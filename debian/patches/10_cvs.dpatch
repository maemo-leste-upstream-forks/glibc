#! /bin/sh -e

# All lines beginning with `# DP:' are a description of the patch.
# DP: Description: CVS Update
# DP: Author: GOTO Masanori <gotom@debian.org>
# DP: Upstream status: In CVS
# DP: Status Details:
# DP: Date: 2003-07-07

if [ $# -ne 2 ]; then
    echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
    exit 1
fi
case "$1" in
    -patch) patch -d "$2" -f --no-backup-if-mismatch -p1 < $0;;
    -unpatch) patch -d "$2" -f --no-backup-if-mismatch -R -p1 < $0;;
    *)
        echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
        exit 1
esac
exit 0

# append the patch here and adjust the -p? flag in the patch calls.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/ChangeLog libc-20030708/ChangeLog
--- glibc-2.3.2/ChangeLog	2003-03-01 10:10:14.000000000 +0900
+++ libc-20030708/ChangeLog	2003-07-08 22:58:05.000000000 +0900
@@ -1,3 +1,4105 @@
+2003-07-04  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/s390/s390-32/elf/start.S: Emit position independent code
+	if PIC.
+	* sysdeps/s390/s390-64/elf/start.S: Likewise.
+
+2003-07-07  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/powerpc/powerpc64/elf/start.S: Put L(start_address)
+	into .data.rel.ro.local section if PIC to avoid DT_TEXTREL.
+
+2003-07-07  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/kernel-features.h: Version
+	__ASSUME_CORRECT_SI_PID and __ASSUME_TGKILL if possible.
+
+	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Adjust for
+	compilation with HAVE_AUX_SECURE defined.
+
+2003-07-05  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/alpha/elf/initfini.c: Avoid .ent/.end.
+
+2003-07-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* configure.in: Also check for .cfi_rel_offset pseudo-op.
+
+2003-07-03  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/prof-freq.c (__profile_frequency): Fix a
+	typo.
+
+2003-07-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/kernel-features.h (__ASSUME_AT_CLKTCK):
+	Define.
+	* sysdeps/unix/sysv/linux/prof-freq.h: New file.
+
+2003-07-02  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Protect new_sysinfo
+	decl and use with #ifdef NEED_DL_SYSINFO.
+
+2003-07-02  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Don't set
+	GL(dl_sysinfo) unles GL(dl_sysinfo_dso) is also set.
+	* sysdeps/unix/sysv/linux/kernel-features.h: Define
+	__ASSUME_VSYSCALL only for 2.5.69 and up since this is when the
+	vsyscall DSO was added.
+
+	* posix/bits/posix1_lim.h (_POSIX_NGROUPS_MAX): Define to 8 or 0
+	depending on selected standard.
+	(NGROUPS_MAX): Define to 8 if not defined.
+
+2003-07-02  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/x86_64/sys/epoll.h: New file.
+
+2003-05-04  H.J. Lu  <hongjiu.lu@intel.com>
+
+	* malloc/arena.c (arena_get2): Add atomic_write_barrier.
+	* malloc/thread-m.h: Include <atomic.h>.
+	(atomic_full_barrier): Provide default.
+	(atomic_read_barrier): Likewise.
+	(atomic_write_barrier): Likewise.
+	* sysdeps/ia64/bits/atomic.h (atomic_full_barrier): New #define.
+
+2003-06-30  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/sysdep.h: Define cfi_rel_offset and CFI_REL_OFFSET.
+
+2003-06-30  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/alpha/bits/atomic.h (__arch_compare_and_exchange_bool_*_int):
+	Invert the sense of the return value.
+	(__arch_exchange_16_int): Fix paste-o.
+	(__arch_exchange_{32,64}_int): Fix think-o.
+
+	* sysdeps/unix/sysv/linux/alpha/clone.S: Load child_tid properly.
+
+2003-06-30  Richard Henderson  <rth@redhat.com>
+
+	* include/sys/resource.h (__getrusage): Mark hidden.
+	* include/sys/time.h (__settimeofday, __setitimer, __utimes): Likewise.
+	* include/sys/wait.h (__wait4): Likewise.
+
+2003-06-17  Guido Guenther  <agx@sigxcpu.org>
+
+	* sysdeps/unix/sysv/linux/mips/xstatconv.c: Handle STAT_IS_KERNEL_STAT
+	case.
+	(xstat_conv): Rename to __xstat_conv and remove static inline.
+	(xstat64_conv): Likewise.
+
+2003-06-29  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/sleep.c (__sleep): Handle parameter
+	values which cannot be handled in one nanosleep call.
+
+2003-06-25  Alfred M. Szmidt  <ams@kemisten.nu>
+
+	* sysdeps/generic/bits/in.h (IPV6_HOPOPTS, IPV6_DSTOPTS): New macros.
+	(IPV6_RXHOPOPTS, IPV6_RXDSTOPTS): Use them.
+
+	* sysdeps/generic/ifreq.h (__if_nextreq) [_HAVE_SA_LEN]: Typo fix.
+
+2003-06-04  Thorsten Kukuk  <kukuk@suse.de>
+
+	* sysdeps/unix/sysv/linux/net/if_arp.h: Sync with kernel header,
+	fix typo.
+
+2003-06-26  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/unix/sysv/linux/xstatconv.h [!STAT_IS_KERNEL_STAT]:
+	Conditionalize function definitions that use struct kernel_stat.
+	* sysdeps/unix/sysv/linux/fxstat.c: Remove __syscall_fstat extern.
+	* sysdeps/unix/sysv/linux/lxstat.c: Remove __syscall_lstat extern.
+	* sysdeps/unix/sysv/linux/xstat.c: Remove __syscall_stat extern.
+
+2003-06-28  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/s390/semtimedop.c (semtimedop): Add real
+	implementation.
+
+2003-06-07  Thorsten Kukuk  <kukuk@suse.de>
+
+	* nis/nss_compat/compat-grp.c: Remove unused nis_first variable.
+	(getgrent_next_file): Don't store group name to early in blacklist.
+
+	* nis/nss_compat/compat-pwd.c (internal_getpwuid_r): Save strlen result
+	and use memcpy instead of strcpy.
+
+2003-06-28  Ulrich Drepper  <drepper@redhat.com>
+
+	* nis/nss_compat/compat-grp.c: Optimize several little things.  Use
+	stream unlocked.
+	* nis/nss_compat/compat-initgroups.c: Likewise.
+	* nis/nss_compat/compat-pwd.c: Likewise.
+	* nis/nss_compat/compat-spwd.c: Likewise.
+
+2003-06-27  Thorsten Kukuk  <kukuk@suse.de>
+
+	* nis/nss_compat/compat-initgroups.c: Don't use our own NIS/NIS+
+	functions, dlopen corresponding NSS module instead.
+
+2003-06-27  Jeroen Dekkers  <jeroen@dekkers.cx>
+
+	* sysdeps/mach/hurd/alpha/init-first.c: Remove call to __libc_init.
+	* sysdeps/mach/hurd/i386/init-first.c: Likewise.
+	* sysdeps/mach/hurd/mips/init-first.c: Likewise.
+	* sysdeps/mach/hurd/powerpc/init-first.c: Likewise.
+
+2003-06-27  Ulrich Drepper  <drepper@redhat.com>
+
+	* rt/Makefile (CFLAGS-librt-cancellation.c): Define.
+
+2003-06-26  Roland McGrath  <roland@frob.com>
+
+	* sysdeps/mach/configure.in: Barf rather than define NO_CREATION_TIME.
+	* sysdeps/mach/configure: Regenerated.
+	* sysdeps/mach/hurd/times.c (times_init): Function removed.
+	(__times): Assume `creation_time' field is available.
+	* sysdeps/mach/hurd/Makefile [$(subdir) = csu] (sysdep_routines):
+	Don't append set-init.
+	* sysdeps/mach/hurd/set-init.c: File removed.
+
+2003-06-26  Roland McGrath  <roland@redhat.com>
+
+	* elf/elf.h (AT_SECURE): New macro.
+	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Grok it,
+	set __libc_enable_secure.
+	(_dl_show_auxv): Add AT_SECURE to name table.
+	* elf/dl-support.c (_dl_aux_init): Grok AT_SECURE, set
+	__libc_enable_secure and __libc_enable_secure_decided.
+	* sysdeps/unix/sysv/linux/ldsodefs.h
+	[__ASSUME_AT_SECURE] (HAVE_AUX_SECURE): Define it.
+	* sysdeps/unix/sysv/linux/kernel-features.h
+	[__LINUX_KERNEL_VERSION >= 132426] (__ASSUME_AT_SECURE): Define it.
+
+2003-06-26  Ulrich Drepper  <drepper@redhat.com>
+
+	* io/test-utime.c: If _STATBUF_ST_NSEC is defined, adjust lower
+	boundary test to take rounding of nanoseconds into account.
+
+	* sysdeps/unix/sysv/linux/bits/stat.h: Define _STATBUF_ST_NSEC.
+	* sysdeps/unix/sysv/linux/ia64/bits/stat.h: Likewise.
+	* sysdeps/unix/sysv/linux/m68k/bits/stat.h: Likewise.
+	* sysdeps/unix/sysv/linux/powerpc/bits/stat.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/bits/stat.h: Likewise.
+	* sysdeps/unix/sysv/linux/sparc/bits/stat.h: Likewise.
+	* sysdeps/unix/sysv/linux/x86_64/bits/stat.h: Likewise.
+
+2003-06-26  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/m68k/fpu/bits/mathinline.h: Don't inline frexp.
+	* sysdeps/m68k/fpu/s_frexp.c: Put implementation here.
+	* sysdeps/m68k/fpu/s_frexpl.c: Fix to handle unnormalized numbers.
+
+2003-06-17  Thorsten Kukuk  <kukuk@suse.de>
+
+	* nis/Makefile: Remove NIS/NIS+ files from nss_compat module.
+	* nis/nss_compat/compat-grp.c: Don't use our own NIS/NIS+ functions,
+	dlopen corresponding NSS module instead.
+	* nis/nss_compat/compat-pwd.c: Likewise.
+	* nis/nss_compat/compat-spwd.c: Likewise.
+	* nis/nss_compat/compat-initgroups.c: Disabled for now.
+	* nss/Versions: Export __nss_lookup_function.
+
+2003-06-19  Daniel Jacobowitz  <drow@mvista.com>
+
+	* sysdeps/unix/sysv/linux/kernel-features.h: Update kernel features
+	for the SH architecture.
+
+2003-06-25  Thorsten Kukuk  <kukuk@suse.de>
+
+	* csu/Makefile: Use CPPFLAGS to find correct linux/version.h.
+
+2003-06-25  Andreas Jaeger  <aj@suse.de>
+
+	* stdlib/tst-strtod.c (main): Declare constant long double as
+	suggested by Jakub Jelinek and Andreas Schwab.
+
+	* posix/tst-nanosleep.c: Include <time.h> for nanosleep
+	declaration.
+
+	* stdio-common/tst-fphex.c: Fix format string.
+
+	* posix/transbug.c: Include <string.h> for memset and strlen
+	declarations.
+
+	* stdio-common/tst-sprintf.c: Include <stdlib.h> for free declaration.
+
+	* stdlib/tst-strtod.c (main): Pass long double value.
+
+	* test-skeleton.c: Include <time.h> for nanosleep declaration.
+
+2003-06-25  Ulrich Drepper  <drepper@redhat.com>
+
+	* include/time.h: Don't define CLOCK_IDFIELD_SIZE if _ISOMAC is
+	defined.
+
+2003-06-11  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/Versions (libc): Add _dl_open_hook@GLIBC_PRIVATE.
+	* elf/dl-libc.c (struct dl_open_hook): New.
+	(_dl_open_hook): New variable.
+	(do_dlsym_private): New function.
+	(__libc_dlopen_mode) [!SHARED]: Lookup _dl_open_hook@GLIBC_PRIVATE
+	and initialize it if found.
+	(__libc_dlopen_mode) [SHARED]: If _dl_open_hook is non-NULL,
+	call dlopen_mode hook.
+	(__libc_dlsym) [SHARED]: If _dl_open_hook is non-NULL,
+	call dlsym hook.
+	(__libc_dlclose) [SHARED]: If _dl_open_hook is non-NULL,
+	call dlclose hook.
+
+2003-06-25  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/cris/sysdep.h (INLINE_SYSCALL): Cast
+	result to long int so that extensions to long long int work.
+	Patch by Uwe Reimann <libc-alpha@pulsar.homelinux.net>.
+
+2003-06-19  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/ldconfig.c (main): Use add_system_dir instead of add_dir.
+	* sysdeps/generic/dl-cache.h (add_system_dir): Define.
+	* sysdeps/unix/sysv/linux/x86_64/dl-cache.h: Include sparc
+	dl-cache.h.
+	* sysdeps/unix/sysv/linux/s390/dl-cache.h: New file.
+	* sysdeps/unix/sysv/linux/mips/dl-cache.h: New file.
+	* sysdeps/unix/sysv/linux/powerpc/dl-cache.h: New file.
+	* sysdeps/unix/sysv/linux/sparc/dl-cache.h: New file.
+
+2003-06-19  Jakub Jelinek  <jakub@redhat.com>
+
+	* test-skeleton.c (timeout_handler): If waitpid returned 0,
+	retry once after a second.  If killed == 0, assume
+	WTERMSIG (status) == SIGKILL.
+
+2003-06-18  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/generic/dl-sysdep.c (_dl_show_auxv): Catch uninitialized
+	elements in the table instead of printing an empty name string.
+
+2003-06-05  Roland McGrath  <roland@redhat.com>
+
+	* elf/elf.h (PT_GNU_STACK): New macro.
+
+2003-06-24  Ulrich Drepper  <drepper@redhat.com>
+
+	* include/time.h: Define CLOCK_IDFIELD_SIZE.
+	* sysdeps/posix/clock_getres.c: Recognize thread CPU clock IDs.
+	* sysdeps/unix/clock_gettime.c: Likewise.
+	* sysdeps/unix/clock_settime.c: Likewise.
+	* sysdeps/unix/clock_nanosleep.c (CPUCLOCK_P): Adjust for new
+	clock id for thread CPU clocks.
+
+	* sysdeps/unix/sysv/linux/fstatfs64.c (__fstatfs64): Add support
+	for the fstatfs64 syscall.
+	* sysdeps/unix/sysv/linux/statfs64.c (__statfs64): Add support for
+	the statfs64 syscall.
+
+	* sysdeps/unix/sysv/linux/kernel-features.h: Define
+	__ASSUME_STATFS64 appropriately.
+
+	* sysdeps/unix/sysv/linux/internal_statvfs.c: Use f_frsize field
+	from statfs structure if it has been filled in.
+
+	* sysdeps/unix/sysv/linux/bits/statfs.h (struct statfs): Add f_frsize
+	field.
+	(struct statfs64): Likewise.
+	* sysdeps/unix/sysv/linux/alpha/bits/statfs.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/bits/statfs.h: Likewise.
+
+2003-06-24  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/unix/sysv/linux/alpha/syscalls.list (pread, pwrite): Use
+	the 64-bit syscall name.
+
+	* sysdeps/alpha/setjmp.S (_setjmp, setjmp): Mark .prologue.
+
+	* sysdeps/alpha/fpu/bits/mathinline.h: Honor
+	__LIBC_INTERNAL_MATH_INLINES.  Implement __signbitf, __signbit.
+
+	* sysdeps/unix/sysv/linux/alpha/clone.S: Use HIDDEN_JUMPTARGET.
+	* sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S: Use
+	libc_hidden_def.
+	* sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/setfpucw.c: Use libc_hidden_proto
+	on them.
+
+	* sysdeps/alpha/bits/atomic.h: New file.
+
+2003-06-24  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/m68k/fpu/libm-test-ulps: Update.
+
+2003-06-24  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/x86_64/stat.h (_STAT_VER_LINUX): Avoid
+	redeclaration with 32-bit code.
+
+2003-05-19  Ed Connell  <ed.connell@sas.com>
+
+	* sysdeps/unix/sysv/linux/i386/getcontext.S (getcontext): Retain
+	floating point mask.
+	* sysdeps/i386/fpu/fegetenv.c (fegetenv): Likewise.
+
+2003-06-23  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/pthread/aio_misc.h: Mark __aio_requests_mutex,
+	__aio_enqueue_request, __aio_find_req, __aio_find_req_fd,
+	__aio_free_request, __aio_notify, and __aio_sigqueue as hidden.
+
+	* sysdeps/pthread/aio_suspend.c (aio_suspend): Set errno to the result
+	of pthread_cond_wait if there was an error.  Use pthread_cleanup_*
+	instead of __libc_cleanup_region_*.
+
+2003-06-20  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/unix/make-syscalls.sh: Implement ! prefix for strong aliases.
+	* sysdeps/unix/sysv/linux/alpha/syscalls.list (open, open64): New.
+
+2003-06-20  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/unix/alpha/sysdep.h (INLINE_SYSCALL1): Use __builtin_expect.
+	* sysdeps/unix/sysv/linux/kernel-features.h (__ASSUME_ST_INO_64_BIT)
+	Unset for alpha.
+	(__ASSUME_TIMEVAL64): Set for alpha.
+	* sysdeps/unix/sysv/linux/alpha/Makefile (sysdep_routines): Remove
+	adjtimex, osf_sigprocmask, old_adjtimex.
+	* sysdeps/unix/sysv/linux/alpha/adjtime.c: Use INLINE_SYSCALL,
+	__ASSUME_TIMEVAL64.  Reorg tv64 functions to avoid uninit variable.
+	* sysdeps/unix/sysv/linux/alpha/getitimer.S: Use __ASSUME_TIMEVAL64.
+	* sysdeps/unix/sysv/linux/alpha/getrusage.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/gettimeofday.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/select.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/setitimer.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/settimeofday.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/utimes.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/wait4.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S: Streamline
+	PIC code sequence.
+	* sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/sigaction.c: New file.
+	* sysdeps/unix/sysv/linux/alpha/sigprocmask.c: Use INLINE_SYSCALL.
+	* sysdeps/unix/sysv/linux/alpha/ustat.c: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/xmknod.c: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/syscalls.list: Remove osf_sigprocmask,
+	sys_ustat, sys_mknod, adjtimex, old_adjtimex.
+	* sysdeps/unix/sysv/linux/alpha/sysdep.h (INLINE_SYSCALL): Don't
+	defer to __syscall_name; error for rt_sigaction.
+	* sysdeps/unix/sysv/linux/alpha/xstatconv.c: Include kernel_stat.h.
+
+2003-06-18  Ulrich Drepper  <drepper@redhat.com>
+
+	* malloc/malloc.c (public_mALLINFo): Initialize malloc if it
+	hasn't happened yet.
+
+	* sysdeps/unix/sysv/linux/x86_64/register-dump.h (register_dump):
+	Fix completely broken implementation.  The second parameter is of
+	type struct ucontext*.
+
+	* sysdeps/x86_64/dl-machine.h (elf_machine_runtime_setup): Always
+	inline.
+
+	* sysdeps/i386/i686/dl-hash.h: Don't inline _dl_elf_hash.
+	* sysdeps/generic/dl-hash.h: Likewise.
+
+	* sysdeps/generic/memcmp.c: Remove inline from
+	memcmp_common_alignment and memcmp_not_common_alignment definition.
+
+	* intl/localealias.c (read_alias_file): Determine whether line is
+	read incompletely early, before we modify the line.
+
+2003-06-17  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_rela)
+	<case R_PPC64_DTPREL64>: Don't segfault on undefined symbols.
+
+2003-06-17  Paul Mackerras  <paulus@samba.org>
+
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/getcontext.S: New file.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/makecontext.S: New file.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/setcontext.S: New file.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/swapcontext.S: New file.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/ucontext_i.h: New file.
+	* sysdeps/unix/sysv/linux/powerpc/sys/ucontext.h: Adjust.
+
+2003-06-17  Jakub Jelinek  <jakub@redhat.com>
+
+	* posix/regcomp.c (build_word_op): Use alnum instead of alpha class.
+
+2003-06-17  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/clock_nanosleep.c (clock_nanosleep): nanosleep
+	takes care of enabling cancellation.
+
+	* sysdeps/pthread/aio_suspend.c (aio_suspend): Make aio_suspend
+	cancelable.  It's not correct to disable cancellation.  Instead of
+	a cleanup handler.
+
+	* sysdeps/unix/sysv/linux/sigtimedwait.c: If SIGCANCEL is defined
+	and part of the incoming set, create a temporary set without this
+	signal.
+	* sysdeps/unix/sysv/linux/sigwait.c: Likewise.
+	* sysdeps/unix/sysv/linux/sigwaitinfo.c: Likewise.
+
+	* sysdeps/unix/sysv/linux/sleep.c: Use CANCELLATION_P if defined before
+	returning because seconds==0.  Add __builtin_expect.
+
+2003-06-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/i386/socket.S: Add unwind information.
+
+	* sysdeps/unix/sysv/linux/wait.c (__libc_wait): Fix type of result
+	variable.
+
+2003-06-16  Thorsten Kukuk  <kukuk@suse.de>
+
+	* include/libc-symbols.h: Add static_link_warning macro.
+	* grp/initgroups.c: Print linker warning if this function
+	is called in a static linked binary.
+	* nss/getXXbyYY.c: Likewise.
+	* nss/getXXbyYY_r.c: Likewise.
+	* nss/getXXent.c: Likewise.
+	* nss/getXXent_r.c: Likewise.
+	* sysdeps/posix/getaddrinfo.c: Likewise.
+
+2003-06-16  Bruno Haible  <bruno@clisp.org>
+
+	* iconvdata/gconv-modules (ISO-8859-15): Add aliases ISO_8859-15,
+	LATIN-9.
+	(ISO-8859-16): Add aliases ISO_8859-16:2001, ISO_8859-16.
+	(IBM1047): Add alias IBM-1047.
+	(GBK): Add aliases MS936, WINDOWS-936.
+
+2003-06-16  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/xstatconv.c (__xstat_conv): Define even if
+	defined __ASSUME_STAT64_SYSCALL && defined XSTAT_IS_XSTAT64.
+	(__xstat64_conv): Change xstat_conv to __xstat_conv.
+
+2003-06-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* locale/iso-639.def: Update from current official ISO 639.
+
+	* math/tgmath.h (__TGMATH_UNARY_IMAG_ONLY): Removed.
+
+2003-06-15  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/i386/fpu/feenablxcpt.c (feenableexcept): Correct setting
+	of MXCSR.
+	* sysdeps/i386/fpu/fedisblxcpt.c (fedisableexcept): Likewise.
+	* sysdeps/i386/fpu/feholdexcpt.c (feholdexcept): Likewise.
+	Reported by Arnaud Desitter <arnaud.desitter@geography.oxford.ac.uk>.
+
+	* math/tgmath.h (carg): Handle real arguments.
+	(conj): Likewise.
+	(cproj): Likewise.
+	(cimag): Likewise.
+	(creal): Likewise.
+
+	* math/Makefile (CFLAGS-test-tgmath-ret.c): New.
+	(tests): Add test-tgmath-ret.
+	* math/test-tgmath-ret.c: New file.
+
+	* math/tgmath.h (ilogb): Return always an int.
+
+2003-06-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/rtld.c (dl_main): Use l_map_start not l_addr in Phdr
+	computation so that prelinking works.
+
+2003-06-15  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/dl-iteratephdr.c (__dl_iterate_phdr): Don't skip dynamic
+	linker's map.
+	* elf/rtld.c (dl_main): Initialize l_phdr and l_phnum of of the
+	dynamic linker's map.
+
+	Fix cancellation point handling wrt exception based cleanup.
+	* io/Makefile: Compile fcntl.c, poll.c, and lockf.c with exceptions.
+	* misc/Makefile: Compile pselect.c, readv.c, writev.c, and usleep.c
+	with exceptions.
+	* posix/Makefile: Compile pread.c, pread64.c, pwrite.c, pwrite64.c,
+	sleep.c, wait.c, waitid.c, and waitpid.c with exceptions.
+	* rt/Makefile: Compile aio_suspend.c and clock_nanosleep.c with
+	exceptions.
+	* signal/Makefile: Compile sigpause.c, sigsuspend.c, sigtimedwait.c,
+	sigwait.c, and sigwaitinfo.c with exceptions.
+	* stdlib/Makefile: Compile system.c with exceptions.
+	* sysvipc/Makefile: Compile msgrcv.c and msgsnd.c with exceptions.
+	* termios/Makefile: Compile tcdrain.c with exceptions.
+	* sysdeps/generic/lockf.c: Add comment explaining the cancellation
+	situation.
+	* sysdeps/generic/pselect.c: Likewise.
+	* sysdeps/posix/sigpause.c: Likewise.
+	* sysdeps/posix/system.c: Likewise.
+	* sysdeps/posix/waitid.c: Likewise.
+	* sysdeps/unix/sysv/linux/sleep.c: Likewise.
+	* sysdeps/unix/sysv/linux/usleep.c: Likewise.
+	* sysdeps/unix/sysv/linux/i386/sysdep.h: Major rewrite of
+	INTERNAL_SYSCALL to not use push inside asm statement so that
+	unwind info is correct around the syscall.
+	* sysdeps/unix/clock_nanosleep.c: Add cancellation support.
+	* sysdeps/unix/sysv/linux/clock_nanosleep.c: Likewise.
+
+2003-06-15  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/x86_64/dl-machine.h (ELF_MACHINE_RUNTIME_TRAMPOLINE):
+	Add CFI directives.
+
+2003-06-15  Guido Guenther  <agx@sigxcpu.org>
+
+	* sysdeps/unix/sysv/linux/mips/Makefile: Add missing endif and
+	create $(objpfx).
+
+2003-06-14  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/check_pf.c (__check_pf): Use __close,
+	not close.
+
+	* inet/inet6_option.c (inet6_option_alloc): Add libc_hidden_def.
+	* include/netinet/in.h (inet6_option_alloc): Add libc_hidden_proto
+	definition.
+
+	* inet/netinet/ip6.h (IP6OPT_PAD1, IP6OPT_PADN): Define.
+	* inet/netinet/in.h: Add prototypes for inet6_option_* functions.
+	* inet/Makefile (routines): Add inet6_option.
+	* inet/inet6_option.c: New file.
+	* inet/Versions [GLIBC_2.3.3] (libc): Add inet6_option_space,
+	inet6_option_init, inet6_option_append, inet6_option_alloc,
+	inet6_option_next, and inet6_option_find.
+
+2003-06-13  Ulrich Drepper  <drepper@redhat.com>
+
+	* inet/netinet/ip6.h (struct ip6_ext): Define.
+
+	* sysdeps/unix/sysv/linux/sys/param.h (howmany): Optimize for gcc.
+
+	Fixing gcc 3.3 warnings, part II.
+	* argp/argp-help.c (hol_entry_long_iterate): Always inline.
+	* elf/dl-load.c (cache_rpath): Don't inline.
+	* iconvdata/cns11642l2.h: Always inline all functions.
+	* iconvdata/iso-ir-165.h: Likewise.
+	* locale/Makefile (aux): Add coll-lookup.
+	* locale/coll-lookup.c: New file.
+	* locale/coll-lookup.h (collidx_table_lookup): Do not define here.
+	(collseq_table_lookup): Likewise.
+	* locale/weightwc.h: Adjust collidx_table_lookup calls for name change.
+	* posix/fnmatch_loop.c: Adjust collseq_table_lookup calls for name
+	change.
+	* posix/regcomp.c: Likewise.
+	* posix/regexec.c: Likewise.
+	* locale/programs/3level.h (*_get): Always inline.
+	* locale/programs/locfile.h: Move definition of handle_copy to...
+	* locale/programs/locfile.c: ...here.
+	* locale/programs/ld-collate.c (obstack_int32_grow): Always inline.
+	(obstack_int32_grow_fast): Likewise.
+	(utf8_encode): Likewise.
+	(find_element): Avoid aliasing problems.
+	(insert_value): Likewise.
+	(collate_read): Likewise.
+	* nss/getent.c (print_hosts): Don't inline
+	(print_networks): Likewise.
+	(print_shadow): Likewise.
+	(build_doc): Likewise.
+	* nss/nss_files/files-parse.c [ENTDATA] (parser_stclass): Don't
+	inline.
+	* posix/regcomp.c (re_set_fastmap): Always inline.
+	(seek_collating_symbol_entry): Likewise.
+	(lookup_collation_sequence_value): Likewise.
+	(build_range_exp): Likewise.
+	(build_collating_symbol): Likewise.
+	* posix/regexec.c (acquire_init_state_context): Don't inline.
+	(clean_state_log_if_need): Likewise.
+	* resolv/res_send.c (eConsIovec): Rewrite to not return struct and
+	adjust all callers.
+	(evConsTime): Likewise.
+	(evAddTime): Likewise.
+	(evSubTime): Likewise.
+	(evNowTime): Likewise.
+	(evTimeSpec): Removed.
+	(__libc_res_nsend): Avoid aliasing problem.
+	* sysdeps/unix/sysv/linux/ifreq.h: Move old_siocgifconf definition to..
+	* sysdeps/unix/sysv/linux/ifreq.c: ...here.
+	* sysdeps/unix/sysv/linux/i386/dl-procinfo.h (_dl_string_hwcap):
+	Always inline.
+	(_dl_string_platform): Likewise.
+	* wctype/wchar-lookup.h (wctype_table_lookup): Always inline.
+	(wcwidth_table_lookup): Likewise.
+	(wctrans_table_lookup): Likewise.
+
+	* sysdeps/unix/sysv/linux/sys/epoll.h: Include <stdint.h>.
+
+2003-06-12  Ulrich Drepper  <drepper@redhat.com>
+
+	* wcsmbs/wchar.h: Define wint_t in std namespace, too [PR libc/5034].
+
+2003-05-29  Jim Meyering  <jim@meyering.net>
+
+	* time/strftime.c (my_strftime) [!defined _NL_CURRENT
+	&& HAVE_STRFTIME]: Use underlying_strftime for %r.
+	Suggested by Daniel Yacob <locales@geez.org>.
+
+2003-06-12  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/powerpc64/dl-machine.h (RTLD_START): Replace
+	@got notation with @toc.
+	* sysdeps/powerpc/powerpc64/sysdep.h (CALL_MCOUNT): Likewise.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc64/brk.S (__brk): Likewise.
+
+2003-06-12  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/posix/getaddrinfo.c (gaih_inet): Set no_inet6_date also
+	if only PF_INET address is needed.
+
+	* nss/getXXbyYY_r.c: Make sure we always return a nonzero value in
+	case of an error.
+
+	* scripts/config.guess: Update from upstream version.
+	* scripts/config.sub: Likewise.
+
+2003-06-12  Jakub Jelinek  <jakub@redhat.com>
+
+	* locale/programs/ld-time.c (time_output): Also copy the era format,
+	not only the name.
+
+2003-06-12  H.J. Lu  <hongjiu.lu@intel.com>
+
+	* posix/transbug.c (run_test): Return 1 for failure.
+	(do_test): Compare only if run_test is successful.
+
+2003-06-12  Simon Josefsson  <jas@extundo.com>
+
+	* argp/argp.h [!__THROW]: Define if undefined.
+
+2003-06-12  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/cris/sysdep.h: Fix handling of syscalls with
+	more than four parameters.
+	Patch by Uwe Reimann <libc-alpha@pulsar.homelinux.net>.
+
+2003-06-12  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/kernel_stat.h: New file.
+	* sysdeps/unix/sysv/linux/s390/s390-64/kernel_stat.h: New file.
+	* sysdeps/unix/sysv/linux/x86_64/kernel_stat.h: New file.
+
+	* stdio-common/printf-parsemb.c: Include stdlib.h and sys/param.h.
+
+2003-06-12  Roland McGrath  <roland@redhat.com>
+
+	* Makerules ($(objpfx)stubs): Rewrite sed magic.
+
+2003-02-28  Isamu Hasegawa  <isamu@yamato.ibm.com>
+
+	* posix/regcomp.c (parse_expression): Deliver translation to
+	build_word_op, and build_charclass.
+	(build_charclass): Apply translation for character classes too.
+	(build_word_op): Deliver translation to build_charclass.
+	* posix/transbug.c: New file.
+	* posix/Makefile (tests): Add transbug.
+
+2003-06-04  Paolo Bonzini  <bonzini@gnu.org>
+
+	* posix/regexec.c (group_nodes_into_DFAstates): Check for
+	NEXT_ENDBUF_CONSTRAINT.  Move check for constraints which do a
+	'continue' before the others.
+
+2003-06-11  Ulrich Drepper  <drepper@redhat.com>
+
+	* dirent/scandir.c (SCANDIR): Reset errno after calling selector
+	function [PR libc/5045].
+
+	* sysdeps/i386/bits/byteswap.h (__bswap_32): Use bswap instruction
+	also for P4.
+
+	* time/tzfile.c: Add a couple of __builtin_expect.
+
+	Remove warnings gcc 3.3 shows.
+	* argp/argp-help.c (hol_entry_short_iterate): Don't inline.
+	* elf/dl-load.c (fillin_rpath): Likewise.
+	(add_path): Likewise.
+	* elf/dl-version.c (find_needed): Always inline.
+	* elf/do-lookup.c (FCT): Don't inline.
+	* iconv/Makefile: Extend vpath to intl subdir.
+	(iconvconfig-modules): Add hash-string.
+	* iconv/gconv_charset.h (strip): Don't inline.
+	(upstr): Always inline.
+	Move __gconv_compare_alias prototype to...
+	* iconv/gconv_int.h: ...here.
+	* iconv/gconv_db.c: Don't include gconv_charset.h.
+	* iconv/gconv_conf.c (add_alias): Don't inline.
+	(insert_module): Likewise.
+	* iconv/gconv_simple.c (internal_ucs4_loop): Always inline.
+	(internal_ucs4_loop_unaligned): Likewise.
+	(internal_ucs4_loop_single): Likewise.
+	(ucs4_internal_loop): Likewise.
+	(ucs4_internal_loop_unaligned): Likewise.
+	(ucs4_internal_loop_single): Likewise.
+	(internal_ucs4le_loop): Always inline.
+	(internal_ucs4le_loop_unaligned): Likewise.
+	(internal_ucs4le_loop_single): Likewise.
+	(ucs4le_internal_loop): Likewise.
+	(ucs4le_internal_loop_unaligned): Likewise.
+	(ucs4le_internal_loop_single): Likewise.
+	* iconv/loop.c: Always inline the defined functions.
+	* iconvdata/cns11642.h: Likewise.
+	* iconvdata/cns11642l1.h: Likewise.
+	* iconvdata/euc-kr.c: Likewise.
+	* iconvdata/gb2312.h: Likewise.
+	* iconvdata/jis0201.h: Likewise.
+	* iconvdata/jis0208.h: Likewise.
+	* iconvdata/jis0212.h: Likewise.
+	* iconvdata/jisx0213.h: Likewise.
+	* iconvdata/ksc5601.h: Likewise.
+	* iconvdata/utf-7.c (base64): Don't inline.
+	* include/libc-symbols.h (symbol_set_first_element): Add cast
+	(symbol_set_end_p): Likewise.
+	* include/set-hooks (RUN_HOOK): Likewise.
+	* inet/Makefile (aux): Add ifreq.
+	* intl/Makefile (aux): Add some entries from routines.  Add
+	hash-string.
+	* intl/hash-string.c: New file.
+	* intl/hash-string.h: Remove hash_string definition.  Declare
+	__hash_string.
+	* iconv/gconv_cache.c (find_module_idx): Adjust hash_string caller.
+	* iconv/iconvconfig.c (new_name): Likewise.
+	* intl/dcigettext.c (_nl_find_msg): Likewise.
+	* intl/loadmsgcat.c (_nl_load_domain): Likewise.
+	* io/ftw.c (open_dir_stream): Always inline.
+	(process_entry): Don't inline.
+	* locale/findlocale.c: Include gconv_int.h.
+	* locale/setlocale.c (new_composite_name): Don't inline.
+	* locale/weight.h (findidx): Always inline.
+	* locale/weightwc.h (findidx): Likewise.
+	* locale/programs/linereader.c (lr_ignore_rest): Define here.
+	* locale/programs/linereader.h (lr_ignore_rest): Don't define here,
+	just declare it.
+	(lr_getc): Always inline.
+	(lr_ungetc): Likewise.
+	* nss/nss_files/files-parse.c (parse_list): Likewise.
+	* stdio-common/Makefile (aux): Add printf-parsemb and
+	printf-parsewc.
+	* stdio-common/_itoa.h (_itoa_word): Always inline.
+	(_fitoa_word, _fitoa): Don't define here, only declare.
+	* stdio-common/_itoa.c (_iftoa_word): Add here.
+	(_fitoa): Likewise.
+	* stdio-common/_itowa.h (_itowa_word): Always inline.
+	* stdio-common/printf-parse.h (read_int): Don't inline.
+	(find_spec): Don't define.
+	Declare __find_specmb and __find_specwc.
+	(parse_one_spec): Don't define.
+	Declare __parse_one_specmb and __parse_one_specwc.
+	* stdio-common/printf-parsemb.c: New file.
+	* stdio-common/printf-parsewc.c: New file.
+	* stdio-common/vfprintf.c: Update calls to find_spec and
+	parse_one_spec for new names.
+	* stdio-common/printf-prs.c: Likewise.  Define DONT_NEED_READ_INT.
+	* stdlib/Makefile (aux): Add grouping and groupingwc.
+	* stdlib/grouping.c: New file.
+	* stdlib/groupingwc.c: New file.
+	* stdlib/grouping.h (correctly_grouped_prefix): Don't define here.
+	Just prototype.
+	* stdlib/rpmatch.c (try): Don't inline.
+	* stdlib/strtod.c (round_and_return): Don't line.
+	(str_to_mpn): Likewise.
+	(__mpn_lshift_1): Always inline.  Optimize only for constant count.
+	Adjust for name change of correctly_grouped_prefix.
+	* sysdeps/generic/strtol.c: Adjust for name change of
+	correctly_grouped_prefix.
+	* string/strxfrm.c (utf8_encode): Don't inline.
+	* sysdeps/generic/dl-cache.c: Define _dl_cache_libcmp.
+	* sysdeps/generic/dl-cache.h: Just declare _dl_cache_libcmp.
+	* sysdeps/generic/ifreq.c: New file.
+	* sysdeps/unix/sysv/linux/ifreq.c: New file.
+	* sysdeps/generic/ifreq.h (__ifreq): Only declare here.
+	* sysdeps/unix/sysv/linux/ifreq.h: Likewise.
+	* sysdeps/generic/ldsodefs.h (_dl_name_match_p): Always inline.
+	* sysdeps/generic/unwind-dw2-fde.c (start_fde_sort): Don't inline.
+	(fde_split): Likewise.
+	(fde_merge): Likewise.
+	(end_fde_sort): Likewise.
+	(init_object): Likewise.
+	(binary_search_unencoded_fdes): Likewise.
+	(binary_search_single_encoding_fdes): Likewise.
+	(binary_search_mixed_encoding_fdes): Likewise.
+	* sysdeps/generic/wordexp.c (w_addchar): Don't inline.
+	* sysdeps/i386/dl-machine.c (elf_machine_runtime_setup): Always inline.
+	* sysdeps/posix/sprofil.c (profil_count): Don't inline.
+	* sysdeps/unix/sysv/linux/Makefile [subdir=io] (sysdep_routines):
+	Add xstatconv.
+	* sysdeps/unix/sysv/linux/xstatconv.h: New file.
+	* sysdeps/unix/sysv/linux/xstatconv.c: Don't inline the function.
+	Export them.  Prepend __ to name.
+	* sysdeps/unix/sysv/linux/Dist: Add xstatconv.h.
+	* sysdeps/unix/sysv/linux/fxstat.c: Adjust for name change of
+	conversion functions.
+	* sysdeps/unix/sysv/linux/fxstat64.c: Likewise.
+	* sysdeps/unix/sysv/linux/lxstat.c: Likewise.
+	* sysdeps/unix/sysv/linux/lxstat64.c: Likewise.
+	* sysdeps/unix/sysv/linux/xstat.c: Likewise.
+	* sysdeps/unix/sysv/linux/xstat64.c: Likewise.
+	* sysdeps/unix/sysv/linux/i386/fxstat.c: Likewise.
+	* sysdeps/unix/sysv/linux/i386/lxstat.c: Likewise.
+	* sysdeps/unix/sysv/linux/i386/xstat.c: Likewise.
+	* sysdeps/unix/sysv/linux/pathconf.c (__statfs_link_max,
+	__statfs_filesize_max, __statfs_symlinks): Define here.  __ prepended
+	to name.  Change callers.
+	* sysdeps/unix/sysv/linux/pathconf.h (__statfs_link_max,
+	__statfs_filesize_max, __statfs_symlinks): Don't define here, just
+	declare.
+	* sysdeps/unix/sysv/linux/fpathconf.c: Change all callers.
+	* time/tzfile.c (decode): Always inline.
+	* wcsmbs/wcsnrtombs.c: Change type of inbuf to unsigned char*.
+	Remove cast in tomb function call.
+	* wcsmbs/wcsrtombs.c Likewise.
+	* wcsmbs/wcstob.c: Introduce new temp variable to take pointer in
+	tomb function call.
+
+2003-06-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* po/zh_CN.po: Update from translation team.
+
+2003-06-10  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/bits/in.h (IPV6_V6ONLY, IPV6_JOIN_ANYCAST,
+	IPV6_LEAVE_ANYCAST, IPV6_IPSEC_POLICY, IPV6_XFRM_POLICY): Define.
+
+2003-06-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* inet/Makefile (aux): Add check_pf.
+	* include/ifaddrs.h: Add prototype for __check_pf.
+	* sysdeps/generic/check_pf.c: New file.
+	* sysdeps/unix/sysv/linux/check_pf.c: New file.
+	* sysdeps/unix/sysv/linux/ifaddrs.h (__no_netlink_support): Renamed
+	from no_netlink_support.  Export.
+	* sysdeps/posix/getaddrinfo.c (getaddrinfo): Don't call getifaddrs,
+	call __check_pf.
+
+	* sysdeps/generic/ifaddrs.h: Add libc_hidden_def.
+
+	* sysdeps/posix/getaddrinfo.c (getaddrinfo): Don't leak memory
+	from getifaddr calls.
+
+2003-06-09  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/kernel-features.h
+	(__ASSUME_SETRESGID_SYSCALL): Define.
+	* sysdeps/unix/sysv/linux/setegid.c: Use __ASSUME_SETRESGID_SYSCALL
+	instead of __ASSUME_SETRESUID_SYSCALL.
+	(setegid): Only use setresgid32 inline syscall if __NR_setresgid32 is
+	defined.
+	* sysdeps/unix/sysv/linux/seteuid.c (seteuid): Only use setresgid32
+	inline syscall if __NR_setresuid32 is defined.
+	* sysdeps/unix/sysv/linux/i386/setegid.c (setegid): Use
+	__ASSUME_SETRESGID_SYSCALL instead of __ASSUME_SETRESUID_SYSCALL.
+	* sysdeps/unix/sysv/linux/i386/setregid.c: Backout last changes.
+	* sysdeps/unix/sysv/linux/i386/setreuid.c: Likewise.
+	* sysdeps/unix/sysv/linux/sparc/sparc32/setegid.c (setegid): Protect
+	code handling non-existant setresgid32 syscall with
+	#if __ASSUME_SETRESGID_SYSCALL == 0.
+
+2003-06-09  Andreas Schwab  <schwab@suse.de>
+
+	* sunrpc/Makefile (generated): Remove rpc-proto.c, rpc-proto.d.
+	($(rpcsvc:%.x=$(objpfx)x%$o)): Don't depend on
+	$(objpfx)rpc-proto.d.
+	(rpcsvc-dt-files, rpcsvc-depfiles): Define.  Include
+	$(rpcsvc-depfiles) instead of $(objpfx)rpc-proto.d.
+	($(objpfx)rpc-proto.d, $(objpfx)rpc-proto.c): Remove rules.
+
+2003-06-08  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/seteuid.c (seteuid): Use setresuid32
+	syscall directly if possible.  If __ASSUME_SETRESUID_SYSCALL is
+	defined drop compatibility code.
+	* sysdeps/unix/sysv/linux/setegid.c (setegid): Use setresgid32
+	syscall directly if possible.  If __ASSUME_SETRESUID_SYSCALL is
+	defined drop compatibility code.
+	* sysdeps/unix/sysv/linux/i386/seteuid.c (seteuid): Use
+	setresuid32 syscall directly if possible.
+	* sysdeps/unix/sysv/linux/i386/setegid.c (setegid): Use
+	setresgid32 syscall directly if possible.
+	* sysdeps/unix/sysv/linux/i386/setregid.c (__setregid): Make POSIX
+	compliant.  Don't change sgid.
+	* sysdeps/unix/sysv/linux/i386/setreuid.c (__setreuid): Make POSIX
+	compliant.  Don't change suid.
+
+	* config.h.in: Add have-forced-unwind.
+	* configure.in: Add AC_SUBST(libc_cv_forced_unwind).
+
+2003-06-07  Ulrich Drepper  <drepper@redhat.com>
+
+	* test-skeleton.c (main): If EXPECTED_STATUS is defined check that
+	returned status from child matches.
+
+	* Makeconfig (gnulib): Add -lgcc_eh once again.
+
+2003-06-06  Ulrich Drepper  <drepper@redhat.com>
+
+	* test-skeleton.c (main): Use TEMP_FAILURE_RETRY with waitpid.
+
+	* sysdeps/unix/sysv/linux/i386/sysdep.h (ASMFMT_2): Only allow
+	%edx for first parameter.  This means no pushl and therefore the
+	unwind info isn't screwed up.
+
+2003-06-04  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/alpha/dl-machine.h (RTLD_START): Fix top-of-stack backtrace.
+	* sysdeps/unix/sysv/linux/alpha/clone.S: Likewise.
+	* sysdeps/alpha/elf/start.S: Likewise.  Remove pointless allocation.
+	* sysdeps/unix/sysv/linux/alpha/rt_sigaction.S: Use standard ldgp
+	entry sequence and explicit relocs.  Add unwind info for sigreturn
+	and rt_sigreturn.
+	* configure.in (libc_cv_asm_cfi_directives): Test .cfi_remember_state.
+
+	* sysdeps/unix/sysv/linux/alpha/syscalls.list (semtimedop): New.
+	Annotate some parameters.
+	* sysdeps/unix/sysv/linux/alpha/sysdep.h (__NR_semtimedop): New.
+
+	* sysdeps/unix/sysv/linux/alpha/gettimeofday.S: Fix typo in conversion.
+
+	* include/libc-symbols.h (symbol_set_declare): Use arrays
+	of unspecified size.
+
+2003-06-04  Jakub Jelinek  <jakub@redhat.com>
+
+	* config.make.in (ASFLAGS-config): New.
+	* Makeconfig (ASFLAGS): Append $(ASFLAGS-config).
+	* configure.in (libc_cv_as_noexecstack): New check.
+	(ASFLAGS_config): Substitute.
+
+2003-06-04  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/i386/fpu/bits/mathinline.h (log1p, asinh, acosh, atanh,
+	hypot, logb): Protect with #ifdef __FAST_MATH__.
+
+2003-06-04  Thorsten Kukuk  <kukuk@suse.de>
+
+	* sysdeps/i386/fpu/bits/mathinline.h (ldexpf, ldexpl): Protect with
+	#ifdef __FAST_MATH__.
+
+2003-06-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/glob.c [HAVE_D_TYPE] (glob_in_dir): Also allow
+	DT_LNK entries if GLOB_ONLYDIR is set [PR libc/5043].
+	* posix/globtest.sh: Adjust for this change.
+
+	* sysdeps/unix/sysv/linux/ifaddrs.c (netlink_open): Call getsockname
+	to get the actual PID value used in the records passed up.
+	(getifaddrs): Don't initialize nh.pid here.
+
+2003-06-02  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ifaddrs.c (netlink_receive): Minor
+	optimization.
+
+	* po/zh_CN.po: Update from translation team.
+
+	* posix/getconf.c (main): Also recognize names without the
+	_POSIX_ prefix.
+
+	* elf/Makefile (CFLAGS-dl-lookup.c): Define.
+
+2003-06-02  Bernd Schmidt  <bernds@redhat.com>
+
+	* sysdeps/i386/fpu/bits/mathinline.h (sqrt, __sqrtl, ldexp,
+	ldexpf, ldexpl): Only define if __FAST_MATH__.
+
+2003-06-02  Richard C. Bilson  <rcbilson@plg.uwaterloo.ca>
+
+	Replace hard-coded offsets into struct sigcontext with generated file.
+	* sysdeps/unix/sysv/linux/ia64/sigcontext-offsets.sym: New file.
+	* sysdeps/unix/sysv/linux/ia64/Makefile
+	[$(subdir) = stdlib] (gen-as-const-headers): Add it.
+	* sysdeps/unix/sysv/linux/ia64/ucontext_i.h: Include it instead of
+	defining SC_* macros here.
+
+2003-06-02  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/bits/sched.h (CLONE_PID): Remove.
+
+2003-06-01  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/i386/dl-machine.h: Include <sysdep.h>.
+
+2003-06-01  Ulrich Drepper  <drepper@redhat.com>
+
+	* test-skeleton.c (main): Request getopt to not reorder the
+	command line.
+
+	* elf/Makefile (CFLAGS-dl-runtime.c): Define.
+
+	* wcsmbs/wcpncpy.c (__wcpncpy): Fix broken implementation to match
+	stpncpy.
+
+2003-05-31  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/bits/sigaction.h (SA_NOCLDWAIT): Define.
+
+2003-05-31  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_plt_conflict):
+	New function.
+	(elf_machine_rela) <case R_PPC64_JMP_SLOT>: Avoid
+	RESOLVE_CONFLICT_FIND_MAP.  If RESOLVE_CONFLICT_FIND_MAP is defined,
+	call elf_machine_plt_conflict instead of elf_machine_fixup_plt.
+
+2003-05-31  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/i386/dl-machine.h (ELF_MACHINE_RUNTIME_TRAMPOLINE): Add
+	CFI directives.
+
+	* csu/Makefile: Fix Makefile warnings regarding Scrt1.o.
+
+	* libio/fileops.c (_IO_file_open): Don't mark as inline.
+
+	* sysdeps/ia64/elf/initfini.c (gmon_initializer): Mark with
+	attribute used.
+
+2003-05-30  Ulrich Drepper  <drepper@redhat.com>
+
+	* scripts/config.guess: Update from master copy.
+	* scripts/config.sub: Likewise.
+
+2003-05-30  Guido Guenther  <agx@sigxcpu.org>
+
+	* sysdeps/mips/mips64/bsd-_setjmp.S: Include <sys/asm.h> for
+	SETUP_GP64 and friends.
+	* sysdeps/unix/sysv/linux/mips/mips64/n32/sysdep.h: Fix register
+	names in internal_syscall{6,7}.
+	* sysdeps/unix/sysv/linux/mips/mips64/n64/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/mips/pread.c [_MIPS_SIM == _ABI64]: Fix
+	number of syscall arguments.
+	* sysdeps/unix/sysv/linux/mips/pwrite.c: Likewise.
+	* sysdeps/unix/sysv/linux/mips/pread64.c: Likewise.
+	* sysdeps/unix/sysv/linux/mips/pwrite64.c: Likewise.
+
+2003-05-30  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/x86_64/dl-machine.h (ELF_MACHINE_RUNTIME_TRAMPOLINE):
+	Add CFI directives.
+
+	* sysdeps/unix/sysv/linux/x86_64/sigaction.c (RESTORE2): Add CFI
+	directives.
+
+	* sysdeps/generic/sysdep.h: Add CFI_* macros for C files.
+
+	* sysdeps/unix/sysv/linux/x86_64/sysdep.h (SYSCALL_ERROR_HANDLER):
+	Add CFI directives.
+
+2003-05-30  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/powerpc/powerpc32/elf/start.S: Make code compilable with
+	SHARED.
+
+2003-05-11  Andreas Schwab  <schwab@suse.de>
+
+	* Makerules: Always use -MP together with -MD.
+	(sed-remove-dotot): Substitute $(..) also at start of line.
+	($(stdio_lim:h=st)): Use -MD instead of SUNPRO_DEPENDENCIES.
+	Generated defines with a single compiler call.
+	Use $(sed-remove-dotdot).
+	* mach/Makefile ($(objpfx)mach-syscalls.mk): Use -MD instead
+	of DEPENDENCIES_OUTPUT, and use $(sed-remove-objpfx).
+	* sysdeps/unix/sysv/linux/Makefile ($(objpfx)syscall-%.h):
+	Use -MD instead of SUNPRO_DEPENDENCIES, and use $(sed-remove-objpfx).
+	* sysdeps/unix/sysv/linux/mips/Makefile
+	($(objpfx)syscall-%.h): Likewise.
+
+2003-05-28  Roland McGrath  <roland@redhat.com>
+
+	* malloc/malloc.h [! __GNUC__] (__const): Define if undefined.
+
+2003-05-26  Aldy Hernandez  <aldyh@redhat.com>
+
+	* soft-fp/soft-fp.h (FP_EX_UNDERFLOW): Define to 0.
+
+2003-05-28  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/setcontext.S: Pass fourth argument to
+	rt_sigprocmask system call.
+	* sysdeps/unix/sysv/linux/ia64/ucontext_i.h (SC_MASK): Fix value.
+	From Peter A. Buhr <pabuhr@plg2.math.uwaterloo.ca>.
+
+2003-05-28  Ulrich Drepper  <drepper@redhat.com>
+
+	* include/libc-symbols.h: Define hidden attribute for real also if
+	LIBC_NONSHARED is defined.  Patch by Jakub Jelinek.
+
+	* csu/Makefile: Add rules to build Scrt1.o.
+	* sysdeps/i386/elf/start.S: Make code compilable with SHARED.
+	* sysdeps/x86_64/elf/start.S: Likewise.
+
+2003-05-27  Jakub Jelinek  <jakub@redhat.com>
+
+	* stdio-common/vfprintf.c (process_arg, process_string_arg): Use
+	pa_int/pa_u_int instead of pa_short_int, pa_u_short_int and pa_char.
+	* stdio-common/printf-parse.h (union printf_arg): Remove pa_char,
+	pa_short_int, pa_u_short_int and pa_float.
+
+2003-05-26  Jakub Jelinek  <jakub@redhat.com>
+
+	* libio/strops.c (_IO_str_init_static): Change into a wrapper around
+	_IO_str_init_static_internal.
+	(_IO_str_init_static_internal): Moved from _IO_str_init_static,
+	change size argument to _IO_size_t, don't limit sprintf to 64M.
+	(_IO_str_init_readonly): Call _IO_str_init_static_internal.
+	* libio/wstrops.c (_IO_wstr_init_static): Change size argument to
+	_IO_size_t, don't limit swprintf to 256M.
+	(_IO_wstr_init_readonly): Remove.
+	* libio/libioP.h (_IO_str_init_static_internal, _IO_wstr_init_static):
+	Adjust prototypes.
+	(_IO_wstr_init_readonly): Remove prototype.
+	* libio/iovsprintf.c (_IO_vsprintf): Use
+	_IO_str_init_static_internal instead of INTUSE(_IO_str_init_static).
+	* libio/iovsscanf.c (_IO_vsscanf): Likewise.
+	* libio/memstream.c (open_memstream): Likewise.
+	* libio/obprintf.c (_IO_obstack_vfprintf): Likewise.
+	* libio/vasprintf.c (_IO_vasprintf): Likewise.
+	* libio/vsnprintf.c (_IO_vsnprintf): Likewise.
+	* stdio-common/tst-sprintf.c (main): Add new test.
+
+2003-05-26  Ulrich Drepper  <drepper@redhat.com>
+
+	* stdio-common/vfprintf.c (vfprintf): Be bug-compatible with some
+	other implementation in respect of multiple uses of parameter with
+	different types.
+
+2003-05-25  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/kernel-features.h: Define
+	__ASSUME_FUTEX_REQUEUE for >= 2.5.70.
+
+2003-05-22  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/x86_64/gettimeofday.S: Add CFI
+	directives.
+	* sysdeps/unix/sysv/linux/x86_64/time.S: Likewise.
+	* sysdeps/x86_64/strtok.S: Likewise.
+
+2003-05-20  Guido Guenther  <agx@sigxcpu.org>
+
+	* sysdeps/unix/sysv/linux/mips/bits/siginfo.h: Change SI_ASYNCNL
+	to -60 and define SI_TKILL.
+
+2003-05-21  H.J. Lu  <hongjiu.lu@intel.com>
+
+	* math/test-fenv.c (feexcp_nomask_test): Fix comment.
+	(feexcp_mask_test): Likewise.
+
+2003-05-21  Ulrich Drepper  <drepper@redhat.com>
+
+	* locale/programs/locale.c (main): Fix typo in last patch.
+
+	* csu/elf-init.c: Mark __preinit_array_start, __preinit_array_end,
+	__init_array_start, __init_array_end, __fini_array_start, and
+	__fini_array_end as hidden.
+
+2003-05-21  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locale/programs/locale.c (main): Report an error if setlocale()
+	fails [PR libc/2254].
+
+2003-05-21  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/s390/system.c: New file.
+
+2003-05-21  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h (LOADARGS_0,
+	LOADARGS_1, LOADARGS_2, LOADARGS_3, LOADARGS_4, LOADARGS_5,
+	LOADARGS_6): Don't error if syscall argument is a string literal.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h (LOADARGS_0,
+	LOADARGS_1, LOADARGS_2, LOADARGS_3, LOADARGS_4, LOADARGS_5,
+	LOADARGS_6): Likewise.
+
+2003-05-21  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/generic/sysdep.h (cfi_offset, cfi_startproc,
+	cfi_endproc, cfi_def_cfa, cfi_def_ccfa_register,
+	cfi_def_cfa_offset, cfi_adjust_cfa_offset, cfi_offset): Define.
+
+	* sysdeps/x86_64/sysdep.h (CALL_MCOUNT): Add cfi directives.
+	(ENTRY): Likewise.
+	(END): Likewise.
+
+	* configure.in: Test for asm cfi directives.
+
+	* config.h.in: Add HAVE_ASM_CFI_DIRECTIVES.
+
+2003-05-17  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/x86_64/syscall.S: Revert last patch.
+
+	* rt/tst-clock_nanosleep.c: Include <time.h> for clock_nanosleep.
+
+2003-05-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* rt/Makefile (tests): Add tst-clock_nanosleep.
+	* rt/tst-clock_nanosleep.c: New file.
+	* posix/Makefile (tests): Add tst-nanosleep.
+	* posix/tst-nanosleep.c: New file.
+
+	* sysdeps/unix/clock_nanosleep.c (CPUCLOCK_P): Fix definition.
+
+	* include/features.h (__USE_XOPEN2K): Define also for
+	_POSIX_C_SOURCE>=200112L.
+
+	* sysdeps/unix/sysv/linux/sigwaitinfo.c (do_sigwaitinfo): Fold
+	SI_TKILL code into SI_USER.
+	* sysdeps/unix/sysv/linux/sigtimedwait.c (do_sigtimedwait): Likewise.
+
+	* sysdeps/posix/sigpause.c (do_sigpause): Use sigdelset after all.
+
+2003-05-15  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/powerpc/powerpc32/dl-machine.c (_dl_reloc_overflow):
+	Remove sym argument, always use refsym.
+	(__process_machine_rela): Adjust callers.
+	* sysdeps/powerpc/powerpc64/dl-machine.c (_dl_reloc_overflow):
+	Likewise.
+	* sysdeps/powerpc/powerpc32/dl-machine.h (_dl_reloc_overflow):
+	Adjust prototype.
+	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_rela): Likewise.
+
+2003-05-15  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/dl-sysdep.c (_dl_show_auxv): Fix typo
+	(DL_NEED_SYSINFO -> NEED_DL_SYSINFO).  If aux value is not known
+	print numeric values.
+
+2003-05-12  Thorsten Kukuk  <kukuk@suse.de>
+
+	* inet/netinet/igmp.h: Sync with Linux Kernel 2.5.69 and *BSD.
+
+2003-05-14  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/unix/sysv/linux/ia64/umount.c: New file.
+
+2003-05-14  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/rtld.c (dl_main): For LD_TRACE_PRELINKING print search scope
+	even if no DT_NEEDED is present.
+
+2003-05-13  David Mosberger  <davidm@hpl.hp.com>
+
+	* sysdeps/unix/sysv/linux/ia64/setjmp.S: Fix the fix from
+	2003-03-27: setjmp is NOT a leaf-routine (due to the call to
+	__sigjmp_save) so we can't keep the saved unat value in a scratch
+	register (r16).  Use loc2 instead.
+
+2003-05-13  Ulrich Drepper  <drepper@redhat.com>
+
+	* csu/Makefile: Do compile elf-init with PIC flag since in dynamic
+	binaries it has to be relocatable.
+
+	* sysdeps/unix/sysv/linux/waitpid.c: Use waitpid syscall is available.
+
+2003-05-12  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/bits/atomic.h
+	(__arch_compare_and_exchange_bool_8_rel): Define.
+	(__arch_compare_and_exchange_bool_16_rel): Define.
+	(__ARCH_REL_INSTR): Define if not already defined.
+	(__arch_atomic_exchange_and_add_32): Add "memory" to clobber list.
+	(__arch_atomic_decrement_if_positive_32):
+	Add "memory" to clobber list.
+	(__arch_compare_and_exchange_val_32_acq): Remove release sync.
+	(__arch_compare_and_exchange_val_32_rel): Define.
+	(__arch_atomic_exchange_32): Remove.
+	(__arch_atomic_exchange_32_acq): Define.
+	(__arch_atomic_exchange_32_rel): Define.
+	(atomic_compare_and_exchange_val_rel): Define.
+	(atomic_exchange_acq): Use __arch_atomic_exchange_*_acq forms.
+	(atomic_exchange_rel): Define.
+	* sysdeps/powerpc/powerpc32/bits/atomic.h
+	(__arch_compare_and_exchange_bool_32_acq): Remove release sync.
+	(__arch_compare_and_exchange_bool_32_rel): Define.
+	(__arch_compare_and_exchange_bool_64_rel): Define.
+	(__arch_compare_and_exchange_val_64_rel): Define.
+	(__arch_atomic_exchange_64): Remove.
+	(__arch_atomic_exchange_64_acq): Define.
+	(__arch_atomic_exchange_64_rel): Define.
+	* sysdeps/powerpc/powerpc64/bits/atomic.h
+	(__arch_compare_and_exchange_bool_32_rel): Define.
+	(__arch_compare_and_exchange_bool_64_acq): Remove release sync.
+	(__arch_compare_and_exchange_bool_64_rel): Define.
+	(__arch_compare_and_exchange_val_64_acq): Remove release sync.
+	(__arch_compare_and_exchange_val_64_rel): Define.
+	(__arch_atomic_exchange_64): Remove.
+	(__arch_atomic_exchange_64_acq): Define.
+	(__arch_atomic_exchange_64_rel): Define.
+	(__arch_atomic_exchange_and_add_64): Add "memory" to clobber list.
+	(__arch_atomic_decrement_if_positive_64):
+	Add "memory" to clobber list.
+	[!UP](__ARCH_REL_INSTR): Define as lwsync.
+
+2003-05-11  Andreas Schwab  <schwab@suse.de>
+
+	* io/Makefile ($(objpfx)ftwtest.out): Use absolute file names.
+
+2003-05-11  Ulrich Drepper  <drepper@redhat.com>
+
+	* time/tst-strftime.c (do_test): Add tests for - flag.
+
+2003-05-11  Jim Meyering  <jim@meyering.net>
+
+	* time/strftime.c (my_strftime): Let the `-' (no-pad) flag affect
+	the space-padded-by-default conversion specifiers, %e, %k, %l.
+
+2003-05-11  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/generic/sched_setaffinity.c: Fix parameter name.
+
+2003-05-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/bits/sched.h: Define cpu_set_t only if not
+	already defined and when really needed.
+	* sysdeps/unix/sysv/linux/bits/sched.h: Likewise.
+
+2003-05-09  Thorsten Kukuk  <kukuk@suse.de>
+
+	* sysdeps/unix/sysv/linux/netinet/igmp.h: Don't include kernel
+	headers, add defines from kernel header, move it from here...
+	* inet/netinet/igmp.h: ... to here.
+	* inet/Makefile (headers): Add netinet/igmp.h.
+	* sysdeps/unix/sysv/linux/Makefile: Remove netinet/igmp.h.
+	* sysdeps/unix/sysv/linux/Dist: Remove netinet/igmp.h.
+
+2003-05-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/pthread/lio_listio64.c (lio_listio64): If SIG == NULL,
+	use dummy sigevent structure with SIGEV_NONE [PR libc/5015].
+
+2003-05-09  Thorsten Kukuk <kukuk@suse.de>
+
+	* libio/bits/stdio.h: Sync prototypes with libio/stdio.h
+	(remove __THROW from possible cancellation points).
+
+2003-05-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* posix/sched.h (CPU_SETSIZE): Define.
+
+2003-05-09  Ulrich Drepper  <drepper@redhat.com>
+
+	* Makeconfig (gnulib): Remove -lgcc_eh again.
+
+	* posix/sched.h: Change prototypes of sched_getaffinity and
+	sched_setaffinity.  Define CPU_SET, CPU_CLR, CPU_ISSET, and CPU_ZERO.
+	* sysdeps/generic/sched_getaffinity.c: Adjust definition.
+	* sysdeps/generic/sched_setaffinity.c: Likewise.
+	* sysdeps/generic/bits/sched.h: Define __CPU_SETSIZE, __NCPUBITS,
+	__CPUELT, __CPUMASK, cpu_set_t, __cpu_mask, __CPU_ZERO, __CPU_SET,
+	__CPU_CLR, and __CPU_ISSET.
+	* sysdeps/unix/sysv/linux/bits/sched.h: Likewise.
+	* sysdeps/unix/sysv/linux/sched_getaffinity.c: New file.
+	* sysdeps/unix/sysv/linux/sched_setaffinity.c: New file.
+
+	* include/atomic.h (atomic_exchange_acq): Renamed from atomic_exchange.
+	(atomic_exchange_rel): New #define.
+	* sysdeps/ia64/bits/atomic.h: Likewise.
+	* sysdeps/i386/i486/bits/atomic.h (atomic_exchange_acq): Renamed from
+	atomic_exchange.
+	* sysdeps/m68k/m68020/bits/atomic.h: Likewise.
+	* sysdeps/powerpc/bits/atomic.h: Likewise.
+	* sysdeps/sparc/sparc32/sparcv9/bits/atomic.h: Likewise.
+	* sysdeps/sparc/sparc64/bits/atomic.h: Likewise.
+	* sysdeps/x86_64/bits/atomic.h: Likewise.
+	* csu/tst-atomic.c: Use atomic_exchange_acq instead of atomic_exchange.
+
+	* sysdeps/unix/sysv/linux/x86_64/get_clockfreq.c: New file.
+
+2003-05-08  Ulrich Drepper  <drepper@redhat.com>
+
+	* malloc/thread-m.h: Remove special handling of thread_atfork if
+	HAVE_register_atfork_malloc is defined.
+
+2003-05-07  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/x86_64/syscall.S: Add DWARF2 unwind
+	information.
+
+2003-05-06  Ulrich Drepper  <drepper@redhat.com>
+
+	* libio/oldiofdopen.c (_IO_old_fdopen): Use _IO_old_init not _IO_init.
+	* libio/oldiofopen.c (_IO_old_fopen): Likewise.
+	* libio/libioP.h: Declare _IO_old_init.
+	* libio/genops.c (_IO_no_init): Split in two.  New function
+	_IO_old_init.
+
+2003-05-05  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/enbl-secure.c (__libc_enable_secure_decided): New
+	variable.
+	(__libc_init_secure): Don't do anything if __libc_enable_secure_decided
+	is nonzero.
+	* include/unistd.h: Declare __libc_enable_secure_decided.
+	* elf/dl-support.c (_dl_aux_init): Recognize AT_UID, AT_EUID, AT_GID,
+	and AT_EGID.  If all found, set __libc_enable_secure and
+	__libc_enable_secure_decided.
+
+	* sysdeps/generic/libc-start.c [!SHARED]: Call
+	__libc_check_standard_fds after __libc_init_first.
+
+2003-05-05  Roland McGrath  <roland@redhat.com>
+
+	* Makerules (common-before-compile): New variable.
+	($(common-objpfx)%.make): Depend on that instead of $(before-compile).
+	($(common-objpfx)%.h $(common-objpfx)%.h.d): Likewise.  Move this rule
+	to after all setting of before-compile.
+
+2003-05-05  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/ia64/bits/atomic.h (__arch_compare_and_exchange_val_8_acq,
+	__arch_compare_and_exchange_val_16_acq): Cast 0 to mem's type.
+	* sysdeps/powerpc/powerpc32/bits/atomic.h
+	(__arch_compare_and_exchange_val_64_acq): Likewise.
+	* sysdeps/sparc/sparc32/sparcv9/bits/atomic.h
+	(__arch_compare_and_exchange_val_8_acq,
+	__arch_compare_and_exchange_val_16_acq,
+	__arch_compare_and_exchange_val_64_acq): Likewise.
+	* sysdeps/sparc/sparc64/bits/atomic.h
+	(__arch_compare_and_exchange_val_8_acq,
+	__arch_compare_and_exchange_val_16_acq): Likewise.
+	* sysdeps/s390/bits/atomic.h (__arch_compare_and_exchange_val_8_acq,
+	__arch_compare_and_exchange_val_16_acq,
+	__arch_compare_and_exchange_val_64_acq): Likewise.
+	* sysdeps/unix/sysv/linux/sh/bits/atomic.h
+	(__arch_compare_and_exchange_val_64_acq): Likewise.
+	* sysdeps/s390/s390-64/backtrace.c (__backtrace): Add cast to shut
+	up warning.
+	* sysdeps/s390/fpu/fegetenv.c (fegetenv): Likewise.
+
+	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h
+	(INLINE_SYSCALL, INTERNAL_SYSCALL_DIRECT, INTERNAL_SYSCALL_SVC0):
+	Return long instead of int.
+	(INTERNAL_SYSCALL_ERROR_P): Cast val to unsigned long, replace
+	0xfffff001u with -4095UL.
+
+2003-05-05  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/x86_64/fpu_control.h: New from i386.
+
+	* sysdeps/unix/sysv/linux/x86_64/sysdep.h (__NR_semtimedop):
+	Define if not defined.
+
+	* sunrpc/Makefile (generated-dirs): New variable.
+	* resolv/Makefile (generated): New variable.
+
+2003-05-04  Roland McGrath  <roland@redhat.com>
+
+	* csu/Makefile ($(csu-dummies) target rule): Don't use a temp C file.
+	Depend on $(before-compile).
+
+	* csu/Makefile ($(objpfx)crt%.o): Replace implicit rule with a static
+	pattern rule.  The implicit rule could be ruled out when $(objpfx)
+	didn't exist at the time of its consideration (ugh!).
+
+	* Makerules (+make-deps): Fix target matching.
+	Use $(sed-remove-dotdot).
+
+2003-05-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* nscd/nscd.c (main): Parse config file right after parsing
+	parameters.  Then, if get_stats is true, call receive_print_stats.
+	Drop parameter from nscd_init call.
+	(get_stats): New variable.
+	(parse_opt): Set get_stats, don't call receive_print_stats here.
+	* nscd/nscd.h: Declare dbs, stat_user, and stat_uid.  Adjust nscd_init
+	prototype.
+	* nscd/connections.c (stat_user, stat_uid): New variables.
+	(dbs): Make global.
+	(nscd_init): Don't read configuration file here.  Drop parameter.
+	(handle_request): Cleanup handling of non-database lookup requests.
+	* nscd/nscd_conf.c (nscd_parse_file): Recognize stat-user entry.
+	Get UID of the specified user.  Use xstrdup instead of strdup.
+	* nscd/nscd_stat.c (receive_print_stats): Check UID.  If not zero,
+	check stat_user.
+	* nscd/Makefile (nscd-modules): Add xstrdup.
+	* nscd/nscd.conf: Document stat-user entry.
+
+2003-05-03  H.J. Lu  <hongjiu.lu@intel.com>
+
+	* sysdeps/unix/sysv/linux/ia64/sysdep.h (__NR_semtimedop): Define
+	if not defined.
+
+2003-04-22  Roland McGrath  <roland@redhat.com>
+
+	* elf/elf.h (AT_SYSINFO_EHDR): New macro, replaces AT_SYSINFO_EH_FRAME.
+	* sysdeps/generic/ldsodefs.h (struct rtld_global): Remove
+	dl_sysinfo_eh_frame member, add dl_sysinfo_dso member instead.
+	* elf/dl-support.c: Update defn.
+	* sysdeps/generic/libc-start.c: Don't call __register_frame_info_bases.
+	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start) [NEED_DL_SYSINFO]:
+	Set GL(dl_sysinfo_dso) from AT_SYSINFO_EHDR.
+	(_dl_show_auxv): Grok AT_SYSINFO_EHDR, not AT_SYSINFO_EH_FRAME.
+	* elf/rtld.c (dl_main) [NEED_DL_SYSINFO]: If GL(dl_sysinfo_dso) is
+	set, set up a link_map for the preloaded, prelinked object.
+
+2003-05-03  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/gnu/Makefile (generated): Append errlist-compat.c here, ...
+	* stdio-common/Makefile: ... not here.
+
+	* csu/Makefile ($(objpfx)initfini.s): Depend on $(before-compile).
+	* sysdeps/gnu/Makefile ($(objpfx)errlist-compat.c): Likewise.
+
+2003-05-02  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/s390/semtimedop.c: New file.
+
+	* sysdeps/unix/sysv/linux/alpha/ipc_priv.h (IPCOP_semtimedop): Define.
+
+	* sysdeps/generic/dl-fptr.c (_dl_make_fptr): Use 0 not NULL for
+	comparing ftab elements.
+	(_dl_unmap): Fix typo in test.
+	(_dl_make_fptr): Fix typos introduced in last change.
+
+	* sysdeps/generic/dl-fptr.c: Put back one optimization from the
+	original patch.  Use non-exported symbols.  Mark translatable
+	strings.  Pretty printing.
+
+2003-05-02  Roland McGrath  <roland@redhat.com>
+
+	* Makerules (do-stamp): Do $(make-target-directory).
+
+2003-04-07  H.J. Lu  <hjl@gnu.org>
+
+	* sysdeps/generic/dl-fptr.c: Modify to remove the lock.
+
+2003-04-03  H.J. Lu  <hjl@gnu.org>
+
+	* sysdeps/ia64/dl-fptr.c: Moved to ...
+	* sysdeps/generic/dl-fptr.c: Here.
+
+	* sysdeps/generic/dl-fptr.h: New.
+	* sysdeps/ia64/dl-fptr.h: New.
+
+	* sysdeps/ia64/dl-symaddr.c: Moved to ...
+	* sysdeps/generic/dl-symaddr.c: here.
+
+	* sysdeps/ia64/dl-machine.h: Include <dl-fptr.h>.
+	(IA64_BOOT_FPTR_TABLE_LEN): Removed.
+	(ia64_fdesc): Likewise.
+	(ia64_fdesc_table): Likewise.
+	(__ia64_make_fptr): Likewise.
+	(__ia64_init_bootstrap_fdesc_table): Replace __ia64_boot_fptr_table
+	with _dl_boot_fptr_table.
+	(elf_machine_runtime_setup): Replace `struct ia64_fdesc' with
+	`struct fdesc'.
+	(elf_machine_rela): Replace __ia64_make_fptr with _dl_make_fptr.
+
+2003-05-01  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/generic/bp-thunks.h: Protect includes with [!__ASSEMBLER__].
+	* sysdeps/unix/sysv/linux/i386/bp-thunks.h: Likewise.
+
+	* sysdeps/unix/sysv/linux/Makefile ($(objpfx)syscall-%.h):
+	Use $(make-target-directory).
+	* sysdeps/unix/Makefile ($(objpfx)stub-syscalls.c): Likewise.
+
+	* Makerules (compile-mkdep-flags): New variable, pass -MD -MF $@.d.
+	(compile-command.S): Don't use ifndef.  Append $(compile-mkdep-flags).
+	(compile-command.s, compile-command.c): Likewise.
+	($(objpfx)%.d): All such pattern rules removed.
+	($(+sysdir_pfx)sysd-rules): Don't generate them.
+	($(common-objpfx)dummy.d): Target removed.
+	(make-dummy-dep): Variable removed.
+	(generate-md5): Likewise.
+	(%.d: %.dt): New pattern rule.
+	(+depfiles): Use $(wildcard) function to get just existing *.d files
+	and .d files for existing *.dt files.
+	(common-clean): Remove all *.d and *.dt files.
+	(before-compile): Add $(objpfx). when it doesn't exist,
+	regardless of $(no_deps).
+	* elf/rtld-Rules ($(objpfx)rtld-%.d): All such pattern rules removed.
+	(rtld-depfiles): Use .os.d instead of .d names.
+	Include existing *.d files and .d files for existing *.dt files.
+
+	* Makerules ($(common-objpfx)%.make): Protect with [! subdir].
+	Use -MD, -MT and -MF flags instead of SUNPRO_DEPENDENCIES variable.
+
+	* sysdeps/unix/Makefile ($(common-objpfx)s-%.d): Remove compat.h hack.
+	Do s-*.d includes only if we have some syscall routines in this subdir.
+
+	* include/libc-symbols.h (libc_freeres_ptr): Use %nobits instead of
+	@nobits.  The former is accepted by gas on any ELF platform.
+
+2003-05-01  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/semtimedop.c: New file.
+
+	* malloc/malloc.c (mSTATs): Call ptmalloc_init if necessary.
+
+2003-04-29  Andreas Schwab  <schwab@suse.de>
+
+	* string/test-strcat.c (do_one_test): Fix attribute name.
+
+2003-04-30  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/unix/sysv/linux/mips/sys/ucontext.h (ucontext): Make
+	uc_flags long for all ABIs.
+
+2003-04-30  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/x86_64/sys/debugreg.h
+	(DR_CONTROL_RESERVED): Use correct value for 64-bit.
+	Reported by Andrew Derrick Balsa <andrebalsa@mailingaddress.org>.
+	Add bi-arch support.
+
+2003-04-30  Ulrich Drepper  <drepper@redhat.com>
+
+	* malloc/malloc.c (mEMALIGn): Define alias __memalign_internal.
+	(__posix_memalign): Use __memalign_internal instead of memalign.
+
+2003-04-29  Roland McGrath  <roland@redhat.com>
+
+	* configure.in: Search for AUTOCONF unconditionally.
+	Just don't complain about missing it under --without-cvs.
+
+	* include/libc-symbols.h (__symbol_set_attribute): New macro,
+	give hidden for [SHARED] and weak for [! SHARED].
+	(symbol_set_declare): Use that.  Never need weak_extern these days.
+	* Makerules ($(common-objpfx)shlib.lds): Go back to using PROVIDE.
+	Depend on $(..)Makerules.
+
+2003-04-29  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ifaddrs.c (getifaddrs): Use __ protected
+	variants of socket, bind, recvmsg, and sendto.
+
+	* sysdeps/i386/fpu/ftestexcept.c: Also check SSE status word.
+
+	* include/signal.h: Use libc_hidden_proto for sigaddset and sigdelset.
+	* signal/sigaddset.c: Add libc_hidden_def.
+	* signal/sigdelset.c: Likewise.
+
+2003-04-29  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/i386/i486/string-inlines.c (__memcpy_g, __strchr_g): Move
+	to the end of the file.
+
+	* configure.in: Change __oline__ to $LINENO.
+	(HAVE_BUILTIN_REDIRECTION): New check.
+	* config.h.in (HAVE_BUILTIN_REDIRECTION): Add.
+	* include/libc-symbols.h (libc_hidden_builtin_proto,
+	libc_hidden_builtin_def, libc_hidden_builtin_weak,
+	libc_hidden_builtin_ver): Define.
+	* include/string.h (memchr, memcpy, memmove, memset, strcat, strchr,
+	strcmp, strcpy, strcspn, strlen, strncmp, strncpy, strpbrk, strrchr,
+	strspn, strstr): Add libc_hidden_builtin_proto.
+	* intl/plural.y: Include string.h.
+	* sysdeps/alpha/alphaev6/memchr.S (memchr): Add
+	libc_hidden_builtin_def.
+	* sysdeps/alpha/alphaev6/memcpy.S (memcpy): Likewise.
+	* sysdeps/alpha/alphaev6/memset.S (memset): Likewise.
+	* sysdeps/alpha/alphaev67/strcat.S (strcat): Likewise.
+	* sysdeps/alpha/alphaev67/strchr.S (strchr): Likewise.
+	* sysdeps/alpha/alphaev67/strlen.S (strlen): Likewise.
+	* sysdeps/alpha/alphaev67/strrchr.S (strrchr): Likewise.
+	* sysdeps/alpha/memchr.S (memchr): Likewise.
+	* sysdeps/alpha/memset.S (memset): Likewise.
+	* sysdeps/alpha/strcat.S (strcat): Likewise.
+	* sysdeps/alpha/strchr.S (strchr): Likewise.
+	* sysdeps/alpha/strcmp.S (strcmp): Likewise.
+	* sysdeps/alpha/strcpy.S (strcpy): Likewise.
+	* sysdeps/alpha/strlen.S (strlen): Likewise.
+	* sysdeps/alpha/strncmp.S (strncmp): Likewise.
+	* sysdeps/alpha/strncpy.S (strncpy): Likewise.
+	* sysdeps/alpha/strrchr.S (strrchr): Likewise.
+	* sysdeps/arm/memset.S (memset): Likewise.
+	* sysdeps/arm/strlen.S (strlen): Likewise.
+	* sysdeps/generic/memchr.c (memchr): Likewise.
+	* sysdeps/generic/memcpy.c (memcpy): Likewise.
+	* sysdeps/generic/memmove.c (memmove): Likewise.
+	* sysdeps/generic/memset.c (memset): Likewise.
+	* sysdeps/generic/strcat.c (strcat): Likewise.
+	* sysdeps/generic/strchr.c (strchr): Likewise.
+	* sysdeps/generic/strcmp.c (strcmp): Likewise.
+	* sysdeps/generic/strcpy.c (strcpy): Likewise.
+	* sysdeps/generic/strcspn.c (strcspn): Likewise.
+	* sysdeps/generic/strlen.c (strlen): Likewise.
+	* sysdeps/generic/strncmp.c (strncmp): Likewise.
+	* sysdeps/generic/strncpy.c (strncpy): Likewise.
+	* sysdeps/generic/strpbrk.c (strpbrk): Likewise.
+	* sysdeps/generic/strrchr.c (strrchr): Likewise.
+	* sysdeps/generic/strspn.c (strspn): Likewise.
+	* sysdeps/generic/strstr.c (strstr): Likewise.
+	* sysdeps/i386/i486/strcat.S (strcat): Likewise.
+	* sysdeps/i386/i486/strlen.S (strlen): Likewise.
+	* sysdeps/i386/i586/memcpy.S (memcpy): Likewise.
+	* sysdeps/i386/i586/memset.S (memset): Likewise.
+	* sysdeps/i386/i586/strchr.S (strchr): Likewise.
+	* sysdeps/i386/i586/strcpy.S (strcpy): Likewise.
+	* sysdeps/i386/i586/strlen.S (strlen): Likewise.
+	* sysdeps/i386/i686/memcpy.S (memcpy): Likewise.
+	* sysdeps/i386/i686/memmove.S (memmove): Likewise.
+	* sysdeps/i386/i686/memset.S (memset): Likewise.
+	* sysdeps/i386/i686/strcmp.S (strcmp): Likewise.
+	* sysdeps/i386/memchr.S (memchr): Likewise.
+	* sysdeps/i386/memset.c (memset): Likewise.
+	* sysdeps/i386/strchr.S (strchr): Likewise.
+	* sysdeps/i386/strcspn.S (strcspn): Likewise.
+	* sysdeps/i386/strlen.c (strlen): Likewise.
+	* sysdeps/i386/strpbrk.S (strpbrk): Likewise.
+	* sysdeps/i386/strrchr.S (strrchr): Likewise.
+	* sysdeps/i386/strspn.S (strspn): Likewise.
+	* sysdeps/ia64/memchr.S (memchr): Likewise.
+	* sysdeps/ia64/memcpy.S (memcpy): Likewise.
+	* sysdeps/ia64/memmove.S (memmove): Likewise.
+	* sysdeps/ia64/memset.S (memset): Likewise.
+	* sysdeps/ia64/strcat.S (strcat): Likewise.
+	* sysdeps/ia64/strchr.S (strchr): Likewise.
+	* sysdeps/ia64/strcmp.S (strcmp): Likewise.
+	* sysdeps/ia64/strcpy.S (strcpy): Likewise.
+	* sysdeps/ia64/strlen.S (strlen): Likewise.
+	* sysdeps/ia64/strncmp.S (strncmp): Likewise.
+	* sysdeps/ia64/strncpy.S (strncpy): Likewise.
+	* sysdeps/m68k/memchr.S (memchr): Likewise.
+	* sysdeps/m68k/strchr.S (strchr): Likewise.
+	* sysdeps/mips/mips64/memcpy.S (memcpy): Likewise.
+	* sysdeps/mips/mips64/memset.S (memset): Likewise.
+	* sysdeps/mips/memcpy.S (memcpy): Likewise.
+	* sysdeps/mips/memset.S (memset): Likewise.
+	* sysdeps/powerpc/powerpc32/memset.S (memset): Likewise.
+	* sysdeps/powerpc/powerpc32/strchr.S (strchr): Likewise.
+	* sysdeps/powerpc/powerpc32/strcmp.S (strcmp): Likewise.
+	* sysdeps/powerpc/powerpc32/strcpy.S (strcpy): Likewise.
+	* sysdeps/powerpc/powerpc32/strlen.S (strlen): Likewise.
+	* sysdeps/powerpc/powerpc64/memcpy.S (memcpy): Likewise.
+	* sysdeps/powerpc/powerpc64/memset.S (memset): Likewise.
+	* sysdeps/powerpc/powerpc64/strchr.S (strchr): Likewise.
+	* sysdeps/powerpc/powerpc64/strcmp.S (strcmp): Likewise.
+	* sysdeps/powerpc/powerpc64/strcpy.S (strcpy): Likewise.
+	* sysdeps/powerpc/powerpc64/strlen.S (strlen): Likewise.
+	* sysdeps/powerpc/strcat.c (strcat): Likewise.
+	* sysdeps/sparc/sparc32/memchr.S (memchr): Likewise.
+	* sysdeps/sparc/sparc32/memcpy.S (memcpy): Likewise.
+	* sysdeps/sparc/sparc32/memset.S (memset): Likewise.
+	* sysdeps/sparc/sparc32/strcat.S (strcat): Likewise.
+	* sysdeps/sparc/sparc32/strchr.S (strchr, strrchr): Likewise.
+	* sysdeps/sparc/sparc32/strcmp.S (strcmp): Likewise.
+	* sysdeps/sparc/sparc32/strcpy.S (strcpy): Likewise.
+	* sysdeps/sparc/sparc32/strlen.S (strlen): Likewise.
+	* sysdeps/sparc/sparc64/sparcv9b/memcpy.S (memcpy, memmove): Likewise.
+	* sysdeps/sparc/sparc64/memchr.S (memchr): Likewise.
+	* sysdeps/sparc/sparc64/memcpy.S (memcpy, memmove): Likewise.
+	* sysdeps/sparc/sparc64/memset.S (memset): Likewise.
+	* sysdeps/sparc/sparc64/strcat.S (strcat): Likewise.
+	* sysdeps/sparc/sparc64/strchr.S (strchr, strrchr): Likewise.
+	* sysdeps/sparc/sparc64/strcmp.S (strcmp): Likewise.
+	* sysdeps/sparc/sparc64/strcpy.S (strcpy): Likewise.
+	* sysdeps/sparc/sparc64/strcspn.S (strcspn): Likewise.
+	* sysdeps/sparc/sparc64/strlen.S (strlen): Likewise.
+	* sysdeps/sparc/sparc64/strncmp.S (strncmp): Likewise.
+	* sysdeps/sparc/sparc64/strncpy.S (strncpy): Likewise.
+	* sysdeps/sparc/sparc64/strpbrk.S (strpbrk): Likewise.
+	* sysdeps/sparc/sparc64/strspn.S (strspn): Likewise.
+	* sysdeps/sh/memcpy.S (memcpy): Likewise.
+	* sysdeps/sh/memset.S (memset): Likewise.
+	* sysdeps/sh/strlen.S (strlen): Likewise.
+	* sysdeps/s390/s390-32/memchr.S (memchr): Likewise.
+	* sysdeps/s390/s390-32/memcpy.S (memcpy): Likewise.
+	* sysdeps/s390/s390-32/memset.S (memset): Likewise.
+	* sysdeps/s390/s390-32/strcmp.S (strcmp): Likewise.
+	* sysdeps/s390/s390-32/strcpy.S (strcpy): Likewise.
+	* sysdeps/s390/s390-32/strncpy.S (strncpy): Likewise.
+	* sysdeps/s390/s390-64/memchr.S (memchr): Likewise.
+	* sysdeps/s390/s390-64/memcpy.S (memcpy): Likewise.
+	* sysdeps/s390/s390-64/memset.S (memset): Likewise.
+	* sysdeps/s390/s390-64/strcmp.S (strcmp): Likewise.
+	* sysdeps/s390/s390-64/strcpy.S (strcpy): Likewise.
+	* sysdeps/s390/s390-64/strncpy.S (strncpy): Likewise.
+	* sysdeps/x86_64/memcpy.S (memcpy): Likewise.
+	* sysdeps/x86_64/memset.S (memset): Likewise.
+	* sysdeps/x86_64/strcat.S (strcat): Likewise.
+	* sysdeps/x86_64/strchr.S (strchr): Likewise.
+	* sysdeps/x86_64/strcmp.S (strcmp): Likewise.
+	* sysdeps/x86_64/strcpy.S (strcpy): Likewise.
+	* sysdeps/x86_64/strcspn.S (strcspn): Likewise.
+	* sysdeps/x86_64/strlen.S (strlen): Likewise.
+	* sysdeps/x86_64/strspn.S (strspn): Likewise.
+	* string/string-inlines.c: Move...
+	* sysdeps/generic/string-inlines.c: ...here.
+	(__memcpy_g, __strchr_g): Remove.
+	(__NO_INLINE__): Define before including <string.h>,
+	undefine after.  Include bits/string.h and bits/string2.h.
+	* sysdeps/i386/i486/string-inlines.c: New file.
+	* sysdeps/i386/string-inlines.c: New file.
+	* sysdeps/i386/i486/Versions: Remove.
+	All GLIBC_2.1.1 symbols moved...
+	* sysdeps/i386/Versions (libc): ...here.
+
+2003-04-29  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/i386/fpu/Makefile: New file.
+	* sysdeps/i386/fpu/fedisblxcpt.c: Also set SSE control word.
+	* sysdeps/i386/fpu/feenablxcpt.c: Likewise.
+	* sysdeps/i386/fpu/feholdexcpt.c: Likewise.
+	* sysdeps/i386/fpu/fesetround.c: Also set SSE rounding mode
+	[PR libc/4987].
+
+2003-04-28  Ulrich Drepper  <drepper@redhat.com>
+
+	* nscd/nscd_getgr_r.c: Compact code a bit.  Add some __builtin_expect.
+	* nscd/nscd_getpw_r.c: Likewise.
+	* nscd/nscd_gethst_r.c: Likewise.
+
+2003-04-27  Ulrich Drepper  <drepper@redhat.com>
+
+	* nscd/pwdcache.c: Initialize .version element in result.
+	* nscd/grpcache.c: Likewise.
+	* nscd/pwdcache.c: Likewise.
+
+2003-04-27  Andreas Schwab  <schwab@suse.de>
+
+	* Makeconfig ($(common-objpfx)sysd-sorted): Fix for running in
+	subdirectory.
+
+2003-04-27  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/unix/sysv/linux/m68k/semtimedop.S: New file.
+
+2003-04-27  Ulrich Drepper  <drepper@redhat.com>
+
+	* nscd/connections.c (client_queued): New variable.
+	(nscd_run): Revamp the loop.  Don't call poll except for cleanup
+	threads.  Keep track of the number of delays caused because of busy
+	worker threads.
+	* nscd/nscd.h: Declare client_queued.
+	* nscd/nscd_stat.c: Transmit and print client_queued information.
+
+	* locale/programs/locale.c (show_info): Use '\177' instead of CHAR_MAX.
+
+	* Makerules ($(common-objpfx)shlib.lds): Don't use PROVIDE to
+	define __start_libc_freeres_ptrs and __stop___libc_freeres_ptrs.
+
+2003-04-26  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/dl-close.c [USE_TLS && TLS_TCB_AT_TP] (_dl_close): Reimplement
+	tracking of freed memory in static TLS block.
+	* elf/Makefile: Add rules to build and run tst-tls13.
+	* elf/tst-tls13.c: New file.
+	* elf/tst-tlsmod13.c: New file.
+	* elf/tst-tlsmod13a.c: New file.
+
+	* elf/tst-tls8.c: Adjust types of variables to avoid warnings.
+
+	* elf/dl-reloc.c: Pretty printing.
+
+2003-04-26  Roland McGrath  <roland@redhat.com>
+
+	* Makerules ($(common-objpfx)shlib.lds): New target.
+	(common-generated): Add it.
+	(build-shlib, build-module): Use that instead of generating every time.
+	($(common-objpfx)libc.so): Depend on it.
+	(lib%.so rule): Likewise.
+	(build-module-helper-objlist): Remove %.lds.
+	(LDSEDCMD-c.so): Variable removed.
+	* iconvdata/extra-module.mk ($(objpfx)$(mod).so):
+	Depend on $(common-objpfx)shlib.lds.
+	* dlfcn/Makefile ($(test-modules)): Likewise.
+
+2003-04-26  Roland McGrath  <roland@frob.com>
+
+	* sysdeps/mach/hurd/tmpfile.c: Remove USE_IN_LIBIO conditionals.
+
+2003-04-26  Andreas Schwab  <schwab@suse.de>
+
+	* elf/dl-close.c (remove_slotinfo): Fix missing parens.
+
+2003-04-25  Ulrich Drepper  <drepper@redhat.com>
+
+	* nscd/cache.c (cache_search): Keep track of how many chain links
+	we searched and update table statistics.
+	(cache_add): Keep track of how many values are in the table.
+	(prune_cache): Likewise.  Keep track of locking success.
+	Print messages about removed entries in separate pass.
+	* nscd/connections.c (handle_request): Don't print debug message here.
+	The caller will do it.  Keep track of locking success.
+	(nscd_run): Print debug message.  Also print PID of the client process.
+	* nscd/nscd.c (start_time): New variable.
+	(main): Remember start time.
+	* nscd/nscd.h: Declare start_time.
+	(struct database): Add more members for new statistics.
+	* nscd/nscd_stat.c: Add support for sending, receiving, and printing
+	of new statistics.
+
+	* sysdeps/posix/getaddrinfo.c: Include <stdbool.h>.
+
+2003-04-22  Jakub Jelinek  <jakub@redhat.com>
+
+	* include/link.h (NO_TLS_OFFSET): Define to 0 if not defined.
+	* elf/dl-close.c (_dl_close): Use NO_TLS_OFFSET.
+	* elf/dl-object.c (_dl_new_object): Initialize l_tls_offset to
+	NO_TLS_OFFSET.
+	* elf/rtld.c (_dl_start_final, _dl_start): Likewise.
+	* elf/dl-reloc.c (CHECK_STATIC_TLS): Use NO_TLS_OFFSET.
+	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_init): Likewise.
+	* sysdeps/powerpc/dl-tls.h (TLS_TPREL_VALUE): Don't subtract
+	TLS_TCB_SIZE.
+
+2003-04-24  Ulrich Drepper  <drepper@redhat.com>
+
+	* nss/getent.c: Implement alternative host database lookup via
+	getaddrinfo.
+
+	* include/ifaddrs.h: New file.
+	* include/netdb.h: Move definitions of AI_V4MAPPED, AI_ALL, and
+	AI_ADDRCONFIG...
+	* resolv/netdb.h: ...here.
+	* sysdeps/gnu/ifaddrs.c. Use libc_hidden_def where appropriate.
+	* sysdeps/unix/sysv/linux/ifaddrs.c: Likewise.
+	* sysdeps/posix/getaddrinfo.c: Implement AI_V4MAPPED, AI_ALL, and
+	AI_ADDRCONFIG.
+
+2003-04-24  Roland McGrath  <roland@redhat.com>
+
+	* elf/dl-reloc.c (_dl_allocate_static_tls): Add internal_function.
+
+2003-04-24  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/dl-reloc.c (allocate_static_tls): Rename to...
+	(_dl_allocate_static_tls): ... this function.  No longer static.
+	(CHECK_STATIC_TLS): Adjust.
+	* sysdeps/generic/ldsodefs.h (_dl_allocate_static_tls): New prototype.
+	* sysdeps/powerpc/powerpc32/dl-machine.h (__process_machine_rela):
+	Add SYM_MAP argument.
+	(elf_machine_rela): Adjust caller.  Declare SYM_MAP unconditionally.
+	Check if SYM_MAP != NULL for R_PPC_DTPREL32.  Only handle 32-bit
+	TLS relocs here.  #ifdef out relocs which never appear in
+	.gnu.conflict section from dl-conflict.c processing.
+	* sysdeps/powerpc/powerpc32/dl-machine.c (__process_machine_rela):
+	Add SYM_MAP argument.  Handle 16-bit TLS relocs here.
+
+	* sysdeps/s390/s390-32/dl-machine.h (elf_machine_rela): #ifdef
+	out relocs which never appear in .gnu.conflict section from
+	dl-conflict.c processing.
+	* sysdeps/s390/s390-64/dl-machine.h (elf_machine_rela): Likewise.
+	* sysdeps/x86_64/dl-machine.h (elf_machine_rela): Likewise.
+	* sysdeps/i386/dl-machine.h (elf_machine_rela): Likewise.
+	Use r_type in RESOLVE macro.
+
+2003-04-23  Ulrich Drepper  <drepper@redhat.com>
+
+	* nis/ypclnt.c (__yp_bind): Expect YPDB parameter to always be !=
+	NULL.  Remove code made redundant by this assumption.
+	(__yp_unbind): Add call to free.  Adjust all callers.
+
+	* nis/ypclnt.c (yp_all): Free the dom_binding object after
+	unbinding it.
+
+	* grp/initgroups.c (getgrouplist): Don't copy too much into the
+	user buffer if more groups are found than fit into it.
+
+	* nis/nss_nis/nis-initgroups.c (_nss_nis_initgroups_dyn): Use
+	extend_alloca.
+
+2003-04-23  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/posix/getaddrinfo.c (gaih_inet): Check for rc == ERANGE,
+	not rc == errno.  Use extend_alloca.
+
+	* elf/tst-tls12.c (main): Fix declaration.
+	* elf/tst-tls10.c (dummy): Make hidden instead of static.
+	* elf/tst-tlsmod7.c (dummy): Likewise.
+	* elf/tst-tlsmod8.c (dummy): Likewise.
+	* elf/tst-tlsmod9.c (dummy): Likewise.
+
+2003-04-22  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/sysv/linux/not-cancel.h: Put parens around macro args.
+	(open_not_cancel): Make last argument non-optional.
+	* sysdeps/generic/check_fds.c (check_one_fd): Update caller.
+	* sysdeps/unix/sysv/linux/gethostid.c (gethostid): Likewise.
+	* iconv/gconv_cache.c (__gconv_load_cache): Likewise.
+
+	* include/tls.h: Protect against multiple inclusion.
+
+2003-04-22  Ulrich Drepper  <drepper@redhat.com>
+
+	* nscd/nscd-client.h: Add declaration for __nscd_open_socket.
+	* nscd/nscd_gethst_r.c (__nscd_open_socket): Renamed from
+	open_socket.  Not static anymore.
+	(nscd_gethst_r): Use __nscd_open_socket.
+	* nscd/nscd_getgr_r.c (open_socket): Removed.
+	(nscd_getgr_r): Use __nscd_open_socket.
+	* nscd/nscd_getpw_r.c (open_socket): Removed.
+	(nscd_getpw_r): Use __nscd_open_socket.
+
+	* nscd/nscd.c (main): Change type of fdn to long int and use strtol.
+	* nscd/connections.c (handle_request): Add cast to avoid warning.
+
+2003-04-21  Ulrich Drepper  <drepper@redhat.com>
+
+	* signal/sigfillset.c: Moved to...
+	* sysdeps/generic/sigfillset.c: ...here.  If SIGCANCEL is defined
+	do not set the corresponding bit.
+
+	* sysdeps/unix/sysv/linux/sigprocmask.c: Prevent changing mask for
+	SIGCANCEL.
+	* sysdeps/unix/sysv/linux/alpha/bits/siginfo.h: Define SI_TKILL.
+	* sysdeps/unix/sysv/linux/bits/siginfo.h: Define SI_TKILL.
+	* sysdeps/unix/sysv/linux/ia64/bits/siginfo.h: Define SI_TKILL.
+	* sysdeps/unix/sysv/linux/s390/bits/siginfo.h: Define SI_TKILL.
+	* sysdeps/unix/sysv/linux/sparc/bits/siginfo.h: Define SI_TKILL.
+
+2003-04-20  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/not-cancel.h (open_not_cancel): Cast
+	first syscall parameter to const char*.
+
+2003-04-19  Ulrich Drepper  <drepper@redhat.com>
+
+	* intl/Makefile ($(objpfx)msgs.h): Use C locale for sed run.
+
+	* configure.in: Add AC_PROG_CXX.
+	* config.make.in (CXX): Define.
+
+	* sysdeps/i386/i686/hp-timing.h (HP_TIMING_PRINT): Change type of
+	__len to size_t to avoid warnings.
+
+2003-04-18  Jes Sorensen  <jes@wildopensource.com>
+
+	* libc/sysdeps/unix/sysv/linux/ia64/bits/fcntl.h: Sync with Linux
+	2.5.67.
+	* libc/sysdeps/unix/sysv/linux/alpha/bits/fcntl.h: Likewise.
+
+2003-04-19  Ulrich Drepper  <drepper@redhat.com>
+
+	* stdlib/cxa_finalize.c (__cxa_finalize): Don't call
+	UNREGISTER_ATFORK if d == NULL.
+
+	* catgets/nl_types.h: Remove __THROW marker from cancellation points.
+	* dirent/dirent.h: Likewise.
+	* dlfcn/dlfcn.h: Likewise.
+	* grp/grp.h: Likewise.
+	* iconv/iconv.h: Likewise.
+	* io/fcntl.h: Likewise.
+	* io/ftw.h: Likewise.
+	* libio/stdio.h: Likewise.
+	* misc/sys/mman.h: Likewise.
+	* misc/sys/select.h: Likewise.
+	* misc/sys/syslog.h: Likewise.
+	* misc/sys/uio.h: Likewise.
+	* posix/spawn.h: Likewise.
+	* posix/unistd.h: Likewise.
+	* posix/sys/wait.h: Likewise.
+	* pwd/pwd.h: Likewise.
+	* resolv/netdb.h: Likewise.
+	* rt/aio.h: Likewise.
+	* shadow/shadow.h: Likewise.
+	* signal/signal.h: Likewise.
+	* socket/sys/socket.h: Likewise.
+	* stdlib/stdlib.h: Likewise.
+	* streams/stropts.h: Likewise.
+	* string/string.h: Likewise.
+	* sysdeps/gnu/utmpx.h: Likewise.
+	* sysvipc/sys/msg.h: Likewise.
+	* termios/termios.h: Likewise.
+	* time/time.h: Likewise.
+	* wcsmbs/wchar.h: Likewise.
+	* iconv/gconv_cache.c: Include <not-cancel.h> and use non-cancelable
+	functions.
+	* misc/daemon.c: Likewise.
+	* sysdeps/generic/backtracesymsfd.c: Likewise.
+	* sysdeps/generic/check_fds.c: Likewise.
+	* sysdeps/unix/sysv/linux/gethostid.c: Likewise.
+	* sysdeps/unix/sysv/linux/not-cancel.h: New file.
+	* sysdeps/generic/not-cancel.h: New file.
+	* csu/Makefile (distribute): Add not-cancel.h.
+	* sysdeps/unix/sysv/linux/fatal-prepare.h: New file.
+	* sysdeps/unix/sysv/linux/Makefile: Define FATAL_PREPARE_INCLUDE
+	for assert.c and assert-perr.c to include <fatal-prepare.h>.
+	* sysdeps/unix/sysv/linux/Dist: Add fatal-prepare.h.
+
+	* sysdeps/posix/remove.c (remove): Rewrite.  No need to restore
+	errno and unlink first.
+
+	* io/ftw.c (ftw_dir): In all places assume fchdir is available.
+
+2003-04-18  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/libc_fatal.c (__libc_fatal): Use
+	INTERNAL_SYSCALL instead of INLINE_SYSCALL.
+
+2003-04-17  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/Makefile: Remove db2 directory handling.
+
+	* malloc/Makefile (CFLAGS-malloc.c): Define DEFAULT_TOP_PAD to 128k.
+	* sysdeps/unix/sysv/linux/Makefile (CFLAGS-malloc.c): Add to, not
+	replace.
+
+	* signal/Makefile (tests): Add tst-sigsimple.
+	* signal/tst-sigsimple.c: New file.
+
+2003-04-16  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/Makefile (distribute): Add tst-tlsmod{[7-9],1[0-2]}.c and
+	tst-tls10.h.
+	(tests): Add tst-tls1[0-2].
+	(modules-names): Add tst-tlsmod{[7-8],1[0-2]}.
+	($(objpfx)tst-tlsmod8.so): Depend on tst-tlsmod7.so.
+	($(objpfx)tst-tlsmod10.so): Depend on tst-tlsmod9.so.
+	($(objpfx)tst-tlsmod12.so): Depend on tst-tlsmod11.so.
+	($(objpfx)tst-tls10): Depend on tst-tlsmod8.so.
+	($(objpfx)tst-tls11): Depend on tst-tlsmod10.so.
+	($(objpfx)tst-tls12): Depend on tst-tlsmod12.so.
+	* elf/tst-tls10.c: New test.
+	* elf/tst-tls11.c: New test.
+	* elf/tst-tls12.c: New test.
+	* elf/tst-tls10.h: New file.
+	* elf/tst-tlsmod7.c: New file.
+	* elf/tst-tlsmod8.c: New file.
+	* elf/tst-tlsmod9.c: New file.
+	* elf/tst-tlsmod10.c: New file.
+	* elf/tst-tlsmod11.c: New file.
+	* elf/tst-tlsmod12.c: New file.
+
+2003-04-15  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/bits/atomic.h: Moved ppc32/64 specific code to ...
+	* sysdeps/powerpc/powerpc32/bits/atomic.h: New file.
+	* sysdeps/powerpc/powerpc64/bits/atomic.h: New file.
+
+2003-04-17  Ulrich Drepper  <drepper@redhat.com>
+
+	* posix/regex.h: Include <sys/types.h>.
+
+	* signal/sigrelse.c (sigrelse): Use sigdelset and not __sigdelset.
+	The signal number must be checked.
+	* signal/sighold.c (sighold): Use sigaddset and not __sigaddset.
+	The signal number must be checked [PR libc/5004].
+
+	* sysdeps/unix/sysv/linux/system.c: If compiled without threads
+	don't do anything fancy.
+
+	* sysdeps/generic/bits/libc-lock.h: Define
+	__rtld_lock_define_initialized_recursive.
+
+	* nss/getXXbyYY_r.c [USE_NSCD] (REENTRANT_NAME): Only retry
+	contacting nscd if NOT_USENSCD_NAME > 0.
+	* nss/nsswitch.c (__nss_disable_nscd): New function.
+	* nss/nsswitch.h: Declare it.
+	* nss/Versions [GLIBC_PRIVATE]: Export __nss_disable_nscd.
+	* nscd/nscd.c (main): Call __nss_disable_nscd.
+
+2003-04-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* stdio-common/perror.c (perror): We don't need to set the offset
+	to _IO_pos_bad, this is how streams are initialized.
+
+	* locale/programs/ld-time.c (TESTARR_ELEM): Make i unsigned.
+	(time_output): If necessary, allocate new buffer for .name string if
+	padding is required.
+
+	* sysdeps/unix/sysv/linux/ifaddrs.c (getifaddrs): Check lengths
+	before copying.  This might leave holes in the list.  Adjust
+	pointers if necessary.
+	(netlink_receive): Allocate only one block.
+	(free_netlink_handle): Adjust appropriately.
+	(getifaddrs): Lots of cleanups.
+
+	* string/test-strncpy.c (do_one_test): Mark start and stop as
+	possibly unused.
+	* string/test-memchr.c: Likewise.
+	* string/test-memcmp.c: Likewise.
+	* string/test-memcpy.c: Likewise.
+	* string/test-memmove.c: Likewise.
+	* string/test-memset.c: Likewise.
+	* string/test-strcat.c: Likewise.
+	* string/test-strchr.c: Likewise.
+	* string/test-strcmp.c: Likewise.
+	* string/test-strcpy.c: Likewise.
+	* string/test-strlen.c: Likewise.
+	* string/test-strncmp.c: Likewise.
+	* string/test-strpbrk.c: Likewise.
+	* string/test-strrchr.c: Likewise.
+	* string/test-strspn.c: Likewise.
+
+2003-04-15  Roland McGrath  <roland@redhat.com>
+
+	* libio/fileops.c (_IO_file_close_it): Macro tweak to avoid warning.
+
+	* sysdeps/generic/libc-start.c [NEED_DL_SYSINFO]: Add decl for
+	INTUSE(__register_frame_info_bases).
+
+2003-04-15  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/elf.h: Define AT_SYSINFO_EH_FRAME.
+	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start): Handle
+	AT_SYSINFO_EH_FRAME.  Adjust string width.
+	(_dl_show_auxv):Display AT_SYSINFO_EH_FRAME value.
+	* sysdeps/generic/ldsodefs.h [NEED_DL_SYSINFO] (struct rtld_global):
+	Add _dl_sysinfo_eh_frame field.
+	* elf/dl-support.c [NEED_DL_SYSINFO]: Define _dl_sysinfo_eh_frame.
+	* sysdeps/generic/libc-start.c [NEED_DL_SYSINFO] Define eh_obj
+	variable.
+	[NEED_DL_SYSINFO] (LIBC_START_MAIN): Call __register_frame_info_bases
+	if _dl_sysinfo_eh_frame is non-NULL.
+
+	* Makeconfig (gnulib): Add -lgcc_eh.
+
+	* config.h.in: Define HAVE_FORCED_UNWIND.
+
+2003-04-15  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/powerpc64/strcmp.S: Convert to full 64-bit.
+	* sysdeps/powerpc/powerpc64/strcpy.S: Likewise.
+
+2003-04-15  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_rela): Avoid
+	checking R_PPC_RELATIVE, R_PPC_NONE and whether relocation is
+	against local symbol in conflict processing.
+
+2003-04-15  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/bits/atomic.h
+	[__powerpc64] (__arch_compare_and_exchange_val_64_acq): Define.
+	[! __powerpc64] (__arch_compare_and_exchange_val_64_acq): Defined
+	as abort stub.
+	(__arch_compare_and_exchange_val_32_acq): Define.
+	(atomic_compare_and_exchange_val_acq): Define.
+
+2003-04-15  Ulrich Drepper  <drepper@redhat.com>
+
+	* include/atomic.h: Pretty printing.
+
+2003-04-14  Ulrich Drepper  <drepper@redhat.com>
+
+	* stdio-common/vfscanf.c: Add casts to avoid warnings.
+
+2003-04-14  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/i386/i486/bits/atomic.h: Rename LOCK to LOCK_PREFIX.
+	* sysdeps/x86_64/bits/atomic.h: Likewise.
+
+2003-04-14  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/i386/sysdep.h: Change PUSHARGS_1 and
+	POPARGS_1 to emit labels for the mov instructions.
+
+2003-04-14  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h (ret_NOERRNO): Define.
+
+2003-04-14  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/generic/unwind-dw2.c (_Unwind_GetCFA): Add a cast to silence
+	compiler warning.
+
+	* sysdeps/generic/unwind-pe.h: Fix decl hacks broken in merge.
+
+2003-04-14  Ulrich Drepper  <drepper@redhat.com>
+
+	* string/strxfrm.c (STRXFRM): Terminate rulearr at correct
+	position.  Reported by jreiser@BitWagon.com.
+
+2003-04-13  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/unwind-dw2-fde.c: Update from recent gcc version.
+	* sysdeps/generic/unwind-dw2-fde.h: Likewise.
+	* sysdeps/generic/unwind-dw2.c: Likewise.
+	* sysdeps/generic/unwind-pe.h: Likewise.
+
+2003-04-13  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/unix/sysv/linux/mips/profil-counter: New.
+	* sysdeps/unix/sysv/linux/mips/sigcontextinfo.h: Port to n32/n64.
+	* sysdeps/unix/sysv/linux/mips/bits/sigcontext.h: New.
+	* sysdeps/unix/sysv/linux/mips/sys/ucontext.h: Port to n32/n64.
+	(mcontext_t): Make it match the 32-bit mips kernel in o32.
+	* sysdeps/unix/sysv/linux/mips/sys/user.h: Bring in constants from
+	the mips and mips64 headers.
+	(struct user): Port to n32/n64.
+
+2003-04-12  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_init): Add cast to
+	avoid warning.
+
+	* sysdeps/unix/sysv/linux/i386/sigaction.c (__libc_sigaction): If
+	__ASSUME_VSYSCALL is defined don't add restorer.
+	* sysdeps/unix/sysv/linux/kernel-features.h: Define
+	__ASSUME_VSYSCALL for 2.5.53.
+
+2003-04-11  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/libc-start.c: Cleanup MAIN_AUXVEC_ARG handling.
+	Remove HAVE_CANCELBUF code.  Replace with code using the new
+	initializers for unwind-based cleanup handling.
+	* sysdeps/generic/unwind.h: Update from latest gcc version.
+	* sysdeps/unix/sysv/linux/i386/sysdep.h: Define labels in a few
+	places to allow unwind data generation.
+	* sysdeps/i386/bits/setjmp.h: Allow file to be included multiple times.
+	* sysdeps/x86_64/bits/setjmp.h: Likewise.
+	* sysdeps/sh/bits/setjmp.h: Likewise.
+	* sysdeps/powerpc/bits/setjmp.h: Likewise.
+	* sysdeps/unix/sysv/linux/ia64/bits/setjmp.h: Likewise.
+	* sysdeps/alpha/bits/setjmp.h: Likewise.
+
+2003-04-11  Roland McGrath  <roland@redhat.com>
+
+	* csu/tst-empty.c: New file.
+	* csu/Makefile (tests, tests-static): Add it.
+
+2003-04-11  Jakub Jelinek  <jakub@redhat.com>
+
+	* string/test-strcmp.c (do_random_tests): Test whether return value
+	has been promoted to wordsize if the ABI requires caller to do so.
+	* string/test-strncmp.c (do_random_tests): Likewise.
+	* string/test-memcmp.c (do_random_tests): Likewise.
+
+	* sysdeps/powerpc/powerpc64/strcmp.S (strcmp): Sign extend rRTN
+	before returning.
+
+	* sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c
+	(__fe_nomask_env): Try prctl even if __ASSUME_NEW_PRCTL_SYSCALL
+	is not defined, but the prctl constants are.
+
+	* string/tester.c (test_strcmp): Fix a typo.
+
+2003-04-09  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/alpha/fpu/bits/mathdef.h: Remove FLT_EVAL_METHOD definition.
+	* sysdeps/powerpc/fpu/bits/mathdef.h: Likewise.
+
+2003-04-08  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/sys/regdef.h (t4,t5,t6,t7): Renamed to t0..t3 on
+	NewABI.
+	(ta0, ta1, ta2, ta3): Defined to t4..t7 on o32, and a4..a7 on
+	NewABI.
+	* sysdeps/mips/mips64/memcpy.S: Adjust register naming
+	conventions.
+	* sysdeps/mips/mips64/memset.S: Likewise.
+	* sysdeps/unix/mips/sysdep.S (__syscall_error) [_LIBC_REENTRANT]:
+	Use t0 instead of t4 as temporary.
+
+2003-04-07  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/ldconfig.c (parse_conf): Ignore leading whitespace.  Use
+	feof_unlocked instead of feof.
+	(add_dir): Ignore trailing whitespace.
+
+2003-04-07  Jakub Jelinek  <jakub@redhat.com>
+
+	* posix/bug-regex4.c (main): Cap RANGE and STOP arguments to
+	sum of SIZE1 and SIZE2 arguments.
+
+2003-04-06  Ulrich Drepper  <drepper@redhat.com>
+
+	* iconv/iconv_prog.c (process_block): Don't print message about
+	invalid input if the -c option is used.
+	(main): Correctly append IGNORE string for -c option.
+
+2002-04-06  Kaz Kojima  <kkojima@rr.iij4u.or.jp>
+
+	* sysdeps/sh/bits/atomic.h: Moved to ...
+	* sysdeps/unix/sysv/linux/sh/bits/atomic.h: ... here.  Add comments.
+	(__arch_compare_and_exchange_val_*_acq): Add parens around macro
+	arguments.
+	(atomic_bit_set, atomic_bit_test_set): Likewise.
+	(atomic_exchange_and_add): Likewise.  Don't evaluate VALUE argument
+	twice.
+	(atomic_add, atomic_add_negative, atomic_add_zero): Likewise.
+
+2003-04-06  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/sysv/linux/i386/swapcontext.S: Rewrite register
+	restoration as done for setcontext yesterday.
+
+2003-04-06  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/rtld.c: Revert 2003-03-14 change.
+	* elf/dl-conflict.c (_dl_resolve_conflicts): Move
+	#if ! ELF_MACHINE_NO_RELA conditional into the routine.
+
+2003-04-05  Ulrich Drepper  <drepper@redhat.com>
+
+	* sunrpc/xdr.c (xdr_string): Catch nodesize == 0 [PR libc/4999].
+
+	* sysdeps/ieee754/ldbl-96/e_gammal_r.c (__ieee754_gammal_r):
+	Always initialize *signgamp before returning an error.
+
+2003-04-05  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/sysv/linux/i386/setcontext.S: Rewrite to avoid writing
+	below the stack pointer even if switching to the same context we are
+	running right now.
+
+2003-04-05  Ulrich Drepper  <drepper@redhat.com>
+
+	* catgets/gencat.c (read_input_file): Make sure that \n is not
+	alone on the line before testing for continuation.
+
+	* math/test-tgmath.c (compile_test): Initialize c.
+
+2003-04-05  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/unix/sysv/linux/mips/mips64/n32/ftruncate64.c: New.
+	* sysdeps/unix/sysv/linux/mips/mips64/n32/truncate64.c: New.
+	* sysdeps/unix/sysv/linux/kernel-features.h: fcntl64 is available
+	on mips n32.
+	* sysdeps/unix/sysv/linux/mips/kernel_stat.h: Explain why
+	XSTAT_IS_XSTAT64 must not be used for mips n64.  Use 64-bit data
+	structure on n32 as well.
+	* sysdeps/unix/sysv/linux/mips/bits/stat.h: Use POSIX-compliant
+	data types on n32 and n64.
+
+2003-04-05  Ulrich Drepper  <drepper@redhat.com>
+
+	* libio/fileops.c (_IO_new_file_fopen): Don't free step data right
+	after getting them.
+
+	* malloc/thread-m.h [PTHREAD_MUTEX_INITIALIZER]: If
+	HAVE_register_atfork_malloc is defined use __register_atfork_malloc
+	instead of __register_atfork.
+
+2003-04-05  Jakub Jelinek  <jakub@redhat.com>
+
+	* stdio-common/reg-printf.c (__register_printf_function): Calloc
+	instead of malloc __printf_arginfo_table and __printf_function_table.
+	Reported by John Reiser <jreiser@BitWagon.com>.
+
+2003-04-04  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/powerpc64/strchr.S: 64-bit optimizations.
+	* sysdeps/powerpc/powerpc64/strlen.S: 64-bit optimizations.
+
+	* sysdeps/powerpc/fpu/bits/mathdef.h (FLT_EVAL_METHOD): Undef before
+	defining.
+
+2003-04-04  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/unix/sysv/linux/mips/bits/fcntl.h (struct flock): Adjust
+	for n64 abi.
+
+2003-04-03  Roland McGrath  <roland@redhat.com>
+
+	* configure.in: Fix up use of compilation flags to match the build:
+	For .s files, $ASFLAGS;
+	For .S files, $CPPFLAGS $ASFLAGS;
+	For .c files, $CFLAGS $CPPFLAGS;
+	when linking, add $LDFLAGS.
+	* configure: Regenerated.
+
+2003-04-03  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/getsysstats.c (get_proc_path): Reverse test
+	for atomic_compare_and_exchange_bool_acq failure.
+
+2003-04-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* posix/unistd.h: Define _POSIX_VERSION, _POSIX2_VERSION,
+	_POSIX2_C_BIND, _POSIX2_C_DEV, _POSIX2_SW_DEV, and
+	_POSXI2_LOCALEDEF to 200112L.  Remove _POSIX2_C_VERSION.
+	Remove declaration of pthread_atfork.
+
+2003-04-02  Ulrich Drepper  <drepper@redhat.com>
+
+	* locale/iso-639.def: Add many more languages from the current ISO 639.
+
+	* sysdeps/unix/sysv/linux/ipc_priv.h: Define IPCOP_semtimedop.
+	* sysdeps/generic/semtimedop.c: New file.
+	* sysdeps/unix/sysv/linux/i386/semtimedop.S: New file.
+	* sysdeps/unix/sysv/linux/ia64/syscalls.list: Add semtimedop.
+	* sysdeps/unix/sysv/linux/x86_64/syscalls.list: Likewise.
+	* sysvipc/Makefile (routines): Add semtimedop.
+	* sysvipc/Versions [GLIBC_2.3.3] (glibc): Add semtimedop.
+	* sysvipc/sys/sem.h: Declare semtimedop.
+
+2003-04-02  Daniel Jacobowitz  <drow@mvista.com>
+
+	* configure.in: Check for __register_frame_info in both
+	-lgcc and -lgcc_eh.
+	* configure: Regenerated.
+
+2003-04-01  Roland McGrath  <roland@redhat.com>
+
+	* scripts/abilist.awk: Allow dots in soname suffix.
+
+	* scripts/abilist.awk (emit): Fix bailout condition.
+
+2003-04-01  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/sparc/sparc64/sigsuspend.c: Use the
+	IA-64 version.
+
+	* elf/tls-macros.h [__ia64__] (TLS_IE, TLS_LD, TLS_GD): Add gp
+	register as input to asm.
+
+2003-04-01  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/bits/siginfo.h (sigevent_t): Fix a typo.
+
+2003-04-01  Andreas Jaeger  <aj@suse.de>
+
+	* configure.in: Output as/ld as name if version is too old.
+
+2003-03-31  Daniel Jacobowitz  <drow@mvista.com>
+
+	* configure.in: Don't require an installed C library in the test
+	for ".set" assembler support.
+
+2003-03-31  Roland McGrath  <roland@redhat.com>
+
+	* signal/tst-sigset.c: New file.
+	* signal/Makefile (tests): Add it.
+
+2003-03-31  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/alpha/bits/signum.h (_NSIG): Define to 65.
+	* sysdeps/unix/sysv/linux/hppa/bits/signum.h (_NSIG): Likewise.
+	* sysdeps/unix/sysv/linux/sparc/bits/signum.h (_NSIG): Likewise.
+	* sysdeps/unix/sysv/linux/bits/signum.h (_NSIG): Likewise.
+	(__SIGRTMAX): Adjust accordingly.
+	* sysdeps/gnu/siglist.c: If OLD2_SIGLIST_SIZE is defined define
+	second compatibility symbol set.
+	* sysdeps/unix/sysv/linux/siglist.h (OLD2_SIGLIST_SIZE): Define.
+
+2003-03-31  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/m68k/m68020/bits/atomic.h (atomic_increment_and_test):
+	Define.
+	(atomic_decrement_and_test): Fix test.
+
+2003-03-31  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/sparc/sparc32/bits/atomic.h: New file.
+	* sysdeps/sparc/sparc32/sparcv9/bits/atomic.h: New file.
+	* sysdeps/sparc/sparc64/bits/atomic.h: New file.
+	* sysdeps/sparc/sparc32/atomicity.h: Removed.
+	* sysdeps/sparc/sparc32/sparcv9/atomicity.h: Removed.
+	* sysdeps/sparc/sparc64/atomicity.h: Removed.
+
+2003-03-30  Roland McGrath  <roland@redhat.com>
+
+	* scripts/abilist.awk: Grok .opd foo plus .text .foo as "foo F" alone.
+
+	* intl/po2test.sed: Anchor substitution regexps to fix last change.
+
+2003-03-29  Paolo Bonzini  <bonzini@gnu.org>
+
+	* intl/po2test.sed: Unify the transformations for msgid and msgstr
+	and remove a useless s/// command.
+
+2003-03-27  David Mosberger  <davidm@hpl.hp.com>
+
+	* sysdeps/ia64/dl-machine.h (RTLD_START): Wrap ".save rp, r0"
+	directive into empty .prologue region to ensure that call-chain
+	is terminated even for the first instruction.
+
+	* sysdeps/ia64/elf/start.S (_start): Use ".save rp, r0" idiom
+	to terminate call-chain right from the get-go.
+
+	* sysdeps/unix/sysv/linux/ia64/fork.S (fork): Remove unnecessary
+	stop bit between compare & branch.
+
+2003-03-29  Ulrich Drepper  <drepper@redhat.com>
+
+	* stdlib/strtod.c (INTERNAL): Recognize first digit after decimal
+	point correctly [PR libc/4993].
+
+	* sysdeps/unix/sysv/linux/ifaddrs.c (getifaddrs): Avoid
+	netlink_open calls if netlink is known to not be available.
+
+2003-03-29  Alexandre Oliva  <aoliva@redhat.com>
+
+	* configure.in: Add mips64* support.
+	* sysdeps/mips/bits/endian.h: Make it bi-endian.
+	* sysdeps/mips/mipsel/bits/endian.h: Removed.
+	* sysdeps/mips/mips64/n32/el/bits/endian.h: Removed.
+	* sysdeps/mips/mips64/n64/el/bits/endian.h: Removed.
+	* sysdeps/mips/mips32/Makefile (CC): Add -mabi=32.
+	* sysdeps/mips/mips64/n32/Makefile (CC): Add -mabi=n32.
+	* sysdeps/mips/mips64/n64/Makefile (CC): Add -mabi=64.
+	* sysdeps/mips/Implies: Moved wordsize-32 to...
+	* sysdeps/mips/mips32/Implies: New file.
+	* sysdeps/unix/mips/sysdep.h (PSEUDO_NOERRNO, PSEUDO_END_NOERRNO,
+	ret_NOERRNO): New.
+	(ret, PSEUDO_END): Moved past END.
+	(PSEUDO): Moved to...
+	* sysdeps/unix/mips/mips32/sysdep.h: New file.
+	* sysdeps/unix/mips/mips64/n32/sysdep.h: Removed #undef PSEUDO.
+	* sysdeps/unix/mips/mips64/n64/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/mips/sysdep.h: Move to...
+	* sysdeps/unix/sysv/linux/mips/mips32/sysdep.h: New file.
+	* sysdeps/unix/sysv/linux/mips/mips32/kern64/sysdep.h: New file.
+
+	* sysdeps/unix/sysv/linux/mips/clone.S (__thread_start):
+	Re-introduce ENTRY.
+
+2003-03-28  Thorsten Kukuk  <kukuk@suse.de>
+
+	* sysdeps/unix/sysv/linux/ifaddrs.c: New file.
+	* inet/test-ifaddrs.c: Allow AF_PACKET.
+	* sysdeps/unix/sysv/linux/kernel-features.h: Add
+	__ASSUME_NETLINK_SUPPORT.
+
+2003-03-28  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/vismain.c (do_test): Comment out tests which fail in the moment.
+
+2003-03-26  H.J. Lu  <hjl@gnu.org>
+
+	* elf/vismod.h (getvarlocal1): Return const char **.
+	(getvarinmod1): Likewise.
+	(getvaritcpt1): Likewise.
+	(getvarlocal2): Likewise.
+	(getvarinmod2): Likewise.
+	(getvaritcpt2): Likewise.
+	(getvaritcpt3): Likewise.
+	* elf/vismain.c (do_test): Adjusted.
+	* elf/vismod1.c (getvarlocal1): Return address.
+	(getvarinmod1): Likewise.
+	(getvaritcpt1): Likewise.
+	* elf/vismod2.c (getvarlocal2): Likewise.
+	(getvarinmod2): Likewise.
+	(getvaritcpt2): Likewise.
+	* elf/vismod3.c (getvaritcpt3): Likewise.
+
+2003-03-28  Roland McGrath  <roland@redhat.com>
+
+	* elf/vismain.c (do_test): Print both addresses when they don't match.
+
+	* scripts/abilist.awk: If given -v filename_regexp and/or -v
+	libname_regexp when parsing names, then produce output only
+	for those matching the given regexps.  In combine mode, save all
+	stanzas for a final sorting by stanza header at the end.
+	Emit a blank line between stanzas.
+
+	* scripts/abilist.awk: When given -v combine=1, do parse_names and
+	emit a single output stream with lib name in stanza header lines.
+
+	* scripts/abilist.awk: Emit A for all *ABS* regardless of type.
+
+2003-03-27  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/powerpc/bits/atomic.h [! __powerpc64__]
+	(__arch_atomic_decrement_if_positive_64): Fix bogus definition.
+
+2003-03-28  Kaz Kojima  <kkojima@rr.iij4u.or.jp>
+
+	* sysdeps/sh/bits/atomic.h (__arch_compare_and_exchange_val_8_acq):
+	Return old value. Make asm output reg constraint earlyclobber.
+	Renamed from...
+	(__arch_compare_and_exchange_8_acq): ... this.
+	(__arch_compare_and_exchange_val_16_acq):
+	Return old value. Make asm output reg constraint earlyclobber.
+	Renamed from...
+	(__arch_compare_and_exchange_16_acq): ... this.
+	(__arch_compare_and_exchange_val_32_acq):
+	Return old value. Make asm output reg constraint earlyclobber.
+	Renamed from...
+	(__arch_compare_and_exchange_32_acq): ... this.
+	(__arch_compare_and_exchange_val_64_acq):
+	Renamed from...
+	(__arch_compare_and_exchange_64_acq): ... this.
+	(atomic_exchange_and_add): Use local variables and
+	__arch_compare_and_exchange_val_64_acq.
+	(atomic_add): Likewise.
+	(atomic_add_negative, atomic_add_zero): Use local variables.
+
+2003-03-28  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/unix/mips/sysdep.S: Include sys/asm.h.
+
+2003-03-27  Ulrich Drepper  <drepper@redhat.com>
+
+	* Makefile: Remove libmd5crypt goal.
+
+2003-03-25  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_rela): Restore
+	special handling of relocations against local symbols.
+
+2003-03-27  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/bits/atomic.h
+	(__arch_compare_and_exchange_bool_32_acq): Move to [!__powerpc64__].
+	[__powerpc64__] (__arch_compare_and_exchange_bool_32_acq):
+	Define PPC64 specific version.
+	[__powerpc64__] (__arch_compare_and_exchange_bool_64_acq):
+	Change (mem) constraint to "b".
+	[__powerpc64__] (__arch_atomic_exchange_and add_64):
+	Replace addi with add. Change (value) contraint to "r".
+	Change (mem) constraint to "b".
+	[__powerpc64__] (__arch_atomic_decrement_if_positive_64): New macro.
+	(__arch_atomic_exchange_32): Change (mem) constraint to "b".
+	(__arch_atomic_exchange_and_add_32): Change (mem) constraint to "b".
+	(__arch_atomic_decrement_if_positive_32): New macro.
+	(atomic_decrement_if_positive): Use __arch* macros.
+
+2003-03-27  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/ia64/fpu/libm-test-ulps: Update.
+
+2003-03-27  Roland McGrath  <roland@redhat.com>
+
+	* scripts/rpm2dynsym.sh: New file.
+	* Makefile (distribute): Add it.
+
+2003-03-27  David Mosberger  <davidm@hpl.hp.com>
+
+	* sysdeps/unix/sysv/linux/ia64/getcontext.S: Restore caller's
+	ar.unat before returning.  Add missing .mem.offset directives
+	to ensure file gets assembled without warnings.
+	* sysdeps/unix/sysv/linux/ia64/setjmp.S: Likewise.
+
+2003-03-27  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/sysconf.c (__sysconf) <_SC_MONOTONIC_CLOCK>:
+	Return -1 instead of 0 if clock_getres failed.
+
+2003-03-27  Roland McGrath  <roland@redhat.com>
+
+	* scripts/abilist.awk: If variable `parse_names' is set, grok the file
+	header lines and write out foo.symlist files for each foo.so.NN listed.
+
+	* libio/libioP.h (_IO_wfile_jumps): Remove attribute_hidden.
+	This symbol is exported, and we don't want to hide it.
+	Add libc_hidden_proto instead.
+	(_IO_file_jumps): Add libc_hidden_proto.
+	* libio/wfileops.c (_IO_wfile_jumps): Add libc_hidden_data_def.
+	Remove INTVARDEF.
+	* libio/fileops.c (_IO_file_jumps): Likewise.
+	* libio/stdfiles.c: Don't use INTUSE on them.
+	* libio/iofdopen.c (_IO_new_fdopen): Likewise.
+	* libio/iofopen.c (__fopen_internal): Likewise.
+	* libio/freopen.c (freopen): Likewise.
+	* libio/freopen64.c (freopen64): Likewise.
+	* libio/iovdprintf.c (_IO_vdprintf): Likewise.
+
+	* Makerules (check-abi) [$(enable-check-abi) = warn]:
+	Ignore exit status from diff.
+	* configure.in (enable_check_abi): Document possible value "warn".
+	Change default to no for now.
+	* configure: Regenerated.
+
+	* sysdeps/unix/Makefile ($(objpfx)stub-syscalls.c): Emit stub_warning
+	macro calls and a #include <stub-tag.h> at the end.
+	* Makerules ($(objpfx)stubs): Tweak sed commands.
+
+	* sysdeps/unix/sysv/linux/syscalls.list: Use - rather than EXTRA in
+	caller column for *xattr syscalls, since they are in sysdeps/generic.
+
+	* sysdeps/unix/sysv/linux/i386/setfsuid.c: setfsgid -> setfsuid
+	* sysdeps/unix/sysv/linux/i386/setfsgid.c: setfsuid -> setfsgid
+
+2003-03-26  Roland McGrath  <roland@redhat.com>
+
+	* Makerules (check-abi-config): Use /thread instead of /tls when
+	use-thread and not just use-tls is set.
+
+	* Makerules (update-abi): Put quotes around $(update-abi-config).
+
+	* elf/Makefile (check-abi): Depend on check-abi-ld.
+	(update-abi): Depend on update-abi-ld.
+
+2003-03-26  GOTO Masanori  <gotom@debian.or.jp>
+
+	* sysdeps/unix/sysv/linux/i386/setfsuid.c: Use INTERNAL_SYSCALL and
+	do not check for errors (unless testing for 32bit variant).
+	* sysdeps/unix/sysv/linux/i386/setfsgid.c: Likewise.
+
+2003-03-27  Philip Blundell  <philb@gnu.org>
+
+	* sysdeps/unix/sysv/linux/arm/sysdep.h (PSEUDO_RET_NOERRNO): Use
+	unconditional mov.  Remove nop.
+
+	* sysdeps/unix/sysv/linux/kernel-features.h
+	(__ASSUME_VFORK_SYSCALL): Define for kernel 2.4 on arm.
+	* sysdeps/unix/sysv/linux/arm/vfork.S: Elide compatibility code
+	when __ASSUME_VFORK_SYSCALL is defined.
+	* sysdeps/unix/sysv/linux/arm/mmap64.S: Likewise for
+	__ASSUME_MMAP2_SYSCALL.
+	* sysdeps/unix/sysv/linux/arm/sigaction.c: Likewise for
+	__ASSUME_REALTIME_SIGNALS.
+
+2003-03-26  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/ldsodefs.h (ELF_RTYPE_CLASS_COPY): Define to 2
+	only if DL_NO_COPY_RELOCS is not defined.
+	* sysdeps/ia64/dl-lookupcfg.h: Define DL_NO_COPY_RELOCS.
+
+2003-03-26  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/make-syscalls.sh: When an undefined syscall has
+	SOURCE=-, append its symbol names to make variable unix-stub-syscalls.
+	* sysdeps/unix/Makefile [$(subdir) = misc] [unix-stub-syscalls]
+	(sysdep_routines): Add stub-syscalls.
+	($(objpfx)stub-syscalls.c): New target.
+	(generated): Add stub-syscalls.c.
+
+	* tls.make.c: Also define use-tls according to USE_TLS macro.
+
+2003-03-26  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/alpha/bits/siginfo.h (struct siginfo): Avoid
+	no-op padding element.
+	* sysdeps/unix/sysv/linux/bits/siginfo.h: Likewise.
+	* sysdeps/unix/sysv/linux/ia64/bits/siginfo.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/bits/siginfo.h: Likewise.
+	* sysdeps/unix/sysv/linux/sparc/bits/siginfo.h: Likewise.
+
+2003-03-26  GOTO Masanori  <gotom@debian.or.jp>
+
+	* sysdeps/unix/sysv/linux/i386/getgroups.c: Fix the error
+	condition check for the return value of getgroups32.
+
+2003-03-26  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h (PSEUDO_NOERRNO):
+	Fix a typo.
+	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h (PSEUDO_NOERRNO,
+	PSEUDO_END_NOERRNO): Define.
+	* sysdeps/unix/sysdep.h (PSEUDO_END_NOERRNO): Fix a typo.
+	Define to PSEUDO_END.
+
+2003-03-26  Ulrich Drepper  <drepper@redhat.com>
+
+	* abilist/librt.abilist: Add new timer interfaces for 64-bit archs.
+
+2003-03-25  Jiro SEKIBA  <jir@yamato.ibm.com>
+
+	* iconvdata/euc-tw.c (from_euc_tw): Fix return value of TO_LOOP.
+	* iconvdata/bug-iconv4.c: New file.
+	* iconvdata/Makefile (tests): Add bug-iconv4.
+
+2003-03-25  H.J. Lu  <hjl@gnu.org>
+
+	* elf/dl-lookup.c (_dl_lookup_symbol): Avoid looking up protected
+	symbols twice.
+	(_dl_lookup_versioned_symbol): Likewise.
+
+2003-03-26  Jakub Jelinek  <jakub@redhat.com>
+
+	* csu/tst-atomic.c (do_test): Add some new
+	atomic_compare_and_exchange_val_acq, atomic_add_zero,
+	atomic_compare_and_exchange_bool_acq and atomic_add_negative tests.
+	* include/atomic.h (atomic_add_negative, atomic_add_zero):
+	Prefix local variable so that it doesn't clash with the one
+	in atomic_exchange_and_add.
+	* sysdeps/ia64/bits/atomic.h (atomic_exchange): Fix for long/void *
+	pointers.
+	(atomic_exchange_and_add): Implement using __sync_fetch_and_add_?i.
+	* sysdeps/powerpc/bits/atomic.h (atomic_exchange_and_add): Force
+	value into register.
+	* sysdeps/s390/bits/atomic.h (__arch_compare_and_exchange_val_64_acq):
+	Cast newval to long.
+	* sysdeps/x86_64/bits/atomic.h
+	(__arch_compare_and_exchange_val_64_acq): Cast newval and oldval to
+	long.
+	(atomic_exchange): Cast newvalue to long if sizeof == 8.
+	(atomic_exchange_and_add): Cast value to long if sizeof == 8.
+	(atomic_add, atomic_add_negative, atomic_add_zero): Likewise.
+	(atomic_bit_set): Shift 1L up in all cases to shut up warnings.
+
+2003-03-21  Martin Schwidefsky  <schwidefskyde.ibm.com>
+
+	* sysdeps/s390/s390-32/backtrace.c (__backtrace): Remove high order
+	bit from backtrace addresses.
+
+2003-03-21  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/unix/sysv/linux/i386/chown.c: Don't define any versioned
+	__chown symbols.
+
+2003-03-25  Roland McGrath  <roland@redhat.com>
+
+	* config.make.in (enable-check-abi): New variable from configure.
+	* configure.in (enable_check_abi): New substituted variable,
+	controlled by --{enable,disable}-check-abi (default yes).
+	* configure: Regenerated.
+	* Makerules [$(enable-check-abi) = yes] (tests): Put this condition
+	on check-abi dependency.
+
+2003-03-26  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/m68k/m68020/bits/atomic.h: Fix typos.
+	* include/atomic.h: Likewise.
+
+	* sysdeps/unix/sysv/linux/m68k/sysdep.h: Define ret_NOERRNO.
+
+2003-03-25  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/powerpc/bits/atomic.h (__arch_atomic_exchange_32): New macro.
+	(__arch_atomic_exchange_64): New macro.
+	(atomic_exchange): Use them.
+	(__arch_atomic_exchange_and_add_32): New macro.
+	(__arch_atomic_exchange_and_add_64): New macro.
+	(atomic_exchange_and_add): Use them.
+	Original patch from Steven Munroe <sjmunroe@us.ibm.com>.
+
+2003-03-25  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/sgidefs.h (_MIPS_ISA_MIPS32, _MIPS_ISA_MIPS64):
+	Define.
+	* sysdeps/mips/sys/asm.h: Test _MIPS_ISA against them on all
+	ISA tests.
+	(ALSZ, ALMASK, SZREG, REG_S, REG_L): Define based on ABI, not ISA.
+	(PTR_ADD, etc): Test _MIPS_SZPTR instead of _MIPS_SZLONG.
+	* sysdeps/unix/sysv/linux/mips/bits/sigaction.h: Use _MIPS_SZPTR
+	to decide whether to add padding.
+	* sysdeps/unix/sysv/linux/mips/bits/sigaction.h: Use _MIPS_SZPTR
+	to decide whether to add padding.
+	* sysdeps/unix/sysv/linux/mips/kernel_sigaction.h (struct
+	old_kernel_sigaction): Likewise.
+
+2003-03-25  Ulrich Drepper  <drepper@redhat.com>
+
+	* csu/tst-atomic.c: Adjust tests to what atomic_add_negative and
+	atomic_add_zero were supposed to do.
+	* include/atomic.h: Adjust atomic_add_negative and atomic_add_zero
+	to x86 behavior.
+
+	* sysdeps/generic/bits/typesizes.h (__TIMER_T_TYPE): Define as void*.
+	This matches the new timer implementation.
+	* sysdeps/unix/sysv/linux/sparc/bits/typesizes.h (__TIMER_T_TYPE):
+	Likewise.
+	* sysdeps/unix/sysv/linux/alpha/bits/typesizes.h (__TIMER_T_TYPE):
+	Likewise.
+	* sysdeps/unix/sysv/linux/bits/siginfo.h (struct siginfo): Adjust
+	timer info for what the kernel provides these days.
+	(struct sigevent): Add _tid field.
+	Define SIGEV_THREAD_ID.
+	Remove struct __pthread_attr_s forward declaration.
+	* sysdeps/unix/sysv/linux/alpha/bits/siginfo.h: Likewise.
+	* sysdeps/unix/sysv/linux/ia64/bits/siginfo.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/bits/siginfo.h: Likewise.
+	* sysdeps/unix/sysv/linux/sparc/bits/siginfo.h: Likewise.
+
+	* Versions.def (librt): Add GLIBC_2.3.3.
+
+	* abilist/libpthread.abilist: Update for nptl.
+
+2003-03-24  Jon Grimm  <jgrimm@us.ibm.com>
+
+	* inet/netinet/in.h: Add IPPROTO_SCTP.
+
+2003-03-24  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/sys/epoll.h (EPOLLET): Define.
+
+2003-03-24  Philip Blundell  <philb@gnu.org>
+
+	* sysdeps/unix/sysv/linux/arm/sysdep.h (INTERNAL_SYSCALL):
+	Remove a1 from clobber list.
+
+2003-03-24  Ulrich Drepper  <drepper@redhat.com>
+
+	* timezone/antarctica: Update from tzdata2003a.
+	* timezone/asia: Likewise.
+	* timezone/australasia: Likewise.
+	* timezone/europe: Likewise.
+	* timezone/iso3166.tab: Likewise.
+	* timezone/northamerica: Likewise.
+	* timezone/southamerica: Likewise.
+	* timezone/zone.tab: Likewise.
+
+2003-03-24  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/powerpc64/sysdep.h (PSEUDO_END_NOERRNO): Fix typo.
+
+2003-03-23  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/sysdep.h (ret_NOERRNO): Avoid
+	unwanted expansion by definining to ret.  Patch by Ian Wienand.
+
+	* sysdeps/unix/make-syscalls.sh: Recognize 'E' in first position of
+	the parameter description to denote no error checking.  Generate
+	appropriate pseudo asm code.
+	* sysdeps/unix/syscalls.list: Mark getgid, getpid, getuid with 'E'.
+	* sysdeps/unix/sysv/linux/syscalls.list: Mark getegid, geteuid,
+	getpgrp, and getppid with 'E'.
+	* sysdeps/powerpc/powerpc32/sysdep.h: Define PSEUDO_NOERRNO,
+	PSEUDO_END_NOERRNO, and ret_NOERRNO.
+	* sysdeps/powerpc/powerpc64/sysdep.h: Likewise.
+	* sysdeps/unix/sysdep.h: Likewise.
+	* sysdeps/unix/alpha/sysdep.h: Likewise.
+	* sysdeps/unix/sparc/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/arm/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/cris/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/hppa/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/i386/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/ia64/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/m68k/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/sh/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h: Likewise.
+	* sysdeps/unix/sysv/linux/x86_64/sysdep.h: Likewise.
+
+2003-03-23  Roland McGrath  <roland@redhat.com>
+
+	* Makeconfig (+includes): Don't use $(last-includes).
+
+2003-03-22  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/unix/sysv/linux/configure.in: Update mips64 patterns.
+	* sysdeps/unix/sysv/linux/configure: Rebuilt.
+
+2003-03-23  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/alpha/fpu/libm-test-ulps: Update.
+	* sysdeps/arm/libm-test-ulps: Update.
+	* sysdeps/hppa/fpu/libm-test-ulps: Update.
+	* sysdeps/ia64/fpu/libm-test-ulps: Update.
+	* sysdeps/mips/fpu/libm-test-ulps: Update.
+	* sysdeps/powerpc/nofpu/libm-test-ulps: Update.
+	* sysdeps/powerpc/fpu/libm-test-ulps: Update.
+	* sysdeps/sparc/sparc32/fpu/libm-test-ulps: Update.
+	* sysdeps/sparc/sparc64/fpu/libm-test-ulps: Update.
+	* sysdeps/sh/sh4/fpu/libm-test-ulps: Update.
+	* sysdeps/s390/fpu/libm-test-ulps: Update.
+	* sysdeps/x86_64/fpu/libm-test-ulps: Update.
+
+2003-03-22  Roland McGrath  <roland@redhat.com>
+
+	* include/atomic.h: Put parens around all macro arguments.
+	(__atomic_val_bysize, __atomic_bool_bysize): New macros.
+	(atomic_compare_and_exchange_val_acq): Use it.
+	(atomic_compare_and_exchange_bool_acq): Likewise.
+	(atomic_increment_and_test): Invert sense of test.
+	(atomic_decrement_and_test): Likewise.
+	* csu/tst-atomic.c: Update those tests to match.
+
+2003-03-22  Jakub Jelinek  <jakub@redhat.com>
+
+	* include/atomic.h (atomic_compare_and_exchange_val_acq): Add comment.
+	Don't define if __arch_compare_and_exchange_val_32_acq is not defined.
+	(atomic_compare_and_exchange_bool_acq): Add comment.  Don't use
+	__oldval variable in the macro, since it might be macro argument.
+	(atomic_decrement_if_positive): Initialize __memp, remove setting
+	of non-existent variable.
+	(atomic_bit_test_set): Cast 1 to __typeof (*mem) before shifting.
+	* sysdeps/ia64/bits/atomic.h (atomic_exchange_and_add): Implement
+	using atomic_compare_and_exchange_val_acq.
+	(atomic_decrement_if_positive, atomic_bit_test_set): Define.
+	* sysdeps/s390/bits/atomic.h (__arch_compare_and_exchange_val_8_acq):
+	Renamed from...
+	(__arch_compare_and_exchange_bool_8_acq): ... this.
+	(__arch_compare_and_exchange_val_16_acq): Renamed from...
+	(__arch_compare_and_exchange_bool_16_acq): ... this.
+	(__arch_compare_and_exchange_val_32_acq): Return old value.  Renamed
+	from...
+	(__arch_compare_and_exchange_bool_32_acq): ... this.
+	(__arch_compare_and_exchange_val_64_acq): Return old value.  Renamed
+	from...
+	(__arch_compare_and_exchange_bool_64_acq): ... this.
+	(__arch_compare_and_exchange_val_32_acq): Use __typeof for local
+	variables types instead of assuming int.
+	Change prefix of local variables to __arch.
+	* sysdeps/generic/bits/atomic.h (arch_compare_and_exchange_acq):
+	Remove.
+	(atomic_compare_and_exchange_val_acq,
+	atomic_compare_and_exchange_bool_acq): Define.
+
+	* csu/tst-atomic.c: New test.
+	* csu/tst-atomic-long.c: New test.
+	* csu/Makefile (tests): Add tst-atomic and tst-atomic-long.
+
+	* malloc/memusagestat.c (main): Kill warning if uint64_t is ulong.
+
+	* sysdeps/s390/Versions: Add trailing newline.
+
+	* sysdeps/unix/sysv/linux/sysconf.c (__sysconf): Kill warning
+	if INTERNAL_SYSCALL_ERROR_P doesn't use its first argument.
+
+2003-03-22  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/m68k/fpu/libm-test-ulps: Update.
+
+	* sysdeps/m68k/m68020/bits/atomic.h: New file.
+	* sysdeps/m68k/m68020/atomicity.h: Removed.
+
+2003-03-22  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/elf/ldsodefs.h: Add mips-specific elf64 relocation
+	data structures and macros.  Protect from multiple inclusion.
+
+	* sysdeps/mips/dl-machine.h (ELF_MIPS_GNU_GOT1_MASK): Fix harmless
+	typo in #if test.
+
+2003-03-21  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/i386/fpu/libm-test-ulps: Update.
+
+	* math/libm-test.inc (tgamma_test): Recompute some constants with
+	36 digits precision.
+	(lgamma_test): Likewise.
+	(ccos_test): Likewise.
+	(ccosh_test): Likewise.
+	(clog10_test): Likewise.
+	(csin_test): Likewise.
+	(csinh_test): Likewise.
+	(ctan_test): Likewise.
+	(ctanh_test): Likewise.
+
+2003-03-19  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/sparc/sparc64/fpu/libm-test-ulps: Regenerated.
+
+2003-03-21  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/i386/i486/bits/atomic.h (atomic_bit_set): Use "ir"
+	constraint to permit non-constant BIT argument.
+	(atomic_bit_test_set): Likewise.
+	* sysdeps/x86_64/bits/atomic.h (atomic_bit_test_set): Likewise.
+	(atomic_bit_set): Likewise.  Use 1UL in case that BIT might be >= 32.
+	For quadword case, use "i" constraint if __builtin_constant_p and < 32
+	or "r" constraint otherwise.
+
+	* configure.in: Move AC_PROG_CC and other program-finding before all
+	the version checks.
+	* configure: Regenerated.
+
+2003-03-21  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/mips64/memcpy.S: Fix porting bug that broke
+	unaligned copying of 8-15 bytes.  From Chris Demetriou
+	<cgd@broadcom.com>.  Fix label names.
+	* sysdeps/mips/mips64/memset.S: Fix label names.  Make similar
+	change as to memcpy.S.
+	* sysdeps/mips/memcpy.S: Formatting changes.
+	* sysdeps/mips/memset.S: Likewise.
+
+2003-03-21  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/arm/sysdep.h (CALL_MCOUNT): Add trailing semicolon.
+
+2003-03-21  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/mips64/memcpy.S, sysdeps/mips/mips64/memset.S: New.
+	* sysdeps/mips/memcpy.S, sysdeps/mips/memset.S: Update comments.
+
+2003-03-21  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/i386/i486/bits/atomic.h
+	(__arch_compare_and_exchange_val_64_acq): Rewrite abort-calling
+	version of the macro to avoid compile-time warnings.
+	[! __PIC__] (__arch_compare_and_exchange_64_acq): Rename to above.
+	(atomic_exchange_and_add, atomic_add): Fix name and usage of it.
+	(atomic_increment, atomic_decrement): Likewise.
+
+2003-03-21  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/x86_64/bits/atomic.h: Don't use matching memory constraints.
+	* sysdeps/i386/i486/bits/atomic.h: Likewise.
+
+2003-03-21  Roland McGrath  <roland@redhat.com>
+
+	* include/atomic.h (atomic_compare_and_exchange_bool_acq): Typo fix.
+
+2003-03-20  Ulrich Drepper  <drepper@redhat.com>
+
+	* include/atomic.h: Define atomic_compare_and_exchange_val_acq,
+	atomic_compare_and_exchange_val_rel,
+	atomic_compare_and_exchange_bool_acq, and
+	atomic_compare_and_exchange_bool_rel instead of
+	atomic_compare_and_exchange_acq and atomic_compare_and_exchange_rel.
+	* sysdeps/i386/i486/bits/atomic.h: Define
+	__arch_compare_and_exchange_val_*_acq instead of
+	__arch_compare_and_exchange_*_acq.
+	* sysdeps/x86_64/bits/atomic.h: Likewise.
+	* sysdeps/ia64/bits/atomic.h: Define
+	__arch_compare_and_exchange_bool_*_acq instead of
+	__arch_compare_and_exchange_*_acq.
+	* sysdeps/powerpc/bits/atomic.h: Likewise.
+	* sysdeps/s390/bits/atomic.h: Likewise.
+	* gmon/mcount.c: Adjust for new form of compare&exchange macros.
+	* malloc/set-freeres.c: Likewise.
+	* nscd/cache.c: Likewise.
+	* stdlib/cxa_finalize.c: Likewise.
+	* sysdeps/unix/sysv/linux/getsysstats.c: Likewise.
+
+2003-03-20  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/bits/setjmp.h: n32 has only 6 call-saved fpregs.
+	* sysdeps/mips/mips64/setjmp_aux.c (__sigsetjmp_aux): Adjust.
+	* sysdeps/mips/mips64/__longjmp.c (__longjmp): Likewise.
+
+	* sysdeps/unix/sysv/linux/mips/pread.c: Don't break up offset
+	into high and low halves on n64.
+	* sysdeps/unix/sysv/linux/mips/pread64.c: Likewise.
+	* sysdeps/unix/sysv/linux/mips/pwrite.c: Likewise.
+	* sysdeps/unix/sysv/linux/mips/pwrite64.c: Likewise.
+
+2003-03-20  Ulrich Drepper  <drepper@redhat.com>
+
+	* include/atomic.h (atomic_decrement_if_positive): Adjust for the
+	correct atomic_compare_and_exchange_acq semantics.
+
+2003-03-20  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/ieee754.h: Remove excess #endif.
+
+2003-03-20  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/powerpc/bits/atomic.h (atomic_exchange): Remove unused
+	variable.  Remove superfluous memory clobber.
+
+	* include/atomic.h: Syntax braino fix.
+
+	* posix/tst-nice.c (do_test): Use %m formats instead of printing errno
+	in decimal.  Don't bail if niced at start.  Just check that nice call
+	bumps the total at all.
+
+2003-03-20  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/bits/setjmp.h: Store all N32 and N64 registers,
+	including pc, gp, sp and fp, as long long.
+	* sysdeps/mips/mips64/setjmp.S: Pass gp to __sigsetjmp_aux.
+	* sysdeps/mips/mips64/setjmp_aux.c: Adjust type of arguments.
+	Add gp argument, and set gp in the jmpbuf to it.
+	* sysdeps/mips/setjmp_aux.c: Revert to o32-only.
+
+2003-03-20  Ulrich Drepper  <drepper@redhat.com>
+
+	* include/atomic.h: Define atomic_exchange and
+	atomic_decrement_if_positive if not already defined.  Add some
+	__builtin_expect.
+	* sysdeps/i386/i486/bits/atomic.h: Define atomic_exchange.
+	* sysdeps/x86_64/bits/atomic.h: Likewise.
+	* sysdeps/ia64/bits/atomic.h: Pretty printing.  Define atomic_exchange.
+	* sysdeps/powerpc/bits/atomic.h: Pretty printing.  Define
+	atomic_exchange, atomic_exchange_and_add, and
+	atomic_decrement_if_positive
+
+2003-03-20  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S: Sign-extend
+	with a single instruction.
+
+	* sysdeps/mips/dl-machine.h (ELF_MIPS_GNU_GOT1_MASK): Define
+	properly for n64.
+	(elf_machine_runtime_setup): Cast link_map pointer to Elf Addr
+	type.
+	(elf_machine_rel, elf_machine_rel_relative): Cast symidx to Elf
+	Word before comparing with gotsym.  Take reloc_addr argument as
+	void*.  Remove the code added for the compiler to drop any
+	alignment assumptions.
+
+2003-03-19  Ulrich Drepper  <drepper@redhat.com>
+
+	* Makefile (distribute): Add include/atomic.h and bits/atomic.h.
+	* include/atomic.h: New file.
+	* sysdeps/i386/i486/bits/atomic.h: New file.
+	* sysdeps/x86_64/bits/atomic.h: New file.
+	* sysdeps/s390/bits/atomic.h: New file.
+	* sysdeps/sh/bits/atomic.h: New file.
+	* sysdeps/ia64/bits/atomic.h: New file.
+	* sysdeps/powerpc/bits/atomic.h: New file.
+	* sysdeps/generic/bits/atomic.h: New file.
+	* sysdeps/i386/i486/atomicity.h: Removed.
+	* sysdeps/x86_64/atomicity.h: Removed.
+	* sysdeps/s390/s390-32/atomicity.h: Removed.
+	* sysdeps/s390/s390-64/atomicity.h: Removed.
+	* sysdeps/ia64/atomicity.h: Removed.
+	* sysdeps/powerpc/powerpc32/atomicity.h: Removed.
+	* sysdeps/powerpc/powerpc64/atomicity.h: Removed.
+	* elf/dl-profile.c: Use atomic.h instead of atomicity.h.  Adjust
+	use of macros from atomicity.h to new names and semantics.
+	* gmon_mcount.c: Likewise.
+	* malloc/set-freeres.c: Likewise.
+	* nscd/cache.c: Likewise.
+	* stdlib/cxa_finalize.c: Likewise.
+	* sysdeps/unix/sysv/linux/getsysstats.c: Likewise.
+
+2003-03-19  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/ieee754.h: New file, suitable to replace both
+	../ieee754/ieee754.h and ../ieee754/ldbl-128/ieee754.h, kept
+	mips-specific for now.
+
+2003-03-19  Ulrich Drepper  <drepper@redhat.com>
+
+	* stdlib/strtod.c (INTERNAL): While eating trailing zeros handle
+	hexdigits correctly.  Reported by Fred Tydeman <tydeman@tybor.com>.
+	* stdlib/tst-strtod.c: Add test for the bug.
+
+	* posix/tst-nice.c (do_test): Remove invalid of return value.
+	Don't run test if initial level != 0.
+
+2003-03-19  Amos Waterland  <apw@us.ibm.com>
+
+	* posix/tst-nice.c: New file.
+	* posix/Makefile (tests): Add tst-nice.
+
+2003-03-18  Roland McGrath  <roland@redhat.com>
+
+	* abilist: New directory of libfoo.abilist files maintained using
+	scripts/merge-abilist.awk and "make update-abi" rules.
+	* Makefile (distribute): Add abilist/*.abilist.
+	* Makerules [$(build-shared) = yes] [$(subdir)] (tests):
+	Depend on check-abi.
+
+	* configure.in: Move $critic_missing check after all AC_CHECK_PROG_VER.
+	* configure: Regenerated.
+
+	* sysdeps/unix/sysv/linux/syscalls.list (posix_fadvise64): Fix name.
+
+2003-03-18  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/posix/sysconf.c (__sysconf): Handle _SC_MONOTONIC_CLOCK
+	correctly.
+
+2003-03-18  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/powerpc64/memcpy.S: New file.
+
+2003-03-18  Ulrich Drepper  <drepper@redhat.com>
+
+	* Versions.def: Add GLIBC_2.3.3 for libpthread.
+
+2003-03-17  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/libc-start.c [!SHARED &&
+	!LIBC_START_MAIN_AUXVEC_ARG]: Compute beginning of auxvec correctly.
+
+2003-03-17  Roland McGrath  <roland@redhat.com>
+
+	* include/ctype.h: Revert last change.
+
+2003-03-17  Ulrich Drepper  <drepper@redhat.com>
+
+	* argp/tst-argp1.c: Use test-skeleton.c.
+	* locale/tst-C-locale.c: Likewise.
+
+2003-03-17  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/mips64/Implies: Move wordsize-64 to...
+	* sysdeps/mips/mips64/n64/Implies: New file.
+	* sysdeps/mips/mips64/n64/Makefile: New file.
+	* sysdeps/mips/mips64/n64/el/bits/endian.h: New file.
+	* sysdeps/mips/mips64/n32/Implies: New file.
+	* sysdeps/mips/mips64/n32/Makefile: New file.
+	* sysdeps/mips/mips64/n32/el/bits/endian.h: New file.
+	* sysdeps/unix/mips/mips64/n32/sysdep.h: New file.
+	* sysdeps/unix/mips/mips64/n64/sysdep.h: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/n32/sysdep.h: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/n64/glob64.c: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/n64/sysdep.h: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/ldconfig.h: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/llseek.c: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/recv.c: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/send.c: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/syscall.S: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/syscalls.list: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/umount.c: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S: New file.
+
+	* sysdeps/unix/sysv/linux/configure.in (libc_cv_slibdir): Use
+	lib64 for mips64/n64 and lib32 for mips64/n32.
+	(ldd_rewrite_script): Needed for all mips64 configurations.
+	* sysdeps/unix/sysv/linux/configure: Rebuilt.
+	* sysdeps/unix/sysv/linux/mips/mips64/ldd-rewrite.sed: New file.
+	* sysdeps/unix/sysv/linux/mips/mips64/Dist: New file.
+
+	* sysdeps/mips/machine-gmon.h (MCOUNT): Define for N32 and N64 as
+	well.
+
+	* sysdeps/unix/sysv/linux/mips/configure.in: New.  Pre-process
+	asm/unistd.h into asm-unistd.h.
+	* sysdeps/unix/sysv/linux/mips/configure: Generated.
+	* sysdeps/unix/sysv/linux/mips/Makefile: Do custom processing
+	of syscall list.
+	* sysdeps/unix/sysv/linux/mips/sys/syscall.h: New file.
+	* sysdeps/unix/sysv/linux/mips/clone.S: Don't include
+	asm/unistd.h.
+
+	* sysdeps/unix/sysv/linux/mips/sys/ptrace.h: New file.
+	* sysdeps/unix/sysv/linux/mips/ptrace.c: New file.  Use long
+	long type for registers on n32.
+
+	* sysdeps/mips/bits/wordsize.h: New file, appropriate for all
+	3 ABIs.
+	* sysdeps/mips/mips64/gmp-mparam.h: New file.  Define
+	BITS_PER_LONGINT to __WORDSIZE, to match all 3 ABIs.
+	* sysdeps/mips/setjmp_aux.c (STRINGXP, REGS, PTRS): New macros.
+	(__sigsetjmp_aux): Use them.  Adjust for all 3 ABIs.
+	* sysdeps/mips/elf/start.S: Adjust for all 3 ABIs.
+	* sysdeps/unix/mips/brk.S: Likewise.
+	* sysdeps/unix/mips/sysdep.S: Likewise.
+	* sysdeps/unix/sysv/linux/mips/clone.S: Likewise.
+	* sysdeps/mips/bits/setjmp.h (__jmp_buf): Likewise.
+	* sysdeps/mips/sys/ucontext.h: Likewise.
+	* sysdeps/unix/sysv/linux/mips/sys/profcs.h: Likewise.
+	* sysdeps/unix/sysv/linux/mips/sys/ucontext.h: Likewise.
+	* sysdeps/unix/sysv/linux/mips/kernel_stat.h: Likewise.
+	* sysdeps/mips/mips64/bsd-_setjmp.S: Likewise.
+	* sysdeps/mips/mips64/bsd-setjmp.S: Likewise.
+	* sysdeps/mips/mips64/setjmp.S: Likewise.
+	* sysdeps/mips/mips64/bits/setjmp.h: Deleted, obsolete.
+	* sysdeps/mips/mips64/soft-fp/sfp-machine.h: Use long long for
+	64-bit types.
+
+2003-03-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/clock_settime.c (HANDLE_REALTIME): Define tv here,
+	not at function level.
+	* sysdeps/unix/clock_gettime.c (HANDLE_REALTIME): Likewise.
+
+2003-03-15  Roland McGrath  <roland@redhat.com>
+
+	* nis/nss_nis/nis-hosts.c (internal_gethostbyname2_r): int -> size_t
+	* nis/nss_nis/nis-network.c (_nss_nis_getnetbyname_r): Likewise.
+	* nis/nss_nis/nis-alias.c (_nss_nis_getaliasbyname_r): Likewise.
+	* nis/nis_table.c (__create_ib_request): Likewise.
+
+	* posix/fnmatch_loop.c: Add casts for signedness.
+	* nss/nss_files/files-hosts.c: Likewise.
+	* nscd/nscd_getpw_r.c (nscd_getpw_r): Likewise.
+	* gmon/gmon.c (write_call_graph): Use u_long for FROM_LEN.
+	* nscd/nscd_getgr_r.c (nscd_getgr_r): Use nscd_ssize_t for CNT.
+
+	* configure.in (libc_cv_visibility_attribute): Use AC_TRY_COMMAND,
+	get errors into the log file.
+	(libc_cv_broken_visibility_attribute): Likewise.
+	(libc_cv_broken_alias_attribute): Likewise.
+	(libc_cv_asm_weak_directive): Likewise.
+	(libc_cv_need_minus_P): Likewise.
+	(libc_cv_dot_text): Likewise.
+	(libc_cv_asm_global_directive): Likewise.
+	(libc_cv_asm_type_prefix): Likewise.
+	* configure: Regenerated.
+
+	* nscd/cache.c (cache_search): Give first arg type `request_type'.
+	* nscd/nscd.h: Update decl.
+
+	* nscd/nscd_getpw_r.c (nscd_getpw_r): Add casts for signedness.
+	* nscd/nscd_getgr_r.c (nscd_getgr_r): Likewise.
+	* elf/dl-close.c (_dl_close): Likewise.
+	* sysdeps/unix/sysv/linux/powerpc/chown.c (__chown): int -> size_t
+	* io/fts.c (fts_build): Likewise.
+	* elf/cache.c (add_to_cache): Likewise.
+	* locale/programs/locarchive.c (show_archive_content): Likewise.
+
+	* posix/fnmatch.c (fnmatch): Tweak __builtin_expect use.
+
+	* include/ctype.h (__ctype_b_loc): Tweak type punning to make gcc 3.3
+	happy.
+	(__ctype_toupper_loc, __ctype_tolower_loc): Likewise.
+
+2003-03-15  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/system.c: Use the generic Linux
+	code for most parts.
+
+2003-03-15  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/sysv/linux/i386/system.c: Moved to ...
+	* sysdeps/unix/sysv/linux/system.c: ... here.
+	(FORK): Don't #define if already #define'd.
+	* sysdeps/unix/sysv/linux/s390/system.c: File removed.
+	* sysdeps/unix/sysv/linux/kernel-features.h [__powerpc__]:
+	(__ASSUME_CLONE_THREAD_FLAGS): Define for kernel >= 2.5.64.
+
+	* dlfcn/tst-dlinfo.c: New file.
+	* dlfcn/Makefile (tests): Add tst-dlinfo.
+	($(objpfx)tst-dlinfo): New target.
+
+	* dlfcn/dlinfo.c: New file.
+	* dlfcn/Makefile (libdl-routines): Add it.
+	* dlfcn/Versions (libdl: GLIBC_2.3.3): Add dlinfo.
+	* dlfcn/dlfcn.h [__USE_GNU]: Declare dlinfo.
+	[__USE_GNU] (RTLD_DI_*): New enum constants.
+	[__USE_GNU] (Dl_serpath, Dl_serinfo): New types.
+	* elf/dl-load.c (cache_rpath): New inline function.
+	(_dl_map_object): Use it.
+	(_dl_rtld_di_serinfo): New function.
+	* sysdeps/generic/ldsodefs.h: Declare it.
+	* elf/Versions (ld: GLIBC_PRIVATE): Add it.
+
+	* sysdeps/powerpc/elf/libc-start.c (AUX_VECTOR_INIT): Define it.
+	(LIBC_START_MAIN, LIBC_START_MAIN_AUXVEC_ARG, MAIN_AUXVEC_ARG)
+	(INIT_MAIN_ARGS): Define, and #include <sysdeps/generic/libc-start.c>.
+	(__libc_start_main): Just call the generic one for most of the work.
+
+	* sysdeps/generic/libc-start.c [LIBC_START_MAIN]: If defined, define a
+	static function by that name instead of BP_SYM (__libc_start_main).
+	[LIBC_START_MAIN_AUXVEC_ARG]: Take AUXVEC as argument.
+	[MAIN_AUXVEC_ARG]: Pass 4th argument to MAIN.
+	[INIT_MAIN_ARGS]: Give INIT the same args as MAIN.
+
+	* sysdeps/generic/dl-sysdep.c (_dl_sysdep_start) [DL_PLATFORM_AUXV]:
+	Use this macro for extra AT_* cases.
+	* sysdeps/unix/sysv/linux/powerpc/dl-sysdep.c (DL_PLATFORM_AUXV):
+	New macro, guts from ...
+	(__aux_init_cache): ... here, function removed.
+	(DL_PLATFORM_INIT): Don't define this.
+
+	* sysdeps/powerpc/powerpc32/memset.S: Put __cache_line_size in bss.
+	* sysdeps/powerpc/powerpc64/memset.S: Likewise.
+
+	* Versions.def (libthread_db): Add GLIBC_2.3.3 set.
+
+2003-03-14  Roland McGrath  <roland@redhat.com>
+
+	* dlfcn/dlerror.c (dlerror): If objname is "", don't put ": " after it.
+
+2003-03-14  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/Makefile (syscall-%.h): Fix a typo.
+
+	* sysdeps/unix/sysv/linux/sparc/sparc64/pause.c: Include
+	sysdeps/posix/pause.c instead of sysdeps/unix/common/pause.c.
+
+2003-03-14  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/fpu/bits/mathdef.h: New.
+	(__NO_LONG_DOUBLE_MATH): Define for o32.
+
+	* sysdeps/mips/sys/asm.h: Formatting changes.
+	(PTR, PTRSIZE, PTRLOG): Adjust for all 3 ABIs.
+	(CPADD): Define for all of them.
+	(SETUP_GP, SETUP_GPX, SETUP_GPX_L, SAVE_GP, SETUP_GP64,
+	SETUP_GPX64, SETUP_GPX64_L, RESTORE_GP64, USE_ALT_CP,
+	NARGSAVE): Define per ABI spec.
+	(END): Don't redefine.
+	(LONG_SLL, LONG_SLLV, LONG_SRL, LONG_SRLV, LONG_SRA,
+	LONG_SRAV): Remove duplicate definitions.
+	(PTR_ADD, PTR_ADDI, PTR_ADDU, PTR_ADDIU, PTR_SUB, PTR_SUBI,
+	PTR_SUBU, PTR_SUBIU, PTR_L, PTR_S, PTR_SLL, PTR_SLLV, PTR_SRL,
+	PTR_SRLV, PTR_SRA, PTR_SRAV, PTR_SCALESHIFT): Define for n32.
+	(PTR_LA): Define for all 3 ABIs.
+
+	* sysdeps/mips/dl-machine.h: Include sys/asm.h.
+	(elf_machine_matches_host): Prevent linking of o32 and n32
+	together.
+	(elf_machine_dynamic): Document assumption on $gp.
+	(STRINGXP, STRINGXV, STRINGV_): New macros.
+	(elf_machine_load_address): Use them to stringize PTR_LA and
+	PTR_SUBU.
+	(ELF_DL_FRAME_SIZE, ELF_DL_SAVE_ARG_REGS,
+	ELF_DL_RESTORE_ARG_REGS, IFABIO32): New macros used in...
+	(_dl_runtime_resolve): Adjust it for all 3 ABIs.
+	(__dl_runtime_resolve): Cast the symtab initializer to the
+	right type.
+	(RTLD_START): Use it.  Adjust it for all 3 ABIs.
+	(elf_machine_rel): Mark as always_inline in RTLD_BOOTSTRAP.
+	Handle 64-bit R_MIPS_REL composite relocation and accept
+	R_MIPS_64 relocations to shift addend size to 64 bits.
+	Document assumption regarding local GOT entries.  Document
+	backward-compatibility departing from the ABI behavior in
+	applying relocations that reference section symbols, no longer
+	used.  Support relocations to mis-aligned offsets.
+	* sysdeps/mips/mips64/dl-machine.h: Deleted, obsolete.
+
+	* sysdeps/unix/sysv/linux/mips/readelflib.c: New file.
+
+	* sysdeps/unix/sysv/linux/mips/kernel_sigaction.h
+	(_KERNEL_NSIG_BPW): Define in terms of _MIPS_SZLONG.
+	* sysdeps/unix/sysv/linux/mips/sigaction.c: Define restore and
+	restore_rt functions.  Use them.
+
+	* sysdeps/unix/sysv/linux/mips/sys/tas.h (_test_and_set): Don't
+	.set mips2 on new abis.
+
+2003-03-13  Ulrich Drepper  <drepper@redhat.com>
+
+	* posix/getconf.c: Recognize POSIX2_SYMLINKS.
+	* sysdeps/generic/bits/confname.h: Define _PC_2_SYMLINKS.
+	* sysdeps/posix/fpathconf.c: Handle _PC_2_SYMLINKS.
+	* sysdeps/posix/pathconf.c: Likewise.
+	* sysdeps/unix/sysv/linux/fpathconf.c: Likewise.
+	* sysdeps/unix/sysv/linux/pathconf.c: Likewise.
+	* sysdeps/unix/sysv/linux/pathconf.h: Define statfs_symlinks.
+
+	* sysdeps/unix/sysv/linux/linux_fsinfo.h: Define some more magic
+	words.
+
+2003-03-14  Alexandre Oliva  <aoliva@redhat.com>
+
+	* include/gmp.h: Include/gmp-mparam.h.
+	* stdlib/strtod.c: Include gmp-mparam.h before gmp.h and
+	gmp-impl.h.
+
+	* elf/dl-conflict.c: Don't compile _dl_resolve_conflicts if
+	ELF_MACHINE_NO_RELA is set.
+	* elf/rtld.c (dl_main): No prelink support for REL-only.
+
+	* sysdeps/generic/ldconfig.h (FLAG_MIPS64_LIBN32,
+	FLAG_MIPS64_LIBN64): Define.
+	* elf/cache.c (print_entry): Handle mips64 n32 and n64.
+
+	* sysdeps/mips/memcpy.S: Map t0-3 to a4-7 on new abis.
+	* sysdeps/mips/memset.S: Likewise.
+	* sysdeps/mips/sys/regdef.h: Alias a4-7 or t0-3 to $8-11
+	depending on the ABI.
+
+	* sysdeps/mips/atomicity.h (exchange_and_add, atomic_add):
+	Don't .set mips2 on new abi.
+	(compare_and_swap): Likewise.  Support 64-bit longs on n64.
+
+	* stdlib/fpioconst.h: Include gmp.h with angle brackets.
+
+2003-03-13  Roland McGrath  <roland@redhat.com>
+
+	* elf/dl-load.c (_dl_map_object_from_fd): Bail if no PT_LOAD phdrs
+	found.  Reported by Alexandre Oliva <aoliva@redhat.com>.
+
+2003-03-13  Alexandre Oliva  <aoliva@redhat.com>
+
+	* stdio-common/_itoa.c (_itoa_base_table): Make 64-bit
+	literals long long.
+	* stdlib/fpioconst.c: Likewise.
+	* stdlib/strtod.c: Likewise.
+
+	* sysdeps/mips/add_n.S: Use L macro for local labels.
+	* sysdeps/mips/addmul_1.S: Likewise.
+	* sysdeps/mips/lshift.S: Likewise.
+	* sysdeps/mips/memcpy.S: Likewise.
+	* sysdeps/mips/memset.S: Likewise.
+	* sysdeps/mips/mul_1.S: Likewise.
+	* sysdeps/mips/rshift.S: Likewise.
+	* sysdeps/mips/sub_n.S: Likewise.
+	* sysdeps/mips/submul_1.S: Likewise.
+	* sysdeps/mips/mips64/add_n.S: Likewise.
+	* sysdeps/mips/mips64/addmul_1.S: Likewise.
+	* sysdeps/mips/mips64/lshift.S: Likewise.
+	* sysdeps/mips/mips64/mul_1.S: Likewise.
+	* sysdeps/mips/mips64/rshift.S: Likewise.
+	* sysdeps/mips/mips64/sub_n.S: Likewise.
+	* sysdeps/mips/mips64/submul_1.S: Likewise.
+	* sysdeps/unix/mips/sysdep.h: Define L() according to ABI
+	conventions.  Define END as in sys/asm.h.
+	* sysdeps/unix/mips/sysdep.S: Likewise.
+	* sysdeps/unix/mips/wait.S: Likewise.
+	* sysdeps/unix/sysv/linux/mips/clone.S: Likewise.
+
+	* sysdeps/ieee754/dbl-64/dbl2mpn.c (__mpn_extract_double):
+	Cast shifted values that may be too narrow to mp_limb_t.
+	* sysdeps/ieee754/dbl-64/mpn2dbl.c (__mpn_construct_double):
+	Likewise.
+	* sysdeps/ieee754/flt-32/mpn2flt.c (__mpn_construct_float):
+	Likewise.
+	* sysdeps/ieee754/ldbl-128/ldbl2mpn.c
+	(__mpn_extract_long_double): Likewise.
+	* sysdeps/ieee754/ldbl-128/mpn2ldbl.c
+	(__mpn_construct_long_double): Likewise.
+	* sysdeps/ieee754/ldbl-96/ldbl2mpn.c
+	(__mpn_extract_long_double): Likewise.
+	* sysdeps/ieee754/ldbl-96/mpn2ldbl.c
+	(__mpn_construct_long_double): Likewise.
+
+2003-03-13  Roland McGrath  <roland@redhat.com>
+
+	* elf/Makefile ($(objpfx)librtld.mk): Tweak regexp so that one-line
+	entries in the map file match too.
+
+2003-03-13  Guido Guenther  <agx@sigxcpu.org>
+
+	* sysdeps/unix/sysv/linux/mips/clone.S: introduce and use local
+	label .Lthread_start since current binutils don't allow branches
+	to globally visible symbols.
+
+2003-03-13  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/sysdep.h (BREAK_INSN_1, BREAK_INSN,
+	ASM_OUTARGS_0, ASM_OUTARGS_1, ASM_OUTARGS_2, ASM_OUTARGS_3,
+	ASM_OUTARGS_4, ASM_OUTARGS_5, ASM_OUTARGS_6): Define.
+	(INTERNAL_SYSCALL, INLINE_SYSCALL): Use it.  Make syscall arguments
+	clobbered by the syscall.
+	(ASM_ARGS_1, ASM_ARGS_2, ASM_ARGS_3, ASM_ARGS_4, ASM_ARGS_5,
+	ASM_ARGS_6): Change constraints from r to index of corresponding
+	output register.
+	* sysdeps/unix/sysv/linux/ia64/clone2.S (__clone2): Swap
+	ptid and ctid to match kernel.
+	* sysdeps/unix/sysv/linux/ia64/system.c (FORK): Likewise.
+
+2003-03-12  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/powerpc64/elf/configure.in: Remove
+	AC_DEFINE(PI_STATIC_AND_HIDDEN).  Not supported for PowerPC64.
+	* sysdeps/powerpc/powerpc64/elf/configure: Regenerated.
+
+2003-03-11  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_rela):
+	Check SYM_MAP rather than SYM as definedness check.
+	Handle R_PPC64_ADDR32, R_PPC64_ADDR30, and R_PPC64_REL64 relocs.
+	Don't handle R_PPC64_REL24 reloc.
+	Mostly from Steven Munroe <sjmunroe@us.ibm.com>.
+
+	* sysdeps/powerpc/powerpc64/dl-machine.h
+	[USE_TLS] (elf_machine_type_class): Match all the TLS relocs in a
+	block, so we cover all the TPREL16* flavors without 6 ||s.
+	[USE_TLS] (elf_machine_tprel): New function.
+	(elf_machine_rela) [USE_TLS]: Use elf_machine_tprel for TPREL64 reloc,
+	and handle TPREL16 relocs too.  Return rather than break for DTPREL64.
+	Mostly from Steven Munroe <sjmunroe@us.ibm.com>.
+
+2003-03-11  Ralf Baechle  <ralf@linux-mips.org>
+
+	* sysdeps/unix/sysv/linux/mips/clone.S (__thread_start): Use jal
+	instead of jalr to invoke subroutine so restoring the $gp register
+	will work properly.
+
+2003-03-11  Martin Schwidefsky  <schwidefsky@de.ibm.com>
+
+	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h (__NR_pread64): Define
+	to __NR_pread if not defined.
+	(__NR_pwrite64): Define to __NR_pwrite if not defined.
+
+2003-03-11  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/system.c: New file.
+	* sysdeps/unix/sysv/linux/kernel-features.h
+	(__ASSUME_CLONE_THREAD_FLAGS): Define for IA-64 and s390* with
+	kernel >= 2.5.64.
+
+2003-03-11  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/generic/dl-sysdep.c (_dl_important_hwcaps): If CNT == 1,
+	allocate space even for the trailing '/'.
+	Reported by John Reiser <jreiser@BitWagon.com>.
+
+	* sysdeps/unix/sysv/linux/ia64/sysdep.h (LOAD_ARGS_6, ASM_ARGS_6,
+	ASM_CLOBBERS_6): Define.
+	(ASM_CLOBBERS_5): Use ASM_CLOBBERS_6.
+	* sysdeps/unix/sysv/linux/ia64/clone2.S (__clone2): Reorder arguments
+	to match IA-32 order.
+	* sysdeps/unix/sysv/linux/i386/clone.S: Fix comment.
+
+2003-03-10  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/unix/sysv/linux/powerpc/powerpc64/clone.S: Don't clobber R7.
+	Copy extra params for NPTL to registers used in clone syscall.
+
+2003-03-10  Martin Schwidefsky  <schwidefsky@de.ibm.com>
+
+	* sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list: Correct system
+	call names for pread and pwrite.
+
+2003-03-10  Roland McGrath  <roland@redhat.com>
+
+	* dlfcn/Makefile (libdl-routines): Add dladdr1.
+	* dlfcn/dladdr1.c: New file.
+	* dlfcn/dlfcn.h [__USE_GNU]: Declare dladdr1.
+	[__USE_GNU] (RTLD_DL_SYMENT, RTLD_DL_LINKMAP): New enum constants.
+	* elf/dl-addr.c (_dl_addr): Take new args, a struct link_map ** and
+	a const ElfNN_Sym ** to fill in.
+	* include/dlfcn.h: Update decl.  Include <link.h>.
+	* dlfcn/dladdr.c (dladdr): Update caller.
+	* malloc/mtrace.c (tr_where): Likewise.
+	* sysdeps/generic/elf/backtracesyms.c: Likewise.
+	* sysdeps/generic/elf/backtracesymsfd.c: Likewise.
+	* dlfcn/Versions (libdl: GLIBC_2.3.3): New set, add dladdr1.
+	* Versions.def (libdl): Define GLIBC_2.3.3 set.
+
+	* sysdeps/unix/make-syscalls.sh: Generate $(compile-syscall) for
+	assembler command.
+	* sysdeps/unix/Makefile (compile-syscall): New variable.
+	Pass -g0 to compiler for assembling syscall stubs from stdin.
+
+	* sysdeps/i386/sysdep.h [HAVE_CPP_ASM_DEBUGINFO]
+	(STABS_CURRENT_FILE, STABS_CURRENT_FILE1, STABS_FUN, STABS_FUN_END):
+	Define these to do nothing.
+
+	* configure.in: New check for -g on .S files.
+	* configure: Regenerated.
+	* config.make.in (have-cpp-asm-debuginfo): New variable.
+	* config.h.in (HAVE_CPP_ASM_DEBUGINFO): New #undef.
+	* Makeconfig (ASFLAGS): New variable, if undefined and
+	$(have-cpp-asm-debuginfo), take options matching -g% from $(CFLAGS).
+	* Makerules (compile.S, COMPILE.S): Use $(ASFLAGS).
+
+2003-03-09  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S: Take 3 new args
+	used by NPTL on new kernels.  From Paul Mackerras <paulus@samba.org>.
+
+2003-03-09  Ulrich Drepper  <drepper@redhat.com>
+
+	* po/fi.po: Update from translation team.
+	* po/ca.po: Likewise.
+	* po/da.po: Likewise.
+
+2003-03-08  Ulrich Drepper  <drepper@redhat.com>
+
+	* rt/tst-aio7.c (do_test): Change BYTES into a #define.
+
+2003-03-07  Ulrich Drepper  <drepper@redhat.com>
+
+	* rt/tst-aio7.c (do_test): Give BUFF permanent extent, too.
+
+	* sysdeps/powerpc/fpu/w_sqrt.c: Fix comment.
+
+2003-03-07  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/s390/s390-32/sysdep.h (L): Use .Lfoo instead of foo.
+	* sysdeps/s390/s390-64/sysdep.h (L): Likewise.
+
+2003-03-04  Guido Guenther  <agx@sigxcpu.org>
+
+	* sysdeps/unix/sysv/linux/mips/syscalls.list: Remove unneeded
+	stubs, we have INLINE_SYSCALL.
+	* sysdeps/unix/sysv/linux/mips/bits/mman.h: Define MAP_POPULATE,
+	MAP_NONBLOCK.
+
+2003-03-06  Roland McGrath  <roland@redhat.com>
+
+	* rt/tst-aio7.c (do_test): Revert last change.  Instead, give CB1
+	permanent extent and add a comment about testing its implicit teardown.
+
+2003-03-06  Martin Schwidefsky  <schwidefsky@de.ibm.com>
+
+	* rt/tst-aio7.c (do_test): Cancel i/o on CB1 before it's out of scope.
+
+2003-03-05  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/dl-tls.c (_dl_allocate_tls_storage): Fix
+	reversed __builtin_expect expectation.
+
+2003-03-05  Roland McGrath  <roland@redhat.com>
+
+	* stdio-common/sscanf.c: Use prototype defn with ... syntax.
+	* libio/swscanf.c: Likewise.
+	* libio/swprintf.c: Likewise.
+
+2003-03-04  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/powerpc/powerpc64/dl-machine.h: Include <dl-tls.h>.
+	(elf_machine_rela): Always use RESOLVE_MAP, needed for
+	R_PPC64_JMP_SLOT as well as TLS cases.
+	(BIT_INSERT): Move parenthesis where it ought to have been.
+	Reported by Steven Munroe <sjmunroe@us.ibm.com>.
+
+	* posix/confstr.c (confstr): Correct STRING_LEN values for
+	_CS_GNU_LIBC_VERSION and _CS_GNU_LIBPTHREAD_VERSION, add missing
+	break.  Reported by Alexandre Julliard <julliard@winehq.com>.
+
+2003-03-04  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/ia64/fpu/libm-test-ulps: Regenerated.
+
+2003-03-04  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/x86_64/clone.S: Add support for the new
+	clone parameters.
+
+	* po/sv.po: Update from translation team.
+
+2003-03-04  Andreas Jaeger  <aj@suse.de>
+	    Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/x86_64/sysdep.h: Fix comments.
+
+2003-03-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/generic/dl-sysdep.h: Add double include protection.
+
+	* po/tr.po: Update from translation team.
+
+	* elf/dl-load.c (_dl_map_object_from_fd): Determine whether there
+	are holes between the segments.  Only call mprotect to set
+	proection to PROT_NONE if there are some.
+
+	* elf/dl-load.c (struct filebuf): Actually use FILEBUF_SIZE.
+	Update comment.
+
+	* include/sched.h (__clone2): Use ... instead of adding all the
+	new parameters.
+
+2003-03-03  Roland McGrath  <roland@redhat.com>
+
+	* elf/dl-load.c (struct filebuf): Fix typo in last change.
+
+	* sysdeps/powerpc/powerpc32/elf/configure.in: Don't define
+	PI_STATIC_AND_HIDDEN.
+
+2003-03-03  Ian Wienand  <ianw@gelato.unsw.edu.au>
+
+	* sysdeps/unix/sysv/linux/ia64/clone2.S: Update to take extra clone
+	flags.
+	* include/sched.h: Update clone2 prototype.
+
+2003-03-03  Andreas Jaeger  <aj@suse.de>
+
+	* math/tgmath.h (__TGMATH_UNARY_REAL_RET_ONLY): New definition.
+	(llrint): Use it to correct return type.
+	(lrint): Likewise.
+	(lround): Likewise.
+	(llround): Likewise.
+
+2003-03-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/dl-load.c (struct filebuf): For 64-bit platforms use 640
+	byte filebuf size.
+
+	* libio/fileops.c (_IO_new_file_fopen): Close stillborn descriptor
+	if ccs parameter isn't valid.  Reported by Andreas Schwab.
+
+2003-03-03  Martin Schwidefsky  <schwidefsky@de.ibm.com>
+
+	* sysdeps/unix/sysv/linux/s390/s390-32/syscall.S (syscall): Add support
+	for system call numbers > 255.
+	* sysdeps/unix/sysv/linux/s390/s390-32/syscall.h (DO_CALL,
+	INLINE_SYSCALL, INTERNAL_SYSCALL_DIRECT, INTERNAL_SYSCALL_SVC0,
+	INTERNAL_SYSCALL): Likewise.
+	* sysdeps/unix/sysv/linux/s390/s390-64/syscall.S (syscall): Likewise.
+	* sysdeps/unix/sysv/linux/s390/s390-64/syscall.h (DO_CALL,
+	INLINE_SYSCALL, INTERNAL_SYSCALL_DIRECT, INTERNAL_SYSCALL_SVC0,
+	INTERNAL_SYSCALL): Likewise.
+
+2003-03-03  Martin Schwidefsky  <schwidefsky@de.ibm.com>
+
+	* sysdeps/generic/dl-tls.c (_dl_deallocate_tls): Don't free the dtv
+	array if it is the initial dtv.
+
+2003-03-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* po/es.po: Update from translation team.
+	* po/fr.po: Likewise.
+	* po/gl.po: Likewise.
+	* po/sk.po: Likewise.
+	* po/sv.po: Likewise.
+
+	* sysdeps/unix/sysv/linux/syscalls.list: Add remap_file_pages entry.
+	* misc/sys/mman.h: Add prototype for remap_file_pages.
+	* sysdeps/generic/remap_file_pages.c: New file.
+	* misc/Makefile (routines): Add remap_file_pages.
+	* misc/Versions [libc:GLIBC_2.3.3]: Add remap_file_pages.
+
+	* sysdeps/unix/sysv/linux/x86_64/bits/mman.h: Define MAP_POPULATE
+	and MAP_NONBLOCK.
+	* sysdeps/unix/sysv/linux/s390/bits/mman.h: Likewise.
+	* sysdeps/unix/sysv/linux/powerpc/bits/mman.h: Likewise
+	* sysdeps/unix/sysv/linux/m68k/bits/mman.h: Likewise.
+	* sysdeps/unix/sysv/linux/arm/bits/mman.h: Likewise.
+	* sysdeps/unix/sysv/linux/ia64/bits/mman.h: Likewise.
+	* sysdeps/unix/sysv/linux/hppa/bits/mman.h: Likewise.
+	* sysdeps/unix/sysv/linux/alpha/bits/mman.h: Likewise.
+	* sysdeps/unix/sysv/linux/i386/bits/mman.h: Likewise.
+
+2003-03-03  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/ia64/dl-fptr.c (__ia64_make_fptr): Revert last change.
+	* sysdeps/ia64/dl-machine.h: Likewise.
+	* sysdeps/ia64/dl-symaddr.c (_dl_symbol_address): Remove const from
+	argument type.
+	* sysdeps/ia64/dl-lookupcfg.h: Update decl.
+
+	* sysdeps/wordsize-64/strtol_l.c (strtoll_l): Define as weak alias.
+	* sysdeps/wordsize-64/strtoul_l.c (strtoull_l): Define as weak alias.
+	* locale/Versions (libc: GLIBC_2.3): Move those to ...
+	* sysdeps/wordsize-32/Versions (libc: GLIBC_2.3): ... here, new file.
+	* sysdeps/wordsize-64/Versions (libc: GLIBC_2.3.3) Likewise.
+	* Versions.def (libc): Add GLIBC_2.3.3 set.
+
+	* sysdeps/ia64/dl-fptr.c (__ia64_make_fptr): Add const to MAP arg.
+	* sysdeps/ia64/dl-machine.h: Update decl.
+
+2003-03-03  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/clock_settime.c (HANDLE_REALTIME): Add missing brace.
+
+2003-03-02  Roland McGrath  <roland@redhat.com>
+
+	* scripts/abilist.awk: Reject data items with apparent 0 size.
+
+	* scripts/merge-abilist.awk: Restore hack to elide pattern foo.*/bar
+	after foo.* as if it were a duplicate.
+
+	* sysdeps/unix/sysv/linux/ia64/brk.S: Add .type and .size for __curbrk.
+
+2003-03-02  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/dl-load.c (struct filebuf): Reduce buf array to 512 bytes.
+
+	* sysdeps/generic/bits/time.h: Define CLOCK_MONOTONIC.
+	* sysdeps/posix/clock_getres.c: Define code for CLOCK_REALTIME only
+	if not already defined.  Use SYSDEP_GETRES to allow other files to
+	provide alternative implementations.
+	* sysdeps/unix/sysv/linux/clock_getres.c: New file
+	* sysdeps/unix/clock_gettime.c: Define code for CLOCK_REALTIME only
+	if not already defined.  Use SYSDEP_GETTIME to allow other files to
+	provide alternative implementations.
+	* sysdeps/unix/sysv/linux/clock_gettime.c: New file.
+	* sysdeps/unix/clock_settime.c: Define code for CLOCK_REALTIME only
+	if not already defined.  Use SYSDEP_GETTIME to allow other files to
+	provide alternative implementations.
+	* sysdeps/unix/sysv/linux/clock_settime.c: New file.
+	* sysdeps/unix/clock_nanosleep.c: Use SYSDEP_NANOSLEEP to allow
+	other files to provide alternative implementations.  Rearrange
+	tests for invalid parameters.
+	* sysdeps/unix/sysv/linux/clock_nanosleep.c: New file.
+	* sysdeps/unix/sysv/linux/sysconf.c: New file.
+	* sysdeps/unix/sysv/linux/kernel-features.h: Define
+	__ASSUME_POSIX_TIMERS for Linux 2.5.63 and up.
+	* sysdeps/unix/sysv/linux/bits/posix_opt.h: Define
+	_POSIX_MONOTONIC_CLOCK.
+
+2003-03-02  Roland McGrath  <roland@redhat.com>
+
+	* scripts/merge-abilist.awk: More checks for bogus input.
+	Uniquify duplicate config names.
+
+	* scripts/abilist.awk: Don't distinguish weak symbols in normal output.
+
+	* sysdeps/powerpc/powerpc32/dl-machine.c (_dl_reloc_overflow): Renamed
+	from dl_reloc_overflow, make global.
+	(__process_machine_rela): Update callers.
+	* sysdeps/powerpc/powerpc32/dl-machine.h: Declare _dl_reloc_overflow.
+	Add attribute_hidden to __process_machine_rela decl.
+	(elf_machine_type_class, elf_machine_rela): Handle 16-bit TLS relocs.
+
+	* sysdeps/generic/libc-start.c (__libc_start_main): Don't assign const
+	variable.
+
+	* sysdeps/powerpc/powerpc64/dl-machine.h (elf_machine_fixup_plt):
+	Don't use weak_extern for dl_rtld_map.  Instead check only if [SHARED].
+	(elf_machine_rela): Clean up.
+
+	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_rela): Clean up.
+
+	PowerPC TLS support contributed by Paul Mackerras <paulus@samba.org>.
+	* sysdeps/powerpc/powerpc32/elf/configure.in: New file.
+	* sysdeps/powerpc/powerpc32/elf/configure: New generated file.
+	* elf/tls-macros.h [__powerpc__ && !__powerpc64__]
+	(TLS_LE, TLS_IE, TLS_LD, TLS_GD): Define them.
+	* sysdeps/powerpc/powerpc32/dl-machine.h (elf_machine_rela): Support
+	new relocs for TLS.
+
+	* sysdeps/powerpc/dl-tls.h (TLS_TP_OFFSET, TLS_DTV_OFFSET): Move these
+	macros out of [SHARED].
+	(TLS_TPREL_VALUE, TLS_DTPREL_VALUE): New macros.
+
+	* elf/elf.h: Define R_PPC_* relocs for TLS support.
+	Clean up R_PPC64_* macro definition comments.
+
+	* configure.in: In "running configure fragment for" message,
+	omit $srcdir from the name if we prepended it.
+	* configure: Regenerated.
+
+	* elf/dl-reloc.c (allocate_static_tls): Fix calculations.
+	From Jakub Jelinek <jakub@redhat.com>.
+
+	* sysdeps/unix/sysv/linux/powerpc/bits/fcntl.h: Revert last change,
+	which duplicated the O_DIRECT defn.
+
+2003-03-01  GOTO Masanori  <gotom@debian.or.jp>
+
+	* stdlib/stdlib.h: Add missing __USE_BSD enclosure for BSD derived
+	random functions.
+
+2003-03-01  Andreas Schwab  <schwab@suse.de>
+
+	* resolv/Makefile (tests): Don't depend on
+	$(objpfx)mtrace-tst-leaks when cross compiling.
+
+	* sysdeps/m68k/dl-machine.h (_dl_start_user): Access
+	__libc_stack_end through GOT since it is a global symbol.
+
 2003-03-01  GOTO Masanori  <gotom@debian.or.jp>
 
 	* argp/argp.h: Fix a typo.
@@ -5561,6 +9663,16 @@
 	(common-mostlyclean, common-clean): Clean up rtld-* files.
 	* sysdeps/unix/make-syscalls.sh: Add rtld-*.os target name to rules.
 
+2003-05-20  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/dynamic-link.h (elf_get_dynamic_info): Add temp argument.
+	If temp != NULL, copy dynamic entries which need relocation to temp
+	array before relocating.
+	(DL_RO_DYN_TEMP_CNT): Define.
+	* elf/dl-load.c (_dl_map_object_from_fd): Adjust caller.
+	* elf/rtld.c (_dl_start): Likewise.
+	(dl_main): Likewise.  Add dyn_temp static variable.
+
 2002-10-11  Roland McGrath  <roland@redhat.com>
 
 	* sysdeps/generic/dl-tls.c (__tls_get_addr): After freeing block in
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/Makeconfig libc-20030708/Makeconfig
--- glibc-2.3.2/Makeconfig	2003-01-06 14:31:36.000000000 +0900
+++ libc-20030708/Makeconfig	2003-06-12 08:53:45.000000000 +0900
@@ -505,7 +505,7 @@
 link-extra-libs-bounded = $(foreach lib,$(LDLIBS-$(@F:%-bp=%)),$(common-objpfx)$(lib)_b.a)
 
 ifndef gnulib
-gnulib := -lgcc
+gnulib := -lgcc -lgcc_eh
 endif
 ifeq ($(elf),yes)
 +preinit = $(addprefix $(csu-objpfx),crti.o)
@@ -621,7 +621,7 @@
 +includes = -I$(..)include -I. \
 	    $(patsubst %/,-I%,$(objpfx)) $(patsubst %/,-I%,$(..)) \
 	    $(libio-include) $(includes) \
-	    $(+sysdep-includes) $(last-includes) $(sysincludes)
+	    $(+sysdep-includes) $(sysincludes)
 
 # Since libio has several internal header files, we use a -I instead
 # of many little headers in the include directory.
@@ -716,6 +716,15 @@
 libtype.oS = lib%_nonshared.a
 endif
 
+# The assembler can generate debug information too.
+ifndef ASFLAGS
+ifeq ($(have-cpp-asm-debuginfo),yes)
+ASFLAGS := $(filter -g%,$(CFLAGS))
+else
+ASFLAGS :=
+endif
+endif
+ASFLAGS += $(ASFLAGS-config)
 
 +gnu-stabs = $(shell echo>&2 '*** BARF ON ME')
 
@@ -921,11 +930,11 @@
 all-Depend-files = $(wildcard $(..)*/Depend)
 $(common-objpfx)sysd-sorted: $(..)scripts/gen-sorted.awk $(all-Depend-files) \
 			     $(common-objpfx)sysd-dirs $(..)Makeconfig
-	{ { dirs='$(patsubst $(..)%/Depend,$(..)%,$(filter %/Depend,$^))';\
+	{ { dirs='$(patsubst $(..)%/Depend,%,$(filter %/Depend,$^))';	  \
 	    for d in $$dirs; do						  \
 	      while read on; do						  \
 		echo "depend $$d $$on";					  \
-	      done < $$d/Depend;					  \
+	      done < $(..)$$d/Depend;					  \
 	    done;							  \
 	    for f in $(all-subdirs); do					  \
 	      echo $$f;							  \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/Makefile libc-20030708/Makefile
--- glibc-2.3.2/Makefile	2003-02-21 15:22:51.000000000 +0900
+++ libc-20030708/Makefile	2003-03-28 21:28:14.000000000 +0900
@@ -274,6 +274,7 @@
 		include/shlib-compat.h include/pthread.h Versions.def	\
 		cppflags-iterator.mk tls.make.c				\
 		include/stubs-prologue.h include/gnu/stubs.h		\
+		include/atomic.h bits/atomic.h				\
 		INTERFACE CONFORMANCE NAMESPACE LICENSES	        \
 		$(addprefix scripts/,					\
 			    rellns-sh config.sub config.guess		\
@@ -282,7 +283,10 @@
 			    gen-sorted.awk abi-versions.awk abilist.awk	\
 			    firstversions.awk documented.sh cpp		\
 			    output-format.sed gen-as-const.awk		\
-			    merge-abilist.awk extract-abilist.awk)
+			    merge-abilist.awk extract-abilist.awk	\
+			    rpm2dynsym.sh				\
+			    )						\
+		$(wildcard abilist/*.abilist)
 
 distribute := $(strip $(distribute))
 generated := $(generated) stubs.h
@@ -318,12 +322,6 @@
 iconvdata/% localedata/% po/% manual/%:
 	$(MAKE) $(PARALLELMFLAGS) -C $(@D) $(@F)
 
-# This is a special goal for people making binary distributions.  Normally
-# everybody uses the DES based crypt library but for the distribution we
-# need the only-MD5 based one as well.
-md5-crypt/libmd5crypt:
-	$(MAKE) $(PARALLELMFLAGS) -C $(@D) $(@F)
-
 # glibc 2.0 contains some header files which aren't used with glibc 2.1
 # anymore.
 # These rules should remove those headers
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/Makerules libc-20030708/Makerules
--- glibc-2.3.2/Makerules	2003-02-23 08:23:31.000000000 +0900
+++ libc-20030708/Makerules	2003-07-08 22:58:05.000000000 +0900
@@ -125,29 +125,9 @@
 endif # avoid-generated
 endif # $(versioning) = yes
 
-
-# Generating headers for assembly constants.
-# We need this defined early to get into before-compile before
-# it's used in sysd-rules, below.
-$(common-objpfx)%.h $(common-objpfx)%.h.d: $(..)scripts/gen-as-const.awk \
-					   %.sym $(before-compile)
-	$(AWK) -f $< $(filter %.sym,$^) \
-	| $(CC) -S -o - $(CFLAGS) $(CPPFLAGS) -x c - \
-		-MD -MF $(@:.h=.h.d)T -MT '$(@:.h=.h.d) $(@:.h.d=.h)' \
-	| sed -n 's/^.*@@@name@@@\([^@]*\)@@@value@@@[^0-9Xxa-fA-F-]*\([0-9Xxa-fA-F-][0-9Xxa-fA-F-]*\).*@@@end@@@.*$$/#define \1 \2/p' > $(@:.h.d=.h)T
-	sed $(sed-remove-objpfx) $(sed-remove-dotdot) \
-	    $(@:.h=.h.d)T > $(@:.h=.h.d)T2
-	rm -f $(@:.h=.h.d)T
-	mv -f $(@:.h=.h.d)T2 $(@:.h=.h.d)
-	mv -f $(@:.h.d=.h)T $(@:.h.d=.h)
-vpath %.sym $(sysdirs)
-before-compile += $(gen-as-const-headers:%.sym=$(common-objpfx)%.h)
-
-
-# When we have no deps pass doing it, then make sure the subdirectory
-# for object files gets created.
-ifdef no_deps
+# Make sure the subdirectory for object files gets created.
 ifdef objpfx
+ifeq (,$(wildcard $(objpfx).))
 before-compile += $(objpfx).
 $(objpfx).:
 	$(make-target-directory)
@@ -166,26 +146,59 @@
 $(before-compile):
 endif
 
+# We don't want $(common-objpfx) files to depend on miscellaneous stuff
+# in subdirs.
+ifdef subdir
+common-before-compile := $(filter-out $(objpfx)%,$(before-compile))
+else
+common-before-compile = $(before-compile)
+endif
+
+ifndef subdir
 # If a makefile needs to do something conditional on something that
 # can only be figured out from headers, write a FOO.make.c input
 # file that uses cpp contructs and contains @@@ LINE @@@ for each LINE
 # to emit in the generated makefile, and use -include $(common-objpfx)FOO.make.
-$(common-objpfx)%.make: $(..)%.make.c $(..)Makerules $(before-compile)
+#
+# We only generate these in the top-level makefile, to avoid any weirdness
+# from subdir-specific makefile tweaks creeping in on an update.
+$(common-objpfx)%.make: $(..)%.make.c $(..)Makerules $(common-before-compile)
 	rm -f $@T $@.dT
 	(echo '# Generated from $*.make.c by Makerules.'; \
-	 SUNPRO_DEPENDENCIES='$@.dT $$(common-objpfx)$*.make' \
 	 $(CC) $(CFLAGS) $(CPPFLAGS) -E $< \
+	       -MD -MP -MT '$$(common-objpfx)$*.make' -MF $@.dT \
 	 | sed -n '/@@@/{s/@@@[	 ]*\(.*\)@@@/\1/;s/[	 ]*$$//p;}'; \
 	 echo 'common-generated += $(@F)'; \
 	 sed $(sed-remove-objpfx) $(sed-remove-dotdot) $@.dT; \
 	 rm -f $@.dT) > $@T
 	mv -f $@T $@
+endif
 
 ifdef subdir
-sed-remove-dotdot := -e 's@  *\.\.\/\([^ 	\]*\)@ $$(..)\1@g'
+sed-remove-dotdot := -e 's@  *\.\.\/\([^ 	\]*\)@ $$(..)\1@g' \
+		     -e 's@^\.\.\/\([^ 	\]*\)@$$(..)\1@g'
 else
-sed-remove-dotdot := -e 's@  *\([^ 	\/$$][^ 	\]*\)@ $$(..)\1@g'
+sed-remove-dotdot := -e 's@  *\([^ 	\/$$][^ 	\]*\)@ $$(..)\1@g' \
+		     -e 's@^\([^ 	\/$$][^ 	\]*\)@$$(..)\1@g'
 endif
+
+
+# Generating headers for assembly constants.
+# We need this defined early to get into before-compile before
+# it's used in sysd-rules, below.
+$(common-objpfx)%.h $(common-objpfx)%.h.d: $(..)scripts/gen-as-const.awk \
+					   %.sym $(common-before-compile)
+	$(AWK) -f $< $(filter %.sym,$^) \
+	| $(CC) -S -o - $(CFLAGS) $(CPPFLAGS) -x c - \
+		-MD -MP -MF $(@:.h=.h.d)T -MT '$(@:.h=.h.d) $(@:.h.d=.h)' \
+	| sed -n 's/^.*@@@name@@@\([^@]*\)@@@value@@@[^0-9Xxa-fA-F-]*\([0-9Xxa-fA-F-][0-9Xxa-fA-F-]*\).*@@@end@@@.*$$/#define \1 \2/p' > $(@:.h.d=.h)T
+	sed $(sed-remove-objpfx) $(sed-remove-dotdot) \
+	    $(@:.h=.h.d)T > $(@:.h=.h.d)T2
+	rm -f $(@:.h=.h.d)T
+	mv -f $(@:.h=.h.d)T2 $(@:.h=.h.d)
+	mv -f $(@:.h.d=.h)T $(@:.h.d=.h)
+vpath %.sym $(sysdirs)
+before-compile += $(gen-as-const-headers:%.sym=$(common-objpfx)%.h)
 
 # Generate an ordered list of implicit rules which find the source files in
 # each sysdep directory.  The old method was to use vpath to search all the
@@ -193,15 +206,6 @@
 # later directory would be chosen over a .c file in an earlier directory,
 # which does not preserve the desired sysdeps ordering behavior.
 
-# When making the list of .d files to include, we can't know which ones
-# have source in .s files, and thus do not in fact need a .d file.
-# So we must define rules to make .d files for .s files.
-define make-dummy-dep
-$(addprefix ln $(common-objpfx)dummy.d ,$(filter-out $(wildcard $@),$@))
-endef
-$(common-objpfx)dummy.d:
-	echo '# .s files cannot contain includes, so they need no deps.' > $@
-
 # It matters that this set of rules, for compiling from sources in
 # the current directory (the $srcdir/$subdir) come before the
 # generated sysdep rules in included from sysd-rules below.  When
@@ -212,21 +216,18 @@
 endef
 object-suffixes-left := $(all-object-suffixes)
 include $(o-iterator)
-$(objpfx)%.d: %.S $(before-compile); $(+make-deps)
 
 define o-iterator-doit
 $(objpfx)%$o: %.s $(before-compile); $$(compile-command.s)
 endef
 object-suffixes-left := $(all-object-suffixes)
 include $(o-iterator)
-$(objpfx)%.d: %.s $(common-objpfx)dummy.d; $(make-dummy-dep)
 
 define o-iterator-doit
 $(objpfx)%$o: %.c $(before-compile); $$(compile-command.c)
 endef
 object-suffixes-left := $(all-object-suffixes)
 include $(o-iterator)
-$(objpfx)%.d: %.c $(before-compile); $(+make-deps)
 
 # Omit the objpfx rules when building in the source tree, because
 # objpfx is empty and so these rules just override the ones above.
@@ -238,21 +239,18 @@
 endef
 object-suffixes-left := $(all-object-suffixes)
 include $(o-iterator)
-$(objpfx)%.d: $(objpfx)%.S $(before-compile); $(+make-deps)
 
 define o-iterator-doit
 $(objpfx)%$o: $(objpfx)%.s $(before-compile); $$(compile-command.s)
 endef
 object-suffixes-left := $(all-object-suffixes)
 include $(o-iterator)
-$(objpfx)%.d: $(objpfx)%.s $(common-objpfx)dummy.d; $(make-dummy-dep)
 
 define o-iterator-doit
 $(objpfx)%$o: $(objpfx)%.c $(before-compile); $$(compile-command.c)
 endef
 object-suffixes-left := $(all-object-suffixes)
 include $(o-iterator)
-$(objpfx)%.d: $(objpfx)%.c $(before-compile); $(+make-deps)
 endif
 
 # System-dependent makefiles can put in `inhibit-sysdep-asm' wildcard
@@ -301,26 +299,6 @@
 	     echo "\$$(objpfx)ptw-%$$o: $$dir/%.c \$$(before-compile); \
 		  \$$(compile-command.c)";				      \
 	   done; \
-	   $(open-check-inhibit-asm) \
-	   echo "\$$(objpfx)%.d: $$dir/%.s \$$(common-objpfx)dummy.d; \
-		\$$(make-dummy-dep)";			       \
-	   echo "\$$(objpfx)rtld-%.d: $$dir/%.s \$$(common-objpfx)dummy.d; \
-		\$$(make-dummy-dep)";			       \
-	   echo "\$$(objpfx)ptw-%.d: $$dir/%.s \$$(common-objpfx)dummy.d; \
-		\$$(make-dummy-dep)";			       \
-	   echo "\$$(objpfx)%.d: $$dir/%.S \$$(before-compile); \
-		\$$(+make-deps)";					      \
-	   echo "\$$(objpfx)rtld-%.d: $$dir/%.S \$$(before-compile); \
-		\$$(+make-deps)";					      \
-	   echo "\$$(objpfx)ptw-%.d: $$dir/%.S \$$(before-compile); \
-		\$$(+make-deps)";					      \
-	   $(close-check-inhibit-asm)	\
-	   echo "\$$(objpfx)%.d: $$dir/%.c \$$(before-compile); \
-		\$$(+make-deps)";					      \
-	   echo "\$$(objpfx)rtld-%.d: $$dir/%.c \$$(before-compile); \
-		\$$(+make-deps)";					      \
-	   echo "\$$(objpfx)ptw-%.d: $$dir/%.c \$$(before-compile); \
-		\$$(+make-deps)";					      \
 	   echo "\$$(objpfx)m_%.S: $$dir/s_%.S; \$$(+make-include-of-dep)";   \
 	   echo "\$$(objpfx)m_%.c: $$dir/s_%.c; \$$(+make-include-of-dep)";   \
 	 done;								      \
@@ -383,32 +361,20 @@
 endif # $(versioning) = yes
 endif # sysd-sorted-done
 
-
-ifndef compile-command.S
-compile-command.S = $(compile.S) $(OUTPUT_OPTION)
-endif
-ifndef compile-command.s
-compile-command.s = $(COMPILE.s) $< $(OUTPUT_OPTION)
-endif
-ifndef compile-command.c
-compile-command.c = $(compile.c) $(OUTPUT_OPTION)
-endif
+# Generate .dT files as we compile.
+compile-mkdep-flags = -MD -MP -MF $@.dt
+compile-command.S = $(compile.S) $(OUTPUT_OPTION) $(compile-mkdep-flags)
+compile-command.s = $(COMPILE.s) $< $(OUTPUT_OPTION) $(compile-mkdep-flags)
+compile-command.c = $(compile.c) $(OUTPUT_OPTION) $(compile-mkdep-flags)
 
 # GCC can grok options after the file name, and it looks nicer that way.
 compile.c = $(CC) $< -c $(CFLAGS) $(CPPFLAGS)
-compile.S = $(CC) $< -c $(CPPFLAGS) $(S-CPPFLAGS) $(ASFLAGS-$(suffix $@))
-COMPILE.S = $(CC) -c $(CPPFLAGS) $(S-CPPFLAGS) $(ASFLAGS-$(suffix $@))
+compile.S = $(CC) $< -c $(CPPFLAGS) $(S-CPPFLAGS) \
+		  $(ASFLAGS) $(ASFLAGS-$(suffix $@))
+COMPILE.S = $(CC) -c $(CPPFLAGS) $(S-CPPFLAGS) \
+		  $(ASFLAGS) $(ASFLAGS-$(suffix $@))
 COMPILE.s = $(filter-out -pipe,$(CC)) -c $(ASFLAGS)
 
-# If we want to generate MD5 checksums for the sources do this now.
-ifeq ($(md5),yes)
-generate-md5 = ; rm -f $(@:.d=.md5); \
-$(CC) -E $< $(CFLAGS) $(CPPFLAGS) $($(patsubst .%,%,$(suffix $(<F)))-CPPFLAGS) | \
-sed '/^\#/d;/^[[:space:]]*$$/d' | md5sum > $(@:.d=.md5)
-else
-generate-md5 =
-endif
-
 # We need this for the output to go in the right place.  It will default to
 # empty if make was configured to work with a cc that can't grok -c and -o
 # together.  You can't compile the C library with such a compiler.
@@ -418,14 +384,16 @@
 # the dependency run for C sources.  But having it for assembly sources can
 # get the wrong predefines.
 S-CPPFLAGS = -DASSEMBLER $(asm-CPPFLAGS)
+
 define +make-deps
 $(make-target-directory)
 $(+mkdep) $< $(if $(filter %.c,$<),$(CFLAGS)) \
-	     $(CPPFLAGS) $($(patsubst .%,%,$(suffix $(<F)))-CPPFLAGS) | sed \
--e 's,$(subst .,\.,$*)\.o,$(foreach o,$(all-object-suffixes),$(@:.d=$o)) $@,' \
-$(sed-remove-objpfx) > $(@:.d=.T)
+	     $(CPPFLAGS) $($(patsubst .%,%,$(suffix $(<F)))-CPPFLAGS) | sed -e\
+'s,$(subst .,\.,$(@F:.d=.o)),$(foreach o,$(all-object-suffixes),$(@:.d=$o)) $@,' \
+$(sed-remove-objpfx) $(sed-remove-dotdot) > $(@:.d=.T)
 mv -f $(@:.d=.T) $@ $(generate-md5)
 endef
+
 ifneq (,$(objpfx))
 # Continuation lines here are dangerous because they introduce spaces!
 define sed-remove-objpfx
@@ -509,17 +477,23 @@
 ifeq (yes,$(elf))
 # binutils only position loadable notes into the first page for binaries,
 # not for shared objects
-define build-shlib
-$(build-shlib-helper) \
-	  -o $@.new $(csu-objpfx)abi-note.o -Wl,--verbose \
-	  $(LDLIBS-$(@F:lib%.so=%).so) 2>&1 | \
-	  sed -e '/^=========/,/^=========/!d;/^=========/d' \
+$(common-objpfx)shlib.lds: $(common-objpfx)config.make $(..)Makerules
+	$(LINK.o) -shared -Wl,-O1 \
+		  $(sysdep-LDFLAGS) $(config-LDFLAGS) $(LDFLAGS.so) \
+		  -Wl,--verbose 2>&1 | \
+	  sed > $@T \
+	      -e '/^=========/,/^=========/!d;/^=========/d' \
 	      -e 's/^.*\.hash[ 	]*:.*$$/  .note.ABI-tag : { *(.note.ABI-tag) } &/' \
-	      $(LDSEDCMD-$(@F:lib%.so=%).so) > $@.lds
-rm -f $@.new
-$(build-shlib-helper) -o $@ -T $@.lds \
+	      -e 's/^.*\*(\.dynbss).*$$/& \
+		 PROVIDE(__start___libc_freeres_ptrs = .); \
+		 *(__libc_freeres_ptrs) \
+		 PROVIDE(__stop___libc_freeres_ptrs = .);/'
+	mv -f $@T $@
+common-generated += shlib.lds
+
+define build-shlib
+$(build-shlib-helper) -o $@ -T $(common-objpfx)shlib.lds \
 	  $(csu-objpfx)abi-note.o $(build-shlib-objlist)
-rm -f $@.lds
 endef
 else
 ifneq (,$(findstring aix,$(config-os)))
@@ -559,16 +533,8 @@
 # binutils only position loadable notes into the first page for binaries,
 # not for shared objects
 define build-module
-$(build-module-helper) \
-	  -o $@.new $(csu-objpfx)abi-note.o -Wl,--verbose \
-	  $(LDLIBS-$(@F:lib%.so=%).so) 2>&1 | \
-	  sed -e '/^=========/,/^=========/!d;/^=========/d' \
-	      -e 's/^.*\.hash[ 	]*:.*$$/  .note.ABI-tag : { *(.note.ABI-tag) } &/' \
-	  > $@.lds
-rm -f $@.new
-$(build-module-helper) -o $@ -T $@.lds \
+$(build-module-helper) -o $@ -T $(common-objpfx)shlib.lds \
 	  $(csu-objpfx)abi-note.o $(build-module-objlist)
-rm -f $@.lds
 endef
 else
 ifneq (,$(findstring aix,$(config-os)))
@@ -590,7 +556,7 @@
 
 build-module-helper-objlist = \
 	$(patsubst %_pic.a,$(whole-archive) %_pic.a $(no-whole-archive),\
-		   $(filter-out $(map-file) $(+preinit) $(+postinit),$^))
+		   $(filter-out %.lds $(map-file) $(+preinit) $(+postinit),$^))
 whole-archive := -Wl,--whole-archive
 
 build-module-objlist = $(build-module-helper-objlist) $(LDLIBS-$(@F:%.so=%).so)
@@ -616,12 +582,12 @@
 $(common-objpfx)libc_pic.os: $(common-objpfx)libc_pic.a
 	$(LINK.o) -nostdlib -nostartfiles -r -o $@ \
 	$(LDFLAGS-c_pic.os) -Wl,-d -Wl,--whole-archive $^
-LDSEDCMD-c.so = -e 's/^.*\*(\.dynbss).*$$/& __start___libc_freeres_ptrs = .; *(__libc_freeres_ptrs) __stop___libc_freeres_ptrs = .;/'
 # Use our own special initializer and finalizer files for libc.so.
 $(common-objpfx)libc.so: $(elfobjdir)/soinit.os \
 			 $(common-objpfx)libc_pic.os \
 			 $(elfobjdir)/sofini.os \
-			 $(elfobjdir)/interp.os $(elfobjdir)/ld.so
+			 $(elfobjdir)/interp.os $(elfobjdir)/ld.so \
+			 $(common-objpfx)shlib.lds
 	$(build-shlib)
 ifeq ($(versioning),yes)
 $(common-objpfx)libc.so: $(common-objpfx)libc.map
@@ -689,6 +655,15 @@
 +depfiles := $(addprefix $(objpfx),\
 			 $(filter-out $(addsuffix .d,$(omit-deps)),\
 				      $(+depfiles)))
+all-dt-files := $(foreach o,$(object-suffixes-for-libc),$(+depfiles:.d=$o.dt))
++depfiles := $(patsubst %.dt,%.d,$(wildcard $(all-dt-files))) \
+	     $(wildcard $(all-dt-files:.dt=.d))
+
+# This is a funny rule in that it removes its input file.
+%.d: %.dt
+	@sed $(sed-remove-objpfx) $< > $(@:.d=.T) && \
+	 mv -f $(@:.d=.T) $@ && \
+	 rm -f $<
 
 # Avoid the .h.d files for any .sym files whose .h files don't exist yet.
 # They will be generated when they're needed, and trying too early won't work.
@@ -762,6 +737,7 @@
 $(objpfx)stamp$o: $(o-objects); $$(do-stamp)
 endef
 define do-stamp
+$(make-target-directory)
 echo '$(patsubst $(objpfx)%,$(addsuffix /,$(subdir))%,$^)' > $@T
 mv -f $@T $@
 endef
@@ -1188,15 +1164,23 @@
 	LC_ALL=C \
 	$(AWK) -f $< -v 'config=$(check-abi-config)' \
 	       $(filter %.abilist,$^) \
-	| diff -pu0 - $(filter %.symlist,$^)
+	| { diff -pu0 - $(filter %.symlist,$^) $(check-abi-warn) ; }
 endef
+ifeq ($(enable-check-abi),warn)
+check-abi-warn = || echo '*** WARNING: $*.so failed ABI check'
+endif
 
 ifeq ($(firstword $(sysd-sorted-done) f)$(firstword $(generating) f),tf)
 -include $(common-objpfx)tls.make
-config-tls-yes := tls
-config-tls-no := notls
+config-tls := notls
+ifeq ($(use-tls),yes)
+config-tls := tls
+endif
+ifeq ($(use-thread),yes)
+config-tls := thread
+endif
 check-abi-config := \
-  $(config-machine)-$(config-vendor)-$(config-os)/$(config-tls-$(use-thread))
+  $(config-machine)-$(config-vendor)-$(config-os)/$(config-tls)
 endif
 
 update-abi-%: $(..)scripts/merge-abilist.awk $(..)abilist/%.abilist \
@@ -1211,7 +1195,7 @@
 endef
 else
 define update-abi
-LC_ALL=C $(AWK) -v config=$(update-abi-config) -f $^ \
+LC_ALL=C $(AWK) -v config='$(update-abi-config)' -f $^ \
 	 > $(..)abilist/$*.abilist.new
 @if cmp -s $(..)abilist/$*.abilist.new $(..)abilist/$*.abilist 2> /dev/null; \
  then rm -f $(..)abilist/$*.abilist.new; \
@@ -1233,19 +1217,23 @@
 update-abi: subdir_update-abi
 endif
 
-# Enable this when all the .abilist files are in place.
-#tests: check-abi
-
 ifeq ($(subdir),elf)
 check-abi: check-abi-libc
 update-abi: update-abi-libc
 common-generated += libc.symlist
 endif
 
+ifeq ($(build-shared),yes)
+ifneq ($(enable-check-abi),no)
+ifdef subdir
+tests: check-abi
+endif
+endif
+endif
+
 endif
 
 # There's no good place to put this - here will do.
-# The dependencies are wrong if it's run from the top level.
 ifeq ($(filter %posix, $(sysdirs)),)
 L_tmpnam  = 1
 TMP_MAX   = 0
@@ -1263,24 +1251,20 @@
 $(stdio_lim:h=st): $(..)stdio-common/stdio_lim.h.in $(..)Rules \
 		   $(common-objpfx)config.make
 	$(make-target-directory)
-	echo '#include "$(..)posix/bits/posix1_lim.h"' |		\
-	SUNPRO_DEPENDENCIES='$(@:st=dT) $@'				\
-	$(CC) $(+includes) -E -dM -xc - -o $(@:st=hT)
-	echo '#include "$(..)misc/sys/uio.h"' |				\
-	SUNPRO_DEPENDENCIES='$(@:st=dT) $@'				\
-	$(CC) -D_LIBC=1 $(+includes) -E -dM -xc - | cat - >> $(@:st=hT)
-ifdef sed-remove-objpfx
-	sed $(sed-remove-objpfx) $(@:st=dT) > $(@:st=dt)
-	cat $(@:st=dt) >> $(@:st=d)
-else
-	cat $(@:st=dT) >> $(@:st=d)
-endif
+	{ echo '#include "$(..)posix/bits/posix1_lim.h"';		\
+	  echo '#define _LIBC 1';					\
+	  echo '#include "$(..)misc/sys/uio.h"'; } |			\
+	$(CC) -E -dM -MD -MP -MF $(@:st=dT) -MT '$(@:st=h) $(@:st=d)' 	\
+	      $(+includes) -xc - -o $(@:st=hT)
+	sed $(sed-remove-objpfx) $(sed-remove-dotdot)			\
+	    $(@:st=dT) > $(@:st=dt)
+	mv -f $(@:st=dt) $(@:st=d)
 	fopen_max=`sed -n 's/^#define OPEN_MAX //1p' $(@:st=hT)`; 	\
 	filename_max=`sed -n 's/^#define PATH_MAX //1p' $(@:st=hT)`;	\
 	iov_max=`sed -n 's/^#define UIO_MAXIOV //p' $(@:st=hT)`;	\
 	fopen_max=$${fopen_max:-16};					\
 	filename_max=$${filename_max:-1024};				\
-	if [ -z $$iov_max ]; then					\
+	if [ -z "$$iov_max" ]; then					\
 	  define_iov_max="# undef IOV_MAX";				\
 	else								\
 	  define_iov_max="# define IOV_MAX $$iov_max";			\
@@ -1355,8 +1339,8 @@
 
 # Also remove the dependencies and generated source files.
 common-clean: common-mostlyclean
-	-rm -f $(addprefix $(objpfx),$(generated)) $(+depfiles)
-	-rm -f $(objpfx)rtld-*.d
+	-rm -f $(addprefix $(objpfx),$(generated))
+	-rm -f $(objpfx)*.d $(objpfx)*.dt
 	-rm -fr $(addprefix $(objpfx),$(generated-dirs))
 	-rm -f $(addprefix $(common-objpfx),$(common-generated))
 	-rm -f $(objpfx)distinfo
@@ -1370,17 +1354,23 @@
 .PHONY: stubs # The parent Makefile calls this target.
 stubs: $(objpfx)stubs
 endif
-s = $(sysdep_dir)/generic
 $(objpfx)stubs: $(+depfiles)
+ifneq (,$(strip $(+depfiles)))
 # Use /dev/null since `...` might expand to empty.
-	(s=`cd $s && $(PWD_P)`; \
-	 $(patsubst %/,cd % &&,$(objpfx)) \
-	 sed -n 's/^stub_warning *(\([^)]*\).*$$/#define __stub_\1/p' \
-	  `sed -n -e '\@ $s/[^ ]*\.c@{; s@^.* $s/\([^ ]*\.c\).*$$@'"$$s"'/\1@; h; }' \
-		-e '/stub-tag\.h/{; g; p; }' \
-		  $(patsubst $(objpfx)%,%,$^) /dev/null` \
-	     /dev/null) > $@T
+	c=`($(patsubst %/,cd % &&,$(objpfx)) \
+	    sed -n -e 's@\$$(common-objpfx)@$(common-objpfx)@g' \
+		   -e 's@\$$(objpfx)@$(objpfx)@g' \
+		   -e '/stub-tag\.h/{; g; s/./&/p; }' \
+		   -e '/:/{x; s/^.*$$//; x; }' \
+		   -e 's/^.*://;s/\\$$//;s/^ *\([^ ][^ ]*\) .*$$/\1/' \
+		   -e '/^[^ ][^ ]*$$/{G;s/^.*\n\(..*\)/\1/;s/\n//;h; }' \
+		   $(patsubst $(objpfx)%,%,$^)) | sort | uniq`; \
+	sed -n 's/^stub_warning *(\([^)]*\).*$$/#define __stub_\1/p' \
+	    $$c /dev/null > $@T
 	mv -f $@T $@
+else
+	> $@
+endif
 
 # Make the distribution tar file.
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/NEWS libc-20030708/NEWS
--- glibc-2.3.2/NEWS	2003-01-13 18:26:13.000000000 +0900
+++ libc-20030708/NEWS	2003-04-28 23:53:19.000000000 +0900
@@ -1,10 +1,24 @@
-GNU C Library NEWS -- history of user-visible changes.  2003-1-12
-Copyright (C) 1992-2002, 2003 Free Software Foundation, Inc.
+GNU C Library NEWS -- history of user-visible changes.  2003-4-24
+Copyright (C) 1992-2002,2003 Free Software Foundation, Inc.
 See the end for copying conditions.
 
 Please send GNU C library bug reports using the `glibcbug' script to
 <bugs@gnu.org>.  Please send questions and suggestions to <bug-glibc@gnu.org>.
 
+Version 2.3.3
+
+* New functions `dladdr1' and `dlinfo' in <dlfcn.h> provide more ways to
+  interrogate the dynamic linker, compatible with the Solaris interface.
+
+* ELF thread-local storage support (TLS) now works on PowerPC and PowerPC64;
+  implemented by Paul Mackerras, Steven Munroe, and Roland McGrath.
+
+* getifaddrs new uses on Linux the netlink interface to get the information.
+  Implemented by Thorsten Kukuk.
+
+* getaddrinfo now implements AI_V4MAPPED, AI_ALL, and AI_ADDRCONF.
+  Implemented by Ulrich Drepper.
+
 Version 2.3.2
 
 * Thread-safe interfaces for many functions that access locale data
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/README-alpha libc-20030708/README-alpha
--- glibc-2.3.2/README-alpha	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/README-alpha	1999-05-13 19:22:39.000000000 +0900
@@ -0,0 +1,287 @@
+			 GNU libc SNAPSHOT SYSTEM
+			    (general info)
+			   Updated 1997-9-26
+
+WHAT ARE GNU libc SNAPSHOTS
+---------------------------
+
+Snapshots are an "image" of the main glibc development tree, captured at a
+particular random instant in time.  When you use the snapshots, you should be
+able to maintain a local copy of libc that is no more than one day older than
+the official source tree used by the libc maintainers.
+
+The primary purpose of providing snapshots is to widen the group of motivated
+developers that would like to help test, debug, and enhance glibc, by providing
+you with access to the "latest and greatest" source.  This has several
+advantages, and several disadvantages.
+
+    First the advantages:
+
+    o	Once we have a large base of motivated testers using the snapshots,
+	this should provide good coverage across all currently supported
+	glibc hosts and targets.  If a new bug is introduced in glibc due to
+	fixing another bug or ongoing development, it should become
+	obvious much more quickly and get fixed before the next general
+	net release.  This should help to reduce the chances of glibc being
+	released to the general public with a major bug that went unnoticed
+	during the release cycle testing because they are machine dependent.
+	We hope to greatly improve glibc's stability and reliability by
+	involving more people and more execution environments in the
+	prerelease testing.
+
+    o	With access to the latest source, any diffs that you send to fix
+	bugs or add new features should be much easier for the glibc team
+	to merge into the official source base (after suitable review
+	of course).  This encourages us to merge your changes quicker,
+	while they are still "fresh".
+
+    o	Once your diffs are merged, you can obtain a new copy of glibc
+	containing your changes almost immediately.  Thus you do not
+	have to maintain local copies of your changes for any longer
+	than it takes to get them merged into the official source base.
+	This encourages you to send in changes quicker.
+
+    And the disadvantages:
+
+    o	The snapshot you get will be largely untested and of unknown quality.
+	It may fail to configure or compile.  It may have serious bugs.
+	You should always keep a copy of the last known working version
+	before updating to the current snapshot, or at least be able to
+	regenerate a working version if the latest snapshot is unusable
+	in your environment for some reason.
+
+	If a production version of glibc has a bug and a snapshot has the fix,
+	and you care about stability, you should put only the fix for that
+	particular problem into your production version.  Of course, if you
+	are eager to test glibc, you can use the snapshot versions in your
+	daily work, but users who have not been consulted about whether they
+	feel like testing glibc should generally have something which is at
+	least as bug free as the last released version.
+
+    o	Providing timely response to your questions, bug reports, and
+	submitted patches will require the glibc development team to allocate
+	time from an already thin time budget.  Please try to help us make
+	this time as productive as possible.  See the section below about
+	how to submit changes.
+
+
+WHO SHOULD TRY THE SNAPSHOTS
+----------------------------
+
+Remember, these are snapshots not tested versions.  So if you use
+these versions you should be able to
+
+    o	make sure your system stays usable
+
+    o	locate and hopefully fix problems
+
+    o	to port glibc to a new target yourself
+
+You should not use the snapshots if
+
+    o	your system is needed in a production environment which needs
+	stability
+
+    o	you expect us to fix your problems since you somehow depend on them.
+	You must be willing to fix the problems yourself, we don't want to
+	see "I have problems, fix this" messages.
+
+
+HOW TO GET THE SNAPSHOTS
+------------------------
+
+At the moment we provide a full snapshot weekly (every sunday), so
+that users getting a snapshot for the first time, or updating after
+a long period of not updating, can get the latest version in a single
+operation.  Along with the full snapshot, we will provide incremental
+diffs on a nearly daily basis (whenever code changes).  Each daily
+diff will be relative to the source tree after applying all previous
+daily diffs.  The daily diffs are for people who have relatively low
+bandwidth ftp or uucp connections.
+
+The files will be available via anonymous ftp from alpha.gnu.org, in
+directory /gnu/libc and on linux.kernel.org in /pub/software/libs/glibc.  The
+directories should look something like:
+
+	libc-970921.tar.gz
+	libc-970917-970922.diff.gz
+	libc-970922-970925.diff.gz
+	.
+	.
+	.
+
+Please note that the snapshots on alpha.gnu.org and on
+linux.kernel.org are not always in sync. Patches to some files might
+appear a day a diff earlier or later on alpha than on kernel.
+Use always alpha or always kernel but don't mix them.
+
+There are sometimes additionally test releases of the add-ons available in
+these directories.  If a new version of an add-on is available it is normally
+required for the corresponding snapshot so always pay attention for these.
+
+Note that we provide GNU gzip compressed files only.  You can ftp gzip
+from ftp.gnu.org in directory pub/gnu.
+
+In some cases the dates for diffs and snapshots do not match like in the
+example above.  The full release is for 970921 but the patch is for
+970917-970922.  This only means that nothing changed between 970917 and 970922
+and that you have to use this patch on top of the 970921 snapshot since the
+patch is made on 970922.
+
+Also, as the gcc developers did with their gcc snapshot system, even though we
+will make the snapshots available on a publically accessible ftp area, we ask
+that recipients not widely publicise their availability.  The motivation for
+this request is not to hoard them, but to avoid the situation where the
+general glibc user base naively attempts to use the snapshots, has trouble with
+them, complains publically, and the reputation of glibc declines because of a
+perception of instability or lack of quality control.
+
+
+GLIBC TEST SUITE
+----------------
+
+A test suite is distributed as an integral part of the snapshots.  A simple
+"make check" in your build directory is sufficient to run the tests.  glibc
+should pass all tests and if any fails, please report it.  A failure might not
+originate from a bug in glibc but also from bugs in the tools, e.g. with gcc
+2.7.2.x the math tests fail some of the tests because of compiler bugs.
+
+Note that the test suite is still in its infancy.  The tests themselves only
+cover a small portion of libc features, and where tests do exist for a feature
+they are not exhaustive.  New tests are welcome.
+
+
+GETTING HELP, GLIBC DISCUSSIONS, etc
+------------------------------------
+
+People who want to help with glibc and who test out snapshots
+regularly should get on the libc-alpha@sourceware.cygnus.com mailing
+list by sending an email to libc-alpha-subscribe@sourceware.cygnus.com.
+This list is meant (as the name suggests) for the discussion of test
+releases and also reports for them.  People who are on this list are
+welcome to post questions of general interest.
+
+People who are not only willing to test the snapshots but instead
+really want to help developing glibc should contact
+libc-hacker-subscribe@sourceware.cygnus.com.org to be put on the developers
+mailing list.  This list is really only meant for developers.  No
+questions about installation problems or other simple topics are
+wanted nor will they be answered.
+
+Do *not* send any questions about the snapshots or patches specific to the
+snapshots to bug-glibc@gnu.org.  Nobody there will have any idea what
+you are talking about and it will just cause confusion.
+
+
+BUG REPORTS
+-----------
+
+Send bug reports directly to Ulrich Drepper <drepper@gnu.org>.  Please
+do *not* use the glibcbug script for reporting bugs in the snapshots.
+glibcbug should only be used for problems with the official released versions.
+We don't like bug reports in the bug database because otherwise the impression
+of instability or lack of quality control of glibc as a whole might manifest
+in people's mind.
+
+Note that since no testing is done on the snapshots, and snapshots may even be
+made when glibc is in an inconsistent state, it may not be unusual for an
+occasional snapshot to have a very obvious bug, such as failure to compile on
+*any* machine.  It is likely that such bugs will be fixed by the next
+snapshot, so it really isn't necessary to report them unless they persist for
+a couple of days.
+
+Missing files should always be reported, since they usually mean there is a
+problem with the snapshot-generating process and we won't know about them
+unless someone tells us.
+
+Bugs which are non-obvious, such as failure to compile on only a specific
+machine, a new machine dependent or obscure bug (particularly one not detected
+by the testsuite), etc should be reported when you discover them, or have a
+suggested patch to fix them.
+
+
+FORMAT FOR PATCHES
+------------------
+
+If you have a fix for a bug, or an enhancement to submit, send your patch to
+Ulrich Drepper <drepper@gnu.org>.  Here are some simple guidelines for
+submitting patches:
+
+    o	Use "unified diffs" for patches.  A typical command for generating
+	context diffs is "diff -ru glibc-old glibc-patched".
+
+    o	Use the "minimalist approach" for patches.  That is, each patch
+	should address only one particular bug, new feature, etc.  Do not
+	save up many unrelated changes and submit them all in one big
+	patch, since in general, the larger the patch the more difficult
+	it is for us to decide if the patch is either correct or
+	desirable.  And if we find something about the patch that needs
+	to be corrected before it can be installed, we would have to reject
+	the entire patch, which might contain changes which otherwise would
+	be accepted if submitted separately.
+
+    o	Submit a sample ChangeLog entry with your patch.  See the existing
+	glibc ChangeLog for examples of what a ChangeLog entry should look
+	like.  The emacs command ^X4A will create a ChangeLog entry header
+	for you.
+
+
+BUILDING SNAPSHOTS
+------------------
+
+The `best' way to build glibc is to use an extra directory, e.g.:
+tar xzf libc-970921.tar.gz
+mkdir build-glibc
+cd build-glibc
+../libc-970921/configure ...
+
+In this way you can easily clean up (since `make clean' doesn't work at
+the moment) and rebuild glibc.
+
+
+NECESSARY TOOLS
+---------------
+
+For the recommended versions of gcc, binutils, make, texinfo, gettext,
+autoconf and other tools which might be especially needed when using patches,
+please read the file INSTALL.
+
+
+HOW CAN YOU HELP
+----------------
+
+It helps already a lot if you just install glibc on your system and try to
+solve any problems.  You might want to look at the file `PROJECTS' and help
+with one of those projects, fix some bugs (see `BUGS' or the bug database),
+port to an unsupported platform, ...
+
+
+FURTHER DOCUMENTATION
+---------------------
+
+A lot of questions are answered in the FAQ.  The files `INSTALL', `README' and
+`NOTES' contain the most important documentation.  Furthermore glibc has its
+own 700+ pages info documentation, ...
+
+
+
+And finally a word of caution: The libc is one of the most fundamental parts
+of your system - and these snapshots are untested and come without any
+guarantee or warranty.  You might be lucky and everything works or you might
+crash your system.  If you install a glibc snapshot as primary library, you
+should have a backup somewhere.
+
+On many systems it is also a problem to replace the libc while the system is
+running.  In the worst case on broken OSes some systems crash.  On better
+systems you can move the old libc aside but removing it will cause problems
+since there are still processes using this libc image and so you might have to
+check the filesystem to get rid of the libc data.  One good alternative (which
+is also safer) is to use a chroot'ed environment.
+
+Thanks for your help and support.
+
+Thanks to Fred Fish from Cygnus for the original version of this text
+(for GDB).
+
+
+Ulrich Drepper
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/README.template libc-20030708/README.template
--- glibc-2.3.2/README.template	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/README.template	2002-10-03 06:16:42.000000000 +0900
@@ -0,0 +1,87 @@
+This directory contains the version VERSION release of the GNU C Library.
+Many bugs have been fixed since the last release.
+Some bugs surely remain.
+
+As of this release, the GNU C library is known to run on the following
+configurations:
+
+		*-*-gnu			GNU Hurd
+		i[3456]86-*-linux-gnu	Linux-2.x on Intel
+		m68k-*-linux-gnu	Linux-2.x on Motorola 680x0
+		alpha*-*-linux-gnu	Linux-2.x on DEC Alpha
+		powerpc-*-linux-gnu     Linux and MkLinux on PowerPC systems
+		powerpc64-*-linux-gnu	Linux-2.4.19+ on 64-bit PowerPC systems
+		sparc-*-linux-gnu	Linux-2.x on SPARC
+		sparc64-*-linux-gnu	Linux-2.x on UltraSPARC 64-bit
+		arm-*-none		ARM standalone systems
+		arm-*-linux		Linux-2.x on ARM
+		arm-*-linuxaout		Linux-2.x on ARM using a.out binaries
+		mips*-*-linux-gnu	Linux-2.x on MIPS
+		ia64-*-linux-gnu	Linux-2.x on ia64
+		s390-*-linux-gnu	Linux-2.x on IBM S/390
+		s390x-*-linux-gnu	Linux-2.4+ on IBM S/390 64-bit
+		sh-*-linux-gnu		Linux-2.x on Super Hitachi
+		cris-*-linux-gnu	Linux-2.4+ on CRIS
+		x86-64-*-linux-gnu	Linux-2.4+ on x86-64
+
+Former releases of this library (version 1.09.1 and perhaps earlier
+versions) used to run on the following configurations:
+
+		alpha-dec-osf1
+		i[3456]86-*-bsd4.3
+		i[3456]86-*-isc2.2
+		i[3456]86-*-isc3
+		i[3456]86-*-sco3.2
+		i[3456]86-*-sco3.2v4
+		i[3456]86-*-sysv
+		i[3456]86-*-sysv4
+		i[3456]86-force_cpu386-none
+		i[3456]86-sequent-bsd
+		i960-nindy960-none
+		m68k-hp-bsd4.3
+		m68k-mvme135-none
+		m68k-mvme136-none
+		m68k-sony-newsos3
+		m68k-sony-newsos4
+		m68k-sun-sunos4
+		mips-dec-ultrix4
+		mips-sgi-irix4
+		sparc-sun-solaris2
+		sparc-sun-sunos4
+
+Since no one has volunteered to test and fix the above configurations,
+these are not supported at the moment.  It's expected that these don't
+work anymore.  Porting the library is not hard.  If you are interested
+in doing a port, please contact the glibc maintainers by sending
+electronic mail to <bug-glibc@gnu.org>.
+
+There are some add-ons which can be used together with GNU libc.  They
+are designed in a way to ease the installation by integrating them in
+the libc source tree.  Simply get the add-ons you need and use the
+--enable-add-ons option of the `configure' script to tell where the
+add-ons are found.  Please read the FAQ file for more details.
+
+See the file INSTALL to find out how to configure, build, install, and port
+the GNU C library.  You might also consider reading the WWW pages for the
+GNU libc at http://www.gnu.org/software/libc/libc.html.
+
+The GNU C Library is completely documented by the Texinfo manual found
+in the `manual/' subdirectory.  The manual is still being updated and
+contains some known errors and omissions; we regret that we do not
+have the resources to work on the manual as much as we would like.
+Please send comments on the manual to <bug-glibc-manual@gnu.org>, and
+not to the library bug-reporting address.
+
+The file NOTES contains a description of the feature-test macros used
+in the GNU C library, explaining how you can tell the library what
+facilities you want it to make available.
+
+We prefer to get bug reports sent using the `glibcbug' shell script which
+is installed together with the rest of the GNU libc to <bugs@gnu.org>.
+Simply run this shell script and fill in the information.  Nevertheless
+you can still send bug reports to <bug-glibc@gnu.org> as normal electronic
+mails.
+
+The GNU C Library is free software.  See the file COPYING.LIB for copying
+conditions, and LICENSES for notices about a few contributions that require
+these additional notices to be distributed.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/Versions.def libc-20030708/Versions.def
--- glibc-2.3.2/Versions.def	2002-12-11 04:05:17.000000000 +0900
+++ libc-20030708/Versions.def	2003-03-28 21:28:14.000000000 +0900
@@ -18,6 +18,7 @@
   GLIBC_2.3
   GLIBC_2.3.1
   GLIBC_2.3.2
+  GLIBC_2.3.3
 %ifdef USE_IN_LIBIO
   HURD_CTHREADS_0.3
 %endif
@@ -32,6 +33,7 @@
 libdl {
   GLIBC_2.0
   GLIBC_2.1
+  GLIBC_2.3.3
 }
 libm {
   GLIBC_2.0
@@ -71,6 +73,7 @@
   GLIBC_2.2.3
   GLIBC_2.2.6
   GLIBC_2.3.2
+  GLIBC_2.3.3
   GLIBC_PRIVATE
 }
 libresolv {
@@ -82,6 +85,7 @@
   GLIBC_2.1
   GLIBC_2.2
   GLIBC_2.3
+  GLIBC_2.3.3
 }
 libutil {
   GLIBC_2.0
@@ -96,6 +100,7 @@
   GLIBC_2.1.3
   GLIBC_2.2.3
   GLIBC_2.3
+  GLIBC_2.3.3
 }
 libanl {
   GLIBC_2.2.3
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/ld.abilist libc-20030708/abilist/ld.abilist
--- glibc-2.3.2/abilist/ld.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/ld.abilist	2003-04-02 13:39:52.000000000 +0900
@@ -0,0 +1,35 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.0 A
+ _r_debug D 0x14
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __libc_memalign F
+ calloc F
+ free F
+ malloc F
+ realloc F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1 A
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _dl_mcount F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _r_debug D 0x28
+GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3 A
+GLIBC_2.3 i.86-.*-linux.*/thread i.86-.*-linux.*/tls
+ ___tls_get_addr F
+GLIBC_2.3 i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread x86_64-.*-linux.*/tls
+ __tls_get_addr F
+GLIBC_2.3 s390-.*-linux.*/tls s390x-.*-linux.*/tls
+ __tls_get_offset F
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libBrokenLocale.abilist libc-20030708/abilist/libBrokenLocale.abilist
--- glibc-2.3.2/abilist/libBrokenLocale.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libBrokenLocale.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,13 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.0 A
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __ctype_get_mb_cur_max F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libanl.abilist libc-20030708/abilist/libanl.abilist
--- glibc-2.3.2/abilist/libanl.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libanl.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,13 @@
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2.3 A
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ gai_cancel F
+ gai_error F
+ gai_suspend F
+ getaddrinfo_a F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libc.abilist libc-20030708/abilist/libc.abilist
--- glibc-2.3.2/abilist/libc.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libc.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,2231 @@
+GCC_3.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GCC_3.0 A
+ _Unwind_Find_FDE F
+ __deregister_frame_info_bases F
+ __register_frame_info_bases F
+ __register_frame_info_table_bases F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls
+ __fpu_control D 0x2
+ vm86 F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.0 A
+ _IO_stderr_ D 0x50
+ _IO_stdin_ D 0x50
+ _IO_stdout_ D 0x50
+ __strtoq_internal F
+ __strtouq_internal F
+ _sys_errlist D 0x1ec
+ _sys_siglist D 0x80
+ res_init F
+ sys_errlist D 0x1ec
+ sys_sigabbrev D 0x80
+ sys_siglist D 0x80
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.1.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ getaliasbyname_r F
+ getaliasent_r F
+ getgrent_r F
+ getgrgid_r F
+ getgrnam_r F
+ gethostbyaddr_r F
+ gethostbyname2_r F
+ gethostbyname_r F
+ gethostent_r F
+ getnetbyaddr_r F
+ getnetbyname_r F
+ getnetent_r F
+ getprotobyname_r F
+ getprotobynumber_r F
+ getprotoent_r F
+ getpwent_r F
+ getpwnam_r F
+ getpwuid_r F
+ getrpcbyname_r F
+ getrpcbynumber_r F
+ getrpcent_r F
+ getservbyname_r F
+ getservbyport_r F
+ getservent_r F
+ getspent_r F
+ getspnam_r F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ _sys_nerr D 0x4
+ sys_nerr D 0x4
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_do_write F
+ _IO_fclose F
+ _IO_fdopen F
+ _IO_file_attach F
+ _IO_file_close_it F
+ _IO_file_fopen F
+ _IO_file_init F
+ _IO_file_overflow F
+ _IO_file_seekoff F
+ _IO_file_setbuf F
+ _IO_file_sync F
+ _IO_file_underflow F
+ _IO_file_write F
+ _IO_file_xsputn F
+ _IO_fopen F
+ _IO_popen F
+ _IO_proc_close F
+ _IO_proc_open F
+ fclose F
+ fdopen F
+ fopen F
+ pclose F
+ popen F
+ pthread_attr_init F
+ tmpfile F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ chown F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ fnmatch F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_fgetpos F
+ _IO_fsetpos F
+ fgetpos F
+ fopencookie F
+ fsetpos F
+ getrlimit F
+ localeconv F
+ msgctl F
+ semctl F
+ setrlimit F
+ shmctl F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ re_max_failures D 0x4
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ pthread_cond_broadcast F
+ pthread_cond_destroy F
+ pthread_cond_init F
+ pthread_cond_signal F
+ pthread_cond_wait F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ realpath F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_adjust_column F
+ _IO_default_doallocate F
+ _IO_default_finish F
+ _IO_default_pbackfail F
+ _IO_default_uflow F
+ _IO_default_xsgetn F
+ _IO_default_xsputn F
+ _IO_doallocbuf F
+ _IO_feof F
+ _IO_ferror F
+ _IO_fflush F
+ _IO_fgets F
+ _IO_file_close F
+ _IO_file_doallocate F
+ _IO_file_open F
+ _IO_file_read F
+ _IO_file_seek F
+ _IO_file_stat F
+ _IO_flockfile F
+ _IO_flush_all F
+ _IO_flush_all_linebuffered F
+ _IO_fprintf F
+ _IO_fputs F
+ _IO_fread F
+ _IO_free_backup_area F
+ _IO_ftell F
+ _IO_ftrylockfile F
+ _IO_funlockfile F
+ _IO_fwrite F
+ _IO_getc F
+ _IO_getline F
+ _IO_gets F
+ _IO_init F
+ _IO_init_marker F
+ _IO_link_in F
+ _IO_marker_delta F
+ _IO_marker_difference F
+ _IO_padn F
+ _IO_peekc_locked F
+ _IO_printf F
+ _IO_putc F
+ _IO_puts F
+ _IO_remove_marker F
+ _IO_seekmark F
+ _IO_seekoff F
+ _IO_seekpos F
+ _IO_setb F
+ _IO_setbuffer F
+ _IO_setvbuf F
+ _IO_sgetn F
+ _IO_sprintf F
+ _IO_sputbackc F
+ _IO_sscanf F
+ _IO_str_init_readonly F
+ _IO_str_init_static F
+ _IO_str_overflow F
+ _IO_str_pbackfail F
+ _IO_str_seekoff F
+ _IO_str_underflow F
+ _IO_sungetc F
+ _IO_switch_to_get_mode F
+ _IO_un_link F
+ _IO_ungetc F
+ _IO_unsave_markers F
+ _IO_vfprintf F
+ _IO_vfscanf F
+ _IO_vsprintf F
+ __adjtimex F
+ __argz_count F
+ __argz_next F
+ __argz_stringify F
+ __assert_fail F
+ __assert_perror_fail F
+ __bsd_getpgrp F
+ __check_rhosts_file D 0x4
+ __close F
+ __cmsg_nxthdr F
+ __connect F
+ __ctype_get_mb_cur_max F
+ __daylight D 0x4
+ __dcgettext F
+ __default_morecore F
+ __dgettext F
+ __dup2 F
+ __errno_location F
+ __fcntl F
+ __ffs F
+ __finite F
+ __finitef F
+ __finitel F
+ __fxstat F
+ __getdelim F
+ __getpagesize F
+ __getpgid F
+ __getpid F
+ __gettimeofday F
+ __gmtime_r F
+ __h_errno_location F
+ __isinf F
+ __isinff F
+ __isinfl F
+ __isnan F
+ __isnanf F
+ __isnanl F
+ __iswctype F
+ __ivaliduser F
+ __libc_calloc F
+ __libc_free F
+ __libc_init_first F
+ __libc_mallinfo F
+ __libc_malloc F
+ __libc_mallopt F
+ __libc_memalign F
+ __libc_pvalloc F
+ __libc_realloc F
+ __libc_start_main F
+ __libc_valloc F
+ __lseek F
+ __lxstat F
+ __mbrlen F
+ __mbrtowc F
+ __mempcpy F
+ __monstartup F
+ __nss_configure_lookup F
+ __nss_database_lookup F
+ __nss_group_lookup F
+ __nss_hosts_lookup F
+ __nss_next F
+ __nss_passwd_lookup F
+ __open F
+ __overflow F
+ __pipe F
+ __printf_fp F
+ __profile_frequency F
+ __read F
+ __res_randomid F
+ __sbrk F
+ __sched_get_priority_max F
+ __sched_get_priority_min F
+ __sched_getparam F
+ __sched_getscheduler F
+ __sched_setscheduler F
+ __sched_yield F
+ __secure_getenv F
+ __select F
+ __send F
+ __setpgid F
+ __sigaction F
+ __sigaddset F
+ __sigdelset F
+ __sigismember F
+ __sigpause F
+ __sigsetjmp F
+ __stpcpy F
+ __stpncpy F
+ __strcasecmp F
+ __strdup F
+ __strerror_r F
+ __strtod_internal F
+ __strtof_internal F
+ __strtok_r F
+ __strtol_internal F
+ __strtold_internal F
+ __strtoll_internal F
+ __strtoul_internal F
+ __strtoull_internal F
+ __sysv_signal F
+ __uflow F
+ __underflow F
+ __vfscanf F
+ __vsnprintf F
+ __vsscanf F
+ __wait F
+ __waitpid F
+ __wcstod_internal F
+ __wcstof_internal F
+ __wcstol_internal F
+ __wcstold_internal F
+ __wcstoll_internal F
+ __wcstoul_internal F
+ __wcstoull_internal F
+ __write F
+ __xmknod F
+ __xpg_basename F
+ __xstat F
+ _exit F
+ _libc_intl_domainname D 0x5
+ _longjmp F
+ _mcleanup F
+ _mcount F
+ _nl_msg_cat_cntr D 0x4
+ _obstack_allocated_p F
+ _obstack_begin F
+ _obstack_begin_1 F
+ _obstack_free F
+ _obstack_memory_used F
+ _obstack_newchunk F
+ _rpc_dtablesize F
+ _seterr_reply F
+ _setjmp F
+ _tolower F
+ _toupper F
+ a64l F
+ abort F
+ abs F
+ accept F
+ access F
+ acct F
+ addmntent F
+ adjtime F
+ adjtimex F
+ advance F
+ alarm F
+ alphasort F
+ argz_add F
+ argz_add_sep F
+ argz_append F
+ argz_count F
+ argz_create F
+ argz_create_sep F
+ argz_delete F
+ argz_extract F
+ argz_insert F
+ argz_next F
+ argz_replace F
+ argz_stringify F
+ asctime F
+ asctime_r F
+ asprintf F
+ atof F
+ atoi F
+ atol F
+ atoll F
+ authnone_create F
+ authunix_create F
+ authunix_create_default F
+ basename F
+ bcmp F
+ bcopy F
+ bdflush F
+ bind F
+ bindresvport F
+ bindtextdomain F
+ brk F
+ bsd_signal F
+ bsearch F
+ btowc F
+ bzero F
+ calloc F
+ callrpc F
+ canonicalize_file_name F
+ catclose F
+ catgets F
+ catopen F
+ cfgetispeed F
+ cfgetospeed F
+ cfmakeraw F
+ cfree F
+ cfsetispeed F
+ cfsetospeed F
+ cfsetspeed F
+ chdir F
+ chflags F
+ chmod F
+ chroot F
+ clearenv F
+ clearerr F
+ clearerr_unlocked F
+ clnt_broadcast F
+ clnt_create F
+ clnt_pcreateerror F
+ clnt_perrno F
+ clnt_perror F
+ clnt_spcreateerror F
+ clnt_sperrno F
+ clnt_sperror F
+ clntraw_create F
+ clnttcp_create F
+ clntudp_bufcreate F
+ clntudp_create F
+ clock F
+ close F
+ closedir F
+ closelog F
+ confstr F
+ connect F
+ copysign F
+ copysignf F
+ copysignl F
+ creat F
+ create_module F
+ ctermid F
+ ctime F
+ ctime_r F
+ cuserid F
+ daemon F
+ daylight D 0x4
+ dcgettext F
+ delete_module F
+ dgettext F
+ difftime F
+ dirfd F
+ dirname F
+ div F
+ dprintf F
+ drand48 F
+ drand48_r F
+ dup F
+ dup2 F
+ dysize F
+ ecvt F
+ ecvt_r F
+ endaliasent F
+ endfsent F
+ endgrent F
+ endhostent F
+ endmntent F
+ endnetent F
+ endnetgrent F
+ endprotoent F
+ endpwent F
+ endrpcent F
+ endservent F
+ endspent F
+ endttyent F
+ endusershell F
+ endutent F
+ envz_add F
+ envz_entry F
+ envz_get F
+ envz_merge F
+ envz_remove F
+ envz_strip F
+ erand48 F
+ erand48_r F
+ err F
+ error F
+ error_at_line F
+ error_message_count D 0x4
+ error_one_per_line D 0x4
+ errx F
+ ether_aton F
+ ether_aton_r F
+ ether_hostton F
+ ether_line F
+ ether_ntoa F
+ ether_ntoa_r F
+ ether_ntohost F
+ euidaccess F
+ execl F
+ execle F
+ execlp F
+ execv F
+ execve F
+ execvp F
+ exit F
+ fchdir F
+ fchflags F
+ fchmod F
+ fchown F
+ fcloseall F
+ fcntl F
+ fcvt F
+ fcvt_r F
+ fdatasync F
+ feof F
+ feof_unlocked F
+ ferror F
+ ferror_unlocked F
+ fexecve F
+ fflush F
+ fflush_unlocked F
+ ffs F
+ fgetc F
+ fgetgrent F
+ fgetgrent_r F
+ fgetpwent F
+ fgetpwent_r F
+ fgets F
+ fgetspent F
+ fgetspent_r F
+ fileno F
+ fileno_unlocked F
+ finite F
+ finitef F
+ finitel F
+ flock F
+ flockfile F
+ fork F
+ fpathconf F
+ fprintf F
+ fputc F
+ fputc_unlocked F
+ fputs F
+ fread F
+ free F
+ freeaddrinfo F
+ freopen F
+ frexp F
+ frexpf F
+ frexpl F
+ fscanf F
+ fseek F
+ fstatfs F
+ fsync F
+ ftell F
+ ftime F
+ ftok F
+ ftruncate F
+ ftrylockfile F
+ fts_children F
+ fts_close F
+ fts_open F
+ fts_read F
+ fts_set F
+ ftw F
+ funlockfile F
+ fwrite F
+ gcvt F
+ get_avphys_pages F
+ get_current_dir_name F
+ get_kernel_syms F
+ get_myaddress F
+ get_nprocs F
+ get_nprocs_conf F
+ get_phys_pages F
+ getaddrinfo F
+ getaliasbyname F
+ getaliasent F
+ getc F
+ getc_unlocked F
+ getchar F
+ getchar_unlocked F
+ getcwd F
+ getdelim F
+ getdirentries F
+ getdomainname F
+ getdtablesize F
+ getegid F
+ getenv F
+ geteuid F
+ getfsent F
+ getfsfile F
+ getfsspec F
+ getgid F
+ getgrent F
+ getgrgid F
+ getgrnam F
+ getgroups F
+ gethostbyaddr F
+ gethostbyname F
+ gethostbyname2 F
+ gethostent F
+ gethostid F
+ gethostname F
+ getitimer F
+ getline F
+ getlogin F
+ getlogin_r F
+ getmntent F
+ getmntent_r F
+ getnetbyaddr F
+ getnetbyname F
+ getnetent F
+ getnetgrent F
+ getnetgrent_r F
+ getopt F
+ getopt_long F
+ getopt_long_only F
+ getpagesize F
+ getpass F
+ getpeername F
+ getpgid F
+ getpgrp F
+ getpid F
+ getppid F
+ getpriority F
+ getprotobyname F
+ getprotobynumber F
+ getprotoent F
+ getpublickey F
+ getpw F
+ getpwent F
+ getpwnam F
+ getpwuid F
+ getresgid F
+ getresuid F
+ getrpcbyname F
+ getrpcbynumber F
+ getrpcent F
+ getrpcport F
+ getrusage F
+ gets F
+ getsecretkey F
+ getservbyname F
+ getservbyport F
+ getservent F
+ getsid F
+ getsockname F
+ getsockopt F
+ getspent F
+ getspnam F
+ getsubopt F
+ gettext F
+ gettimeofday F
+ getttyent F
+ getttynam F
+ getuid F
+ getusershell F
+ getutent F
+ getutent_r F
+ getutid F
+ getutid_r F
+ getutline F
+ getutline_r F
+ getw F
+ getwd F
+ glob F
+ glob_pattern_p F
+ globfree F
+ gmtime F
+ gmtime_r F
+ group_member F
+ gsignal F
+ gtty F
+ h_nerr D 0x4
+ hasmntopt F
+ hcreate F
+ hcreate_r F
+ hdestroy F
+ hdestroy_r F
+ herror F
+ hsearch F
+ hsearch_r F
+ hstrerror F
+ htonl F
+ htons F
+ index F
+ inet_addr F
+ inet_aton F
+ inet_lnaof F
+ inet_makeaddr F
+ inet_netof F
+ inet_network F
+ inet_nsap_addr F
+ inet_nsap_ntoa F
+ inet_ntoa F
+ inet_ntop F
+ inet_pton F
+ init_module F
+ initgroups F
+ initstate F
+ initstate_r F
+ innetgr F
+ insque F
+ ioctl F
+ iruserok F
+ isalnum F
+ isalpha F
+ isascii F
+ isatty F
+ isblank F
+ iscntrl F
+ isdigit F
+ isfdtype F
+ isgraph F
+ isinf F
+ isinff F
+ isinfl F
+ islower F
+ isnan F
+ isnanf F
+ isnanl F
+ isprint F
+ ispunct F
+ isspace F
+ isupper F
+ iswalnum F
+ iswalpha F
+ iswcntrl F
+ iswctype F
+ iswdigit F
+ iswgraph F
+ iswlower F
+ iswprint F
+ iswpunct F
+ iswspace F
+ iswupper F
+ iswxdigit F
+ isxdigit F
+ jrand48 F
+ jrand48_r F
+ kill F
+ killpg F
+ klogctl F
+ l64a F
+ labs F
+ lchown F
+ lckpwdf F
+ lcong48 F
+ lcong48_r F
+ ldexp F
+ ldexpf F
+ ldexpl F
+ ldiv F
+ lfind F
+ link F
+ listen F
+ llabs F
+ lldiv F
+ llseek F
+ localtime F
+ localtime_r F
+ lockf F
+ longjmp F
+ lrand48 F
+ lrand48_r F
+ lsearch F
+ lseek F
+ madvise F
+ mallinfo F
+ malloc F
+ malloc_get_state F
+ malloc_set_state F
+ malloc_stats F
+ malloc_trim F
+ malloc_usable_size F
+ mallopt F
+ mblen F
+ mbrlen F
+ mbrtowc F
+ mbsinit F
+ mbsnrtowcs F
+ mbsrtowcs F
+ mbstowcs F
+ mbtowc F
+ mcheck F
+ memalign F
+ memccpy F
+ memchr F
+ memcmp F
+ memcpy F
+ memfrob F
+ memmem F
+ memmove F
+ memset F
+ mkdir F
+ mkfifo F
+ mkstemp F
+ mktemp F
+ mktime F
+ mlock F
+ mlockall F
+ mmap F
+ modf F
+ modff F
+ modfl F
+ monstartup F
+ mount F
+ mprobe F
+ mprotect F
+ mrand48 F
+ mrand48_r F
+ mremap F
+ msgget F
+ msgrcv F
+ msgsnd F
+ msync F
+ mtrace F
+ munlock F
+ munlockall F
+ munmap F
+ muntrace F
+ nanosleep F
+ nfsservctl F
+ nice F
+ nl_langinfo F
+ nrand48 F
+ nrand48_r F
+ ntohl F
+ ntohs F
+ obstack_exit_failure D 0x4
+ obstack_free F
+ obstack_printf F
+ obstack_vprintf F
+ on_exit F
+ open F
+ open_memstream F
+ opendir F
+ openlog F
+ opterr D 0x4
+ optind D 0x4
+ optopt D 0x4
+ parse_printf_format F
+ pathconf F
+ pause F
+ perror F
+ personality F
+ pipe F
+ pmap_getmaps F
+ pmap_getport F
+ pmap_rmtcall F
+ pmap_set F
+ pmap_unset F
+ poll F
+ prctl F
+ printf F
+ profil F
+ pselect F
+ psignal F
+ pthread_attr_destroy F
+ pthread_attr_getdetachstate F
+ pthread_attr_getinheritsched F
+ pthread_attr_getschedparam F
+ pthread_attr_getschedpolicy F
+ pthread_attr_getscope F
+ pthread_attr_setdetachstate F
+ pthread_attr_setinheritsched F
+ pthread_attr_setschedparam F
+ pthread_attr_setschedpolicy F
+ pthread_attr_setscope F
+ pthread_condattr_destroy F
+ pthread_condattr_init F
+ pthread_equal F
+ pthread_exit F
+ pthread_getschedparam F
+ pthread_mutex_destroy F
+ pthread_mutex_init F
+ pthread_mutex_lock F
+ pthread_mutex_unlock F
+ pthread_self F
+ pthread_setcancelstate F
+ pthread_setcanceltype F
+ pthread_setschedparam F
+ ptrace F
+ putc F
+ putc_unlocked F
+ putchar F
+ putchar_unlocked F
+ putenv F
+ putpwent F
+ puts F
+ putspent F
+ pututline F
+ putw F
+ pvalloc F
+ qecvt F
+ qecvt_r F
+ qfcvt F
+ qfcvt_r F
+ qgcvt F
+ qsort F
+ query_module F
+ quotactl F
+ raise F
+ rand F
+ rand_r F
+ random F
+ random_r F
+ rcmd F
+ re_comp F
+ re_compile_fastmap F
+ re_compile_pattern F
+ re_exec F
+ re_match F
+ re_match_2 F
+ re_search F
+ re_search_2 F
+ re_set_registers F
+ re_set_syntax F
+ read F
+ readdir F
+ readdir_r F
+ readlink F
+ readv F
+ realloc F
+ reboot F
+ recv F
+ recvfrom F
+ recvmsg F
+ regcomp F
+ regerror F
+ regexec F
+ regfree F
+ register_printf_function F
+ registerrpc F
+ remove F
+ remque F
+ rename F
+ revoke F
+ rewind F
+ rewinddir F
+ rexec F
+ rexecoptions D 0x4
+ rindex F
+ rmdir F
+ rpmatch F
+ rresvport F
+ ruserok F
+ ruserpass F
+ sbrk F
+ scalbn F
+ scalbnf F
+ scalbnl F
+ scandir F
+ scanf F
+ sched_get_priority_max F
+ sched_get_priority_min F
+ sched_getparam F
+ sched_getscheduler F
+ sched_rr_get_interval F
+ sched_setparam F
+ sched_setscheduler F
+ sched_yield F
+ seed48 F
+ seed48_r F
+ seekdir F
+ select F
+ semget F
+ semop F
+ send F
+ sendmsg F
+ sendto F
+ setaliasent F
+ setbuf F
+ setbuffer F
+ setcontext F
+ setdomainname F
+ setegid F
+ setenv F
+ seteuid F
+ setfsent F
+ setfsgid F
+ setfsuid F
+ setgid F
+ setgrent F
+ setgroups F
+ sethostent F
+ sethostid F
+ sethostname F
+ setitimer F
+ setjmp F
+ setlinebuf F
+ setlocale F
+ setlogin F
+ setlogmask F
+ setmntent F
+ setnetent F
+ setnetgrent F
+ setpgid F
+ setpgrp F
+ setpriority F
+ setprotoent F
+ setpwent F
+ setregid F
+ setresgid F
+ setresuid F
+ setreuid F
+ setrpcent F
+ setservent F
+ setsid F
+ setsockopt F
+ setspent F
+ setstate F
+ setstate_r F
+ settimeofday F
+ setttyent F
+ setuid F
+ setusershell F
+ setutent F
+ setvbuf F
+ sgetspent F
+ sgetspent_r F
+ shmat F
+ shmdt F
+ shmget F
+ shutdown F
+ sigaction F
+ sigaddset F
+ sigaltstack F
+ sigandset F
+ sigblock F
+ sigdelset F
+ sigemptyset F
+ sigfillset F
+ siggetmask F
+ siginterrupt F
+ sigisemptyset F
+ sigismember F
+ siglongjmp F
+ signal F
+ sigorset F
+ sigpause F
+ sigpending F
+ sigprocmask F
+ sigreturn F
+ sigsetmask F
+ sigstack F
+ sigsuspend F
+ sigvec F
+ sigwait F
+ sleep F
+ snprintf F
+ socket F
+ socketpair F
+ sprintf F
+ srand F
+ srand48 F
+ srand48_r F
+ srandom F
+ srandom_r F
+ sscanf F
+ ssignal F
+ sstk F
+ statfs F
+ step F
+ stime F
+ stpcpy F
+ stpncpy F
+ strcasecmp F
+ strcat F
+ strchr F
+ strcmp F
+ strcoll F
+ strcpy F
+ strcspn F
+ strdup F
+ strerror F
+ strerror_r F
+ strfmon F
+ strfry F
+ strftime F
+ strlen F
+ strncasecmp F
+ strncat F
+ strncmp F
+ strncpy F
+ strndup F
+ strnlen F
+ strpbrk F
+ strptime F
+ strrchr F
+ strsep F
+ strsignal F
+ strspn F
+ strstr F
+ strtod F
+ strtof F
+ strtok F
+ strtok_r F
+ strtol F
+ strtold F
+ strtoll F
+ strtoq F
+ strtoul F
+ strtoull F
+ strtouq F
+ strxfrm F
+ stty F
+ svc_exit F
+ svc_fdset D 0x80
+ svc_getreq F
+ svc_getreqset F
+ svc_register F
+ svc_run F
+ svc_sendreply F
+ svc_unregister F
+ svcerr_auth F
+ svcerr_decode F
+ svcerr_noproc F
+ svcerr_noprog F
+ svcerr_progvers F
+ svcerr_systemerr F
+ svcerr_weakauth F
+ svcfd_create F
+ svcraw_create F
+ svctcp_create F
+ svcudp_bufcreate F
+ svcudp_create F
+ svcudp_enablecache F
+ swab F
+ swapoff F
+ swapon F
+ symlink F
+ sync F
+ syscall F
+ sysconf F
+ sysctl F
+ sysinfo F
+ syslog F
+ system F
+ tcdrain F
+ tcflow F
+ tcflush F
+ tcgetattr F
+ tcgetpgrp F
+ tcsendbreak F
+ tcsetattr F
+ tcsetpgrp F
+ tdelete F
+ telldir F
+ tempnam F
+ textdomain F
+ tfind F
+ time F
+ timegm F
+ timelocal F
+ times F
+ tmpnam F
+ tmpnam_r F
+ toascii F
+ tolower F
+ toupper F
+ towctrans F
+ towlower F
+ towupper F
+ tr_break F
+ truncate F
+ tsearch F
+ ttyname F
+ ttyname_r F
+ ttyslot F
+ twalk F
+ tzset F
+ ualarm F
+ ulckpwdf F
+ ulimit F
+ umask F
+ umount F
+ uname F
+ ungetc F
+ unlink F
+ unsetenv F
+ updwtmp F
+ uselib F
+ usleep F
+ ustat F
+ utime F
+ utimes F
+ utmpname F
+ valloc F
+ vasprintf F
+ vdprintf F
+ verr F
+ verrx F
+ vfork F
+ vfprintf F
+ vfscanf F
+ vhangup F
+ vlimit F
+ vprintf F
+ vscanf F
+ vsnprintf F
+ vsprintf F
+ vsscanf F
+ vsyslog F
+ vtimes F
+ vwarn F
+ vwarnx F
+ wait F
+ wait3 F
+ wait4 F
+ waitpid F
+ warn F
+ warnx F
+ wcpcpy F
+ wcpncpy F
+ wcrtomb F
+ wcscat F
+ wcschr F
+ wcscmp F
+ wcscoll F
+ wcscpy F
+ wcscspn F
+ wcsdup F
+ wcslen F
+ wcsncat F
+ wcsncmp F
+ wcsncpy F
+ wcsnrtombs F
+ wcspbrk F
+ wcsrchr F
+ wcsrtombs F
+ wcsspn F
+ wcsstr F
+ wcstod F
+ wcstof F
+ wcstok F
+ wcstol F
+ wcstold F
+ wcstombs F
+ wcstoq F
+ wcstoul F
+ wcstouq F
+ wcswidth F
+ wcsxfrm F
+ wctob F
+ wctomb F
+ wctrans F
+ wctype F
+ wcwidth F
+ wmemchr F
+ wmemcmp F
+ wmemcpy F
+ wmemmove F
+ wmemset F
+ write F
+ writev F
+ xdr_accepted_reply F
+ xdr_array F
+ xdr_authunix_parms F
+ xdr_bool F
+ xdr_bytes F
+ xdr_callhdr F
+ xdr_callmsg F
+ xdr_char F
+ xdr_cryptkeyarg F
+ xdr_cryptkeyarg2 F
+ xdr_cryptkeyres F
+ xdr_des_block F
+ xdr_double F
+ xdr_enum F
+ xdr_float F
+ xdr_free F
+ xdr_int F
+ xdr_key_netstarg F
+ xdr_key_netstres F
+ xdr_keybuf F
+ xdr_keystatus F
+ xdr_long F
+ xdr_netobj F
+ xdr_opaque F
+ xdr_opaque_auth F
+ xdr_pmap F
+ xdr_pmaplist F
+ xdr_pointer F
+ xdr_reference F
+ xdr_rejected_reply F
+ xdr_replymsg F
+ xdr_rmtcall_args F
+ xdr_rmtcallres F
+ xdr_short F
+ xdr_string F
+ xdr_u_char F
+ xdr_u_int F
+ xdr_u_long F
+ xdr_u_short F
+ xdr_union F
+ xdr_vector F
+ xdr_void F
+ xdr_wrapstring F
+ xdrmem_create F
+ xdrrec_create F
+ xdrrec_endofrecord F
+ xdrrec_eof F
+ xdrrec_skiprecord F
+ xdrstdio_create F
+ xencrypt F
+ xprt_register F
+ xprt_unregister F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __fork F
+ _nl_default_dirname D 0x12
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __bzero F
+ __clone F
+ clone F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls
+ __divdi3 F
+ __moddi3 F
+ __udivdi3 F
+ __umoddi3 F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ atexit F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+ __deregister_frame F
+ __frame_state_for F
+ __register_frame F
+ __register_frame_info_table F
+ __register_frame_table F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ __deregister_frame_info F
+ __register_frame_info F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2 sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ _IO_file_jumps D 0x54
+ _IO_list_all D 0x4
+ __after_morecore_hook D 0x4
+ __ctype32_b D 0x4
+ __ctype_b D 0x4
+ __ctype_tolower D 0x4
+ __ctype_toupper D 0x4
+ __curbrk D 0x4
+ __environ D 0x4
+ __free_hook D 0x4
+ __malloc_hook D 0x4
+ __malloc_initialize_hook D 0x4
+ __memalign_hook D 0x4
+ __morecore D 0x4
+ __progname D 0x4
+ __progname_full D 0x4
+ __rcmd_errstr D 0x4
+ __realloc_hook D 0x4
+ __timezone D 0x4
+ __tzname D 0x8
+ _environ D 0x4
+ _nl_domain_bindings D 0x4
+ _null_auth D 0xc
+ _obstack D 0x4
+ environ D 0x4
+ error_print_progname D 0x4
+ h_errlist D 0x14
+ loc1 D 0x4
+ loc2 D 0x4
+ locs D 0x4
+ mallwatch D 0x4
+ obstack_alloc_failed_handler D 0x4
+ optarg D 0x4
+ program_invocation_name D 0x4
+ program_invocation_short_name D 0x4
+ re_syntax_options D 0x4
+ rpc_createerr D 0x10
+ stderr D 0x4
+ stdin D 0x4
+ stdout D 0x4
+ svcauthdes_stats D 0xc
+ timezone D 0x4
+ tzname D 0x8
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls s390-.*-linux.*/tls
+ ___brk_addr D 0x4
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ mcount F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls
+ ioperm F
+ iopl F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls
+ _errno D 0x4
+ _h_errno D 0x4
+ errno D 0x4
+ h_errno D 0x4
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2 sh[34].*-.*-linux.*/notls
+ _res D 0x200
+GLIBC_2.0 m68.*-.*-linux.*/notls
+ _res D 0x1fe
+ cacheflush F
+GLIBC_2.0 m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __fpu_control D 0x4
+GLIBC_2.0 powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls
+ __ashldi3 F
+ __ashrdi3 F
+ __cmpdi2 F
+ __fixdfdi F
+ __fixsfdi F
+ __fixunsdfdi F
+ __fixunssfdi F
+ __floatdidf F
+ __floatdisf F
+ __lshrdi3 F
+ __ucmpdi2 F
+GLIBC_2.1.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls
+ __memcpy_by2 F
+ __memcpy_by4 F
+ __memcpy_g F
+ __mempcpy_by2 F
+ __mempcpy_by4 F
+ __mempcpy_byn F
+ __memset_ccn_by2 F
+ __memset_ccn_by4 F
+ __memset_gcn_by2 F
+ __memset_gcn_by4 F
+ __stpcpy_g F
+ __strcat_c F
+ __strcat_g F
+ __strchr_c F
+ __strchr_g F
+ __strchrnul_c F
+ __strchrnul_g F
+ __strcmp_gg F
+ __strcpy_g F
+ __strcspn_cg F
+ __strcspn_g F
+ __strlen_g F
+ __strncat_g F
+ __strncmp_g F
+ __strncpy_by2 F
+ __strncpy_by4 F
+ __strncpy_byn F
+ __strncpy_gg F
+ __strpbrk_cg F
+ __strpbrk_g F
+ __strrchr_c F
+ __strrchr_g F
+ __strspn_cg F
+ __strspn_g F
+ __strstr_cg F
+ __strstr_g F
+GLIBC_2.1.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1.1 A
+GLIBC_2.1.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _Exit F
+ __mempcpy_small F
+ __stpcpy_small F
+ __strcpy_small F
+ __strcspn_c1 F
+ __strcspn_c2 F
+ __strcspn_c3 F
+ __strpbrk_c2 F
+ __strpbrk_c3 F
+ __strsep_1c F
+ __strsep_2c F
+ __strsep_3c F
+ __strsep_g F
+ __strspn_c1 F
+ __strspn_c2 F
+ __strspn_c3 F
+ __strtok_r_1c F
+ __strverscmp F
+ getutmp F
+ getutmpx F
+ imaxabs F
+ imaxdiv F
+ strchrnul F
+ xdr_hyper F
+ xdr_int64_t F
+ xdr_longlong_t F
+ xdr_u_hyper F
+ xdr_u_longlong_t F
+ xdr_uint64_t F
+GLIBC_2.1.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1.2 A
+GLIBC_2.1.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __vfork F
+GLIBC_2.1.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1.3 A
+GLIBC_2.1.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __cxa_atexit F
+ __cxa_finalize F
+ __sigsuspend F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls
+ scalbln F
+ scalblnf F
+ scalblnl F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1 A
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.2 ia64-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ wordexp F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_fgetpos64 F
+ _IO_fsetpos64 F
+ __fxstat64 F
+ __lxstat64 F
+ __xstat64 F
+ fgetpos64 F
+ fsetpos64 F
+ getrlimit64 F
+ readdir64 F
+ readdir64_r F
+ scandir64 F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ glob64 F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ alphasort64 F
+ versionsort64 F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_file_finish F
+ _IO_getline_info F
+ __asprintf F
+ __backtrace F
+ __backtrace_symbols F
+ __backtrace_symbols_fd F
+ __duplocale F
+ __freelocale F
+ __isalnum_l F
+ __isalpha_l F
+ __isascii_l F
+ __isblank_l F
+ __iscntrl_l F
+ __isdigit_l F
+ __isgraph_l F
+ __islower_l F
+ __isprint_l F
+ __ispunct_l F
+ __isspace_l F
+ __isupper_l F
+ __iswalnum_l F
+ __iswalpha_l F
+ __iswblank_l F
+ __iswcntrl_l F
+ __iswctype_l F
+ __iswdigit_l F
+ __iswgraph_l F
+ __iswlower_l F
+ __iswprint_l F
+ __iswpunct_l F
+ __iswspace_l F
+ __iswupper_l F
+ __iswxdigit_l F
+ __isxdigit_l F
+ __libc_allocate_rtsig F
+ __libc_current_sigrtmax F
+ __libc_current_sigrtmin F
+ __libc_freeres F
+ __libc_sa_len F
+ __newlocale F
+ __poll F
+ __pread64 F
+ __pwrite64 F
+ __rawmemchr F
+ __signbit F
+ __signbitf F
+ __strcasecmp_l F
+ __strcasestr F
+ __strcoll_l F
+ __strfmon_l F
+ __strncasecmp_l F
+ __strtod_l F
+ __strtof_l F
+ __strtol_l F
+ __strtold_l F
+ __strtoll_l F
+ __strtoul_l F
+ __strtoull_l F
+ __strxfrm_l F
+ __toascii_l F
+ __tolower_l F
+ __toupper_l F
+ __towctrans F
+ __towctrans_l F
+ __towlower_l F
+ __towupper_l F
+ __wcscasecmp_l F
+ __wcscoll_l F
+ __wcsncasecmp_l F
+ __wcstod_l F
+ __wcstof_l F
+ __wcstol_l F
+ __wcstold_l F
+ __wcstoll_l F
+ __wcstoul_l F
+ __wcstoull_l F
+ __wcsxfrm_l F
+ __wctype_l F
+ _argp_unlock_xxx F
+ _authenticate F
+ _dl_mcount_wrapper F
+ _dl_mcount_wrapper_check F
+ addseverity F
+ argp_err_exit_status D 0x4
+ argp_error F
+ argp_failure F
+ argp_help F
+ argp_parse F
+ argp_state_help F
+ argp_usage F
+ authdes_create F
+ authdes_getucred F
+ authdes_pk_create F
+ backtrace F
+ backtrace_symbols F
+ backtrace_symbols_fd F
+ capget F
+ capset F
+ cbc_crypt F
+ clntunix_create F
+ creat64 F
+ des_setparity F
+ ecb_crypt F
+ endutxent F
+ fattach F
+ fdetach F
+ ffsl F
+ ffsll F
+ fgetc_unlocked F
+ fgets_unlocked F
+ fmtmsg F
+ fopen64 F
+ fputs_unlocked F
+ fread_unlocked F
+ freopen64 F
+ fseeko F
+ fseeko64 F
+ fstatfs64 F
+ fstatvfs F
+ fstatvfs64 F
+ ftello F
+ ftello64 F
+ ftruncate64 F
+ ftw64 F
+ fwrite_unlocked F
+ gai_strerror F
+ getcontext F
+ getdate F
+ getdate_err D 0x4
+ getdate_r F
+ getmsg F
+ getnameinfo F
+ getnetname F
+ getpmsg F
+ getpt F
+ getutxent F
+ getutxid F
+ getutxline F
+ globfree64 F
+ gnu_get_libc_release F
+ gnu_get_libc_version F
+ grantpt F
+ host2netname F
+ iconv F
+ iconv_close F
+ iconv_open F
+ if_freenameindex F
+ if_indextoname F
+ if_nameindex F
+ if_nametoindex F
+ in6addr_any D 0x10
+ in6addr_loopback D 0x10
+ isastream F
+ iswblank F
+ key_decryptsession F
+ key_decryptsession_pk F
+ key_encryptsession F
+ key_encryptsession_pk F
+ key_gendes F
+ key_get_conv F
+ key_secretkey_is_set F
+ key_setnet F
+ key_setsecret F
+ lockf64 F
+ lseek64 F
+ makecontext F
+ mempcpy F
+ mmap64 F
+ netname2host F
+ netname2user F
+ nftw F
+ nftw64 F
+ ntp_adjtime F
+ ntp_gettime F
+ open64 F
+ passwd2des F
+ pread F
+ pread64 F
+ printf_size F
+ printf_size_info F
+ ptsname F
+ ptsname_r F
+ putgrent F
+ putmsg F
+ putpmsg F
+ pututxline F
+ pwrite F
+ pwrite64 F
+ rawmemchr F
+ rtime F
+ sendfile F
+ setrlimit64 F
+ setutxent F
+ sighold F
+ sigignore F
+ sigqueue F
+ sigrelse F
+ sigset F
+ sigtimedwait F
+ sigwaitinfo F
+ statfs64 F
+ statvfs F
+ statvfs64 F
+ strcasestr F
+ strtoimax F
+ strtoumax F
+ strverscmp F
+ svcunix_create F
+ svcunixfd_create F
+ swapcontext F
+ sysv_signal F
+ tcgetsid F
+ tdestroy F
+ tmpfile64 F
+ truncate64 F
+ umount2 F
+ unlockpt F
+ updwtmpx F
+ user2netname F
+ utmpxname F
+ versionsort F
+ waitid F
+ wcscasecmp F
+ wcsncasecmp F
+ wcsnlen F
+ wcstoimax F
+ wcstoll F
+ wcstoull F
+ wcstoumax F
+ wcswcs F
+ wordfree F
+ xdecrypt F
+ xdr_authdes_cred F
+ xdr_authdes_verf F
+ xdr_getcredres F
+ xdr_int16_t F
+ xdr_int32_t F
+ xdr_int8_t F
+ xdr_netnamestr F
+ xdr_sizeof F
+ xdr_uint16_t F
+ xdr_uint32_t F
+ xdr_uint8_t F
+ xdr_unixcred F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2 sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ __key_decryptsession_pk_LOCAL D 0x4
+ __key_encryptsession_pk_LOCAL D 0x4
+ __key_gendes_LOCAL D 0x4
+ _sys_errlist D 0x1f4
+ _sys_siglist D 0x100
+ argp_program_bug_address D 0x4
+ argp_program_version D 0x4
+ argp_program_version_hook D 0x4
+ sys_errlist D 0x1f4
+ sys_sigabbrev D 0x100
+ sys_siglist D 0x100
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls
+ __signbitl F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls
+| GLIBC_2.2 sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ _IO_2_1_stderr_ D 0x98
+ _IO_2_1_stdin_ D 0x98
+ _IO_2_1_stdout_ D 0x98
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ modify_ldt F
+GLIBC_2.1 powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ _IO_2_1_stderr_ D 0xa0
+ _IO_2_1_stdin_ D 0xa0
+ _IO_2_1_stdout_ D 0xa0
+GLIBC_2.1 s390-.*-linux.*/tls
+ __chown F
+GLIBC_2.2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2.1 A
+GLIBC_2.2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ pivot_root F
+ posix_openpt F
+GLIBC_2.2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2.2 A
+GLIBC_2.2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __nss_hostname_digits_dots F
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2.3 A
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __rpc_thread_createerr F
+ __rpc_thread_svc_fdset F
+ __rpc_thread_svc_max_pollfd F
+ __rpc_thread_svc_pollfd F
+ sprofil F
+GLIBC_2.2.4 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2.4 A
+GLIBC_2.2.4 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ dl_iterate_phdr F
+ getgrouplist F
+ sockatmark F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+ __arch_prctl F
+ arch_prctl F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_adjust_wcolumn F
+ _IO_free_wbackup_area F
+ _IO_init_wmarker F
+ _IO_iter_begin F
+ _IO_iter_end F
+ _IO_iter_file F
+ _IO_iter_next F
+ _IO_least_wmarker F
+ _IO_list_lock F
+ _IO_list_resetlock F
+ _IO_list_unlock F
+ _IO_seekwmark F
+ _IO_sputbackwc F
+ _IO_sungetwc F
+ _IO_switch_to_main_wget_area F
+ _IO_switch_to_wbackup_area F
+ _IO_switch_to_wget_mode F
+ _IO_unsave_wmarkers F
+ _IO_wdefault_doallocate F
+ _IO_wdefault_finish F
+ _IO_wdefault_pbackfail F
+ _IO_wdefault_uflow F
+ _IO_wdefault_xsgetn F
+ _IO_wdefault_xsputn F
+ _IO_wdo_write F
+ _IO_wdoallocbuf F
+ _IO_wfile_overflow F
+ _IO_wfile_seekoff F
+ _IO_wfile_sync F
+ _IO_wfile_underflow F
+ _IO_wfile_xsputn F
+ _IO_wmarker_delta F
+ _IO_wsetb F
+ __assert F
+ __cyg_profile_func_enter F
+ __cyg_profile_func_exit F
+ __endmntent F
+ __fbufsize F
+ __flbf F
+ __fpending F
+ __fpurge F
+ __freadable F
+ __freading F
+ __fsetlocking F
+ __fwritable F
+ __fwriting F
+ __getmntent_r F
+ __nl_langinfo_l F
+ __open64 F
+ __res_init F
+ __res_nclose F
+ __res_ninit F
+ __res_state F
+ __setmntent F
+ __statfs F
+ __strndup F
+ __sysconf F
+ __sysctl F
+ __wctrans_l F
+ __woverflow F
+ __wuflow F
+ __wunderflow F
+ __xpg_sigpause F
+ _flushlbf F
+ bind_textdomain_codeset F
+ dcngettext F
+ dngettext F
+ fgetwc F
+ fgetwc_unlocked F
+ fgetws F
+ fgetws_unlocked F
+ fmemopen F
+ fputwc F
+ fputwc_unlocked F
+ fputws F
+ fputws_unlocked F
+ fwide F
+ fwprintf F
+ fwscanf F
+ getdirentries64 F
+ getloadavg F
+ getwc F
+ getwc_unlocked F
+ getwchar F
+ getwchar_unlocked F
+ iruserok_af F
+ mcheck_check_all F
+ mcheck_pedantic F
+ memrchr F
+ mincore F
+ mkdtemp F
+ mkstemp64 F
+ moncontrol F
+ ngettext F
+ posix_fadvise F
+ posix_fadvise64 F
+ posix_fallocate F
+ posix_fallocate64 F
+ posix_madvise F
+ posix_memalign F
+ posix_spawn F
+ posix_spawn_file_actions_addclose F
+ posix_spawn_file_actions_adddup2 F
+ posix_spawn_file_actions_addopen F
+ posix_spawn_file_actions_destroy F
+ posix_spawn_file_actions_init F
+ posix_spawnattr_destroy F
+ posix_spawnattr_getflags F
+ posix_spawnattr_getpgroup F
+ posix_spawnattr_getschedparam F
+ posix_spawnattr_getschedpolicy F
+ posix_spawnattr_getsigdefault F
+ posix_spawnattr_getsigmask F
+ posix_spawnattr_init F
+ posix_spawnattr_setflags F
+ posix_spawnattr_setpgroup F
+ posix_spawnattr_setschedparam F
+ posix_spawnattr_setschedpolicy F
+ posix_spawnattr_setsigdefault F
+ posix_spawnattr_setsigmask F
+ posix_spawnp F
+ putwc F
+ putwc_unlocked F
+ putwchar F
+ putwchar_unlocked F
+ rcmd_af F
+ rexec_af F
+ rresvport_af F
+ ruserok_af F
+ svc_getreq_common F
+ svc_getreq_poll F
+ svc_max_pollfd D 0x4
+ swprintf F
+ swscanf F
+ ungetwc F
+ vfwprintf F
+ vfwscanf F
+ vswprintf F
+ vswscanf F
+ vwprintf F
+ vwscanf F
+ wcschrnul F
+ wcsftime F
+ wmempcpy F
+ wprintf F
+ wscanf F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+ __ctype32_b D 0x8
+ __ctype32_tolower D 0x8
+ __ctype32_toupper D 0x8
+ __ctype_b D 0x8
+ __ctype_tolower D 0x8
+ __ctype_toupper D 0x8
+ _res D 0x238
+ _sys_errlist D 0x3e8
+ sys_errlist D 0x3e8
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_2_1_stderr_ D 0xe0
+ _IO_2_1_stdin_ D 0xe0
+ _IO_2_1_stdout_ D 0xe0
+ _IO_file_jumps D 0xa8
+ _IO_list_all D 0x8
+ _IO_wfile_jumps D 0xa8
+ __after_morecore_hook D 0x8
+ __curbrk D 0x8
+ __environ D 0x8
+ __free_hook D 0x8
+ __key_decryptsession_pk_LOCAL D 0x8
+ __key_encryptsession_pk_LOCAL D 0x8
+ __key_gendes_LOCAL D 0x8
+ __malloc_hook D 0x8
+ __malloc_initialize_hook D 0x8
+ __memalign_hook D 0x8
+ __morecore D 0x8
+ __progname D 0x8
+ __progname_full D 0x8
+ __rcmd_errstr D 0x8
+ __realloc_hook D 0x8
+ __timezone D 0x8
+ __tzname D 0x10
+ _environ D 0x8
+ _nl_domain_bindings D 0x8
+ _null_auth D 0x18
+ _obstack D 0x8
+ _res_hconf D 0x48
+ _sys_siglist D 0x200
+ argp_program_bug_address D 0x8
+ argp_program_version D 0x8
+ argp_program_version_hook D 0x8
+ environ D 0x8
+ error_print_progname D 0x8
+ h_errlist D 0x28
+ loc1 D 0x8
+ loc2 D 0x8
+ locs D 0x8
+ mallwatch D 0x8
+ obstack_alloc_failed_handler D 0x8
+ optarg D 0x8
+ program_invocation_name D 0x8
+ program_invocation_short_name D 0x8
+ re_syntax_options D 0x8
+ rpc_createerr D 0x20
+ stderr D 0x8
+ stdin D 0x8
+ stdout D 0x8
+ svc_pollfd D 0x8
+ svcauthdes_stats D 0x18
+ sys_sigabbrev D 0x200
+ sys_siglist D 0x200
+ timezone D 0x8
+ tzname D 0x10
+GLIBC_2.2.6 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.2.6 A
+GLIBC_2.2.6 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __nanosleep F
+GLIBC_2.2.6 ia64-.*-linux.*/tls
+ getunwind F
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ __ctype32_tolower D 0x4
+ __ctype32_toupper D 0x4
+ _res_hconf D 0x30
+ svc_pollfd D 0x4
+GLIBC_2.2 i.86-.*-linux.*/thread i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ _IO_wfile_jumps D 0x54
+GLIBC_2.2 ia64-.*-linux.*/tls
+ __clone2 F
+ __divdf3 F
+ __divsf3 F
+ __divtf3 F
+ __multi3 F
+ _inb F
+ _inl F
+ _inw F
+ _outb F
+ _outl F
+ _outw F
+ inb F
+ inl F
+ inw F
+ outb F
+ outw F
+ pciconfig_read F
+ pciconfig_write F
+GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls
+ ___brk_addr D 0x8
+GLIBC_2.2 sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ _nl_default_dirname D 0x20
+GLIBC_2.3.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3.2 A
+ __register_atfork F
+ lchmod F
+ sched_getaffinity F
+ sched_setaffinity F
+ strptime_l F
+GLIBC_2.3.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls x86_64-.*-linux.*/tls
+ epoll_create F
+ epoll_ctl F
+ epoll_wait F
+GLIBC_2.3.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3.3 A
+ remap_file_pages F
+GLIBC_2.3.3 i.86-.*-linux.*/thread i.86-.*-linux.*/tls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls
+ _sys_siglist D 0x104
+ sys_sigabbrev D 0x104
+ sys_siglist D 0x104
+GLIBC_2.3.3 ia64-.*-linux.*/tls powerpc64-.*-linux.*/thread s390x-.*-linux.*/tls x86_64-.*-linux.*/tls
+| GLIBC_2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ strtoll_l F
+ strtoull_l F
+GLIBC_2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3 A
+ __ctype_b_loc F
+ __ctype_tolower_loc F
+ __ctype_toupper_loc F
+ __isctype F
+ __strftime_l F
+ __uselocale F
+ __wcsftime_l F
+ duplocale F
+ fgetxattr F
+ flistxattr F
+ freeifaddrs F
+ freelocale F
+ fremovexattr F
+ fsetxattr F
+ futimes F
+ getifaddrs F
+ getxattr F
+ isalnum_l F
+ isalpha_l F
+ isblank_l F
+ iscntrl_l F
+ isctype F
+ isdigit_l F
+ isgraph_l F
+ islower_l F
+ isprint_l F
+ ispunct_l F
+ isspace_l F
+ isupper_l F
+ iswalnum_l F
+ iswalpha_l F
+ iswblank_l F
+ iswcntrl_l F
+ iswctype_l F
+ iswdigit_l F
+ iswgraph_l F
+ iswlower_l F
+ iswprint_l F
+ iswpunct_l F
+ iswspace_l F
+ iswupper_l F
+ iswxdigit_l F
+ isxdigit_l F
+ lgetxattr F
+ listxattr F
+ llistxattr F
+ lremovexattr F
+ lsetxattr F
+ lutimes F
+ newlocale F
+ nl_langinfo_l F
+ readahead F
+ removexattr F
+ sendfile64 F
+ setxattr F
+ strcasecmp_l F
+ strcoll_l F
+ strfmon_l F
+ strftime_l F
+ strncasecmp_l F
+ strtod_l F
+ strtof_l F
+ strtol_l F
+ strtold_l F
+ strtoul_l F
+ strxfrm_l F
+ tolower_l F
+ toupper_l F
+ towctrans_l F
+ towlower_l F
+ towupper_l F
+ uselocale F
+ wcscasecmp_l F
+ wcscoll_l F
+ wcsftime_l F
+ wcsncasecmp_l F
+ wcstod_l F
+ wcstof_l F
+ wcstol_l F
+ wcstold_l F
+ wcstoll_l F
+ wcstoul_l F
+ wcstoull_l F
+ wcsxfrm_l F
+ wctrans_l F
+ wctype_l F
+GLIBC_2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ _sys_errlist D 0x1f8
+ sys_errlist D 0x1f8
+GLIBC_2.3 ia64-.*-linux.*/tls powerpc64-.*-linux.*/thread s390x-.*-linux.*/tls x86_64-.*-linux.*/tls
+ _sys_errlist D 0x3f0
+ sys_errlist D 0x3f0
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libcrypt.abilist libc-20030708/abilist/libcrypt.abilist
--- glibc-2.3.2/abilist/libcrypt.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libcrypt.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,19 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.0 A
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ crypt F
+ crypt_r F
+ encrypt F
+ encrypt_r F
+ fcrypt F
+ setkey F
+ setkey_r F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2 s390x-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libdl.abilist libc-20030708/abilist/libdl.abilist
--- glibc-2.3.2/abilist/libdl.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libdl.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,33 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.0 A
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ dlopen F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ dladdr F
+ dlclose F
+ dlerror F
+ dlsym F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.1 A
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ dlvsym F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2 s390x-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3.3 A
+ dladdr1 F
+ dlinfo F
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libm.abilist libc-20030708/abilist/libm.abilist
--- glibc-2.3.2/abilist/libm.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libm.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,355 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.0 A
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _LIB_VERSION D 0x4
+ acos F
+ acosf F
+ acosh F
+ acoshf F
+ acoshl F
+ acosl F
+ asin F
+ asinf F
+ asinh F
+ asinhf F
+ asinhl F
+ asinl F
+ atan F
+ atan2 F
+ atan2f F
+ atan2l F
+ atanf F
+ atanh F
+ atanhf F
+ atanhl F
+ atanl F
+ cbrt F
+ cbrtf F
+ cbrtl F
+ ceil F
+ ceilf F
+ ceill F
+ copysign F
+ copysignf F
+ copysignl F
+ cos F
+ cosf F
+ cosh F
+ coshf F
+ coshl F
+ cosl F
+ drem F
+ dremf F
+ dreml F
+ erf F
+ erfc F
+ erfcf F
+ erfcl F
+ erff F
+ erfl F
+ exp F
+ expf F
+ expl F
+ expm1 F
+ expm1f F
+ expm1l F
+ fabs F
+ fabsf F
+ fabsl F
+ finite F
+ finitef F
+ finitel F
+ floor F
+ floorf F
+ floorl F
+ fmod F
+ fmodf F
+ fmodl F
+ frexp F
+ frexpf F
+ frexpl F
+ gamma F
+ gammaf F
+ gammal F
+ hypot F
+ hypotf F
+ hypotl F
+ ilogb F
+ ilogbf F
+ ilogbl F
+ j0 F
+ j0f F
+ j0l F
+ j1 F
+ j1f F
+ j1l F
+ jn F
+ jnf F
+ jnl F
+ ldexp F
+ ldexpf F
+ ldexpl F
+ lgamma F
+ lgamma_r F
+ lgammaf F
+ lgammaf_r F
+ lgammal F
+ lgammal_r F
+ log F
+ log10 F
+ log10f F
+ log10l F
+ log1p F
+ log1pf F
+ log1pl F
+ logb F
+ logbf F
+ logbl F
+ logf F
+ logl F
+ matherr F
+ modf F
+ modff F
+ modfl F
+ nextafter F
+ nextafterf F
+ nextafterl F
+ pow F
+ powf F
+ powl F
+ remainder F
+ remainderf F
+ remainderl F
+ rint F
+ rintf F
+ rintl F
+ scalb F
+ scalbf F
+ scalbl F
+ scalbn F
+ scalbnf F
+ scalbnl F
+ signgam D 0x4
+ significand F
+ significandf F
+ significandl F
+ sin F
+ sinf F
+ sinh F
+ sinhf F
+ sinhl F
+ sinl F
+ sqrt F
+ sqrtf F
+ sqrtl F
+ tan F
+ tanf F
+ tanh F
+ tanhf F
+ tanhl F
+ tanl F
+ y0 F
+ y0f F
+ y0l F
+ y1 F
+ y1f F
+ y1l F
+ yn F
+ ynf F
+ ynl F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1 A
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ feclearexcept F
+ fegetenv F
+ fegetexceptflag F
+ feraiseexcept F
+ fesetenv F
+ fesetexceptflag F
+ feupdateenv F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __clog10 F
+ __clog10f F
+ __clog10l F
+ __finite F
+ __finitef F
+ __finitel F
+ __fpclassify F
+ __fpclassifyf F
+ __signbit F
+ __signbitf F
+ cabs F
+ cabsf F
+ cabsl F
+ cacos F
+ cacosf F
+ cacosh F
+ cacoshf F
+ cacoshl F
+ cacosl F
+ carg F
+ cargf F
+ cargl F
+ casin F
+ casinf F
+ casinh F
+ casinhf F
+ casinhl F
+ casinl F
+ catan F
+ catanf F
+ catanh F
+ catanhf F
+ catanhl F
+ catanl F
+ ccos F
+ ccosf F
+ ccosh F
+ ccoshf F
+ ccoshl F
+ ccosl F
+ cexp F
+ cexpf F
+ cexpl F
+ cimag F
+ cimagf F
+ cimagl F
+ clog F
+ clog10 F
+ clog10f F
+ clog10l F
+ clogf F
+ clogl F
+ conj F
+ conjf F
+ conjl F
+ cpow F
+ cpowf F
+ cpowl F
+ cproj F
+ cprojf F
+ cprojl F
+ creal F
+ crealf F
+ creall F
+ csin F
+ csinf F
+ csinh F
+ csinhf F
+ csinhl F
+ csinl F
+ csqrt F
+ csqrtf F
+ csqrtl F
+ ctan F
+ ctanf F
+ ctanh F
+ ctanhf F
+ ctanhl F
+ ctanl F
+ exp10 F
+ exp10f F
+ exp10l F
+ exp2 F
+ exp2f F
+ fdim F
+ fdimf F
+ fdiml F
+ fegetround F
+ feholdexcept F
+ fesetround F
+ fetestexcept F
+ fma F
+ fmaf F
+ fmal F
+ fmax F
+ fmaxf F
+ fmaxl F
+ fmin F
+ fminf F
+ fminl F
+ llrint F
+ llrintf F
+ llrintl F
+ llround F
+ llroundf F
+ llroundl F
+ log2 F
+ log2f F
+ log2l F
+ lrint F
+ lrintf F
+ lrintl F
+ lround F
+ lroundf F
+ lroundl F
+ nan F
+ nanf F
+ nanl F
+ nearbyint F
+ nearbyintf F
+ nearbyintl F
+ nexttoward F
+ nexttowardf F
+ nexttowardl F
+ pow10 F
+ pow10f F
+ pow10l F
+ remquo F
+ remquof F
+ remquol F
+ round F
+ roundf F
+ roundl F
+ scalbln F
+ scalblnf F
+ scalblnl F
+ sincos F
+ sincosf F
+ sincosl F
+ tgamma F
+ tgammaf F
+ tgammal F
+ trunc F
+ truncf F
+ truncl F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls
+ __fpclassifyl F
+ __signbitl F
+ exp2l F
+GLIBC_2.1 powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __fe_dfl_env D 0x8
+ __fe_enabled_env D 0x8
+ __fe_nomask_env F
+ __fe_nonieee_env D 0x8
+GLIBC_2.2.3 ia64-.*-linux.*/tls
+ GLIBC_2.2.3 A
+ matherrf F
+ matherrl F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ fedisableexcept F
+ feenableexcept F
+ fegetexcept F
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls
+ __expl F
+ __expm1l F
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libnsl.abilist libc-20030708/abilist/libnsl.abilist
--- glibc-2.3.2/abilist/libnsl.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libnsl.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,142 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.0 A
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __yp_check F
+ xdr_domainname F
+ xdr_keydat F
+ xdr_mapname F
+ xdr_peername F
+ xdr_valdat F
+ xdr_yp_buf F
+ xdr_ypbind_binding F
+ xdr_ypbind_resp F
+ xdr_ypbind_resptype F
+ xdr_ypbind_setdom F
+ xdr_ypdelete_args F
+ xdr_ypmap_parms F
+ xdr_ypmaplist F
+ xdr_yppush_status F
+ xdr_yppushresp_xfr F
+ xdr_ypreq_key F
+ xdr_ypreq_nokey F
+ xdr_ypreq_xfr F
+ xdr_ypresp_all F
+ xdr_ypresp_key_val F
+ xdr_ypresp_maplist F
+ xdr_ypresp_master F
+ xdr_ypresp_order F
+ xdr_ypresp_val F
+ xdr_ypresp_xfr F
+ xdr_ypstat F
+ xdr_ypupdate_args F
+ xdr_ypxfrstat F
+ yp_all F
+ yp_bind F
+ yp_first F
+ yp_get_default_domain F
+ yp_maplist F
+ yp_master F
+ yp_match F
+ yp_next F
+ yp_order F
+ yp_unbind F
+ yp_update F
+ ypbinderr_string F
+ yperr_string F
+ ypprot_err F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.1 A
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __free_fdresult F
+ __nis_default_access F
+ __nis_default_group F
+ __nis_default_owner F
+ __nis_default_ttl F
+ __nis_finddirectory F
+ __nis_hash F
+ __nisbind_connect F
+ __nisbind_create F
+ __nisbind_destroy F
+ __nisbind_next F
+ nis_add F
+ nis_add_entry F
+ nis_addmember F
+ nis_checkpoint F
+ nis_clone_directory F
+ nis_clone_object F
+ nis_clone_result F
+ nis_creategroup F
+ nis_destroy_object F
+ nis_destroygroup F
+ nis_dir_cmp F
+ nis_domain_of F
+ nis_domain_of_r F
+ nis_first_entry F
+ nis_free_directory F
+ nis_free_object F
+ nis_free_request F
+ nis_freenames F
+ nis_freeresult F
+ nis_freeservlist F
+ nis_freetags F
+ nis_getnames F
+ nis_getservlist F
+ nis_ismember F
+ nis_leaf_of F
+ nis_leaf_of_r F
+ nis_lerror F
+ nis_list F
+ nis_local_directory F
+ nis_local_group F
+ nis_local_host F
+ nis_local_principal F
+ nis_lookup F
+ nis_mkdir F
+ nis_modify F
+ nis_modify_entry F
+ nis_name_of F
+ nis_name_of_r F
+ nis_next_entry F
+ nis_perror F
+ nis_ping F
+ nis_print_directory F
+ nis_print_entry F
+ nis_print_group F
+ nis_print_group_entry F
+ nis_print_link F
+ nis_print_object F
+ nis_print_result F
+ nis_print_rights F
+ nis_print_table F
+ nis_read_obj F
+ nis_remove F
+ nis_remove_entry F
+ nis_removemember F
+ nis_rmdir F
+ nis_servstate F
+ nis_sperrno F
+ nis_sperror F
+ nis_sperror_r F
+ nis_stats F
+ nis_verifygroup F
+ nis_write_obj F
+ readColdStartFile F
+ writeColdStartFile F
+ xdr_cback_data F
+ xdr_obj_p F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ xdr_ypall F
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libpthread.abilist libc-20030708/abilist/libpthread.abilist
--- glibc-2.3.2/abilist/libpthread.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libpthread.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,256 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.0 A
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ pthread_attr_init F
+ pthread_create F
+ sem_destroy F
+ sem_getvalue F
+ sem_init F
+ sem_post F
+ sem_trywait F
+ sem_wait F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ pthread_atfork F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ pthread_cond_broadcast F
+ pthread_cond_destroy F
+ pthread_cond_init F
+ pthread_cond_signal F
+ pthread_cond_timedwait F
+ pthread_cond_wait F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ _IO_flockfile F
+ _IO_ftrylockfile F
+ _IO_funlockfile F
+ __close F
+ __connect F
+ __errno_location F
+ __fcntl F
+ __fork F
+ __h_errno_location F
+ __lseek F
+ __open F
+ __pthread_getspecific F
+ __pthread_key_create F
+ __pthread_mutex_destroy F
+ __pthread_mutex_init F
+ __pthread_mutex_lock F
+ __pthread_mutex_trylock F
+ __pthread_mutex_unlock F
+ __pthread_mutexattr_destroy F
+ __pthread_mutexattr_init F
+ __pthread_mutexattr_settype F
+ __pthread_once F
+ __pthread_setspecific F
+ __read F
+ __send F
+ __sigaction F
+ __wait F
+ __write F
+ _pthread_cleanup_pop F
+ _pthread_cleanup_pop_restore F
+ _pthread_cleanup_push F
+ _pthread_cleanup_push_defer F
+ accept F
+ close F
+ connect F
+ fcntl F
+ flockfile F
+ fork F
+ fsync F
+ ftrylockfile F
+ funlockfile F
+ longjmp F
+ lseek F
+ msync F
+ nanosleep F
+ open F
+ pause F
+ pthread_attr_destroy F
+ pthread_attr_getdetachstate F
+ pthread_attr_getinheritsched F
+ pthread_attr_getschedparam F
+ pthread_attr_getschedpolicy F
+ pthread_attr_getscope F
+ pthread_attr_setdetachstate F
+ pthread_attr_setinheritsched F
+ pthread_attr_setschedparam F
+ pthread_attr_setschedpolicy F
+ pthread_attr_setscope F
+ pthread_cancel F
+ pthread_condattr_destroy F
+ pthread_condattr_init F
+ pthread_detach F
+ pthread_equal F
+ pthread_exit F
+ pthread_getschedparam F
+ pthread_getspecific F
+ pthread_join F
+ pthread_key_create F
+ pthread_key_delete F
+ pthread_kill F
+ pthread_kill_other_threads_np F
+ pthread_mutex_destroy F
+ pthread_mutex_init F
+ pthread_mutex_lock F
+ pthread_mutex_trylock F
+ pthread_mutex_unlock F
+ pthread_mutexattr_destroy F
+ pthread_mutexattr_getkind_np F
+ pthread_mutexattr_init F
+ pthread_mutexattr_setkind_np F
+ pthread_once F
+ pthread_self F
+ pthread_setcancelstate F
+ pthread_setcanceltype F
+ pthread_setschedparam F
+ pthread_setspecific F
+ pthread_sigmask F
+ pthread_testcancel F
+ raise F
+ read F
+ recv F
+ recvfrom F
+ recvmsg F
+ send F
+ sendmsg F
+ sendto F
+ sigaction F
+ siglongjmp F
+ sigwait F
+ system F
+ tcdrain F
+ vfork F
+ wait F
+ waitpid F
+ write F
+GLIBC_2.1.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1.1 A
+GLIBC_2.1.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ sem_close F
+ sem_open F
+ sem_unlink F
+GLIBC_2.1.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1.2 A
+GLIBC_2.1.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __vfork F
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+ GLIBC_2.1 A
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 ia64-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __libc_allocate_rtsig F
+ __libc_current_sigrtmax F
+ __libc_current_sigrtmin F
+ pthread_attr_getguardsize F
+ pthread_attr_getstackaddr F
+ pthread_attr_getstacksize F
+ pthread_attr_setguardsize F
+ pthread_attr_setstackaddr F
+ pthread_attr_setstacksize F
+ pthread_getconcurrency F
+ pthread_mutexattr_gettype F
+ pthread_mutexattr_settype F
+ pthread_rwlock_destroy F
+ pthread_rwlock_init F
+ pthread_rwlock_rdlock F
+ pthread_rwlock_tryrdlock F
+ pthread_rwlock_trywrlock F
+ pthread_rwlock_unlock F
+ pthread_rwlock_wrlock F
+ pthread_rwlockattr_destroy F
+ pthread_rwlockattr_getkind_np F
+ pthread_rwlockattr_getpshared F
+ pthread_rwlockattr_init F
+ pthread_rwlockattr_setkind_np F
+ pthread_rwlockattr_setpshared F
+ pthread_setconcurrency F
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2.3 A
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ pthread_getattr_np F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __open64 F
+ __pread64 F
+ __pthread_rwlock_destroy F
+ __pthread_rwlock_init F
+ __pthread_rwlock_rdlock F
+ __pthread_rwlock_tryrdlock F
+ __pthread_rwlock_trywrlock F
+ __pthread_rwlock_unlock F
+ __pthread_rwlock_wrlock F
+ __pwrite64 F
+ __res_state F
+ lseek64 F
+ open64 F
+ pread F
+ pread64 F
+ pthread_attr_getstack F
+ pthread_attr_setstack F
+ pthread_barrier_destroy F
+ pthread_barrier_init F
+ pthread_barrier_wait F
+ pthread_barrierattr_destroy F
+ pthread_barrierattr_init F
+ pthread_barrierattr_setpshared F
+ pthread_condattr_getpshared F
+ pthread_condattr_setpshared F
+ pthread_getcpuclockid F
+ pthread_mutex_timedlock F
+ pthread_mutexattr_getpshared F
+ pthread_mutexattr_setpshared F
+ pthread_rwlock_timedrdlock F
+ pthread_rwlock_timedwrlock F
+ pthread_spin_destroy F
+ pthread_spin_init F
+ pthread_spin_lock F
+ pthread_spin_trylock F
+ pthread_spin_unlock F
+ pthread_yield F
+ pwrite F
+ pwrite64 F
+ sem_timedwait F
+GLIBC_2.2.6 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.2.6 A
+GLIBC_2.2.6 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __nanosleep F
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3.2 A
+GLIBC_2.3.3 i.86-.*-linux.*/thread sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.3.3 A
+ pthread_barrierattr_getpshared F
+ pthread_condattr_getclock F
+ pthread_condattr_setclock F
+ pthread_timedjoin_np F
+ pthread_tryjoin_np F
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libresolv.abilist libc-20030708/abilist/libresolv.abilist
--- glibc-2.3.2/abilist/libresolv.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libresolv.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,95 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.0 A
+ dn_expand F
+ res_mkquery F
+ res_query F
+ res_querydomain F
+ res_search F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __b64_ntop F
+ __b64_pton F
+ __dn_comp F
+ __dn_count_labels F
+ __dn_skipname F
+ __fp_nquery F
+ __fp_query F
+ __fp_resstat F
+ __hostalias F
+ __loc_aton F
+ __loc_ntoa F
+ __p_cdname F
+ __p_cdnname F
+ __p_class F
+ __p_fqname F
+ __p_fqnname F
+ __p_option F
+ __p_query F
+ __p_secstodate F
+ __p_time F
+ __p_type F
+ __putlong F
+ __putshort F
+ __res_close F
+ __res_dnok F
+ __res_hnok F
+ __res_isourserver F
+ __res_mailok F
+ __res_nameinquery F
+ __res_ownok F
+ __res_queriesmatch F
+ __res_send F
+ __sym_ntop F
+ __sym_ntos F
+ __sym_ston F
+ _gethtbyaddr F
+ _gethtbyname F
+ _gethtbyname2 F
+ _gethtent F
+ _getlong F
+ _getshort F
+ _sethtent F
+ inet_net_ntop F
+ inet_net_pton F
+ inet_neta F
+ res_gethostbyaddr F
+ res_gethostbyname F
+ res_gethostbyname2 F
+ res_send_setqhook F
+ res_send_setrhook F
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ __p_class_syms D 0x54
+ __p_type_syms D 0x21c
+ _res_opcodes D 0x40
+GLIBC_2.0 ia64-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __p_class_syms D 0xa8
+ __p_type_syms D 0x438
+ _res_opcodes D 0x80
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ __dn_expand F
+ __res_hostalias F
+ __res_mkquery F
+ __res_nmkquery F
+ __res_nquery F
+ __res_nquerydomain F
+ __res_nsearch F
+ __res_nsend F
+ __res_query F
+ __res_querydomain F
+ __res_search F
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3.2 A
+ __p_rcode F
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/librt.abilist libc-20030708/abilist/librt.abilist
--- glibc-2.3.2/abilist/librt.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/librt.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,44 @@
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.1 A
+GLIBC_2.1 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ aio_cancel F
+ aio_cancel64 F
+ aio_error F
+ aio_error64 F
+ aio_fsync F
+ aio_fsync64 F
+ aio_init F
+ aio_read F
+ aio_read64 F
+ aio_return F
+ aio_return64 F
+ aio_suspend F
+ aio_suspend64 F
+ aio_write F
+ aio_write64 F
+ lio_listio F
+ lio_listio64 F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ clock_getcpuclockid F
+ clock_getres F
+ clock_gettime F
+ clock_nanosleep F
+ clock_settime F
+ shm_open F
+ shm_unlink F
+ timer_create F
+ timer_delete F
+ timer_getoverrun F
+ timer_gettime F
+ timer_settime F
+GLIBC_2.2 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libthread_db.abilist libc-20030708/abilist/libthread_db.abilist
--- glibc-2.3.2/abilist/libthread_db.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libthread_db.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,59 @@
+GLIBC_2.1.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.1.3 A
+GLIBC_2.1.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ td_init F
+ td_log F
+ td_ta_clear_event F
+ td_ta_delete F
+ td_ta_enable_stats F
+ td_ta_event_addr F
+ td_ta_event_getmsg F
+ td_ta_get_nthreads F
+ td_ta_get_ph F
+ td_ta_get_stats F
+ td_ta_map_id2thr F
+ td_ta_map_lwp2thr F
+ td_ta_new F
+ td_ta_reset_stats F
+ td_ta_set_event F
+ td_ta_setconcurrency F
+ td_ta_thr_iter F
+ td_ta_tsd_iter F
+ td_thr_clear_event F
+ td_thr_dbresume F
+ td_thr_dbsuspend F
+ td_thr_event_enable F
+ td_thr_event_getmsg F
+ td_thr_get_info F
+ td_thr_getfpregs F
+ td_thr_getgregs F
+ td_thr_getxregs F
+ td_thr_getxregsize F
+ td_thr_set_event F
+ td_thr_setfpregs F
+ td_thr_setgregs F
+ td_thr_setprio F
+ td_thr_setsigpending F
+ td_thr_setxregs F
+ td_thr_sigsetmask F
+ td_thr_tsd F
+ td_thr_validate F
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.2.3 A
+GLIBC_2.2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ td_symbol_list F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2 s390x-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3.3 A
+ td_thr_tlsbase F
+GLIBC_2.3 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls powerpc64-.*-linux.*/thread s390-.*-linux.*/tls s390x-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls x86_64-.*-linux.*/tls
+ GLIBC_2.3 A
+ td_thr_tls_get_addr F
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/abilist/libutil.abilist libc-20030708/abilist/libutil.abilist
--- glibc-2.3.2/abilist/libutil.abilist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/abilist/libutil.abilist	2003-04-15 23:55:44.000000000 +0900
@@ -0,0 +1,18 @@
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+ GLIBC_2.0 A
+GLIBC_2.0 i.86-.*-linux.*/notls i.86-.*-linux.*/thread i.86-.*-linux.*/tls ia64-.*-linux.*/tls m68.*-.*-linux.*/notls powerpc-.*-linux.*/notls powerpc-.*-linux.*/thread powerpc-.*-linux.*/tls s390-.*-linux.*/tls sh[34].*-.*-linux.*/notls sh[34].*-.*-linux.*/thread sh[34].*-.*-linux.*/tls
+| GLIBC_2.2.5 x86_64-.*-linux.*/tls
+| GLIBC_2.2 s390x-.*-linux.*/tls
+| GLIBC_2.3 powerpc64-.*-linux.*/thread
+ forkpty F
+ login F
+ login_tty F
+ logout F
+ logwtmp F
+ openpty F
+GLIBC_2.2.5 x86_64-.*-linux.*/tls
+ GLIBC_2.2.5 A
+GLIBC_2.2 s390x-.*-linux.*/tls
+ GLIBC_2.2 A
+GLIBC_2.3 powerpc64-.*-linux.*/thread
+ GLIBC_2.3 A
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/argp/argp-help.c libc-20030708/argp/argp-help.c
--- glibc-2.3.2/argp/argp-help.c	2002-04-08 17:19:17.000000000 +0900
+++ libc-20030708/argp/argp-help.c	2003-07-08 22:58:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Hierarchial argument parsing help output
-   Copyright (C) 1995-2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Miles Bader <miles@gnu.ai.mit.edu>.
 
@@ -521,7 +521,7 @@
   free (hol);
 }
 
-static inline int
+static int
 hol_entry_short_iterate (const struct hol_entry *entry,
 			 int (*func)(const struct argp_option *opt,
 				     const struct argp_option *real,
@@ -547,6 +547,7 @@
 }
 
 static inline int
+__attribute ((always_inline))
 hol_entry_long_iterate (const struct hol_entry *entry,
 			int (*func)(const struct argp_option *opt,
 				    const struct argp_option *real,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/argp/argp.h libc-20030708/argp/argp.h
--- glibc-2.3.2/argp/argp.h	2003-03-01 10:09:18.000000000 +0900
+++ libc-20030708/argp/argp.h	2003-07-08 22:58:05.000000000 +0900
@@ -32,6 +32,10 @@
 # define __const const
 #endif
 
+#ifndef __THROW
+# define __THROW
+#endif
+
 #ifndef __error_t_defined
 typedef int error_t;
 # define __error_t_defined
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/argp/tst-argp1.c libc-20030708/argp/tst-argp1.c
--- glibc-2.3.2/argp/tst-argp1.c	2002-12-05 07:45:02.000000000 +0900
+++ libc-20030708/argp/tst-argp1.c	2003-03-18 04:21:04.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@redhat.com>, 2002.
 
@@ -29,7 +29,7 @@
 #define OPT_TOPLEVEL		304
 
 
-static const struct argp_option options[] =
+static const struct argp_option test_options[] =
   {
     { NULL, 0, NULL, 0, "\
 This is a test for threads so we allow ther user to selection the number of \
@@ -89,12 +89,12 @@
 /* Data structure to communicate with argp functions.  */
 static struct argp argp =
 {
-  options, parse_opt
+  test_options, parse_opt
 };
 
 
-int
-main (void)
+static int
+do_test (void)
 {
   int argc = 2;
   char *argv[3] = { (char *) "tst-argp1", (char *) "--help", NULL };
@@ -113,3 +113,6 @@
 {
   return ARGP_ERR_UNKNOWN;
 }
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/catgets/gencat.c libc-20030708/catgets/gencat.c
--- glibc-2.3.2/catgets/gencat.c	2003-02-23 08:09:59.000000000 +0900
+++ libc-20030708/catgets/gencat.c	2003-04-15 23:55:44.000000000 +0900
@@ -333,7 +333,7 @@
 	      /* There might be more than one backslash at the end of
 		 the line.  Only if there is an odd number of them is
 		 the line continued.  */
-	      if (buf[act_len - 1] == '\\')
+	      if (act_len > 0 && buf[act_len - 1] == '\\')
 		{
 		  int temp_act_len = act_len;
 
@@ -343,10 +343,10 @@
 		      continued = !continued;
 		    }
 		  while (temp_act_len > 0 && buf[temp_act_len - 1] == '\\');
-		}
 
-	      if (continued)
-		--act_len;
+		  if (continued)
+		    --act_len;
+		}
 	    }
 
 	  /* Append to currently selected line.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/catgets/nl_types.h libc-20030708/catgets/nl_types.h
--- glibc-2.3.2/catgets/nl_types.h	2001-07-08 04:20:51.000000000 +0900
+++ libc-20030708/catgets/nl_types.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -36,8 +36,11 @@
 /* Type used by `nl_langinfo'.  */
 typedef int nl_item;
 
-/* Open message catalog for later use, returning descriptor.  */
-extern nl_catd catopen (__const char *__cat_name, int __flag) __THROW;
+/* Open message catalog for later use, returning descriptor.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern nl_catd catopen (__const char *__cat_name, int __flag);
 
 /* Return translation with NUMBER in SET of CATALOG; if not found
    return STRING.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/config.h.in libc-20030708/config.h.in
--- glibc-2.3.2/config.h.in	2003-02-04 17:35:22.000000000 +0900
+++ libc-20030708/config.h.in	2003-05-21 23:20:31.000000000 +0900
@@ -31,6 +31,9 @@
 /* Define if weak symbols are available via the `.weakext' directive.  */
 #undef	HAVE_ASM_WEAKEXT_DIRECTIVE
 
+/* Define if CFI directives are available.  */
+#undef	HAVE_ASM_CFI_DIRECTIVES
+
 /* Define to the assembler line separator character for multiple
    assembler instructions per line.  Default is `;'  */
 #undef ASM_LINE_SEP
@@ -58,6 +61,9 @@
 /* Define a symbol_name as a global .symbol_name for ld.  */
 #undef	HAVE_ASM_GLOBAL_DOT_NAME
 
+/* Define if the assembler generates debugging information directly.  */
+#undef	HAVE_CPP_ASM_DEBUGINFO
+
 /* Define if _Unwind_Find_FDE should be exported from glibc.  */
 #undef  EXPORT_UNWIND_FIND_FDE
 
@@ -95,6 +101,10 @@
 /* Define if the compiler supports __builtin_memset.  */
 #undef	HAVE_BUILTIN_MEMSET
 
+/* Define if __asm () on built-in function's prototype causes redirection of
+   the builtin.  */
+#undef	HAVE_BUILTIN_REDIRECTION
+
 /* Define if the __thread keyword is supported.  */
 #undef HAVE___THREAD
 
@@ -186,6 +196,9 @@
 /* Mach/i386 specific: define if the `i386_set_gdt' RPC is available.  */
 #undef	HAVE_I386_SET_GDT
 
+/* Defined if forced unwind support is available.  */
+#undef	HAVE_FORCED_UNWIND
+
 /*
  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/config.make.in libc-20030708/config.make.in
--- glibc-2.3.2/config.make.in	2002-11-15 07:53:32.000000000 +0900
+++ libc-20030708/config.make.in	2003-06-12 08:53:45.000000000 +0900
@@ -1,5 +1,5 @@
 # @configure_input@
-# From $Id: config.make.in,v 1.90 2002/11/14 03:59:36 roland Exp $.
+# From $Id: config.make.in,v 1.95 2003/06/08 07:03:34 drepper Exp $.
 # Don't edit this file.  Put configuration parameters in configparms instead.
 
 version = @VERSION@
@@ -50,6 +50,9 @@
 old-glibc-headers = @old_glibc_headers@
 unwind-find-fde = @libc_cv_gcc_unwind_find_fde@
 have-initfini-array = @libc_cv_initfinit_array@
+have-cpp-asm-debuginfo = @libc_cv_cpp_asm_debuginfo@
+enable-check-abi = @enable_check_abi@
+have-forced-unwind = @libc_cv_forced_unwind@
 
 static-libgcc = @libc_cv_gcc_static_libgcc@
 
@@ -82,8 +85,10 @@
 
 # Build tools.
 CC = @CC@
+CXX = @CXX@
 BUILD_CC = @BUILD_CC@
 CFLAGS = @CFLAGS@
+ASFLAGS-config = @ASFLAGS_config@
 AR = @AR@
 RANLIB = @RANLIB@
 MAKEINFO = @MAKEINFO@
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/configure libc-20030708/configure
--- glibc-2.3.2/configure	2003-02-26 18:20:48.000000000 +0900
+++ libc-20030708/configure	2003-07-08 22:58:05.000000000 +0900
@@ -1,7 +1,7 @@
 #! /bin/sh
 # From configure.in CVSid.
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.57 for GNU C Library (see version.h).
+# Generated by GNU Autoconf 2.54 for GNU C Library (see version.h).
 #
 # Report bugs to <glibc>.
 #
@@ -39,10 +39,7 @@
 PS4='+ '
 
 # NLS nuisances.
-for as_var in \
-  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
-  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
-  LC_TELEPHONE LC_TIME
+for as_var in LANG LANGUAGE LC_ALL LC_COLLATE LC_CTYPE LC_NUMERIC LC_MESSAGES LC_TIME
 do
   if (set +x; test -n "`(eval $as_var=C; export $as_var) 2>&1`"); then
     eval $as_var=C; export $as_var
@@ -88,15 +85,15 @@
 
 # The user is always right.
 if test "${PATH_SEPARATOR+set}" != set; then
-  echo "#! /bin/sh" >conf$$.sh
-  echo  "exit 0"   >>conf$$.sh
-  chmod +x conf$$.sh
-  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+  echo "#! /bin/sh" >conftest.sh
+  echo  "exit 0"   >>conftest.sh
+  chmod +x conftest.sh
+  if (PATH="/nonexistent;."; conftest.sh) >/dev/null 2>&1; then
     PATH_SEPARATOR=';'
   else
     PATH_SEPARATOR=:
   fi
-  rm -f conf$$.sh
+  rm -f conftest.sh
 fi
 
 
@@ -312,7 +309,7 @@
 # include <unistd.h>
 #endif"
 
-ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS with_fp with_cvs oldest_abi subdirs force_install all_warnings build build_cpu build_vendor build_os host host_cpu host_vendor host_os base_machine sysnames INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA LN_S PWD_P CC MAKE MSGFMT MAKEINFO SED AUTOCONF CFLAGS LDFLAGS CPPFLAGS ac_ct_CC OBJEXT BUILD_CC cross_compiling CPP AR OBJDUMP RANLIB ac_ct_RANLIB MIG AS LD CCVERSION SYSINCLUDES libc_cv_gcc_static_libgcc BASH libc_cv_have_bash2 KSH libc_cv_have_ksh AWK PERL INSTALL_INFO OLD_DEBIAN_INSTALL_INFO BISON VERSIONING libc_cv_asm_protected_directive libc_cv_initfinit_array libc_cv_z_nodelete libc_cv_z_nodlopen libc_cv_z_initfirst libc_cv_Bgroup libc_cv_z_combreloc libc_cv_have_initfini no_whole_archive exceptions LIBGD EGREP sizeof_long_double libc_cv_gcc_unwind_find_fde uname_sysname uname_release uname_version old_glibc_headers libc_cv_slibdir libc_cv_localedir libc_cv_sysconfdir libc_cv_rootsbindir use_ldconfig ldd_rewrite_script gnu_ld gnu_as elf xcoff static shared pic_default profile omitfp bounded static_nss nopic_initfini DEFINES linux_doors mach_interface_list VERSION RELEASE LIBOBJS LTLIBOBJS'
+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS with_fp with_cvs enable_check_abi oldest_abi subdirs force_install all_warnings build build_cpu build_vendor build_os host host_cpu host_vendor host_os base_machine sysnames INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA LN_S CC CFLAGS LDFLAGS CPPFLAGS ac_ct_CC OBJEXT BUILD_CC cross_compiling CPP CXX CXXFLAGS ac_ct_CXX AR OBJDUMP RANLIB ac_ct_RANLIB MIG AS LD PWD_P MAKE MSGFMT MAKEINFO SED AUTOCONF CCVERSION SYSINCLUDES libc_cv_gcc_static_libgcc BASH libc_cv_have_bash2 KSH libc_cv_have_ksh AWK PERL INSTALL_INFO OLD_DEBIAN_INSTALL_INFO BISON VERSIONING libc_cv_asm_protected_directive libc_cv_initfinit_array libc_cv_z_nodelete libc_cv_z_nodlopen libc_cv_z_initfirst libc_cv_Bgroup ASFLAGS_config libc_cv_z_combreloc libc_cv_have_initfini libc_cv_cpp_asm_debuginfo no_whole_archive exceptions LIBGD EGREP sizeof_long_double libc_cv_gcc_unwind_find_fde uname_sysname uname_release uname_version old_glibc_headers libc_cv_slibdir libc_cv_localedir libc_cv_sysconfdir libc_cv_rootsbindir libc_cv_forced_unwind use_ldconfig ldd_rewrite_script gnu_ld gnu_as elf xcoff static shared pic_default profile omitfp bounded static_nss nopic_initfini DEFINES linux_doors mach_interface_list VERSION RELEASE LIBOBJS LTLIBOBJS'
 ac_subst_files=''
 
 # Initialize some variables set by options.
@@ -773,6 +770,14 @@
 ac_env_CPP_value=$CPP
 ac_cv_env_CPP_set=${CPP+set}
 ac_cv_env_CPP_value=$CPP
+ac_env_CXX_set=${CXX+set}
+ac_env_CXX_value=$CXX
+ac_cv_env_CXX_set=${CXX+set}
+ac_cv_env_CXX_value=$CXX
+ac_env_CXXFLAGS_set=${CXXFLAGS+set}
+ac_env_CXXFLAGS_value=$CXXFLAGS
+ac_cv_env_CXXFLAGS_set=${CXXFLAGS+set}
+ac_cv_env_CXXFLAGS_value=$CXXFLAGS
 
 #
 # Report the --help message.
@@ -851,6 +856,8 @@
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
   --disable-sanity-checks really do not use threads (should not be used except
                           in special situations) [default=yes]
+  --enable-check-abi      do "make check-abi" in "make check" (no/warn/yes)
+                          [default=no]
   --enable-shared         build shared library [default=yes if GNU ld &
                           ELF]
   --enable-profile        build profiled library [default=yes]
@@ -899,6 +906,8 @@
   CPPFLAGS    C/C++ preprocessor flags, e.g. -I<include dir> if you have
               headers in a nonstandard directory <include dir>
   CPP         C preprocessor
+  CXX         C++ compiler command
+  CXXFLAGS    C++ compiler flags
 
 Use these variables to override the choices made by `configure' or to help
 it to find libraries and programs with nonstandard names/locations.
@@ -967,7 +976,7 @@
 if $ac_init_version; then
   cat <<\_ACEOF
 GNU C Library configure (see version.h)
-generated by GNU Autoconf 2.57
+generated by GNU Autoconf 2.54
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001, 2002
 Free Software Foundation, Inc.
@@ -982,7 +991,7 @@
 running configure, to aid debugging if configure makes a mistake.
 
 It was created by GNU C Library $as_me (see version.h), which was
-generated by GNU Autoconf 2.57.  Invocation command line was
+generated by GNU Autoconf 2.54.  Invocation command line was
 
   $ $0 $@
 
@@ -1034,54 +1043,24 @@
 
 # Keep a trace of the command line.
 # Strip out --no-create and --no-recursion so they do not pile up.
-# Strip out --silent because we don't want to record it for future runs.
 # Also quote any args containing shell meta-characters.
-# Make two passes to allow for proper duplicate-argument suppression.
 ac_configure_args=
-ac_configure_args0=
-ac_configure_args1=
 ac_sep=
-ac_must_keep_next=false
-for ac_pass in 1 2
+for ac_arg
 do
-  for ac_arg
-  do
-    case $ac_arg in
-    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
-    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-    | -silent | --silent | --silen | --sile | --sil)
-      continue ;;
-    *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?\"\']*)
-      ac_arg=`echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
-    esac
-    case $ac_pass in
-    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
-    2)
-      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
-      if test $ac_must_keep_next = true; then
-        ac_must_keep_next=false # Got value, back to normal.
-      else
-        case $ac_arg in
-          *=* | --config-cache | -C | -disable-* | --disable-* \
-          | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
-          | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
-          | -with-* | --with-* | -without-* | --without-* | --x)
-            case "$ac_configure_args0 " in
-              "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
-            esac
-            ;;
-          -* ) ac_must_keep_next=true ;;
-        esac
-      fi
-      ac_configure_args="$ac_configure_args$ac_sep'$ac_arg'"
-      # Get rid of the leading space.
-      ac_sep=" "
-      ;;
-    esac
-  done
+  case $ac_arg in
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c | -n ) continue ;;
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
+    continue ;;
+  *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?\"\']*)
+    ac_arg=`echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+  esac
+  ac_configure_args="$ac_configure_args$ac_sep'$ac_arg'"
+  # Get rid of the leading space.
+  ac_sep=" "
 done
-$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
-$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
 
 # When interrupted or exit'd, cleanup temporary files, and complete
 # config.log.  We remove comments because anyway the quotes in there
@@ -1479,6 +1458,15 @@
   enable_sanity=yes
 fi;
 
+
+# Check whether --enable-check-abi or --disable-check-abi was given.
+if test "${enable_check_abi+set}" = set; then
+  enableval="$enable_check_abi"
+  enable_check_abi=$enableval
+else
+  enable_check_abi=no
+fi;
+
 static=yes
 # Check whether --enable-shared or --disable-shared was given.
 if test "${enable_shared+set}" = set; then
@@ -1822,8 +1810,33 @@
 m68k)		base_machine=m68k machine=m68k/m68020 ;;
 m88???)		base_machine=m88k machine=m88k/$machine ;;
 m88k)		base_machine=m88k machine=m88k/m88100 ;;
-mips64*)	base_machine=mips64 machine=mips/mips64/$machine ;;
-mips*)		base_machine=mips machine=mips/$machine ;;
+mips64*)	base_machine=mips64
+		case "$CC $CFLAGS $CPPFLAGS " in
+		*" -mabi=n32 "*) mips_cc_abi=n32 ;;
+		*" -mabi=64 "*|*" -mabi=n64 "*) mips_cc_abi=64 ;;
+		*" -mabi=32 "*|*" -mabi=o32 "*) mips_cc_abi=32 ;;
+		*) mips_cc_abi=default ;;
+		esac
+		case $config_os in
+		*abin32*) mips_config_abi=n32 ;;
+		*abi64*|*abin64*) mips_config_abi=64 ;;
+		*abi32*|*abio32*) mips_config_abi=32 ;;
+		*) mips_config_abi=$mips_cc_abi ;;
+		esac
+		case $mips_config_abi in
+		default) machine=mips/mips64/n32 mips_config_abi=n32 ;;
+		n32) machine=mips/mips64/n32 ;;
+		64) machine=mips/mips64/n64 ;;
+		32) machine=mips/mips32/kern64 ;;
+		esac
+		machine=$machine/$config_machine
+		if test $mips_config_abi != $mips_cc_abi; then
+		  # This won't make it to config.make, but we want to
+		  # set this in case configure tests depend on it.
+		  CPPFLAGS="$CPPFLAGS -mabi=$mips_config_abi"
+		fi
+		;;
+mips*)		base_machine=mips machine=mips/mips32/$machine ;;
 powerpc)	base_machine=powerpc machine=powerpc/powerpc32 ;;
 powerpc64)	base_machine=powerpc machine=powerpc/powerpc64 ;;
 s390)           base_machine=s390 machine=s390/s390-32 ;;
@@ -2170,70 +2183,59 @@
 fi
 
 
-# We need the physical current working directory.  We cannot use the
-# "pwd -P" shell builtin since that's not portable.  Instead we try to
-# find a pwd binary.  Note that assigning to the PWD environment
-# variable might have some interesting side effects, so we don't do
-# that.
-# Extract the first word of "pwd", so it can be a program name with args.
-set dummy pwd; ac_word=$2
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_path_PWD_P+set}" = set; then
+if test "${ac_cv_prog_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  case $PWD_P in
-  [\\/]* | ?:[\\/]*)
-  ac_cv_path_PWD_P="$PWD_P" # Let the user override the test with a path.
-  ;;
-  *)
-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_path_PWD_P="$as_dir/$ac_word$ac_exec_ext"
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
 done
 
-  test -z "$ac_cv_path_PWD_P" && ac_cv_path_PWD_P="no"
-  ;;
-esac
 fi
-PWD_P=$ac_cv_path_PWD_P
-
-if test -n "$PWD_P"; then
-  echo "$as_me:$LINENO: result: $PWD_P" >&5
-echo "${ECHO_T}$PWD_P" >&6
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-if test "$PWD_P" = no; then
-  { { echo "$as_me:$LINENO: error: *** A pwd binary could not be found." >&5
-echo "$as_me: error: *** A pwd binary could not be found." >&2;}
-   { (exit 1); exit 1; }; }
 fi
-
-# These programs are version sensitive.
-
-for ac_prog in ${ac_tool_prefix}gcc ${ac_tool_prefix}cc
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_CC+set}" = set; then
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
@@ -2242,7 +2244,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="$ac_prog"
+    ac_cv_prog_ac_ct_CC="gcc"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -2251,50 +2253,31 @@
 
 fi
 fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  echo "$as_me:$LINENO: result: $CC" >&5
-echo "${ECHO_T}$CC" >&6
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+echo "${ECHO_T}$ac_ct_CC" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-  test -n "$CC" && break
-done
-
-if test -z "$CC"; then
-  ac_verc_fail=yes
+  CC=$ac_ct_CC
 else
-  # Found it, now check the version.
-  echo "$as_me:$LINENO: checking version of $CC" >&5
-echo $ECHO_N "checking version of $CC... $ECHO_C" >&6
-  ac_prog_version=`$CC -v 2>&1 | sed -n 's/^.*version \([egcygnustpi-]*[0-9.]*\).*$/\1/p'`
-  case $ac_prog_version in
-    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
-    3.[2-9]*)
-       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
-    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
-
-  esac
-  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
-echo "${ECHO_T}$ac_prog_version" >&6
-fi
-if test $ac_verc_fail = yes; then
-  critic_missing="$critic_missing gcc"
+  CC="$ac_cv_prog_CC"
 fi
 
-for ac_prog in gnumake gmake make
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_MAKE+set}" = set; then
+if test "${ac_cv_prog_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$MAKE"; then
-  ac_cv_prog_MAKE="$MAKE" # Let the user override the test.
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
@@ -2303,7 +2286,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_MAKE="$ac_prog"
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -2312,63 +2295,27 @@
 
 fi
 fi
-MAKE=$ac_cv_prog_MAKE
-if test -n "$MAKE"; then
-  echo "$as_me:$LINENO: result: $MAKE" >&5
-echo "${ECHO_T}$MAKE" >&6
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-  test -n "$MAKE" && break
-done
-
-if test -z "$MAKE"; then
-  ac_verc_fail=yes
-else
-  # Found it, now check the version.
-  echo "$as_me:$LINENO: checking version of $MAKE" >&5
-echo $ECHO_N "checking version of $MAKE... $ECHO_C" >&6
-  ac_prog_version=`$MAKE --version 2>&1 | sed -n 's/^.*GNU Make[^0-9]*\([0-9][0-9.]*\).*$/\1/p'`
-  case $ac_prog_version in
-    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
-    3.79* | 3.[89]*)
-       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
-    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
-
-  esac
-  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
-echo "${ECHO_T}$ac_prog_version" >&6
-fi
-if test $ac_verc_fail = yes; then
-  critic_missing="$critic_missing make"
-fi
-
-
-
-if test -n "$critic_missing"; then
-{ { echo "$as_me:$LINENO: error:
-*** These critical programs are missing or too old:$critic_missing
-*** Check the INSTALL file for required versions." >&5
-echo "$as_me: error:
-*** These critical programs are missing or too old:$critic_missing
-*** Check the INSTALL file for required versions." >&2;}
-   { (exit 1); exit 1; }; }
 fi
-
-
-for ac_prog in gnumsgfmt gmsgfmt msgfmt
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_MSGFMT+set}" = set; then
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$MSGFMT"; then
-  ac_cv_prog_MSGFMT="$MSGFMT" # Let the user override the test.
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
@@ -2377,7 +2324,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_MSGFMT="$ac_prog"
+    ac_cv_prog_ac_ct_CC="cc"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -2386,51 +2333,33 @@
 
 fi
 fi
-MSGFMT=$ac_cv_prog_MSGFMT
-if test -n "$MSGFMT"; then
-  echo "$as_me:$LINENO: result: $MSGFMT" >&5
-echo "${ECHO_T}$MSGFMT" >&6
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+echo "${ECHO_T}$ac_ct_CC" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-  test -n "$MSGFMT" && break
-done
-
-if test -z "$MSGFMT"; then
-  ac_verc_fail=yes
+  CC=$ac_ct_CC
 else
-  # Found it, now check the version.
-  echo "$as_me:$LINENO: checking version of $MSGFMT" >&5
-echo $ECHO_N "checking version of $MSGFMT... $ECHO_C" >&6
-  ac_prog_version=`$MSGFMT --version 2>&1 | sed -n 's/^.*GNU gettext.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
-  case $ac_prog_version in
-    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
-    0.10.3[6-9]* | 0.10.[4-9][0-9]* | 0.1[1-9]* | 0.[2-9][0-9]* | [1-9].*)
-       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
-    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
-
-  esac
-  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
-echo "${ECHO_T}$ac_prog_version" >&6
-fi
-if test $ac_verc_fail = yes; then
-  MSGFMT=: aux_missing="$aux_missing msgfmt"
+  CC="$ac_cv_prog_CC"
 fi
 
-for ac_prog in makeinfo
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
+fi
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_MAKEINFO+set}" = set; then
+if test "${ac_cv_prog_CC+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$MAKEINFO"; then
-  ac_cv_prog_MAKEINFO="$MAKEINFO" # Let the user override the test.
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
 else
+  ac_prog_rejected=no
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
 do
@@ -2438,205 +2367,30 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_MAKEINFO="$ac_prog"
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
 done
 
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
 fi
 fi
-MAKEINFO=$ac_cv_prog_MAKEINFO
-if test -n "$MAKEINFO"; then
-  echo "$as_me:$LINENO: result: $MAKEINFO" >&5
-echo "${ECHO_T}$MAKEINFO" >&6
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-
-  test -n "$MAKEINFO" && break
-done
-
-if test -z "$MAKEINFO"; then
-  ac_verc_fail=yes
-else
-  # Found it, now check the version.
-  echo "$as_me:$LINENO: checking version of $MAKEINFO" >&5
-echo $ECHO_N "checking version of $MAKEINFO... $ECHO_C" >&6
-  ac_prog_version=`$MAKEINFO --version 2>&1 | sed -n 's/^.*GNU texinfo.* \([0-9][0-9.]*\).*$/\1/p'`
-  case $ac_prog_version in
-    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
-    4.*)
-       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
-    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
-
-  esac
-  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
-echo "${ECHO_T}$ac_prog_version" >&6
-fi
-if test $ac_verc_fail = yes; then
-  MAKEINFO=: aux_missing="$aux_missing makeinfo"
-fi
-
-for ac_prog in sed
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_SED+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$SED"; then
-  ac_cv_prog_SED="$SED" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_SED="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-fi
-fi
-SED=$ac_cv_prog_SED
-if test -n "$SED"; then
-  echo "$as_me:$LINENO: result: $SED" >&5
-echo "${ECHO_T}$SED" >&6
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-
-  test -n "$SED" && break
-done
-
-if test -z "$SED"; then
-  ac_verc_fail=yes
-else
-  # Found it, now check the version.
-  echo "$as_me:$LINENO: checking version of $SED" >&5
-echo $ECHO_N "checking version of $SED... $ECHO_C" >&6
-  ac_prog_version=`$SED --version 2>&1 | sed -n 's/^.*GNU sed version \([0-9]*\.[0-9.]*\).*$/\1/p'`
-  case $ac_prog_version in
-    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
-    3.0[2-9]*|3.[1-9]*|[4-9]*)
-       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
-    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
-
-  esac
-  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
-echo "${ECHO_T}$ac_prog_version" >&6
-fi
-if test $ac_verc_fail = yes; then
-  SED=: aux_missing="$aux_missing sed"
-fi
-
-
-if test "x$with_cvs" != xyes; then
-  for ac_prog in autoconf
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_AUTOCONF+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$AUTOCONF"; then
-  ac_cv_prog_AUTOCONF="$AUTOCONF" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_AUTOCONF="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-fi
-fi
-AUTOCONF=$ac_cv_prog_AUTOCONF
-if test -n "$AUTOCONF"; then
-  echo "$as_me:$LINENO: result: $AUTOCONF" >&5
-echo "${ECHO_T}$AUTOCONF" >&6
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-
-  test -n "$AUTOCONF" && break
-done
-test -n "$AUTOCONF" || AUTOCONF="no"
-
-  case "x$AUTOCONF" in
-  xno|x|x:) AUTOCONF=no ;;
-  *)
-    echo "$as_me:$LINENO: checking whether $AUTOCONF${ACFLAGS:+ }$ACFLAGS works" >&5
-echo $ECHO_N "checking whether $AUTOCONF${ACFLAGS:+ }$ACFLAGS works... $ECHO_C" >&6
-if test "${libc_cv_autoconf_works+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-      if (cd $srcdir; $AUTOCONF $ACFLAGS configure.in > /dev/null 2>&1); then
-      libc_cv_autoconf_works=yes
-    else
-      libc_cv_autoconf_works=no
-    fi
-fi
-echo "$as_me:$LINENO: result: $libc_cv_autoconf_works" >&5
-echo "${ECHO_T}$libc_cv_autoconf_works" >&6
-    test $libc_cv_autoconf_works = yes || AUTOCONF=no
-    ;;
-  esac
-  test "x$AUTOCONF" != xno || aux_missing="$aux_missing autoconf"
-fi
-
-ac_ext=c
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_c_compiler_gnu
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}gcc; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="${ac_tool_prefix}gcc"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-fi
 fi
 CC=$ac_cv_prog_CC
 if test -n "$CC"; then
@@ -2648,52 +2402,12 @@
 fi
 
 fi
-if test -z "$ac_cv_prog_CC"; then
-  ac_ct_CC=$CC
-  # Extract the first word of "gcc", so it can be a program name with args.
-set dummy gcc; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_CC="gcc"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-echo "${ECHO_T}$ac_ct_CC" >&6
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-
-  CC=$ac_ct_CC
-else
-  CC="$ac_cv_prog_CC"
-fi
-
 if test -z "$CC"; then
   if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
-set dummy ${ac_tool_prefix}cc; ac_word=$2
+  for ac_prog in cl
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_CC+set}" = set; then
@@ -2709,7 +2423,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -2727,11 +2441,15 @@
 echo "${ECHO_T}no" >&6
 fi
 
+    test -n "$CC" && break
+  done
 fi
-if test -z "$ac_cv_prog_CC"; then
+if test -z "$CC"; then
   ac_ct_CC=$CC
-  # Extract the first word of "cc", so it can be a program name with args.
-set dummy cc; ac_word=$2
+  for ac_prog in cl
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
 if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
@@ -2747,7 +2465,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_CC="cc"
+    ac_cv_prog_ac_ct_CC="$ac_prog"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -2764,150 +2482,9 @@
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
-
-  CC=$ac_ct_CC
-else
-  CC="$ac_cv_prog_CC"
-fi
-
-fi
-if test -z "$CC"; then
-  # Extract the first word of "cc", so it can be a program name with args.
-set dummy cc; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-  ac_prog_rejected=no
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
-       ac_prog_rejected=yes
-       continue
-     fi
-    ac_cv_prog_CC="cc"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-if test $ac_prog_rejected = yes; then
-  # We found a bogon in the path, so make sure we never use it.
-  set dummy $ac_cv_prog_CC
-  shift
-  if test $# != 0; then
-    # We chose a different compiler from the bogus one.
-    # However, it has the same basename, so the bogon will be chosen
-    # first if we set CC to just the basename; use the full file name.
-    shift
-    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
-  fi
-fi
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  echo "$as_me:$LINENO: result: $CC" >&5
-echo "${ECHO_T}$CC" >&6
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-
-fi
-if test -z "$CC"; then
-  if test -n "$ac_tool_prefix"; then
-  for ac_prog in cl
-  do
-    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
-set dummy $ac_tool_prefix$ac_prog; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$CC"; then
-  ac_cv_prog_CC="$CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-fi
-fi
-CC=$ac_cv_prog_CC
-if test -n "$CC"; then
-  echo "$as_me:$LINENO: result: $CC" >&5
-echo "${ECHO_T}$CC" >&6
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-
-    test -n "$CC" && break
-  done
-fi
-if test -z "$CC"; then
-  ac_ct_CC=$CC
-  for ac_prog in cl
-do
-  # Extract the first word of "$ac_prog", so it can be a program name with args.
-set dummy $ac_prog; ac_word=$2
-echo "$as_me:$LINENO: checking for $ac_word" >&5
-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  if test -n "$ac_ct_CC"; then
-  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
-else
-as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-for as_dir in $PATH
-do
-  IFS=$as_save_IFS
-  test -z "$as_dir" && as_dir=.
-  for ac_exec_ext in '' $ac_executable_extensions; do
-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_CC="$ac_prog"
-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-    break 2
-  fi
-done
-done
-
-fi
-fi
-ac_ct_CC=$ac_cv_prog_ac_ct_CC
-if test -n "$ac_ct_CC"; then
-  echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
-echo "${ECHO_T}$ac_ct_CC" >&6
-else
-  echo "$as_me:$LINENO: result: no" >&5
-echo "${ECHO_T}no" >&6
-fi
-
-  test -n "$ac_ct_CC" && break
-done
+
+  test -n "$ac_ct_CC" && break
+done
 
   CC=$ac_ct_CC
 fi
@@ -2915,10 +2492,8 @@
 fi
 
 
-test -z "$CC" && { { echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&5
-echo "$as_me: error: no acceptable C compiler found in \$PATH
-See \`config.log' for more details." >&2;}
+test -z "$CC" && { { echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH" >&5
+echo "$as_me: error: no acceptable C compiler found in \$PATH" >&2;}
    { (exit 1); exit 1; }; }
 
 # Provide some information about the compiler.
@@ -2949,11 +2524,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 
 int
 main ()
@@ -2978,12 +2549,9 @@
 done
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-{ { echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&5
-echo "$as_me: error: cannot compute suffix of object files: cannot compile
-See \`config.log' for more details." >&2;}
+cat conftest.$ac_ext >&5
+{ { echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile" >&5
+echo "$as_me: error: cannot compute suffix of object files: cannot compile" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
@@ -3000,11 +2568,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 
 int
 main ()
@@ -3032,8 +2596,7 @@
   ac_compiler_gnu=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ac_compiler_gnu=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -3053,11 +2616,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 
 int
 main ()
@@ -3082,8 +2641,7 @@
   ac_cv_prog_cc_g=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ac_cv_prog_cc_g=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -3114,11 +2672,7 @@
 ac_save_CC=$CC
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <stdarg.h>
 #include <stdio.h>
 #include <sys/types.h>
@@ -3181,8 +2735,7 @@
 break
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext
 done
@@ -3233,11 +2786,7 @@
 do
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <stdlib.h>
 $ac_declaration
 int
@@ -3263,18 +2812,13 @@
   :
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 continue
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_declaration
 int
 main ()
@@ -3299,8 +2843,7 @@
   break
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 done
@@ -3313,8 +2856,7 @@
 
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 ac_ext=c
@@ -3389,22 +2931,12 @@
 do
   # Use a header file that comes with gcc, so configuring glibc
   # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
+#include "confdefs.h"
+#include <assert.h>
                      Syntax error
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -3427,8 +2959,7 @@
   :
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+  cat conftest.$ac_ext >&5
   # Broken: fails on valid input.
 continue
 fi
@@ -3438,11 +2969,7 @@
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <ac_nonexistent.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -3466,8 +2993,7 @@
 continue
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+  cat conftest.$ac_ext >&5
   # Passes both tests.
 ac_preproc_ok=:
 break
@@ -3496,22 +3022,12 @@
 do
   # Use a header file that comes with gcc, so configuring glibc
   # with a fresh cross-compiler works.
-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since
-  # <limits.h> exists even on freestanding compilers.
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp. "Syntax error" is here to catch this case.
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
-#ifdef __STDC__
-# include <limits.h>
-#else
-# include <assert.h>
-#endif
+#include "confdefs.h"
+#include <assert.h>
                      Syntax error
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -3534,8 +3050,7 @@
   :
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+  cat conftest.$ac_ext >&5
   # Broken: fails on valid input.
 continue
 fi
@@ -3545,11 +3060,7 @@
   # can be detected and how.
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <ac_nonexistent.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -3573,8 +3084,7 @@
 continue
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+  cat conftest.$ac_ext >&5
   # Passes both tests.
 ac_preproc_ok=:
 break
@@ -3587,10 +3097,8 @@
 if $ac_preproc_ok; then
   :
 else
-  { { echo "$as_me:$LINENO: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&5
-echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check
-See \`config.log' for more details." >&2;}
+  { { echo "$as_me:$LINENO: error: C preprocessor \"$CPP\" fails sanity check" >&5
+echo "$as_me: error: C preprocessor \"$CPP\" fails sanity check" >&2;}
    { (exit 1); exit 1; }; }
 fi
 
@@ -3600,34 +3108,698 @@
 ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-# Was a --with-binutils option given?
-if test -n "$path_binutils"; then
-    # Make absolute; ensure a single trailing slash.
-    path_binutils=`(cd $path_binutils; pwd) | sed 's%/*$%/%'`
-    CC="$CC -B$path_binutils"
+# We need the C++ compiler only for testing.
+ac_ext=cc
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  for ac_prog in $CCC g++ c++ gpp aCC CC cxx cc++ cl FCC KCC RCC xlC_r xlC
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CXX+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$CXX"; then
+  ac_cv_prog_CXX="$CXX" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+CXX=$ac_cv_prog_CXX
+if test -n "$CXX"; then
+  echo "$as_me:$LINENO: result: $CXX" >&5
+echo "${ECHO_T}$CXX" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
-AS=`$CC -print-prog-name=as`
-LD=`$CC -print-prog-name=ld`
-AR=`$CC -print-prog-name=ar`
 
-OBJDUMP=`$CC -print-prog-name=objdump`
+    test -n "$CXX" && break
+  done
+fi
+if test -z "$CXX"; then
+  ac_ct_CXX=$CXX
+  for ac_prog in $CCC g++ c++ gpp aCC CC cxx cc++ cl FCC KCC RCC xlC_r xlC
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_CXX+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_CXX"; then
+  ac_cv_prog_ac_ct_CXX="$ac_ct_CXX" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CXX="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
 
+fi
+fi
+ac_ct_CXX=$ac_cv_prog_ac_ct_CXX
+if test -n "$ac_ct_CXX"; then
+  echo "$as_me:$LINENO: result: $ac_ct_CXX" >&5
+echo "${ECHO_T}$ac_ct_CXX" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
 
-# ranlib has to be treated a bit differently since it might not exist at all.
-ac_ranlib=`$CC -print-prog-name=ranlib`
-if test "x$ac_ranlib" = xranlib; then
-# This extra check has to happen since gcc simply echos the parameter in
-# case it cannot find the value in its own directories.
-if test -n "$ac_tool_prefix"; then
-  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
-set dummy ${ac_tool_prefix}ranlib; ac_word=$2
+  test -n "$ac_ct_CXX" && break
+done
+test -n "$ac_ct_CXX" || ac_ct_CXX="g++"
+
+  CXX=$ac_ct_CXX
+fi
+
+
+# Provide some information about the compiler.
+echo "$as_me:$LINENO:" \
+     "checking for C++ compiler version" >&5
+ac_compiler=`set X $ac_compile; echo $2`
+{ (eval echo "$as_me:$LINENO: \"$ac_compiler --version </dev/null >&5\"") >&5
+  (eval $ac_compiler --version </dev/null >&5) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }
+{ (eval echo "$as_me:$LINENO: \"$ac_compiler -v </dev/null >&5\"") >&5
+  (eval $ac_compiler -v </dev/null >&5) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }
+{ (eval echo "$as_me:$LINENO: \"$ac_compiler -V </dev/null >&5\"") >&5
+  (eval $ac_compiler -V </dev/null >&5) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }
+
+echo "$as_me:$LINENO: checking whether we are using the GNU C++ compiler" >&5
+echo $ECHO_N "checking whether we are using the GNU C++ compiler... $ECHO_C" >&6
+if test "${ac_cv_cxx_compiler_gnu+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_compiler_gnu=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_compiler_gnu=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+ac_cv_cxx_compiler_gnu=$ac_compiler_gnu
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_cxx_compiler_gnu" >&5
+echo "${ECHO_T}$ac_cv_cxx_compiler_gnu" >&6
+GXX=`test $ac_compiler_gnu = yes && echo yes`
+ac_test_CXXFLAGS=${CXXFLAGS+set}
+ac_save_CXXFLAGS=$CXXFLAGS
+CXXFLAGS="-g"
+echo "$as_me:$LINENO: checking whether $CXX accepts -g" >&5
+echo $ECHO_N "checking whether $CXX accepts -g... $ECHO_C" >&6
+if test "${ac_cv_prog_cxx_g+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_prog_cxx_g=yes
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+ac_cv_prog_cxx_g=no
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: $ac_cv_prog_cxx_g" >&5
+echo "${ECHO_T}$ac_cv_prog_cxx_g" >&6
+if test "$ac_test_CXXFLAGS" = set; then
+  CXXFLAGS=$ac_save_CXXFLAGS
+elif test $ac_cv_prog_cxx_g = yes; then
+  if test "$GXX" = yes; then
+    CXXFLAGS="-g -O2"
+  else
+    CXXFLAGS="-g"
+  fi
+else
+  if test "$GXX" = yes; then
+    CXXFLAGS="-O2"
+  else
+    CXXFLAGS=
+  fi
+fi
+for ac_declaration in \
+   ''\
+   '#include <stdlib.h>' \
+   'extern "C" void std::exit (int) throw (); using std::exit;' \
+   'extern "C" void std::exit (int); using std::exit;' \
+   'extern "C" void exit (int) throw ();' \
+   'extern "C" void exit (int);' \
+   'void exit (int);'
+do
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+#include <stdlib.h>
+$ac_declaration
+int
+main ()
+{
+exit (42);
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  :
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+continue
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+  cat >conftest.$ac_ext <<_ACEOF
+#line $LINENO "configure"
+#include "confdefs.h"
+$ac_declaration
+int
+main ()
+{
+exit (42);
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+         { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  break
+else
+  echo "$as_me: failed program was:" >&5
+cat conftest.$ac_ext >&5
+fi
+rm -f conftest.$ac_objext conftest.$ac_ext
+done
+rm -f conftest*
+if test -n "$ac_declaration"; then
+  echo '#ifdef __cplusplus' >>confdefs.h
+  echo $ac_declaration      >>confdefs.h
+  echo '#endif'             >>confdefs.h
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+# Was a --with-binutils option given?
+if test -n "$path_binutils"; then
+    # Make absolute; ensure a single trailing slash.
+    path_binutils=`(cd $path_binutils; pwd) | sed 's%/*$%/%'`
+    CC="$CC -B$path_binutils"
+fi
+AS=`$CC -print-prog-name=as`
+LD=`$CC -print-prog-name=ld`
+AR=`$CC -print-prog-name=ar`
+
+OBJDUMP=`$CC -print-prog-name=objdump`
+
+
+# ranlib has to be treated a bit differently since it might not exist at all.
+ac_ranlib=`$CC -print-prog-name=ranlib`
+if test "x$ac_ranlib" = xranlib; then
+# This extra check has to happen since gcc simply echos the parameter in
+# case it cannot find the value in its own directories.
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
+set dummy ${ac_tool_prefix}ranlib; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_RANLIB+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+RANLIB=$ac_cv_prog_RANLIB
+if test -n "$RANLIB"; then
+  echo "$as_me:$LINENO: result: $RANLIB" >&5
+echo "${ECHO_T}$RANLIB" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+fi
+if test -z "$ac_cv_prog_RANLIB"; then
+  ac_ct_RANLIB=$RANLIB
+  # Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_RANLIB"; then
+  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_RANLIB="ranlib"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+  test -z "$ac_cv_prog_ac_ct_RANLIB" && ac_cv_prog_ac_ct_RANLIB=":"
+fi
+fi
+ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
+if test -n "$ac_ct_RANLIB"; then
+  echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
+echo "${ECHO_T}$ac_ct_RANLIB" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  RANLIB=$ac_ct_RANLIB
+else
+  RANLIB="$ac_cv_prog_RANLIB"
+fi
+
+else
+  RANLIB=$ac_ranlib
+fi
+
+
+# Determine whether we are using GNU binutils.
+echo "$as_me:$LINENO: checking whether $AS is GNU as" >&5
+echo $ECHO_N "checking whether $AS is GNU as... $ECHO_C" >&6
+if test "${libc_cv_prog_as_gnu+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  # Most GNU programs take a -v and spit out some text including
+# the word 'GNU'.  Some try to read stdin, so give them /dev/null.
+if $AS -o conftest -v </dev/null 2>&1 | grep GNU > /dev/null 2>&1; then
+  libc_cv_prog_as_gnu=yes
+else
+  libc_cv_prog_as_gnu=no
+fi
+rm -fr contest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_prog_as_gnu" >&5
+echo "${ECHO_T}$libc_cv_prog_as_gnu" >&6
+rm -f a.out
+gnu_as=$libc_cv_prog_as_gnu
+
+echo "$as_me:$LINENO: checking whether $LD is GNU ld" >&5
+echo $ECHO_N "checking whether $LD is GNU ld... $ECHO_C" >&6
+if test "${libc_cv_prog_ld_gnu+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  # Most GNU programs take a -v and spit out some text including
+# the word 'GNU'.  Some try to read stdin, so give them /dev/null.
+if $LD -o conftest -v </dev/null 2>&1 | grep GNU > /dev/null 2>&1; then
+  libc_cv_prog_ld_gnu=yes
+else
+  libc_cv_prog_ld_gnu=no
+fi
+rm -fr contest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_prog_ld_gnu" >&5
+echo "${ECHO_T}$libc_cv_prog_ld_gnu" >&6
+gnu_ld=$libc_cv_prog_ld_gnu
+
+
+# Accept binutils 2.13 or newer.
+for ac_prog in $AS
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_AS+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$AS"; then
+  ac_cv_prog_AS="$AS" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AS="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+AS=$ac_cv_prog_AS
+if test -n "$AS"; then
+  echo "$as_me:$LINENO: result: $AS" >&5
+echo "${ECHO_T}$AS" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  test -n "$AS" && break
+done
+
+if test -z "$AS"; then
+  ac_verc_fail=yes
+else
+  # Found it, now check the version.
+  echo "$as_me:$LINENO: checking version of $AS" >&5
+echo $ECHO_N "checking version of $AS... $ECHO_C" >&6
+  ac_prog_version=`$AS --version 2>&1 | sed -n 's/^.*GNU assembler.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
+  case $ac_prog_version in
+    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+    2.1[3-9]*)
+       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
+
+  esac
+  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
+echo "${ECHO_T}$ac_prog_version" >&6
+fi
+if test $ac_verc_fail = yes; then
+  AS=: critic_missing="$critic_missing as"
+fi
+
+for ac_prog in $LD
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_LD+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$LD"; then
+  ac_cv_prog_LD="$LD" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_LD="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+LD=$ac_cv_prog_LD
+if test -n "$LD"; then
+  echo "$as_me:$LINENO: result: $LD" >&5
+echo "${ECHO_T}$LD" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  test -n "$LD" && break
+done
+
+if test -z "$LD"; then
+  ac_verc_fail=yes
+else
+  # Found it, now check the version.
+  echo "$as_me:$LINENO: checking version of $LD" >&5
+echo $ECHO_N "checking version of $LD... $ECHO_C" >&6
+  ac_prog_version=`$LD --version 2>&1 | sed -n 's/^.*GNU ld.* \([0-9][0-9]*\.[0-9.]*\).*$/\1/p'`
+  case $ac_prog_version in
+    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+    2.1[3-9]*)
+       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
+
+  esac
+  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
+echo "${ECHO_T}$ac_prog_version" >&6
+fi
+if test $ac_verc_fail = yes; then
+  LD=: critic_missing="$critic_missing ld"
+fi
+
+
+# We need the physical current working directory.  We cannot use the
+# "pwd -P" shell builtin since that's not portable.  Instead we try to
+# find a pwd binary.  Note that assigning to the PWD environment
+# variable might have some interesting side effects, so we don't do
+# that.
+# Extract the first word of "pwd", so it can be a program name with args.
+set dummy pwd; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_path_PWD_P+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  case $PWD_P in
+  [\\/]* | ?:[\\/]*)
+  ac_cv_path_PWD_P="$PWD_P" # Let the user override the test with a path.
+  ;;
+  *)
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_path_PWD_P="$as_dir/$ac_word$ac_exec_ext"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+  test -z "$ac_cv_path_PWD_P" && ac_cv_path_PWD_P="no"
+  ;;
+esac
+fi
+PWD_P=$ac_cv_path_PWD_P
+
+if test -n "$PWD_P"; then
+  echo "$as_me:$LINENO: result: $PWD_P" >&5
+echo "${ECHO_T}$PWD_P" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+if test "$PWD_P" = no; then
+  { { echo "$as_me:$LINENO: error: *** A pwd binary could not be found." >&5
+echo "$as_me: error: *** A pwd binary could not be found." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+# These programs are version sensitive.
+
+for ac_prog in ${ac_tool_prefix}gcc ${ac_tool_prefix}cc
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  test -n "$CC" && break
+done
+
+if test -z "$CC"; then
+  ac_verc_fail=yes
+else
+  # Found it, now check the version.
+  echo "$as_me:$LINENO: checking version of $CC" >&5
+echo $ECHO_N "checking version of $CC... $ECHO_C" >&6
+  ac_prog_version=`$CC -v 2>&1 | sed -n 's/^.*version \([egcygnustpi-]*[0-9.]*\).*$/\1/p'`
+  case $ac_prog_version in
+    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+    3.[2-9]*)
+       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
+
+  esac
+  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
+echo "${ECHO_T}$ac_prog_version" >&6
+fi
+if test $ac_verc_fail = yes; then
+  critic_missing="$critic_missing gcc"
+fi
+
+for ac_prog in gnumake gmake make
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_RANLIB+set}" = set; then
+if test "${ac_cv_prog_MAKE+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$RANLIB"; then
-  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+  if test -n "$MAKE"; then
+  ac_cv_prog_MAKE="$MAKE" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
@@ -3636,7 +3808,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
+    ac_cv_prog_MAKE="$ac_prog"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -3645,27 +3817,51 @@
 
 fi
 fi
-RANLIB=$ac_cv_prog_RANLIB
-if test -n "$RANLIB"; then
-  echo "$as_me:$LINENO: result: $RANLIB" >&5
-echo "${ECHO_T}$RANLIB" >&6
+MAKE=$ac_cv_prog_MAKE
+if test -n "$MAKE"; then
+  echo "$as_me:$LINENO: result: $MAKE" >&5
+echo "${ECHO_T}$MAKE" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
+  test -n "$MAKE" && break
+done
+
+if test -z "$MAKE"; then
+  ac_verc_fail=yes
+else
+  # Found it, now check the version.
+  echo "$as_me:$LINENO: checking version of $MAKE" >&5
+echo $ECHO_N "checking version of $MAKE... $ECHO_C" >&6
+  ac_prog_version=`$MAKE --version 2>&1 | sed -n 's/^.*GNU Make[^0-9]*\([0-9][0-9.]*\).*$/\1/p'`
+  case $ac_prog_version in
+    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+    3.79* | 3.[89]*)
+       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
+
+  esac
+  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
+echo "${ECHO_T}$ac_prog_version" >&6
 fi
-if test -z "$ac_cv_prog_RANLIB"; then
-  ac_ct_RANLIB=$RANLIB
-  # Extract the first word of "ranlib", so it can be a program name with args.
-set dummy ranlib; ac_word=$2
+if test $ac_verc_fail = yes; then
+  critic_missing="$critic_missing make"
+fi
+
+
+for ac_prog in gnumsgfmt gmsgfmt msgfmt
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+if test "${ac_cv_prog_MSGFMT+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$ac_ct_RANLIB"; then
-  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
+  if test -n "$MSGFMT"; then
+  ac_cv_prog_MSGFMT="$MSGFMT" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
@@ -3674,86 +3870,59 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_ac_ct_RANLIB="ranlib"
+    ac_cv_prog_MSGFMT="$ac_prog"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
 done
 done
 
-  test -z "$ac_cv_prog_ac_ct_RANLIB" && ac_cv_prog_ac_ct_RANLIB=":"
 fi
 fi
-ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
-if test -n "$ac_ct_RANLIB"; then
-  echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
-echo "${ECHO_T}$ac_ct_RANLIB" >&6
+MSGFMT=$ac_cv_prog_MSGFMT
+if test -n "$MSGFMT"; then
+  echo "$as_me:$LINENO: result: $MSGFMT" >&5
+echo "${ECHO_T}$MSGFMT" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-  RANLIB=$ac_ct_RANLIB
-else
-  RANLIB="$ac_cv_prog_RANLIB"
-fi
-
-else
-  RANLIB=$ac_ranlib
-fi
-
+  test -n "$MSGFMT" && break
+done
 
-# Determine whether we are using GNU binutils.
-echo "$as_me:$LINENO: checking whether $AS is GNU as" >&5
-echo $ECHO_N "checking whether $AS is GNU as... $ECHO_C" >&6
-if test "${libc_cv_prog_as_gnu+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  # Most GNU programs take a -v and spit out some text including
-# the word 'GNU'.  Some try to read stdin, so give them /dev/null.
-if $AS -o conftest -v </dev/null 2>&1 | grep GNU > /dev/null 2>&1; then
-  libc_cv_prog_as_gnu=yes
+if test -z "$MSGFMT"; then
+  ac_verc_fail=yes
 else
-  libc_cv_prog_as_gnu=no
-fi
-rm -fr contest*
-fi
-echo "$as_me:$LINENO: result: $libc_cv_prog_as_gnu" >&5
-echo "${ECHO_T}$libc_cv_prog_as_gnu" >&6
-rm -f a.out
-gnu_as=$libc_cv_prog_as_gnu
+  # Found it, now check the version.
+  echo "$as_me:$LINENO: checking version of $MSGFMT" >&5
+echo $ECHO_N "checking version of $MSGFMT... $ECHO_C" >&6
+  ac_prog_version=`$MSGFMT --version 2>&1 | sed -n 's/^.*GNU gettext.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
+  case $ac_prog_version in
+    '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+    0.10.3[6-9]* | 0.10.[4-9][0-9]* | 0.1[1-9]* | 0.[2-9][0-9]* | [1-9].*)
+       ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+    *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
 
-echo "$as_me:$LINENO: checking whether $LD is GNU ld" >&5
-echo $ECHO_N "checking whether $LD is GNU ld... $ECHO_C" >&6
-if test "${libc_cv_prog_ld_gnu+set}" = set; then
-  echo $ECHO_N "(cached) $ECHO_C" >&6
-else
-  # Most GNU programs take a -v and spit out some text including
-# the word 'GNU'.  Some try to read stdin, so give them /dev/null.
-if $LD -o conftest -v </dev/null 2>&1 | grep GNU > /dev/null 2>&1; then
-  libc_cv_prog_ld_gnu=yes
-else
-  libc_cv_prog_ld_gnu=no
+  esac
+  echo "$as_me:$LINENO: result: $ac_prog_version" >&5
+echo "${ECHO_T}$ac_prog_version" >&6
 fi
-rm -fr contest*
+if test $ac_verc_fail = yes; then
+  MSGFMT=: aux_missing="$aux_missing msgfmt"
 fi
-echo "$as_me:$LINENO: result: $libc_cv_prog_ld_gnu" >&5
-echo "${ECHO_T}$libc_cv_prog_ld_gnu" >&6
-gnu_ld=$libc_cv_prog_ld_gnu
 
-
-# Accept binutils 2.13 or newer.
-for ac_prog in $AS
+for ac_prog in makeinfo
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_AS+set}" = set; then
+if test "${ac_cv_prog_MAKEINFO+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$AS"; then
-  ac_cv_prog_AS="$AS" # Let the user override the test.
+  if test -n "$MAKEINFO"; then
+  ac_cv_prog_MAKEINFO="$MAKEINFO" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
@@ -3762,7 +3931,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_AS="$ac_prog"
+    ac_cv_prog_MAKEINFO="$ac_prog"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -3771,28 +3940,28 @@
 
 fi
 fi
-AS=$ac_cv_prog_AS
-if test -n "$AS"; then
-  echo "$as_me:$LINENO: result: $AS" >&5
-echo "${ECHO_T}$AS" >&6
+MAKEINFO=$ac_cv_prog_MAKEINFO
+if test -n "$MAKEINFO"; then
+  echo "$as_me:$LINENO: result: $MAKEINFO" >&5
+echo "${ECHO_T}$MAKEINFO" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-  test -n "$AS" && break
+  test -n "$MAKEINFO" && break
 done
 
-if test -z "$AS"; then
+if test -z "$MAKEINFO"; then
   ac_verc_fail=yes
 else
   # Found it, now check the version.
-  echo "$as_me:$LINENO: checking version of $AS" >&5
-echo $ECHO_N "checking version of $AS... $ECHO_C" >&6
-  ac_prog_version=`$AS --version 2>&1 | sed -n 's/^.*GNU assembler.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
+  echo "$as_me:$LINENO: checking version of $MAKEINFO" >&5
+echo $ECHO_N "checking version of $MAKEINFO... $ECHO_C" >&6
+  ac_prog_version=`$MAKEINFO --version 2>&1 | sed -n 's/^.*GNU texinfo.* \([0-9][0-9.]*\).*$/\1/p'`
   case $ac_prog_version in
     '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
-    2.1[3-9]*)
+    4.*)
        ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
     *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
 
@@ -3801,20 +3970,20 @@
 echo "${ECHO_T}$ac_prog_version" >&6
 fi
 if test $ac_verc_fail = yes; then
-  AS=: critic_missing=t
+  MAKEINFO=: aux_missing="$aux_missing makeinfo"
 fi
 
-for ac_prog in $LD
+for ac_prog in sed
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
 echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-if test "${ac_cv_prog_LD+set}" = set; then
+if test "${ac_cv_prog_SED+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  if test -n "$LD"; then
-  ac_cv_prog_LD="$LD" # Let the user override the test.
+  if test -n "$SED"; then
+  ac_cv_prog_SED="$SED" # Let the user override the test.
 else
 as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
 for as_dir in $PATH
@@ -3823,7 +3992,7 @@
   test -z "$as_dir" && as_dir=.
   for ac_exec_ext in '' $ac_executable_extensions; do
   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-    ac_cv_prog_LD="$ac_prog"
+    ac_cv_prog_SED="$ac_prog"
     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
   fi
@@ -3832,28 +4001,28 @@
 
 fi
 fi
-LD=$ac_cv_prog_LD
-if test -n "$LD"; then
-  echo "$as_me:$LINENO: result: $LD" >&5
-echo "${ECHO_T}$LD" >&6
+SED=$ac_cv_prog_SED
+if test -n "$SED"; then
+  echo "$as_me:$LINENO: result: $SED" >&5
+echo "${ECHO_T}$SED" >&6
 else
   echo "$as_me:$LINENO: result: no" >&5
 echo "${ECHO_T}no" >&6
 fi
 
-  test -n "$LD" && break
+  test -n "$SED" && break
 done
 
-if test -z "$LD"; then
+if test -z "$SED"; then
   ac_verc_fail=yes
 else
   # Found it, now check the version.
-  echo "$as_me:$LINENO: checking version of $LD" >&5
-echo $ECHO_N "checking version of $LD... $ECHO_C" >&6
-  ac_prog_version=`$LD --version 2>&1 | sed -n 's/^.*GNU ld.* \([0-9][0-9]*\.[0-9.]*\).*$/\1/p'`
+  echo "$as_me:$LINENO: checking version of $SED" >&5
+echo $ECHO_N "checking version of $SED... $ECHO_C" >&6
+  ac_prog_version=`$SED --version 2>&1 | sed -n 's/^.*GNU sed version \([0-9]*\.[0-9.]*\).*$/\1/p'`
   case $ac_prog_version in
     '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
-    2.1[3-9]*)
+    3.0[2-9]*|3.[1-9]*|[4-9]*)
        ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
     *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
 
@@ -3862,10 +4031,83 @@
 echo "${ECHO_T}$ac_prog_version" >&6
 fi
 if test $ac_verc_fail = yes; then
-  LD=: critic_missing=t
+  SED=: aux_missing="$aux_missing sed"
 fi
 
 
+for ac_prog in autoconf
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_AUTOCONF+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$AUTOCONF"; then
+  ac_cv_prog_AUTOCONF="$AUTOCONF" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AUTOCONF="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+AUTOCONF=$ac_cv_prog_AUTOCONF
+if test -n "$AUTOCONF"; then
+  echo "$as_me:$LINENO: result: $AUTOCONF" >&5
+echo "${ECHO_T}$AUTOCONF" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  test -n "$AUTOCONF" && break
+done
+test -n "$AUTOCONF" || AUTOCONF="no"
+
+case "x$AUTOCONF" in
+xno|x|x:) AUTOCONF=no ;;
+*)
+  echo "$as_me:$LINENO: checking whether $AUTOCONF${ACFLAGS:+ }$ACFLAGS works" >&5
+echo $ECHO_N "checking whether $AUTOCONF${ACFLAGS:+ }$ACFLAGS works... $ECHO_C" >&6
+if test "${libc_cv_autoconf_works+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+    if (cd $srcdir; $AUTOCONF $ACFLAGS configure.in > /dev/null 2>&1); then
+    libc_cv_autoconf_works=yes
+  else
+    libc_cv_autoconf_works=no
+  fi
+fi
+echo "$as_me:$LINENO: result: $libc_cv_autoconf_works" >&5
+echo "${ECHO_T}$libc_cv_autoconf_works" >&6
+  test $libc_cv_autoconf_works = yes || AUTOCONF=no
+  ;;
+esac
+if test "x$with_cvs" = xyes && test "x$AUTOCONF" = xno; then
+  # If --without-cvs they probably won't change configure.in, so no complaints.
+  aux_missing="$aux_missing autoconf"
+fi
+
+test -n "$critic_missing" && { { echo "$as_me:$LINENO: error:
+*** These critical programs are missing or too old:$critic_missing
+*** Check the INSTALL file for required versions." >&5
+echo "$as_me: error:
+*** These critical programs are missing or too old:$critic_missing
+*** Check the INSTALL file for required versions." >&2;}
+   { (exit 1); exit 1; }; }
+
 test -n "$aux_missing" && { echo "$as_me:$LINENO: WARNING:
 *** These auxiliary programs are missing or incompatible versions:$aux_missing
 *** some features will be disabled.
@@ -3899,7 +4141,7 @@
 char b;
 void c(void) {}
 EOF
-$CC $CFLAGS -c conftest.c
+$CC $CFLAGS $CPPFLAGS -c conftest.c
 $AR cr conftest.a conftest.o
 cp conftest.a conftest2.a
 $RANLIB conftest.a
@@ -4298,11 +4540,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #define __need_size_t
 #define __need_wchar_t
 #include <stddef.h>
@@ -4335,8 +4573,7 @@
   libc_cv_friendly_stddef=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 libc_cv_friendly_stddef=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -4357,7 +4594,12 @@
 #include "confdefs.h"
 /* Nothing whatsoever.  */
 EOF
-if ${CC-cc} $CFLAGS -c conftest.S 2>/dev/null; then
+if { ac_try='${CC-cc} $CPPFLAGS $ASFLAGS -c conftest.S 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
   libc_cv_need_minus_P=no
 else
   libc_cv_need_minus_P=yes
@@ -4380,7 +4622,12 @@
 .text
 EOF
 libc_cv_dot_text=
-if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+if { ac_try='${CC-cc} $ASFLAGS -c conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
   libc_cv_dot_text=.text
 fi
 rm -f conftest*
@@ -4406,7 +4653,12 @@
 	${ac_globl} foo
 foo:
 EOF
-  if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+  if { ac_try='${CC-cc} $ASFLAGS -c conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
     libc_cv_asm_global_directive=${ac_globl}
   fi
   rm -f conftest*
@@ -4441,9 +4693,10 @@
 # (but it doesn't work), so we must do a linking check to be sure.
 cat > conftest1.c <<\EOF
 extern int glibc_conftest_frobozz;
-main () { printf ("%d\n", glibc_conftest_frobozz); }
+void _start() { glibc_conftest_frobozz = 1; }
 EOF
 if ${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS \
+	    -nostartfiles -nostdlib \
 	    -o conftest conftest.s conftest1.c 1>&5 2>&5; then
   libc_cv_asm_set_directive=yes
 else
@@ -4475,7 +4728,12 @@
 foo:
 	.byte 1
 EOF
-  if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+  if { ac_try='${CC-cc} $ASFLAGS -c conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
     libc_cv_asm_type_prefix=${ac_try_prefix}
   fi
   rm -f conftest*
@@ -4511,7 +4769,7 @@
 _sym:
 .symver _sym,sym@VERS
 EOF
-if ${CC-cc} -c $CFLAGS $CPPFLAGS conftest.s 1>&5 2>&5; then
+if ${CC-cc} -c $ASFLAGS conftest.s 1>&5 2>&5; then
   libc_cv_asm_symver_directive=yes
 else
   libc_cv_asm_symver_directive=no
@@ -4540,10 +4798,11 @@
         global: sym;
 } VERS_1;
 EOF
-  if ${CC-cc} -c $CFLAGS $CPPFLAGS conftest.s 1>&5 2>&5; then
-    if { ac_try='${CC-cc} $CFLAGS -shared -o conftest.so conftest.o
-					-nostartfiles -nostdlib
-					-Wl,--version-script,conftest.map
+  if ${CC-cc} -c $ASFLAGS conftest.s 1>&5 2>&5; then
+    if { ac_try='${CC-cc} $CFLAGS $LDFLAGS -shared
+				-o conftest.so conftest.o
+				-nostartfiles -nostdlib
+				-Wl,--version-script,conftest.map
 		       1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
@@ -4596,7 +4855,7 @@
 .section foo_section
 .previous
 EOF
-  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'
+  if { ac_try='${CC-cc} -c $ASFLAGS conftest.s 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4625,7 +4884,7 @@
 .pushsection foo_section
 .popsection
 EOF
-    if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'
+    if { ac_try='${CC-cc} -c $ASFLAGS conftest.s 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4657,7 +4916,7 @@
 .hidden bar
 bar:
 EOF
-  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'
+  if { ac_try='${CC-cc} -c $ASFLAGS conftest.s 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4692,7 +4951,12 @@
 		  int bar __attribute__ ((visibility ("protected"))) = 1;
 EOF
 		  libc_cv_visibility_attribute=no
-		  if ${CC-cc} -Werror -S conftest.c -o conftest.s >/dev/null 2>&1; then
+		  if { ac_try='${CC-cc} -Werror -S conftest.c -o conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
 		    if grep '\.hidden.*foo' conftest.s >/dev/null; then
 		      if grep '\.protected.*bar' conftest.s >/dev/null; then
 			libc_cv_visibility_attribute=yes
@@ -4724,7 +4988,12 @@
 		  int bar (int x) { return x; }
 EOF
 		  libc_cv_broken_visibility_attribute=yes
-		  if ${CC-cc} -Werror -S conftest.c -o conftest.s >/dev/null 2>&1; then
+		  if { ac_try='${CC-cc} -Werror -S conftest.c -o conftest.s1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
 		    if grep '\.hidden[ 	_]foo' conftest.s >/dev/null; then
 		      libc_cv_broken_visibility_attribute=no
 		    fi
@@ -4756,7 +5025,12 @@
 		  int dfoo = 1;
 EOF
 		  libc_cv_broken_alias_attribute=yes
-		  if ${CC-cc} -Werror -S conftest.c -o conftest.s >/dev/null 2>&1; then
+		  if { ac_try='${CC-cc} -Werror -S conftest.c -o conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
 		    if grep 'xyzzy' conftest.s >/dev/null &&
 		       grep 'abccb' conftest.s >/dev/null; then
 		      libc_cv_broken_alias_attribute=no
@@ -4782,7 +5056,7 @@
 else
   echo "int i;" > conftest.c
 		  libc_cv_have_sdata_section=no
-		  if ${CC-cc} -shared -Wl,--verbose conftest.c -o conftest.so 2>&1 \
+		  if ${CC-cc} $LDFLAGS -shared -Wl,--verbose conftest.c -o conftest.so 2>&1 \
 		     | grep '\.sdata' >/dev/null; then
 		    libc_cv_have_sdata_section=yes
 		  fi
@@ -4810,7 +5084,7 @@
 int foo (void) { return 1; }
 int (*fp) (void) __attribute__ ((section (".init_array"))) = foo;
 EOF
-  if { ac_try='${CC-cc} -o conftest conftest.c
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS -o conftest conftest.c
 		     -static -nostartfiles -nostdlib 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
@@ -4846,7 +5120,8 @@
     cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+		     -shared -o conftest.so conftest.c
 		     -nostartfiles -nostdlib
 		     -Wl,--enable-new-dtags,-z,nodelete 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
@@ -4873,7 +5148,8 @@
     cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			-shared -o conftest.so conftest.c
 			-nostartfiles -nostdlib
 			-Wl,--enable-new-dtags,-z,nodlopen 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
@@ -4900,7 +5176,8 @@
     cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			-shared -o conftest.so conftest.c
 			-nostartfiles -nostdlib
 			-Wl,--enable-new-dtags,-z,initfirst 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
@@ -4927,7 +5204,9 @@
     cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if { ac_try='${CC-cc} -shared -o conftest.so conftest.c -Wl,-Bgroup -nostdlib 1>&5'
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			      -shared -o conftest.so conftest.c
+			      -Wl,-Bgroup -nostdlib 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -4944,6 +5223,43 @@
 echo "${ECHO_T}$libc_cv_Bgroup" >&6
 
 
+  ASFLAGS_config=
+  echo "$as_me:$LINENO: checking whether --noexecstack is desirable for .S files" >&5
+echo $ECHO_N "checking whether --noexecstack is desirable for .S files... $ECHO_C" >&6
+if test "${libc_cv_as_noexecstack+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+    cat > conftest.c <<EOF
+void foo (void) { }
+EOF
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS
+		     -S -o conftest.s conftest.c 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } \
+     && grep -q .note.GNU-stack conftest.s \
+     && { ac_try='${CC-cc} $CFLAGS $CPPFLAGS -Wa,--noexecstack
+		       -c -o conftest.o conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }
+  then
+    libc_cv_as_noexecstack=yes
+  else
+    libc_cv_as_noexecstack=no
+  fi
+  rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_as_noexecstack" >&5
+echo "${ECHO_T}$libc_cv_as_noexecstack" >&6
+  if test $libc_cv_as_noexecstack = yes; then
+    ASFLAGS_config="$ASFLAGS_config -Wa,--noexecstack"
+  fi
+
   echo "$as_me:$LINENO: checking for -z combreloc" >&5
 echo $ECHO_N "checking for -z combreloc... $ECHO_C" >&6
 if test "${libc_cv_z_combreloc+set}" = set; then
@@ -4954,7 +5270,8 @@
 extern int mumble;
 int foo (void) { return bar (mumble); }
 EOF
-  if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			-shared -o conftest.so conftest.c
 			-nostdlib -nostartfiles
 			-Wl,-z,combreloc 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
@@ -4992,11 +5309,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 
 int
 main ()
@@ -5023,8 +5336,7 @@
   libc_cv_have_initfini=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 libc_cv_have_initfini=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -5084,11 +5396,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 asm ("_glibc_foobar:");
 int
 main ()
@@ -5113,8 +5421,7 @@
   libc_cv_asm_underscores=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 libc_cv_asm_underscores=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
@@ -5128,7 +5435,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5131 "configure"
+#line $LINENO "configure"
 #include "confdefs.h"
 void underscore_test(void) {
 return; }
@@ -5180,7 +5487,12 @@
 .weak foo
 .weak bar; bar = foo
 EOF
-if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+if { ac_try='${CC-cc} $ASFLAGS -c conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
   libc_cv_asm_weak_directive=yes
 else
   libc_cv_asm_weak_directive=no
@@ -5205,7 +5517,12 @@
 ${libc_cv_asm_global_directive} baz
 baz:
 EOF
-  if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+  if { ac_try='${CC-cc} $ASFLAGS -c conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
     libc_cv_asm_weakext_directive=yes
   else
     libc_cv_asm_weakext_directive=no
@@ -5246,7 +5563,7 @@
     cat > conftest.s <<EOF
  nop ; is_old_puffin
 EOF
-  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'
+  if { ac_try='${CC-cc} -c $ASFLAGS conftest.s 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -5272,6 +5589,92 @@
   ;;
 esac
 
+echo "$as_me:$LINENO: checking whether CFI directives are supported" >&5
+echo $ECHO_N "checking whether CFI directives are supported... $ECHO_C" >&6
+if test "${libc_cv_asm_cfi_directives+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat > conftest.s <<EOF
+        .text
+        .type   func,@function
+func:
+        .cfi_startproc
+	.cfi_remember_state
+	.cfi_rel_offset 1, 0
+        .cfi_endproc
+EOF
+if { ac_try='${CC-cc} $ASFLAGS -c conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  libc_cv_asm_cfi_directives=yes
+else
+  libc_cv_asm_cfi_directives=no
+fi
+rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_asm_cfi_directives" >&5
+echo "${ECHO_T}$libc_cv_asm_cfi_directives" >&6
+if test $libc_cv_asm_cfi_directives = yes; then
+  cat >>confdefs.h <<\_ACEOF
+#define HAVE_ASM_CFI_DIRECTIVES 1
+_ACEOF
+
+fi
+
+echo "$as_me:$LINENO: checking if -g produces usable source locations for assembler-with-cpp" >&5
+echo $ECHO_N "checking if -g produces usable source locations for assembler-with-cpp... $ECHO_C" >&6
+if test "${libc_cv_cpp_asm_debuginfo+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat > conftest.S <<EOF
+#include "confdefs.h"
+
+/* comment on
+   two lines */
+	${libc_cv_dot_text}
+	${libc_cv_asm_global_directive} foo
+foo:
+	/* Unfortunately this test only works for a real instruction,
+	   not for any of the machine-independent pseudo-ops.
+	   So we just have to assume everybody has a "nop".  */
+	nop
+	/* comment */
+	nop
+	/* comment */
+	nop
+EOF
+if { ac_try='${CC-cc} $CPPFLAGS $ASFLAGS -g -c conftest.S 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+   ac_pattern='conftest\.S'
+   { ac_try='readelf --debug-dump=line conftest.o |
+		   grep $ac_pattern 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  libc_cv_cpp_asm_debuginfo=yes
+else
+  libc_cv_cpp_asm_debuginfo=no
+fi
+rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_cpp_asm_debuginfo" >&5
+echo "${ECHO_T}$libc_cv_cpp_asm_debuginfo" >&6
+if test $libc_cv_cpp_asm_debuginfo = yes; then
+  cat >>confdefs.h <<\_ACEOF
+#define HAVE_CPP_ASM_DEBUGINFO 1
+_ACEOF
+
+fi
+
 echo "$as_me:$LINENO: checking for ld --no-whole-archive" >&5
 echo $ECHO_N "checking for ld --no-whole-archive... $ECHO_C" >&6
 if test "${libc_cv_ld_no_whole_archive+set}" = set; then
@@ -5282,7 +5685,7 @@
 int __eh_pc;
 __throw () {}
 EOF
-if { ac_try='${CC-cc} $CFLAGS
+if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
 			    -nostdlib -nostartfiles -Wl,--no-whole-archive
 			    -o conftest conftest.c 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
@@ -5312,7 +5715,7 @@
 int __eh_pc;
 __throw () {}
 EOF
-if { ac_try='${CC-cc} $CFLAGS
+if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
 			    -nostdlib -nostartfiles -fexceptions
 			    -o conftest conftest.c 1>&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
@@ -5342,11 +5745,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 int tester(int x) { asm ("" : : : "cc"); return x & 123; }
 int
 main ()
@@ -5371,8 +5770,7 @@
   libc_cv_c_asmcr0_bug='no'
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 libc_cv_c_asmcr0_bug='yes'
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -5393,7 +5791,7 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat > conftest.c <<EOF
-#line 5396 "configure"
+#line $LINENO "configure"
 static char *__EH_FRAME_BEGIN__;
 _start ()
 {
@@ -5419,28 +5817,24 @@
 __bzero () {}
 dl_iterate_phdr () {}
 EOF
-if { ac_try='${CC-cc} $CFLAGS -DCHECK__register_frame_info
-			    -nostdlib -nostartfiles
-			    -o conftest conftest.c -lgcc >&5'
+libc_unwind_check="${CC-cc} $CFLAGS $CPPFLAGS -DCHECK__register_frame_info \
+			    $LDFLAGS \
+			    -nostdlib -nostartfiles -o conftest conftest.c \
+			    -lgcc"
+# Some platforms' specs put -lgcc first.  The second one doesn't hurt.
+if { ac_try='$libc_unwind_check >&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
-  libc_cv_gcc_dwarf2_unwind_info=static
-else
-  libc_cv_gcc_dwarf2_unwind_info=no
-fi
-# Some platforms' specs put -lgcc first.  The second one doesn't hurt.
-libc_unwind_check="${CC-cc} $CFLAGS -DCHECK__register_frame_info \
-                            -nostdlib -nostartfiles -o conftest conftest.c \
-			    -lgcc -lgcc_eh -lgcc"
-if { ac_try='$libc_unwind_check >&5'
+  (exit $ac_status); }; } ||
+   { ac_try='$libc_unwind_check -lgcc_eh -lgcc >&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+  (exit $ac_status); }; }
+then
   if $libc_unwind_check -v 2>&1 >/dev/null \
      | grep -q -- --eh-frame-hdr; then
     libc_cv_gcc_dwarf2_unwind_info=no_registry_needed
@@ -5451,8 +5845,8 @@
   libc_cv_gcc_dwarf2_unwind_info=no
 fi
 if test $libc_cv_gcc_dwarf2_unwind_info = no; then
-  if { ac_try='${CC-cc} $CFLAGS -DCHECK__register_frame
-			      -nostdlib -nostartfiles
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS -DCHECK__register_frame
+			      $LDFLAGS -nostdlib -nostartfiles
 			      -o conftest conftest.c -lgcc >&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
@@ -5493,14 +5887,14 @@
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat > conftest.c <<EOF
-#line 5496 "configure"
+#line $LINENO "configure"
 int foo (int a)
 {
   a = __builtin_expect (a, 10);
   return a == 10 ? 0 : 1;
 }
 EOF
-if { ac_try='${CC-cc} $CFLAGS -nostdlib -nostartfiles
+if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS -nostdlib -nostartfiles
 			    -o conftest conftest.c -lgcc >&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
@@ -5555,13 +5949,47 @@
 
 fi
 
+echo "$as_me:$LINENO: checking for redirection of built-in functions" >&5
+echo $ECHO_N "checking for redirection of built-in functions... $ECHO_C" >&6
+if test "${libc_cv_gcc_builtin_redirection+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat > conftest.c <<\EOF
+extern char *strstr (const char *, const char *) __asm ("my_strstr");
+char *foo (const char *a, const char *b)
+{
+  return __builtin_strstr (a, b);
+}
+EOF
+if { ac_try='${CC-cc} -O3 -S conftest.c -o - | fgrep "my_strstr" > /dev/null'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; };
+then
+  libc_cv_gcc_builtin_redirection=yes
+else
+  libc_cv_gcc_builtin_redirection=no
+fi
+rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_gcc_builtin_redirection" >&5
+echo "${ECHO_T}$libc_cv_gcc_builtin_redirection" >&6
+if test "$libc_cv_gcc_builtin_redirection" = yes ; then
+  cat >>confdefs.h <<\_ACEOF
+#define HAVE_BUILTIN_REDIRECTION 1
+_ACEOF
+
+fi
+
 echo "$as_me:$LINENO: checking for local label subtraction" >&5
 echo $ECHO_N "checking for local label subtraction... $ECHO_C" >&6
 if test "${libc_cv_gcc_subtract_local_labels+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   cat > conftest.c <<EOF
-#line 5564 "configure"
+#line $LINENO "configure"
 int foo (int a)
 {
   static const int ar[] = { &&l1 - &&l1, &&l2 - &&l1 };
@@ -5573,7 +6001,7 @@
   return 2;
 }
 EOF
-if { ac_try='${CC-cc} $CFLAGS -nostdlib -nostartfiles
+if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS -nostdlib -nostartfiles
 			    -o conftest conftest.c -lgcc >&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
@@ -5604,7 +6032,7 @@
   cat > conftest.c <<\EOF
 __thread int a = 42;
 EOF
-  if { ac_try='${CC-cc} $CFLAGS -c conftest.c >&5'
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS -c conftest.c >&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -5637,7 +6065,7 @@
     cat > conftest.c <<\EOF
 extern __thread int a __attribute__((tls_model ("initial-exec")));
 EOF
-  if { ac_try='${CC-cc} $CFLAGS -S -Werror conftest.c >&5'
+  if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS -S -Werror conftest.c >&5'
   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
   (eval $ac_try) 2>&5
   ac_status=$?
@@ -5670,11 +6098,7 @@
   LIBS="$LIBS -lgd -lpng -lz -lm"
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <gd.h>
 int
 main ()
@@ -5699,8 +6123,7 @@
   LIBGD=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 LIBGD=no
 fi
 rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
@@ -5737,54 +6160,43 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <stdlib.h>
 #include <stdarg.h>
 #include <string.h>
 #include <float.h>
 
-int
-main ()
-{
-
-  ;
-  return 0;
-}
 _ACEOF
-rm -f conftest.$ac_objext
-if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
-  (eval $ac_compile) 2>&5
-  ac_status=$?
-  echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); } &&
-         { ac_try='test -s conftest.$ac_objext'
-  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
-  (eval $ac_try) 2>&5
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
   ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
   echo "$as_me:$LINENO: \$? = $ac_status" >&5
-  (exit $ac_status); }; }; then
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_c_preproc_warn_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
   ac_cv_header_stdc=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
-ac_cv_header_stdc=no
+  cat conftest.$ac_ext >&5
+  ac_cv_header_stdc=no
 fi
-rm -f conftest.$ac_objext conftest.$ac_ext
+rm -f conftest.err conftest.$ac_ext
 
 if test $ac_cv_header_stdc = yes; then
   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <string.h>
 
 _ACEOF
@@ -5802,11 +6214,7 @@
   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <stdlib.h>
 
 _ACEOF
@@ -5827,18 +6235,13 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 #include <ctype.h>
 #if ((' ' & 0x0FF) == 0x020)
 # define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
 # define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
 #else
-# define ISLOWER(c) \
-                   (('a' <= (c) && (c) <= 'i') \
+# define ISLOWER(c) (('a' <= (c) && (c) <= 'i') \
                      || ('j' <= (c) && (c) <= 'r') \
                      || ('s' <= (c) && (c) <= 'z'))
 # define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))
@@ -5871,8 +6274,7 @@
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ( exit $ac_status )
 ac_cv_header_stdc=no
 fi
@@ -5911,11 +6313,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 
 #include <$ac_header>
@@ -5935,8 +6333,7 @@
   eval "$as_ac_Header=yes"
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 eval "$as_ac_Header=no"
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -5960,11 +6357,7 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 int
 main ()
@@ -5992,8 +6385,7 @@
   ac_cv_type_long_double=yes
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ac_cv_type_long_double=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -6015,11 +6407,7 @@
   # Depending upon the size, compute the lo and hi bounds.
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 int
 main ()
@@ -6047,11 +6435,7 @@
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 int
 main ()
@@ -6078,8 +6462,7 @@
   ac_hi=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ac_lo=`expr $ac_mid + 1`
                     if test $ac_lo -le $ac_mid; then
                       ac_lo= ac_hi=
@@ -6091,15 +6474,10 @@
   done
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 int
 main ()
@@ -6127,11 +6505,7 @@
   while :; do
     cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 int
 main ()
@@ -6158,8 +6532,7 @@
   ac_lo=$ac_mid; break
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ac_hi=`expr '(' $ac_mid ')' - 1`
                        if test $ac_mid -le $ac_hi; then
                          ac_lo= ac_hi=
@@ -6171,8 +6544,7 @@
   done
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ac_lo= ac_hi=
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -6183,11 +6555,7 @@
   ac_mid=`expr '(' $ac_hi - $ac_lo ')' / 2 + $ac_lo`
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 int
 main ()
@@ -6214,35 +6582,26 @@
   ac_hi=$ac_mid
 else
   echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ac_lo=`expr '(' $ac_mid ')' + 1`
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
 done
 case $ac_lo in
 ?*) ac_cv_sizeof_long_double=$ac_lo;;
-'') { { echo "$as_me:$LINENO: error: cannot compute sizeof (long double), 77
-See \`config.log' for more details." >&5
-echo "$as_me: error: cannot compute sizeof (long double), 77
-See \`config.log' for more details." >&2;}
+'') { { echo "$as_me:$LINENO: error: cannot compute sizeof (long double), 77" >&5
+echo "$as_me: error: cannot compute sizeof (long double), 77" >&2;}
    { (exit 1); exit 1; }; } ;;
 esac
 else
   if test "$cross_compiling" = yes; then
-  { { echo "$as_me:$LINENO: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&5
-echo "$as_me: error: cannot run test program while cross compiling
-See \`config.log' for more details." >&2;}
+  { { echo "$as_me:$LINENO: error: cannot run test program while cross compiling" >&5
+echo "$as_me: error: cannot run test program while cross compiling" >&2;}
    { (exit 1); exit 1; }; }
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-/* confdefs.h.  */
-_ACEOF
-cat confdefs.h >>conftest.$ac_ext
-cat >>conftest.$ac_ext <<_ACEOF
-/* end confdefs.h.  */
+#include "confdefs.h"
 $ac_includes_default
 long longval () { return (long) (sizeof (long double)); }
 unsigned long ulongval () { return (long) (sizeof (long double)); }
@@ -6290,13 +6649,10 @@
 else
   echo "$as_me: program exited with status $ac_status" >&5
 echo "$as_me: failed program was:" >&5
-sed 's/^/| /' conftest.$ac_ext >&5
-
+cat conftest.$ac_ext >&5
 ( exit $ac_status )
-{ { echo "$as_me:$LINENO: error: cannot compute sizeof (long double), 77
-See \`config.log' for more details." >&5
-echo "$as_me: error: cannot compute sizeof (long double), 77
-See \`config.log' for more details." >&2;}
+{ { echo "$as_me:$LINENO: error: cannot compute sizeof (long double), 77" >&5
+echo "$as_me: error: cannot compute sizeof (long double), 77" >&2;}
    { (exit 1); exit 1; }; }
 fi
 rm -f core core.* *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext
@@ -6335,8 +6691,8 @@
     *)  dest=$srcdir/$dir ;;
   esac
   if test -r $dest/configure; then
-    echo "$as_me:$LINENO: result: running configure fragment for $dest" >&5
-echo "${ECHO_T}running configure fragment for $dest" >&6
+    echo "$as_me:$LINENO: result: running configure fragment for $dir" >&5
+echo "${ECHO_T}running configure fragment for $dir" >&6
     . $dest/configure
   fi
 
@@ -6461,6 +6817,7 @@
 
 
 
+
 if test $gnu_ld = yes; then
   cat >>confdefs.h <<\_ACEOF
 #define HAVE_GNU_LD 1
@@ -6594,7 +6951,7 @@
      t end
      /^ac_cv_env/!s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
      : end' >>confcache
-if diff $cache_file confcache >/dev/null 2>&1; then :; else
+if cmp -s $cache_file confcache; then :; else
   if test -w $cache_file; then
     test "x$cache_file" != "x/dev/null" && echo "updating cache $cache_file"
     cat confcache >$cache_file
@@ -6654,8 +7011,6 @@
 # configure, is in config.log if it exists.
 
 debug=false
-ac_cs_recheck=false
-ac_cs_silent=false
 SHELL=\${CONFIG_SHELL-$SHELL}
 _ACEOF
 
@@ -6690,10 +7045,7 @@
 PS4='+ '
 
 # NLS nuisances.
-for as_var in \
-  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
-  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
-  LC_TELEPHONE LC_TIME
+for as_var in LANG LANGUAGE LC_ALL LC_COLLATE LC_CTYPE LC_NUMERIC LC_MESSAGES LC_TIME
 do
   if (set +x; test -n "`(eval $as_var=C; export $as_var) 2>&1`"); then
     eval $as_var=C; export $as_var
@@ -6739,15 +7091,15 @@
 
 # The user is always right.
 if test "${PATH_SEPARATOR+set}" != set; then
-  echo "#! /bin/sh" >conf$$.sh
-  echo  "exit 0"   >>conf$$.sh
-  chmod +x conf$$.sh
-  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+  echo "#! /bin/sh" >conftest.sh
+  echo  "exit 0"   >>conftest.sh
+  chmod +x conftest.sh
+  if (PATH="/nonexistent;."; conftest.sh) >/dev/null 2>&1; then
     PATH_SEPARATOR=';'
   else
     PATH_SEPARATOR=:
   fi
-  rm -f conf$$.sh
+  rm -f conftest.sh
 fi
 
 
@@ -6910,7 +7262,7 @@
 cat >&5 <<_CSEOF
 
 This file was extended by GNU C Library $as_me (see version.h), which was
-generated by GNU Autoconf 2.57.  Invocation command line was
+generated by GNU Autoconf 2.54.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -6950,7 +7302,6 @@
 
   -h, --help       print this help, then exit
   -V, --version    print version number, then exit
-  -q, --quiet      do not print progress messages
   -d, --debug      don't remove temporary files
       --recheck    update $as_me by reconfiguring in the same conditions
   --file=FILE[:TEMPLATE]
@@ -6973,7 +7324,7 @@
 cat >>$CONFIG_STATUS <<_ACEOF
 ac_cs_version="\\
 GNU C Library config.status (see version.h)
-configured by $0, generated by GNU Autoconf 2.57,
+configured by $0, generated by GNU Autoconf 2.54,
   with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
 
 Copyright 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001
@@ -7010,9 +7361,12 @@
   case $ac_option in
   # Handling of the options.
 _ACEOF
-cat >>$CONFIG_STATUS <<\_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF
   -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
-    ac_cs_recheck=: ;;
+    echo "running $SHELL $0 " $ac_configure_args " --no-create --no-recursion"
+    exec $SHELL $0 $ac_configure_args --no-create --no-recursion ;;
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
   --version | --vers* | -V )
     echo "$ac_cs_version"; exit 0 ;;
   --he | --h)
@@ -7034,9 +7388,6 @@
     $ac_shift
     CONFIG_HEADERS="$CONFIG_HEADERS $ac_optarg"
     ac_need_defaults=false;;
-  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
-  | -silent | --silent | --silen | --sile | --sil | --si | --s)
-    ac_cs_silent=: ;;
 
   # This is an error.
   -*) { { echo "$as_me:$LINENO: error: unrecognized option: $1
@@ -7051,20 +7402,6 @@
   shift
 done
 
-ac_configure_extra_args=
-
-if $ac_cs_silent; then
-  exec 6>/dev/null
-  ac_configure_extra_args="$ac_configure_extra_args --silent"
-fi
-
-_ACEOF
-cat >>$CONFIG_STATUS <<_ACEOF
-if \$ac_cs_recheck; then
-  echo "running $SHELL $0 " $ac_configure_args \$ac_configure_extra_args " --no-create --no-recursion" >&6
-  exec $SHELL $0 $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
-fi
-
 _ACEOF
 
 cat >>$CONFIG_STATUS <<_ACEOF
@@ -7105,9 +7442,6 @@
   test "${CONFIG_COMMANDS+set}" = set || CONFIG_COMMANDS=$config_commands
 fi
 
-# Have a temporary directory for convenience.  Make it in the build tree
-# simply because there is no reason to put it here, and in addition,
-# creating and moving files from /tmp can sometimes cause problems.
 # Create a temporary directory, and hook for its removal unless debugging.
 $debug ||
 {
@@ -7116,17 +7450,17 @@
 }
 
 # Create a (secure) tmp directory for tmp files.
-
+: ${TMPDIR=/tmp}
 {
-  tmp=`(umask 077 && mktemp -d -q "./confstatXXXXXX") 2>/dev/null` &&
+  tmp=`(umask 077 && mktemp -d -q "$TMPDIR/csXXXXXX") 2>/dev/null` &&
   test -n "$tmp" && test -d "$tmp"
 }  ||
 {
-  tmp=./confstat$$-$RANDOM
+  tmp=$TMPDIR/cs$$-$RANDOM
   (umask 077 && mkdir $tmp)
 } ||
 {
-   echo "$me: cannot create a temporary directory in ." >&2
+   echo "$me: cannot create a temporary directory in $TMPDIR" >&2
    { (exit 1); exit 1; }
 }
 
@@ -7176,6 +7510,7 @@
 s,@LIBS@,$LIBS,;t t
 s,@with_fp@,$with_fp,;t t
 s,@with_cvs@,$with_cvs,;t t
+s,@enable_check_abi@,$enable_check_abi,;t t
 s,@oldest_abi@,$oldest_abi,;t t
 s,@subdirs@,$subdirs,;t t
 s,@force_install@,$force_install,;t t
@@ -7194,13 +7529,7 @@
 s,@INSTALL_SCRIPT@,$INSTALL_SCRIPT,;t t
 s,@INSTALL_DATA@,$INSTALL_DATA,;t t
 s,@LN_S@,$LN_S,;t t
-s,@PWD_P@,$PWD_P,;t t
 s,@CC@,$CC,;t t
-s,@MAKE@,$MAKE,;t t
-s,@MSGFMT@,$MSGFMT,;t t
-s,@MAKEINFO@,$MAKEINFO,;t t
-s,@SED@,$SED,;t t
-s,@AUTOCONF@,$AUTOCONF,;t t
 s,@CFLAGS@,$CFLAGS,;t t
 s,@LDFLAGS@,$LDFLAGS,;t t
 s,@CPPFLAGS@,$CPPFLAGS,;t t
@@ -7209,6 +7538,9 @@
 s,@BUILD_CC@,$BUILD_CC,;t t
 s,@cross_compiling@,$cross_compiling,;t t
 s,@CPP@,$CPP,;t t
+s,@CXX@,$CXX,;t t
+s,@CXXFLAGS@,$CXXFLAGS,;t t
+s,@ac_ct_CXX@,$ac_ct_CXX,;t t
 s,@AR@,$AR,;t t
 s,@OBJDUMP@,$OBJDUMP,;t t
 s,@RANLIB@,$RANLIB,;t t
@@ -7216,6 +7548,12 @@
 s,@MIG@,$MIG,;t t
 s,@AS@,$AS,;t t
 s,@LD@,$LD,;t t
+s,@PWD_P@,$PWD_P,;t t
+s,@MAKE@,$MAKE,;t t
+s,@MSGFMT@,$MSGFMT,;t t
+s,@MAKEINFO@,$MAKEINFO,;t t
+s,@SED@,$SED,;t t
+s,@AUTOCONF@,$AUTOCONF,;t t
 s,@CCVERSION@,$CCVERSION,;t t
 s,@SYSINCLUDES@,$SYSINCLUDES,;t t
 s,@libc_cv_gcc_static_libgcc@,$libc_cv_gcc_static_libgcc,;t t
@@ -7235,8 +7573,10 @@
 s,@libc_cv_z_nodlopen@,$libc_cv_z_nodlopen,;t t
 s,@libc_cv_z_initfirst@,$libc_cv_z_initfirst,;t t
 s,@libc_cv_Bgroup@,$libc_cv_Bgroup,;t t
+s,@ASFLAGS_config@,$ASFLAGS_config,;t t
 s,@libc_cv_z_combreloc@,$libc_cv_z_combreloc,;t t
 s,@libc_cv_have_initfini@,$libc_cv_have_initfini,;t t
+s,@libc_cv_cpp_asm_debuginfo@,$libc_cv_cpp_asm_debuginfo,;t t
 s,@no_whole_archive@,$no_whole_archive,;t t
 s,@exceptions@,$exceptions,;t t
 s,@LIBGD@,$LIBGD,;t t
@@ -7251,6 +7591,7 @@
 s,@libc_cv_localedir@,$libc_cv_localedir,;t t
 s,@libc_cv_sysconfdir@,$libc_cv_sysconfdir,;t t
 s,@libc_cv_rootsbindir@,$libc_cv_rootsbindir,;t t
+s,@libc_cv_forced_unwind@,$libc_cv_forced_unwind,;t t
 s,@use_ldconfig@,$use_ldconfig,;t t
 s,@ldd_rewrite_script@,$ldd_rewrite_script,;t t
 s,@gnu_ld@,$gnu_ld,;t t
@@ -7649,7 +7990,7 @@
   cat $tmp/in >>$tmp/config.h
   rm -f $tmp/in
   if test x"$ac_file" != x-; then
-    if diff $ac_file $tmp/config.h >/dev/null 2>&1; then
+    if cmp -s $ac_file $tmp/config.h 2>/dev/null; then
       { echo "$as_me:$LINENO: $ac_file is unchanged" >&5
 echo "$as_me: $ac_file is unchanged" >&6;}
     else
@@ -7782,11 +8123,8 @@
 # need to make the FD available again.
 if test "$no_create" != yes; then
   ac_cs_success=:
-  ac_config_status_args=
-  test "$silent" = yes &&
-    ac_config_status_args="$ac_config_status_args --quiet"
   exec 5>/dev/null
-  $SHELL $CONFIG_STATUS $ac_config_status_args || ac_cs_success=false
+  $SHELL $CONFIG_STATUS || ac_cs_success=false
   exec 5>>config.log
   # Use ||, not &&, to avoid exiting from the if with $? = 1, which
   # would make configure fail if this is the last instruction.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/configure.in libc-20030708/configure.in
--- glibc-2.3.2/configure.in	2003-02-26 09:46:31.000000000 +0900
+++ libc-20030708/configure.in	2003-07-08 22:58:05.000000000 +0900
@@ -113,6 +113,14 @@
 	      [enable_sanity=$enableval],
 	      [enable_sanity=yes])
 
+AC_SUBST(enable_check_abi)
+AC_ARG_ENABLE([check-abi],
+	      AC_HELP_STRING([--enable-check-abi],
+			     [do "make check-abi" in "make check" (no/warn/yes)
+			      @<:@default=no@:>@]),
+	      [enable_check_abi=$enableval],
+	      [enable_check_abi=no])
+
 dnl Arguments to enable or disable building the static, shared, profiled,
 dnl and -fomit-frame-pointer libraries.
 dnl I've disabled this for now since we cannot build glibc without static
@@ -378,8 +386,33 @@
 m68k)		base_machine=m68k machine=m68k/m68020 ;;
 m88???)		base_machine=m88k machine=m88k/$machine ;;
 m88k)		base_machine=m88k machine=m88k/m88100 ;;
-mips64*)	base_machine=mips64 machine=mips/mips64/$machine ;;
-mips*)		base_machine=mips machine=mips/$machine ;;
+mips64*)	base_machine=mips64
+		case "$CC $CFLAGS $CPPFLAGS " in
+		*" -mabi=n32 "*) mips_cc_abi=n32 ;;
+		*" -mabi=64 "*|*" -mabi=n64 "*) mips_cc_abi=64 ;;
+		*" -mabi=32 "*|*" -mabi=o32 "*) mips_cc_abi=32 ;;
+		*) mips_cc_abi=default ;;
+		esac
+		case $config_os in
+		*abin32*) mips_config_abi=n32 ;;
+		*abi64*|*abin64*) mips_config_abi=64 ;;
+		*abi32*|*abio32*) mips_config_abi=32 ;;
+		*) mips_config_abi=$mips_cc_abi ;;
+		esac
+		case $mips_config_abi in
+		default) machine=mips/mips64/n32 mips_config_abi=n32 ;;
+		n32) machine=mips/mips64/n32 ;;
+		64) machine=mips/mips64/n64 ;;
+		32) machine=mips/mips32/kern64 ;;
+		esac
+		machine=$machine/$config_machine
+		if test $mips_config_abi != $mips_cc_abi; then
+		  # This won't make it to config.make, but we want to
+		  # set this in case configure tests depend on it.
+		  CPPFLAGS="$CPPFLAGS -mabi=$mips_config_abi"
+		fi
+		;;
+mips*)		base_machine=mips machine=mips/mips32/$machine ;;
 powerpc)	base_machine=powerpc machine=powerpc/powerpc32 ;;
 powerpc64)	base_machine=powerpc machine=powerpc/powerpc64 ;;
 s390)           base_machine=s390 machine=s390/s390-32 ;;
@@ -637,6 +670,25 @@
 fi
 AC_PROG_LN_S
 
+AC_PROG_CC
+if test $host != $build; then
+  AC_CHECK_PROGS(BUILD_CC, gcc cc)
+fi
+AC_SUBST(cross_compiling)
+AC_PROG_CPP
+# We need the C++ compiler only for testing.
+AC_PROG_CXX
+LIBC_PROG_BINUTILS
+AC_SUBST(MIG)dnl Needed by sysdeps/mach/configure.in
+
+# Accept binutils 2.13 or newer.
+AC_CHECK_PROG_VER(AS, $AS, --version,
+		  [GNU assembler.* \([0-9]*\.[0-9.]*\)],
+		  [2.1[3-9]*], AS=: critic_missing="$critic_missing as")
+AC_CHECK_PROG_VER(LD, $LD, --version,
+		  [GNU ld.* \([0-9][0-9]*\.[0-9.]*\)],
+		  [2.1[3-9]*], LD=: critic_missing="$critic_missing ld")
+
 # We need the physical current working directory.  We cannot use the
 # "pwd -P" shell builtin since that's not portable.  Instead we try to
 # find a pwd binary.  Note that assigning to the PWD environment
@@ -656,14 +708,6 @@
   [GNU Make[^0-9]*\([0-9][0-9.]*\)],
   [3.79* | 3.[89]*], critic_missing="$critic_missing make")
 
-
-if test -n "$critic_missing"; then
-AC_MSG_ERROR([
-*** These critical programs are missing or too old:$critic_missing
-*** Check the INSTALL file for required versions.])
-fi
-
-
 AC_CHECK_PROG_VER(MSGFMT, gnumsgfmt gmsgfmt msgfmt, --version,
   [GNU gettext.* \([0-9]*\.[0-9.]*\)],
   [0.10.3[6-9]* | 0.10.[4-9][0-9]* | 0.1[1-9]* | 0.[2-9][0-9]* | [1-9].*],
@@ -677,40 +721,28 @@
   [3.0[2-9]*|3.[1-9]*|[4-9]*],
   SED=: aux_missing="$aux_missing sed")
 
-if test "x$with_cvs" != xyes; then
-  AC_CHECK_PROGS(AUTOCONF, autoconf, no)
-  case "x$AUTOCONF" in
-  xno|x|x:) AUTOCONF=no ;;
-  *)
-    AC_CACHE_CHECK(dnl
+AC_CHECK_PROGS(AUTOCONF, autoconf, no)
+case "x$AUTOCONF" in
+xno|x|x:) AUTOCONF=no ;;
+*)
+  AC_CACHE_CHECK(dnl
 whether $AUTOCONF${ACFLAGS:+ }$ACFLAGS works, libc_cv_autoconf_works, [dnl
-    if (cd $srcdir; $AUTOCONF $ACFLAGS configure.in > /dev/null 2>&1); then
-      libc_cv_autoconf_works=yes
-    else
-      libc_cv_autoconf_works=no
-    fi])
-    test $libc_cv_autoconf_works = yes || AUTOCONF=no
-    ;;
-  esac
-  test "x$AUTOCONF" != xno || aux_missing="$aux_missing autoconf"
-fi
-
-AC_PROG_CC
-if test $host != $build; then
-  AC_CHECK_PROGS(BUILD_CC, gcc cc)
+  if (cd $srcdir; $AUTOCONF $ACFLAGS configure.in > /dev/null 2>&1); then
+    libc_cv_autoconf_works=yes
+  else
+    libc_cv_autoconf_works=no
+  fi])
+  test $libc_cv_autoconf_works = yes || AUTOCONF=no
+  ;;
+esac
+if test "x$with_cvs" = xyes && test "x$AUTOCONF" = xno; then
+  # If --without-cvs they probably won't change configure.in, so no complaints.
+  aux_missing="$aux_missing autoconf"
 fi
-AC_SUBST(cross_compiling)
-AC_PROG_CPP
-LIBC_PROG_BINUTILS
-AC_SUBST(MIG)dnl Needed by sysdeps/mach/configure.in
 
-# Accept binutils 2.13 or newer.
-AC_CHECK_PROG_VER(AS, $AS, --version,
-		  [GNU assembler.* \([0-9]*\.[0-9.]*\)],
-		  [2.1[3-9]*], AS=: critic_missing=t)
-AC_CHECK_PROG_VER(LD, $LD, --version,
-		  [GNU ld.* \([0-9][0-9]*\.[0-9.]*\)],
-		  [2.1[3-9]*], LD=: critic_missing=t)
+test -n "$critic_missing" && AC_MSG_ERROR([
+*** These critical programs are missing or too old:$critic_missing
+*** Check the INSTALL file for required versions.])
 
 test -n "$aux_missing" && AC_MSG_WARN([
 *** These auxiliary programs are missing or incompatible versions:$aux_missing
@@ -737,7 +769,7 @@
 char b;
 void c(void) {}
 EOF
-$CC $CFLAGS -c conftest.c
+$CC $CFLAGS $CPPFLAGS -c conftest.c
 $AR cr conftest.a conftest.o
 cp conftest.a conftest2.a
 $RANLIB conftest.a
@@ -889,7 +921,7 @@
 #include "confdefs.h"
 /* Nothing whatsoever.  */
 EOF
-if ${CC-cc} $CFLAGS -c conftest.S 2>/dev/null; then
+if AC_TRY_COMMAND(${CC-cc} $CPPFLAGS $ASFLAGS -c conftest.S 1>&AS_MESSAGE_LOG_FD); then
   libc_cv_need_minus_P=no
 else
   libc_cv_need_minus_P=yes
@@ -906,7 +938,7 @@
 .text
 EOF
 libc_cv_dot_text=
-if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+if AC_TRY_COMMAND(${CC-cc} $ASFLAGS -c conftest.s 1>&AS_MESSAGE_LOG_FD); then
   libc_cv_dot_text=.text
 fi
 rm -f conftest*])
@@ -925,7 +957,7 @@
 	${ac_globl} foo
 foo:
 EOF
-  if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+  if AC_TRY_COMMAND(${CC-cc} $ASFLAGS -c conftest.s 1>&AS_MESSAGE_LOG_FD); then
     libc_cv_asm_global_directive=${ac_globl}
   fi
   rm -f conftest*
@@ -948,9 +980,10 @@
 # (but it doesn't work), so we must do a linking check to be sure.
 cat > conftest1.c <<\EOF
 extern int glibc_conftest_frobozz;
-main () { printf ("%d\n", glibc_conftest_frobozz); }
+void _start() { glibc_conftest_frobozz = 1; }
 EOF
 if ${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS \
+	    -nostartfiles -nostdlib \
 	    -o conftest conftest.s conftest1.c 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD; then
   libc_cv_asm_set_directive=yes
 else
@@ -973,7 +1006,7 @@
 foo:
 	.byte 1
 EOF
-  if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+  if AC_TRY_COMMAND(${CC-cc} $ASFLAGS -c conftest.s 1>&AS_MESSAGE_LOG_FD); then
     libc_cv_asm_type_prefix=${ac_try_prefix}
   fi
   rm -f conftest*
@@ -996,7 +1029,7 @@
 _sym:
 .symver _sym,sym@VERS
 EOF
-if ${CC-cc} -c $CFLAGS $CPPFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD; then
+if ${CC-cc} -c $ASFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD; then
   libc_cv_asm_symver_directive=yes
 else
   libc_cv_asm_symver_directive=no
@@ -1018,10 +1051,11 @@
         global: sym;
 } VERS_1;
 EOF
-  if ${CC-cc} -c $CFLAGS $CPPFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD; then
-    if AC_TRY_COMMAND([${CC-cc} $CFLAGS -shared -o conftest.so conftest.o
-					-nostartfiles -nostdlib
-					-Wl,--version-script,conftest.map
+  if ${CC-cc} -c $ASFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD 2>&AS_MESSAGE_LOG_FD; then
+    if AC_TRY_COMMAND([${CC-cc} $CFLAGS $LDFLAGS -shared
+				-o conftest.so conftest.o
+				-nostartfiles -nostdlib
+				-Wl,--version-script,conftest.map
 		       1>&AS_MESSAGE_LOG_FD]);
     then
       libc_cv_ld_version_script_option=yes
@@ -1060,7 +1094,7 @@
 .section foo_section
 .previous
 EOF
-  if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
+  if AC_TRY_COMMAND(${CC-cc} -c $ASFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
     libc_cv_asm_previous_directive=yes
   else
     libc_cv_asm_previous_directive=no
@@ -1075,7 +1109,7 @@
 .pushsection foo_section
 .popsection
 EOF
-    if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
+    if AC_TRY_COMMAND(${CC-cc} -c $ASFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
       libc_cv_asm_popsection_directive=yes
     else
       libc_cv_asm_popsection_directive=no
@@ -1093,7 +1127,7 @@
 .hidden bar
 bar:
 EOF
-  if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
+  if AC_TRY_COMMAND(${CC-cc} -c $ASFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
     libc_cv_asm_protected_directive=yes
   else
     libc_cv_asm_protected_directive=no
@@ -1111,7 +1145,7 @@
 		  int bar __attribute__ ((visibility ("protected"))) = 1;
 EOF
 		  libc_cv_visibility_attribute=no
-		  if ${CC-cc} -Werror -S conftest.c -o conftest.s >/dev/null 2>&1; then
+		  if AC_TRY_COMMAND(${CC-cc} -Werror -S conftest.c -o conftest.s 1>&AS_MESSAGE_LOG_FD); then
 		    if grep '\.hidden.*foo' conftest.s >/dev/null; then
 		      if grep '\.protected.*bar' conftest.s >/dev/null; then
 			libc_cv_visibility_attribute=yes
@@ -1134,7 +1168,7 @@
 		  int bar (int x) { return x; }
 EOF
 		  libc_cv_broken_visibility_attribute=yes
-		  if ${CC-cc} -Werror -S conftest.c -o conftest.s >/dev/null 2>&1; then
+		  if AC_TRY_COMMAND(${CC-cc} -Werror -S conftest.c -o conftest.s1>&AS_MESSAGE_LOG_FD); then
 changequote(,)dnl
 		    if grep '\.hidden[ 	_]foo' conftest.s >/dev/null; then
 changequote([,])dnl
@@ -1159,7 +1193,7 @@
 		  int dfoo = 1;
 EOF
 		  libc_cv_broken_alias_attribute=yes
-		  if ${CC-cc} -Werror -S conftest.c -o conftest.s >/dev/null 2>&1; then
+		  if AC_TRY_COMMAND(${CC-cc} -Werror -S conftest.c -o conftest.s 1>&AS_MESSAGE_LOG_FD); then
 		    if grep 'xyzzy' conftest.s >/dev/null &&
 		       grep 'abccb' conftest.s >/dev/null; then
 		      libc_cv_broken_alias_attribute=no
@@ -1176,7 +1210,7 @@
 		 libc_cv_have_sdata_section,
 		 [echo "int i;" > conftest.c
 		  libc_cv_have_sdata_section=no
-		  if ${CC-cc} -shared -Wl,--verbose conftest.c -o conftest.so 2>&1 \
+		  if ${CC-cc} $LDFLAGS -shared -Wl,--verbose conftest.c -o conftest.so 2>&1 \
 		     | grep '\.sdata' >/dev/null; then
 		    libc_cv_have_sdata_section=yes
 		  fi
@@ -1195,7 +1229,7 @@
 int foo (void) { return 1; }
 int (*fp) (void) __attribute__ ((section (".init_array"))) = foo;
 EOF
-  if AC_TRY_COMMAND([${CC-cc} -o conftest conftest.c
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS -o conftest conftest.c
 		     -static -nostartfiles -nostdlib 1>&AS_MESSAGE_LOG_FD])
   then
     if readelf -S conftest | fgrep INIT_ARRAY > /dev/null; then
@@ -1217,7 +1251,8 @@
   cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if AC_TRY_COMMAND([${CC-cc} -shared -o conftest.so conftest.c
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+		     -shared -o conftest.so conftest.c
 		     -nostartfiles -nostdlib
 		     -Wl,--enable-new-dtags,-z,nodelete 1>&AS_MESSAGE_LOG_FD])
   then
@@ -1233,7 +1268,8 @@
   cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if AC_TRY_COMMAND([${CC-cc} -shared -o conftest.so conftest.c
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			-shared -o conftest.so conftest.c
 			-nostartfiles -nostdlib
 			-Wl,--enable-new-dtags,-z,nodlopen 1>&AS_MESSAGE_LOG_FD])
   then
@@ -1249,7 +1285,8 @@
   cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if AC_TRY_COMMAND([${CC-cc} -shared -o conftest.so conftest.c
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			-shared -o conftest.so conftest.c
 			-nostartfiles -nostdlib
 			-Wl,--enable-new-dtags,-z,initfirst 1>&AS_MESSAGE_LOG_FD])
   then
@@ -1265,7 +1302,9 @@
   cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if AC_TRY_COMMAND([${CC-cc} -shared -o conftest.so conftest.c -Wl,-Bgroup -nostdlib 1>&AS_MESSAGE_LOG_FD])
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			      -shared -o conftest.so conftest.c
+			      -Wl,-Bgroup -nostdlib 1>&AS_MESSAGE_LOG_FD])
   then
     libc_cv_Bgroup=yes
   else
@@ -1274,6 +1313,27 @@
   rm -f conftest*])
   AC_SUBST(libc_cv_Bgroup)
 
+  ASFLAGS_config=
+  AC_CACHE_CHECK(whether --noexecstack is desirable for .S files,
+		 libc_cv_as_noexecstack, [dnl
+  cat > conftest.c <<EOF
+void foo (void) { }
+EOF
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS
+		     -S -o conftest.s conftest.c 1>&AS_MESSAGE_LOG_FD]) \
+     && grep -q .note.GNU-stack conftest.s \
+     && AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS -Wa,--noexecstack
+		       -c -o conftest.o conftest.s 1>&AS_MESSAGE_LOG_FD])
+  then
+    libc_cv_as_noexecstack=yes
+  else
+    libc_cv_as_noexecstack=no
+  fi
+  rm -f conftest*])
+  if test $libc_cv_as_noexecstack = yes; then
+    ASFLAGS_config="$ASFLAGS_config -Wa,--noexecstack"
+  fi
+  AC_SUBST(ASFLAGS_config)
   AC_CACHE_CHECK(for -z combreloc,
 		 libc_cv_z_combreloc, [dnl
   cat > conftest.c <<EOF
@@ -1281,7 +1341,8 @@
 extern int mumble;
 int foo (void) { return bar (mumble); }
 EOF
-  if AC_TRY_COMMAND([${CC-cc} -shared -o conftest.so conftest.c
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
+			-shared -o conftest.so conftest.c
 			-nostdlib -nostartfiles
 			-Wl,-z,combreloc 1>&AS_MESSAGE_LOG_FD])
   then
@@ -1345,8 +1406,8 @@
 AC_DEFUN(AC_CHECK_ASM_UNDERSCORE,
 [cat > conftest.$ac_ext <<EOF
 dnl This sometimes fails to find confdefs.h, for some reason.
-dnl [#]line __oline__ "[$]0"
-[#]line __oline__ "configure"
+dnl [#]line $LINENO "[$]0"
+[#]line $LINENO "configure"
 #include "confdefs.h"
 void underscore_test(void) {
 return; }
@@ -1398,7 +1459,7 @@
 .weak foo
 .weak bar; bar = foo
 EOF
-if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+if AC_TRY_COMMAND(${CC-cc} $ASFLAGS -c conftest.s 1>&AS_MESSAGE_LOG_FD); then
   libc_cv_asm_weak_directive=yes
 else
   libc_cv_asm_weak_directive=no
@@ -1418,7 +1479,7 @@
 ${libc_cv_asm_global_directive} baz
 baz:
 EOF
-  if ${CC-cc} $CFLAGS -c conftest.s 2>/dev/null; then
+  if AC_TRY_COMMAND(${CC-cc} $ASFLAGS -c conftest.s 1>&AS_MESSAGE_LOG_FD); then
     libc_cv_asm_weakext_directive=yes
   else
     libc_cv_asm_weakext_directive=no
@@ -1447,7 +1508,7 @@
   cat > conftest.s <<EOF
  nop ; is_old_puffin
 EOF
-  if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
+  if AC_TRY_COMMAND(${CC-cc} -c $ASFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
     libc_cv_asm_line_sep='!'
   else
     if test -z "$enable_hacker_mode"; then
@@ -1462,6 +1523,58 @@
   ;;
 esac
 
+AC_CACHE_CHECK(whether CFI directives are supported, libc_cv_asm_cfi_directives, [dnl
+cat > conftest.s <<EOF
+        .text
+        .type   func,@function
+func:
+        .cfi_startproc
+	.cfi_remember_state
+	.cfi_rel_offset 1, 0
+        .cfi_endproc
+EOF
+if AC_TRY_COMMAND(${CC-cc} $ASFLAGS -c conftest.s 1>&AS_MESSAGE_LOG_FD); then
+  libc_cv_asm_cfi_directives=yes
+else
+  libc_cv_asm_cfi_directives=no
+fi
+rm -f conftest*])
+if test $libc_cv_asm_cfi_directives = yes; then
+  AC_DEFINE(HAVE_ASM_CFI_DIRECTIVES)
+fi
+
+AC_CACHE_CHECK(if -g produces usable source locations for assembler-with-cpp,
+	       libc_cv_cpp_asm_debuginfo, [dnl
+cat > conftest.S <<EOF
+#include "confdefs.h"
+
+/* comment on
+   two lines */
+	${libc_cv_dot_text}
+	${libc_cv_asm_global_directive} foo
+foo:
+	/* Unfortunately this test only works for a real instruction,
+	   not for any of the machine-independent pseudo-ops.
+	   So we just have to assume everybody has a "nop".  */
+	nop
+	/* comment */
+	nop
+	/* comment */
+	nop
+EOF
+if AC_TRY_COMMAND([${CC-cc} $CPPFLAGS $ASFLAGS -g -c conftest.S 1>&AS_MESSAGE_LOG_FD]) &&
+   ac_pattern='conftest\.S'
+   AC_TRY_COMMAND([readelf --debug-dump=line conftest.o |
+		   grep $ac_pattern 1>&AS_MESSAGE_LOG_FD]); then
+  libc_cv_cpp_asm_debuginfo=yes
+else
+  libc_cv_cpp_asm_debuginfo=no
+fi
+rm -f conftest*])AC_SUBST(libc_cv_cpp_asm_debuginfo)
+if test $libc_cv_cpp_asm_debuginfo = yes; then
+  AC_DEFINE(HAVE_CPP_ASM_DEBUGINFO)
+fi
+
 AC_CACHE_CHECK(for ld --no-whole-archive, libc_cv_ld_no_whole_archive, [dnl
 cat > conftest.c <<\EOF
 _start () {}
@@ -1469,7 +1582,7 @@
 __throw () {}
 EOF
 dnl No \ in command here because it ends up inside ''.
-if AC_TRY_COMMAND([${CC-cc} $CFLAGS
+if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
 			    -nostdlib -nostartfiles -Wl,--no-whole-archive
 			    -o conftest conftest.c 1>&AS_MESSAGE_LOG_FD]); then
   libc_cv_ld_no_whole_archive=yes
@@ -1489,7 +1602,7 @@
 __throw () {}
 EOF
 dnl No \ in command here because it ends up inside ''.
-if AC_TRY_COMMAND([${CC-cc} $CFLAGS
+if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS
 			    -nostdlib -nostartfiles -fexceptions
 			    -o conftest conftest.c 1>&AS_MESSAGE_LOG_FD]); then
   libc_cv_gcc_exceptions=yes
@@ -1516,7 +1629,7 @@
 
 AC_CACHE_CHECK(for DWARF2 unwind info support, libc_cv_gcc_dwarf2_unwind_info,
 [cat > conftest.c <<EOF
-#line __oline__ "configure"
+#line $LINENO "configure"
 static char *__EH_FRAME_BEGIN__;
 _start ()
 {
@@ -1542,19 +1655,14 @@
 __bzero () {}
 dl_iterate_phdr () {}
 EOF
-dnl No \ in command here because it ends up inside ''.
-if AC_TRY_COMMAND([${CC-cc} $CFLAGS -DCHECK__register_frame_info
-			    -nostdlib -nostartfiles
-			    -o conftest conftest.c -lgcc >&AS_MESSAGE_LOG_FD]); then
-  libc_cv_gcc_dwarf2_unwind_info=static
-else
-  libc_cv_gcc_dwarf2_unwind_info=no
-fi
+libc_unwind_check="${CC-cc} $CFLAGS $CPPFLAGS -DCHECK__register_frame_info \
+			    $LDFLAGS \
+			    -nostdlib -nostartfiles -o conftest conftest.c \
+			    -lgcc"
 # Some platforms' specs put -lgcc first.  The second one doesn't hurt.
-libc_unwind_check="${CC-cc} $CFLAGS -DCHECK__register_frame_info \
-                            -nostdlib -nostartfiles -o conftest conftest.c \
-			    -lgcc -lgcc_eh -lgcc"
-if AC_TRY_COMMAND([$libc_unwind_check >&AS_MESSAGE_LOG_FD]); then
+if AC_TRY_COMMAND([$libc_unwind_check >&AS_MESSAGE_LOG_FD]) ||
+   AC_TRY_COMMAND([$libc_unwind_check -lgcc_eh -lgcc >&AS_MESSAGE_LOG_FD])
+then
   if $libc_unwind_check -v 2>&1 >/dev/null \
      | grep -q -- --eh-frame-hdr; then
     libc_cv_gcc_dwarf2_unwind_info=no_registry_needed
@@ -1565,8 +1673,8 @@
   libc_cv_gcc_dwarf2_unwind_info=no
 fi
 if test $libc_cv_gcc_dwarf2_unwind_info = no; then
-  if AC_TRY_COMMAND([${CC-cc} $CFLAGS -DCHECK__register_frame
-			      -nostdlib -nostartfiles
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS -DCHECK__register_frame
+			      $LDFLAGS -nostdlib -nostartfiles
 			      -o conftest conftest.c -lgcc >&AS_MESSAGE_LOG_FD]); then
     libc_cv_gcc_dwarf2_unwind_info=yes
   else
@@ -1587,7 +1695,7 @@
 dnl Check whether compiler understands __builtin_expect.
 AC_CACHE_CHECK(for __builtin_expect, libc_cv_gcc_builtin_expect,
 [cat > conftest.c <<EOF
-#line __oline__ "configure"
+#line $LINENO "configure"
 int foo (int a)
 {
   a = __builtin_expect (a, 10);
@@ -1595,7 +1703,7 @@
 }
 EOF
 dnl No \ in command here because it ends up inside ''.
-if AC_TRY_COMMAND([${CC-cc} $CFLAGS -nostdlib -nostartfiles
+if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS -nostdlib -nostartfiles
 			    -o conftest conftest.c -lgcc >&AS_MESSAGE_LOG_FD]); then
   libc_cv_gcc_builtin_expect=yes
 else
@@ -1625,11 +1733,31 @@
   AC_DEFINE(HAVE_BUILTIN_MEMSET)
 fi
 
+AC_CACHE_CHECK(for redirection of built-in functions, libc_cv_gcc_builtin_redirection, [dnl
+cat > conftest.c <<\EOF
+extern char *strstr (const char *, const char *) __asm ("my_strstr");
+char *foo (const char *a, const char *b)
+{
+  return __builtin_strstr (a, b);
+}
+EOF
+dnl
+if AC_TRY_COMMAND([${CC-cc} -O3 -S conftest.c -o - | fgrep "my_strstr" > /dev/null]);
+then
+  libc_cv_gcc_builtin_redirection=yes
+else
+  libc_cv_gcc_builtin_redirection=no
+fi
+rm -f conftest* ])
+if test "$libc_cv_gcc_builtin_redirection" = yes ; then
+  AC_DEFINE(HAVE_BUILTIN_REDIRECTION)
+fi
+
 dnl Check whether the compiler supports subtraction of local labels.
 AC_CACHE_CHECK(for local label subtraction, libc_cv_gcc_subtract_local_labels,
 [cat > conftest.c <<EOF
 changequote(,)dnl
-#line __oline__ "configure"
+#line $LINENO "configure"
 int foo (int a)
 {
   static const int ar[] = { &&l1 - &&l1, &&l2 - &&l1 };
@@ -1643,7 +1771,7 @@
 changequote([,])dnl
 EOF
 dnl No \ in command here because it ends up inside ''.
-if AC_TRY_COMMAND([${CC-cc} $CFLAGS -nostdlib -nostartfiles
+if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS $LDFLAGS -nostdlib -nostartfiles
 			    -o conftest conftest.c -lgcc >&AS_MESSAGE_LOG_FD]); then
   libc_cv_gcc_subtract_local_labels=yes
 else
@@ -1660,7 +1788,7 @@
   [cat > conftest.c <<\EOF
 __thread int a = 42;
 EOF
-  if AC_TRY_COMMAND([${CC-cc} $CFLAGS -c conftest.c >&AS_MESSAGE_LOG_FD]); then
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS -c conftest.c >&AS_MESSAGE_LOG_FD]); then
     libc_cv_gcc___thread=yes
   else
     libc_cv_gcc___thread=no
@@ -1679,7 +1807,7 @@
   cat > conftest.c <<\EOF
 extern __thread int a __attribute__((tls_model ("initial-exec")));
 EOF
-  if AC_TRY_COMMAND([${CC-cc} $CFLAGS -S -Werror conftest.c >&AS_MESSAGE_LOG_FD]); then
+  if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS -S -Werror conftest.c >&AS_MESSAGE_LOG_FD]); then
     libc_cv_gcc_tls_model_attr=yes
   else
     libc_cv_gcc_tls_model_attr=no
@@ -1732,7 +1860,7 @@
     *)  dest=$srcdir/$dir ;;
   esac
   if test -r $dest/configure; then
-    AC_MSG_RESULT(running configure fragment for $dest)
+    AC_MSG_RESULT(running configure fragment for $dir)
     . $dest/configure
   fi
 [
@@ -1833,6 +1961,7 @@
 AC_SUBST(libc_cv_localedir)
 AC_SUBST(libc_cv_sysconfdir)
 AC_SUBST(libc_cv_rootsbindir)
+AC_SUBST(libc_cv_forced_unwind)
 
 AC_SUBST(use_ldconfig)
 AC_SUBST(ldd_rewrite_script)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/csu/Makefile libc-20030708/csu/Makefile
--- glibc-2.3.2/csu/Makefile	2003-01-01 07:24:37.000000000 +0900
+++ libc-20030708/csu/Makefile	2003-07-08 22:58:05.000000000 +0900
@@ -1,5 +1,5 @@
 # Makefile for csu code for GNU C library.
-# Copyright (C) 1995,96,97,98,99,2000,01,2002 Free Software Foundation, Inc.
+# Copyright (C) 1995,96,97,98,99,2000,01,02,2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -33,19 +33,29 @@
 static-only-routines = elf-init
 csu-dummies = $(filter-out $(start-installed-name),crt1.o Mcrt1.o)
 extra-objs = start.o gmon-start.o \
-	     $(start-installed-name) g$(start-installed-name) $(csu-dummies)
+	     $(start-installed-name) g$(start-installed-name) $(csu-dummies) \
+	     S$(start-installed-name)
 omit-deps = $(patsubst %.o,%,$(start-installed-name) g$(start-installed-name) \
-			      b$(start-installed-name) $(csu-dummies))
+			     b$(start-installed-name) $(csu-dummies) \
+			     S$(start-installed-name))
 install-lib = $(start-installed-name) g$(start-installed-name) $(csu-dummies)
 distribute = initfini.c gmon-start.c start.c defs.awk munch.awk \
-	     abi-note.S init.c munch-tmpl.c
+	     abi-note.S init.c munch-tmpl.c not-cancel.h
 generated = version-info.h
 before-compile = $(objpfx)version-info.h
 
+tests := tst-empty tst-atomic tst-atomic-long
+tests-static := tst-empty
+
 all: # Make this the default target; it will be defined in Rules.
 
 include ../Makeconfig
 
+ifeq (yes,$(build-shared))
+extra-objs += S$(start-installed-name)
+install-lib += S$(start-installed-name)
+endif
+
 ifeq (yes,$(build-bounded))
 extra-objs += b$(start-installed-name)
 install-lib += b$(start-installed-name)
@@ -80,11 +90,6 @@
 
 CPPFLAGS += -DHAVE_INITFINI
 
-# We don't want this compiled with PIC.
-# It's never included in shared libraries, unlike the rest of libc_nonshared.a.
-CPPFLAGS-elf-init.oS = $(patsubst %,-UPIC,$(pic-ccflag))
-CFLAGS-elf-init.oS = $(patsubst -f%,-fno-%,$(pic-ccflag))
-
 # These are the special initializer/finalizer files.  They are always the
 # first and last file in the link.  crti.o ... crtn.o define the global
 # "functions" _init and _fini to run the .init and .fini sections.
@@ -96,14 +101,14 @@
 omit-deps += $(crtstuff)
 
 # Special rules for the building of crti.o and crtn.o
-$(objpfx)crt%.o: $(objpfx)crt%.S $(objpfx)defs.h
+$(crtstuff:%=$(objpfx)%.o): %.o: %.S $(objpfx)defs.h
 	$(compile.S) -g0 $(ASFLAGS-.os) -o $@
 
 CFLAGS-initfini.s = -g0 -fPIC -fno-inline-functions
 
 vpath initfini.c $(full_config_sysdirs)
 
-$(objpfx)initfini.s: initfini.c
+$(objpfx)initfini.s: initfini.c $(before-compile)
 	$(compile.c) -S $(CFLAGS-initfini.s) -finhibit-size-directive \
 		$(patsubst -f%,-fno-%,$(exceptions)) -o $@
 
@@ -151,6 +156,9 @@
 $(objpfx)$(start-installed-name): $(objpfx)start.o $(objpfx)abi-note.o \
 				  $(objpfx)init.o
 	$(link-relocatable)
+$(objpfx)S$(start-installed-name): $(objpfx)start.os $(objpfx)abi-note.o \
+				  $(objpfx)init.o
+	$(link-relocatable)
 $(objpfx)b$(start-installed-name): $(objpfx)start.ob $(objpfx)abi-note.ob \
 				  $(objpfx)init.ob
 	$(link-relocatable)
@@ -160,6 +168,9 @@
 $(objpfx)$(start-installed-name): $(objpfx)start.o
 	rm -f $@
 	ln $< $@
+$(objpfx)S$(start-installed-name): $(objpfx)start.os
+	rm -f $@
+	ln $< $@
 $(objpfx)b$(start-installed-name): $(objpfx)start.ob
 	rm -f $@
 	ln $< $@
@@ -176,11 +187,9 @@
 
 # These extra files are sometimes expected by system standard linking
 # procedures, but we have nothing for them to do.  So compile empty files.
-$(addprefix $(objpfx),$(filter-out $(start-installed-name),$(csu-dummies))):
-	@-rm -f $(@:.o=.c)
-	echo > $(@:.o=.c)
-	$(COMPILE.c) $(@:.o=.c) $(OUTPUT_OPTION)
-	rm -f $(@:.o=.c)
+$(addprefix $(objpfx),$(filter-out $(start-installed-name), $(csu-dummies))):\
+  $(before-compile)
+	$(COMPILE.c) -o $@ -x c /dev/null
 
 # These headers are used by the startup code.
 $(objpfx)abi-tag.h: $(..)abi-tags
@@ -208,7 +217,7 @@
 	$(make-target-directory)
 	(case $(config-os) in \
 	   linux*) version=`(echo -e "#include <linux/version.h>\nUTS_RELEASE"\
-			     | $(CC) -E -P - | \
+			     | $(CC) $(CPPFLAGS) -E -P - | \
 			     sed -e 's/"\([^"]*\)".*/\1/p' -e d) 2>/dev/null`;\
 		   if [ -z "$$version" ]; then \
 		     if [ -r /proc/version ]; then \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/csu/elf-init.c libc-20030708/csu/elf-init.c
--- glibc-2.3.2/csu/elf-init.c	2003-01-01 08:41:32.000000000 +0900
+++ libc-20030708/csu/elf-init.c	2003-06-12 08:53:45.000000000 +0900
@@ -1,5 +1,5 @@
 /* Startup support for ELF initializers/finalizers in the main executable.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,12 +21,12 @@
 
 #ifdef HAVE_INITFINI_ARRAY
 /* These magic symbols are provided by the linker.  */
-extern void (*__preinit_array_start []) (void);
-extern void (*__preinit_array_end []) (void);
-extern void (*__init_array_start []) (void);
-extern void (*__init_array_end []) (void);
-extern void (*__fini_array_start []) (void);
-extern void (*__fini_array_end []) (void);
+extern void (*__preinit_array_start []) (void) attribute_hidden;
+extern void (*__preinit_array_end []) (void) attribute_hidden;
+extern void (*__init_array_start []) (void) attribute_hidden;
+extern void (*__init_array_end []) (void) attribute_hidden;
+extern void (*__fini_array_start []) (void) attribute_hidden;
+extern void (*__fini_array_end []) (void) attribute_hidden;
 #endif
 
 /* These function symbols are provided for the .init/.fini section entry
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/csu/tst-atomic-long.c libc-20030708/csu/tst-atomic-long.c
--- glibc-2.3.2/csu/tst-atomic-long.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/csu/tst-atomic-long.c	2003-03-23 08:00:17.000000000 +0900
@@ -0,0 +1,28 @@
+/* Tests for atomic.h macros.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Jakub Jelinek <jakub@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <bits/wordsize.h>
+
+#define atomic_t long
+#if __WORDSIZE == 64
+# define TEST_ATOMIC64 1
+#endif
+
+#include "tst-atomic.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/csu/tst-atomic.c libc-20030708/csu/tst-atomic.c
--- glibc-2.3.2/csu/tst-atomic.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/csu/tst-atomic.c	2003-05-12 01:30:07.000000000 +0900
@@ -0,0 +1,373 @@
+/* Tests for atomic.h macros.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Jakub Jelinek <jakub@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdio.h>
+#include <atomic.h>
+
+#ifndef atomic_t
+# define atomic_t int
+#endif
+
+/* Test various atomic.h macros.  */
+static int
+do_test (void)
+{
+  atomic_t mem;
+  int ret = 0;
+
+#ifdef atomic_compare_and_exchange_val_acq
+  mem = 24;
+  if (atomic_compare_and_exchange_val_acq (&mem, 35, 24) != 24
+      || mem != 35)
+    {
+      puts ("atomic_compare_and_exchange_val_acq test 1 failed");
+      ret = 1;
+    }
+
+  mem = 12;
+  if (atomic_compare_and_exchange_val_acq (&mem, 10, 15) != 12
+      || mem != 12)
+    {
+      puts ("atomic_compare_and_exchange_val_acq test 2 failed");
+      ret = 1;
+    }
+
+  mem = -15;
+  if (atomic_compare_and_exchange_val_acq (&mem, -56, -15) != -15
+      || mem != -56)
+    {
+      puts ("atomic_compare_and_exchange_val_acq test 3 failed");
+      ret = 1;
+    }
+
+  mem = -1;
+  if (atomic_compare_and_exchange_val_acq (&mem, 17, 0) != -1
+      || mem != -1)
+    {
+      puts ("atomic_compare_and_exchange_val_acq test 4 failed");
+      ret = 1;
+    }
+#endif
+
+  mem = 24;
+  if (atomic_compare_and_exchange_bool_acq (&mem, 35, 24)
+      || mem != 35)
+    {
+      puts ("atomic_compare_and_exchange_bool_acq test 1 failed");
+      ret = 1;
+    }
+
+  mem = 12;
+  if (! atomic_compare_and_exchange_bool_acq (&mem, 10, 15)
+      || mem != 12)
+    {
+      puts ("atomic_compare_and_exchange_bool_acq test 2 failed");
+      ret = 1;
+    }
+
+  mem = -15;
+  if (atomic_compare_and_exchange_bool_acq (&mem, -56, -15)
+      || mem != -56)
+    {
+      puts ("atomic_compare_and_exchange_bool_acq test 3 failed");
+      ret = 1;
+    }
+
+  mem = -1;
+  if (! atomic_compare_and_exchange_bool_acq (&mem, 17, 0)
+      || mem != -1)
+    {
+      puts ("atomic_compare_and_exchange_bool_acq test 4 failed");
+      ret = 1;
+    }
+
+  mem = 64;
+  if (atomic_exchange_acq (&mem, 31) != 64
+      || mem != 31)
+    {
+      puts ("atomic_exchange_acq test failed");
+      ret = 1;
+    }
+
+  mem = 2;
+  if (atomic_exchange_and_add (&mem, 11) != 2
+      || mem != 13)
+    {
+      puts ("atomic_exchange_and_add test failed");
+      ret = 1;
+    }
+
+  mem = -21;
+  atomic_add (&mem, 22);
+  if (mem != 1)
+    {
+      puts ("atomic_add test failed");
+      ret = 1;
+    }
+
+  mem = -1;
+  atomic_increment (&mem);
+  if (mem != 0)
+    {
+      puts ("atomic_increment test failed");
+      ret = 1;
+    }
+
+  mem = 0;
+  if (atomic_increment_and_test (&mem)
+      || mem != 1)
+    {
+      puts ("atomic_increment_and_test test 1 failed");
+      ret = 1;
+    }
+
+  mem = 35;
+  if (atomic_increment_and_test (&mem)
+      || mem != 36)
+    {
+      puts ("atomic_increment_and_test test 2 failed");
+      ret = 1;
+    }
+
+  mem = -1;
+  if (! atomic_increment_and_test (&mem)
+      || mem != 0)
+    {
+      puts ("atomic_increment_and_test test 3 failed");
+      ret = 1;
+    }
+
+  mem = 17;
+  atomic_decrement (&mem);
+  if (mem != 16)
+    {
+      puts ("atomic_decrement test failed");
+      ret = 1;
+    }
+
+  mem = 0;
+  if (atomic_decrement_and_test (&mem)
+      || mem != -1)
+    {
+      puts ("atomic_decrement_and_test test 1 failed");
+      ret = 1;
+    }
+
+  mem = 15;
+  if (atomic_decrement_and_test (&mem)
+      || mem != 14)
+    {
+      puts ("atomic_decrement_and_test test 2 failed");
+      ret = 1;
+    }
+
+  mem = 1;
+  if (! atomic_decrement_and_test (&mem)
+      || mem != 0)
+    {
+      puts ("atomic_decrement_and_test test 3 failed");
+      ret = 1;
+    }
+
+  mem = 1;
+  if (atomic_decrement_if_positive (&mem) != 1
+      || mem != 0)
+    {
+      puts ("atomic_decrement_if_positive test 1 failed");
+      ret = 1;
+    }
+
+  mem = 0;
+  if (atomic_decrement_if_positive (&mem) != 0
+      || mem != 0)
+    {
+      puts ("atomic_decrement_if_positive test 2 failed");
+      ret = 1;
+    }
+
+  mem = -1;
+  if (atomic_decrement_if_positive (&mem) != -1
+      || mem != -1)
+    {
+      puts ("atomic_decrement_if_positive test 3 failed");
+      ret = 1;
+    }
+
+  mem = -12;
+  if (! atomic_add_negative (&mem, 10)
+      || mem != -2)
+    {
+      puts ("atomic_add_negative test 1 failed");
+      ret = 1;
+    }
+
+  mem = 0;
+  if (atomic_add_negative (&mem, 100)
+      || mem != 100)
+    {
+      puts ("atomic_add_negative test 2 failed");
+      ret = 1;
+    }
+
+  mem = 15;
+  if (atomic_add_negative (&mem, -10)
+      || mem != 5)
+    {
+      puts ("atomic_add_negative test 3 failed");
+      ret = 1;
+    }
+
+  mem = -12;
+  if (atomic_add_negative (&mem, 14)
+      || mem != 2)
+    {
+      puts ("atomic_add_negative test 4 failed");
+      ret = 1;
+    }
+
+  mem = 0;
+  if (! atomic_add_negative (&mem, -1)
+      || mem != -1)
+    {
+      puts ("atomic_add_negative test 5 failed");
+      ret = 1;
+    }
+
+  mem = -31;
+  if (atomic_add_negative (&mem, 31)
+      || mem != 0)
+    {
+      puts ("atomic_add_negative test 6 failed");
+      ret = 1;
+    }
+
+  mem = -34;
+  if (atomic_add_zero (&mem, 31)
+      || mem != -3)
+    {
+      puts ("atomic_add_zero test 1 failed");
+      ret = 1;
+    }
+
+  mem = -36;
+  if (! atomic_add_zero (&mem, 36)
+      || mem != 0)
+    {
+      puts ("atomic_add_zero test 2 failed");
+      ret = 1;
+    }
+
+  mem = 113;
+  if (atomic_add_zero (&mem, -13)
+      || mem != 100)
+    {
+      puts ("atomic_add_zero test 3 failed");
+      ret = 1;
+    }
+
+  mem = -18;
+  if (atomic_add_zero (&mem, 20)
+      || mem != 2)
+    {
+      puts ("atomic_add_zero test 4 failed");
+      ret = 1;
+    }
+
+  mem = 10;
+  if (atomic_add_zero (&mem, -20)
+      || mem != -10)
+    {
+      puts ("atomic_add_zero test 5 failed");
+      ret = 1;
+    }
+
+  mem = 10;
+  if (! atomic_add_zero (&mem, -10)
+      || mem != 0)
+    {
+      puts ("atomic_add_zero test 6 failed");
+      ret = 1;
+    }
+
+  mem = 0;
+  atomic_bit_set (&mem, 1);
+  if (mem != 2)
+    {
+      puts ("atomic_bit_set test 1 failed");
+      ret = 1;
+    }
+
+  mem = 8;
+  atomic_bit_set (&mem, 3);
+  if (mem != 8)
+    {
+      puts ("atomic_bit_set test 2 failed");
+      ret = 1;
+    }
+
+#ifdef TEST_ATOMIC64
+  mem = 16;
+  atomic_bit_set (&mem, 35);
+  if (mem != 0x800000010LL)
+    {
+      puts ("atomic_bit_set test 3 failed");
+      ret = 1;
+    }
+#endif
+
+  mem = 0;
+  if (atomic_bit_test_set (&mem, 1)
+      || mem != 2)
+    {
+      puts ("atomic_bit_test_set test 1 failed");
+      ret = 1;
+    }
+
+  mem = 8;
+  if (! atomic_bit_test_set (&mem, 3)
+      || mem != 8)
+    {
+      puts ("atomic_bit_test_set test 2 failed");
+      ret = 1;
+    }
+
+#ifdef TEST_ATOMIC64
+  mem = 16;
+  if (atomic_bit_test_set (&mem, 35)
+      || mem != 0x800000010LL)
+    {
+      puts ("atomic_bit_test_set test 3 failed");
+      ret = 1;
+    }
+
+  mem = 0x100000000LL;
+  if (! atomic_bit_test_set (&mem, 32)
+      || mem != 0x100000000LL)
+    {
+      puts ("atomic_bit_test_set test 4 failed");
+      ret = 1;
+    }
+#endif
+
+  return ret;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/csu/tst-empty.c libc-20030708/csu/tst-empty.c
--- glibc-2.3.2/csu/tst-empty.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/csu/tst-empty.c	2003-04-12 09:16:59.000000000 +0900
@@ -0,0 +1,6 @@
+/* The most useful C program known to man.  */
+int
+main (void)
+{
+  return 0;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dirent/dirent.h libc-20030708/dirent/dirent.h
--- glibc-2.3.2/dirent/dirent.h	2001-07-08 04:20:52.000000000 +0900
+++ libc-20030708/dirent/dirent.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -128,12 +128,18 @@
 typedef struct __dirstream DIR;
 
 /* Open a directory stream on NAME.
-   Return a DIR stream on the directory, or NULL if it could not be opened.  */
-extern DIR *opendir (__const char *__name) __THROW;
+   Return a DIR stream on the directory, or NULL if it could not be opened.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern DIR *opendir (__const char *__name);
 
 /* Close the directory stream DIRP.
-   Return 0 if successful, -1 if not.  */
-extern int closedir (DIR *__dirp) __THROW;
+   Return 0 if successful, -1 if not.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int closedir (DIR *__dirp);
 
 /* Read a directory entry from DIRP.  Return a pointer to a `struct
    dirent' describing the entry, or NULL for EOF or error.  The
@@ -141,34 +147,40 @@
    same DIR stream.
 
    If the Large File Support API is selected we have to use the
-   appropriate interface.  */
+   appropriate interface.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 #ifndef __USE_FILE_OFFSET64
-extern struct dirent *readdir (DIR *__dirp) __THROW;
+extern struct dirent *readdir (DIR *__dirp);
 #else
 # ifdef __REDIRECT
-extern struct dirent *__REDIRECT (readdir, (DIR *__dirp) __THROW, readdir64);
+extern struct dirent *__REDIRECT (readdir, (DIR *__dirp), readdir64);
 # else
 #  define readdir readdir64
 # endif
 #endif
 
 #ifdef __USE_LARGEFILE64
-extern struct dirent64 *readdir64 (DIR *__dirp) __THROW;
+extern struct dirent64 *readdir64 (DIR *__dirp);
 #endif
 
 #if defined __USE_POSIX || defined __USE_MISC
 /* Reentrant version of `readdir'.  Return in RESULT a pointer to the
-   next entry.  */
+   next entry.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 # ifndef __USE_FILE_OFFSET64
 extern int readdir_r (DIR *__restrict __dirp,
 		      struct dirent *__restrict __entry,
-		      struct dirent **__restrict __result) __THROW;
+		      struct dirent **__restrict __result);
 # else
 #  ifdef __REDIRECT
 extern int __REDIRECT (readdir_r,
 		       (DIR *__restrict __dirp,
 			struct dirent *__restrict __entry,
-			struct dirent **__restrict __result) __THROW,
+			struct dirent **__restrict __result),
 		       readdir64_r);
 #  else
 #   define readdir_r readdir64_r
@@ -178,7 +190,7 @@
 # ifdef __USE_LARGEFILE64
 extern int readdir64_r (DIR *__restrict __dirp,
 			struct dirent64 *__restrict __entry,
-			struct dirent64 **__restrict __result) __THROW;
+			struct dirent64 **__restrict __result);
 # endif
 #endif	/* POSIX or misc */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dirent/scandir.c libc-20030708/dirent/scandir.c
--- glibc-2.3.2/dirent/scandir.c	2002-10-15 02:41:01.000000000 +0900
+++ libc-20030708/dirent/scandir.c	2003-07-08 22:58:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1992-1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1992-1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -27,6 +27,7 @@
 #define DIRENT_TYPE struct dirent
 #endif
 
+
 int
 SCANDIR (dir, namelist, select, cmp)
      const char *dir;
@@ -48,34 +49,47 @@
 
   i = 0;
   while ((d = READDIR (dp)) != NULL)
-    if (select == NULL || (*select) (d))
-      {
-	DIRENT_TYPE *vnew;
-	size_t dsize;
-
-	/* Ignore errors from select or readdir */
-	__set_errno (0);
-
-	if (__builtin_expect (i == vsize, 0))
-	  {
-	    DIRENT_TYPE **new;
-	    if (vsize == 0)
-	      vsize = 10;
-	    else
-	      vsize *= 2;
-	    new = (DIRENT_TYPE **) realloc (v, vsize * sizeof (*v));
-	    if (new == NULL)
-	      break;
-	    v = new;
-	  }
-
-	dsize = &d->d_name[_D_ALLOC_NAMLEN (d)] - (char *) d;
-	vnew = (DIRENT_TYPE *) malloc (dsize);
-	if (vnew == NULL)
-	  break;
+    {
+      int use_it = select == NULL;
 
-	v[i++] = (DIRENT_TYPE *) memcpy (vnew, d, dsize);
-      }
+      if (! use_it)
+	{
+	  use_it = select (d);
+	  /* The select function might have changed errno.  It was
+	     zero before and it need to be again to make the latter
+	     tests work.  */
+	  __set_errno (0);
+	}
+
+      if (use_it)
+	{
+	  DIRENT_TYPE *vnew;
+	  size_t dsize;
+
+	  /* Ignore errors from select or readdir */
+	  __set_errno (0);
+
+	  if (__builtin_expect (i == vsize, 0))
+	    {
+	      DIRENT_TYPE **new;
+	      if (vsize == 0)
+		vsize = 10;
+	      else
+		vsize *= 2;
+	      new = (DIRENT_TYPE **) realloc (v, vsize * sizeof (*v));
+	      if (new == NULL)
+		break;
+	      v = new;
+	    }
+
+	  dsize = &d->d_name[_D_ALLOC_NAMLEN (d)] - (char *) d;
+	  vnew = (DIRENT_TYPE *) malloc (dsize);
+	  if (vnew == NULL)
+	    break;
+
+	  v[i++] = (DIRENT_TYPE *) memcpy (vnew, d, dsize);
+	}
+    }
 
   if (__builtin_expect (errno, 0) != 0)
     {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/Makefile libc-20030708/dlfcn/Makefile
--- glibc-2.3.2/dlfcn/Makefile	2003-02-26 09:46:32.000000000 +0900
+++ libc-20030708/dlfcn/Makefile	2003-04-28 23:53:20.000000000 +0900
@@ -19,7 +19,8 @@
 subdir		:= dlfcn
 headers		:= bits/dlfcn.h dlfcn.h
 extra-libs	:= libdl
-libdl-routines	:= dlopen dlclose dlsym dlvsym dlerror dladdr eval
+libdl-routines	:= dlopen dlclose dlsym dlvsym dlerror dladdr dladdr1 dlinfo \
+		   eval
 distribute	:= dlopenold.c glreflib1.c glreflib2.c failtestmod.c eval.c \
 		   defaultmod1.c defaultmod2.c errmsg1mod.c modatexit.c \
 		   modcxaatexit.c modstatic.c \
@@ -37,7 +38,7 @@
 
 ifeq (yes,$(build-shared))
 tests = glrefmain failtest tst-dladdr default errmsg1 tstcxaatexit \
-	bug-dlopen1 bug-dlsym1
+	bug-dlopen1 bug-dlsym1 tst-dlinfo
 ifeq (yes,$(have-protected))
 tests += tstatexit
 endif
@@ -61,7 +62,7 @@
 LDFLAGS-dl.so = -Wl,-dynamic-linker,$(slibdir)/$(rtld-installed-name)
 
 test-modules = $(addprefix $(objpfx),$(addsuffix .so,$(modules-names)))
-$(test-modules): $(objpfx)%.so: $(objpfx)%.os
+$(test-modules): $(objpfx)%.so: $(objpfx)%.os $(common-objpfx)shlib.lds
 	$(build-module)
 
 $(objpfx)glrefmain: $(libdl)
@@ -74,6 +75,9 @@
 $(objpfx)tst-dladdr: $(libdl)
 $(objpfx)tst-dladdr.out: $(objpfx)glreflib1.so
 
+$(objpfx)tst-dlinfo: $(libdl)
+$(objpfx)tst-dlinfo.out: $(objpfx)glreflib1.so
+
 LDFLAGS-default = $(LDFLAGS-rdynamic)
 $(objpfx)default: $(libdl) $(objpfx)defaultmod1.so $(objpfx)defaultmod2.so
 $(objpfx)defaultmod1.so: $(libdl) $(common-objpfx)libc_nonshared.a
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/Versions libc-20030708/dlfcn/Versions
--- glibc-2.3.2/dlfcn/Versions	1999-07-08 03:25:24.000000000 +0900
+++ libc-20030708/dlfcn/Versions	2003-03-16 08:14:44.000000000 +0900
@@ -5,4 +5,7 @@
   GLIBC_2.1 {
     dlopen; dlvsym;
   }
+  GLIBC_2.3.3 {
+    dladdr1; dlinfo;
+  }
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/dladdr.c libc-20030708/dlfcn/dladdr.c
--- glibc-2.3.2/dlfcn/dladdr.c	2001-07-08 04:20:52.000000000 +0900
+++ libc-20030708/dlfcn/dladdr.c	2003-03-10 18:12:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* Locate the shared object symbol nearest a given address.
-   Copyright (C) 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,5 +22,5 @@
 int
 dladdr (const void *address, Dl_info *info)
 {
-  return _dl_addr (address, info);
+  return _dl_addr (address, info, NULL, NULL);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/dladdr1.c libc-20030708/dlfcn/dladdr1.c
--- glibc-2.3.2/dlfcn/dladdr1.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/dlfcn/dladdr1.c	2003-03-10 18:12:11.000000000 +0900
@@ -0,0 +1,35 @@
+/* Locate the shared object symbol nearest a given address.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <dlfcn.h>
+
+int
+dladdr1 (const void *address, Dl_info *info, void **extra, int flags)
+{
+  switch (flags)
+    {
+    default:			/* Make this an error?  */
+    case 0:
+      return _dl_addr (address, info, NULL, NULL);
+    case RTLD_DL_SYMENT:
+      return _dl_addr (address, info, NULL, (const ElfW(Sym) **) extra);
+    case RTLD_DL_LINKMAP:
+      return _dl_addr (address, info, (struct link_map **) extra, NULL);
+    }
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/dlerror.c libc-20030708/dlfcn/dlerror.c
--- glibc-2.3.2/dlfcn/dlerror.c	2002-11-19 15:51:37.000000000 +0900
+++ libc-20030708/dlfcn/dlerror.c	2003-03-16 05:06:37.000000000 +0900
@@ -1,5 +1,5 @@
 /* Return error detail for failing <dlfcn.h> functions.
-   Copyright (C) 1995,1996,1997,1998,1999,2000,2002
+   Copyright (C) 1995,1996,1997,1998,1999,2000,2002, 2003
 	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
@@ -69,9 +69,19 @@
   else if (result->errstring != NULL)
     {
       buf = (char *) result->errstring;
-      if (__asprintf (&buf, result->errcode != 0 ? "%s: %s: %s" : "%s: %s",
-		      result->objname, _(result->errstring),
-		      strerror (result->errcode)) != -1)
+      int n;
+      if (result->errcode == 0)
+	n = __asprintf (&buf, "%s%s%s",
+			result->objname,
+			result->objname[0] == '\0' ? "" : ": ",
+			_(result->errstring));
+      else
+	n = __asprintf (&buf, "%s%s%s: %s",
+			result->objname,
+			result->objname[0] == '\0' ? "" : ": ",
+			_(result->errstring),
+			strerror (result->errcode));
+      if (n != -1)
 	{
 	  /* We don't need the error string anymore.  */
 	  if (strcmp (result->errstring, "out of memory") != 0)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/dlfcn.h libc-20030708/dlfcn/dlfcn.h
--- glibc-2.3.2/dlfcn/dlfcn.h	2001-10-27 08:58:28.000000000 +0900
+++ libc-20030708/dlfcn/dlfcn.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,5 +1,5 @@
 /* User functions for run-time dynamic loading.
-   Copyright (C) 1995-1999, 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1995-1999,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,6 +21,8 @@
 #define	_DLFCN_H 1
 
 #include <features.h>
+#define __need_size_t
+#include <stddef.h>
 
 /* Collect various system dependent definitions and declarations.  */
 #include <bits/dlfcn.h>
@@ -43,8 +45,11 @@
 __BEGIN_DECLS
 
 /* Open the shared object FILE and map it in; return a handle that can be
-   passed to `dlsym' to get symbol values from it.  */
-extern void *dlopen (__const char *__file, int __mode) __THROW;
+   passed to `dlsym' to get symbol values from it.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void *dlopen (__const char *__file, int __mode);
 
 /* Unmap and close a shared object opened by `dlopen'.
    The handle cannot be used again after calling `dlclose'.  */
@@ -83,7 +88,74 @@
 /* Fill in *INFO with the following information about ADDRESS.
    Returns 0 iff no shared object's segments contain that address.  */
 extern int dladdr (__const void *__address, Dl_info *__info) __THROW;
-#endif
+
+/* Same as `dladdr', but additionally sets *EXTRA_INFO according to FLAGS.  */
+extern int dladdr1 (__const void *__address, Dl_info *__info,
+		    void **__extra_info, int __flags) __THROW;
+
+/* These are the possible values for the FLAGS argument to `dladdr1'.
+   This indicates what extra information is stored at *EXTRA_INFO.
+   It may also be zero, in which case the EXTRA_INFO argument is not used.  */
+enum
+  {
+    /* Matching symbol table entry (const ElfNN_Sym *).  */
+    RTLD_DL_SYMENT = 1,
+
+    /* The object containing the address (struct link_map *).  */
+    RTLD_DL_LINKMAP = 2
+  };
+
+
+/* Get information about the shared object HANDLE refers to.
+   REQUEST is from among the values below, and determines the use of ARG.
+
+   On success, returns zero.  On failure, returns -1 and records an error
+   message to be fetched with `dlerror'.  */
+extern int dlinfo (void *__restrict __handle,
+		   int __request, void *__restrict __arg);
+
+/* These are the possible values for the REQUEST argument to `dlinfo'.  */
+enum
+  {
+    /* Treat ARG as `struct link_map **';
+       store the `struct link_map *' for HANDLE there.  */
+    RTLD_DI_LINKMAP = 2,
+
+    /* Treat ARG as `Dl_serinfo *' (see below), and fill in to describe the
+       directories that will be searched for dependencies of this object.
+       RTLD_DI_SERINFOSIZE fills in just the `dls_cnt' and `dls_size'
+       entries to indicate the size of the buffer that must be passed to
+       RTLD_DI_SERINFO to fill in the full information.  */
+    RTLD_DI_SERINFO = 4,
+    RTLD_DI_SERINFOSIZE = 5,
+
+    /* Treat ARG as `char *', and store there the directory name used to
+       expand $ORIGIN in this shared object's dependency file names.  */
+    RTLD_DI_ORIGIN = 6,
+
+    RTLD_DI_LMID = 1,		/* Unsupported, defined by Solaris.  */
+    RTLD_DI_CONFIGADDR = 3	/* Unsupported, defined by Solaris.  */
+  };
+
+
+/* This is the type of elements in `Dl_serinfo', below.
+   The `dls_name' member points to space in the buffer passed to `dlinfo'.  */
+typedef struct
+{
+  char *dls_name;		/* Name of library search path directory.  */
+  unsigned int dls_flags;	/* Indicates where this directory came from. */
+} Dl_serpath;
+
+/* This is the structure that must be passed (by reference) to `dlinfo' for
+   the RTLD_DI_SERINFO and RTLD_DI_SERINFOSIZE requests.  */
+typedef struct
+{
+  size_t dls_size;		/* Size in bytes of the whole buffer.  */
+  unsigned int dls_cnt;		/* Number of elements in `dls_serpath'.  */
+  Dl_serpath dls_serpath[1];	/* Actually longer, dls_cnt elements.  */
+} Dl_serinfo;
+#endif /* __USE_GNU */
+
 
 __END_DECLS
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/dlinfo.c libc-20030708/dlfcn/dlinfo.c
--- glibc-2.3.2/dlfcn/dlinfo.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/dlfcn/dlinfo.c	2003-03-16 08:14:44.000000000 +0900
@@ -0,0 +1,87 @@
+/* dlinfo -- Get information from the dynamic linker.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <dlfcn.h>
+#include <link.h>
+#include <ldsodefs.h>
+#include <libintl.h>
+
+struct dlinfo_args
+{
+  ElfW(Addr) caller;
+  void *handle;
+  int request;
+  void *arg;
+};
+
+static void
+dlinfo_doit (void *argsblock)
+{
+  struct dlinfo_args *const args = argsblock;
+  struct link_map *l = args->handle;
+
+#if 0
+  if (args->handle == RTLD_SELF)
+    {
+
+      /* Find the highest-addressed object that CALLER is not below.  */
+      for (l = GL(dl_loaded); l != NULL; l = l->l_next)
+	if (caller >= l->l_map_start && caller < l->l_map_end)
+	  /* There must be exactly one DSO for the range of the virtual
+	     memory.  Otherwise something is really broken.  */
+	  break;
+
+      if (l == NULL)
+	_dl_signal_error (0, NULL, NULL, N_("\
+RTLD_SELF used in code not dynamically loaded"));
+    }
+#endif
+
+  switch (args->request)
+    {
+    case RTLD_DI_LMID:
+    case RTLD_DI_CONFIGADDR:
+    default:
+      _dl_signal_error (0, NULL, NULL, N_("unsupported dlinfo request"));
+      break;
+
+    case RTLD_DI_LINKMAP:
+      *(struct link_map **) args->arg = l;
+      break;
+
+    case RTLD_DI_SERINFO:
+      _dl_rtld_di_serinfo (l, args->arg, false);
+      break;
+    case RTLD_DI_SERINFOSIZE:
+      _dl_rtld_di_serinfo (l, args->arg, true);
+      break;
+
+    case RTLD_DI_ORIGIN:
+      strcpy (args->arg, l->l_origin);
+      break;
+    }
+}
+
+int
+dlinfo (void *handle, int request, void *arg)
+{
+  struct dlinfo_args args = { (ElfW(Addr)) RETURN_ADDRESS (0),
+			      handle, request, arg };
+  return _dlerror_run (&dlinfo_doit, &args) ? -1 : 0;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/dlfcn/tst-dlinfo.c libc-20030708/dlfcn/tst-dlinfo.c
--- glibc-2.3.2/dlfcn/tst-dlinfo.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/dlfcn/tst-dlinfo.c	2003-03-16 08:14:48.000000000 +0900
@@ -0,0 +1,96 @@
+/* Test for dlinfo.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <dlfcn.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <error.h>
+
+#define TEST_FUNCTION do_test ()
+
+static int
+do_test (void)
+{
+  int status = 0;
+
+  void *handle = dlopen ("glreflib1.so", RTLD_NOW);
+  if (handle == NULL)
+    error (EXIT_FAILURE, 0, "cannot load: glreflib1.so: %s", dlerror ());
+
+#define TRY(req, arg)							      \
+  if (dlinfo (handle, req, arg) != 0)					      \
+    {									      \
+      printf ("dlinfo failed for %s: %s\n", #req, dlerror ());		      \
+      status = 1;							      \
+    }									      \
+  else
+
+  struct link_map *l;
+  TRY (RTLD_DI_LINKMAP, &l)
+    {
+      if (l != handle)
+	{
+	  printf ("bogus link_map? %p != %p\n", l, handle);
+	  status = 1;
+	}
+    }
+
+  char origin[8192];		/* >= PATH_MAX, in theory */
+  TRY (RTLD_DI_ORIGIN, origin)
+    {
+      printf ("origin: %s\n", origin);
+    }
+
+  Dl_serinfo counts;
+  TRY (RTLD_DI_SERINFOSIZE, &counts)
+    {
+      Dl_serinfo *buf = alloca (counts.dls_size);
+      buf->dls_cnt = counts.dls_cnt;
+      buf->dls_size = counts.dls_size;
+      printf ("%u library directories\n", buf->dls_cnt);
+      TRY (RTLD_DI_SERINFO, buf)
+	{
+	  if (counts.dls_cnt != buf->dls_cnt)
+	    {
+	      printf ("??? became %u library directories\n", buf->dls_cnt);
+	      status = 1;
+	    }
+	  for (unsigned int i = 0; i < buf->dls_cnt; ++i)
+	    printf ("\t%#02x\t%s\n",
+		    buf->dls_serpath[i].dls_flags,
+		    buf->dls_serpath[i].dls_name);
+	}
+    }
+
+  unsigned long int lmid = 0xdeadbeefUL;
+  if (dlinfo (handle, RTLD_DI_LMID, &lmid) != 0)
+    printf ("dlinfo refuses RTLD_DI_LMID: %s\n", dlerror ());
+  else
+    {
+      printf ("dlinfo RTLD_DI_LMID worked? %#lx\n", lmid);
+      status = lmid == 0xdeadbeefUL;
+    }
+
+#undef TRY
+  dlclose (handle);
+
+  return status;
+}
+
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/Makefile libc-20030708/elf/Makefile
--- glibc-2.3.2/elf/Makefile	2003-02-21 15:28:09.000000000 +0900
+++ libc-20030708/elf/Makefile	2003-06-12 08:53:46.000000000 +0900
@@ -69,7 +69,9 @@
 		   unwind-dw2.c unwind-dw2-fde.c unwind.h unwind-pe.h \
 		   unwind-dw2-fde.h dwarf2.h dl-procinfo.c tls.h dl-tls.h \
 		   tst-tlsmod1.c tst-tlsmod2.c tst-tlsmod3.c tst-tlsmod4.c \
-		   tst-tlsmod5.c tst-tlsmod6.c \
+		   tst-tlsmod5.c tst-tlsmod6.c tst-tlsmod7.c tst-tlsmod8.c \
+		   tst-tlsmod9.c tst-tlsmod10.c tst-tlsmod11.c \
+		   tst-tlsmod12.c tst-tls10.h \
 		   circlemod1.c circlemod1a.c circlemod2.c circlemod2a.c \
 		   circlemod3.c circlemod3a.c nodlopenmod2.c \
 		   tls-macros.h \
@@ -80,6 +82,9 @@
 		   tst-array2dep.c \
 		   check-textrel.c dl-sysdep.h
 
+CFLAGS-dl-runtime.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-dl-lookup.c = -fexceptions -fasynchronous-unwind-tables
+
 include ../Makeconfig
 
 ifeq ($(unwind-find-fde),yes)
@@ -142,7 +147,8 @@
 	 $(tests-nodlopen-$(have-z-nodlopen)) neededtest neededtest2 \
 	 neededtest3 neededtest4 unload2 lateglobal initfirst global \
 	 restest2 next dblload dblunload reldep5 reldep6 reldep7 reldep8 \
-	 circleload1 tst-tls3 tst-tls4 tst-tls5 tst-tls6 tst-tls7 tst-tls8
+	 circleload1 tst-tls3 tst-tls4 tst-tls5 tst-tls6 tst-tls7 tst-tls8 \
+	 tst-tls10 tst-tls11 tst-tls12 tst-tls13
 #	 reldep9
 test-srcs = tst-pathopt
 tests-vis-yes = vismain
@@ -163,7 +169,9 @@
 	        reldep6mod0 reldep6mod1 reldep6mod2 reldep6mod3 reldep6mod4 \
 		reldep7mod1 reldep7mod2 \
 		tst-tlsmod1 tst-tlsmod2 tst-tlsmod3 tst-tlsmod4 \
-		tst-tlsmod5 tst-tlsmod6 \
+		tst-tlsmod5 tst-tlsmod6 tst-tlsmod7 tst-tlsmod8 \
+		tst-tlsmod9 tst-tlsmod10 tst-tlsmod11 tst-tlsmod12 \
+		tst-tlsmod13 tst-tlsmod13a \
 		circlemod1 circlemod1a circlemod2 circlemod2a \
 		circlemod3 circlemod3a \
 		reldep8mod1 reldep8mod2 reldep8mod3 \
@@ -181,6 +189,9 @@
 
 include ../Rules
 
+check-abi: check-abi-ld
+update-abi: update-abi-ld
+
 ifeq (yes,$(build-shared))
 # Make sure these things are built in the `make lib' pass so they can be used
 # to run programs during the `make others' pass.
@@ -210,7 +221,8 @@
 	mv -f $@T $@
 
 $(objpfx)librtld.mk: $(objpfx)librtld.map Makefile
-	sed -n 's@^$(common-objpfx)\([^(]*\)(\([^)]*\.os\))$$@\1 \2@p' $< | \
+	sed -n 's@^$(common-objpfx)\([^(]*\)(\([^)]*\.os\)) *.*$$@\1 \2@p' \
+	    $< | \
 	while read lib file; do \
 	  case $$lib in \
 	  libc_pic.a) \
@@ -372,6 +384,10 @@
 $(objpfx)reldep6mod3.so: $(objpfx)reldep6mod2.so
 $(objpfx)reldep6mod4.so: $(objpfx)reldep6mod1.so
 $(objpfx)tst-tlsmod3.so: $(objpfx)tst-tlsmod2.so
+$(objpfx)tst-tlsmod8.so: $(objpfx)tst-tlsmod7.so
+$(objpfx)tst-tlsmod10.so: $(objpfx)tst-tlsmod9.so
+$(objpfx)tst-tlsmod12.so: $(objpfx)tst-tlsmod11.so
+$(objpfx)tst-tlsmod13a.so: $(objpfx)tst-tlsmod13.so
 # For tst-tls9-static, make sure the modules it dlopens have libc.so in DT_NEEDED
 $(objpfx)tst-tlsmod5.so: $(common-objpfx)libc.so
 $(objpfx)tst-tlsmod6.so: $(common-objpfx)libc.so
@@ -573,6 +589,15 @@
 $(objpfx)tst-tls9: $(libdl)
 $(objpfx)tst-tls9.out: $(objpfx)tst-tlsmod5.so $(objpfx)tst-tlsmod6.so
 
+$(objpfx)tst-tls10: $(objpfx)tst-tlsmod8.so
+
+$(objpfx)tst-tls11: $(objpfx)tst-tlsmod10.so
+
+$(objpfx)tst-tls12: $(objpfx)tst-tlsmod12.so
+
+$(objpfx)tst-tls13: $(libdl)
+$(objpfx)tst-tls13.out: $(objpfx)tst-tlsmod13a.so
+
 ifdef libdl
 $(objpfx)tst-tls9-static: $(common-objpfx)dlfcn/libdl.a
 $(objpfx)tst-tls9-static.out: $(objpfx)tst-tlsmod5.so $(objpfx)tst-tlsmod6.so
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/Versions libc-20030708/elf/Versions
--- glibc-2.3.2/elf/Versions	2002-12-05 03:22:02.000000000 +0900
+++ libc-20030708/elf/Versions	2003-07-08 22:58:05.000000000 +0900
@@ -21,6 +21,7 @@
     # functions used in other libraries
     _dl_open; _dl_close; _dl_addr;
     _dl_sym; _dl_vsym;
+    _dl_open_hook;
   }
 }
 
@@ -51,6 +52,6 @@
     _dl_unload_cache;
     _rtld_global; _dl_tls_symaddr; _dl_allocate_tls; _dl_deallocate_tls;
     _dl_get_tls_static_info; _dl_allocate_tls_init;
-    _dl_get_origin; _dl_tls_setup;
+    _dl_get_origin; _dl_tls_setup; _dl_rtld_di_serinfo;
   }
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/cache.c libc-20030708/elf/cache.c
--- glibc-2.3.2/elf/cache.c	2002-12-30 04:14:59.000000000 +0900
+++ libc-20030708/elf/cache.c	2003-03-16 10:03:52.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2001, 2002, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 1999.
 
@@ -86,6 +87,11 @@
     case FLAG_POWERPC_LIB64:
       fputs(",64bit", stdout);
       break;
+    case FLAG_MIPS64_LIBN32:
+      fputs(",N32", stdout);
+      break;
+    case FLAG_MIPS64_LIBN64:
+      fputs(",64bit", stdout);
     case 0:
       break;
     default:
@@ -458,7 +464,7 @@
 {
   struct cache_entry *new_entry, *ptr, *prev;
   char *full_path;
-  int len, i;
+  size_t len, i;
 
   new_entry = (struct cache_entry *) xmalloc (sizeof (struct cache_entry));
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-addr.c libc-20030708/elf/dl-addr.c
--- glibc-2.3.2/elf/dl-addr.c	2002-09-28 12:35:22.000000000 +0900
+++ libc-20030708/elf/dl-addr.c	2003-03-10 18:12:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* Locate the shared object symbol nearest a given address.
-   Copyright (C) 1996-2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -24,7 +24,8 @@
 
 int
 internal_function
-_dl_addr (const void *address, Dl_info *info)
+_dl_addr (const void *address, Dl_info *info,
+	  struct link_map **mapp, const ElfW(Sym) **symbolp)
 {
   const ElfW(Addr) addr = DL_LOOKUP_ADDRESS (address);
   struct link_map *l, *match;
@@ -93,6 +94,11 @@
 	    || ELFW(ST_BIND) (symtab->st_info) == STB_WEAK))
       matchsym = (ElfW(Sym) *) symtab;
 
+  if (mapp)
+    *mapp = match;
+  if (symbolp)
+    *symbolp = matchsym;
+
   if (matchsym)
     {
       /* We found a symbol close by.  Fill in its name and exact address.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-close.c libc-20030708/elf/dl-close.c
--- glibc-2.3.2/elf/dl-close.c	2003-01-28 05:44:03.000000000 +0900
+++ libc-20030708/elf/dl-close.c	2003-04-28 23:53:20.000000000 +0900
@@ -80,7 +80,7 @@
 	return true;
     }
 
-  while (idx - disp > disp == 0 ? 1 + GL(dl_tls_static_nelem) : 0)
+  while (idx - disp > (disp == 0 ? 1 + GL(dl_tls_static_nelem) : 0))
     {
       --idx;
 
@@ -321,8 +321,9 @@
   _dl_debug_state ();
 
 #ifdef USE_TLS
-  size_t tls_free_start, tls_free_end;
-  tls_free_start = tls_free_end = GL(dl_tls_static_used);
+  size_t tls_free_start;
+  size_t tls_free_end;
+  tls_free_start = tls_free_end = NO_TLS_OFFSET;
 #endif
 
   /* Check each element of the search list to see if all references to
@@ -365,15 +366,56 @@
 		/* All dynamically loaded modules with TLS are unloaded.  */
 		GL(dl_tls_max_dtv_idx) = GL(dl_tls_static_nelem);
 
-	      if (imap->l_tls_offset != 0)
+	      if (imap->l_tls_offset != NO_TLS_OFFSET)
 		{
 		  /* Collect a contiguous chunk built from the objects in
 		     this search list, going in either direction.  When the
 		     whole chunk is at the end of the used area then we can
 		     reclaim it.  */
-		  if (imap->l_tls_offset == tls_free_end)
+# if TLS_TCB_AT_TP
+		  if (tls_free_start == NO_TLS_OFFSET
+		      || (size_t) imap->l_tls_offset == tls_free_start)
+		    {
+		      /* Extend the contiguous chunk being reclaimed.  */
+		      tls_free_start
+			= imap->l_tls_offset - imap->l_tls_blocksize;
+
+		      if (tls_free_end == NO_TLS_OFFSET)
+			tls_free_end = imap->l_tls_offset;
+		    }
+		  else if (imap->l_tls_offset - imap->l_tls_blocksize
+			   == tls_free_end)
+		    /* Extend the chunk backwards.  */
+		    tls_free_end = imap->l_tls_offset;
+		  else
+		    {
+		      /* This isn't contiguous with the last chunk freed.
+			 One of them will be leaked unless we can free
+			 one block right away.  */
+		      if (tls_free_end == GL(dl_tls_static_used))
+			{
+			  GL(dl_tls_static_used) = tls_free_start;
+			  tls_free_end = imap->l_tls_offset;
+			  tls_free_start
+			    = tls_free_end - imap->l_tls_blocksize;
+			}
+		      else if ((size_t) imap->l_tls_offset
+			       == GL(dl_tls_static_used))
+			GL(dl_tls_static_used)
+			  = imap->l_tls_offset - imap->l_tls_blocksize;
+		      else if (tls_free_end < (size_t) imap->l_tls_offset)
+			{
+			  /* We pick the later block.  It has a chance to
+			     be freed.  */
+			  tls_free_end = imap->l_tls_offset;
+			  tls_free_start
+			    = tls_free_end - imap->l_tls_blocksize;
+			}
+		    }
+# elif TLS_DTV_AT_TP
+		  if ((size_t) imap->l_tls_offset == tls_free_end)
 		    /* Extend the contiguous chunk being reclaimed.  */
-		    tls_free_end += imap->l_tls_blocksize;
+		    tls_free_end -= imap->l_tls_blocksize;
 		  else if (imap->l_tls_offset + imap->l_tls_blocksize
 			   == tls_free_start)
 		    /* Extend the chunk backwards.  */
@@ -387,6 +429,9 @@
 		      tls_free_start = imap->l_tls_offset;
 		      tls_free_end = tls_free_start + imap->l_tls_blocksize;
 		    }
+# else
+#  error "Either TLS_TCB_AT_TP or TLS_DTV_AT_TP must be defined"
+# endif
 		}
 	    }
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-conflict.c libc-20030708/elf/dl-conflict.c
--- glibc-2.3.2/elf/dl-conflict.c	2002-10-18 02:05:51.000000000 +0900
+++ libc-20030708/elf/dl-conflict.c	2003-04-15 23:55:45.000000000 +0900
@@ -1,5 +1,5 @@
 /* Resolve conflicts against already prelinked libraries.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jakub@redhat.com>, 2001.
 
@@ -28,11 +28,11 @@
 #include <sys/types.h>
 #include "dynamic-link.h"
 
-
 void
 _dl_resolve_conflicts (struct link_map *l, ElfW(Rela) *conflict,
 		       ElfW(Rela) *conflictend)
 {
+#if ! ELF_MACHINE_NO_RELA
   if (__builtin_expect (GL(dl_debug_mask) & DL_DEBUG_RELOC, 0))
     _dl_printf ("\nconflict processing: %s\n",
 		l->l_name[0] ? l->l_name : rtld_progname);
@@ -64,4 +64,5 @@
     for (; conflict < conflictend; ++conflict)
       elf_machine_rela (l, conflict, NULL, NULL, (void *) conflict->r_offset);
   }
+#endif
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-iteratephdr.c libc-20030708/elf/dl-iteratephdr.c
--- glibc-2.3.2/elf/dl-iteratephdr.c	2002-12-06 15:42:30.000000000 +0900
+++ libc-20030708/elf/dl-iteratephdr.c	2003-07-08 22:58:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Get loaded objects program headers.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jakub@redhat.com>, 2001.
 
@@ -36,9 +36,6 @@
 
   for (l = GL(dl_loaded); l != NULL; l = l->l_next)
     {
-      /* Skip the dynamic linker.  */
-      if (l->l_phdr == NULL)
-	continue;
       info.dlpi_addr = l->l_addr;
       info.dlpi_name = l->l_name;
       info.dlpi_phdr = l->l_phdr;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-libc.c libc-20030708/elf/dl-libc.c
--- glibc-2.3.2/elf/dl-libc.c	2002-11-19 17:38:32.000000000 +0900
+++ libc-20030708/elf/dl-libc.c	2003-07-08 22:58:05.000000000 +0900
@@ -96,6 +96,50 @@
   _dl_close ((struct link_map *) ptr);
 }
 
+/* This code is to support __libc_dlopen from __libc_dlopen'ed shared
+   libraries.  We need to ensure the statically linked __libc_dlopen
+   etc. functions are used instead of the dynamically loaded.  */
+struct dl_open_hook
+{
+  void *(*dlopen_mode) (const char *name, int mode);
+  void *(*dlsym) (void *map, const char *name);
+  int (*dlclose) (void *map);
+};
+
+#ifdef SHARED
+extern struct dl_open_hook *_dl_open_hook;
+libc_hidden_proto (_dl_open_hook);
+struct dl_open_hook *_dl_open_hook __attribute__((nocommon));
+libc_hidden_data_def (_dl_open_hook);
+#else
+static void
+do_dlsym_private (void *ptr)
+{
+  lookup_t l;
+  struct r_found_version vers;
+  vers.name = "GLIBC_PRIVATE";
+  vers.hidden = 1;
+  /* vers.hash = _dl_elf_hash (version);  */
+  vers.hash = 0x0963cf85;
+  /* FIXME: Shouldn't we use libc.so.6* here?  */
+  vers.filename = NULL;
+
+  struct do_dlsym_args *args = (struct do_dlsym_args *) ptr;
+  args->ref = NULL;
+  l = _dl_lookup_versioned_symbol (args->name, args->map,
+				   &args->ref, args->map->l_scope,
+				   &vers, 0, 0);
+  args->loadbase = l;
+}
+
+static struct dl_open_hook _dl_open_hook =
+  {
+    .dlopen_mode = __libc_dlopen_mode,
+    .dlsym = __libc_dlsym,
+    .dlclose = __libc_dlclose
+  };
+#endif
+
 /* ... and these functions call dlerror_run. */
 
 void *
@@ -105,7 +149,29 @@
   args.name = name;
   args.mode = mode;
 
+#ifdef SHARED
+  if (__builtin_expect (_dl_open_hook != NULL, 0))
+    return _dl_open_hook->dlopen_mode (name, mode);
   return (dlerror_run (do_dlopen, &args) ? NULL : (void *) args.map);
+#else
+  if (dlerror_run (do_dlopen, &args))
+    return NULL;
+
+  struct do_dlsym_args sargs;
+  sargs.map = args.map;
+  sargs.name = "_dl_open_hook";
+
+  if (! dlerror_run (do_dlsym_private, &sargs))
+    {
+      struct dl_open_hook **hook
+	= (struct dl_open_hook **)
+	  (DL_SYMBOL_ADDRESS (sargs.loadbase, sargs.ref));
+      if (hook != NULL)
+	*hook = &_dl_open_hook;
+    }
+
+  return (void *) args.map;
+#endif
 }
 
 void *
@@ -115,6 +181,10 @@
   args.map = map;
   args.name = name;
 
+#ifdef SHARED
+  if (__builtin_expect (_dl_open_hook != NULL, 0))
+    return _dl_open_hook->dlsym (map, name);
+#endif
   return (dlerror_run (do_dlsym, &args) ? NULL
 	  : (void *) (DL_SYMBOL_ADDRESS (args.loadbase, args.ref)));
 }
@@ -122,6 +192,10 @@
 int
 __libc_dlclose (void *map)
 {
+#ifdef SHARED
+  if (__builtin_expect (_dl_open_hook != NULL, 0))
+    return _dl_open_hook->dlclose (map);
+#endif
   return dlerror_run (do_dlclose, map);
 }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-load.c libc-20030708/elf/dl-load.c
--- glibc-2.3.2/elf/dl-load.c	2003-01-17 03:14:41.000000000 +0900
+++ libc-20030708/elf/dl-load.c	2003-07-08 22:58:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Map in a shared object's segments from the file.
-   Copyright (C) 1995,96,97,98,99,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -26,6 +26,7 @@
 #include <string.h>
 #include <unistd.h>
 #include <ldsodefs.h>
+#include <bits/wordsize.h>
 #include <sys/mman.h>
 #include <sys/param.h>
 #include <sys/stat.h>
@@ -97,19 +98,26 @@
 /* Type for the buffer we put the ELF header and hopefully the program
    header.  This buffer does not really have to be too large.  In most
    cases the program header follows the ELF header directly.  If this
-   is not the case all bets are off and we can make the header arbitrarily
-   large and still won't get it read.  This means the only question is
-   how large are the ELF and program header combined.  The ELF header
-   in 64-bit files is 56 bytes long.  Each program header entry is again
-   56 bytes long.  I.e., even with a file which has 17 program header
-   entries we only have to read 1kB.  And 17 program header entries is
-   plenty, normal files have < 10.  If this heuristic should really fail
-   for some file the code in `_dl_map_object_from_fd' knows how to
-   recover.  */
+   is not the case all bets are off and we can make the header
+   arbitrarily large and still won't get it read.  This means the only
+   question is how large are the ELF and program header combined.  The
+   ELF header 32-bit files is 52 bytes long and in 64-bit files is 64
+   bytes long.  Each program header entry is again 32 and 56 bytes
+   long respectively.  I.e., even with a file which has 7 program
+   header entries we only have to read 512B.  Add to this a bit of
+   margin for program notes and reading 512B and 640B for 32-bit and
+   64-bit files respecitvely is enough.  If this heuristic should
+   really fail for some file the code in `_dl_map_object_from_fd'
+   knows how to recover.  */
 struct filebuf
 {
   ssize_t len;
-  char buf[1024] __attribute__ ((aligned (__alignof (ElfW(Ehdr)))));
+#if __WORDSIZE == 32
+# define FILEBUF_SIZE 512
+#else
+# define FILEBUF_SIZE 640
+#endif
+  char buf[FILEBUF_SIZE] __attribute__ ((aligned (__alignof (ElfW(Ehdr)))));
 };
 
 /* This is the decomposed LD_LIBRARY_PATH search path.  */
@@ -353,7 +361,7 @@
 
 static size_t max_dirnamelen;
 
-static inline struct r_search_path_elem **
+static struct r_search_path_elem **
 fillin_rpath (char *rpath, struct r_search_path_elem **result, const char *sep,
 	      int check_trusted, const char *what, const char *where)
 {
@@ -568,6 +576,34 @@
   sps->malloced = 1;
 }
 
+/* Make sure cached path information is stored in *SP
+   and return true if there are any paths to search there.  */
+static bool
+cache_rpath (struct link_map *l,
+	     struct r_search_path_struct *sp,
+	     int tag,
+	     const char *what)
+{
+  if (sp->dirs == (void *) -1)
+    return false;
+
+  if (sp->dirs != NULL)
+    return true;
+
+  if (l->l_info[tag] == NULL)
+    {
+      /* There is no path.  */
+      sp->dirs = (void *) -1;
+      return false;
+    }
+
+  /* Make sure the cache information is available.  */
+  decompose_rpath (sp, (const char *) (D_PTR (l, l_info[DT_STRTAB])
+				       + l->l_info[tag]->d_un.d_val),
+		   l, what);
+  return true;
+}
+
 
 void
 internal_function
@@ -877,6 +913,7 @@
 	int prot;
       } loadcmds[l->l_phnum], *c;
     size_t nloadcmds = 0;
+    bool has_holes = false;
 
     /* The struct is initialized to zero so this is not necessary:
     l->l_ld = 0;
@@ -922,6 +959,11 @@
 	  c->allocend = ph->p_vaddr + ph->p_memsz;
 	  c->mapoff = ph->p_offset & ~(ph->p_align - 1);
 
+	  /* Determine whether there is a gap between the last segment
+	     and this one.  */
+	  if (nloadcmds > 1 && c[-1].mapend != c->mapstart)
+	    has_holes = true;
+
 	  /* Optimize a common case.  */
 #if (PF_R | PF_W | PF_X) == 7 && (PROT_READ | PROT_WRITE | PROT_EXEC) == 7
 	  c->prot = (PF_TO_PROT
@@ -1014,6 +1056,15 @@
 	  break;
 	}
 
+    if (__builtin_expect (nloadcmds == 0, 0))
+      {
+	/* This only happens for a bogus object that will be caught with
+	   another error below.  But we don't want to go through the
+	   calculations below using NLOADCMDS - 1.  */
+	errstring = N_("object file has no loadable segments");
+	goto call_lose;
+      }
+
     /* Now process the load commands and map segments into memory.  */
     c = loadcmds;
 
@@ -1051,14 +1102,15 @@
 	l->l_map_end = l->l_map_start + maplength;
 	l->l_addr = l->l_map_start - c->mapstart;
 
-	/* Change protection on the excess portion to disallow all access;
-	   the portions we do not remap later will be inaccessible as if
-	   unallocated.  Then jump into the normal segment-mapping loop to
-	   handle the portion of the segment past the end of the file
-	   mapping.  */
-	__mprotect ((caddr_t) (l->l_addr + c->mapend),
-		    loadcmds[nloadcmds - 1].allocend - c->mapend,
-		    PROT_NONE);
+	if (has_holes)
+	  /* Change protection on the excess portion to disallow all access;
+	     the portions we do not remap later will be inaccessible as if
+	     unallocated.  Then jump into the normal segment-mapping loop to
+	     handle the portion of the segment past the end of the file
+	     mapping.  */
+	  __mprotect ((caddr_t) (l->l_addr + c->mapend),
+		      loadcmds[nloadcmds - 1].allocend - c->mapend,
+		      PROT_NONE);
 
 	goto postmap;
       }
@@ -1118,23 +1170,18 @@
 	    if (zeropage > zero)
 	      {
 		/* Zero the final part of the last page of the segment.  */
-		if ((c->prot & PROT_WRITE) == 0)
+		if (__builtin_expect ((c->prot & PROT_WRITE) == 0, 0))
 		  {
 		    /* Dag nab it.  */
-		    if (__builtin_expect (__mprotect ((caddr_t)
-						      (zero
-						       & ~(GL(dl_pagesize)
-							   - 1)),
-						      GL(dl_pagesize),
-						      c->prot|PROT_WRITE) < 0,
-					  0))
+		    if (__mprotect ((caddr_t) (zero & ~(GL(dl_pagesize) - 1)),
+				    GL(dl_pagesize), c->prot|PROT_WRITE) < 0)
 		      {
 			errstring = N_("cannot change memory protections");
 			goto call_lose_errno;
 		      }
 		  }
 		memset ((void *) zero, '\0', zeropage - zero);
-		if ((c->prot & PROT_WRITE) == 0)
+		if (__builtin_expect ((c->prot & PROT_WRITE) == 0, 0))
 		  __mprotect ((caddr_t) (zero & ~(GL(dl_pagesize) - 1)),
 			      GL(dl_pagesize), c->prot);
 	      }
@@ -1221,7 +1268,7 @@
 			   (unsigned long int) l->l_phdr,
 			   (int) sizeof (void *) * 2, l->l_phnum);
 
-  elf_get_dynamic_info (l);
+  elf_get_dynamic_info (l, NULL);
 
   /* Make sure we are not dlopen'ing an object
      that has the DF_1_NOOPEN flag set.  */
@@ -1728,29 +1775,9 @@
 	  /* First try the DT_RPATH of the dependent object that caused NAME
 	     to be loaded.  Then that object's dependent, and on up.  */
 	  for (l = loader; fd == -1 && l; l = l->l_loader)
-	    {
-	      if (l->l_rpath_dirs.dirs == NULL)
-		{
-		  if (l->l_info[DT_RPATH] == NULL)
-		    {
-		      /* There is no path.  */
-		      l->l_rpath_dirs.dirs = (void *) -1;
-		      continue;
-		    }
-		  else
-		    {
-		      /* Make sure the cache information is available.  */
-		      size_t ptrval = (D_PTR (l, l_info[DT_STRTAB])
-				       + l->l_info[DT_RPATH]->d_un.d_val);
-		      decompose_rpath (&l->l_rpath_dirs,
-				       (const char *) ptrval, l, "RPATH");
-		    }
-		}
-
-	      if (l->l_rpath_dirs.dirs != (void *) -1)
-		fd = open_path (name, namelen, preloaded, &l->l_rpath_dirs,
-				&realname, &fb);
-	    }
+	    if (cache_rpath (l, &l->l_rpath_dirs, DT_RPATH, "RPATH"))
+	      fd = open_path (name, namelen, preloaded, &l->l_rpath_dirs,
+			      &realname, &fb);
 
 	  /* If dynamically linked, try the DT_RPATH of the executable
              itself.  */
@@ -1766,37 +1793,12 @@
 	fd = open_path (name, namelen, preloaded, &env_path_list,
 			&realname, &fb);
 
-      /* Look at the RUNPATH information for this binary.
-
-	 Note that this is no real loop.  'while' is used only to enable
-	 us to use 'break' instead of a 'goto' to jump to the end.  The
-	 loop is always left after the first round.  */
-      while (fd == -1 && loader != NULL
-	     && loader->l_runpath_dirs.dirs != (void *) -1)
-	{
-	  if (loader->l_runpath_dirs.dirs == NULL)
-	    {
-	      if (loader->l_info[DT_RUNPATH] == NULL)
-		{
-		  /* No RUNPATH.  */
-		  loader->l_runpath_dirs.dirs = (void *) -1;
-		  break;
-		}
-	      else
-		{
-		  /* Make sure the cache information is available.  */
-		  size_t ptrval = (D_PTR (loader, l_info[DT_STRTAB])
-				   + loader->l_info[DT_RUNPATH]->d_un.d_val);
-		  decompose_rpath (&loader->l_runpath_dirs,
-				   (const char *) ptrval, loader, "RUNPATH");
-		}
-	    }
-
-	  if (loader->l_runpath_dirs.dirs != (void *) -1)
-	    fd = open_path (name, namelen, preloaded,
-			    &loader->l_runpath_dirs, &realname, &fb);
-	  break;
-	}
+      /* Look at the RUNPATH information for this binary.  */
+      if (fd == -1 && loader != NULL
+	  && cache_rpath (loader, &loader->l_runpath_dirs,
+			  DT_RUNPATH, "RUNPATH"))
+	fd = open_path (name, namelen, preloaded,
+			&loader->l_runpath_dirs, &realname, &fb);
 
       if (fd == -1
 	  && (__builtin_expect (! preloaded, 1)
@@ -1920,3 +1922,86 @@
   return _dl_map_object_from_fd (name, fd, &fb, realname, loader, type, mode);
 }
 INTDEF (_dl_map_object)
+
+void
+internal_function
+_dl_rtld_di_serinfo (struct link_map *loader, Dl_serinfo *si, bool counting)
+{
+  if (counting)
+    {
+      si->dls_cnt = 0;
+      si->dls_size = 0;
+    }
+
+  unsigned int idx = 0;
+  char *allocptr = (char *) &si->dls_serpath[si->dls_cnt];
+  void add_path (const struct r_search_path_struct *sps, unsigned int flags)
+# define add_path(sps, flags) add_path(sps, 0) /* XXX */
+    {
+      if (sps->dirs != (void *) -1)
+	{
+	  struct r_search_path_elem **dirs = sps->dirs;
+	  do
+	    {
+	      const struct r_search_path_elem *const r = *dirs++;
+	      if (counting)
+		{
+		  si->dls_cnt++;
+		  si->dls_size += r->dirnamelen;
+		}
+	      else
+		{
+		  Dl_serpath *const sp = &si->dls_serpath[idx++];
+		  sp->dls_name = allocptr;
+		  allocptr = __mempcpy (allocptr,
+					r->dirname, r->dirnamelen - 1);
+		  *allocptr++ = '\0';
+		  sp->dls_flags = flags;
+		}
+	    }
+	  while (*dirs != NULL);
+	}
+    }
+
+  /* When the object has the RUNPATH information we don't use any RPATHs.  */
+  if (loader->l_info[DT_RUNPATH] == NULL)
+    {
+      /* First try the DT_RPATH of the dependent object that caused NAME
+	 to be loaded.  Then that object's dependent, and on up.  */
+
+      struct link_map *l = loader;
+      do
+	{
+	  if (cache_rpath (l, &l->l_rpath_dirs, DT_RPATH, "RPATH"))
+	    add_path (&l->l_rpath_dirs, XXX_RPATH);
+	  l = l->l_loader;
+	}
+      while (l != NULL);
+
+      /* If dynamically linked, try the DT_RPATH of the executable itself.  */
+      l = GL(dl_loaded);
+      if (l != NULL && l->l_type != lt_loaded && l != loader)
+	if (cache_rpath (l, &l->l_rpath_dirs, DT_RPATH, "RPATH"))
+	  add_path (&l->l_rpath_dirs, XXX_RPATH);
+    }
+
+  /* Try the LD_LIBRARY_PATH environment variable.  */
+  add_path (&env_path_list, XXX_ENV);
+
+  /* Look at the RUNPATH information for this binary.  */
+  if (cache_rpath (loader, &loader->l_runpath_dirs, DT_RUNPATH, "RUNPATH"))
+    add_path (&loader->l_runpath_dirs, XXX_RUNPATH);
+
+  /* XXX
+     Here is where ld.so.cache gets checked, but we don't have
+     a way to indicate that in the results for Dl_serinfo.  */
+
+  /* Finally, try the default path.  */
+  if (!(loader->l_flags_1 & DF_1_NODEFLIB))
+    add_path (&rtld_search_dirs, XXX_default);
+
+  if (counting)
+    /* Count the struct size before the string area, which we didn't
+       know before we completed dls_cnt.  */
+    si->dls_size += (char *) &si->dls_serpath[si->dls_cnt] - (char *) si;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-lookup.c libc-20030708/elf/dl-lookup.c
--- glibc-2.3.2/elf/dl-lookup.c	2003-01-11 18:51:49.000000000 +0900
+++ libc-20030708/elf/dl-lookup.c	2003-03-28 21:28:15.000000000 +0900
@@ -273,17 +273,30 @@
     {
       /* It is very tricky.  We need to figure out what value to
          return for the protected symbol.  */
-      struct sym_val protected_value = { NULL, NULL };
-
-      for (scope = symbol_scope; *scope; ++scope)
-	if (_dl_do_lookup (undef_name, hash, *ref, &protected_value, *scope,
-			   0, flags, NULL, ELF_RTYPE_CLASS_PLT))
-	  break;
-
-      if (protected_value.s != NULL && protected_value.m != undef_map)
+      if (type_class == ELF_RTYPE_CLASS_PLT)
 	{
-	  current_value.s = *ref;
-	  current_value.m = undef_map;
+	  if (current_value.s != NULL && current_value.m != undef_map)
+	    {
+	      current_value.s = *ref;
+	      current_value.m = undef_map;
+	    }
+	}
+      else
+	{
+	  struct sym_val protected_value = { NULL, NULL };
+
+	  for (scope = symbol_scope; *scope; ++scope)
+	    if (_dl_do_lookup (undef_name, hash, *ref,
+			       &protected_value, *scope, 0, flags,
+			       NULL, ELF_RTYPE_CLASS_PLT))
+	      break;
+
+	  if (protected_value.s != NULL
+	      && protected_value.m != undef_map)
+	    {
+	      current_value.s = *ref;
+	      current_value.m = undef_map;
+	    }
 	}
     }
 
@@ -465,18 +478,31 @@
     {
       /* It is very tricky.  We need to figure out what value to
          return for the protected symbol.  */
-      struct sym_val protected_value = { NULL, NULL };
-
-      for (scope = symbol_scope; *scope; ++scope)
-	if (_dl_do_lookup_versioned (undef_name, hash, *ref, &protected_value,
-				     *scope, 0, version, NULL,
-				     ELF_RTYPE_CLASS_PLT))
-	  break;
-
-      if (protected_value.s != NULL && protected_value.m != undef_map)
+      if (type_class == ELF_RTYPE_CLASS_PLT)
 	{
-	  current_value.s = *ref;
-	  current_value.m = undef_map;
+	  if (current_value.s != NULL && current_value.m != undef_map)
+	    {
+	      current_value.s = *ref;
+	      current_value.m = undef_map;
+	    }
+	}
+      else
+	{
+	  struct sym_val protected_value = { NULL, NULL };
+
+	  for (scope = symbol_scope; *scope; ++scope)
+	    if (_dl_do_lookup_versioned (undef_name, hash, *ref,
+					 &protected_value,
+					 *scope, 0, version, NULL,
+					 ELF_RTYPE_CLASS_PLT))
+	      break;
+
+	  if (protected_value.s != NULL
+	      && protected_value.m != undef_map)
+	    {
+	      current_value.s = *ref;
+	      current_value.m = undef_map;
+	    }
 	}
     }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-object.c libc-20030708/elf/dl-object.c
--- glibc-2.3.2/elf/dl-object.c	2003-01-10 17:23:58.000000000 +0900
+++ libc-20030708/elf/dl-object.c	2003-04-28 23:53:20.000000000 +0900
@@ -53,6 +53,10 @@
   new->l_name = realname;
   new->l_type = type;
   new->l_loader = loader;
+#if defined USE_TLS && NO_TLS_OFFSET != 0
+  new->l_tls_offset = NO_TLS_OFFSET;
+#endif
+
   /* new->l_global = 0;	We use calloc therefore not necessary.  */
 
   /* Use the 'l_scope_mem' array by default for the the 'l_scope'
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-profile.c libc-20030708/elf/dl-profile.c
--- glibc-2.3.2/elf/dl-profile.c	2002-08-03 06:46:57.000000000 +0900
+++ libc-20030708/elf/dl-profile.c	2003-03-20 16:07:22.000000000 +0900
@@ -1,5 +1,5 @@
 /* Profiling of shared libraries.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
    Based on the BSD mcount implementation.
@@ -34,7 +34,7 @@
 #include <sys/mman.h>
 #include <sys/param.h>
 #include <sys/stat.h>
-#include <atomicity.h>
+#include <atomic.h>
 
 /* The LD_PROFILE feature has to be implemented different to the
    normal profiling using the gmon/ functions.  The problem is that an
@@ -516,24 +516,24 @@
 	      size_t newfromidx;
 	      to_index = (data[narcs].self_pc
 			  / (hashfraction * sizeof (*tos)));
-	      newfromidx = exchange_and_add (&fromidx, 1) + 1;
+	      newfromidx = atomic_exchange_and_add (&fromidx, 1) + 1;
 	      froms[newfromidx].here = &data[narcs];
 	      froms[newfromidx].link = tos[to_index];
 	      tos[to_index] = newfromidx;
-	      atomic_add (&narcs, 1);
+	      atomic_increment (&narcs);
 	    }
 
 	  /* If we still have no entry stop searching and insert.  */
 	  if (*topcindex == 0)
 	    {
-	      uint_fast32_t newarc = exchange_and_add (narcsp, 1);
+	      uint_fast32_t newarc = atomic_exchange_and_add (narcsp, 1);
 
 	      /* In rare cases it could happen that all entries in FROMS are
 		 occupied.  So we cannot count this anymore.  */
 	      if (newarc >= fromlimit)
 		goto done;
 
-	      *topcindex = exchange_and_add (&fromidx, 1) + 1;
+	      *topcindex = atomic_exchange_and_add (&fromidx, 1) + 1;
 	      fromp = &froms[*topcindex];
 
 	      fromp->here = &data[newarc];
@@ -541,7 +541,7 @@
 	      data[newarc].self_pc = selfpc;
 	      data[newarc].count = 0;
 	      fromp->link = 0;
-	      atomic_add (&narcs, 1);
+	      atomic_increment (&narcs);
 
 	      break;
 	    }
@@ -554,7 +554,7 @@
     }
 
   /* Increment the counter.  */
-  atomic_add (&fromp->here->count, 1);
+  atomic_increment (&fromp->here->count);
 
  done:
   ;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-reloc.c libc-20030708/elf/dl-reloc.c
--- glibc-2.3.2/elf/dl-reloc.c	2003-01-31 02:35:50.000000000 +0900
+++ libc-20030708/elf/dl-reloc.c	2003-04-28 23:53:20.000000000 +0900
@@ -41,26 +41,37 @@
    the static TLS area already allocated for each running thread.  If this
    object's TLS segment is too big to fit, we fail.  If it fits,
    we set MAP->l_tls_offset and return.  */
-static void __attribute_noinline__
-allocate_static_tls (struct link_map *map)
+void
+internal_function __attribute_noinline__
+_dl_allocate_static_tls (struct link_map *map)
 {
-  size_t offset = roundup (GL(dl_tls_static_used), map->l_tls_align);
-  if (offset + map->l_tls_blocksize
+  size_t offset;
+  size_t used;
+  size_t check;
+
 # if TLS_TCB_AT_TP
-      + TLS_TCB_SIZE
+  offset = roundup (GL(dl_tls_static_used) + map->l_tls_blocksize,
+		    map->l_tls_align);
+  used = offset;
+  check = offset + TLS_TCB_SIZE;
 # elif TLS_DTV_AT_TP
+  offset = roundup (GL(dl_tls_static_used), map->l_tls_align);
+  used = offset + map->l_tls_blocksize;
+  check = used;
   /* dl_tls_static_used includes the TCB at the beginning.  */
 # else
 #  error "Either TLS_TCB_AT_TP or TLS_DTV_AT_TP must be defined"
 # endif
-      > GL(dl_tls_static_size))
+
+  if (check > GL(dl_tls_static_size))
     {
       const char *errstring = N_("\
 shared object cannot be dlopen()ed: static TLS memory too small");
       INTUSE(_dl_signal_error) (0, (map)->l_name, NULL, errstring);
     }
+
   map->l_tls_offset = offset;
-  GL(dl_tls_static_used) = offset + map->l_tls_blocksize;
+  GL(dl_tls_static_used) = used;
 }
 #endif
 
@@ -200,8 +211,8 @@
        intended to produce.  */
 #define CHECK_STATIC_TLS(map, sym_map)					      \
     do {								      \
-      if (__builtin_expect ((sym_map)->l_tls_offset == 0, 0))		      \
-	allocate_static_tls (sym_map);					      \
+      if (__builtin_expect ((sym_map)->l_tls_offset == NO_TLS_OFFSET, 0))     \
+	_dl_allocate_static_tls (sym_map);				      \
     } while (0)
 
 #include "dynamic-link.h"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-support.c libc-20030708/elf/dl-support.c
--- glibc-2.3.2/elf/dl-support.c	2003-01-31 02:31:18.000000000 +0900
+++ libc-20030708/elf/dl-support.c	2003-07-08 22:58:06.000000000 +0900
@@ -127,6 +127,8 @@
 #ifdef NEED_DL_SYSINFO
 /* Needed for improved syscall handling on at least x86/Linux.  */
 uintptr_t _dl_sysinfo = DL_SYSINFO_DEFAULT;
+/* Address of the ELF headers in the vsyscall page.  */
+const ElfW(Ehdr) *_dl_sysinfo_dso;
 #endif
 
 /* During the program run we must not modify the global data of
@@ -146,6 +148,10 @@
 internal_function
 _dl_aux_init (ElfW(auxv_t) *av)
 {
+  int seen = 0;
+  uid_t uid = 0;
+  gid_t gid = 0;
+
   for (; av->a_type != AT_NULL; ++av)
     switch (av->a_type)
       {
@@ -166,7 +172,33 @@
 	GL(dl_sysinfo) = av->a_un.a_val;
 	break;
 #endif
+      case AT_UID:
+	uid ^= av->a_un.a_val;
+	seen |= 1;
+	break;
+      case AT_EUID:
+	uid ^= av->a_un.a_val;
+	seen |= 2;
+	break;
+      case AT_GID:
+	gid ^= av->a_un.a_val;
+	seen |= 4;
+	break;
+      case AT_EGID:
+	gid ^= av->a_un.a_val;
+	seen |= 8;
+	break;
+      case AT_SECURE:
+	seen = -1;
+	__libc_enable_secure = av->a_un.a_val;
+	__libc_enable_secure_decided = 1;
+	break;
       }
+  if (seen == 0xf)
+    {
+      __libc_enable_secure = uid != 0 || gid != 0;
+      __libc_enable_secure_decided = 1;
+    }
 }
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dl-version.c libc-20030708/elf/dl-version.c
--- glibc-2.3.2/elf/dl-version.c	2002-03-11 17:31:59.000000000 +0900
+++ libc-20030708/elf/dl-version.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Handle symbol and library versioning.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -53,6 +53,7 @@
 
 
 static inline struct link_map *
+__attribute ((always_inline))
 find_needed (const char *name, struct link_map *map)
 {
   struct link_map *tmap;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/do-lookup.h libc-20030708/elf/do-lookup.h
--- glibc-2.3.2/elf/do-lookup.h	2002-04-13 16:32:17.000000000 +0900
+++ libc-20030708/elf/do-lookup.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Look up a symbol in the loaded objects.
-   Copyright (C) 1995,96,97,98,99,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -28,7 +28,7 @@
 /* Inner part of the lookup functions.  We return a value > 0 if we
    found the symbol, the value 0 if nothing is found and < 0 if
    something bad happened.  */
-static inline int
+static int
 FCT (const char *undef_name, unsigned long int hash, const ElfW(Sym) *ref,
      struct sym_val *result, struct r_scope_elem *scope, size_t i, ARG,
      struct link_map *skip, int type_class)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/dynamic-link.h libc-20030708/elf/dynamic-link.h
--- glibc-2.3.2/elf/dynamic-link.h	2003-01-31 02:35:50.000000000 +0900
+++ libc-20030708/elf/dynamic-link.h	2003-05-21 23:20:31.000000000 +0900
@@ -56,7 +56,7 @@
 /* Read the dynamic section at DYN and fill in INFO with indices DT_*.  */
 
 static inline void __attribute__ ((unused, always_inline))
-elf_get_dynamic_info (struct link_map *l)
+elf_get_dynamic_info (struct link_map *l, ElfW(Dyn) *temp)
 {
   ElfW(Dyn) *dyn = l->l_ld;
   ElfW(Dyn) **info;
@@ -88,32 +88,45 @@
 	     + DT_VERSIONTAGNUM + DT_EXTRANUM + DT_VALNUM] = dyn;
       ++dyn;
     }
+
+#define DL_RO_DYN_TEMP_CNT	8
+
 #ifndef DL_RO_DYN_SECTION
   /* Don't adjust .dynamic unnecessarily.  */
   if (l->l_addr != 0)
     {
       ElfW(Addr) l_addr = l->l_addr;
+      int cnt = 0;
+
+# define ADJUST_DYN_INFO(tag) \
+      do								      \
+	if (info[tag] != NULL)						      \
+	  {								      \
+	    if (temp)							      \
+	      {								      \
+		temp[cnt].d_tag = info[tag]->d_tag;			      \
+		temp[cnt].d_un.d_ptr = info[tag]->d_un.d_ptr + l_addr;	      \
+		info[tag] = temp + cnt++;				      \
+	      }								      \
+	    else							      \
+	      info[tag]->d_un.d_ptr += l_addr;				      \
+	  }								      \
+      while (0)
 
-      if (info[DT_HASH] != NULL)
-	info[DT_HASH]->d_un.d_ptr += l_addr;
-      if (info[DT_PLTGOT] != NULL)
-	info[DT_PLTGOT]->d_un.d_ptr += l_addr;
-      if (info[DT_STRTAB] != NULL)
-	info[DT_STRTAB]->d_un.d_ptr += l_addr;
-      if (info[DT_SYMTAB] != NULL)
-	info[DT_SYMTAB]->d_un.d_ptr += l_addr;
+      ADJUST_DYN_INFO (DT_HASH);
+      ADJUST_DYN_INFO (DT_PLTGOT);
+      ADJUST_DYN_INFO (DT_STRTAB);
+      ADJUST_DYN_INFO (DT_SYMTAB);
 # if ! ELF_MACHINE_NO_RELA
-      if (info[DT_RELA] != NULL)
-	info[DT_RELA]->d_un.d_ptr += l_addr;
+      ADJUST_DYN_INFO (DT_RELA);
 # endif
 # if ! ELF_MACHINE_NO_REL
-      if (info[DT_REL] != NULL)
-	info[DT_REL]->d_un.d_ptr += l_addr;
+      ADJUST_DYN_INFO (DT_REL);
 # endif
-      if (info[DT_JMPREL] != NULL)
-	info[DT_JMPREL]->d_un.d_ptr += l_addr;
-      if (info[VERSYMIDX (DT_VERSYM)] != NULL)
-	info[VERSYMIDX (DT_VERSYM)]->d_un.d_ptr += l_addr;
+      ADJUST_DYN_INFO (DT_JMPREL);
+      ADJUST_DYN_INFO (VERSYMIDX (DT_VERSYM));
+# undef ADJUST_DYN_INFO
+      assert (cnt <= DL_RO_DYN_TEMP_CNT);
     }
 #endif
   if (info[DT_PLTREL] != NULL)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/elf.h libc-20030708/elf/elf.h
--- glibc-2.3.2/elf/elf.h	2003-02-26 08:40:08.000000000 +0900
+++ libc-20030708/elf/elf.h	2003-07-08 22:58:06.000000000 +0900
@@ -1,5 +1,5 @@
 /* This file defines standard ELF types, structures, and macros.
-   Copyright (C) 1995-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -558,6 +558,7 @@
 #define	PT_NUM		8		/* Number of defined types */
 #define PT_LOOS		0x60000000	/* Start of OS-specific */
 #define PT_GNU_EH_FRAME	0x6474e550	/* GCC .eh_frame_hdr segment */
+#define PT_GNU_STACK	0x6474e551	/* Indicates stack executability */
 #define PT_LOSUNW	0x6ffffffa
 #define PT_SUNWBSS	0x6ffffffa	/* Sun Specific segment */
 #define PT_SUNWSTACK	0x6ffffffb	/* Stack segment */
@@ -944,11 +945,14 @@
 
 /* A special ignored value for PPC, used by the kernel to control the
    interpretation of the AUXV. Must be > 16.  */
-#define AT_IGNOREPPC	22		/* Entry should be ignored */
+#define AT_IGNOREPPC	22		/* Entry should be ignored.  */
+
+#define	AT_SECURE	23		/* Boolean, was exec setuid-like?  */
 
 /* Pointer to the global system page used for system calls and other
    nice things.  */
 #define AT_SYSINFO	32
+#define AT_SYSINFO_EHDR	33
 
 
 /* Note section contents.  Each entry in the note section begins with
@@ -1881,122 +1885,39 @@
 #define R_PPC_SECTOFF_LO	34
 #define R_PPC_SECTOFF_HI	35
 #define R_PPC_SECTOFF_HA	36
-/* Keep this the last entry.  */
-#define R_PPC_NUM		37
 
-/* PowerPC64 relocations defined by the ABIs */
-#define R_PPC64_NONE    R_PPC_NONE
-#define R_PPC64_ADDR32  R_PPC_ADDR32  /* 32bit absolute address.  */
-#define R_PPC64_ADDR24  R_PPC_ADDR24  /* 26bit address, word aligned.  */
-#define R_PPC64_ADDR16  R_PPC_ADDR16  /* 16bit absolute address. */
-#define R_PPC64_ADDR16_LO R_PPC_ADDR16_LO /* lower 16bits of abs. address.  */
-#define R_PPC64_ADDR16_HI R_PPC_ADDR16_HI /* high 16bits of abs. address. */
-#define R_PPC64_ADDR16_HA R_PPC_ADDR16_HA /* adjusted high 16bits.  */
-#define R_PPC64_ADDR14 R_PPC_ADDR14   /* 16bit address, word aligned.  */
-#define R_PPC64_ADDR14_BRTAKEN  R_PPC_ADDR14_BRTAKEN
-#define R_PPC64_ADDR14_BRNTAKEN R_PPC_ADDR14_BRNTAKEN
-#define R_PPC64_REL24   R_PPC_REL24 /* PC relative 26 bit, word aligned.  */
-#define R_PPC64_REL14   R_PPC_REL14 /* PC relative 16 bit. */
-#define R_PPC64_REL14_BRTAKEN   R_PPC_REL14_BRTAKEN
-#define R_PPC64_REL14_BRNTAKEN  R_PPC_REL14_BRNTAKEN
-#define R_PPC64_GOT16     R_PPC_GOT16
-#define R_PPC64_GOT16_LO  R_PPC_GOT16_LO
-#define R_PPC64_GOT16_HI  R_PPC_GOT16_HI
-#define R_PPC64_GOT16_HA  R_PPC_GOT16_HA
-
-#define R_PPC64_COPY      R_PPC_COPY
-#define R_PPC64_GLOB_DAT  R_PPC_GLOB_DAT
-#define R_PPC64_JMP_SLOT  R_PPC_JMP_SLOT
-#define R_PPC64_RELATIVE  R_PPC_RELATIVE
-
-#define R_PPC64_UADDR32   R_PPC_UADDR32
-#define R_PPC64_UADDR16   R_PPC_UADDR16
-#define R_PPC64_REL32     R_PPC_REL32
-#define R_PPC64_PLT32     R_PPC_PLT32
-#define R_PPC64_PLTREL32  R_PPC_PLTREL32
-#define R_PPC64_PLT16_LO  R_PPC_PLT16_LO
-#define R_PPC64_PLT16_HI  R_PPC_PLT16_HI
-#define R_PPC64_PLT16_HA  R_PPC_PLT16_HA
-
-#define R_PPC64_SECTOFF     R_PPC_SECTOFF
-#define R_PPC64_SECTOFF_LO  R_PPC_SECTOFF_LO
-#define R_PPC64_SECTOFF_HI  R_PPC_SECTOFF_HI
-#define R_PPC64_SECTOFF_HA  R_PPC_SECTOFF_HA
-#define R_PPC64_ADDR30          37  /* word30 (S + A - P) >> 2.  */
-#define R_PPC64_ADDR64          38  /* doubleword64 S + A.  */
-#define R_PPC64_ADDR16_HIGHER   39  /* half16 #higher(S + A).  */
-#define R_PPC64_ADDR16_HIGHERA  40  /* half16 #highera(S + A).  */
-#define R_PPC64_ADDR16_HIGHEST  41  /* half16 #highest(S + A).  */
-#define R_PPC64_ADDR16_HIGHESTA 42  /* half16 #highesta(S + A). */
-#define R_PPC64_UADDR64     43  /* doubleword64 S + A.  */
-#define R_PPC64_REL64       44  /* doubleword64 S + A - P.  */
-#define R_PPC64_PLT64       45  /* doubleword64 L + A.  */
-#define R_PPC64_PLTREL64    46  /* doubleword64 L + A - P.  */
-#define R_PPC64_TOC16       47  /* half16* S + A - .TOC.  */
-#define R_PPC64_TOC16_LO    48  /* half16 #lo(S + A - .TOC.).  */
-#define R_PPC64_TOC16_HI    49  /* half16 #hi(S + A - .TOC.).  */
-#define R_PPC64_TOC16_HA    50  /* half16 #ha(S + A - .TOC.).  */
-#define R_PPC64_TOC         51  /* doubleword64 .TOC. */
-#define R_PPC64_PLTGOT16    52  /* half16* M + A.  */
-#define R_PPC64_PLTGOT16_LO 53  /* half16 #lo(M + A).  */
-#define R_PPC64_PLTGOT16_HI 54  /* half16 #hi(M + A).  */
-#define R_PPC64_PLTGOT16_HA 55  /* half16 #ha(M + A).  */
-
-#define R_PPC64_ADDR16_DS      56 /* half16ds* (S + A) >> 2.  */
-#define R_PPC64_ADDR16_LO_DS   57 /* half16ds  #lo(S + A) >> 2.  */
-#define R_PPC64_GOT16_DS       58 /* half16ds* (G + A) >> 2.  */
-#define R_PPC64_GOT16_LO_DS    59 /* half16ds  #lo(G + A) >> 2.  */
-#define R_PPC64_PLT16_LO_DS    60 /* half16ds  #lo(L + A) >> 2.  */
-#define R_PPC64_SECTOFF_DS     61 /* half16ds* (R + A) >> 2.  */
-#define R_PPC64_SECTOFF_LO_DS  62 /* half16ds  #lo(R + A) >> 2.  */
-#define R_PPC64_TOC16_DS       63 /* half16ds* (S + A - .TOC.) >> 2.  */
-#define R_PPC64_TOC16_LO_DS    64 /* half16ds  #lo(S + A - .TOC.) >> 2.  */
-#define R_PPC64_PLTGOT16_DS    65 /* half16ds* (M + A) >> 2.  */
-#define R_PPC64_PLTGOT16_LO_DS 66 /* half16ds  #lo(M + A) >> 2.  */
+/* PowerPC relocations defined for the TLS access ABI.  */
+#define R_PPC_TLS		67 /* none	(sym+add)@tls */
+#define R_PPC_DTPMOD32		68 /* word32	(sym+add)@dtpmod */
+#define R_PPC_TPREL16		69 /* half16*	(sym+add)@tprel */
+#define R_PPC_TPREL16_LO	70 /* half16	(sym+add)@tprel@l */
+#define R_PPC_TPREL16_HI	71 /* half16	(sym+add)@tprel@h */
+#define R_PPC_TPREL16_HA	72 /* half16	(sym+add)@tprel@ha */
+#define R_PPC_TPREL32		73 /* word32	(sym+add)@tprel */
+#define R_PPC_DTPREL16		74 /* half16*	(sym+add)@dtprel */
+#define R_PPC_DTPREL16_LO	75 /* half16	(sym+add)@dtprel@l */
+#define R_PPC_DTPREL16_HI	76 /* half16	(sym+add)@dtprel@h */
+#define R_PPC_DTPREL16_HA	77 /* half16	(sym+add)@dtprel@ha */
+#define R_PPC_DTPREL32		78 /* word32	(sym+add)@dtprel */
+#define R_PPC_GOT_TLSGD16	79 /* half16*	(sym+add)@got@tlsgd */
+#define R_PPC_GOT_TLSGD16_LO	80 /* half16	(sym+add)@got@tlsgd@l */
+#define R_PPC_GOT_TLSGD16_HI	81 /* half16	(sym+add)@got@tlsgd@h */
+#define R_PPC_GOT_TLSGD16_HA	82 /* half16	(sym+add)@got@tlsgd@ha */
+#define R_PPC_GOT_TLSLD16	83 /* half16*	(sym+add)@got@tlsld */
+#define R_PPC_GOT_TLSLD16_LO	84 /* half16	(sym+add)@got@tlsld@l */
+#define R_PPC_GOT_TLSLD16_HI	85 /* half16	(sym+add)@got@tlsld@h */
+#define R_PPC_GOT_TLSLD16_HA	86 /* half16	(sym+add)@got@tlsld@ha */
+#define R_PPC_GOT_TPREL16	87 /* half16*	(sym+add)@got@tprel */
+#define R_PPC_GOT_TPREL16_LO	88 /* half16	(sym+add)@got@tprel@l */
+#define R_PPC_GOT_TPREL16_HI	89 /* half16	(sym+add)@got@tprel@h */
+#define R_PPC_GOT_TPREL16_HA	90 /* half16	(sym+add)@got@tprel@ha */
+#define R_PPC_GOT_DTPREL16	91 /* half16*	(sym+add)@got@dtprel */
+#define R_PPC_GOT_DTPREL16_LO	92 /* half16*	(sym+add)@got@dtprel@l */
+#define R_PPC_GOT_DTPREL16_HI	93 /* half16*	(sym+add)@got@dtprel@h */
+#define R_PPC_GOT_DTPREL16_HA	94 /* half16*	(sym+add)@got@dtprel@ha */
 
-/* PowerPC64 relocations defined for the TLS access ABI.  */
-#define R_PPC64_TLS             67 /* none         (sym+add)@tls.  */
-#define R_PPC64_DTPMOD64        68 /* doubleword64 (sym+add)@dtpmod.  */
-#define R_PPC64_TPREL16         69 /* half16*      (sym+add)@tprel.  */
-#define R_PPC64_TPREL16_LO      60 /* half16       (sym+add)@tprel@l. */
-#define R_PPC64_TPREL16_HI      71 /* half16       (sym+add)@tprel@h.  */
-#define R_PPC64_TPREL16_HA      72 /* half16       (sym+add)@tprel@ha.  */
-#define R_PPC64_TPREL64         73 /* doubleword64 (sym+add)@tprel.  */
-#define R_PPC64_DTPREL16        74 /* half16*      (sym+add)@dtprel.  */
-#define R_PPC64_DTPREL16_LO     75 /* half16       (sym+add)@dtprel@l.  */
-#define R_PPC64_DTPREL16_HI     76 /* half16       (sym+add)@dtprel@h.  */
-#define R_PPC64_DTPREL16_HA     77 /* half16       (sym+add)@dtprel@ha.  */
-#define R_PPC64_DTPREL64        78 /* doubleword64 (sym+add)@dtprel.  */
-#define R_PPC64_GOT_TLSGD16     79 /* half16*      (sym+add)@got@tlsgd.  */
-#define R_PPC64_GOT_TLSGD16_LO  80 /* half16       (sym+add)@got@tlsgd@l.  */
-#define R_PPC64_GOT_TLSGD16_HI  81 /* half16       (sym+add)@got@tlsgd@h.  */
-#define R_PPC64_GOT_TLSGD16_HA  82 /* half16       (sym+add)@got@tlsgd@ha.  */
-#define R_PPC64_GOT_TLSLD16     83 /* half16*      (sym+add)@got@tlsld.  */
-#define R_PPC64_GOT_TLSLD16_LO  84 /* half16       (sym+add)@got@tlsld@l.  */
-#define R_PPC64_GOT_TLSLD16_HI  85 /* half16       (sym+add)@got@tlsld@h.  */
-#define R_PPC64_GOT_TLSLD16_HA  86 /* half16       (sym+add)@got@tlsld@ha.  */
-#define R_PPC64_GOT_TPREL16_DS  87 /* half16ds*    (sym+add)@got@tprel.  */
-#define R_PPC64_GOT_TPREL16_LO_DS 88 /* half16ds   (sym+add)@got@tprel@l.  */
-#define R_PPC64_GOT_TPREL16_HI  89 /* half16       (sym+add)@got@tprel@h.  */
-#define R_PPC64_GOT_TPREL16_HA  90 /* half16       (sym+add)@got@tprel@ha.  */
-#define R_PPC64_GOT_DTPREL16_DS 91 /* half16ds*    (sym+add)@got@dtprel.  */
-#define R_PPC64_GOT_DTPREL16_LO_DS 92 /* half16ds  (sym+add)@got@dtprel@l.  */
-#define R_PPC64_GOT_DTPREL16_HI 93 /* half16       (sym+add)@got@dtprel@h.  */
-#define R_PPC64_GOT_DTPREL16_HA 94 /* half16       (sym+add)@got@dtprel@ha.  */
-#define R_PPC64_TPREL16_DS      95 /* half16ds*    (sym+add)@tprel.  */
-#define R_PPC64_TPREL16_LO_DS   96 /* half16ds     (sym+add)@tprel@l.  */
-#define R_PPC64_TPREL16_HIGHER  97 /* half16       (sym+add)@tprel@higher.  */
-#define R_PPC64_TPREL16_HIGHERA 98 /* half16       (sym+add)@tprel@highera.  */
-#define R_PPC64_TPREL16_HIGHEST 99 /* half16       (sym+add)@tprel@highest.  */
-#define R_PPC64_TPREL16_HIGHESTA 100 /* half16    (sym+add)@tprel@highesta.  */
-#define R_PPC64_DTPREL16_DS    101 /* half16ds*    (sym+add)@dtprel.  */
-#define R_PPC64_DTPREL16_LO_DS 102 /* half16ds     (sym+add)@dtprel@l.  */
-#define R_PPC64_DTPREL16_HIGHER 103 /* half16      (sym+add)@dtprel@higher.  */
-#define R_PPC64_DTPREL16_HIGHERA 104 /* half16    (sym+add)@dtprel@highera.  */
-#define R_PPC64_DTPREL16_HIGHEST 105 /* half16    (sym+add)@dtprel@highest.  */
-#define R_PPC64_DTPREL16_HIGHESTA 106 /* half16  (sym+add)@dtprel@highesta.  */
 /* Keep this the last entry.  */
-#define R_PPC64_NUM		107
+#define R_PPC_NUM		95
 
 /* The remaining relocs are from the Embedded ELF ABI, and are not
    in the SVR4 ELF ABI.  */
@@ -2029,10 +1950,127 @@
    that may still be in object files.  */
 #define R_PPC_TOC16		255
 
+
+/* PowerPC64 relocations defined by the ABIs */
+#define R_PPC64_NONE		R_PPC_NONE
+#define R_PPC64_ADDR32		R_PPC_ADDR32 /* 32bit absolute address */
+#define R_PPC64_ADDR24		R_PPC_ADDR24 /* 26bit address, word aligned */
+#define R_PPC64_ADDR16		R_PPC_ADDR16 /* 16bit absolute address */
+#define R_PPC64_ADDR16_LO	R_PPC_ADDR16_LO	/* lower 16bits of address */
+#define R_PPC64_ADDR16_HI	R_PPC_ADDR16_HI	/* high 16bits of address. */
+#define R_PPC64_ADDR16_HA	R_PPC_ADDR16_HA /* adjusted high 16bits.  */
+#define R_PPC64_ADDR14		R_PPC_ADDR14 /* 16bit address, word aligned */
+#define R_PPC64_ADDR14_BRTAKEN	R_PPC_ADDR14_BRTAKEN
+#define R_PPC64_ADDR14_BRNTAKEN	R_PPC_ADDR14_BRNTAKEN
+#define R_PPC64_REL24		R_PPC_REL24 /* PC-rel. 26 bit, word aligned */
+#define R_PPC64_REL14		R_PPC_REL14 /* PC relative 16 bit */
+#define R_PPC64_REL14_BRTAKEN	R_PPC_REL14_BRTAKEN
+#define R_PPC64_REL14_BRNTAKEN	R_PPC_REL14_BRNTAKEN
+#define R_PPC64_GOT16		R_PPC_GOT16
+#define R_PPC64_GOT16_LO	R_PPC_GOT16_LO
+#define R_PPC64_GOT16_HI	R_PPC_GOT16_HI
+#define R_PPC64_GOT16_HA	R_PPC_GOT16_HA
+
+#define R_PPC64_COPY		R_PPC_COPY
+#define R_PPC64_GLOB_DAT	R_PPC_GLOB_DAT
+#define R_PPC64_JMP_SLOT	R_PPC_JMP_SLOT
+#define R_PPC64_RELATIVE	R_PPC_RELATIVE
+
+#define R_PPC64_UADDR32		R_PPC_UADDR32
+#define R_PPC64_UADDR16		R_PPC_UADDR16
+#define R_PPC64_REL32		R_PPC_REL32
+#define R_PPC64_PLT32		R_PPC_PLT32
+#define R_PPC64_PLTREL32	R_PPC_PLTREL32
+#define R_PPC64_PLT16_LO	R_PPC_PLT16_LO
+#define R_PPC64_PLT16_HI	R_PPC_PLT16_HI
+#define R_PPC64_PLT16_HA	R_PPC_PLT16_HA
+
+#define R_PPC64_SECTOFF		R_PPC_SECTOFF
+#define R_PPC64_SECTOFF_LO	R_PPC_SECTOFF_LO
+#define R_PPC64_SECTOFF_HI	R_PPC_SECTOFF_HI
+#define R_PPC64_SECTOFF_HA	R_PPC_SECTOFF_HA
+#define R_PPC64_ADDR30		37 /* word30 (S + A - P) >> 2 */
+#define R_PPC64_ADDR64		38 /* doubleword64 S + A */
+#define R_PPC64_ADDR16_HIGHER	39 /* half16 #higher(S + A) */
+#define R_PPC64_ADDR16_HIGHERA	40 /* half16 #highera(S + A) */
+#define R_PPC64_ADDR16_HIGHEST	41 /* half16 #highest(S + A) */
+#define R_PPC64_ADDR16_HIGHESTA	42 /* half16 #highesta(S + A) */
+#define R_PPC64_UADDR64		43 /* doubleword64 S + A */
+#define R_PPC64_REL64		44 /* doubleword64 S + A - P */
+#define R_PPC64_PLT64		45 /* doubleword64 L + A */
+#define R_PPC64_PLTREL64	46 /* doubleword64 L + A - P */
+#define R_PPC64_TOC16		47 /* half16* S + A - .TOC */
+#define R_PPC64_TOC16_LO	48 /* half16 #lo(S + A - .TOC.) */
+#define R_PPC64_TOC16_HI	49 /* half16 #hi(S + A - .TOC.) */
+#define R_PPC64_TOC16_HA	50 /* half16 #ha(S + A - .TOC.) */
+#define R_PPC64_TOC		51 /* doubleword64 .TOC */
+#define R_PPC64_PLTGOT16	52 /* half16* M + A */
+#define R_PPC64_PLTGOT16_LO	53 /* half16 #lo(M + A) */
+#define R_PPC64_PLTGOT16_HI	54 /* half16 #hi(M + A) */
+#define R_PPC64_PLTGOT16_HA	55 /* half16 #ha(M + A) */
+
+#define R_PPC64_ADDR16_DS	56 /* half16ds* (S + A) >> 2 */
+#define R_PPC64_ADDR16_LO_DS	57 /* half16ds  #lo(S + A) >> 2 */
+#define R_PPC64_GOT16_DS	58 /* half16ds* (G + A) >> 2 */
+#define R_PPC64_GOT16_LO_DS	59 /* half16ds  #lo(G + A) >> 2 */
+#define R_PPC64_PLT16_LO_DS	60 /* half16ds  #lo(L + A) >> 2 */
+#define R_PPC64_SECTOFF_DS	61 /* half16ds* (R + A) >> 2 */
+#define R_PPC64_SECTOFF_LO_DS	62 /* half16ds  #lo(R + A) >> 2 */
+#define R_PPC64_TOC16_DS	63 /* half16ds* (S + A - .TOC.) >> 2 */
+#define R_PPC64_TOC16_LO_DS	64 /* half16ds  #lo(S + A - .TOC.) >> 2 */
+#define R_PPC64_PLTGOT16_DS	65 /* half16ds* (M + A) >> 2 */
+#define R_PPC64_PLTGOT16_LO_DS	66 /* half16ds  #lo(M + A) >> 2 */
+
+/* PowerPC64 relocations defined for the TLS access ABI.  */
+#define R_PPC64_TLS		67 /* none	(sym+add)@tls */
+#define R_PPC64_DTPMOD64	68 /* doubleword64 (sym+add)@dtpmod */
+#define R_PPC64_TPREL16		69 /* half16*	(sym+add)@tprel */
+#define R_PPC64_TPREL16_LO	70 /* half16	(sym+add)@tprel@l */
+#define R_PPC64_TPREL16_HI	71 /* half16	(sym+add)@tprel@h */
+#define R_PPC64_TPREL16_HA	72 /* half16	(sym+add)@tprel@ha */
+#define R_PPC64_TPREL64		73 /* doubleword64 (sym+add)@tprel */
+#define R_PPC64_DTPREL16	74 /* half16*	(sym+add)@dtprel */
+#define R_PPC64_DTPREL16_LO	75 /* half16	(sym+add)@dtprel@l */
+#define R_PPC64_DTPREL16_HI	76 /* half16	(sym+add)@dtprel@h */
+#define R_PPC64_DTPREL16_HA	77 /* half16	(sym+add)@dtprel@ha */
+#define R_PPC64_DTPREL64	78 /* doubleword64 (sym+add)@dtprel */
+#define R_PPC64_GOT_TLSGD16	79 /* half16*	(sym+add)@got@tlsgd */
+#define R_PPC64_GOT_TLSGD16_LO	80 /* half16	(sym+add)@got@tlsgd@l */
+#define R_PPC64_GOT_TLSGD16_HI	81 /* half16	(sym+add)@got@tlsgd@h */
+#define R_PPC64_GOT_TLSGD16_HA	82 /* half16	(sym+add)@got@tlsgd@ha */
+#define R_PPC64_GOT_TLSLD16	83 /* half16*	(sym+add)@got@tlsld */
+#define R_PPC64_GOT_TLSLD16_LO	84 /* half16	(sym+add)@got@tlsld@l */
+#define R_PPC64_GOT_TLSLD16_HI	85 /* half16	(sym+add)@got@tlsld@h */
+#define R_PPC64_GOT_TLSLD16_HA	86 /* half16	(sym+add)@got@tlsld@ha */
+#define R_PPC64_GOT_TPREL16_DS	87 /* half16ds*	(sym+add)@got@tprel */
+#define R_PPC64_GOT_TPREL16_LO_DS 88 /* half16ds (sym+add)@got@tprel@l */
+#define R_PPC64_GOT_TPREL16_HI	89 /* half16	(sym+add)@got@tprel@h */
+#define R_PPC64_GOT_TPREL16_HA	90 /* half16	(sym+add)@got@tprel@ha */
+#define R_PPC64_GOT_DTPREL16_DS	91 /* half16ds*	(sym+add)@got@dtprel */
+#define R_PPC64_GOT_DTPREL16_LO_DS 92 /* half16ds (sym+add)@got@dtprel@l */
+#define R_PPC64_GOT_DTPREL16_HI	93 /* half16	(sym+add)@got@dtprel@h */
+#define R_PPC64_GOT_DTPREL16_HA	94 /* half16	(sym+add)@got@dtprel@ha */
+#define R_PPC64_TPREL16_DS	95 /* half16ds*	(sym+add)@tprel */
+#define R_PPC64_TPREL16_LO_DS	96 /* half16ds	(sym+add)@tprel@l */
+#define R_PPC64_TPREL16_HIGHER	97 /* half16	(sym+add)@tprel@higher */
+#define R_PPC64_TPREL16_HIGHERA	98 /* half16	(sym+add)@tprel@highera */
+#define R_PPC64_TPREL16_HIGHEST	99 /* half16	(sym+add)@tprel@highest */
+#define R_PPC64_TPREL16_HIGHESTA 100 /* half16	(sym+add)@tprel@highesta */
+#define R_PPC64_DTPREL16_DS	101 /* half16ds* (sym+add)@dtprel */
+#define R_PPC64_DTPREL16_LO_DS	102 /* half16ds	(sym+add)@dtprel@l */
+#define R_PPC64_DTPREL16_HIGHER	103 /* half16	(sym+add)@dtprel@higher */
+#define R_PPC64_DTPREL16_HIGHERA 104 /* half16	(sym+add)@dtprel@highera */
+#define R_PPC64_DTPREL16_HIGHEST 105 /* half16	(sym+add)@dtprel@highest */
+#define R_PPC64_DTPREL16_HIGHESTA 106 /* half16	(sym+add)@dtprel@highesta */
+
+/* Keep this the last entry.  */
+#define R_PPC64_NUM		107
+
 /* PowerPC64 specific values for the Dyn d_tag field.  */
 #define DT_PPC64_GLINK  (DT_LOPROC + 0)
 #define DT_PPC64_NUM    1
 
+
 /* ARM specific declarations */
 
 /* Processor specific flags for the ELF header e_flags field.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/ldconfig.c libc-20030708/elf/ldconfig.c
--- glibc-2.3.2/elf/ldconfig.c	2003-01-13 17:50:11.000000000 +0900
+++ libc-20030708/elf/ldconfig.c	2003-07-08 22:58:06.000000000 +0900
@@ -342,13 +342,15 @@
       entry->flag = FLAG_ANY;
     }
 
-  /* Canonify path: for now only remove trailing slashes.  */
+  /* Canonify path: for now only remove leading and trailing
+     whitespace and the trailing slashes slashes.  */
   i = strlen (entry->path) - 1;
+
+  while (isspace (entry->path[i]) && i > 0)
+    entry->path[i--] = '\0';
+
   while (entry->path[i] == '/' && i > 0)
-    {
-      entry->path[i] = '\0';
-      --i;
-    }
+    entry->path[i--] = '\0';
 
   if (stat64 (entry->path, &stat_buf))
     {
@@ -963,12 +965,18 @@
 	 make it terminating the line.  */
       *strchrnul (line, '#') = '\0';
 
+      /* Remove leading whitespace.  NUL is no whitespace character.  */
+      char *cp = line;
+      while (isspace (*cp))
+	++cp;
+
       /* If the line is blank it is ignored.  */
-      if (line[0] == '\0')
+      if (cp[0] == '\0')
 	continue;
 
-      add_dir (line);
-    } while (!feof (file));
+      add_dir (cp);
+    }
+  while (!feof_unlocked (file));
 
   /* Free buffer and close file.  */
   free (line);
@@ -1095,9 +1103,9 @@
   if (!opt_only_cline)
     {
       /* Always add the standard search paths.  */
-      add_dir (SLIBDIR);
+      add_system_dir (SLIBDIR);
       if (strcmp (SLIBDIR, LIBDIR))
-	add_dir (LIBDIR);
+	add_system_dir (LIBDIR);
 
       parse_conf (config_file);
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/rtld-Rules libc-20030708/elf/rtld-Rules
--- glibc-2.3.2/elf/rtld-Rules	2002-10-14 13:03:13.000000000 +0900
+++ libc-20030708/elf/rtld-Rules	2003-05-02 14:47:11.000000000 +0900
@@ -1,6 +1,6 @@
 # Subroutine makefile for compiling libc modules linked into dynamic linker.
 
-# Copyright (C) 2002 Free Software Foundation, Inc.
+# Copyright (C) 2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -81,19 +81,13 @@
 # The sysd-rules generated makefile already defines pattern rules for rtld-%
 # targets built from sysdeps source files.
 $(objpfx)rtld-%.os: %.S $(before-compile); $(compile-command.S)
-$(objpfx)rtld-%.d: %.S $(before-compile); $(+make-deps)
 $(objpfx)rtld-%.os: %.s $(before-compile); $(compile-command.s)
-$(objpfx)rtld-%.d: %.s $(before-compile); $(+make-deps)
 $(objpfx)rtld-%.os: %.c $(before-compile); $(compile-command.c)
-$(objpfx)rtld-%.d: %.c $(before-compile); $(+make-deps)
 
 # The rules for generated source files.
 $(objpfx)rtld-%.os: $(objpfx)%.S $(before-compile); $(compile-command.S)
-$(objpfx)rtld-%.d: $(objpfx)%.S $(before-compile); $(+make-deps)
 $(objpfx)rtld-%.os: $(objpfx)%.s $(before-compile); $(compile-command.s)
-$(objpfx)rtld-%.d: $(objpfx)%.s $(before-compile); $(+make-deps)
 $(objpfx)rtld-%.os: $(objpfx)%.c $(before-compile); $(compile-command.c)
-$(objpfx)rtld-%.d: $(objpfx)%.c $(before-compile); $(+make-deps)
 
 # The command line setting of rtld-modules (see above) tells us
 # what we need to build, and that tells us what dependency files we need.
@@ -101,9 +95,12 @@
 
 # Figure out the dependency files we need.  After respecting the $(omit-deps)
 # list as applied to the names without the `rtld-', there may be none left.
-rtld-depfiles := $(patsubst %,$(objpfx)rtld-%.d,\
+rtld-depfiles := $(patsubst %,$(objpfx)rtld-%.os.d,\
 			    $(filter-out $(omit-deps),\
 					 $(rtld-modules:rtld-%.os=%)))
+rtld-depfiles := $(strip $(wildcard $(rtld-depfiles)) \
+			 $(patsubst %.dt,%.d,\
+				    $(wildcard $(rtld-depfiles:.d=.dt))))
 ifdef rtld-depfiles
 -include $(rtld-depfiles)
 endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/rtld.c libc-20030708/elf/rtld.c
--- glibc-2.3.2/elf/rtld.c	2003-01-08 03:47:35.000000000 +0900
+++ libc-20030708/elf/rtld.c	2003-07-08 22:58:06.000000000 +0900
@@ -233,6 +233,9 @@
   GL(dl_rtld_map).l_tls_modid = 1;
 # else
   assert (info->l.l_tls_modid == 0);
+#  if NO_TLS_OFFSET != 0
+  GL(dl_rtld_map).l_tls_offset = NO_TLS_OFFSET;
+#  endif
 # endif
 
 #endif
@@ -314,7 +317,11 @@
 
   /* Read our own dynamic section and fill in the info array.  */
   bootstrap_map.l_ld = (void *) bootstrap_map.l_addr + elf_machine_dynamic ();
-  elf_get_dynamic_info (&bootstrap_map);
+  elf_get_dynamic_info (&bootstrap_map, NULL);
+
+#if defined USE_TLS && NO_TLS_OFFSET != 0
+  bootstrap_map.l_tls_offset = NO_TLS_OFFSET;
+#endif
 
 #if USE___THREAD
   /* Get the dynamic linker's own program header.  First we need the ELF
@@ -885,7 +892,7 @@
   if (! rtld_is_main)
     {
       /* Extract the contents of the dynamic section for easy access.  */
-      elf_get_dynamic_info (GL(dl_loaded));
+      elf_get_dynamic_info (GL(dl_loaded), NULL);
       if (GL(dl_loaded)->l_info[DT_HASH])
 	/* Set up our cache of pointers into the hash table.  */
 	_dl_setup_hash (GL(dl_loaded));
@@ -924,6 +931,13 @@
   GL(dl_rtld_map).l_prev = GL(dl_loaded);
   ++GL(dl_nloaded);
 
+  /* Set up the program header information for the dynamic linker
+     itself.  It is needed in the dl_iterate_phdr() callbacks.  */
+  ElfW(Ehdr) *rtld_ehdr = (ElfW(Ehdr) *) GL(dl_rtld_map).l_map_start;
+  GL(dl_rtld_map).l_phdr = (ElfW(Phdr) *) (GL(dl_rtld_map).l_map_start
+					   + rtld_ehdr->e_phoff);
+  GL(dl_rtld_map).l_phnum = rtld_ehdr->e_phnum;
+
   /* We have two ways to specify objects to preload: via environment
      variable and via the file /etc/ld.so.preload.  The latter can also
      be used when security is enabled.  */
@@ -1062,6 +1076,50 @@
       assert (i == npreloads);
     }
 
+#ifdef NEED_DL_SYSINFO
+  if (GL(dl_sysinfo_dso) != NULL)
+    {
+      /* We have a prelinked DSO preloaded by the system.  */
+      GL(dl_sysinfo) = GL(dl_sysinfo_dso)->e_entry;
+
+      /* Do an abridged version of the work _dl_map_object_from_fd would do
+	 to map in the object.  It's already mapped and prelinked (and
+	 better be, since it's read-only and so we couldn't relocate it).
+	 We just want our data structures to describe it as if we had just
+	 mapped and relocated it normally.  */
+      struct link_map *l = _dl_new_object ((char *) "", "", lt_library, NULL);
+      if (__builtin_expect (l != NULL, 1))
+	{
+	  static ElfW(Dyn) dyn_temp [DL_RO_DYN_TEMP_CNT];
+
+	  l->l_phdr = ((const void *) GL(dl_sysinfo_dso)
+		       + GL(dl_sysinfo_dso)->e_phoff);
+	  l->l_phnum = GL(dl_sysinfo_dso)->e_phnum;
+	  for (uint_fast16_t i = 0; i < l->l_phnum; ++i)
+	    {
+	      const ElfW(Phdr) *const ph = &l->l_phdr[i];
+	      if (ph->p_type == PT_DYNAMIC)
+		{
+		  l->l_ld = (void *) ph->p_vaddr;
+		  l->l_ldnum = ph->p_memsz / sizeof (ElfW(Dyn));
+		  break;
+		}
+	      if (ph->p_type == PT_LOAD)
+		assert ((void *) ph->p_vaddr == GL(dl_sysinfo_dso));
+	    }
+	  elf_get_dynamic_info (l, dyn_temp);
+	  _dl_setup_hash (l);
+	  l->l_relocated = 1;
+
+	  /* Now that we have the info handy, use the DSO image's soname
+	     so this object can be looked up by name.  */
+	  if (l->l_info[DT_SONAME] != NULL)
+	    l->l_libname->name = ((char *) D_PTR (l, l_info[DT_STRTAB])
+				  + l->l_info[DT_SONAME]->d_un.d_val);
+	}
+    }
+#endif
+
   /* Load all the libraries specified by DT_NEEDED entries.  If LD_PRELOAD
      specified some libraries to load, these are inserted before the actual
      dependencies in the executable's searchlist for symbol resolution.  */
@@ -1213,57 +1271,52 @@
 	 important that we do this before real relocation, because the
 	 functions we call below for output may no longer work properly
 	 after relocation.  */
-      if (! GL(dl_loaded)->l_info[DT_NEEDED])
-	_dl_printf ("\tstatically linked\n");
-      else
+      struct link_map *l;
+
+      if (GL(dl_debug_mask) & DL_DEBUG_PRELINK)
 	{
-	  struct link_map *l;
+	  struct r_scope_elem *scope = &GL(dl_loaded)->l_searchlist;
 
-	  if (GL(dl_debug_mask) & DL_DEBUG_PRELINK)
+	  for (i = 0; i < scope->r_nlist; i++)
 	    {
-	      struct r_scope_elem *scope = &GL(dl_loaded)->l_searchlist;
-
-	      for (i = 0; i < scope->r_nlist; i++)
+	      l = scope->r_list [i];
+	      if (l->l_faked)
 		{
-		  l = scope->r_list [i];
-		  if (l->l_faked)
-		    {
-		      _dl_printf ("\t%s => not found\n", l->l_libname->name);
-		      continue;
-		    }
-		  if (_dl_name_match_p (GL(dl_trace_prelink), l))
-		    GL(dl_trace_prelink_map) = l;
-		  _dl_printf ("\t%s => %s (0x%0*Zx, 0x%0*Zx)",
-			      l->l_libname->name[0] ? l->l_libname->name
-			      : rtld_progname ?: "<main program>",
-			      l->l_name[0] ? l->l_name
-			      : rtld_progname ?: "<main program>",
-			      (int) sizeof l->l_map_start * 2,
-			      l->l_map_start,
-			      (int) sizeof l->l_addr * 2,
-			      l->l_addr);
+		  _dl_printf ("\t%s => not found\n", l->l_libname->name);
+		  continue;
+		}
+	      if (_dl_name_match_p (GL(dl_trace_prelink), l))
+		GL(dl_trace_prelink_map) = l;
+	      _dl_printf ("\t%s => %s (0x%0*Zx, 0x%0*Zx)",
+			  l->l_libname->name[0] ? l->l_libname->name
+			  : rtld_progname ?: "<main program>",
+			  l->l_name[0] ? l->l_name
+			  : rtld_progname ?: "<main program>",
+			  (int) sizeof l->l_map_start * 2, l->l_map_start,
+			  (int) sizeof l->l_addr * 2, l->l_addr);
 #ifdef USE_TLS
-		  if (l->l_tls_modid)
-		    _dl_printf (" TLS(0x%Zx, 0x%0*Zx)\n", l->l_tls_modid,
-				(int) sizeof l->l_tls_offset * 2,
-				l->l_tls_offset);
-		  else
+	      if (l->l_tls_modid)
+		_dl_printf (" TLS(0x%Zx, 0x%0*Zx)\n", l->l_tls_modid,
+			    (int) sizeof l->l_tls_offset * 2,
+			    l->l_tls_offset);
+	      else
 #endif
-		    _dl_printf ("\n");
-		}
-	    }
-	  else
-	    {
-	      for (l = GL(dl_loaded)->l_next; l; l = l->l_next)
-		if (l->l_faked)
-		  /* The library was not found.  */
-		  _dl_printf ("\t%s => not found\n", l->l_libname->name);
-		else
-		  _dl_printf ("\t%s => %s (0x%0*Zx)\n", l->l_libname->name,
-			      l->l_name, (int) sizeof l->l_map_start * 2,
-			      l->l_map_start);
+		_dl_printf ("\n");
 	    }
 	}
+      else if (! GL(dl_loaded)->l_info[DT_NEEDED])
+	_dl_printf ("\tstatically linked\n");
+      else
+	{
+	  for (l = GL(dl_loaded)->l_next; l; l = l->l_next)
+	    if (l->l_faked)
+	      /* The library was not found.  */
+	      _dl_printf ("\t%s => not found\n", l->l_libname->name);
+	    else
+	      _dl_printf ("\t%s => %s (0x%0*Zx)\n", l->l_libname->name,
+			  l->l_name, (int) sizeof l->l_map_start * 2,
+			  l->l_map_start);
+	}
 
       if (__builtin_expect (mode, trace) != trace)
 	for (i = 1; i < (unsigned int) _dl_argc; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tls-macros.h libc-20030708/elf/tls-macros.h
--- glibc-2.3.2/elf/tls-macros.h	2003-02-26 08:40:08.000000000 +0900
+++ libc-20030708/elf/tls-macros.h	2003-04-15 23:55:45.000000000 +0900
@@ -316,13 +316,14 @@
 
 # define TLS_IE(x) \
   ({ void *__l;								      \
+     register long __gp asm ("gp");					      \
      asm (";;\n\t"							      \
 	 "addl r16=@ltoff(@tprel(" #x ")),gp\n\t"			      \
          ";;\n\t"							      \
          "ld8 r17=[r16]\n\t"						      \
          ";;\n\t"							      \
          "add %0=r13,r17\n\t"						      \
-         : "=r" (__l) : : "r16", "r17" ); __l; })
+         : "=r" (__l) : "r" (__gp) : "r16", "r17" ); __l; })
 
 # define __TLS_CALL_CLOBBERS \
   "r2", "r3", "r8", "r9", "r10", "r11", "r14", "r15", "r16", "r17",	      \
@@ -335,6 +336,7 @@
 
 # define TLS_LD(x) \
   ({ void *__l;								      \
+     register long __gp asm ("gp");					      \
      asm (";;\n\t"							      \
 	 "mov loc0=gp\n\t"						      \
          "addl r16=@ltoff(@dtpmod(" #x ")),gp\n\t"			      \
@@ -345,11 +347,12 @@
          ";;\n\t"							      \
          "mov gp=loc0\n\t"						      \
          "mov %0=r8\n\t"						      \
-         : "=r" (__l) : : "loc0", __TLS_CALL_CLOBBERS);			      \
+         : "=r" (__l) : "r" (__gp) : "loc0", __TLS_CALL_CLOBBERS);	      \
      __l; })
 
 # define TLS_GD(x) \
   ({ void *__l;								      \
+     register long __gp asm ("gp");					      \
      asm (";;\n\t"							      \
 	 "mov loc0=gp\n\t"						      \
          "addl r16=@ltoff(@dtpmod(" #x ")),gp\n\t"			      \
@@ -361,7 +364,7 @@
          ";;\n\t"							      \
          "mov gp=loc0\n\t"						      \
          "mov %0=r8\n\t"						      \
-          : "=r" (__l) : : "loc0", __TLS_CALL_CLOBBERS);		      \
+          : "=r" (__l) : "r" (__gp) : "loc0", __TLS_CALL_CLOBBERS);	      \
      __l; })
 
 #elif defined __sparc__ && !defined __arch64__
@@ -373,7 +376,7 @@
      asm ("add %%g7, %1, %0" : "=r" (__l) : "r" (__l));			      \
      __l; })
 
-# ifdef __PIC__ 
+# ifdef __PIC__
 #  define TLS_LOAD_PIC \
   ({ register long pc __asm__ ("%o7");					      \
      long got;								      \
@@ -623,6 +626,53 @@
      (int *) (__builtin_thread_pointer() + __offset); })
 # endif
 
+#elif defined __powerpc__ && !defined __powerpc64__
+
+# define __TLS_CALL_CLOBBERS						\
+	"0", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12",	\
+	"lr", "ctr", "cr0", "cr1", "cr5", "cr6", "cr7"
+
+/* PowerPC32 Local Exec TLS access.  */
+# define TLS_LE(x)				\
+  ({ int *__result;				\
+     asm ("addi %0,2," #x "@tprel"		\
+	  : "=r" (__result));			\
+     __result; })
+
+/* PowerPC32 Initial Exec TLS access.  */
+# define TLS_IE(x)					\
+  ({ int *__result;					\
+     asm ("bl _GLOBAL_OFFSET_TABLE_@local-4\n\t"	\
+	  "mflr %0\n\t"					\
+	  "lwz %0," #x "@got@tprel(%0)\n\t"		\
+	  "add %0,%0," #x "@tls"			\
+	  : "=b" (__result) :				\
+	  : "lr");					\
+     __result; })
+
+/* PowerPC32 Local Dynamic TLS access.  */
+# define TLS_LD(x)					\
+  ({ int *__result;					\
+     asm ("bl _GLOBAL_OFFSET_TABLE_@local-4\n\t"	\
+	  "mflr 3\n\t"					\
+	  "addi 3,3," #x "@got@tlsld\n\t"		\
+	  "bl __tls_get_addr@plt\n\t"			\
+	  "addi %0,3," #x "@dtprel"			\
+	  : "=r" (__result) :				\
+	  : __TLS_CALL_CLOBBERS);			\
+     __result; })
+
+/* PowerPC32 General Dynamic TLS access.  */
+# define TLS_GD(x)					\
+  ({ register int *__result __asm__ ("r3");		\
+     asm ("bl _GLOBAL_OFFSET_TABLE_@local-4\n\t"	\
+	  "mflr 3\n\t"					\
+	  "addi 3,3," #x "@got@tlsgd\n\t"		\
+	  "bl __tls_get_addr@plt"			\
+	  : :						\
+	  : __TLS_CALL_CLOBBERS);			\
+     __result; })
+
 #elif defined __powerpc__ && defined __powerpc64__
 
 /* PowerPC64 Local Exec TLS access.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tls10.c libc-20030708/elf/tst-tls10.c
--- glibc-2.3.2/elf/tst-tls10.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tls10.c	2003-04-23 10:54:06.000000000 +0900
@@ -0,0 +1,40 @@
+#include "tst-tls10.h"
+
+#ifdef USE_TLS__THREAD
+__thread int dummy __attribute__((visibility ("hidden"))) = 12;
+__thread struct A local = { 1, 2, 3 };
+#endif
+
+#define CHECK(N, S)					\
+  p = f##N##a ();					\
+  if (p->a != S || p->b != S + 1 || p->c != S + 2)	\
+    abort ()
+
+int
+main (void)
+{
+#ifdef USE_TLS__THREAD
+  struct A *p;
+  if (local.a != 1 || local.b != 2 || local.c != 3)
+    abort ();
+  if (a1.a != 4 || a1.b != 5 || a1.c != 6)
+    abort ();
+  if (a2.a != 22 || a2.b != 23 || a2.c != 24)
+    abort ();
+  if (a3.a != 10 || a3.b != 11 || a3.c != 12)
+    abort ();
+  if (a4.a != 25 || a4.b != 26 || a4.c != 27)
+    abort ();
+  check1 ();
+  check2 ();
+  if (f1a () != &a1 || f2a () != &a2 || f3a () != &a3 || f4a () != &a4)
+    abort ();
+  CHECK (5, 16);
+  CHECK (6, 19);
+  if (f7a () != &a2 || f8a () != &a4)
+    abort ();
+  CHECK (9, 28);
+  CHECK (10, 31);
+#endif
+  exit (0);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tls10.h libc-20030708/elf/tst-tls10.h
--- glibc-2.3.2/elf/tst-tls10.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tls10.h	2003-04-18 04:19:01.000000000 +0900
@@ -0,0 +1,38 @@
+#include <tls.h>
+#include <stdlib.h>
+
+#if defined USE_TLS && defined HAVE___THREAD \
+    && defined HAVE_TLS_MODEL_ATTRIBUTE
+# define USE_TLS__THREAD
+
+struct A
+{
+  char a;
+  int b;
+  long long c;
+};
+
+extern __thread struct A a1, a2, a3, a4;
+extern struct A *f1a (void);
+extern struct A *f2a (void);
+extern struct A *f3a (void);
+extern struct A *f4a (void);
+extern struct A *f5a (void);
+extern struct A *f6a (void);
+extern struct A *f7a (void);
+extern struct A *f8a (void);
+extern struct A *f9a (void);
+extern struct A *f10a (void);
+extern int f1b (void);
+extern int f2b (void);
+extern int f3b (void);
+extern int f4b (void);
+extern int f5b (void);
+extern int f6b (void);
+extern int f7b (void);
+extern int f8b (void);
+extern int f9b (void);
+extern int f10b (void);
+extern void check1 (void);
+extern void check2 (void);
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tls11.c libc-20030708/elf/tst-tls11.c
--- glibc-2.3.2/elf/tst-tls11.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tls11.c	2003-04-18 04:19:01.000000000 +0900
@@ -0,0 +1,27 @@
+#include "tst-tls10.h"
+
+#define CHECK(N, S)					\
+  p = f##N##a ();					\
+  if (p->a != S || p->b != S + 1 || p->c != S + 2)	\
+    abort ()
+
+int
+main (void)
+{
+#ifdef USE_TLS__THREAD
+  struct A *p;
+  check1 ();
+  check2 ();
+  CHECK (1, 4);
+  CHECK (2, 22);
+  CHECK (3, 10);
+  CHECK (4, 25);
+  CHECK (5, 16);
+  CHECK (6, 19);
+  CHECK (7, 22);
+  CHECK (8, 25);
+  CHECK (9, 28);
+  CHECK (10, 31);
+#endif
+  exit (0);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tls12.c libc-20030708/elf/tst-tls12.c
--- glibc-2.3.2/elf/tst-tls12.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tls12.c	2003-04-23 10:54:06.000000000 +0900
@@ -0,0 +1,18 @@
+#include "tst-tls10.h"
+
+#define CHECK(N, S)					\
+  p = &a##N;						\
+  if (p->a != S || p->b != S + 1 || p->c != S + 2)	\
+    abort ()
+
+int
+main (void)
+{
+#ifdef USE_TLS__THREAD
+  struct A *p;
+  check1 ();
+  CHECK (1, 4);
+  CHECK (2, 7);
+#endif
+  exit (0);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tls13.c libc-20030708/elf/tst-tls13.c
--- glibc-2.3.2/elf/tst-tls13.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tls13.c	2003-04-27 15:15:09.000000000 +0900
@@ -0,0 +1,29 @@
+/* Check unloading modules with data in static TLS block.  */
+#include <dlfcn.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+
+static int
+do_test (void)
+{
+  int i;
+  for (i = 0; i < 1000;)
+    {
+      printf ("round %d\n",++i);
+
+      void *h = dlopen ("tst-tlsmod13a.so", RTLD_LAZY);
+      if (h == NULL)
+	{
+	  printf ("cannot load: %s\n", dlerror ());
+	  exit (1);
+	}
+
+      dlclose (h);
+    }
+
+  return 0;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tls8.c libc-20030708/elf/tst-tls8.c
--- glibc-2.3.2/elf/tst-tls8.c	2002-12-05 03:22:02.000000000 +0900
+++ libc-20030708/elf/tst-tls8.c	2003-04-28 23:53:20.000000000 +0900
@@ -19,8 +19,8 @@
   void *h1;
   void *h2;
   int i;
-  int modid1 = -1;
-  int modid2 = -1;
+  size_t modid1 = (size_t) -1;
+  size_t modid2 = (size_t) -1;
   int *bazp;
 
   for (i = 0; i < 10; ++i)
@@ -35,7 +35,7 @@
       /* Dirty test code here: we peek into a private data structure.
 	 We make sure that the module gets assigned the same ID every
 	 time.  The value of the first round is used.  */
-      if (modid1 == -1)
+      if (modid1 == (size_t) -1)
 	modid1 = ((struct link_map *) h1)->l_tls_modid;
       else if (((struct link_map *) h1)->l_tls_modid != modid1)
 	{
@@ -65,7 +65,7 @@
       /* Dirty test code here: we peek into a private data structure.
 	 We make sure that the module gets assigned the same ID every
 	 time.  The value of the first round is used.  */
-      if (modid2 == -1)
+      if (modid2 == (size_t) -1)
 	modid2 = ((struct link_map *) h1)->l_tls_modid;
       else if (((struct link_map *) h1)->l_tls_modid != modid2)
 	{
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod10.c libc-20030708/elf/tst-tlsmod10.c
--- glibc-2.3.2/elf/tst-tlsmod10.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod10.c	2003-04-18 04:19:01.000000000 +0900
@@ -0,0 +1 @@
+#include "tst-tlsmod8.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod11.c libc-20030708/elf/tst-tlsmod11.c
--- glibc-2.3.2/elf/tst-tlsmod11.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod11.c	2003-04-18 04:19:01.000000000 +0900
@@ -0,0 +1,6 @@
+#include "tst-tls10.h"
+
+#ifdef USE_TLS__THREAD
+__thread struct A a1 = { 4, 5, 6 };
+__thread struct A a2 = { 7, 8, 9 };
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod12.c libc-20030708/elf/tst-tlsmod12.c
--- glibc-2.3.2/elf/tst-tlsmod12.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod12.c	2003-04-18 04:19:01.000000000 +0900
@@ -0,0 +1,14 @@
+#include "tst-tls10.h"
+
+#ifdef USE_TLS__THREAD
+extern __thread struct A a2 __attribute__((tls_model("initial-exec")));
+
+void
+check1 (void)
+{
+  if (a1.a != 4 || a1.b != 5 || a1.c != 6)
+    abort ();
+  if (a2.a != 7 || a2.b != 8 || a2.c != 9)
+    abort ();
+}
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod13.c libc-20030708/elf/tst-tlsmod13.c
--- glibc-2.3.2/elf/tst-tlsmod13.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod13.c	2003-04-27 15:15:39.000000000 +0900
@@ -0,0 +1,14 @@
+#include <tls.h>
+
+#if defined USE_TLS && defined HAVE___THREAD \
+    && defined HAVE_TLS_MODEL_ATTRIBUTE
+__thread int a[2] __attribute__ ((tls_model ("initial-exec")));
+#else
+int a[2];
+#endif
+
+int
+foo (void)
+{
+  return a[0];
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod13a.c libc-20030708/elf/tst-tlsmod13a.c
--- glibc-2.3.2/elf/tst-tlsmod13a.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod13a.c	2003-04-27 15:15:39.000000000 +0900
@@ -0,0 +1,16 @@
+#include <tls.h>
+
+#if defined USE_TLS && defined HAVE___THREAD \
+    && defined HAVE_TLS_MODEL_ATTRIBUTE
+__thread int b[2] __attribute__ ((tls_model ("initial-exec")));
+#else
+int b[2];
+#endif
+
+extern int foo (void);
+
+int
+bar (void)
+{
+  return foo () + b[0];
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod7.c libc-20030708/elf/tst-tlsmod7.c
--- glibc-2.3.2/elf/tst-tlsmod7.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod7.c	2003-04-23 10:54:06.000000000 +0900
@@ -0,0 +1,103 @@
+#include "tst-tls10.h"
+
+#ifdef USE_TLS__THREAD
+__thread int dummy __attribute__((visibility ("hidden"))) = 12;
+__thread struct A a1 = { 4, 5, 6 };
+__thread struct A a2 = { 7, 8, 9 };
+__thread struct A a3 __attribute__((tls_model("initial-exec")))
+  = { 10, 11, 12 };
+__thread struct A a4 __attribute__((tls_model("initial-exec")))
+  = { 13, 14, 15 };
+static __thread struct A local1 = { 16, 17, 18 };
+static __thread struct A local2 __attribute__((tls_model("initial-exec")))
+  = { 19, 20, 21 };
+
+void
+check1 (void)
+{
+  if (a1.a != 4 || a1.b != 5 || a1.c != 6)
+    abort ();
+  if (a2.a != 22 || a2.b != 23 || a2.c != 24)
+    abort ();
+  if (a3.a != 10 || a3.b != 11 || a3.c != 12)
+    abort ();
+  if (a4.a != 25 || a4.b != 26 || a4.c != 27)
+    abort ();
+  if (local1.a != 16 || local1.b != 17 || local1.c != 18)
+    abort ();
+  if (local2.a != 19 || local2.b != 20 || local2.c != 21)
+    abort ();
+}
+
+struct A *
+f1a (void)
+{
+  return &a1;
+}
+
+struct A *
+f2a (void)
+{
+  return &a2;
+}
+
+struct A *
+f3a (void)
+{
+  return &a3;
+}
+
+struct A *
+f4a (void)
+{
+  return &a4;
+}
+
+struct A *
+f5a (void)
+{
+  return &local1;
+}
+
+struct A *
+f6a (void)
+{
+  return &local2;
+}
+
+int
+f1b (void)
+{
+  return a1.a;
+}
+
+int
+f2b (void)
+{
+  return a2.b;
+}
+
+int
+f3b (void)
+{
+  return a3.c;
+}
+
+int
+f4b (void)
+{
+  return a4.a;
+}
+
+int
+f5b (void)
+{
+  return local1.b;
+}
+
+int
+f6b (void)
+{
+  return local2.c;
+}
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod8.c libc-20030708/elf/tst-tlsmod8.c
--- glibc-2.3.2/elf/tst-tlsmod8.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod8.c	2003-04-23 10:54:06.000000000 +0900
@@ -0,0 +1,72 @@
+#include "tst-tls10.h"
+
+#ifdef USE_TLS__THREAD
+__thread long long dummy __attribute__((visibility ("hidden"))) = 12;
+__thread struct A a2 = { 22, 23, 24 };
+__thread struct A a4 __attribute__((tls_model("initial-exec")))
+  = { 25, 26, 27 };
+static __thread struct A local1 = { 28, 29, 30 };
+static __thread struct A local2 __attribute__((tls_model("initial-exec")))
+  = { 31, 32, 33 };
+
+void
+check2 (void)
+{
+  if (a2.a != 22 || a2.b != 23 || a2.c != 24)
+    abort ();
+  if (a4.a != 25 || a4.b != 26 || a4.c != 27)
+    abort ();
+  if (local1.a != 28 || local1.b != 29 || local1.c != 30)
+    abort ();
+  if (local2.a != 31 || local2.b != 32 || local2.c != 33)
+    abort ();
+}
+
+struct A *
+f7a (void)
+{
+  return &a2;
+}
+
+struct A *
+f8a (void)
+{
+  return &a4;
+}
+
+struct A *
+f9a (void)
+{
+  return &local1;
+}
+
+struct A *
+f10a (void)
+{
+  return &local2;
+}
+
+int
+f7b (void)
+{
+  return a2.b;
+}
+
+int
+f8b (void)
+{
+  return a4.a;
+}
+
+int
+f9b (void)
+{
+  return local1.b;
+}
+
+int
+f10b (void)
+{
+  return local2.c;
+}
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/tst-tlsmod9.c libc-20030708/elf/tst-tlsmod9.c
--- glibc-2.3.2/elf/tst-tlsmod9.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/elf/tst-tlsmod9.c	2003-04-23 10:54:06.000000000 +0900
@@ -0,0 +1,101 @@
+#include "tst-tls10.h"
+
+#ifdef USE_TLS__THREAD
+__thread int dummy __attribute__((visibility ("hidden"))) = 12;
+__thread struct A a1 = { 4, 5, 6 };
+__thread struct A a3 __attribute__((tls_model("initial-exec")))
+  = { 10, 11, 12 };
+extern __thread struct A a4 __attribute__((tls_model("initial-exec")));
+static __thread struct A local1 = { 16, 17, 18 };
+static __thread struct A local2 __attribute__((tls_model("initial-exec")))
+  = { 19, 20, 21 };
+
+void
+check1 (void)
+{
+  if (a1.a != 4 || a1.b != 5 || a1.c != 6)
+    abort ();
+  if (a2.a != 22 || a2.b != 23 || a2.c != 24)
+    abort ();
+  if (a3.a != 10 || a3.b != 11 || a3.c != 12)
+    abort ();
+  if (a4.a != 25 || a4.b != 26 || a4.c != 27)
+    abort ();
+  if (local1.a != 16 || local1.b != 17 || local1.c != 18)
+    abort ();
+  if (local2.a != 19 || local2.b != 20 || local2.c != 21)
+    abort ();
+}
+
+struct A *
+f1a (void)
+{
+  return &a1;
+}
+
+struct A *
+f2a (void)
+{
+  return &a2;
+}
+
+struct A *
+f3a (void)
+{
+  return &a3;
+}
+
+struct A *
+f4a (void)
+{
+  return &a4;
+}
+
+struct A *
+f5a (void)
+{
+  return &local1;
+}
+
+struct A *
+f6a (void)
+{
+  return &local2;
+}
+
+int
+f1b (void)
+{
+  return a1.a;
+}
+
+int
+f2b (void)
+{
+  return a2.b;
+}
+
+int
+f3b (void)
+{
+  return a3.c;
+}
+
+int
+f4b (void)
+{
+  return a4.a;
+}
+
+int
+f5b (void)
+{
+  return local1.b;
+}
+
+int
+f6b (void)
+{
+  return local2.c;
+}
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/vismain.c libc-20030708/elf/vismain.c
--- glibc-2.3.2/elf/vismain.c	2001-07-08 04:20:53.000000000 +0900
+++ libc-20030708/elf/vismain.c	2003-04-01 21:00:53.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -86,7 +86,8 @@
      first DSO.  */
   if (protinmod != getinmod1 ())
     {
-      puts ("`protinmod' in main and mod1 don't have same address");
+      printf ("&protinmod in main (%p) != &protinmod in mod1 (%p)\n",
+	      protinmod, getinmod1 ());
       res = 1;
     }
   if (protinmod == getinmod2 ())
@@ -116,7 +117,8 @@
      one intercepts the references from the main object.  */
   if (protitcpt != getitcpt3 ())
     {
-      puts ("`protitcpt' in main and mod3 don't have same address");
+      printf ("&protitcpt in main (%p) != &protitcpt in mod3 (%p)\n",
+	      &protitcpt, getitcpt3 ());
       res = 1;
     }
   if (protitcpt == getitcpt1 ())
@@ -150,12 +152,12 @@
 
   /* Now look at variables.  First a variable which is available
      everywhere.  We must have three different addresses.  */
-  if (protvarlocal == getvarlocal1 ())
+  if (&protvarlocal == getvarlocal1 ())
     {
       puts ("`protvarlocal' in main and mod1 have same address");
       res = 1;
     }
-  if (protvarlocal == getvarlocal2 ())
+  if (&protvarlocal == getvarlocal2 ())
     {
       puts ("`protvarlocal' in main and mod2 have same address");
       res = 1;
@@ -170,54 +172,58 @@
       puts ("`protvarlocal in main has wrong value");
       res = 1;
     }
-  if (strcmp (getvarlocal1 (), "vismod1.c") != 0)
+  if (strcmp (*getvarlocal1 (), "vismod1.c") != 0)
     {
       puts ("`getvarlocal1' returns wrong value");
       res = 1;
     }
-  if (strcmp (getvarlocal2 (), "vismod2.c") != 0)
+  if (strcmp (*getvarlocal2 (), "vismod2.c") != 0)
     {
       puts ("`getvarlocal2' returns wrong value");
       res = 1;
     }
 
   /* Now the case where there is no local definition.  */
-  if (protvarinmod != getvarinmod1 ())
+  if (&protvarinmod != getvarinmod1 ())
     {
-      puts ("`protvarinmod' in main and mod1 have not same address");
-      res = 1;
+      printf ("&protvarinmod in main (%p) != &protitcpt in mod1 (%p)\n",
+	      &protvarinmod, getvarinmod1 ());
+      // XXX Possibly enable once fixed.
+      // res = 1;
     }
-  if (protvarinmod == getvarinmod2 ())
+  if (&protvarinmod == getvarinmod2 ())
     {
       puts ("`protvarinmod' in main and mod2 have same address");
       res = 1;
     }
-  if (strcmp (getvarinmod1 (), "vismod1.c") != 0)
+  if (strcmp (*getvarinmod1 (), "vismod1.c") != 0)
     {
       puts ("`getvarinmod1' returns wrong value");
       res = 1;
     }
-  if (strcmp (getvarinmod2 (), "vismod2.c") != 0)
+  if (strcmp (*getvarinmod2 (), "vismod2.c") != 0)
     {
       puts ("`getvarinmod2' returns wrong value");
       res = 1;
     }
 
   /* And a test where a variable definition is intercepted.  */
-  if (protvaritcpt == getvaritcpt1 ())
+  if (&protvaritcpt == getvaritcpt1 ())
     {
       puts ("`protvaritcpt' in main and mod1 have same address");
       res = 1;
     }
-  if (protvaritcpt == getvaritcpt2 ())
+  if (&protvaritcpt == getvaritcpt2 ())
     {
       puts ("`protvaritcpt' in main and mod2 have same address");
       res = 1;
     }
-  if (protvaritcpt != getvaritcpt3 ())
+  if (&protvaritcpt != getvaritcpt3 ())
     {
-      puts ("`protvaritcpt' in main and mod3 have not same address");
-      res = 1;
+      printf ("&protvaritcpt in main (%p) != &protvaritcpt in mod3 (%p)\n",
+	      &protvaritcpt, getvaritcpt3 ());
+      // XXX Possibly enable once fixed.
+      // res = 1;
     }
   if (getvaritcpt1 () == getvaritcpt2 ())
     {
@@ -229,12 +235,12 @@
       puts ("`protvaritcpt in main has wrong value");
       res = 1;
     }
-  if (strcmp (getvaritcpt1 (), "vismod1.c") != 0)
+  if (strcmp (*getvaritcpt1 (), "vismod1.c") != 0)
     {
       puts ("`getvaritcpt1' returns wrong value");
       res = 1;
     }
-  if (strcmp (getvaritcpt2 (), "vismod2.c") != 0)
+  if (strcmp (*getvaritcpt2 (), "vismod2.c") != 0)
     {
       puts ("`getvaritcpt2' returns wrong value");
       res = 1;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/vismod.h libc-20030708/elf/vismod.h
--- glibc-2.3.2/elf/vismod.h	2000-12-18 02:07:45.000000000 +0900
+++ libc-20030708/elf/vismod.h	2003-04-01 21:00:53.000000000 +0900
@@ -5,21 +5,21 @@
 extern int (*getinmod1 (void)) (void);
 extern int callitcpt1 (void);
 extern int (*getitcpt1 (void)) (void);
-extern const char *getvarlocal1 (void);
-extern const char *getvarinmod1 (void);
-extern const char *getvaritcpt1 (void);
+extern const char **getvarlocal1 (void);
+extern const char **getvarinmod1 (void);
+extern const char **getvaritcpt1 (void);
 extern int calllocal2 (void);
 extern int (*getlocal2 (void)) (void);
 extern int callinmod2 (void);
 extern int (*getinmod2 (void)) (void);
 extern int callitcpt2 (void);
 extern int (*getitcpt2 (void)) (void);
-extern const char *getvarlocal2 (void);
-extern const char *getvarinmod2 (void);
-extern const char *getvaritcpt2 (void);
+extern const char **getvarlocal2 (void);
+extern const char **getvarinmod2 (void);
+extern const char **getvaritcpt2 (void);
 extern int callitcpt3 (void);
 extern int (*getitcpt3 (void)) (void);
-extern const char *getvaritcpt3 (void);
+extern const char **getvaritcpt3 (void);
 
 extern int protinmod (void);
 extern int protitcpt (void);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/vismod1.c libc-20030708/elf/vismod1.c
--- glibc-2.3.2/elf/vismod1.c	2001-07-08 04:20:53.000000000 +0900
+++ libc-20030708/elf/vismod1.c	2003-04-01 21:00:53.000000000 +0900
@@ -79,26 +79,26 @@
 const char *protvarlocal = __FILE__;
 asm (".protected protvarlocal");
 
-const char *
+const char **
 getvarlocal1 (void)
 {
-  return protvarlocal;
+  return &protvarlocal;
 }
 
 const char *protvarinmod = __FILE__;
 asm (".protected protvarinmod");
 
-const char *
+const char **
 getvarinmod1 (void)
 {
-  return protvarinmod;
+  return &protvarinmod;
 }
 
 const char *protvaritcpt = __FILE__;
 asm (".protected protvaritcpt");
 
-const char *
+const char **
 getvaritcpt1 (void)
 {
-  return protvaritcpt;
+  return &protvaritcpt;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/vismod2.c libc-20030708/elf/vismod2.c
--- glibc-2.3.2/elf/vismod2.c	2001-07-08 04:20:53.000000000 +0900
+++ libc-20030708/elf/vismod2.c	2003-04-01 21:00:53.000000000 +0900
@@ -80,28 +80,28 @@
 const char *protvarlocal = __FILE__;
 asm (".protected protvarlocal");
 
-const char *
+const char **
 getvarlocal2 (void)
 {
-  return protvarlocal;
+  return &protvarlocal;
 }
 
 const char *protvarinmod = __FILE__;
 asm (".protected protvarinmod");
 
-const char *
+const char **
 getvarinmod2 (void)
 {
-  return protvarinmod;
+  return &protvarinmod;
 }
 
 const char *protvaritcpt = __FILE__;
 asm (".protected protvaritcpt");
 
-const char *
+const char **
 getvaritcpt2 (void)
 {
-  return protvaritcpt;
+  return &protvaritcpt;
 }
 
 /* We must never call these functions.  */
@@ -117,7 +117,7 @@
   abort ();
 }
 
-const char *
+const char **
 getvaritcpt3 (void)
 {
   abort ();
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/elf/vismod3.c libc-20030708/elf/vismod3.c
--- glibc-2.3.2/elf/vismod3.c	2001-07-08 04:20:53.000000000 +0900
+++ libc-20030708/elf/vismod3.c	2003-04-01 21:00:53.000000000 +0900
@@ -40,8 +40,8 @@
 const char *protvaritcpt = __FILE__;
 asm (".protected protvaritcpt");
 
-const char *
+const char **
 getvaritcpt3 (void)
 {
-  return protvaritcpt;
+  return &protvaritcpt;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/gmon/gmon.c libc-20030708/gmon/gmon.c
--- glibc-2.3.2/gmon/gmon.c	2003-01-08 12:49:47.000000000 +0900
+++ libc-20030708/gmon/gmon.c	2003-03-16 12:22:23.000000000 +0900
@@ -213,7 +213,7 @@
   struct gmon_cg_arc_record raw_arc[NARCS_PER_WRITEV]
     __attribute__ ((aligned (__alignof__ (char*))));
   ARCINDEX from_index, to_index;
-  int from_len;
+  u_long from_len;
   u_long frompc;
   struct iovec iov[2 * NARCS_PER_WRITEV];
   int nfilled;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/gmon/mcount.c libc-20030708/gmon/mcount.c
--- glibc-2.3.2/gmon/mcount.c	2002-08-29 18:25:51.000000000 +0900
+++ libc-20030708/gmon/mcount.c	2003-03-21 16:45:54.000000000 +0900
@@ -39,7 +39,7 @@
    and MCOUNT macros.  */
 #include "machine-gmon.h"
 
-#include <atomicity.h>
+#include <atomic.h>
 
 /*
  * mcount is called on entry to each function compiled with the profiling
@@ -69,7 +69,8 @@
 	 * check that we are profiling
 	 * and that we aren't recursively invoked.
 	 */
-	if (! compare_and_swap (&p->state, GMON_PROF_ON, GMON_PROF_BUSY))
+	if (atomic_compare_and_exchange_bool_acq (&p->state, GMON_PROF_BUSY,
+						  GMON_PROF_ON))
 	  return;
 
 	/*
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/grp/grp.h libc-20030708/grp/grp.h
--- glibc-2.3.2/grp/grp.h	2001-07-08 04:20:53.000000000 +0900
+++ libc-20030708/grp/grp.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,92,95,96,97,98,99,2000,01 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1992,1995-2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -56,32 +56,57 @@
 
 
 #if defined __USE_SVID || defined __USE_BSD || defined __USE_XOPEN_EXTENDED
-/* Rewind the group-file stream.  */
-extern void setgrent (void) __THROW;
+/* Rewind the group-file stream.
 
-/* Close the group-file stream.  */
-extern void endgrent (void) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void setgrent (void);
 
-/* Read an entry from the group-file stream, opening it if necessary.  */
-extern struct group *getgrent (void) __THROW;
+/* Close the group-file stream.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void endgrent (void);
+
+/* Read an entry from the group-file stream, opening it if necessary.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct group *getgrent (void);
 #endif
 
 #ifdef	__USE_SVID
-/* Read a group entry from STREAM.  */
-extern struct group *fgetgrent (FILE *__stream) __THROW;
+/* Read a group entry from STREAM.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern struct group *fgetgrent (FILE *__stream);
 #endif
 
 #ifdef __USE_GNU
-/* Write the given entry onto the given stream.  */
+/* Write the given entry onto the given stream.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int putgrent (__const struct group *__restrict __p,
-		     FILE *__restrict __f) __THROW;
+		     FILE *__restrict __f);
 #endif
 
-/* Search for an entry with a matching group ID.  */
-extern struct group *getgrgid (__gid_t __gid) __THROW;
+/* Search for an entry with a matching group ID.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct group *getgrgid (__gid_t __gid);
+
+/* Search for an entry with a matching group name.
 
-/* Search for an entry with a matching group name.  */
-extern struct group *getgrnam (__const char *__name) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct group *getgrnam (__const char *__name);
 
 #if defined __USE_POSIX || defined __USE_MISC
 
@@ -97,32 +122,48 @@
    The interface may change in later versions of this library.  But
    the interface is designed following the principals used for the
    other reentrant functions so the chances are good this is what the
-   POSIX people would choose.  */
+   POSIX people would choose.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 
 # ifdef __USE_GNU
 extern int getgrent_r (struct group *__restrict __resultbuf,
 		       char *__restrict __buffer, size_t __buflen,
-		       struct group **__restrict __result) __THROW;
+		       struct group **__restrict __result);
 # endif
 
-/* Search for an entry with a matching group ID.  */
+/* Search for an entry with a matching group ID.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int getgrgid_r (__gid_t __gid, struct group *__restrict __resultbuf,
 		       char *__restrict __buffer, size_t __buflen,
-		       struct group **__restrict __result) __THROW;
+		       struct group **__restrict __result);
+
+/* Search for an entry with a matching group name.
 
-/* Search for an entry with a matching group name.  */
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int getgrnam_r (__const char *__restrict __name,
 		       struct group *__restrict __resultbuf,
 		       char *__restrict __buffer, size_t __buflen,
-		       struct group **__restrict __result) __THROW;
+		       struct group **__restrict __result);
 
 # ifdef	__USE_SVID
 /* Read a group entry from STREAM.  This function is not standardized
-   an probably never will.  */
+   an probably never will.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int fgetgrent_r (FILE *__restrict __stream,
 			struct group *__restrict __resultbuf,
 			char *__restrict __buffer, size_t __buflen,
-			struct group **__restrict __result) __THROW;
+			struct group **__restrict __result);
 # endif
 
 #endif	/* POSIX or reentrant */
@@ -138,14 +179,24 @@
 
 /* Store at most *NGROUPS members of the group set for USER into
    *GROUPS.  Also include GROUP.  The actual number of groups found is
-   returned in *NGROUPS.  Return -1 if the if *NGROUPS is too small.  */
+   returned in *NGROUPS.  Return -1 if the if *NGROUPS is too small.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int getgrouplist (__const char *__user, __gid_t __group,
-			 __gid_t *__groups, int *__ngroups) __THROW;
+			 __gid_t *__groups, int *__ngroups);
 
 /* Initialize the group set for the current user
    by reading the group database and using all groups
-   of which USER is a member.  Also include GROUP.  */
-extern int initgroups (__const char *__user, __gid_t __group) __THROW;
+   of which USER is a member.  Also include GROUP.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int initgroups (__const char *__user, __gid_t __group);
 
 #endif /* Use BSD.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/grp/initgroups.c libc-20030708/grp/initgroups.c
--- glibc-2.3.2/grp/initgroups.c	2002-03-14 02:49:14.000000000 +0900
+++ libc-20030708/grp/initgroups.c	2003-07-08 22:58:06.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1989,91,93,1996-2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1989,91,93,1996-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -23,6 +23,7 @@
 #include <stdlib.h>
 #include <string.h>
 #include <unistd.h>
+#include <sys/param.h>
 #include <sys/types.h>
 #include <nsswitch.h>
 
@@ -207,6 +208,9 @@
     return -1;
 
   result = internal_getgrouplist (user, group, &size, &newgroups, -1);
+
+  memcpy (groups, newgroups, MIN (*ngroups, result) * sizeof (gid_t));
+
   if (result > *ngroups)
     {
       *ngroups = result;
@@ -215,12 +219,12 @@
   else
     *ngroups = result;
 
-  memcpy (groups, newgroups, *ngroups * sizeof (gid_t));
-
   free (newgroups);
   return result;
 }
 
+static_link_warning (getgrouplist)
+
 /* Initialize the group set for the current user
    by reading the group database and using all groups
    of which USER is a member.  Also include GROUP.  */
@@ -269,3 +273,5 @@
   return result;
 #endif
 }
+
+static_link_warning (initgroups)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/Makefile libc-20030708/iconv/Makefile
--- glibc-2.3.2/iconv/Makefile	2002-11-26 10:50:58.000000000 +0900
+++ libc-20030708/iconv/Makefile	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1997, 1998, 2000, 2001, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1997,1998,2000,2001,2002,2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -35,11 +35,11 @@
 CFLAGS-gconv_simple.c = -DSTATIC_GCONV
 endif
 
-vpath %.c ../locale/programs
+vpath %.c ../locale/programs ../intl
 
 iconv_prog-modules = iconv_charmap charmap charmap-dir linereader \
 		     dummy-repertoire simple-hash xstrdup xmalloc
-iconvconfig-modules = strtab xmalloc
+iconvconfig-modules = strtab xmalloc hash-string
 extra-objs	   = $(iconv_prog-modules:=.o) $(iconvconfig-modules:=.o)
 CFLAGS-iconv_prog.c = -I../locale/programs
 CFLAGS-iconv_charmap.c = -I../locale/programs
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/gconv_cache.c libc-20030708/iconv/gconv_cache.c
--- glibc-2.3.2/iconv/gconv_cache.c	2002-12-03 06:26:09.000000000 +0900
+++ libc-20030708/iconv/gconv_cache.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Cache handling for iconv modules.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 2001.
 
@@ -19,6 +19,7 @@
    02111-1307 USA.  */
 
 #include <dlfcn.h>
+#include <errno.h>
 #include <fcntl.h>
 #include <stdlib.h>
 #include <string.h>
@@ -28,6 +29,7 @@
 
 #include <gconv_int.h>
 #include <iconvconfig.h>
+#include <not-cancel.h>
 
 #include "../intl/hash-string.h"
 
@@ -58,7 +60,7 @@
     return -1;
 
   /* See whether the cache file exists.  */
-  fd = __open (GCONV_MODULES_CACHE, O_RDONLY);
+  fd = open_not_cancel (GCONV_MODULES_CACHE, O_RDONLY, 0);
   if (__builtin_expect (fd, 0) == -1)
     /* Not available.  */
     return -1;
@@ -70,7 +72,7 @@
       || (size_t) st.st_size < sizeof (struct gconvcache_header))
     {
     close_and_exit:
-      __close (fd);
+      close_not_cancel_no_status (fd);
       return -1;
     }
 
@@ -107,7 +109,7 @@
     }
 
   /* We don't need the file descriptor anymore.  */
-  __close (fd);
+  close_not_cancel_no_status (fd);
 
   /* Check the consistency.  */
   header = (struct gconvcache_header *) gconv_cache;
@@ -157,7 +159,7 @@
   hashtab = (struct hash_entry *) ((char *) gconv_cache
 				   + header->hash_offset);
 
-  hval = hash_string (str);
+  hval = __hash_string (str);
   idx = hval % header->hash_size;
   hval2 = 1 + hval % (header->hash_size - 2);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/gconv_charset.h libc-20030708/iconv/gconv_charset.h
--- glibc-2.3.2/iconv/gconv_charset.h	2002-05-15 05:46:02.000000000 +0900
+++ libc-20030708/iconv/gconv_charset.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Charset name normalization.
-   Copyright (C) 2001,02 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 2001.
 
@@ -22,7 +22,7 @@
 #include <locale.h>
 
 
-static inline void
+static void
 strip (char *wp, const char *s)
 {
   int slash_count = 0;
@@ -48,7 +48,7 @@
 }
 
 
-static inline char * __attribute__ ((unused))
+static inline char * __attribute__ ((unused, always_inline))
 upstr (char *dst, const char *str)
 {
   char *cp = dst;
@@ -56,8 +56,3 @@
     /* nothing */;
   return dst;
 }
-
-
-/* If NAME is an codeset alias expand it.  */
-extern int __gconv_compare_alias (const char *name1, const char *name2)
-     internal_function;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/gconv_conf.c libc-20030708/iconv/gconv_conf.c
--- glibc-2.3.2/iconv/gconv_conf.c	2002-12-16 13:26:02.000000000 +0900
+++ libc-20030708/iconv/gconv_conf.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Handle configuration data.
-   Copyright (C) 1997,98,99,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997,98,99,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -125,7 +125,7 @@
 
 
 /* Add new alias.  */
-static inline void
+static void
 add_alias (char *rp, void *modules)
 {
   /* We now expect two more string.  The strings are normalized
@@ -178,7 +178,7 @@
 
 
 /* Insert a data structure for a new module in the search tree.  */
-static inline void
+static void
 internal_function
 insert_module (struct gconv_module *newp, int tobefreed)
 {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/gconv_db.c libc-20030708/iconv/gconv_db.c
--- glibc-2.3.2/iconv/gconv_db.c	2002-12-03 06:26:09.000000000 +0900
+++ libc-20030708/iconv/gconv_db.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Provide access to the collection of available transformation modules.
-   Copyright (C) 1997,98,99,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997,98,99,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -27,7 +27,6 @@
 
 #include <dlfcn.h>
 #include <gconv_int.h>
-#include <gconv_charset.h>
 
 
 /* Simple data structure for alias mapping.  We have two names, `from'
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/gconv_int.h libc-20030708/iconv/gconv_int.h
--- glibc-2.3.2/iconv/gconv_int.h	2002-12-03 06:26:09.000000000 +0900
+++ libc-20030708/iconv/gconv_int.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -262,6 +262,11 @@
 				  size_t *irreversible) attribute_hidden;
 
 
+/* If NAME is an codeset alias expand it.  */
+extern int __gconv_compare_alias (const char *name1, const char *name2)
+     internal_function;
+
+
 /* Builtin transformations.  */
 #ifdef _LIBC
 # define __BUILTIN_TRANSFORM(Name) \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/gconv_simple.c libc-20030708/iconv/gconv_simple.c
--- glibc-2.3.2/iconv/gconv_simple.c	2003-01-16 15:31:35.000000000 +0900
+++ libc-20030708/iconv/gconv_simple.c	2003-06-12 08:53:46.000000000 +0900
@@ -72,6 +72,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 internal_ucs4_loop (struct __gconv_step *step,
 		    struct __gconv_step_data *step_data,
 		    const unsigned char **inptrp, const unsigned char *inend,
@@ -113,6 +114,7 @@
 
 #ifndef _STRING_ARCH_unaligned
 static inline int
+__attribute ((always_inline))
 internal_ucs4_loop_unaligned (struct __gconv_step *step,
 			      struct __gconv_step_data *step_data,
 			      const unsigned char **inptrp,
@@ -161,6 +163,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 internal_ucs4_loop_single (struct __gconv_step *step,
 			   struct __gconv_step_data *step_data,
 			   const unsigned char **inptrp,
@@ -219,6 +222,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 ucs4_internal_loop (struct __gconv_step *step,
 		    struct __gconv_step_data *step_data,
 		    const unsigned char **inptrp, const unsigned char *inend,
@@ -283,6 +287,7 @@
 
 #ifndef _STRING_ARCH_unaligned
 static inline int
+__attribute ((always_inline))
 ucs4_internal_loop_unaligned (struct __gconv_step *step,
 			      struct __gconv_step_data *step_data,
 			      const unsigned char **inptrp,
@@ -352,6 +357,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 ucs4_internal_loop_single (struct __gconv_step *step,
 			   struct __gconv_step_data *step_data,
 			   const unsigned char **inptrp,
@@ -426,6 +432,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 internal_ucs4le_loop (struct __gconv_step *step,
 		      struct __gconv_step_data *step_data,
 		      const unsigned char **inptrp, const unsigned char *inend,
@@ -467,6 +474,7 @@
 
 #ifndef _STRING_ARCH_unaligned
 static inline int
+__attribute ((always_inline))
 internal_ucs4le_loop_unaligned (struct __gconv_step *step,
 				struct __gconv_step_data *step_data,
 				const unsigned char **inptrp,
@@ -518,6 +526,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 internal_ucs4le_loop_single (struct __gconv_step *step,
 			     struct __gconv_step_data *step_data,
 			     const unsigned char **inptrp,
@@ -573,6 +582,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 ucs4le_internal_loop (struct __gconv_step *step,
 		      struct __gconv_step_data *step_data,
 		      const unsigned char **inptrp, const unsigned char *inend,
@@ -638,6 +648,7 @@
 
 #ifndef _STRING_ARCH_unaligned
 static inline int
+__attribute ((always_inline))
 ucs4le_internal_loop_unaligned (struct __gconv_step *step,
 				struct __gconv_step_data *step_data,
 				const unsigned char **inptrp,
@@ -711,6 +722,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 ucs4le_internal_loop_single (struct __gconv_step *step,
 			     struct __gconv_step_data *step_data,
 			     const unsigned char **inptrp,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/iconv.h libc-20030708/iconv/iconv.h
--- glibc-2.3.2/iconv/iconv.h	2001-07-08 04:20:58.000000000 +0900
+++ libc-20030708/iconv/iconv.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,9 +31,11 @@
 
 
 /* Allocate descriptor for code conversion from codeset FROMCODE to
-   codeset TOCODE.  */
-extern iconv_t iconv_open (__const char *__tocode, __const char *__fromcode)
-     __THROW;
+   codeset TOCODE.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern iconv_t iconv_open (__const char *__tocode, __const char *__fromcode);
 
 /* Convert at most *INBYTESLEFT bytes from *INBUF according to the
    code conversion algorithm specified by CD and place up to
@@ -43,8 +45,11 @@
 		     char **__restrict __outbuf,
 		     size_t *__restrict __outbytesleft);
 
-/* Free resources allocated for descriptor CD for code conversion.  */
-extern int iconv_close (iconv_t __cd) __THROW;
+/* Free resources allocated for descriptor CD for code conversion.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int iconv_close (iconv_t __cd);
 
 __END_DECLS
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/iconv_prog.c libc-20030708/iconv/iconv_prog.c
--- glibc-2.3.2/iconv/iconv_prog.c	2003-02-23 04:20:07.000000000 +0900
+++ libc-20030708/iconv/iconv_prog.c	2003-04-15 23:55:45.000000000 +0900
@@ -160,14 +160,16 @@
 	  if (*errhand == '/')
 	    {
 	      --nslash;
-	      ++errhand;
+	      errhand = strchr (errhand, '\0');
 	    }
 	}
 
-      newp = (char *) alloca (errhand - to_code + nslash + 6 + 1);
+      newp = (char *) alloca (errhand - to_code + nslash + 7 + 1);
       cp = mempcpy (newp, to_code, errhand - to_code);
       while (nslash-- > 0)
 	*cp++ = '/';
+      if (cp[-1] != '/')
+	*cp++ = ',';
       memcpy (cp, "IGNORE", sizeof ("IGNORE"));
 
       to_code = newp;
@@ -496,8 +498,9 @@
 	  switch (errno)
 	    {
 	    case EILSEQ:
-	      error (0, 0, _("illegal input sequence at position %ld"),
-		     (long) (addr - start));
+	      if (! omit_invalid)
+		error (0, 0, _("illegal input sequence at position %ld"),
+		       (long int) (addr - start));
 	      break;
 	    case EINVAL:
 	      error (0, 0, _("\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/iconvconfig.c libc-20030708/iconv/iconvconfig.c
--- glibc-2.3.2/iconv/iconvconfig.c	2003-01-03 04:59:10.000000000 +0900
+++ libc-20030708/iconv/iconvconfig.c	2003-06-12 08:53:46.000000000 +0900
@@ -784,7 +784,7 @@
   newp->name = str;
   newp->strent = strent;
   newp->module_idx = -1;
-  newp->hashval = hash_string (str);
+  newp->hashval = __hash_string (str);
 
   ++nnames;
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconv/loop.c libc-20030708/iconv/loop.c
--- glibc-2.3.2/iconv/loop.c	2003-01-16 15:30:13.000000000 +0900
+++ libc-20030708/iconv/loop.c	2003-06-12 08:53:46.000000000 +0900
@@ -257,6 +257,7 @@
 
 /* The function returns the status, as defined in gconv.h.  */
 static inline int
+__attribute ((always_inline))
 FCTNAME (LOOPFCT) (struct __gconv_step *step,
 		   struct __gconv_step_data *step_data,
 		   const unsigned char **inptrp, const unsigned char *inend,
@@ -342,6 +343,7 @@
 # define SINGLE(fct) SINGLE2 (fct)
 # define SINGLE2(fct) fct##_single
 static inline int
+__attribute ((always_inline))
 SINGLE(LOOPFCT) (struct __gconv_step *step,
 		 struct __gconv_step_data *step_data,
 		 const unsigned char **inptrp, const unsigned char *inend,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/Makefile libc-20030708/iconvdata/Makefile
--- glibc-2.3.2/iconvdata/Makefile	2003-02-22 10:01:16.000000000 +0900
+++ libc-20030708/iconvdata/Makefile	2003-03-28 21:28:15.000000000 +0900
@@ -58,7 +58,7 @@
 include ../Makeconfig
 
 ifeq (yes,$(build-shared))
-tests = bug-iconv1 bug-iconv2 tst-loading tst-e2big tst-iconv4
+tests = bug-iconv1 bug-iconv2 tst-loading tst-e2big tst-iconv4 bug-iconv4
 ifeq ($(have-thread-library),yes)
 tests += bug-iconv3
 endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/bug-iconv4.c libc-20030708/iconvdata/bug-iconv4.c
--- glibc-2.3.2/iconvdata/bug-iconv4.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/iconvdata/bug-iconv4.c	2003-03-26 17:10:58.000000000 +0900
@@ -0,0 +1,78 @@
+/* Contributed by Jiro SEKIBA <jir@yamato.ibm.com>.  */
+#include <errno.h>
+#include <iconv.h>
+#include <stdbool.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+
+#define UCS_STR "\x4e\x8c" /* EUC-TW 0xa2a2, EUC-JP 0x */
+
+static const char *to_code;
+
+static bool
+xiconv (iconv_t cd, int out_size)
+{
+  unsigned char euc[4];
+  char *inp = (char *) UCS_STR;
+  char *outp = euc;
+  size_t inbytesleft = strlen (UCS_STR);
+  size_t outbytesleft = out_size;
+  size_t ret;
+  bool fail = false;
+
+  errno = 0;
+  ret = iconv (cd, &inp, &inbytesleft, &outp, &outbytesleft);
+  if (errno || ret == (size_t) -1)
+    {
+      fail = out_size == 4 || errno != E2BIG;
+      printf ("expected %d (E2BIG), got %d (%m)\n", E2BIG, errno);
+    }
+  else
+    {
+      printf ("%s: 0x%02x%02x\n", to_code, euc[0], euc[1]);
+      if (out_size == 1)
+	fail = true;
+    }
+
+  return fail;
+}
+
+
+static iconv_t
+xiconv_open (const char *code)
+{
+  iconv_t cd;
+  to_code = code;
+  errno = 0;
+  if (errno || (cd = iconv_open (to_code, "UCS-2BE")) == (iconv_t) -1)
+    {
+      puts ("Can't open converter");
+      exit (1);
+    }
+  return cd;
+}
+
+
+int
+main (void)
+{
+  iconv_t cd;
+  int result = 0;
+
+  cd = xiconv_open ("EUC-TW");
+  result |= xiconv (cd, 4) == true;
+  puts ("---");
+  result |= xiconv (cd, 1) == true;
+  puts ("---");
+  iconv_close (cd);
+
+  cd = xiconv_open ("EUC-JP");
+  result |= xiconv (cd, 4) == true;
+  puts ("---");
+  result |= xiconv (cd, 1) == true;
+  puts ("---");
+  iconv_close (cd);
+
+  return result;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/cns11643.h libc-20030708/iconvdata/cns11643.h
--- glibc-2.3.2/iconvdata/cns11643.h	2002-04-20 16:31:30.000000000 +0900
+++ libc-20030708/iconvdata/cns11643.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for CNS 11643 handling.
-   Copyright (C) 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998,1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -40,6 +40,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 cns11643_to_ucs4 (const char **s, size_t avail, unsigned char offset)
 {
   unsigned char ch = *(*s);
@@ -140,6 +141,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_cns11643 (uint32_t wch, char *s, size_t avail)
 {
   unsigned int ch = (unsigned int) wch;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/cns11643l1.h libc-20030708/iconvdata/cns11643l1.h
--- glibc-2.3.2/iconvdata/cns11643l1.h	2001-07-08 04:20:59.000000000 +0900
+++ libc-20030708/iconvdata/cns11643l1.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for CNS 11643, plane 1 handling.
-   Copyright (C) 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -26,6 +26,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 cns11643l1_to_ucs4 (const unsigned char **s, size_t avail,
 		    unsigned char offset)
 {
@@ -71,6 +72,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_cns11643l1 (uint32_t wch, unsigned char *s, size_t avail)
 {
   unsigned int ch = (unsigned int) wch;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/cns11643l2.h libc-20030708/iconvdata/cns11643l2.h
--- glibc-2.3.2/iconvdata/cns11643l2.h	2001-07-08 04:20:59.000000000 +0900
+++ libc-20030708/iconvdata/cns11643l2.h	2003-07-08 22:58:06.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for CNS 11643, plane 2 handling.
-   Copyright (C) 1998, 1999, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -26,6 +26,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 cns11643l2_to_ucs4 (const unsigned char **s, size_t avail,
 		    unsigned char offset)
 {
@@ -58,6 +59,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_cns11643l2 (uint32_t wch, unsigned char *s, size_t avail)
 {
   unsigned int ch = (unsigned int) wch;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/euc-kr.c libc-20030708/iconvdata/euc-kr.c
--- glibc-2.3.2/iconvdata/euc-kr.c	2002-12-03 06:26:10.000000000 +0900
+++ libc-20030708/iconvdata/euc-kr.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Mapping tables for EUC-KR handling.
-   Copyright (C) 1998, 1999, 2000-2002 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jungshik Shin <jshin@pantheon.yale.edu>
    and Ulrich Drepper <drepper@cygnus.com>, 1998.
@@ -25,6 +25,7 @@
 
 
 static inline void
+__attribute ((always_inline))
 euckr_from_ucs4 (uint32_t ch, unsigned char *cp)
 {
   if (ch > 0x9f)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/euc-tw.c libc-20030708/iconvdata/euc-tw.c
--- glibc-2.3.2/iconvdata/euc-tw.c	2002-12-03 06:26:10.000000000 +0900
+++ libc-20030708/iconvdata/euc-tw.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,5 +1,5 @@
 /* Mapping tables for EUC-TW handling.
-   Copyright (C) 1998, 1999, 2000-2002 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -143,7 +143,7 @@
 	if (__builtin_expect (found, 1) == 0)				      \
 	  {								      \
 	    /* We ran out of space.  */					      \
-	    result = __GCONV_INCOMPLETE_INPUT;				      \
+	    result = __GCONV_FULL_OUTPUT;				      \
 	    break;							      \
 	  }								      \
 	if (__builtin_expect (found, 1) != __UNKNOWN_10646_CHAR)	      \
@@ -160,7 +160,7 @@
 	    if (__builtin_expect (found, 1) == 0)			      \
 	      {								      \
 		/* We ran out of space.  */				      \
-		result = __GCONV_INCOMPLETE_INPUT;			      \
+		result = __GCONV_FULL_OUTPUT;				      \
 		break;							      \
 	      }								      \
 	    if (__builtin_expect (found, 0) == __UNKNOWN_10646_CHAR)	      \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/extra-module.mk libc-20030708/iconvdata/extra-module.mk
--- glibc-2.3.2/iconvdata/extra-module.mk	2001-03-18 17:02:29.000000000 +0900
+++ libc-20030708/iconvdata/extra-module.mk	2003-04-28 23:53:20.000000000 +0900
@@ -3,7 +3,8 @@
 
 extra-objs := $(extra-objs) $(patsubst %,%.os,$($(mod)-routines))
 
-$(objpfx)$(mod).so: $(addprefix $(objpfx),$(addsuffix .os,$($(mod)-routines)))
+$(objpfx)$(mod).so: $(addprefix $(objpfx),$(addsuffix .os,$($(mod)-routines)))\
+		    $(common-objpfx)shlib.lds
 	$(build-module)
 
 # Depend on libc.so so a DT_NEEDED is generated in the shared objects.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/gb2312.h libc-20030708/iconvdata/gb2312.h
--- glibc-2.3.2/iconvdata/gb2312.h	2001-07-08 04:20:59.000000000 +0900
+++ libc-20030708/iconvdata/gb2312.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for GB2312 conversion.
-   Copyright (C) 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -30,6 +30,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 gb2312_to_ucs4 (const unsigned char **s, size_t avail, unsigned char offset)
 {
   unsigned char ch = *(*s);
@@ -67,6 +68,7 @@
 extern const char __gb2312_from_ucs4_tab9[][2];
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_gb2312 (uint32_t wch, unsigned char *s, size_t avail)
 {
   unsigned int ch = (unsigned int) wch;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/gconv-modules libc-20030708/iconvdata/gconv-modules
--- glibc-2.3.2/iconvdata/gconv-modules	2003-01-14 18:32:35.000000000 +0900
+++ libc-20030708/iconvdata/gconv-modules	2003-07-08 22:58:06.000000000 +0900
@@ -393,6 +393,8 @@
 alias	ISO8859-15//		ISO-8859-15//
 alias	ISO885915//		ISO-8859-15//
 alias	ISO-IR-203//		ISO-8859-15//
+alias	ISO_8859-15//		ISO-8859-15//
+alias	LATIN-9//		ISO-8859-15//
 alias	ISO_8859-15:1998//	ISO-8859-15//
 module	ISO-8859-15//		INTERNAL		ISO8859-15	1
 module	INTERNAL		ISO-8859-15//		ISO8859-15	1
@@ -403,6 +405,8 @@
 alias	ISO-IR-226//		ISO-8859-16//
 alias	LATIN10//		ISO-8859-16//
 alias	L10//			ISO-8859-16//
+alias	ISO_8859-16:2001//	ISO-8859-16//
+alias	ISO_8859-16//		ISO-8859-16//
 module	ISO-8859-16//		INTERNAL		ISO8859-16	1
 module	INTERNAL		ISO-8859-16//		ISO8859-16	1
 
@@ -996,6 +1000,7 @@
 module	INTERNAL		IBM1046//		IBM1046		1
 
 #	from			to			module		cost
+alias	IBM-1047//		IBM1047//
 alias	CP1047//		IBM1047//
 alias	1047//			IBM1047//
 alias	OSF10020417//		IBM1047//
@@ -1122,6 +1127,8 @@
 #	from			to			module		cost
 alias	GB13000//		GBK//
 alias	CP936//			GBK//
+alias	MS936//			GBK//
+alias	WINDOWS-936//		GBK//
 module	GBK//			INTERNAL		GBK		1
 module	INTERNAL		GBK//			GBK		1
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/iso-ir-165.h libc-20030708/iconvdata/iso-ir-165.h
--- glibc-2.3.2/iconvdata/iso-ir-165.h	2001-07-08 04:21:02.000000000 +0900
+++ libc-20030708/iconvdata/iso-ir-165.h	2003-07-08 22:58:06.000000000 +0900
@@ -1,6 +1,6 @@
 /* Tables for conversion to and from ISO-IR-165.
    converting from UCS using gaps.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 2000.
 
@@ -40,6 +40,7 @@
 /* XXX If we at some point need an offset value to decode the byte
    sequences another parameter can be added.  */
 static inline uint32_t
+__attribute ((always_inline))
 isoir165_to_ucs4 (const unsigned char **s, size_t avail)
 {
   unsigned char ch = *(*s);
@@ -70,6 +71,7 @@
 extern const char __isoir165_from_tab[];
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_isoir165 (uint32_t wch, char *s, size_t avail)
 {
   unsigned int ch = (unsigned int) wch;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/jis0201.h libc-20030708/iconvdata/jis0201.h
--- glibc-2.3.2/iconvdata/jis0201.h	2001-07-08 04:21:02.000000000 +0900
+++ libc-20030708/iconvdata/jis0201.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for JISX0201 conversion.
-   Copyright (C) 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -26,6 +26,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 jisx0201_to_ucs4 (char ch)
 {
   uint32_t val = __jisx0201_to_ucs4[(unsigned char) ch];
@@ -38,6 +39,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_jisx0201 (uint32_t wch, char *s)
 {
   char ch;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/jis0208.h libc-20030708/iconvdata/jis0208.h
--- glibc-2.3.2/iconvdata/jis0208.h	2001-07-08 04:21:02.000000000 +0900
+++ libc-20030708/iconvdata/jis0208.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for JISX0208 conversion.
-   Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -43,6 +43,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 jisx0208_to_ucs4 (const unsigned char **s, size_t avail, unsigned char offset)
 {
   unsigned char ch = *(*s);
@@ -70,6 +71,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_jisx0208 (uint32_t wch, char *s, size_t avail)
 {
   unsigned int ch = (unsigned int) wch;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/jis0212.h libc-20030708/iconvdata/jis0212.h
--- glibc-2.3.2/iconvdata/jis0212.h	2001-07-08 04:21:02.000000000 +0900
+++ libc-20030708/iconvdata/jis0212.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for JISX0212 conversion.
-   Copyright (C) 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -42,6 +42,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 jisx0212_to_ucs4 (const unsigned char **s, size_t avail, unsigned char offset)
 {
   const struct jisx0212_idx *rp = __jisx0212_to_ucs_idx;
@@ -77,6 +78,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_jisx0212 (uint32_t wch, char *s, size_t avail)
 {
   const struct jisx0212_idx *rp = __jisx0212_from_ucs_idx;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/jisx0213.h libc-20030708/iconvdata/jisx0213.h
--- glibc-2.3.2/iconvdata/jisx0213.h	2002-04-20 16:41:04.000000000 +0900
+++ libc-20030708/iconvdata/jisx0213.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Functions for JISX0213 conversion.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Bruno Haible <bruno@clisp.org>, 2002.
 
@@ -32,6 +32,7 @@
 #define NELEMS(arr) (sizeof (arr) / sizeof (arr[0]))
 
 static inline uint32_t
+__attribute ((always_inline))
 jisx0213_to_ucs4 (unsigned int row, unsigned int col)
 {
   uint32_t val;
@@ -64,6 +65,7 @@
 }
 
 static inline uint16_t
+__attribute ((always_inline))
 ucs4_to_jisx0213 (uint32_t ucs)
 {
   if (ucs < NELEMS (__jisx0213_from_ucs_level1) << 6)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/ksc5601.h libc-20030708/iconvdata/ksc5601.h
--- glibc-2.3.2/iconvdata/ksc5601.h	2001-07-08 04:21:02.000000000 +0900
+++ libc-20030708/iconvdata/ksc5601.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Access functions for KS C 5601-1992 based encoding conversion.
-   Copyright (C) 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,6 +44,7 @@
 
 
 static inline uint32_t
+__attribute ((always_inline))
 ksc5601_to_ucs4 (const unsigned char **s, size_t avail, unsigned char offset)
 {
   unsigned char ch = **s;
@@ -85,6 +86,7 @@
 }
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_ksc5601_hangul (uint32_t wch, unsigned char *s, size_t avail)
 {
   int l = 0;
@@ -116,6 +118,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_ksc5601_hanja (uint32_t wch, unsigned char *s, size_t avail)
 {
   int l = 0;
@@ -146,6 +149,7 @@
 }
 
 static inline  size_t
+__attribute ((always_inline))
 ucs4_to_ksc5601_sym (uint32_t wch, unsigned char *s, size_t avail)
 {
   int l = 0;
@@ -177,6 +181,7 @@
 
 
 static inline size_t
+__attribute ((always_inline))
 ucs4_to_ksc5601 (uint32_t wch, unsigned char *s, size_t avail)
 {
   if (wch >= 0xac00 && wch <= 0xd7a3)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/testdata/IBM1160.~1~ libc-20030708/iconvdata/testdata/IBM1160.~1~
--- glibc-2.3.2/iconvdata/testdata/IBM1160.~1~	2001-09-20 14:06:15.000000000 +0900
+++ libc-20030708/iconvdata/testdata/IBM1160.~1~	1970-01-01 09:00:00.000000000 +0900
@@ -1,14 +0,0 @@
-  ! " # $ % & ' ( ) * + , - . / 0 
-1 2 3 4 5 6 7 8 9 : ; < = > ? @ A 
-B C D E F G H I J K L M N O P Q R 
-S T U V W X Y Z [ \ ] ^ _ ` a b c 
-d e f g h i j k l m n o p q r s t 
-u v w x y z { | } ~        
-                 
-                 
-                 
-                 
-                 
-                 
-                 
-   
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/iconvdata/utf-7.c libc-20030708/iconvdata/utf-7.c
--- glibc-2.3.2/iconvdata/utf-7.c	2002-06-29 04:43:39.000000000 +0900
+++ libc-20030708/iconvdata/utf-7.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Conversion module for UTF-7.
-   Copyright (C) 2000-2002 Free Software Foundation, Inc.
+   Copyright (C) 2000-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Bruno Haible <haible@clisp.cons.org>, 2000.
 
@@ -93,7 +93,7 @@
 
 
 /* Converts a value in the range 0..63 to a base64 encoded char.  */
-static inline unsigned char
+static unsigned char
 base64 (unsigned int i)
 {
   if (i < 26)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/atomic.h libc-20030708/include/atomic.h
--- glibc-2.3.2/include/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/include/atomic.h	2003-05-12 01:30:08.000000000 +0900
@@ -0,0 +1,246 @@
+/* Internal macros for atomic operations for GNU C Library.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _ATOMIC_H
+#define _ATOMIC_H	1
+
+#include <stdlib.h>
+
+#include <bits/atomic.h>
+
+/* Wrapper macros to call pre_NN_post (mem, ...) where NN is the
+   bit width of *MEM.  The calling macro puts parens around MEM
+   and following args.  */
+#define __atomic_val_bysize(pre, post, mem, ...)			      \
+  ({									      \
+    __typeof (*mem) __result;						      \
+    if (sizeof (*mem) == 1)						      \
+      __result = pre##_8_##post (mem, __VA_ARGS__);			      \
+    else if (sizeof (*mem) == 2)					      \
+      __result = pre##_16_##post (mem, __VA_ARGS__);			      \
+    else if (sizeof (*mem) == 4)					      \
+      __result = pre##_32_##post (mem, __VA_ARGS__);			      \
+    else if (sizeof (*mem) == 8)					      \
+      __result = pre##_64_##post (mem, __VA_ARGS__);			      \
+    else								      \
+      abort ();								      \
+    __result;								      \
+  })
+#define __atomic_bool_bysize(pre, post, mem, ...)			      \
+  ({									      \
+    int __result;							      \
+    if (sizeof (*mem) == 1)						      \
+      __result = pre##_8_##post (mem, __VA_ARGS__);			      \
+    else if (sizeof (*mem) == 2)					      \
+      __result = pre##_16_##post (mem, __VA_ARGS__);			      \
+    else if (sizeof (*mem) == 4)					      \
+      __result = pre##_32_##post (mem, __VA_ARGS__);			      \
+    else if (sizeof (*mem) == 8)					      \
+      __result = pre##_64_##post (mem, __VA_ARGS__);			      \
+    else								      \
+      abort ();								      \
+    __result;								      \
+  })
+
+
+/* Atomically store NEWVAL in *MEM if *MEM is equal to OLDVAL.
+   Return the old *MEM value.  */
+#if !defined atomic_compare_and_exchange_val_acq \
+    && defined __arch_compare_and_exchange_val_32_acq
+# define atomic_compare_and_exchange_val_acq(mem, newval, oldval) \
+  __atomic_val_bysize (__arch_compare_and_exchange_val,acq,		      \
+		       mem, newval, oldval)
+#endif
+
+
+#ifndef atomic_compare_and_exchange_val_rel
+# define atomic_compare_and_exchange_val_rel(mem, oldval, newval)	      \
+  atomic_compare_and_exchange_val_acq (mem, oldval, newval)
+#endif
+
+
+/* Atomically store NEWVAL in *MEM if *MEM is equal to OLDVAL.
+   Return zero if *MEM was changed or non-zero if no exchange happened.  */
+#ifndef atomic_compare_and_exchange_bool_acq
+# ifdef __arch_compare_and_exchange_bool_32_acq
+#  define atomic_compare_and_exchange_bool_acq(mem, newval, oldval) \
+  __atomic_bool_bysize (__arch_compare_and_exchange_bool,acq,		      \
+		        mem, newval, oldval)
+#  else
+#   define atomic_compare_and_exchange_bool_acq(mem, newval, oldval) \
+  ({ /* Cannot use __oldval here, because macros later in this file might     \
+	call this macro with __oldval argument.	 */			      \
+     __typeof (oldval) __old = (oldval);				      \
+     atomic_compare_and_exchange_val_acq (mem, newval, __old) != __old;	      \
+  })
+# endif
+#endif
+
+
+#ifndef atomic_compare_and_exchange_bool_rel
+# define atomic_compare_and_exchange_bool_rel(mem, oldval, newval) \
+  atomic_compare_and_exchange_bool_acq (mem, oldval, newval)
+#endif
+
+
+/* Store NEWVALUE in *MEM and return the old value.  */
+#ifndef atomic_exchange_acq
+# define atomic_exchange_acq(mem, newvalue) \
+  ({ __typeof (*(mem)) __oldval;					      \
+     __typeof (mem) __memp = (mem);					      \
+     __typeof (*(mem)) __value = (newvalue);				      \
+									      \
+     do									      \
+       __oldval = (*__memp);						      \
+     while (__builtin_expect (atomic_compare_and_exchange_bool_acq (__memp,   \
+								    __value,  \
+								    __oldval),\
+			      0));					      \
+									      \
+     __oldval; })
+#endif
+
+#ifndef atomic_exchange_rel
+# define atomic_exchange_rel(mem, newvalue) atomic_exchange_acq (mem, newvalue)
+#endif
+
+
+/* Add VALUE to *MEM and return the old value of *MEM.  */
+#ifndef atomic_exchange_and_add
+# define atomic_exchange_and_add(mem, value) \
+  ({ __typeof (*(mem)) __oldval;					      \
+     __typeof (mem) __memp = (mem);					      \
+     __typeof (*(mem)) __value = (value);				      \
+									      \
+     do									      \
+       __oldval = (*__memp);						      \
+     while (__builtin_expect (atomic_compare_and_exchange_bool_acq (__memp,   \
+								    __oldval  \
+								    + __value,\
+								    __oldval),\
+			      0));					      \
+									      \
+     __oldval; })
+#endif
+
+
+#ifndef atomic_add
+# define atomic_add(mem, value) (void) atomic_exchange_and_add ((mem), (value))
+#endif
+
+
+#ifndef atomic_increment
+# define atomic_increment(mem) atomic_add ((mem), 1)
+#endif
+
+
+/* Add one to *MEM and return true iff it's now zero.  */
+#ifndef atomic_increment_and_test
+# define atomic_increment_and_test(mem) \
+  (atomic_exchange_and_add ((mem), 1) + 1 == 0)
+#endif
+
+
+#ifndef atomic_decrement
+# define atomic_decrement(mem) atomic_add ((mem), -1)
+#endif
+
+
+/* Subtract 1 from *MEM and return true iff it's now zero.  */
+#ifndef atomic_decrement_and_test
+# define atomic_decrement_and_test(mem) \
+  (atomic_exchange_and_add ((mem), -1) == 1)
+#endif
+
+
+/* Decrement *MEM if it is > 0, and return the old value.  */
+#ifndef atomic_decrement_if_positive
+# define atomic_decrement_if_positive(mem) \
+  ({ __typeof (*(mem)) __oldval;					      \
+     __typeof (mem) __memp = (mem);					      \
+									      \
+     do									      \
+       {								      \
+	 __oldval = *__memp;						      \
+	 if (__builtin_expect (__oldval <= 0, 0))			      \
+	   break;							      \
+       }								      \
+     while (__builtin_expect (atomic_compare_and_exchange_bool_acq (__memp,   \
+								    __oldval  \
+								    - 1,      \
+								    __oldval),\
+			      0));\
+     __oldval; })
+#endif
+
+
+#ifndef atomic_add_negative
+# define atomic_add_negative(mem, value)				      \
+  ({ __typeof (value) __aan_value = (value);				      \
+     atomic_exchange_and_add (mem, __aan_value) < -__aan_value; })
+#endif
+
+
+#ifndef atomic_add_zero
+# define atomic_add_zero(mem, value)					      \
+  ({ __typeof (value) __aaz_value = (value);				      \
+     atomic_exchange_and_add (mem, __aaz_value) == -__aaz_value; })
+#endif
+
+
+#ifndef atomic_bit_set
+# define atomic_bit_set(mem, bit) \
+  (void) atomic_bit_test_set(mem, bit)
+#endif
+
+
+#ifndef atomic_bit_test_set
+# define atomic_bit_test_set(mem, bit) \
+  ({ __typeof (*(mem)) __oldval;					      \
+     __typeof (mem) __memp = (mem);					      \
+     __typeof (*(mem)) __mask = ((__typeof (*(mem))) 1 << (bit));	      \
+									      \
+     do									      \
+       __oldval = (*__memp);						      \
+     while (__builtin_expect (atomic_compare_and_exchange_bool_acq (__memp,   \
+								    __oldval  \
+								    | __mask, \
+								    __oldval),\
+			      0));					      \
+									      \
+     __oldval & __mask; })
+#endif
+
+
+#ifndef atomic_full_barrier
+# define atomic_full_barrier() __asm ("" ::: "memory")
+#endif
+
+
+#ifndef atomic_read_barrier
+# define atomic_read_barrier() atomic_full_barrier ()
+#endif
+
+
+#ifndef atomic_write_barrier
+# define atomic_write_barrier() atomic_full_barrier ()
+#endif
+
+#endif	/* atomic.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/dlfcn.h libc-20030708/include/dlfcn.h
--- glibc-2.3.2/include/dlfcn.h	2002-11-19 17:18:00.000000000 +0900
+++ libc-20030708/include/dlfcn.h	2003-03-10 18:12:11.000000000 +0900
@@ -1,5 +1,6 @@
 #ifndef _DLFCN_H
 #include <dlfcn/dlfcn.h>
+#include <link.h>		/* For ElfW.  */
 
 /* Internally used flag.  */
 #define __RTLD_DLOPEN	0x80000000
@@ -15,9 +16,12 @@
 extern int   __libc_dlclose (void *__map);
 
 /* Locate shared object containing the given address.  */
-extern int _dl_addr (const void *address, Dl_info *info)
+#ifdef ElfW
+extern int _dl_addr (const void *address, Dl_info *info,
+		     struct link_map **mapp, const ElfW(Sym) **symbolp)
      internal_function;
 libc_hidden_proto (_dl_addr)
+#endif
 
 /* Open the shared object NAME, relocate it, and run its initializer if it
    hasn't already been run.  MODE is as for `dlopen' (see <dlfcn.h>).  If
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/features.h libc-20030708/include/features.h
--- glibc-2.3.2/include/features.h	2002-11-04 18:34:54.000000000 +0900
+++ libc-20030708/include/features.h	2003-05-21 23:20:31.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1993,1995-2000,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1993,1995-2002, 2003   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -188,6 +188,10 @@
 # define __USE_POSIX199506	1
 #endif
 
+#if (_POSIX_C_SOURCE - 0) >= 200112L
+# define __USE_XOPEN2K		1
+#endif
+
 #ifdef	_XOPEN_SOURCE
 # define __USE_XOPEN	1
 # if (_XOPEN_SOURCE - 0) >= 500
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/gmp.h libc-20030708/include/gmp.h
--- glibc-2.3.2/include/gmp.h	2000-12-06 02:28:08.000000000 +0900
+++ libc-20030708/include/gmp.h	2003-03-14 14:48:18.000000000 +0900
@@ -1,3 +1,7 @@
+/* Include gmp-mparam.h first, such that definitions of _SHORT_LIMB
+   and _LONG_LONG_LIMB in it can take effect into gmp.h.  */
+#include <gmp-mparam.h>
+
 #ifndef __GMP_H__
 
 #include <stdlib/gmp.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/ifaddrs.h libc-20030708/include/ifaddrs.h
--- glibc-2.3.2/include/ifaddrs.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/include/ifaddrs.h	2003-06-12 08:53:46.000000000 +0900
@@ -0,0 +1,10 @@
+#ifndef _IFADDRS_H
+#include <inet/ifaddrs.h>
+#include <stdbool.h>
+
+libc_hidden_proto (getifaddrs)
+libc_hidden_proto (freeifaddrs)
+
+extern void __check_pf (bool *seen_ipv4, bool *seen_ipv6) attribute_hidden;
+
+#endif	/* ifaddrs.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/libc-symbols.h libc-20030708/include/libc-symbols.h
--- glibc-2.3.2/include/libc-symbols.h	2003-01-04 08:21:03.000000000 +0900
+++ libc-20030708/include/libc-symbols.h	2003-07-08 22:58:06.000000000 +0900
@@ -247,7 +247,7 @@
     __attribute__ ((unused, section (".gnu.warning." #symbol __sec_comment))) \
     = msg;
 #  define libc_freeres_ptr(decl) \
-  __make_section_unallocated ("__libc_freeres_ptrs, \"aw\", @nobits") \
+  __make_section_unallocated ("__libc_freeres_ptrs, \"aw\", %nobits") \
   decl __attribute__ ((section ("__libc_freeres_ptrs" __sec_comment)))
 #  define __libc_freeres_fn_section \
   __attribute__ ((section ("__libc_freeres_fn")))
@@ -282,6 +282,16 @@
   link_warning (name, \
 		"warning: " #name " is not implemented and will always fail")
 
+/* Warning for linking functions calling dlopen into static binaries.  */
+#ifdef SHARED
+#define static_link_warning(name)
+#else
+#define static_link_warning(name) static_link_warning1(name)
+#define static_link_warning1(name) \
+  link_warning(name, "Using '" #name "' in statically linked applications \
+requires at runtime the shared libraries from the glibc version used \
+for linking")
+#endif
 
 /* Declare SYMBOL to be TYPE (`function' or `object') and of SIZE bytes,
    when the assembler supports such declarations (such as in ELF).
@@ -345,18 +355,25 @@
    be able to use the set's contents.  */
 #  define symbol_set_define(set)	symbol_set_declare(set)
 
-/* Declare SET for use in this module, if defined in another module.  */
+/* Declare SET for use in this module, if defined in another module.
+   In a shared library, this is always local to that shared object.
+   For static linking, the set might be wholly absent and so we use
+   weak references.  */
 #  define symbol_set_declare(set) \
-  extern void *const __start_##set __attribute__ ((__weak__));		\
-  extern void *const __stop_##set __attribute__ ((__weak__));		\
-  weak_extern (__start_##set) weak_extern (__stop_##set)
+  extern char const __start_##set[] __symbol_set_attribute; \
+  extern char const __stop_##set[] __symbol_set_attribute;
+#  ifdef SHARED
+#   define __symbol_set_attribute attribute_hidden
+#  else
+#   define __symbol_set_attribute __attribute__ ((weak))
+#  endif
 
 /* Return a pointer (void *const *) to the first element of SET.  */
-#  define symbol_set_first_element(set)	(&__start_##set)
+#  define symbol_set_first_element(set)	((void *const *) (&__start_##set))
 
 /* Return true iff PTR (a void *const *) has been incremented
    past the last element in SET.  */
-#  define symbol_set_end_p(set, ptr)	((ptr) >= &__stop_##set)
+#  define symbol_set_end_p(set, ptr) ((ptr) >= (void *const *) &__stop_##set)
 
 # else	/* Not ELF: a.out.  */
 
@@ -434,7 +451,8 @@
   strong_alias(real, name)
 #endif
 
-#if defined HAVE_VISIBILITY_ATTRIBUTE && defined SHARED
+#if defined HAVE_VISIBILITY_ATTRIBUTE \
+    && (defined SHARED || defined LIBC_NONSHARED)
 # define attribute_hidden __attribute__ ((visibility ("hidden")))
 #else
 # define attribute_hidden
@@ -720,4 +738,16 @@
 # define libm_hidden_data_ver(local, name)
 #endif
 
+#ifdef HAVE_BUILTIN_REDIRECTION
+# define libc_hidden_builtin_proto(name, attrs...) libc_hidden_proto (name, ##attrs)
+# define libc_hidden_builtin_def(name) libc_hidden_def (name)
+# define libc_hidden_builtin_weak(name) libc_hidden_weak (name)
+# define libc_hidden_builtin_ver(local, name) libc_hidden_ver (local, name)
+#else
+# define libc_hidden_builtin_proto(name, attrs...)
+# define libc_hidden_builtin_def(name)
+# define libc_hidden_builtin_weak(name)
+# define libc_hidden_builtin_ver(local, name)
+#endif
+
 #endif /* libc-symbols.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/link.h libc-20030708/include/link.h
--- glibc-2.3.2/include/link.h	2002-12-03 07:36:09.000000000 +0900
+++ libc-20030708/include/link.h	2003-04-28 23:53:20.000000000 +0900
@@ -268,6 +268,9 @@
     size_t l_tls_blocksize;
     /* Alignment requirement of the TLS block.  */
     size_t l_tls_align;
+# ifndef NO_TLS_OFFSET
+#  define NO_TLS_OFFSET	0
+# endif
     /* For objects present at startup time: offset in the static TLS block.  */
     ptrdiff_t l_tls_offset;
     /* Index of the module in the dtv array.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/netdb.h libc-20030708/include/netdb.h
--- glibc-2.3.2/include/netdb.h	2003-01-01 04:14:52.000000000 +0900
+++ libc-20030708/include/netdb.h	2003-04-28 23:53:20.000000000 +0900
@@ -181,13 +181,9 @@
 libc_hidden_proto (ruserpass)
 
 
-/* The following declarations and definitions have been removed from
-   the public header since we don't want people to use them.  */
+/* The following definition has been removed from the public header
+   since we don't want people to use them.  */
 
-#define AI_V4MAPPED	0x0008	/* IPv4-mapped addresses are acceptable.  */
-#define AI_ALL		0x0010	/* Return both IPv4 and IPv6 addresses.	 */
-#define AI_ADDRCONFIG	0x0020	/* Use configuration of this host to choose
-				  returned address type.  */
 #define AI_DEFAULT    (AI_V4MAPPED | AI_ADDRCONFIG)
 
 #include <inet/netgroup.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/netinet/in.h libc-20030708/include/netinet/in.h
--- glibc-2.3.2/include/netinet/in.h	2002-08-08 11:08:13.000000000 +0900
+++ libc-20030708/include/netinet/in.h	2003-07-08 22:58:06.000000000 +0900
@@ -5,5 +5,6 @@
 libc_hidden_proto (bindresvport)
 libc_hidden_proto (in6addr_loopback)
 libc_hidden_proto (in6addr_any)
+libc_hidden_proto (inet6_option_alloc)
 
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/sched.h libc-20030708/include/sched.h
--- glibc-2.3.2/include/sched.h	2002-08-15 14:39:03.000000000 +0900
+++ libc-20030708/include/sched.h	2003-03-04 06:32:45.000000000 +0900
@@ -18,5 +18,5 @@
 extern int __clone (int (*__fn) (void *__arg), void *__child_stack,
 		    int __flags, void *__arg, ...);
 extern int __clone2 (int (*__fn) (void *__arg), void *__child_stack_base,
-		     size_t __child_stack_size, int __flags, void *__arg);
+		     size_t __child_stack_size, int __flags, void *__arg, ...);
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/set-hooks.h libc-20030708/include/set-hooks.h
--- glibc-2.3.2/include/set-hooks.h	2001-07-08 04:21:03.000000000 +0900
+++ libc-20030708/include/set-hooks.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Macros for using symbol sets for running lists of functions.
-   Copyright (C) 1994, 1995, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994, 1995, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -40,12 +40,12 @@
 /* Run all the functions hooked on the set called NAME.
    Each function is called like this: `function ARGS'.  */
 
-# define RUN_HOOK(NAME, ARGS)				\
-do {							\
-  void *const *__unbounded ptr;				\
-  for (ptr = symbol_set_first_element (NAME);		\
-       ! symbol_set_end_p (NAME, ptr); ++ptr)		\
-    (*(__##NAME##_hook_function_t *) *ptr) ARGS;	\
+# define RUN_HOOK(NAME, ARGS)						      \
+do {									      \
+  void *const *__unbounded ptr;						      \
+  for (ptr = (void *const *) symbol_set_first_element (NAME);		      \
+       ! symbol_set_end_p (NAME, ptr); ++ptr)				      \
+    (*(__##NAME##_hook_function_t *) *ptr) ARGS;			      \
 } while (0)
 
 /* Define a hook variable with NAME and PROTO, and a function called RUNNER
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/signal.h libc-20030708/include/signal.h
--- glibc-2.3.2/include/signal.h	2003-01-01 04:38:14.000000000 +0900
+++ libc-20030708/include/signal.h	2003-05-02 00:11:50.000000000 +0900
@@ -6,6 +6,8 @@
 
 libc_hidden_proto (sigemptyset)
 libc_hidden_proto (sigfillset)
+libc_hidden_proto (sigaddset)
+libc_hidden_proto (sigdelset)
 libc_hidden_proto (sigismember)
 libc_hidden_proto (__sigpause)
 libc_hidden_proto (raise)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/string.h libc-20030708/include/string.h
--- glibc-2.3.2/include/string.h	2003-01-01 07:38:31.000000000 +0900
+++ libc-20030708/include/string.h	2003-05-02 00:11:50.000000000 +0900
@@ -79,6 +79,23 @@
 libc_hidden_proto (basename)
 libc_hidden_proto (strcoll)
 
+libc_hidden_builtin_proto (memchr)
+libc_hidden_builtin_proto (memcpy)
+libc_hidden_builtin_proto (memmove)
+libc_hidden_builtin_proto (memset)
+libc_hidden_builtin_proto (strcat)
+libc_hidden_builtin_proto (strchr)
+libc_hidden_builtin_proto (strcmp)
+libc_hidden_builtin_proto (strcpy)
+libc_hidden_builtin_proto (strcspn)
+libc_hidden_builtin_proto (strlen)
+libc_hidden_builtin_proto (strncmp)
+libc_hidden_builtin_proto (strncpy)
+libc_hidden_builtin_proto (strpbrk)
+libc_hidden_builtin_proto (strrchr)
+libc_hidden_builtin_proto (strspn)
+libc_hidden_builtin_proto (strstr)
+
 # ifndef _ISOMAC
 #  ifndef index
 #   define index(s, c)	(strchr ((s), (c)))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/sys/resource.h libc-20030708/include/sys/resource.h
--- glibc-2.3.2/include/sys/resource.h	2002-08-04 13:32:39.000000000 +0900
+++ libc-20030708/include/sys/resource.h	2003-07-08 22:58:06.000000000 +0900
@@ -7,7 +7,8 @@
 /* Now define the internal interfaces.  */
 extern int __getrlimit (enum __rlimit_resource __resource,
 			struct rlimit *__rlimits);
-extern int __getrusage (enum __rusage_who __who, struct rusage *__usage);
+extern int __getrusage (enum __rusage_who __who, struct rusage *__usage)
+	attribute_hidden;
 
 extern int __setrlimit (enum __rlimit_resource __resource,
 			const struct rlimit *__rlimits);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/sys/time.h libc-20030708/include/sys/time.h
--- glibc-2.3.2/include/sys/time.h	2002-04-14 18:25:54.000000000 +0900
+++ libc-20030708/include/sys/time.h	2003-07-08 22:58:06.000000000 +0900
@@ -5,17 +5,21 @@
 extern int __gettimeofday (struct timeval *__tv,
 			   struct timezone *__tz);
 extern int __gettimeofday_internal (struct timeval *__tv,
-				    struct timezone *__tz) attribute_hidden;
+				    struct timezone *__tz)
+	attribute_hidden;
 extern int __settimeofday (__const struct timeval *__tv,
-			   __const struct timezone *__tz);
+			   __const struct timezone *__tz)
+	attribute_hidden;
 extern int __adjtime (__const struct timeval *__delta,
 		      struct timeval *__olddelta);
 extern int __getitimer (enum __itimer_which __which,
 			struct itimerval *__value);
 extern int __setitimer (enum __itimer_which __which,
 			__const struct itimerval *__restrict __new,
-			struct itimerval *__restrict __old);
-extern int __utimes (__const char *__file, const struct timeval __tvp[2]);
+			struct itimerval *__restrict __old)
+	attribute_hidden;
+extern int __utimes (__const char *__file, const struct timeval __tvp[2])
+	attribute_hidden;
 
 #ifndef NOT_IN_libc
 # define __gettimeofday(tv, tz) INTUSE(__gettimeofday) (tv, tz)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/sys/wait.h libc-20030708/include/sys/wait.h
--- glibc-2.3.2/include/sys/wait.h	2002-12-20 16:47:59.000000000 +0900
+++ libc-20030708/include/sys/wait.h	2003-07-08 22:58:06.000000000 +0900
@@ -13,5 +13,6 @@
 extern __pid_t __wait3 (__WAIT_STATUS __stat_loc,
 			int __options, struct rusage * __usage);
 extern __pid_t __wait4 (__pid_t __pid, __WAIT_STATUS __stat_loc,
-			int __options, struct rusage *__usage);
+			int __options, struct rusage *__usage)
+			attribute_hidden;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/time.h libc-20030708/include/time.h
--- glibc-2.3.2/include/time.h	2003-02-02 05:47:59.000000000 +0900
+++ libc-20030708/include/time.h	2003-07-08 22:58:06.000000000 +0900
@@ -82,5 +82,12 @@
 
 /* Determine CLK_TCK value.  */
 extern int __getclktck (void);
+
+
+/* Use in the clock_* functions.  Size of the field representing the
+   actual clock ID.  */
+#ifndef _ISOMAC
+# define CLOCK_IDFIELD_SIZE	3
+#endif
 #endif
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/tls.h libc-20030708/include/tls.h
--- glibc-2.3.2/include/tls.h	2002-12-20 05:12:03.000000000 +0900
+++ libc-20030708/include/tls.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,5 +1,8 @@
 /* This file defines USE___THREAD to 1 or 0 to cut down on the #if mess.  */
 
+#ifndef _include_tls_h
+#define _include_tls_h 1
+
 #include_next <tls.h>
 
 #if USE_TLS && HAVE___THREAD \
@@ -12,3 +15,5 @@
 # define USE___THREAD 0
 
 #endif
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/include/unistd.h libc-20030708/include/unistd.h
--- glibc-2.3.2/include/unistd.h	2003-01-01 04:14:22.000000000 +0900
+++ libc-20030708/include/unistd.h	2003-05-10 13:38:02.000000000 +0900
@@ -140,6 +140,7 @@
    and some functions contained in the C library ignore various
    environment variables that normally affect them.  */
 extern int __libc_enable_secure;
+extern int __libc_enable_secure_decided;
 #ifdef IS_IN_rtld
 /* XXX The #ifdef should go.  */
 extern int __libc_enable_secure_internal attribute_hidden;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/inet/Makefile libc-20030708/inet/Makefile
--- glibc-2.3.2/inet/Makefile	2002-12-28 19:06:33.000000000 +0900
+++ libc-20030708/inet/Makefile	2003-07-08 22:58:06.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1991-1999,2000,01,02 Free Software Foundation, Inc.
+# Copyright (C) 1991-2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -22,7 +22,7 @@
 subdir	:= inet
 
 headers	:= netinet/ether.h netinet/in.h netinet/in_systm.h \
-	   netinet/if_ether.h \
+	   netinet/if_ether.h netinet/igmp.h \
 	   netinet/tcp.h netinet/ip.h $(wildcard arpa/*.h protocols/*.h) \
 	   aliases.h ifaddrs.h netinet/ip6.h netinet/icmp6.h bits/in.h
 
@@ -45,7 +45,9 @@
 	    rcmd rexec ruserpass \
 	    getnetgrent_r getnetgrent \
 	    getaliasent_r getaliasent getaliasname getaliasname_r \
-	    in6_addr getnameinfo if_index ifaddrs
+	    in6_addr getnameinfo if_index ifaddrs inet6_option
+
+aux := check_pf ifreq
 
 tests := htontest test_ifindex tst-ntoa tst-ether_aton tst-network \
 	 tst-gethnm test-ifaddrs
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/inet/Versions libc-20030708/inet/Versions
--- glibc-2.3.2/inet/Versions	2002-07-25 17:08:18.000000000 +0900
+++ libc-20030708/inet/Versions	2003-07-08 22:58:07.000000000 +0900
@@ -70,6 +70,10 @@
     # g*
     getifaddrs;
   }
+  GLIBC_2.3.3 {
+    inet6_option_space; inet6_option_init; inet6_option_append;
+    inet6_option_alloc; inet6_option_next; inet6_option_find;
+  }
   GLIBC_PRIVATE {
     # functions used in other libraries
     __internal_endnetgrent; __internal_getnetgrent_r;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/inet/inet6_option.c libc-20030708/inet/inet6_option.c
--- glibc-2.3.2/inet/inet6_option.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/inet/inet6_option.c	2003-06-14 17:43:24.000000000 +0900
@@ -0,0 +1,343 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <assert.h>
+#include <string.h>
+#include <netinet/in.h>
+#include <netinet/ip6.h>
+#include <sys/param.h>
+
+
+static void
+internal_function
+add_pad (struct cmsghdr *cmsg, int len)
+{
+  unsigned char *p = CMSG_DATA (cmsg) + cmsg->cmsg_len - CMSG_LEN (0);
+
+  if (len == 1)
+    /* Special handling for 1, a one-byte solution.  */
+    *p++ = IP6OPT_PAD1;
+  else if (len != 0)
+    {
+      /* Multibyte padding.  */
+      *p++ = IP6OPT_PADN;
+      *p++ = len - 2;	/* Discount the two header bytes.  */
+      /* The rest is filled with zero.  */
+      memset (p, '\0', len - 2);
+      p += len - 2;
+    }
+
+  /* Account for the bytes.  */
+  cmsg->cmsg_len += len;
+}
+
+
+static int
+get_opt_end (const uint8_t **result, const uint8_t *startp,
+	     const uint8_t *endp)
+{
+  if (startp >= endp)
+    /* Out of bounds.  */
+    return -1;
+
+  if (*startp == IP6OPT_PAD1)
+    {
+      /* Just this one byte.  */
+      *result = startp + 1;
+      return 0;
+    }
+
+  /* Now we know there must be at least two bytes.  */
+  if (startp + 2 > endp
+      /* Now we can get the length byte.  */
+      || startp + startp[1] + 2 > endp)
+    return -1;
+
+  *result = startp + startp[1] + 2;
+
+  return 0;
+}
+
+
+/* RFC 2292, 6.3.1
+
+   This function returns the number of bytes required to hold an option
+   when it is stored as ancillary data, including the cmsghdr structure
+   at the beginning, and any padding at the end (to make its size a
+   multiple of 8 bytes).  The argument is the size of the structure
+   defining the option, which must include any pad bytes at the
+   beginning (the value y in the alignment term "xn + y"), the type
+   byte, the length byte, and the option data.  */
+int
+inet6_option_space (nbytes)
+     int nbytes;
+{
+  /* Add room for the extension header.  */
+  nbytes += sizeof (struct ip6_ext);
+
+  return CMSG_SPACE (roundup (nbytes, 8));
+}
+
+
+/* RFC 2292, 6.3.2
+
+   This function is called once per ancillary data object that will
+   contain either Hop-by-Hop or Destination options.  It returns 0 on
+   success or -1 on an error.  */
+int
+inet6_option_init (bp, cmsgp, type)
+     void *bp;
+     struct cmsghdr **cmsgp;
+     int type;
+{
+  /* Only Hop-by-Hop or Destination options allowed.  */
+  if (type != IPV6_HOPOPTS && type != IPV6_DSTOPTS)
+    return -1;
+
+  /* BP is a pointer to the previously allocated space.  */
+  struct cmsghdr *newp = (struct cmsghdr *) bp;
+
+  /* Initialize the message header.
+
+     Length: No data yet, only the cmsghdr struct.  */
+  newp->cmsg_len = CMSG_LEN (0);
+  /* Originating protocol: obviously IPv6.  */
+  newp->cmsg_level = IPPROTO_IPV6;
+  /* Message type.  */
+  newp->cmsg_type = type;
+
+  /* Pass up the result.  */
+  *cmsgp = newp;
+
+  return 0;
+}
+
+
+/* RFC 2292, 6.3.3
+
+   This function appends a Hop-by-Hop option or a Destination option
+   into an ancillary data object that has been initialized by
+   inet6_option_init().  This function returns 0 if it succeeds or -1 on
+   an error.  */
+int
+inet6_option_append (cmsg, typep, multx, plusy)
+     struct cmsghdr *cmsg;
+     const uint8_t *typep;
+     int multx;
+     int plusy;
+{
+  /* typep is a pointer to the 8-bit option type.  It is assumed that this
+     field is immediately followed by the 8-bit option data length field,
+     which is then followed immediately by the option data.
+
+     The option types IP6OPT_PAD1 and IP6OPT_PADN also must be handled.  */
+  int len = typep[0] == IP6OPT_PAD1 ? 1 : typep[1] + 2;
+
+  /* Get the pointer to the space in the message.  */
+  uint8_t *ptr = inet6_option_alloc (cmsg, len, multx, plusy);
+  if (ptr == NULL)
+    /* Some problem with the parameters.  */
+    return -1;
+
+  /* Copy the content.  */
+  memcpy (ptr, typep, len);
+
+  return 0;
+}
+
+
+/* RFC 2292, 6.3.4
+
+   This function appends a Hop-by-Hop option or a Destination option
+   into an ancillary data object that has been initialized by
+   inet6_option_init().  This function returns a pointer to the 8-bit
+   option type field that starts the option on success, or NULL on an
+   error.  */
+uint8_t *
+inet6_option_alloc (cmsg, datalen, multx, plusy)
+     struct cmsghdr *cmsg;
+     int datalen;
+     int multx;
+     int plusy;
+{
+  /* The RFC limits the value of the alignment values.  */
+  if ((multx != 1 && multx != 2 && multx != 4 && multx != 8)
+      || ! (plusy >= 0 && plusy <= 7))
+    return NULL;
+
+  /* Current data size.  */
+  int dsize = cmsg->cmsg_len - CMSG_LEN (0);
+
+  /* The first two bytes of the option are for the extended header.  */
+  if (__builtin_expect (dsize == 0, 0))
+    {
+      cmsg->cmsg_len += sizeof (struct ip6_ext);
+      dsize = sizeof (struct ip6_ext);
+    }
+
+  /* First add padding.  */
+  add_pad (cmsg, ((multx - (dsize & (multx - 1))) & (multx - 1)) + plusy);
+
+  /* Return the pointer to the start of the option space.  */
+  uint8_t *result = CMSG_DATA (cmsg) + cmsg->cmsg_len - CMSG_LEN (0);
+  cmsg->cmsg_len += datalen;
+
+  /* The extended option header length is measured in 8-byte groups.
+     To represent the current length we might have to add padding.  */
+  dsize = cmsg->cmsg_len - CMSG_LEN (0);
+  add_pad (cmsg, (8 - (dsize & (8 - 1))) & (8 - 1));
+
+  /* Record the new length of the option.  */
+  assert (((cmsg->cmsg_len - CMSG_LEN (0)) % 8) == 0);
+  int len8b = (cmsg->cmsg_len - CMSG_LEN (0)) / 8 - 1;
+  if (len8b >= 256)
+    /* Too long.  */
+    return NULL;
+
+  ((struct ip6_ext *) CMSG_DATA (cmsg))->ip6e_len = len8b;
+
+  return result;
+}
+libc_hidden_def (inet6_option_alloc)
+
+
+/* RFC 2292, 6.3.5
+
+   This function processes the next Hop-by-Hop option or Destination
+   option in an ancillary data object.  If another option remains to be
+   processed, the return value of the function is 0 and *tptrp points to
+   the 8-bit option type field (which is followed by the 8-bit option
+   data length, followed by the option data).  If no more options remain
+   to be processed, the return value is -1 and *tptrp is NULL.  If an
+   error occurs, the return value is -1 and *tptrp is not NULL.  */
+int
+inet6_option_next (cmsg, tptrp)
+     const struct cmsghdr *cmsg;
+     uint8_t **tptrp;
+{
+  /* Make sure it is an option of the right type.  */
+  if (cmsg->cmsg_level != IPPROTO_IPV6
+      || (cmsg->cmsg_type != IPV6_HOPOPTS && cmsg->cmsg_type != IPV6_DSTOPTS))
+    return -1;
+
+  /* Pointer to the extension header.  We only compute the address, we
+     don't access anything yet.  */
+  const struct ip6_ext *ip6e = (const struct ip6_ext *) CMSG_DATA (cmsg);
+
+  /* Make sure the message is long enough.  */
+  if (cmsg->cmsg_len < CMSG_LEN (sizeof (struct ip6_ext))
+      /* Now we can access the extension header.  */
+      || cmsg->cmsg_len < CMSG_LEN ((ip6e->ip6e_len + 1) * 8))
+    /* Too small.  */
+    return -1;
+
+  /* Determine the address of the byte past the message.  */
+  const uint8_t *endp = CMSG_DATA (cmsg) + (ip6e->ip6e_len + 1) * 8;
+
+  const uint8_t *result;
+  if (tptrp == NULL)
+    /* This is the first call, return the first option if there is one.  */
+    result = (const uint8_t *) (ip6e + 1);
+  else
+    {
+      /* Make sure *TPTRP points to a beginning of a new option in
+	 the message.  The upper limit is checked in get_opt_end.  */
+      if (*tptrp < (const uint8_t *) (ip6e + 1))
+	return -1;
+
+      /* Get the beginning of the next option.  */
+      if (get_opt_end (&result, *tptrp, endp) != 0)
+	return -1;
+    }
+
+  /* We know where the next option starts.  */
+  *tptrp = (uint8_t *) result;
+
+  /* Check the option is fully represented in the message.  */
+  return get_opt_end (&result, result, endp);
+}
+
+
+/* RFC 2292, 6.3.6
+
+   This function is similar to the previously described
+   inet6_option_next() function, except this function lets the caller
+   specify the option type to be searched for, instead of always
+   returning the next option in the ancillary data object.  cmsg is a
+   pointer to cmsghdr structure of which cmsg_level equals IPPROTO_IPV6
+   and cmsg_type equals either IPV6_HOPOPTS or IPV6_DSTOPTS.  */
+int
+inet6_option_find (cmsg, tptrp, type)
+     const struct cmsghdr *cmsg;
+     uint8_t **tptrp;
+     int type;
+{
+  /* Make sure it is an option of the right type.  */
+  if (cmsg->cmsg_level != IPPROTO_IPV6
+      || (cmsg->cmsg_type != IPV6_HOPOPTS && cmsg->cmsg_type != IPV6_DSTOPTS))
+    return -1;
+
+  /* Pointer to the extension header.  We only compute the address, we
+     don't access anything yet.  */
+  const struct ip6_ext *ip6e = (const struct ip6_ext *) CMSG_DATA (cmsg);
+
+  /* Make sure the message is long enough.  */
+  if (cmsg->cmsg_len < CMSG_LEN (sizeof (struct ip6_ext))
+      /* Now we can access the extension header.  */
+      || cmsg->cmsg_len < CMSG_LEN ((ip6e->ip6e_len + 1) * 8))
+    /* Too small.  */
+    return -1;
+
+  /* Determine the address of the byte past the message.  */
+  const uint8_t *endp = CMSG_DATA (cmsg) + (ip6e->ip6e_len + 1) * 8;
+
+  const uint8_t *next;
+  if (tptrp == NULL)
+    /* This is the first call, return the first option if there is one.  */
+    next = (const uint8_t *) (ip6e + 1);
+  else
+    {
+      /* Make sure *TPTRP points to a beginning of a new option in
+	 the message.  The upper limit is checked in get_opt_end.  */
+      if (*tptrp < (const uint8_t *) (ip6e + 1))
+	return -1;
+
+      /* Get the beginning of the next option.  */
+      if (get_opt_end (&next, *tptrp, endp) != 0)
+	return -1;
+    }
+
+  /* Now search for the appropriate typed entry.  */
+  const uint8_t *result;
+  do
+    {
+      result = next;
+
+      /* Get the end of this entry.  */
+      if (get_opt_end (&next, result, endp) != 0)
+	return -1;
+    }
+  while (*result != type);
+
+  /* We know where the next option starts.  */
+  *tptrp = (uint8_t *) result;
+
+  /* Success.  */
+  return 0;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/inet/netinet/igmp.h libc-20030708/inet/netinet/igmp.h
--- glibc-2.3.2/inet/netinet/igmp.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/inet/netinet/igmp.h	2003-05-21 23:20:32.000000000 +0900
@@ -0,0 +1,126 @@
+/* Copyright (C) 1997, 1999, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _NETINET_IGMP_H
+#define	_NETINET_IGMP_H 1
+
+#include <sys/cdefs.h>
+#include <sys/types.h>
+
+#ifdef __USE_BSD
+
+#include <netinet/in.h>
+
+__BEGIN_DECLS
+
+/*
+ * Copyright (c) 1988 Stephen Deering.
+ * Copyright (c) 1992, 1993
+ *	The Regents of the University of California.  All rights reserved.
+ *
+ * This code is derived from software contributed to Berkeley by
+ * Stephen Deering of Stanford University.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in the
+ *    documentation and/or other materials provided with the distribution.
+ * 4. Neither the name of the University nor the names of its contributors
+ *    may be used to endorse or promote products derived from this software
+ *    without specific prior written permission.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+ * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
+ * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
+ * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
+ * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
+ * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ *
+ *	@(#)igmp.h	8.1 (Berkeley) 6/10/93
+ *	$FreeBSD$
+ */
+
+struct igmp {
+  u_int8_t igmp_type;             /* IGMP type */
+  u_int8_t igmp_code;             /* routing code */
+  u_int16_t igmp_cksum;           /* checksum */
+  struct in_addr igmp_group;      /* group address */
+};
+
+#define IGMP_MINLEN			8
+
+/*
+ * Message types, including version number.
+ */
+#define IGMP_MEMBERSHIP_QUERY   	0x11	/* membership query         */
+#define IGMP_V1_MEMBERSHIP_REPORT	0x12	/* Ver. 1 membership report */
+#define IGMP_V2_MEMBERSHIP_REPORT	0x16	/* Ver. 2 membership report */
+#define IGMP_V2_LEAVE_GROUP		0x17	/* Leave-group message	    */
+
+#define IGMP_DVMRP			0x13	/* DVMRP routing message    */
+#define IGMP_PIM			0x14	/* PIM routing message      */
+#define IGMP_TRACE			0x15
+
+#define IGMP_MTRACE_RESP		0x1e	/* traceroute resp.(to sender)*/
+#define IGMP_MTRACE			0x1f	/* mcast traceroute messages  */
+
+#define IGMP_MAX_HOST_REPORT_DELAY	10	/* max delay for response to     */
+						/*  query (in seconds) according */
+						/*  to RFC1112                   */
+#define IGMP_TIMER_SCALE		10	/* denotes that the igmp code field */
+						/* specifies time in 10th of seconds*/
+
+/*
+ * States for the IGMP v2 state table.
+ */
+#define IGMP_DELAYING_MEMBER	1
+#define IGMP_IDLE_MEMBER	2
+#define IGMP_LAZY_MEMBER	3
+#define IGMP_SLEEPING_MEMBER	4
+#define IGMP_AWAKENING_MEMBER	5
+
+/*
+ * States for IGMP router version cache.
+ */
+#define IGMP_v1_ROUTER		1
+#define IGMP_v2_ROUTER		2
+
+/*
+ * The following four defininitions are for backwards compatibility.
+ * They should be removed as soon as all applications are updated to
+ * use the new constant names.
+ */
+#define IGMP_HOST_MEMBERSHIP_QUERY	IGMP_MEMBERSHIP_QUERY
+#define IGMP_HOST_MEMBERSHIP_REPORT	IGMP_V1_MEMBERSHIP_REPORT
+#define IGMP_HOST_NEW_MEMBERSHIP_REPORT	IGMP_V2_MEMBERSHIP_REPORT
+#define IGMP_HOST_LEAVE_MESSAGE		IGMP_V2_LEAVE_GROUP
+
+__END_DECLS
+
+#endif
+
+#endif	/* netinet/igmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/inet/netinet/in.h libc-20030708/inet/netinet/in.h
--- glibc-2.3.2/inet/netinet/in.h	2001-07-08 04:21:03.000000000 +0900
+++ libc-20030708/inet/netinet/in.h	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1999, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1999, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,6 +21,7 @@
 
 #include <features.h>
 #include <stdint.h>
+#include <sys/socket.h>
 #include <bits/types.h>
 
 
@@ -79,6 +80,8 @@
 #define IPPROTO_PIM		IPPROTO_PIM
     IPPROTO_COMP = 108,	   /* Compression Header Protocol.  */
 #define IPPROTO_COMP		IPPROTO_COMP
+    IPPROTO_SCTP = 132,	   /* Stream Control Transmission Protocol.  */
+#define IPPROTO_SCTP		IPPROTO_SCTP
     IPPROTO_RAW = 255,	   /* Raw IP packets.  */
 #define IPPROTO_RAW		IPPROTO_RAW
     IPPROTO_MAX
@@ -364,6 +367,23 @@
     unsigned int	ipi6_ifindex; /* send/recv interface index */
   };
 
+
+#ifdef __USE_GNU
+/* Hop-by-Hop and Destination Options Processing.  */
+extern int inet6_option_space (int __nbytes);
+extern int inet6_option_init (void *__bp, struct cmsghdr **__cmsgp,
+			      int __type);
+extern int inet6_option_append (struct cmsghdr *__cmsg,
+				__const uint8_t *__typep, int __multx,
+				int __plusy);
+extern uint8_t *inet6_option_alloc (struct cmsghdr *__cmsg, int __datalen,
+				    int __multx, int __plusy);
+extern int inet6_option_next (__const struct cmsghdr *__cmsg,
+			      uint8_t **__tptrp);
+extern int inet6_option_find (__const struct cmsghdr *__cmsg,
+			      uint8_t **__tptrp, int __type);
+#endif	/* use GNU */
+
 __END_DECLS
 
 #endif	/* netinet/in.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/inet/netinet/ip6.h libc-20030708/inet/netinet/ip6.h
--- glibc-2.3.2/inet/netinet/ip6.h	2001-07-08 04:21:03.000000000 +0900
+++ libc-20030708/inet/netinet/ip6.h	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1997, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1997, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -47,51 +47,58 @@
 #define ip6_hlim  ip6_ctlun.ip6_un1.ip6_un1_hlim
 #define ip6_hops  ip6_ctlun.ip6_un1.ip6_un1_hlim
 
+/* Generic extension header.  */
+struct ip6_ext
+  {
+    uint8_t  ip6e_nxt;		/* next header.  */
+    uint8_t  ip6e_len;		/* length in units of 8 octets.  */
+  };
+
 /* Hop-by-Hop options header.  */
 struct ip6_hbh
   {
-    uint8_t  ip6h_nxt;        /* next hesder.  */
-    uint8_t  ip6h_len;        /* length in units of 8 octets.  */
+    uint8_t  ip6h_nxt;		/* next header.  */
+    uint8_t  ip6h_len;		/* length in units of 8 octets.  */
     /* followed by options */
   };
 
 /* Destination options header */
 struct ip6_dest
   {
-    uint8_t  ip6d_nxt;        /* next header */
-    uint8_t  ip6d_len;        /* length in units of 8 octets */
+    uint8_t  ip6d_nxt;		/* next header */
+    uint8_t  ip6d_len;		/* length in units of 8 octets */
     /* followed by options */
   };
 
 /* Routing header */
 struct ip6_rthdr
   {
-    uint8_t  ip6r_nxt;        /* next header */
-    uint8_t  ip6r_len;        /* length in units of 8 octets */
-    uint8_t  ip6r_type;       /* routing type */
-    uint8_t  ip6r_segleft;    /* segments left */
+    uint8_t  ip6r_nxt;		/* next header */
+    uint8_t  ip6r_len;		/* length in units of 8 octets */
+    uint8_t  ip6r_type;		/* routing type */
+    uint8_t  ip6r_segleft;	/* segments left */
     /* followed by routing type specific data */
   };
 
 /* Type 0 Routing header */
 struct ip6_rthdr0
   {
-    uint8_t  ip6r0_nxt;       /* next header */
-    uint8_t  ip6r0_len;       /* length in units of 8 octets */
-    uint8_t  ip6r0_type;      /* always zero */
-    uint8_t  ip6r0_segleft;   /* segments left */
-    uint8_t  ip6r0_reserved;  /* reserved field */
-    uint8_t  ip6r0_slmap[3];  /* strict/loose bit map */
+    uint8_t  ip6r0_nxt;		/* next header */
+    uint8_t  ip6r0_len;		/* length in units of 8 octets */
+    uint8_t  ip6r0_type;	/* always zero */
+    uint8_t  ip6r0_segleft;	/* segments left */
+    uint8_t  ip6r0_reserved;	/* reserved field */
+    uint8_t  ip6r0_slmap[3];	/* strict/loose bit map */
     struct in6_addr  ip6r0_addr[1];  /* up to 23 addresses */
   };
 
 /* Fragment header */
 struct ip6_frag
   {
-    uint8_t   ip6f_nxt;       /* next header */
-    uint8_t   ip6f_reserved;  /* reserved field */
-    uint16_t  ip6f_offlg;     /* offset, reserved, and flag */
-    uint32_t  ip6f_ident;     /* identification */
+    uint8_t   ip6f_nxt;		/* next header */
+    uint8_t   ip6f_reserved;	/* reserved field */
+    uint16_t  ip6f_offlg;	/* offset, reserved, and flag */
+    uint32_t  ip6f_ident;	/* identification */
   };
 
 #if     BYTE_ORDER == BIG_ENDIAN
@@ -104,4 +111,8 @@
 #define IP6F_MORE_FRAG      0x0100  /* more-fragments flag */
 #endif
 
+/* Special option types for padding.  */
+#define IP6OPT_PAD1	0
+#define IP6OPT_PADN	1
+
 #endif /* netinet/ip6.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/inet/test-ifaddrs.c libc-20030708/inet/test-ifaddrs.c
--- glibc-2.3.2/inet/test-ifaddrs.c	2002-12-03 07:36:09.000000000 +0900
+++ libc-20030708/inet/test-ifaddrs.c	2003-04-01 21:00:53.000000000 +0900
@@ -69,6 +69,10 @@
 #endif
 	    case AF_UNSPEC:
 	      return "---";
+
+	    case AF_PACKET:
+	      return "<packet>";
+
 	    default:
 	      ++failures;
 	      printf ("sa_family=%d %08x\n", sa->sa_family,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/Makefile libc-20030708/intl/Makefile
--- glibc-2.3.2/intl/Makefile	2002-12-12 09:55:10.000000000 +0900
+++ libc-20030708/intl/Makefile	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1995-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -22,8 +22,8 @@
 headers = libintl.h
 routines = bindtextdom dcgettext dgettext gettext	\
 	   dcigettext dcngettext dngettext ngettext \
-	   finddomain loadmsgcat localealias textdomain	\
-	   l10nflist explodename plural plural-exp
+	   finddomain loadmsgcat localealias textdomain
+aux =	   l10nflist explodename plural plural-exp hash-string
 distribute = gmo.h gettextP.h hash-string.h loadinfo.h locale.alias \
 	     plural.y plural-exp.h po2test.sed tst-gettext.sh tst-translit.sh \
 	     translit.po tst-gettext2.sh tstlang1.po tstlang2.po tstcodeset.po\
@@ -77,7 +77,7 @@
 
 $(objpfx)msgs.h: po2test.sed ../po/de.po
 	$(make-target-directory)
-	sed -f $^ > $@
+	LC_ALL=C sed -f $^ > $@
 
 CFLAGS-tst-gettext.c = -DTESTSTRS_H=\"$(objpfx)msgs.h\"
 CFLAGS-tst-gettext2.c = -DOBJPFX=\"$(objpfx)\"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/dcigettext.c libc-20030708/intl/dcigettext.c
--- glibc-2.3.2/intl/dcigettext.c	2002-12-12 09:55:10.000000000 +0900
+++ libc-20030708/intl/dcigettext.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Implementation of the internal dcigettext function.
-   Copyright (C) 1995-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -695,7 +695,7 @@
     {
       /* Use the hashing table.  */
       nls_uint32 len = strlen (msgid);
-      nls_uint32 hash_val = hash_string (msgid);
+      nls_uint32 hash_val = __hash_string (msgid);
       nls_uint32 idx = hash_val % domain->hash_size;
       nls_uint32 incr = 1 + (hash_val % (domain->hash_size - 2));
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/hash-string.c libc-20030708/intl/hash-string.c
--- glibc-2.3.2/intl/hash-string.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/intl/hash-string.c	2003-06-12 06:46:03.000000000 +0900
@@ -0,0 +1,47 @@
+/* Implements a string hashing function.
+   Copyright (C) 1995, 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include "hash-string.h"
+
+
+/* Defines the so called `hashpjw' function by P.J. Weinberger
+   [see Aho/Sethi/Ullman, COMPILERS: Principles, Techniques and Tools,
+   1986, 1987 Bell Telephone Laboratories, Inc.]  */
+unsigned long int
+__hash_string (str_param)
+     const char *str_param;
+{
+  unsigned long int hval, g;
+  const char *str = str_param;
+
+  /* Compute the hash value for the given string.  */
+  hval = 0;
+  while (*str != '\0')
+    {
+      hval <<= 4;
+      hval += (unsigned long int) *str++;
+      g = hval & ((unsigned long int) 0xf << (HASHWORDBITS - 4));
+      if (g != 0)
+	{
+	  hval ^= g >> (HASHWORDBITS - 8);
+	  hval ^= g;
+	}
+    }
+  return hval;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/hash-string.h libc-20030708/intl/hash-string.h
--- glibc-2.3.2/intl/hash-string.h	2002-12-12 09:55:10.000000000 +0900
+++ libc-20030708/intl/hash-string.h	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Implements a string hashing function.
-   Copyright (C) 1995, 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1995, 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -34,27 +34,5 @@
 /* Defines the so called `hashpjw' function by P.J. Weinberger
    [see Aho/Sethi/Ullman, COMPILERS: Principles, Techniques and Tools,
    1986, 1987 Bell Telephone Laboratories, Inc.]  */
-static unsigned long int hash_string PARAMS ((const char *__str_param));
-
-static inline unsigned long int
-hash_string (str_param)
-     const char *str_param;
-{
-  unsigned long int hval, g;
-  const char *str = str_param;
-
-  /* Compute the hash value for the given string.  */
-  hval = 0;
-  while (*str != '\0')
-    {
-      hval <<= 4;
-      hval += (unsigned long int) *str++;
-      g = hval & ((unsigned long int) 0xf << (HASHWORDBITS - 4));
-      if (g != 0)
-	{
-	  hval ^= g >> (HASHWORDBITS - 8);
-	  hval ^= g;
-	}
-    }
-  return hval;
-}
+extern unsigned long int __hash_string PARAMS ((const char *__str_param))
+     attribute_hidden;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/loadmsgcat.c libc-20030708/intl/loadmsgcat.c
--- glibc-2.3.2/intl/loadmsgcat.c	2002-12-12 15:55:11.000000000 +0900
+++ libc-20030708/intl/loadmsgcat.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Load needed message catalogs.
-   Copyright (C) 1995-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -1209,7 +1209,7 @@
 		for (i = 0; i < n_sysdep_strings; i++)
 		  {
 		    const char *msgid = inmem_orig_sysdep_tab[i].pointer;
-		    nls_uint32 hash_val = hash_string (msgid);
+		    nls_uint32 hash_val = __hash_string (msgid);
 		    nls_uint32 idx = hash_val % domain->hash_size;
 		    nls_uint32 incr = 1 + (hash_val % (domain->hash_size - 2));
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/localealias.c libc-20030708/intl/localealias.c
--- glibc-2.3.2/intl/localealias.c	2002-11-20 12:26:47.000000000 +0900
+++ libc-20030708/intl/localealias.c	2003-07-08 22:58:07.000000000 +0900
@@ -1,5 +1,5 @@
 /* Handle aliases for locale names.
-   Copyright (C) 1995-1999, 2000,01,02 Free Software Foundation, Inc.
+   Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -243,11 +243,15 @@
       char *alias;
       char *value;
       char *cp;
+      int complete_line;
 
       if (FGETS (buf, sizeof buf, fp) == NULL)
 	/* EOF reached.  */
 	break;
 
+      /* Determine whether the line is complete.  */
+      complete_line = strchr (buf, '\n') != NULL;
+
       cp = buf;
       /* Ignore leading white space.  */
       while (isspace ((unsigned char) cp[0]))
@@ -334,11 +338,13 @@
 
       /* Possibly not the whole line fits into the buffer.  Ignore
 	 the rest of the line.  */
-      while (strchr (buf, '\n') == NULL)
-	if (FGETS (buf, sizeof buf, fp) == NULL)
-	  /* Make sure the inner loop will be left.  The outer loop
-	     will exit at the `feof' test.  */
-	  break;
+      if (! complete_line)
+	do
+	  if (FGETS (buf, sizeof buf, fp) == NULL)
+	    /* Make sure the inner loop will be left.  The outer loop
+	       will exit at the `feof' test.  */
+	    break;
+	while (strchr (buf, '\n') == NULL);
     }
 
   /* Should we test for ferror()?  I think we have to silently ignore
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/plural.c libc-20030708/intl/plural.c
--- glibc-2.3.2/intl/plural.c	2002-06-19 06:12:35.000000000 +0900
+++ libc-20030708/intl/plural.c	2003-05-02 00:11:50.000000000 +0900
@@ -51,6 +51,7 @@
 
 #include <stddef.h>
 #include <stdlib.h>
+#include <string.h>
 #include "plural-exp.h"
 
 /* The main function generated by the parser is called __gettextparse,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/plural.y libc-20030708/intl/plural.y
--- glibc-2.3.2/intl/plural.y	2002-03-11 17:32:00.000000000 +0900
+++ libc-20030708/intl/plural.y	2003-05-02 00:11:50.000000000 +0900
@@ -32,6 +32,7 @@
 
 #include <stddef.h>
 #include <stdlib.h>
+#include <string.h>
 #include "plural-exp.h"
 
 /* The main function generated by the parser is called __gettextparse,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/intl/po2test.sed libc-20030708/intl/po2test.sed
--- glibc-2.3.2/intl/po2test.sed	2000-01-22 14:43:54.000000000 +0900
+++ libc-20030708/intl/po2test.sed	2003-04-01 21:00:54.000000000 +0900
@@ -1,5 +1,5 @@
 # po2test.sed - Convert Uniforum style .po file to C code for testing.
-# Copyright (C) 2000 Free Software Foundation, Inc.
+# Copyright (C) 2000,2003 Free Software Foundation, Inc.
 # Ulrich Drepper <drepper@cygnus.com>, 2000.
 #
 # This program is free software; you can redistribute it and/or modify
@@ -16,55 +16,37 @@
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
 #
+
 #
 # We copy the original message as a comment into the .msg file.  But enclose
 # them with INPUT ( ).
 #
-/^msgid/ {
-  s/msgid[ 	]*"\(.*\)"/INPUT ("\1")/
-# Clear flag from last substitution.
-  tb
-# Append the next line.
-  :b
-  N
-# Look whether second part is a continuation line.
-  s/\(.*\)")\(\n\)"\(.*\)"/\1\\\2\3")/
-# Yes, then branch.
-  ta
-  P
-  D
-# Note that `D' includes a jump to the start!!
-# We found a continuation line.  But before printing insert '\'.
-  :a
-  s/\(.*\)")\(\n.*\)/\1\\\2/
-  P
-# We cannot use the sed command `D' here
-  s/.*\n\(.*\)/\1/
-  tb
-}
+s/^msgid[ 	]*"\(.*\)"/INPUT ("\1")/
+# Clear flag from last substitution and jump if matching
+tb
+
 #
 # Copy the translations as well and enclose them with OUTPUT ( ).
 #
-/^msgstr/ {
-  s/msgstr[ 	]*"\(.*\)"/OUTPUT ("\1")/
-# Clear flag from last substitution.
-  tb
+s/^msgstr[ 	]*"\(.*\)"/OUTPUT ("\1")/
+# Clear flag from last substitution and jump if matching
+tb
+
+d
+
+:b
 # Append the next line.
-  :b
-  N
-# Look whether second part is a continuation line.
-  s/\(.*\)")\(\n\)"\(.*\)"/\1\\\2\3")/
-# Yes, then branch.
-  ta
-  P
-  D
-# Note that `D' includes a jump to the start!!
-# We found a continuation line.  But before printing insert '\'.
-  :a
-  s/\(.*\)")\(\n.*\)/\1\\\2/
-  P
+$!N
+# Check whether second part is a continuation line.  If so, before printing
+# insert '\'.
+s/\(.*\)")\(\n\)"\(.*\)"/\1\\\2\3")/
+P
+ta
+# No, go to the top and process it. Note that `D' includes a jump to the start!!
+D
+# Yes, we found a continuation line.
+:a
 # We cannot use the sed command `D' here
-  s/.*\n\(.*\)/\1/
-  tb
-}
-d
+s/[^\n]*\n//
+# Clear the substitution flag and do the next line.
+tb
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/io/Makefile libc-20030708/io/Makefile
--- glibc-2.3.2/io/Makefile	2002-10-23 15:21:16.000000000 +0900
+++ libc-20030708/io/Makefile	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1992-1999,2000,01,02 Free Software Foundation, Inc.
+# Copyright (C) 1992-2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -64,6 +64,10 @@
 include ../Rules
 
 CFLAGS-fts.c = -Wno-uninitialized
+CFLAGS-fcntl.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-poll.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-lockf.c = -fexceptions
+
 CFLAGS-test-stat.c = -D_FILE_OFFSET_BITS=64 -D_LARGEFILE64_SOURCE
 CFLAGS-test-lfs.c = -D_LARGEFILE64_SOURCE
 
@@ -83,5 +87,6 @@
 tests: $(objpfx)ftwtest.out
 
 $(objpfx)ftwtest.out: $(objpfx)ftwtest
-	$(SHELL) -e ftwtest-sh $(common-objpfx) $(<D)/$(<F) > $@
+	$(SHELL) -e ftwtest-sh $(shell cd $(common-objpfx). && pwd)/ \
+		 $(shell cd $(<D) && pwd)/$(<F) > $@
 endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/io/fcntl.h libc-20030708/io/fcntl.h
--- glibc-2.3.2/io/fcntl.h	2001-07-08 04:21:03.000000000 +0900
+++ libc-20030708/io/fcntl.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,92,94,95,96,97,98,99,2000,2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1992,1994-2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -56,41 +56,48 @@
 #endif	/* XPG */
 
 /* Do the file control operation described by CMD on FD.
-   The remaining arguments are interpreted depending on CMD.  */
-extern int fcntl (int __fd, int __cmd, ...) __THROW;
+   The remaining arguments are interpreted depending on CMD.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int fcntl (int __fd, int __cmd, ...);
 
 /* Open FILE and return a new file descriptor for it, or -1 on error.
    OFLAG determines the type of access used.  If O_CREAT is on OFLAG,
-   the third argument is taken as a `mode_t', the mode of the created file.  */
+   the third argument is taken as a `mode_t', the mode of the created file.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 #ifndef __USE_FILE_OFFSET64
-extern int open (__const char *__file, int __oflag, ...) __THROW;
+extern int open (__const char *__file, int __oflag, ...);
 #else
 # ifdef __REDIRECT
-extern int __REDIRECT (open, (__const char *__file, int __oflag, ...) __THROW,
-		       open64);
+extern int __REDIRECT (open, (__const char *__file, int __oflag, ...), open64);
 # else
 #  define open open64
 # endif
 #endif
 #ifdef __USE_LARGEFILE64
-extern int open64 (__const char *__file, int __oflag, ...) __THROW;
+extern int open64 (__const char *__file, int __oflag, ...);
 #endif
 
-/* Create and open FILE, with mode MODE.
-   This takes an `int' MODE argument because that is
-   what `mode_t' will be widened to.  */
+/* Create and open FILE, with mode MODE.  This takes an `int' MODE
+   argument because that is what `mode_t' will be widened to.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 #ifndef __USE_FILE_OFFSET64
-extern int creat (__const char *__file, __mode_t __mode) __THROW;
+extern int creat (__const char *__file, __mode_t __mode);
 #else
 # ifdef __REDIRECT
-extern int __REDIRECT (creat, (__const char *__file, __mode_t __mode) __THROW,
+extern int __REDIRECT (creat, (__const char *__file, __mode_t __mode),
 		       creat64);
 # else
 #  define creat creat64
 # endif
 #endif
 #ifdef __USE_LARGEFILE64
-extern int creat64 (__const char *__file, __mode_t __mode) __THROW;
+extern int creat64 (__const char *__file, __mode_t __mode);
 #endif
 
 #if !defined F_LOCK && (defined __USE_MISC || (defined __USE_XOPEN_EXTENDED \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/io/fts.c libc-20030708/io/fts.c
--- glibc-2.3.2/io/fts.c	2002-04-08 16:02:07.000000000 +0900
+++ libc-20030708/io/fts.c	2003-03-16 10:03:52.000000000 +0900
@@ -581,8 +581,9 @@
 	FTSENT *cur, *tail;
 	DIR *dirp;
 	void *oldaddr;
-	int cderrno, descend, len, level, maxlen, nlinks, saved_errno,
+	int cderrno, descend, len, level, nlinks, saved_errno,
 	    nostat, doadjust;
+	size_t maxlen;
 	char *cp;
 
 	/* Set current node pointer. */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/io/ftw.c libc-20030708/io/ftw.c
--- glibc-2.3.2/io/ftw.c	2003-02-09 03:25:54.000000000 +0900
+++ libc-20030708/io/ftw.c	2003-06-12 08:53:46.000000000 +0900
@@ -258,6 +258,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 open_dir_stream (struct ftw_data *data, struct dir_data *dirp)
 {
   int result = 0;
@@ -348,7 +349,8 @@
 }
 
 
-static inline int
+static int
+internal_function
 process_entry (struct ftw_data *data, struct dir_data *dir, const char *name,
 	       size_t namlen)
 {
@@ -482,17 +484,6 @@
     {
       if (__fchdir (dirfd (dir.stream)) < 0)
 	{
-	  if (errno == ENOSYS)
-	    {
-	      if (__chdir (data->dirbuf) < 0)
-		result = -1;
-	    }
-	  else
-	    result = -1;
-	}
-
-      if (result != 0)
-	{
 	  int save_err = errno;
 	  __closedir (dir.stream);
 	  __set_errno (save_err);
@@ -501,7 +492,7 @@
 	    data->actdir = data->maxdir - 1;
 	  data->dirstreams[data->actdir] = NULL;
 
-	  return result;
+	  return -1;
 	}
     }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/io/ftw.h libc-20030708/io/ftw.h
--- glibc-2.3.2/io/ftw.h	2001-07-08 04:21:03.000000000 +0900
+++ libc-20030708/io/ftw.h	2003-04-28 23:53:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1992, 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1992,1996,1997,1998,1999,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -103,40 +103,45 @@
 # endif
 #endif
 
-/* Call a function on every element in a directory tree.  */
+/* Call a function on every element in a directory tree.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 #ifndef __USE_FILE_OFFSET64
-extern int ftw (__const char *__dir, __ftw_func_t __func, int __descriptors)
-     __THROW;
+extern int ftw (__const char *__dir, __ftw_func_t __func, int __descriptors);
 #else
 # ifdef __REDIRECT
 extern int __REDIRECT (ftw, (__const char *__dir, __ftw_func_t __func,
-			     int __descriptors) __THROW, ftw64);
+			     int __descriptors), ftw64);
 # else
 #  define ftw ftw64
 # endif
 #endif
 #ifdef __USE_LARGEFILE64
 extern int ftw64 (__const char *__dir, __ftw64_func_t __func,
-		  int __descriptors) __THROW;
+		  int __descriptors);
 #endif
 
 #ifdef __USE_XOPEN_EXTENDED
 /* Call a function on every element in a directory tree.  FLAG allows
-   to specify the behaviour more detailed.  */
+   to specify the behaviour more detailed.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 # ifndef __USE_FILE_OFFSET64
 extern int nftw (__const char *__dir, __nftw_func_t __func, int __descriptors,
-		 int __flag) __THROW;
+		 int __flag);
 # else
 #  ifdef __REDIRECT
 extern int __REDIRECT (nftw, (__const char *__dir, __nftw_func_t __func,
-			      int __descriptors, int __flag) __THROW, nftw64);
+			      int __descriptors, int __flag), nftw64);
 #  else
 #   define nftw nftw64
 #  endif
 # endif
 # ifdef __USE_LARGEFILE64
 extern int nftw64 (__const char *__dir, __nftw64_func_t __func,
-		   int __descriptors, int __flag) __THROW;
+		   int __descriptors, int __flag);
 # endif
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/io/test-utime.c libc-20030708/io/test-utime.c
--- glibc-2.3.2/io/test-utime.c	2002-12-12 18:24:33.000000000 +0900
+++ libc-20030708/io/test-utime.c	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1994, 1996, 1997, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1994,1996,1997,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -112,7 +112,12 @@
       return 1;
     }
 
-  if (stnow.st_mtime < now1 || stnow.st_mtime > now2)
+#ifdef _STATBUF_ST_NSEC
+# define CORR (stnow.st_mtim.tv_nsec == 0 ? 0 : 1)
+#else
+# define CORR 0
+#endif
+  if (stnow.st_mtime + CORR < now1 || stnow.st_mtime > now2)
     {
       printf ("modtime %ld <%ld >%ld\n", stnow.st_mtime, now1, now2);
       return 1;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/bits/stdio.h libc-20030708/libio/bits/stdio.h
--- glibc-2.3.2/libio/bits/stdio.h	2001-08-03 08:39:43.000000000 +0900
+++ libc-20030708/libio/bits/stdio.h	2003-05-12 01:30:08.000000000 +0900
@@ -31,14 +31,14 @@
 #ifdef __USE_EXTERN_INLINES
 /* Write formatted output to stdout from argument list ARG.  */
 __STDIO_INLINE int
-vprintf (__const char *__restrict __fmt, _G_va_list __arg) __THROW
+vprintf (__const char *__restrict __fmt, _G_va_list __arg)
 {
   return vfprintf (stdout, __fmt, __arg);
 }
 
 /* Read a character from stdin.  */
 __STDIO_INLINE int
-getchar (void) __THROW
+getchar (void)
 {
   return _IO_getc (stdin);
 }
@@ -47,14 +47,14 @@
 # if defined __USE_POSIX || defined __USE_MISC
 /* This is defined in POSIX.1:1996.  */
 __STDIO_INLINE int
-getc_unlocked (FILE *__fp) __THROW
+getc_unlocked (FILE *__fp)
 {
   return _IO_getc_unlocked (__fp);
 }
 
 /* This is defined in POSIX.1:1996.  */
 __STDIO_INLINE int
-getchar_unlocked (void) __THROW
+getchar_unlocked (void)
 {
   return _IO_getc_unlocked (stdin);
 }
@@ -63,7 +63,7 @@
 
 /* Write a character to stdout.  */
 __STDIO_INLINE int
-putchar (int __c) __THROW
+putchar (int __c)
 {
   return _IO_putc (__c, stdout);
 }
@@ -72,7 +72,7 @@
 # ifdef __USE_MISC
 /* Faster version when locking is not necessary.  */
 __STDIO_INLINE int
-fputc_unlocked (int __c, FILE *__stream) __THROW
+fputc_unlocked (int __c, FILE *__stream)
 {
   return _IO_putc_unlocked (__c, __stream);
 }
@@ -82,14 +82,14 @@
 # if defined __USE_POSIX || defined __USE_MISC
 /* This is defined in POSIX.1:1996.  */
 __STDIO_INLINE int
-putc_unlocked (int __c, FILE *__stream) __THROW
+putc_unlocked (int __c, FILE *__stream)
 {
   return _IO_putc_unlocked (__c, __stream);
 }
 
 /* This is defined in POSIX.1:1996.  */
 __STDIO_INLINE int
-putchar_unlocked (int __c) __THROW
+putchar_unlocked (int __c)
 {
   return _IO_putc_unlocked (__c, stdout);
 }
@@ -99,7 +99,7 @@
 # ifdef	__USE_GNU
 /* Like `getdelim', but reads up to a newline.  */
 __STDIO_INLINE _IO_ssize_t
-getline (char **__lineptr, size_t *__n, FILE *__stream) __THROW
+getline (char **__lineptr, size_t *__n, FILE *__stream)
 {
   return __getdelim (__lineptr, __n, '\n', __stream);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/fileops.c libc-20030708/libio/fileops.c
--- glibc-2.3.2/libio/fileops.c	2003-01-08 14:18:32.000000000 +0900
+++ libc-20030708/libio/fileops.c	2003-06-12 08:53:46.000000000 +0900
@@ -63,6 +63,7 @@
 # define read(FD, Buf, NBytes) __read (FD, Buf, NBytes)
 # define write(FD, Buf, NBytes) __write (FD, Buf, NBytes)
 # define _IO_do_write _IO_new_do_write /* For macro uses.  */
+# define _IO_file_close_it _IO_new_file_close_it
 #else
 # define _IO_new_do_write _IO_do_write
 # define _IO_new_file_attach _IO_file_attach
@@ -214,9 +215,6 @@
 }
 INTDEF2(_IO_new_file_finish, _IO_file_finish)
 
-#if defined __GNUC__ && __GNUC__ >= 2
-__inline__
-#endif
 _IO_FILE *
 _IO_file_open (fp, filename, posix_mode, prot, read_write, is32not64)
      _IO_FILE *fp;
@@ -353,6 +351,7 @@
 	      /* Something went wrong, we cannot load the conversion modules.
 		 This means we cannot proceed since the user explicitly asked
 		 for these.  */
+	      (void) INTUSE(_IO_file_close_it) (fp);
 	      __set_errno (EINVAL);
 	      return NULL;
 	    }
@@ -397,10 +396,6 @@
 
 	  /* Set the mode now.  */
 	  result->_mode = 1;
-
-	  /* We don't need the step data structure anymore.  */
-	  __gconv_release_cache (fcts.towc, fcts.towc_nsteps);
-	  __gconv_release_cache (fcts.tomb, fcts.tomb_nsteps);
 	}
     }
 #endif	/* GNU libc */
@@ -456,7 +451,7 @@
   _IO_FILE *result;
 
   /* Change the function table.  */
-  _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &INTUSE(_IO_file_jumps);
+  _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &_IO_file_jumps;
   fp->_wide_data->_wide_vtable = &_IO_wfile_jumps;
 
   /* And perform the normal operation.  */
@@ -708,7 +703,7 @@
       fp->_IO_buf_base = fp->_IO_buf_end = NULL;
       _IO_setg (fp, NULL, NULL, NULL);
       if (fp->_mode <= 0)
-	_IO_JUMPS ((struct _IO_FILE_plus *) fp) = &INTUSE(_IO_file_jumps);
+	_IO_JUMPS ((struct _IO_FILE_plus *) fp) = &_IO_file_jumps;
       else
 	_IO_JUMPS ((struct _IO_FILE_plus *) fp) = &_IO_wfile_jumps;
       fp->_wide_data->_wide_vtable = &_IO_wfile_jumps;
@@ -801,7 +796,7 @@
   /* We couldn't use mmap, so revert to the vanilla file operations.  */
 
   if (fp->_mode <= 0)
-    _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &INTUSE(_IO_file_jumps);
+    _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &_IO_file_jumps;
   else
     _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &_IO_wfile_jumps;
   fp->_wide_data->_wide_vtable = &_IO_wfile_jumps;
@@ -1548,6 +1543,7 @@
 
 #ifdef _LIBC
 # undef _IO_do_write
+# undef _IO_file_close_it
 versioned_symbol (libc, _IO_new_do_write, _IO_do_write, GLIBC_2_1);
 versioned_symbol (libc, _IO_new_file_attach, _IO_file_attach, GLIBC_2_1);
 versioned_symbol (libc, _IO_new_file_close_it, _IO_file_close_it, GLIBC_2_1);
@@ -1586,7 +1582,7 @@
   JUMP_INIT(showmanyc, _IO_default_showmanyc),
   JUMP_INIT(imbue, _IO_default_imbue)
 };
-INTVARDEF(_IO_file_jumps)
+libc_hidden_data_def (_IO_file_jumps)
 
 struct _IO_jump_t _IO_file_jumps_mmap =
 {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/freopen.c libc-20030708/libio/freopen.c
--- glibc-2.3.2/libio/freopen.c	2002-10-03 17:11:25.000000000 +0900
+++ libc-20030708/libio/freopen.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1993,95,96,97,98,2000,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993,95,96,97,98,2000,2001,2002,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -67,9 +68,9 @@
 #endif
     {
       INTUSE(_IO_file_close_it) (fp);
-      _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &INTUSE(_IO_file_jumps);
+      _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &_IO_file_jumps;
       if (fp->_vtable_offset == 0 && fp->_wide_data != NULL)
-	fp->_wide_data->_wide_vtable = &INTUSE(_IO_wfile_jumps);
+	fp->_wide_data->_wide_vtable = &_IO_wfile_jumps;
       result = INTUSE(_IO_file_fopen) (fp, filename, mode, 1);
       if (result != NULL)
 	result = __fopen_maybe_mmap (result);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/freopen64.c libc-20030708/libio/freopen64.c
--- glibc-2.3.2/libio/freopen64.c	2002-10-03 17:11:32.000000000 +0900
+++ libc-20030708/libio/freopen64.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993,1995,1996,1997,1998,2000,2001,2002
+/* Copyright (C) 1993,1995,1996,1997,1998,2000,2001,2002, 2003
    Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
@@ -53,9 +53,9 @@
 	filename = fd_to_filename (fd);
     }
   INTUSE(_IO_file_close_it) (fp);
-  _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &INTUSE(_IO_file_jumps);
+  _IO_JUMPS ((struct _IO_FILE_plus *) fp) = &_IO_file_jumps;
   if (fp->_vtable_offset == 0 && fp->_wide_data != NULL)
-    fp->_wide_data->_wide_vtable = &INTUSE(_IO_wfile_jumps);
+    fp->_wide_data->_wide_vtable = &_IO_wfile_jumps;
   result = INTUSE(_IO_file_fopen) (fp, filename, mode, 0);
   if (result != NULL)
     result = __fopen_maybe_mmap (result);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/genops.c libc-20030708/libio/genops.c
--- glibc-2.3.2/libio/genops.c	2003-01-08 14:22:10.000000000 +0900
+++ libc-20030708/libio/genops.c	2003-05-10 13:38:02.000000000 +0900
@@ -602,12 +602,9 @@
 INTDEF(_IO_init)
 
 void
-_IO_no_init (fp, flags, orientation, wd, jmp)
+_IO_old_init (fp, flags)
      _IO_FILE *fp;
      int flags;
-     int orientation;
-     struct _IO_wide_data *wd;
-     struct _IO_jump_t *jmp;
 {
   fp->_flags = _IO_MAGIC|flags;
   fp->_flags2 = 0;
@@ -633,6 +630,17 @@
   if (fp->_lock != NULL)
     _IO_lock_init (*fp->_lock);
 #endif
+}
+
+void
+_IO_no_init (fp, flags, orientation, wd, jmp)
+     _IO_FILE *fp;
+     int flags;
+     int orientation;
+     struct _IO_wide_data *wd;
+     struct _IO_jump_t *jmp;
+{
+  _IO_old_init (fp, flags);
   fp->_mode = orientation;
 #if defined _LIBC || defined _GLIBCPP_USE_WCHAR_T
   if (orientation >= 0)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/iofdopen.c libc-20030708/libio/iofdopen.c
--- glibc-2.3.2/libio/iofdopen.c	2002-08-30 15:56:29.000000000 +0900
+++ libc-20030708/libio/iofdopen.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1993,1994,1997-1999,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993,1994,1997,1998,1999,2000,2002,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -152,12 +153,12 @@
 	       (use_mmap && (read_write & _IO_NO_WRITES))
 	       ? &_IO_wfile_jumps_maybe_mmap :
 #endif
-	       &INTUSE(_IO_wfile_jumps));
+	       &_IO_wfile_jumps);
   _IO_JUMPS (&new_f->fp) =
 #ifdef _G_HAVE_MMAP
     (use_mmap && (read_write & _IO_NO_WRITES)) ? &_IO_file_jumps_maybe_mmap :
 #endif
-      &INTUSE(_IO_file_jumps);
+      &_IO_file_jumps;
   INTUSE(_IO_file_init) (&new_f->fp);
 #if  !_IO_UNIFIED_JUMPTABLES
   new_f->fp.vtable = NULL;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/iofopen.c libc-20030708/libio/iofopen.c
--- glibc-2.3.2/libio/iofopen.c	2002-08-30 15:45:05.000000000 +0900
+++ libc-20030708/libio/iofopen.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1993,1997,1998,1999,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993,1997,1998,1999,2000,2002,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -80,11 +81,11 @@
   new_f->fp.file._lock = &new_f->lock;
 #endif
 #if defined _LIBC || defined _GLIBCPP_USE_WCHAR_T
-  _IO_no_init (&new_f->fp.file, 0, 0, &new_f->wd, &INTUSE(_IO_wfile_jumps));
+  _IO_no_init (&new_f->fp.file, 0, 0, &new_f->wd, &_IO_wfile_jumps);
 #else
   _IO_no_init (&new_f->fp.file, 1, 0, NULL, NULL);
 #endif
-  _IO_JUMPS (&new_f->fp) = &INTUSE(_IO_file_jumps);
+  _IO_JUMPS (&new_f->fp) = &_IO_file_jumps;
   INTUSE(_IO_file_init) (&new_f->fp);
 #if  !_IO_UNIFIED_JUMPTABLES
   new_f->fp.vtable = NULL;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/iovdprintf.c libc-20030708/libio/iovdprintf.c
--- glibc-2.3.2/libio/iovdprintf.c	2002-08-03 06:46:58.000000000 +0900
+++ libc-20030708/libio/iovdprintf.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1997-2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1997-2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,8 +41,8 @@
 #ifdef _IO_MTSAFE_IO
   tmpfil.file._lock = NULL;
 #endif
-  _IO_no_init (&tmpfil.file, _IO_USER_LOCK, 0, &wd, &INTUSE(_IO_wfile_jumps));
-  _IO_JUMPS (&tmpfil) = &INTUSE(_IO_file_jumps);
+  _IO_no_init (&tmpfil.file, _IO_USER_LOCK, 0, &wd, &_IO_wfile_jumps);
+  _IO_JUMPS (&tmpfil) = &_IO_file_jumps;
   INTUSE(_IO_file_init) (&tmpfil);
 #if  !_IO_UNIFIED_JUMPTABLES
   tmpfil.vtable = NULL;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/iovsprintf.c libc-20030708/libio/iovsprintf.c
--- glibc-2.3.2/libio/iovsprintf.c	2002-02-25 16:01:40.000000000 +0900
+++ libc-20030708/libio/iovsprintf.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1997-2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993, 1997-2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -42,7 +42,7 @@
 #endif
   _IO_no_init (&sf._sbf._f, _IO_USER_LOCK, -1, NULL, NULL);
   _IO_JUMPS ((struct _IO_FILE_plus *) &sf._sbf) = &_IO_str_jumps;
-  INTUSE(_IO_str_init_static) (&sf, string, -1, string);
+  _IO_str_init_static_internal (&sf, string, -1, string);
   ret = INTUSE(_IO_vfprintf) ((_IO_FILE *) &sf._sbf, format, args);
   _IO_putc_unlocked ('\0', (_IO_FILE *) &sf._sbf);
   return ret;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/iovsscanf.c libc-20030708/libio/iovsscanf.c
--- glibc-2.3.2/libio/iovsscanf.c	2002-02-25 15:59:37.000000000 +0900
+++ libc-20030708/libio/iovsscanf.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1997-2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993, 1997-2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,7 +41,7 @@
 #endif
   _IO_no_init (&sf._sbf._f, _IO_USER_LOCK, -1, NULL, NULL);
   _IO_JUMPS ((struct _IO_FILE_plus *) &sf._sbf) = &_IO_str_jumps;
-  INTUSE(_IO_str_init_static) (&sf, (char*)string, 0, NULL);
+  _IO_str_init_static_internal (&sf, (char*)string, 0, NULL);
   ret = INTUSE(_IO_vfscanf) ((_IO_FILE *) &sf._sbf, format, args, NULL);
   return ret;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/libioP.h libc-20030708/libio/libioP.h
--- glibc-2.3.2/libio/libioP.h	2003-01-08 14:18:05.000000000 +0900
+++ libc-20030708/libio/libioP.h	2003-06-12 08:53:46.000000000 +0900
@@ -450,9 +450,11 @@
 extern void _IO_default_imbue __P ((_IO_FILE *, void *));
 
 extern struct _IO_jump_t _IO_file_jumps;
+libc_hidden_proto (_IO_file_jumps)
 extern struct _IO_jump_t _IO_file_jumps_mmap attribute_hidden;
 extern struct _IO_jump_t _IO_file_jumps_maybe_mmap attribute_hidden;
-extern struct _IO_jump_t _IO_wfile_jumps attribute_hidden;
+extern struct _IO_jump_t _IO_wfile_jumps;
+libc_hidden_proto (_IO_wfile_jumps)
 extern struct _IO_jump_t _IO_wfile_jumps_mmap attribute_hidden;
 extern struct _IO_jump_t _IO_wfile_jumps_maybe_mmap attribute_hidden;
 extern struct _IO_jump_t _IO_old_file_jumps attribute_hidden;
@@ -477,6 +479,7 @@
 extern int _IO_old_fgetpos64 __P ((_IO_FILE *, _IO_fpos64_t *));
 extern int _IO_new_fsetpos64 __P ((_IO_FILE *, const _IO_fpos64_t *));
 extern int _IO_old_fsetpos64 __P ((_IO_FILE *, const _IO_fpos64_t *));
+extern void _IO_old_init __P ((_IO_FILE *fp, int flags));
 
 
 #if defined _LIBC || defined _GLIBCPP_USE_WCHAR_T
@@ -616,8 +619,7 @@
 extern _IO_ssize_t _IO_str_count __P ((_IO_FILE *));
 
 /* And the wide character versions.  */
-extern void _IO_wstr_init_static __P ((_IO_FILE *, wchar_t *, int, wchar_t *));
-extern void _IO_wstr_init_readonly __P ((_IO_FILE *, const char *, int));
+extern void _IO_wstr_init_static __P ((_IO_FILE *, wchar_t *, _IO_size_t, wchar_t *));
 extern _IO_ssize_t _IO_wstr_count __P ((_IO_FILE *));
 extern _IO_wint_t _IO_wstr_overflow __P ((_IO_FILE *, _IO_wint_t));
 extern _IO_wint_t _IO_wstr_underflow __P ((_IO_FILE *));
@@ -707,7 +709,7 @@
 extern _IO_off64_t _IO_str_seekoff_internal __P ((_IO_FILE *, _IO_off64_t,
 						  int, int));
 extern void _IO_str_init_static_internal __P ((struct _IO_strfile_ *, char *,
-					       int, char *));
+					       _IO_size_t, char *));
 
 extern struct _IO_jump_t _IO_file_jumps_internal attribute_hidden;
 extern struct _IO_jump_t _IO_wfile_jumps_internal attribute_hidden;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/memstream.c libc-20030708/libio/memstream.c
--- glibc-2.3.2/libio/memstream.c	2002-08-11 03:08:29.000000000 +0900
+++ libc-20030708/libio/memstream.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995,1996,1997,1999,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1995-1997,1999,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -114,7 +114,7 @@
     return NULL;
   _IO_no_init (&new_f->fp._sf._sbf._f, 0, 0, &new_f->wd, &_IO_wmem_jumps);
   _IO_JUMPS ((struct _IO_FILE_plus *) &new_f->fp._sf._sbf) = &_IO_mem_jumps;
-  INTUSE(_IO_str_init_static) (&new_f->fp._sf, buf, _IO_BUFSIZ, buf);
+  _IO_str_init_static_internal (&new_f->fp._sf, buf, _IO_BUFSIZ, buf);
   new_f->fp._sf._sbf._f._flags &= ~_IO_USER_BUF;
   new_f->fp._sf._s._allocate_buffer = (_IO_alloc_type) malloc;
   new_f->fp._sf._s._free_buffer = (_IO_free_type) free;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/obprintf.c libc-20030708/libio/obprintf.c
--- glibc-2.3.2/libio/obprintf.c	2002-02-25 16:01:53.000000000 +0900
+++ libc-20030708/libio/obprintf.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Print output of stream to given obstack.
-   Copyright (C) 1996,1997,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1999-2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -153,9 +153,9 @@
       assert (size != 0);
     }
 
-  INTUSE(_IO_str_init_static) ((struct _IO_strfile_ *) &new_f.ofile,
-			       obstack_base (obstack),
-			       size, obstack_next_free (obstack));
+  _IO_str_init_static_internal ((struct _IO_strfile_ *) &new_f.ofile,
+				obstack_base (obstack),
+				size, obstack_next_free (obstack));
   /* Now allocate the rest of the current chunk.  */
   assert (size == (new_f.ofile.file.file._IO_write_end
 		   - new_f.ofile.file.file._IO_write_base));
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/oldiofdopen.c libc-20030708/libio/oldiofdopen.c
--- glibc-2.3.2/libio/oldiofdopen.c	2002-04-09 16:30:11.000000000 +0900
+++ libc-20030708/libio/oldiofdopen.c	2003-05-10 13:38:02.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993,94,97,99,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993,94,97,99,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -114,7 +114,7 @@
 #ifdef _IO_MTSAFE_IO
   new_f->fp.file._lock = &new_f->lock;
 #endif
-  INTUSE(_IO_init) (&new_f->fp.file, 0);
+  _IO_old_init (&new_f->fp.file, 0);
   _IO_JUMPS (&new_f->fp) = &_IO_old_file_jumps;
   _IO_old_file_init (&new_f->fp);
 #if  !_IO_UNIFIED_JUMPTABLES
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/oldiofopen.c libc-20030708/libio/oldiofopen.c
--- glibc-2.3.2/libio/oldiofopen.c	2002-02-25 16:31:13.000000000 +0900
+++ libc-20030708/libio/oldiofopen.c	2003-05-10 13:38:02.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993,1997,1999,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -53,7 +53,7 @@
 #ifdef _IO_MTSAFE_IO
   new_f->fp.file._lock = &new_f->lock;
 #endif
-  INTUSE(_IO_init) (&new_f->fp.file, 0);
+  _IO_old_init (&new_f->fp.file, 0);
   _IO_JUMPS (&new_f->fp) = &_IO_old_file_jumps;
   _IO_old_file_init (&new_f->fp);
 #if  !_IO_UNIFIED_JUMPTABLES
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/stdfiles.c libc-20030708/libio/stdfiles.c
--- glibc-2.3.2/libio/stdfiles.c	2002-03-13 10:05:41.000000000 +0900
+++ libc-20030708/libio/stdfiles.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993-1997,1999,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993-1997,1999,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -39,30 +39,30 @@
 #  define DEF_STDFILE(NAME, FD, CHAIN, FLAGS) \
   static _IO_lock_t _IO_stdfile_##FD##_lock = _IO_lock_initializer; \
   static struct _IO_wide_data _IO_wide_data_##FD \
-    = { ._wide_vtable = &INTUSE(_IO_wfile_jumps) }; \
+    = { ._wide_vtable = &_IO_wfile_jumps }; \
   struct _IO_FILE_plus NAME \
     = {FILEBUF_LITERAL(CHAIN, FLAGS, FD, &_IO_wide_data_##FD), \
-       &INTUSE(_IO_file_jumps)};
+       &_IO_file_jumps};
 # else
 #  define DEF_STDFILE(NAME, FD, CHAIN, FLAGS) \
   static _IO_lock_t _IO_stdfile_##FD##_lock = _IO_lock_initializer; \
   struct _IO_FILE_plus NAME \
     = {FILEBUF_LITERAL(CHAIN, FLAGS, FD, NULL), \
-       &INTUSE(_IO_file_jumps)};
+       &_IO_file_jumps};
 # endif
 #else
 # if defined _LIBC || defined _GLIBCPP_USE_WCHAR_T
 #  define DEF_STDFILE(NAME, FD, CHAIN, FLAGS) \
   static struct _IO_wide_data _IO_wide_data_##FD \
-    = { ._wide_vtable = &INTUSE(_IO_wfile_jumps) }; \
+    = { ._wide_vtable = &_IO_wfile_jumps }; \
   struct _IO_FILE_plus NAME \
     = {FILEBUF_LITERAL(CHAIN, FLAGS, FD, &_IO_wide_data_##FD), \
-       &INTUSE(_IO_file_jumps)};
+       &_IO_file_jumps};
 # else
 #  define DEF_STDFILE(NAME, FD, CHAIN, FLAGS) \
   struct _IO_FILE_plus NAME \
     = {FILEBUF_LITERAL(CHAIN, FLAGS, FD, NULL), \
-       &INTUSE(_IO_file_jumps)};
+       &_IO_file_jumps};
 # endif
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/stdio.h libc-20030708/libio/stdio.h
--- glibc-2.3.2/libio/stdio.h	2002-08-28 10:55:38.000000000 +0900
+++ libc-20030708/libio/stdio.h	2003-04-28 23:53:21.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define ISO C stdio on top of C++ iostreams.
-   Copyright (C) 1991,1994-1999,2000,01,02 Free Software Foundation, Inc.
+   Copyright (C) 1991,1994-2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -156,25 +156,28 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Create a temporary file and open it read/write.  */
+/* Create a temporary file and open it read/write.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
 #ifndef __USE_FILE_OFFSET64
-extern FILE *tmpfile (void) __THROW;
+extern FILE *tmpfile (void);
 #else
 # ifdef __REDIRECT
-extern FILE *__REDIRECT (tmpfile, (void) __THROW, tmpfile64);
+extern FILE *__REDIRECT (tmpfile, (void), tmpfile64);
 # else
 #  define tmpfile tmpfile64
 # endif
 #endif
 
+#ifdef __USE_LARGEFILE64
+extern FILE *tmpfile64 (void);
+#endif
+
 /* Generate a temporary filename.  */
 extern char *tmpnam (char *__s) __THROW;
 __END_NAMESPACE_STD
 
-#ifdef __USE_LARGEFILE64
-extern FILE *tmpfile64 (void) __THROW;
-#endif
-
 #ifdef __USE_MISC
 /* This is the reentrant variant of `tmpnam'.  The only difference is
    that it does not allow S to be NULL.  */
@@ -196,41 +199,61 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Close STREAM.  */
-extern int fclose (FILE *__stream) __THROW;
-/* Flush STREAM, or all streams if STREAM is NULL.  */
-extern int fflush (FILE *__stream) __THROW;
+/* Close STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int fclose (FILE *__stream);
+/* Flush STREAM, or all streams if STREAM is NULL.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int fflush (FILE *__stream);
 __END_NAMESPACE_STD
 
 #ifdef __USE_MISC
-/* Faster versions when locking is not required.  */
-extern int fflush_unlocked (FILE *__stream) __THROW;
+/* Faster versions when locking is not required.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int fflush_unlocked (FILE *__stream);
 #endif
 
 #ifdef __USE_GNU
-/* Close all streams.  */
-extern int fcloseall (void) __THROW;
+/* Close all streams.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int fcloseall (void);
 #endif
 
 
 __BEGIN_NAMESPACE_STD
 #ifndef __USE_FILE_OFFSET64
-/* Open a file and create a new stream for it.  */
+/* Open a file and create a new stream for it.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern FILE *fopen (__const char *__restrict __filename,
-		    __const char *__restrict __modes) __THROW;
-/* Open a file, replacing an existing stream with it. */
+		    __const char *__restrict __modes);
+/* Open a file, replacing an existing stream with it.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern FILE *freopen (__const char *__restrict __filename,
 		      __const char *__restrict __modes,
-		      FILE *__restrict __stream) __THROW;
+		      FILE *__restrict __stream);
 #else
 # ifdef __REDIRECT
 extern FILE *__REDIRECT (fopen, (__const char *__restrict __filename,
-				 __const char *__restrict __modes) __THROW,
-			 fopen64);
+				 __const char *__restrict __modes), fopen64);
 extern FILE *__REDIRECT (freopen, (__const char *__restrict __filename,
 				   __const char *__restrict __modes,
-				   FILE *__restrict __stream) __THROW,
-			 freopen64);
+				   FILE *__restrict __stream), freopen64);
 # else
 #  define fopen fopen64
 #  define freopen freopen64
@@ -239,10 +262,10 @@
 __END_NAMESPACE_STD
 #ifdef __USE_LARGEFILE64
 extern FILE *fopen64 (__const char *__restrict __filename,
-		      __const char *__restrict __modes) __THROW;
+		      __const char *__restrict __modes);
 extern FILE *freopen64 (__const char *__restrict __filename,
 			__const char *__restrict __modes,
-			FILE *__restrict __stream) __THROW;
+			FILE *__restrict __stream);
 #endif
 
 #ifdef	__USE_POSIX
@@ -291,21 +314,32 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Write formatted output to STREAM.  */
+/* Write formatted output to STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int fprintf (FILE *__restrict __stream,
-		    __const char *__restrict __format, ...) __THROW;
-/* Write formatted output to stdout.  */
-extern int printf (__const char *__restrict __format, ...) __THROW;
+		    __const char *__restrict __format, ...);
+/* Write formatted output to stdout.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int printf (__const char *__restrict __format, ...);
 /* Write formatted output to S.  */
 extern int sprintf (char *__restrict __s,
 		    __const char *__restrict __format, ...) __THROW;
 
-/* Write formatted output to S from argument list ARG.  */
+/* Write formatted output to S from argument list ARG.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int vfprintf (FILE *__restrict __s, __const char *__restrict __format,
-		     _G_va_list __arg) __THROW;
-/* Write formatted output to stdout from argument list ARG.  */
-extern int vprintf (__const char *__restrict __format, _G_va_list __arg)
-     __THROW;
+		     _G_va_list __arg);
+/* Write formatted output to stdout from argument list ARG.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int vprintf (__const char *__restrict __format, _G_va_list __arg);
 /* Write formatted output to S from argument list ARG.  */
 extern int vsprintf (char *__restrict __s, __const char *__restrict __format,
 		     _G_va_list __arg) __THROW;
@@ -337,21 +371,32 @@
 		     __const char *__restrict __fmt, ...)
      __THROW __attribute__ ((__format__ (__printf__, 2, 3)));
 
-/* Write formatted output to a file descriptor.  */
+/* Write formatted output to a file descriptor.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern int vdprintf (int __fd, __const char *__restrict __fmt,
 		     _G_va_list __arg)
-     __THROW __attribute__ ((__format__ (__printf__, 2, 0)));
+     __attribute__ ((__format__ (__printf__, 2, 0)));
 extern int dprintf (int __fd, __const char *__restrict __fmt, ...)
-     __THROW __attribute__ ((__format__ (__printf__, 2, 3)));
+     __attribute__ ((__format__ (__printf__, 2, 3)));
 #endif
 
 
 __BEGIN_NAMESPACE_STD
-/* Read formatted input from STREAM.  */
+/* Read formatted input from STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int fscanf (FILE *__restrict __stream,
-		   __const char *__restrict __format, ...) __THROW;
-/* Read formatted input from stdin.  */
-extern int scanf (__const char *__restrict __format, ...) __THROW;
+		   __const char *__restrict __format, ...);
+/* Read formatted input from stdin.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int scanf (__const char *__restrict __format, ...);
 /* Read formatted input from S.  */
 extern int sscanf (__const char *__restrict __s,
 		   __const char *__restrict __format, ...) __THROW;
@@ -359,14 +404,20 @@
 
 #ifdef	__USE_ISOC99
 __BEGIN_NAMESPACE_C99
-/* Read formatted input from S into argument list ARG.  */
+/* Read formatted input from S into argument list ARG.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int vfscanf (FILE *__restrict __s, __const char *__restrict __format,
 		    _G_va_list __arg)
-     __THROW __attribute__ ((__format__ (__scanf__, 2, 0)));
+     __attribute__ ((__format__ (__scanf__, 2, 0)));
+
+/* Read formatted input from stdin into argument list ARG.
 
-/* Read formatted input from stdin into argument list ARG.  */
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int vscanf (__const char *__restrict __format, _G_va_list __arg)
-     __THROW __attribute__ ((__format__ (__scanf__, 1, 0)));
+     __attribute__ ((__format__ (__scanf__, 1, 0)));
 
 /* Read formatted input from S into argument list ARG.  */
 extern int vsscanf (__const char *__restrict __s,
@@ -377,12 +428,18 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Read a character from STREAM.  */
-extern int fgetc (FILE *__stream) __THROW;
-extern int getc (FILE *__stream) __THROW;
+/* Read a character from STREAM.
 
-/* Read a character from stdin.  */
-extern int getchar (void) __THROW;
+   These functions are possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int fgetc (FILE *__stream);
+extern int getc (FILE *__stream);
+
+/* Read a character from stdin.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int getchar (void);
 __END_NAMESPACE_STD
 
 /* The C standard explicitly says this is a macro, so we always do the
@@ -390,24 +447,38 @@
 #define getc(_fp) _IO_getc (_fp)
 
 #if defined __USE_POSIX || defined __USE_MISC
-/* These are defined in POSIX.1:1996.  */
-extern int getc_unlocked (FILE *__stream) __THROW;
-extern int getchar_unlocked (void) __THROW;
+/* These are defined in POSIX.1:1996.
+
+   These functions are possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int getc_unlocked (FILE *__stream);
+extern int getchar_unlocked (void);
 #endif /* Use POSIX or MISC.  */
 
 #ifdef __USE_MISC
-/* Faster version when locking is not necessary.  */
-extern int fgetc_unlocked (FILE *__stream) __THROW;
+/* Faster version when locking is not necessary.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int fgetc_unlocked (FILE *__stream);
 #endif /* Use MISC.  */
 
 
 __BEGIN_NAMESPACE_STD
-/* Write a character to STREAM.  */
+/* Write a character to STREAM.
+
+   These functions are possible cancellation points and therefore not
+   marked with __THROW.  */
 extern int fputc (int __c, FILE *__stream) __THROW;
 extern int putc (int __c, FILE *__stream) __THROW;
 
-/* Write a character to stdout.  */
-extern int putchar (int __c) __THROW;
+/* Write a character to stdout.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int putchar (int __c);
 __END_NAMESPACE_STD
 
 /* The C standard explicitly says this can be a macro,
@@ -415,18 +486,27 @@
 #define putc(_ch, _fp) _IO_putc (_ch, _fp)
 
 #ifdef __USE_MISC
-/* Faster version when locking is not necessary.  */
-extern int fputc_unlocked (int __c, FILE *__stream) __THROW;
+/* Faster version when locking is not necessary.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int fputc_unlocked (int __c, FILE *__stream);
 #endif /* Use MISC.  */
 
 #if defined __USE_POSIX || defined __USE_MISC
-/* These are defined in POSIX.1:1996.  */
-extern int putc_unlocked (int __c, FILE *__stream) __THROW;
-extern int putchar_unlocked (int __c) __THROW;
+/* These are defined in POSIX.1:1996.
+
+   These functions are possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int putc_unlocked (int __c, FILE *__stream);
+extern int putchar_unlocked (int __c);
 #endif /* Use POSIX or MISC.  */
 
 
-#if defined __USE_SVID || defined __USE_MISC || defined __USE_XOPEN
+#if defined __USE_SVID || defined __USE_MISC \
+    || (defined __USE_XOPEN && !defined __USE_XOPEN2K)
 /* Get a word (int) from STREAM.  */
 extern int getw (FILE *__stream) __THROW;
 
@@ -436,19 +516,29 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Get a newline-terminated string of finite length from STREAM.  */
-extern char *fgets (char *__restrict __s, int __n, FILE *__restrict __stream)
-     __THROW;
+/* Get a newline-terminated string of finite length from STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern char *fgets (char *__restrict __s, int __n, FILE *__restrict __stream);
 
 /* Get a newline-terminated string from stdin, removing the newline.
-   DO NOT USE THIS FUNCTION!!  There is no limit on how much it will read.  */
-extern char *gets (char *__s) __THROW;
+   DO NOT USE THIS FUNCTION!!  There is no limit on how much it will read.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern char *gets (char *__s);
 __END_NAMESPACE_STD
 
 #ifdef __USE_GNU
-/* This function does the same as `fgets' but does not lock the stream.  */
+/* This function does the same as `fgets' but does not lock the stream.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern char *fgets_unlocked (char *__restrict __s, int __n,
-			     FILE *__restrict __stream) __THROW;
+			     FILE *__restrict __stream);
 #endif
 
 
@@ -457,50 +547,84 @@
    (and null-terminate it). *LINEPTR is a pointer returned from malloc (or
    NULL), pointing to *N characters of space.  It is realloc'd as
    necessary.  Returns the number of characters read (not including the
-   null terminator), or -1 on error or EOF.  */
+   null terminator), or -1 on error or EOF.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern _IO_ssize_t __getdelim (char **__restrict __lineptr,
 			       size_t *__restrict __n, int __delimiter,
-			       FILE *__restrict __stream) __THROW;
+			       FILE *__restrict __stream);
 extern _IO_ssize_t getdelim (char **__restrict __lineptr,
 			     size_t *__restrict __n, int __delimiter,
-			     FILE *__restrict __stream) __THROW;
+			     FILE *__restrict __stream);
 
-/* Like `getdelim', but reads up to a newline.  */
+/* Like `getdelim', but reads up to a newline.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern _IO_ssize_t getline (char **__restrict __lineptr,
 			    size_t *__restrict __n,
-			    FILE *__restrict __stream) __THROW;
+			    FILE *__restrict __stream);
 #endif
 
 
 __BEGIN_NAMESPACE_STD
-/* Write a string to STREAM.  */
-extern int fputs (__const char *__restrict __s, FILE *__restrict __stream)
-     __THROW;
+/* Write a string to STREAM.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int fputs (__const char *__restrict __s, FILE *__restrict __stream);
+
+/* Write a string, followed by a newline, to stdout.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int puts (__const char *__s);
 
-/* Write a string, followed by a newline, to stdout.  */
-extern int puts (__const char *__s) __THROW;
 
+/* Push a character back onto the input buffer of STREAM.
 
-/* Push a character back onto the input buffer of STREAM.  */
-extern int ungetc (int __c, FILE *__stream) __THROW;
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int ungetc (int __c, FILE *__stream);
 
 
-/* Read chunks of generic data from STREAM.  */
+/* Read chunks of generic data from STREAM.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
 extern size_t fread (void *__restrict __ptr, size_t __size,
-		     size_t __n, FILE *__restrict __stream) __THROW;
-/* Write chunks of generic data to STREAM.  */
+		     size_t __n, FILE *__restrict __stream);
+/* Write chunks of generic data to STREAM.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
 extern size_t fwrite (__const void *__restrict __ptr, size_t __size,
-		      size_t __n, FILE *__restrict __s) __THROW;
+		      size_t __n, FILE *__restrict __s);
 __END_NAMESPACE_STD
 
 #ifdef __USE_GNU
-/* This function does the same as `fputs' but does not lock the stream.  */
+/* This function does the same as `fputs' but does not lock the stream.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int fputs_unlocked (__const char *__restrict __s,
-			   FILE *__restrict __stream) __THROW;
+			   FILE *__restrict __stream);
 #endif
 
 #ifdef __USE_MISC
-/* Faster versions when locking is not necessary.  */
+/* Faster versions when locking is not necessary.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern size_t fread_unlocked (void *__restrict __ptr, size_t __size,
 			      size_t __n, FILE *__restrict __stream) __THROW;
 extern size_t fwrite_unlocked (__const void *__restrict __ptr, size_t __size,
@@ -509,12 +633,21 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Seek to a certain position on STREAM.  */
-extern int fseek (FILE *__stream, long int __off, int __whence) __THROW;
-/* Return the current position of STREAM.  */
-extern long int ftell (FILE *__stream) __THROW;
-/* Rewind to the beginning of STREAM.  */
-extern void rewind (FILE *__stream) __THROW;
+/* Seek to a certain position on STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int fseek (FILE *__stream, long int __off, int __whence);
+/* Return the current position of STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern long int ftell (FILE *__stream);
+/* Rewind to the beginning of STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void rewind (FILE *__stream);
 __END_NAMESPACE_STD
 
 /* The Single Unix Specification, Version 2, specifies an alternative,
@@ -524,16 +657,22 @@
 
 #ifdef __USE_LARGEFILE
 # ifndef __USE_FILE_OFFSET64
-/* Seek to a certain position on STREAM.  */
-extern int fseeko (FILE *__stream, __off_t __off, int __whence) __THROW;
-/* Return the current position of STREAM.  */
-extern __off_t ftello (FILE *__stream) __THROW;
+/* Seek to a certain position on STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int fseeko (FILE *__stream, __off_t __off, int __whence);
+/* Return the current position of STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern __off_t ftello (FILE *__stream);
 # else
 #  ifdef __REDIRECT
 extern int __REDIRECT (fseeko,
-		       (FILE *__stream, __off64_t __off, int __whence) __THROW,
+		       (FILE *__stream, __off64_t __off, int __whence),
 		       fseeko64);
-extern __off64_t __REDIRECT (ftello, (FILE *__stream) __THROW, ftello64);
+extern __off64_t __REDIRECT (ftello, (FILE *__stream), ftello64);
 #  else
 #   define fseeko fseeko64
 #   define ftello ftello64
@@ -543,18 +682,22 @@
 
 __BEGIN_NAMESPACE_STD
 #ifndef __USE_FILE_OFFSET64
-/* Get STREAM's position.  */
-extern int fgetpos (FILE *__restrict __stream, fpos_t *__restrict __pos)
-     __THROW;
-/* Set STREAM's position.  */
-extern int fsetpos (FILE *__stream, __const fpos_t *__pos) __THROW;
+/* Get STREAM's position.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int fgetpos (FILE *__restrict __stream, fpos_t *__restrict __pos);
+/* Set STREAM's position.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int fsetpos (FILE *__stream, __const fpos_t *__pos);
 #else
 # ifdef __REDIRECT
 extern int __REDIRECT (fgetpos, (FILE *__restrict __stream,
-				 fpos_t *__restrict __pos) __THROW, fgetpos64);
+				 fpos_t *__restrict __pos), fgetpos64);
 extern int __REDIRECT (fsetpos,
-		       (FILE *__stream, __const fpos_t *__pos) __THROW,
-		       fsetpos64);
+		       (FILE *__stream, __const fpos_t *__pos), fsetpos64);
 # else
 #  define fgetpos fgetpos64
 #  define fsetpos fsetpos64
@@ -563,11 +706,10 @@
 __END_NAMESPACE_STD
 
 #ifdef __USE_LARGEFILE64
-extern int fseeko64 (FILE *__stream, __off64_t __off, int __whence) __THROW;
-extern __off64_t ftello64 (FILE *__stream) __THROW;
-extern int fgetpos64 (FILE *__restrict __stream, fpos64_t *__restrict __pos)
-     __THROW;
-extern int fsetpos64 (FILE *__stream, __const fpos64_t *__pos) __THROW;
+extern int fseeko64 (FILE *__stream, __off64_t __off, int __whence);
+extern __off64_t ftello64 (FILE *__stream);
+extern int fgetpos64 (FILE *__restrict __stream, fpos64_t *__restrict __pos);
+extern int fsetpos64 (FILE *__stream, __const fpos64_t *__pos);
 #endif
 
 __BEGIN_NAMESPACE_STD
@@ -588,8 +730,11 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Print a message describing the meaning of the value of errno.  */
-extern void perror (__const char *__s) __THROW;
+/* Print a message describing the meaning of the value of errno.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void perror (__const char *__s);
 __END_NAMESPACE_STD
 
 /* Provide the declarations for `sys_errlist' and `sys_nerr' if they
@@ -612,11 +757,17 @@
 
 #if (defined __USE_POSIX2 || defined __USE_SVID  || defined __USE_BSD || \
      defined __USE_MISC)
-/* Create a new stream connected to a pipe running the given command.  */
-extern FILE *popen (__const char *__command, __const char *__modes) __THROW;
+/* Create a new stream connected to a pipe running the given command.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern FILE *popen (__const char *__command, __const char *__modes);
+
+/* Close a stream opened by popen and return the status of its child.
 
-/* Close a stream opened by popen and return the status of its child.  */
-extern int pclose (FILE *__stream) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern int pclose (FILE *__stream);
 #endif
 
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/strops.c libc-20030708/libio/strops.c
--- glibc-2.3.2/libio/strops.c	2002-02-25 15:49:21.000000000 +0900
+++ libc-20030708/libio/strops.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1997-2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993, 1997-2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -63,33 +63,22 @@
 #endif
 
 void
-_IO_str_init_static (sf, ptr, size, pstart)
+_IO_str_init_static_internal (sf, ptr, size, pstart)
      _IO_strfile *sf;
      char *ptr;
-     int size;
+     _IO_size_t size;
      char *pstart;
 {
   _IO_FILE *fp = &sf->_sbf._f;
+  char *end;
 
   if (size == 0)
-    size = strlen (ptr);
-  else if (size < 0)
-    {
-      /* If size is negative 'the characters are assumed to
-	 continue indefinitely.'  This is kind of messy ... */
-      int s;
-      size = 512;
-      /* Try increasing powers of 2, as long as we don't wrap around. */
-      for (; s = 2*size, s > 0 && ptr + s > ptr && s < 0x4000000L; )
-	size = s;
-      /* Try increasing size as much as we can without wrapping around. */
-      for (s = size >> 1; s > 0; s >>= 1)
-	{
-	  if (ptr + size + s > ptr)
-	    size += s;
-	}
-    }
-  INTUSE(_IO_setb) (fp, ptr, ptr + size, 0);
+    end = __rawmemchr (ptr, '\0');
+  else if ((_IO_size_t) ptr + size > (_IO_size_t) ptr)
+    end = ptr + size;
+  else
+    end = (char *) -1;
+  INTUSE(_IO_setb) (fp, ptr, end, 0);
 
   fp->_IO_write_base = ptr;
   fp->_IO_read_base = ptr;
@@ -97,19 +86,28 @@
   if (pstart)
     {
       fp->_IO_write_ptr = pstart;
-      fp->_IO_write_end = ptr + size;
+      fp->_IO_write_end = end;
       fp->_IO_read_end = pstart;
     }
   else
     {
       fp->_IO_write_ptr = ptr;
       fp->_IO_write_end = ptr;
-      fp->_IO_read_end = ptr+size;
+      fp->_IO_read_end = end;
     }
   /* A null _allocate_buffer function flags the strfile as being static. */
   sf->_s._allocate_buffer = (_IO_alloc_type) 0;
 }
-INTDEF(_IO_str_init_static)
+
+void
+_IO_str_init_static (sf, ptr, size, pstart)
+     _IO_strfile *sf;
+     char *ptr;
+     int size;
+     char *pstart;
+{
+  return _IO_str_init_static_internal (sf, ptr, size < 0 ? -1 : size, pstart);
+}
 
 void
 _IO_str_init_readonly (sf, ptr, size)
@@ -117,7 +115,7 @@
      const char *ptr;
      int size;
 {
-  INTUSE(_IO_str_init_static) (sf, (char *) ptr, size, NULL);
+  _IO_str_init_static_internal (sf, (char *) ptr, size < 0 ? -1 : size, NULL);
   sf->_sbf._f._IO_file_flags |= _IO_NO_WRITES;
 }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/swprintf.c libc-20030708/libio/swprintf.c
--- glibc-2.3.2/libio/swprintf.c	2001-07-08 04:21:03.000000000 +0900
+++ libc-20030708/libio/swprintf.c	2003-03-06 04:58:03.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1991,1995,1997,1998,1999,2000 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1995,1997,1998,1999,2000,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,10 +23,7 @@
 /* Write formatted output into S, according to the format string FORMAT.  */
 /* VARARGS3 */
 int
-swprintf (s, n, format)
-     wchar_t *s;
-     size_t n;
-     const wchar_t *format;
+swprintf (wchar_t *s, size_t n, const wchar_t *format, ...)
 {
   va_list arg;
   int done;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/swscanf.c libc-20030708/libio/swscanf.c
--- glibc-2.3.2/libio/swscanf.c	2001-07-08 04:21:03.000000000 +0900
+++ libc-20030708/libio/swscanf.c	2003-03-06 04:58:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1995, 1996, 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1995,1996,1998,1999,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,9 +22,7 @@
 /* Read formatted input from S, according to the format string FORMAT.  */
 /* VARARGS2 */
 int
-swscanf (s, format)
-     const wchar_t *s;
-     const wchar_t *format;
+swscanf (const wchar_t *s, const wchar_t *format, ...)
 {
   va_list arg;
   int done;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/vasprintf.c libc-20030708/libio/vasprintf.c
--- glibc-2.3.2/libio/vasprintf.c	2002-02-25 16:02:03.000000000 +0900
+++ libc-20030708/libio/vasprintf.c	2003-06-12 08:53:46.000000000 +0900
@@ -54,7 +54,7 @@
 #endif
   _IO_no_init ((_IO_FILE *) &sf._sbf, _IO_USER_LOCK, -1, NULL, NULL);
   _IO_JUMPS ((struct _IO_FILE_plus *) &sf._sbf) = &_IO_str_jumps;
-  INTUSE(_IO_str_init_static) (&sf, string, init_string_size, string);
+  _IO_str_init_static_internal (&sf, string, init_string_size, string);
   sf._sbf._f._flags &= ~_IO_USER_BUF;
   sf._s._allocate_buffer = (_IO_alloc_type) malloc;
   sf._s._free_buffer = (_IO_free_type) free;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/vsnprintf.c libc-20030708/libio/vsnprintf.c
--- glibc-2.3.2/libio/vsnprintf.c	2002-02-25 16:02:12.000000000 +0900
+++ libc-20030708/libio/vsnprintf.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1994,1997,1999,2000,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1994,1997,1999-2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -126,7 +126,7 @@
   _IO_no_init (&sf.f._sbf._f, _IO_USER_LOCK, -1, NULL, NULL);
   _IO_JUMPS ((struct _IO_FILE_plus *) &sf.f._sbf) = &_IO_strn_jumps;
   string[0] = '\0';
-  INTUSE(_IO_str_init_static) (&sf.f, string, maxlen - 1, string);
+  _IO_str_init_static_internal (&sf.f, string, maxlen - 1, string);
   ret = INTUSE(_IO_vfprintf) ((_IO_FILE *) &sf.f._sbf, format, args);
 
   if (sf.f._sbf._f._IO_buf_base != sf.overflow_buf)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/wfileops.c libc-20030708/libio/wfileops.c
--- glibc-2.3.2/libio/wfileops.c	2002-11-05 16:28:51.000000000 +0900
+++ libc-20030708/libio/wfileops.c	2003-03-28 21:28:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993,95,97,98,99,2000,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993,95,97,98,99,2000,2001,2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Ulrich Drepper <drepper@cygnus.com>.
    Based on the single byte version by Per Bothner <bothner@cygnus.com>.
@@ -879,7 +879,7 @@
   JUMP_INIT(showmanyc, _IO_default_showmanyc),
   JUMP_INIT(imbue, _IO_default_imbue)
 };
-INTVARDEF(_IO_wfile_jumps)
+libc_hidden_data_def (_IO_wfile_jumps)
 
 
 struct _IO_jump_t _IO_wfile_jumps_mmap =
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/libio/wstrops.c libc-20030708/libio/wstrops.c
--- glibc-2.3.2/libio/wstrops.c	2002-08-25 11:41:38.000000000 +0900
+++ libc-20030708/libio/wstrops.c	2003-06-12 08:53:46.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993,1997,1998,1999,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993,1997-1999,2001-2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -67,28 +67,20 @@
 _IO_wstr_init_static (fp, ptr, size, pstart)
      _IO_FILE *fp;
      wchar_t *ptr;
-     int size;
+     _IO_size_t size;
      wchar_t *pstart;
 {
+  wchar_t *end;
+  
   if (size == 0)
-    size = __wcslen (ptr);
-  else if (size < 0)
-    {
-      /* If size is negative 'the characters are assumed to
-	 continue indefinitely.'  This is kind of messy ... */
-      int s;
-      size = 512;
-      /* Try increasing powers of 2, as long as we don't wrap around. */
-      for (; s = 2*size, s > 0 && ptr + s > ptr && s < 0x4000000L; )
-	size = s;
-      /* Try increasing size as much as we can without wrapping around. */
-      for (s = size >> 1; s > 0; s >>= 1)
-	{
-	  if (ptr + size + s > ptr)
-	    size += s;
-	}
-    }
-  INTUSE(_IO_wsetb) (fp, ptr, ptr + size, 0);
+    end = ptr + __wcslen (ptr);
+  else if ((_IO_size_t) ptr + size * sizeof (wchar_t) > (_IO_size_t) ptr)
+    end = ptr + size;
+  else
+    /* Even for misaligned ptr make sure there is integral number of wide
+       characters.  */
+    end = ptr + (-1 - (_IO_size_t) ptr) / sizeof (wchar_t);
+  INTUSE(_IO_wsetb) (fp, ptr, end, 0);
 
   fp->_wide_data->_IO_write_base = ptr;
   fp->_wide_data->_IO_read_base = ptr;
@@ -96,29 +88,19 @@
   if (pstart)
     {
       fp->_wide_data->_IO_write_ptr = pstart;
-      fp->_wide_data->_IO_write_end = ptr + size;
+      fp->_wide_data->_IO_write_end = end;
       fp->_wide_data->_IO_read_end = pstart;
     }
   else
     {
       fp->_wide_data->_IO_write_ptr = ptr;
       fp->_wide_data->_IO_write_end = ptr;
-      fp->_wide_data->_IO_read_end = ptr + size;
+      fp->_wide_data->_IO_read_end = end;
     }
   /* A null _allocate_buffer function flags the strfile as being static. */
   (((_IO_strfile *) fp)->_s._allocate_buffer) =  (_IO_alloc_type)0;
 }
 
-void
-_IO_wstr_init_readonly (fp, ptr, size)
-     _IO_FILE *fp;
-     const char *ptr;
-     int size;
-{
-  _IO_wstr_init_static (fp, (wchar_t *) ptr, size, NULL);
-  fp->_IO_file_flags |= _IO_NO_WRITES;
-}
-
 _IO_wint_t
 _IO_wstr_overflow (fp, c)
      _IO_FILE *fp;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/ChangeLog libc-20030708/linuxthreads/ChangeLog
--- glibc-2.3.2/linuxthreads/ChangeLog	2003-02-28 07:40:10.000000000 +0900
+++ libc-20030708/linuxthreads/ChangeLog	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,301 @@
-2003-02-27  Roland McGrath  <roland@redhat.com>
+2003-07-04  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/ia64/sysdep-cancel.h (PSEUDO): Use
+	different symbol for the cancellation syscall wrapper and
+	non-cancellation syscall wrapper.
+	(PSEUDO_END): Define.
+
+2003-07-05  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/alpha/elf/pt-initfini.c: Avoid .ent/.end.
+
+2003-06-20  Kaz Kojima  <kkojima@rr.iij4u.or.jp>
+
+	* sysdeps/unix/sysv/linux/sh/sysdep-cancel.h: Support cancellation
+	in librt.
+
+2003-06-21  Andreas Schwab  <schwab@suse.de>
+
+	* sysdeps/unix/sysv/linux/m68k/sysdep-cancel.h: Support cancellation
+	in librt.
+
+2003-06-20  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/unix/sysv/linux/alpha/Makefile (libpthread-routines):
+	Remove ptw-osf_sigprocmask.
+
+2003-06-18  Jakub Jelinek  <jakub@redhat.com>
+
+	* internals.h (__librt_multiple_threads, __librt_enable_asynccancel,
+	__librt_disable_asynccancel): Declare.
+	(LIBC_CANCEL_ASYNC, LIBC_CANCEL_RESET, LIBC_CANCEL_HANDLED): Define
+	for IS_IN_librt.
+	* sysdeps/unix/sysv/linux/i386/sysdep-cancel.h: Support cancellation
+	in librt.
+	* sysdeps/unix/sysv/linux/ia64/sysdep-cancel.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/s390-32/sysdep-cancel.h: Likewise.
+	* sysdeps/unix/sysv/linux/s390/s390-64/sysdep-cancel.h: Likewise.
+	* sysdeps/unix/sysv/linux/sparc/sparc32/sysdep-cancel.h: Likewise.
+	* sysdeps/unix/sysv/linux/sparc/sparc64/sysdep-cancel.h: Likewise.
+	* sysdeps/unix/sysv/linux/x86_64/sysdep-cancel.h: Likewise.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep-cancel.h: Likewise.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep-cancel.h: Likewise.
+	* sysdeps/x86_64/tcb-offsets.sym: New file.
+	* sysdeps/x86_64/Makefile: New file.
+	* sysdeps/x86_64/tls.h (tcbhead_t): Add multiple_threads.
+	* Versions (libc): Export __librt_enable_asynccancel,
+	__librt_disable_asynccancel and __librt_multiple_threads as
+	GLIBC_PRIVATE.
+	* libc-cancellation.c (__librt_multiple_threads,
+	__librt_enable_asynccancel, __librt_disable_asynccancel): New aliases.
+
+2003-06-12  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep-cancel.h
+	(SINGLE_THREAD_P): Replace @ got notation with @toc.
+
+2003-06-11  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/powerpc/pspinlock.c (__pthread_spin_init): Fix
+	initializer [PR libc/5052].
+
+2003-06-09  Andreas Schwab  <schwab@suse.de>
+
+	* Makefile: Move inclusion of ../Rules down after extra-objs is
+	fully known.
+
+2003-06-06  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/arm/sysdep-cancel.h: New sequences for
+	5+ arg syscalls only needed for PIC.
+	Patch by Ralph Siemsen <ralphs@netwinder.org>.
+
+2003-06-05  Richard Henderson  <rth@redhat.com>
+
+	* sysdeps/unix/sysv/linux/alpha/sysdep-cancel.h (PSEUDO): Use
+	and require CFI assembler directives.
+	* sysdeps/unix/sysv/linux/alpha/vfork.S: Likewise.
+
+2003-05-30  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/x86_64/sysdep-cancel.h
+	(SAVESTK_0): Add CFI directives.
+	(SAVESTK_3): Likewise.
+	(SAVESTK_5): Likewise.
+	(RESTSTK_0): Likewise.
+	(RESTSTK_3): Likewise.
+	(RESTSTK_5): Likewise.
+
+2003-05-05  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/i386/tls.h (TLS_DO_SET_THREAD_AREA): Add \n to error
+	messages.
+
+2003-05-04  Roland McGrath  <roland@redhat.com>
+
+	* Makefile ($(objpfx)../libc.so): New target.
+
+2003-04-26  Ulrich Drepper  <drepper@redhat.com>
+
+	* pthread.c (__pthread_initialize_manager): Remove one last
+	p_multiple_threads call.
+
+2003-04-22  Jakub Jelinek  <jakub@redhat.com>
+
+	* pthread.c (__pthread_initialize_manager): Subtract
+	TLS_PRE_TCB_SIZE bytes from tcbp to get to descr.
+	* manager.c (pthread_handle_create): Subtract or add TLS_PRE_TCB_SIZE
+	instead of sizeof (pthread_descr).
+	(pthread_free): Add TLS_PRE_TCB_SIZE instead of sizeof (pthread_descr).
+	* sysdeps/powerpc/tls.h (TLS_INIT_TCB_SIZE, TLS_TCB_SIZE): Define to 0.
+	(TLS_INIT_TCB_ALIGN, TLS_TCB_ALIGN): Define to alignment of
+	pthread_descr.
+	(TLS_PRE_TCB_SIZE): Increase to cover tcbhead_t preceeded by pad
+	to TLS_TCB_ALIGN.
+	(INSTALL_DTV, GET_DTV, THREAD_DTV): tcbhead_t is immediately before
+	tcbp.
+	(TLS_INIT_TP, THREAD_SELF, INIT_THREAD_SELF): Don't add TLS_TCB_SIZE
+	unneccessarily.
+	(NO_TLS_OFFSET): Define.
+
+2003-04-22  Roland McGrath  <roland@redhat.com>
+
+	* Makeconfig (shared-thread-library): Reverse link order to work
+	around linker bug.
+
+2003-04-20  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/i386/useldt.h (DO_SET_THREAD_AREA): Make sure the
+	compiler knows we use the ldt_entry variable and that the syscall
+	modifies the memory.
+
+	* internals.h: Split pthread_functions definition into...
+	* sysdeps/pthread/pthread-functions.h: ...new file.
+
+	* sysdeps/i386/useldt.h: Include <sysdep.h>.
+
+2003-04-13  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/i386/sysdep-cancel.h: Rename macros to
+	match changes in NPTL sysdep-cancel.h.
+
+2003-04-11  Roland McGrath  <roland@redhat.com>
+
+	* Makefile (multidir): Don't set the variable here with $(shell ...).
+	($(objpfx)multidir.mk): New target, generated makefile; include that.
+	(generated): Append it.
+
+2003-04-10  Jakub Jelinek  <jakub@redhat.com>
+
+	* Makefile (multidir, crti-objs, crtn-objs): New variables.
+	(generated-dirs): Add pathname component of multidir.
+	(omit-deps, extra-objs): Include $(multidir)/crt? as well.
+	($(objpfx)libpthread.so): Depend on $(multidir)/crt?.o as well.
+	($(objpfx)$(multidir), $(objpfx)$(multidir)/crti.o,
+	$(objpfx)$(multidir)/crtn.o): New.
+	* sysdeps/unix/sysv/linux/sparc/Makefile: Removed.
+	* sysdeps/unix/sysv/linux/x86_64/Makefile (LDFLAGS-pthread.so,
+	before-compile, generated): Don't generate and use specs.
+	($(objpfx)specs): Remove.
+
+2003-04-11  Martin Schwidefsky  <schwidefsky@de.ibm.com>
+
+	* sysdeps/s390/pspinlock.c (__pthread_spin_unlock): Fix asm contraints.
+
+2003-04-03  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/arm/sysdep-cancel.h (PSEUDO): Add
+	missing ; after ENTRY use [PR libc/4997].
+
+2003-04-03  Jakub Jelinek  <jakub@redhat.com>
+
+	* pthread.c (pthread_initialize): Unblock __pthread_sig_cancel
+	in case the parent blocked it.
+
+2003-04-02  Jakub Jelinek  <jakub@redhat.com>
+
+	* Makefile (libpthread-routines): Add pthread_atfork.
+	(libpthread-static-only-routines): Add pthread_atfork.
+
+2003-04-01  Jakub Jelinek  <jakub@redhat.com>
+
+	* pthread.c (__pthread_wait_for_restart_signal): Use
+	__pthread_sigsuspend instead of sigsuspend.
+	* internals.h (__pthread_sigsuspend): New prototype.
+	* Makefile (libpthread-routines): Add pt-sigsuspend.
+	(tests): Add tst-cancel7.
+	* sysdeps/unix/sysv/linux/pt-sigsuspend.c: New file.
+	* sysdeps/unix/sysv/linux/alpha/pt-sigsuspend.S: New file.
+	* sysdeps/unix/sysv/linux/ia64/pt-sigsuspend.c: New file.
+	* sysdeps/unix/sysv/linux/s390/s390-64/pt-sigsuspend.c: New file.
+	* sysdeps/unix/sysv/linux/sparc/sparc64/pt-sigsuspend.c: New file.
+	* sysdeps/unix/sysv/linux/x86_64/pt-sigsuspend.c: New file.
+	* tst-cancel7.c: New test.
+
+2003-03-31  Alexandre Oliva  <aoliva@redhat.com>
+
+	* alloca_cutoff.c: Include internals.h.
+	* sysdeps/pthread/errno-loc.c: Include linuxthreads/internals.h.
+	* sysdeps/pthread/herrno-loc.c: Likewise.
+	* sysdeps/pthread/res-state.c: Likewise.
+
+2003-03-25  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/pthread/bits/typesizes.h: New file.
+	* sysdeps/unix/sysv/linux/alpha/bits/typesizes.h: New file.
+	* sysdeps/unix/sysv/linux/sparc/bits/typesizes.h: New file.
+
+2003-03-24  Daniel Jacobowitz  <drow@mvista.com>
+
+	* sysdeps/unix/sysv/linux/arm/sysdep-cancel.h
+	(DOARGS_5, DOARGS_6, DOARGS_7): Rewritten.
+
+2003-03-22  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/fork.c (__fork): Add libc_hidden_def.
+
+2003-03-21  Daniel Jacobowitz  <drow@mvista.com>
+
+	* sysdeps/unix/sysv/linux/arm/sysdep-cancel.h
+	(SINGLE_THREAD_P_PIC): Use "reg" instead of "lr".
+
+2003-03-21  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/i386/tls.h [__ASSUME_SET_THREAD_AREA_SYSCALL]
+	(TLS_SETUP_GS_SEGMENT): Fix a typo.
+
+2003-03-19  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/pthread/Makefile: Fix cut&paste error.
+
+2003-03-18  Roland McGrath  <roland@redhat.com>
+
+	* Versions (libpthread: GLIBC_2.2): Remove
+	pthread_barrierattr_getpshared, never really existed.
+	(libpthread: GLIBC_2.0): Move __pthread_initialize to ...
+	(libpthread: GLIBC_PRIVATE): ... here.
+
+2003-03-14  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/unix/sysv/linux/sparc/sparc64/Makefile: New file.
+	* sysdeps/unix/sysv/linux/sparc/Makefile ($(objpfx)specs): Use full
+	path for crt[in].o.
+
+2003-03-14  Alexandre Oliva  <aoliva@redhat.com>
+
+	* sysdeps/mips/pspinlock.c (__pthread_spin_lock): Don't .set
+	mips2 on new abi.
+	* sysdeps/mips/pt-machine.h (__compare_and_swap): Likewise.
+	Handle 64-bit longs on n64.
+
+2003-03-07  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/ia64/pspinlock.c (__pthread_spin_lock,
+	__pthread_spin_trylock): Rewritten.
+
+2003-03-06  Ulrich Drepper  <drepper@redhat.com>
+
+	* tst-cancel4.c (tf_sleep): Lower sleep time a bit to not upset
+	recent kernels.
+
+2003-03-02  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/pthread/timer_create.c (timer_create): Return correct
+	error for CPU clocks.
+
+	* sysdeps/unix/sysv/linux/bits/posix_opt.h: Define
+	_POSIX_MONOTONIC_CLOCK.
+	* sysdeps/unix/sysv/linux/i386/bits/posix_opt.h: Likewise.
+
+2003-03-01  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/powerpc/powerpc64/pt-machine.h
+	(THREAD_GETMEM, THREAD_GETMEM_NC, THREAD_SETMEM, THREAD_SETMEM_NC):
+	New macros.
+	* sysdeps/powerpc/tls.h: Don't define those here.
+
+	* sysdeps/powerpc/tls.h [! USE_TLS && !__powerpc64__]: Define
+	tcbhead_t with multiple_threads member.
+	[USE_TLS] (tcbhead_t): Define minimal one-word version.
+	[USE_TLS && !__powerpc64__] (TLS_MULTIPLE_THREADS_IN_TCB): Define.
+	* sysdeps/powerpc/tcb-offsets.sym [USE_TLS]: Use tls.h macros to
+	derive thread register offset of p_multiple_threads member.
+
+	* descr.h (struct _pthread_descr_struct) [!USE_TLS || !TLS_DTV_AT_TP]:
+	Conditionalize p_header member on this.
+	[TLS_MULTIPLE_THREADS_IN_TCB]: Add p_multiple_threads alternatively.
+	* sysdeps/ia64/tls.h [USE_TLS] (TLS_MULTIPLE_THREADS_IN_TCB): Define.
+	* sysdeps/sh/tls.h: Likewise.
+	* sysdeps/ia64/tcb-offsets.sym [USE_TLS]: Use p_multiple_threads.
+	* sysdeps/sh/tcb-offsets.sym: Likewise.
+	* sysdeps/unix/sysv/linux/sh/sysdep-cancel.h
+	(SINGLE_THREAD_P): Likewise.
+	* sysdeps/unix/sysv/linux/ia64/sysdep-cancel.h
+	(SINGLE_THREAD_P): Likewise.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep-cancel.h
+	(SINGLE_THREAD_P): Likewise.
+	* pthread.c (__pthread_initialize_manager): Likewise.
+	* manager.c (pthread_handle_create): Likewise.
 
 	* sysdeps/powerpc/tls.h [HAVE_TLS_SUPPORT]: Define USE_TLS and all
 	related macros.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/Makeconfig libc-20030708/linuxthreads/Makeconfig
--- glibc-2.3.2/linuxthreads/Makeconfig	2002-12-31 14:56:27.000000000 +0900
+++ libc-20030708/linuxthreads/Makeconfig	2003-04-28 23:53:21.000000000 +0900
@@ -3,8 +3,8 @@
 
 have-thread-library = yes
 
-shared-thread-library = $(common-objpfx)linuxthreads/libpthread.so \
-			$(common-objpfx)linuxthreads/libpthread_nonshared.a
+shared-thread-library = $(common-objpfx)linuxthreads/libpthread_nonshared.a \
+			$(common-objpfx)linuxthreads/libpthread.so
 static-thread-library = $(common-objpfx)linuxthreads/libpthread.a
 bounded-thread-library = $(common-objpfx)linuxthreads/libpthread_b.a
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/Makefile libc-20030708/linuxthreads/Makefile
--- glibc-2.3.2/linuxthreads/Makefile	2003-02-22 10:01:16.000000000 +0900
+++ libc-20030708/linuxthreads/Makefile	2003-06-12 08:53:47.000000000 +0900
@@ -36,8 +36,8 @@
 install-lib-ldscripts := libpthread.so
 
 libpthread-routines := attr cancel condvar join manager mutex ptfork \
-		       ptlongjmp pthread signals specific errno lockfile \
-		       semaphore spinlock rwlock pt-machine \
+		       ptlongjmp pthread pt-sigsuspend signals specific errno \
+		       lockfile semaphore spinlock rwlock pt-machine \
 		       oldsemaphore events getcpuclockid pspinlock barrier \
 		       ptclock_gettime ptclock_settime sighandler \
 		       pthandles libc-tls-loc pt-allocrtsig \
@@ -47,11 +47,12 @@
 		       ptw-lseek64 ptw-llseek ptw-msync ptw-nanosleep \
 		       ptw-open ptw-open64 ptw-pause ptw-pread ptw-pread64 \
 		       ptw-pwrite ptw-pwrite64 ptw-tcdrain ptw-wait \
-		       ptw-waitpid pt-system old_pthread_atfork
+		       ptw-waitpid pt-system old_pthread_atfork pthread_atfork
 # Don't generate deps for calls with no sources.  See sysdeps/unix/Makefile.
 omit-deps = $(unix-syscalls:%=ptw-%)
 
 libpthread-shared-only-routines = pt-allocrtsig
+libpthread-static-only-routines = pthread_atfork
 
 libpthread-nonshared = pthread_atfork
 
@@ -78,7 +79,24 @@
 
 ifeq ($(build-shared),yes)
 
-extra-objs += crti.o crtn.o
+# Set the `multidir' variable by grabbing the variable from the compiler.
+# We do it once and save the result in a generated makefile.
+-include $(objpfx)multidir.mk
+$(objpfx)multidir.mk: $(common-objpfx)config.make
+	dir=`$(CC) $(CFLAGS) $(CPPFLAGS) -print-multi-directory`; \
+	echo "multidir := $$dir" > $@T
+	mv -f $@T $@
+generated += multidir.mk
+
+crti-objs := crti.o
+crtn-objs := crtn.o
+ifneq (,$(patsubst .,,$(multidir)))
+generated-dirs := $(firstword $(subst /, , $(multidir)))
+crti-objs += $(multidir)/crti.o
+crtn-objs += $(multidir)/crtn.o
+omit-deps += $(multidir)/crti $(multidir)/crtn
+endif
+extra-objs += $(crti-objs) $(crtn-objs)
 omit-deps += crti crtn
 
 CFLAGS-pt-initfini.s = -g0 -fPIC -fno-inline-functions
@@ -89,7 +107,7 @@
 	tststack $(tests-nodelete-$(have-z-nodelete)) ecmutex ex14 ex15 ex16 \
 	ex17 ex18 tst-cancel tst-context bug-sleep \
 	tst-cancel1 tst-cancel2 tst-cancel3 tst-cancel4 tst-cancel5 \
-	tst-cancel6 tst-popen tst-popen2
+	tst-cancel6 tst-cancel7 tst-popen tst-popen2
 test-srcs = tst-signal
 # These tests are linked with libc before libpthread
 tests-reverse += tst-cancel5
@@ -103,7 +121,7 @@
 tests-nodelete-yes = unload
 endif
 
-include ../Rules
+all: # Make this the default target; it will be defined in Rules.
 
 # What we install as libpthread.so for programs to link against is in fact a
 # link script.  It contains references for the various libraries we need.
@@ -131,9 +149,9 @@
 
 
 extra-B-pthread.so = -B$(common-objpfx)linuxthreads/
-$(objpfx)libpthread.so: $(objpfx)crti.o $(objpfx)crtn.o
-$(objpfx)libpthread.so: +preinit += $(objpfx)crti.o
-$(objpfx)libpthread.so: +postinit += $(objpfx)crtn.o
+$(objpfx)libpthread.so: $(addprefix $(objpfx),$(crti-objs) $(crtn-objs))
+$(objpfx)libpthread.so: +preinit += $(addprefix $(objpfx),$(crti-objs))
+$(objpfx)libpthread.so: +postinit += $(addprefix $(objpfx),$(crtn-objs))
 
 znodelete-yes = -DHAVE_Z_NODELETE
 CFLAGS-mutex.c += -D__NO_WEAK_PTHREAD_ALIASES
@@ -186,6 +204,8 @@
 libc-link.so = $(common-objpfx)libc.so
 endif
 
+include ../Rules
+
 # Depend on libc.so so a DT_NEEDED is generated in the shared objects.
 # This ensures they will load libc.so for needed symbols if loaded by
 # a statically-linked program that hasn't already loaded it.
@@ -204,6 +224,7 @@
 $(addprefix $(objpfx), $(tests-reverse)): \
   $(objpfx)../libc.so $(objpfx)libpthread.so \
   $(objpfx)libpthread_nonshared.a
+$(objpfx)../libc.so: $(common-objpfx)libc.so ;
 $(addprefix $(objpfx),$(librt-tests)): $(common-objpfx)rt/librt.so
 $(objpfx)unload: $(common-objpfx)dlfcn/libdl.so
 $(objpfx)unload.out: $(objpfx)libpthread.so $(objpfx)libpthread_nonshared.a
@@ -248,6 +269,17 @@
 $(objpfx)crtn.o: $(objpfx)crtn.S $(objpfx)defs.h
 	$(compile.S) -g0 $(ASFLAGS-.os) -o $@
 
+ifneq ($(multidir),.)
+$(objpfx)$(multidir):
+	@mkdir -p $(objpfx)$(multidir)
+
+$(objpfx)$(multidir)/crti.o: $(objpfx)crti.o $(objpfx)$(multidir)
+	ln -f $< $@
+
+$(objpfx)$(multidir)/crtn.o: $(objpfx)crtn.o $(objpfx)$(multidir)
+	ln -f $< $@
+endif
+
 generated += crti.S crtn.S defs.h pt-initfini.s
 endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/Versions libc-20030708/linuxthreads/Versions
--- glibc-2.3.2/linuxthreads/Versions	2003-01-03 07:33:45.000000000 +0900
+++ libc-20030708/linuxthreads/Versions	2003-07-08 22:58:07.000000000 +0900
@@ -31,7 +31,8 @@
 
     __libc_creat; __libc_poll; __libc_pselect; __libc_select;
     __libc_sigpause; __libc_sigsuspend; __libc_sigwait; __libc_sigwaitinfo;
-    __libc_waitid; __libc___xpg_sigpause;
+    __libc_waitid; __libc___xpg_sigpause; __librt_enable_asynccancel;
+    __librt_disable_asynccancel; __librt_multiple_threads;
   }
 }
 
@@ -80,7 +81,7 @@
     sigwait;
 
     # Protected names for functions used in other shared objects.
-    __pthread_atfork; __pthread_initialize; __pthread_getspecific;
+    __pthread_atfork; __pthread_getspecific;
     __pthread_key_create; __pthread_mutex_destroy; __pthread_mutex_init;
     __pthread_mutex_lock; __pthread_mutex_trylock; __pthread_mutex_unlock;
     __pthread_mutexattr_destroy; __pthread_mutexattr_init;
@@ -147,7 +148,7 @@
     pthread_getcpuclockid;
     pthread_barrier_destroy; pthread_barrier_init; pthread_barrier_wait;
     pthread_barrierattr_destroy; pthread_barrierattr_init;
-    pthread_barrierattr_getpshared; pthread_barrierattr_setpshared;
+    pthread_barrierattr_setpshared;
     pthread_mutex_timedlock;
     pthread_rwlock_timedrdlock; pthread_rwlock_timedwrlock;
 
@@ -170,6 +171,7 @@
   }
   GLIBC_PRIVATE {
     # Internal libc interface to libpthread
+    __pthread_initialize;
     __pthread_kill_other_threads_np;
   }
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/alloca_cutoff.c libc-20030708/linuxthreads/alloca_cutoff.c
--- glibc-2.3.2/linuxthreads/alloca_cutoff.c	2002-12-28 19:06:33.000000000 +0900
+++ libc-20030708/linuxthreads/alloca_cutoff.c	2003-04-01 21:00:54.000000000 +0900
@@ -1,5 +1,5 @@
 /* Determine whether block of given size can be allocated on the stack or not.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -20,6 +20,7 @@
 #include <alloca.h>
 #include <stdlib.h>
 #include <sys/param.h>
+#include "internals.h"
 #include <sysdep-cancel.h>
 
 int
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/descr.h libc-20030708/linuxthreads/descr.h
--- glibc-2.3.2/linuxthreads/descr.h	2002-12-28 19:06:33.000000000 +0900
+++ libc-20030708/linuxthreads/descr.h	2003-04-28 23:53:21.000000000 +0900
@@ -23,6 +23,7 @@
 #include <stdint.h>
 #include <sys/types.h>
 #include <hp-timing.h>
+#include <tls.h>
 
 /* Fast thread-specific data internal to libc.  */
 enum __libc_tsd_key_t { _LIBC_TSD_KEY_MALLOC = 0,
@@ -106,22 +107,30 @@
 
 union dtv;
 
-
-struct _pthread_descr_struct {
-  /* XXX Remove this union for IA-64 style TLS module */
-  union {
-    struct {
+struct _pthread_descr_struct
+{
+#if !defined USE_TLS || !TLS_DTV_AT_TP
+  /* This overlaps tcbhead_t (see tls.h), as used for TLS without threads.  */
+  union
+  {
+    struct
+    {
       void *tcb;		/* Pointer to the TCB.  This is not always
 				   the address of this thread descriptor.  */
       union dtv *dtvp;
       pthread_descr self;	/* Pointer to this structure */
       int multiple_threads;
-#ifdef NEED_DL_SYSINFO
+# ifdef NEED_DL_SYSINFO
       uintptr_t sysinfo;
-#endif
+# endif
     } data;
     void *__padding[16];
   } p_header;
+# define p_multiple_threads p_header.data.multiple_threads
+#elif TLS_MULTIPLE_THREADS_IN_TCB
+  int p_multiple_threads;
+#endif
+
   pthread_descr p_nextlive, p_prevlive;
                                 /* Double chaining of active threads */
   pthread_descr p_nextwaiting;  /* Next element in the queue holding the thr */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/internals.h libc-20030708/linuxthreads/internals.h
--- glibc-2.3.2/linuxthreads/internals.h	2003-01-07 09:02:26.000000000 +0900
+++ libc-20030708/linuxthreads/internals.h	2003-07-08 22:58:07.000000000 +0900
@@ -29,6 +29,7 @@
 #include "descr.h"
 
 #include "semaphore.h"
+#include <pthread-functions.h>
 
 #ifndef THREAD_GETMEM
 # define THREAD_GETMEM(descr, member) descr->member
@@ -256,6 +257,7 @@
 
 /* Defined and used in libc.so.  */
 extern int __libc_multiple_threads attribute_hidden;
+extern int __librt_multiple_threads;
 
 /* Debugging */
 
@@ -377,6 +379,8 @@
 
 extern void __pthread_wait_for_restart_signal(pthread_descr self);
 
+extern void __pthread_sigsuspend (const sigset_t *mask) attribute_hidden;
+
 extern int __pthread_yield (void);
 
 extern int __pthread_rwlock_timedrdlock (pthread_rwlock_t *__restrict __rwlock,
@@ -465,9 +469,12 @@
 extern void __libc_disable_asynccancel (int oldtype)
   internal_function attribute_hidden;
 
+/* The two functions are in libc.so and are exported.  */
+extern int __librt_enable_asynccancel (void);
+extern void __librt_disable_asynccancel (int oldtype) internal_function;
+
 extern void __pthread_cleanup_upto (__jmp_buf target,
 				    char *targetframe) attribute_hidden;
-struct fork_block;
 extern pid_t __pthread_fork (struct fork_block *b) attribute_hidden;
 
 #if !defined NOT_IN_libc
@@ -478,7 +485,7 @@
 # define LIBC_CANCEL_HANDLED() \
   __asm (".globl " __SYMBOL_PREFIX "__libc_enable_asynccancel"); \
   __asm (".globl " __SYMBOL_PREFIX "__libc_disable_asynccancel")
-#elif defined NOT_IN_libc && defined IS_IN_libpthread
+#elif defined IS_IN_libpthread
 # define LIBC_CANCEL_ASYNC() \
   __pthread_enable_asynccancel ()
 # define LIBC_CANCEL_RESET(oldtype) \
@@ -486,70 +493,20 @@
 # define LIBC_CANCEL_HANDLED() \
   __asm (".globl " __SYMBOL_PREFIX "__pthread_enable_asynccancel"); \
   __asm (".globl " __SYMBOL_PREFIX "__pthread_disable_asynccancel")
+#elif defined IS_IN_librt
+# define LIBC_CANCEL_ASYNC() \
+  __librt_enable_asynccancel ()
+# define LIBC_CANCEL_RESET(oldtype) \
+  __librt_disable_asynccancel (oldtype)
+# define LIBC_CANCEL_HANDLED() \
+  __asm (".globl " __SYMBOL_PREFIX "__librt_enable_asynccancel"); \
+  __asm (".globl " __SYMBOL_PREFIX "__librt_disable_asynccancel")
 #else
 # define LIBC_CANCEL_ASYNC()    0 /* Just a dummy value.  */
 # define LIBC_CANCEL_RESET(val) ((void)(val)) /* Nothing, but evaluate it.  */
 # define LIBC_CANCEL_HANDLED()	/* Nothing.  */
 #endif
 
-/* Data type shared with libc.  The libc uses it to pass on calls to
-   the thread functions.  */
-struct pthread_functions
-{
-  pid_t (*ptr_pthread_fork) (struct fork_block *);
-  int (*ptr_pthread_attr_destroy) (pthread_attr_t *);
-  int (*ptr___pthread_attr_init_2_0) (pthread_attr_t *);
-  int (*ptr___pthread_attr_init_2_1) (pthread_attr_t *);
-  int (*ptr_pthread_attr_getdetachstate) (const pthread_attr_t *, int *);
-  int (*ptr_pthread_attr_setdetachstate) (pthread_attr_t *, int);
-  int (*ptr_pthread_attr_getinheritsched) (const pthread_attr_t *, int *);
-  int (*ptr_pthread_attr_setinheritsched) (pthread_attr_t *, int);
-  int (*ptr_pthread_attr_getschedparam) (const pthread_attr_t *,
-					 struct sched_param *);
-  int (*ptr_pthread_attr_setschedparam) (pthread_attr_t *,
-					 const struct sched_param *);
-  int (*ptr_pthread_attr_getschedpolicy) (const pthread_attr_t *, int *);
-  int (*ptr_pthread_attr_setschedpolicy) (pthread_attr_t *, int);
-  int (*ptr_pthread_attr_getscope) (const pthread_attr_t *, int *);
-  int (*ptr_pthread_attr_setscope) (pthread_attr_t *, int);
-  int (*ptr_pthread_condattr_destroy) (pthread_condattr_t *);
-  int (*ptr_pthread_condattr_init) (pthread_condattr_t *);
-  int (*ptr___pthread_cond_broadcast) (pthread_cond_t *);
-  int (*ptr___pthread_cond_destroy) (pthread_cond_t *);
-  int (*ptr___pthread_cond_init) (pthread_cond_t *,
-				  const pthread_condattr_t *);
-  int (*ptr___pthread_cond_signal) (pthread_cond_t *);
-  int (*ptr___pthread_cond_wait) (pthread_cond_t *, pthread_mutex_t *);
-  int (*ptr_pthread_equal) (pthread_t, pthread_t);
-  void (*ptr___pthread_exit) (void *);
-  int (*ptr_pthread_getschedparam) (pthread_t, int *, struct sched_param *);
-  int (*ptr_pthread_setschedparam) (pthread_t, int,
-				    const struct sched_param *);
-  int (*ptr_pthread_mutex_destroy) (pthread_mutex_t *);
-  int (*ptr_pthread_mutex_init) (pthread_mutex_t *,
-				 const pthread_mutexattr_t *);
-  int (*ptr_pthread_mutex_lock) (pthread_mutex_t *);
-  int (*ptr_pthread_mutex_trylock) (pthread_mutex_t *);
-  int (*ptr_pthread_mutex_unlock) (pthread_mutex_t *);
-  pthread_t (*ptr_pthread_self) (void);
-  int (*ptr_pthread_setcancelstate) (int, int *);
-  int (*ptr_pthread_setcanceltype) (int, int *);
-  void (*ptr_pthread_do_exit) (void *retval, char *currentframe);
-  void (*ptr_pthread_cleanup_upto) (__jmp_buf target,
-				    char *targetframe);
-  pthread_descr (*ptr_pthread_thread_self) (void);
-  int (*ptr_pthread_internal_tsd_set) (int key, const void *pointer);
-  void * (*ptr_pthread_internal_tsd_get) (int key);
-  void ** __attribute__ ((__const__))
-    (*ptr_pthread_internal_tsd_address) (int key);
-  int (*ptr_pthread_sigaction) (int sig, const struct sigaction * act,
-				struct sigaction *oact);
-  int (*ptr_pthread_sigwait) (const sigset_t *set, int *sig);
-  int (*ptr_pthread_raise) (int sig);
-};
-
-/* Variable in libc.so.  */
-extern struct pthread_functions __libc_pthread_functions attribute_hidden;
 extern int * __libc_pthread_init (const struct pthread_functions *functions);
 
 #if !defined NOT_IN_libc && !defined FLOATING_STACKS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/libc-cancellation.c libc-20030708/linuxthreads/libc-cancellation.c
--- glibc-2.3.2/linuxthreads/libc-cancellation.c	2003-01-03 08:26:04.000000000 +0900
+++ libc-20030708/linuxthreads/libc-cancellation.c	2003-07-08 22:58:07.000000000 +0900
@@ -31,7 +31,8 @@
 weak_extern (__pthread_do_exit)
 # endif
 
-int __libc_multiple_threads attribute_hidden;
+int __libc_multiple_threads attribute_hidden __attribute__((nocommon));
+strong_alias (__libc_multiple_threads, __librt_multiple_threads);
 
 /* The next two functions are similar to pthread_setcanceltype() but
    more specialized for the use in the cancelable functions like write().
@@ -49,6 +50,7 @@
 			(PTHREAD_CANCELED, CURRENT_STACK_FRAME), 0);
   return oldtype;
 }
+strong_alias (__libc_enable_asynccancel, __librt_enable_asynccancel)
 
 void
 internal_function attribute_hidden
@@ -57,5 +59,6 @@
   pthread_descr self = thread_self();
   LIBC_THREAD_SETMEM(self, p_canceltype, oldtype);
 }
+strong_alias (__libc_disable_asynccancel, __librt_disable_asynccancel)
 
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/manager.c libc-20030708/linuxthreads/manager.c
--- glibc-2.3.2/linuxthreads/manager.c	2003-01-12 17:37:35.000000000 +0900
+++ libc-20030708/linuxthreads/manager.c	2003-04-28 23:53:21.000000000 +0900
@@ -591,8 +591,8 @@
   if (new_thread == NULL)
     return EAGAIN;
 # if TLS_DTV_AT_TP
-  /* pthread_descr is right below TP.  */
-  --new_thread;
+  /* pthread_descr is below TP.  */
+  new_thread = (pthread_descr) ((char *) new_thread - TLS_PRE_TCB_SIZE);
 # endif
 #else
   /* Prevent warnings.  */
@@ -612,7 +612,7 @@
 	{
 #ifdef USE_TLS
 # if TLS_DTV_AT_TP
-	  ++new_thread;
+	  new_thread = (pthread_descr) ((char *) new_thread + TLS_PRE_TCB_SIZE);
 # endif
 	  _dl_deallocate_tls (new_thread, true);
 #endif
@@ -638,13 +638,13 @@
   new_thread_id = sseg + pthread_threads_counter;
   /* Initialize the thread descriptor.  Elements which have to be
      initialized to zero already have this value.  */
-#if defined USE_TLS && TLS_DTV_AT_TP
-  new_thread->p_header.data.tcb = new_thread + 1;
-#else
+#if !defined USE_TLS || !TLS_DTV_AT_TP
   new_thread->p_header.data.tcb = new_thread;
-#endif
   new_thread->p_header.data.self = new_thread;
-  new_thread->p_header.data.multiple_threads = 1;
+#endif
+#if TLS_MULTIPLE_THREADS_IN_TCB || !defined USE_TLS || !TLS_DTV_AT_TP
+  new_thread->p_multiple_threads = 1;
+#endif
   new_thread->p_tid = new_thread_id;
   new_thread->p_lock = &(__pthread_handles[sseg].h_lock);
   new_thread->p_cancelstate = PTHREAD_CANCEL_ENABLE;
@@ -806,7 +806,7 @@
       }
 #ifdef USE_TLS
 # if TLS_DTV_AT_TP
-    ++new_thread;
+    new_thread = (pthread_descr) ((char *) new_thread + TLS_PRE_TCB_SIZE);
 # endif
     _dl_deallocate_tls (new_thread, true);
 #endif
@@ -896,7 +896,7 @@
 
 #ifdef USE_TLS
 # if TLS_DTV_AT_TP
-      ++th;
+      th = (pthread_descr) ((char *) th + TLS_PRE_TCB_SIZE);
 # endif
       _dl_deallocate_tls (th, true);
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/pthread.c libc-20030708/linuxthreads/pthread.c
--- glibc-2.3.2/linuxthreads/pthread.c	2003-01-17 03:14:41.000000000 +0900
+++ libc-20030708/linuxthreads/pthread.c	2003-04-28 23:53:21.000000000 +0900
@@ -529,6 +529,10 @@
   sigemptyset(&mask);
   sigaddset(&mask, __pthread_sig_restart);
   sigprocmask(SIG_BLOCK, &mask, NULL);
+  /* And unblock __pthread_sig_cancel if it has been blocked. */
+  sigdelset(&mask, __pthread_sig_restart);
+  sigaddset(&mask, __pthread_sig_cancel);
+  sigprocmask(SIG_UNBLOCK, &mask, NULL);
   /* Register an exit function to kill all other threads. */
   /* Do it early so that user-registered atexit functions are called
      before pthread_*exit_process. */
@@ -566,8 +570,10 @@
 #endif
 
   __pthread_multiple_threads = 1;
-  __pthread_main_thread->p_header.data.multiple_threads = 1;
-  * __libc_multiple_threads_ptr = 1;
+#if TLS_MULTIPLE_THREADS_IN_TCB || !defined USE_TLS || !TLS_DTV_AT_TP
+  __pthread_main_thread->p_multiple_threads = 1;
+#endif
+  *__libc_multiple_threads_ptr = 1;
 
 #ifndef HAVE_Z_NODELETE
   if (__builtin_expect (&__dso_handle != NULL, 1))
@@ -606,14 +612,18 @@
 # elif TLS_DTV_AT_TP
   /* pthread_descr is located right below tcbhead_t which _dl_allocate_tls
      returns.  */
-  mgr = (pthread_descr) tcbp - 1;
+  mgr = (pthread_descr) ((char *) tcbp - TLS_PRE_TCB_SIZE);
 # endif
   __pthread_handles[1].h_descr = manager_thread = mgr;
 
   /* Initialize the descriptor.  */
+#if !defined USE_TLS || !TLS_DTV_AT_TP
   mgr->p_header.data.tcb = tcbp;
   mgr->p_header.data.self = mgr;
   mgr->p_header.data.multiple_threads = 1;
+#elif TLS_MULTIPLE_THREADS_IN_TCB
+  mgr->p_multiple_threads = 1;
+#endif
   mgr->p_lock = &__pthread_handles[1].h_lock;
 # ifndef HAVE___THREAD
   mgr->p_errnop = &mgr->p_errno;
@@ -1138,7 +1148,8 @@
   sigdelset(&mask, __pthread_sig_restart); /* Unblock the restart signal */
   THREAD_SETMEM(self, p_signal, 0);
   do {
-    sigsuspend(&mask);                   /* Wait for signal */
+    __pthread_sigsuspend(&mask);	/* Wait for signal.  Must not be a
+					   cancellation point. */
   } while (THREAD_GETMEM(self, p_signal) !=__pthread_sig_restart);
 
   READ_MEMORY_BARRIER(); /* See comment in __pthread_restart_new */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/alpha/elf/pt-initfini.c libc-20030708/linuxthreads/sysdeps/alpha/elf/pt-initfini.c
--- glibc-2.3.2/linuxthreads/sysdeps/alpha/elf/pt-initfini.c	2002-02-09 10:55:16.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/alpha/elf/pt-initfini.c	2003-07-08 22:58:07.000000000 +0900
@@ -45,18 +45,16 @@
 /*@_init_PROLOG_BEGINS*/				\n\
 	.section .init, \"ax\", @progbits		\n\
 	.globl	_init					\n\
-	.ent	_init					\n\
+	.type	_init,@function				\n\
+	.usepv	_init,std				\n\
 _init:							\n\
 	ldgp	$29, 0($27)				\n\
 	subq	$30, 16, $30				\n\
 	stq	$26, 0($30)				\n\
 	stq	$29, 8($30)				\n\
-	.prologue 1					\n\
 	jsr	$26, __pthread_initialize_minimal	\n\
 	ldq	$29, 8($30)				\n\
 	.align 3					\n\
-	.end	_init					\n\
-	.size	_init, 0				\n\
 /*@_init_PROLOG_ENDS*/					\n\
 							\n\
 /*@_init_EPILOG_BEGINS*/				\n\
@@ -70,7 +68,8 @@
 /*@_fini_PROLOG_BEGINS*/				\n\
 	.section .fini, \"ax\", @progbits		\n\
 	.globl	_fini					\n\
-	.ent	_fini					\n\
+	.type	_fini,@function				\n\
+	.usepv	_fini,std				\n\
 _fini:							\n\
 	ldgp	$29, 0($27)				\n\
 	subq	$30, 16, $30				\n\
@@ -78,8 +77,6 @@
 	stq	$29, 8($30)				\n\
 	.prologue 1					\n\
 	.align 3					\n\
-	.end	_fini					\n\
-	.size	_fini, 0				\n\
 /*@_fini_PROLOG_ENDS*/					\n\
 							\n\
 /*@_fini_EPILOG_BEGINS*/				\n\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/i386/tls.h libc-20030708/linuxthreads/sysdeps/i386/tls.h
--- glibc-2.3.2/linuxthreads/sysdeps/i386/tls.h	2003-02-26 09:46:32.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/i386/tls.h	2003-05-10 13:38:03.000000000 +0900
@@ -119,7 +119,7 @@
 #   include "useldt.h"		/* For the structure.  */
 #   define TLS_DO_MODIFY_LDT_KERNEL_CHECK(doit)				      \
   (__builtin_expect (GL(dl_osversion) < 131939, 0)			      \
-   ? "kernel too old for thread-local storage support"			      \
+   ? "kernel too old for thread-local storage support\n"			      \
    : (doit))
 #  endif
 
@@ -142,7 +142,7 @@
 		"d" (sizeof (ldt_entry)));				      \
   __builtin_expect (result, 0) == 0					      \
   ? ({ asm ("movw %w0, %%gs" : : "q" ((nr) * 8 + 7)); NULL; })		      \
-  : "cannot set up LDT for thread-local storage";			      \
+  : "cannot set up LDT for thread-local storage\n";			      \
 }))
 
 #  define TLS_DO_SET_THREAD_AREA(descr, secondcall)			      \
@@ -171,8 +171,8 @@
 
 #  ifdef __ASSUME_SET_THREAD_AREA_SYSCALL
 #   define TLS_SETUP_GS_SEGMENT(descr, secondcall)			      \
-  (TLS_DO_SET_THREAD_AREA (descr, firstcall)				      \
-   ? "set_thread_area failed when setting up thread-local storage" : NULL)
+  (TLS_DO_SET_THREAD_AREA (descr, secondcall)				      \
+   ? "set_thread_area failed when setting up thread-local storage\n" : NULL)
 #  elif defined __NR_set_thread_area
 #   define TLS_SETUP_GS_SEGMENT(descr, secondcall) \
   (TLS_DO_SET_THREAD_AREA (descr, secondcall)				      \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/i386/useldt.h libc-20030708/linuxthreads/sysdeps/i386/useldt.h
--- glibc-2.3.2/linuxthreads/sysdeps/i386/useldt.h	2002-12-19 07:49:52.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/i386/useldt.h	2003-04-28 23:53:21.000000000 +0900
@@ -22,6 +22,7 @@
 #ifndef __ASSEMBLER__
 #include <stddef.h>	/* For offsetof.  */
 #include <stdlib.h>	/* For abort().	 */
+#include <sysdep.h>
 
 
 /* We don't want to include the kernel header.	So duplicate the
@@ -109,7 +110,9 @@
 	     "int $0x80\n\t"						      \
 	     USETLS_LOAD_EBX						      \
 	     : "=&a" (__result)						      \
-	     : USETLS_EBX_ARG (&ldt_entry), "i" (__NR_set_thread_area));      \
+	     : USETLS_EBX_ARG (&ldt_entry), "i" (__NR_set_thread_area),	      \
+	       "m" (ldt_entry)						      \
+	     : "memory");						      \
       if (__result == 0)						      \
 	asm ("movw %w0, %%gs" :: "q" (__gs));				      \
       else								      \
@@ -127,7 +130,9 @@
 	     "int $0x80\n\t"						      \
 	     USETLS_LOAD_EBX						      \
 	     : "=&a" (__result)						      \
-	     : USETLS_EBX_ARG (&ldt_entry), "i" (__NR_set_thread_area));      \
+	     : USETLS_EBX_ARG (&ldt_entry), "i" (__NR_set_thread_area),	      \
+	       "m" (ldt_entry)						      \
+	     : "memory");						      \
       if (__result == 0)						      \
 	{								      \
 	  __gs = (ldt_entry.entry_number << 3) + 3;			      \
@@ -307,4 +312,3 @@
 /* Maximum size of the stack if the rlimit is unlimited.  */
 #define ARCH_STACK_MAX_SIZE	8*1024*1024
 #endif
-
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/ia64/pspinlock.c libc-20030708/linuxthreads/sysdeps/ia64/pspinlock.c
--- glibc-2.3.2/linuxthreads/sysdeps/ia64/pspinlock.c	2002-08-27 13:52:35.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/ia64/pspinlock.c	2003-03-08 07:22:38.000000000 +0900
@@ -1,5 +1,5 @@
 /* POSIX spinlock implementation.  ia64 version.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jes Sorensen <jes@linuxcare.com>
 
@@ -21,6 +21,7 @@
 #include <errno.h>
 #include <pthread.h>
 #include "internals.h"
+#include <ia64intrin.h>
 
 /* This implementation is inspired by the implementation used in the
    Linux kernel. */
@@ -28,21 +29,15 @@
 int
 __pthread_spin_lock (pthread_spinlock_t *lock)
 {
-  asm volatile
-    ("mov ar.ccv = r0\n\t"
-     "mov r3 = 1\n\t"
-     ";;\n"
-     "1:\n\t"
-     "ld4 r2 = %0\n\t"
-     ";;\n\t"
-     "cmp4.eq p0, p7 = r0, r2\n\t"
-     "(p7) br.cond.spnt.few 1b \n\t"
-     "cmpxchg4.acq r2 = %0, r3, ar.ccv\n\t"
-     ";;\n\t"
-     "cmp4.eq p0, p7 = r0, r2\n\t"
-     "(p7) br.cond.spnt.few 1b\n\t"
-     ";;\n"
-     :: "m" (lock) : "r2", "r3", "p7", "memory");
+  int *p = (int *) lock;
+  
+  while (__builtin_expect (__sync_val_compare_and_swap_si (p, 0, 1), 0))
+    {
+      /* Spin without using the atomic instruction.  */
+      do
+        __asm __volatile ("" : : : "memory");
+      while (*p);
+    }
   return 0;
 }
 weak_alias (__pthread_spin_lock, pthread_spin_lock)
@@ -51,16 +46,7 @@
 int
 __pthread_spin_trylock (pthread_spinlock_t *lock)
 {
-  int oldval;
-
-  asm volatile
-    ("mov ar.ccv = r0\n\t"
-     "mov r2 = 1\n\t"
-     ";;\n\t"
-     "cmpxchg4.acq %0 = %1, r2, ar.ccv\n\t"
-     ";;\n"
-     : "=r" (oldval) : "m" (lock) : "r2", "memory");
-  return oldval > 0 ? 0 : EBUSY;
+  return __sync_val_compare_and_swap_si ((int *) lock, 0, 1) == 0 ? 0 : EBUSY;
 }
 weak_alias (__pthread_spin_trylock, pthread_spin_trylock)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/ia64/tcb-offsets.sym libc-20030708/linuxthreads/sysdeps/ia64/tcb-offsets.sym
--- glibc-2.3.2/linuxthreads/sysdeps/ia64/tcb-offsets.sym	2003-01-17 03:20:08.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/ia64/tcb-offsets.sym	2003-04-28 23:53:21.000000000 +0900
@@ -3,7 +3,7 @@
 
 --
 #ifdef USE_TLS
-MULTIPLE_THREADS_OFFSET offsetof (struct _pthread_descr_struct, p_header.data.multiple_threads) - sizeof (struct _pthread_descr_struct)
+MULTIPLE_THREADS_OFFSET offsetof (struct _pthread_descr_struct, p_multiple_threads) - sizeof (struct _pthread_descr_struct)
 #else
 MULTIPLE_THREADS_OFFSET offsetof (tcbhead_t, multiple_threads)
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/ia64/tls.h libc-20030708/linuxthreads/sysdeps/ia64/tls.h
--- glibc-2.3.2/linuxthreads/sysdeps/ia64/tls.h	2003-01-17 03:20:08.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/ia64/tls.h	2003-03-02 20:44:20.000000000 +0900
@@ -98,6 +98,8 @@
 #  define INIT_THREAD_SELF(descr, nr) \
   (__thread_self = (struct _pthread_descr_struct *)(descr) + 1)
 
+# define TLS_MULTIPLE_THREADS_IN_TCB 1
+
 /* Get the thread descriptor definition.  */
 #  include <linuxthreads/descr.h>
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/mips/pspinlock.c libc-20030708/linuxthreads/sysdeps/mips/pspinlock.c
--- glibc-2.3.2/linuxthreads/sysdeps/mips/pspinlock.c	2002-08-27 13:52:36.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/mips/pspinlock.c	2003-03-14 13:22:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* POSIX spinlock implementation.  MIPS version.
-   Copyright (C) 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +32,9 @@
     ("\t\t\t# spin_lock\n"
      "1:\n\t"
      ".set	push\n\t"
+#if _MIPS_SIM == _MIPS_SIM_ABI32
      ".set	mips2\n\t"
+#endif
      "ll	%1,%3\n\t"
      "li	%2,1\n\t"
      "bnez	%1,1b\n\t"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/mips/pt-machine.h libc-20030708/linuxthreads/sysdeps/mips/pt-machine.h
--- glibc-2.3.2/linuxthreads/sysdeps/mips/pt-machine.h	2002-08-27 13:52:36.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/mips/pt-machine.h	2003-03-14 13:22:05.000000000 +0900
@@ -1,6 +1,7 @@
 /* Machine-dependent pthreads configuration and inline functions.
 
-   Copyright (C) 1996, 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1998, 2000, 2002, 2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ralf Baechle <ralf@gnu.org>.
    Based on the Alpha version by Richard Henderson <rth@tamu.edu>.
@@ -60,12 +61,22 @@
     ("/* Inline compare & swap */\n"
      "1:\n\t"
      ".set	push\n\t"
+#if _MIPS_SIM == _MIPS_SIM_ABI32
      ".set	mips2\n\t"
+#endif
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+     "lld	%1,%5\n\t"
+#else
      "ll	%1,%5\n\t"
+#endif
      "move	%0,$0\n\t"
      "bne	%1,%3,2f\n\t"
      "move	%0,%4\n\t"
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+     "scd	%0,%2\n\t"
+#else
      "sc	%0,%2\n\t"
+#endif
      ".set	pop\n\t"
      "beqz	%0,1b\n"
      "2:\n\t"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h libc-20030708/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h
--- glibc-2.3.2/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h	2002-09-14 17:55:04.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h	2003-03-02 20:44:12.000000000 +0900
@@ -1,6 +1,6 @@
 /* Machine-dependent pthreads configuration and inline functions.
    powerpc version.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -57,6 +57,16 @@
 /* Initialize the thread-unique value.  */
 #define INIT_THREAD_SELF(descr, nr)  (__thread_self = (descr))
 
+/* Access to data in the thread descriptor is easy.  */
+#define THREAD_GETMEM(descr, member) \
+  ((void) (descr), THREAD_SELF->member)
+#define THREAD_GETMEM_NC(descr, member) \
+  ((void) (descr), THREAD_SELF->member)
+#define THREAD_SETMEM(descr, member, value) \
+  ((void) (descr), THREAD_SELF->member = (value))
+#define THREAD_SETMEM_NC(descr, member, value) \
+  ((void) (descr), THREAD_SELF->member = (value))
+
 /* Compare-and-swap for semaphores. */
 /* note that test-and-set(x) is the same as !compare-and-swap(x, 0, 1) */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/powerpc/pspinlock.c libc-20030708/linuxthreads/sysdeps/powerpc/pspinlock.c
--- glibc-2.3.2/linuxthreads/sysdeps/powerpc/pspinlock.c	2002-08-27 13:52:36.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/powerpc/pspinlock.c	2003-06-12 08:53:47.000000000 +0900
@@ -1,5 +1,5 @@
 /* POSIX spinlock implementation.  PowerPC version.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -55,7 +55,7 @@
   /* We can ignore the `pshared' parameter.  Since we are busy-waiting
      all processes which can access the memory location `lock' points
      to can use the spinlock.  */
-  *lock = 1;
+  *lock = 0;
   return 0;
 }
 weak_alias (__pthread_spin_init, pthread_spin_init)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/powerpc/tcb-offsets.sym libc-20030708/linuxthreads/sysdeps/powerpc/tcb-offsets.sym
--- glibc-2.3.2/linuxthreads/sysdeps/powerpc/tcb-offsets.sym	2003-02-18 05:32:09.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/powerpc/tcb-offsets.sym	2003-04-28 23:53:21.000000000 +0900
@@ -1,4 +1,24 @@
 #include <sysdep.h>
 #include <tls.h>
 
-MULTIPLE_THREADS_OFFSET		offsetof (tcbhead_t, multiple_threads)
+--
+
+-- This could go into powerpc32/ instead and conditionalize #include of it.
+#ifndef __powerpc64__
+
+# ifdef USE_TLS
+
+-- Abuse tls.h macros to derive offsets relative to the thread register.
+#  undef __thread_register
+#  define __thread_register	((void *) 0)
+#  define thread_offsetof(mem)	((void *) &THREAD_SELF->p_##mem - (void *) 0)
+
+# else
+
+#  define thread_offsetof(mem)	offsetof (tcbhead_t, mem)
+
+# endif
+
+MULTIPLE_THREADS_OFFSET		thread_offsetof (multiple_threads)
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/powerpc/tls.h libc-20030708/linuxthreads/sysdeps/powerpc/tls.h
--- glibc-2.3.2/linuxthreads/sysdeps/powerpc/tls.h	2003-02-28 07:40:10.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/powerpc/tls.h	2003-04-28 23:53:21.000000000 +0900
@@ -32,15 +32,6 @@
   void *pointer;
 } dtv_t;
 
-typedef struct
-{
-  void *tcb;		/* Pointer to the TCB.  Not necessary the
-			   thread descriptor used by libpthread.  */
-  dtv_t *dtv;
-  void *self;		/* Pointer to the thread descriptor.  */
-  int multiple_threads;
-} tcbhead_t;
-
 #else /* __ASSEMBLER__ */
 # include <tcb-offsets.h>
 #endif /* __ASSEMBLER__ */
@@ -52,28 +43,38 @@
 
 # ifndef __ASSEMBLER__
 
+/* This layout is actually wholly private and not affected by the ABI.
+   Nor does it overlap the pthread data structure, so we need nothing
+   extra here at all.  */
+typedef struct
+{
+  dtv_t *dtv;
+} tcbhead_t;
+
 /* This is the size of the initial TCB.  */
-#  define TLS_INIT_TCB_SIZE	sizeof (tcbhead_t)
+#  define TLS_INIT_TCB_SIZE	0
 
 /* Alignment requirements for the initial TCB.  */
-#  define TLS_INIT_TCB_ALIGN	__alignof__ (tcbhead_t)
+#  define TLS_INIT_TCB_ALIGN	__alignof__ (struct _pthread_descr_struct)
 
 /* This is the size of the TCB.  */
-#  define TLS_TCB_SIZE		sizeof (tcbhead_t)
+#  define TLS_TCB_SIZE		0
 
 /* Alignment requirements for the TCB.  */
-#  define TLS_TCB_ALIGN		__alignof__ (tcbhead_t)
+#  define TLS_TCB_ALIGN		__alignof__ (struct _pthread_descr_struct)
 
 /* This is the size we need before TCB.  */
-#  define TLS_PRE_TCB_SIZE	sizeof (struct _pthread_descr_struct)
+#  define TLS_PRE_TCB_SIZE \
+  (sizeof (struct _pthread_descr_struct)				      \
+   + ((sizeof (tcbhead_t) + TLS_TCB_ALIGN - 1) & ~(TLS_TCB_ALIGN - 1)))
 
-/* The following assumes that TP (R13) is points to the end of the
+/* The following assumes that TP (R2 or R13) is points to the end of the
    TCB + 0x7000 (per the ABI).  This implies that TCB address is
-   R13-(TLS_TCB_SIZE + 0x7000).  As we define TLS_DTV_AT_TP we can
+   TP - 0x7000.  As we define TLS_DTV_AT_TP we can
    assume that the pthread_descr is allocated immediately ahead of the
    TCB.  This implies that the pthread_descr address is
-   R13-(TLS_PRE_TCB_SIZE + TLS_TCB_SIZE + 0x7000).  */
-#  define TLS_TCB_OFFSET	0x7000
+   TP - (TLS_PRE_TCB_SIZE + 0x7000).  */
+#define TLS_TCB_OFFSET		0x7000
 
 /* The DTV is allocated at the TP; the TCB is placed elsewhere.  */
 /* This is not really true for powerpc64.  We are following alpha
@@ -83,13 +84,13 @@
 /* Install the dtv pointer.  The pointer passed is to the element with
    index -1 which contain the length.  */
 #  define INSTALL_DTV(TCBP, DTVP) \
-  (((tcbhead_t *) (TCBP))->dtv = (DTVP) + 1)
+  (((tcbhead_t *) (TCBP))[-1].dtv = (DTVP) + 1)
 
 /* Install new dtv for current thread.  */
 #  define INSTALL_NEW_DTV(DTV) (THREAD_DTV() = (DTV))
 
 /* Return dtv of given thread descriptor.  */
-#  define GET_DTV(TCBP)	(((tcbhead_t *) (TCBP))->dtv)
+#  define GET_DTV(TCBP)	(((tcbhead_t *) (TCBP))[-1].dtv)
 
 /* The global register variable is declared in pt-machine.h with
    the wrong type, but the compiler doesn't like us declaring another.  */
@@ -99,47 +100,57 @@
    special attention since 'errno' is not yet available and if the
    operation can cause a failure 'errno' must not be touched.  */
 # define TLS_INIT_TP(TCBP, SECONDCALL) \
-    (__thread_register = (void *) (TCBP) + TLS_TCB_OFFSET + TLS_TCB_SIZE, 0)
+    (__thread_register = (void *) (TCBP) + TLS_TCB_OFFSET, NULL)
 
 /* Return the address of the dtv for the current thread.  */
 #  define THREAD_DTV() \
-     (((tcbhead_t *) (__thread_register - TLS_TCB_OFFSET - TLS_TCB_SIZE))->dtv)
+     (((tcbhead_t *) (__thread_register - TLS_TCB_OFFSET))[-1].dtv)
 
 /* Return the thread descriptor for the current thread.  */
 #  undef THREAD_SELF
 #  define THREAD_SELF \
     ((pthread_descr) (__thread_register \
-		      - TLS_TCB_OFFSET - TLS_TCB_SIZE - TLS_PRE_TCB_SIZE))
+		      - TLS_TCB_OFFSET - TLS_PRE_TCB_SIZE))
 
 #  undef INIT_THREAD_SELF
 #  define INIT_THREAD_SELF(DESCR, NR) \
      (__thread_register = ((void *) (DESCR) \
-		           + TLS_TCB_OFFSET + TLS_TCB_SIZE + TLS_PRE_TCB_SIZE))
+		           + TLS_TCB_OFFSET + TLS_PRE_TCB_SIZE))
+
+/* Make sure we have the p_multiple_threads member in the thread structure.
+   See below.  */
+#  ifndef __powerpc64__
+#   define TLS_MULTIPLE_THREADS_IN_TCB 1
+#  endif
 
 /* Get the thread descriptor definition.  */
 #  include <linuxthreads/descr.h>
 
-/* Generic bits of LinuxThreads may call these macros with
-   DESCR set to NULL.  We are expected to be able to reference
-   the "current" value.  */
-
-#  define THREAD_GETMEM(descr, member) \
-     ((void) sizeof (descr), THREAD_SELF->member)
-#  define THREAD_SETMEM(descr, member, value) \
-     ((void) sizeof (descr), THREAD_SELF->member = (value))
-
-#define THREAD_GETMEM_NC(descr, member) THREAD_GETMEM (descr, member)
-#define THREAD_SETMEM_NC(descr, member, value) \
-  THREAD_SETMEM ((descr), member, (value))
+/* l_tls_offset == 0 is perfectly valid on PPC, so we have to use some
+   different value to mean unset l_tls_offset.  */
+#  define NO_TLS_OFFSET	-1
 
 # endif /* __ASSEMBLER__ */
 
-#else /* Not HAVE_TLS_SUPPORT.  */
+#elif !defined __ASSEMBLER__ && !defined __powerpc64__
+
+/* This overlaps the start of the pthread_descr.  On PPC32, system
+   calls and such use this to find the multiple_threads flag and need
+   to use the same offset relative to the thread register in both
+   single-threaded and multi-threaded code.  On PPC64, the global
+   variable is always used, so single-threaded code without TLS
+   never needs to initialize the thread register at all.  */
+typedef struct
+{
+  void *tcb;			/* Never used.  */
+  dtv_t *dtv;			/* Never used.  */
+  void *self;			/* Used only if multithreaded, and rarely.  */
+  int multiple_threads;		/* Only this member is really used.  */
+} tcbhead_t;
 
 #define NONTLS_INIT_TP							\
   do {									\
-    static const tcbhead_t nontls_init_tp				\
-      = { .multiple_threads = 0 };					\
+    static const tcbhead_t nontls_init_tp = { .multiple_threads = 0 };	\
     __thread_self = (__typeof (__thread_self)) &nontls_init_tp;		\
   } while (0)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/Makefile libc-20030708/linuxthreads/sysdeps/pthread/Makefile
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/Makefile	2003-02-13 06:40:09.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/Makefile	2003-03-20 02:57:45.000000000 +0900
@@ -9,5 +9,5 @@
 endif
 
 ifeq ($(subdir),posix)
-CFLAGS-confstr.c += -DLIBPTHREAD_VERSION="\"$(shell sed 's/\(.*\) by .*/\1/' ../nptl/Banner)\""
+CFLAGS-confstr.c += -DLIBPTHREAD_VERSION="\"$(shell sed 's/\(.*\) by .*/\1/' ../linuxthreads/Banner)\""
 endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/bits/#libc-tsd.h# libc-20030708/linuxthreads/sysdeps/pthread/bits/#libc-tsd.h#
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/bits/#libc-tsd.h#	2003-01-04 07:10:19.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/bits/#libc-tsd.h#	1970-01-01 09:00:00.000000000 +0900
@@ -1,59 +0,0 @@
-/* libc-internal interface for thread-specific data.  LinuxThreads version.
-   Copyright (C) 1997,98,99,2001,02 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public License as
-   published by the Free Software Foundation; either version 2.1 of the
-   License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; see the file COPYING.LIB.  If not,
-   write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
-   Boston, MA 02111-1307, USA.  */
-
-#ifndef _BITS_LIBC_TSD_H
-#define _BITS_LIBC_TSD_H 1
-
-#include <linuxthreads/descr.h>
-#include <tls.h>
-
-#if USE_TLS && HAVE___THREAD
-
-/* When __thread works, the generic definition is what we want.  */
-# include <sysdeps/generic/bits/libc-tsd.h>
-
-#else
-
-# include <bits/libc-lock.h>
-
-# ifndef SHARED
-extern void ** __pthread_internal_tsd_address (int);
-extern void *__pthread_internal_tsd_get (int);
-extern int __pthread_internal_tsd_set (int, const void *);
-
-weak_extern (__pthread_internal_tsd_address)
-weak_extern (__pthread_internal_tsd_get)
-weak_extern (__pthread_internal_tsd_set)
-# endif
-
-#define __libc_tsd_define(CLASS, KEY)	CLASS void *__libc_tsd_##KEY##_data;
-#define __libc_tsd_address(KEY) \
-  __libc_maybe_call2 (pthread_internal_tsd_address,			\
-		      (_LIBC_TSD_KEY_##KEY), &__libc_tsd_##KEY##_data)
-#define __libc_tsd_get(KEY) \
-  __libc_maybe_call2 (pthread_internal_tsd_get,				\
-		      (_LIBC_TSD_KEY_##KEY), __libc_tsd_##KEY##_data)
-#define __libc_tsd_set(KEY, VALUE) \
-  __libc_maybe_call2 (pthread_internal_tsd_set,				\
-		      (_LIBC_TSD_KEY_##KEY, (VALUE)),			\
-		       (__libc_tsd_##KEY##_data = (VALUE), 0))
-
-#endif
-
-#endif	/* bits/libc-tsd.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/bits/typesizes.h libc-20030708/linuxthreads/sysdeps/pthread/bits/typesizes.h
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/bits/typesizes.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/bits/typesizes.h	2003-03-26 05:39:24.000000000 +0900
@@ -0,0 +1,65 @@
+/* bits/typesizes.h -- underlying types for *_t.  Generic version.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _BITS_TYPES_H
+# error "Never include <bits/typesizes.h> directly; use <sys/types.h> instead."
+#endif
+
+#ifndef	_BITS_TYPESIZES_H
+#define	_BITS_TYPESIZES_H	1
+
+/* See <bits/types.h> for the meaning of these macros.  This file exists so
+   that <bits/types.h> need not vary across different GNU platforms.  */
+
+#define __DEV_T_TYPE		__UQUAD_TYPE
+#define __UID_T_TYPE		__U32_TYPE
+#define __GID_T_TYPE		__U32_TYPE
+#define __INO_T_TYPE		__ULONGWORD_TYPE
+#define __INO64_T_TYPE		__UQUAD_TYPE
+#define __MODE_T_TYPE		__U32_TYPE
+#define __NLINK_T_TYPE		__UWORD_TYPE
+#define __OFF_T_TYPE		__SLONGWORD_TYPE
+#define __OFF64_T_TYPE		__SQUAD_TYPE
+#define __PID_T_TYPE		__S32_TYPE
+#define __RLIM_T_TYPE		__ULONGWORD_TYPE
+#define __RLIM64_T_TYPE		__UQUAD_TYPE
+#define	__BLKCNT_T_TYPE		__SLONGWORD_TYPE
+#define	__BLKCNT64_T_TYPE	__SQUAD_TYPE
+#define	__FSBLKCNT_T_TYPE	__ULONGWORD_TYPE
+#define	__FSBLKCNT64_T_TYPE	__UQUAD_TYPE
+#define	__FSFILCNT_T_TYPE	__ULONGWORD_TYPE
+#define	__FSFILCNT64_T_TYPE	__UQUAD_TYPE
+#define	__ID_T_TYPE		__U32_TYPE
+#define __CLOCK_T_TYPE		__SLONGWORD_TYPE
+#define __TIME_T_TYPE		__SLONGWORD_TYPE
+#define __USECONDS_T_TYPE	__U32_TYPE
+#define __SUSECONDS_T_TYPE	__SLONGWORD_TYPE
+#define __DADDR_T_TYPE		__S32_TYPE
+#define __SWBLK_T_TYPE		__SLONGWORD_TYPE
+#define __KEY_T_TYPE		__S32_TYPE
+#define __CLOCKID_T_TYPE	__S32_TYPE
+#define __TIMER_T_TYPE		__S32_TYPE
+#define __BLKSIZE_T_TYPE	__SLONGWORD_TYPE
+#define __FSID_T_TYPE		struct { int __val[2]; }
+
+/* Number of descriptors that can fit in an `fd_set'.  */
+#define	__FD_SETSIZE		1024
+
+
+#endif /* bits/typesizes.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/errno-loc.c libc-20030708/linuxthreads/sysdeps/pthread/errno-loc.c
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/errno-loc.c	2003-01-01 04:14:22.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/errno-loc.c	2003-04-01 21:00:55.000000000 +0900
@@ -1,6 +1,6 @@
 /* MT support function to get address of `errno' variable, linuxthreads
    version.
-   Copyright (C) 1996, 1998, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1998, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -20,6 +20,7 @@
 
 #include <errno.h>
 #include <tls.h>
+#include <linuxthreads/internals.h>
 #include <sysdep-cancel.h>
 
 #if ! USE___THREAD
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/herrno-loc.c libc-20030708/linuxthreads/sysdeps/pthread/herrno-loc.c
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/herrno-loc.c	2003-01-01 04:14:22.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/herrno-loc.c	2003-04-01 21:00:55.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 97, 98, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 97, 98, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -18,6 +18,7 @@
 
 #include <netdb.h>
 #include <tls.h>
+#include <linuxthreads/internals.h>
 #include <sysdep-cancel.h>
 
 #if ! USE___THREAD
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/pthread-functions.h libc-20030708/linuxthreads/sysdeps/pthread/pthread-functions.h
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/pthread-functions.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/pthread-functions.h	2003-04-20 16:37:06.000000000 +0900
@@ -0,0 +1,88 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _PTHREAD_FUNCTIONS_H
+#define _PTHREAD_FUNCTIONS_H	1
+
+#include <pthread.h>
+#include <setjmp.h>
+#include <linuxthreads/descr.h>
+
+struct fork_block;
+
+/* Data type shared with libc.  The libc uses it to pass on calls to
+   the thread functions.  */
+struct pthread_functions
+{
+  pid_t (*ptr_pthread_fork) (struct fork_block *);
+  int (*ptr_pthread_attr_destroy) (pthread_attr_t *);
+  int (*ptr___pthread_attr_init_2_0) (pthread_attr_t *);
+  int (*ptr___pthread_attr_init_2_1) (pthread_attr_t *);
+  int (*ptr_pthread_attr_getdetachstate) (const pthread_attr_t *, int *);
+  int (*ptr_pthread_attr_setdetachstate) (pthread_attr_t *, int);
+  int (*ptr_pthread_attr_getinheritsched) (const pthread_attr_t *, int *);
+  int (*ptr_pthread_attr_setinheritsched) (pthread_attr_t *, int);
+  int (*ptr_pthread_attr_getschedparam) (const pthread_attr_t *,
+					 struct sched_param *);
+  int (*ptr_pthread_attr_setschedparam) (pthread_attr_t *,
+					 const struct sched_param *);
+  int (*ptr_pthread_attr_getschedpolicy) (const pthread_attr_t *, int *);
+  int (*ptr_pthread_attr_setschedpolicy) (pthread_attr_t *, int);
+  int (*ptr_pthread_attr_getscope) (const pthread_attr_t *, int *);
+  int (*ptr_pthread_attr_setscope) (pthread_attr_t *, int);
+  int (*ptr_pthread_condattr_destroy) (pthread_condattr_t *);
+  int (*ptr_pthread_condattr_init) (pthread_condattr_t *);
+  int (*ptr___pthread_cond_broadcast) (pthread_cond_t *);
+  int (*ptr___pthread_cond_destroy) (pthread_cond_t *);
+  int (*ptr___pthread_cond_init) (pthread_cond_t *,
+				  const pthread_condattr_t *);
+  int (*ptr___pthread_cond_signal) (pthread_cond_t *);
+  int (*ptr___pthread_cond_wait) (pthread_cond_t *, pthread_mutex_t *);
+  int (*ptr_pthread_equal) (pthread_t, pthread_t);
+  void (*ptr___pthread_exit) (void *);
+  int (*ptr_pthread_getschedparam) (pthread_t, int *, struct sched_param *);
+  int (*ptr_pthread_setschedparam) (pthread_t, int,
+				    const struct sched_param *);
+  int (*ptr_pthread_mutex_destroy) (pthread_mutex_t *);
+  int (*ptr_pthread_mutex_init) (pthread_mutex_t *,
+				 const pthread_mutexattr_t *);
+  int (*ptr_pthread_mutex_lock) (pthread_mutex_t *);
+  int (*ptr_pthread_mutex_trylock) (pthread_mutex_t *);
+  int (*ptr_pthread_mutex_unlock) (pthread_mutex_t *);
+  pthread_t (*ptr_pthread_self) (void);
+  int (*ptr_pthread_setcancelstate) (int, int *);
+  int (*ptr_pthread_setcanceltype) (int, int *);
+  void (*ptr_pthread_do_exit) (void *retval, char *currentframe);
+  void (*ptr_pthread_cleanup_upto) (__jmp_buf target,
+				    char *targetframe);
+  pthread_descr (*ptr_pthread_thread_self) (void);
+  int (*ptr_pthread_internal_tsd_set) (int key, const void *pointer);
+  void * (*ptr_pthread_internal_tsd_get) (int key);
+  void ** __attribute__ ((__const__))
+    (*ptr_pthread_internal_tsd_address) (int key);
+  int (*ptr_pthread_sigaction) (int sig, const struct sigaction * act,
+				struct sigaction *oact);
+  int (*ptr_pthread_sigwait) (const sigset_t *set, int *sig);
+  int (*ptr_pthread_raise) (int sig);
+};
+
+/* Variable in libc.so.  */
+extern struct pthread_functions __libc_pthread_functions attribute_hidden;
+
+#endif	/* pthread-functions.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/res-state.c libc-20030708/linuxthreads/sysdeps/pthread/res-state.c
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/res-state.c	2003-01-01 04:14:22.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/res-state.c	2003-04-01 21:00:55.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 97, 98, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 97, 98, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -18,6 +18,7 @@
 
 #include <resolv.h>
 #include <tls.h>
+#include <linuxthreads/internals.h>
 #include <sysdep-cancel.h>
 
 #if ! USE___THREAD
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/pthread/timer_create.c libc-20030708/linuxthreads/sysdeps/pthread/timer_create.c
--- glibc-2.3.2/linuxthreads/sysdeps/pthread/timer_create.c	2002-08-27 13:52:36.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/pthread/timer_create.c	2003-03-03 14:28:17.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Kaz Kylheku <kaz@ashi.footprints.net>.
 
@@ -37,15 +37,23 @@
   struct timer_node *newtimer = NULL;
   struct thread_node *thread = NULL;
 
-  if (clock_id != CLOCK_REALTIME
+  if (0
 #ifdef _POSIX_CPUTIME
-      && clock_id != CLOCK_PROCESS_CPUTIME_ID
+      || clock_id == CLOCK_PROCESS_CPUTIME_ID
 #endif
 #ifdef _POSIX_THREAD_CPUTIME
-      && clock_id != CLOCK_THREAD_CPUTIME_ID
+      || clock_id == CLOCK_THREAD_CPUTIME_ID
 #endif
       )
     {
+      /* We don't allow timers for CPU clocks.  At least not in the
+	 moment.  */
+      __set_errno (ENOTSUP);
+      return -1;
+    }
+
+  if (clock_id != CLOCK_REALTIME)
+    {
       __set_errno (EINVAL);
       return -1;
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/s390/pspinlock.c libc-20030708/linuxthreads/sysdeps/s390/pspinlock.c
--- glibc-2.3.2/linuxthreads/sysdeps/s390/pspinlock.c	2002-08-27 13:52:36.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/s390/pspinlock.c	2003-04-15 23:55:46.000000000 +0900
@@ -64,7 +64,7 @@
 {
   asm volatile("    xc 0(4,%0),0(%0)\n"
 	       "    bcr 15,0"
-	       : "=a" (lock) );
+	       : : "a" (lock) : "memory" );
   return 0;
 }
 weak_alias (__pthread_spin_unlock, pthread_spin_unlock)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/sh/tcb-offsets.sym libc-20030708/linuxthreads/sysdeps/sh/tcb-offsets.sym
--- glibc-2.3.2/linuxthreads/sysdeps/sh/tcb-offsets.sym	2003-02-08 11:29:53.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/sh/tcb-offsets.sym	2003-04-28 23:53:21.000000000 +0900
@@ -3,7 +3,7 @@
 
 --
 #ifdef USE_TLS
-MULTIPLE_THREADS_OFFSET offsetof (struct _pthread_descr_struct, p_header.data.multiple_threads)
+MULTIPLE_THREADS_OFFSET offsetof (struct _pthread_descr_struct, p_multiple_threads)
 TLS_PRE_TCB_SIZE	sizeof (struct _pthread_descr_struct)
 #else
 MULTIPLE_THREADS_OFFSET offsetof (tcbhead_t, multiple_threads)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/sh/tls.h libc-20030708/linuxthreads/sysdeps/sh/tls.h
--- glibc-2.3.2/linuxthreads/sysdeps/sh/tls.h	2003-02-08 11:29:53.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/sh/tls.h	2003-03-02 20:44:20.000000000 +0900
@@ -112,6 +112,8 @@
      __asm __volatile ("ldc %0,gbr" : : "r" (__self + 1));		      \
      0; })
 
+# define TLS_MULTIPLE_THREADS_IN_TCB 1
+
 /* Get the thread descriptor definition.  This must be after the
    the definition of THREAD_SELF for TLS.  */
 #  include <linuxthreads/descr.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/Makefile libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/Makefile
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/Makefile	2003-01-07 08:49:01.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/Makefile	2003-07-08 22:58:07.000000000 +0900
@@ -1,3 +1,3 @@
 ifeq ($(subdir),linuxthreads)
-libpthread-routines += ptw-sysdep ptw-sigblock ptw-sigprocmask ptw-osf_sigprocmask
+libpthread-routines += ptw-sysdep ptw-sigblock ptw-sigprocmask
 endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h	2003-03-26 07:03:21.000000000 +0900
@@ -0,0 +1,65 @@
+/* bits/typesizes.h -- underlying types for *_t.  Linux/Alpha version.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _BITS_TYPES_H
+# error "Never include <bits/typesizes.h> directly; use <sys/types.h> instead."
+#endif
+
+#ifndef	_BITS_TYPESIZES_H
+#define	_BITS_TYPESIZES_H	1
+
+/* See <bits/types.h> for the meaning of these macros.  This file exists so
+   that <bits/types.h> need not vary across different GNU platforms.  */
+
+#define __DEV_T_TYPE		__U64_TYPE
+#define __UID_T_TYPE		__U32_TYPE
+#define __GID_T_TYPE		__U32_TYPE
+#define __INO_T_TYPE		__U32_TYPE
+#define __INO64_T_TYPE		__U64_TYPE
+#define __MODE_T_TYPE		__U32_TYPE
+#define __NLINK_T_TYPE		__U32_TYPE
+#define __OFF_T_TYPE		__SLONGWORD_TYPE
+#define __OFF64_T_TYPE		__S64_TYPE
+#define __PID_T_TYPE		__S32_TYPE
+#define __RLIM_T_TYPE		__ULONGWORD_TYPE
+#define __RLIM64_T_TYPE		__U64_TYPE
+#define	__BLKCNT_T_TYPE		__U32_TYPE
+#define	__BLKCNT64_T_TYPE	__U64_TYPE
+#define	__FSBLKCNT_T_TYPE	__S32_TYPE
+#define	__FSBLKCNT64_T_TYPE	__S64_TYPE
+#define	__FSFILCNT_T_TYPE	__U32_TYPE
+#define	__FSFILCNT64_T_TYPE	__U64_TYPE
+#define	__ID_T_TYPE		__U32_TYPE
+#define __CLOCK_T_TYPE		__SLONGWORD_TYPE
+#define __TIME_T_TYPE		__SLONGWORD_TYPE
+#define __USECONDS_T_TYPE	__U32_TYPE
+#define __SUSECONDS_T_TYPE	__S64_TYPE
+#define __DADDR_T_TYPE		__S32_TYPE
+#define __SWBLK_T_TYPE		__SLONGWORD_TYPE
+#define __KEY_T_TYPE		__S32_TYPE
+#define __CLOCKID_T_TYPE	__S32_TYPE
+#define __TIMER_T_TYPE		__S32_TYPE
+#define __BLKSIZE_T_TYPE	__U32_TYPE
+#define __FSID_T_TYPE		struct { int __val[2]; }
+
+/* Number of descriptors that can fit in an `fd_set'.  */
+#define	__FD_SETSIZE		1024
+
+
+#endif /* bits/typesizes.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/pt-sigsuspend.S libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/pt-sigsuspend.S
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/pt-sigsuspend.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/pt-sigsuspend.S	2003-04-02 09:10:44.000000000 +0900
@@ -0,0 +1,28 @@
+/* Internal sigsuspend system call for LinuxThreads.  Alpha version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#undef PSEUDO_PREPARE_ARGS
+#define PSEUDO_PREPARE_ARGS	ldq	a0, 0(a0);
+
+	.hidden __pthread_sigsuspend
+PSEUDO_NOERRNO(__pthread_sigsuspend, sigsuspend, 1)
+	ret
+PSEUDO_END_NOERRNO(__pthread_sigsuspend)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/sysdep-cancel.h	2003-01-13 04:19:43.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/sysdep-cancel.h	2003-06-12 08:53:48.000000000 +0900
@@ -40,10 +40,11 @@
 # define PSEUDO(name, syscall_name, args)			\
 	.globl name;						\
 	.align 4;						\
-	.ent name, 0;						\
+	.type name, @function;					\
+	.usepv name, std;					\
+	cfi_startproc;						\
 __LABEL(name)							\
 	ldgp	gp, 0(pv);					\
-	.prologue 1;						\
 	PSEUDO_PROF;						\
 	PSEUDO_PREPARE_ARGS					\
 	SINGLE_THREAD_P(t0);					\
@@ -55,7 +56,9 @@
 	.subsection 2;						\
 __LABEL($pseudo_cancel)						\
 	subq	sp, 64, sp;					\
+	cfi_def_cfa_offset(64);					\
 	stq	ra, 0(sp);					\
+	cfi_offset(ra, -64);					\
 	SAVE_ARGS_##args;					\
 	CENABLE;						\
 	LOAD_ARGS_##args;					\
@@ -67,19 +70,27 @@
 	ldq	ra, 0(sp);					\
 	ldq	v0, 8(sp);					\
 	addq	sp, 64, sp;					\
+	cfi_remember_state;					\
+	cfi_restore(ra);					\
+	cfi_def_cfa_offset(0);					\
 	ret;							\
+	cfi_restore_state;					\
 __LABEL($multi_error)						\
 	CDISABLE;						\
 	ldq	ra, 0(sp);					\
 	ldq	v0, 8(sp);					\
 	addq	sp, 64, sp;					\
+	cfi_restore(ra);					\
+	cfi_def_cfa_offset(0);					\
 __LABEL($syscall_error)						\
 	SYSCALL_ERROR_HANDLER;					\
-	END(name);						\
 	.previous
 
 # undef PSEUDO_END
-# define PSEUDO_END(sym)
+# define PSEUDO_END(sym)					\
+	.subsection 2;						\
+	cfi_endproc;						\
+	.size sym, .-sym
 
 # define SAVE_ARGS_0	/* Nothing.  */
 # define SAVE_ARGS_1	SAVE_ARGS_0; stq a0, 8(sp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/vfork.S libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/vfork.S
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/alpha/vfork.S	2003-02-11 15:24:43.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/alpha/vfork.S	2003-06-12 08:53:48.000000000 +0900
@@ -19,12 +19,13 @@
 
 #include <sysdep-cancel.h>
 
-	.globl __vfork
         .align 4
-        .ent __vfork,0
-__LABEL(__vfork)
+	.globl	__vfork
+	.type	__vfork, @function
+	.usepv	__vfork, std
+	cfi_startproc
+__vfork:
 	ldgp	gp, 0(pv)
-	.prologue 1
 	PSEUDO_PROF
 
 #ifdef SHARED
@@ -46,18 +47,24 @@
 	   fork and vfork object files.  */
 $do_fork:
 	subq	sp, 16, sp
+	cfi_adjust_cfa_offset(16)
 	stq	ra, 0(sp)
+	cfi_offset(ra, -16)
 	jsr	ra, HIDDEN_JUMPTARGET (__fork)
 	ldgp	gp, 0(ra)
 	ldq	ra, 0(sp)
 	addq	sp, 16, sp
+	cfi_restore(ra)
+	cfi_adjust_cfa_offset(-16)
 	ret
 
 $syscall_error:
 	SYSCALL_ERROR_HANDLER
 #endif
 
-PSEUDO_END(__vfork)
+	cfi_endproc
+	.size __vfork, .-__vfork
+
 libc_hidden_def (__vfork)
 
 weak_alias (__vfork, vfork)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/arm/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/arm/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/arm/sysdep-cancel.h	2003-01-12 18:13:57.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/arm/sysdep-cancel.h	2003-06-12 08:53:48.000000000 +0900
@@ -24,6 +24,17 @@
 
 #if !defined NOT_IN_libc || defined IS_IN_libpthread
 
+/* We push lr onto the stack, so we have to use ldmib instead of ldmia
+   to find the saved arguments.  */
+# ifdef PIC
+#  undef DOARGS_5
+#  undef DOARGS_6
+#  undef DOARGS_7
+#  define DOARGS_5 str r4, [sp, $-4]!; ldr r4, [sp, $8];
+#  define DOARGS_6 mov ip, sp; stmfd sp!, {r4, r5}; ldmib ip, {r4, r5};
+#  define DOARGS_7 mov ip, sp; stmfd sp!, {r4, r5, r6}; ldmib ip, {r4, r5, r6};
+# endif
+
 # undef PSEUDO_RET
 # define PSEUDO_RET						        \
     ldrcc pc, [sp], $4;						        \
@@ -34,7 +45,7 @@
 # define PSEUDO(name, syscall_name, args)				\
   .section ".text";							\
     PSEUDO_PROLOGUE;							\
-  ENTRY (name)								\
+  ENTRY (name);								\
     SINGLE_THREAD_P_INT;						\
     bne .Lpseudo_cancel;						\
     DO_CALL (syscall_name, args);					\
@@ -110,7 +121,7 @@
   ldr reg, 2b;								\
 3:									\
   add ip, pc, ip;							\
-  ldr ip, [ip, lr];							\
+  ldr ip, [ip, reg];							\
   teq ip, #0;
 #   define SINGLE_THREAD_P_INT						\
   str lr, [sp, $-4]!;							\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/bits/posix_opt.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/bits/posix_opt.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/bits/posix_opt.h	2002-11-29 10:48:24.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/bits/posix_opt.h	2003-03-03 13:55:24.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define POSIX options for Linux.
-   Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -132,4 +132,7 @@
 /* POSIX message queues are not yet supported.  */
 #undef	_POSIX_MESSAGE_PASSING
 
+/* The monotonic clock might be available.  */
+#define _POSIX_MONOTONIC_CLOCK	0
+
 #endif /* posix_opt.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/fork.c libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/fork.c
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/fork.c	2003-01-03 08:26:04.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/fork.c	2003-03-22 09:06:53.000000000 +0900
@@ -39,4 +39,5 @@
   return __libc_maybe_call2 (pthread_fork, (&__fork_block), ARCH_FORK ());
 }
 weak_alias (__libc_fork, __fork)
+libc_hidden_def (__fork)
 weak_alias (__libc_fork, fork)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/i386/bits/posix_opt.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/i386/bits/posix_opt.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/i386/bits/posix_opt.h	2002-11-29 10:47:54.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/i386/bits/posix_opt.h	2003-03-03 13:55:24.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define POSIX options for Linux/ix86.
-   Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -138,4 +138,7 @@
 /* POSIX message queues are not yet supported.  */
 #undef	_POSIX_MESSAGE_PASSING
 
+/* The monotonic clock might be available.  */
+#define _POSIX_MONOTONIC_CLOCK	0
+
 #endif /* posix_opt.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/i386/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/i386/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/i386/sysdep-cancel.h	2003-01-01 04:16:42.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/i386/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jakub@redhat.com>, 2002.
 
@@ -24,7 +24,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -39,12 +39,12 @@
   L(pseudo_cancel):							      \
     CENABLE								      \
     SAVE_OLDTYPE_##args							      \
-    PUSHARGS_##args							      \
+    PUSHCARGS_##args							      \
     DOCARGS_##args							      \
     movl $SYS_ify (syscall_name), %eax;					      \
     int $0x80								      \
-    POPARGS_##args;							      \
-    POPCARGS_##args							      \
+    POPCARGS_##args;							      \
+    POPSTATE_##args							      \
     cmpl $-4095, %eax;							      \
     jae SYSCALL_ERROR_LABEL;						      \
   L(pseudo_end):
@@ -56,12 +56,41 @@
 # define SAVE_OLDTYPE_4	SAVE_OLDTYPE_2
 # define SAVE_OLDTYPE_5	SAVE_OLDTYPE_2
 
-# define DOCARGS_0	DOARGS_0
-# define DOCARGS_1	DOARGS_1
+# define PUSHCARGS_0	/* No arguments to push.  */
+# define DOCARGS_0	/* No arguments to frob.  */
+# define POPCARGS_0	/* No arguments to pop.  */
+# define _PUSHCARGS_0	/* No arguments to push.  */
+# define _POPCARGS_0	/* No arguments to pop.  */
+
+# define PUSHCARGS_1	movl %ebx, %edx; PUSHCARGS_0
+# define DOCARGS_1	_DOARGS_1 (4)
+# define POPCARGS_1	POPCARGS_0; movl %edx, %ebx
+# define _PUSHCARGS_1	pushl %ebx; L(PUSHBX2): _PUSHCARGS_0
+# define _POPCARGS_1	_POPCARGS_0; popl %ebx; L(POPBX2):
+
+# define PUSHCARGS_2	PUSHCARGS_1
 # define DOCARGS_2	_DOARGS_2 (12)
+# define POPCARGS_2	POPCARGS_1
+# define _PUSHCARGS_2	_PUSHCARGS_1
+# define _POPCARGS_2	_POPCARGS_1
+
+# define PUSHCARGS_3	_PUSHCARGS_2
 # define DOCARGS_3	_DOARGS_3 (20)
+# define POPCARGS_3	_POPCARGS_3
+# define _PUSHCARGS_3	_PUSHCARGS_2
+# define _POPCARGS_3	_POPCARGS_2
+
+# define PUSHCARGS_4	_PUSHCARGS_4
 # define DOCARGS_4	_DOARGS_4 (28)
+# define POPCARGS_4	_POPCARGS_4
+# define _PUSHCARGS_4	pushl %esi; L(PUSHSI2): _PUSHCARGS_3
+# define _POPCARGS_4	_POPCARGS_3; popl %esi; L(POPSI2):
+
+# define PUSHCARGS_5	_PUSHCARGS_5
 # define DOCARGS_5	_DOARGS_5 (36)
+# define POPCARGS_5	_POPCARGS_5
+# define _PUSHCARGS_5	pushl %edi; L(PUSHDI2): _PUSHCARGS_4
+# define _POPCARGS_5	_POPCARGS_4; popl %edi; L(POPDI2):
 
 # ifdef IS_IN_libpthread
 #  define CENABLE	call __pthread_enable_asynccancel;
@@ -70,17 +99,19 @@
 #  define CENABLE	call __libc_enable_asynccancel;
 #  define CDISABLE	call __libc_disable_asynccancel
 # endif
-# define POPCARGS_0	pushl %eax; movl %ecx, %eax; CDISABLE; popl %eax;
-# define POPCARGS_1	POPCARGS_0
-# define POPCARGS_2	xchgl (%esp), %eax; CDISABLE; popl %eax;
-# define POPCARGS_3	POPCARGS_2
-# define POPCARGS_4	POPCARGS_2
-# define POPCARGS_5	POPCARGS_2
+# define POPSTATE_0	pushl %eax; movl %ecx, %eax; CDISABLE; popl %eax;
+# define POPSTATE_1	POPSTATE_0
+# define POPSTATE_2	xchgl (%esp), %eax; CDISABLE; popl %eax;
+# define POPSTATE_3	POPSTATE_2
+# define POPSTATE_4	POPSTATE_2
+# define POPSTATE_5	POPSTATE_2
 
 #if !defined NOT_IN_libc
 # define __local_multiple_threads __libc_multiple_threads
-#else
+#elif defined IS_IN_libpthread
 # define __local_multiple_threads __pthread_multiple_threads
+#else
+# define __local_multiple_threads __librt_multiple_threads
 #endif
 
 # ifndef __ASSEMBLER__
@@ -89,7 +120,12 @@
   __builtin_expect (THREAD_GETMEM (THREAD_SELF,				      \
 				   p_header.data.multiple_threads) == 0, 1)
 #  else
-extern int __local_multiple_threads attribute_hidden;
+extern int __local_multiple_threads
+#   if !defined NOT_IN_libc || defined IS_IN_libpthread
+  attribute_hidden;
+#   else
+  ;
+#   endif
 #   define SINGLE_THREAD_P __builtin_expect (__local_multiple_threads == 0, 1)
 #  endif
 # else
@@ -98,16 +134,23 @@
 #  elif defined FLOATING_STACKS && USE___THREAD
 #   define SINGLE_THREAD_P cmpl $0, %gs:MULTIPLE_THREADS_OFFSET
 #  else
+#   if !defined NOT_IN_libc || defined IS_IN_libpthread
+#    define __SINGLE_THREAD_CMP cmpl $0, __local_multiple_threads@GOTOFF(%ecx)
+#   else
+#    define __SINGLE_THREAD_CMP \
+  movl __local_multiple_threads@GOT(%ecx), %ecx;\
+  cmpl $0, (%ecx)
+#   endif
 #   if !defined HAVE_HIDDEN || !USE___THREAD
 #    define SINGLE_THREAD_P \
   SETUP_PIC_REG (cx);				\
   addl $_GLOBAL_OFFSET_TABLE_, %ecx;		\
-  cmpl $0, __local_multiple_threads@GOTOFF(%ecx)
+  __SINGLE_THREAD_CMP
 #   else
 #    define SINGLE_THREAD_P \
   call __i686.get_pc_thunk.cx;			\
   addl $_GLOBAL_OFFSET_TABLE_, %ecx;		\
-  cmpl $0, __local_multiple_threads@GOTOFF(%ecx)
+  __SINGLE_THREAD_CMP
 #   endif
 #  endif
 # endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/ia64/pt-sigsuspend.c libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/ia64/pt-sigsuspend.c
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/ia64/pt-sigsuspend.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/ia64/pt-sigsuspend.c	2003-04-02 09:10:45.000000000 +0900
@@ -0,0 +1,33 @@
+/* Internal sigsuspend system call for LinuxThreads.  IA64 version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <signal.h>
+#include <unistd.h>
+
+#include <sysdep.h>
+#include <sys/syscall.h>
+#include <linuxthreads/internals.h>
+
+void
+__pthread_sigsuspend (const sigset_t *set)
+{
+  INTERNAL_SYSCALL_DECL (err);
+  INTERNAL_SYSCALL (rt_sigsuspend, err, 2, set, _NSIG / 8);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/ia64/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/ia64/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/ia64/sysdep-cancel.h	2003-01-10 04:43:34.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/ia64/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -23,7 +23,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -38,6 +38,11 @@
      cmp.eq p6,p0=-1,r10;						      \
 (p6) br.cond.spnt.few __syscall_error;					      \
      ret;;								      \
+     .endp name;							      \
+     .proc __GC_##name;							      \
+     .globl __GC_##name;						      \
+     .hidden __GC_##name;						      \
+__GC_##name:								      \
 .Lpseudo_cancel:							      \
      .prologue;								      \
      .regstk args, 5, args, 0;						      \
@@ -62,12 +67,13 @@
      mov ar.pfs = loc0;							      \
 .Lpseudo_end:								      \
      ret;								      \
-     .endp name;							      \
+     .endp __GC_##name;							      \
 .section .gnu.linkonce.t.__syscall_error_##args, "ax";			      \
      .align 32;								      \
      .proc __syscall_error_##args;					      \
      .global __syscall_error_##args;					      \
      .hidden __syscall_error_##args;					      \
+     .size __syscall_error_##args, 64;					      \
 __syscall_error_##args:							      \
      .prologue;								      \
      .regstk args, 5, args, 0;						      \
@@ -82,12 +88,18 @@
      mov r8 = -1;							      \
      mov ar.pfs = loc0
 
+#undef PSEUDO_END
+#define PSEUDO_END(name) .endp
+
 # ifdef IS_IN_libpthread
 #  define CENABLE	br.call.sptk.many b0 = __pthread_enable_asynccancel
 #  define CDISABLE	br.call.sptk.many b0 = __pthread_disable_asynccancel
-# else
+# elif !defined NOT_IN_libc
 #  define CENABLE	br.call.sptk.many b0 = __libc_enable_asynccancel
 #  define CDISABLE	br.call.sptk.many b0 = __libc_disable_asynccancel
+# else
+#  define CENABLE	br.call.sptk.many b0 = __librt_enable_asynccancel
+#  define CDISABLE	br.call.sptk.many b0 = __librt_disable_asynccancel
 # endif
 
 #define COPY_ARGS_0	/* Nothing */
@@ -101,8 +113,7 @@
 
 # ifndef __ASSEMBLER__
 #  define SINGLE_THREAD_P \
-  __builtin_expect (THREAD_GETMEM (THREAD_SELF,				      \
-				   p_header.data.multiple_threads) == 0, 1)
+  __builtin_expect (THREAD_GETMEM (THREAD_SELF, p_multiple_threads) == 0, 1)
 # else
 #  define SINGLE_THREAD_P \
   adds r14 = MULTIPLE_THREADS_OFFSET, r13 ;; ld4 r14 = [r14] ;; cmp4.ne p6, p7 = 0, r14
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/m68k/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/m68k/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/m68k/sysdep-cancel.h	2003-01-06 05:04:06.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/m68k/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -22,7 +22,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -84,7 +84,7 @@
 #   define CENABLE	jbsr __pthread_enable_asynccancel
 #   define CDISABLE	jbsr __pthread_disable_asynccancel
 #  endif
-# else
+# elif !defined NOT_IN_libc
 #  ifdef PIC
 #   define CENABLE	jbsr __libc_enable_asynccancel@PLTPC
 #   define CDISABLE	jbsr __libc_disable_asynccancel@PLTPC
@@ -92,12 +92,22 @@
 #   define CENABLE	jbsr __libc_enable_asynccancel
 #   define CDISABLE	jbsr __libc_disable_asynccancel
 #  endif
+# else
+#  ifdef PIC
+#   define CENABLE	jbsr __librt_enable_asynccancel@PLTPC
+#   define CDISABLE	jbsr __librt_disable_asynccancel@PLTPC
+#  else
+#   define CENABLE	jbsr __librt_enable_asynccancel
+#   define CDISABLE	jbsr __librt_disable_asynccancel
+#  endif
 # endif
 
 # if !defined NOT_IN_libc
 #  define __local_multiple_threads __libc_multiple_threads
-# else
+# elif defined IS_IN_libpthread
 #  define __local_multiple_threads __pthread_multiple_threads
+# else
+#  define __local_multiple_threads __librt_multiple_threads
 # endif
 
 # ifndef __ASSEMBLER__
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep-cancel.h	2003-02-18 05:32:09.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -23,7 +23,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				\
@@ -78,15 +78,17 @@
 # ifdef IS_IN_libpthread
 #  define CENABLE	bl JUMPTARGET(__pthread_enable_asynccancel)
 #  define CDISABLE	bl JUMPTARGET(__pthread_disable_asynccancel)
-# else
+# elif !defined NOT_IN_libc
 #  define CENABLE	bl JUMPTARGET(__libc_enable_asynccancel)
 #  define CDISABLE	bl JUMPTARGET(__libc_disable_asynccancel)
+# else
+#  define CENABLE	bl JUMPTARGET(__librt_enable_asynccancel)
+#  define CDISABLE	bl JUMPTARGET(__librt_disable_asynccancel)
 # endif
 
 # ifndef __ASSEMBLER__
 #  define SINGLE_THREAD_P						\
-  __builtin_expect (THREAD_GETMEM (THREAD_SELF,				\
-				     p_header.data.multiple_threads) == 0, 1)
+  __builtin_expect (THREAD_GETMEM (THREAD_SELF, p_multiple_threads) == 0, 1)
 # else
 #  define SINGLE_THREAD_P						\
   lwz 10,MULTIPLE_THREADS_OFFSET(2);					\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep-cancel.h	2003-01-12 17:09:45.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -22,7 +22,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				\
@@ -78,18 +78,31 @@
 #  define CENABLE	bl JUMPTARGET(__pthread_enable_asynccancel)
 #  define CDISABLE	bl JUMPTARGET(__pthread_disable_asynccancel)
 #  define __local_multiple_threads __pthread_multiple_threads
-# else
+# elif !defined NOT_IN_libc
 #  define CENABLE	bl JUMPTARGET(__libc_enable_asynccancel)
 #  define CDISABLE	bl JUMPTARGET(__libc_disable_asynccancel)
 #  define __local_multiple_threads __libc_multiple_threads
+# else
+#  define CENABLE	bl JUMPTARGET(__librt_enable_asynccancel); nop
+#  define CDISABLE	bl JUMPTARGET(__librt_disable_asynccancel); nop
+#  define __local_multiple_threads __librt_multiple_threads
 # endif
 
 # ifndef __ASSEMBLER__
-extern int __local_multiple_threads attribute_hidden;
+extern int __local_multiple_threads
+#  if !defined NOT_IN_libc || defined IS_IN_libpthread
+  attribute_hidden;
+#  else
+  ;
+#  endif
 #  define SINGLE_THREAD_P __builtin_expect (__local_multiple_threads == 0, 1)
 # else
 #   define SINGLE_THREAD_P						\
-  ld    10,__local_multiple_threads@got(2);				\
+	.section	".toc","aw";  \
+.LC__local_multiple_threads:; \
+	.tc __local_multiple_threads[TC],__local_multiple_threads; \
+  .previous;              \
+  ld    10,.LC__local_multiple_threads@toc(2);				\
   ld    10,0(10);								\
   cmpdi 10,0
 # endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/pt-sigsuspend.c libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/pt-sigsuspend.c
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/pt-sigsuspend.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/pt-sigsuspend.c	2003-04-02 09:10:44.000000000 +0900
@@ -0,0 +1,56 @@
+/* Internal sigsuspend system call for LinuxThreads.  Generic Linux version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <signal.h>
+#include <unistd.h>
+
+#include <sysdep.h>
+#include <sys/syscall.h>
+#include <linuxthreads/internals.h>
+
+#include "kernel-features.h"
+
+void
+__pthread_sigsuspend (const sigset_t *set)
+{
+  INTERNAL_SYSCALL_DECL (err);
+#if !__ASSUME_REALTIME_SIGNALS
+  static int __pthread_missing_rt_sigs;
+
+# ifdef __NR_rt_sigsuspend
+  /* First try the RT signals.  */
+  if (!__pthread_missing_rt_sigs)
+    {
+      /* XXX The size argument hopefully will have to be changed to the
+	 real size of the user-level sigset_t.  */
+      int r;
+      r = INTERNAL_SYSCALL (rt_sigsuspend, err, 2, set, _NSIG / 8);
+      if (INTERNAL_SYSCALL_ERRNO (r, err) != ENOSYS)
+	return;
+
+      __pthread_missing_rt_sigs = 1;
+    }
+# endif
+
+  INTERNAL_SYSCALL (sigsuspend, err, 3, 0, 0, set->__val[0]);
+#else
+  INTERNAL_SYSCALL (rt_sigsuspend, err, 2, set, _NSIG / 8);
+#endif
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-32/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-32/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-32/sysdep-cancel.h	2003-01-14 10:04:15.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-32/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -23,7 +23,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -62,9 +62,12 @@
 # ifdef IS_IN_libpthread
 #  define CENABLE	__pthread_enable_asynccancel
 #  define CDISABLE	__pthread_disable_asynccancel
-# else
+# elif !defined NOT_IN_libc
 #  define CENABLE	__libc_enable_asynccancel
 #  define CDISABLE	__libc_disable_asynccancel
+# else
+#  define CENABLE	__librt_enable_asynccancel
+#  define CDISABLE	__librt_disable_asynccancel
 # endif
 
 #define STM_0		/* Nothing */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/pt-sigsuspend.c libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/pt-sigsuspend.c
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/pt-sigsuspend.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/pt-sigsuspend.c	2003-04-02 09:10:45.000000000 +0900
@@ -0,0 +1 @@
+#include "../../ia64/pt-sigsuspend.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/sysdep-cancel.h	2003-01-28 19:20:09.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/s390/s390-64/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -23,7 +23,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -58,10 +58,13 @@
 #  define CENABLE	__pthread_enable_asynccancel
 #  define CDISABLE	__pthread_disable_asynccancel
 #  define __local_multiple_threads	__pthread_multiple_threads
-# else
+# elif !defined NOT_IN_libc
 #  define CENABLE	__libc_enable_asynccancel
 #  define CDISABLE	__libc_disable_asynccancel
 #  define __local_multiple_threads	__libc_multiple_threads
+# else
+#  define CENABLE	__librt_enable_asynccancel
+#  define CDISABLE	__librt_disable_asynccancel
 # endif
 
 #define STM_0		/* Nothing */
@@ -78,14 +81,31 @@
 #define LM_4		lmg %r2,%r5,16+160(%r15);
 #define LM_5		lmg %r2,%r5,16+160(%r15);
 
-# ifndef __ASSEMBLER__
+# if !defined NOT_IN_libc || defined IS_IN_libpthread
+#  ifndef __ASSEMBLER__
 extern int __local_multiple_threads attribute_hidden;
-#  define SINGLE_THREAD_P \
+#   define SINGLE_THREAD_P \
   __builtin_expect (__local_multiple_threads == 0, 1)
-# else
-#  define SINGLE_THREAD_P \
+#  else
+#   define SINGLE_THREAD_P \
 	larl	%r1,__local_multiple_threads;				      \
 	icm	%r0,15,0(%r1);
+#  endif
+
+# else
+
+#  ifndef __ASSEMBLER__
+#   define SINGLE_THREAD_P \
+  __builtin_expect (THREAD_GETMEM (THREAD_SELF,				      \
+				   p_header.data.multiple_threads) == 0, 1)
+#  else
+#   define SINGLE_THREAD_P \
+	ear	%r1,%a0;						      \
+	sllg	%r1,%r1,32;						      \
+	ear	%r1,%a1;						      \
+	icm	%r1,15,MULTIPLE_THREADS_OFFSET(%r1);
+#  endif
+
 # endif
 
 #elif !defined __ASSEMBLER__
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sh/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sh/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sh/sysdep-cancel.h	2003-02-08 11:29:53.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sh/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -23,7 +23,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # define _IMM12 #-12
 # define _IMM16 #-16
@@ -92,10 +92,13 @@
 #  define __local_enable_asynccancel	__pthread_enable_asynccancel
 #  define __local_disable_asynccancel	__pthread_disable_asynccancel
 #  define __local_multiple_threads	__pthread_multiple_threads
-# else
+# elif !defined NOT_IN_libc
 #  define __local_enable_asynccancel	__libc_enable_asynccancel
 #  define __local_disable_asynccancel	__libc_disable_asynccancel
 #  define __local_multiple_threads	__libc_multiple_threads
+# else
+#  define __local_enable_asynccancel	__librt_enable_asynccancel
+#  define __local_disable_asynccancel	__librt_disable_asynccancel
 # endif
 
 # define CENABLE \
@@ -121,8 +124,7 @@
 # ifndef __ASSEMBLER__
 #  if defined FLOATING_STACKS && USE___THREAD && defined PIC
 #   define SINGLE_THREAD_P \
-  __builtin_expect (THREAD_GETMEM (THREAD_SELF,				      \
-				   p_header.data.multiple_threads) == 0, 1)
+  __builtin_expect (THREAD_GETMEM (THREAD_SELF, p_multiple_threads) == 0, 1)
 #  else
 extern int __local_multiple_threads attribute_hidden;
 #   define SINGLE_THREAD_P __builtin_expect (__local_multiple_threads == 0, 1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/Makefile libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/Makefile
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/Makefile	2003-02-22 03:55:30.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/Makefile	1970-01-01 09:00:00.000000000 +0900
@@ -1,11 +0,0 @@
-ifeq ($(subdir),linuxthreads)
-# gcc has /usr/lib{,64}/crti.o hardcoded in the specs file, because otherwise
-# it would normally find {64,32}bit crt[in].o.
-LDFLAGS-pthread.so += -specs=$(objpfx)specs
-before-compile += $(objpfx)specs
-generated += specs
-$(objpfx)specs:
-	$(CC) $(CFLAGS) $(CPPFLAGS) -dumpspecs \
-	  | sed 's,\(/usr/lib\(\|64\)/\|^\|\([^/a-z]\)\)\(crt[in]\.o\),\3./\4,g' > $@.new
-	mv -f $@.new $@
-endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h	2003-03-26 07:02:20.000000000 +0900
@@ -0,0 +1,65 @@
+/* bits/typesizes.h -- underlying types for *_t.  Linux/SPARC version.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _BITS_TYPES_H
+# error "Never include <bits/typesizes.h> directly; use <sys/types.h> instead."
+#endif
+
+#ifndef	_BITS_TYPESIZES_H
+#define	_BITS_TYPESIZES_H	1
+
+/* See <bits/types.h> for the meaning of these macros.  This file exists so
+   that <bits/types.h> need not vary across different GNU platforms.  */
+
+#define __DEV_T_TYPE		__UQUAD_TYPE
+#define __UID_T_TYPE		__U32_TYPE
+#define __GID_T_TYPE		__U32_TYPE
+#define __INO_T_TYPE		__ULONGWORD_TYPE
+#define __INO64_T_TYPE		__UQUAD_TYPE
+#define __MODE_T_TYPE		__U32_TYPE
+#define __NLINK_T_TYPE		__U32_TYPE
+#define __OFF_T_TYPE		__SLONGWORD_TYPE
+#define __OFF64_T_TYPE		__SQUAD_TYPE
+#define __PID_T_TYPE		__S32_TYPE
+#define __RLIM_T_TYPE		__ULONGWORD_TYPE
+#define __RLIM64_T_TYPE		__UQUAD_TYPE
+#define	__BLKCNT_T_TYPE		__SLONGWORD_TYPE
+#define	__BLKCNT64_T_TYPE	__SQUAD_TYPE
+#define	__FSBLKCNT_T_TYPE	__ULONGWORD_TYPE
+#define	__FSBLKCNT64_T_TYPE	__UQUAD_TYPE
+#define	__FSFILCNT_T_TYPE	__ULONGWORD_TYPE
+#define	__FSFILCNT64_T_TYPE	__UQUAD_TYPE
+#define	__ID_T_TYPE		__U32_TYPE
+#define __CLOCK_T_TYPE		__SLONGWORD_TYPE
+#define __TIME_T_TYPE		__SLONGWORD_TYPE
+#define __USECONDS_T_TYPE	__U32_TYPE
+#define __SUSECONDS_T_TYPE	__S32_TYPE
+#define __DADDR_T_TYPE		__S32_TYPE
+#define __SWBLK_T_TYPE		__SLONGWORD_TYPE
+#define __KEY_T_TYPE		__S32_TYPE
+#define __CLOCKID_T_TYPE	__S32_TYPE
+#define __TIMER_T_TYPE		__S32_TYPE
+#define __BLKSIZE_T_TYPE	__SLONGWORD_TYPE
+#define __FSID_T_TYPE		struct { int __val[2]; }
+
+/* Number of descriptors that can fit in an `fd_set'.  */
+#define	__FD_SETSIZE		1024
+
+
+#endif /* bits/typesizes.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep-cancel.h	2003-01-28 05:47:53.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -23,7 +23,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -68,9 +68,12 @@
 # ifdef IS_IN_libpthread
 #  define CENABLE	call __pthread_enable_asynccancel
 #  define CDISABLE	call __pthread_disable_asynccancel
-# else
+# elif defined !NOT_IN_libc
 #  define CENABLE	call __libc_enable_asynccancel
 #  define CDISABLE	call __libc_disable_asynccancel
+# else
+#  define CENABLE	call __librt_enable_asynccancel
+#  define CDISABLE	call __librt_disable_asynccancel
 # endif
 
 #define COPY_ARGS_0	/* Nothing */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/Makefile libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/Makefile
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/Makefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/Makefile	2003-03-15 08:36:52.000000000 +0900
@@ -0,0 +1,5 @@
+# glibc makefile fragment for linuxthreads on sparc/sparc64.
+
+ifeq ($(subdir),linuxthreads)
+libpthread-routines += ptw-sigprocmask
+endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/pt-sigsuspend.c libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/pt-sigsuspend.c
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/pt-sigsuspend.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/pt-sigsuspend.c	2003-04-02 09:10:44.000000000 +0900
@@ -0,0 +1 @@
+#include "../../ia64/pt-sigsuspend.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep-cancel.h	2003-02-22 03:55:30.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -23,7 +23,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -67,9 +67,12 @@
 # ifdef IS_IN_libpthread
 #  define CENABLE	call __pthread_enable_asynccancel
 #  define CDISABLE	call __pthread_disable_asynccancel
-# else
+# elif !defined NOT_IN_libc
 #  define CENABLE	call __libc_enable_asynccancel
 #  define CDISABLE	call __libc_disable_asynccancel
+# else
+#  define CENABLE	call __librt_enable_asynccancel
+#  define CDISABLE	call __librt_disable_asynccancel
 # endif
 
 #define COPY_ARGS_0	/* Nothing */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/x86_64/Makefile libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/x86_64/Makefile
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/x86_64/Makefile	2003-02-22 03:55:30.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/x86_64/Makefile	2003-04-15 23:55:46.000000000 +0900
@@ -1,12 +1,3 @@
 ifeq ($(subdir),linuxthreads)
 CFLAGS-pt-initfini.s = -g0 -fPIC -fno-inline-functions -fno-asynchronous-unwind-tables
-# gcc -m64 has /usr/lib64/crti.o hardcoded in the specs file, because otherwise
-# it would normally find 32bit crti.o.
-LDFLAGS-pthread.so += -specs=$(objpfx)specs
-before-compile += $(objpfx)specs
-generated += specs
-$(objpfx)specs:
-	$(CC) $(CFLAGS) $(CPPFLAGS) -dumpspecs \
-	| sed 's,\(/usr/lib\(\|64\)/\|^\|\([^/a-z]\)\)\(crt[in]\.o\),\3./\4,g' > $@.new
-	mv -f $@.new $@
 endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/x86_64/pt-sigsuspend.c libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/x86_64/pt-sigsuspend.c
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/x86_64/pt-sigsuspend.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/x86_64/pt-sigsuspend.c	2003-04-02 09:10:45.000000000 +0900
@@ -0,0 +1 @@
+#include "../ia64/pt-sigsuspend.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/x86_64/sysdep-cancel.h libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/x86_64/sysdep-cancel.h
--- glibc-2.3.2/linuxthreads/sysdeps/unix/sysv/linux/x86_64/sysdep-cancel.h	2003-02-13 06:45:53.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/unix/sysv/linux/x86_64/sysdep-cancel.h	2003-07-08 22:58:07.000000000 +0900
@@ -24,7 +24,7 @@
 # include <linuxthreads/internals.h>
 #endif
 
-#if !defined NOT_IN_libc || defined IS_IN_libpthread
+#if !defined NOT_IN_libc || defined IS_IN_libpthread || defined IS_IN_librt
 
 # undef PSEUDO
 # define PSEUDO(name, syscall_name, args)				      \
@@ -74,38 +74,54 @@
 # define POPARGS_6	POPARGS_5 movq 48(%rsp), %r9;
 
 /* We always have to align the stack before calling a function.  */
-# define SAVESTK_0	subq $24, %rsp;
+# define SAVESTK_0	subq $24, %rsp;cfi_adjust_cfa_offset(24);
 # define SAVESTK_1	SAVESTK_0
 # define SAVESTK_2	SAVESTK_1
-# define SAVESTK_3	subq $40, %rsp;
+# define SAVESTK_3	subq $40, %rsp;cfi_adjust_cfa_offset(40);
 # define SAVESTK_4	SAVESTK_3
-# define SAVESTK_5	subq $56, %rsp;
+# define SAVESTK_5	subq $56, %rsp;cfi_adjust_cfa_offset(56);
 # define SAVESTK_6	SAVESTK_5
 
-# define RESTSTK_0	addq $24,%rsp;
+# define RESTSTK_0	addq $24,%rsp;cfi_adjust_cfa_offset(-24);
 # define RESTSTK_1	RESTSTK_0
 # define RESTSTK_2	RESTSTK_1
-# define RESTSTK_3	addq $40, %rsp;
+# define RESTSTK_3	addq $40, %rsp;cfi_adjust_cfa_offset(-40);
 # define RESTSTK_4	RESTSTK_3
-# define RESTSTK_5	addq $56, %rsp;
+# define RESTSTK_5	addq $56, %rsp;cfi_adjust_cfa_offset(-56);
 # define RESTSTK_6	RESTSTK_5
 
 # ifdef IS_IN_libpthread
 #  define CENABLE	call __pthread_enable_asynccancel;
 #  define CDISABLE	call __pthread_disable_asynccancel;
 #  define __local_multiple_threads __pthread_multiple_threads
-# else
+# elif !defined NOT_IN_libc
 #  define CENABLE	call __libc_enable_asynccancel;
 #  define CDISABLE	call __libc_disable_asynccancel;
 #  define __local_multiple_threads __libc_multiple_threads
+# else
+#  define CENABLE	call __librt_enable_asynccancel@plt;
+#  define CDISABLE	call __librt_disable_asynccancel@plt;
 # endif
 
-# ifndef __ASSEMBLER__
+# if defined IS_IN_libpthread || !defined NOT_IN_libc
+#  ifndef __ASSEMBLER__
 extern int __local_multiple_threads attribute_hidden;
 #   define SINGLE_THREAD_P \
   __builtin_expect (__local_multiple_threads == 0, 1)
+#  else
+#   define SINGLE_THREAD_P cmpl $0, __local_multiple_threads(%rip)
+#  endif
+
 # else
-#  define SINGLE_THREAD_P cmpl $0, __local_multiple_threads(%rip)
+
+#  ifndef __ASSEMBLER__
+#   define SINGLE_THREAD_P \
+  __builtin_expect (THREAD_GETMEM (THREAD_SELF, \
+				   p_header.data.multiple_threads) == 0, 1)
+#  else
+#   define SINGLE_THREAD_P cmpl $0, %fs:MULTIPLE_THREADS_OFFSET
+#  endif
+
 # endif
 
 #elif !defined __ASSEMBLER__
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/x86_64/Makefile libc-20030708/linuxthreads/sysdeps/x86_64/Makefile
--- glibc-2.3.2/linuxthreads/sysdeps/x86_64/Makefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/x86_64/Makefile	2003-06-18 07:24:24.000000000 +0900
@@ -0,0 +1,3 @@
+ifeq ($(subdir),csu)
+gen-as-const-headers += tcb-offsets.sym
+endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/x86_64/tcb-offsets.sym libc-20030708/linuxthreads/sysdeps/x86_64/tcb-offsets.sym
--- glibc-2.3.2/linuxthreads/sysdeps/x86_64/tcb-offsets.sym	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/x86_64/tcb-offsets.sym	2003-06-18 07:23:41.000000000 +0900
@@ -0,0 +1,4 @@
+#include <sysdep.h>
+#include <tls.h>
+
+MULTIPLE_THREADS_OFFSET		offsetof (tcbhead_t, multiple_threads)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/sysdeps/x86_64/tls.h libc-20030708/linuxthreads/sysdeps/x86_64/tls.h
--- glibc-2.3.2/linuxthreads/sysdeps/x86_64/tls.h	2002-12-28 16:04:09.000000000 +0900
+++ libc-20030708/linuxthreads/sysdeps/x86_64/tls.h	2003-07-08 22:58:07.000000000 +0900
@@ -39,6 +39,7 @@
 			   thread descriptor used by libpthread.  */
   dtv_t *dtv;
   void *self;		/* Pointer to the thread descriptor.  */
+  int multiple_threads;
 } tcbhead_t;
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/tst-cancel4.c libc-20030708/linuxthreads/tst-cancel4.c
--- glibc-2.3.2/linuxthreads/tst-cancel4.c	2002-12-28 16:49:20.000000000 +0900
+++ libc-20030708/linuxthreads/tst-cancel4.c	2003-03-07 06:39:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@redhat.com>, 2002.
 
@@ -154,7 +154,7 @@
       exit (1);
     }
 
-  sleep (10000000);
+  sleep (1000000);
 
   printf ("%s: sleep returns\n", __FUNCTION__);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads/tst-cancel7.c libc-20030708/linuxthreads/tst-cancel7.c
--- glibc-2.3.2/linuxthreads/tst-cancel7.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads/tst-cancel7.c	2003-04-02 09:10:44.000000000 +0900
@@ -0,0 +1,111 @@
+/* Test for pthread cancellation of mutex blocks.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Jakub Jelinek <jakub@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <pthread.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <unistd.h>
+
+pthread_mutex_t lock = PTHREAD_MUTEX_INITIALIZER;
+pthread_barrier_t b;
+int value = 0;
+
+static void *
+tf (void *arg)
+{
+  int r = pthread_barrier_wait (&b);
+  if (r != 0 && r != PTHREAD_BARRIER_SERIAL_THREAD)
+    {
+      printf ("%s: barrier_wait failed\n", __FUNCTION__);
+      exit (1);
+    }
+
+  pthread_mutex_lock (&lock);
+  ++value;
+  pthread_testcancel ();
+  ++value;
+  pthread_mutex_unlock (&lock);
+  return NULL;
+}
+
+
+static int
+do_test (void)
+{
+  pthread_mutex_lock (&lock);
+
+  if (pthread_barrier_init (&b, NULL, 2) != 0)
+    {
+      puts ("barrier init failed");
+      return 1;
+    }
+
+  pthread_t th;
+  if (pthread_create (&th, NULL, tf, NULL) != 0)
+    {
+      puts ("pthread_create failed");
+      return 1;
+    }
+
+  int r = pthread_barrier_wait (&b);
+  if (r != 0 && r != PTHREAD_BARRIER_SERIAL_THREAD)
+    {
+      printf ("%s: barrier_wait failed\n", __FUNCTION__);
+      exit (1);
+    }
+
+  if (pthread_cancel (th) != 0)
+    {
+      puts ("pthread_cancel failed");
+      return 1;
+    }
+
+  pthread_mutex_unlock (&lock);
+
+  void *status;
+  if (pthread_join (th, &status) != 0)
+    {
+      puts ("join failed");
+      return 1;
+    }
+
+  if (status != PTHREAD_CANCELED)
+    {
+      puts ("thread not canceled");
+      return 1;
+    }
+
+  if (value == 0)
+    {
+      puts ("thread cancelled in the pthread_mutex_lock call");
+      return 1;
+    }
+
+  if (value != 1)
+    {
+      puts ("thread not cancelled in pthread_testcancel call");
+      return 1;
+    }
+
+  return 0;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads_db/ChangeLog libc-20030708/linuxthreads_db/ChangeLog
--- glibc-2.3.2/linuxthreads_db/ChangeLog	2003-01-30 19:15:38.000000000 +0900
+++ libc-20030708/linuxthreads_db/ChangeLog	2003-03-16 08:09:52.000000000 +0900
@@ -1,3 +1,19 @@
+2003-03-15  Roland McGrath  <roland@redhat.com>
+
+	* thread_db.h (td_err_e): Add TD_NOTLS and TD_TLSDEFER.
+	(td_thr_tlsbase): Declare it.
+	* td_thr_tlsbase.c: New file.
+	* Makefile (libthread_db-routines): Add it.
+	* Versions (libthread_db: GLIBC_2.3.3): New set, add td_thr_tlsbase.
+	* td_thr_tls_get_addr.c (td_thr_tls_get_addr): Use td_thr_tlsbase.
+
+2003-02-27  Roland McGrath  <roland@redhat.com>
+
+	* td_thr_tls_get_addr.c (td_thr_tls_get_addr): Handle TLS_DTV_AT_TP.
+
+	* td_ta_thr_iter.c (handle_descr) [!defined USE_TLS || !TLS_DTV_AT_TP]:
+	Conditionalize p_header use on this.
+
 2003-01-29  Roland McGrath  <roland@redhat.com>
 
 	* td_ta_new.c (td_ta_new): Cap the `sizeof_descr' value read from the
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads_db/Makefile libc-20030708/linuxthreads_db/Makefile
--- glibc-2.3.2/linuxthreads_db/Makefile	2003-01-05 19:00:22.000000000 +0900
+++ libc-20030708/linuxthreads_db/Makefile	2003-03-16 08:09:01.000000000 +0900
@@ -39,7 +39,8 @@
 			td_thr_event_enable td_thr_set_event 		    \
 			td_thr_clear_event td_thr_event_getmsg		    \
 			td_ta_set_event td_ta_event_getmsg		    \
-			td_ta_clear_event td_symbol_list td_thr_tls_get_addr
+			td_ta_clear_event td_symbol_list \
+			td_thr_tlsbase td_thr_tls_get_addr
 
 libthread_db-inhibit-o = $(filter-out .os,$(object-suffixes))
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads_db/Versions libc-20030708/linuxthreads_db/Versions
--- glibc-2.3.2/linuxthreads_db/Versions	2002-07-11 08:08:40.000000000 +0900
+++ libc-20030708/linuxthreads_db/Versions	2003-03-16 08:09:01.000000000 +0900
@@ -18,4 +18,7 @@
   GLIBC_2.3 {
     td_thr_tls_get_addr;
   }
+  GLIBC_2.3.3 {
+    td_thr_tlsbase;
+  }
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads_db/td_ta_thr_iter.c libc-20030708/linuxthreads_db/td_ta_thr_iter.c
--- glibc-2.3.2/linuxthreads_db/td_ta_thr_iter.c	2002-07-16 12:34:26.000000000 +0900
+++ libc-20030708/linuxthreads_db/td_ta_thr_iter.c	2003-03-02 20:45:02.000000000 +0900
@@ -1,5 +1,5 @@
 /* Iterate over a process's threads.
-   Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1999.
 
@@ -40,7 +40,9 @@
 	  memset (&pds, '\0', sizeof (pds));
 
 	  /* Empty thread descriptor the thread library would create.  */
+#if !defined USE_TLS || !TLS_DTV_AT_TP
 	  pds.p_header.data.self = &pds;
+#endif
 	  pds.p_nextlive = pds.p_prevlive = &pds;
 	  pds.p_tid = PTHREAD_THREADS_MAX;
 	  /* The init code also sets up p_lock, p_errnop, p_herrnop, and
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads_db/td_thr_tls_get_addr.c libc-20030708/linuxthreads_db/td_thr_tls_get_addr.c
--- glibc-2.3.2/linuxthreads_db/td_thr_tls_get_addr.c	2002-09-29 02:41:11.000000000 +0900
+++ libc-20030708/linuxthreads_db/td_thr_tls_get_addr.c	2003-03-16 08:09:01.000000000 +0900
@@ -1,5 +1,5 @@
 /* Get address of thread local variable.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 2002.
 
@@ -18,14 +18,9 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-
-#include "link.h"
+#include <link.h>
 #include "thread_dbP.h"
 
-/* Value used for dtv entries for which the allocation is delayed.  */
-# define TLS_DTV_UNALLOCATED	((void *) -1l)
-
-
 td_err_e
 td_thr_tls_get_addr (const td_thrhandle_t *th __attribute__ ((unused)),
 		     void *map_address __attribute__ ((unused)),
@@ -33,37 +28,17 @@
 		     void **address __attribute__ ((unused)))
 {
 #if USE_TLS
-  size_t modid;
-  union dtv pdtv, *dtvp;
-
-  LOG ("td_thr_tls_get_addr");
-
-  /* Get the DTV pointer from the thread descriptor.  */
-  if (ps_pdread (th->th_ta_p->ph,
-		 &((struct _pthread_descr_struct *) th->th_unique)->p_header.data.dtvp,
-		 &dtvp, sizeof dtvp) != PS_OK)
-    return TD_ERR;	/* XXX Other error value?  */
-
   /* Read the module ID from the link_map.  */
+  size_t modid;
   if (ps_pdread (th->th_ta_p->ph,
 		 &((struct link_map *) map_address)->l_tls_modid,
 		 &modid, sizeof modid) != PS_OK)
     return TD_ERR;	/* XXX Other error value?  */
 
-  /* Get the corresponding entry in the DTV.  */
-  if (ps_pdread (th->th_ta_p->ph, dtvp + modid,
-		 &pdtv, sizeof (union dtv)) != PS_OK)
-    return TD_ERR;	/* XXX Other error value?  */
-
-  /* It could be that the memory for this module is not allocated for
-     the given thread.  */
-  if (pdtv.pointer == TLS_DTV_UNALLOCATED)
-    /* There is not much we can do.  */
-    return TD_NOTALLOC;
-
-  *address = (char *) pdtv.pointer + offset;
-
-  return TD_OK;
+  td_err_e result = td_thr_tlsbase (th, modid, address);
+  if (result == TD_OK)
+    *address += offset;
+  return result;
 #else
   return TD_ERR;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads_db/td_thr_tlsbase.c libc-20030708/linuxthreads_db/td_thr_tlsbase.c
--- glibc-2.3.2/linuxthreads_db/td_thr_tlsbase.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/linuxthreads_db/td_thr_tlsbase.c	2003-03-16 08:09:01.000000000 +0900
@@ -0,0 +1,67 @@
+/* Locate TLS data for a thread.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include "thread_dbP.h"
+
+/* Value used for dtv entries for which the allocation is delayed.  */
+# define TLS_DTV_UNALLOCATED	((void *) -1l)
+
+td_err_e
+td_thr_tlsbase (const td_thrhandle_t *th,
+		unsigned long int modid,
+		psaddr_t *base)
+{
+  if (modid < 1)
+    return TD_NOTLS;
+
+#if USE_TLS
+  union dtv pdtv, *dtvp;
+
+  LOG ("td_thr_tlsbase");
+
+  psaddr_t dtvpp = th->th_unique;
+#if TLS_TCB_AT_TP
+  dtvpp += offsetof (struct _pthread_descr_struct, p_header.data.dtvp);
+#elif TLS_DTV_AT_TP
+  dtvpp += TLS_PRE_TCB_SIZE + offsetof (tcbhead_t, dtv);
+#else
+# error "Either TLS_TCB_AT_TP or TLS_DTV_AT_TP must be defined."
+#endif
+
+  /* Get the DTV pointer from the thread descriptor.  */
+  if (ps_pdread (th->th_ta_p->ph, dtvpp, &dtvp, sizeof dtvp) != PS_OK)
+    return TD_ERR;	/* XXX Other error value?  */
+
+  /* Get the corresponding entry in the DTV.  */
+  if (ps_pdread (th->th_ta_p->ph, dtvp + modid,
+		 &pdtv, sizeof (union dtv)) != PS_OK)
+    return TD_ERR;	/* XXX Other error value?  */
+
+  /* It could be that the memory for this module is not allocated for
+     the given thread.  */
+  if (pdtv.pointer == TLS_DTV_UNALLOCATED)
+    return TD_TLSDEFER;
+
+  *base = (char *) pdtv.pointer;
+
+  return TD_OK;
+#else
+  return TD_ERR;
+#endif
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/linuxthreads_db/thread_db.h libc-20030708/linuxthreads_db/thread_db.h
--- glibc-2.3.2/linuxthreads_db/thread_db.h	2002-09-25 08:33:07.000000000 +0900
+++ libc-20030708/linuxthreads_db/thread_db.h	2003-03-16 08:09:01.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1999, 2001, 2002 Free Software Foundation, Inc.
+/* thread_db.h -- interface to libthread_db.so library for debugging -lpthread
+   Copyright (C) 1999,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -52,8 +53,10 @@
   TD_MALLOC,	  /* Out of memory.  */
   TD_PARTIALREG,  /* Not entire register set was read or written.  */
   TD_NOXREGS,	  /* X register set not available for given thread.  */
-  TD_NOTALLOC,	  /* TLS memory not yet allocated.  */
-  TD_VERSION	  /* Version if libpthread and libthread_db do not match.  */
+  TD_TLSDEFER,	  /* Thread has not yet allocated TLS for given module.  */
+  TD_NOTALLOC = TD_TLSDEFER,
+  TD_VERSION,	  /* Version if libpthread and libthread_db do not match.  */
+  TD_NOTLS	  /* There is TLS segment in the given module.  */
 } td_err_e;
 
 
@@ -402,6 +405,11 @@
 				 const void *__addr);
 
 
+/* Get address of the given module's TLS storage area for the given thread.  */
+extern td_err_e td_thr_tlsbase (const td_thrhandle_t *__th,
+				unsigned long int __modid,
+				psaddr_t *__base);
+
 /* Get address of thread local variable.  */
 extern td_err_e td_thr_tls_get_addr (const td_thrhandle_t *__th,
 				     void *__map_address, size_t __offset,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/Makefile libc-20030708/locale/Makefile
--- glibc-2.3.2/locale/Makefile	2002-10-18 02:05:53.000000000 +0900
+++ libc-20030708/locale/Makefile	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1991,92,1995-1999,2000,2001,2002 Free Software Foundation, Inc.
+# Copyright (C) 1991,1992,1995-2002,2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -42,7 +42,7 @@
 categories	= ctype messages monetary numeric time paper name \
 		  address telephone measurement identification collate
 aux		= $(categories:%=lc-%) $(categories:%=C-%) SYS_libc C_name \
-		  xlocale localename global-locale
+		  xlocale localename global-locale coll-lookup
 others		= localedef locale
 #others-static	= localedef locale
 install-bin	= localedef locale
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/Versions libc-20030708/locale/Versions
--- glibc-2.3.2/locale/Versions	2002-08-28 10:04:45.000000000 +0900
+++ libc-20030708/locale/Versions	2003-03-03 18:45:12.000000000 +0900
@@ -59,13 +59,12 @@
     iswcntrl_l; iswctype_l; iswdigit_l; iswgraph_l; iswlower_l;
     iswprint_l; iswpunct_l; iswspace_l; iswupper_l; iswxdigit_l;
     isxdigit_l; strcasecmp_l; strcoll_l; strfmon_l; strncasecmp_l;
-    strtod_l; strtof_l; strtol_l; strtold_l; strtoll_l; strtoul_l;
-    strtoull_l; strxfrm_l; toascii_l; tolower_l; toupper_l;
+    strtod_l; strtof_l; strtol_l; strtold_l; strtoul_l;
+    strxfrm_l; toascii_l; tolower_l; toupper_l;
     towctrans_l; towlower_l; towupper_l; wcscasecmp_l; wcscoll_l;
     wcsncasecmp_l; wcstod_l; wcstof_l; wcstol_l; wcstold_l;
     wcstoll_l; wcstoul_l; wcstoull_l; wcsxfrm_l; wctype_l;
     wctrans_l; nl_langinfo_l;
-
   }
   GLIBC_PRIVATE {
     # global variables
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/coll-lookup.c libc-20030708/locale/coll-lookup.c
--- glibc-2.3.2/locale/coll-lookup.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/locale/coll-lookup.c	2003-06-14 05:41:58.000000000 +0900
@@ -0,0 +1,81 @@
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Bruno Haible <haible@clisp.cons.org>, 2000.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+/* Lookup in a table of int32_t, with default value 0.  */
+int32_t
+internal_function
+__collidx_table_lookup (const char *table, uint32_t wc)
+{
+  uint32_t shift1 = ((const uint32_t *) table)[0];
+  uint32_t index1 = wc >> shift1;
+  uint32_t bound = ((const uint32_t *) table)[1];
+  if (index1 < bound)
+    {
+      uint32_t lookup1 = ((const uint32_t *) table)[5 + index1];
+      if (lookup1 != 0)
+	{
+	  uint32_t shift2 = ((const uint32_t *) table)[2];
+	  uint32_t mask2 = ((const uint32_t *) table)[3];
+	  uint32_t index2 = (wc >> shift2) & mask2;
+	  uint32_t lookup2 = ((const uint32_t *)(table + lookup1))[index2];
+	  if (lookup2 != 0)
+	    {
+	      uint32_t mask3 = ((const uint32_t *) table)[4];
+	      uint32_t index3 = wc & mask3;
+	      int32_t lookup3 = ((const int32_t *)(table + lookup2))[index3];
+
+	      return lookup3;
+	    }
+	}
+    }
+  return 0;
+}
+
+
+/* Lookup in a table of uint32_t, with default value 0xffffffff.  */
+uint32_t
+internal_function
+__collseq_table_lookup (const char *table, uint32_t wc)
+{
+  uint32_t shift1 = ((const uint32_t *) table)[0];
+  uint32_t index1 = wc >> shift1;
+  uint32_t bound = ((const uint32_t *) table)[1];
+  if (index1 < bound)
+    {
+      uint32_t lookup1 = ((const uint32_t *) table)[5 + index1];
+      if (lookup1 != 0)
+	{
+	  uint32_t shift2 = ((const uint32_t *) table)[2];
+	  uint32_t mask2 = ((const uint32_t *) table)[3];
+	  uint32_t index2 = (wc >> shift2) & mask2;
+	  uint32_t lookup2 = ((const uint32_t *)(table + lookup1))[index2];
+	  if (lookup2 != 0)
+	    {
+	      uint32_t mask3 = ((const uint32_t *) table)[4];
+	      uint32_t index3 = wc & mask3;
+	      uint32_t lookup3 = ((const uint32_t *)(table + lookup2))[index3];
+
+	      return lookup3;
+	    }
+	}
+    }
+  return ~((uint32_t) 0);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/coll-lookup.h libc-20030708/locale/coll-lookup.h
--- glibc-2.3.2/locale/coll-lookup.h	2001-07-08 04:21:04.000000000 +0900
+++ libc-20030708/locale/coll-lookup.h	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Bruno Haible <haible@clisp.cons.org>, 2000.
 
@@ -17,85 +17,12 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-/* Word tables are accessed by cutting wc in three blocks of bits:
-   - the high 32-q-p bits,
-   - the next q bits,
-   - the next p bits.
-
-	    +------------------+-----+-----+
-     wc  =  +      32-q-p      |  q  |  p  |
-	    +------------------+-----+-----+
-
-   p and q are variable.  For 16-bit Unicode it is sufficient to
-   choose p and q such that q+p <= 16.
-
-   The table contains the following uint32_t words:
-   - q+p,
-   - s = upper exclusive bound for wc >> (q+p),
-   - p,
-   - 2^q-1,
-   - 2^p-1,
-   - 1st-level table: s offsets, pointing into the 2nd-level table,
-   - 2nd-level table: k*2^q offsets, pointing into the 3rd-level table,
-   - 3rd-level table: j*2^p words, each containing 32 bits of data.
-*/
-
 #include <stdint.h>
 
 /* Lookup in a table of int32_t, with default value 0.  */
-static inline int32_t
-collidx_table_lookup (const char *table, uint32_t wc)
-{
-  uint32_t shift1 = ((const uint32_t *) table)[0];
-  uint32_t index1 = wc >> shift1;
-  uint32_t bound = ((const uint32_t *) table)[1];
-  if (index1 < bound)
-    {
-      uint32_t lookup1 = ((const uint32_t *) table)[5 + index1];
-      if (lookup1 != 0)
-	{
-	  uint32_t shift2 = ((const uint32_t *) table)[2];
-	  uint32_t mask2 = ((const uint32_t *) table)[3];
-	  uint32_t index2 = (wc >> shift2) & mask2;
-	  uint32_t lookup2 = ((const uint32_t *)(table + lookup1))[index2];
-	  if (lookup2 != 0)
-	    {
-	      uint32_t mask3 = ((const uint32_t *) table)[4];
-	      uint32_t index3 = wc & mask3;
-	      int32_t lookup3 = ((const int32_t *)(table + lookup2))[index3];
-
-	      return lookup3;
-	    }
-	}
-    }
-  return 0;
-}
+extern int32_t __collidx_table_lookup (const char *table, uint32_t wc)
+     internal_function;
 
 /* Lookup in a table of uint32_t, with default value 0xffffffff.  */
-static inline uint32_t
-collseq_table_lookup (const char *table, uint32_t wc)
-{
-  uint32_t shift1 = ((const uint32_t *) table)[0];
-  uint32_t index1 = wc >> shift1;
-  uint32_t bound = ((const uint32_t *) table)[1];
-  if (index1 < bound)
-    {
-      uint32_t lookup1 = ((const uint32_t *) table)[5 + index1];
-      if (lookup1 != 0)
-	{
-	  uint32_t shift2 = ((const uint32_t *) table)[2];
-	  uint32_t mask2 = ((const uint32_t *) table)[3];
-	  uint32_t index2 = (wc >> shift2) & mask2;
-	  uint32_t lookup2 = ((const uint32_t *)(table + lookup1))[index2];
-	  if (lookup2 != 0)
-	    {
-	      uint32_t mask3 = ((const uint32_t *) table)[4];
-	      uint32_t index3 = wc & mask3;
-	      uint32_t lookup3 = ((const uint32_t *)(table + lookup2))[index3];
-
-	      return lookup3;
-	    }
-	}
-    }
-  return ~((uint32_t) 0);
-}
+extern uint32_t __collseq_table_lookup (const char *table, uint32_t wc)
+     internal_function;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/findlocale.c libc-20030708/locale/findlocale.c
--- glibc-2.3.2/locale/findlocale.c	2002-09-02 03:02:00.000000000 +0900
+++ libc-20030708/locale/findlocale.c	2003-06-12 08:54:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -28,6 +28,7 @@
 
 #include "localeinfo.h"
 #include "../iconv/gconv_charset.h"
+#include "../iconv/gconv_int.h"
 
 
 #ifdef NL_CURRENT_INDIRECT
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/iso-639.def libc-20030708/locale/iso-639.def
--- glibc-2.3.2/locale/iso-639.def	2002-08-03 05:28:38.000000000 +0900
+++ libc-20030708/locale/iso-639.def	2003-07-08 22:58:07.000000000 +0900
@@ -6,171 +6,462 @@
  * If you find something missing or wrong contact <bug-glibc@gnu.org>
  */
 
-DEFINE_LANGUAGE_CODE ("Afar", aa, aar, aar)
 DEFINE_LANGUAGE_CODE ("Abkhazian", ab, abk, abk)
+DEFINE_LANGUAGE_CODE3 ("Achinese", ace, ace)
+DEFINE_LANGUAGE_CODE3 ("Acoli", ach, ach)
+DEFINE_LANGUAGE_CODE3 ("Adangme", ada, ada)
+DEFINE_LANGUAGE_CODE3 ("Adygei", ady, ady)
+DEFINE_LANGUAGE_CODE ("Afar", aa, aar, aar)
+DEFINE_LANGUAGE_CODE3 ("Afrihili", afh, afh)
 DEFINE_LANGUAGE_CODE ("Afrikaans", af, afr, afr)
+DEFINE_LANGUAGE_CODE3 ("Afro-Asiatic (Other)", afa, afa)
+DEFINE_LANGUAGE_CODE ("Akan", ak, aka, aka)
+DEFINE_LANGUAGE_CODE3 ("Akkadian", akk, akk)
 DEFINE_LANGUAGE_CODE ("Albanian", sq, sqi, alb)
+DEFINE_LANGUAGE_CODE3 ("Aleut", ale, ale)
+DEFINE_LANGUAGE_CODE3 ("Alonquian languages", alg, alg)
+DEFINE_LANGUAGE_CODE3 ("Altaic (Other)", tut, tut)
 DEFINE_LANGUAGE_CODE ("Amharic", am, amh, amh)
+DEFINE_LANGUAGE_CODE3 ("Apache language", apa, apa)
 DEFINE_LANGUAGE_CODE ("Arabic", ar, ara, ara)
+DEFINE_LANGUAGE_CODE ("Argonese", an, arg, arg)
+DEFINE_LANGUAGE_CODE3 ("Aramaic", arc, arc)
+DEFINE_LANGUAGE_CODE3 ("Arapaho", arp, arp)
+DEFINE_LANGUAGE_CODE3 ("Araucanian", arn, arn)
+DEFINE_LANGUAGE_CODE3 ("Arawak", arw, arw)
 DEFINE_LANGUAGE_CODE ("Armenian", hy, hye, arm)
+DEFINE_LANGUAGE_CODE3 ("Artificial (Other)", art, art)
 DEFINE_LANGUAGE_CODE ("Assamese", as, asm, asm)
+DEFINE_LANGUAGE_CODE3 ("Asturian; Bable", ast, ast)
+DEFINE_LANGUAGE_CODE3 ("Athapascan languages", ath, ath)
+DEFINE_LANGUAGE_CODE3 ("Australian languages", aus, aus)
+DEFINE_LANGUAGE_CODE3 ("Austronesian (Other)", map, map)
+DEFINE_LANGUAGE_CODE ("Avaric", av, ava, ava)
 DEFINE_LANGUAGE_CODE ("Avestan", ae, ave, ave)
+DEFINE_LANGUAGE_CODE3 ("Awadhi", awa, awa)
 DEFINE_LANGUAGE_CODE ("Aymara", ay, aym, aym)
 DEFINE_LANGUAGE_CODE ("Azerbaijani", az, aze, aze)
+DEFINE_LANGUAGE_CODE3 ("Balinese", ban, ban)
+DEFINE_LANGUAGE_CODE3 ("Baltic (Other)", bat, bat)
+DEFINE_LANGUAGE_CODE3 ("Baluchi", bal, bal)
+DEFINE_LANGUAGE_CODE ("Bambara", bm, bam, bam)
+DEFINE_LANGUAGE_CODE3 ("Bamileke languages", bai, bai)
+DEFINE_LANGUAGE_CODE3 ("Banda", bad, bad)
+DEFINE_LANGUAGE_CODE3 ("Bantu (Other)", bnt, bnt)
+DEFINE_LANGUAGE_CODE3 ("Basa", bas, bas)
 DEFINE_LANGUAGE_CODE ("Bashkir", ba, bak, bak)
 DEFINE_LANGUAGE_CODE ("Basque", eu, eus, baq)
+DEFINE_LANGUAGE_CODE3 ("Batak (Indonesia)", btk, btk)
+DEFINE_LANGUAGE_CODE3 ("Beja", bej, bej)
 DEFINE_LANGUAGE_CODE ("Belarusian", be, bel, bel)
+DEFINE_LANGUAGE_CODE3 ("Bemba", bem, bem)
 DEFINE_LANGUAGE_CODE ("Bengali", bn, ben, ben)
+DEFINE_LANGUAGE_CODE3 ("Berber (Other)", ber, ber)
+DEFINE_LANGUAGE_CODE3 ("Bhojpuri", bho, bho)
 DEFINE_LANGUAGE_CODE ("Bihari", bh, bih, bih)
+DEFINE_LANGUAGE_CODE3 ("Bikol", bik, bik)
+DEFINE_LANGUAGE_CODE3 ("Bini", bin, bin)
 DEFINE_LANGUAGE_CODE ("Bislama", bi, bis, bis)
 DEFINE_LANGUAGE_CODE ("Bosnian", bs, bos, bos)
+DEFINE_LANGUAGE_CODE3 ("Braj", bra, bra)
 DEFINE_LANGUAGE_CODE ("Breton", br, bre, bre)
+DEFINE_LANGUAGE_CODE3 ("Buginese", bug, bug)
 DEFINE_LANGUAGE_CODE ("Bulgarian", bg, bul, bul)
+DEFINE_LANGUAGE_CODE3 ("Buriat", bua, bua)
 DEFINE_LANGUAGE_CODE ("Burmese", my, mya, bur)
+DEFINE_LANGUAGE_CODE3 ("Caddo", cad, cad)
+DEFINE_LANGUAGE_CODE3 ("Carib", car, car)
 DEFINE_LANGUAGE_CODE ("Catalan", ca, cat, cat)
+DEFINE_LANGUAGE_CODE3 ("Caucasian (Other)", cau, cau)
+DEFINE_LANGUAGE_CODE3 ("Cebuano", ceb, ceb)
+DEFINE_LANGUAGE_CODE3 ("Celtic (Other)", cel, cel)
+DEFINE_LANGUAGE_CODE3 ("Central American Indian (Other)", cai, cai)
+DEFINE_LANGUAGE_CODE3 ("Chagatai", chg, chg)
+DEFINE_LANGUAGE_CODE3 ("Canmic languages", cmc, cmc)
 DEFINE_LANGUAGE_CODE ("Chamorro", ch, cha, cha)
 DEFINE_LANGUAGE_CODE ("Chechen", ce, che, che)
+DEFINE_LANGUAGE_CODE3 ("Cherokee", chr, chr)
+DEFINE_LANGUAGE_CODE ("Chewa; Chechewa; Nyanja", ny, nya, nya)
+DEFINE_LANGUAGE_CODE3 ("Cheyenne", chy, chy)
+DEFINE_LANGUAGE_CODE3 ("Chibcha", chb, chb)
 DEFINE_LANGUAGE_CODE ("Chinese", zh, zho, chi)
+DEFINE_LANGUAGE_CODE3 ("Chinook jargon", chn, chn)
+DEFINE_LANGUAGE_CODE3 ("Chipewyan", chp, chp)
+DEFINE_LANGUAGE_CODE3 ("Choctaw", cho, cho)
 DEFINE_LANGUAGE_CODE ("Church Slavic", cu, chu, chu)
+DEFINE_LANGUAGE_CODE3 ("Chuukese", chk, chk)
 DEFINE_LANGUAGE_CODE ("Chuvash", cv, chv, chv)
+DEFINE_LANGUAGE_CODE3 ("Coptic", cop, cop)
 DEFINE_LANGUAGE_CODE ("Cornish", kw, cor, cor)
 DEFINE_LANGUAGE_CODE ("Corsican", co, cos, cos)
+DEFINE_LANGUAGE_CODE ("Cree", cr, cre, cre)
+DEFINE_LANGUAGE_CODE3 ("Creek", mus, mus)
+DEFINE_LANGUAGE_CODE3 ("Creoles and pidgins (Other)", crp, crp)
+DEFINE_LANGUAGE_CODE3 ("Creoles and pidgins, English-based (Other)", cpe, cpe)
+DEFINE_LANGUAGE_CODE3 ("Creoles and pidgins, French-based (Other)", cpf, cpf)
+DEFINE_LANGUAGE_CODE3 ("Creoles and pidgins, Portuguese-based (Other)", cpp, cpp)
+DEFINE_LANGUAGE_CODE3 ("Crimean Tatar; Crimean Turkish", crh, crh)
+DEFINE_LANGUAGE_CODE ("Croatian", hr, hrv, scr)
+DEFINE_LANGUAGE_CODE3 ("Cushitic (Other)", cus, cus)
 DEFINE_LANGUAGE_CODE ("Czech", cs, ces, cze)
+DEFINE_LANGUAGE_CODE3 ("Dakota", dak, dak)
 DEFINE_LANGUAGE_CODE ("Danish", da, dan, dan)
-DEFINE_LANGUAGE_CODE ("Dutch", nl, nld, dut)
+DEFINE_LANGUAGE_CODE3 ("Dargwa", dar, dar)
+DEFINE_LANGUAGE_CODE3 ("Dayak", day, day)
+DEFINE_LANGUAGE_CODE3 ("Delaware", del, del)
+DEFINE_LANGUAGE_CODE3 ("Dinka", din, din)
+DEFINE_LANGUAGE_CODE ("Divehi", dv, div, div)
+DEFINE_LANGUAGE_CODE3 ("Dogri", doi, doi)
+DEFINE_LANGUAGE_CODE3 ("Dogrib", dgr, dgr)
+DEFINE_LANGUAGE_CODE3 ("Dravidian (Other)", dra, dra)
+DEFINE_LANGUAGE_CODE3 ("Duala", dua, dua)
+DEFINE_LANGUAGE_CODE ("Dutch; Flemish", nl, nld, dut)
+DEFINE_LANGUAGE_CODE3 ("Dutch, Middle", dum, dum)
+DEFINE_LANGUAGE_CODE3 ("Dyula", dyu, dyu)
 DEFINE_LANGUAGE_CODE ("Dzongkha", dz, dzo, dzo)
+DEFINE_LANGUAGE_CODE3 ("Efik", efi, efi)
+DEFINE_LANGUAGE_CODE3 ("Egyptian (Ancient)", egy, egy)
+DEFINE_LANGUAGE_CODE3 ("Ekajuk", eka, eka)
+DEFINE_LANGUAGE_CODE3 ("Elamite", elx, elx)
 DEFINE_LANGUAGE_CODE ("English", en, eng, eng)
+DEFINE_LANGUAGE_CODE3 ("English, Middle", enm, enm)
+DEFINE_LANGUAGE_CODE3 ("English, Old", ang, ang)
+DEFINE_LANGUAGE_CODE3 ("Erzya", myv, myv)
 DEFINE_LANGUAGE_CODE ("Esperanto", eo, epo, epo)
 DEFINE_LANGUAGE_CODE ("Estonian", et, est, est)
+DEFINE_LANGUAGE_CODE ("Ewe", ee, ewe, ewe)
+DEFINE_LANGUAGE_CODE3 ("Ewondo", ewo, ewo)
+DEFINE_LANGUAGE_CODE3 ("Fang", fan, fan)
+DEFINE_LANGUAGE_CODE3 ("Fanti", fat, fat)
 DEFINE_LANGUAGE_CODE ("Faroese", fo, fao, fao)
 DEFINE_LANGUAGE_CODE ("Fijian", fj, fij, fij)
 DEFINE_LANGUAGE_CODE ("Finnish", fi, fin, fin)
+DEFINE_LANGUAGE_CODE3 ("Finno-Ugrian (Other)", fiu, fiu)
+DEFINE_LANGUAGE_CODE3 ("Fon", fon, fon)
 DEFINE_LANGUAGE_CODE ("French", fr, fra, fre)
+DEFINE_LANGUAGE_CODE3 ("French, Middle", frm, frm)
+DEFINE_LANGUAGE_CODE3 ("French, Old", fro, fro)
 DEFINE_LANGUAGE_CODE ("Frisian", fy, fry, fry)
-DEFINE_LANGUAGE_CODE ("Georgian", ka, kat, geo)
-DEFINE_LANGUAGE_CODE ("German", de, deu, ger)
+DEFINE_LANGUAGE_CODE3 ("Friulian", fur, fur)
+DEFINE_LANGUAGE_CODE ("Fulah", ff, ful, ful)
+DEFINE_LANGUAGE_CODE3 ("Ga", gaa, gaa)
 DEFINE_LANGUAGE_CODE ("Gaelic (Scots)", gd, gla, gla)
-DEFINE_LANGUAGE_CODE ("Irish", ga, gle, gle)
 DEFINE_LANGUAGE_CODE ("Gallegan", gl, glg, glg)
-DEFINE_LANGUAGE_CODE3 ("Ganda", lug, lug)
-DEFINE_LANGUAGE_CODE ("Manx", gv, glv, glv)
-DEFINE_LANGUAGE_CODE ("Greek, Modern ()", el, gre, ell)
+DEFINE_LANGUAGE_CODE ("Ganda", lg, lug, lug)
+DEFINE_LANGUAGE_CODE3 ("Gayo", gay, gay)
+DEFINE_LANGUAGE_CODE3 ("Gbaya", gba, gba)
+DEFINE_LANGUAGE_CODE3 ("Geez", gez, gez)
+DEFINE_LANGUAGE_CODE ("Georgian", ka, kat, geo)
+DEFINE_LANGUAGE_CODE ("German", de, deu, ger)
+DEFINE_LANGUAGE_CODE3 ("German,  Low; Saxon, Low", nds, nds)
+DEFINE_LANGUAGE_CODE3 ("German, Middle High", gmh, gmh)
+DEFINE_LANGUAGE_CODE3 ("German, Old High", goh, goh)
+DEFINE_LANGUAGE_CODE3 ("Germanic (Other)", gem, gem)
+DEFINE_LANGUAGE_CODE ("Gikuyu; Kikuyu", ki, kik, kik)
+DEFINE_LANGUAGE_CODE3 ("Gilbertese", gil, gil)
+DEFINE_LANGUAGE_CODE3 ("Gondi", gon, gon)
+DEFINE_LANGUAGE_CODE3 ("Gorontalo", gor, gor)
+DEFINE_LANGUAGE_CODE3 ("Gothic", got, got)
+DEFINE_LANGUAGE_CODE3 ("Grebo", grb, grb)
+DEFINE_LANGUAGE_CODE3 ("Greek, Ancient", grc, grc)
+DEFINE_LANGUAGE_CODE ("Greek, Modern", el, gre, ell)
 DEFINE_LANGUAGE_CODE ("Guarani", gn, grn, grn)
 DEFINE_LANGUAGE_CODE ("Gujarati", gu, guj, guj)
+DEFINE_LANGUAGE_CODE3 ("Gwichin", gwi, gwi)
+DEFINE_LANGUAGE_CODE3 ("Haida", hai, hai)
+DEFINE_LANGUAGE_CODE ("Haitian; Haitian Creole", ht, hat, hat)
+DEFINE_LANGUAGE_CODE ("Hausa", ha, hau, hau)
+DEFINE_LANGUAGE_CODE3 ("Hawaiian", haw, haw)
 DEFINE_LANGUAGE_CODE ("Hebrew", he, heb, heb)
 DEFINE_LANGUAGE_CODE ("Herero", hz, her, her)
+DEFINE_LANGUAGE_CODE3 ("Hiligaynon", hil, hil)
+DEFINE_LANGUAGE_CODE3 ("Himachali", him, him)
 DEFINE_LANGUAGE_CODE ("Hindi", hi, hin, hin)
 DEFINE_LANGUAGE_CODE ("Hiri Motu", ho, hmo, hmo)
+DEFINE_LANGUAGE_CODE3 ("Hittite", hit, hit)
+DEFINE_LANGUAGE_CODE3 ("Hmong", hmn, hmn)
 DEFINE_LANGUAGE_CODE ("Hungarian", hu, hun, hun)
+DEFINE_LANGUAGE_CODE3 ("Hupa", hup, hup)
+DEFINE_LANGUAGE_CODE3 ("Iban", iba, iba)
 DEFINE_LANGUAGE_CODE ("Icelandic", is, isl, ice)
-DEFINE_LANGUAGE_CODE ("Inuktitut", iu, iku, iku)
-DEFINE_LANGUAGE_CODE ("Interlingue", ie, ile, ile)
-DEFINE_LANGUAGE_CODE ("Interlingua", ia, ina, ina)
+DEFINE_LANGUAGE_CODE ("Ido", io, ido, ido)
+DEFINE_LANGUAGE_CODE ("Igbo", ig, ibo, ibo)
+DEFINE_LANGUAGE_CODE3 ("Ijo", ijo, ijo)
+DEFINE_LANGUAGE_CODE3 ("Iloko", ilo, ilo)
+DEFINE_LANGUAGE_CODE3 ("Inari Sami", smn, smn)
+DEFINE_LANGUAGE_CODE3 ("Indic (Other)", inc, inc)
+DEFINE_LANGUAGE_CODE3 ("Indo-European (Other)", ine, ine)
 DEFINE_LANGUAGE_CODE ("Indonesian", id, ind, ind)
+DEFINE_LANGUAGE_CODE3 ("Ingush", inh, inh)
+DEFINE_LANGUAGE_CODE ("Interlingua", ia, ina, ina)
+DEFINE_LANGUAGE_CODE ("Interlingue", ie, ile, ile)
+DEFINE_LANGUAGE_CODE ("Inuktitut", iu, iku, iku)
 DEFINE_LANGUAGE_CODE ("Inupiaq", ik, ipk, ipk)
+DEFINE_LANGUAGE_CODE3 ("Iranian (Other)", ira, ira)
+DEFINE_LANGUAGE_CODE ("Irish", ga, gle, gle)
+DEFINE_LANGUAGE_CODE3 ("Irish, Middle", mga, mga)
+DEFINE_LANGUAGE_CODE3 ("Irish, Old", sga, sga)
+DEFINE_LANGUAGE_CODE3 ("Iroquoian languages", iro, iro)
 DEFINE_LANGUAGE_CODE ("Italian", it, ita, ita)
-DEFINE_LANGUAGE_CODE ("Javanese", jv, jaw, jav)
 DEFINE_LANGUAGE_CODE ("Japanese", ja, jpn, jpn)
+DEFINE_LANGUAGE_CODE ("Javanese", jv, jaw, jav)
+DEFINE_LANGUAGE_CODE3 ("Judeo-Arabic", jrb, jrb)
+DEFINE_LANGUAGE_CODE3 ("Judeo-Persian", jpr, jpr)
+DEFINE_LANGUAGE_CODE3 ("Kabardian", kbd, kbd)
+DEFINE_LANGUAGE_CODE3 ("Kabyle", kab, kab)
+DEFINE_LANGUAGE_CODE3 ("Kachin", kac, kac)
 DEFINE_LANGUAGE_CODE ("Kalaallisut (Greenlandic)", kl, kal, kal)
+DEFINE_LANGUAGE_CODE3 ("Kamba", kam, kam)
 DEFINE_LANGUAGE_CODE ("Kannada", kn, kan, kan)
+DEFINE_LANGUAGE_CODE ("Kanuri", kr, kau, kau)
+DEFINE_LANGUAGE_CODE3 ("Karachay-Balkar", krc, krc)
+DEFINE_LANGUAGE_CODE3 ("Kara-Kalpak", kaa, kaa)
+DEFINE_LANGUAGE_CODE3 ("Karen", kar, kar)
 DEFINE_LANGUAGE_CODE ("Kashmiri", ks, kas, kas)
+DEFINE_LANGUAGE_CODE3 ("Kashubian", csb, csb)
+DEFINE_LANGUAGE_CODE3 ("Kawi", kaw, kaw)
 DEFINE_LANGUAGE_CODE ("Kazakh", kk, kaz, kaz)
+DEFINE_LANGUAGE_CODE3 ("Khasi", kha, kha)
 DEFINE_LANGUAGE_CODE ("Khmer", km, khm, khm)
+DEFINE_LANGUAGE_CODE3 ("Khoisan (Other)", khi, khi)
+DEFINE_LANGUAGE_CODE3 ("Khotanese", kho, kho)
 DEFINE_LANGUAGE_CODE ("Kikuyu", ki, kik, kik)
+DEFINE_LANGUAGE_CODE3 ("Kimbundu", kmb, kmb)
 DEFINE_LANGUAGE_CODE ("Kinyarwanda", rw, kin, kin)
 DEFINE_LANGUAGE_CODE ("Kirghiz", ky, kir, kir)
 DEFINE_LANGUAGE_CODE ("Komi", kv, kom, kom)
+DEFINE_LANGUAGE_CODE ("Kongo", kg, kon, kon)
+DEFINE_LANGUAGE_CODE3 ("Konkani", kok, kok)
 DEFINE_LANGUAGE_CODE ("Korean", ko, kor, kor)
+DEFINE_LANGUAGE_CODE3 ("Kosraean", kos, kos)
+DEFINE_LANGUAGE_CODE3 ("Kpelle", kpe, kpe)
+DEFINE_LANGUAGE_CODE3 ("Kru", kro, kro)
 DEFINE_LANGUAGE_CODE ("Kuanyama", kj, kua, kua)
+DEFINE_LANGUAGE_CODE3 ("Kumyk", kum, kum)
 DEFINE_LANGUAGE_CODE ("Kurdish", ku, kur, kur)
+DEFINE_LANGUAGE_CODE3 ("Kurukh", kru, kru)
+DEFINE_LANGUAGE_CODE3 ("Kutenai", kut, kut)
+DEFINE_LANGUAGE_CODE3 ("Ladino", lad, lad)
+DEFINE_LANGUAGE_CODE3 ("Lahnda", lah, lah)
+DEFINE_LANGUAGE_CODE3 ("Lamba", lam, lam)
 DEFINE_LANGUAGE_CODE ("Lao", lo, lao, lao)
 DEFINE_LANGUAGE_CODE ("Latin", la, lat, lat)
 DEFINE_LANGUAGE_CODE ("Latvian", lv, lav, lav)
+DEFINE_LANGUAGE_CODE ("Letzeburgesch", lb, ltz, ltz)
+DEFINE_LANGUAGE_CODE3 ("Lezghian", lez, lez)
+DEFINE_LANGUAGE_CODE ("Limburgan; Limburger; Limburgish", li, lim, lim)
 DEFINE_LANGUAGE_CODE ("Lingala", ln, lin, lin)
 DEFINE_LANGUAGE_CODE ("Lithuanian", lt, lit, lit)
-DEFINE_LANGUAGE_CODE ("Letzeburgesch", lb, ltz, ltz)
+DEFINE_LANGUAGE_CODE3 ("Lozi", loz, loz)
+DEFINE_LANGUAGE_CODE ("Luba-Katanga", lu, lub, lub)
+DEFINE_LANGUAGE_CODE3 ("Luba-Lulua", lua, lua)
+DEFINE_LANGUAGE_CODE3 ("Luiseno", lui, lui)
+DEFINE_LANGUAGE_CODE3 ("Lule Sami", smj, smj)
+DEFINE_LANGUAGE_CODE3 ("Lunda", lun, lun)
+DEFINE_LANGUAGE_CODE3 ("Luo (Kenya and Tanzania)", luo, luo)
+DEFINE_LANGUAGE_CODE3 ("Lushai", lus, lus)
 DEFINE_LANGUAGE_CODE ("Macedonian", mk, mkd, mac)
-DEFINE_LANGUAGE_CODE ("Marshall", mh, mah, mah)
+DEFINE_LANGUAGE_CODE3 ("Madurese", mad, mad)
+DEFINE_LANGUAGE_CODE3 ("Magahi", mag, mag)
+DEFINE_LANGUAGE_CODE3 ("Maithili", mai, mai)
+DEFINE_LANGUAGE_CODE3 ("Makasar", mak, mak)
+DEFINE_LANGUAGE_CODE ("Malagasy", mg, mlg, mlg)
+DEFINE_LANGUAGE_CODE ("Malay", ms, msa, may)
 DEFINE_LANGUAGE_CODE ("Malayalam", ml, mal, mal)
+DEFINE_LANGUAGE_CODE ("Maltese", mt, mlt, mlt)
+DEFINE_LANGUAGE_CODE3 ("Manchu", mnc, mnc)
+DEFINE_LANGUAGE_CODE3 ("Mandar", mdr, mdr)
+DEFINE_LANGUAGE_CODE3 ("Mandingo", man, man)
+DEFINE_LANGUAGE_CODE3 ("Manipuri", mni, mni)
+DEFINE_LANGUAGE_CODE3 ("Manobo languages", mno, mno)
+DEFINE_LANGUAGE_CODE ("Manx", gv, glv, glv)
 DEFINE_LANGUAGE_CODE ("Maori", mi, mri, mao)
 DEFINE_LANGUAGE_CODE ("Marathi", mr, mar, mar)
-DEFINE_LANGUAGE_CODE ("Malay", ms, msa, may)
-DEFINE_LANGUAGE_CODE ("Malagasy", mg, mlg, mlg)
-DEFINE_LANGUAGE_CODE ("Maltese", mt, mlt, mlt)
+DEFINE_LANGUAGE_CODE3 ("Mari", chm, chm)
+DEFINE_LANGUAGE_CODE ("Marshallese", mh, mah, mah)
+DEFINE_LANGUAGE_CODE3 ("Marwari", mwr, mwr)
+DEFINE_LANGUAGE_CODE3 ("Masai", mas, mas)
+DEFINE_LANGUAGE_CODE3 ("Mayan languages", myn, myn)
+DEFINE_LANGUAGE_CODE3 ("Mende", men, men)
+DEFINE_LANGUAGE_CODE3 ("Micmac", mic, mic)
+DEFINE_LANGUAGE_CODE3 ("Minangkabau", min, min)
+DEFINE_LANGUAGE_CODE3 ("Miscellaneous languages", mis, mis)
+DEFINE_LANGUAGE_CODE3 ("Mohawk", moh, moh)
+DEFINE_LANGUAGE_CODE3 ("Moksha", mdf, mdf)
 DEFINE_LANGUAGE_CODE ("Moldavian", mo, mol, mol)
+DEFINE_LANGUAGE_CODE3 ("Mon-Khmer (Other)", mkh, mkh)
+DEFINE_LANGUAGE_CODE3 ("Mongo", lol, lol)
 DEFINE_LANGUAGE_CODE ("Mongolian", mn, mon, mon)
+DEFINE_LANGUAGE_CODE3 ("Mossi", mos, mos)
+DEFINE_LANGUAGE_CODE3 ("Munda languages", mun, mun)
+DEFINE_LANGUAGE_CODE3 ("Nahuatl", nah, nah)
 DEFINE_LANGUAGE_CODE ("Nauru", na, nau, nau)
 DEFINE_LANGUAGE_CODE ("Navajo", nv, nav, nav)
-DEFINE_LANGUAGE_CODE ("Ndebele, South", nr, nbl, nbl)
 DEFINE_LANGUAGE_CODE ("Ndebele, North", nd, nde, nde)
+DEFINE_LANGUAGE_CODE ("Ndebele, South", nr, nbl, nbl)
 DEFINE_LANGUAGE_CODE ("Ndonga", ng, ndo, ndo)
+DEFINE_LANGUAGE_CODE3 ("Neapolitan", nap, nap)
 DEFINE_LANGUAGE_CODE ("Nepali", ne, nep, nep)
+DEFINE_LANGUAGE_CODE3 ("Newari", new, new)
+DEFINE_LANGUAGE_CODE3 ("Nias", nia, nia)
+DEFINE_LANGUAGE_CODE3 ("Niger-Kordofanian (Other)", nic, nic)
+DEFINE_LANGUAGE_CODE3 ("Nilo-Saharan (Other)", ssa, ssa)
+DEFINE_LANGUAGE_CODE3 ("Niuean", niu, niu)
+DEFINE_LANGUAGE_CODE3 ("Nogai", nog, nog)
+DEFINE_LANGUAGE_CODE3 ("Norse, Old", non, non)
+DEFINE_LANGUAGE_CODE3 ("North  American  Indian  (Other)", nai, nai)
+DEFINE_LANGUAGE_CODE ("Northern Sami", se, sme, sme)
 DEFINE_LANGUAGE_CODE ("Norwegian", no, nor, nor)
-DEFINE_LANGUAGE_CODE ("Norwegian Nynorsk", nn, nno, nno)
 DEFINE_LANGUAGE_CODE ("Norwegian Bokml", nb, nob, nob)
-DEFINE_LANGUAGE_CODE ("Chichewa; Nyanja", ny, nya, nya)
-DEFINE_LANGUAGE_CODE ("Occitan (post 1500); Provenal", oc, oci, oci)
+DEFINE_LANGUAGE_CODE ("Norwegian Nynorsk", nn, nno, nno)
+DEFINE_LANGUAGE_CODE3 ("Nubian languages", nub, nub)
+DEFINE_LANGUAGE_CODE3 ("Nyamwezi", nym, nym)
+DEFINE_LANGUAGE_CODE3 ("Nyankole", nyn, nyn)
+DEFINE_LANGUAGE_CODE3 ("Nyoro", nyo, nyo)
+DEFINE_LANGUAGE_CODE3 ("Nzima", nzi, nzi)
+DEFINE_LANGUAGE_CODE ("Ojibwa", oj, oji, oji)
 DEFINE_LANGUAGE_CODE ("Oriya", or, ori, ori)
 DEFINE_LANGUAGE_CODE ("Oromo", om, orm, orm)
+DEFINE_LANGUAGE_CODE3 ("Osage", osa, osa)
 DEFINE_LANGUAGE_CODE ("Ossetian; Ossetic", os, oss, oss)
+DEFINE_LANGUAGE_CODE3 ("Otomian languages", oto, oto)
+DEFINE_LANGUAGE_CODE3 ("Pahlavi", pal, pal)
+DEFINE_LANGUAGE_CODE3 ("Palauan", pau, pau)
+DEFINE_LANGUAGE_CODE ("Pali", pi, pli, pli)
+DEFINE_LANGUAGE_CODE3 ("Pampanga", pam, pam)
+DEFINE_LANGUAGE_CODE3 ("Pangasinan", pag, pag)
 DEFINE_LANGUAGE_CODE ("Panjabi", pa, pan, pan)
+DEFINE_LANGUAGE_CODE3 ("Papiamento", pap, pap)
+DEFINE_LANGUAGE_CODE3 ("Papuan (Other)", paa, paa)
 DEFINE_LANGUAGE_CODE ("Persian", fa, fas, per)
-DEFINE_LANGUAGE_CODE ("Pali", pi, pli, pli)
+DEFINE_LANGUAGE_CODE3 ("Persian, Old (ca.600-400 B.C.E.)", peo, peo)
+DEFINE_LANGUAGE_CODE3 ("Philippine (Other)", phi, phi)
+DEFINE_LANGUAGE_CODE3 ("Phoenician", phn, phn)
+DEFINE_LANGUAGE_CODE3 ("Pohnpeian", pon, pon)
 DEFINE_LANGUAGE_CODE ("Polish", pl, pol, pol)
 DEFINE_LANGUAGE_CODE ("Portuguese", pt, por, por)
+DEFINE_LANGUAGE_CODE3 ("Prakrit", pra, pra)
+DEFINE_LANGUAGE_CODE ("Provenal; Occitan (post 1500)", oc, oci, oci)
+DEFINE_LANGUAGE_CODE3 ("Provenal, Old (to 1500)", pro, pro)
 DEFINE_LANGUAGE_CODE ("Pushto", ps, pus, pus)
 DEFINE_LANGUAGE_CODE ("Quechua", qu, que, que)
 DEFINE_LANGUAGE_CODE ("Raeto-Romance", rm, roh, roh)
+DEFINE_LANGUAGE_CODE3 ("Rajasthani", raj, raj)
+DEFINE_LANGUAGE_CODE3 ("Rapanui", rap, rap)
+DEFINE_LANGUAGE_CODE3 ("Rarotongan", rar, rar)
+DEFINE_LANGUAGE_CODE3 ("Romance (Other)", roa, roa)
 DEFINE_LANGUAGE_CODE ("Romanian", ro, ron, rum)
+DEFINE_LANGUAGE_CODE3 ("Romany", rom, rom)
 DEFINE_LANGUAGE_CODE ("Rundi", rn, run, run)
 DEFINE_LANGUAGE_CODE ("Russian", ru, rus, rus)
+DEFINE_LANGUAGE_CODE3 ("Salishan languages", sal, sal)
+DEFINE_LANGUAGE_CODE3 ("Samaritan Aramaic", sam, sam)
+DEFINE_LANGUAGE_CODE3 ("Sami languages (Other)", smi, smi)
+DEFINE_LANGUAGE_CODE ("Samoan", sm, smo, smo)
+DEFINE_LANGUAGE_CODE3 ("Sandawe", sad, sad)
 DEFINE_LANGUAGE_CODE ("Sango", sg, sag, sag)
 DEFINE_LANGUAGE_CODE ("Sanskrit", sa, san, san)
+DEFINE_LANGUAGE_CODE3 ("Santali", sat, sat)
+DEFINE_LANGUAGE_CODE ("Sardinian", sc, srd, srd)
+DEFINE_LANGUAGE_CODE3 ("Sasak", sas, sas)
+DEFINE_LANGUAGE_CODE3 ("Scots", sco, sco)
+DEFINE_LANGUAGE_CODE3 ("Selkup", sel, sel)
+DEFINE_LANGUAGE_CODE3 ("Semitic (Other)", sem, sem)
 DEFINE_LANGUAGE_CODE ("Serbian", sr, srp, scc)
-DEFINE_LANGUAGE_CODE ("Croatian", hr, hrv, scr)
+DEFINE_LANGUAGE_CODE3 ("Serer", srr, srr)
+DEFINE_LANGUAGE_CODE3 ("Shan", shn, shn)
+DEFINE_LANGUAGE_CODE ("Shona", sn, sna, sna)
+DEFINE_LANGUAGE_CODE ("Sichuan Yi", ii, iii, iii)
+DEFINE_LANGUAGE_CODE3 ("Sidamo", sid, sid)
+DEFINE_LANGUAGE_CODE3 ("Siksika", bla, bla)
+DEFINE_LANGUAGE_CODE ("Sindhi", sd, snd, snd)
 DEFINE_LANGUAGE_CODE ("Sinhalese", si, sin, sin)
+DEFINE_LANGUAGE_CODE3 ("Sino-Tibetan (Other)", sit, sit)
+DEFINE_LANGUAGE_CODE3 ("Siouan languages", sio, sio)
+DEFINE_LANGUAGE_CODE3 ("Skolt Sami", sms, sms)
+DEFINE_LANGUAGE_CODE3 ("Slave (Athapascan)", den, den)
+DEFINE_LANGUAGE_CODE3 ("Slavic (Other)", sla, sla)
 DEFINE_LANGUAGE_CODE ("Slovak", sk, slk, slo)
 DEFINE_LANGUAGE_CODE ("Slovenian", sl, slv, slv)
-DEFINE_LANGUAGE_CODE ("Northern Sami", se, sme, sme)
-DEFINE_LANGUAGE_CODE ("Samoan", sm, smo, smo)
-DEFINE_LANGUAGE_CODE ("Shona", sn, sna, sna)
-DEFINE_LANGUAGE_CODE ("Sindhi", sd, snd, snd)
+DEFINE_LANGUAGE_CODE3 ("Sogdian", sog, sog)
 DEFINE_LANGUAGE_CODE ("Somali", so, som, som)
+DEFINE_LANGUAGE_CODE3 ("Songhai", son, son)
+DEFINE_LANGUAGE_CODE3 ("Soninke", snk, snk)
+DEFINE_LANGUAGE_CODE3 ("Sorbian languages", wen, wen)
 DEFINE_LANGUAGE_CODE3 ("Sotho, Northern", nso, nso)
 DEFINE_LANGUAGE_CODE ("Sotho, Southern", st, sot, sot)
+DEFINE_LANGUAGE_CODE3 ("South American Indian (Other)", sai, sai)
+DEFINE_LANGUAGE_CODE3 ("Southern Sami", sma, sma)
 DEFINE_LANGUAGE_CODE ("Spanish", es, spa, spa)
-DEFINE_LANGUAGE_CODE ("Sardinian", sc, srd, srd)
-DEFINE_LANGUAGE_CODE ("Swati", ss, ssw, ssw)
+DEFINE_LANGUAGE_CODE3 ("Sukuma", suk, suk)
+DEFINE_LANGUAGE_CODE3 ("Sumerian", sux, sux)
 DEFINE_LANGUAGE_CODE ("Sundanese", su, sun, sun)
+DEFINE_LANGUAGE_CODE3 ("Susu", sus, sus)
 DEFINE_LANGUAGE_CODE ("Swahili", sw, swa, swa)
+DEFINE_LANGUAGE_CODE ("Swati", ss, ssw, ssw)
 DEFINE_LANGUAGE_CODE ("Swedish", sv, swe, swe)
+DEFINE_LANGUAGE_CODE3 ("Syriac", syr, syr)
+DEFINE_LANGUAGE_CODE ("Tagalog", tl, tgl, tgl)
 DEFINE_LANGUAGE_CODE ("Tahitian", ty, tah, tah)
+DEFINE_LANGUAGE_CODE3 ("Tai (Other)", tai, tai)
+DEFINE_LANGUAGE_CODE ("Tajik", tg, tgk, tgk)
+DEFINE_LANGUAGE_CODE3 ("Tamashek", tmh, tmh)
 DEFINE_LANGUAGE_CODE ("Tamil", ta, tam, tam)
 DEFINE_LANGUAGE_CODE ("Tatar", tt, tat, tat)
 DEFINE_LANGUAGE_CODE ("Telugu", te, tel, tel)
-DEFINE_LANGUAGE_CODE ("Tajik", tg, tgk, tgk)
-DEFINE_LANGUAGE_CODE ("Tagalog", tl, tgl, tgl)
+DEFINE_LANGUAGE_CODE3 ("Tereno", ter, ter)
+DEFINE_LANGUAGE_CODE3 ("Tetum", tet, tet)
 DEFINE_LANGUAGE_CODE ("Thai", th, tha, tha)
 DEFINE_LANGUAGE_CODE ("Tibetan", bo, bod, tib)
+DEFINE_LANGUAGE_CODE3 ("Tigre", tig, tig)
 DEFINE_LANGUAGE_CODE ("Tigrinya", ti, tir, tir)
+DEFINE_LANGUAGE_CODE3 ("Timne", tem, tem)
+DEFINE_LANGUAGE_CODE3 ("Tiv", tiv, tiv)
+DEFINE_LANGUAGE_CODE3 ("Tlingit", tli, tli)
+DEFINE_LANGUAGE_CODE3 ("Tok Pisin", tpi, tpi)
+DEFINE_LANGUAGE_CODE3 ("Tokelau", tkl, tkl)
+DEFINE_LANGUAGE_CODE3 ("Tonga (Nyasa)", tog, tog)
 DEFINE_LANGUAGE_CODE ("Tonga (Tonga Islands)", to, ton, ton)
-DEFINE_LANGUAGE_CODE ("Tswana", tn, tsn, tsn)
+DEFINE_LANGUAGE_CODE3 ("Tsimshian", tsi, tsi)
 DEFINE_LANGUAGE_CODE ("Tsonga", ts, tso, tso)
+DEFINE_LANGUAGE_CODE ("Tswana", tn, tsn, tsn)
+DEFINE_LANGUAGE_CODE3 ("Tumbuka", tum, tum)
+DEFINE_LANGUAGE_CODE3 ("Tupi languages", tup, tup)
 DEFINE_LANGUAGE_CODE ("Turkish", tr, tur, tur)
+DEFINE_LANGUAGE_CODE3 ("Turkish, Ottoman (1500-1928)", ota, ota)
 DEFINE_LANGUAGE_CODE ("Turkmen", tk, tuk, tuk)
+DEFINE_LANGUAGE_CODE3 ("Tuvalu", tvl, tvl)
+DEFINE_LANGUAGE_CODE3 ("Tuvinian", tyv, tyv)
 DEFINE_LANGUAGE_CODE ("Twi", tw, twi, twi)
+DEFINE_LANGUAGE_CODE3 ("Udmurt", udm, udm)
+DEFINE_LANGUAGE_CODE3 ("Ugaritic", uga, uga)
 DEFINE_LANGUAGE_CODE ("Uighur", ug, uig, uig)
 DEFINE_LANGUAGE_CODE ("Ukrainian", uk, ukr, ukr)
+DEFINE_LANGUAGE_CODE3 ("Umbundu", umb, umb)
 DEFINE_LANGUAGE_CODE ("Urdu", ur, urd, urd)
 DEFINE_LANGUAGE_CODE ("Uzbek", uz, uzb, uzb)
+DEFINE_LANGUAGE_CODE3 ("Vai", vai, vai)
 DEFINE_LANGUAGE_CODE3 ("Venda", ven, ven)
 DEFINE_LANGUAGE_CODE ("Vietnamese", vi, vie, vie)
 DEFINE_LANGUAGE_CODE ("Volapk", vo, vol, vol)
+DEFINE_LANGUAGE_CODE3 ("Votic", vot, vot)
+DEFINE_LANGUAGE_CODE3 ("Wakashan languages", wak, wak)
+DEFINE_LANGUAGE_CODE3 ("Walamo", wal, wal)
 DEFINE_LANGUAGE_CODE ("Walloon", wa, wln, wln)
+DEFINE_LANGUAGE_CODE3 ("Waray", war, war)
+DEFINE_LANGUAGE_CODE3 ("Washo", was, was)
 DEFINE_LANGUAGE_CODE ("Welsh", cy, cym, wel)
 DEFINE_LANGUAGE_CODE ("Wolof", wo, wol, wol)
 DEFINE_LANGUAGE_CODE ("Xhosa", xh, xho, xho)
+DEFINE_LANGUAGE_CODE3 ("Yakut", sah, sah)
+DEFINE_LANGUAGE_CODE3 ("Yao", yao, yao)
+DEFINE_LANGUAGE_CODE3 ("Yapese", yap, yap)
 DEFINE_LANGUAGE_CODE ("Yiddish", yi, yid, yid)
 DEFINE_LANGUAGE_CODE ("Yoruba", yo, yor, yor)
+DEFINE_LANGUAGE_CODE3 ("Yupik languages", ypk, ypk)
+DEFINE_LANGUAGE_CODE3 ("Zande", znd, znd)
+DEFINE_LANGUAGE_CODE3 ("Zapotec", zap, zap)
+DEFINE_LANGUAGE_CODE3 ("Zenaga", zen, zen)
 DEFINE_LANGUAGE_CODE ("Zhuang", za, zha, zha)
 DEFINE_LANGUAGE_CODE ("Zulu", zu, zul, zul)
+DEFINE_LANGUAGE_CODE3 ("Zuni", zun, zun)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/3level.h libc-20030708/locale/programs/3level.h
--- glibc-2.3.2/locale/programs/3level.h	2001-08-08 03:51:49.000000000 +0900
+++ libc-20030708/locale/programs/3level.h	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000-2001 Free Software Foundation, Inc.
+/* Copyright (C) 2000-2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Bruno Haible <haible@clisp.cons.org>, 2000.
 
@@ -80,6 +80,7 @@
 
 /* Retrieve an entry.  */
 static inline ELEMENT
+__attribute ((always_inline))
 CONCAT(TABLE,_get) (struct TABLE *t, uint32_t wc)
 {
   uint32_t index1 = wc >> (t->q + t->p);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/ld-collate.c libc-20030708/locale/programs/ld-collate.c
--- glibc-2.3.2/locale/programs/ld-collate.c	2002-05-02 01:44:51.000000000 +0900
+++ libc-20030708/locale/programs/ld-collate.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.org>, 1995.
 
@@ -42,6 +42,7 @@
 #define obstack_chunk_free free
 
 static inline void
+__attribute ((always_inline))
 obstack_int32_grow (struct obstack *obstack, int32_t data)
 {
   if (sizeof (int32_t) == sizeof (int))
@@ -51,6 +52,7 @@
 }
 
 static inline void
+__attribute ((always_inline))
 obstack_int32_grow_fast (struct obstack *obstack, int32_t data)
 {
   if (sizeof (int32_t) == sizeof (int))
@@ -249,6 +251,7 @@
 
 /* We need UTF-8 encoding of numbers.  */
 static inline int
+__attribute ((always_inline))
 utf8_encode (char *buf, int val)
 {
   int retval;
@@ -606,10 +609,10 @@
 find_element (struct linereader *ldfile, struct locale_collate_t *collate,
 	      const char *str, size_t len)
 {
-  struct element_t *result = NULL;
+  void *result = NULL;
 
   /* Search for the entries among the collation sequences already define.  */
-  if (find_entry (&collate->seq_table, str, len, (void **) &result) != 0)
+  if (find_entry (&collate->seq_table, str, len, &result) != 0)
     {
       /* Nope, not define yet.  So we see whether it is a
          collation symbol.  */
@@ -625,8 +628,7 @@
 	    result = sym->order = new_element (collate, NULL, 0, NULL,
 					       NULL, 0, 0);
 	}
-      else if (find_entry (&collate->elem_table, str, len,
-			   (void **) &result) != 0)
+      else if (find_entry (&collate->elem_table, str, len, &result) != 0)
 	{
 	  /* It's also no collation element.  So it is a character
 	     element defined later.  */
@@ -636,7 +638,7 @@
 	}
     }
 
-  return result;
+  return (struct element_t *) result;
 }
 
 
@@ -944,8 +946,8 @@
     {
       /* It's no character, so look through the collation elements and
 	 symbol list.  */
-      if (find_entry (&collate->elem_table, symstr, symlen,
-			   (void **) &elem) != 0)
+      void *ptr = elem;
+      if (find_entry (&collate->elem_table, symstr, symlen, &ptr) != 0)
 	{
 	  void *result;
 	  struct symbol_t *sym = NULL;
@@ -976,12 +978,15 @@
 		insert_entry (&collate->seq_table, symstr, symlen, elem);
 	    }
 	}
+      else
+	/* Copy the result back.  */
+	elem = ptr;
     }
   else
     {
       /* Otherwise the symbols stands for a character.  */
-      if (find_entry (&collate->seq_table, symstr, symlen,
-		      (void **) &elem) != 0)
+      void *ptr = elem;
+      if (find_entry (&collate->seq_table, symstr, symlen, &ptr) != 0)
 	{
 	  uint32_t wcs[2] = { wc, 0 };
 
@@ -998,6 +1003,9 @@
 	}
       else
 	{
+	  /* Copy the result back.  */
+	  elem = ptr;
+
 	  /* Maybe the character was used before the definition.  In this case
 	     we have to insert the byte sequences now.  */
 	  if (elem->mbs == NULL && seq != NULL)
@@ -1169,8 +1177,9 @@
 		  /* Now we are ready to insert the new value in the
 		     sequence.  Find out whether the element is
 		     already known.  */
+		  void *ptr;
 		  if (find_entry (&collate->seq_table, seq->name, namelen,
-				  (void **) &elem) != 0)
+				  &ptr) != 0)
 		    {
 		      uint32_t wcs[2] = { seq->ucs4, 0 };
 
@@ -1186,6 +1195,9 @@
 			/* This cannot happen.  */
 			assert (! "Internal error");
 		    }
+		  else
+		    /* Copy the result.  */
+		    elem = ptr;
 
 		  /* Test whether this element is not already in the list.  */
 		  if (elem->next != NULL || (collate->cursor != NULL
@@ -1324,9 +1336,12 @@
 	      sprintf (buf + preflen, base == 10 ? "%ld" : "%lX", from);
 
 	      /* Look whether this name is already defined.  */
-	      if (find_entry (&collate->seq_table, buf, symlen,
-			      (void **) &elem) == 0)
+	      void *ptr;
+	      if (find_entry (&collate->seq_table, buf, symlen, &ptr) == 0)
 		{
+		  /* Copy back the result.  */
+		  elem = ptr;
+
 		  if (elem->next != NULL || (collate->cursor != NULL
 					     && elem->next == collate->cursor))
 		    {
@@ -3009,7 +3024,7 @@
 	      size_t newname_len = arg->val.str.lenmb;
 	      const char *symname;
 	      size_t symname_len;
-	      struct symbol_t *symval;
+	      void *symval;	/* Actually struct symbol_t*  */
 
 	      arg = lr_token (ldfile, charmap, result, repertoire, verbose);
 	      if (arg->tok != tok_bsymbol)
@@ -3045,7 +3060,7 @@
 
 	      /* See whether the symbol name is already defined.  */
 	      if (find_entry (&collate->sym_table, symname, symname_len,
-			      (void **) &symval) != 0)
+			      &symval) != 0)
 		{
 		  lr_error (ldfile, _("\
 %s: unknown symbol `%s' in equivalent definition"),
@@ -3294,6 +3309,7 @@
 	      size_t lenmb;
 	      struct element_t *insp;
 	      int no_error = 1;
+	      void *ptr;
 
 	      if (arg->tok == tok_bsymbol)
 		{
@@ -3307,18 +3323,20 @@
 		  lenmb = 9;
 		}
 
-	      if (find_entry (&collate->seq_table, startmb, lenmb,
-			      (void **) &insp) == 0)
+	      if (find_entry (&collate->seq_table, startmb, lenmb, &ptr) == 0)
 		/* Yes, the symbol exists.  Simply point the cursor
 		   to it.  */
-		collate->cursor = insp;
+		collate->cursor = (struct element_t *) ptr;
 	      else
 		{
 		  struct symbol_t *symbp;
+		  void *ptr;
 
 		  if (find_entry (&collate->sym_table, startmb, lenmb,
-				  (void **) &symbp) == 0)
+				  &ptr) == 0)
 		    {
+		      symbp = ptr;
+
 		      if (symbp->order->last != NULL
 			  || symbp->order->next != NULL)
 			collate->cursor = symbp->order;
@@ -3334,8 +3352,10 @@
 			}
 		    }
 		  else if (find_entry (&collate->elem_table, startmb, lenmb,
-				       (void **) &insp) == 0)
+				       &ptr) == 0)
 		    {
+		      insp = (struct element_t *) ptr;
+
 		      if (insp->last != NULL || insp->next != NULL)
 			collate->cursor = insp;
 		      else
@@ -3517,10 +3537,12 @@
                  collation symbols since these are purely abstract
                  values and don't need directions associated.  */
 	      struct element_t *seqp;
+	      void *ptr;
 
-	      if (find_entry (&collate->seq_table, symstr, symlen,
-			      (void **) &seqp) == 0)
+	      if (find_entry (&collate->seq_table, symstr, symlen, &ptr) == 0)
 		{
+		  seqp = ptr;
+
 		  /* It's already defined.  First check whether this
 		     is really a collating symbol.  */
 		  if (seqp->is_character)
@@ -3561,8 +3583,9 @@
 	    {
 	      /* It is possible that we already have this collation sequence.
 		 In this case we move the entry.  */
-	      struct element_t *seqp;
+	      struct element_t *seqp = NULL;
 	      void *sym;
+	      void *ptr;
 
 	      /* If the symbol after which we have to insert was not found
 		 ignore all entries.  */
@@ -3572,17 +3595,19 @@
 		  break;
 		}
 
-	      if (find_entry (&collate->seq_table, symstr, symlen,
-			      (void **) &seqp) == 0)
-		goto move_entry;
+	      if (find_entry (&collate->seq_table, symstr, symlen, &ptr) == 0)
+		{
+		  seqp = (struct element_t *) ptr;
+		  goto move_entry;
+		}
 
 	      if (find_entry (&collate->sym_table, symstr, symlen, &sym) == 0
 		  && (seqp = ((struct symbol_t *) sym)->order) != NULL)
 		goto move_entry;
 
-	      if (find_entry (&collate->elem_table, symstr, symlen,
-			      (void **) &seqp) == 0
-		  && (seqp->last != NULL || seqp->next != NULL
+	      if (find_entry (&collate->elem_table, symstr, symlen, &ptr) == 0
+		  && (seqp = (struct element_t *) ptr,
+		      seqp->last != NULL || seqp->next != NULL
 		      || (collate->start != NULL && seqp == collate->start)))
 		{
 		move_entry:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/ld-time.c libc-20030708/locale/programs/ld-time.c
--- glibc-2.3.2/locale/programs/ld-time.c	2002-04-17 09:45:08.000000000 +0900
+++ libc-20030708/locale/programs/ld-time.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.org>, 1995.
 
@@ -170,7 +170,7 @@
   if (!time->cat##_defined)						      \
     {									      \
       const char *initval[] = { noparen val };				      \
-      int i;								      \
+      unsigned int i;							      \
 									      \
       if (! be_quiet && ! nothing)					      \
 	WITH_CUR_LOCALE (error (0, 0, _("%s: field `%s' not defined"),	      \
@@ -670,7 +670,7 @@
   idx[1 + last_idx] = idx[last_idx];
   for (num = 0; num < time->num_era; ++num)
     {
-      size_t l;
+      size_t l, l2;
 
       iov[2 + cnt].iov_base = (void *) &time->era_entries[num].direction;
       iov[2 + cnt].iov_len = sizeof (int32_t);
@@ -697,14 +697,16 @@
       iov[2 + cnt].iov_len = sizeof (int32_t);
       ++cnt;
 
-      l = (strchr (time->era_entries[num].format, '\0')
+      l = ((char *) rawmemchr (time->era_entries[num].format, '\0')
 	   - time->era_entries[num].name) + 1;
-      l = (l + 3) & ~3;
-      iov[2 + cnt].iov_base = (void *) time->era_entries[num].name;
-      iov[2 + cnt].iov_len = l;
+      l2 = (l + 3) & ~3;
+      iov[2 + cnt].iov_base = alloca (l2);
+      memset (mempcpy (iov[2 + cnt].iov_base, time->era_entries[num].name, l),
+	      '\0', l2 - l);
+      iov[2 + cnt].iov_len = l2;
       ++cnt;
 
-      idx[1 + last_idx] += 8 * sizeof (int32_t) + l;
+      idx[1 + last_idx] += 8 * sizeof (int32_t) + l2;
 
       assert (idx[1 + last_idx] % 4 == 0);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/linereader.c libc-20030708/locale/programs/linereader.c
--- glibc-2.3.2/locale/programs/linereader.c	2002-10-18 02:45:12.000000000 +0900
+++ libc-20030708/locale/programs/linereader.c	2003-06-12 08:54:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.org>, 1996.
 
@@ -111,6 +111,35 @@
 
 
 void
+lr_ignore_rest (struct linereader *lr, int verbose)
+{
+  if (verbose)
+    {
+      while (isspace (lr->buf[lr->idx]) && lr->buf[lr->idx] != '\n'
+	     && lr->buf[lr->idx] != lr->comment_char)
+	if (lr->buf[lr->idx] == '\0')
+	  {
+	    if (lr_next (lr) < 0)
+	      return;
+	  }
+	else
+	  ++lr->idx;
+
+      if (lr->buf[lr->idx] != '\n' && ! feof (lr->fp)
+	  && lr->buf[lr->idx] != lr->comment_char)
+	lr_error (lr, _("trailing garbage at end of line"));
+    }
+
+  /* Ignore continued line.  */
+  while (lr->bufact > 0 && lr->buf[lr->bufact - 1] != '\n')
+    if (lr_next (lr) < 0)
+      break;
+
+  lr->idx = lr->bufact;
+}
+
+
+void
 lr_close (struct linereader *lr)
 {
   fclose (lr->fp);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/linereader.h libc-20030708/locale/programs/linereader.h
--- glibc-2.3.2/locale/programs/linereader.h	2002-02-06 08:20:05.000000000 +0900
+++ libc-20030708/locale/programs/linereader.h	2003-06-12 08:54:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper, <drepper@gnu.org>.
 
@@ -95,6 +95,7 @@
 			       struct localedef_t *locale,
 			       const struct repertoire_t *repertoire,
 			       int verbose);
+extern void lr_ignore_rest (struct linereader *lr, int verbose);
 
 
 #define lr_error(lr, fmt, args...) \
@@ -103,6 +104,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 lr_getc (struct linereader *lr)
 {
   if (lr->idx == lr->bufact)
@@ -120,6 +122,7 @@
 
 
 static inline int
+__attribute ((always_inline))
 lr_ungetc (struct linereader *lr, int ch)
 {
   if (lr->idx == 0)
@@ -142,33 +145,4 @@
 }
 
 
-static inline void
-lr_ignore_rest (struct linereader *lr, int verbose)
-{
-  if (verbose)
-    {
-      while (isspace (lr->buf[lr->idx]) && lr->buf[lr->idx] != '\n'
-	     && lr->buf[lr->idx] != lr->comment_char)
-	if (lr->buf[lr->idx] == '\0')
-	  {
-	    if (lr_next (lr) < 0)
-	      return;
-	  }
-	else
-	  ++lr->idx;
-
-      if (lr->buf[lr->idx] != '\n' && ! feof (lr->fp)
-	  && lr->buf[lr->idx] != lr->comment_char)
-	lr_error (lr, _("trailing garbage at end of line"));
-    }
-
-  /* Ignore continued line.  */
-  while (lr->bufact > 0 && lr->buf[lr->bufact - 1] != '\n')
-    if (lr_next (lr) < 0)
-      break;
-
-  lr->idx = lr->bufact;
-}
-
-
 #endif /* linereader.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/locale.c libc-20030708/locale/programs/locale.c
--- glibc-2.3.2/locale/programs/locale.c	2003-01-03 05:02:12.000000000 +0900
+++ libc-20030708/locale/programs/locale.c	2003-06-12 08:54:03.000000000 +0900
@@ -191,8 +191,10 @@
 
   /* Set locale.  Do not set LC_ALL because the other categories must
      not be affected (according to POSIX.2).  */
-  setlocale (LC_CTYPE, "");
-  setlocale (LC_MESSAGES, "");
+  if (setlocale (LC_CTYPE, "") == NULL)
+    error (0, errno, gettext ("Cannot set LC_CTYPE to default locale"));
+  if (setlocale (LC_MESSAGES, "") == NULL)
+    error (0, errno, gettext ("Cannot set LC_MESSAGES to default locale"));
 
   /* Initialize the message catalog.  */
   textdomain (PACKAGE);
@@ -203,7 +205,9 @@
   /* `-a' requests the names of all available locales.  */
   if (do_all != 0)
     {
-      setlocale (LC_COLLATE, "");
+      if (setlocale (LC_COLLATE, "") == NULL)
+	error (0, errno,
+	       gettext ("Cannot set LC_COLLATE to default locale"));
       write_locales ();
       exit (EXIT_SUCCESS);
     }
@@ -218,7 +222,8 @@
 
   /* Specific information about the current locale are requested.
      Change to this locale now.  */
-  setlocale (LC_ALL, "");
+  if (setlocale (LC_ALL, "") == NULL)
+    error (0, errno, gettext ("Cannot set LC_ALL to default locale"));
 
   /* If no real argument is given we have to print the contents of the
      current locale definition variables.  These are LANG and the LC_*.  */
@@ -864,7 +869,7 @@
 	      printf ("%s=", item->name);
 
 	    if (val != NULL)
-	      printf ("%d", *val == CHAR_MAX ? -1 : *val);
+	      printf ("%d", *val == '\177' ? -1 : *val);
 	    putchar ('\n');
 	  }
 	  break;
@@ -878,12 +883,12 @@
 
 	    while (cnt > 1)
 	      {
-		printf ("%d;", *val == CHAR_MAX ? -1 : *val);
+		printf ("%d;", *val == '\177' ? -1 : *val);
                 --cnt;
 		++val;
 	      }
 
-	    printf ("%d\n", cnt == 0 || *val == CHAR_MAX ? -1 : *val);
+	    printf ("%d\n", cnt == 0 || *val == '\177' ? -1 : *val);
 	  }
 	  break;
 	case word:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/locarchive.c libc-20030708/locale/programs/locarchive.c
--- glibc-2.3.2/locale/programs/locarchive.c	2002-10-23 15:21:17.000000000 +0900
+++ libc-20030708/locale/programs/locarchive.c	2003-03-16 10:03:52.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@redhat.com>, 2002.
 
@@ -1402,8 +1402,7 @@
   struct locarhead *head;
   struct namehashent *namehashtab;
   struct nameent *names;
-  int cnt;
-  int used;
+  size_t cnt, used;
 
   /* Open the archive.  This call never returns if we cannot
      successfully open the archive.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/locfile.c libc-20030708/locale/programs/locfile.c
--- glibc-2.3.2/locale/programs/locfile.c	2003-01-13 17:55:06.000000000 +0900
+++ libc-20030708/locale/programs/locfile.c	2003-07-08 22:58:08.000000000 +0900
@@ -764,3 +764,63 @@
 
   free (fname);
 }
+
+
+/* General handling of `copy'.  */
+void
+handle_copy (struct linereader *ldfile, const struct charmap_t *charmap,
+	     const char *repertoire_name, struct localedef_t *result,
+	     enum token_t token, int locale, const char *locale_name,
+	     int ignore_content)
+{
+  struct token *now;
+  int warned = 0;
+
+  now = lr_token (ldfile, charmap, result, NULL, verbose);
+  if (now->tok != tok_string)
+    lr_error (ldfile, _("expect string argument for `copy'"));
+  else if (!ignore_content)
+    {
+      if (now->val.str.startmb == NULL)
+	lr_error (ldfile, _("\
+locale name should consist only of portable characters"));
+      else
+	{
+	  (void) add_to_readlist (locale, now->val.str.startmb,
+				  repertoire_name, 1, NULL);
+	  result->copy_name[locale] = now->val.str.startmb;
+	}
+    }
+
+  lr_ignore_rest (ldfile, now->tok == tok_string);
+
+  /* The rest of the line must be empty and the next keyword must be
+     `END xxx'.  */
+  while ((now = lr_token (ldfile, charmap, result, NULL, verbose))->tok
+	 != tok_end && now->tok != tok_eof)
+    {
+      if (warned == 0)
+	{
+	  lr_error (ldfile, _("\
+no other keyword shall be specified when `copy' is used"));
+	  warned = 1;
+	}
+
+      lr_ignore_rest (ldfile, 0);
+    }
+
+  if (now->tok != tok_eof)
+    {
+      /* Handle `END xxx'.  */
+      now = lr_token (ldfile, charmap, result, NULL, verbose);
+
+      if (now->tok != token)
+	lr_error (ldfile, _("\
+`%1$s' definition does not end with `END %1$s'"), locale_name);
+
+      lr_ignore_rest (ldfile, now->tok == token);
+    }
+  else
+    /* When we come here we reached the end of the file.  */
+    lr_error (ldfile, _("%s: premature end of file"), locale_name);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/programs/locfile.h libc-20030708/locale/programs/locfile.h
--- glibc-2.3.2/locale/programs/locfile.h	2002-04-17 14:11:34.000000000 +0900
+++ libc-20030708/locale/programs/locfile.h	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.org>, 1996.
 
@@ -45,64 +45,12 @@
 
 
 /* General handling of `copy'.  */
-static inline void
-handle_copy (struct linereader *ldfile, const struct charmap_t *charmap,
-	     const char *repertoire_name, struct localedef_t *result,
-	     enum token_t token, int locale, const char *locale_name,
-	     int ignore_content)
-{
-  struct token *now;
-  int warned = 0;
-
-  now = lr_token (ldfile, charmap, result, NULL, verbose);
-  if (now->tok != tok_string)
-    lr_error (ldfile, _("expect string argument for `copy'"));
-  else if (!ignore_content)
-    {
-      if (now->val.str.startmb == NULL)
-	lr_error (ldfile, _("\
-locale name should consist only of portable characters"));
-      else
-	{
-	  (void) add_to_readlist (locale, now->val.str.startmb,
-				  repertoire_name, 1, NULL);
-	  result->copy_name[locale] = now->val.str.startmb;
-	}
-    }
-
-  lr_ignore_rest (ldfile, now->tok == tok_string);
-
-  /* The rest of the line must be empty and the next keyword must be
-     `END xxx'.  */
-  while ((now = lr_token (ldfile, charmap, result, NULL, verbose))->tok
-	 != tok_end && now->tok != tok_eof)
-    {
-      if (warned == 0)
-	{
-	  lr_error (ldfile, _("\
-no other keyword shall be specified when `copy' is used"));
-	  warned = 1;
-	}
-
-      lr_ignore_rest (ldfile, 0);
-    }
-
-  if (now->tok != tok_eof)
-    {
-      /* Handle `END xxx'.  */
-      now = lr_token (ldfile, charmap, result, NULL, verbose);
-
-      if (now->tok != token)
-	lr_error (ldfile, _("\
-`%1$s' definition does not end with `END %1$s'"), locale_name);
-
-      lr_ignore_rest (ldfile, now->tok == token);
-    }
-  else
-    /* When we come here we reached the end of the file.  */
-    lr_error (ldfile, _("%s: premature end of file"), locale_name);
-}
-
+extern void handle_copy (struct linereader *ldfile,
+			 const struct charmap_t *charmap,
+			 const char *repertoire_name,
+			 struct localedef_t *result, enum token_t token,
+			 int locale, const char *locale_name,
+			 int ignore_content);
 
 /* Found in locfile.c.  */
 extern int locfile_read (struct localedef_t *result,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/setlocale.c libc-20030708/locale/setlocale.c
--- glibc-2.3.2/locale/setlocale.c	2002-12-04 18:53:49.000000000 +0900
+++ libc-20030708/locale/setlocale.c	2003-06-12 08:54:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 92, 95-99, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 92, 1995-2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -128,7 +128,7 @@
 
 
 /* Construct a new composite name.  */
-static inline char *
+static char *
 new_composite_name (int category, const char *newnames[__LC_LAST])
 {
   size_t last_len = 0;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/tst-C-locale.c libc-20030708/locale/tst-C-locale.c
--- glibc-2.3.2/locale/tst-C-locale.c	2002-09-04 03:39:41.000000000 +0900
+++ libc-20030708/locale/tst-C-locale.c	2003-03-18 04:11:36.000000000 +0900
@@ -1,5 +1,5 @@
 /* Tests of C and POSIX locale contents.
-   Copyright (C) 2000,01,02 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@redhat.com>, 2000.
 
@@ -450,8 +450,8 @@
 }
 
 
-int
-main (void)
+static int
+do_test (void)
 {
   int result;
 
@@ -475,3 +475,6 @@
 
   return result;
 }
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/weight.h libc-20030708/locale/weight.h
--- glibc-2.3.2/locale/weight.h	2001-07-08 04:21:04.000000000 +0900
+++ libc-20030708/locale/weight.h	2003-06-12 08:54:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1996,1997,1998,1999,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Ulrich Drepper, <drepper@cygnus.com>.
 
@@ -19,6 +19,7 @@
 
 /* Find index of weight.  */
 static inline int32_t
+__attribute ((always_inline))
 findidx (const unsigned char **cpp)
 {
   int_fast32_t i = table[*(*cpp)++];
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/locale/weightwc.h libc-20030708/locale/weightwc.h
--- glibc-2.3.2/locale/weightwc.h	2001-08-07 13:23:14.000000000 +0900
+++ libc-20030708/locale/weightwc.h	2003-07-08 22:58:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996-2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Ulrich Drepper, <drepper@cygnus.com>.
 
@@ -19,6 +19,7 @@
 
 /* Find index of weight.  */
 static inline int32_t
+__attribute ((always_inline))
 findidx (const wint_t **cpp)
 {
   int32_t i;
@@ -26,7 +27,7 @@
   wint_t ch;
 
   ch = *(*cpp)++;
-  i = collidx_table_lookup ((const char *) table, ch);
+  i = __collidx_table_lookup ((const char *) table, ch);
 
   if (i >= 0)
     /* This is an index into the weight table.  Cool.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/ChangeLog libc-20030708/localedata/ChangeLog
--- glibc-2.3.2/localedata/ChangeLog	2003-01-31 05:21:47.000000000 +0900
+++ libc-20030708/localedata/ChangeLog	2003-07-08 22:58:08.000000000 +0900
@@ -1,3 +1,150 @@
+2003-07-02  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/lo_LA: Update collation info for U0EAF and U0EC6.
+	Update era_t_fmt, era_d_t_fmt, country_name, and lang_name fields.
+	Patch by Anousak Souphavanh <anousak@muanglao.com>.
+
+2003-06-25  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/an_ES: Change default charset from ISO-8859-1 to
+	ISO-8859-15 as the locale need the EURO sign.
+
+	* SUPPORTED (SUPPORTED-LOCALES): Add an_ES.ISO-8859-15.
+
+2003-06-21  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/no_NO [LC_COLLATE]: Add missing eth letter, sorted as
+	latin letter d.
+
+2003-06-16  Bruno Haible  <bruno@clisp.org>
+
+	* charmaps/ISO-8859-15: Add aliases ISO_8859-15, LATIN-9.
+	* charmaps/ISO-8859-16: Add aliases ISO_8859-16:2001, ISO_8859-16.
+	* charmaps/IBM1047: Add alias IBM-1047.
+	* charmaps/GBK: Add aliases CP936, MS936, WINDOWS-936.
+
+2003-06-15  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/fi_FI [LC_TIME]: Correct month names to make the dates
+	gramatically correct.  Patch from Eero Hkkinen. [PR libc/5013].
+
+2003-06-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/an_ES: New file.  Contributed by Jordi Mallach Pez.
+
+2003-06-15  Petter Reinholdtsen  <pere@hungry.com>
+
+	* tst-fmon.c (main): Remove unused variable 'monval'.
+
+	* tst-fmon.sh: Make sure all tests are executed before an error
+	code is reported to make.
+	* tst-numeric.sh: Likewise.
+
+2003-06-15  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/is_IS [LC_TIME]: Use lower case letters in month and
+	week day names.  Patch from Bjarni Ingi Gislason.
+
+2003-05-31  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/fi_FI: Add URL to a reference documenting Finish in
+	Finland
+	* locales/fi_FI [LC_MONETARY]: Correct mon_thousands_sep from
+	period (U002E) to non-break space (U00A0).
+	suggestion from Eero Hkkinen.
+	[LC_NUMERIC]: Correct thousands_sep from period (U002E) to
+	non-break space (U00A0).  Based on suggestion from Eero Hkkinen.
+
+2003-06-11  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/lo_LA: New file.
+	Contributed by Anousak Souphavanh <anousak@muanglao.com>.
+	* SUPPORTED (SUPPORTED-LOCALES): Add lo_LA.UTF8.
+
+2003-05-29  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/uk_UA: Correct mail address of Denys Dmytriyenko.
+
+2003-05-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/st_ZA: New file.
+	* locales/xh_ZA: New file.
+	* locales/zu_ZA: New file.
+	Contributed by Dwayne Bailey <dwayne@translate.org.za>.
+
+2003-05-06  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/de_DE: Use two-letter abday values.
+	* tst-langinfo.sh: Update after de_DE locale change.
+
+2003-05-05  Jakub Jelinek  <jakub@redhat.com>
+
+	* tests-mbwc/tst_wcsxfrm.c (tst_wcsxfrm): Use %zu instead of %d
+	format specifier when printing ret.
+
+2003-04-30  Petter Reinholdtsen  <pere@hungry.com>
+
+	* tst-fmon.c: Report name of locale if setlocale() fails.
+	* tst-numeric.c: Likewise.
+
+	* tst-fmon.sh: Ignore lines starting with hash '#' in the data file.
+	* tst-numeric.sh: Likewise.
+
+2003-04-30  Petter Reinholdtsen  <pere@hungry.com>
+
+	* sort-test.sh: Output 'diff -u' when sorting test failed, to make
+	it easier to find out what was wrong with the sorting order.
+
+2003-04-16  Petter Reinholdtsen  <pere@hungry.com>
+
+	* Makefile (tests): Add LC_NUMERIC test tst-numeric.out.
+	(tst-numeric.out): Define.
+	* tst-numeric.c: New file.
+	* tst-numeric.sh: New file.
+	* tst-numeric.data: New file.
+
+2003-04-21  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/ar_BH: Fix spelling of Bahrain.
+
+2003-04-16  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/uk_UA: Fix sorting.
+	Patch by Leonid Kanter <leon@geon.donetsk.ua>.
+
+2003-04-15  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/ar_SD [LC_MONETARY]: Use international currency symbol
+	'SDD' for Sudan.
+	* locales/es_EC [LC_MONETARY]: Use international currency symbol
+	'USD' for Ecuador.
+	Source is CIA World Fact book.
+
+2003-04-05  Petter Reinholdtsen  <pere@hungry.com>
+
+	* locales/sr_YU [LC_MONETARY]: Change int_curr_symbol from 'YUN'
+	to 'YUM' to match changes commited to ISO-4217 2002-02-13 and get
+	the locale building again.
+	* locales/sr_YU@cyrillic: Likewise.
+
+2003-04-14  Ulrich Drepper  <drepper@redhat.com>
+
+	* locales/mn_MN: Fix country_post and country_ab2.
+
+2003-03-17  Ulrich Drepper  <drepper@redhat.com>
+
+	* localedata/en_ZA: Changed %x for LC_TIME to use dd/mm/ccyy.
+	Added ^ to LC_MESSAGES regex "^[yY].*".
+	Confirmed LC_PAPER and LC_MEASUREMENT settings.
+	Added country and language names to LC_ADDRESS.
+	Added missing info for LC_TELEPHONE.
+	Patch by Dwayne Bailey <dwayne@obsidian.co.za>.
+
+2003-03-14  Ulrich Drepper  <drepper@redhat.com>
+
+	* localedata/mn_MN: New file.
+	Contributed by Sanlig Badral <badral@chinggis.com>.
+
 2003-01-30  Ulrich Drepper  <drepper@redhat.com>
 
 	* Makefile (LOCALES): Add vi_VN.TCVN5712-1.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/Makefile libc-20030708/localedata/Makefile
--- glibc-2.3.2/localedata/Makefile	2003-01-31 05:09:21.000000000 +0900
+++ libc-20030708/localedata/Makefile	2003-04-28 23:53:21.000000000 +0900
@@ -39,7 +39,7 @@
 
 test-srcs := collate-test xfrm-test tst-fmon tst-rpmatch tst-trans \
 	     tst-mbswcs1 tst-mbswcs2 tst-mbswcs3 tst-mbswcs4 tst-mbswcs5 \
-	     tst-ctype tst-wctype tst-langinfo
+	     tst-ctype tst-wctype tst-langinfo tst-numeric
 test-input := de_DE.ISO-8859-1 en_US.ISO-8859-1 da_DK.ISO-8859-1 \
 	      hr_HR.ISO-8859-2 sv_SE.ISO-8859-1
 test-input-data = $(addsuffix .in, $(basename $(test-input)))
@@ -65,6 +65,7 @@
 	      tst-fmon.data $(test-input-data) $(ld-test-srcs)		\
 	      th_TH.in cs_CZ.in tst-mbswcs.sh tst-trans.sh tst-ctype.sh \
 	      tst-ctype-de_DE.ISO-8859-1.in				\
+	      tst-numeric.sh tst-numeric.data				\
 	      $(wildcard tests-mbwc/*.[ch])				\
 	      $(addprefix tst-fmon-locales/tstfmon_,$(fmon-tests))	\
 	      gen-locale.sh show-ucs-data.c tst-langinfo.sh		\
@@ -130,7 +131,7 @@
 LOCALES := de_DE.ISO-8859-1 de_DE.UTF-8 en_US.ANSI_X3.4-1968 \
 	   en_US.ISO-8859-1 ja_JP.EUC-JP da_DK.ISO-8859-1 \
 	   hr_HR.ISO-8859-2 sv_SE.ISO-8859-1 ja_JP.SJIS fr_FR.ISO-8859-1 \
-	   vi_VN.TCVN5712-1
+	   vi_VN.TCVN5712-1 no_NO.ISO-8859-1 nn_NO.ISO-8859-1
 LOCALE_SRCS := $(shell echo "$(LOCALES)"|sed 's/\([^ .]*\)[^ ]*/\1/g')
 CHARMAPS := $(shell echo "$(LOCALES)" | \
 		    sed -e 's/[^ .]*[.]\([^ ]*\)/\1/g' -e s/SJIS/SHIFT_JIS/g)
@@ -151,7 +152,7 @@
 tests: $(objpfx)sort-test.out $(objpfx)tst-fmon.out $(objpfx)tst-locale.out \
        $(objpfx)tst-rpmatch.out $(objpfx)tst-trans.out \
        $(objpfx)tst-mbswcs.out $(objpfx)tst-ctype.out $(objpfx)tst-wctype.out \
-       $(objpfx)tst-langinfo.out
+       $(objpfx)tst-langinfo.out $(objpfx)tst-numeric.out
 
 $(objpfx)sort-test.out: sort-test.sh $(objpfx)collate-test $(objpfx)xfrm-test \
 		       $(test-input-data) $(addprefix $(objpfx),$(CTYPE_FILES))
@@ -162,6 +163,11 @@
 		       $(addprefix $(objpfx),$(CTYPE_FILES))
 	$(SHELL) -e $< $(common-objpfx) '$(run-program-prefix)' tst-fmon.data \
 	  > $@
+$(objpfx)tst-numeric.out: tst-numeric.sh $(objpfx)tst-numeric tst-numeric.data \
+		       $(objpfx)sort-test.out \
+		       $(addprefix $(objpfx),$(CTYPE_FILES))
+	$(SHELL) -e $< $(common-objpfx) '$(run-program-prefix)' tst-numeric.data \
+	  > $@
 $(objpfx)tst-locale.out: tst-locale.sh $(common-objpfx)locale/localedef \
 			 $(ld-test-srcs) $(addprefix $(objpfx),$(CTYPE_FILES))
 	$(SHELL) -e $< $(common-objpfx) '$(built-program-cmd)' > $@
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/SUPPORTED libc-20030708/localedata/SUPPORTED
--- glibc-2.3.2/localedata/SUPPORTED	2002-02-24 04:30:27.000000000 +0900
+++ libc-20030708/localedata/SUPPORTED	2003-07-08 22:58:08.000000000 +0900
@@ -3,6 +3,7 @@
 # appropriate message.
 SUPPORTED-LOCALES=\
 af_ZA/ISO-8859-1 \
+an_ES/ISO-8859-15 \
 ar_AE/ISO-8859-6 \
 ar_BH/ISO-8859-6 \
 ar_DZ/ISO-8859-6 \
@@ -112,6 +113,7 @@
 ko_KR.EUC-KR/EUC-KR \
 ko_KR.UTF-8/UTF-8 \
 kw_GB/ISO-8859-1 \
+lo_LA/UTF-8 \
 lt_LT/ISO-8859-13 \
 lv_LV/ISO-8859-13 \
 mi_NZ/ISO-8859-13 \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/charmaps/GBK libc-20030708/localedata/charmaps/GBK
--- glibc-2.3.2/localedata/charmaps/GBK	2002-11-03 13:49:08.000000000 +0900
+++ libc-20030708/localedata/charmaps/GBK	2003-07-08 22:58:08.000000000 +0900
@@ -4,6 +4,9 @@
 <comment_char> %
 <escape_char> /
 
+% alias CP936
+% alias MS936
+% alias WINDOWS-936
 CHARMAP
 <U0000>     /x00         NULL (NUL)
 <U0001>     /x01         START OF HEADING (SOH)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/charmaps/IBM1047 libc-20030708/localedata/charmaps/IBM1047
--- glibc-2.3.2/localedata/charmaps/IBM1047	2000-06-24 03:38:48.000000000 +0900
+++ libc-20030708/localedata/charmaps/IBM1047	2003-07-08 22:58:08.000000000 +0900
@@ -6,6 +6,7 @@
 
 %  Registry SC09-1391-00 p 150.
 
+% alias IBM-1047
 % alias CP1047
 % alias 1047
 CHARMAP
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/charmaps/ISO-8859-15 libc-20030708/localedata/charmaps/ISO-8859-15
--- glibc-2.3.2/localedata/charmaps/ISO-8859-15	2000-06-24 04:02:28.000000000 +0900
+++ libc-20030708/localedata/charmaps/ISO-8859-15	2003-07-08 22:58:08.000000000 +0900
@@ -3,6 +3,8 @@
 <escape_char> /
 % automatically generated from the charDB
 
+% alias ISO_8859-15
+% alias LATIN-9
 CHARMAP
 <U0000>     /x00         NULL
 <U0001>     /x01         START OF HEADING
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/charmaps/ISO-8859-16 libc-20030708/localedata/charmaps/ISO-8859-16
--- glibc-2.3.2/localedata/charmaps/ISO-8859-16	2001-11-27 12:44:03.000000000 +0900
+++ libc-20030708/localedata/charmaps/ISO-8859-16	2003-07-08 22:58:08.000000000 +0900
@@ -4,6 +4,8 @@
 % automatically generated from the charDB
 
 % alias ISO-IR-226
+% alias ISO_8859-16:2001
+% alias ISO_8859-16
 % alias LATIN10
 % alias L10
 CHARMAP
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/an_ES libc-20030708/localedata/locales/an_ES
--- glibc-2.3.2/localedata/locales/an_ES	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/locales/an_ES	2003-06-26 16:29:02.000000000 +0900
@@ -0,0 +1,126 @@
+comment_char %
+escape_char  /
+%
+% Aragonese Language Locale for Spain
+% Source:
+% Address:
+% Contact: Jordi Mallach Prez
+% Email: jordi@gnu.org
+% Language: an
+% Territory: ES
+% Revision: 1.0
+% Date: 2003-05-22
+% Application: general
+% Users: general
+% Charset: ISO-8859-15
+%
+% This file is under the
+% GNU General Public License.
+% Based in the gl_ES Locale
+
+LC_IDENTIFICATION
+title      "Aragonese locale for Spain"
+source     ""
+address    ""
+contact    "Jordi Mallach Prez"
+email      "bug-glibc@gnu.org"
+tel        ""
+fax        ""
+language   "an"
+territory  "ES"
+revision   "1.0"
+date       "2003-06-15"
+%
+category  "i18n:1999";LC_IDENTIFICATION
+category  "i18n:1999";LC_CTYPE
+category  "i18n:1999";LC_COLLATE
+category  "i18n:1999";LC_TIME
+category  "posix:1993";LC_NUMERIC
+category  "i18n:1999";LC_MONETARY
+category  "i18n:1999";LC_MESSAGES
+category  "i18n:1999";LC_PAPER
+category  "i18n:1999";LC_NAME
+category  "i18n:1999";LC_ADDRESS
+category  "i18n:1999";LC_TELEPHONE
+END LC_IDENTIFICATION
+
+LC_COLLATE
+copy "es_ES"
+END LC_COLLATE
+
+LC_CTYPE
+copy "es_ES"
+END LC_CTYPE
+
+LC_MESSAGES
+yesexpr "<U005E><U005B><U0073><U0053><U0079><U0059><U005D><U002E><U002A>"
+noexpr  "<U005E><U005B><U006E><U004E><U005D><U002E><U002A>"
+END LC_MESSAGES
+
+LC_MONETARY
+copy "es_ES"
+END LC_MONETARY
+
+LC_NUMERIC
+copy "es_ES"
+END LC_NUMERIC
+
+LC_TIME
+abday   "<U0064><U006F><U006D>";"<U006C><U0075><U006E>";/
+        "<U006D><U0061><U0072>";"<U006D><U0069><U0065>";/
+        "<U0063><U0068><U0075>";"<U0062><U0069><U0065>";/
+        "<U0073><U0061><U0062>"
+day     "<U0064><U006F><U006D><U0069><U006E><U0067><U006F>";/
+        "<U006C><U0075><U006E><U0073>";/
+        "<U006D><U0061><U0072><U0074><U0065><U0073>";/
+        "<U006D><U0069><U0065><U0063><U006F><U006c><U0073>";/
+        "<U0063><U0068><U0075><U0065><U0062><U0065><U0073>";/
+        "<U0062><U0069><U0065><U0072><U006E><U0065><U0073>";/
+        "<U0073><U0061><U0062><U0061><U0064><U006F>"
+abmon   "<U0063><U0068><U0069>";"<U0066><U0072><U0065>";/
+        "<U006D><U0061><U0072>";"<U0061><U0062><U0072>";/
+        "<U006D><U0061><U0079>";"<U0063><U0068><U006E>";/
+        "<U0063><U0068><U006C>";"<U0061><U0067><U006F>";/
+        "<U0073><U0065><U0074>";"<U006f><U0063><U0074>";/
+        "<U006E><U006F><U0062>";"<U0061><U0062><U0069>"
+mon     "<U0063><U0068><U0069><U006E><U0065><U0072><U006F>";/
+        "<U0066><U0072><U0065><U0062><U0065><U0072><U006F>";/
+        "<U006D><U0061><U0072><U007A><U006F>";/
+        "<U0061><U0062><U0072><U0069><U006C>";/
+        "<U006D><U0061><U0079><U006F>";/
+        "<U0063><U0068><U0075><U006E><U0069><U006F>";/
+        "<U0063><U0068><U0075><U006C><U0069><U006F>";/
+        "<U0061><U0067><U006F><U0073><U0074><U006F>";/
+        "<U0073><U0065><U0074><U0069><U0065><U006D><U0062><U0072><U0065>";/
+        "<U006F><U0063><U0074><U0075><U0062><U0072><U0065>";/
+        "<U006E><U006F><U0062><U0069><U0065><U006D><U0062><U0072><U0065>";/
+        "<U0061><U0062><U0069><U0065><U006E><U0074><U006F>"
+d_t_fmt "<U0025><U0061><U0020><U0025><U0064><U0020><U0025><U0062><U0020><U0025><U0059><U0020><U0025><U0054><U0020><U0025><U005A>"
+d_fmt   "<U0025><U0064><U002F><U0025><U006D><U002F><U0025><U0079>"
+t_fmt   "<U0025><U0054>"
+am_pm   "";""
+t_fmt_ampm ""
+date_fmt       "<U0025><U0061><U0020><U0025><U0062><U0020><U0025><U0065>/
+<U0020><U0025><U0048><U003A><U0025><U004D><U003A><U0025><U0053><U0020>/
+<U0025><U005A><U0020><U0025><U0059>"
+END LC_TIME
+
+LC_PAPER
+copy "es_ES"
+END LC_PAPER
+
+LC_TELEPHONE
+copy "es_ES"
+END LC_TELEPHONE
+
+LC_MEASUREMENT
+copy "es_ES"
+END LC_MEASUREMENT
+
+LC_NAME
+copy "es_ES"
+END LC_NAME
+
+LC_ADDRESS
+copy "es_ES"
+END LC_ADDRESS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/ar_BH libc-20030708/localedata/locales/ar_BH
--- glibc-2.3.2/localedata/locales/ar_BH	2000-10-27 02:42:04.000000000 +0900
+++ libc-20030708/localedata/locales/ar_BH	2003-04-28 23:53:21.000000000 +0900
@@ -5,7 +5,7 @@
 % Tetsuji Orita <orita@jp.ibm.com>.
 
 LC_IDENTIFICATION
-title      "Arabic language locale for Bahrein"
+title      "Arabic language locale for Bahrain"
 source     "IBM Globalization Center of Competency, Yamato Software Laboratory"
 address    "1623-14, Shimotsuruma, Yamato-shi, Kanagawa-ken, 242-8502, Japan"
 contact    ""
@@ -13,7 +13,7 @@
 tel        ""
 fax        ""
 language   "Arabic"
-territory  "Bahrein"
+territory  "Bahrain"
 revision   "1.0"
 date       "2000-07-20"
 %
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/ar_SD libc-20030708/localedata/locales/ar_SD
--- glibc-2.3.2/localedata/locales/ar_SD	2000-10-27 02:44:45.000000000 +0900
+++ libc-20030708/localedata/locales/ar_SD	2003-04-16 10:03:41.000000000 +0900
@@ -47,7 +47,7 @@
 % These are generated based on XML base Locale difintion file
 % for IBM Class for Unicode/Java
 %
-int_curr_symbol       "<U0053><U0044><U0050><U0020>"
+int_curr_symbol       "<U0053><U0044><U0044><U0020>"
 currency_symbol       "<U062C><U002E><U0633><U002E>"
 mon_decimal_point     "<U002E>"
 mon_thousands_sep     "<U002C>"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/de_DE libc-20030708/localedata/locales/de_DE
--- glibc-2.3.2/localedata/locales/de_DE	2002-02-28 17:34:13.000000000 +0900
+++ libc-20030708/localedata/locales/de_DE	2003-05-10 13:38:03.000000000 +0900
@@ -94,10 +94,10 @@
 END LC_NUMERIC
 
 LC_TIME
-abday	"<U0053><U006F><U006E>";"<U004D><U006F><U006E>";/
-	"<U0044><U0069><U0065>";"<U004D><U0069><U0074>";/
-	"<U0044><U006F><U006E>";"<U0046><U0072><U0065>";/
-	"<U0053><U0061><U006D>"
+abday	"<U0053><U006F>";"<U004D><U006F>";/
+	"<U0044><U0069>";"<U004D><U0069>";/
+	"<U0044><U006F>";"<U0046><U0072>";/
+	"<U0053><U0061>"
 day	"<U0053><U006F><U006E><U006E><U0074><U0061><U0067>";/
 	"<U004D><U006F><U006E><U0074><U0061><U0067>";/
 	"<U0044><U0069><U0065><U006E><U0073><U0074><U0061><U0067>";/
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/en_ZA libc-20030708/localedata/locales/en_ZA
--- glibc-2.3.2/localedata/locales/en_ZA	2000-10-27 02:48:46.000000000 +0900
+++ libc-20030708/localedata/locales/en_ZA	2003-03-17 19:08:52.000000000 +0900
@@ -2,44 +2,54 @@
 comment_char  %
 
 % English language locale for South Africa
-% Source: RAP
-% Email: nic@sig.co.za
-% Tel: +27 83 7659503
-% Fax: +27 12 3478098
+% Source: Zuza Software Foundation
+% Email: dwayne@translate.org.za
+% Tel: +27 21 4487827
+% Fax: +27 21 4489574
 % Language: en
 % Territory: ZA
-% Revision: 1.0
-% Date: 1999-03-28
+% Revision: 1.1
+% Date: 2003-03-14
 % Users: general
 % Repertoiremap: mnemonic,ds
 % Charset: ISO-8859-1
 % Distribution and use is free, also
 % for commercial purposes.
+%
+% Changelog
+% 1.1 (2003-03-14):
+%   - Updated maintainer to Zuza Sofware Foundation
+%   - Changed %x for LC_TIME to use dd/mm/ccyy
+%   - Added ^ to LC_MESSAGES regex "^[yY].*"
+%   - Confirmed LC_PAPER and LC_MEASUREMENT settings
+%   - Added country and language names to LC_ADDRESS
+%   - Added missing info for LC_TELEPHONE
 
 LC_IDENTIFICATION
 title      "English locale for South Africa"
-source     "RAP"
-address    ""
-contact    ""
-email      "bug-glibc@gnu.org"
-tel        ""
-fax        ""
+source     "Zuza Software Foundation"
+address    "Box 13412, Mowbray, 7701, South Africa"
+contact    "Dwayne Bailey"
+email      "dwayne@translate.org.za"
+tel        "+27 21 448 7827"
+fax        "+27 21 448 9574"
 language   "English"
 territory  "South Africa"
-revision   "1.0"
-date       "2000-06-29"
+revision   "1.1"
+date       "2003-03-14"
 %
-category  "en_ZA:2000";LC_IDENTIFICATION
+category  "en_ZA:2003";LC_IDENTIFICATION
 category  "en_ZA:2000";LC_CTYPE
 category  "en_ZA:2000";LC_COLLATE
-category  "en_ZA:2000";LC_TIME
+category  "en_ZA:2003";LC_TIME
 category  "en_ZA:2000";LC_NUMERIC
 category  "en_ZA:2000";LC_MONETARY
-category  "en_ZA:2000";LC_MESSAGES
+category  "en_ZA:2003";LC_MESSAGES
 category  "en_ZA:2000";LC_PAPER
+category  "en_ZA:2000";LC_MEASUREMENT
 category  "en_ZA:2000";LC_NAME
-category  "en_ZA:2000";LC_ADDRESS
-category  "en_ZA:2000";LC_TELEPHONE
+category  "en_ZA:2003";LC_ADDRESS
+category  "en_ZA:2003";LC_TELEPHONE
 
 END LC_IDENTIFICATION
 
@@ -106,7 +116,7 @@
             "<U004E><U006F><U0076><U0065><U006D><U0062><U0065><U0072>";/
             "<U0044><U0065><U0063><U0065><U006D><U0062><U0065><U0072>"
 d_t_fmt     "<U0025><U0061><U0020><U0025><U0064><U0020><U0025><U0062><U0020><U0025><U0059><U0020><U0025><U0054><U0020><U0025><U005A>"
-d_fmt       "<U0025><U0064><U002F><U0025><U006D><U002F><U0025><U0079>"
+d_fmt       "<U0025><U0064><U002F><U0025><U006D><U002F><U0025><U0059>"
 t_fmt       "<U0025><U0054>"
 am_pm       "";""
 t_fmt_ampm  ""
@@ -116,25 +126,25 @@
 END LC_TIME
 
 LC_MESSAGES
-yesexpr     "<U005B><U0079><U0059><U005D><U002E><U002A>"
-noexpr      "<U005B><U006E><U004E><U005D><U002E><U002A>"
+yesexpr     "<U005E><U005B><U0079><U0059><U005D><U002E><U002A>"
+noexpr      "<U005E><U005B><U006E><U004E><U005D><U002E><U002A>"
 END LC_MESSAGES
 
 LC_PAPER
-% FIXME
 height   297
-% FIXME
 width    210
 END LC_PAPER
 
 LC_TELEPHONE
 tel_int_fmt    "<U002B><U0025><U0063><U0020><U0025><U0061><U0020><U0025>/
 <U006C>"
+tel_dom_fmt    "<U0028><U0025><U0041><U0029><U0020><U0025><U006C>"
+int_select     "<U0030><U0039>"
 int_prefix     "<U0032><U0037>"
+
 END LC_TELEPHONE
 
 LC_MEASUREMENT
-% FIXME
 measurement    1
 END LC_MEASUREMENT
 
@@ -149,4 +159,7 @@
 <U0020><U0025><U0068><U0020><U0025><U0065><U0020><U0025><U0072><U0025>/
 <U004E><U0025><U0025><U007A><U0020><U0025><U0054><U0025>/
 <U004E><U0025><U0063><U0025><U004E>"
+country_name  "<U0053><U006F><U0075><U0074><U0068><U0020>/
+<U0041><U0066><U0072><U0069><U0063><U0061>"
+lang_name     "<U0045><U006E><U0067><U006C><U0069><U0073><U0068>"
 END LC_ADDRESS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/es_EC libc-20030708/localedata/locales/es_EC
--- glibc-2.3.2/localedata/locales/es_EC	2002-08-03 05:00:00.000000000 +0900
+++ libc-20030708/localedata/locales/es_EC	2003-04-16 10:03:41.000000000 +0900
@@ -61,7 +61,7 @@
 END LC_MESSAGES
 
 LC_MONETARY
-int_curr_symbol      "<U0045><U0043><U0053><U0020>"
+int_curr_symbol      "<U0055><U0053><U0044><U0020>"
 currency_symbol      "<U0024>"
 mon_decimal_point    "<U002C>"
 mon_thousands_sep    "<U002E>"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/fi_FI libc-20030708/localedata/locales/fi_FI
--- glibc-2.3.2/localedata/locales/fi_FI	2002-02-28 17:45:33.000000000 +0900
+++ libc-20030708/localedata/locales/fi_FI	2003-07-08 22:58:08.000000000 +0900
@@ -19,6 +19,10 @@
 % Charset: ISO-8859-1
 % Distribution and use is free, also
 % for commercial purposes.
+%
+% Useful sources:
+%   Locale info for Finnish in Finland
+%     http://std.dkuug.dk/cultreg/registrations/narrative/fi_FI,_1.0
 
 LC_IDENTIFICATION
 title      "Finnish locale for Finland"
@@ -2121,7 +2125,7 @@
 int_curr_symbol      "<U0045><U0055><U0052><U0020>"
 currency_symbol      "<U20AC>"
 mon_decimal_point    "<U002C>"
-mon_thousands_sep    "<U002E>"
+mon_thousands_sep    "<U00A0>"
 mon_grouping         3;3
 positive_sign        ""
 negative_sign        "<U002D>"
@@ -2139,7 +2143,7 @@
 
 LC_NUMERIC
 decimal_point        "<U002C>"
-thousands_sep        "<U002E>"
+thousands_sep        "<U00A0>"
 grouping             3;3
 END LC_NUMERIC
 
@@ -2178,14 +2182,15 @@
          "<U006C><U006F><U006B><U0061><U006B><U0075><U0075>";/
          "<U006D><U0061><U0072><U0072><U0061><U0073><U006B><U0075><U0075>";/
          "<U006A><U006F><U0075><U006C><U0075><U006B><U0075><U0075>"
-d_t_fmt  "<U0025><U0061><U0020><U0025><U0065><U0020><U0025><U0042><U0020><U0025><U0059><U0020><U0025><U0054>"
+d_t_fmt  "<U0025><U0061><U0020><U0025><U0065><U002E><U0020><U0025><U0042>/
+<U0074><U0061><U0020><U0025><U0059><U0020><U0025><U0054>"
 d_fmt    "<U0025><U0064><U002E><U0025><U006D><U002E><U0025><U0059>"
 t_fmt    "<U0025><U0054>"
 am_pm    "";""
 t_fmt_ampm  ""
-date_fmt       "<U0025><U0061><U0020><U0025><U0062><U0020><U0025><U0065>/
-<U0020><U0025><U0048><U003A><U0025><U004D><U003A><U0025><U0053><U0020>/
-<U0025><U005A><U0020><U0025><U0059>"
+date_fmt       "<U0025><U0061><U0020><U0025><U0042><U006E><U0020><U0025>/
+<U0065><U002E><U0020><U0025><U0048><U003A><U0025><U004D><U003A><U0025>/
+<U0053><U0020><U0025><U005A><U0020><U0025><U0059>"
 END LC_TIME
 
 LC_MESSAGES
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/is_IS libc-20030708/localedata/locales/is_IS
--- glibc-2.3.2/localedata/locales/is_IS	2000-10-27 02:54:41.000000000 +0900
+++ libc-20030708/localedata/locales/is_IS	2003-07-08 22:58:08.000000000 +0900
@@ -2185,35 +2185,35 @@
 END LC_NUMERIC
 
 LC_TIME
-abday "<U0053><U0075><U006E>";"<U004D><U00E1><U006E>";/
-      "<U00DE><U0072><U0069>";"<U004D><U0069><U00F0>";/
-      "<U0046><U0069><U006D>";"<U0046><U00F6><U0073>";/
-      "<U004C><U0061><U0075>"
-day   "<U0053><U0075><U006E><U006E><U0075><U0064><U0061><U0067><U0075><U0072>";/
-      "<U004D><U00E1><U006E><U0075><U0064><U0061><U0067><U0075><U0072>";/
-      "<U00DE><U0072><U0069><U00F0><U006A><U0075><U0064><U0061><U0067><U0075><U0072>";/
-      "<U004D><U0069><U00F0><U0076><U0069><U006B><U0075><U0064><U0061><U0067><U0075><U0072>";/
-      "<U0046><U0069><U006D><U006D><U0074><U0075><U0064><U0061><U0067><U0075><U0072>";/
-      "<U0046><U00F6><U0073><U0074><U0075><U0064><U0061><U0067><U0075><U0072>";/
-      "<U004C><U0061><U0075><U0067><U0061><U0072><U0064><U0061><U0067><U0075><U0072>"
-abmon "<U004A><U0061><U006E>";"<U0046><U0065><U0062>";/
-      "<U004D><U0061><U0072>";"<U0041><U0070><U0072>";/
-      "<U004D><U0061><U00ED>";"<U004A><U00FA><U006E>";/
-      "<U004A><U00FA><U006C>";"<U00C1><U0067><U00FA>";/
-      "<U0053><U0065><U0070>";"<U004F><U006B><U0074>";/
-      "<U004E><U00F3><U0076>";"<U0044><U0065><U0073>"
-mon   "<U004A><U0061><U006E><U00FA><U0061><U0072>";/
-      "<U0046><U0065><U0062><U0072><U00FA><U0061><U0072>";/
-      "<U004D><U0061><U0072><U0073>";/
-      "<U0041><U0070><U0072><U00ED><U006C>";/
-      "<U004D><U0061><U00ED>";/
-      "<U004A><U00FA><U006E><U00ED>";/
-      "<U004A><U00FA><U006C><U00ED>";/
-      "<U00C1><U0067><U00FA><U0073><U0074>";/
-      "<U0053><U0065><U0070><U0074><U0065><U006D><U0062><U0065><U0072>";/
-      "<U004F><U006B><U0074><U00F3><U0062><U0065><U0072>";/
-      "<U004E><U00F3><U0076><U0065><U006D><U0062><U0065><U0072>";/
-      "<U0044><U0065><U0073><U0065><U006D><U0062><U0065><U0072>"
+abday "<U0073><U0075><U006E>";"<U006D><U00E1><U006E>";/
+      "<U00FE><U0072><U0069>";"<U006D><U0069><U00F0>";/
+      "<U0066><U0069><U006D>";"<U0066><U00F6><U0073>";/
+      "<U006C><U0061><U0075>"
+day   "<U0073><U0075><U006E><U006E><U0075><U0064><U0061><U0067><U0075><U0072>";/
+      "<U006D><U00E1><U006E><U0075><U0064><U0061><U0067><U0075><U0072>";/
+      "<U00FE><U0072><U0069><U00F0><U006A><U0075><U0064><U0061><U0067><U0075><U0072>";/
+      "<U006D><U0069><U00F0><U0076><U0069><U006B><U0075><U0064><U0061><U0067><U0075><U0072>";/
+      "<U0066><U0069><U006D><U006D><U0074><U0075><U0064><U0061><U0067><U0075><U0072>";/
+      "<U0066><U00F6><U0073><U0074><U0075><U0064><U0061><U0067><U0075><U0072>";/
+      "<U006C><U0061><U0075><U0067><U0061><U0072><U0064><U0061><U0067><U0075><U0072>"
+abmon "<U006A><U0061><U006E>";"<U0066><U0065><U0062>";/
+      "<U006D><U0061><U0072>";"<U0061><U0070><U0072>";/
+      "<U006D><U0061><U00ED>";"<U006A><U00FA><U006E>";/
+      "<U006A><U00FA><U006C>";"<U00E1><U0067><U00FA>";/
+      "<U0073><U0065><U0070>";"<U006F><U006B><U0074>";/
+      "<U006E><U00F3><U0076>";"<U0064><U0065><U0073>"
+mon   "<U006A><U0061><U006E><U00FA><U0061><U0072>";/
+      "<U0066><U0065><U0062><U0072><U00FA><U0061><U0072>";/
+      "<U006D><U0061><U0072><U0073>";/
+      "<U0061><U0070><U0072><U00ED><U006C>";/
+      "<U006D><U0061><U00ED>";/
+      "<U006A><U00FA><U006E><U00ED>";/
+      "<U006A><U00FA><U006C><U00ED>";/
+      "<U00E1><U0067><U00FA><U0073><U0074>";/
+      "<U0073><U0065><U0070><U0074><U0065><U006D><U0062><U0065><U0072>";/
+      "<U006F><U006B><U0074><U00F3><U0062><U0065><U0072>";/
+      "<U006E><U00F3><U0076><U0065><U006D><U0062><U0065><U0072>";/
+      "<U0064><U0065><U0073><U0065><U006D><U0062><U0065><U0072>"
 d_t_fmt "<U0025><U0061><U0020><U0025><U0065><U002E><U0025><U0062><U0020><U0025><U0059><U002C><U0020><U0025><U0054><U0020><U0025><U005A>"
 d_fmt   "<U0025><U0061><U0020><U0025><U0065><U002E><U0025><U0062><U0020><U0025><U0059>"
 t_fmt   "<U0025><U0054>"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/lo_LA libc-20030708/localedata/locales/lo_LA
--- glibc-2.3.2/localedata/locales/lo_LA	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/locales/lo_LA	2003-07-03 04:09:21.000000000 +0900
@@ -0,0 +1,787 @@
+escape_char /
+comment_char %
+
+%
+% Lao Lanuage Locale for Laos
+%
+% Name:         lo_LA
+% Author:       Anousak Souphavanh
+% Contact:   
+% E-mail:       Anousak@muanglao.com
+% Language:     Lao
+% Territory:    Laos
+% Charset:      UTF-8
+% Revision:     1.1
+% Date:         2003-02-06
+%
+
+%
+% Copyright (C) 2002 Anousak Souphavanh
+   
+%
+% Permission is hereby granted, free of charge, to any person obtaining
+% a copy of this software and associated documentation files (the "Software"),
+% to deal in the Software without restriction, including without limitation
+% the rights to use, copy, modify, merge, publish, distribute, sublicense,
+% and/or sell copies of the Software, and to permit persons to whom the
+% Software is furnished to do so, subject to the following conditions:
+%
+% The above copyright notice and this permission notice shall be included
+% in all copies or substantial portions of the Software.
+%
+% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+% FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
+% THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
+% OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
+% ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
+% OTHER DEALINGS IN THE SOFTWARE.
+%
+%
+%
+%  Note: I would like to give a special thank to Mr. Pablo Salatxaga @ Mandrake , email "srtxg@chanae.alphanet.ch"
+%        & Theppitak Karoonboonyanan, email: 'thep@linux.thai.net', all had guided me in the right direction.
+
+LC_IDENTIFICATION
+title      "Lao locale for Laos"
+source     ""
+address    ""
+contact    "Anousak Souphavanh at: anousak@muanglao.com"
+email      "bug-glibc@gnu.org"
+tel        ""
+fax        ""
+language   "Lao"
+territory  "Laos"
+revision   "1.0"
+date       "2003-4-1"
+%
+category  "lo_LA:2000";LC_IDENTIFICATION
+category  "lo_LA:2000";LC_CTYPE
+category  "lo_LA:2000";LC_COLLATE
+category  "lo_LA:2000";LC_TIME
+category  "lo_LA:2000";LC_NUMERIC
+category  "lo_LA:2000";LC_MONETARY
+category  "lo_LA:2000";LC_MESSAGES
+category  "lo_LA:2000";LC_PAPER
+category  "lo_LA:2000";LC_NAME
+category  "lo_LA:2000";LC_ADDRESS
+category  "lo_LA:2000";LC_TELEPHONE
+
+END LC_IDENTIFICATION
+
+LC_CTYPE
+copy "i18n"
+translit_start
+include  "translit_combining";""
+translit_end
+END LC_CTYPE
+
+LC_COLLATE
+
+%
+
+collating-element <ko-e> from "<U0EC0><U0E81>"
+collating-element <ko-ae> from "<U0EC1><U0E81>"
+collating-element <ko-o> from "<U0EC2><U0E81>"
+collating-element <ko-ai-maimuan> from "<U0EC3><U0E81>"
+collating-element <ko-ai-maimalai> from "<U0EC4><U0E81>"
+
+collating-element <kho-sung-e> from "<U0EC0><U0E82>"
+collating-element <kho-sung-ae> from "<U0EC1><U0E82>"
+collating-element <kho-sung-o> from "<U0EC2><U0E82>"
+collating-element <kho-sung-ai-maimuan> from "<U0EC3><U0E82>"
+collating-element <kho-sung-ai-maimalai> from "<U0EC4><U0E82>"
+
+collating-element <kho-tam-e> from "<U0EC0><U0E84>"
+collating-element <kho-tam-ae> from "<U0EC1><U0E84>"
+collating-element <kho-tam-o> from "<U0EC2><U0E84>"
+collating-element <kho-tam-ai-maimuan> from "<U0EC3><U0E84>"
+collating-element <kho-tam-ai-maimalai> from "<U0EC4><U0E84>"
+
+collating-element <ngo-e> from "<U0EC0><U0E87>"
+collating-element <ngo-ae> from "<U0EC1><U0E87>"
+collating-element <ngo-o> from "<U0EC2><U0E87>"
+collating-element <ngo-ai-maimuan> from "<U0EC3><U0E87>"
+collating-element <ngo-ai-maimalai> from "<U0EC4><U0E87>"
+
+collating-element <cho-e> from "<U0EC0><U0E88>"
+collating-element <cho-ae> from "<U0EC1><U0E88>"
+collating-element <cho-o> from "<U0EC2><U0E88>"
+collating-element <cho-ai-maimuan> from "<U0EC3><U0E88>"
+collating-element <cho-ai-maimalai> from "<U0EC4><U0E88>"
+
+collating-element <xo-e> from "<U0EC0><U0E8A>"
+collating-element <xo-ae> from "<U0EC1><U0E8A>"
+collating-element <xo-o> from "<U0EC2><U0E8A>"
+collating-element <xo-ai-maimuan> from "<U0EC3><U0E8A>"
+collating-element <xo-ai-maimalai> from "<U0EC4><U0E8A>"
+
+collating-element <nyo-e> from "<U0EC0><U0E8D>"
+collating-element <nyo-ae> from "<U0EC1><U0E8D>"
+collating-element <nyo-o> from "<U0EC2><U0E8D>"
+collating-element <nyo-ai-maimuan> from "<U0EC3><U0E8D>"
+collating-element <nyo-ai-maimalai> from "<U0EC4><U0E8D>"
+
+collating-element <do-e> from "<U0EC0><U0E94>"
+collating-element <do-ae> from "<U0EC1><U0E94>"
+collating-element <do-o> from "<U0EC2><U0E94>"
+collating-element <do-ai-maimuan> from "<U0EC3><U0E94>"
+collating-element <do-ai-maimalai> from "<U0EC4><U0E94>"
+
+collating-element <to-e> from "<U0EC0><U0E95>"
+collating-element <to-ae> from "<U0EC1><U0E95>"
+collating-element <to-o> from "<U0EC2><U0E95>"
+collating-element <to-ai-maimuan> from "<U0EC3><U0E95>"
+collating-element <to-ai-maimalai> from "<U0EC4><U0E95>"
+
+collating-element <tho-sung-e> from "<U0EC0><U0E96>"
+collating-element <tho-sung-ae> from "<U0EC1><U0E96>"
+collating-element <tho-sung-o> from "<U0EC2><U0E96>"
+collating-element <tho-sung-ai-maimuan> from "<U0EC3><U0E96>"
+collating-element <tho-sung-ai-maimalai> from "<U0EC4><U0E96>"
+
+collating-element <tho-tam-e> from "<U0EC0><U0E97>"
+collating-element <tho-tam-ae> from "<U0EC1><U0E97>"
+collating-element <tho-tam-o> from "<U0EC2><U0E97>"
+collating-element <tho-tam-ai-maimuan> from "<U0EC3><U0E97>"
+collating-element <tho-tam-ai-maimalai> from "<U0EC4><U0E97>"
+
+collating-element <no-e> from "<U0EC0><U0E99>"
+collating-element <no-ae> from "<U0EC1><U0E99>"
+collating-element <no-o> from "<U0EC2><U0E99>"
+collating-element <no-ai-maimuan> from "<U0EC3><U0E99>"
+collating-element <no-ai-maimalai> from "<U0EC4><U0E99>"
+
+collating-element <bo-e> from "<U0EC0><U0E9A>"
+collating-element <bo-ae> from "<U0EC1><U0E9A>"
+collating-element <bo-o> from "<U0EC2><U0E9A>"
+collating-element <bo-ai-maimuan> from "<U0EC3><U0E9A>"
+collating-element <bo-ai-maimalai> from "<U0EC4><U0E9A>"
+
+collating-element <po-e> from "<U0EC0><U0E9B>"
+collating-element <po-ae> from "<U0EC1><U0E9B>"
+collating-element <po-o> from "<U0EC2><U0E9B>"
+collating-element <po-ai-maimuan> from "<U0EC3><U0E9B>"
+collating-element <po-ai-maimalai> from "<U0EC4><U0E9B>"
+
+collating-element <pho-sung-e> from "<U0EC0><U0E9C>"
+collating-element <pho-sung-ae> from "<U0EC1><U0E9C>"
+collating-element <pho-sung-o> from "<U0EC2><U0E9C>"
+collating-element <pho-sung-ai-maimuan> from "<U0EC3><U0E9C>"
+collating-element <pho-sung-ai-maimalai> from "<U0EC4><U0E9C>"
+
+collating-element <fo-tam-e> from "<U0EC0><U0E9D>"
+collating-element <fo-tam-ae> from "<U0EC1><U0E9D>"
+collating-element <fo-tam-o> from "<U0EC2><U0E9D>"
+collating-element <fo-tam-ai-maimuan> from "<U0EC3><U0E9D>"
+collating-element <fo-tam-ai-maimalai> from "<U0EC4><U0E9D>"
+
+collating-element <pho-tam-e> from "<U0EC0><U0E9E>"
+collating-element <pho-tam-ae> from "<U0EC1><U0E9E>"
+collating-element <pho-tam-o> from "<U0EC2><U0E9E>"
+collating-element <pho-tam-ai-maimuan> from "<U0EC3><U0E9E>"
+collating-element <pho-tam-ai-maimalai> from "<U0EC4><U0E9E>"
+
+collating-element <fo-sung-e> from "<U0EC0><U0E9F>"
+collating-element <fo-sung-ae> from "<U0EC1><U0E9F>"
+collating-element <fo-sung-o> from "<U0EC2><U0E9F>"
+collating-element <fo-sung-ai-maimuan> from "<U0EC3><U0E9F>"
+collating-element <fo-sung-ai-maimalai> from "<U0EC4><U0E9F>"
+
+collating-element <mo-e> from "<U0EC0><U0EA1>"
+collating-element <mo-ae> from "<U0EC1><U0EA1>"
+collating-element <mo-o> from "<U0EC2><U0EA1>"
+collating-element <mo-ai-maimuan> from "<U0EC3><U0EA1>"
+collating-element <mo-ai-maimalai> from "<U0EC4><U0EA1>"
+
+collating-element <yo-e> from "<U0EC0><U0EA2>"
+collating-element <yo-ae> from "<U0EC1><U0EA2>"
+collating-element <yo-o> from "<U0EC2><U0EA2>"
+collating-element <yo-ai-maimuan> from "<U0EC3><U0EA2>"
+collating-element <yo-ai-maimalai> from "<U0EC4><U0EA2>"
+
+collating-element <ro-e> from "<U0EC0><U0EA3>"
+collating-element <ro-ae> from "<U0EC1><U0EA3>"
+collating-element <ro-o> from "<U0EC2><U0EA3>"
+collating-element <ro-ai-maimuan> from "<U0EC3><U0EA3>"
+collating-element <ro-ai-maimalai> from "<U0EC4><U0EA3>"
+
+collating-element <lo-e> from "<U0EC0><U0EA5>"
+collating-element <lo-ae> from "<U0EC1><U0EA5>"
+collating-element <lo-o> from "<U0EC2><U0EA5>"
+collating-element <lo-ai-maimuan> from "<U0EC3><U0EA5>"
+collating-element <lo-ai-maimalai> from "<U0EC4><U0EA5>"
+
+collating-element <wo-e> from "<U0EC0><U0EA7>"
+collating-element <wo-ae> from "<U0EC1><U0EA7>"
+collating-element <wo-o> from "<U0EC2><U0EA7>"
+collating-element <wo-ai-maimuan> from "<U0EC3><U0EA7>"
+collating-element <wo-ai-maimalai> from "<U0EC4><U0EA7>"
+
+collating-element <so-e> from "<U0EC0><U0EAA>"
+collating-element <so-ae> from "<U0EC1><U0EAA>"
+collating-element <so-o> from "<U0EC2><U0EAA>"
+collating-element <so-ai-maimuan> from "<U0EC3><U0EAA>"
+collating-element <so-ai-maimalai> from "<U0EC4><U0EAA>"
+
+collating-element <ho-e> from "<U0EC0><U0EAB>"
+collating-element <ho-ae> from "<U0EC1><U0EAB>"
+collating-element <ho-o> from "<U0EC2><U0EAB>"
+collating-element <ho-ai-maimuan> from "<U0EC3><U0EAB>"
+collating-element <ho-ai-maimalai> from "<U0EC4><U0EAB>"
+
+collating-element <o-ae> from "<U0EC1><U0EAD>"
+collating-element <o-o> from "<U0EC2><U0EAD>"
+collating-element <o-ai-maimuan> from "<U0EC3><U0EAD>"
+collating-element <o-ai-maimalai> from "<U0EC4><U0EAD>"
+
+collating-element <hor-e> from "<U0EC0><U0EAE>"
+collating-element <hor-ae> from "<U0EC1><U0EAE>"
+collating-element <hor-o> from "<U0EC2><U0EAE>"
+collating-element <hor-ai-maimuan> from "<U0EC3><U0EAE>"
+collating-element <hor-ai-maimalai> from "<U0EC4><U0EAE>"
+
+collating-element <nhor-e> from "<U0EC0><U0EDC>"
+collating-element <nhor-ae> from "<U0EC1><U0EDC>"
+collating-element <nhor-o> from "<U0EC2><U0EDC>"
+collating-element <nhor-ai-maimuan> from "<U0EC3><U0EDC>"
+collating-element <nhor-ai-maimalai> from "<U0EC4><U0EDC>"
+
+collating-element <mhor-e> from "<U0EC0><U0EDD>"
+collating-element <mhor-ae> from "<U0EC1><U0EDD>"
+collating-element <mhor-o> from "<U0EC2><U0EDD>"
+collating-element <mhor-ai-maimuan> from "<U0EC3><U0EDD>"
+collating-element <mhor-ai-maimalai> from "<U0EC4><U0EDD>"
+
+
+collating-symbol  <BLANK>
+collating-symbol  <LaoI>
+collating-symbol  <CAP>
+collating-symbol  <MIN>
+collating-symbol  <EXTRA>
+
+order_start   forward;forward;forward;forward
+
+% definitions of extra collating symbols
+<BLANK>
+<LaoI>
+<CAP>
+<MIN>
+<EXTRA>
+
+UNDEFINED      IGNORE;IGNORE;IGNORE;IGNORE
+
+% punctuation marks, ordered after ISO/IEC 14651
+<U0020>        IGNORE;IGNORE;<U0020>;IGNORE          % SPACE
+<U005F>   IGNORE;IGNORE;<U005F>;IGNORE     % LOW LINE
+<U002D>       IGNORE;IGNORE;<U002D>;IGNORE         % HYPHEN-MINUS
+<U002C>        IGNORE;IGNORE;<U002C>;IGNORE          % COMMA
+<U003B>    IGNORE;IGNORE;<U003B>;IGNORE      % SEMICOLON
+<U003A>        IGNORE;IGNORE;<U003A>;IGNORE          % COLON
+<U0021> IGNORE;IGNORE;<U0021>;IGNORE  % EXCLAMATION MARK
+<U003F>    IGNORE;IGNORE;<U003F>;IGNORE     % QUESTION MARK
+<U002F>        IGNORE;IGNORE;<U002F>;IGNORE          % SOLIDUS
+<U002E>       IGNORE;IGNORE;<U002E>;IGNORE         % FULL STOP
+<U0EAF>        IGNORE;IGNORE;<U0EAF>;IGNORE          % Lao CHARACTER Lao Ellipse
+<U0EC6>        IGNORE;IGNORE;<U0EC6>;IGNORE          % Lao CHARACTER mAI ko La
+<U0060> IGNORE;IGNORE;<U0060>;IGNORE   % GRAVE ACCENT
+<U005E>   IGNORE;IGNORE;<U005E>;IGNORE     % CIRCUMFLEX
+<U007E>        IGNORE;IGNORE;<U007E>;IGNORE          % TILDE
+<U0027>        IGNORE;IGNORE;<U0027>;IGNORE    % APOSTROPHE
+<U0022>    IGNORE;IGNORE;<U0022>;IGNORE    % QUOTATION MARK
+<U0028>  IGNORE;IGNORE;<U0028>;IGNORE  % LEFT PAREN.
+<U005B> IGNORE;IGNORE;<U005B>;IGNORE  % LT BRACKET
+<U007B>        IGNORE;IGNORE;<U007B>;IGNORE    % LEFT CURLY BRACKET
+<U007D>       IGNORE;IGNORE;<U007D>;IGNORE   % RIGHT CURLY BRACKET
+<U005D> IGNORE;IGNORE;<U005D>;IGNORE % RT BRACKET
+<U0029> IGNORE;IGNORE;<U0029>;IGNORE % RIGHT PAREN.
+<U0040>     IGNORE;IGNORE;<U0040>;IGNORE     % COMMERCIAL AT
+<U20AD>             IGNORE;IGNORE;<U20AD>;IGNORE  % Lao CHARACTER SYMBOL KIP
+<U0024>       IGNORE;IGNORE;<U0024>;IGNORE   % DOLLAR SIGN
+<U002A>          IGNORE;IGNORE;<U002A>;IGNORE      % ASTERISK
+<U005C>         IGNORE;IGNORE;<U005C>;IGNORE     % BACK SOLIDUS
+<U0026>         IGNORE;IGNORE;<U0026>;IGNORE     % AMPERSAND
+<U0023>       IGNORE;IGNORE;<U0023>;IGNORE   % NUMBER SIGN
+<U0025>      IGNORE;IGNORE;<U0025>;IGNORE  % PERCENT
+<U002B>         IGNORE;IGNORE;<U002B>;IGNORE     % PLUS
+<U003C>    IGNORE;IGNORE;<U003C>;IGNORE     % LESS THAN
+<U003D>       IGNORE;IGNORE;<U003D>;IGNORE   % EQUAL
+<U003E> IGNORE;IGNORE;<U003E>;IGNORE  % GREATER THAN
+<U007C>     IGNORE;IGNORE;<U007C>;IGNORE % VERTICAL LINE
+
+% Lao tone marks and diacritics
+
+<U0ECC>        IGNORE;<U0ECC>;<BLANK>;<BLANK>  % Lao CHARACTER THANTHAKHAT Or Cancellation Mark
+<U0EC8>        IGNORE;<U0EC8>;<BLANK>;<BLANK>  % Lao CHARACTER MAI EK
+<U0EC9>        IGNORE;<U0EC9>;<BLANK>;<BLANK>  % Lao CHARACTER MAI THO
+<U0ECA>        IGNORE;<U0ECA>;<BLANK>;<BLANK>  % Lao CHARACTER MAI TI
+<U0ECB>        IGNORE;<U0ECB>;<BLANK>;<BLANK>  % Lao CHARACTER MAI CHATTAWA
+<U0EBB>        IGNORE;<U0ECA>;<BLANK>;<BLANK>  % Lao CHARACTER MAI Kon
+<U0ECD>        IGNORE;<U0ECA>;<BLANK>;<BLANK>  % Lao CHARACTER MAI Niggahita
+<U0EC6>        IGNORE;<U0ECA>;<BLANK>;<BLANK>  % Lao CHARACTER MAI Ko Lao
+
+
+
+
+% Arabic and Lao decimal digits
+<U0030>  <U0030>;<BLANK>;<BLANK>;<BLANK>   % DIGIT ZERO
+<U0ED0> <U0030>;<LaoI>;<BLANK>;<BLANK>   % Lao DIGIT ZERO
+<U0031>   <U0031>;<BLANK>;<BLANK>;<BLANK>    % DIGIT ONE
+<U0ED1> <U0031>;<LaoI>;<BLANK>;<BLANK>    % Lao DIGIT ONE
+<U0032>   <U0032>;<BLANK>;<BLANK>;<BLANK>    % DIGIT TWO
+<U0ED2> <U0032>;<LaoI>;<BLANK>;<BLANK>    % Lao DIGIT TWO
+<U0033> <U0033>;<BLANK>;<BLANK>;<BLANK>  % DIGIT THREE
+<U0ED3> <U0033>;<LaoI>;<BLANK>;<BLANK>  % Lao DIGIT THREE
+<U0034>  <U0034>;<BLANK>;<BLANK>;<BLANK>   % DIGIT FOUR
+<U0ED4> <U0034>;<LaoI>;<BLANK>;<BLANK>   % Lao DIGIT FOUR
+<U0035>  <U0035>;<BLANK>;<BLANK>;<BLANK>   % DIGIT FIVE
+<U0ED5> <U0035>;<LaoI>;<BLANK>;<BLANK>   % Lao DIGIT FIVE
+<U0036>   <U0036>;<BLANK>;<BLANK>;<BLANK>    % DIGIT SIX
+<U0ED6> <U0036>;<LaoI>;<BLANK>;<BLANK>    % Lao DIGIT SIX
+<U0037> <U0037>;<BLANK>;<BLANK>;<BLANK>  % DIGIT SEVEN
+<U0ED7> <U0037>;<LaoI>;<BLANK>;<BLANK>  % Lao DIGIT SEVEN
+<U0038> <U0038>;<BLANK>;<BLANK>;<BLANK>  % DIGIT EIGHT
+<U0ED8> <U0038>;<LaoI>;<BLANK>;<BLANK>  % Lao DIGIT EIGHT
+<U0039>  <U0039>;<BLANK>;<BLANK>;<BLANK>   % DIGIT NINE
+<U0ED9> <U0039>;<LaoI>;<BLANK>;<BLANK>   % Lao DIGIT NINE
+
+% Latin alphabet
+<U0041> <U0041>;<BLANK>;<BLANK>;<CAP>  % A
+<U0061> <U0041>;<BLANK>;<BLANK>;<MIN>  % a
+<U0042> <U0042>;<BLANK>;<BLANK>;<CAP>  % B
+<U0062> <U0042>;<BLANK>;<BLANK>;<MIN>  % b
+<U0043> <U0043>;<BLANK>;<BLANK>;<CAP>  % C
+<U0063> <U0043>;<BLANK>;<BLANK>;<MIN>  % c
+<U0044> <U0044>;<BLANK>;<BLANK>;<CAP>  % D
+<U0064> <U0044>;<BLANK>;<BLANK>;<MIN>  % d
+<U0045> <U0045>;<BLANK>;<BLANK>;<CAP>  % E
+<U0065> <U0045>;<BLANK>;<BLANK>;<MIN>  % e
+<U0046> <U0046>;<BLANK>;<BLANK>;<CAP>  % F
+<U0066> <U0046>;<BLANK>;<BLANK>;<MIN>  % f
+<U0047> <U0047>;<BLANK>;<BLANK>;<CAP>  % G
+<U0067> <U0047>;<BLANK>;<BLANK>;<MIN>  % g
+<U0048> <U0048>;<BLANK>;<BLANK>;<CAP>  % H
+<U0068> <U0048>;<BLANK>;<BLANK>;<MIN>  % h
+<U0049> <U0049>;<BLANK>;<BLANK>;<CAP>  % I
+<U0069> <U0049>;<BLANK>;<BLANK>;<MIN>  % i
+<U004A> <U004A>;<BLANK>;<BLANK>;<CAP>  % J
+<U006A> <U004A>;<BLANK>;<BLANK>;<MIN>  % j
+<U004B> <U004B>;<BLANK>;<BLANK>;<CAP>  % K
+<U006B> <U004B>;<BLANK>;<BLANK>;<MIN>  % k
+<U004C> <U004C>;<BLANK>;<BLANK>;<CAP>  % L
+<U006C> <U004C>;<BLANK>;<BLANK>;<MIN>  % l
+<U004D> <U004D>;<BLANK>;<BLANK>;<CAP>  % M
+<U006D> <U004D>;<BLANK>;<BLANK>;<MIN>  % m
+<U004E> <U004E>;<BLANK>;<BLANK>;<CAP>  % N
+<U006E> <U004E>;<BLANK>;<BLANK>;<MIN>  % n
+<U004F> <U004F>;<BLANK>;<BLANK>;<CAP>  % O
+<U006F> <U004F>;<BLANK>;<BLANK>;<MIN>  % o
+<U0050> <U0050>;<BLANK>;<BLANK>;<CAP>  % P
+<U0070> <U0050>;<BLANK>;<BLANK>;<MIN>  % p
+<U0051> <U0051>;<BLANK>;<BLANK>;<CAP>  % Q
+<U0071> <U0051>;<BLANK>;<BLANK>;<MIN>  % q
+<U0052> <U0052>;<BLANK>;<BLANK>;<CAP>  % R
+<U0072> <U0052>;<BLANK>;<BLANK>;<MIN>  % r
+<U0053> <U0053>;<BLANK>;<BLANK>;<CAP>  % S
+<U0073> <U0053>;<BLANK>;<BLANK>;<MIN>  % s
+<U0054> <U0054>;<BLANK>;<BLANK>;<CAP>  % T
+<U0074> <U0054>;<BLANK>;<BLANK>;<MIN>  % t
+<U0055> <U0055>;<BLANK>;<BLANK>;<CAP>  % U
+<U0075> <U0055>;<BLANK>;<BLANK>;<MIN>  % u
+<U0056> <U0056>;<BLANK>;<BLANK>;<CAP>  % V
+<U0076> <U0056>;<BLANK>;<BLANK>;<MIN>  % v
+<U0057> <U0057>;<BLANK>;<BLANK>;<CAP>  % W
+<U0077> <U0057>;<BLANK>;<BLANK>;<MIN>  % w
+<U0058> <U0058>;<BLANK>;<BLANK>;<CAP>  % X
+<U0078> <U0058>;<BLANK>;<BLANK>;<MIN>  % x
+<U0059> <U0059>;<BLANK>;<BLANK>;<CAP>  % Y
+<U0079> <U0059>;<BLANK>;<BLANK>;<MIN>  % y
+<U005A> <U005A>;<BLANK>;<BLANK>;<CAP>  % Z
+<U007A> <U005A>;<BLANK>;<BLANK>;<MIN>  % z
+
+%
+% Lao consonants, with leading vowels rearrangement
+%
+<U0E81>        <U0E81>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER KO 
+<ko-e>           "<U0E81><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<ko-ae>          "<U0E81><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<ko-o>           "<U0E81><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<ko-ai-maimuan>  "<U0E81><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<ko-ai-maimalai> "<U0E81><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E82>        <U0E82>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER KHO sung
+<kho-sung-e>           "<U0E82><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<kho-sung-ae>          "<U0E82><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<kho-sung-o>           "<U0E82><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<kho-sung-ai-maimuan>  "<U0E82><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<kho-sung-ai-maimalai> "<U0E82><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E84>        <U0E84>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER KHO tam
+<kho-tam-e>           "<U0E84><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<kho-tam-ae>          "<U0E84><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<kho-tam-o>           "<U0E84><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<kho-tam-ai-maimuan>  "<U0E84><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<kho-tam-ai-maimalai> "<U0E84><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E87>        <U0E87>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER NGO 
+<ngo-e>           "<U0E87><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<ngo-ae>          "<U0E87><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<ngo-o>           "<U0E87><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<ngo-ai-maimuan>  "<U0E87><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<ngo-ai-maimalai> "<U0E87><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E88>        <U0E88>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER CHO 
+<cho-e>           "<U0E88><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<cho-ae>          "<U0E88><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<cho-o>           "<U0E88><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<cho-ai-maimuan>  "<U0E88><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<cho-ai-maimalai> "<U0E88><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E8A>        <U0E8A>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER SO
+<xo-e>           "<U0E8A><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<xo-ae>          "<U0E8A><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<xo-o>           "<U0E8A><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<xo-ai-maimuan>  "<U0E8A><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<xo-ai-maimalai> "<U0E8A><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E8D>        <U0E8D>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER Nyo
+<nyo-e>           "<U0E8D><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<nyo-ae>          "<U0E8D><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<nyo-o>           "<U0E8D><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<nyo-ai-maimuan>  "<U0E8D><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<nyo-ai-maimalai> "<U0E8D><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E94>        <U0E94>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER DO
+<do-e>           "<U0E94><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<do-ae>          "<U0E94><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<do-o>           "<U0E94><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<do-ai-maimuan>  "<U0E94><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<do-ai-maimalai> "<U0E94><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E95>        <U0E95>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER TO 
+<to-e>           "<U0E95><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<to-ae>          "<U0E95><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<to-o>           "<U0E95><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<to-ai-maimuan>  "<U0E95><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<to-ai-maimalai> "<U0E95><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E96>        <U0E96>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER THO Sung
+<tho-sung-e>           "<U0E96><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<tho-sung-ae>          "<U0E96><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<tho-sung-o>           "<U0E96><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<tho-sung-ai-maimuan>  "<U0E96><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<tho-sung-ai-maimalai> "<U0E96><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E97>        <U0E97>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER THO Tam
+<tho-tam-e>           "<U0E97><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<tho-tam-ae>          "<U0E97><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<tho-tam-o>           "<U0E97><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<tho-tam-ai-maimuan>  "<U0E97><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<tho-tam-ai-maimalai> "<U0E97><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E99>        <U0E99>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER NO
+<no-e>           "<U0E99><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<no-ae>          "<U0E99><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<no-o>           "<U0E99><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<no-ai-maimuan>  "<U0E99><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<no-ai-maimalai> "<U0E99><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E9A>        <U0E9A>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER BO
+<bo-e>           "<U0E9A><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<bo-ae>          "<U0E9A><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<bo-o>           "<U0E9A><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<bo-ai-maimuan>  "<U0E9A><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<bo-ai-maimalai> "<U0E9A><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E9B>        <U0E9B>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER PO
+<po-e>           "<U0E9B><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<po-ae>          "<U0E9B><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<po-o>           "<U0E9B><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<po-ai-maimuan>  "<U0E9B><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<po-ai-maimalai> "<U0E9B><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E9C>        <U0E9C>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER PHO sUNG
+<pho-sung-e>           "<U0E9C><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<pho-sung-ae>          "<U0E9C><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<pho-sung-o>           "<U0E9C><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<pho-sung-ai-maimuan>  "<U0E9C><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<pho-sung-ai-maimalai> "<U0E9C><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E9D>        <U0E9D>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER FO tam
+<fo-tam-e>           "<U0E9D><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<fo-tam-ae>          "<U0E9D><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<fo-tam-o>           "<U0E9D><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<fo-tam-ai-maimuan>  "<U0E9D><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<fo-tam-ai-maimalai> "<U0E9D><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E9E>        <U0E9E>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER pho tam
+<pho-tam-e>           "<U0E9E><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<pho-tam-ae>          "<U0E9E><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<pho-tam-o>           "<U0E9E><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<pho-tam-ai-maimuan>  "<U0E9E><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<pho-tam-ai-maimalai> "<U0E9E><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0E9F>        <U0E9F>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER fo sung
+<fo-sung-e>           "<U0E9F><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<fo-sung-ae>          "<U0E9F><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<fo-sung-o>           "<U0E9F><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<fo-sung-ai-maimuan>  "<U0E9F><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<fo-sung-ai-maimalai> "<U0E9F><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EA1>        <U0EA1>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER MO
+<mo-e>           "<U0EA1><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<mo-ae>          "<U0EA1><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<mo-o>           "<U0EA1><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<mo-ai-maimuan>  "<U0EA1><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<mo-ai-maimalai> "<U0EA1><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EA2>        <U0EA2>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER YO
+<yo-e>           "<U0EA2><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<yo-ae>          "<U0EA2><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<yo-o>           "<U0EA2><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<yo-ai-maimuan>  "<U0EA2><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<yo-ai-maimalai> "<U0EA2><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EA3>        <U0EA3>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER RO
+<ro-e>           "<U0EA3><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<ro-ae>          "<U0EA3><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<ro-o>           "<U0EA3><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<ro-ai-maimuan>  "<U0EA3><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<ro-ai-maimalai> "<U0EA3><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EA5>        <U0EA5>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER LO
+<lo-e>           "<U0EA5><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<lo-ae>          "<U0EA5><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<lo-o>           "<U0EA5><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<lo-ai-maimuan>  "<U0EA5><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<lo-ai-maimalai> "<U0EA5><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EA7>        <U0EA7>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER WO
+<wo-e>           "<U0EA7><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<wo-ae>          "<U0EA7><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<wo-o>           "<U0EA7><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<wo-ai-maimuan>  "<U0EA7><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<wo-ai-maimalai> "<U0EA7><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EAA>        <U0EAA>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER SO
+<so-e>           "<U0EAA><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<so-ae>          "<U0EAA><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<so-o>           "<U0EAA><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<so-ai-maimuan>  "<U0EAA><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<so-ai-maimalai> "<U0EAA><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EAB>        <U0EAB>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER HO
+<ho-e>           "<U0EAB><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<ho-ae>          "<U0EAB><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<ho-o>           "<U0EAB><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<ho-ai-maimuan>  "<U0EAB><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<ho-ai-maimalai> "<U0EAB><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EAD>        <U0EAD>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER O
+<o-e>           "<U0EAD><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<o-ae>          "<U0EAD><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<o-o>           "<U0EAD><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<o-ai-maimuan>  "<U0EAD><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<o-ai-maimalai> "<U0EAD><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EAE>        <U0EAE>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER HOr
+<hor-e>           "<U0EAE><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<hor-ae>          "<U0EAE><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<hor-o>           "<U0EAE><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<hor-ai-maimuan>  "<U0EAE><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<hor-ai-maimalai> "<U0EAE><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+
+<U0EDC>        <U0EDC>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER NHOr
+<nhor-e>           "<U0EDC><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<nhor-ae>          "<U0EDC><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<nhor-o>           "<U0EDC><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<nhor-ai-maimuan>  "<U0EDC><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<nhor-ai-maimalai> "<U0EDC><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+
+<U0EDD>        <U0EDC>;<BLANK>;<BLANK>;<BLANK> % Lao CHARACTER HHOr
+<mhor-e>           "<U0EDD><U0EC0>";<BLANK>;<BLANK>;<BLANK>
+<mor-ae>          "<U0EDD><U0EC1>";<BLANK>;<BLANK>;<BLANK>
+<mor-o>           "<U0EDD><U0EC2>";<BLANK>;<BLANK>;<BLANK>
+<mor-ai-maimuan>  "<U0EDD><U0EC3>";<BLANK>;<BLANK>;<BLANK>
+<mor-ai-maimalai> "<U0EDD><U0EC4>";<BLANK>;<BLANK>;<BLANK>
+
+<U0EAF> <U0EAF>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Ellipsis
+
+
+% order of Lao vowels
+<U0EB0> <U0EB0>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER SAlA A
+<U0EB1> <U0EB1>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER MAI HAN-AKAT
+<U0EB2> <U0EB2>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER SAlA AA
+<U0EB3> <U0EB3>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala AM
+<U0EB4> <U0EB4>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala I
+<U0EB5> <U0EB5>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala II
+<U0EB6> <U0EB6>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala UE
+<U0EB7> <U0EB7>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala UEE
+<U0EB8> <U0EB8>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala U
+<U0EB9> <U0EB9>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala UU
+<U0EBC> <U0EB9>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala Lo
+<U0EBD> <U0EB9>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala Oy
+<U0EC0> <U0EC0>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala E
+<U0EC1> <U0EC1>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala AE
+<U0EC2> <U0EC2>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala O
+<U0EC3> <U0EC3>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala AI MAIMUAN
+<U0EC4> <U0EC4>;<BLANK>;<BLANK>;<BLANK>  % Lao CHARACTER Sala AI MAIMALAI
+
+order_end
+
+END LC_COLLATE
+
+LC_MONETARY
+
+int_curr_symbol      "<U004C><U0041><U004B><U0020>"
+
+% monetary unit: Kip
+currency_symbol      "<U20AD>"
+mon_decimal_point    "<U002E>"
+mon_thousands_sep    "<U002C>"
+mon_grouping         3;3
+positive_sign        ""
+negative_sign        "<U002D>"
+int_frac_digits      2
+frac_digits          2
+p_cs_precedes        1
+p_sep_by_space       2
+n_cs_precedes        1
+n_sep_by_space       2
+p_sign_posn          4
+n_sign_posn          4
+END LC_MONETARY
+
+
+LC_NUMERIC
+
+decimal_point           "<U002E>"
+thousands_sep           "<U002C>"
+grouping                3
+
+END LC_NUMERIC
+
+LC_TIME
+
+abday   "<U0EAD><U0EB2><U002E>";"<U0E88><U002E>";"<U0E84><U002E>";/
+        "<U0E9E><U002E>";"<U0E9E><U0EAB><U002E>";"<U0EAA><U002E>";/
+        "<U0EAA><U002E>"
+day     "<U0EAD><U0EB2><U0E97><U0EB4><U0E94>";/
+        "<U0E88><U0EB1><U0E99>";/
+        "<U0EAD><U0EB1><U0E87><U0E84><U0EB2><U0E99>";/
+        "<U0E9E><U0EB8><U0E94>";/
+        "<U0E9E><U0EB0><U0EAB><U0EB1><U0E94>";/
+        "<U0EAA><U0EB8><U0E81>";/
+        "<U0EC0><U0EAA><U0EBB><U0EB2>"
+abmon   "<U0EA1><U002E><U0E81><U002E>";/
+        "<U0E81><U002E><U0E9E><U002E>";/
+        "<U0EA1><U002E><U0E99><U002E>";/
+        "<U0EA1><U002E><U0EAA><U002E>";/
+        "<U0E9E><U002E><U0E9E><U002E>";/
+        "<U0EA1><U0EB4><U002E><U0E96><U002E>";/
+        "<U0E81><U002E><U0EA5><U002E>";/
+        "<U0EAA><U002E><U0EAB><U002E>";/
+        "<U0E81><U002E><U0E8D><U002E>";/
+        "<U0E95><U002E><U0EA5><U002E>";/
+        "<U0E9E><U002E><U0E88><U002E>";/
+        "<U0E97><U002E><U0EA7><U002E>"
+mon     "<U0EA1><U0EB1><U0E87><U0E81><U0EAD><U0E99>";/
+        "<U0E81><U0EB8><U0EA1><U0E9F><U0EB2>";/
+        "<U0EA1><U0EB5><U0E99><U0EB2>";/
+        "<U0EC0><U0EA1><U0EAA><U0EB2>";/
+        "<U0E9E><U0EB6><U0E94><U0EAA><U0EB0><U0E9E><U0EB2>";/
+        "<U0EA1><U0EB4><U0E96><U0EB8><U0E99><U0EB2>";/
+        "<U0E81><U0ECD><U0EA5><U0EB0><U0E81><U0EBB><U0E94>";/
+        "<U0EAA><U0EB4><U0E87><U0EAB><U0EB2>";/
+        "<U0E81><U0EB1><U0E99><U0E8D><U0EB2>";/
+        "<U0E95><U0EB8><U0EA5><U0EB2>";/
+        "<U0E9E><U0EB0><U0E88><U0EB4><U0E81>";/
+        "<U0E97><U0EB1><U0E99><U0EA7><U0EB2>"
+% Appropriate date & time representation  "%a %e %b %Ey, %H:%M:%S"
+d_t_fmt "%a<U0020>%e<U0020>%b<U0020>%Ey<U002C><U0020>%H<U003A>%M<U003A>%S"
+% Appropriate date representation  "%d/%m/%Ey"
+d_fmt   "%d<U002F>%m<U002F>%Ey"
+% Appropriate time representation  "%H:%M:%S"
+t_fmt   "%H<U003A>%M<U003A>%S"
+% AM/PM signs
+am_pm   "<U0041><U004D>";"<U0050><U004D>"
+% Appropriate 12-hour clock representation  "%I:%M:%S %p"
+t_fmt_ampm  "%I<U003A>%M<U003A>%S<U0020>%p"
+% Era : Buddhist Era
+era     "+:1:-543<U002F>01<U002F>01:+*:<U0E9E><U002E><U0EAA><U002E>:%EC<U0020>%Ey"
+era_d_fmt       "%e<U0020>%b<U0020>%Ey"
+era_t_fmt       "%H<U002E>%M<U002E>%S<U0020><U0E99><U002E>"
+era_d_t_fmt     "<U0EA7><U0EB1><U0E99>%A<U0E97><U0EB5><U0EC8><U0020>%e<U0020>%B<U0020>%EC<U0020>%Ey<U002C><U0020>%H<U002E>%M<U002E>%S<U0020><U0E99><U002E>"
+% Appropriate date representation (date(1))   "%a %e %b %Ey %H:%M:%S %Z"
+date_fmt       "<U0025><U0061><U0020><U0025><U0065><U0020><U0025><U0062>/
+<U0020><U0025><U0045><U0079><U0020><U0025><U0048><U003A><U0025><U004D>/
+<U003A><U0025><U0053><U0020><U0025><U005A>"
+% ICT-7ICT-7
+timezone	"<U0049><U0043><U0054><U002D><U0037><U0049><U0043><U0054><U002d><U0037>"
+END LC_TIME
+
+LC_MESSAGES
+
+% yesexpr : begins with "y", "Y", or mo 
+% noexpr : begins with "n", "N", or Bo
+% yesstr = "men" = Sala ae + Mo + MAI EK + No 
+% nostr = "Bo Men" = Letter Bo +salo Or+ MAI EK + mo+ Ma Ek+ No
+
+yesexpr "<U005E><U005B><U0079><U0059><U0EA1><U005D>"
+noexpr  "<U005E><U005B><U006E><U004E><U0E9A><U005D>"
+yesstr  "<U0EC1><U0EA1><U0EC8><U0E99>"
+nostr   "<U0E9A><U0ECD><U0EC8><U0EC1><U0EA1><U0EC8><U0E99>"
+
+END LC_MESSAGES
+
+LC_PAPER
+height   297
+width    210
+END LC_PAPER
+
+LC_TELEPHONE
+tel_int_fmt    "<U002B><U0025><U0063><U0020><U0025><U0061><U0020><U0025>/
+<U006C>"
+tel_dom_fmt    "<U0028><U0025><U0041><U0029><U0025><U006C>"
+int_select     "<U0030><U0030><U0031>"
+int_prefix     "<U0038><U0035><U0036>"
+END LC_TELEPHONE
+
+LC_MEASUREMENT
+% FIXME
+measurement    1
+END LC_MEASUREMENT
+
+LC_NAME
+name_fmt    "<U0025><U0064><U0025><U0074><U0025><U0067><U0025><U0074>/
+<U0025><U006D><U0025><U0074><U0025><U0066>"
+
+name_mr     "<U0E97>."
+name_mrs    "<U0E99>."
+END LC_NAME
+
+LC_ADDRESS
+%    "%f%N%a%N%d%N%r%t%e%t%b%N%h%t%s%N%T%N%S%N%z%c%N"
+postal_fmt    "<U0025><U0066><U0025><U004E><U0025><U0061><U0025><U004E>/
+<U0025><U0064><U0025><U004E><U0025><U0072><U0025><U0074><U0025><U0065>/
+<U0025><U0074><U0025><U0062><U0025><U004E><U0025><U0068><U0025><U0074>/
+<U0025><U0073><U0025><U004E><U0025><U0054><U0025><U004E><U0025><U0053>/
+<U0025><U004E><U0025><U007A><U0025><U0063><U0025><U004E>"
+country_name  "<U0EA5><U0EB2><U0EA7>"
+%FIXME
+%country_post  ""
+country_ab2   "<U004C><U0041>"
+country_ab3   "<U004C><U0041><U004F>"
+country_num   418
+country_car   "<U004C><U0041><U004F>"
+%FIXME
+%country_isbn  ""
+lang_name     "<U0EA5><U0EB2><U0EA7>"
+lang_ab       "<U006C><U006F>"
+lang_term     "<U006c><U0061><U006F>"
+lang_lib      "<U006C><U0061><U006F>"
+END LC_ADDRESS
+
+
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/mn_MN libc-20030708/localedata/locales/mn_MN
--- glibc-2.3.2/localedata/locales/mn_MN	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/locales/mn_MN	2003-04-15 23:55:46.000000000 +0900
@@ -0,0 +1,196 @@
+comment_char %
+escape_char /
+% Mongolian language (cyrillic) locale for Mongolia
+% Sanlig Badral <badral@chinggis.com>
+% Revision: 0.9 (2003-2-27)
+% Charsets: UTF-8
+% Distribution and use is free, also
+% for commercial purposes.
+
+LC_IDENTIFICATION
+title      "Mongolian locale for Mongolia"
+source     "OPENMN"
+address    ""
+contact    ""
+email      "bug-glibc@gnu.org"
+tel        ""
+fax        ""
+language   "Mongolian"
+territory  "Mongolia"
+revision   "0.9"
+date       "2003-02-27"
+
+category  "mn_MN:2000";LC_IDENTIFICATION
+category  "mn_MN:2000";LC_CTYPE
+category  "mn_MN:2000";LC_COLLATE
+category  "mn_MN:2000";LC_TIME
+category  "mn_MN:2000";LC_NUMERIC
+category  "mn_MN:2000";LC_MONETARY
+category  "mn_MN:2000";LC_MESSAGES
+category  "mn_MN:2000";LC_PAPER
+category  "mn_MN:2000";LC_NAME
+category  "mn_MN:2000";LC_ADDRESS
+category  "mn_MN:2000";LC_TELEPHONE
+
+END LC_IDENTIFICATION
+
+LC_COLLATE
+copy "iso14651_t1"
+
+% iso14651_t1 is missing Mongolian ue(straight u), oe(barred o)
+% like russian, but with <o-=> (<barred-o>) after <o=> and
+% <u'=>(straight u) after <u=>
+
+collating-symbol <o-=>
+collating-symbol <u'=>
+
+reorder-after <CYR-O>
+<o-=>
+reorder-after <CYR-OUBRE>
+<u'=>
+
+reorder-after <U043E>
+<U04E9> <o-=>;<PCL>;<MIN>;IGNORE
+reorder-after <U041E>
+<U04E8> <o-=>;<PCL>;<CAP>;IGNORE
+
+reorder-after <U0443>
+<U04AF> <u'=>;<PCL>;<MIN>;IGNORE
+reorder-after <U0423>
+<U04AE> <u'=>;<PCL>;<CAP>;IGNORE
+
+reorder-end
+END LC_COLLATE
+
+LC_CTYPE
+copy "i18n"
+END LC_CTYPE
+
+LC_MONETARY
+int_curr_symbol     "<U004D><U004E><U0054><U0020>"
+currency_symbol     "<U20AE>"
+mon_decimal_point   "<U002E>"
+mon_thousands_sep   "<U0020>"
+mon_grouping        3;3
+positive_sign       ""
+negative_sign       "<U002D>"
+int_frac_digits     2
+frac_digits         2
+p_cs_precedes       0
+p_sep_by_space      1
+n_cs_precedes       0
+n_sep_by_space      1
+p_sign_posn         1
+n_sign_posn         1
+
+END LC_MONETARY
+
+LC_NUMERIC
+decimal_point   "<U002C>"
+thousands_sep   "<U002E>"
+grouping        3;3
+END LC_NUMERIC
+
+LC_TIME
+% Abbreviated weekday names (%a)
+abday "<U041D><U044F>";"<U0414><U0430>";/
+      "<U041C><U044F>";"<U041B><U0445>";/
+      "<U041F><U04AF>";"<U0411><U0430>";/
+      "<U0411><U044F>"
+% Full weekday names (%A)
+day   "<U041D><U044F><U043C>";/
+      "<U0414><U0430><U0432><U0430><U0430>";/
+      "<U041C><U044F><U0433><U043C><U0430><U0440>";/
+      "<U041B><U0445><U0430><U0433><U0432><U0430>";/
+      "<U041F><U04AF><U0440><U044D><U0432>";/
+      "<U0411><U0430><U0430><U0441><U0430><U043D>";/
+      "<U0411><U044F><U043C><U0431><U0430>"
+% Abbreviated month names (%b)
+abmon       "<U0031><U002D><U0440>";"<U0032><U002D><U0440>";/
+            "<U0033><U002D><U0440>";"<U0034><U002D><U0440>";/
+            "<U0035><U002D><U0440>";"<U0036><U002D><U0440>";/
+            "<U0037><U002D><U0440>";"<U0038><U002D><U0440>";/
+            "<U0039><U002D><U0440>";"<U0031><U0030><U002D><U0440>";/
+            "<U0031><U0031><U002D><U0440>";"<U0031><U0032><U002D><U0440>"
+% Full month names (%B)
+mon         "<U041D><U044D><U0433><U0434><U04AF><U0433><U044D><U044D><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0425><U043E><U0451><U0440><U0434><U0443><U0433><U0430><U0430><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0413><U0443><U0440><U0430><U0432><U0434><U0443><U0433><U0430><U0430><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0414><U04E9><U0440><U04E9><U0432><U0434><U04AF><U0433><U044D><U044D><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0422><U0430><U0432><U0434><U0443><U0433><U0430><U0430><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0417><U0443><U0440><U0433><U0430><U0430><U0434><U0443><U0433><U0430><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0414><U043E><U043B><U043E><U043E><U0434><U0443><U0433><U0430><U0430><U0440><U0020><U0441><U0430><U0440>";/
+            "<U041D><U0430><U0439><U043C><U0434><U0443><U0433><U0430><U0430><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0415><U0441><U0434><U04AF><U0433><U044D><U044D><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0410><U0440><U0430><U0432><U0434><U0443><U0433><U0430><U0430><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0410><U0440><U0432><U0430><U043D><U043D><U044D><U0433><U0434><U04AF><U0433><U044D><U044D><U0440><U0020><U0441><U0430><U0440>";/
+            "<U0410><U0440><U0432><U0430><U043D><U0445><U043E><U0451><U0440><U0434><U0433><U0430><U0430><U0440><U0020><U0441><U0430><U0440>"
+% Appropriate date and time representation
+% "%a %d %b %Y %T %Z"
+d_t_fmt "<U0025><U0061><U0020><U0025><U0064><U0020><U0025><U0062><U0020><U0025><U0059><U0020><U0025><U0054><U0020><U0025><U005A>"
+
+% Appropriate date representation
+% "%Y.%m.%d"
+d_fmt   "<U0025><U0059><U002E><U0025><U006D><U002E><U0025><U0064>"
+% Appropriate time representation
+% "%T"
+t_fmt   "<U0025><U0054>"
+% Appropriate 12 h time representation (%r)
+am_pm   "";""
+t_fmt_ampm ""
+% Full date and time representation
+% "%a %b %e %H:%M:%S %Z %Y"
+date_fmt  "<U0025><U0061><U0020><U0025><U0062><U0020><U0025><U0065><U0020><U0025><U0048><U003A><U0025><U004D><U003A><U0025><U0053><U0020><U0025><U005A><U0020><U0025><U0059>"
+END LC_TIME
+
+LC_MESSAGES
+yesexpr "<U005E><U005B><U0442><U0422><U0079><U0059><U005D><U002E><U002A>"
+noexpr  "<U005E><U005B><U04AF><U04AE><U006E><U004E><U005D><U002E><U002A>"
+END LC_MESSAGES
+
+% Paper format
+LC_PAPER
+height   297
+width    210
+END LC_PAPER
+
+LC_NAME
+name_fmt    "<U0025><U0064><U0025><U0074><U0025><U0067><U0025><U0074>/
+<U0025><U006D><U0025><U0074><U0025><U0066>"
+
+name_miss   "<U0425><U0430><U0442><U0430><U0433><U0442><U0430><U0439>"
+name_mr     "<U041D><U043E><U0451><U043D>"
+name_mrs    "<U0425><U0430><U0442><U0430><U0433><U0442><U0430><U0439>"
+name_ms     "<U0425><U0430><U0442><U0430><U0433><U0442><U0430><U0439>"
+END LC_NAME
+
+LC_ADDRESS
+postal_fmt    "<U0025><U0066><U0025><U004E><U0025><U0061><U0025><U004E>/
+<U0025><U0064><U0025><U004E><U0025><U0062><U0025><U004E><U0025><U0073>/
+<U0020><U0025><U0068><U0020><U0025><U0065><U0020><U0025><U0072><U0025>/
+<U004E><U0025><U0025><U007A><U0020><U0025><U0054><U0025>/
+<U004E><U0025><U0063><U0025><U004E>"
+
+country_name  "<U004D><U006F><U006E><U0067><U006F><U006C><U0069><U0061>"
+country_post  "<U004D><U004E>"
+country_ab2   "<U004D><U004E>"
+country_ab3   "<U004D><U004E><U0047>"
+country_num   496
+country_car   "<U004D><U0047><U004C>"
+country_isbn  99929
+lang_name     "<U004D><U006F><U006E><U0067><U006F><U006C><U0069><U0061><U006E>"
+lang_ab       "<U006D><U006E>"
+lang_term     "<U006D><U006F><U006E>"
+lang_lib      "<U006D><U006F><U006E>"
+END LC_ADDRESS
+
+LC_TELEPHONE
+tel_int_fmt    "<U0028><U002B><U0025><U0063><U0020><U0025><U0061><U0029><U0020><U0025><U006C>"
+tel_dom_fmt    "<U0028><U0030><U0025><U0061><U0029><U0020><U0025><U006C>"
+int_select     "<U0030><U0030>"
+int_prefix     "<U0039><U0037><U0036>"
+END LC_TELEPHONE
+
+LC_MEASUREMENT
+measurement    1
+END LC_MEASUREMENT
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/no_NO libc-20030708/localedata/locales/no_NO
--- glibc-2.3.2/localedata/locales/no_NO	2000-10-27 02:57:17.000000000 +0900
+++ libc-20030708/localedata/locales/no_NO	2003-07-08 22:58:08.000000000 +0900
@@ -1056,6 +1056,8 @@
 <U1E13>	<U0044>;<MACRON+CIRCUMFLEX>;<SMALL>;IGNORE
 <U1E0E>	<U0044>;<LINE-BELOW>;<CAPITAL>;IGNORE
 <U1E0F>	<U0044>;<LINE-BELOW>;<SMALL>;IGNORE
+<U00D0>	<U0044>;<U00D0>;<CAPITAL>;IGNORE %LATIN CAPITAL LETTER ETH (Icelandic)
+<U00F0>	<U0044>;<U00D0>;<SMALL>;IGNORE   %LATIN SMALL LETTER ETH (Icelandic)
 <d8>
 <U0045>	<U0045>;<NONE>;<CAPITAL>;IGNORE
 <U0065>	<U0045>;<NONE>;<SMALL>;IGNORE
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/sr_YU libc-20030708/localedata/locales/sr_YU
--- glibc-2.3.2/localedata/locales/sr_YU	2002-02-14 09:58:15.000000000 +0900
+++ libc-20030708/localedata/locales/sr_YU	2003-04-15 23:55:46.000000000 +0900
@@ -224,7 +224,7 @@
 END LC_MESSAGES
 
 LC_MONETARY
-int_curr_symbol           "<U0059><U0055><U004E><U0020>"
+int_curr_symbol           "<U0059><U0055><U004D><U0020>"
 currency_symbol           "<U0064><U0069><U006E>"
 mon_decimal_point         "<U002C>"
 mon_thousands_sep         "<U0020>"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/sr_YU@cyrillic libc-20030708/localedata/locales/sr_YU@cyrillic
--- glibc-2.3.2/localedata/locales/sr_YU@cyrillic	2000-10-28 04:33:59.000000000 +0900
+++ libc-20030708/localedata/locales/sr_YU@cyrillic	2003-04-15 23:55:46.000000000 +0900
@@ -61,7 +61,7 @@
 END LC_MESSAGES
 
 LC_MONETARY
-int_curr_symbol           "<U0059><U0055><U004E><U0020>"
+int_curr_symbol           "<U0059><U0055><U004D><U0020>"
 currency_symbol           "<U0434><U0438><U043D>"
 mon_decimal_point         "<U002C>"
 mon_thousands_sep         "<U0020>"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/st_ZA libc-20030708/localedata/locales/st_ZA
--- glibc-2.3.2/localedata/locales/st_ZA	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/locales/st_ZA	2003-05-10 17:39:17.000000000 +0900
@@ -0,0 +1,254 @@
+escape_char  /
+comment_char  %
+
+% ChangeLog
+% 0.1 (2003-04-21):
+%   - Initial Sotho locale for South Africa
+%     by Zuza Software Foundation
+
+LC_IDENTIFICATION
+title      "Sotho locale for South Africa"
+source     "Zuza Software Foundation"
+address    "PO Box 13412, Mowbray, 7705, South Africa"
+contact    "Dwayne Bailey"
+email      "dwayne@translate.org.za"
+tel        "+27 (0)21 448 9265"
+fax        "+27 (0)21 448 9574"
+language   "Sotho"
+territory  "South Africa"
+revision   "0.1"
+date       "2003-04-21"
+%
+category  "st_ZA:2003";LC_IDENTIFICATION
+category  "st_ZA:2003";LC_CTYPE
+category  "st_ZA:2003";LC_COLLATE
+category  "st_ZA:2003";LC_TIME
+category  "st_ZA:2003";LC_NUMERIC
+category  "st_ZA:2003";LC_MONETARY
+category  "st_ZA:2003";LC_MESSAGES
+category  "st_ZA:2003";LC_PAPER
+category  "st_ZA:2003";LC_NAME
+category  "st_ZA:2003";LC_ADDRESS
+category  "st_ZA:2003";LC_TELEPHONE
+category  "st_ZA:2003";LC_MEASUREMENT
+
+END LC_IDENTIFICATION
+
+LC_CTYPE
+% Use the characters described in the charmap file "i18n.tgz"
+copy "i18n"
+END LC_CTYPE
+
+LC_COLLATE
+% Copy the template from ISO/IEC 14651 i.e.
+% use the rules there when making ordered lists of words.
+copy "iso14651_t1"
+END LC_COLLATE
+
+LC_MONETARY
+copy "en_ZA"
+END LC_MONETARY
+
+LC_NUMERIC
+copy "en_ZA"
+END LC_NUMERIC
+
+LC_TIME
+
+% abday - The abbreviations for the week days:
+% - Son, Mma, Bed, Rar, Ne, Hla, Moq
+abday       "<U0053><U006F><U006E>";/
+            "<U004D><U006D><U0061>";/
+            "<U0042><U0065><U0064>";/
+            "<U0052><U0061><U0072>";/
+            "<U004E><U0065>";/
+            "<U0048><U006C><U0061>";/
+            "<U004D><U006F><U0071>"
+ 
+% day - The full names of the week days:
+% - Sontaha, Mmantaha, Labobedi, Laboraru, Labone, Labohlane, Moqebelo
+day         "<U0053><U006F><U006E><U0074><U0061><U0068><U0061>";/
+            "<U004D><U006D><U0061><U006E><U0074><U0061><U0068><U0061>";/
+            "<U004C><U0061><U0062><U006F><U0062><U0065><U0064><U0069>";/
+            "<U004C><U0061><U0062><U006F><U0072><U0061><U0072><U0075>";/
+            "<U004C><U0061><U0062><U006F><U006E><U0065>";/
+            "<U004C><U0061><U0062><U006F><U0068><U006C><U0061><U006E><U0065>";/
+            "<U004D><U006F><U0071><U0065><U0062><U0065><U006C><U006F>"
+ 
+% abmon - The abbreviations for the months 
+% - Phe, Kol, Ube, Mme, Mot, Jan, Upu, Pha, Leo, Mph, Pun, Tsh
+abmon       "<U0050><U0068><U0065>";"<U004B><U006F><U006C>";/
+            "<U0055><U0062><U0065>";"<U004D><U006D><U0065>";/
+            "<U004D><U006F><U0074>";"<U004A><U0061><U006E>";/
+            "<U0055><U0070><U0075>";"<U0050><U0068><U0061>";/
+            "<U004C><U0065><U006F>";"<U004D><U0070><U0068>";/
+            "<U0050><U0075><U006E>";"<U0054><U0073><U0068>"
+ 
+% mon - The full names of the months - 
+% - Phesekgong, Hlakola, Hlakubele, Mmese, Motsheanong, Phupjane, 
+%   Phupu, Phata, Leotshe, Mphalane, Pundungwane, Tshitwe
+mon         "<U0050><U0068><U0065><U0073><U0065><U006B><U0067><U006F><U006E><U0067>";/
+            "<U0048><U006C><U0061><U006B><U006F><U006C><U0061>";/
+            "<U0048><U006C><U0061><U006B><U0075><U0062><U0065><U006C><U0065>";/
+            "<U004D><U006D><U0065><U0073><U0065>";/
+            "<U004D><U006F><U0074><U0073><U0068><U0065><U0061><U006E><U006F><U006E><U0067>";/
+            "<U0050><U0068><U0075><U0070><U006A><U0061><U006E><U0065>";/
+            "<U0050><U0068><U0075><U0070><U0075>";/
+            "<U0050><U0068><U0061><U0074><U0061>";/
+            "<U004C><U0065><U006F><U0074><U0073><U0068><U0065>";/
+            "<U004D><U0070><U0068><U0061><U006C><U0061><U006E><U0065>";/
+            "<U0050><U0075><U006E><U0064><U0075><U006E><U0067><U0077><U0061><U006E><U0065>";/
+            "<U0054><U0073><U0068><U0069><U0074><U0077><U0065>"
+ 
+% Abreviated date and time representation to be referenced by the "%c" field descriptor -
+d_t_fmt     "<U0025><U0061><U0020><U0025><U0064><U0020><U0025><U0062><U0020><U0025><U0059><U0020><U0025><U0054><U0020><U0025><U005A>"
+%
+% "%a" (short weekday name),
+% "%d" (day of month as a decimal number),
+% "%b" (short month name),
+% "%Y" (year with century as a decimal number),
+% "%T" (24-hour clock time in format HH:MM:SS),
+% "%Z" (Time zone name)
+ 
+% Date representation to be referenced by the "%x" field descriptor -
+d_fmt   "<U0025><U0064><U002F><U0025><U006D><U002F><U0025><U0059>"
+% "%d/%m/%Y", day/month/year as decimal numbers (01/01/2000).
+ 
+% Time representation to be referenced by the "%X" field descriptor -
+t_fmt       "<U0025><U0054>"
+% "%T" (24-hour clock time in format HH:MM:SS)
+ 
+% Define representation of ante meridiem and post meridiem strings -
+am_pm       "";""
+% The "" mean 'default to "AM" and "PM".
+ 
+% Define time representation in 12-hour format with "am_pm", to be referenced by the "%r"
+t_fmt_ampm  ""
+% The "" means that this format is not supported.
+ 
+% Date representation not described in ISO/IEC 14652. Comes out as -
+% "%a %b %e %H:%M:%S %Z %Y" which is default "date" command output
+date_fmt "<U0025><U0061><U0020><U0025><U0062><U0020><U0025><U0065>/
+<U0020><U0025><U0048><U003A><U0025><U004D><U003A><U0025><U0053><U0020>/
+<U0025><U005A><U0020><U0025><U0059>"
+%
+% %a - abbreviated weekday name,
+% %b - abreviated month name,
+% %e - day of month as a decimal number with leading space (1 to 31),
+% %H - hour (24-hour clock) as a decimal number (00 to 23),
+% %M - minute as a decimal number (00 to 59),
+% %S - seconds as a decimal number (00 to 59),
+% %Z - time-zone name,
+% %Y - year with century as a decimal number,e.g. 2001.
+ 
+END LC_TIME
+
+LC_MESSAGES
+% FIXME: Check both of these
+% The affirmative response -
+% "^[yY].*"
+yesexpr     "<U005E><U005B><U0079><U0059><U005D><U002E><U002A>"
+
+% The negative response -
+% "^[nN].*"
+noexpr      "<U005E><U005B><U006E><U004E><U005D><U002E><U002A>"
+END LC_MESSAGES
+
+LC_PAPER
+copy "en_ZA"
+END LC_PAPER
+
+LC_TELEPHONE
+copy "en_ZA"
+END LC_TELEPHONE
+
+LC_MEASUREMENT
+copy "en_ZA"
+END LC_MEASUREMENT
+
+LC_NAME
+% Format for addressing a person.
+name_fmt    "<U0025><U0064><U0025><U0074><U0025><U0067><U0025><U0074>/
+<U0025><U006D><U0025><U0074><U0025><U0066>"
+% "%d%t%g%t%m%t%f"
+% "Salutation",
+% "Empty string, or <Space>",
+% "First given name",
+% "Empty string, or <Space>",
+% "Middle names",
+% "Empty string, or <Space>",
+% "Clan names"
+ 
+% FIXME - define all the following name_*
+% General salutation for any sex
+% name_gen    ""
+
+% Salutation for unmarried females - ""
+% name_miss   ""
+ 
+% Salutation for males - ""
+% name_mr     ""
+
+% Salutation for married females - ""
+% name_mrs    ""
+
+% Salutation valid for all females - "" (no term)
+% name_ms     ""
+
+END LC_NAME
+
+LC_ADDRESS
+% Country name in Sotho - "Afrika Borwa"
+country_name "<U0041><U0066><U0072><U0069><U006B><U0061><U0020><U0042><U006F><U0072><U0077><U0061>"
+ 
+% Abbreviated country postal name - "ZA"
+country_post "<U005A><U0041>"
+ 
+% ISO 3166 two letter country abbreviation - "ZA"
+country_ab2 "<U005A><U0041>"
+
+% FIXME define the following correctly
+% country_ab3 ""
+% country_car ""
+% country_isbn ""
+% country_num 
+ 
+% Language name in Sotho - "Sesotho"
+lang_name "<U0053><U0065><U0073><U006F><U0074><U0068><U006F>"
+
+% FIXME define the following correctly
+% lang_ab   ""
+% lang_term ""
+ 
+% Representation of postal addresses (minus the addressee's name) in South
+% Africa. (Ignored for now)
+postal_fmt    "<U0025><U0066><U0025><U004E><U0025><U0061><U0025><U004E>/
+<U0025><U0064><U0025><U004E><U0025><U0062><U0025><U004E><U0025><U0073>/
+<U0020><U0025><U0068><U0020><U0025><U0065><U0020><U0025><U0072><U0025>/
+<U004E><U0025><U0025><U007A><U0020><U0025><U0054><U0025>/
+<U004E><U0025><U0063><U0025><U004E>"
+% "%f%N%a%N%d%N%b%N%s %h %e %r%N%%z %T%N%c%N", which gives -
+% "firm name",
+% "end of line",
+% "C/O address",
+% "end of line",
+% "department name",
+% "Building name",
+% "end of line",
+% "street or block name",
+% "space",
+% "house number or designation",
+% "space",
+% "floor number",
+% "space",
+% "room number, door designation",
+% "end of line",
+% "postal code",
+% "space",
+% "town, city",
+% "end of line",
+% "country designation for the <country_post> keyword",
+% "end of line
+%
+END LC_ADDRESS
+
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/uk_UA libc-20030708/localedata/locales/uk_UA
--- glibc-2.3.2/localedata/locales/uk_UA	2001-08-03 17:17:35.000000000 +0900
+++ libc-20030708/localedata/locales/uk_UA	2003-06-12 08:54:03.000000000 +0900
@@ -4,7 +4,7 @@
 % Ukrainian Language Locale for Ukraine
 % Source: RFC 2319
 % Contact: Denis V. Dmitrienko
-% Email: denis@null.net
+% Email: denis@denix.org
 % Language: uk
 % Territory: UA
 % Revision: 1.2
@@ -14,6 +14,8 @@
 % Charset: KOI8-U
 % Distribution and use is free, also
 % for commercial purposes.
+%
+% Some collate fixes by Valentyn Solomko vesna@slovnyk.org
 
 LC_IDENTIFICATION
 title      "Ukrainian locale for Ukraine"
@@ -25,8 +27,8 @@
 fax        ""
 language   "Ukrainian"
 territory  "Ukraine"
-revision   "1.0"
-date       "2000-06-29"
+revision   "1.3"
+date       "2003-01-31"
 %
 category  "uk_UA:2000";LC_IDENTIFICATION
 category  "uk_UA:2000";LC_CTYPE
@@ -47,19 +49,30 @@
 END LC_CTYPE
 
 LC_COLLATE
+
 copy "iso14651_t1"
 
 % iso14651_t1 is missing Ukrainian ghe
 collating-symbol <UKR-GHE>
 
-reorder-after <CYR-GZHE>
+reorder-after <CYR-GHE>
 <UKR-GHE>
 
-reorder-after <U0453>
-<U0491> <UKR-GHE>;<BAS>;<MIN>;IGNORE
-
-reorder-after <U0403>
-<U0490> <UKR-GHE>;<BAS>;<CAP>;IGNORE
+reorder-after <U0433>
+% <U0491> <UKR-GHE>;<BAS>;<MIN>;IGNORE
+<U0491> <CYR-GHE>;<UKR-GHE>;<MIN>;IGNORE
+
+reorder-after <U0438>
+% <U0456> <UKR-I>;<BAS>;<MIN>;IGNORE
+<U0456> <CYR-I>;<UKR-I>;<MIN>;IGNORE
+
+reorder-after <U0413>
+% <U0490> <UKR-GHE>;<BAS>;<CAP>;IGNORE
+<U0490> <CYR-GHE>;<UKR-GHE>;<CAP>;IGNORE
+
+reorder-after <U0418>
+% <U0406> <UKR-I>;<BAS>;<CAP>;IGNORE
+<U0406> <CYR-I>;<UKR-I>;<CAP>;IGNORE
 
 reorder-end
 END LC_COLLATE
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/xh_ZA libc-20030708/localedata/locales/xh_ZA
--- glibc-2.3.2/localedata/locales/xh_ZA	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/locales/xh_ZA	2003-05-10 17:39:31.000000000 +0900
@@ -0,0 +1,235 @@
+escape_char  /
+comment_char  %
+
+% ChangeLog
+% 0.1 (2003-05-08):
+%   - Initial Xhosa locale by Zuza Software Foundation
+
+LC_IDENTIFICATION
+title      "Xhosa locale for South Africa"
+source     "Zuza Software Foundation"
+address    "PO Box 13412, Mowbray, 7705, South Africa"
+contact    "Dwayne Bailey"
+email      "dwayne@translate.org.za"
+tel        "+27 (0)21 448 9265"
+fax        "+27 (0)21 448 9574"
+language   "Xhosa"
+territory  "South Africa"
+revision   "0.1"
+date       "2003-05-08"
+%
+category  "xh_ZA:2003";LC_IDENTIFICATION
+category  "xh_ZA:2003";LC_CTYPE
+category  "xh_ZA:2003";LC_COLLATE
+category  "xh_ZA:2003";LC_TIME
+category  "xh_ZA:2003";LC_NUMERIC
+category  "xh_ZA:2003";LC_MONETARY
+category  "xh_ZA:2003";LC_MESSAGES
+category  "xh_ZA:2003";LC_PAPER
+category  "xh_ZA:2003";LC_NAME
+category  "xh_ZA:2003";LC_ADDRESS
+category  "xh_ZA:2003";LC_TELEPHONE
+category  "xh_ZA:2003";LC_MEASUREMENT
+
+END LC_IDENTIFICATION
+
+LC_CTYPE
+% Use the characters described in the charmap file "i18n.tgz"
+copy "i18n"
+END LC_CTYPE
+
+LC_COLLATE
+% Copy the template from ISO/IEC 14651 i.e.
+% use the rules there when making ordered lists of words.
+copy "iso14651_t1"
+END LC_COLLATE
+
+LC_MONETARY
+copy "en_ZA"
+END LC_MONETARY
+
+LC_NUMERIC
+copy "en_ZA"
+END LC_NUMERIC
+
+LC_TIME
+% The abbreviations for the week days:
+% - Caw, Mvu, Bin, Tha, Sin, Hla, Mgq
+abday       "<U0043><U0061><U0077>";/
+            "<U004D><U0076><U0075>";/
+            "<U0042><U0069><U006E>";/
+            "<U0054><U0068><U0061>";/
+            "<U0053><U0069><U006E>";/
+            "<U0048><U006C><U0061>";/
+            "<U004D><U0067><U0071>"
+%
+% The full names of the week days:
+% - Cawe, Mvulo, Lwesibini, Lwesithathu, Lwesine, Lwesihlanu, Mgqibelo
+day         "<U0043><U0061><U0077><U0065>";/
+            "<U004D><U0076><U0075><U006C><U006F>";/
+            "<U004C><U0077><U0065><U0073><U0069><U0062><U0069><U006E><U0069>";/
+            "<U004C><U0077><U0065><U0073><U0069><U0074><U0068><U0061><U0074><U0068><U0075>";/
+            "<U004C><U0077><U0065><U0073><U0069><U006E><U0065>";/
+            "<U004C><U0077><U0065><U0073><U0069><U0068><U006C><U0061><U006E><U0075>";/
+            "<U004D><U0067><U0071><U0069><U0062><U0065><U006C><U006F>"
+%
+% The abbreviations for the months 
+% - Jan, Feb, Mat, Epr, Mey, Jun, Jul, Aga, Sep, Okt, Nov, Dis
+abmon       "<U004A><U0061><U006E>";"<U0046><U0065><U0062>";/
+            "<U004D><U0061><U0074>";"<U0045><U0070><U0072>";/
+            "<U004D><U0065><U0079>";"<U004A><U0075><U006E>";/
+            "<U004A><U0075><U006C>";"<U0041><U0067><U0061>";/
+            "<U0053><U0065><U0070>";"<U004F><U006B><U0074>";/
+            "<U004E><U006F><U0076>";"<U0044><U0069><U0073>"
+%
+% The full names of the months - 
+% - Janyuwari, Februwari, Matshi, Epreli, Meyi, Juni, Julayi, Agasti, Septemba,
+%   Okthoba, Novemba, Disemba
+mon         "<U004A><U0061><U006E><U0079><U0075><U0077><U0061><U0072><U0069>";/
+            "<U0046><U0065><U0062><U0072><U0075><U0077><U0061><U0072><U0069>";/
+            "<U004D><U0061><U0074><U0073><U0068><U0069>";/
+            "<U0045><U0070><U0072><U0065><U006C><U0069>";/
+            "<U004D><U0065><U0079><U0069>";/
+            "<U004A><U0075><U006E><U0069>";/
+            "<U004A><U0075><U006C><U0061><U0079><U0069>";/
+            "<U0041><U0067><U0061><U0073><U0074><U0069>";/
+            "<U0053><U0065><U0070><U0074><U0065><U006D><U0062><U0061>";/
+            "<U004F><U006B><U0074><U0068><U006F><U0062><U0061>";/
+            "<U004E><U006F><U0076><U0065><U006D><U0062><U0061>";/
+            "<U0044><U0069><U0073><U0065><U006D><U0062><U0061>"
+%
+% Abreviated date and time representation to be referenced by the "%c" field descriptor -
+d_t_fmt     "<U0025><U0061><U0020><U0025><U0064><U0020><U0025><U0062><U0020><U0025><U0059><U0020><U0025><U0054><U0020><U0025><U005A>"
+% "%a" (weekday name),
+% "%d" (day of month as a decimal number),
+% "%b" (month name),
+% "%Y" (year with century as a decimal number),
+% "%T" (24-hour clock time in format HH:MM:SS),
+% "%Z" (Time zone name)
+%
+% Date representation to be referenced by the "%x" field % descriptor -
+% "%d/%m/%Y", day/month/year as decimal numbers (01/01/2000).
+d_fmt   "<U0025><U0064><U002F><U0025><U006D><U002F><U0025><U0059>"
+%
+% Time representation to be referenced by the "%X" field descriptor -
+% "%T" (24-hour clock time in format HH:MM:SS)
+t_fmt       "<U0025><U0054>"
+%
+% Define representation of ante meridiem and post meridiem strings -
+% The ""s means default to "AM" and "PM".
+am_pm       "";""
+%
+% Define time representation in 12-hour format with "am_pm", to be referenced by the "%r"
+% field descriptor -
+% The "" means that this format is not supported.
+t_fmt_ampm  ""
+%
+% Date representation not described in ISO/IEC 14652. 
+% Comes out as - "%a %b %e %H:%M:%S %Z %Y" 
+date_fmt "<U0025><U0061><U0020><U0025><U0062><U0020><U0025><U0065>/
+<U0020><U0025><U0048><U003A><U0025><U004D><U003A><U0025><U0053><U0020>/
+<U0025><U005A><U0020><U0025><U0059>"
+% which is:
+% abbreviated weekday name,
+% day of month as a decimal number (01 to 31),
+% day of month as a decimal number with leading space (1 to 31),
+% hour (24-hour clock) as a decimal number (00 to 23),
+% minute as a decimal number (00 to 59),
+% seconds as a decimal number (00 to 59),
+% time-zone name,
+% year with century as a decimal number,e.g. 2001.
+%
+END LC_TIME
+
+LC_MESSAGES
+% The affirmative response -
+% "^[yYeE].*"
+yesexpr     "<U005E><U005B><U0079><U0059><U0065><U0045><U005D><U002E><U002A>"
+%
+% The negative response -
+% "^[nNhH].*"
+noexpr      "<U005E><U005B><U006E><U004E><U0068><U0048><U005D><U002E><U002A>"
+%
+END LC_MESSAGES
+
+LC_PAPER
+copy "en_ZA"
+END LC_PAPER
+
+LC_TELEPHONE
+copy "en_ZA"
+END LC_TELEPHONE
+
+LC_MEASUREMENT
+copy "en_ZA"
+END LC_MEASUREMENT
+
+LC_NAME
+% Format for addressing a person.
+name_fmt    "<U0025><U0064><U0025><U0074><U0025><U0067><U0025><U0074>/
+<U0025><U006D><U0025><U0074><U0025><U0066>"
+% "%d%t%g%t%m%t%f"
+% "Salutation",
+% "Empty string, or <Space>",
+% "First given name",
+% "Empty string, or <Space>",
+% "Middle names",
+% "Empty string, or <Space>",
+% "Clan names"
+%
+% Salutation for unmarried females - "Nkosazana"
+name_miss   "<U004E><U006B><U006F><U0073><U0061><U007A><U0061><U006E><U0061>"
+%
+% Salutation for males - "Mnumzana"
+name_mr     "<U004D><U006E><U0075><U006D><U007A><U0061><U006E><U0061>"
+%
+% Salutation for married females - "Nkosikazi"
+name_mrs    "<U004E><U006B><U006F><U0073><U0069><U006B><U0061><U007A><U0069>"
+%
+% Salutation valid for all females - "" (no term)
+name_ms     ""
+END LC_NAME
+
+LC_ADDRESS
+% Country name in Xhosa - "Mzantsi Afrika"
+country_name "<U004D><U007A><U0061><U006E><U0074><U0073><U0069><U0020>/
+<U0041><U0066><U0072><U0069><U006B><U0061>"
+%
+% Abbreviated country postal name - "ZA"
+country_post "<U005A><U0041>"
+%
+% ISO 3166 two letter country abbreviation - "ZA"
+country_ab2 "<U005A><U0041>"
+%
+% Representation of postal addresses (minus the addressee's name) in South
+% Africa. (Ignored for now)
+postal_fmt    "<U0025><U0066><U0025><U004E><U0025><U0061><U0025><U004E>/
+<U0025><U0064><U0025><U004E><U0025><U0062><U0025><U004E><U0025><U0073>/
+<U0020><U0025><U0068><U0020><U0025><U0065><U0020><U0025><U0072><U0025>/
+<U004E><U0025><U0025><U007A><U0020><U0025><U0054><U0025>/
+<U004E><U0025><U0063><U0025><U004E>"
+% "%f%N%a%N%d%N%b%N%s %h %e %r%N%%z %T%N%c%N", which gives -
+% "firm name",
+% "end of line",
+% "C/O address",
+% "end of line",
+% "department name",
+% "Building name",
+% "end of line",
+% "street or block name",
+% "space",
+% "house number or designation",
+% "space",
+% "floor number",
+% "space",
+% "room number, door designation",
+% "end of line",
+% "postal code",
+% "space",
+% "town, city",
+% "end of line",
+% "country designation for the <country_post> keyword",
+% "end of line
+%
+END LC_ADDRESS
+
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/locales/zu_ZA libc-20030708/localedata/locales/zu_ZA
--- glibc-2.3.2/localedata/locales/zu_ZA	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/locales/zu_ZA	2003-05-10 17:39:46.000000000 +0900
@@ -0,0 +1,241 @@
+escape_char  /
+comment_char  %
+
+% ChangeLog
+% 0.1 (2003-04-19):
+%   - Initial Zulu locale by Zuza Software Foundation
+
+LC_IDENTIFICATION
+title      "Zulu locale for South Africa"
+source     "Zuza Software Foundation"
+address    "PO Box 13412, Mowbray, 7705, South Africa"
+contact    "Dwayne Bailey"
+email      "dwayne@translate.org.za"
+tel        "+27 (0)21 448 9265"
+fax        "+27 (0)21 448 9574"
+language   "Zulu"
+territory  "South Africa"
+revision   "0.1"
+date       "2003-04-19"
+%
+category  "zu_ZA:2003";LC_IDENTIFICATION
+category  "zu_ZA:2003";LC_CTYPE
+category  "zu_ZA:2003";LC_COLLATE
+category  "zu_ZA:2003";LC_TIME
+category  "zu_ZA:2003";LC_NUMERIC
+category  "zu_ZA:2003";LC_MONETARY
+category  "zu_ZA:2003";LC_MESSAGES
+category  "zu_ZA:2003";LC_PAPER
+category  "zu_ZA:2003";LC_NAME
+category  "zu_ZA:2003";LC_ADDRESS
+category  "zu_ZA:2003";LC_TELEPHONE
+category  "zu_ZA:2003";LC_MEASUREMENT
+
+END LC_IDENTIFICATION
+
+LC_CTYPE
+% Use the characters described in the charmap file "i18n.tgz"
+%
+copy "i18n"
+END LC_CTYPE
+
+LC_COLLATE
+% Copy the template from ISO/IEC 14651 i.e.
+% use the rules there when making ordered lists of words.
+%
+copy "iso14651_t1"
+END LC_COLLATE
+
+LC_MONETARY
+copy "en_ZA"
+END LC_MONETARY
+
+LC_NUMERIC
+copy "en_ZA"
+END LC_NUMERIC
+
+LC_TIME
+% abday - The abbreviations for the week days:
+% - Son, Mso, Bil, Tha, Sin, Hla, Mgq
+abday       "<U0053><U006F><U006E>";/
+            "<U004D><U0073><U006F>";/
+            "<U0042><U0069><U006C>";/
+            "<U0054><U0068><U0061>";/
+            "<U0053><U0069><U006E>";/
+            "<U0048><U006C><U0061>";/
+            "<U004D><U0067><U0071>"
+ 
+% day - The full names of the week days:
+% - Sonto, Msombuluko, Lwesibili, Lwesithathu, Lwesine, Lwesihlanu, Mgqibelo
+day         "<U0053><U006F><U006E><U0074><U006F>";/
+            "<U004D><U0073><U006F><U006D><U0062><U0075><U006C><U0075><U006B><U006F>";/
+            "<U004C><U0077><U0065><U0073><U0069><U0062><U0069><U006C><U0069>";/
+            "<U004C><U0077><U0065><U0073><U0069><U0074><U0068><U0061><U0074><U0068><U0075>";/
+            "<U004C><U0077><U0065><U0073><U0069><U006E><U0065>";/
+            "<U004C><U0077><U0065><U0073><U0069><U0068><U006C><U0061><U006E><U0075>";/
+            "<U004D><U0067><U0071><U0069><U0062><U0065><U006C><U006F>"
+ 
+% abmon - The abbreviations for the months 
+% - Jan, Feb, Mas, Apr, Mey, Jun, Jul, Aga, Sep, Okt, Nov, Dis
+abmon       "<U004A><U0061><U006E>";"<U0046><U0065><U0062>";/
+            "<U004D><U0061><U0073>";"<U0041><U0070><U0072>";/
+            "<U004D><U0065><U0079>";"<U004A><U0075><U006E>";/
+            "<U004A><U0075><U006C>";"<U0041><U0067><U0061>";/
+            "<U0053><U0065><U0070>";"<U004F><U006B><U0074>";/
+            "<U004E><U006F><U0076>";"<U0044><U0069><U0073>"
+ 
+% mon - The full names of the months - 
+% - Januwari, Februwari, Mashi, Apreli, Meyi, Juni, Julayi, Agasti, Septemba,
+%   Okthoba, Novemba, Disemba 
+mon         "<U004A><U0061><U006E><U0075><U0077><U0061><U0072><U0069>";/
+            "<U0046><U0065><U0062><U0072><U0075><U0077><U0061><U0072><U0069>";/
+            "<U004D><U0061><U0073><U0068><U0069>";/
+            "<U0041><U0070><U0072><U0065><U006C><U0069>";/
+            "<U004D><U0065><U0079><U0069>";/
+            "<U004A><U0075><U006E><U0069>";/
+            "<U004A><U0075><U006C><U0061><U0079><U0069>";/
+            "<U0041><U0067><U0061><U0073><U0074><U0069>";/
+            "<U0053><U0065><U0070><U0074><U0065><U006D><U0062><U0061>";/
+            "<U004F><U006B><U0074><U0068><U006F><U0062><U0061>";/
+            "<U004E><U006F><U0076><U0065><U006D><U0062><U0061>";/
+            "<U0044><U0069><U0073><U0065><U006D><U0062><U0061>"
+ 
+% Abreviated date and time representation to be referenced by the "%c" field descriptor -
+d_t_fmt     "<U0025><U0061><U0020><U0025><U0064><U0020><U0025><U0062><U0020><U0025><U0059><U0020><U0025><U0054><U0020><U0025><U005A>"
+%
+% "%a" (short weekday name),
+% "%d" (day of month as a decimal number),
+% "%b" (short month name),
+% "%Y" (year with century as a decimal number),
+% "%T" (24-hour clock time in format HH:MM:SS),
+% "%Z" (Time zone name)
+
+% Date representation to be referenced by the "%x" field descriptor -
+% "%d/%m/%Y", day/month/year as decimal numbers (01/01/2000).
+d_fmt   "<U0025><U0064><U002F><U0025><U006D><U002F><U0025><U0059>"
+ 
+% Time representation to be referenced by the "%X" field descriptor -
+% "%T" (24-hour clock time in format HH:MM:SS)
+t_fmt       "<U0025><U0054>"
+ 
+% Define representation of ante meridiem and post meridiem strings -
+% The ""s mean default to "AM" and "PM".
+am_pm       "";""
+ 
+% Define time representation in 12-hour format with "am_pm", to be referenced by the "%r"
+% field descriptor -
+% The "" means that this format is not supported.
+t_fmt_ampm  ""
+
+% Date representation not described in ISO/IEC 14652. Comes out as -
+% "%a %b %e %H:%M:%S %Z %Y" 
+date_fmt "<U0025><U0061><U0020><U0025><U0062><U0020><U0025><U0065>/
+<U0020><U0025><U0048><U003A><U0025><U004D><U003A><U0025><U0053><U0020>/
+<U0025><U005A><U0020><U0025><U0059>"
+% which is
+% %a - abbreviated weekday name,
+% %b - abreviated month name,
+% %e - day of month as a decimal number with leading space (1 to 31),
+% %H - hour (24-hour clock) as a decimal number (00 to 23),
+% %M - minute as a decimal number (00 to 59),
+% %S - seconds as a decimal number (00 to 59),
+% %Z - time-zone name,
+% %Y - year with century as a decimal number,e.g. 2001.
+
+END LC_TIME
+
+LC_MESSAGES
+yesexpr     "<U005E><U005B><U0079><U0059><U005D><U002E><U002A>"
+% The affirmative response -
+% "^[yY].*"
+%
+noexpr      "<U005E><U005B><U006E><U004E><U0063><U0043><U005D><U002E><U002A>"
+% The negative response -
+% "^[nNcC].*"
+%
+END LC_MESSAGES
+
+LC_PAPER
+copy "en_ZA"
+END LC_PAPER
+
+LC_TELEPHONE
+copy "en_ZA"
+END LC_TELEPHONE
+
+LC_MEASUREMENT
+copy "en_ZA"
+END LC_MEASUREMENT
+
+LC_NAME
+name_fmt    "<U0025><U0064><U0025><U0074><U0025><U0067><U0025><U0074>/
+<U0025><U006D><U0025><U0074><U0025><U0066>"
+% Format for addressing a person.
+% "%d%t%g%t%m%t%f"
+% "Salutation",
+% "Empty string, or <Space>",
+% "First given name",
+% "Empty string, or <Space>",
+% "Middle names",
+% "Empty string, or <Space>",
+% "Clan names"
+%
+name_miss   "<U004E><U006B><U006F><U0073><U0061><U007A><U0061><U006E><U0065>"
+% Salutation for unmarried females - "Nkosazane"
+%
+name_mr     "<U004D><U006E><U0075><U006D><U007A><U0061><U006E><U0065>"
+% Salutation for males - "Mnumzane"
+%
+name_mrs    "<U004E><U006B><U006F><U0073><U0069><U006B><U0061><U007A><U0069>"
+% Salutation for married females - "Nkosikazi"
+%
+name_ms     ""
+% Salutation valid for all females - "" (no term)
+END LC_NAME
+
+LC_ADDRESS
+country_name "<U004D><U007A><U0061><U006E><U0073><U0069><U0020>/
+<U0041><U0066><U0072><U0069><U006B><U0061>"
+% Country name in Zulu - "Mzansi Afrika"
+%
+country_post "<U005A><U0041>"
+% Abbreviated country postal name - "ZA"
+%
+country_ab2 "<U005A><U0041>"
+% ISO 3166 two letter country abbreviation - "ZA"
+%
+lang_name "<U0049><U0073><U0069><U007A><U0075><U006C><U0075>"
+% Language name in Zulu - "Isizulu"
+%
+postal_fmt    "<U0025><U0066><U0025><U004E><U0025><U0061><U0025><U004E>/
+<U0025><U0064><U0025><U004E><U0025><U0062><U0025><U004E><U0025><U0073>/
+<U0020><U0025><U0068><U0020><U0025><U0065><U0020><U0025><U0072><U0025>/
+<U004E><U0025><U0025><U007A><U0020><U0025><U0054><U0025>/
+<U004E><U0025><U0063><U0025><U004E>"
+% Representation of postal addresses (minus the addressee's name) in South
+% Africa. (Ignored for now)
+% "%f%N%a%N%d%N%b%N%s %h %e %r%N%%z %T%N%c%N", which gives -
+% "firm name",
+% "end of line",
+% "C/O address",
+% "end of line",
+% "department name",
+% "Building name",
+% "end of line",
+% "street or block name",
+% "space",
+% "house number or designation",
+% "space",
+% "floor number",
+% "space",
+% "room number, door designation",
+% "end of line",
+% "postal code",
+% "space",
+% "town, city",
+% "end of line",
+% "country designation for the <country_post> keyword",
+% "end of line
+%
+END LC_ADDRESS
+
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/sort-test.sh libc-20030708/localedata/sort-test.sh
--- glibc-2.3.2/localedata/sort-test.sh	2000-08-22 16:52:13.000000000 +0900
+++ libc-20030708/localedata/sort-test.sh	2003-05-02 00:11:50.000000000 +0900
@@ -27,6 +27,7 @@
     echo "$l OK"
   else
     echo "$l FAIL"
+    diff -u $cns.in ${common_objpfx}localedata/$cns.xout
     status=1
   fi
 done
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/tests-mbwc/tst_wcsxfrm.c libc-20030708/localedata/tests-mbwc/tst_wcsxfrm.c
--- glibc-2.3.2/localedata/tests-mbwc/tst_wcsxfrm.c	2000-06-28 00:53:19.000000000 +0900
+++ libc-20030708/localedata/tests-mbwc/tst_wcsxfrm.c	2003-05-10 13:38:03.000000000 +0900
@@ -47,7 +47,7 @@
       if (debug_flg)
 	{
 	  fprintf (stdout, "tst_wcsxfrm() : REC = %d\n", rec + 1);
-	  fprintf (stdout, "tst_wcsxfrm() : 1st ret = %d\n", ret);
+	  fprintf (stdout, "tst_wcsxfrm() : 1st ret = %zu\n", ret);
 	}
 
       if (ret == -1 || ret >= n1 || errno_save != 0)
@@ -78,7 +78,7 @@
 
       if (debug_flg)
 	{
-	  fprintf (stdout, "tst_wcsxfrm() : 2nd ret = %d\n", ret);
+	  fprintf (stdout, "tst_wcsxfrm() : 2nd ret = %zu\n", ret);
 	}
 
       /* wcscoll() */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/tst-fmon.c libc-20030708/localedata/tst-fmon.c
--- glibc-2.3.2/localedata/tst-fmon.c	2001-07-08 04:21:05.000000000 +0900
+++ libc-20030708/localedata/tst-fmon.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,5 +1,5 @@
 /* Testing the implementation of strfmon(3).
-   Copyright (C) 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jochen Hein <jochen.hein@delphi.central.de>, 1997.
 
@@ -42,15 +42,12 @@
 main (int argc, char *argv[])
 {
   char *s = malloc (201);
-  double monval;
 
   if (setlocale (LC_MONETARY, argv[1]) == NULL)
     {
-      perror ("setlocale");
+      fprintf (stderr, "setlocale(LC_MONETARY, \"%s\"): %m\n", argv[1]);
       exit (EXIT_SETLOCALE);
     }
-  /* This is locale-dependent! see setlocale(3) for details */
-  monval = strtod (argv[3], NULL);
 
   if (strfmon (s, 200, argv[2], (double) atof (argv[3])) == -1)
     {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/tst-fmon.sh libc-20030708/localedata/tst-fmon.sh
--- glibc-2.3.2/localedata/tst-fmon.sh	2001-07-08 04:21:05.000000000 +0900
+++ libc-20030708/localedata/tst-fmon.sh	2003-07-08 22:58:08.000000000 +0900
@@ -1,6 +1,6 @@
 #! /bin/sh
 # Testing the implementation of strfmon(3).
-# Copyright (C) 1996, 1997, 1998, 2000 Free Software Foundation, Inc.
+# Copyright (C) 1996, 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 # Contributed by Jochen Hein <jochen.hein@delphi.central.de>, 1997.
 #
@@ -39,24 +39,26 @@
 done
 
 # Run the tests.
+errcode=0
 # There's a TAB for IFS
 while IFS="	" read locale format value expect; do
+    case "$locale" in '#'*) continue ;; esac
     if [ -n "$format" ]; then
-	LOCPATH=${common_objpfx}localedata \
-	GCONV_PATH=${common_objpfx}/iconvdata \
-	${run_program_prefix} ${common_objpfx}localedata/tst-fmon \
-	    "$locale" "$format" "$value" "$expect"
-	if [ $? -eq 0 ]; then
+	if LOCPATH=${common_objpfx}localedata \
+	   GCONV_PATH=${common_objpfx}/iconvdata \
+	   ${run_program_prefix} ${common_objpfx}localedata/tst-fmon \
+	   "$locale" "$format" "$value" "$expect" ; then
 	    echo "Locale: \"${locale}\" Format: \"${format}\"" \
 		 "Value: \"${value}\" Expect: \"${expect}\"  passed"
 	else
+	    errcode=$?
 	    echo "Locale: \"${locale}\" Format: \"${format}\"" \
 		 "Value: \"${value}\" Expect: \"${expect}\"    failed"
 	fi
     fi
 done < $datafile
 
-exit $?
+exit $errcode
 # Local Variables:
 #  mode:shell-script
 # End:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/tst-langinfo.sh libc-20030708/localedata/tst-langinfo.sh
--- glibc-2.3.2/localedata/tst-langinfo.sh	2001-07-08 04:21:05.000000000 +0900
+++ libc-20030708/localedata/tst-langinfo.sh	2003-05-10 13:38:03.000000000 +0900
@@ -1,6 +1,6 @@
 #! /bin/sh
 # Test nl_langinfo.
-# Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+# Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 #
 
@@ -155,13 +155,13 @@
 en_US.ISO-8859-1     THOUSEP     ,
 en_US.ISO-8859-1     YESEXPR     ^[yY].*
 en_US.ISO-8859-1     NOEXPR      ^[nN].*
-de_DE.ISO-8859-1     ABDAY_1     Son
-de_DE.ISO-8859-1     ABDAY_2     Mon
-de_DE.ISO-8859-1     ABDAY_3     Die
-de_DE.ISO-8859-1     ABDAY_4     Mit
-de_DE.ISO-8859-1     ABDAY_5     Don
-de_DE.ISO-8859-1     ABDAY_6     Fre
-de_DE.ISO-8859-1     ABDAY_7     Sam
+de_DE.ISO-8859-1     ABDAY_1     So
+de_DE.ISO-8859-1     ABDAY_2     Mo
+de_DE.ISO-8859-1     ABDAY_3     Di
+de_DE.ISO-8859-1     ABDAY_4     Mi
+de_DE.ISO-8859-1     ABDAY_5     Do
+de_DE.ISO-8859-1     ABDAY_6     Fr
+de_DE.ISO-8859-1     ABDAY_7     Sa
 de_DE.ISO-8859-1     DAY_1       Sonntag
 de_DE.ISO-8859-1     DAY_2       Montag
 de_DE.ISO-8859-1     DAY_3       Dienstag
@@ -200,13 +200,13 @@
 de_DE.ISO-8859-1     THOUSEP     .
 de_DE.ISO-8859-1     YESEXPR     ^[jJyY].*
 de_DE.ISO-8859-1     NOEXPR      ^[nN].*
-de_DE.UTF-8          ABDAY_1     Son
-de_DE.UTF-8          ABDAY_2     Mon
-de_DE.UTF-8          ABDAY_3     Die
-de_DE.UTF-8          ABDAY_4     Mit
-de_DE.UTF-8          ABDAY_5     Don
-de_DE.UTF-8          ABDAY_6     Fre
-de_DE.UTF-8          ABDAY_7     Sam
+de_DE.UTF-8          ABDAY_1     So
+de_DE.UTF-8          ABDAY_2     Mo
+de_DE.UTF-8          ABDAY_3     Di
+de_DE.UTF-8          ABDAY_4     Mi
+de_DE.UTF-8          ABDAY_5     Do
+de_DE.UTF-8          ABDAY_6     Fr
+de_DE.UTF-8          ABDAY_7     Sa
 de_DE.UTF-8          DAY_1       Sonntag
 de_DE.UTF-8          DAY_2       Montag
 de_DE.UTF-8          DAY_3       Dienstag
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/tst-numeric.c libc-20030708/localedata/tst-numeric.c
--- glibc-2.3.2/localedata/tst-numeric.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/tst-numeric.c	2003-05-02 00:11:50.000000000 +0900
@@ -0,0 +1,74 @@
+/* Testing the implementation of LC_NUMERIC and snprintf().
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Petter Reinholdtsen <pere@hungry.com>, 2003
+
+   Based on tst-fmon.c by Jochen Hein <jochen.hein@delphi.central.de>, 1997.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdio.h>
+#include <locale.h>
+#include <string.h>
+#include <stdlib.h>
+
+/*
+  test-numeric gets called with three parameters:
+   - the locale
+   - the format-string to be used
+   - the actual number to be formatted
+   - the expected string
+   If the test passes, test-numeric terminates with returncode 0,
+   otherwise with 1
+*/
+#define EXIT_SUCCESS 0
+#define EXIT_FAILURE 1
+#define EXIT_SETLOCALE 2
+#define EXIT_SNPRINTF 3
+
+int
+main (int argc, char *argv[])
+{
+  char *s = malloc (201);
+  double val;
+
+  /* Make sure to read the value before setting of the locale, as
+     strtod() is locale-dependent. */
+  val = strtod (argv[3], NULL);
+
+  if (setlocale (LC_ALL, argv[1]) == NULL)
+    {
+      fprintf (stderr, "setlocale(LC_ALL, \"%s\"): %m\n", argv[1]);
+      exit (EXIT_SETLOCALE);
+    }
+
+  if (snprintf (s, 200, argv[2], val) == -1)
+    {
+      perror ("snprintf");
+      exit (EXIT_SNPRINTF);
+    }
+
+  if (strcmp (s, argv[4]) != 0)
+    {
+      printf ("\
+locale: \"%s\", format: \"%s\", expected: \"%s\", got: \"%s\" => %s\n",
+	      argv[1], argv[2], argv[4], s,
+	      strcmp (s, argv[4]) != 0 ? "false" : "correct");
+      exit (EXIT_FAILURE);
+    }
+
+  return EXIT_SUCCESS;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/tst-numeric.data libc-20030708/localedata/tst-numeric.data
--- glibc-2.3.2/localedata/tst-numeric.data	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/tst-numeric.data	2003-04-27 18:02:25.000000000 +0900
@@ -0,0 +1,49 @@
+# Test data for tst-nomeric, which checks it's implementation in glibc
+# Copyright (C) 2003 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+# Contributed by Petter Reinholdtsen <pere@hungry.com>, 2003
+# Based on code by Jochen Hein <jochen.hein@delphi.central.de>, 1997.
+#
+
+# The GNU C Library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+
+# The GNU C Library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; if not, write to the Free
+# Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+# 02111-1307 USA.
+
+# The format of this file is pretty simple: Each line contains a test
+# for strfmon.  Fields are separated by TABs.  Lines that start with a
+# '#' are comments and are ignored.
+#
+# Field Description
+# #1    locale which is to be checked
+# #2    format string which is fed into snprintf
+# #3    double value that is used for formatting
+# #4    the expected result (may contain trailing spaces!)
+#
+# First the implementation without any locale-dependent data
+C	%g	1.23	1.23
+C	%g	-1.23	-1.23
+C	%g	0	0
+C	%%	0	%
+C	%'g	123.45	123.45
+C	%'g	-123.45	-123.45
+C	*%g*	1.23	*1.23*
+C	%9g	1.23	     1.23
+C	%9g	-1.23	    -1.23
+#
+# check both the norwegian locales and snprintf with that data
+#
+no_NO.ISO-8859-1	%'g	123.45	123,45
+no_NO.ISO-8859-1	%'g	-123.45	-123,45
+nn_NO.ISO-8859-1	%'g	123.45	123,45
+nn_NO.ISO-8859-1	%'g	-123.45	-123,45
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/localedata/tst-numeric.sh libc-20030708/localedata/tst-numeric.sh
--- glibc-2.3.2/localedata/tst-numeric.sh	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/localedata/tst-numeric.sh	2003-07-08 22:58:08.000000000 +0900
@@ -0,0 +1,51 @@
+#! /bin/sh
+# Testing the implementation of LC_NUMERIC and snprintf(3).
+# Copyright (C) 1996, 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+# Contributed by Jochen Hein <jochen.hein@delphi.central.de>, 1997.
+#
+
+# The GNU C Library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+
+# The GNU C Library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; if not, write to the Free
+# Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+# 02111-1307 USA.
+
+common_objpfx=$1
+run_program_prefix=$2
+datafile=$3
+
+# Run the tests.
+errcode=0
+# There's a TAB for IFS
+while IFS="	" read locale format value expect; do
+    case "$locale" in '#'*) continue ;; esac
+    if [ -n "$format" ]; then
+	if LOCPATH=${common_objpfx}localedata \
+	    GCONV_PATH=${common_objpfx}/iconvdata \
+	    ${run_program_prefix} ${common_objpfx}localedata/tst-numeric \
+	    "$locale" "$format" "$value" "$expect"
+	then
+	    echo "Locale: \"${locale}\" Format: \"${format}\"" \
+		 "Value: \"${value}\" Expect: \"${expect}\"  passed"
+	else
+	    errcode=$?
+	    echo "Locale: \"${locale}\" Format: \"${format}\"" \
+		 "Value: \"${value}\" Expect: \"${expect}\"    failed"
+	fi
+    fi
+done < $datafile
+
+exit $errcode
+# Local Variables:
+#  mode:shell-script
+# End:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/mach/Makefile libc-20030708/mach/Makefile
--- glibc-2.3.2/mach/Makefile	2003-02-18 03:58:01.000000000 +0900
+++ libc-20030708/mach/Makefile	2003-06-12 08:54:03.000000000 +0900
@@ -79,12 +79,17 @@
 	$(make-target-directory)
 # We must use $(CFLAGS) to get -O flags that affect #if's in header files.
 	echo '#include <mach/syscall_sw.h>' | \
-	DEPENDENCIES_OUTPUT='$@-dep $@' \
-	$(CC) $(CFLAGS) $(CPPFLAGS) -E -x c-header - \
+	$(CC) $(CFLAGS) $(CPPFLAGS) -E -MD -MP -MF $@-dep -MT $@ \
+	      -x c-header - \
 	      -D_MACH_`echo $(mach-machine) | tr a-z A-Z`_SYSCALL_SW_H_=1 | \
 	sed -n -e 's/^kernel_trap(\(.*\),\([-0-9]*\),\([0-9]*\))$$/\1 \2 \3/p'\
 	| $(AWK) -f $< > $@-new
-	cat $@-dep >> $@-new; rm -f $@-dep
+ifneq (,$(objpfx))
+	sed $(sed-remove-objpfx) $@-dep >> $@-new
+else
+	cat $@-dep >> $@-new
+endif
+	rm -f $@-dep
 	mv -f $@-new $@
 generated += mach-syscalls.mk
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/Makefile libc-20030708/malloc/Makefile
--- glibc-2.3.2/malloc/Makefile	2003-02-22 10:01:17.000000000 +0900
+++ libc-20030708/malloc/Makefile	2003-04-28 23:53:21.000000000 +0900
@@ -56,6 +56,7 @@
 
 include ../Makeconfig
 
+CFLAGS-malloc.c += -DDEFAULT_TOP_PAD=131072
 CPPFLAGS-memusagestat = -DNOT_IN_libc
 
 # The Perl script to analyze the output of the mtrace functions.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/arena.c libc-20030708/malloc/arena.c
--- glibc-2.3.2/malloc/arena.c	2002-12-28 08:22:15.000000000 +0900
+++ libc-20030708/malloc/arena.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,5 +1,5 @@
 /* Malloc implementation for multiple threads without lock contention.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Wolfram Gloger <wg@malloc.de>, 2001.
 
@@ -18,7 +18,7 @@
    write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
    Boston, MA 02111-1307, USA.  */
 
-/* $Id: arena.c,v 1.6 2002/12/27 00:36:41 roland Exp $ */
+/* $Id: arena.c,v 1.7 2003/07/01 08:27:54 drepper Exp $ */
 
 /* Compile-time constants.  */
 
@@ -758,6 +758,7 @@
   /* Add the new arena to the global list.  */
   (void)mutex_lock(&list_lock);
   a->next = main_arena.next;
+  atomic_write_barrier ();
   main_arena.next = a;
   (void)mutex_unlock(&list_lock);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/malloc.c libc-20030708/malloc/malloc.c
--- glibc-2.3.2/malloc/malloc.c	2003-01-31 03:36:54.000000000 +0900
+++ libc-20030708/malloc/malloc.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,5 +1,5 @@
-/* Malloc implementation for multiple threads without lock contention.
-   Copyright (C) 1996,1997,1998,1999,2000,01,02 Free Software Foundation, Inc.
+  /* Malloc implementation for multiple threads without lock contention.
+   Copyright (C) 1996-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Wolfram Gloger <wg@malloc.de>
    and Doug Lea <dl@cs.oswego.edu>, 2001.
@@ -24,7 +24,7 @@
   Doug Lea and adapted to multiple threads/arenas by Wolfram Gloger.
 
 * Version ptmalloc2-20011215
-  $Id: malloc.c,v 1.108 2003/01/30 18:36:54 drepper Exp $
+  $Id: malloc.c,v 1.111 2003/06/18 23:51:20 drepper Exp $
   based on:
   VERSION 2.7.0 Sun Mar 11 14:14:06 2001  Doug Lea  (dl at gee)
 
@@ -3474,6 +3474,7 @@
 	 ar_ptr == arena_for_chunk(mem2chunk(p)));
   return p;
 }
+strong_alias (public_mEMALIGn, __memalign_internal)
 
 Void_t*
 public_vALLOc(size_t bytes)
@@ -3707,6 +3708,8 @@
 {
   struct mallinfo m;
 
+  if(__malloc_initialized < 0)
+    ptmalloc_init ();
   (void)mutex_lock(&main_arena.mutex);
   m = mALLINFo(&main_arena);
   (void)mutex_unlock(&main_arena.mutex);
@@ -5089,6 +5092,8 @@
   long stat_lock_direct = 0, stat_lock_loop = 0, stat_lock_wait = 0;
 #endif
 
+  if(__malloc_initialized < 0)
+    ptmalloc_init ();
   for (i=0, ar_ptr = &main_arena;; i++) {
     (void)mutex_lock(&ar_ptr->mutex);
     mi = mALLINFo(ar_ptr);
@@ -5353,7 +5358,7 @@
   if (alignment % sizeof (void *) != 0 || !powerof2 (alignment) != 0)
     return EINVAL;
 
-  mem = __libc_memalign (alignment, size);
+  mem = __memalign_internal (alignment, size);
 
   if (mem != NULL) {
     *memptr = mem;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/malloc.h libc-20030708/malloc/malloc.h
--- glibc-2.3.2/malloc/malloc.h	2003-01-13 12:58:02.000000000 +0900
+++ libc-20030708/malloc/malloc.h	2003-06-12 08:54:03.000000000 +0900
@@ -1,5 +1,5 @@
 /* Prototypes and definition for malloc implementation.
-   Copyright (C) 1996, 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1999,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -25,7 +25,7 @@
 #endif
 
 /*
-  $Id: malloc.h,v 1.23 2003/01/13 03:42:16 roland Exp $
+  $Id: malloc.h,v 1.24 2003/05/28 21:01:42 roland Exp $
   `ptmalloc2', a malloc implementation for multiple threads without
   lock contention, by Wolfram Gloger <wg@malloc.de>.
 
@@ -85,11 +85,19 @@
 #  define __MALLOC_P(args)	args
 #  define __MALLOC_PMT(args)	args
 
+#  ifndef __const
+#   define __const	 const
+#  endif
+
 # else	/* Not ANSI C or C++.  */
 
 #  define __MALLOC_P(args)	()	/* No prototypes.  */
 #  define __MALLOC_PMT(args)	()
 
+#  ifndef __const
+#   define __const
+#  endif
+
 # endif	/* ANSI C or C++.  */
 
 #endif	/* GCC.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/memusagestat.c libc-20030708/malloc/memusagestat.c
--- glibc-2.3.2/malloc/memusagestat.c	2001-07-08 04:21:06.000000000 +0900
+++ libc-20030708/malloc/memusagestat.c	2003-03-23 08:00:25.000000000 +0900
@@ -405,7 +405,7 @@
     }
 
 
-  snprintf (buf, sizeof (buf), "%llu", total);
+  snprintf (buf, sizeof (buf), "%llu", (unsigned long long) total);
   gdImageString (im_out, gdFontSmall, xsize - 50, ysize - 14, buf, blue);
 
   if (!time_based)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/mtrace.c libc-20030708/malloc/mtrace.c
--- glibc-2.3.2/malloc/mtrace.c	2003-01-01 06:18:43.000000000 +0900
+++ libc-20030708/malloc/mtrace.c	2003-03-10 18:12:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* More debugging hooks for `malloc'.
-   Copyright (C) 1991-1994,1996-2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991-1994,1996-2001,2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 		 Written April 2, 1991 by John Gilmore of Cygnus Support.
 		 Based on mcheck.c by Mike Haertel.
@@ -103,7 +103,7 @@
     {
 #ifdef HAVE_ELF
       Dl_info info;
-      if (_dl_addr (caller, &info))
+      if (_dl_addr (caller, &info, NULL, NULL))
 	{
 	  char *buf = (char *) "";
 	  if (info.dli_sname != NULL)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/set-freeres.c libc-20030708/malloc/set-freeres.c
--- glibc-2.3.2/malloc/set-freeres.c	2002-11-02 11:15:52.000000000 +0900
+++ libc-20030708/malloc/set-freeres.c	2003-03-21 16:45:55.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997,1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -16,7 +16,7 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <atomicity.h>
+#include <atomic.h>
 #include <stdlib.h>
 #include <set-hooks.h>
 #include <libc-internal.h>
@@ -36,7 +36,7 @@
      protect for multiple executions since these are fatal.  */
   static long int already_called;
 
-  if (compare_and_swap (&already_called, 0, 1))
+  if (! atomic_compare_and_exchange_bool_acq (&already_called, 1, 0))
     {
       void * const *p;
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/malloc/thread-m.h libc-20030708/malloc/thread-m.h
--- glibc-2.3.2/malloc/thread-m.h	2003-01-01 07:12:17.000000000 +0900
+++ libc-20030708/malloc/thread-m.h	2003-07-08 22:58:08.000000000 +0900
@@ -1,6 +1,6 @@
 /* Basic platform-independent macro definitions for mutexes and
    thread-specific data.
-   Copyright (C) 1996,1997,1998,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-1998,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Wolfram Gloger <wg@malloc.de>, 2001.
 
@@ -19,7 +19,7 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-/* $Id: thread-m.h,v 1.20 2002/12/31 21:05:27 drepper Exp $
+/* $Id: thread-m.h,v 1.23 2003/07/01 08:29:43 drepper Exp $
    One out of _LIBC, USE_PTHREADS, USE_THR or USE_SPROC should be
    defined, otherwise the token NO_THREADS and dummy implementations
    of the macros will be defined.  */
@@ -31,6 +31,7 @@
 
 #if defined(_LIBC) /* The GNU C library, a special case of Posix threads */
 
+#include <atomic.h>
 #include <bits/libc-lock.h>
 
 #ifdef PTHREAD_MUTEX_INITIALIZER
@@ -306,4 +307,16 @@
 
 #endif /* defined(NO_THREADS) */
 
+#ifndef atomic_full_barrier
+# define atomic_full_barrier() __asm ("" ::: "memory")
+#endif
+
+#ifndef atomic_read_barrier
+# define atomic_read_barrier() atomic_full_barrier ()
+#endif
+
+#ifndef atomic_write_barrier
+# define atomic_write_barrier() atomic_full_barrier ()
+#endif
+
 #endif /* !defined(_THREAD_M_H) */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/math/Makefile libc-20030708/math/Makefile
--- glibc-2.3.2/math/Makefile	2003-02-21 15:03:48.000000000 +0900
+++ libc-20030708/math/Makefile	2003-07-08 22:58:08.000000000 +0900
@@ -87,7 +87,7 @@
 
 # Rules for the test suite.
 tests = test-matherr test-fenv atest-exp atest-sincos atest-exp2 basic-test \
-	test-misc test-fpucw tst-definitions test-tgmath
+	test-misc test-fpucw tst-definitions test-tgmath test-tgmath-ret
 # We do the `long double' tests only if this data type is available and
 # distinct from `double'.
 test-longdouble-yes = test-ldouble test-ildoubl
@@ -126,6 +126,7 @@
 CFLAGS-test-double.c = -fno-inline -ffloat-store
 CFLAGS-test-ldouble.c = -fno-inline -ffloat-store
 CFLAGS-test-tgmath.c = -fno-builtin
+CFLAGS-test-tgmath-ret.c = -fno-builtin
 CPPFLAGS-test-ifloat.c = -U__LIBC_INTERNAL_MATH_INLINES -D__FAST_MATH__ \
 			 -DTEST_FAST_MATH
 CPPFLAGS-test-idouble.c = -U__LIBC_INTERNAL_MATH_INLINES -D__FAST_MATH__ \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/math/libm-test.inc libc-20030708/math/libm-test.inc
--- glibc-2.3.2/math/libm-test.inc	2003-02-15 15:55:23.000000000 +0900
+++ libc-20030708/math/libm-test.inc	2003-03-22 15:13:35.000000000 +0900
@@ -1537,7 +1537,7 @@
   TEST_c_c (ccos, nan_value, nan_value, nan_value, nan_value);
 
   TEST_c_c (ccos, 0.75L, 1.25L, 1.38173873063425888530729933139078645L, -1.09193013555397466170919531722024128L);
-  TEST_c_c (ccos, -2, -3, -4.1896256909688072301L, -9.1092278937553365979L);
+  TEST_c_c (ccos, -2, -3, -4.18962569096880723013255501961597373L, -9.10922789375533659797919726277886212L);
 
   END (ccos, complex);
 }
@@ -1606,7 +1606,7 @@
 
   TEST_c_c (ccosh, 0.75L, 1.25L, 0.408242591877968807788852146397499084L, 0.780365930845853240391326216300863152L);
 
-  TEST_c_c (ccosh, -2, -3, -3.7245455049153225654L, 0.5118225699873846088L);
+  TEST_c_c (ccosh, -2, -3, -3.72454550491532256547397070325597253L, 0.511822569987384608834463849801875634L);
 
   END (ccosh, complex);
 }
@@ -1836,7 +1836,7 @@
   TEST_c_c (clog10, nan_value, nan_value, nan_value, nan_value);
 
   TEST_c_c (clog10, 0.75L, 1.25L, 0.163679467193165171449476605077428975L, 0.447486970040493067069984724340855636L);
-  TEST_c_c (clog10, -2, -3, 0.5569716761534183846L, -0.9375544629863747085L);
+  TEST_c_c (clog10, -2, -3, 0.556971676153418384603252578971164214L, -0.937554462986374708541507952140189646L);
 
   END (clog10, complex);
 }
@@ -2072,7 +2072,7 @@
   TEST_c_c (csin, nan_value, nan_value, nan_value, nan_value);
 
   TEST_c_c (csin, 0.75L, 1.25L, 1.28722291002649188575873510790565441L, 1.17210635989270256101081285116138863L);
-  TEST_c_c (csin, -2, -3, -9.1544991469114295734L, 4.1689069599665643507L);
+  TEST_c_c (csin, -2, -3, -9.15449914691142957346729954460983256L, 4.16890695996656435075481305885375484L);
 
   END (csin, complex);
 }
@@ -2140,7 +2140,7 @@
   TEST_c_c (csinh, nan_value, nan_value, nan_value, nan_value);
 
   TEST_c_c (csinh, 0.75L, 1.25L, 0.259294854551162779153349830618433028L, 1.22863452409509552219214606515777594L);
-  TEST_c_c (csinh, -2, -3, 3.5905645899857799520L, -0.5309210862485198052L);
+  TEST_c_c (csinh, -2, -3, 3.59056458998577995201256544779481679L, -0.530921086248519805267040090660676560L);
 
   END (csinh, complex);
 }
@@ -2264,7 +2264,7 @@
   TEST_c_c (ctan, nan_value, nan_value, nan_value, nan_value);
 
   TEST_c_c (ctan, 0.75L, 1.25L, 0.160807785916206426725166058173438663L, 0.975363285031235646193581759755216379L);
-  TEST_c_c (ctan, -2, -3, 0.0037640256415042482L, -1.0032386273536098014L);
+  TEST_c_c (ctan, -2, -3, 0.376402564150424829275122113032269084e-2L, -1.00323862735360980144635859782192726L);
 
   END (ctan, complex);
 }
@@ -2323,7 +2323,7 @@
   TEST_c_c (ctanh, 0, M_PI_4l, 0.0, 1.0);
 
   TEST_c_c (ctanh, 0.75L, 1.25L, 1.37260757053378320258048606571226857L, 0.385795952609750664177596760720790220L);
-  TEST_c_c (ctanh, -2, -3, -0.9653858790221331242L, 0.0098843750383224937L);
+  TEST_c_c (ctanh, -2, -3, -0.965385879022133124278480269394560686L, 0.988437503832249372031403430350121098e-2L);
 
   END (ctanh, complex);
 }
@@ -3067,8 +3067,8 @@
 
   TEST_f_f1 (lgamma, 0.5, M_LOG_SQRT_PIl, 1);
   TEST_f_f1 (lgamma, -0.5, M_LOG_2_SQRT_PIl, -1);
-  TEST_f_f1 (lgamma, 0.7L, 0.26086724653166651439L, 1);
-  TEST_f_f1 (lgamma, 1.2L, -0.853740900033158497197e-1L, 1);
+  TEST_f_f1 (lgamma, 0.7L, 0.260867246531666514385732417016759578L, 1);
+  TEST_f_f1 (lgamma, 1.2L, -0.853740900033158497197028392998854470e-1L, 1);
 
   END (lgamma);
 }
@@ -4078,8 +4078,8 @@
   TEST_f_f (tgamma, 1, 1);
   TEST_f_f (tgamma, 4, 6);
 
-  TEST_f_f (tgamma, 0.7L, 1.29805533264755778568L);
-  TEST_f_f (tgamma, 1.2L, 0.91816874239976061064L);
+  TEST_f_f (tgamma, 0.7L, 1.29805533264755778568117117915281162L);
+  TEST_f_f (tgamma, 1.2L, 0.918168742399760610640951655185830401L);
 
   END (tgamma);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/math/test-fenv.c libc-20030708/math/test-fenv.c
--- glibc-2.3.2/math/test-fenv.c	2001-07-08 04:21:06.000000000 +0900
+++ libc-20030708/math/test-fenv.c	2003-06-12 08:54:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de> and
    Ulrich Drepper <drepper@cygnus.com>, 1997.
@@ -350,7 +350,8 @@
   int status;
   pid_t pid;
 
-  printf ("Test: after fedisable (%s) processes will abort\n", flag_name);
+  printf ("Test: after fedisableexcept (%s) processes will abort\n",
+	  flag_name);
   printf ("      when feraiseexcept (%s) is called.\n", flag_name);
   pid = fork ();
   if (pid == 0)
@@ -403,7 +404,8 @@
   int exception;
   pid_t pid;
 
-  printf ("Test: after fedisable (%s) processes will not abort\n", flag_name);
+  printf ("Test: after fedisableexcept (%s) processes will not abort\n",
+	  flag_name);
   printf ("      when feraiseexcept (%s) is called.\n", flag_name);
   pid = fork ();
   if (pid == 0)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/math/test-tgmath-ret.c libc-20030708/math/test-tgmath-ret.c
--- glibc-2.3.2/math/test-tgmath-ret.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/math/test-tgmath-ret.c	2003-06-16 16:52:41.000000000 +0900
@@ -0,0 +1,85 @@
+/* Test compilation of tgmath macros.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Andreas Jaeger <aj@suse.de>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <math.h>
+#include <complex.h>
+#include <tgmath.h>
+#include <stdio.h>
+
+static float fx;
+static double dx;
+static long double lx;
+static int errors = 0;
+
+static void
+our_error (const char *c)
+{
+  puts (c);
+  ++errors;
+}
+
+/* First function where the return type is constant.  */
+
+#define CHECK_RET_CONST_TYPE(func, rettype, arg, name) \
+  if (sizeof (func (arg)) != sizeof (rettype))				      \
+    our_error ("Return size of " #func " is wrong with " #name " argument");
+
+#define CHECK_RET_CONST_FLOAT(func, rettype) \
+  CHECK_RET_CONST_TYPE (func, rettype, fx, float)
+#define CHECK_RET_CONST_DOUBLE(func, rettype) \
+  CHECK_RET_CONST_TYPE (func, rettype, dx, double)
+#ifdef NO_LONG_DOUBLE
+# define CHECK_RET_CONST_LDOUBLE(func, rettype)
+#else
+# define CHECK_RET_CONST_LDOUBLE(func, rettype) \
+  CHECK_RET_CONST_TYPE (func, rettype, lx, long double)
+#endif
+
+#define CHECK_RET_CONST(func, rettype) \
+static void								      \
+check_return_ ##func (void)						      \
+{									      \
+  CHECK_RET_CONST_FLOAT (func, rettype)					      \
+  CHECK_RET_CONST_DOUBLE (func, rettype)				      \
+  CHECK_RET_CONST_LDOUBLE (func, rettype)				      \
+}
+
+CHECK_RET_CONST(ilogb, int)
+CHECK_RET_CONST(lrint, long)
+CHECK_RET_CONST(lround, long)
+CHECK_RET_CONST(llrint, long long)
+CHECK_RET_CONST(llround, long long)
+
+static int
+do_test (void)
+{
+  check_return_ilogb ();
+  check_return_lrint ();
+  check_return_lround ();
+  check_return_llrint ();
+  check_return_llround ();
+
+  printf ("%Zd\n", sizeof(carg (lx)));
+
+  return errors != 0;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/math/test-tgmath.c libc-20030708/math/test-tgmath.c
--- glibc-2.3.2/math/test-tgmath.c	2001-07-08 04:21:06.000000000 +0900
+++ libc-20030708/math/test-tgmath.c	2003-04-15 23:55:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test compilation of tgmath macros.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jakub@redhat.com> and
    Ulrich Drepper <drepper@redhat.com>, 2001.
@@ -162,7 +162,7 @@
 static void
 F(compile_test) (void)
 {
-  TYPE a, b, c;
+  TYPE a, b, c = 1.0;
   int i;
   long int j;
   long long int k;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/math/tgmath.h libc-20030708/math/tgmath.h
--- glibc-2.3.2/math/tgmath.h	2001-07-08 04:21:06.000000000 +0900
+++ libc-20030708/math/tgmath.h	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 1999, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -70,7 +70,18 @@
 			 __tgmres = Fct (Val);				      \
 		       else if (sizeof (Val) == sizeof (float))		      \
 			 __tgmres = Fct##f (Val);			      \
-		       else 						      \
+		       else						      \
+			 __tgmres = __tgml(Fct) (Val);			      \
+		       __tgmres; }))
+
+# define __TGMATH_UNARY_REAL_RET_ONLY(Val, RetType, Fct) \
+     (__extension__ ({ RetType __tgmres;				      \
+		       if (sizeof (Val) == sizeof (double)		      \
+			   || __builtin_classify_type (Val) != 8)	      \
+			 __tgmres = Fct (Val);				      \
+		       else if (sizeof (Val) == sizeof (float))		      \
+			 __tgmres = Fct##f (Val);			      \
+		       else						      \
 			 __tgmres = __tgml(Fct) (Val);			      \
 		       __tgmres; }))
 
@@ -81,7 +92,7 @@
 			 __tgmres = Fct (Val1, Val2);			      \
 		       else if (sizeof (Val1) == sizeof (float))	      \
 			 __tgmres = Fct##f (Val1, Val2);		      \
-		       else 						      \
+		       else						      \
 			 __tgmres = __tgml(Fct) (Val1, Val2);		      \
 		       __tgmres; }))
 
@@ -155,7 +166,7 @@
 			   else						      \
 			     __tgmres = Cfct (Val);			      \
 			 }						      \
-		       else 						      \
+		       else						      \
 			 {						      \
 			   if (sizeof (__real__ (Val)) == sizeof (Val))	      \
 			     __tgmres = Fct##f (Val);			      \
@@ -166,19 +177,6 @@
 
 /* XXX This definition has to be changed as soon as the compiler understands
    the imaginary keyword.  */
-# define __TGMATH_UNARY_IMAG_ONLY(Val, Fct) \
-     (__extension__ ({ __tgmath_real_type (Val) __tgmres;		      \
-		       if (sizeof (Val) == sizeof (__complex__ double)	      \
-			   || __builtin_classify_type (__real__ (Val)) != 8)  \
-			 __tgmres = Fct (Val);				      \
-		       else if (sizeof (Val) == sizeof (__complex__ float))   \
-			 __tgmres = Fct##f (Val);			      \
-		       else 						      \
-			 __tgmres = __tgml(Fct) (Val);			      \
-		       __tgmres; }))
-
-/* XXX This definition has to be changed as soon as the compiler understands
-   the imaginary keyword.  */
 # define __TGMATH_BINARY_REAL_IMAG(Val1, Val2, Fct, Cfct) \
      (__extension__ ({ __tgmath_real_type ((Val1) + (Val2)) __tgmres;	      \
 		       if ((sizeof (__real__ (Val1)) > sizeof (double)	      \
@@ -345,13 +343,13 @@
 
 /* Round X to nearest integral value according to current rounding
    direction.  */
-#define lrint(Val) __TGMATH_UNARY_REAL_ONLY (Val, lrint)
-#define llrint(Val) __TGMATH_UNARY_REAL_ONLY (Val, llrint)
+#define lrint(Val) __TGMATH_UNARY_REAL_RET_ONLY (Val, long int, lrint)
+#define llrint(Val) __TGMATH_UNARY_REAL_RET_ONLY (Val, long long int, llrint)
 
 /* Round X to nearest integral value, rounding halfway cases away from
    zero.  */
-#define lround(Val) __TGMATH_UNARY_REAL_ONLY (Val, lround)
-#define llround(Val) __TGMATH_UNARY_REAL_ONLY (Val, llround)
+#define lround(Val) __TGMATH_UNARY_REAL_RET_ONLY (Val, long int, lround)
+#define llround(Val) __TGMATH_UNARY_REAL_RET_ONLY (Val, long long int, llround)
 
 
 /* Return X with its signed changed to Y's.  */
@@ -389,7 +387,7 @@
      __TGMATH_BINARY_FIRST_REAL_ONLY (Val1, Val2, scalbln)
 
 /* Return the binary exponent of X, which must be nonzero.  */
-#define ilogb(Val) __TGMATH_UNARY_REAL_ONLY (Val, ilogb)
+#define ilogb(Val) __TGMATH_UNARY_REAL_RET_ONLY (Val, int, ilogb)
 
 
 /* Return positive difference between X and Y.  */
@@ -410,21 +408,21 @@
 /* Absolute value, conjugates, and projection.  */
 
 /* Argument value of Z.  */
-#define carg(Val) __TGMATH_UNARY_IMAG_ONLY (Val, carg)
+#define carg(Val) __TGMATH_UNARY_REAL_IMAG (Val, carg, carg)
 
 /* Complex conjugate of Z.  */
-#define conj(Val) __TGMATH_UNARY_IMAG_ONLY (Val, conj)
+#define conj(Val) __TGMATH_UNARY_REAL_IMAG (Val, conj, conj)
 
 /* Projection of Z onto the Riemann sphere.  */
-#define cproj(Val) __TGMATH_UNARY_IMAG_ONLY (Val, cproj)
+#define cproj(Val) __TGMATH_UNARY_REAL_IMAG (Val, cproj, cproj)
 
 
 /* Decomposing complex values.  */
 
 /* Imaginary part of Z.  */
-#define cimag(Val) __TGMATH_UNARY_IMAG_ONLY (Val, cimag)
+#define cimag(Val) __TGMATH_UNARY_REAL_IMAG (Val, cimag, cimag)
 
 /* Real part of Z.  */
-#define creal(Val) __TGMATH_UNARY_IMAG_ONLY (Val, creal)
+#define creal(Val) __TGMATH_UNARY_REAL_IMAG (Val, creal, creal)
 
 #endif /* tgmath.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/misc/Makefile libc-20030708/misc/Makefile
--- glibc-2.3.2/misc/Makefile	2002-08-27 13:52:37.000000000 +0900
+++ libc-20030708/misc/Makefile	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1991-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1991-2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -52,7 +52,7 @@
 	    chflags fchflags \
 	    insremque getttyent getusershell getpass ttyslot \
 	    syslog syscall daemon \
-	    mmap mmap64 munmap mprotect msync madvise mincore \
+	    mmap mmap64 munmap mprotect msync madvise mincore remap_file_pages\
 	    mlock munlock mlockall munlockall \
 	    efgcvt efgcvt_r qefgcvt qefgcvt_r \
 	    hsearch hsearch_r tsearch lsearch \
@@ -77,6 +77,10 @@
 
 CFLAGS-tsearch.c = $(exceptions)
 CFLAGS-lsearch.c = $(exceptions)
+CFLAGS-pselect.c = -fexceptions
+CFLAGS-readv.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-writev.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-usleep.c = -fexceptions
 
 include ../Rules
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/misc/Versions libc-20030708/misc/Versions
--- glibc-2.3.2/misc/Versions	2002-12-19 07:49:52.000000000 +0900
+++ libc-20030708/misc/Versions	2003-03-03 18:47:42.000000000 +0900
@@ -127,6 +127,9 @@
     # s*
     setxattr;
   }
+  GLIBC_2.3.3 {
+    remap_file_pages;
+  }
   GLIBC_PRIVATE {
     # functions which have an additional interface since they are
     # cancelable.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/misc/daemon.c libc-20030708/misc/daemon.c
--- glibc-2.3.2/misc/daemon.c	2002-04-08 16:02:09.000000000 +0900
+++ libc-20030708/misc/daemon.c	2003-04-28 23:53:22.000000000 +0900
@@ -31,12 +31,14 @@
 static char sccsid[] = "@(#)daemon.c	8.1 (Berkeley) 6/4/93";
 #endif /* LIBC_SCCS and not lint */
 
+#include <errno.h>
 #include <fcntl.h>
 #include <paths.h>
 #include <unistd.h>
 #include <sys/stat.h>
 
 #include <device-nrs.h>
+#include <not-cancel.h>
 
 int
 daemon(nochdir, noclose)
@@ -59,7 +61,8 @@
 	if (!nochdir)
 		(void)__chdir("/");
 
-	if (!noclose && (fd = __open(_PATH_DEVNULL, O_RDWR, 0)) != -1) {
+	if (!noclose
+	    && (fd = open_not_cancel(_PATH_DEVNULL, O_RDWR, 0)) != -1) {
 		struct stat64 st;
 
 		if (__builtin_expect (__fxstat64 (_STAT_VER, fd, &st), 0) == 0
@@ -74,7 +77,7 @@
 			if (fd > 2)
 				(void)__close (fd);
 		} else {
-			(void)__close (fd);
+			close_not_cancel_no_status (fd);
 			return -1;
 		}
 	}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/misc/sys/mman.h libc-20030708/misc/sys/mman.h
--- glibc-2.3.2/misc/sys/mman.h	2001-07-08 04:21:06.000000000 +0900
+++ libc-20030708/misc/sys/mman.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for BSD-style memory management.
-   Copyright (C) 1994-1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994-1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -83,8 +83,11 @@
 
 /* Synchronize the region starting at ADDR and extending LEN bytes with the
    file it maps.  Filesystem operations on a file being mapped are
-   unpredictable before this is done.  Flags are from the MS_* set.  */
-extern int msync (void *__addr, size_t __len, int __flags) __THROW;
+   unpredictable before this is done.  Flags are from the MS_* set.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int msync (void *__addr, size_t __len, int __flags);
 
 #ifdef __USE_BSD
 /* Advise the system about particular usage patterns the program follows
@@ -124,7 +127,13 @@
    The status is returned in a vector of bytes.  The least significant
    bit of each byte is 1 if the referenced page is in memory, otherwise
    it is zero.  */
-extern int mincore (void *__start, size_t __len, unsigned char *__vec);
+extern int mincore (void *__start, size_t __len, unsigned char *__vec)
+     __THROW;
+
+/* Remap arbitrary pages of a shared backing store within an existing
+   VMA.  */
+extern int remap_file_pages (void *__start, size_t __size, int __prot,
+			     size_t __pgoff, int __flags) __THROW;
 #endif
 
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/misc/sys/select.h libc-20030708/misc/sys/select.h
--- glibc-2.3.2/misc/sys/select.h	2002-08-02 14:00:55.000000000 +0900
+++ libc-20030708/misc/sys/select.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,5 +1,5 @@
 /* `fd_set' type and related macros, and `select'/`pselect' declarations.
-   Copyright (C) 1996,97,98,99,2000,01,02 Free Software Foundation, Inc.
+   Copyright (C) 1996,97,98,99,2000,01,02,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -102,21 +102,27 @@
    readiness, in WRITEFDS (if not NULL) for write readiness, and in EXCEPTFDS
    (if not NULL) for exceptional conditions.  If TIMEOUT is not NULL, time out
    after waiting the interval specified therein.  Returns the number of ready
-   descriptors, or -1 for errors.  */
+   descriptors, or -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int select (int __nfds, fd_set *__restrict __readfds,
 		   fd_set *__restrict __writefds,
 		   fd_set *__restrict __exceptfds,
-		   struct timeval *__restrict __timeout) __THROW;
+		   struct timeval *__restrict __timeout);
 
 #ifdef __USE_XOPEN2K
 /* Same as above only that the TIMEOUT value is given with higher
    resolution and a sigmask which is been set temporarily.  This version
-   should be used.  */
+   should be used.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int pselect (int __nfds, fd_set *__restrict __readfds,
 		    fd_set *__restrict __writefds,
 		    fd_set *__restrict __exceptfds,
 		    const struct timespec *__restrict __timeout,
-		    const __sigset_t *__restrict __sigmask) __THROW;
+		    const __sigset_t *__restrict __sigmask);
 #endif
 
 __END_DECLS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/misc/sys/syslog.h libc-20030708/misc/sys/syslog.h
--- glibc-2.3.2/misc/sys/syslog.h	2000-12-09 02:05:25.000000000 +0900
+++ libc-20030708/misc/sys/syslog.h	2003-04-28 23:53:22.000000000 +0900
@@ -168,22 +168,35 @@
 
 __BEGIN_DECLS
 
-/* Close desriptor used to write to system logger.  */
-extern void closelog (void) __THROW;
+/* Close desriptor used to write to system logger.
 
-/* Open connection to system logger.  */
-extern void openlog (__const char *__ident, int __option, int __facility)
-     __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void closelog (void);
+
+/* Open connection to system logger.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void openlog (__const char *__ident, int __option, int __facility);
 
 /* Set the log mask level.  */
 extern int setlogmask (int __mask) __THROW;
 
-/* Generate a log message using FMT string and option arguments.  */
-extern void syslog (int __pri, __const char *__fmt, ...) __THROW
+/* Generate a log message using FMT string and option arguments.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void syslog (int __pri, __const char *__fmt, ...)
      __attribute__ ((__format__(__printf__, 2, 3)));
 
 #ifdef __USE_BSD
-/* Generate a log message using FMT and using arguments pointed to by AP.  */
+/* Generate a log message using FMT and using arguments pointed to by AP.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern void vsyslog (int __pri, __const char *__fmt, __gnuc_va_list __ap)
      __THROW __attribute__ ((__format__(__printf__, 2, 0)));
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/misc/sys/uio.h libc-20030708/misc/sys/uio.h
--- glibc-2.3.2/misc/sys/uio.h	2001-07-08 04:21:06.000000000 +0900
+++ libc-20030708/misc/sys/uio.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 92, 96, 97, 98, 99 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 92, 96, 97, 98, 99, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,17 +33,21 @@
    buffers described by VECTOR, which is a vector of COUNT `struct iovec's.
    The buffers are filled in the order specified.
    Operates just like `read' (see <unistd.h>) except that data are
-   put in VECTOR instead of a contiguous buffer.  */
-extern ssize_t readv (int __fd, __const struct iovec *__vector, int __count)
-     __THROW;
+   put in VECTOR instead of a contiguous buffer.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t readv (int __fd, __const struct iovec *__vector, int __count);
 
 /* Write data pointed by the buffers described by VECTOR, which
    is a vector of COUNT `struct iovec's, to file descriptor FD.
    The data is written in the order specified.
    Operates just like `write' (see <unistd.h>) except that the data
-   are taken from VECTOR instead of a contiguous buffer.  */
-extern ssize_t writev (int __fd, __const struct iovec *__vector, int __count)
-     __THROW;
+   are taken from VECTOR instead of a contiguous buffer.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t writev (int __fd, __const struct iovec *__vector, int __count);
 
 __END_DECLS
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/Makefile libc-20030708/nis/Makefile
--- glibc-2.3.2/nis/Makefile	2002-04-10 02:33:04.000000000 +0900
+++ libc-20030708/nis/Makefile	2003-07-08 22:58:08.000000000 +0900
@@ -54,8 +54,7 @@
 		  nis_findserv nis_callback nis_clone_dir nis_clone_obj\
 		  nis_clone_res
 
-libnss_compat-routines	:= $(addprefix compat-,grp pwd spwd initgroups) \
-			   nisplus-parser nss-nis nss-nisplus
+libnss_compat-routines	:= $(addprefix compat-,grp pwd spwd initgroups)
 libnss_compat-inhibit-o	= $(filter-out .os,$(object-suffixes))
 
 libnss_nis-routines	:= $(addprefix nis-,$(databases)) nis-initgroups \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nis_table.c libc-20030708/nis/nis_table.c
--- glibc-2.3.2/nis/nis_table.c	2001-07-08 04:21:06.000000000 +0900
+++ libc-20030708/nis/nis_table.c	2003-03-16 12:36:21.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (c) 1997, 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (c) 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1997.
 
@@ -30,7 +30,7 @@
   struct ib_request *ibreq = calloc (1, sizeof (ib_request));
   char buf[strlen (name) + 1];
   nis_attr *search_val = NULL;
-  int search_len = 0;
+  size_t search_len = 0;
   char *cptr;
   size_t size = 0;
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_compat/compat-grp.c libc-20030708/nis/nss_compat/compat-grp.c
--- glibc-2.3.2/nis/nss_compat/compat-grp.c	2002-08-26 14:04:55.000000000 +0900
+++ libc-20030708/nis/nss_compat/compat-grp.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996,1997,1998,1999,2001,2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1996.
 
@@ -17,25 +17,28 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <ctype.h>
 #include <errno.h>
 #include <fcntl.h>
-#include <nss.h>
 #include <grp.h>
-#include <ctype.h>
-#include <bits/libc-lock.h>
-#include <string.h>
-#include <rpcsvc/yp.h>
-#include <rpcsvc/ypclnt.h>
-#include <rpcsvc/nis.h>
+#include <nss.h>
 #include <nsswitch.h>
-
-#include "nss-nisplus.h"
-#include "nisplus-parser.h"
+#include <stdio_ext.h>
+#include <string.h>
+#include <rpc/types.h>
+#include <bits/libc-lock.h>
 
 static service_user *ni;
-static bool_t use_nisplus; /* default: group_compat: nis */
-static nis_name grptable; /* Name of the group table */
-static size_t grptablelen;
+static enum nss_status (*nss_setgrent) (int stayopen);
+static enum nss_status (*nss_getgrnam_r) (const char *name,
+					  struct group * grp, char *buffer,
+					  size_t buflen, int *errnop);
+static enum nss_status (*nss_getgrgid_r) (gid_t gid, struct group * grp,
+					  char *buffer, size_t buflen,
+					  int *errnop);
+static enum nss_status (*nss_getgrent_r) (struct group * grp, char *buffer,
+					  size_t buflen, int *errnop);
+static enum nss_status (*nss_endgrent) (void);
 
 /* Get the declaration of the parser function.  */
 #define ENTNAME grent
@@ -47,25 +50,21 @@
 #define BLACKLIST_INITIAL_SIZE 512
 #define BLACKLIST_INCREMENT 256
 struct blacklist_t
-  {
-    char *data;
-    int current;
-    int size;
-  };
+{
+  char *data;
+  int current;
+  int size;
+};
 
 struct ent_t
-  {
-    bool_t nis;
-    bool_t nis_first;
-    char *oldkey;
-    int oldkeylen;
-    nis_result *result;
-    FILE *stream;
-    struct blacklist_t blacklist;
+{
+  bool_t files;
+  FILE *stream;
+  struct blacklist_t blacklist;
 };
 typedef struct ent_t ent_t;
 
-static ent_t ext_ent = {0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0}};
+static ent_t ext_ent = {TRUE, NULL, {NULL, 0, 0}};
 
 /* Protect global state against multiple changers.  */
 __libc_lock_define_initialized (static, lock)
@@ -74,56 +73,27 @@
 static void blacklist_store_name (const char *, ent_t *);
 static int in_blacklist (const char *, int, ent_t *);
 
-static enum nss_status
-_nss_first_init (void)
+/* Initialize the NSS interface/functions. The calling function must
+   hold the lock.  */
+static void
+init_nss_interface (void)
 {
-  if (ni == NULL)
-    {
-      __nss_database_lookup ("group_compat", NULL, "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
-
-  if (grptable == NULL)
+  if (__nss_database_lookup ("group_compat", NULL, "nis", &ni) >= 0)
     {
-      static const char key[] = "group.org_dir.";
-      const char *local_dir = nis_local_directory ();
-      size_t len_local_dir = strlen (local_dir);
-
-      grptable = malloc (sizeof (key) + len_local_dir);
-      if (grptable == NULL)
-        return NSS_STATUS_TRYAGAIN;
-
-      grptablelen = ((char *) mempcpy (mempcpy (grptable,
-						key, sizeof (key) - 1),
-				       local_dir, len_local_dir + 1)
-		     - grptable) - 1;
+      nss_setgrent = __nss_lookup_function (ni, "setgrent");
+      nss_getgrnam_r = __nss_lookup_function (ni, "getgrnam_r");
+      nss_getgrgid_r = __nss_lookup_function (ni, "getgrgid_r");
+      nss_getgrent_r = __nss_lookup_function (ni, "getgrent_r");
+      nss_endgrent = __nss_lookup_function (ni, "endgrent");
     }
-
-  return NSS_STATUS_SUCCESS;
 }
 
 static enum nss_status
-internal_setgrent (ent_t *ent)
+internal_setgrent (ent_t *ent, int stayopen)
 {
   enum nss_status status = NSS_STATUS_SUCCESS;
 
-  ent->nis = ent->nis_first = 0;
-
-  if (_nss_first_init () != NSS_STATUS_SUCCESS)
-    return NSS_STATUS_UNAVAIL;
-
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
-
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
+  ent->files = TRUE;
 
   if (ent->blacklist.data != NULL)
     {
@@ -136,7 +106,7 @@
 
   if (ent->stream == NULL)
     {
-      ent->stream = fopen ("/etc/group", "r");
+      ent->stream = fopen ("/etc/group", "rm");
 
       if (ent->stream == NULL)
 	status = errno == EAGAIN ? NSS_STATUS_TRYAGAIN : NSS_STATUS_UNAVAIL;
@@ -145,25 +115,31 @@
 	  /* We have to make sure the file is  `closed on exec'.  */
 	  int result, flags;
 
-	  result = flags = fcntl (fileno (ent->stream), F_GETFD, 0);
+	  result = flags = fcntl (fileno_unlocked (ent->stream), F_GETFD, 0);
 	  if (result >= 0)
 	    {
 	      flags |= FD_CLOEXEC;
-	      result = fcntl (fileno (ent->stream), F_SETFD, flags);
+	      result = fcntl (fileno_unlocked (ent->stream), F_SETFD, flags);
 	    }
 	  if (result < 0)
 	    {
 	      /* Something went wrong.  Close the stream and return a
-		 failure.  */
+	         failure.  */
 	      fclose (ent->stream);
 	      ent->stream = NULL;
 	      status = NSS_STATUS_UNAVAIL;
 	    }
+	  else
+	    /* We take care of locking ourself.  */
+	    __fsetlocking (ent->stream, FSETLOCKING_BYCALLER);
 	}
     }
   else
     rewind (ent->stream);
 
+  if (status == NSS_STATUS_SUCCESS && nss_setgrent)
+    return nss_setgrent (stayopen);
+
   return status;
 }
 
@@ -175,7 +151,10 @@
 
   __libc_lock_lock (lock);
 
-  result = internal_setgrent (&ext_ent);
+  if (ni == NULL)
+    init_nss_interface ();
+
+  result = internal_setgrent (&ext_ent, stayopen);
 
   __libc_lock_unlock (lock);
 
@@ -186,27 +165,15 @@
 static enum nss_status
 internal_endgrent (ent_t *ent)
 {
+  if (nss_endgrent)
+    nss_endgrent ();
+
   if (ent->stream != NULL)
     {
       fclose (ent->stream);
       ent->stream = NULL;
     }
 
-  ent->nis = ent->nis_first = 0;
-
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
-
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
-
   if (ent->blacklist.data != NULL)
     {
       ent->blacklist.current = 1;
@@ -233,239 +200,44 @@
   return result;
 }
 
+/* get the next group from NSS  (+ entry) */
 static enum nss_status
-getgrent_next_nis (struct group *result, ent_t *ent, char *buffer,
+getgrent_next_nss (struct group *result, ent_t *ent, char *buffer,
 		   size_t buflen, int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
-  char *domain;
-  char *outkey, *outval;
-  int outkeylen, outvallen, parse_res;
-  char *p;
-
-  if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-    {
-      ent->nis = 0;
-      return NSS_STATUS_NOTFOUND;
-    }
+  if (!nss_getgrent_r)
+    return NSS_STATUS_UNAVAIL;
 
   do
     {
-      char *save_oldkey;
-      int save_oldlen;
-      bool_t save_nis_first;
+      enum nss_status status;
 
-      if (ent->nis_first)
-	{
-	  if (yp_first (domain, "group.byname", &outkey, &outkeylen,
-			&outval, &outvallen) != YPERR_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      return NSS_STATUS_UNAVAIL;
-	    }
-
-	  if ( buflen < ((size_t) outvallen + 1))
-	    {
-	      free (outval);
-	      *errnop = ERANGE;
-	      return NSS_STATUS_TRYAGAIN;
-	    }
-
-	  save_oldkey = ent->oldkey;
-	  save_oldlen = ent->oldkeylen;
-	  save_nis_first = TRUE;
-	  ent->oldkey = outkey;
-	  ent->oldkeylen = outkeylen;
-	  ent->nis_first = FALSE;
-	}
-      else
-	{
-	  if (yp_next (domain, "group.byname", ent->oldkey, ent->oldkeylen,
-		       &outkey, &outkeylen, &outval, &outvallen)
-	      != YPERR_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      return NSS_STATUS_NOTFOUND;
-	    }
-
-	  if ( buflen < ((size_t) outvallen + 1))
-	    {
-	      free (outval);
-	      *errnop = ERANGE;
-	      return NSS_STATUS_TRYAGAIN;
-	    }
-
-	  save_oldkey = ent->oldkey;
-	  save_oldlen = ent->oldkeylen;
-	  save_nis_first = FALSE;
-	  ent->oldkey = outkey;
-	  ent->oldkeylen = outkeylen;
-	}
-
-      /* Copy the found data to our buffer...  */
-      p = strncpy (buffer, outval, buflen);
-
-      /* ...and free the data.  */
-      free (outval);
-
-      while (isspace (*p))
-	++p;
-
-      parse_res = _nss_files_parse_grent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  free (ent->oldkey);
-	  ent->oldkey = save_oldkey;
-	  ent->oldkeylen = save_oldlen;
-	  ent->nis_first = save_nis_first;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      else
-	{
-	  if (!save_nis_first)
-	    free (save_oldkey);
-	}
-
-      if (parse_res &&
-	  in_blacklist (result->gr_name, strlen (result->gr_name), ent))
-	parse_res = 0; /* if result->gr_name in blacklist,search next entry */
+      if ((status = nss_getgrent_r (result, buffer, buflen, errnop)) !=
+	  NSS_STATUS_SUCCESS)
+	return status;
     }
-  while (!parse_res);
-
-  return NSS_STATUS_SUCCESS;
-}
-
-static enum nss_status
-getgrent_next_nisplus (struct group *result, ent_t *ent, char *buffer,
-                       size_t buflen, int *errnop)
-{
-  int parse_res;
-
-  do
-    {
-      nis_result *save_oldres;
-      bool_t save_nis_first;
-
-      if (ent->nis_first)
-        {
-	  save_oldres = ent->result;
-	  save_nis_first = TRUE;
-          ent->result = nis_first_entry(grptable);
-          if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-            {
-              ent->nis = 0;
-              return niserr2nss (ent->result->status);
-            }
-          ent->nis_first = FALSE;
-        }
-      else
-        {
-          nis_result *res;
-
-	  save_oldres = ent->result;
-	  save_nis_first = FALSE;
-          res = nis_next_entry(grptable, &ent->result->cookie);
-          ent->result = res;
-          if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-            {
-	      ent->nis = 0;
-	      return niserr2nss (ent->result->status);
-            }
-        }
-      parse_res = _nss_nisplus_parse_grent (ent->result, 0, result,
-					    buffer, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  nis_freeresult (ent->result);
-	  ent->result = save_oldres;
-	  ent->nis_first = save_nis_first;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      else
-	{
-	  if (!save_nis_first)
-	    nis_freeresult (save_oldres);
-	}
-
-      if (parse_res &&
-          in_blacklist (result->gr_name, strlen (result->gr_name), ent))
-        parse_res = 0; /* if result->gr_name in blacklist,search next entry */
-    }
-  while (!parse_res);
+  while (in_blacklist (result->gr_name, strlen (result->gr_name), ent));
 
   return NSS_STATUS_SUCCESS;
 }
 
 /* This function handle the +group entrys in /etc/group */
 static enum nss_status
-getgrnam_plusgroup (const char *name, struct group *result, char *buffer,
-		    size_t buflen, int *errnop)
+getgrnam_plusgroup (const char *name, struct group *result, ent_t *ent,
+		    char *buffer, size_t buflen, int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
-  int parse_res;
-
-  if (use_nisplus) /* Do the NIS+ query here */
-    {
-      nis_result *res;
-      char buf[strlen (name) + 24 + grptablelen];
-
-      sprintf(buf, "[name=%s],%s", name, grptable);
-      res = nis_list(buf, FOLLOW_PATH | FOLLOW_LINKS, NULL, NULL);
-      if (niserr2nss (res->status) != NSS_STATUS_SUCCESS)
-        {
-          enum nss_status status =  niserr2nss (res->status);
-
-          nis_freeresult (res);
-          return status;
-        }
-      parse_res = _nss_nisplus_parse_grent (res, 0, result, buffer, buflen,
-					    errnop);
-      if (parse_res == -1)
-	{
-	  nis_freeresult (res);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      nis_freeresult (res);
-    }
-  else /* Use NIS */
-    {
-      char *domain, *outval, *p;
-      int outvallen;
-
-      if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (yp_match (domain, "group.byname", name, strlen (name),
-		    &outval, &outvallen) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (buflen < ((size_t) outvallen + 1))
-	{
-	  free (outval);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
+  if (!nss_getgrnam_r)
+    return NSS_STATUS_UNAVAIL;
 
-      /* Copy the found data to our buffer...  */
-      p = strncpy (buffer, outval, buflen);
+  if (nss_getgrnam_r (name, result, buffer, buflen, errnop) !=
+      NSS_STATUS_SUCCESS)
+    return NSS_STATUS_NOTFOUND;
 
-      /* ... and free the data.  */
-      free (outval);
-      while (isspace (*p))
-        ++p;
-      parse_res = _nss_files_parse_grent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	return NSS_STATUS_TRYAGAIN;
-    }
+  if (in_blacklist (result->gr_name, strlen (result->gr_name), ent))
+    return NSS_STATUS_NOTFOUND;
 
-  if (parse_res)
-    /* We found the entry.  */
-    return NSS_STATUS_SUCCESS;
-  else
-    return NSS_STATUS_RETURN;
+  /* We found the entry.  */
+  return NSS_STATUS_SUCCESS;
 }
 
 static enum nss_status
@@ -483,8 +255,8 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    return NSS_STATUS_NOTFOUND;
 
 	  if (p == NULL || buffer[buflen - 1] != '\xff')
@@ -501,9 +273,9 @@
 	  while (isspace (*p))
 	    ++p;
 	}
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines. */
-      /* Parse the line.  If it is invalid, loop to
-         get the next line of the file to parse.  */
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines. */
+	     /* Parse the line.  If it is invalid, loop to
+	        get the next line of the file to parse.  */
 	     !(parse_res = _nss_files_parse_grent (p, result, data, buflen,
 						   errnop)));
 
@@ -531,41 +303,39 @@
       if (result->gr_name[0] == '+' && result->gr_name[1] != '\0'
 	  && result->gr_name[1] != '@')
 	{
-          enum nss_status status;
+	  size_t len = strlen (result->gr_name);
+	  char buf[len];
+	  enum nss_status status;
 
 	  /* Store the group in the blacklist for the "+" at the end of
 	     /etc/group */
-	  blacklist_store_name (&result->gr_name[1], ent);
-	  status = getgrnam_plusgroup (&result->gr_name[1], result, buffer,
-				       buflen, errnop);
-          if (status == NSS_STATUS_SUCCESS) /* We found the entry. */
-            break;
-          else
-            if (status == NSS_STATUS_RETURN /* We couldn't parse the entry */
-		|| status == NSS_STATUS_NOTFOUND) /* No group in NIS */
-              continue;
-            else
-	      {
-		if (status == NSS_STATUS_TRYAGAIN)
-		  {
-		    /* The parser ran out of space.  */
-		    fsetpos (ent->stream, &pos);
-		    *errnop = ERANGE;
-		  }
-		return status;
-	      }
+	  memcpy (buf, &result->gr_name[1], len);
+	  status = getgrnam_plusgroup (&result->gr_name[1], result, ent,
+				       buffer, buflen, errnop);
+	  blacklist_store_name (buf, ent);
+	  if (status == NSS_STATUS_SUCCESS)	/* We found the entry. */
+	    break;
+	  else if (status == NSS_STATUS_RETURN	/* We couldn't parse the entry */
+		   || status == NSS_STATUS_NOTFOUND)	/* No group in NIS */
+	    continue;
+	  else
+	    {
+	      if (status == NSS_STATUS_TRYAGAIN)
+		{
+		  /* The parser ran out of space.  */
+		  fsetpos (ent->stream, &pos);
+		  *errnop = ERANGE;
+		}
+	      return status;
+	    }
 	}
 
       /* +:... */
       if (result->gr_name[0] == '+' && result->gr_name[1] == '\0')
 	{
-	  ent->nis = TRUE;
-	  ent->nis_first = TRUE;
+	  ent->files = FALSE;
 
-	  if (use_nisplus)
-	    return getgrent_next_nisplus (result, ent, buffer, buflen, errnop);
-	  else
-	    return getgrent_next_nis (result, ent, buffer, buflen, errnop);
+	  return getgrent_next_nss (result, ent, buffer, buflen, errnop);
 	}
     }
 
@@ -573,39 +343,31 @@
 }
 
 
-static enum nss_status
-internal_getgrent_r (struct group *gr, ent_t *ent, char *buffer,
-		     size_t buflen, int *errnop)
-{
-  if (ent->nis)
-    {
-      if (use_nisplus)
-	return getgrent_next_nisplus (gr, ent, buffer, buflen, errnop);
-      else
-	return getgrent_next_nis (gr, ent, buffer, buflen, errnop);
-    }
-  else
-    return getgrent_next_file (gr, ent, buffer, buflen, errnop);
-}
-
 enum nss_status
 _nss_compat_getgrent_r (struct group *grp, char *buffer, size_t buflen,
 			int *errnop)
 {
-  enum nss_status status = NSS_STATUS_SUCCESS;
+  enum nss_status result = NSS_STATUS_SUCCESS;
 
   __libc_lock_lock (lock);
 
   /* Be prepared that the setgrent function was not called before.  */
-  if (ext_ent.stream == NULL)
-    status = internal_setgrent (&ext_ent);
+  if (ni == NULL)
+    init_nss_interface ();
 
-  if (status == NSS_STATUS_SUCCESS)
-    status = internal_getgrent_r (grp, &ext_ent, buffer, buflen, errnop);
+  if (ext_ent.stream == NULL)
+    result = internal_setgrent (&ext_ent, 1);
 
+  if (result == NSS_STATUS_SUCCESS)
+    {
+      if (ext_ent.files)
+	result = getgrent_next_file (grp, &ext_ent, buffer, buflen, errnop);
+      else
+	result = getgrent_next_nss (grp, &ext_ent, buffer, buflen, errnop);
+    }
   __libc_lock_unlock (lock);
 
-  return status;
+  return result;
 }
 
 /* Searches in /etc/group and the NIS/NIS+ map for a special group */
@@ -624,9 +386,9 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
-	      return NSS_STATUS_NOTFOUND;
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
+	    return NSS_STATUS_NOTFOUND;
 
 	  if (p == NULL || buffer[buflen - 1] != '\xff')
 	    {
@@ -642,9 +404,9 @@
 	  while (isspace (*p))
 	    ++p;
 	}
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines. */
-      /* Parse the line.  If it is invalid, loop to
-         get the next line of the file to parse.  */
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines. */
+	     /* Parse the line.  If it is invalid, loop to
+	        get the next line of the file to parse.  */
 	     !(parse_res = _nss_files_parse_grent (p, result, data, buflen,
 						   errnop)));
 
@@ -681,8 +443,8 @@
 	    {
 	      enum nss_status status;
 
-	      status = getgrnam_plusgroup (name, result, buffer, buflen,
-					   errnop);
+	      status = getgrnam_plusgroup (name, result, ent,
+					   buffer, buflen, errnop);
 	      if (status == NSS_STATUS_RETURN)
 		/* We couldn't parse the entry */
 		continue;
@@ -695,7 +457,8 @@
 	{
 	  enum nss_status status;
 
-	  status = getgrnam_plusgroup (name, result, buffer, buflen, errnop);
+	  status = getgrnam_plusgroup (name, result, ent,
+				       buffer, buflen, errnop);
 	  if (status == NSS_STATUS_RETURN)
 	    /* We couldn't parse the entry */
 	    continue;
@@ -711,99 +474,27 @@
 _nss_compat_getgrnam_r (const char *name, struct group *grp,
 			char *buffer, size_t buflen, int *errnop)
 {
-  ent_t ent = {0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0}};
-  enum nss_status status;
+  ent_t ent = {TRUE, NULL, {NULL, 0, 0}};
+  enum nss_status result;
 
   if (name[0] == '-' || name[0] == '+')
     return NSS_STATUS_NOTFOUND;
 
   __libc_lock_lock (lock);
 
-  status = internal_setgrent (&ent);
+  if (ni == NULL)
+    init_nss_interface ();
 
   __libc_lock_unlock (lock);
 
-  if (status != NSS_STATUS_SUCCESS)
-    return status;
+  result = internal_setgrent (&ent, 0);
 
-  status = internal_getgrnam_r (name, grp, &ent, buffer, buflen, errnop);
+  if (result == NSS_STATUS_SUCCESS)
+    result = internal_getgrnam_r (name, grp, &ent, buffer, buflen, errnop);
 
   internal_endgrent (&ent);
 
-  return status;
-}
-
-/* This function handle the + entry in /etc/group */
-static enum nss_status
-getgrgid_plusgroup (gid_t gid, struct group *result, char *buffer,
-		    size_t buflen, int *errnop)
-{
-  struct parser_data *data = (void *) buffer;
-  int parse_res;
-
-  if (use_nisplus) /* Do the NIS+ query here */
-    {
-      nis_result *res;
-      char buf[24 + grptablelen];
-
-      sprintf(buf, "[gid=%lu],%s", (unsigned long int) gid, grptable);
-      res = nis_list(buf, FOLLOW_PATH | FOLLOW_LINKS, NULL, NULL);
-      if (niserr2nss (res->status) != NSS_STATUS_SUCCESS)
-        {
-          enum nss_status status =  niserr2nss (res->status);
-
-          nis_freeresult (res);
-          return status;
-        }
-      if ((parse_res = _nss_nisplus_parse_grent (res, 0, result, buffer,
-						 buflen, errnop)) == -1)
-	{
-	  nis_freeresult (res);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      nis_freeresult (res);
-    }
-  else /* Use NIS */
-    {
-      char buf[24];
-      char *domain, *outval, *p;
-      int outvallen;
-
-      if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      snprintf (buf, sizeof (buf), "%lu", (unsigned long int) gid);
-
-      if (yp_match (domain, "group.bygid", buf, strlen (buf),
-		    &outval, &outvallen) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (buflen < ((size_t) outvallen + 1))
-	{
-	  free (outval);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      /* Copy the found data to our buffer...  */
-      p = strncpy (buffer, outval, buflen);
-
-      /* ... and free the data.  */
-      free (outval);
-
-      while (isspace (*p))
-        p++;
-      parse_res = _nss_files_parse_grent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	return NSS_STATUS_TRYAGAIN;
-    }
-
-  if (parse_res)
-    /* We found the entry.  */
-    return NSS_STATUS_SUCCESS;
-  else
-    return NSS_STATUS_RETURN;
+  return result;
 }
 
 /* Searches in /etc/group and the NIS/NIS+ map for a special group id */
@@ -822,8 +513,8 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    return NSS_STATUS_NOTFOUND;
 
 	  if (p == NULL || buffer[buflen - 1] != '\xff')
@@ -840,9 +531,9 @@
 	  while (isspace (*p))
 	    ++p;
 	}
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines. */
-      /* Parse the line.  If it is invalid, loop to
-         get the next line of the file to parse.  */
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines. */
+	     /* Parse the line.  If it is invalid, loop to
+	        get the next line of the file to parse.  */
 	     !(parse_res = _nss_files_parse_grent (p, result, data, buflen,
 						   errnop)));
 
@@ -866,8 +557,8 @@
       /* -group */
       if (result->gr_name[0] == '-' && result->gr_name[1] != '\0')
 	{
-          blacklist_store_name (&result->gr_name[1], ent);
-          continue;
+	  blacklist_store_name (&result->gr_name[1], ent);
+	  continue;
 	}
 
       /* +group */
@@ -876,10 +567,10 @@
 	  enum nss_status status;
 
 	  /* Store the group in the blacklist for the "+" at the end of
-             /etc/group */
-          blacklist_store_name (&result->gr_name[1], ent);
-	  status = getgrnam_plusgroup (&result->gr_name[1], result, buffer,
-				      buflen, errnop);
+	     /etc/group */
+	  blacklist_store_name (&result->gr_name[1], ent);
+	  status = getgrnam_plusgroup (&result->gr_name[1], result, ent,
+				       buffer, buflen, errnop);
 	  if (status == NSS_STATUS_SUCCESS && result->gr_gid == gid)
 	    break;
 	  else
@@ -890,7 +581,7 @@
 	{
 	  enum nss_status status;
 
-	  status = getgrgid_plusgroup (gid, result, buffer, buflen, errnop);
+	  status = nss_getgrgid_r (gid, result, buffer, buflen, errnop);
 	  if (status == NSS_STATUS_RETURN) /* We couldn't parse the entry */
 	    return NSS_STATUS_NOTFOUND;
 	  else
@@ -905,23 +596,24 @@
 _nss_compat_getgrgid_r (gid_t gid, struct group *grp,
 			char *buffer, size_t buflen, int *errnop)
 {
-  ent_t ent = {0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0}};
-  enum nss_status status;
+  ent_t ent = {TRUE, NULL, {NULL, 0, 0}};
+  enum nss_status result;
 
   __libc_lock_lock (lock);
 
-  status = internal_setgrent (&ent);
+  if (ni == NULL)
+    init_nss_interface ();
 
   __libc_lock_unlock (lock);
 
-  if (status != NSS_STATUS_SUCCESS)
-    return status;
+  result = internal_setgrent (&ent, 0);
 
-  status = internal_getgrgid_r (gid, grp, &ent, buffer, buflen, errnop);
+  if (result == NSS_STATUS_SUCCESS)
+    result = internal_getgrgid_r (gid, grp, &ent, buffer, buflen, errnop);
 
   internal_endgrent (&ent);
 
-  return status;
+  return result;
 }
 
 
@@ -983,7 +675,7 @@
 
   buf[0] = '|';
   cp = stpcpy (&buf[1], name);
-  *cp++= '|';
+  *cp++ = '|';
   *cp = '\0';
   return strstr (ent->blacklist.data, buf) != NULL;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_compat/compat-initgroups.c libc-20030708/nis/nss_compat/compat-initgroups.c
--- glibc-2.3.2/nis/nss_compat/compat-initgroups.c	2002-08-26 14:05:19.000000000 +0900
+++ libc-20030708/nis/nss_compat/compat-initgroups.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998,1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1998.
 
@@ -17,27 +17,39 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <alloca.h>
+#include <ctype.h>
 #include <errno.h>
 #include <fcntl.h>
-#include <nss.h>
 #include <grp.h>
-#include <ctype.h>
+#include <nss.h>
+#include <stdio_ext.h>
 #include <string.h>
 #include <unistd.h>
-#include <rpcsvc/yp.h>
-#include <rpcsvc/ypclnt.h>
-#include <rpcsvc/nis.h>
+#include <rpc/types.h>
 #include <sys/param.h>
 #include <nsswitch.h>
-
-#include "nss-nis.h"
-#include "nss-nisplus.h"
-#include "nisplus-parser.h"
+#include <bits/libc-lock.h>
 
 static service_user *ni;
-static bool_t use_nisplus; /* default: group_compat: nis */
-static nis_name grptable; /* Name of the group table */
-static size_t grptablelen;
+/* Type of the lookup function.  */
+static enum nss_status (*nss_initgroups_dyn) (const char *, gid_t,
+					      long int *, long int *,
+					      gid_t **, long int, int *);
+static enum nss_status (*nss_setgrent) (int stayopen);
+static enum nss_status (*nss_getgrnam_r) (const char *name,
+					  struct group * grp, char *buffer,
+					  size_t buflen, int *errnop);
+static enum nss_status (*nss_getgrgid_r) (gid_t gid, struct group * grp,
+					  char *buffer, size_t buflen,
+					  int *errnop);
+static enum nss_status (*nss_getgrent_r) (struct group * grp, char *buffer,
+					  size_t buflen, int *errnop);
+static enum nss_status (*nss_endgrent) (void);
+
+/* Protect global state against multiple changers.  */
+__libc_lock_define_initialized (static, lock)
+
 
 /* Get the declaration of the parser function.  */
 #define ENTNAME grent
@@ -49,29 +61,17 @@
 #define BLACKLIST_INITIAL_SIZE 512
 #define BLACKLIST_INCREMENT 256
 struct blacklist_t
-  {
-    char *data;
-    int current;
-    int size;
-  };
-
-struct response_t
 {
-  char *val;
-  struct response_t *next;
+  char *data;
+  int current;
+  int size;
 };
 
 struct ent_t
-  {
-    bool_t nis;
-    bool_t nis_first;
-    char *oldkey;
-    int oldkeylen;
-    nis_result *result;
-    FILE *stream;
-    struct blacklist_t blacklist;
-    struct response_t *start;
-    struct response_t *next;
+{
+  bool_t files;
+  FILE *stream;
+  struct blacklist_t blacklist;
 };
 typedef struct ent_t ent_t;
 
@@ -80,68 +80,26 @@
 static void blacklist_store_name (const char *, ent_t *);
 static int in_blacklist (const char *, int, ent_t *);
 
-static int
-saveit (int instatus, char *inkey, int inkeylen, char *inval,
-        int invallen, char *indata)
-{
-  ent_t *intern = (ent_t *) indata;
-
-  if (instatus != YP_TRUE)
-    return instatus;
-
-  if (inkey && inkeylen > 0 && inval && invallen > 0)
-    {
-      if (intern->start == NULL)
-        {
-          intern->start = malloc (sizeof (struct response_t));
-	  if (intern->start == NULL)
-	    return YP_FALSE;
-          intern->next = intern->start;
-        }
-      else
-        {
-          intern->next->next = malloc (sizeof (struct response_t));
-	  if (intern->next->next == NULL)
-	    return YP_FALSE;
-          intern->next = intern->next->next;
-        }
-      intern->next->next = NULL;
-      intern->next->val = malloc (invallen + 1);
-      if (intern->next->val == NULL)
-	return YP_FALSE;
-      strncpy (intern->next->val, inval, invallen);
-      intern->next->val[invallen] = '\0';
-    }
-
-  return 0;
-}
-
-static enum nss_status
-_nss_first_init (void)
+/* Initialize the NSS interface/functions. The calling function must
+   hold the lock.  */
+static void
+init_nss_interface (void)
 {
-  if (ni == NULL)
-    {
-      __nss_database_lookup ("group_compat", NULL, "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+  __libc_lock_lock (lock);
 
-  if (grptable == NULL)
+  /* Retest.  */
+  if (ni == NULL
+      && __nss_database_lookup ("group_compat", NULL, "nis", &ni) >= 0)
     {
-      static const char key[] = "group.org_dir.";
-      const char *local_dir = nis_local_directory ();
-      size_t len_local_dir = strlen (local_dir);
-
-      grptable = malloc (sizeof (key) + len_local_dir);
-      if (grptable == NULL)
-        return NSS_STATUS_TRYAGAIN;
-
-      grptablelen = ((char *) mempcpy (mempcpy (grptable,
-						key, sizeof (key) - 1),
-				       local_dir, len_local_dir + 1)
-		     - grptable) - 1;
+      nss_initgroups_dyn = __nss_lookup_function (ni, "initgroups_dyn");
+      nss_setgrent = __nss_lookup_function (ni, "setgrent");
+      nss_getgrnam_r = __nss_lookup_function (ni, "getgrnam_r");
+      nss_getgrgid_r = __nss_lookup_function (ni, "getgrgid_r");
+      nss_getgrent_r = __nss_lookup_function (ni, "getgrent_r");
+      nss_endgrent = __nss_lookup_function (ni, "endgrent");
     }
 
-  return NSS_STATUS_SUCCESS;
+  __libc_lock_unlock (lock);
 }
 
 static enum nss_status
@@ -149,26 +107,10 @@
 {
   enum nss_status status = NSS_STATUS_SUCCESS;
 
-  ent->nis = ent->nis_first = 0;
-
-  ent->start = NULL;
-  ent->next = NULL;
-
-  if (_nss_first_init () != NSS_STATUS_SUCCESS)
-    return NSS_STATUS_UNAVAIL;
-
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
+  ent->files = TRUE;
 
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
+  if (ni == NULL)
+    init_nss_interface ();
 
   if (ent->blacklist.data != NULL)
     {
@@ -179,35 +121,33 @@
   else
     ent->blacklist.current = 0;
 
+  ent->stream = fopen ("/etc/group", "rm");
+
   if (ent->stream == NULL)
+    status = errno == EAGAIN ? NSS_STATUS_TRYAGAIN : NSS_STATUS_UNAVAIL;
+  else
     {
-      ent->stream = fopen ("/etc/group", "r");
+      /* We have to make sure the file is  `closed on exec'.  */
+      int result, flags;
 
-      if (ent->stream == NULL)
-	status = errno == EAGAIN ? NSS_STATUS_TRYAGAIN : NSS_STATUS_UNAVAIL;
-      else
+      result = flags = fcntl (fileno_unlocked (ent->stream), F_GETFD, 0);
+      if (result >= 0)
 	{
-	  /* We have to make sure the file is  `closed on exec'.  */
-	  int result, flags;
-
-	  result = flags = fcntl (fileno (ent->stream), F_GETFD, 0);
-	  if (result >= 0)
-	    {
-	      flags |= FD_CLOEXEC;
-	      result = fcntl (fileno (ent->stream), F_SETFD, flags);
-	    }
-	  if (result < 0)
-	    {
-	      /* Something went wrong.  Close the stream and return a
-		 failure.  */
-	      fclose (ent->stream);
-	      ent->stream = NULL;
-	      status = NSS_STATUS_UNAVAIL;
-	    }
+	  flags |= FD_CLOEXEC;
+	  result = fcntl (fileno_unlocked (ent->stream), F_SETFD, flags);
+	}
+      if (result < 0)
+	{
+	  /* Something went wrong.  Close the stream and return a
+	     failure.  */
+	  fclose (ent->stream);
+	  ent->stream = NULL;
+	  status = NSS_STATUS_UNAVAIL;
 	}
+      else
+	/* We take care of locking ourself.  */
+	__fsetlocking (ent->stream, FSETLOCKING_BYCALLER);
     }
-  else
-    rewind (ent->stream);
 
   return status;
 }
@@ -222,21 +162,6 @@
       ent->stream = NULL;
     }
 
-  ent->nis = ent->nis_first = 0;
-
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
-
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
-
   if (ent->blacklist.data != NULL)
     {
       ent->blacklist.current = 1;
@@ -246,222 +171,145 @@
   else
     ent->blacklist.current = 0;
 
-  while (ent->start != NULL)
-    {
-      if (ent->start->val != NULL)
-        free (ent->start->val);
-      ent->next = ent->start;
-      ent->start = ent->start->next;
-      free (ent->next);
-    }
-
-
   return NSS_STATUS_SUCCESS;
 }
 
-static enum nss_status
-getgrent_next_nis (struct group *result, ent_t *ent, char *buffer,
-		   size_t buflen, int *errnop)
+/* This function checks, if the user is a member of this group and if
+   yes, add the group id to the list.  */
+static void
+check_and_add_group (const char *user, gid_t group, long int *start,
+		     long int *size, gid_t **groupsp, long int limit,
+		     struct group *grp)
 {
-  struct parser_data *data = (void *) buffer;
-  char *domain, *p;
-  int parse_res;
-
-  if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-    {
-      ent->nis = 0;
-      return NSS_STATUS_NOTFOUND;
-    }
-
-  if (ent->start == NULL)
-    {
-      struct ypall_callback ypcb;
-      enum nss_status status;
-
-      ypcb.foreach = saveit;
-      ypcb.data = (char *) ent;
-      status = yperr2nss (yp_all (domain, "group.byname", &ypcb));
-      ent->next = ent->start;
+  gid_t *groups = *groupsp;
+  char **member;
 
-      if (ent->start == NULL || status != NSS_STATUS_SUCCESS)
-	{
-	  ent->nis = 0;
-	  return NSS_STATUS_UNAVAIL;
-	}
-    }
+  /* Don't add main group to list of groups.  */
+  if (grp->gr_gid == group)
+    return;
+
+  for (member = grp->gr_mem; *member != NULL; ++member)
+    if (strcmp (*member, user) == 0)
+      {
+	/* Matches user.  Insert this group.  */
+	if (*start == *size)
+	  {
+	    /* Need a bigger buffer.  */
+	    gid_t *newgroups;
+	    long int newsize;
 
+	    if (limit > 0 && *size == limit)
+	      /* We reached the maximum.  */
+	      return;
 
-  do
-    {
-      if (ent->next == NULL)
-        {
-	  ent->nis = 0;
-          return NSS_STATUS_NOTFOUND;
-        }
-
-      /* Copy the found data to our buffer...  */
-      p = strncpy (buffer, ent->next->val, buflen);
-      while (isspace (*p))
-        ++p;
+	    if (limit <= 0)
+	      newsize = 2 * *size;
+	    else
+	      newsize = MIN (limit, 2 * *size);
 
-      parse_res = _nss_files_parse_grent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
+	    newgroups = realloc (groups, newsize * sizeof (*groups));
+	    if (newgroups == NULL)
+	      return;
+	    *groupsp = groups = newgroups;
+	    *size = newsize;
+	  }
 
-      ent->next = ent->next->next;
+	groups[*start] = grp->gr_gid;
+	*start += 1;
 
-      if (parse_res &&
-	  in_blacklist (result->gr_name, strlen (result->gr_name), ent))
-	parse_res = 0; /* if result->gr_name in blacklist,search next entry */
-    }
-  while (!parse_res);
-
-  return NSS_STATUS_SUCCESS;
+	break;
+      }
 }
 
+/* get the next group from NSS  (+ entry). If the NSS module supports
+   initgroups_dyn, get all entries at once.  */
 static enum nss_status
-getgrent_next_nisplus (struct group *result, ent_t *ent, char *buffer,
-                       size_t buflen, int *errnop)
+getgrent_next_nss (ent_t *ent, char *buffer, size_t buflen, const char *user,
+		   gid_t group, long int *start, long int *size,
+		   gid_t **groupsp, long int limit, int *errnop)
 {
-  int parse_res;
+  enum nss_status status;
+  struct group grpbuf;
 
-  do
-    {
-      nis_result *save_oldres;
-      bool_t save_nis_first;
+  /* if this module does not support getgrent_r and initgroups_dyn,
+     abort. We cannot find the needed group entries.  */
+  if (nss_getgrent_r == NULL && nss_initgroups_dyn == NULL)
+    return NSS_STATUS_UNAVAIL;
 
-      if (ent->nis_first)
-        {
-	  save_oldres = ent->result;
-	  save_nis_first = TRUE;
-          ent->result = nis_first_entry(grptable);
-          if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-            {
-              ent->nis = 0;
-              return niserr2nss (ent->result->status);
-            }
-          ent->nis_first = FALSE;
-        }
-      else
-        {
-          nis_result *res;
+  /* Try nss_initgroups_dyn if supported. We also need getgrgid_r.
+     If this function is not supported, step through the whole group
+     database with getgrent_r.  */
+  if (nss_initgroups_dyn && nss_getgrgid_r)
+    {
+      long int mystart = 0, mysize = limit;
+      gid_t *mygroupsp = __alloca (limit * sizeof (gid_t));
+
+      /* For every gid in the list we get from the NSS module,
+         get the whole group entry. We need to do this, since we
+         need the group name to check if it is in the blacklist.
+         In worst case, this is as twice as slow as stepping with
+         getgrent_r through the whole group database. But for large
+         group databases this is faster, since the user can only be
+         in a limited number of groups.  */
+      if (nss_initgroups_dyn (user, group, &mystart, &mysize, &mygroupsp,
+			      limit, errnop) == NSS_STATUS_SUCCESS)
+	{
+	  /* A temporary buffer. We use the normal buffer, until we found
+	     an entry, for which this buffer is to small.  In this case, we
+	     overwrite the pointer with one to a bigger buffer.  */
+	  char *tmpbuf = buffer;
+	  size_t tmplen = buflen;
+	  int i;
 
-	  save_oldres = ent->result;
-	  save_nis_first = FALSE;
-          res = nis_next_entry(grptable, &ent->result->cookie);
-          ent->result = res;
-          if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-            {
-	      ent->nis = 0;
-	      return niserr2nss (ent->result->status);
-            }
-        }
-      parse_res = _nss_nisplus_parse_grent (ent->result, 0, result,
-					    buffer, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  nis_freeresult (ent->result);
-	  ent->result = save_oldres;
-	  ent->nis_first = save_nis_first;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      else
-	{
-	  if (!save_nis_first)
-	    nis_freeresult (save_oldres);
+	  for (i = 0; i < mystart; i++)
+	    {
+	      while ((status = nss_getgrgid_r (mygroupsp[i], &grpbuf, tmpbuf,
+					       tmplen,
+					       errnop)) == NSS_STATUS_TRYAGAIN
+		     && *errnop == ERANGE)
+		if (tmpbuf == buffer)
+		  {
+		    tmplen *= 2;
+		    tmpbuf = __alloca (tmplen);
+		  }
+		else
+		  tmpbuf = extend_alloca (tmpbuf, tmplen, 2 * tmplen);
+
+	      if (!in_blacklist (grpbuf.gr_name,
+				 strlen (grpbuf.gr_name), ent))
+		check_and_add_group (user, group, start, size, groupsp,
+				     limit, &grpbuf);
+	    }
+	  return NSS_STATUS_NOTFOUND;
 	}
+    }
 
-      if (parse_res &&
-          in_blacklist (result->gr_name, strlen (result->gr_name), ent))
-        parse_res = 0; /* if result->gr_name in blacklist,search next entry */
+  /* If we come here, the NSS module does not support initgroups_dyn
+     and we have to step through the whole list ourself.  */
+  do
+    {
+      if ((status = nss_getgrent_r (&grpbuf, buffer, buflen, errnop)) !=
+	  NSS_STATUS_SUCCESS)
+	return status;
     }
-  while (!parse_res);
+  while (in_blacklist (grpbuf.gr_name, strlen (grpbuf.gr_name), ent));
 
+  check_and_add_group (user, group, start, size, groupsp, limit, &grpbuf);
   return NSS_STATUS_SUCCESS;
 }
 
-/* This function handle the +group entrys in /etc/group */
 static enum nss_status
-getgrnam_plusgroup (const char *name, struct group *result, char *buffer,
-		    size_t buflen, int *errnop)
+internal_getgrent_r (ent_t *ent, char *buffer, size_t buflen, const char *user,
+		     gid_t group, long int *start, long int *size,
+		     gid_t **groupsp, long int limit, int *errnop)
 {
   struct parser_data *data = (void *) buffer;
-  int parse_res;
-
-  if (use_nisplus) /* Do the NIS+ query here */
-    {
-      nis_result *res;
-      char buf[strlen (name) + 24 + grptablelen];
-
-      sprintf(buf, "[name=%s],%s", name, grptable);
-      res = nis_list(buf, FOLLOW_PATH | FOLLOW_LINKS, NULL, NULL);
-      if (niserr2nss (res->status) != NSS_STATUS_SUCCESS)
-        {
-          enum nss_status status =  niserr2nss (res->status);
-
-          nis_freeresult (res);
-          return status;
-        }
-      parse_res = _nss_nisplus_parse_grent (res, 0, result, buffer, buflen,
-					    errnop);
-      if (parse_res == -1)
-	{
-	  nis_freeresult (res);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      nis_freeresult (res);
-    }
-  else /* Use NIS */
-    {
-      char *domain, *outval, *p;
-      int outvallen;
+  struct group grpbuf;
 
-      if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
+  if (!ent->files)
+    return getgrent_next_nss (ent, buffer, buflen, user, group,
+			      start, size, groupsp, limit, errnop);
 
-      if (yp_match (domain, "group.byname", name, strlen (name),
-		    &outval, &outvallen) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (buflen < ((size_t) outvallen + 1))
-	{
-	  free (outval);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      /* Copy the found data to our buffer...  */
-      p = strncpy (buffer, outval, buflen);
-
-      /* ... and free the data.  */
-      free (outval);
-      while (isspace (*p))
-        ++p;
-      parse_res = _nss_files_parse_grent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-    }
-
-  if (parse_res)
-    /* We found the entry.  */
-    return NSS_STATUS_SUCCESS;
-  else
-    return NSS_STATUS_RETURN;
-}
-
-static enum nss_status
-getgrent_next_file (struct group *result, ent_t *ent,
-		    char *buffer, size_t buflen, int *errnop)
-{
-  struct parser_data *data = (void *) buffer;
   while (1)
     {
       fpos_t pos;
@@ -472,8 +320,8 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    return NSS_STATUS_NOTFOUND;
 
 	  if (p == NULL || buffer[buflen - 1] != '\xff')
@@ -490,10 +338,10 @@
 	  while (isspace (*p))
 	    ++p;
 	}
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines. */
-      /* Parse the line.  If it is invalid, loop to
-         get the next line of the file to parse.  */
-	     !(parse_res = _nss_files_parse_grent (p, result, data, buflen,
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines. */
+	     /* Parse the line.  If it is invalid, loop to
+	        get the next line of the file to parse.  */
+	     !(parse_res = _nss_files_parse_grent (p, &grpbuf, data, buflen,
 						   errnop)));
 
       if (parse_res == -1)
@@ -504,90 +352,64 @@
 	  return NSS_STATUS_TRYAGAIN;
 	}
 
-      if (result->gr_name[0] != '+' && result->gr_name[0] != '-')
+      if (grpbuf.gr_name[0] != '+' && grpbuf.gr_name[0] != '-')
 	/* This is a real entry.  */
 	break;
 
       /* -group */
-      if (result->gr_name[0] == '-' && result->gr_name[1] != '\0'
-	  && result->gr_name[1] != '@')
+      if (grpbuf.gr_name[0] == '-' && grpbuf.gr_name[1] != '\0'
+	  && grpbuf.gr_name[1] != '@')
 	{
-	  blacklist_store_name (&result->gr_name[1], ent);
+	  blacklist_store_name (&grpbuf.gr_name[1], ent);
 	  continue;
 	}
 
       /* +group */
-      if (result->gr_name[0] == '+' && result->gr_name[1] != '\0'
-	  && result->gr_name[1] != '@')
+      if (grpbuf.gr_name[0] == '+' && grpbuf.gr_name[1] != '\0'
+	  && grpbuf.gr_name[1] != '@')
 	{
-          enum nss_status status;
-
- 	  /* Store the group in the blacklist for the "+" at the end of
+	  if (in_blacklist (&grpbuf.gr_name[1],
+			    strlen (&grpbuf.gr_name[1]), ent))
+	    continue;
+	  /* Store the group in the blacklist for the "+" at the end of
 	     /etc/group */
-	  blacklist_store_name (&result->gr_name[1], ent);
-	  status = getgrnam_plusgroup (&result->gr_name[1], result, buffer,
-				       buflen, errnop);
-          if (status == NSS_STATUS_SUCCESS) /* We found the entry. */
-            break;
-          else
-            if (status == NSS_STATUS_RETURN /* We couldn't parse the entry */
-		|| status == NSS_STATUS_NOTFOUND) /* No group in NIS */
-              continue;
-            else
-	      {
-		if (status == NSS_STATUS_TRYAGAIN)
-		  {
-		    /* The parser ran out of space.  */
-		    fsetpos (ent->stream, &pos);
-		    *errnop = ERANGE;
-		  }
-		return status;
-	      }
+	  blacklist_store_name (&grpbuf.gr_name[1], ent);
+	  if (nss_getgrnam_r == NULL)
+	    return NSS_STATUS_UNAVAIL;
+	  else if (nss_getgrnam_r (&grpbuf.gr_name[1], &grpbuf, buffer,
+				   buflen, errnop) != NSS_STATUS_SUCCESS)
+	    continue;
+
+	  check_and_add_group (user, group, start, size, groupsp,
+			       limit, &grpbuf);
+
+	  return NSS_STATUS_SUCCESS;
 	}
 
       /* +:... */
-      if (result->gr_name[0] == '+' && result->gr_name[1] == '\0')
+      if (grpbuf.gr_name[0] == '+' && grpbuf.gr_name[1] == '\0')
 	{
-	  ent->nis = TRUE;
-	  ent->nis_first = TRUE;
-
-	  if (use_nisplus)
-	    return getgrent_next_nisplus (result, ent, buffer, buflen, errnop);
-	  else
-	    return getgrent_next_nis (result, ent, buffer, buflen, errnop);
+	  ent->files = FALSE;
+	  return getgrent_next_nss (ent, buffer, buflen, user, group,
+				    start, size, groupsp, limit, errnop);
 	}
     }
 
+  check_and_add_group (user, group, start, size, groupsp, limit, &grpbuf);
+
   return NSS_STATUS_SUCCESS;
 }
 
 
-static enum nss_status
-internal_getgrent_r (struct group *gr, ent_t *ent, char *buffer,
-		     size_t buflen, int *errnop)
-{
-  if (ent->nis)
-    {
-      if (use_nisplus)
-	return getgrent_next_nisplus (gr, ent, buffer, buflen, errnop);
-      else
-	return getgrent_next_nis (gr, ent, buffer, buflen, errnop);
-    }
-  else
-    return getgrent_next_file (gr, ent, buffer, buflen, errnop);
-}
-
 enum nss_status
 _nss_compat_initgroups_dyn (const char *user, gid_t group, long int *start,
 			    long int *size, gid_t **groupsp, long int limit,
 			    int *errnop)
 {
-  struct group grpbuf, *g;
   size_t buflen = sysconf (_SC_GETPW_R_SIZE_MAX);
   char *tmpbuf;
   enum nss_status status;
-  ent_t intern = {0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0}};
-  gid_t *groups = *groupsp;
+  ent_t intern = { TRUE, NULL, {NULL, 0, 0} };
 
   status = internal_setgrent (&intern);
   if (status != NSS_STATUS_SUCCESS)
@@ -597,59 +419,14 @@
 
   do
     {
-      while ((status =
-              internal_getgrent_r (&grpbuf, &intern, tmpbuf, buflen,
-				   errnop)) == NSS_STATUS_TRYAGAIN
-             && *errnop == ERANGE)
-        {
-          buflen *= 2;
-          tmpbuf = __alloca (buflen);
-        }
-
-      if (status != NSS_STATUS_SUCCESS)
-        goto done;
-
-      g = &grpbuf;
-      if (g->gr_gid != group)
-        {
-          char **m;
-
-          for (m = g->gr_mem; *m != NULL; ++m)
-            if (strcmp (*m, user) == 0)
-              {
-                /* Matches user.  Insert this group.  */
-                if (*start == *size)
-                  {
-                    /* Need a bigger buffer.  */
-		    gid_t *newgroups;
-		    long int newsize;
-
-		    if (limit > 0 && *size == limit)
-		      /* We reached the maximum.  */
-		      goto done;
-
-		    if (limit <= 0)
-		      newsize = 2 * *size;
-		    else
-		      newsize = MIN (limit, 2 * *size);
-
-                    newgroups = realloc (groups, newsize * sizeof (*groups));
-                    if (newgroups == NULL)
-                      goto done;
-		    *groupsp = groups = newgroups;
-                    *size = newsize;
-                  }
-
-                groups[*start] = g->gr_gid;
-                *start += 1;
-
-                break;
-              }
-        }
+      while ((status = internal_getgrent_r (&intern, tmpbuf, buflen,
+					    user, group, start, size,
+					    groupsp, limit, errnop))
+	     == NSS_STATUS_TRYAGAIN && *errnop == ERANGE)
+	tmpbuf = extend_alloca (tmpbuf, buflen, 2 * buflen);
     }
   while (status == NSS_STATUS_SUCCESS);
 
-done:
   internal_endgrent (&intern);
 
   return NSS_STATUS_SUCCESS;
@@ -664,7 +441,7 @@
   int namelen = strlen (name);
   char *tmp;
 
-  /* first call, setup cache */
+  /* First call, setup cache.  */
   if (ent->blacklist.size == 0)
     {
       ent->blacklist.size = MAX (BLACKLIST_INITIAL_SIZE, 2 * namelen);
@@ -714,7 +491,7 @@
 
   buf[0] = '|';
   cp = stpcpy (&buf[1], name);
-  *cp++= '|';
+  *cp++ = '|';
   *cp = '\0';
   return strstr (ent->blacklist.data, buf) != NULL;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_compat/compat-pwd.c libc-20030708/nis/nss_compat/compat-pwd.c
--- glibc-2.3.2/nis/nss_compat/compat-pwd.c	2002-08-26 14:07:27.000000000 +0900
+++ libc-20030708/nis/nss_compat/compat-pwd.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-1999,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@vt.uni-paderborn.de>, 1996.
 
@@ -17,27 +17,32 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <nss.h>
-#include <pwd.h>
-#include <errno.h>
 #include <ctype.h>
+#include <errno.h>
 #include <fcntl.h>
 #include <netdb.h>
+#include <nss.h>
+#include <nsswitch.h>
+#include <pwd.h>
+#include <stdio_ext.h>
 #include <string.h>
-#include <bits/libc-lock.h>
-#include <rpcsvc/yp.h>
+#include <rpc/types.h>
 #include <rpcsvc/ypclnt.h>
-#include <rpcsvc/nis.h>
-#include <nsswitch.h>
+#include <bits/libc-lock.h>
 
 #include "netgroup.h"
-#include "nss-nisplus.h"
-#include "nisplus-parser.h"
 
 static service_user *ni;
-static bool_t use_nisplus; /* default: passwd_compat: nis */
-static nis_name pwdtable; /* Name of the pwd table */
-static size_t pwdtablelen;
+static enum nss_status (*nss_setpwent) (int stayopen);
+static enum nss_status (*nss_getpwnam_r) (const char *name,
+					  struct passwd * pwd, char *buffer,
+					  size_t buflen, int *errnop);
+static enum nss_status (*nss_getpwuid_r) (uid_t uid, struct passwd * pwd,
+					  char *buffer, size_t buflen,
+					  int *errnop);
+static enum nss_status (*nss_getpwent_r) (struct passwd * pwd, char *buffer,
+					  size_t buflen, int *errnop);
+static enum nss_status (*nss_endpwent) (void);
 
 /* Get the declaration of the parser function.  */
 #define ENTNAME pwent
@@ -49,29 +54,26 @@
 #define BLACKLIST_INITIAL_SIZE 512
 #define BLACKLIST_INCREMENT 256
 struct blacklist_t
-  {
-    char *data;
-    int current;
-    int size;
-  };
+{
+  char *data;
+  int current;
+  int size;
+};
 
 struct ent_t
-  {
-    bool_t netgroup;
-    bool_t nis;
-    bool_t first;
-    char *oldkey;
-    int oldkeylen;
-    nis_result *result;
-    FILE *stream;
-    struct blacklist_t blacklist;
-    struct passwd pwd;
-    struct __netgrent netgrdata;
-  };
+{
+  bool_t netgroup;
+  bool_t first;
+  bool_t files;
+  FILE *stream;
+  struct blacklist_t blacklist;
+  struct passwd pwd;
+  struct __netgrent netgrdata;
+};
 typedef struct ent_t ent_t;
 
-static ent_t ext_ent = {0, 0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0},
-			{NULL, NULL, 0, 0, NULL, NULL, NULL}};
+static ent_t ext_ent = {0, 0, TRUE, NULL, {NULL, 0, 0},
+                        {NULL, NULL, 0, 0, NULL, NULL, NULL}};
 
 /* Protect global state against multiple changers.  */
 __libc_lock_define_initialized (static, lock)
@@ -80,6 +82,21 @@
 static void blacklist_store_name (const char *, ent_t *);
 static int in_blacklist (const char *, int, ent_t *);
 
+/* Initialize the NSS interface/functions. The calling function must
+   hold the lock.  */
+static void
+init_nss_interface (void)
+{
+  if (__nss_database_lookup ("passwd_compat", NULL, "nis", &ni) >= 0)
+    {
+      nss_setpwent = __nss_lookup_function (ni, "setpwent");
+      nss_getpwnam_r = __nss_lookup_function (ni, "getpwnam_r");
+      nss_getpwuid_r = __nss_lookup_function (ni, "getpwuid_r");
+      nss_getpwent_r = __nss_lookup_function (ni, "getpwent_r");
+      nss_endpwent = __nss_lookup_function (ni, "endpwent");
+    }
+}
+
 static void
 give_pwd_free (struct passwd *pwd)
 {
@@ -156,8 +173,7 @@
     {
       if (buffer == NULL)
 	dest->pw_dir = strdup (src->pw_dir);
-      else if (dest->pw_dir &&
-	       strlen (dest->pw_dir) >= strlen (src->pw_dir))
+      else if (dest->pw_dir && strlen (dest->pw_dir) >= strlen (src->pw_dir))
 	strcpy (dest->pw_dir, src->pw_dir);
       else
 	{
@@ -186,100 +202,17 @@
 }
 
 static enum nss_status
-insert_passwd_adjunct (char **result, int *len, char *domain, int *errnop)
-{
-  char *p1, *p2, *result2, *res;
-  int len2;
-  size_t namelen;
-
-  /* Check for adjunct style secret passwords.  They can be
-     recognized by a password starting with "##".  */
-  p1 = strchr (*result, ':');
-  if (p1 == NULL || p1[1] != '#' || p1[2] != '#')
-    return NSS_STATUS_SUCCESS;
-  p2 = strchr (p1 + 3, ':');
-
-  namelen = p2 - p1 - 3;
-
-  if (yp_match (domain, "passwd.adjunct.byname", &p1[3], namelen,
-		&result2, &len2) == YPERR_SUCCESS)
-    {
-      /* We found a passwd.adjunct entry.  Merge encrypted
-	 password therein into original result.  */
-      char *encrypted = strchr (result2, ':');
-      char *endp;
-      size_t restlen;
-
-      if (encrypted == NULL || (endp = strchr (++encrypted, ':')) == NULL)
-	{
-	  /* Invalid format of the entry.  This never should happen
-	     unless the data from which the NIS table is generated is
-	     wrong.  We simply ignore it.  */
-	  free (result2);
-	  return NSS_STATUS_SUCCESS;
-	}
-
-      restlen = *len - (p2 - *result);
-      if ((res = malloc (namelen + restlen + (endp - encrypted) + 2)) == NULL)
-	{
-	  free (result2);
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      __mempcpy (__mempcpy (__mempcpy (__mempcpy
-				       (res, *result, (p1 - *result)),
-				       ":", 1),
-			    encrypted, endp - encrypted),
-		 p2, restlen + 1);
-
-      free (result2);
-      free (*result);
-      *result = res;
-      *len = strlen (res);
-    }
-  return NSS_STATUS_SUCCESS;
-}
-
-static enum nss_status
-internal_setpwent (ent_t *ent)
+internal_setpwent (ent_t *ent, int stayopen)
 {
   enum nss_status status = NSS_STATUS_SUCCESS;
 
-  ent->nis = ent->first = ent->netgroup = 0;
+  ent->first = ent->netgroup = FALSE;
+  ent->files = TRUE;
 
   /* If something was left over free it.  */
   if (ent->netgroup)
     __internal_endnetgrent (&ent->netgrdata);
 
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
-
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
-
-  if (pwdtable == NULL)
-    {
-      static const char key[] = "passwd.org_dir.";
-      const char *local_dir = nis_local_directory ();
-      size_t len_local_dir = strlen (local_dir);
-
-      pwdtable = malloc (sizeof (key) + len_local_dir);
-      if (pwdtable == NULL)
-        return NSS_STATUS_TRYAGAIN;
-
-      pwdtablelen = ((char *) mempcpy (mempcpy (pwdtable,
-						key, sizeof (key) - 1),
-				       local_dir, len_local_dir + 1)
-		     - pwdtable) - 1;
-    }
-
   if (ent->blacklist.data != NULL)
     {
       ent->blacklist.current = 1;
@@ -291,7 +224,7 @@
 
   if (ent->stream == NULL)
     {
-      ent->stream = fopen ("/etc/passwd", "r");
+      ent->stream = fopen ("/etc/passwd", "rm");
 
       if (ent->stream == NULL)
 	status = errno == EAGAIN ? NSS_STATUS_TRYAGAIN : NSS_STATUS_UNAVAIL;
@@ -300,20 +233,23 @@
 	  /* We have to make sure the file is  `closed on exec'.  */
 	  int result, flags;
 
-	  result = flags = fcntl (fileno (ent->stream), F_GETFD, 0);
+	  result = flags = fcntl (fileno_unlocked (ent->stream), F_GETFD, 0);
 	  if (result >= 0)
 	    {
 	      flags |= FD_CLOEXEC;
-	      result = fcntl (fileno (ent->stream), F_SETFD, flags);
+	      result = fcntl (fileno_unlocked (ent->stream), F_SETFD, flags);
 	    }
 	  if (result < 0)
 	    {
 	      /* Something went wrong.  Close the stream and return a
-		 failure.  */
+	         failure.  */
 	      fclose (ent->stream);
 	      ent->stream = NULL;
 	      status = NSS_STATUS_UNAVAIL;
 	    }
+	  else
+	    /* We take care of locking ourself.  */
+	    __fsetlocking (ent->stream, FSETLOCKING_BYCALLER);
 	}
     }
   else
@@ -321,6 +257,9 @@
 
   give_pwd_free (&ent->pwd);
 
+  if (status == NSS_STATUS_SUCCESS && nss_setpwent)
+    return nss_setpwent (stayopen);
+
   return status;
 }
 
@@ -333,12 +272,9 @@
   __libc_lock_lock (lock);
 
   if (ni == NULL)
-    {
-      __nss_database_lookup ("passwd_compat", NULL, "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+    init_nss_interface ();
 
-  result = internal_setpwent (&ext_ent);
+  result = internal_setpwent (&ext_ent, stayopen);
 
   __libc_lock_unlock (lock);
 
@@ -349,6 +285,9 @@
 static enum nss_status
 internal_endpwent (ent_t *ent)
 {
+  if (nss_endpwent)
+    nss_endpwent ();
+
   if (ent->stream != NULL)
     {
       fclose (ent->stream);
@@ -358,26 +297,13 @@
   if (ent->netgroup)
     __internal_endnetgrent (&ent->netgrdata);
 
-  ent->nis = ent->first = ent->netgroup = 0;
-
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
-
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
+  ent->first = ent->netgroup = FALSE;
 
   if (ent->blacklist.data != NULL)
     {
       ent->blacklist.current = 1;
       ent->blacklist.data[0] = '|';
-     ent->blacklist.data[1] = '\0';
+      ent->blacklist.data[1] = '\0';
     }
   else
     ent->blacklist.current = 0;
@@ -401,19 +327,25 @@
   return result;
 }
 
+
 static enum nss_status
-getpwent_next_nis_netgr (const char *name, struct passwd *result, ent_t *ent,
-			 char *group, char *buffer, size_t buflen, int *errnop)
+getpwent_next_nss_netgr (const char *name, struct passwd *result, ent_t *ent,
+			 char *group, char *buffer, size_t buflen,
+			 int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
-  char *ypdomain, *host, *user, *domain, *outval, *p, *p2;
-  int status, outvallen;
+  char *curdomain, *host, *user, *domain, *p2;
+  int status;
   size_t p2len;
 
-  if (yp_get_default_domain (&ypdomain) != YPERR_SUCCESS)
+  /* Leave function if NSS module does not support getpwnam_r,
+     we need this function here.  */
+  if (!nss_getpwnam_r)
+    return NSS_STATUS_UNAVAIL;
+
+  if (yp_get_default_domain (&curdomain) != YPERR_SUCCESS)
     {
-      ent->netgroup = 0;
-      ent->first = 0;
+      ent->netgroup = FALSE;
+      ent->first = FALSE;
       give_pwd_free (&ent->pwd);
       return NSS_STATUS_UNAVAIL;
     }
@@ -428,7 +360,6 @@
   while (1)
     {
       char *saved_cursor;
-      int parse_res;
 
       saved_cursor = ent->netgrdata.cursor;
       status = __internal_getnetgrent_r (&host, &user, &domain,
@@ -445,7 +376,7 @@
       if (user == NULL || user[0] == '-')
 	continue;
 
-      if (domain != NULL && strcmp (ypdomain, domain) != 0)
+      if (domain != NULL && strcmp (curdomain, domain) != 0)
 	continue;
 
       /* If name != NULL, we are called from getpwnam.  */
@@ -453,148 +384,23 @@
 	if (strcmp (user, name) != 0)
 	  continue;
 
-      if (yp_match (ypdomain, "passwd.byname", user,
-		    strlen (user), &outval, &outvallen)
-	  != YPERR_SUCCESS)
-	continue;
-
-      if (insert_passwd_adjunct (&outval, &outvallen, ypdomain, errnop)
-	  != NSS_STATUS_SUCCESS)
-	{
-	  free (outval);
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
       p2len = pwd_need_buflen (&ent->pwd);
       if (p2len > buflen)
 	{
-	  free (outval);
 	  *errnop = ERANGE;
 	  return NSS_STATUS_TRYAGAIN;
 	}
       p2 = buffer + (buflen - p2len);
       buflen -= p2len;
 
-      if (buflen < ((size_t) outvallen + 1))
-	{
-	  free (outval);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      p = strncpy (buffer, outval, buflen);
-
-      while (isspace (*p))
-	p++;
-      free (outval);
-      parse_res = _nss_files_parse_pwent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  ent->netgrdata.cursor = saved_cursor;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      if (parse_res && !in_blacklist (result->pw_name,
-				      strlen (result->pw_name), ent))
-	{
-	  /* Store the User in the blacklist for the "+" at the end of
-	     /etc/passwd */
-	  blacklist_store_name (result->pw_name, ent);
-	  copy_pwd_changes (result, &ent->pwd, p2, p2len);
-	  break;
-	}
-    }
-
-  return NSS_STATUS_SUCCESS;
-}
-
-static enum nss_status
-getpwent_next_nisplus_netgr (const char *name, struct passwd *result,
-			     ent_t *ent, char *group, char *buffer,
-			     size_t buflen, int *errnop)
-{
-  char *ypdomain, *host, *user, *domain, *p2;
-  int status, parse_res;
-  size_t p2len;
-  nis_result *nisres;
-
-  /* Maybe we should use domainname here ? We need the current
-     domainname for the domain field in netgroups */
-  if (yp_get_default_domain (&ypdomain) != YPERR_SUCCESS)
-    {
-      ent->netgroup = 0;
-      ent->first = 0;
-      give_pwd_free (&ent->pwd);
-      return NSS_STATUS_UNAVAIL;
-    }
-
-  if (ent->first == TRUE)
-    {
-      bzero (&ent->netgrdata, sizeof (struct __netgrent));
-      __internal_setnetgrent (group, &ent->netgrdata);
-      ent->first = FALSE;
-    }
-
-  while (1)
-    {
-      char *saved_cursor;
-
-      saved_cursor = ent->netgrdata.cursor;
-      status = __internal_getnetgrent_r (&host, &user, &domain,
-					 &ent->netgrdata, buffer, buflen,
-					 errnop);
-      if (status != 1)
-	{
-	  __internal_endnetgrent (&ent->netgrdata);
-	  ent->netgroup = 0;
-	  give_pwd_free (&ent->pwd);
-	  return NSS_STATUS_RETURN;
-	}
-
-      if (user == NULL || user[0] == '-')
+      if (nss_getpwnam_r (user, result, buffer, buflen, errnop) !=
+	  NSS_STATUS_SUCCESS)
 	continue;
 
-      if (domain != NULL && strcmp (ypdomain, domain) != 0)
-	continue;
-
-      /* If name != NULL, we are called from getpwnam */
-      if (name != NULL)
-	if (strcmp (user, name) != 0)
-	  continue;
-
-      p2len = pwd_need_buflen (&ent->pwd);
-      if (p2len > buflen)
+      if (!in_blacklist (result->pw_name, strlen (result->pw_name), ent))
 	{
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      p2 = buffer + (buflen - p2len);
-      buflen -= p2len;
-      {
-	char buf[strlen (user) + 30 + pwdtablelen];
-	sprintf(buf, "[name=%s],%s", user, pwdtable);
-	nisres = nis_list(buf, FOLLOW_PATH | FOLLOW_LINKS, NULL, NULL);
-      }
-      if (niserr2nss (nisres->status) != NSS_STATUS_SUCCESS)
-	{
-	  nis_freeresult (nisres);
-	  continue;
-	}
-      parse_res = _nss_nisplus_parse_pwent (nisres, result, buffer,
-					    buflen, errnop);
-      if (parse_res == -1)
-	{
-	  nis_freeresult (nisres);
-	  ent->netgrdata.cursor = saved_cursor;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      nis_freeresult (nisres);
-
-      if (parse_res && !in_blacklist (result->pw_name,
-				      strlen (result->pw_name), ent))
-	{
-	  /* Store the User in the blacklist for the "+" at the end of
-	     /etc/passwd */
+	  /* Store the User in the blacklist for possible the "+" at the
+	     end of /etc/passwd */
 	  blacklist_store_name (result->pw_name, ent);
 	  copy_pwd_changes (result, &ent->pwd, p2, p2len);
 	  break;
@@ -604,100 +410,18 @@
   return NSS_STATUS_SUCCESS;
 }
 
-/* get the next user from NIS+  (+ entry) */
+/* get the next user from NSS  (+ entry) */
 static enum nss_status
-getpwent_next_nisplus (struct passwd *result, ent_t *ent, char *buffer,
-		       size_t buflen, int *errnop)
-{
-  int parse_res;
-  size_t p2len;
-  char *p2;
-
-  p2len = pwd_need_buflen (&ent->pwd);
-  if (p2len > buflen)
-    {
-      *errnop = ERANGE;
-      return NSS_STATUS_TRYAGAIN;
-    }
-  p2 = buffer + (buflen - p2len);
-  buflen -= p2len;
-  do
-    {
-      bool_t saved_first;
-      nis_result *saved_res;
-
-      if (ent->first)
-	{
-	  saved_first = TRUE;
-	  saved_res = ent->result;
-
-	  ent->result = nis_first_entry (pwdtable);
-          if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      give_pwd_free (&ent->pwd);
-	      return niserr2nss (ent->result->status);
-	    }
-	  ent->first = FALSE;
-	}
-      else
-	{
-	  nis_result *res;
-
-	  res = nis_next_entry (pwdtable, &ent->result->cookie);
-	  saved_res = ent->result;
-	  saved_first = FALSE;
-	  ent->result = res;
-	  if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      nis_freeresult (saved_res);
-	      give_pwd_free (&ent->pwd);
-	      return niserr2nss (ent->result->status);
-	    }
-	}
-      parse_res = _nss_nisplus_parse_pwent (ent->result, result, buffer,
-					    buflen, errnop);
-      if (parse_res == -1)
-	{
-	  nis_freeresult (ent->result);
-	  ent->result = saved_res;
-	  ent->first = saved_first;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      else
-	{
-	  if (!saved_first)
-	    nis_freeresult (saved_res);
-	}
-
-      if (parse_res &&
-	  in_blacklist (result->pw_name, strlen (result->pw_name), ent))
-	parse_res = 0; /* if result->pw_name in blacklist,search next entry */
-    }
-  while (!parse_res);
-
-  copy_pwd_changes (result, &ent->pwd, p2, p2len);
-
-  return NSS_STATUS_SUCCESS;
-}
-
-static enum nss_status
-getpwent_next_nis (struct passwd *result, ent_t *ent, char *buffer,
+getpwent_next_nss (struct passwd *result, ent_t *ent, char *buffer,
 		   size_t buflen, int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
-  char *domain, *outkey, *outval, *p, *p2;
-  int outkeylen, outvallen, parse_res;
+  enum nss_status status;
+  char *p2;
   size_t p2len;
 
-  if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-    {
-      ent->nis = 0;
-      give_pwd_free (&ent->pwd);
-      return NSS_STATUS_UNAVAIL;
-    }
+  /* Return if NSS module does not support getpwent_r.  */
+  if (!nss_getpwent_r)
+    return NSS_STATUS_UNAVAIL;
 
   p2len = pwd_need_buflen (&ent->pwd);
   if (p2len > buflen)
@@ -707,103 +431,17 @@
     }
   p2 = buffer + (buflen - p2len);
   buflen -= p2len;
-  do
-    {
-      bool_t saved_first;
-      char *saved_oldkey;
-      int saved_oldlen;
-
-      if (ent->first)
-	{
-	  if (yp_first (domain, "passwd.byname", &outkey, &outkeylen,
-			&outval, &outvallen) != YPERR_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      give_pwd_free (&ent->pwd);
-	      return NSS_STATUS_UNAVAIL;
-	    }
-
-	  if (insert_passwd_adjunct (&outval, &outvallen, domain, errnop) !=
-	      NSS_STATUS_SUCCESS)
-	    {
-	      free (outval);
-	      return NSS_STATUS_TRYAGAIN;
-	    }
-
-	  if (buflen < ((size_t) outvallen + 1))
-	    {
-	      free (outval);
-	      *errnop = ERANGE;
-	      return NSS_STATUS_TRYAGAIN;
-	    }
-
-	  saved_first = TRUE;
-	  saved_oldkey = ent->oldkey;
-	  saved_oldlen = ent->oldkeylen;
-	  ent->oldkey = outkey;
-	  ent->oldkeylen = outkeylen;
-	  ent->first = FALSE;
-	}
-      else
-	{
-	  if (yp_next (domain, "passwd.byname", ent->oldkey, ent->oldkeylen,
-		       &outkey, &outkeylen, &outval, &outvallen)
-	      != YPERR_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      give_pwd_free (&ent->pwd);
-	      return NSS_STATUS_NOTFOUND;
-	    }
-
-	  if (insert_passwd_adjunct (&outval, &outvallen, domain, errnop)
-	      != NSS_STATUS_SUCCESS)
-	    {
-	      free (outval);
-	      return NSS_STATUS_TRYAGAIN;
-	    }
 
-	  if (buflen < ((size_t) outvallen + 1))
-	    {
-	      free (outval);
-	      *errnop = ERANGE;
-	      return NSS_STATUS_TRYAGAIN;
-	    }
+  if (ent->first)
+    ent->first = FALSE;
 
-	  saved_first = FALSE;
-	  saved_oldkey = ent->oldkey;
-	  saved_oldlen = ent->oldkeylen;
-	  ent->oldkey = outkey;
-	  ent->oldkeylen = outkeylen;
-	}
-
-      /* Copy the found data to our buffer  */
-      p = strncpy (buffer, outval, buflen);
-
-      /* ...and free the data.  */
-      free (outval);
-
-      while (isspace (*p))
-	++p;
-      parse_res = _nss_files_parse_pwent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  free (ent->oldkey);
-	  ent->oldkey = saved_oldkey;
-	  ent->oldkeylen = saved_oldlen;
-	  ent->first = saved_first;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      else
-	{
-	  if (!saved_first)
-	    free (saved_oldkey);
-	}
-      if (parse_res
-	  && in_blacklist (result->pw_name, strlen (result->pw_name), ent))
-	parse_res = 0;
+  do
+    {
+      if ((status = nss_getpwent_r (result, buffer, buflen, errnop)) !=
+	  NSS_STATUS_SUCCESS)
+	return status;
     }
-  while (!parse_res);
+  while (in_blacklist (result->pw_name, strlen (result->pw_name), ent));
 
   copy_pwd_changes (result, &ent->pwd, p2, p2len);
 
@@ -815,12 +453,13 @@
 getpwnam_plususer (const char *name, struct passwd *result, ent_t *ent,
 		   char *buffer, size_t buflen, int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
   struct passwd pwd;
-  int parse_res;
   char *p;
   size_t plen;
 
+  if (!nss_getpwnam_r)
+    return NSS_STATUS_UNAVAIL;
+
   memset (&pwd, '\0', sizeof (struct passwd));
 
   copy_pwd_changes (&pwd, result, NULL, 0);
@@ -834,88 +473,17 @@
   p = buffer + (buflen - plen);
   buflen -= plen;
 
-  if (use_nisplus) /* Do the NIS+ query here */
-    {
-      nis_result *res;
-      char buf[strlen (name) + 24 + pwdtablelen];
-
-      sprintf(buf, "[name=%s],%s", name, pwdtable);
-      res = nis_list(buf, FOLLOW_PATH | FOLLOW_LINKS, NULL, NULL);
-      if (niserr2nss (res->status) != NSS_STATUS_SUCCESS)
-	{
-	  enum nss_status status =  niserr2nss (res->status);
-
-	  nis_freeresult (res);
-	  return status;
-	}
-      parse_res = _nss_nisplus_parse_pwent (res, result, buffer,
-					    buflen, errnop);
-
-      nis_freeresult (res);
-
-      if (parse_res == -1)
-	{
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      if (in_blacklist (result->pw_name, strlen (result->pw_name), ent))
-	return NSS_STATUS_NOTFOUND;
-    }
-  else /* Use NIS */
-    {
-      char *domain, *outval, *ptr;
-      int outvallen;
-
-      if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (yp_match (domain, "passwd.byname", name, strlen (name),
-		    &outval, &outvallen) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (insert_passwd_adjunct (&outval, &outvallen, domain, errnop)
-	  != NSS_STATUS_SUCCESS)
-	{
-	  free (outval);
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      if (buflen < ((size_t) outvallen + 1))
-	{
-	  free (outval);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      ptr = strncpy (buffer, outval, buflen);
-      free (outval);
-
-      while (isspace (*ptr))
-	ptr++;
-
-      parse_res = _nss_files_parse_pwent (ptr, result, data, buflen, errnop);
-      if (parse_res == -1)
-	return NSS_STATUS_TRYAGAIN;
+  if (nss_getpwnam_r (name, result, buffer, buflen, errnop) !=
+      NSS_STATUS_SUCCESS)
+    return NSS_STATUS_NOTFOUND;
 
-      if (in_blacklist (result->pw_name, strlen (result->pw_name), ent))
-	return NSS_STATUS_NOTFOUND;
-    }
+  if (in_blacklist (result->pw_name, strlen (result->pw_name), ent))
+    return NSS_STATUS_NOTFOUND;
 
-  if (parse_res > 0)
-    {
-      copy_pwd_changes (result, &pwd, p, plen);
-      give_pwd_free (&pwd);
-      /* We found the entry.  */
-      return NSS_STATUS_SUCCESS;
-    }
-  else
-    {
-      /* Give buffer the old len back */
-      buflen += plen;
-      give_pwd_free (&pwd);
-    }
-  return NSS_STATUS_RETURN;
+  copy_pwd_changes (result, &pwd, p, plen);
+  give_pwd_free (&pwd);
+  /* We found the entry.  */
+  return NSS_STATUS_SUCCESS;
 }
 
 static enum nss_status
@@ -933,8 +501,8 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    return NSS_STATUS_NOTFOUND;
 
 	  if (p == NULL || buffer[buflen - 1] != '\xff')
@@ -951,9 +519,9 @@
 	  while (isspace (*p))
 	    ++p;
 	}
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines.  */
-      /* Parse the line.  If it is invalid, loop to
-         get the next line of the file to parse.  */
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines.  */
+	     /* Parse the line.  If it is invalid, loop to
+	        get the next line of the file to parse.  */
 	     !(parse_res = _nss_files_parse_pwent (p, result, data, buflen,
 						   errnop)));
 
@@ -1000,14 +568,9 @@
 	  ent->first = TRUE;
 	  copy_pwd_changes (&ent->pwd, result, NULL, 0);
 
-	  if (use_nisplus)
-	    status =  getpwent_next_nisplus_netgr (NULL, result, ent,
-						   &result->pw_name[2],
-						   buffer, buflen, errnop);
-	  else
-	    status =  getpwent_next_nis_netgr (NULL, result, ent,
-					       &result->pw_name[2],
-					       buffer, buflen, errnop);
+	  status = getpwent_next_nss_netgr (NULL, result, ent,
+					    &result->pw_name[2],
+					    buffer, buflen, errnop);
 	  if (status == NSS_STATUS_RETURN)
 	    continue;
 	  else
@@ -1026,45 +589,42 @@
       if (result->pw_name[0] == '+' && result->pw_name[1] != '\0'
 	  && result->pw_name[1] != '@')
 	{
-	  char buf[strlen (result->pw_name)];
+	  size_t len = strlen (result->pw_name);
+	  char buf[len];
 	  enum nss_status status;
 
 	  /* Store the User in the blacklist for the "+" at the end of
 	     /etc/passwd */
-	  strcpy (buf, &result->pw_name[1]);
+	  memcpy (buf, &result->pw_name[1], len);
 	  status = getpwnam_plususer (&result->pw_name[1], result, ent,
 				      buffer, buflen, errnop);
 	  blacklist_store_name (buf, ent);
 
-	  if (status == NSS_STATUS_SUCCESS) /* We found the entry. */
+	  if (status == NSS_STATUS_SUCCESS)	/* We found the entry. */
 	    break;
+	  else if (status == NSS_STATUS_RETURN	/* We couldn't parse the entry */
+		   || status == NSS_STATUS_NOTFOUND)	/* entry doesn't exist */
+	    continue;
 	  else
-	    if (status == NSS_STATUS_RETURN /* We couldn't parse the entry */
-		|| status == NSS_STATUS_NOTFOUND) /* entry doesn't exist */
-	      continue;
-	    else
-	      {
-		if (status == NSS_STATUS_TRYAGAIN)
-		  {
-		    /* The parser ran out of space */
-		    fsetpos (ent->stream, &pos);
-		    *errnop = ERANGE;
-		  }
-		return status;
-	      }
+	    {
+	      if (status == NSS_STATUS_TRYAGAIN)
+		{
+		  /* The parser ran out of space */
+		  fsetpos (ent->stream, &pos);
+		  *errnop = ERANGE;
+		}
+	      return status;
+	    }
 	}
 
       /* +:... */
       if (result->pw_name[0] == '+' && result->pw_name[1] == '\0')
 	{
-	  ent->nis = TRUE;
+	  ent->files = FALSE;
 	  ent->first = TRUE;
 	  copy_pwd_changes (&ent->pwd, result, NULL, 0);
 
-	  if (use_nisplus)
-	    return getpwent_next_nisplus (result, ent, buffer, buflen, errnop);
-	  else
-	    return getpwent_next_nis (result, ent, buffer, buflen, errnop);
+	  return getpwent_next_nss (result, ent, buffer, buflen, errnop);
 	}
     }
 
@@ -1082,53 +642,41 @@
 
       /* We are searching members in a netgroup */
       /* Since this is not the first call, we don't need the group name */
-      if (use_nisplus)
-	status = getpwent_next_nisplus_netgr (NULL, pw, ent, NULL, buffer,
-					      buflen, errnop);
-      else
-	status = getpwent_next_nis_netgr (NULL, pw, ent, NULL, buffer, buflen,
-					  errnop);
+      status = getpwent_next_nss_netgr (NULL, pw, ent, NULL, buffer, buflen,
+					errnop);
       if (status == NSS_STATUS_RETURN)
 	return getpwent_next_file (pw, ent, buffer, buflen, errnop);
       else
 	return status;
     }
+  else if (ent->files)
+    return getpwent_next_file (pw, ent, buffer, buflen, errnop);
   else
-    if (ent->nis)
-      {
-	if (use_nisplus)
-	  return getpwent_next_nisplus (pw, ent, buffer, buflen, errnop);
-	else
-	  return getpwent_next_nis (pw, ent, buffer, buflen, errnop);
-      }
-    else
-      return getpwent_next_file (pw, ent, buffer, buflen, errnop);
+    return getpwent_next_nss (pw, ent, buffer, buflen, errnop);
+
 }
 
 enum nss_status
 _nss_compat_getpwent_r (struct passwd *pwd, char *buffer, size_t buflen,
 			int *errnop)
 {
-  enum nss_status status = NSS_STATUS_SUCCESS;
+  enum nss_status result = NSS_STATUS_SUCCESS;
 
   __libc_lock_lock (lock);
 
+  /* Be prepared that the setpwent function was not called before.  */
   if (ni == NULL)
-    {
-      __nss_database_lookup ("passwd_compat", NULL, "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+    init_nss_interface ();
 
-  /* Be prepared that the setpwent function was not called before.  */
   if (ext_ent.stream == NULL)
-    status = internal_setpwent (&ext_ent);
+    result = internal_setpwent (&ext_ent, 1);
 
-  if (status == NSS_STATUS_SUCCESS)
-    status = internal_getpwent_r (pwd, &ext_ent, buffer, buflen, errnop);
+  if (result == NSS_STATUS_SUCCESS)
+    result = internal_getpwent_r (pwd, &ext_ent, buffer, buflen, errnop);
 
   __libc_lock_unlock (lock);
 
-  return status;
+  return result;
 }
 
 /* Searches in /etc/passwd and the NIS/NIS+ map for a special user */
@@ -1148,8 +696,8 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    {
 	      return NSS_STATUS_NOTFOUND;
 	    }
@@ -1167,9 +715,9 @@
 	  while (isspace (*p))
 	    ++p;
 	}
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines.  */
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines.  */
 	     /* Parse the line.  If it is invalid, loop to
-		get the next line of the file to parse.  */
+	        get the next line of the file to parse.  */
 	     !(parse_res = _nss_files_parse_pwent (p, result, data, buflen,
 						   errnop)));
 
@@ -1210,8 +758,8 @@
 	      status = getpwnam_plususer (name, result, ent, buffer,
 					  buflen, errnop);
 
-              if (status == NSS_STATUS_RETURN)
-                continue;
+	      if (status == NSS_STATUS_RETURN)
+		continue;
 
 	      return status;
 	    }
@@ -1253,13 +801,12 @@
 
 	  status = getpwnam_plususer (name, result, ent,
 				      buffer, buflen, errnop);
-	  if (status == NSS_STATUS_SUCCESS) /* We found the entry. */
+	  if (status == NSS_STATUS_SUCCESS)	/* We found the entry. */
 	    break;
+	  else if (status == NSS_STATUS_RETURN)	/* We couldn't parse the entry */
+	    return NSS_STATUS_NOTFOUND;
 	  else
-	    if (status == NSS_STATUS_RETURN) /* We couldn't parse the entry */
-	      return NSS_STATUS_NOTFOUND;
-	    else
-	      return status;
+	    return status;
 	}
     }
   return NSS_STATUS_SUCCESS;
@@ -1269,9 +816,9 @@
 _nss_compat_getpwnam_r (const char *name, struct passwd *pwd,
 			char *buffer, size_t buflen, int *errnop)
 {
-  ent_t ent = {0, 0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0},
-	       {NULL, NULL, 0, 0, NULL, NULL, NULL}};
-  enum nss_status status;
+  enum nss_status result;
+  ent_t ent = {0, 0, TRUE, NULL, {NULL, 0, 0},
+               {NULL, NULL, 0, 0, NULL, NULL, NULL}};
 
   if (name[0] == '-' || name[0] == '+')
     return NSS_STATUS_NOTFOUND;
@@ -1279,35 +826,32 @@
   __libc_lock_lock (lock);
 
   if (ni == NULL)
-    {
-      __nss_database_lookup ("passwd_compat", NULL, "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+    init_nss_interface ();
 
   __libc_lock_unlock (lock);
 
-  status = internal_setpwent (&ent);
-  if (status != NSS_STATUS_SUCCESS)
-    return status;
+  result = internal_setpwent (&ent, 0);
 
-  status = internal_getpwnam_r (name, pwd, &ent, buffer, buflen, errnop);
+  if (result == NSS_STATUS_SUCCESS)
+    result = internal_getpwnam_r (name, pwd, &ent, buffer, buflen, errnop);
 
   internal_endpwent (&ent);
 
-  return status;
+  return result;
 }
 
 /* This function handle the + entry in /etc/passwd for getpwuid */
 static enum nss_status
 getpwuid_plususer (uid_t uid, struct passwd *result, char *buffer,
-                   size_t buflen, int *errnop)
+		   size_t buflen, int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
   struct passwd pwd;
-  int parse_res;
   char *p;
   size_t plen;
 
+  if (!nss_getpwuid_r)
+    return NSS_STATUS_UNAVAIL;
+
   memset (&pwd, '\0', sizeof (struct passwd));
 
   copy_pwd_changes (&pwd, result, NULL, 0);
@@ -1321,70 +865,8 @@
   p = buffer + (buflen - plen);
   buflen -= plen;
 
-  if (use_nisplus) /* Do the NIS+ query here */
-    {
-      nis_result *res;
-      char buf[1024 + pwdtablelen];
-
-      snprintf (buf, sizeof (buf), "[uid=%lu],%s", (unsigned long int) uid,
-                pwdtable);
-      res = nis_list (buf, FOLLOW_PATH | FOLLOW_LINKS, NULL, NULL);
-      if (niserr2nss (res->status) != NSS_STATUS_SUCCESS)
-        {
-          enum nss_status status =  niserr2nss (res->status);
-
-          nis_freeresult (res);
-          return status;
-        }
-      if ((parse_res = _nss_nisplus_parse_pwent (res, result, buffer,
-                                                 buflen, errnop)) == -1)
-        {
-          nis_freeresult (res);
-          *errnop = ERANGE;
-          return NSS_STATUS_TRYAGAIN;
-        }
-      nis_freeresult (res);
-    }
-  else /* Use NIS */
-    {
-      char buf[1024];
-      char *domain, *outval, *ptr;
-      int outvallen;
-
-      if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      sprintf (buf, "%lu", (unsigned long int) uid);
-      if (yp_match (domain, "passwd.byuid", buf, strlen (buf),
-                    &outval, &outvallen)
-          != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (insert_passwd_adjunct (&outval, &outvallen, domain, errnop)
-          != NSS_STATUS_SUCCESS)
-        {
-          free (outval);
-          return NSS_STATUS_TRYAGAIN;
-        }
-
-      if (buflen < ((size_t) outvallen + 1))
-        {
-          free (outval);
-          *errnop = ERANGE;
-          return NSS_STATUS_TRYAGAIN;
-        }
-
-      ptr = strncpy (buffer, outval, buflen);
-      free (outval);
-
-      while (isspace (*ptr))
-        ptr++;
-      parse_res = _nss_files_parse_pwent (ptr, result, data, buflen, errnop);
-      if (parse_res == -1)
-        return NSS_STATUS_TRYAGAIN;
-    }
-
-  if (parse_res > 0)
+  if (nss_getpwuid_r (uid, result, buffer, buflen, errnop) ==
+      NSS_STATUS_SUCCESS)
     {
       copy_pwd_changes (result, &pwd, p, plen);
       give_pwd_free (&pwd);
@@ -1400,10 +882,10 @@
   return NSS_STATUS_RETURN;
 }
 
-/* Searches in /etc/passwd and the NIS/NIS+ map for a special user id */
+/* Searches in /etc/passwd and the NSS subsystem for a special user id */
 static enum nss_status
 internal_getpwuid_r (uid_t uid, struct passwd *result, ent_t *ent,
-                     char *buffer, size_t buflen, int *errnop)
+		     char *buffer, size_t buflen, int *errnop)
 {
   struct parser_data *data = (void *) buffer;
 
@@ -1414,75 +896,79 @@
       int parse_res;
 
       do
-        {
-          fgetpos (ent->stream, &pos);
-          buffer[buflen - 1] = '\xff';
-          p = fgets (buffer, buflen, ent->stream);
-          if (p == NULL && feof (ent->stream))
+	{
+	  fgetpos (ent->stream, &pos);
+	  buffer[buflen - 1] = '\xff';
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    return NSS_STATUS_NOTFOUND;
 
-          if (p == NULL || buffer[buflen - 1] != '\xff')
-            {
-              fsetpos (ent->stream, &pos);
-              *errnop = ERANGE;
-              return NSS_STATUS_TRYAGAIN;
-            }
-
-          /* Terminate the line for any case.  */
-          buffer[buflen - 1] = '\0';
-
-          /* Skip leading blanks.  */
-          while (isspace (*p))
-            ++p;
-        }
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines.  */
-             /* Parse the line.  If it is invalid, loop to
-                get the next line of the file to parse.  */
-             !(parse_res = _nss_files_parse_pwent (p, result, data, buflen,
-                                                   errnop)));
+	  if (p == NULL || buffer[buflen - 1] != '\xff')
+	    {
+	      fsetpos (ent->stream, &pos);
+	      *errnop = ERANGE;
+	      return NSS_STATUS_TRYAGAIN;
+	    }
+
+	  /* Terminate the line for any case.  */
+	  buffer[buflen - 1] = '\0';
+
+	  /* Skip leading blanks.  */
+	  while (isspace (*p))
+	    ++p;
+	}
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines.  */
+	     /* Parse the line.  If it is invalid, loop to
+	        get the next line of the file to parse.  */
+	     !(parse_res = _nss_files_parse_pwent (p, result, data, buflen,
+						   errnop)));
 
       if (parse_res == -1)
-        {
-          /* The parser ran out of space.  */
-          fsetpos (ent->stream, &pos);
-          *errnop = ERANGE;
-          return NSS_STATUS_TRYAGAIN;
-        }
+	{
+	  /* The parser ran out of space.  */
+	  fsetpos (ent->stream, &pos);
+	  *errnop = ERANGE;
+	  return NSS_STATUS_TRYAGAIN;
+	}
 
       /* This is a real entry.  */
       if (result->pw_name[0] != '+' && result->pw_name[0] != '-')
-        {
-          if (result->pw_uid == uid)
-            return NSS_STATUS_SUCCESS;
-          else
-            continue;
-        }
+	{
+	  if (result->pw_uid == uid)
+	    return NSS_STATUS_SUCCESS;
+	  else
+	    continue;
+	}
 
       /* -@netgroup */
       if (result->pw_name[0] == '-' && result->pw_name[1] == '@'
-          && result->pw_name[2] != '\0')
-        {
-	  char buf[strlen (result->pw_name)];
+	  && result->pw_name[2] != '\0')
+	{
+	  /* -1, because we remove first two character of pw_name.  */
+	  size_t len = strlen (result->pw_name) - 1;
+	  char buf[len];
 	  enum nss_status status;
 
-	  strcpy (buf, &result->pw_name[2]);
+	  memcpy (buf, &result->pw_name[2], len);
 
 	  status = getpwuid_plususer (uid, result, buffer, buflen, errnop);
 	  if (status == NSS_STATUS_SUCCESS &&
 	      innetgr (buf, NULL, result->pw_name, NULL))
 	    return NSS_STATUS_NOTFOUND;
 
-          continue;
-        }
+	  continue;
+	}
 
       /* +@netgroup */
       if (result->pw_name[0] == '+' && result->pw_name[1] == '@'
-          && result->pw_name[2] != '\0')
-        {
-	  char buf[strlen (result->pw_name)];
+	  && result->pw_name[2] != '\0')
+	{
+	  /* -1, because we remove first two characters of pw_name.  */
+	  size_t len = strlen (result->pw_name) - 1;
+	  char buf[len];
 	  enum nss_status status;
 
-	  strcpy (buf, &result->pw_name[2]);
+	  memcpy (buf, &result->pw_name[2], len);
 
 	  status = getpwuid_plususer (uid, result, buffer, buflen, errnop);
 
@@ -1494,39 +980,40 @@
 	      if (innetgr (buf, NULL, result->pw_name, NULL))
 		return NSS_STATUS_SUCCESS;
 	    }
+	  else if (status == NSS_STATUS_RETURN)	/* We couldn't parse the entry */
+	    return NSS_STATUS_NOTFOUND;
 	  else
-            if (status == NSS_STATUS_RETURN) /* We couldn't parse the entry */
-	      return NSS_STATUS_NOTFOUND;
-            else
-              return status;
+	    return status;
 
-          continue;
+	  continue;
 	}
 
       /* -user */
       if (result->pw_name[0] == '-' && result->pw_name[1] != '\0'
-          && result->pw_name[1] != '@')
-        {
-	  char buf[strlen (result->pw_name)];
+	  && result->pw_name[1] != '@')
+	{
+	  size_t len = strlen (result->pw_name);
+	  char buf[len];
 	  enum nss_status status;
 
-	  strcpy (buf, &result->pw_name[1]);
+	  memcpy (buf, &result->pw_name[1], len);
 
 	  status = getpwuid_plususer (uid, result, buffer, buflen, errnop);
 	  if (status == NSS_STATUS_SUCCESS &&
 	      innetgr (buf, NULL, result->pw_name, NULL))
 	    return NSS_STATUS_NOTFOUND;
-          continue;
-        }
+	  continue;
+	}
 
       /* +user */
       if (result->pw_name[0] == '+' && result->pw_name[1] != '\0'
-          && result->pw_name[1] != '@')
-        {
-	  char buf[strlen (result->pw_name)];
+	  && result->pw_name[1] != '@')
+	{
+	  size_t len = strlen (result->pw_name);
+	  char buf[len];
 	  enum nss_status status;
 
-	  strcpy (buf, &result->pw_name[1]);
+	  memcpy (buf, &result->pw_name[1], len);
 
 	  status = getpwuid_plususer (uid, result, buffer, buflen, errnop);
 
@@ -1538,60 +1025,54 @@
 	      if (strcmp (buf, result->pw_name) == 0)
 		return NSS_STATUS_SUCCESS;
 	    }
+	  else if (status == NSS_STATUS_RETURN)	/* We couldn't parse the entry */
+	    return NSS_STATUS_NOTFOUND;
 	  else
-            if (status == NSS_STATUS_RETURN) /* We couldn't parse the entry */
-	      return NSS_STATUS_NOTFOUND;
-            else
-              return status;
+	    return status;
 
-          continue;
-        }
+	  continue;
+	}
 
       /* +:... */
       if (result->pw_name[0] == '+' && result->pw_name[1] == '\0')
-        {
-          enum nss_status status;
+	{
+	  enum nss_status status;
 
-          status = getpwuid_plususer (uid, result, buffer, buflen, errnop);
-          if (status == NSS_STATUS_SUCCESS) /* We found the entry. */
-            break;
-          else
-            if (status == NSS_STATUS_RETURN) /* We couldn't parse the entry */
-	      return NSS_STATUS_NOTFOUND;
-            else
-              return status;
-        }
+	  status = getpwuid_plususer (uid, result, buffer, buflen, errnop);
+	  if (status == NSS_STATUS_SUCCESS)	/* We found the entry. */
+	    break;
+	  else if (status == NSS_STATUS_RETURN)	/* We couldn't parse the entry */
+	    return NSS_STATUS_NOTFOUND;
+	  else
+	    return status;
+	}
     }
   return NSS_STATUS_SUCCESS;
 }
 
 enum nss_status
 _nss_compat_getpwuid_r (uid_t uid, struct passwd *pwd,
-                        char *buffer, size_t buflen, int *errnop)
+			char *buffer, size_t buflen, int *errnop)
 {
-  ent_t ent = {0, 0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0},
+  enum nss_status result;
+  ent_t ent = {0, 0, TRUE, NULL, {NULL, 0, 0},
                {NULL, NULL, 0, 0, NULL, NULL, NULL}};
-  enum nss_status status;
 
   __libc_lock_lock (lock);
 
   if (ni == NULL)
-    {
-      __nss_database_lookup ("passwd_compat", NULL, "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+    init_nss_interface ();
 
   __libc_lock_unlock (lock);
 
-  status = internal_setpwent (&ent);
-  if (status != NSS_STATUS_SUCCESS)
-    return status;
+  result = internal_setpwent (&ent, 0);
 
-  status = internal_getpwuid_r (uid, pwd, &ent, buffer, buflen, errnop);
+  if (result == NSS_STATUS_SUCCESS)
+    result = internal_getpwuid_r (uid, pwd, &ent, buffer, buflen, errnop);
 
   internal_endpwent (&ent);
 
-  return status;
+  return result;
 }
 
 
@@ -1653,7 +1134,7 @@
 
   buf[0] = '|';
   cp = stpcpy (&buf[1], name);
-  *cp++= '|';
+  *cp++ = '|';
   *cp = '\0';
   return strstr (ent->blacklist.data, buf) != NULL;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_compat/compat-spwd.c libc-20030708/nis/nss_compat/compat-spwd.c
--- glibc-2.3.2/nis/nss_compat/compat-spwd.c	2002-08-26 14:08:20.000000000 +0900
+++ libc-20030708/nis/nss_compat/compat-spwd.c	2003-07-08 22:58:08.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-1999,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@vt.uni-paderborn.de>, 1996.
 
@@ -17,27 +17,29 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <nss.h>
-#include <errno.h>
 #include <ctype.h>
+#include <errno.h>
 #include <fcntl.h>
 #include <netdb.h>
+#include <nss.h>
+#include <nsswitch.h>
 #include <shadow.h>
+#include <stdio_ext.h>
 #include <string.h>
-#include <bits/libc-lock.h>
-#include <rpcsvc/yp.h>
+#include <rpc/types.h>
 #include <rpcsvc/ypclnt.h>
-#include <rpcsvc/nis.h>
-#include <nsswitch.h>
+#include <bits/libc-lock.h>
 
 #include "netgroup.h"
-#include "nss-nisplus.h"
-#include "nisplus-parser.h"
 
 static service_user *ni;
-static bool_t use_nisplus; /* default: passwd_compat: nis */
-static nis_name pwdtable; /* Name of the password table */
-static size_t pwdtablelen;
+static enum nss_status (*nss_setspent) (int stayopen);
+static enum nss_status (*nss_getspnam_r) (const char *name, struct spwd * sp,
+					  char *buffer, size_t buflen,
+					  int *errnop);
+static enum nss_status (*nss_getspent_r) (struct spwd * sp, char *buffer,
+					  size_t buflen, int *errnop);
+static enum nss_status (*nss_endspent) (void);
 
 /* Get the declaration of the parser function.  */
 #define ENTNAME spent
@@ -49,28 +51,25 @@
 #define BLACKLIST_INITIAL_SIZE 512
 #define BLACKLIST_INCREMENT 256
 struct blacklist_t
-  {
-    char *data;
-    int current;
-    int size;
-  };
+{
+  char *data;
+  int current;
+  int size;
+};
 
 struct ent_t
-  {
-    bool_t netgroup;
-    bool_t nis;
-    bool_t first;
-    char *oldkey;
-    int oldkeylen;
-    nis_result *result;
-    FILE *stream;
-    struct blacklist_t blacklist;
-    struct spwd pwd;
-    struct __netgrent netgrdata;
-  };
+{
+  bool_t netgroup;
+  bool_t files;
+  bool_t first;
+  FILE *stream;
+  struct blacklist_t blacklist;
+  struct spwd pwd;
+  struct __netgrent netgrdata;
+};
 typedef struct ent_t ent_t;
 
-static ent_t ext_ent = {0, 0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0},
+static ent_t ext_ent = {0, TRUE, 0, NULL, {NULL, 0, 0},
 			{NULL, NULL, 0, 0, 0, 0, 0, 0, 0}};
 
 /* Protect global state against multiple changers.  */
@@ -80,6 +79,21 @@
 static void blacklist_store_name (const char *, ent_t *);
 static int in_blacklist (const char *, int, ent_t *);
 
+/* Initialize the NSS interface/functions. The calling function must
+   hold the lock.  */
+static void
+init_nss_interface (void)
+{
+  if (__nss_database_lookup ("shadow_compat", "passwd_compat",
+			     "nis", &ni) >= 0)
+    {
+      nss_setspent = __nss_lookup_function (ni, "setspent");
+      nss_getspnam_r = __nss_lookup_function (ni, "getspnam_r");
+      nss_getspent_r = __nss_lookup_function (ni, "getspent_r");
+      nss_endspent = __nss_lookup_function (ni, "endspent");
+    }
+}
+
 static void
 give_spwd_free (struct spwd *pwd)
 {
@@ -142,45 +156,17 @@
 }
 
 static enum nss_status
-internal_setspent (ent_t *ent)
+internal_setspent (ent_t *ent, int stayopen)
 {
   enum nss_status status = NSS_STATUS_SUCCESS;
 
-  ent->nis = ent->first = ent->netgroup = 0;
+  ent->first = ent->netgroup = 0;
+  ent->files = TRUE;
 
   /* If something was left over free it.  */
   if (ent->netgroup)
     __internal_endnetgrent (&ent->netgrdata);
 
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
-
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
-
-  if (pwdtable == NULL)
-    {
-      static const char key[] = "passwd.org_dir.";
-      const char *local_dir = nis_local_directory ();
-      size_t len_local_dir = strlen (local_dir);
-
-      pwdtable = malloc (sizeof (key) + len_local_dir);
-      if (pwdtable == NULL)
-        return NSS_STATUS_TRYAGAIN;
-
-      pwdtablelen = ((char *) mempcpy (mempcpy (pwdtable,
-						key, sizeof (key) - 1),
-				       local_dir, len_local_dir + 1)
-		     - pwdtable) - 1;
-    }
-
   if (ent->blacklist.data != NULL)
     {
       ent->blacklist.current = 1;
@@ -192,7 +178,7 @@
 
   if (ent->stream == NULL)
     {
-      ent->stream = fopen ("/etc/shadow", "r");
+      ent->stream = fopen ("/etc/shadow", "rm");
 
       if (ent->stream == NULL)
 	status = errno == EAGAIN ? NSS_STATUS_TRYAGAIN : NSS_STATUS_UNAVAIL;
@@ -201,20 +187,23 @@
 	  /* We have to make sure the file is  `closed on exec'.  */
 	  int result, flags;
 
-	  result = flags = fcntl (fileno (ent->stream), F_GETFD, 0);
+	  result = flags = fcntl (fileno_unlocked (ent->stream), F_GETFD, 0);
 	  if (result >= 0)
 	    {
 	      flags |= FD_CLOEXEC;
-	      result = fcntl (fileno (ent->stream), F_SETFD, flags);
+	      result = fcntl (fileno_unlocked (ent->stream), F_SETFD, flags);
 	    }
 	  if (result < 0)
 	    {
 	      /* Something went wrong.  Close the stream and return a
-		 failure.  */
+	         failure.  */
 	      fclose (ent->stream);
 	      ent->stream = NULL;
 	      status = NSS_STATUS_UNAVAIL;
 	    }
+	  else
+	    /* We take care of locking ourself.  */
+	    __fsetlocking (ent->stream, FSETLOCKING_BYCALLER);
 	}
     }
   else
@@ -222,6 +211,9 @@
 
   give_spwd_free (&ent->pwd);
 
+  if (status == NSS_STATUS_SUCCESS && nss_setspent)
+    return nss_setspent (stayopen);
+
   return status;
 }
 
@@ -234,12 +226,9 @@
   __libc_lock_lock (lock);
 
   if (ni == NULL)
-    {
-      __nss_database_lookup ("shadow_compat", "passwd_compat", "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+    init_nss_interface ();
 
-  result = internal_setspent (&ext_ent);
+  result = internal_setspent (&ext_ent, stayopen);
 
   __libc_lock_unlock (lock);
 
@@ -250,6 +239,9 @@
 static enum nss_status
 internal_endspent (ent_t *ent)
 {
+  if (nss_endspent)
+    nss_endspent ();
+
   if (ent->stream != NULL)
     {
       fclose (ent->stream);
@@ -259,20 +251,8 @@
   if (ent->netgroup)
     __internal_endnetgrent (&ent->netgrdata);
 
-  ent->nis = ent->first = ent->netgroup = 0;
-
-  if (ent->oldkey != NULL)
-    {
-      free (ent->oldkey);
-      ent->oldkey = NULL;
-      ent->oldkeylen = 0;
-    }
-
-  if (ent->result != NULL)
-    {
-      nis_freeresult (ent->result);
-      ent->result = NULL;
-    }
+  ent->first = ent->netgroup = FALSE;
+  ent->files = TRUE;
 
   if (ent->blacklist.data != NULL)
     {
@@ -304,25 +284,27 @@
 
 
 static enum nss_status
-getspent_next_nis_netgr (const char *name, struct spwd *result, ent_t *ent,
-			 char *group, char *buffer, size_t buflen, int *errnop)
+getspent_next_nss_netgr (const char *name, struct spwd *result, ent_t *ent,
+			 char *group, char *buffer, size_t buflen,
+			 int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
-  char *ypdomain, *host, *user, *domain, *outval, *p, *p2;
-  int status, outvallen;
+  char *curdomain, *host, *user, *domain, *p2;
   size_t p2len;
 
-  if (yp_get_default_domain (&ypdomain) != YPERR_SUCCESS)
+  if (!nss_getspnam_r)
+    return NSS_STATUS_UNAVAIL;
+
+  if (yp_get_default_domain (&curdomain) != YPERR_SUCCESS)
     {
-      ent->netgroup = 0;
-      ent->first = 0;
+      ent->netgroup = FALSE;
+      ent->first = FALSE;
       give_spwd_free (&ent->pwd);
       return NSS_STATUS_UNAVAIL;
     }
 
   if (ent->first == TRUE)
     {
-      bzero (&ent->netgrdata, sizeof (struct __netgrent));
+      memset (&ent->netgrdata, 0, sizeof (struct __netgrent));
       __internal_setnetgrent (group, &ent->netgrdata);
       ent->first = FALSE;
     }
@@ -330,7 +312,7 @@
   while (1)
     {
       char *saved_cursor;
-      int parse_res;
+      enum nss_status status;
 
       saved_cursor = ent->netgrdata.cursor;
       status = __internal_getnetgrent_r (&host, &user, &domain,
@@ -339,7 +321,7 @@
       if (status != 1)
 	{
 	  __internal_endnetgrent (&ent->netgrdata);
-	  ent->netgroup = 0;
+	  ent->netgroup = FALSE;
 	  give_spwd_free (&ent->pwd);
 	  return NSS_STATUS_RETURN;
 	}
@@ -347,7 +329,7 @@
       if (user == NULL || user[0] == '-')
 	continue;
 
-      if (domain != NULL && strcmp (ypdomain, domain) != 0)
+      if (domain != NULL && strcmp (curdomain, domain) != 0)
 	continue;
 
       /* If name != NULL, we are called from getpwnam */
@@ -355,240 +337,43 @@
 	if (strcmp (user, name) != 0)
 	  continue;
 
-      if (yp_match (ypdomain, "shadow.byname", user,
-		    strlen (user), &outval, &outvallen)
-	  != YPERR_SUCCESS)
-	continue;
-
       p2len = spwd_need_buflen (&ent->pwd);
       if (p2len > buflen)
 	{
-	  free (outval);
 	  *errnop = ERANGE;
 	  return NSS_STATUS_TRYAGAIN;
 	}
       p2 = buffer + (buflen - p2len);
       buflen -= p2len;
-      if (buflen < ((size_t) outval + 1))
-	{
-	  free (outval);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      p = strncpy (buffer, outval, buflen);
-      while (isspace (*p))
-	p++;
-      free (outval);
-      parse_res = _nss_files_parse_spent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  ent->netgrdata.cursor = saved_cursor;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-
-      if (parse_res)
-	{
-	  /* Store the User in the blacklist for the "+" at the end of
-	     /etc/passwd */
-	  blacklist_store_name (result->sp_namp, ent);
-	  copy_spwd_changes (result, &ent->pwd, p2, p2len);
-	  break;
-	}
-    }
-
-  return NSS_STATUS_SUCCESS;
-}
-
-static enum nss_status
-getspent_next_nisplus_netgr (const char *name, struct spwd *result,
-			     ent_t *ent, char *group, char *buffer,
-			     size_t buflen, int *errnop)
-{
-  char *ypdomain, *host, *user, *domain, *p2;
-  int status, parse_res;
-  size_t p2len;
-  nis_result *nisres;
-
-  /* Maybe we should use domainname here ? We need the current
-     domainname for the domain field in netgroups */
-  if (yp_get_default_domain (&ypdomain) != YPERR_SUCCESS)
-    {
-      ent->netgroup = 0;
-      ent->first = 0;
-      give_spwd_free (&ent->pwd);
-      return NSS_STATUS_UNAVAIL;
-    }
 
-  if (ent->first == TRUE)
-    {
-      bzero (&ent->netgrdata, sizeof (struct __netgrent));
-      __internal_setnetgrent (group, &ent->netgrdata);
-      ent->first = FALSE;
-    }
-
-  while (1)
-    {
-      char *saved_cursor;
-
-      saved_cursor = ent->netgrdata.cursor;
-      status = __internal_getnetgrent_r (&host, &user, &domain,
-                                         &ent->netgrdata, buffer, buflen,
-					 errnop);
-      if (status != 1)
-        {
-          __internal_endnetgrent (&ent->netgrdata);
-          ent->netgroup = 0;
-          give_spwd_free (&ent->pwd);
-          return NSS_STATUS_RETURN;
-        }
-
-      if (user == NULL || user[0] == '-')
-        continue;
-
-      if (domain != NULL && strcmp (ypdomain, domain) != 0)
-        continue;
-
-      /* If name != NULL, we are called from getpwnam */
-      if (name != NULL)
-	if (strcmp (user, name) != 0)
-	  continue;
+      if (nss_getspnam_r (user, result, buffer, buflen, errnop) !=
+	  NSS_STATUS_SUCCESS)
+	continue;
 
-      p2len = spwd_need_buflen (&ent->pwd);
-      if (p2len > buflen)
-        {
-          *errnop = ERANGE;
-          return NSS_STATUS_TRYAGAIN;
-        }
-      p2 = buffer + (buflen - p2len);
-      buflen -= p2len;
-      {
-        char buf[strlen (user) + 30 + pwdtablelen];
-        sprintf (buf, "[name=%s],%s", user, pwdtable);
-        nisres = nis_list (buf, FOLLOW_LINKS | FOLLOW_PATH, NULL, NULL);
-      }
-      if (niserr2nss (nisres->status) != NSS_STATUS_SUCCESS)
-        {
-          nis_freeresult (nisres);
-          continue;
-        }
-      parse_res = _nss_nisplus_parse_spent (nisres, result, buffer,
-					    buflen, errnop);
-      if (parse_res == -1)
+      if (!in_blacklist (result->sp_namp, strlen (result->sp_namp), ent))
 	{
-	  nis_freeresult (nisres);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      nis_freeresult (nisres);
-
-      if (parse_res)
-        {
-	  /* Store the User in the blacklist for the "+" at the end of
-	     /etc/passwd */
+	  /* Store the User in the blacklist for possible the "+" at the
+	     end of /etc/passwd */
 	  blacklist_store_name (result->sp_namp, ent);
 	  copy_spwd_changes (result, &ent->pwd, p2, p2len);
-          break;
-        }
-    }
-
-  return NSS_STATUS_SUCCESS;
-}
-
-static enum nss_status
-getspent_next_nisplus (struct spwd *result, ent_t *ent, char *buffer,
-                       size_t buflen, int *errnop)
-{
-  int parse_res;
-  size_t p2len;
-  char *p2;
-
-  p2len = spwd_need_buflen (&ent->pwd);
-  if (p2len > buflen)
-    {
-      *errnop = ERANGE;
-      return NSS_STATUS_TRYAGAIN;
-    }
-  p2 = buffer + (buflen - p2len);
-  buflen -= p2len;
-  do
-    {
-      bool_t saved_first;
-      nis_result *saved_res;
-
-      if (ent->first)
-        {
-	  saved_first = TRUE;
-	  saved_res = ent->result;
-
-          ent->result = nis_first_entry (pwdtable);
-          if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-            {
-              ent->nis = 0;
-              give_spwd_free (&ent->pwd);
-              return niserr2nss (ent->result->status);
-            }
-          ent->first = FALSE;
-        }
-      else
-        {
-          nis_result *res;
-
-	  saved_first = FALSE;
-	  saved_res = ent->result;
-
-          res = nis_next_entry (pwdtable, &ent->result->cookie);
-          ent->result = res;
-          if (niserr2nss (ent->result->status) != NSS_STATUS_SUCCESS)
-            {
-	      nis_freeresult (saved_res);
-	      ent->nis = 0;
-	      give_spwd_free (&ent->pwd);
-	      return niserr2nss (ent->result->status);
-            }
-        }
-      parse_res = _nss_nisplus_parse_spent (ent->result, result, buffer,
-					    buflen, errnop);
-      if (parse_res == -1)
-	{
-	  ent->first = saved_first;
-	  nis_freeresult (ent->result);
-	  ent->result = saved_res;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      else
-	{
-	  if (!saved_first)
-	    nis_freeresult (saved_res);
+	  break;
 	}
-      if (parse_res &&
-          in_blacklist (result->sp_namp, strlen (result->sp_namp), ent))
-        parse_res = 0; /* if result->pw_name in blacklist,search next entry */
     }
-  while (!parse_res);
-
-  copy_spwd_changes (result, &ent->pwd, p2, p2len);
 
   return NSS_STATUS_SUCCESS;
 }
 
 
 static enum nss_status
-getspent_next_nis (struct spwd *result, ent_t *ent,
+getspent_next_nss (struct spwd *result, ent_t *ent,
 		   char *buffer, size_t buflen, int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
-  char *domain, *outkey, *outval, *p, *p2;
-  int outkeylen, outvallen, parse_res;
+  enum nss_status status;
+  char *p2;
   size_t p2len;
 
-  if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-    {
-      ent->nis = 0;
-      give_spwd_free (&ent->pwd);
-      return NSS_STATUS_UNAVAIL;
-    }
+  if (!nss_getspent_r)
+    return NSS_STATUS_UNAVAIL;
 
   p2len = spwd_need_buflen (&ent->pwd);
   if (p2len > buflen)
@@ -600,87 +385,11 @@
   buflen -= p2len;
   do
     {
-      bool_t saved_first;
-      char *saved_oldkey;
-      int saved_oldlen;
-
-      if (ent->first)
-	{
-	  if (yp_first (domain, "shadow.byname", &outkey, &outkeylen,
-			&outval, &outvallen) != YPERR_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      give_spwd_free (&ent->pwd);
-	      return NSS_STATUS_UNAVAIL;
-	    }
-
-	  if (buflen < ((size_t) outvallen + 1))
-	    {
-	      free (outval);
-	      *errnop = ERANGE;
-	      return NSS_STATUS_TRYAGAIN;
-	    }
-
-	  saved_first = TRUE;
-	  saved_oldkey = ent->oldkey;
-	  saved_oldlen = ent->oldkeylen;
-	  ent->oldkey = outkey;
-	  ent->oldkeylen = outkeylen;
-	  ent->first = FALSE;
-	}
-      else
-	{
-	  if (yp_next (domain, "shadow.byname", ent->oldkey, ent->oldkeylen,
-		       &outkey, &outkeylen, &outval, &outvallen)
-	      != YPERR_SUCCESS)
-	    {
-	      ent->nis = 0;
-	      give_spwd_free (&ent->pwd);
-	      return NSS_STATUS_NOTFOUND;
-	    }
-
-	  if (buflen < ((size_t) outvallen + 1))
-	    {
-	      free (outval);
-	      *errnop = ERANGE;
-	      return NSS_STATUS_TRYAGAIN;
-	    }
-
-	  saved_first = FALSE;
-	  saved_oldkey = ent->oldkey;
-	  saved_oldlen = ent->oldkeylen;
-	  ent->oldkey = outkey;
-	  ent->oldkeylen = outkeylen;
-	}
-
-      /* Copy the found data to our buffer  */
-      p = strncpy (buffer, outval, buflen);
-
-      /* ...and free the data.  */
-      free (outval);
-
-      while (isspace (*p))
-	++p;
-      parse_res = _nss_files_parse_spent (p, result, data, buflen, errnop);
-      if (parse_res == -1)
-	{
-	  free (ent->oldkey);
-	  ent->oldkey = saved_oldkey;
-	  ent->oldkeylen = saved_oldlen;
-	  ent->first = saved_first;
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      else
-	{
-	  if (!saved_first)
-	    free (saved_oldkey);
-	}
-      if (parse_res &&
-          in_blacklist (result->sp_namp, strlen (result->sp_namp), ent))
-        parse_res = 0;
+      if ((status = nss_getspent_r (result, buffer, buflen, errnop)) !=
+	  NSS_STATUS_SUCCESS)
+	return status;
     }
-  while (!parse_res);
+  while (in_blacklist (result->sp_namp, strlen (result->sp_namp), ent));
 
   copy_spwd_changes (result, &ent->pwd, p2, p2len);
 
@@ -689,15 +398,16 @@
 
 /* This function handle the +user entrys in /etc/shadow */
 static enum nss_status
-getspnam_plususer (const char *name, struct spwd *result, char *buffer,
-		   size_t buflen, int *errnop)
+getspnam_plususer (const char *name, struct spwd *result, ent_t *ent,
+		   char *buffer, size_t buflen, int *errnop)
 {
-  struct parser_data *data = (void *) buffer;
   struct spwd pwd;
-  int parse_res;
   char *p;
   size_t plen;
 
+  if (!nss_getspnam_r)
+    return NSS_STATUS_UNAVAIL;
+
   memset (&pwd, '\0', sizeof (struct spwd));
   pwd.sp_warn = -1;
   pwd.sp_inact = -1;
@@ -715,71 +425,16 @@
   p = buffer + (buflen - plen);
   buflen -= plen;
 
-  if (use_nisplus) /* Do the NIS+ query here */
-    {
-      nis_result *res;
-      char buf[strlen (name) + 24 + pwdtablelen];
-
-      sprintf(buf, "[name=%s],%s", name, pwdtable);
-      res = nis_list(buf, 0, NULL, NULL);
-      if (niserr2nss (res->status) != NSS_STATUS_SUCCESS)
-        {
-          enum nss_status status =  niserr2nss (res->status);
-
-          nis_freeresult (res);
-          return status;
-        }
-      parse_res = _nss_nisplus_parse_spent (res, result, buffer,
-					    buflen, errnop);
-      if (parse_res == -1)
-	{
-	  nis_freeresult (res);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
-      nis_freeresult (res);
-    }
-  else /* Use NIS */
-    {
-      char *domain, *outval, *ptr;
-      int outvallen;
-
-      if (yp_get_default_domain (&domain) != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (yp_match (domain, "shadow.byname", name, strlen (name),
-		    &outval, &outvallen)  != YPERR_SUCCESS)
-	return NSS_STATUS_NOTFOUND;
-
-      if (buflen < ((size_t) outvallen + 1))
-	{
-	  free (outval);
-	  *errnop = ERANGE;
-	  return NSS_STATUS_TRYAGAIN;
-	}
+  if (nss_getspnam_r (name, result, buffer, buflen, errnop) !=
+      NSS_STATUS_SUCCESS)
+    return NSS_STATUS_NOTFOUND;
 
-      ptr = strncpy (buffer, outval, buflen);
-      free (outval);
-      while (isspace (*ptr))
-        ptr++;
-      parse_res = _nss_files_parse_spent (ptr, result, data, buflen, errnop);
-      if (parse_res == -1)
-	return NSS_STATUS_TRYAGAIN;
-    }
+  if (in_blacklist (result->sp_namp, strlen (result->sp_namp), ent))
+    return NSS_STATUS_NOTFOUND;
 
-  if (parse_res)
-    {
-      copy_spwd_changes (result, &pwd, p, plen);
-      give_spwd_free (&pwd);
-      /* We found the entry.  */
-      return NSS_STATUS_SUCCESS;
-    }
-  else
-    {
-      /* Give buffer the old len back */
-      buflen += plen;
-      give_spwd_free (&pwd);
-    }
+  copy_spwd_changes (result, &pwd, p, plen);
+  give_spwd_free (&pwd);
+  /* We found the entry.  */
   return NSS_STATUS_RETURN;
 }
 
@@ -798,8 +453,8 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    return NSS_STATUS_NOTFOUND;
 
 	  if (p == NULL || buffer[buflen - 1] != '\xff')
@@ -814,18 +469,18 @@
 	    ++p;
 	}
       while (*p == '\0' || *p == '#'	/* Ignore empty and comment lines.  */
-      /* Parse the line.  If it is invalid, loop to
-         get the next line of the file to parse.  */
+	     /* Parse the line.  If it is invalid, loop to
+	        get the next line of the file to parse.  */
 	     || !(parse_res = _nss_files_parse_spent (p, result, data,
 						      buflen, errnop)));
 
       if (parse_res == -1)
-        {
-          /* The parser ran out of space.  */
-          fsetpos (ent->stream, &pos);
-          *errnop = ERANGE;
-          return NSS_STATUS_TRYAGAIN;
-        }
+	{
+	  /* The parser ran out of space.  */
+	  fsetpos (ent->stream, &pos);
+	  *errnop = ERANGE;
+	  return NSS_STATUS_TRYAGAIN;
+	}
 
       if (result->sp_namp[0] != '+' && result->sp_namp[0] != '-')
 	/* This is a real entry.  */
@@ -836,12 +491,12 @@
 	  && result->sp_namp[2] != '\0')
 	{
 	  /* XXX Do not use fixed length buffers.  */
-          char buf2[1024];
+	  char buf2[1024];
 	  char *user, *host, *domain;
-          struct __netgrent netgrdata;
+	  struct __netgrent netgrdata;
 
-          bzero (&netgrdata, sizeof (struct __netgrent));
-          __internal_setnetgrent (&result->sp_namp[2], &netgrdata);
+	  bzero (&netgrdata, sizeof (struct __netgrent));
+	  __internal_setnetgrent (&result->sp_namp[2], &netgrdata);
 	  while (__internal_getnetgrent_r (&host, &user, &domain,
 					   &netgrdata, buf2, sizeof (buf2),
 					   errnop))
@@ -863,14 +518,9 @@
 	  ent->first = TRUE;
 	  copy_spwd_changes (&ent->pwd, result, NULL, 0);
 
-	  if (use_nisplus)
-	    status = getspent_next_nisplus_netgr (NULL, result, ent,
-						  &result->sp_namp[2],
-						  buffer, buflen, errnop);
-	  else
-	    status = getspent_next_nis_netgr (NULL, result, ent,
-					      &result->sp_namp[2],
-					      buffer, buflen, errnop);
+	  status = getspent_next_nss_netgr (NULL, result, ent,
+					    &result->sp_namp[2],
+					    buffer, buflen, errnop);
 	  if (status == NSS_STATUS_RETURN)
 	    continue;
 	  else
@@ -889,41 +539,38 @@
       if (result->sp_namp[0] == '+' && result->sp_namp[1] != '\0'
 	  && result->sp_namp[1] != '@')
 	{
-          enum nss_status status;
+	  enum nss_status status;
 
 	  /* Store the User in the blacklist for the "+" at the end of
 	     /etc/passwd */
 	  blacklist_store_name (&result->sp_namp[1], ent);
-          status = getspnam_plususer (&result->sp_namp[1], result, buffer,
-				      buflen, errnop);
-          if (status == NSS_STATUS_SUCCESS) /* We found the entry. */
-            break;
-          else
-            if (status == NSS_STATUS_RETURN /* We couldn't parse the entry */
-		|| status == NSS_STATUS_NOTFOUND) /* entry doesn't exist */
-              continue;
-            else
-	      {
-		if (status == NSS_STATUS_TRYAGAIN)
-		  {
-		    fsetpos (ent->stream, &pos);
-		    *errnop = ERANGE;
-		  }
-		return status;
-	      }
+	  status = getspnam_plususer (&result->sp_namp[1], result, ent,
+				      buffer, buflen, errnop);
+
+	  if (status == NSS_STATUS_SUCCESS)	/* We found the entry. */
+	    break;
+	  else if (status == NSS_STATUS_RETURN	/* We couldn't parse the entry */
+		   || status == NSS_STATUS_NOTFOUND)	/* entry doesn't exist */
+	    continue;
+	  else
+	    {
+	      if (status == NSS_STATUS_TRYAGAIN)
+		{
+		  fsetpos (ent->stream, &pos);
+		  *errnop = ERANGE;
+		}
+	      return status;
+	    }
 	}
 
       /* +:... */
       if (result->sp_namp[0] == '+' && result->sp_namp[1] == '\0')
 	{
-	  ent->nis = TRUE;
+	  ent->files = FALSE;
 	  ent->first = TRUE;
 	  copy_spwd_changes (&ent->pwd, result, NULL, 0);
 
-	  if (use_nisplus)
-	    return getspent_next_nisplus (result, ent, buffer, buflen, errnop);
-	  else
-	    return getspent_next_nis (result, ent, buffer, buflen, errnop);
+	  return getspent_next_nss (result, ent, buffer, buflen, errnop);
 	}
     }
 
@@ -937,57 +584,45 @@
 {
   if (ent->netgroup)
     {
-      int status;
+      enum nss_status status;
 
       /* We are searching members in a netgroup */
       /* Since this is not the first call, we don't need the group name */
-      if (use_nisplus)
-	status = getspent_next_nisplus_netgr (NULL, pw, ent, NULL, buffer,
-					      buflen, errnop);
-      else
-	status = getspent_next_nis_netgr (NULL, pw, ent, NULL, buffer, buflen,
-					  errnop);
+      status = getspent_next_nss_netgr (NULL, pw, ent, NULL, buffer,
+					buflen, errnop);
+
       if (status == NSS_STATUS_RETURN)
 	return getspent_next_file (pw, ent, buffer, buflen, errnop);
       else
 	return status;
     }
+  else if (ent->files)
+    return getspent_next_file (pw, ent, buffer, buflen, errnop);
   else
-    if (ent->nis)
-      {
-	if (use_nisplus)
-	  return getspent_next_nisplus (pw, ent, buffer, buflen, errnop);
-	else
-	  return getspent_next_nis (pw, ent, buffer, buflen, errnop);
-      }
-    else
-      return getspent_next_file (pw, ent, buffer, buflen, errnop);
+    return getspent_next_nss (pw, ent, buffer, buflen, errnop);
 }
 
 enum nss_status
 _nss_compat_getspent_r (struct spwd *pwd, char *buffer, size_t buflen,
 			int *errnop)
 {
-  enum nss_status status = NSS_STATUS_SUCCESS;
+  enum nss_status result = NSS_STATUS_SUCCESS;
 
   __libc_lock_lock (lock);
 
+  /* Be prepared that the setpwent function was not called before.  */
   if (ni == NULL)
-    {
-      __nss_database_lookup ("shadow_compat", "passwd_compat", "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+    init_nss_interface ();
 
-  /* Be prepared that the setspent function was not called before.  */
   if (ext_ent.stream == NULL)
-    status = internal_setspent (&ext_ent);
+    result = internal_setspent (&ext_ent, 1);
 
-  if (status == NSS_STATUS_SUCCESS)
-    status = internal_getspent_r (pwd, &ext_ent, buffer, buflen, errnop);
+  if (result == NSS_STATUS_SUCCESS)
+    result = internal_getspent_r (pwd, &ext_ent, buffer, buflen, errnop);
 
   __libc_lock_unlock (lock);
 
-  return status;
+  return result;
 }
 
 /* Searches in /etc/passwd and the NIS/NIS+ map for a special user */
@@ -1007,8 +642,8 @@
 	{
 	  fgetpos (ent->stream, &pos);
 	  buffer[buflen - 1] = '\xff';
-	  p = fgets (buffer, buflen, ent->stream);
-	  if (p == NULL && feof (ent->stream))
+	  p = fgets_unlocked (buffer, buflen, ent->stream);
+	  if (p == NULL && feof_unlocked (ent->stream))
 	    return NSS_STATUS_NOTFOUND;
 
 	  if (p == NULL || buffer[buflen - 1] != '\xff')
@@ -1022,9 +657,9 @@
 	  while (isspace (*p))
 	    ++p;
 	}
-      while (*p == '\0' || *p == '#' || /* Ignore empty and comment lines.  */
+      while (*p == '\0' || *p == '#' ||	/* Ignore empty and comment lines.  */
 	     /* Parse the line.  If it is invalid, loop to
-		get the next line of the file to parse.  */
+	        get the next line of the file to parse.  */
 	     !(parse_res = _nss_files_parse_spent (p, result, data, buflen,
 						   errnop)));
 
@@ -1046,6 +681,8 @@
 	}
 
       /* -@netgroup */
+      /* If the loaded NSS module does not support this service, add
+         all users from a +@netgroup entry to the blacklist, too.  */
       if (result->sp_namp[0] == '-' && result->sp_namp[1] == '@'
 	  && result->sp_namp[2] != '\0')
 	{
@@ -1080,19 +717,16 @@
 
 	  do
 	    {
-	      if (use_nisplus)
-		status = getspent_next_nisplus_netgr (name, result, ent, buf,
-						      buffer, buflen, errnop);
-	      else
-		status = getspent_next_nis_netgr (name, result, ent, buf,
-						  buffer, buflen, errnop);
+	      status = getspent_next_nss_netgr (name, result, ent, buf,
+						buffer, buflen, errnop);
 	      if (status == NSS_STATUS_RETURN)
 		continue;
 
 	      if (status == NSS_STATUS_SUCCESS
 		  && strcmp (result->sp_namp, name) == 0)
 		return NSS_STATUS_SUCCESS;
-	    } while (status == NSS_STATUS_SUCCESS);
+	    }
+	  while (status == NSS_STATUS_SUCCESS);
 	  continue;
 	}
 
@@ -1114,8 +748,9 @@
 	    {
 	      enum nss_status status;
 
-	      status = getspnam_plususer (name, result, buffer, buflen,
-					  errnop);
+	      status = getspnam_plususer (name, result, ent,
+					  buffer, buflen, errnop);
+
 	      if (status == NSS_STATUS_RETURN)
 		/* We couldn't parse the entry */
 		return NSS_STATUS_NOTFOUND;
@@ -1129,8 +764,10 @@
 	{
 	  enum nss_status status;
 
-	  status = getspnam_plususer (name, result, buffer, buflen, errnop);
-	  if (status == NSS_STATUS_RETURN) /* We couldn't parse the entry */
+	  status = getspnam_plususer (name, result, ent,
+				      buffer, buflen, errnop);
+
+	  if (status == NSS_STATUS_RETURN)	/* We couldn't parse the entry */
 	    return NSS_STATUS_NOTFOUND;
 	  else
 	    return status;
@@ -1143,28 +780,30 @@
 _nss_compat_getspnam_r (const char *name, struct spwd *pwd,
 			char *buffer, size_t buflen, int *errnop)
 {
-  ent_t ent = {0, 0, 0, NULL, 0, NULL, NULL, {NULL, 0, 0},
+  enum nss_status result;
+  ent_t ent = {0, TRUE, 0, NULL, {NULL, 0, 0},
 	       {NULL, NULL, 0, 0, 0, 0, 0, 0, 0}};
-  enum nss_status status;
 
   if (name[0] == '-' || name[0] == '+')
     return NSS_STATUS_NOTFOUND;
 
+  __libc_lock_lock (lock);
+
   if (ni == NULL)
-    {
-      __nss_database_lookup ("shadow_compat", "passwd_compat", "nis", &ni);
-      use_nisplus = (strcmp (ni->name, "nisplus") == 0);
-    }
+    init_nss_interface ();
+
+  __libc_lock_unlock (lock);
 
-  status = internal_setspent (&ent);
-  if (status != NSS_STATUS_SUCCESS)
-    return status;
+  result = internal_setspent (&ent, 0);
 
-  status = internal_getspnam_r (name, pwd, &ent, buffer, buflen, errnop);
+  if (result != NSS_STATUS_SUCCESS)
+    return result;
+
+  result = internal_getspnam_r (name, pwd, &ent, buffer, buflen, errnop);
 
   internal_endspent (&ent);
 
-  return status;
+  return result;
 }
 
 /* Support routines for remembering -@netgroup and -user entries.
@@ -1225,7 +864,7 @@
 
   buf[0] = '|';
   cp = stpcpy (&buf[1], name);
-  *cp++= '|';
+  *cp++ = '|';
   *cp = '\0';
   return strstr (ent->blacklist.data, buf) != NULL;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_nis/nis-alias.c libc-20030708/nis/nss_nis/nis-alias.c
--- glibc-2.3.2/nis/nss_nis/nis-alias.c	2003-01-18 19:21:02.000000000 +0900
+++ libc-20030708/nis/nss_nis/nis-alias.c	2003-03-16 12:36:21.000000000 +0900
@@ -214,7 +214,7 @@
   char *p;
   size_t namlen = strlen (name);
   char name2[namlen + 1];
-  int i;
+  size_t i;
 
   if (name == NULL)
     {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_nis/nis-hosts.c libc-20030708/nis/nss_nis/nis-hosts.c
--- glibc-2.3.2/nis/nss_nis/nis-hosts.c	2003-01-18 19:40:11.000000000 +0900
+++ libc-20030708/nis/nss_nis/nis-hosts.c	2003-03-16 12:36:21.000000000 +0900
@@ -261,7 +261,7 @@
       /* Convert name to lowercase.  */
       size_t namlen = strlen (name);
       char name2[namlen + 1];
-      int i;
+      size_t i;
 
       for (i = 0; i < namlen; ++i)
 	name2[i] = tolower (name[i]);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_nis/nis-initgroups.c libc-20030708/nis/nss_nis/nis-initgroups.c
--- glibc-2.3.2/nis/nss_nis/nis-initgroups.c	2002-08-26 13:47:19.000000000 +0900
+++ libc-20030708/nis/nss_nis/nis-initgroups.c	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1998.
 
@@ -17,10 +17,11 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <nss.h>
-#include <grp.h>
+#include <alloca.h>
 #include <ctype.h>
 #include <errno.h>
+#include <grp.h>
+#include <nss.h>
 #include <string.h>
 #include <unistd.h>
 #include <rpcsvc/yp.h>
@@ -159,10 +160,7 @@
 	      internal_getgrent_r (&grpbuf, tmpbuf, buflen, errnop,
 				   &intern)) == NSS_STATUS_TRYAGAIN
              && *errnop == ERANGE)
-        {
-          buflen *= 2;
-          tmpbuf = __alloca (buflen);
-        }
+	tmpbuf = extend_alloca (tmpbuf, buflen, 2 * buflen);
 
       if (status != NSS_STATUS_SUCCESS)
 	goto done;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/nss_nis/nis-network.c libc-20030708/nis/nss_nis/nis-network.c
--- glibc-2.3.2/nis/nss_nis/nis-network.c	2003-01-20 04:06:27.000000000 +0900
+++ libc-20030708/nis/nss_nis/nis-network.c	2003-03-16 12:36:21.000000000 +0900
@@ -181,7 +181,7 @@
       /* Convert name to lowercase.  */
       size_t namlen = strlen (name);
       char name2[namlen + 1];
-      int i;
+      size_t i;
 
       for (i = 0; i < namlen; ++i)
 	name2[i] = _tolower (name[i]);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nis/ypclnt.c libc-20030708/nis/ypclnt.c
--- glibc-2.3.2/nis/ypclnt.c	2002-03-21 09:37:12.000000000 +0900
+++ libc-20030708/nis/ypclnt.c	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1996.
 
@@ -66,15 +66,12 @@
   if (domain == NULL || domain[0] == '\0')
     return YPERR_BADARGS;
 
-  if (ypdb != NULL)
+  ysd = *ypdb;
+  while (ysd != NULL)
     {
-      ysd = *ypdb;
-      while (ysd != NULL)
-	{
-	  if (strcmp (domain, ysd->dom_domain) == 0)
-	    break;
-	  ysd = ysd->dom_pnext;
-	}
+      if (strcmp (domain, ysd->dom_domain) == 0)
+	break;
+      ysd = ysd->dom_pnext;
     }
 
   if (ysd == NULL)
@@ -205,7 +202,7 @@
       return YPERR_YPSERV;
     }
 
-  if (is_new && ypdb != NULL)
+  if (is_new)
     {
       ysd->dom_pnext = *ypdb;
       *ypdb = ysd;
@@ -219,6 +216,7 @@
 {
   clnt_destroy (ydb->dom_client);
   ydb->dom_client = NULL;
+  free (ydb);
 }
 
 int
@@ -255,7 +253,6 @@
 	  else
 	    ydbptr2 = ydbptr->dom_pnext;
 	  __yp_unbind (work);
-	  free (work);
 	  break;
 	}
       ydbptr2 = ydbptr;
@@ -335,10 +332,7 @@
 	      use_ypbindlist = FALSE;
 	    }
 	  else
-	    {
-	      __yp_unbind (ydb);
-	      free (ydb);
-	    }
+	    __yp_unbind (ydb);
 
 	  ydb = NULL;
 	  status = YPERR_RPC;
@@ -355,11 +349,7 @@
     }
   else
     if (ydb != NULL)
-      {
-	__yp_unbind (ydb);
-	free (ydb);
-	ydb = NULL;
-      }
+      __yp_unbind (ydb);
 
   __set_errno (saved_errno);
 
@@ -710,6 +700,7 @@
 
       /* We don't need the UDP connection anymore.  */
       __yp_unbind (ydb);
+      ydb = NULL;
 
       clnt = clnttcp_create (&clnt_sin, YPPROG, YPVERS, &clnt_sock, 0, 0);
       if (clnt == NULL)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/Makefile libc-20030708/nscd/Makefile
--- glibc-2.3.2/nscd/Makefile	2002-10-18 02:05:53.000000000 +0900
+++ libc-20030708/nscd/Makefile	2003-05-10 13:38:04.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1998, 2000, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -30,7 +30,7 @@
 
 nscd-modules := nscd connections pwdcache getpwnam_r getpwuid_r grpcache \
 		getgrnam_r getgrgid_r hstcache gethstbyad_r gethstbynm2_r \
-		dbg_log nscd_conf nscd_stat cache xmalloc
+		dbg_log nscd_conf nscd_stat cache xmalloc xstrdup
 
 ifeq ($(have-thread-library),yes)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/cache.c libc-20030708/nscd/cache.c
--- glibc-2.3.2/nscd/cache.c	2001-07-08 04:21:07.000000000 +0900
+++ libc-20030708/nscd/cache.c	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (c) 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (c) 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -17,7 +17,7 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <atomicity.h>
+#include <atomic.h>
 #include <errno.h>
 #include <error.h>
 #include <limits.h>
@@ -39,16 +39,19 @@
 
    This function must be called with the read-lock held.  */
 struct hashentry *
-cache_search (int type, void *key, size_t len, struct database *table,
+cache_search (request_type type, void *key, size_t len, struct database *table,
 	      uid_t owner)
 {
   unsigned long int hash = __nis_hash (key, len) % table->module;
   struct hashentry *work;
+  unsigned long int nsearched = 0;
 
   work = table->array[hash];
 
   while (work != NULL)
     {
+      ++nsearched;
+
       if (type == work->type && len == work->len
 	  && memcmp (key, work->key, len) == 0 && work->owner == owner)
 	{
@@ -58,13 +61,16 @@
 	  else
 	    ++table->poshit;
 
-	  return work;
+	  break;
 	}
 
       work = work->next;
     }
 
-  return NULL;
+  if (nsearched > table->maxnsearched)
+    table->maxnsearched = nsearched;
+
+  return work;
 }
 
 /* Add a new entry to the cache.  The return value is zero if the function
@@ -101,14 +107,20 @@
   /* Put the new entry in the first position.  */
   do
     newp->next = table->array[hash];
-  while (! compare_and_swap ((volatile long int *) &table->array[hash],
-			     (long int) newp->next, (long int) newp));
+  while (atomic_compare_and_exchange_bool_acq (&table->array[hash], newp,
+					       newp->next));
 
   /* Update the statistics.  */
   if (data == (void *) -1)
     ++table->negmiss;
   else if (last)
     ++table->posmiss;
+
+  /* Instead of slowing down the normal process for statistics
+     collection we accept living with some incorrect data.  */
+  unsigned long int nentries = ++table->nentries;
+  if (nentries > table->maxnentries)
+    table->maxnentries = nentries;
 }
 
 /* Walk through the table and remove all entries which lifetime ended.
@@ -165,10 +177,10 @@
 
   /* We run through the table and find values which are not valid anymore.
 
-   Note that for the initial step, finding the entries to be removed,
-   we don't need to get any lock.  It is at all timed assured that the
-   linked lists are set up correctly and that no second thread prunes
-   the cache.  */
+     Note that for the initial step, finding the entries to be removed,
+     we don't need to get any lock.  It is at all timed assured that the
+     linked lists are set up correctly and that no second thread prunes
+     the cache.  */
   do
     {
       struct hashentry *runp = table->array[--cnt];
@@ -195,7 +207,11 @@
 
       /* Now we have to get the write lock since we are about to modify
 	 the table.  */
-      pthread_rwlock_wrlock (&table->lock);
+      if (__builtin_expect (pthread_rwlock_trywrlock (&table->lock) != 0, 0))
+	{
+	  ++table->wrlockdelayed;
+	  pthread_rwlock_wrlock (&table->lock);
+	}
 
       while (first <= last)
 	{
@@ -208,6 +224,7 @@
 		  table->array[first]->dellist = head;
 		  head = table->array[first];
 		  table->array[first] = head->next;
+		  --table->nentries;
 		  if (--mark[first] == 0)
 		    break;
 		}
@@ -221,6 +238,7 @@
 		      head = runp->next;
 		      runp->next = head->next;
 		      --mark[first];
+		      --table->nentries;
 		    }
 		  else
 		    runp = runp->next;
@@ -232,29 +250,35 @@
       /* It's all done.  */
       pthread_rwlock_unlock (&table->lock);
 
-      /* And another run to free the data.  */
-      do
+      /* One extra pass if we do debugging.  */
+      if (__builtin_expect (debug_level > 0, 0))
 	{
-	  struct hashentry *old = head;
+	  struct hashentry *runp = head;
 
-	  if (debug_level > 0)
+	  while (runp != NULL)
 	    {
 	      char buf[INET6_ADDRSTRLEN];
 	      const char *str;
 
-	      if ((old->type == GETHOSTBYADDR || old->type == GETHOSTBYADDRv6)
-		  && (old->last || old->data == (void *) -1))
+	      if (runp->type == GETHOSTBYADDR || runp->type == GETHOSTBYADDRv6)
 		{
-		  inet_ntop (old->type == GETHOSTBYADDR ? AF_INET : AF_INET6,
-			     old->key, buf, sizeof (buf));
+		  inet_ntop (runp->type == GETHOSTBYADDR ? AF_INET : AF_INET6,
+			     runp->key, buf, sizeof (buf));
 		  str = buf;
 		}
 	      else
-		str = old->last ? old->key : (old->data == (void *) -1
-					      ? old->key : "???");
+		str = runp->key;
 
-	      dbg_log ("remove %s entry \"%s\"", serv2str[old->type], str);
+	      dbg_log ("remove %s entry \"%s\"", serv2str[runp->type], str);
+
+	      runp = runp->next;
 	    }
+	}
+
+      /* And another run to free the data.  */
+      do
+	{
+	  struct hashentry *old = head;
 
 	  /* Free the data structures.  */
 	  if (old->data == (void *) -1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/connections.c libc-20030708/nscd/connections.c
--- glibc-2.3.2/nscd/connections.c	2003-01-16 16:52:01.000000000 +0900
+++ libc-20030708/nscd/connections.c	2003-05-10 13:38:04.000000000 +0900
@@ -19,6 +19,7 @@
    02111-1307 USA.  */
 
 #include <assert.h>
+#include <atomic.h>
 #include <error.h>
 #include <errno.h>
 #include <grp.h>
@@ -47,6 +48,8 @@
 const char *server_user;
 static uid_t server_uid;
 static gid_t server_gid;
+const char *stat_user;
+uid_t stat_uid;
 static gid_t *server_groups;
 #ifndef NGROUPS
 # define NGROUPS 32
@@ -87,7 +90,7 @@
 };
 
 /* The control data structures for the services.  */
-static struct database dbs[lastdb] =
+struct database dbs[lastdb] =
 {
   [pwddb] = {
     .lock = PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP,
@@ -130,23 +133,17 @@
 /* Socket for incoming connections.  */
 static int sock;
 
+/* Number of times clients had to wait.  */
+unsigned long int client_queued;
+
 
 /* Initialize database information structures.  */
 void
-nscd_init (const char *conffile)
+nscd_init (void)
 {
   struct sockaddr_un sock_addr;
   size_t cnt;
 
-  /* Read the configuration file.  */
-  if (nscd_parse_file (conffile, dbs) != 0)
-    {
-      /* We couldn't read the configuration file.  Disable all services
-	 by shutting down the srever.  */
-      dbg_log (_("cannot read configuration file; this is fatal"));
-      exit (1);
-    }
-
   /* Secure mode and unprivileged mode are incompatible */
   if (server_user != NULL && secure_in_use)
     {
@@ -233,6 +230,7 @@
   close (sock);
 }
 
+
 static void
 invalidate_cache (char *key)
 {
@@ -256,10 +254,6 @@
 static void
 handle_request (int fd, request_header *req, void *key, uid_t uid)
 {
-  if (__builtin_expect (debug_level, 0) > 0)
-    dbg_log (_("handle_request: request received (Version = %d)"),
-	     req->version);
-
   if (__builtin_expect (req->version, NSCD_VERSION) != NSCD_VERSION)
     {
       if (debug_level > 0)
@@ -296,7 +290,7 @@
 	  /* No, sent the prepared record.  */
 	  if (TEMP_FAILURE_RETRY (write (fd, db->disabled_iov->iov_base,
 					 db->disabled_iov->iov_len))
-	      != db->disabled_iov->iov_len
+	      != (ssize_t) db->disabled_iov->iov_len
 	      && __builtin_expect (debug_level, 0) > 0)
 	    {
 	      /* We have problems sending the result.  */
@@ -309,7 +303,11 @@
 	}
 
       /* Be sure we can read the data.  */
-      pthread_rwlock_rdlock (&db->lock);
+      if (__builtin_expect (pthread_rwlock_tryrdlock (&db->lock) != 0, 0))
+	{
+	  ++db->rdlockdelayed;
+	  pthread_rwlock_rdlock (&db->lock);
+	}
 
       /* See whether we can handle it from the cache.  */
       cached = (struct hashentry *) cache_search (req->type, key, req->key_len,
@@ -380,20 +378,9 @@
     case GETSTAT:
     case SHUTDOWN:
     case INVALIDATE:
-      /* Accept shutdown, getstat and invalidate only from root */
-      if (secure_in_use && uid == 0)
+      if (! secure_in_use)
 	{
-	  if (req->type == GETSTAT)
-	    send_stats (fd, dbs);
-	  else if (req->type == INVALIDATE)
-	    invalidate_cache (key);
-	  else
-	    termination_handler (0);
-	}
-      else
-	{
-	  /* Some systems have no SO_PEERCRED implementation.  They don't
-	     care about security so we don't as well.  */
+	  /* Get the callers credentials.  */
 #ifdef SO_PEERCRED
 	  struct ucred caller;
 	  socklen_t optlen = sizeof (caller);
@@ -404,18 +391,30 @@
 
 	      dbg_log (_("error getting callers id: %s"),
 		       strerror_r (errno, buf, sizeof (buf)));
+	      break;
 	    }
-	  else
-	    if (caller.uid == 0)
+
+	  uid = caller.uid;
+#else
+	  /* Some systems have no SO_PEERCRED implementation.  They don't
+	     care about security so we don't as well.  */
+	  uid = 0;
 #endif
-	      {
-		if (req->type == GETSTAT)
-		  send_stats (fd, dbs);
-		else if (req->type == INVALIDATE)
-		  invalidate_cache (key);
-		else
-		  termination_handler (0);
-	      }
+	}
+
+      /* Accept shutdown, getstat and invalidate only from root.  For
+	 the stat call also allow the user specified in the config file.  */
+      if (req->type == GETSTAT)
+	{
+	  if (uid == 0 || uid == stat_uid)
+	    send_stats (fd, dbs);
+	}
+      else if (uid == 0)
+	{
+	  if (req->type == INVALIDATE)
+	    invalidate_cache (key);
+	  else
+	    termination_handler (0);
 	}
       break;
 
@@ -435,118 +434,163 @@
   long int my_number = (long int) p;
   struct pollfd conn;
   int run_prune = my_number < lastdb && dbs[my_number].enabled;
-  time_t now = time (NULL);
-  time_t next_prune = now + CACHE_PRUNE_INTERVAL;
-  int timeout = run_prune ? 1000 * (next_prune - now) : -1;
+  time_t next_prune = run_prune ? time (NULL) + CACHE_PRUNE_INTERVAL : 0;
+  static unsigned long int nready;
 
   conn.fd = sock;
   conn.events = POLLRDNORM;
 
   while (1)
     {
-      int nr = poll (&conn, 1, timeout);
+      int nr;
+
+      /* One more thread available.  */
+      atomic_increment (&nready);
+
+    no_conn:
+      if (run_prune)
+	do
+	  {
+	    time_t now = time (NULL);
+	    int timeout = now < next_prune ? 1000 * (next_prune - now) : 0;
+
+	    nr = poll (&conn, 1, timeout);
+
+	    if (nr == 0)
+	      {
+		/* The `poll' call timed out.  It's time to clean up the
+		   cache.  */
+		atomic_decrement (&nready);
+		assert (my_number < lastdb);
+		prune_cache (&dbs[my_number], time(NULL));
+		now = time (NULL);
+		next_prune = now + CACHE_PRUNE_INTERVAL;
+		goto try_get;
+	      }
+	  }
+	while ((conn.revents & POLLRDNORM) == 0);
+
+    got_data:;
+      /* We have a new incoming connection.  Accept the connection.  */
+      int fd = TEMP_FAILURE_RETRY (accept (conn.fd, NULL, NULL));
+      request_header req;
+      char buf[256];
+      uid_t uid = -1;
+#ifdef SO_PEERCRED
+      pid_t pid = 0;
+#endif
 
-      if (nr == 0)
+      if (__builtin_expect (fd, 0) < 0)
 	{
-	  /* The `poll' call timed out.  It's time to clean up the cache.  */
-	  assert (my_number < lastdb);
-	  now = time (NULL);
-	  prune_cache (&dbs[my_number], now);
-	  next_prune = now + CACHE_PRUNE_INTERVAL;
-	  timeout = 1000 * (next_prune - now);
+	  dbg_log (_("while accepting connection: %s"),
+		   strerror_r (errno, buf, sizeof (buf)));
+	  goto no_conn;
+	}
+
+      /* This thread is busy.  */
+      atomic_decrement (&nready);
+
+      /* Now read the request.  */
+      if (__builtin_expect (TEMP_FAILURE_RETRY (read (fd, &req, sizeof (req)))
+			    != sizeof (req), 0))
+	{
+	  if (debug_level > 0)
+	    dbg_log (_("short read while reading request: %s"),
+		     strerror_r (errno, buf, sizeof (buf)));
+	  close (fd);
 	  continue;
 	}
 
-      /* We have a new incoming connection.  */
-      if (conn.revents & (POLLRDNORM|POLLERR|POLLHUP|POLLNVAL))
+      /* Some systems have no SO_PEERCRED implementation.  They don't
+	 care about security so we don't as well.  */
+#ifdef SO_PEERCRED
+      if (secure_in_use)
 	{
-	  /* Accept the connection.  */
-	  int fd = TEMP_FAILURE_RETRY (accept (conn.fd, NULL, NULL));
-	  request_header req;
-	  char buf[256];
-	  uid_t uid = 0;
+	  struct ucred caller;
+	  socklen_t optlen = sizeof (caller);
 
-	  if (__builtin_expect (fd, 0) < 0)
+	  if (getsockopt (fd, SOL_SOCKET, SO_PEERCRED, &caller, &optlen) < 0)
 	    {
-	      dbg_log (_("while accepting connection: %s"),
+	      dbg_log (_("error getting callers id: %s"),
 		       strerror_r (errno, buf, sizeof (buf)));
-	      continue;
-	    }
-
-	  /* Now read the request.  */
-	  if (__builtin_expect (TEMP_FAILURE_RETRY (read (fd, &req,
-							  sizeof (req)))
-				!= sizeof (req), 0))
-	    {
-	      if (debug_level > 0)
-		dbg_log (_("short read while reading request: %s"),
-			 strerror_r (errno, buf, sizeof (buf)));
 	      close (fd);
 	      continue;
 	    }
 
-	  /* Some systems have no SO_PEERCRED implementation.  They don't
-	     care about security so we don't as well.  */
-#ifdef SO_PEERCRED
-	  if (secure_in_use)
-	    {
-	      struct ucred caller;
-	      socklen_t optlen = sizeof (caller);
+	  if (req.type < GETPWBYNAME || req.type > LASTDBREQ
+	      || secure[serv2db[req.type]])
+	    uid = caller.uid;
 
-	      if (getsockopt (fd, SOL_SOCKET, SO_PEERCRED,
-			      &caller, &optlen) < 0)
-		{
-		  dbg_log (_("error getting callers id: %s"),
-			   strerror_r (errno, buf, sizeof (buf)));
-		  close (fd);
-		  continue;
-		}
-
-	      if (req.type < GETPWBYNAME || req.type > LASTDBREQ
-		  || secure[serv2db[req.type]])
-		uid = caller.uid;
-	    }
+	  pid = caller.pid;
+	}
+      else if (__builtin_expect (debug_level > 0, 0))
+	{
+	  struct ucred caller;
+	  socklen_t optlen = sizeof (caller);
+
+	  if (getsockopt (fd, SOL_SOCKET, SO_PEERCRED, &caller, &optlen) == 0)
+	    pid = caller.pid;
+	}
 #endif
 
-	  /* It should not be possible to crash the nscd with a silly
-	     request (i.e., a terribly large key).  We limit the size
-	     to 1kb.  */
-	  if (__builtin_expect (req.key_len, 1) < 0
-	      || __builtin_expect (req.key_len, 1) > 1024)
+      /* It should not be possible to crash the nscd with a silly
+	 request (i.e., a terribly large key).  We limit the size to 1kb.  */
+      if (__builtin_expect (req.key_len, 1) < 0
+	  || __builtin_expect (req.key_len, 1) > 1024)
+	{
+	  if (debug_level > 0)
+	    dbg_log (_("key length in request too long: %d"), req.key_len);
+	  close (fd);
+	  continue;
+	}
+      else
+	{
+	  /* Get the key.  */
+	  char keybuf[req.key_len];
+
+	  if (__builtin_expect (TEMP_FAILURE_RETRY (read (fd, keybuf,
+							  req.key_len))
+				!= req.key_len, 0))
 	    {
 	      if (debug_level > 0)
-		dbg_log (_("key length in request too long: %d"), req.key_len);
+		dbg_log (_("short read while reading request key: %s"),
+			 strerror_r (errno, buf, sizeof (buf)));
 	      close (fd);
 	      continue;
 	    }
-	  else
-	    {
-	      /* Get the key.  */
-	      char keybuf[req.key_len];
 
-	      if (__builtin_expect (TEMP_FAILURE_RETRY (read (fd, keybuf,
-							      req.key_len))
-				    != req.key_len, 0))
-		{
-		  if (debug_level > 0)
-		    dbg_log (_("short read while reading request key: %s"),
-			     strerror_r (errno, buf, sizeof (buf)));
-		  close (fd);
-		  continue;
-		}
+	  if (__builtin_expect (debug_level, 0) > 0)
+	    {
+#ifdef SO_PEERCRED
+	      if (pid != 0)
+		dbg_log (_("\
+handle_request: request received (Version = %d) from PID %ld"),
+			 req.version, (long int) pid);
+	      else
+#endif
+		dbg_log (_("\
+handle_request: request received (Version = %d)"), req.version);
+	    }
 
-	      /* Phew, we got all the data, now process it.  */
-	      handle_request (fd, &req, keybuf, uid);
+	  /* Phew, we got all the data, now process it.  */
+	  handle_request (fd, &req, keybuf, uid);
 
-	      /* We are done.  */
-	      close (fd);
-	    }
+	  /* We are done.  */
+	  close (fd);
 	}
 
-      if (run_prune)
+      /* Just determine whether any data is present.  We do this to
+	 measure whether clients are queued up.  */
+    try_get:
+      nr = poll (&conn, 1, 0);
+      if (nr != 0)
 	{
-	  now = time (NULL);
-	  timeout = now < next_prune ? 1000 * (next_prune - now) : 0;
+	  if (nready == 0)
+	    ++client_queued;
+
+	  atomic_increment (&nready);
+
+	  goto got_data;
 	}
     }
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/grpcache.c libc-20030708/nscd/grpcache.c
--- glibc-2.3.2/nscd/grpcache.c	2003-01-15 19:27:22.000000000 +0900
+++ libc-20030708/nscd/grpcache.c	2003-04-28 23:53:22.000000000 +0900
@@ -152,6 +152,7 @@
 	/* There is no reason to go on.  */
 	error (EXIT_FAILURE, errno, _("while allocating cache entry"));
 
+      data->resp.version = NSCD_VERSION;
       data->resp.found = 1;
       data->resp.gr_name_len = gr_name_len;
       data->resp.gr_passwd_len = gr_passwd_len;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/hstcache.c libc-20030708/nscd/hstcache.c
--- glibc-2.3.2/nscd/hstcache.c	2003-01-15 19:29:40.000000000 +0900
+++ libc-20030708/nscd/hstcache.c	2003-04-28 23:53:22.000000000 +0900
@@ -167,6 +167,7 @@
 	/* There is no reason to go on.  */
 	error (EXIT_FAILURE, errno, _("while allocating cache entry"));
 
+      data->resp.version = NSCD_VERSION;
       data->resp.found = 1;
       data->resp.h_name_len = h_name_len;
       data->resp.h_aliases_cnt = h_aliases_cnt;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd-client.h libc-20030708/nscd/nscd-client.h
--- glibc-2.3.2/nscd/nscd-client.h	2001-07-08 04:21:07.000000000 +0900
+++ libc-20030708/nscd/nscd-client.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (c) 1998, 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (c) 1998, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1998.
 
@@ -110,4 +110,7 @@
 } hst_response_header;
 
 
+/* Open socket connection to nscd server.  */
+extern int __nscd_open_socket (void) attribute_hidden;
+
 #endif /* nscd.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd.c libc-20030708/nscd/nscd.c
--- glibc-2.3.2/nscd/nscd.c	2003-01-16 04:32:47.000000000 +0900
+++ libc-20030708/nscd/nscd.c	2003-05-10 13:38:04.000000000 +0900
@@ -30,6 +30,7 @@
 #include <paths.h>
 #include <pthread.h>
 #include <signal.h>
+#include <stdbool.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -41,6 +42,7 @@
 
 #include "dbg_log.h"
 #include "nscd.h"
+#include "../nss/nsswitch.h"
 #include <device-nrs.h>
 
 /* Get libc version number.  */
@@ -71,6 +73,8 @@
 int secure_in_use;
 static const char *conffile = _PATH_NSCDCONF;
 
+time_t start_time;
+
 static int check_pid (const char *file);
 static int write_pid (const char *file);
 
@@ -106,6 +110,9 @@
   options, parse_opt, NULL, doc,
 };
 
+/* True if only statistics are requested.  */
+static bool get_stats;
+
 int
 main (int argc, char **argv)
 {
@@ -126,10 +133,27 @@
       exit (EXIT_FAILURE);
     }
 
+  /* Read the configuration file.  */
+  if (nscd_parse_file (conffile, dbs) != 0)
+    {
+      /* We couldn't read the configuration file.  We don't start the
+	 server.  */
+      dbg_log (_("cannot read configuration file; this is fatal"));
+      exit (1);
+    }
+
+  /* Do we only get statistics?  */
+  if (get_stats)
+    /* Does not return.  */
+    receive_print_stats ();
+
   /* Check if we are already running. */
   if (check_pid (_PATH_NSCDPID))
     error (EXIT_FAILURE, 0, _("already running"));
 
+  /* Remember when we started.  */
+  start_time = time (NULL);
+
   /* Behave like a daemon.  */
   if (go_background)
     {
@@ -175,7 +199,7 @@
 	  while ((dirent = readdir64 (d)) != NULL)
 	    {
 	      char *endp;
-	      unsigned long int fdn = strtoul (dirent->d_name, &endp, 10);
+	      long int fdn = strtol (dirent->d_name, &endp, 10);
 
 	      if (*endp == '\0' && fdn != dfdn && fdn >= min_close_fd)
 		close ((int) fdn);
@@ -213,8 +237,11 @@
   /* Cleanup files created by a previous `bind'.  */
   unlink (_PATH_NSCDSOCKET);
 
+  /* Make sure we do not get recursive calls.  */
+  __nss_disable_nscd ();
+
   /* Init databases.  */
-  nscd_init (conffile);
+  nscd_init ();
 
   /* Handle incoming requests */
   start_threads ();
@@ -259,10 +286,8 @@
       }
 
     case 'g':
-      if (getuid () != 0)
-	error (EXIT_FAILURE, 0, _("Only root is allowed to use this option!"));
-      receive_print_stats ();
-      /* Does not return.  */
+      get_stats = true;
+      break;
 
     case 'i':
       if (getuid () != 0)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd.conf libc-20030708/nscd/nscd.conf
--- glibc-2.3.2/nscd/nscd.conf	2000-04-30 13:25:38.000000000 +0900
+++ libc-20030708/nscd/nscd.conf	2003-05-10 13:38:04.000000000 +0900
@@ -10,6 +10,7 @@
 #	threads			<#threads to use>
 #	server-user             <user to run server as instead of root>
 #		server-user is ignored if nscd is started with -S parameters
+#       stat-user               <user who is allowed to request statistics>
 #
 #       enable-cache		<service> <yes|no>
 #	positive-time-to-live	<service> <time in seconds>
@@ -24,6 +25,7 @@
 #	logfile			/var/log/nscd.log
 #	threads			6
 #	server-user		nobody
+#	stat-user		somebody
 	debug-level		0
 
 	enable-cache		passwd		yes
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd.h libc-20030708/nscd/nscd.h
--- glibc-2.3.2/nscd/nscd.h	2001-07-08 04:21:07.000000000 +0900
+++ libc-20030708/nscd/nscd.h	2003-05-10 13:38:04.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (c) 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (c) 1998, 1999, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1998.
 
@@ -77,11 +77,19 @@
   unsigned long int posmiss;
   unsigned long int negmiss;
 
+  unsigned long int nentries;
+  unsigned long int maxnentries;
+  unsigned long int maxnsearched;
+
+  unsigned long int rdlockdelayed;
+  unsigned long int wrlockdelayed;
+
   struct hashentry **array;
 };
 
 
 /* Global variables.  */
+extern struct database dbs[lastdb];
 extern const char *dbnames[lastdb];
 extern const char *serv2str[LASTREQ];
 
@@ -92,13 +100,23 @@
 /* Number of threads to run.  */
 extern int nthreads;
 
-/* Tables for which we cache data with uid */
+/* Tables for which we cache data with uid.  */
 extern int secure[lastdb];
-extern int secure_in_use; /* Is one of the above 1 ? */
+extern int secure_in_use; /* Is one of the above 1?  */
 
-/* User name to run server processes as */
+/* User name to run server processes as.  */
 extern const char *server_user;
 
+/* Name and UID of user who is allowed to request statistics.  */
+extern const char *stat_user;
+extern uid_t stat_uid;
+
+/* Time the server was started.  */
+extern time_t start_time;
+
+/* Number of times clients had to wait.  */
+extern unsigned long int client_queued;
+
 /* Prototypes for global functions.  */
 
 /* nscd.c */
@@ -106,7 +124,7 @@
 extern int nscd_open_socket (void);
 
 /* connections.c */
-extern void nscd_init (const char *conffile);
+extern void nscd_init (void);
 extern void close_sockets (void);
 extern void start_threads (void) __attribute__ ((__noreturn__));
 
@@ -118,7 +136,7 @@
 extern int receive_print_stats (void) __attribute__ ((__noreturn__));
 
 /* cache.c */
-extern struct hashentry *cache_search (int type, void *key, size_t len,
+extern struct hashentry *cache_search (request_type, void *key, size_t len,
 				       struct database *table, uid_t owner);
 extern void cache_add (int type, void *key, size_t len,
 		       const void *packet, size_t iovtotal, void *data,
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd_conf.c libc-20030708/nscd/nscd_conf.c
--- glibc-2.3.2/nscd/nscd_conf.c	2001-07-08 04:21:07.000000000 +0900
+++ libc-20030708/nscd/nscd_conf.c	2003-05-10 13:38:04.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (c) 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (c) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@suse.de>, 1998.
 
@@ -19,6 +19,7 @@
 
 #include <ctype.h>
 #include <malloc.h>
+#include <pwd.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -29,6 +30,10 @@
 #include "dbg_log.h"
 #include "nscd.h"
 
+/* Wrapper functions with error checking for standard functions.  */
+extern char *xstrdup (const char *s);
+
+
 /* Names of the databases.  */
 const char *dbnames[lastdb] =
 {
@@ -181,7 +186,20 @@
           if (!arg1)
             dbg_log (_("Must specify user name for server-user option"));
           else
-            server_user = strdup (arg1);
+            server_user = xstrdup (arg1);
+        }
+      else if (strcmp (entry, "stat-user") == 0)
+        {
+          if (!arg1)
+            dbg_log (_("Must specify user name for stat-user option"));
+          else
+	    {
+	      stat_user = xstrdup (arg1);
+
+	      struct passwd *pw = getpwnam (stat_user);
+	      if (pw != NULL)
+		stat_uid = pw->pw_uid;
+	    }
         }
       else
 	dbg_log (_("Unknown option: %s %s %s"), entry, arg1, arg2);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd_getgr_r.c libc-20030708/nscd/nscd_getgr_r.c
--- glibc-2.3.2/nscd/nscd_getgr_r.c	2003-01-15 19:42:36.000000000 +0900
+++ libc-20030708/nscd/nscd_getgr_r.c	2003-04-28 23:53:22.000000000 +0900
@@ -60,44 +60,17 @@
 }
 
 
-/* Create a socket connected to a name. */
-static int
-open_socket (void)
-{
-  struct sockaddr_un addr;
-  int sock;
-  int saved_errno = errno;
-
-  sock = __socket (PF_UNIX, SOCK_STREAM, 0);
-  if (sock < 0)
-    {
-      __set_errno (saved_errno);
-      return -1;
-    }
-
-  addr.sun_family = AF_UNIX;
-  strcpy (addr.sun_path, _PATH_NSCDSOCKET);
-  if (__connect (sock, (struct sockaddr *) &addr, sizeof (addr)) < 0)
-    {
-      __close (sock);
-      __set_errno (saved_errno);
-      return -1;
-    }
-
-  return sock;
-}
-
-
 static int
 internal_function
 nscd_getgr_r (const char *key, size_t keylen, request_type type,
 	      struct group *resultbuf, char *buffer, size_t buflen)
 {
-  int sock = open_socket ();
+  int sock = __nscd_open_socket ();
   request_header req;
   gr_response_header gr_resp;
   ssize_t nbytes;
   struct iovec vec[2];
+  int result = -1;
 
   if (sock == -1)
     {
@@ -114,27 +87,20 @@
   vec[1].iov_base = (void *) key;
   vec[1].iov_len = keylen;
 
-  nbytes = (size_t) TEMP_FAILURE_RETRY (__writev (sock, vec, 2));
-  if (nbytes != sizeof (request_header) + keylen)
-    {
-      __close (sock);
-      return -1;
-    }
+  nbytes = TEMP_FAILURE_RETRY (__writev (sock, vec, 2));
+  if (nbytes != (ssize_t) (sizeof (request_header) + keylen))
+    goto out;
 
   nbytes = TEMP_FAILURE_RETRY (__read (sock, &gr_resp,
 				       sizeof (gr_response_header)));
-  if (nbytes != sizeof (gr_response_header))
-    {
-      __close (sock);
-      return -1;
-    }
+  if (nbytes != (ssize_t) sizeof (gr_response_header))
+    goto out;
 
   if (gr_resp.found == -1)
     {
       /* The daemon does not cache this database.  */
-      __close (sock);
       __nss_not_use_nscd_group = 1;
-      return -1;
+      goto out;
     }
 
   if (gr_resp.found == 1)
@@ -143,7 +109,7 @@
       char *p = buffer;
       size_t total_len;
       uintptr_t align;
-      size_t cnt;
+      nscd_ssize_t cnt;
 
       /* Now allocate the buffer the array for the group members.  We must
 	 align the pointer.  */
@@ -151,12 +117,12 @@
 	       & (__alignof__ (char *) - 1));
       total_len = align + (1 + gr_resp.gr_mem_cnt) * sizeof (char *)
 		  + gr_resp.gr_name_len + gr_resp.gr_passwd_len;
-      if (buflen < total_len)
+      if (__builtin_expect (buflen < total_len, 0))
 	{
 	no_room:
 	  __set_errno (ERANGE);
-	  __close (sock);
-	  return ERANGE;
+	  result = ERANGE;
+	  goto out;
 	}
       buflen -= total_len;
 
@@ -184,11 +150,9 @@
       total_len += gr_resp.gr_name_len + gr_resp.gr_passwd_len;
 
       /* Get this data.  */
-      if ((size_t) TEMP_FAILURE_RETRY (__readv (sock, vec, 2)) != total_len)
-	{
-	  __close (sock);
-	  return -1;
-	}
+      size_t n = TEMP_FAILURE_RETRY (__readv (sock, vec, 2));
+      if (__builtin_expect (n != total_len, 0))
+	goto out;
 
       /* Clear the terminating entry.  */
       resultbuf->gr_mem[gr_resp.gr_mem_cnt] = NULL;
@@ -202,26 +166,28 @@
 	  p += len[cnt];
 	}
 
-      if (total_len > buflen)
+      if (__builtin_expect (total_len > buflen, 0))
 	goto no_room;
 
-      if ((size_t) TEMP_FAILURE_RETRY (__read (sock, resultbuf->gr_mem[0],
-					       total_len)) != total_len)
+      result = 0;
+      n = TEMP_FAILURE_RETRY (__read (sock, resultbuf->gr_mem[0],
+					     total_len));
+      if (__builtin_expect (n != total_len, 0))
 	{
-	  __close (sock);
 	  /* The `errno' to some value != ERANGE.  */
 	  __set_errno (ENOENT);
-	  return ENOENT;
+	  result = ENOENT;
 	}
-
-      __close (sock);
-      return 0;
     }
   else
     {
-      __close (sock);
       /* The `errno' to some value != ERANGE.  */
       __set_errno (ENOENT);
-      return ENOENT;
+      result = ENOENT;
     }
+
+ out:
+  __close (sock);
+
+  return result;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd_gethst_r.c libc-20030708/nscd/nscd_gethst_r.c
--- glibc-2.3.2/nscd/nscd_gethst_r.c	2003-01-15 19:40:44.000000000 +0900
+++ libc-20030708/nscd/nscd_gethst_r.c	2003-04-28 23:53:22.000000000 +0900
@@ -86,8 +86,8 @@
 
 
 /* Create a socket connected to a name. */
-static int
-open_socket (void)
+int
+__nscd_open_socket (void)
 {
   struct sockaddr_un addr;
   int sock;
@@ -119,11 +119,12 @@
 	       struct hostent *resultbuf, char *buffer, size_t buflen,
 	       int *h_errnop)
 {
-  int sock = open_socket ();
+  int sock = __nscd_open_socket ();
   hst_response_header hst_resp;
   request_header req;
   ssize_t nbytes;
   struct iovec vec[4];
+  int result = -1;
 
   if (sock == -1)
     {
@@ -142,25 +143,18 @@
 
   nbytes = TEMP_FAILURE_RETRY (__writev (sock, vec, 2));
   if ((size_t) nbytes != sizeof (request_header) + req.key_len)
-    {
-      __close (sock);
-      return -1;
-    }
+    goto out;
 
   nbytes = TEMP_FAILURE_RETRY (__read (sock, &hst_resp,
 				       sizeof (hst_response_header)));
-  if (nbytes != sizeof (hst_response_header))
-    {
-      __close (sock);
-      return -1;
-    }
+  if (__builtin_expect (nbytes != sizeof (hst_response_header), 0))
+    goto out;
 
   if (hst_resp.found == -1)
     {
       /* The daemon does not cache this database.  */
-      __close (sock);
       __nss_not_use_nscd_hosts = 1;
-      return -1;
+      goto out;
     }
 
   if (hst_resp.found == 1)
@@ -190,8 +184,8 @@
 	{
 	no_room:
 	  __set_errno (ERANGE);
-	  __close (sock);
-	  return ERANGE;
+	  result = ERANGE;
+	  goto out;
 	}
       cp += align1;
 
@@ -264,10 +258,7 @@
       resultbuf->h_addr_list[cnt] = NULL;
 
       if ((size_t) TEMP_FAILURE_RETRY (__readv (sock, vec, n)) != total_len)
-	{
-	  __close (sock);
-	  return -1;
-	}
+	goto out;
 
       /*  Now we also can read the aliases.  */
       total_len = 0;
@@ -285,23 +276,21 @@
 
       /* And finally read the aliases.  */
       if ((size_t) TEMP_FAILURE_RETRY (__read (sock, resultbuf->h_aliases[0],
-					       total_len)) != total_len)
-	{
-	  __close (sock);
-	  return -1;
-	}
-
-      __close (sock);
-      return 0;
+					       total_len)) == total_len)
+	result = 0;
     }
   else
     {
       /* Store the error number.  */
       *h_errnop = hst_resp.error;
 
-      __close (sock);
       /* The `errno' to some value != ERANGE.  */
       __set_errno (ENOENT);
-      return ENOENT;
+      result = ENOENT;
     }
+
+ out:
+  __close (sock);
+
+  return result;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd_getpw_r.c libc-20030708/nscd/nscd_getpw_r.c
--- glibc-2.3.2/nscd/nscd_getpw_r.c	2003-01-15 19:44:16.000000000 +0900
+++ libc-20030708/nscd/nscd_getpw_r.c	2003-04-28 23:53:22.000000000 +0900
@@ -60,43 +60,18 @@
   return nscd_getpw_r (buf, n, GETPWBYUID, resultbuf, buffer, buflen);
 }
 
-/* Create a socket connected to a name. */
-static int
-open_socket (void)
-{
-  struct sockaddr_un addr;
-  int sock;
-  int saved_errno = errno;
-
-  sock = __socket (PF_UNIX, SOCK_STREAM, 0);
-  if (sock < 0)
-    {
-      __set_errno (saved_errno);
-      return -1;
-    }
-
-  addr.sun_family = AF_UNIX;
-  strcpy (addr.sun_path, _PATH_NSCDSOCKET);
-  if (__connect (sock, (struct sockaddr *) &addr, sizeof (addr)) < 0)
-    {
-      __close (sock);
-      __set_errno (saved_errno);
-      return -1;
-    }
-
-  return sock;
-}
 
 static int
 internal_function
 nscd_getpw_r (const char *key, size_t keylen, request_type type,
 	      struct passwd *resultbuf, char *buffer, size_t buflen)
 {
-  int sock = open_socket ();
+  int sock = __nscd_open_socket ();
   request_header req;
   pw_response_header pw_resp;
   ssize_t nbytes;
   struct iovec vec[2];
+  int result = -1;
 
   if (sock == -1)
     {
@@ -113,27 +88,20 @@
   vec[1].iov_base = (void *) key;
   vec[1].iov_len = keylen;
 
-  nbytes = (size_t) TEMP_FAILURE_RETRY (__writev (sock, vec, 2));
-  if (nbytes != sizeof (request_header) + keylen)
-    {
-      __close (sock);
-      return -1;
-    }
+  nbytes = TEMP_FAILURE_RETRY (__writev (sock, vec, 2));
+  if (nbytes != (ssize_t) (sizeof (request_header) + keylen))
+    goto out;
 
   nbytes = TEMP_FAILURE_RETRY (__read (sock, &pw_resp,
 				       sizeof (pw_response_header)));
-  if (nbytes != sizeof (pw_response_header))
-    {
-      __close (sock);
-      return -1;
-    }
+  if (nbytes != (ssize_t) sizeof (pw_response_header))
+    goto out;
 
-  if (pw_resp.found == -1)
+  if (__builtin_expect (pw_resp.found == -1, 0))
     {
       /* The daemon does not cache this database.  */
-      __close (sock);
       __nss_not_use_nscd_passwd = 1;
-      return -1;
+      goto out;
     }
 
   if (pw_resp.found == 1)
@@ -143,11 +111,11 @@
 		      + pw_resp.pw_gecos_len + pw_resp.pw_dir_len
 		      + pw_resp.pw_shell_len);
 
-      if (buflen < total)
+      if (__builtin_expect (buflen < total, 0))
 	{
 	  __set_errno (ERANGE);
-	  __close (sock);
-	  return ERANGE;
+	  result = ERANGE;
+	  goto out;
 	}
 
       /* Set the information we already have.  */
@@ -171,15 +139,18 @@
 
       nbytes = TEMP_FAILURE_RETRY (__read (sock, buffer, total));
 
-      __close (sock);
-
-      return nbytes == total ? 0 : -1;
+      if (nbytes == (ssize_t) total)
+	result = 0;
     }
   else
     {
-      __close (sock);
       /* The `errno' to some value != ERANGE.  */
       __set_errno (ENOENT);
-      return ENOENT;
+      result = ENOENT;
     }
+
+ out:
+  __close (sock);
+
+  return result;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/nscd_stat.c libc-20030708/nscd/nscd_stat.c
--- glibc-2.3.2/nscd/nscd_stat.c	2001-07-08 04:21:07.000000000 +0900
+++ libc-20030708/nscd/nscd_stat.c	2003-05-10 13:38:04.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (c) 1998 Free Software Foundation, Inc.
+/* Copyright (c) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Thorsten Kukuk <kukuk@vt.uni-paderborn.de>, 1998.
 
@@ -46,6 +46,13 @@
   unsigned long int neghit;
   unsigned long int posmiss;
   unsigned long int negmiss;
+
+  unsigned long int nentries;
+  unsigned long int maxnentries;
+  unsigned long int maxnsearched;
+
+  unsigned long int rdlockdelayed;
+  unsigned long int wrlockdelayed;
 };
 
 /* Record for transmitting statistics.  */
@@ -53,6 +60,8 @@
 {
   char version[sizeof (compilation)];
   int debug_level;
+  time_t runtime;
+  unsigned long int client_queued;
   int ndbs;
   struct dbstat dbs[lastdb];
 };
@@ -66,6 +75,8 @@
 
   memcpy (data.version, compilation, sizeof (compilation));
   data.debug_level = debug_level;
+  data.runtime = time (NULL) - start_time;
+  data.client_queued = client_queued;
   data.ndbs = lastdb;
 
   for (cnt = 0; cnt < lastdb; ++cnt)
@@ -79,6 +90,11 @@
       data.dbs[cnt].neghit = dbs[cnt].neghit;
       data.dbs[cnt].posmiss = dbs[cnt].posmiss;
       data.dbs[cnt].negmiss = dbs[cnt].negmiss;
+      data.dbs[cnt].nentries = dbs[cnt].nentries;
+      data.dbs[cnt].maxnentries = dbs[cnt].maxnentries;
+      data.dbs[cnt].maxnsearched = dbs[cnt].maxnsearched;
+      data.dbs[cnt].rdlockdelayed = dbs[cnt].rdlockdelayed;
+      data.dbs[cnt].wrlockdelayed = dbs[cnt].wrlockdelayed;
     }
 
   if (TEMP_FAILURE_RETRY (write (fd, &data, sizeof (data))) != sizeof (data))
@@ -98,6 +114,24 @@
   ssize_t nbytes;
   int fd;
   int i;
+  uid_t uid = getuid ();
+
+  /* Find out whether there is another user but root allowed to
+     request statistics.  */
+  if (uid != 0)
+    {
+      /* User specified?  */
+      if(stat_user == NULL || stat_uid != uid)
+	{
+	  if (stat_user != NULL)
+	    error (EXIT_FAILURE, 0,
+		   _("Only root or %s is allowed to use this option!"),
+		   stat_user);
+	  else
+	    error (EXIT_FAILURE, 0,
+		   _("Only root is allowed to use this option!"));
+	}
+    }
 
   /* Open a socket to the running nscd.  */
   fd = nscd_open_socket ();
@@ -120,7 +154,7 @@
   if (TEMP_FAILURE_RETRY (read (fd, &data, sizeof (data))) != sizeof (data)
       || (memcmp (data.version, compilation, sizeof (compilation)) != 0
 	  /* Yes, this is an assignment!  */
-	  && errno == EINVAL))
+	  && (errno = EINVAL)))
     {
       /* Not the right version.  */
       int err = errno;
@@ -131,6 +165,39 @@
   printf (_("nscd configuration:\n\n%15d  server debug level\n"),
 	  data.debug_level);
 
+  /* We know that we can simply subtract time_t values.  */
+  unsigned long int diff = data.runtime;
+  unsigned int ndays = 0;
+  unsigned int nhours = 0;
+  unsigned int nmins = 0;
+  if (diff > 24 * 60 * 60)
+    {
+      ndays = diff / (24 * 60 * 60);
+      diff %= 24 * 60 * 60;
+    }
+  if (diff > 60 * 60)
+    {
+      nhours = diff / (60 * 60);
+      diff %= 60 * 60;
+    }
+  if (diff > 60)
+    {
+      nmins = diff / 60;
+      diff %= 60;
+    }
+  if (ndays != 0)
+    printf (_("%3ud %2uh %2um %2lus  server runtime\n"),
+	    ndays, nhours, nmins, diff);
+  else if (nhours != 0)
+    printf (_("    %2uh %2um %2lus  server runtime\n"), nhours, nmins, diff);
+  else if (nmins != 0)
+    printf (_("        %2um %2lus  server runtime\n"), nmins, diff);
+  else
+    printf (_("            %2lus  server runtime\n"), diff);
+
+  printf (_("%15lu  number of times clients had to wait\n"),
+	  data.client_queued);
+
   for (i = 0; i < lastdb; ++i)
     {
       unsigned long int hit = data.dbs[i].poshit + data.dbs[i].neghit;
@@ -153,14 +220,19 @@
 
       printf (_("\n%s cache:\n\n"
 		"%15s  cache is enabled\n"
-		"%15Zd  suggested size\n"
-		"%15ld  seconds time to live for positive entries\n"
-		"%15ld  seconds time to live for negative entries\n"
-		"%15ld  cache hits on positive entries\n"
-		"%15ld  cache hits on negative entries\n"
-		"%15ld  cache misses on positive entries\n"
-		"%15ld  cache misses on negative entries\n"
-		"%15ld%% cache hit rate\n"
+		"%15Zu  suggested size\n"
+		"%15lu  seconds time to live for positive entries\n"
+		"%15lu  seconds time to live for negative entries\n"
+		"%15lu  cache hits on positive entries\n"
+		"%15lu  cache hits on negative entries\n"
+		"%15lu  cache misses on positive entries\n"
+		"%15lu  cache misses on negative entries\n"
+		"%15lu%% cache hit rate\n"
+		"%15lu  current number of cached values\n"
+		"%15lu  maximum number of cached values\n"
+		"%15lu  maximum chain length searched\n"
+		"%15lu  number of delays on rdlock\n"
+		"%15lu  number of delays on wrlock\n"
 		"%15s  check /etc/%s for changes\n"),
 	      dbnames[i], enabled,
 	      data.dbs[i].module,
@@ -168,7 +240,10 @@
 	      data.dbs[i].poshit, data.dbs[i].neghit,
 	      data.dbs[i].posmiss, data.dbs[i].negmiss,
 	      (100 * hit) / all,
-	      check_file, dbnames[i]);
+	      data.dbs[i].nentries, data.dbs[i].maxnentries,
+	      data.dbs[i].maxnsearched,
+	      data.dbs[i].rdlockdelayed,
+	      data.dbs[i].wrlockdelayed, check_file, dbnames[i]);
     }
 
   close (fd);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nscd/pwdcache.c libc-20030708/nscd/pwdcache.c
--- glibc-2.3.2/nscd/pwdcache.c	2003-01-15 19:28:00.000000000 +0900
+++ libc-20030708/nscd/pwdcache.c	2003-04-28 23:53:22.000000000 +0900
@@ -145,6 +145,7 @@
 	/* There is no reason to go on.  */
 	error (EXIT_FAILURE, errno, _("while allocating cache entry"));
 
+      data->resp.version = NSCD_VERSION;
       data->resp.found = 1;
       data->resp.pw_name_len = pw_name_len;
       data->resp.pw_passwd_len = pw_passwd_len;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/Versions libc-20030708/nss/Versions
--- glibc-2.3.2/nss/Versions	2002-02-02 06:16:41.000000000 +0900
+++ libc-20030708/nss/Versions	2003-07-08 22:58:08.000000000 +0900
@@ -9,6 +9,7 @@
   }
   GLIBC_PRIVATE {
     _nss_files_parse_grent; _nss_files_parse_pwent; _nss_files_parse_spent;
+    __nss_disable_nscd; __nss_lookup_function;
   }
 }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/db-Makefile libc-20030708/nss/db-Makefile
--- glibc-2.3.2/nss/db-Makefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/db-Makefile	2001-07-06 13:55:37.000000000 +0900
@@ -0,0 +1,139 @@
+# Makefile to (re-)generate db versions of system database files.
+# Copyright (C) 1996, 1997, 1998 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+# Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+#
+
+# The GNU C Library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+
+# The GNU C Library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; if not, write to the Free
+# Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+# 02111-1307 USA.
+
+DATABASES = $(wildcard /etc/passwd /etc/group /etc/ethers /etc/protocols \
+		       /etc/rpc /etc/services /etc/shadow /etc/netgroup)
+
+VAR_DB = /var/db
+
+AWK = awk
+MAKEDB = makedb --quiet
+
+all: $(patsubst %,$(VAR_DB)/%.db,$(notdir $(DATABASES)))
+
+
+$(VAR_DB)/passwd.db: /etc/passwd
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS=":"; OFS=":"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$3; print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/group.db: /etc/group
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS=":"; OFS=":"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$3; print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/ethers.db: /etc/ethers
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$2; print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/protocols.db: /etc/protocols
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$2; print; \
+			   for (i = 3; i <= NF && !($$i ~ /^#/); ++i) \
+			     { printf ".%s ", $$i; print } }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/rpc.db: /etc/rpc
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$2; print; \
+			   for (i = 3; i <= NF && !($$i ~ /^#/); ++i) \
+			     { printf ".%s ", $$i; print } }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/services.db: /etc/services
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS="[ \t/]+"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s/%s ", $$1, $$3; print; \
+			   printf ".%s/ ", $$1; print; \
+			   printf "=%s/%s ", $$2, $$3; print; \
+			   printf "=%s/ ", $$2; print; \
+			   for (i = 4; i <= NF && !($$i ~ /^#/); ++i) \
+			     { printf ".%s/%s ", $$i, $$3; print; \
+			       printf ".%s/ ", $$i; print } }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/shadow.db: /etc/shadow
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS=":"; OFS=":"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print }' $^ | \
+	(umask 077 && $(MAKEDB) -o $@ -)
+	@echo "done."
+	@if chgrp shadow $@ 2>/dev/null; then \
+	  chmod g+r $@; \
+	else \
+	  chown 0 $@; chgrp 0 $@; chmod 600 $@; \
+	  echo; \
+	  echo "Warning: The shadow password database $@"; \
+	  echo "has been set to be readable only by root.  You may want"; \
+	  echo "to make it readable by the \`shadow' group depending"; \
+	  echo "on your configuration."; \
+	  echo; \
+	fi
+
+$(VAR_DB)/netgroup.db: /etc/netgroup
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { end=sub(/\\/, " "); \
+			   gsub(/[ \t]+/, " "); \
+			   if(end == 1) printf "%s", $$0; else print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/getXXbyYY.c libc-20030708/nss/getXXbyYY.c
--- glibc-2.3.2/nss/getXXbyYY.c	2002-11-02 11:15:52.000000000 +0900
+++ libc-20030708/nss/getXXbyYY.c	2003-07-08 22:58:09.000000000 +0900
@@ -162,3 +162,5 @@
 
   return result;
 }
+
+static_link_warning (FUNCTION_NAME)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/getXXbyYY_r.c libc-20030708/nss/getXXbyYY_r.c
--- glibc-2.3.2/nss/getXXbyYY_r.c	2003-02-18 12:59:12.000000000 +0900
+++ libc-20030708/nss/getXXbyYY_r.c	2003-07-08 22:58:09.000000000 +0900
@@ -163,7 +163,7 @@
 #endif
 
 #ifdef USE_NSCD
-  if (NOT_USENSCD_NAME && ++NOT_USENSCD_NAME > NSS_NSCD_RETRY)
+  if (NOT_USENSCD_NAME > 0 && ++NOT_USENSCD_NAME > NSS_NSCD_RETRY)
     NOT_USENSCD_NAME = 0;
 
   if (!NOT_USENSCD_NAME)
@@ -247,10 +247,11 @@
 #ifdef POSTPROCESS
   POSTPROCESS;
 #endif
-  return (status != NSS_STATUS_TRYAGAIN ? 0
+  return (status == NSS_STATUS_SUCCESS ? 0
 #ifdef NEED_H_ERRNO
 	  /* These functions only set errno if h_errno is NETDB_INTERNAL.  */
-	  : *h_errnop != NETDB_INTERNAL ? EAGAIN
+	  : status == NSS_STATUS_TRYAGAIN && *h_errnop != NETDB_INTERNAL
+	  ? EAGAIN
 #endif
 	  : errno);
 }
@@ -288,3 +289,5 @@
   versioned_symbol (libc, real, name, version)
 do_default_symbol_version (NEW (REENTRANT_NAME),
 			   REENTRANT_NAME, GLIBC_2_1_2);
+
+static_link_warning (REENTRANT_NAME)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/getXXent.c libc-20030708/nss/getXXent.c
--- glibc-2.3.2/nss/getXXent.c	2002-11-12 10:55:18.000000000 +0900
+++ libc-20030708/nss/getXXent.c	2003-07-08 22:58:09.000000000 +0900
@@ -91,3 +91,5 @@
   __set_errno (save);
   return result;
 }
+
+static_link_warning (GETFUNC_NAME)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/getXXent_r.c libc-20030708/nss/getXXent_r.c
--- glibc-2.3.2/nss/getXXent_r.c	2002-11-04 19:15:12.000000000 +0900
+++ libc-20030708/nss/getXXent_r.c	2003-07-08 22:58:09.000000000 +0900
@@ -201,3 +201,7 @@
   versioned_symbol (libc, real, name, version)
 do_default_symbol_version (NEW (REENTRANT_GETNAME),
 			   REENTRANT_GETNAME, GLIBC_2_1_2);
+
+static_link_warning (SETFUNC_NAME)
+static_link_warning (ENDFUNC_NAME)
+static_link_warning (REENTRANT_GETNAME)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/getent.c libc-20030708/nss/getent.c
--- glibc-2.3.2/nss/getent.c	2003-02-17 04:38:13.000000000 +0900
+++ libc-20030708/nss/getent.c	2003-07-08 22:58:09.000000000 +0900
@@ -229,7 +229,7 @@
 }
 
 /* This is for hosts */
-static inline void
+static void
 print_hosts (struct hostent *host)
 {
   unsigned int cnt;
@@ -296,6 +296,73 @@
   return result;
 }
 
+/* This is for hosts, but using getaddrinfo */
+static int
+ahosts_keys (int number, char *key[])
+{
+  int result = 0;
+  int i;
+  struct hostent *host;
+
+  if (number == 0)
+    {
+      sethostent (0);
+      while ((host = gethostent ()) != NULL)
+	print_hosts (host);
+      endhostent ();
+      return result;
+    }
+
+  struct addrinfo hint;
+  memset (&hint, '\0', sizeof (hint));
+  hint.ai_flags = AI_V4MAPPED | AI_ADDRCONFIG | AI_CANONNAME;
+  hint.ai_family = AF_UNSPEC;
+
+  for (i = 0; i < number; ++i)
+    {
+      struct addrinfo *res;
+
+      if (getaddrinfo (key[i], NULL, &hint, &res) != 0)
+	result = 2;
+      else
+	{
+	  struct addrinfo *runp = res;
+
+	  while (runp != NULL)
+	    {
+	      char sockbuf[20];
+	      const char *sockstr;
+	      if (runp->ai_socktype == SOCK_STREAM)
+		sockstr = "STREAM";
+	      else if (runp->ai_socktype == SOCK_DGRAM)
+		sockstr = "DGRAM";
+	      else if (runp->ai_socktype == SOCK_RAW)
+		sockstr = "RAW";
+	      else
+		{
+		  snprintf (sockbuf, sizeof (sockbuf), "%d",
+			    runp->ai_socktype);
+		  sockstr = sockbuf;
+		}
+
+	      char buf[INET6_ADDRSTRLEN];
+	      printf ("%-15s %-6s %s\n",
+		      inet_ntop (runp->ai_family,
+				 &((struct sockaddr_in *) runp->ai_addr)->sin_addr,
+				 buf, sizeof (buf)),
+		      sockstr,
+		      runp->ai_canonname);
+
+	      runp = runp->ai_next;
+	    }
+
+	  freeaddrinfo (res);
+	}
+    }
+
+  return result;
+}
+
 /* This is for netgroup */
 static int
 netgroup_keys (int number, char *key[])
@@ -329,7 +396,7 @@
 }
 
 /* This is for networks */
-static inline void
+static void
 print_networks (struct netent *net)
 {
   unsigned int i;
@@ -624,7 +691,7 @@
 }
 
 /* This is for shadow */
-static inline void
+static void
 print_shadow (struct spwd *sp)
 {
   printf ("%s:%s:",
@@ -688,6 +755,7 @@
   } databases[] =
   {
 #define D(name) { #name, name ## _keys },
+D(ahosts)
 D(aliases)
 D(ethers)
 D(group)
@@ -723,7 +791,7 @@
 }
 
 /* build doc */
-static inline void
+static void
 build_doc (void)
 {
   int i, j, len;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/makedb.c libc-20030708/nss/makedb.c
--- glibc-2.3.2/nss/makedb.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/makedb.c	2001-07-06 13:55:37.000000000 +0900
@@ -0,0 +1,389 @@
+/* Create simple DB database from textual input.
+   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <argp.h>
+#include <ctype.h>
+#include <dlfcn.h>
+#include <errno.h>
+#include <error.h>
+#include <fcntl.h>
+#include <libintl.h>
+#include <locale.h>
+#include <stdio.h>
+#include <stdint.h>
+#include <stdlib.h>
+#include <string.h>
+#include <sys/stat.h>
+#include "nss_db/dummy-db.h"
+
+/* Get libc version number.  */
+#include "../version.h"
+
+#define PACKAGE _libc_intl_domainname
+
+/* If non-zero convert key to lower case.  */
+static int to_lowercase;
+
+/* If non-zero print content of input file, one entry per line.  */
+static int do_undo;
+
+/* If non-zero do not print informational messages.  */
+static int be_quiet;
+
+/* Name of output file.  */
+static const char *output_name;
+
+/* Name and version of program.  */
+static void print_version (FILE *stream, struct argp_state *state);
+void (*argp_program_version_hook) (FILE *, struct argp_state *) = print_version;
+
+/* Definitions of arguments for argp functions.  */
+static const struct argp_option options[] =
+{
+  { "fold-case", 'f', NULL, 0, N_("Convert key to lower case") },
+  { "output", 'o', N_("NAME"), 0, N_("Write output to file NAME") },
+  { "quiet", 'q', NULL, 0,
+    N_("Do not print messages while building database") },
+  { "undo", 'u', NULL, 0,
+    N_("Print content of database file, one entry a line") },
+  { NULL, 0, NULL, 0, NULL }
+};
+
+/* Short description of program.  */
+static const char doc[] = N_("Create simple DB database from textual input.");
+
+/* Strings for arguments in help texts.  */
+static const char args_doc[] = N_("\
+INPUT-FILE OUTPUT-FILE\n-o OUTPUT-FILE INPUT-FILE\n-u INPUT-FILE");
+
+/* Prototype for option handler.  */
+static error_t parse_opt (int key, char *arg, struct argp_state *state);
+
+/* Function to print some extra text in the help message.  */
+static char *more_help (int key, const char *text, void *input);
+
+/* Data structure to communicate with argp functions.  */
+static struct argp argp =
+{
+  options, parse_opt, args_doc, doc, NULL, more_help
+};
+
+
+/* Prototypes for local functions.  */
+static int process_input (FILE *input, const char *inname, NSS_DB *output,
+			  int to_lowercase, int be_quiet);
+static int print_database (NSS_DB *db);
+
+
+int
+main (int argc, char *argv[])
+{
+  const char *input_name;
+  FILE *input_file;
+  NSS_DB *db_file;
+  int status;
+  int remaining;
+  int mode = 0666;
+
+  /* Set locale via LC_ALL.  */
+  setlocale (LC_ALL, "");
+
+  /* Set the text message domain.  */
+  textdomain (_libc_intl_domainname);
+
+  /* Initialize local variables.  */
+  input_name = NULL;
+
+  /* Parse and process arguments.  */
+  argp_parse (&argp, argc, argv, 0, &remaining, NULL);
+
+  /* Determine file names.  */
+  if (do_undo || output_name != NULL)
+    {
+      if (remaining + 1 != argc)
+	{
+	wrong_arguments:
+	  error (0, 0, gettext ("wrong number of arguments"));
+	  argp_help (&argp, stdout, ARGP_HELP_SEE,
+		     program_invocation_short_name);
+	  exit (1);
+	}
+      input_name = argv[remaining];
+    }
+  else
+    {
+      if (remaining + 2 != argc)
+	goto wrong_arguments;
+
+      input_name = argv[remaining++];
+      output_name = argv[remaining];
+    }
+
+  /* First load the shared object to initialize version dependend
+     variables.  */
+  if (load_db () != NSS_STATUS_SUCCESS)
+    error (EXIT_FAILURE, 0, gettext ("No usable database library found."));
+
+  /* Special handling if we are asked to print the database.  */
+  if (do_undo)
+    {
+      dbopen (input_name, db_rdonly, 0666, &db_file);
+      if (db_file == NULL)
+	error (EXIT_FAILURE, 0, gettext ("cannot open database file `%s': %s"),
+	       input_name,
+	       (errno == EINVAL ? gettext ("incorrectly formatted file")
+		: strerror (errno)));
+
+      status = print_database (db_file);
+
+      db_file->close (db_file->db, 0);
+
+      return status;
+    }
+
+  /* Open input file.  */
+  if (strcmp (input_name, "-") == 0 || strcmp (input_name, "/dev/stdin") == 0)
+    input_file = stdin;
+  else
+    {
+      struct stat st;
+
+      input_file = fopen (input_name, "r");
+      if (input_file == NULL)
+	error (EXIT_FAILURE, errno, gettext ("cannot open input file `%s'"),
+	       input_name);
+
+      /* Get the access rights from the source file.  The output file should
+	 have the same.  */
+      if (fstat (fileno (input_file), &st) >= 0)
+	mode = st.st_mode & ACCESSPERMS;
+    }
+
+  /* Open output file.  This must not be standard output so we don't
+     handle "-" and "/dev/stdout" special.  */
+  dbopen (output_name, DB_CREATE | db_truncate, mode, &db_file);
+  if (db_file == NULL)
+    error (EXIT_FAILURE, errno, gettext ("cannot open output file `%s'"),
+	   output_name);
+
+  /* Start the real work.  */
+  status = process_input (input_file, input_name, db_file, to_lowercase,
+			  be_quiet);
+
+  /* Close files.  */
+  if (input_file != stdin)
+    fclose (input_file);
+  db_file->close (db_file->db, 0);
+
+  return status;
+}
+
+
+/* Handle program arguments.  */
+static error_t
+parse_opt (int key, char *arg, struct argp_state *state)
+{
+  switch (key)
+    {
+    case 'f':
+      to_lowercase = 1;
+      break;
+    case 'o':
+      output_name = arg;
+      break;
+    case 'q':
+      be_quiet = 1;
+      break;
+    case 'u':
+      do_undo = 1;
+      break;
+    default:
+      return ARGP_ERR_UNKNOWN;
+    }
+  return 0;
+}
+
+
+static char *
+more_help (int key, const char *text, void *input)
+{
+  switch (key)
+    {
+    case ARGP_KEY_HELP_EXTRA:
+      /* We print some extra information.  */
+      return strdup (gettext ("\
+Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"));
+    default:
+      break;
+    }
+  return (char *) text;
+}
+
+/* Print the version information.  */
+static void
+print_version (FILE *stream, struct argp_state *state)
+{
+  fprintf (stream, "makedb (GNU %s) %s\n", PACKAGE, VERSION);
+  fprintf (stream, gettext ("\
+Copyright (C) %s Free Software Foundation, Inc.\n\
+This is free software; see the source for copying conditions.  There is NO\n\
+warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\
+"), "2000");
+  fprintf (stream, gettext ("Written by %s.\n"), "Ulrich Drepper");
+}
+
+
+static int
+process_input (input, inname, output, to_lowercase, be_quiet)
+     FILE *input;
+     const char *inname;
+     NSS_DB *output;
+     int to_lowercase;
+     int be_quiet;
+{
+  char *line;
+  size_t linelen;
+  int status;
+  size_t linenr;
+
+  line = NULL;
+  linelen = 0;
+  status = EXIT_SUCCESS;
+  linenr = 0;
+
+  while (!feof (input))
+    {
+      DBT key;
+      DBT val;
+      char *cp;
+      int n;
+
+      n = getline (&line, &linelen, input);
+      if (n < 0)
+	/* This means end of file or some bug.  */
+	break;
+      if (n == 0)
+	/* Short read.  Probably interrupted system call. */
+	continue;
+
+      ++linenr;
+
+      if (line[n - 1] == '\n')
+	/* Remove trailing newline.  */
+	line[--n] = '\0';
+
+      cp = line;
+      while (isspace (*cp))
+	++cp;
+
+      if (*cp == '#')
+	/* First non-space character in line '#': it's a comment.  */
+	continue;
+
+      key.data = cp;
+      while (*cp != '\0' && !isspace (*cp))
+	{
+	  if (to_lowercase)
+	    *cp = tolower (*cp);
+	  ++cp;
+	}
+
+      if (key.data == cp)
+	/* It's an empty line.  */
+	continue;
+
+      key.size = cp - (char *) key.data;
+      key.flags = 0;
+
+      while (isspace (*cp))
+	++cp;
+
+      val.data = cp;
+      val.size = (&line[n] - cp) + 1;
+      val.flags = 0;
+
+      /* Store the value.  */
+      status = output->put (output->db, NULL, &key, &val, db_nooverwrite);
+      if (status != 0)
+	{
+	  if (status == db_keyexist)
+	    {
+	      if (!be_quiet)
+		error_at_line (0, 0, inname, linenr,
+			       gettext ("duplicate key"));
+	      /* This is no real error.  Just give a warning.  */
+	      status = 0;
+	      continue;
+	    }
+	  else
+	    error (0, status, gettext ("while writing database file"));
+
+	  status = EXIT_FAILURE;
+
+	  clearerr (input);
+	  break;
+	}
+    }
+
+  if (ferror (input))
+    {
+      error (0, 0, gettext ("problems while reading `%s'"), inname);
+      status = EXIT_FAILURE;
+    }
+
+  return status;
+}
+
+
+static int
+print_database (db)
+     NSS_DB *db;
+{
+  DBT key;
+  DBT val;
+  NSS_DBC *cursor;
+  int status;
+
+  status = db->cursor (db->db, NULL, &cursor);
+  if (status != 0)
+    {
+      error (0, status, gettext ("while reading database"));
+      return EXIT_FAILURE;
+    }
+
+  key.flags = 0;
+  val.flags = 0;
+  status = cursor->c_get (cursor->cursor, &key, &val, db_first);
+  while (status == 0)
+    {
+      printf ("%.*s %s\n", (int) key.size, (char *) key.data,
+	      (char *) val.data);
+
+      status = cursor->c_get (cursor->cursor, &key, &val, db_next);
+    }
+
+  if (status != db_notfound)
+    {
+      error (0, status, gettext ("while reading database"));
+      return EXIT_FAILURE;
+    }
+
+  return EXIT_SUCCESS;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_db/db-XXX.c libc-20030708/nss/nss_db/db-XXX.c
--- glibc-2.3.2/nss/nss_db/db-XXX.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/nss_db/db-XXX.c	2001-07-06 13:55:38.000000000 +0900
@@ -0,0 +1,261 @@
+/* Common code for DB-based databases in nss_db module.
+   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <dlfcn.h>
+#include <fcntl.h>
+#include <bits/libc-lock.h>
+#include "nsswitch.h"
+#include "nss_db.h"
+
+/* These symbols are defined by the including source file:
+
+   ENTNAME -- database name of the structure and functions (hostent, pwent).
+   STRUCTURE -- struct name, define only if not ENTNAME (passwd, group).
+   DATABASE -- database file name, ("hosts", "passwd")
+
+   NEED_H_ERRNO - defined iff an arg `int *herrnop' is used.
+*/
+
+#define ENTNAME_r	CONCAT(ENTNAME,_r)
+
+#include <paths.h>
+#define	DBFILE		_PATH_VARDB DATABASE ".db"
+
+#ifdef NEED_H_ERRNO
+#define H_ERRNO_PROTO	, int *herrnop
+#define H_ERRNO_ARG	, herrnop
+#define H_ERRNO_SET(val) (*herrnop = (val))
+#else
+#define H_ERRNO_PROTO
+#define H_ERRNO_ARG
+#define H_ERRNO_SET(val) ((void) 0)
+#endif
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Maintenance of the shared handle open on the database.  */
+
+static NSS_DB *db;
+static int keep_db;
+static int entidx;
+
+
+/* Open the database.  */
+enum nss_status
+CONCAT(_nss_db_set,ENTNAME) (int stayopen)
+{
+  enum nss_status status;
+
+  __libc_lock_lock (lock);
+
+  status = internal_setent (DBFILE, &db);
+
+  /* Remember STAYOPEN flag.  */
+  if (db != NULL)
+    keep_db |= stayopen;
+  /* Reset the sequential index.  */
+  entidx = 0;
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
+
+
+/* Close it again.  */
+enum nss_status
+CONCAT(_nss_db_end,ENTNAME) (void)
+{
+  __libc_lock_lock (lock);
+
+  internal_endent (&db);
+
+  /* Reset STAYOPEN flag.  */
+  keep_db = 0;
+
+  __libc_lock_unlock (lock);
+
+  return NSS_STATUS_SUCCESS;
+}
+
+/* Do a database lookup for KEY.  */
+static enum nss_status
+lookup (DBT *key, struct STRUCTURE *result,
+	void *buffer, size_t buflen, int *errnop H_ERRNO_PROTO EXTRA_ARGS_DECL)
+{
+  char *p;
+  enum nss_status status;
+  int err;
+  DBT value;
+
+  /* Open the database.  */
+  if (db == NULL)
+    {
+      status = internal_setent (DBFILE, &db);
+      if (status != NSS_STATUS_SUCCESS)
+	{
+	  *errnop = errno;
+	  H_ERRNO_SET (NETDB_INTERNAL);
+	  return status;
+	}
+    }
+
+  /* Succeed iff it matches a value that parses correctly.  */
+  value.flags = 0;
+  err = DL_CALL_FCT (db->get, (db->db, NULL, key, &value, 0));
+  if (err != 0)
+    {
+      if (err == db_notfound)
+	{
+	  H_ERRNO_SET (HOST_NOT_FOUND);
+	  status = NSS_STATUS_NOTFOUND;
+	}
+      else
+	{
+	  *errnop = err;
+	  H_ERRNO_SET (NETDB_INTERNAL);
+	  status = NSS_STATUS_UNAVAIL;
+	}
+    }
+  else if (buflen < value.size)
+    {
+      /* No room to copy the data to.  */
+      *errnop = ERANGE;
+      H_ERRNO_SET (NETDB_INTERNAL);
+      status = NSS_STATUS_TRYAGAIN;
+    }
+  else
+    {
+      /* Copy the result to a safe place.  */
+      p = (char *) memcpy (buffer, value.data, value.size);
+
+      /* Skip leading blanks.  */
+      while (isspace (*p))
+	++p;
+
+      err = parse_line (p, result, buffer, buflen, errnop EXTRA_ARGS);
+
+      if (err == 0)
+	{
+	  /* If the key begins with '0' we are trying to get the next
+	     entry.  We want to ignore unparsable lines in this case.  */
+	  if (((char *) key->data)[0] == '0')
+	    {
+	      /* Super magical return value.  We need to tell our caller
+		 that it should continue looping.  This value cannot
+		 happen in other cases.  */
+	      status = NSS_STATUS_RETURN;
+	    }
+	  else
+	    {
+	      H_ERRNO_SET (HOST_NOT_FOUND);
+	      status = NSS_STATUS_NOTFOUND;
+	    }
+	}
+      else if (err < 0)
+	{
+	  H_ERRNO_SET (NETDB_INTERNAL);
+	  status = NSS_STATUS_TRYAGAIN;
+	}
+      else
+	status = NSS_STATUS_SUCCESS;
+    }
+
+  if (! keep_db)
+    internal_endent (&db);
+
+  return status;
+}
+
+
+/* Macro for defining lookup functions for this DB-based database.
+
+   NAME is the name of the lookup; e.g. `pwnam'.
+
+   KEYPATTERN gives `printf' args to construct a key string;
+   e.g. `(".%s", name)'.
+
+   KEYSIZE gives the allocation size of a buffer to construct it in;
+   e.g. `1 + strlen (name)'.
+
+   PROTO describes the arguments for the lookup key;
+   e.g. `const char *name'.
+
+   BREAK_IF_MATCH is ignored, but used by ../nss_files/files-XXX.c.  */
+
+#define DB_LOOKUP(name, keysize, keypattern, break_if_match, proto...)	      \
+enum nss_status								      \
+_nss_db_get##name##_r (proto,						      \
+		       struct STRUCTURE *result,			      \
+		       char *buffer, size_t buflen, int *errnop H_ERRNO_PROTO)\
+{									      \
+  DBT key;								      \
+  enum nss_status status;						      \
+  const size_t size = (keysize) + 1;					      \
+  key.data = __alloca (size);						      \
+  key.size = KEYPRINTF keypattern;					      \
+  key.flags = 0;							      \
+  __libc_lock_lock (lock);						      \
+  status = lookup (&key, result, buffer, buflen, errnop H_ERRNO_ARG	      \
+		   EXTRA_ARGS_VALUE);					      \
+  __libc_lock_unlock (lock);						      \
+  return status;							      \
+}
+
+#define KEYPRINTF(pattern, args...) snprintf (key.data, size, pattern ,##args)
+
+
+
+
+/* Return the next entry from the database file, doing locking.  */
+enum nss_status
+CONCAT(_nss_db_get,ENTNAME_r) (struct STRUCTURE *result, char *buffer,
+			       size_t buflen, int *errnop H_ERRNO_PROTO)
+{
+  /* Return next entry in host file.  */
+  enum nss_status status;
+  char buf[20];
+  DBT key;
+
+  __libc_lock_lock (lock);
+
+  /* Loop until we find a valid entry or hit EOF.  See above for the
+     special meaning of the status value.  */
+  do
+    {
+      key.size = snprintf (key.data = buf, sizeof buf, "0%u", entidx++);
+      key.flags = 0;
+      status = lookup (&key, result, buffer, buflen, errnop H_ERRNO_ARG
+		       EXTRA_ARGS_VALUE);
+      if (status == NSS_STATUS_TRYAGAIN
+#ifdef NEED_H_ERRNO
+	  && *herrnop == NETDB_INTERNAL
+#endif
+	  && *errnop == ERANGE)
+	/* Give the user a chance to get the same entry with a larger
+	   buffer.  */
+	--entidx;
+    }
+  while (status == NSS_STATUS_RETURN);
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_db/db-alias.c libc-20030708/nss/nss_db/db-alias.c
--- glibc-2.3.2/nss/nss_db/db-alias.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/nss_db/db-alias.c	2001-07-06 13:55:38.000000000 +0900
@@ -0,0 +1,215 @@
+/* Mail alias file parser in nss_db module.
+   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <aliases.h>
+#include <alloca.h>
+#include <ctype.h>
+#include <dlfcn.h>
+#include <errno.h>
+#include <bits/libc-lock.h>
+#include <paths.h>
+#include <string.h>
+
+#include "nsswitch.h"
+#include "nss_db.h"
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Maintenance of the shared handle open on the database.  */
+
+static NSS_DB *db;
+static int keep_db;
+static unsigned int entidx;	/* Index for `getaliasent_r'. */
+
+
+/* Open database.  */
+enum nss_status
+_nss_db_setaliasent (int stayopen)
+{
+  enum nss_status status;
+
+  __libc_lock_lock (lock);
+
+  status = internal_setent (_PATH_VARDB "aliases.db", &db);
+
+  /* Remember STAYOPEN flag.  */
+  if (db != NULL)
+    keep_db |= stayopen;
+
+  /* Reset the sequential index.  */
+  entidx = 0;
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
+
+
+/* Close it again.  */
+enum nss_status
+_nss_db_endaliasent (void)
+{
+  __libc_lock_lock (lock);
+
+  internal_endent (&db);
+
+  /* Reset STAYOPEN flag.  */
+  keep_db = 0;
+
+  __libc_lock_unlock (lock);
+
+  return NSS_STATUS_SUCCESS;
+}
+
+/* We provide the parse function here.  The parser in libnss_files
+   cannot be used.  The generation of the db file already resolved all
+   :include: statements so we simply have to parse the list and store
+   the result.  */
+static enum nss_status
+lookup (DBT *key, struct aliasent *result, char *buffer,
+	size_t buflen, int *errnop)
+{
+  enum nss_status status;
+  DBT value;
+
+  /* Open the database.  */
+  if (db == NULL)
+    {
+      status = internal_setent (_PATH_VARDB "aliases.db", &db);
+      if (status != NSS_STATUS_SUCCESS)
+	{
+	  *errnop = errno;
+	  return status;
+	}
+    }
+
+  value.flags = 0;
+  if (DL_CALL_FCT (db->get, (db->db, NULL, key, &value, 0)) == 0)
+    {
+      const char *src = value.data;
+      char *cp;
+      size_t cnt;
+
+      result->alias_members_len = 0;
+
+      /* We now have to fill the BUFFER with all the information. */
+      if (buflen < key->size + 1)
+	{
+	no_more_room:
+	  *errnop = ERANGE;
+	  return NSS_STATUS_TRYAGAIN;
+	}
+
+      buffer = stpncpy (buffer, key->data, key->size) + 1;
+      buflen -= key->size + 1;
+
+      while (*src != '\0')
+	{
+	  const char *end, *upto;
+	  while (isspace (*src))
+	    ++src;
+
+	  end = strchr (src, ',');
+	  if (end == NULL)
+	    end = strchr (src, '\0');
+	  for (upto = end; upto > src && isspace (upto[-1]); --upto);
+
+	  if (upto != src)
+	    {
+	      if ((upto - src) + __alignof__ (char *) > buflen)
+		goto no_more_room;
+	      buffer = stpncpy (buffer, src, upto - src) + 1;
+	      buflen -= (upto - src) + __alignof (char *);
+	      ++result->alias_members_len;
+	    }
+	  src = end + (*end != '\0');
+	}
+
+      /* Now prepare the return.  Provide string pointers for the
+	 currently selected aliases.  */
+
+      /* Adjust the pointer so it is aligned for storing pointers.  */
+      buffer += __alignof__ (char *) - 1;
+      buffer -= ((buffer - (char *) 0) % __alignof__ (char *));
+      result->alias_members = (char **) buffer;
+
+      /* Compute addresses of alias entry strings.  */
+      cp = result->alias_name;
+      for (cnt = 0; cnt < result->alias_members_len; ++cnt)
+	{
+	  cp = strchr (cp, '\0') + 1;
+	  result->alias_members[cnt] = cp;
+	}
+
+      status = (result->alias_members_len == 0
+		? NSS_STATUS_RETURN : NSS_STATUS_SUCCESS);
+    }
+  else
+    status = NSS_STATUS_NOTFOUND;
+
+  if (! keep_db)
+    internal_endent (&db);
+
+  return status;
+}
+
+enum nss_status
+_nss_db_getaliasent_r (struct aliasent *result, char *buffer, size_t buflen,
+		       int *errnop)
+{
+  /* Return next entry in alias file.  */
+  enum nss_status status;
+  char buf[20];
+  DBT key;
+
+  __libc_lock_lock (lock);
+  key.size = snprintf (key.data = buf, sizeof buf, "0%u", entidx++);
+  key.flags = 0;
+  status = lookup (&key, result, buffer, buflen, errnop);
+  if (status == NSS_STATUS_TRYAGAIN && *errnop == ERANGE)
+    /* Give the user a chance to get the same entry with a larger buffer.  */
+    --entidx;
+  __libc_lock_unlock (lock);
+
+  return status;
+}
+
+
+enum nss_status
+_nss_db_getaliasbyname_r (const char *name, struct aliasent *result,
+			  char *buffer, size_t buflen, int *errnop)
+{
+  DBT key;
+  enum nss_status status;
+
+  key.size = 1 + strlen (name);
+
+  key.data = __alloca (key.size);
+  ((char *) key.data)[0] = '.';
+  memcpy (&((char *) key.data)[1], name, key.size - 1);
+  key.flags = 0;
+
+  __libc_lock_lock (lock);
+  status = lookup (&key, result, buffer, buflen, errnop);
+  __libc_lock_unlock (lock);
+
+  return status;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_db/db-netgrp.c libc-20030708/nss/nss_db/db-netgrp.c
--- glibc-2.3.2/nss/nss_db/db-netgrp.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/nss_db/db-netgrp.c	2001-07-06 13:55:38.000000000 +0900
@@ -0,0 +1,103 @@
+/* Netgroup file parser in nss_db modules.
+   Copyright (C) 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <dlfcn.h>
+#include <errno.h>
+#include <fcntl.h>
+#include <netgroup.h>
+#include <string.h>
+#include <bits/libc-lock.h>
+#include <paths.h>
+
+#include "nsswitch.h"
+#include "nss_db.h"
+
+
+#define DBFILE		_PATH_VARDB "netgroup.db"
+
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Maintenance of the shared handle open on the database.  */
+static NSS_DB *db;
+static char *entry;
+static char *cursor;
+
+enum nss_status
+_nss_db_setnetgrent (const char *group)
+{
+  enum nss_status status;
+
+  __libc_lock_lock (lock);
+
+  status = internal_setent (DBFILE, &db);
+
+  if (status == NSS_STATUS_SUCCESS)
+    {
+      DBT key = { data: (void *) group, size: strlen (group), flags: 0 };
+      DBT value;
+
+      value.flags = 0;
+      if (DL_CALL_FCT (db->get, (db->db, NULL, &key, &value, 0)) != 0)
+	status = NSS_STATUS_NOTFOUND;
+      else
+	cursor = entry = value.data;
+    }
+
+  __libc_lock_unlock (lock);
+
+  return status;
+
+}
+
+
+enum nss_status
+_nss_db_endnetgrent (void)
+{
+  __libc_lock_lock (lock);
+
+  internal_endent (&db);
+
+  __libc_lock_unlock (lock);
+
+  return NSS_STATUS_SUCCESS;
+}
+
+
+extern enum nss_status _nss_netgroup_parseline (char **cursor,
+						struct __netgrent *result,
+						char *buffer, size_t buflen,
+						int *errnop);
+
+enum nss_status
+_nss_db_getnetgrent_r (struct __netgrent *result, char *buffer, size_t buflen,
+		       int *errnop)
+{
+  int status;
+
+  __libc_lock_lock (lock);
+
+  status = _nss_netgroup_parseline (&cursor, result, buffer, buflen, errnop);
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_db/db-open.c libc-20030708/nss/nss_db/db-open.c
--- glibc-2.3.2/nss/nss_db/db-open.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/nss_db/db-open.c	2001-07-06 13:55:38.000000000 +0900
@@ -0,0 +1,389 @@
+/* Common database routines for nss_db.
+   Copyright (C) 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <fcntl.h>
+#include <dlfcn.h>
+#include <stdlib.h>
+#include <string.h>
+#include <bits/libc-lock.h>
+
+#include "dummy-db.h"
+#include "nss_db.h"
+
+/* This file contains the functions used to open and close the databases
+   read by the rest of libnss_db.  Not all of them are thread safe;
+   make sure the caller does the appropriate locking.
+
+   We dynamically load the database library, so that it does not have
+   to be present when glibc is compiled.  Once loaded, the database
+   library is never never unloaded again until the libnss_db module is
+   unloaded (from the free_mem routine in nsswitch.c) -- we catch the
+   unload by providing a shlib destructor.  (XXX Does that actually
+   work?)  */
+
+/* Handle for the shared Berkeley DB library.  If non-null, the
+   database library is completely loaded and ready to be used by
+   multithreaded code.  */
+static void *libdb_handle;
+
+/* The version of the Berkeley DB library we are using.  */
+enum {
+  nodb,
+  db24,
+  db27,
+  db30
+} libdb_version;
+
+/* Pointer to the db_open function.  For use with DB 2.x.  */
+static int (*libdb_db_open) (const char *, int,
+			     uint32_t, int, void *, void *, void **);
+
+/* Pointer to the db_create function.  For use with DB 3.x.  */
+static int (*libdb_db_create) (void *, void *, uint32_t);
+
+/* Constants which vary from version to version are actually variables
+   here.  */
+int db_first;
+int db_next;
+int db_nooverwrite;
+int db_truncate;
+int db_rdonly;
+/* Variables which keep track of the error values.  */
+int db_keyexist;
+int db_notfound;
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Dynamically load the database library.  Return zero if successful,
+   non-zero if no suitable version of the library could be loaded.
+   Must be called with the above lock held if it might run in a
+   multithreaded context.
+
+   We try currently:
+   - libdb.so.3: the name used by glibc 2.1
+   - libdb-3.0.so: the name used by db-3.0.x
+   and maybe others in the future.  */
+
+enum nss_status
+load_db (void)
+{
+  static const char *libnames[] = { "libdb.so.3", "libdb-3.0.so" };
+  int x;
+
+  for (x = 0; x < sizeof (libnames) / sizeof (libnames[0]); ++x)
+    {
+      libdb_handle = dlopen (libnames[x], RTLD_LAZY);
+      if (libdb_handle == NULL)
+	continue;
+
+      /* DB 3.0 has db_create instead of db_open.  */
+      libdb_db_create = dlsym (libdb_handle, "db_create");
+
+      if (libdb_db_create == NULL)
+	/* DB 2.x uses db_open.  */
+	libdb_db_open = dlsym (libdb_handle, "db_open");
+
+      if (libdb_db_open != NULL || libdb_db_create != NULL)
+	{
+	  /* Alright, we got a library.  Now find out which version it is.  */
+	  const char *(*db_version) (int *, int *, int *);
+
+	  db_version = dlsym (libdb_handle, "db_version");
+	  if (db_version != NULL)
+	    {
+	      /* Call the function and get the information.  */
+	      int major, minor, subminor;
+
+	      DL_CALL_FCT (db_version, (&major, &minor, &subminor));
+	      switch (major)
+		{
+		case 2:
+		  /* Sanity check: Do we have db_open?  */
+		  if (libdb_db_open != NULL)
+		    {
+		      if (minor < 6 || (minor == 6 && subminor < 4))
+			{
+			  libdb_version = db24;
+			  db_first = DB24_FIRST;
+			  db_next = DB24_NEXT;
+			  db_nooverwrite = DB24_NOOVERWRITE;
+			  db_truncate = DB24_TRUNCATE;
+			}
+		      else
+			{
+			  libdb_version = db27;
+			  db_first = DB27_FIRST;
+			  db_next = DB27_NEXT;
+			  db_nooverwrite = DB27_NOOVERWRITE;
+			  db_truncate = DB27_TRUNCATE;
+			}
+		      db_keyexist = DB2x_KEYEXIST;
+		      db_notfound = DB2x_NOTFOUND;
+		      db_rdonly = DB2x_RDONLY;
+		    }
+		  break;
+
+		case 3:
+		  /* Sanity check: Do we have db_create?  */
+		  if (libdb_db_create != NULL)
+		    {
+		      libdb_version = db30;
+		      db_first = DB30_FIRST;
+		      db_next = DB30_NEXT;
+		      db_keyexist = DB30_KEYEXIST;
+		      db_notfound = DB30_NOTFOUND;
+		      db_rdonly = DB30_RDONLY;
+		    }
+		  break;
+
+		default:
+		  break;
+		}
+	    }
+
+	  if (libdb_version != nodb)
+	    return NSS_STATUS_SUCCESS;
+
+	  /* Clear variables.  */
+	  libdb_db_open = NULL;
+	  libdb_db_create = NULL;
+	}
+
+      dlclose (libdb_handle);
+    }
+
+  (void) dlerror ();
+  return NSS_STATUS_UNAVAIL;
+}
+
+/* Set the `FD_CLOEXEC' flag of FD.  Return 0 on success, or -1 on
+   error with `errno' set. */
+static int
+set_cloexec_flag (int fd)
+{
+  int oldflags = fcntl (fd, F_GETFD, 0);
+
+  if (oldflags < 0)
+    return oldflags;
+
+  oldflags |= FD_CLOEXEC;
+
+  return fcntl (fd, F_SETFD, oldflags);
+}
+
+/* Make sure we don't use the library anymore once we are shutting down.  */
+static void __attribute__ ((destructor))
+unload_db (void)
+{
+  if (libdb_handle != NULL)
+    {
+      libdb_db_open = NULL;
+      libdb_db_create = NULL;
+      libdb_version = nodb;
+      dlclose (libdb_handle);
+    }
+}
+
+/* Open the database stored in FILE.  If succesful, store the database
+   handle in *DBP and return NSS_STATUS_SUCCESS.  On failure, return
+   the appropriate lookup status.  */
+enum nss_status
+internal_setent (const char *file, NSS_DB **dbp)
+{
+  enum nss_status status = NSS_STATUS_SUCCESS;
+
+  if (*dbp == NULL)
+    {
+      if (libdb_db_open == NULL && libdb_db_create == NULL)
+	{
+	  __libc_lock_lock (lock);
+
+	  if (libdb_db_open == NULL && libdb_db_create == NULL)
+	    status = load_db ();
+
+	  __libc_lock_unlock (lock);
+	}
+
+      if (status == NSS_STATUS_SUCCESS)
+	status = dbopen (file, db_rdonly, 0, dbp);
+    }
+
+  return status;
+}
+
+
+/* Close the database *DBP.  */
+void
+internal_endent (NSS_DB **dbp)
+{
+  NSS_DB *db = *dbp;
+
+  if (db != NULL)
+    {
+      DL_CALL_FCT (db->close, (db->db, 0));
+      *dbp = NULL;
+    }
+}
+
+/* Allocate a cursor for database DB and transaction TXN.  On success,
+   store the cursor in *DBCP and return zero.  Otherwise return an
+   error value.  */
+int
+db_cursor (void *db, void *txn, NSS_DBC **dbcp)
+{
+  NSS_DBC *dbc;
+  int ret;
+
+  dbc = (NSS_DBC *) malloc (sizeof (NSS_DBC));
+  if (dbc == NULL)
+    return ENOMEM;
+
+  switch (libdb_version)
+    {
+    case db24:
+      ret = ((struct db24 *) db)->cursor (db, txn, &dbc->cursor);
+
+      if (ret == 0)
+	dbc->c_get = ((struct dbc24 *) dbc->cursor)->c_get;
+      break;
+
+    case db27:
+      ret = ((struct db27 *) db)->cursor (db, txn, &dbc->cursor, 0);
+
+      if (ret == 0)
+	dbc->c_get = ((struct dbc27 *) dbc->cursor)->c_get;
+      break;
+
+    case db30:
+      ret = ((struct db30 *) db)->cursor (db, txn, &dbc->cursor, 0);
+
+      if (ret == 0)
+	dbc->c_get = ((struct dbc30 *) dbc->cursor)->c_get;
+      break;
+
+    default:
+      abort ();
+    }
+
+  if (ret != 0)
+    {
+      free (dbc);
+      return ret;
+    }
+
+  *dbcp = dbc;
+
+  return 0;
+}
+
+
+/* Open the database in FNAME, for access specified by FLAGS.  If
+   opening the database causes the file FNAME to be created, it is
+   created with MODE.  If succesful, store the database handle in *DBP
+   and return NSS_STATUS_SUCCESS.  On failure, return the appropriate
+   lookup status.  */
+int
+dbopen (const char *fname, int oper, int mode, NSS_DB **dbp)
+{
+  int err;
+  int fd;
+  NSS_DB *db;
+
+  /* Construct the object we pass up.  */
+  db = (NSS_DB *) calloc (1, sizeof (NSS_DB));
+  if (db == NULL)
+    return NSS_STATUS_UNAVAIL;
+
+  /* Initialize the object.  */
+  db->cursor = db_cursor;
+
+  /* Actually open the database.  */
+  switch (libdb_version)
+    {
+    case db24:
+    case db27:
+      err = DL_CALL_FCT (libdb_db_open,
+			 (fname, DB_BTREE, oper, mode, NULL, NULL, &db->db));
+      if (err != 0)
+	goto fail;
+
+      if (libdb_version)
+	{
+	  db->close = ((struct db24 *) db->db)->close;
+	  db->fd = ((struct db24 *) db->db)->fd;
+	  db->get = ((struct db24 *) db->db)->get;
+	  db->put = ((struct db24 *) db->db)->put;
+	}
+      else
+	{
+	  db->close = ((struct db27 *) db->db)->close;
+	  db->fd = ((struct db27 *) db->db)->fd;
+	  db->get = ((struct db27 *) db->db)->get;
+	  db->put = ((struct db27 *) db->db)->put;
+	}
+      break;
+
+    case db30:
+      err = DL_CALL_FCT (libdb_db_create, (db->db, NULL, 0));
+      if (err != 0)
+	goto fail;
+
+      db->close = ((struct db30 *) db->db)->close;
+      db->fd = ((struct db30 *) db->db)->fd;
+      db->get = ((struct db30 *) db->db)->get;
+      db->put = ((struct db30 *) db->db)->put;
+
+      err = ((struct db30 *) db->db)->open (db->db, fname, NULL, DB_BTREE,
+					    oper, mode);
+      if (err != 0)
+	goto fail;
+      break;
+
+    default:
+      abort ();
+    }
+
+  /* We have to make sure the file is `closed on exec'.  */
+  err = DL_CALL_FCT (db->fd, (db->db, &fd));
+  if (err != 0)
+    goto fail;
+  if (set_cloexec_flag (fd) < 0)
+    goto fail;
+
+  *dbp = db;
+
+  return NSS_STATUS_UNAVAIL;
+
+ fail:
+  /* Something went wrong.  Close the database if necessary.  */
+  if (db)
+    {
+      if (db->db && db->close)
+	DL_CALL_FCT (db->close, (db->db, 0));
+      free (db);
+    }
+
+  /* Make sure `errno' is set.  */
+  if (err)
+    __set_errno (err);
+
+  return err == EAGAIN ? NSS_STATUS_TRYAGAIN : NSS_STATUS_UNAVAIL;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_db/dummy-db.h libc-20030708/nss/nss_db/dummy-db.h
--- glibc-2.3.2/nss/nss_db/dummy-db.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/nss_db/dummy-db.h	2001-07-06 13:55:38.000000000 +0900
@@ -0,0 +1,333 @@
+/* Constants and structures from the various Berkeley DB releases.
+   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+#include "nss_db.h"
+
+/* This file contains dummy definitions for various constants and
+   structures from the Berkeley release.  We only provide those
+   definitions that are actually needed.  In case of the structures,
+   we're only interested in the function pointers, since that's the
+   interface to the database.  Unfortunately the structures have been
+   changed several times.  */
+
+/* The value for the btree database type has not been changed (yet?).  */
+#define DB_BTREE	(1)
+
+/* Permission flags for all 2.x releases.  */
+#define DB2x_RDONLY	0x010000
+
+/* The error values for all 2.x releases.  */
+#define DB2x_KEYEXIST	( -3)
+#define DB2x_NOTFOUND	( -7)
+
+/* For all 2.x releases up to 2.6.3 we can use the same definitions.
+   We'll refer to them as 2.4 since that's the version distributed
+   with glibc 2.1.  */
+
+/* Access methods from version 2.4.  */
+#define DB24_FIRST		0x000020
+#define DB24_NEXT		0x000800
+#define DB24_NOOVERWRITE	0x001000
+
+/* Permission flags from version 2.4.  */
+#define DB24_TRUNCATE	0x080000
+
+/* The DB structure from version 2.4.  */
+struct db24
+{
+  void	*mutexp;
+  enum { dummy24 } type;
+  void *dbenv;
+  void *mp_dbenv;
+  void *master;
+  void *internal;
+  void *mp;
+  void *mpf;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } curs_queue;
+  struct {
+    void *lh_first;
+  } handleq;
+  struct {
+    void *le_next;
+    void **le_prev;
+  } links;
+  uint32_t log_fileid;
+  void *txn;
+  uint32_t locker;
+  struct db24_dbt {
+    void *data;
+    uint32_t size;
+    uint32_t ulen;
+    uint32_t dlen;
+    uint32_t doff;
+    uint32_t flags;
+  } lock_dbt;
+  struct{
+    uint32_t pgno;
+    uint8_t fileid[20];
+  } lock;
+  size_t pgsize;
+  void *db_malloc;
+  /* Functions. */
+  int (*close) (void *, uint32_t);
+  int (*cursor) (void *, void *, void **);
+  int (*del) (void *, void *, DBT *, uint32_t);
+  int (*fd) (void *, int *);
+  int (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*put) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*stat) (void *, void *, void *(*)(size_t), uint32_t);
+  int (*sync) (void *, uint32_t);
+  uint32_t flags;
+};
+
+/* The DBC structure for the 2.4 release.  */
+struct dbc24
+{
+  void *dbp;
+  void *txn;
+  struct
+  {
+    void *tqe_next;
+    void **tqe_prev;
+  } links;
+  void *internal;
+  void *c_close;
+  void *c_del;
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+  void *c_put;
+};
+
+/* The 2.7 release is slighty different.  */
+
+/* Access methods from version 2.7.  */
+#define DB27_FIRST		7
+#define DB27_NEXT		15
+#define DB27_NOOVERWRITE	17
+
+/* Permission flags from version 2.7.  */
+#define DB27_TRUNCATE	0x020000
+
+/* The DB structure from version 2.7.  */
+struct db27
+{
+  void	*mutexp;
+  enum { dummy27 } type;
+  int byteswapped;
+  int saved_open_fd;
+  void *dbenv;
+  void *mp_dbenv;
+  void *internal;
+  void *mp;
+  void *mpf;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } free_queue;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } active_queue;
+  uint8_t fileid[20];
+  uint32_t log_fileid;
+  size_t pgsize;
+  void *db_malloc;
+  void *dup_compare;
+  void *h_hash;
+  /* Functions. */
+  int (*am_close) (void *);
+  int (*close) (void *, uint32_t);
+  int (*cursor) (void *, void *, void **, uint32_t);
+  int (*del) (void *, void *, DBT *, uint32_t);
+  int (*fd) (void *, int *);
+  int (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*join) (void *, void **, uint32_t, void **);
+  int (*put) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*stat) (void *, void *, void *(*)(size_t), uint32_t);
+  int (*sync) (void *, uint32_t);
+  uint32_t flags;
+};
+
+/* The DBC structure for version 2.7.  */
+struct dbc27
+{
+  void *dbp;
+  void *txn;
+  struct
+  {
+    void *tqe_next;
+    void **tqe_prev;
+  } links;
+  uint32_t lid;
+  uint32_t locker;
+  DBT lock_dbt;
+  struct{
+    uint32_t pgno;
+    uint8_t fileid[20];
+  } lock;
+  size_t mylock;
+  DBT rkey;
+  DBT rdata;
+  void *c_am_close;
+  void *c_am_destroy;
+  void *c_close;
+  void *c_del;
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+  void *c_put;
+  void *internal;
+  uint32_t flags;
+};
+
+/* Version 3.0 is mostly incompatible with 2.x.  */
+
+/* Access methods from version 3.0.  */
+#define DB30_FIRST		9
+#define DB30_NEXT		17
+#define DB30_NOOVERWRITE	20
+
+/* Error values from version 3.0.  */
+#define DB30_KEYEXIST	(-30997)
+#define DB30_NOTFOUND	(-30994)
+
+/* Permission flags from version 3.0.  */
+#define DB30_RDONLY	0x000010
+#define DB30_TRUNCATE	0x020000
+
+/* The DB structure from version 3.0.  */
+struct db30
+{
+  size_t pgsize;
+  void (*db_feedback) (void *, int, int);
+  void *(*db_malloc) (size_t);
+  void *(*db_realloc) (void *, size_t);
+  int (*dup_compare) (const DBT *, const DBT *);
+  void *dbenv;
+  enum { dummy30 } type;
+  void *mpf;
+  void	*mutexp;
+  u_int8_t fileid[20];
+  int32_t log_fileid;
+  void *open_txn;
+  void *saved_open_fhp;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } free_queue;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } active_queue;
+  void	*bt_internal;
+  void	*cj_internal;
+  void	*h_internal;
+  void	*q_internal;
+  void	*xa_internal;
+  /* Functions.  */
+  int  (*close) (void *, uint32_t);
+  int  (*cursor) (void *, void *, void **, uint32_t);
+  int  (*del) (void *, void *, DBT *, uint32_t);
+  void (*err) (void *, int, const char *, ...);
+  void (*errx) (void *, const char *, ...);
+  int  (*fd) (void *, int *);
+  int  (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int  (*get_byteswapped) (void *);
+  int (*get_type) (void *);
+  int  (*join) (void *, void **, void **, uint32_t);
+  int  (*open) (void *,	const char *, const char *, int, uint32_t, int);
+  int  (*put) (void *, void *, DBT *, DBT *, uint32_t);
+  int  (*remove) (void *, const char *, const char *, uint32_t);
+  int  (*set_cachesize) (void *, uint32_t, uint32_t, int);
+  int  (*set_dup_compare) (void *, int (*)(const DBT *, const DBT *));
+  void (*set_errcall) (void *, void (*)(const char *, char *));
+  void (*set_errfile) (void *, void *);
+  void (*set_errpfx) (void *, const char *);
+  void (*set_feedback) (void *, void (*)(void *, int, int));
+  int  (*set_flags) (void *, uint32_t);
+  int  (*set_lorder) (void *, int);
+  int  (*set_malloc) (void *, void *(*)(size_t));
+  int  (*set_pagesize) (void *, uint32_t);
+  void (*set_paniccall) (void *, void (*)(void *, int));
+  int  (*set_realloc) (void *, void *(*)(void *, size_t));
+  int  (*stat) (void *, void *, void *(*)(size_t), uint32_t);
+  int  (*sync) (void *, uint32_t);
+  int  (*upgrade) (void *, const char *, uint32_t);
+
+  int  (*set_bt_compare) (void *, int (*)(const DBT *, const DBT *));
+  int  (*set_bt_maxkey) (void *, uint32_t);
+  int  (*set_bt_minkey) (void *, uint32_t);
+  int  (*set_bt_prefix) (void *, size_t (*)(const DBT *, const DBT *));
+
+  int  (*set_h_ffactor) (void *, uint32_t);
+  int  (*set_h_hash) (void *, uint32_t (*)(const void *, uint32_t));
+  int  (*set_h_nelem) (void *, uint32_t);
+
+  int  (*set_re_delim) (void *, int);
+  int  (*set_re_len) (void *, uint32_t);
+  int  (*set_re_pad) (void *, int);
+  int  (*set_re_source) (void *, const char *);
+
+  uint32_t am_ok;
+  uint32_t flags;
+};
+
+/* The DBC structure from version 3.0.  */
+struct dbc30
+{
+  void *dbp;
+  void *txn;
+  struct
+  {
+    void *tqe_next;
+    void **tqe_prev;
+  } links;
+  uint32_t lid;			/* Default process' locker id. */
+  uint32_t locker;		/* Locker for this operation. */
+  DBT lock_dbt;		/* DBT referencing lock. */
+  struct
+  {
+    uint32_t pgno;
+    uint8_t fileid[20];
+  } lock;
+  struct
+  {
+    size_t off;
+    uint32_t ndx;
+    uint32_t gen;
+  } mylock;
+  DBT rkey;
+  DBT rdata;
+  int (*c_close) (void *);
+  int (*c_del) (void *, uint32_t);
+  int (*c_dup) (void *, void **, uint32_t);
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+  int (*c_put) (void *, DBT *, DBT *, uint32_t);
+  int (*c_am_close) (void *);
+  int (*c_am_destroy) (void *);
+  void *internal;
+  uint32_t flags;
+};
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_db/nss_db.h libc-20030708/nss/nss_db/nss_db.h
--- glibc-2.3.2/nss/nss_db/nss_db.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/nss/nss_db/nss_db.h	2001-07-06 13:55:38.000000000 +0900
@@ -0,0 +1,94 @@
+/* Common database open/close routines for nss_db.
+   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _NSS_DB_H
+#define _NSS_DB_H	1
+
+#include <nss.h>
+#include <stdint.h>
+
+/* Variables which keep track of the error values.  */
+extern int db_keyexist;
+extern int db_notfound;
+
+/* This flag is the same for all versions of the Berkeley DB library.  */
+#define DB_CREATE	0x000001
+
+/* But constants which vary from version to version are actually
+   variables here.  */
+extern int db_first;
+extern int db_next;
+extern int db_nooverwrite;
+extern int db_truncate;
+extern int db_rdonly;
+
+/* The `DBT' type is the same in all versions we support.  */
+typedef struct
+{
+  void *data;
+  uint32_t size;
+  uint32_t ulen;
+  uint32_t dlen;
+  uint32_t doff;
+  uint32_t flags;
+} DBT;
+
+/* But the cursor object is very different from version to version.  */
+typedef struct
+{
+  void *cursor;
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+} NSS_DBC;
+
+/* We need a helper function for it.  */
+extern int db_cursor (void *db, void *txn, NSS_DBC **dbcp);
+
+/* This is the wrapper we put around the `DB' structures to provide a
+   uniform interface to the higher-level functions.  */
+typedef struct
+{
+  void *db;
+  int (*close) (void *, uint32_t);
+  int (*cursor) (void *, void *, NSS_DBC **);
+  int (*fd) (void *, int *);
+  int (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*put) (void *, void *, DBT *, DBT *, uint32_t);
+} NSS_DB;
+
+/* Open the database stored in FILE.  If succesful, store the database
+   handle in *DBP and return NSS_STATUS_SUCCESS.  On failure, return
+   the appropriate lookup status.  */
+extern enum nss_status internal_setent (const char *file, NSS_DB **dbp);
+
+/* Close the database *DBP.  */
+extern void internal_endent (NSS_DB **dbp);
+
+/* Dynamically load the Berkeley DB library.  Return zero if
+   successful, non-zero if no suitable version of the library could be
+   loaded.  */
+extern enum nss_status load_db (void);
+
+/* Open the database in FNAME, for access specified by FLAGS.  If
+   opening the database causes the file FNAME to be created, it is
+   created with MODE.  If succesful, store the database handle in *DBP
+   and return NSS_STATUS_SUCCESS.  On failure, return the appropriate
+   lookup status.  */
+extern int dbopen (const char *fname, int oper, int mode, NSS_DB **dbp);
+
+#endif	/* nss_db.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_files/files-hosts.c libc-20030708/nss/nss_files/files-hosts.c
--- glibc-2.3.2/nss/nss_files/files-hosts.c	2003-02-12 16:37:22.000000000 +0900
+++ libc-20030708/nss/nss_files/files-hosts.c	2003-03-16 12:31:40.000000000 +0900
@@ -280,7 +280,7 @@
 
 DB_LOOKUP (hostbyaddr, ,,
 	   {
-	     if (result->h_length == len
+	     if (result->h_length == (int) len
 		 && ! memcmp (addr, result->h_addr_list[0], len))
 	       break;
 	   }, const void *addr, socklen_t len, int af)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nss_files/files-parse.c libc-20030708/nss/nss_files/files-parse.c
--- glibc-2.3.2/nss/nss_files/files-parse.c	2002-08-11 03:09:07.000000000 +0900
+++ libc-20030708/nss/nss_files/files-parse.c	2003-07-08 22:58:09.000000000 +0900
@@ -1,5 +1,5 @@
 /* Common code for file-based database parsers in nss_files module.
-   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996-2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -67,7 +67,7 @@
 #ifdef ENTDATA
 /* The function can't be exported, because the entdata structure
    is defined only in files-foo.c.  */
-# define parser_stclass static inline
+# define parser_stclass static
 # define nss_files_parse_hidden_def(name)
 #else
 /* Export the line parser function so it can be used in nss_db.  */
@@ -171,6 +171,7 @@
 }
 
 static inline char **
+__attribute ((always_inline))
 parse_list (char *line, struct parser_data *data, size_t datalen, int *errnop)
 {
   char *eol, **list, **p;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nsswitch.c libc-20030708/nss/nsswitch.c
--- glibc-2.3.2/nss/nsswitch.c	2002-11-02 11:15:52.000000000 +0900
+++ libc-20030708/nss/nsswitch.c	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-1999,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -39,6 +39,7 @@
 #endif
 
 #include "nsswitch.h"
+#include "../nscd/nscd_proto.h"
 
 /* Prototypes for the local functions.  */
 static name_database *nss_parse_file (const char *fname) internal_function;
@@ -696,6 +697,17 @@
 }
 
 
+/* Called by nscd and nscd alone.  */
+void
+__nss_disable_nscd (void)
+{
+  /* Disable all uses of NSCD.  */
+  __nss_not_use_nscd_passwd = -1;
+  __nss_not_use_nscd_group = -1;
+  __nss_not_use_nscd_hosts = -1;
+}
+
+
 /* Free all resources if necessary.  */
 libc_freeres_fn (free_mem)
 {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/nss/nsswitch.h libc-20030708/nss/nsswitch.h
--- glibc-2.3.2/nss/nsswitch.h	2002-08-11 03:08:37.000000000 +0900
+++ libc-20030708/nss/nsswitch.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-1999,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -101,14 +101,15 @@
    If there is no configuration for this database in the file,
    parse a service list from DEFCONFIG and use that.  More
    than one function can use the database.  */
-int __nss_database_lookup (const char *database, const char *alternative_name,
-			   const char *defconfig, service_user **ni);
+extern int __nss_database_lookup (const char *database,
+				  const char *alternative_name,
+				  const char *defconfig, service_user **ni);
 libc_hidden_proto (__nss_database_lookup)
 
 /* Put first function with name FCT_NAME for SERVICE in FCTP.  The
    position is remembered in NI.  The function returns a value < 0 if
    an error occurred or no such function exists.  */
-int __nss_lookup (service_user **ni, const char *fct_name, void **fctp);
+extern int __nss_lookup (service_user **ni, const char *fct_name, void **fctp);
 
 /* Determine the next step in the lookup process according to the
    result STATUS of the call to the last function returned by
@@ -123,13 +124,17 @@
    services.  In other words, only if all four lookup results have
    the action RETURN associated the lookup process stops before the
    natural end.  */
-int __nss_next (service_user **ni, const char *fct_name, void **fctp,
-		int status, int all_values);
+extern int __nss_next (service_user **ni, const char *fct_name, void **fctp,
+		       int status, int all_values);
 libc_hidden_proto (__nss_next)
 
 /* Search for the service described in NI for a function named FCT_NAME
    and return a pointer to this function if successful.  */
-void *__nss_lookup_function (service_user *ni, const char *fct_name);
+extern void *__nss_lookup_function (service_user *ni, const char *fct_name);
+
+
+/* Called by NSCD to disable recursive calls.  */
+extern void __nss_disable_nscd (void);
 
 
 typedef int (*db_lookup_function) (service_user **, const char *, void **)
glibc-2.3.2/po/be.molibc-20030708/po/be.mo
glibc-2.3.2/po/ca.molibc-20030708/po/ca.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/ca.po libc-20030708/po/ca.po
--- glibc-2.3.2/po/ca.po	2002-11-04 15:56:29.000000000 +0900
+++ libc-20030708/po/ca.po	2003-03-10 07:51:17.000000000 +0900
@@ -1,12 +1,12 @@
 # Catalan messages for GNU libc.
 # Copyright (C) 2002 Free Software Foundation, Inc.
-# Ivan Vilata i Balaguer <ivan@selidor.net>, 1998, 1999, 2000, 2001, 2002.
+# Ivan Vilata i Balaguer <ivan@selidor.net>, 1998, 1999, 2000, 2001, 2002, 2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.3.1\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-10-29 18:59+0100\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-09 23:39+0100\n"
 "Last-Translator: Ivan Vilata i Balaguer <ivan@selidor.net>\n"
 "Language-Team: Catalan <ca@dodds.net>\n"
 "MIME-Version: 1.0\n"
@@ -267,8 +267,8 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
-msgstr "les conversions des de %s i cap a %s no sn suportades"
+msgid "conversion from `%s' and to `%s' are not supported"
+msgstr "la conversi des de %s cap a %s no s suportada"
 
 #: iconv/iconv_prog.c:246
 #, c-format
@@ -293,15 +293,15 @@
 msgid "error while closing output file"
 msgstr "error en tancar el fitxer d'eixida"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
 msgstr "Informeu dels errors amb el gui glibcbug a <bugs@gnu.org>.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -314,9 +314,9 @@
 "de cpia.  No hi ha CAP garantia; ni tan sols de COMERCIABILITAT o\n"
 "ADEQUACI A UN PROPSIT PARTICULAR.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -370,15 +370,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Prefix a usar en tots els accessos a fitxer"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "no hi ha fitxer d'eixida perqu s'han produt avisos"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "en inserir en l'arbre de recerca"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "no s'ha pogut generar el fitxer d'eixida"
 
@@ -1295,7 +1295,7 @@
 msgid "unterminated symbolic name"
 msgstr "el nom simblic no s terminat"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "la seqncia d'escapada no s vlida"
 
@@ -1325,41 +1325,41 @@
 msgid "trailing garbage at end of line"
 msgstr "fem al final de la lnia"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Informaci del sistema:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Mostra els noms dels locales disponibles"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Mostra els noms dels mapes de carcters disponibles"
 
 # ivb (2001/10/30)
 # ivb  Aquesta lnia dna pas a un conjunt d'opcions que modif. l'eixida.
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "Modificadors del format de l'eixida:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Mostra els noms de les categories seleccionades"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Mostra els noms de les paraules clau seleccionades"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Mostra ms informaci"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Obt la informaci especfica d'un locale."
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1367,7 +1367,7 @@
 "NOM\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "en preparar l'eixida"
 
@@ -1504,16 +1504,16 @@
 msgid "cannot create temporary file"
 msgstr "no s'ha pogut crear un fitxer temporal"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "no s'ha pogut iniciar el fitxer arxiu"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "no s'ha pogut redimensionar el fitxer arxiu"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "no s'ha pogut mapar la capalera de l'arxiu"
 
@@ -1531,92 +1531,92 @@
 msgid "cannot map locale archive file"
 msgstr "no s'ha pogut mapar el fitxer arxiu de locales"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "no s'ha pogut blocar el nou arxiu"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "no s'ha pogut estendre el fitxer arxiu de locales"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "no s'ha pogut canviar el mode de l'arxiu de locales redimensionat"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "no s'ha pogut reanomenar el nou arxiu"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "no s'ha pogut obrir l'arxiu %s de locales"
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "ha fallat stat() sobre l'arxiu %s de locales"
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "no s'ha pogut blocar l'arxiu %s de locales"
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "no s'ha pogut llegir la capalera de l'arxiu"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "el locale %s ja existeix"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "no s'ha pogut afegir a l'arxiu de locales"
 
 # ivb (2002/10/21)
 # ivb  El fitxer cont lies de diversos locales (locale.alias).
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "no s'ha trobat el fitxer %s d'lies de locales"
 
 # ivb (2002/10/21)
 # ivb  s un missatge, no un error.
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "S'est afegint %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "ha fallat stat() sobre %s: %s: es descarta"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "%s no s un directori: es descarta"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "no s'ha pogut obrir el directori %s: %s: es descarta"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "el joc de fitxers de locale en %s no s complet"
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "no s'han pogut llegir tots els fitxers de %s: es descarta"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "el locale %s no es troba en l'arxiu"
@@ -1687,8 +1687,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "el lmit superior del rang no s menor que l'inferior"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "la memria s'ha exhaurit"
 
@@ -1714,7 +1714,7 @@
 msgid "Another string for testing."
 msgstr "Altra cadena de prova."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NOM"
 
@@ -1758,7 +1758,7 @@
 msgid "duplicate set definition"
 msgstr "la definici del joc de missatges s duplicada"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "aquesta s la primera definici"
 
@@ -1776,44 +1776,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "la directiva %s no s coneguda: es descarta la lnia"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "el nmero de missatge s duplicat"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "l'identificador de missatge s duplicat"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "el carcter no s vlid: es descarta el missatge"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "la lnia no s vlida"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "es descarta la lnia malmesa"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "no s'ha pogut obrir el fitxer d'eixida %s"
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "el missatge no s terminat"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "en obrir el fitxer antic de catleg"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "els mduls de conversi no es troben disponibles"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "no s'ha pogut determinar el carcter d'escapada"
 
@@ -1821,7 +1821,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: no es poden tractar ms de 8 arguments\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "xit"
@@ -3024,23 +3024,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sSenyal desconegut %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "la memria s consistent; la biblioteca t errors\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "s'ha sobreescrit la memria d'abans del bloc reservat\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "s'ha sobreescrit la memria de desprs del bloc reservat\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "s'ha alliberat el bloc dues voltes\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "el valor d'mcheck_status s estrany; la biblioteca t errors\n"
 
@@ -3076,6 +3076,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "FITXERDADES [FITXEREIXIDA]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Error desconegut"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3102,7 +3106,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: La memria s'ha exhaurit: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Error desconegut del sistema"
 
@@ -3507,27 +3511,23 @@
 msgid "Interrupted by a signal"
 msgstr "Interromput per un senyal"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Error desconegut"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Forma d's: %s [-v especificaci] nom_de_la_variable [cam]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "l'especificaci %s no s coneguda"
 
 # ivb (2001/11/01)
 # ivb  Es refereix a variables de configuraci -> femen.
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "indefinida"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "La variable %s no s reconeguda"
@@ -3589,71 +3589,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: l'opci -W %s no admet arguments\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "No hi ha cap coincidncia"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "L'expressi regular no s vlida"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "El carcter d'ordenaci no s vlid"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "El nom de la classe de carcters no s vlid"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Hi ha una barra invertida sobrant al final"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "La referncia cap enrere no s vlida"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "[ o [^ desaparellat"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "( o \\( desaparellat"
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "\\{ desaparellat"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "El contingut de \\{\\} no s vlid"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "El final del rang no s vlid"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "La memria s'ha exhaurit"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "L'expressi regular precedent s incorrecta"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "F prematur de l'expressi regular"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "L'expressi regular s massa llarga"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr ") o \\) desaparellat"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "No hi ha expressi regular prvia"
 
@@ -3812,24 +3812,24 @@
 msgid "Service configuration to be used"
 msgstr "Configuraci a usar del servei"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "No es suporta l'enumeraci sobre %s\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - obt les entrades de les bases de dades d'administraci."
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Bases de dades suportades:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "el nombre d'arguments s incorrecte"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "La base de dades no s coneguda: %s\n"
@@ -3866,70 +3866,74 @@
 msgid "invalid pointer size"
 msgstr "el tamany del punter no s vlid"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: No s'ha pogut reservar memria\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: socket: Tots els ports estan sent usats\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "connexi amb l'adrea %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "S'est provant amb %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write (en preparar l'eixida estndard d'errors): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (en preparar l'exida estndard d'errors): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: fallada del protocol en configurar el circuit\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "socket: fallada del protocol en configurar el circuit\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: lectura incompleta"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "ha fallat lstat()"
 
 # ivb (2001/10/31)
 # ivb  Cal tenir en compte que ordinary a l'angls s cosa pler diferent ;)
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "no s un fitxer ordinari"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "no s'ha pogut obrir"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "ha fallat fstat()"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "el propietari no s vlid"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "s modificable per altres que no en sn el propietari"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "t un enlla fort en altre lloc"
 
@@ -4146,109 +4150,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "No s'ha pogut rebre una resposta a la difusi"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: l'eixida sobreescriuria %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: no s'ha pogut obrir %s: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: en escriure en l'eixida %s: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "no s'ha pogut trobar el preprocessador de C: %s\n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "no s'ha pogut trobar cap preprocessador de C (cpp)\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: el preprocessador de C ha fallat amb el senyal %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: el preprocessador de C ha fallat amb el codi d'eixida %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "el tipus de xarxa no s perms: %s\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: hi ha massa definicions\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: error en codificar els arguments\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "el fitxer %s ja existeix i podria ser sobreescrit\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "No es pot especificar ms d'un fitxer d'entrada!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Aquesta implementaci no suporta l'estil nou ni el codi compatible amb MT!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "No es pot usar l'opci idxarxa (-n) amb l'opci inetd (-I)!\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "No es pot usar l'opci idxarxa (-n) sense TIRPC!\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "No es pot usar opcions de taula amb l'estil nou (-N)!\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "cal fitxerentrada pels senyaladors de generaci de plantilles.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "No es pot tenir ms d'un senyalador de generaci de fitxers!\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "Forma d's: %s fitxerentrada\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Dnom[=valor]] [-i tamany] [-I [-K segons]] [-Y cam] fitxerentrada\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o fitxereixida] [fitxerentrada]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s tipusdexarxa]* [-o fitxereixida] [fitxerentrada]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n idxarxa]* [-o fitxereixida] [fitxerentrada]\n"
@@ -5126,7 +5130,7 @@
 msgid "while allocating hash table entry"
 msgstr "en reservar una entrada en la taula de dispersi"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "ha fallat stat() sobre el fitxer %s: %s"
@@ -5139,27 +5143,32 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "no es pot executar nscd en mode segur com a usuari sense privilegis"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "en reservar la memria cau: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "no s'ha pogut obrir el connector: %s"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "no s'ha pogut habilitar el connector per acceptar connexions: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: s'ha rebut una petici (Versi = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "no s'ha pogut atendre la petici amb versi antiga %d; la versi actual s %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "no s'ha pogut escriure el resultat: %s"
@@ -5169,130 +5178,130 @@
 # ivb  dimoni nscd per consultar la memria cau o invalidar-la.  Per
 # ivb  aix faig servir programa de control (com ndc amb named o
 # ivb  chronyc amb chronyd).
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "error en obtenir l'identificador del programa de control: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "en acceptar la connexi: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "lectura incompleta en llegir la petici: %s"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "la longitud de la clau de la petici s massa gran: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "lectura incompleta en llegir la clau de la petici: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "No s'ha pogut executar nscd com a l'usuari %s"
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "ha fallat getgrouplist()"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "ha fallat setgroups()"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "en reservar una cpia de la clau"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "en reservar una entrada en la memria cau"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "escriptura incompleta en %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "No s'ha trobat %s en la memria cau de grups!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "%s no s un gid numric vlid!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "No s'ha trobat %d en la memria cau de grups!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "No s'ha trobat %s en la memria cau d'estacions!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Llig les dades de configuraci de NOM"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "No fa fork() i mostra els missatges en el terminal actual"
 
 # ivb (2001/10/30)
 # ivb  Es refereix al _nombre_ de fils a llanar.
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "NOMBRE"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Llana NOMBRE fils d'exeuci"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Termina el servidor"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Mostra estadstiques de la configuraci actual"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TAULA"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Invalida la memria cau especificada"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TAULA,yes"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Usa una memria cau diferent per cada usuari"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Dimoni de memria cau del servei de noms."
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "ja es troba en marxa"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Noms root pot usar aquesta opci!"
 
@@ -5382,22 +5391,22 @@
 "%15ld%% rtio d'encerts de memria cau\n"
 "%15s  comprovar /etc/%s per si hi ha hagut canvis?\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "No s'ha trobat %s en la memria cau d'usuaris!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "%s no s un uid numric vlid!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "No s'ha trobat %d en la memria cau d'usuaris!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "no s'ha pogut crear la llista de capacitats"
 
@@ -5454,7 +5463,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", ABI del SO: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "No s'ha pogut obrir el fitxer %s de memria cau\n"
@@ -5500,19 +5509,19 @@
 msgid "Renaming of %s to %s failed"
 msgstr "No s'ha pogut reanomenar %s a %s"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "l'objecte compartit no s obert"
 
 # ivb (2002/10/29)
 # ivb  TLS = Thread Local Storage
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr "El comptador de generaci de TLS s'ha esgotat!  Per favor, envieu un informe amb el gui glibcbug."
 
 # ivb (2001/11/05)
 # ivb  DST = Dynamic String Token (component cadena dinmica)
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "no es permeten components cadena dinmica (DST) en programes SUID/SGID"
 
@@ -5531,183 +5540,195 @@
 msgid "cannot allocate dependency list"
 msgstr "no s'ha pogut reservar la llista de dependncies"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "no s'ha pogut reservar la llista de recerca de smbols"
 
 # ivb (2002/10/21)
 # ivb  LD_TRACE_PRELINKING s una variable d'entorn, no s part del filtre.
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "Amb LD_TRACE_PRELINKING no es suporten els filtres"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "ERROR EN L'ENLLAADOR DINMIC!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "error en carregar les biblioteques dinmiques"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "no s'ha pogut reservar el registre de nom"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "no s'ha pogut crear la memria cau dels camins de recerca"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "no s'ha pogut crear una cpia de RUNPATH/RPATH"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "no s'ha pogut crear el vector de camins de recerca"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "ha fallat stat() sobre l'objecte compartit"
 
 # ivb (2001/10/28)
 # ivb  Es refereix a /dev/zero .
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "no s'ha pogut obrir el dispositiu de zeros"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "no s'ha pogut crear el descriptor d'objecte compartit"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "no s'han pogut llegir les dades del fitxer"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "L'alineament de l'ordre ELF de crrega no est alineada amb la pgina"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "L'adrea/desplaament de l'ordre ELF de crrega no est correctament alineada"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "no s'han pogut reservar les estructures de dades TLS pel fil inicial"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "no es pot tractar amb dades TLS"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "no s'ha pogut mapar un segment de l'objecte compartit"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "no s'ha pogut carregar dinmicament l'executable"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "no s'han pogut canviar les proteccions de memria"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "no s'han pogut mapar les pgines plenes de zeros"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "no s'ha pogut reservar memria per la capalera del programa"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "el fitxer objecte no t secci dinmica"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "ha fallat dlopen() sobre l'objecte compartit"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "no s'ha pogut crear la llista de recerca"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "el fitxer s massa curt"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "la capalera ELF no s vlida"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "La codificaci de les dades del fitxer ELF no s big-endian"
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "La codificaci de les dades del fitxer ELF no s little-endian"
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "La identificaci de la versi del fitxer ELF no concorda amb l'actual"
 
 # ivb (2001/11(06)
 # ivb  ABI = Application Binary Interface (interfcie binria d'aplicaci)
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "L'ABI de sistema operatiu del fitxer ELF no s vlida"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "La versi de l'ABI del fitxer ELF no s vlida"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "error intern"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "La versi del fitxer ELF no concorda amb l'actual"
 
 # ivb (2001/11/01)
 # ivb  La traducci completa de phentsize vindria a ser: tamany d'entrada
 # ivb  de taula de la capalera de programa.
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "El valor de phentsize del fitxer ELF no s l'esperat"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "noms es poden carregar els tipus ET_DYN i ET_EXEC"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "no s'ha pogut obrir el fitxer objecte compartit"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "error de reubicaci"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "no s'ha pogut estendre l'mbit global"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "la substituci del component cadena dinmica s buida"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "no s'ha pogut crear la llista d'mbits"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "no s'han pogut crear les estructures de dades TLS"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "el mode de dlopen() no s vlid"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "ha fallat dlopen() sobre l'objecte compartit: la memria TLS esttica s massa menuda"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "no s'ha pogut fer escrivible el segment per reubicar-lo"
 
 # ivb (2002/10/21)
 # ivb  PLT = Procedure Linkage Table, Taula d'Enllaat de Procediments
 # ivb  PLTREL = tipus de reubicaci usada per la PLT
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: el perfilador no ha trobat el PLTREL de l'objecte %s\n"
@@ -5715,12 +5736,12 @@
 # ivb (2002/10/29)
 # ivb  A s un cacau, per pense que ac hauria de posar PLT i no PLTREL.
 # ivb  Total, qui ho va a llegir?
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: el perfilador ha exhaurit la memria en calcular el PLTREL de %s\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "no s'ha pogut restaurar la protecci del segment desprs de reubicar-lo"
 
@@ -5776,123 +5797,123 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Configura els vincles en temps d'execuci de l'enllaador dinmic."
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "S'ha especificat el cam %s ms d'una volta"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s no s un tipus conegut de biblioteca"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "Ha fallat stat() sobre %s"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "Ha fallat stat() sobre %s\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s no s un enlla simblic\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "No s'ha pogut desenllaar %s"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "No s'ha pogut crear un enlla des de %s cap a %s"
 
 # ivb (2001/10/28)
 # ivb  Es refereix a un enlla -> mascul.
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (canviat)\n"
 
 # ivb (2001/10/28)
 # ivb  Es refereix a fer o no l'enlla, no importa el gnere.
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (SALTAT)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "No s'ha pogut trobar %s"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "Ha fallat lstat() sobre %s"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Es descarta el fitxer %s que no s un fitxer ordinari."
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "No s'ha creat l'enlla perqu no s'ha trobat el nom d'objecte compartit de %s"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "No s'ha pogut obrir el directori %s"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "Ha fallat lstat() sobre %s"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "Ha fallat stat() sobre %s"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "No s'ha trobat el fitxer d'entrada %s.\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "la bibliotexa %s per libc5 es troba en un directori incorrecte"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "la biblioteca %s per libc6 es troba en un directori incorrecte"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "la biblioteca %s per libc4 es troba en un directori incorrecte"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "les biblioteques %s i %s del directori %s tenen el mateix nom d'objecte compartit per diferent tipus."
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "No s'ha pogut obrir el fitxer %s de configuraci"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "No s'ha pogut canviar al directori /"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "No s'ha pogut obrir el directori %s de fitxers de memria cau\n"
@@ -6005,12 +6026,3 @@
 #: elf/sprof.c:936 elf/sprof.c:988
 msgid "cannot allocate symbol data"
 msgstr "no s'han pogut reservar les dades de smbols"
-
-#~ msgid "\t\t\t\t\t\t\t      %s: value for field `%s' must be in range %d...%d"
-#~ msgstr "\t\t\t\t\t\t\t      %s: el valor del camp %s ha d'estar en el rang %d...%d"
-
-#~ msgid "Failed to look up user '%s' to run server as"
-#~ msgstr "Ha fallat la recerca de l'usuari %s, com a qui executar el servidor"
-
-#~ msgid "no filename for profiling data given and shared object `%s' has no soname"
-#~ msgstr "no s'ha especificat un fitxer de dades de perfilat i %s no t nom d'objecte compartit"
glibc-2.3.2/po/cs.molibc-20030708/po/cs.mo
glibc-2.3.2/po/da.molibc-20030708/po/da.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/da.po libc-20030708/po/da.po
--- glibc-2.3.2/po/da.po	2002-11-11 08:14:07.000000000 +0900
+++ libc-20030708/po/da.po	2003-03-10 08:17:53.000000000 +0900
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.3.1\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-11-09 20:18+01:00\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-08 20:18+01:00\n"
 "Last-Translator: Keld Simonsen <keld@dkuug.dk>\n"
 "Language-Team: Danish <dansk@klid.dk>\n"
 "MIME-Version: 1.0\n"
@@ -259,8 +259,8 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
-msgstr "konverteringer fra '%s' og til '%s' er ikke understttet"
+msgid "conversion from `%s' and to `%s' are not supported"
+msgstr "konvertering fra '%s' og til '%s' er ikke understttet"
 
 #: iconv/iconv_prog.c:246
 #, c-format
@@ -285,15 +285,15 @@
 msgid "error while closing output file"
 msgstr "fejl ved lukning af udfil"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
 msgstr "Rapportr fejl ved at bruge skriptet 'glibcbug' til <bugs@gnu.org>.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -306,9 +306,9 @@
 "Programmellet har ingen garanti, ikke en gang for SALGBARHED eller EGNETHED\n"
 "TIL NOGEN SPECIEL OPGAVE.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -360,15 +360,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Prfiks brugt for alle filadgange"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "p grund af advarsler blev ingen udfil oprettet"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "fejl ved indstning i sgetr"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "kan ikke generere udfil"
 
@@ -1280,7 +1280,7 @@
 msgid "unterminated symbolic name"
 msgstr "uafsluttet symbolsk navn"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "ugyldig undtagelsessekvens"
 
@@ -1310,39 +1310,39 @@
 msgid "trailing garbage at end of line"
 msgstr "efterflgende snavs p slutningen af linien"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Systeminformation:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Skriv navnene til tilgngelige lokaler"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Skriv navnene til tilgngelige tegntabel"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "ndre format for uddata:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Skriv navnene til valgte kategorier"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Skriv navnene til valgte ngleord"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Skriv mere information"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Hent information specifik for lokalet."
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1350,7 +1350,7 @@
 "NAVN\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "da uddata blev forberedt"
 
@@ -1481,16 +1481,16 @@
 msgid "cannot create temporary file"
 msgstr "Kan ikke oprette midlertidig fil"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "kan ikke initiere arkivfil"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "kan ikke skifte strrelse p arkivfil"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "kan ikke lse arkivhoved med mmap"
 
@@ -1506,88 +1506,88 @@
 msgid "cannot map locale archive file"
 msgstr "kan ikke bne lokalearkivfil med mmap"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "kan ikke lse nyt arkiv"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "kan ikke udvide lokalearkivfil"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "kan ikke ndre adgangtilstand p strrelsesndret lokalearkiv"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "kan ikke omdbe nyt arkiv"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "kan ikke bne lokalearkiv \"%s\""
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "kan ikke udfre 'stat' p lokalearkiv '%s'"
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "kan ikke lse lokalearkiv '%s'"
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "kan ikke lse arkivhoved"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "lokale '%s' eksisterer allerede"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "kan ikke tilfje til lokalearkiv"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "fil \"%s\" for lokalealias findes ikke"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "Tilfjer %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "status p \"%s\" mislykkedes: %s: ignoreret"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "\"%s\" er ikke et katalog, ignoreret"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "kan ikke bne katalog \"%s\": %s: ignoreret"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "ufuldstndig opstning af lokalefiler i \"%s\""
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "kan ikke lse alle filer i \"%s\": ignoreret"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "lokale \"%s\" findes ikke i arkivet"
@@ -1656,8 +1656,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "vre grnse i omrde er ikke mindre end nedre grnse"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "lageret opbrugt"
 
@@ -1683,7 +1683,7 @@
 msgid "Another string for testing."
 msgstr "En ny streng til afprvning."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NAVN"
 
@@ -1727,7 +1727,7 @@
 msgid "duplicate set definition"
 msgstr "duplikeret definition af st"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "dette er den frste definition"
 
@@ -1745,44 +1745,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "ukendt ngleord '%s': linie ignoreret"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "duplikeret meddelelsesnummer"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "duplikeret meddelelsesidentifikator"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "Ugyldigt tegn: besked ignoreret"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "ugyldig linje"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "fejlagtig linie ignoreret"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "kan ikke bne udfil '%s'"
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "uafsluttet meddelelse"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "da den gamle katalogfil blev bnet"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "konverteringsmoduler ikke tilgngelige"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "kan ikke bestemme undvigetegn"
 
@@ -1790,7 +1790,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: vd ikke hvordan mere end 8 argumenter skal behandles\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "Succes"
@@ -2979,23 +2979,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sUkendt signal %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "lageret er konsistent, biblioteket er fejlbehftet\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "omrdet foran tildelt lagerblok snavset til\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "omrdet efter tildelt lagerblok snavset til\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "blok frigjort to gange\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "fejlagtig mcheck_status, biblioteket er fejlbehftet\n"
 
@@ -3031,6 +3031,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "DATAFIL [UDFIL]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Ukendt fejl"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3055,7 +3059,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: Lageret opbrugt: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Ukendt systemfejl"
 
@@ -3448,25 +3452,21 @@
 msgid "Interrupted by a signal"
 msgstr "Afbrudt af et signal"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Ukendt fejl"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Brug: %s [-v specifikation] variabelnavn [sgesti]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "ukendt specifikation '%s'"
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "udefineret"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Ukendt variabel '%s'"
@@ -3528,71 +3528,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: flaget '-W %s' tager ikke argumenter\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "Ingen trf"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "Ugyldigt regulrt udtryk"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Ugyldigt sammenligningstegn"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Ugyldigt tegnklassenavn"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Efterflgende backslash"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Ugyldig tilbage-reference"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "Ubalanceret [ eller [^"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "Ubalanceret ( eller \\("
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "Ubalanceret \\{"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "Ugyldig brug af \\{\\}"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Ugyldigt intervalslut"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Lageret opbrugt"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "Ugyldigt foregende regulrt udtryk"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "For tidlig afslutning p regulrt udtryk"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "Regulrt udtryk for stort"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr "Ubalanceret ) eller \\)"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "Intet foregende regulrt udtryk"
 
@@ -3746,24 +3746,24 @@
 msgid "Service configuration to be used"
 msgstr "Tjenestekonfiguration som skal bruges"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "Enumeration er ikke understttet p %s\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - hent indtastninger fra administrativ database."
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Understttede databaser:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "galt antal argumenter"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Ukendt database: %s\n"
@@ -3792,68 +3792,72 @@
 msgid "invalid pointer size"
 msgstr "ugyldig strrelse for pegere"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: Kan ikke tildele lager\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: sokkel: Alle porte i brug\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "koble til adresse %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "Prver %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write: (opstter standard error): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (opstter stderr): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: protokolfejl i opstning af forbindelse\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "sokkel: protokolfejl i opstning af forbindelse\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: kort indlsning"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "lstat fejlede"
 
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "ikke en almindelig fil"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "kan ikke bne"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "fstat fejlede"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "forkert ejer"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "skrivbar af andre end ejer"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "hrdlnket et eller andet sted"
 
@@ -4064,109 +4068,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "Kan ikke tage imod svar p rundsending"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: udskrift ville overskrive %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: kan ikke bne %s: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: under skrivning af uddata %s: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "kan ikke finde C-prprocessor: %s \n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "kan ikke finde nogen C-prprocessor (cpp)\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: C-prprocessoren fejlede med signal %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: C-prprocessoren fejlede med slutkode %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "ulovlig nettype: '%s'\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: for mange definitioner\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: arglist kode-fejl\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "filen '%s' eksisterer allerede og kan blive overskrevet\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "Kan ikke specificere mere end n indfil!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Denne implementation understtter ikke nystil eller MT-sikker kode!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "Kan ikke bruge netid-flag med inetd-flag!\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "Kan ikke bruge netid-flag uden TIRPC!\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "Kan ikke bruge tabelflag med ny stil!\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "'indfil' er ndvendig for flag til at generere skabelon.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "Kan ikke have mere end et fil-genereringsflag!\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "brug:  %s indfil\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM] [-Dnavn[=vrdi]] [-i strrelse] [-I [-K sekunder]] [-Y sgesti] indfil\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o udfil] [indfil]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s nettype]* [-o udfil] [indfil]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n netid]* [-o udfil] [indfil]\n"
@@ -5024,7 +5028,7 @@
 msgid "while allocating hash table entry"
 msgstr "under allokering af hashtabel-indtastninger"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "kan ikke udfre stat() p fil '%s': %s"
@@ -5037,153 +5041,158 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "Kan ikke kre nscd i sikker tilstand som upriviligieret bruger"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "under allokering af buffer: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "kan ikke bne sokkel: %s"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "kan ikke f sokkel til at acceptere forbindelser: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: foresprgsel modtaget (version = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "kan ikke hndtere gammel foresprgsel af version %d. Nuvrende version er %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "kan ikke udskrive resultat: '%s'"
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "fejl ved foresprgsel p opkaldets id: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "under accept af forbindelse: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "afkortet lsning ved lsning af foresprgsel: %s"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "nglelngde i foresprgsel for lang: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "afkortet lsning ved lsning af foresprgsels-ngle: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "Kunne ikke kre nscd som bruger \"%s\""
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "getgrouplist mislykkedes"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "setgroups mislykkedes"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "under allokering af nglekopi"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "under allokering af nrbuffer-indtastninger"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "afkortet skrivning i %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "Har ikke fundet '%s' i gruppe-nrbuffer!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "Ugyldigt numerisk gruppe-id (gid) \"%s\"!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "Har ikke fundet '%d' i gruppe-nrbuffer!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "Har ikke fundet '%s' i vrts-nrbuffer!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Ls konfigurationsdata fra NAVN"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "Udspalt ikke ny proces og vis meddelelser p nuvrende tty"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "NUMMER"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Start ANTAL trde"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Afbryd tjeneren"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Skriv nuvrende konfigurationsstatistik ud"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TABEL"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Ugyldiggr den opgivne hurtigbuffer"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TABEL,ja"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Brug separat buffer for hver bruger"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Dmon for bufring af navnetjeneste"
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "krer allerede"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Kun 'root' har lov til at bruge dette flag!"
 
@@ -5273,22 +5282,22 @@
 "%15ld%% trfrate for hurtigbuffer\n"
 "%15s  tjek /etc/%s for ndringer\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "Har ikke fundet '%s' i adgangskode-nrbuffer!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "Ugyldig numerisk bruger-id (uid) \"%s\"!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "Har ikke fundet '%d' i adgangskode-nrbuffer!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "kan ikke oprette egenskabsliste"
 
@@ -5339,7 +5348,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", OS ABI: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "Kan ikke bne hurtigbufferfil %s\n"
@@ -5385,17 +5394,17 @@
 msgid "Renaming of %s to %s failed"
 msgstr "Omdbning af %s til %s fejlede"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "delt objekt er ikke bent"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr ""
 "Generationstller for TLS tilbagestillet!  Vr sd at indsende fejlrapport med\n"
 "\"glibcbug\"-skriptet"
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "DST er ikke tilladt i SUIT/SGID-programmer"
 
@@ -5414,181 +5423,193 @@
 msgid "cannot allocate dependency list"
 msgstr "kan ikke allokere afhngighedsliste"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "kan ikke allokere symbolsgningsliste"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "Filter understttes ej med LD_TRACE_PRELINKING"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "FEJL I DYNAMISK LNKER!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "fejl da delte biblioteker indlstes"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "Kan ikke allokere navnepost"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "Kan ikke oprette buffer for sgesti"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "kan ikke oprette RUNPATH/RPATH kopi"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "kan ikke oprette tabel over sgestier"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "kan ikke tage status p delt objekt"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "kan ikke bne nulstil-enhed"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "kan ikke oprette delt objektbeskriver"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "kan ikke indlse fildata"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "ELF-indlsningskommandos tilpasning er ikke tilpasset siden"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "ELF-indlsningskommandos adresse/tillg er ikke tilpasset ordentligt"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "kan ikke oprette TLS-datastrukturer for frste trd"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "kan ikke behandle TLS-data"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "klarede ikke at afbilde fra delt objekt'"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "kan ikke indlse udfrbare dynamisk"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "kan ikke ndre lagerbeskyttelser"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "kan ikke mappe nulstil-sider"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "Kan ikke allokere lager til programhoved"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "objektfil har ingen dynamisk sektion"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "delt objekt kan ikke bnes med dlopen()"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "kan ikke lse sgningsliste"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "For kort fil"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "ugyldigt ELF-hoved"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "Kodning for ELF-fildata er ikke \"big-endian\""
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "Kodning for ELF-fildata er ikke \"little-endian\""
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "ELF-filens version-identitet passer ikke med den aktuelle"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "ELF-filens OS ABI er ugyldig"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "ELF-filens ABI-version er ugyldig"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "Intern fejl"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "ELF-filens version passer ikke med den aktuelle"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "ELF-filens 'phentsize' er ikke den forventede strrelse"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "kun ET_DYN og ET_EXEC kan indlses"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "kan ikke bne delt objektfil"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "fejl ved relokering"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "Kan ikke udvide globalt defineringomrde"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "tom dynamisk strengelement-erstatning"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "kan ikke oprette omfangsliste"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "kan ikke oprette datastrukturer for TLS"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "ugyldig modus for dlopen()"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "delt objekt kan ikke bnes med dlopen(): statisk TLS-hukommelse for lille"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "Kan ikke gre segment skrivbart for omflytning"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: profilereren fandt ingen PLTREL i objekt %s\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: profilereren fik slut p hukommelse for kopiering af PLTREL i %s\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "kan ikke genskabe segmentbeskyttelse efter omflytning"
 
@@ -5644,119 +5665,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Konfigurerer vrdier til Dynamisk Lnker"
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "Stien '%s' givet mere end n gang"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s er ikke en kendt bibliotekstype"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "Kan ikke stat() %s"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "Kan ikke stat() %s\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s er ikke en symbolsk lnke\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "Kan ikke aflnke %s"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "Kan ikke lnke %s til %s"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (ndret)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (UDELADT)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "Kan ikke finde %s"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "Kan ikke lstat %s"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Ignorerede filen %s da den ikke er en almindelig fil."
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "Ingen lnke oprettet da .so-navn ikke kunne findes for %s"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "Kan ikke bne katalog %s"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "Kan ikke lstat %s"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "Kan ikke stat() %s"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "Indputfilen %s ikke fundet\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "libc5-bibliotek %s i forkert katalog"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "libc6-bibliotek %s i forkert katalog"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "libc4-bibliotek %s i forkert katalog"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "bibliotekerne %s og %s i kataloget %s har samme .so-navn, men forskellig type"
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "Kan ikke bne konfigurationsfil %s"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "Kan ikke chdir til /"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "Kan ikke bne hurtigbufferkatalog %s\n"
glibc-2.3.2/po/de.molibc-20030708/po/de.mo
glibc-2.3.2/po/el.molibc-20030708/po/el.mo
glibc-2.3.2/po/en_GB.molibc-20030708/po/en_GB.mo
glibc-2.3.2/po/es.molibc-20030708/po/es.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/es.po libc-20030708/po/es.po
--- glibc-2.3.2/po/es.po	2002-11-04 15:56:19.000000000 +0900
+++ libc-20030708/po/es.po	2003-03-04 03:12:33.000000000 +0900
@@ -1,13 +1,13 @@
 # Mensajes en espaol para GNU libc.
-# Copyright (C) 1996, 1997, 1998, 2001, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1996, 1997, 1998, 2001, 2002, 2003 Free Software Foundation, Inc.
 # Enrique Melero Gmez <melero@eurolands.com>, 1996, 1997.
-# Santiago Vila Doncel <sanvila@unex.es>, 1997, 1998, 2001, 2002.
+# Santiago Vila Doncel <sanvila@unex.es>, 1997, 1998, 2001, 2002, 2003.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: GNU libc 2.3.1\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-11-02 16:52+0100\n"
+"Project-Id-Version: GNU libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-03 17:20+0100\n"
 "Last-Translator: Santiago Vila Doncel <sanvila@unex.es>\n"
 "Language-Team: Spanish <es@li.org>\n"
 "MIME-Version: 1.0\n"
@@ -301,8 +301,8 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
-msgstr "no se admiten conversiones de `%s' a `%s'"
+msgid "conversion from `%s' and to `%s' are not supported"
+msgstr "no se admite la conversin de `%s' a `%s'"
 
 #: iconv/iconv_prog.c:246
 #, c-format
@@ -327,15 +327,15 @@
 msgid "error while closing output file"
 msgstr "error al cerrar el fichero de salida"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
 msgstr "Comunicar bichos usando el programa `glibcbug' a <bugs@gnu.org>.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -348,9 +348,9 @@
 "No hay NINGUNA garanta; ni siquiera de COMERCIABILIDAD o IDONEIDAD PARA UN\n"
 "FIN DETERMINADO.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -409,15 +409,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Prefijo utilizado para todos los accesos a ficheros"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "no se ha producido ningn fichero de salida debido a la existencia de avisos"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "al insertar en el rbol de bsqueda"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "no se puede generar el fichero de salida"
 
@@ -1368,7 +1368,7 @@
 msgid "unterminated symbolic name"
 msgstr "nombre simblico sin terminar"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "secuencia de escape invlida"
 
@@ -1398,39 +1398,39 @@
 msgid "trailing garbage at end of line"
 msgstr "hay inconsistencias al final de la lnea"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Informacin del sistema:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Escribe los nombres de los locales disponibles"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Escribe los nombres de las asignaciones de caracteres disponibles"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "Modifica el formato de salida:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Escribe los nombres de las categoras seleccionadas"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Escribe los nombres de las palabras clave seleccionadas"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Muestra ms informacin"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Obtiene la informacin especfica del locale."
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1438,7 +1438,7 @@
 "NOMBRE\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "al preparar la salida"
 
@@ -1571,16 +1571,16 @@
 msgid "cannot create temporary file"
 msgstr "no se puede crear un fichero temporal"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "no se puede inicializar el archivo"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "no se puede cambiar el tamao del archivo"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "no se puede leer la cabecera del archivo"
 
@@ -1596,88 +1596,88 @@
 msgid "cannot map locale archive file"
 msgstr "no se puede leer el fichero de locales"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "no se puede bloquear el archivo nuevo"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "no se puede extender el archivo de locales"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "no se puede cambiar el modo de un archivo de locales redimensionado"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "no se puede renombrar el nuevo archivo"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "no se puede abrir el archivo de locales \"%s\""
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "no se puede efectuar `stat' sobre el archivo de locales \"%s\""
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "no se puede bloquear el archivo de locales \"%s\""
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "no se puede leer la cabecera del archivo"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "el local `%s' ya existe"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "no se puede aadir al archivo de locales"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "no se encontr el fichero de alias de locales `%s'"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "Aadiendo %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "fall la llamada a `stat' sobre \"%s\": %s: descartado"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "\"%s\" no es un directorio; descarrtado"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "no se puede abrir el directorio \"%s\": %s: descartado"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "conjunto incompleto de ficheros de locales en \"%s\""
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "no se pueden leer todos los ficheros de \"%s\": descartado"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "el local \"%s\" no est en el archivo"
@@ -1749,8 +1749,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "el lmite superior del rango no es menor que el lmite inferior"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "memoria agotada"
 
@@ -1793,7 +1793,7 @@
 msgid "Another string for testing."
 msgstr "Otra cadena para hacer pruebas."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NOMBRE"
 
@@ -1839,7 +1839,7 @@
 msgid "duplicate set definition"
 msgstr "definicin de conjunto duplicada"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "esta es la primera vez que aparece la definicin"
 
@@ -1860,44 +1860,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "directiva desconocida `%s': lnea pasada por alto"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "nmero de mensaje duplicado"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "identificador de mensaje duplicado"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "carcter invlido: mensaje descartado"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "lnea invlida"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "una lnea incorrecta no se tendr en cuenta"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "no se puede abrir el fichero de salida `%s'"
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "mensaje sin terminar"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "al abrir el fichero de catlogo antiguo"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "no estn disponibles los mdulos de conversin"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "no se puede determinar el carcter de escape"
 
@@ -1909,7 +1909,7 @@
 # me gustara que hubiera otra palabra mejor. SV
 # Siempre me han gustado F&C ;-)
 # A m tambin :-) sv
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "Conseguido"
@@ -3316,24 +3316,24 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sSeal desconocida %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "la memoria es consistente, la biblioteca tiene un bicho\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "memoria alterada antes del bloque de memoria asignado\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "memoria alterada pasado el final del bloque de memoria asignado\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "bloque liberado dos veces\n"
 
 # Revisar lo de bogus. creo que es eso.
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "valor de mcheck_status incorrecto, la biblioteca tiene un bicho\n"
 
@@ -3372,6 +3372,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "FICHERODEDATOS [FICHERODESALIDA]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Error desconocido"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3396,7 +3400,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: Memoria agotada: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Error del sistema desconocido"
 
@@ -3855,25 +3859,21 @@
 msgid "Interrupted by a signal"
 msgstr "Interrumpido por una seal"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Error desconocido"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Modo de empleo: %s [-v especificacin] nombre_de_variable [ruta]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "especificacin \"%s\" desconocida"
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "sin definir"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Variable no reconocida `%s'"
@@ -3949,71 +3949,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: la opcin `-W %s' no admite ningn argumento\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "No hay ninguna coincidencia"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "La expresin regular es errnea"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Carcter de unin invlido"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Nombre de clase de carcter invlido"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Barra invertida extra al final `\\'"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Referencia hacia atrs invlida"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "[  ^[ desemparejados"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "(  \\( desemparejados"
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "\\{ desemparejado"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "Contenido de \\{\\} invlido"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Final de rango invlido"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Memoria agotada"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "La expresin regular precedente es invlida"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "Fin no esperado de la expresin regular"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "La expresin regular es demasiado grande"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr ")  \\) desemparejados"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "No existe ninguna expresin regular anterior"
 
@@ -4174,24 +4174,24 @@
 msgid "Service configuration to be used"
 msgstr "Configuracin del servicio"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "La enumeracin no est soportada sobre %s\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - obtiene entradas de la base de datos administrativa."
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Bases de datos admitidas:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "nmero incorrecto de argumentos"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Base de datos desconocida: %s\n"
@@ -4221,77 +4221,81 @@
 msgid "invalid pointer size"
 msgstr "tamao de puntero invlido"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: No se puede asignar memoria\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: socket: Se estn usando todos los puertos\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "conexin a la direccin %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "Intentando %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write (activando la salida de error estndar): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (activando la salida de error estndar): %m\n"
 
 #  en la configuracin del servicio?, del circuito?, o dejarlo as?
 #  Es de locos, estuve viendo las/los fuentes, prefer dejarlo as. em
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: fallo de protocolo al configurar el circuito\n"
 
 #  ??? lo mismo que arriba
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "socket: fallo de protocolo al configurar el circuito\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: lectura insuficiente"
 
 # ## Lo mismo con lstat. sv
 # Antes deca: No se pudo obtener informacin (lstat) del fichero .rhosts
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "lstat ha fallado"
 
 # Antes deca: .rhosts no es un fichero regular
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "no es un fichero regular"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "no se puede abrir"
 
 # ## Sugerencia: Aadir (fstat) despus de informacin. sv
 # Antes deca: No se pudo obtener informacin (fstat) del fichero .rhosts
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "fstat ha fallado"
 
 # Antes deca: El propietario del fichero .rhosts no es vlido
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "propietario incorrecto"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "puede ser modificado por otros adems del propietario"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "hay un enlace duro en alguna parte"
 
@@ -4539,115 +4543,115 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "No se puede recibir la respuesta al `broadcast'"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: la salida sobreescribira %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: no se pudo abrir %s: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: al escribir el resultado %s: %m:"
 
 # FIXME: El espacio final.
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "no se puede encontrar el preprocesador de C: %s \n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "no se puede encontrar ningn preprocesador de C (cpp)\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: El preprocesador de C fall con la seal %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: El preprocesador de C fall con un cdigo de retorno %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "tipodered ilegal :`%s'\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: demasiados defines\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: error de codificacin de la lista de argumentos\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "el fichero `%s' ya existe y podra ser sobreescrito\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "No se puede especificar ms de un fichero de entrada\n"
 
 # Se admiten sugerencias para MT-safe. sv
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Esta implementacin no admite cdigo de nuevo estilo o `MT-safe'!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "No se puede usar la opcin netid con la opcin inetd\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "No se puede usar la opcin netid sin TIRPC\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "No se pueden usar las opciones de la tabla con el nuevo estilo\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr ""
 "se necesita un \"fichero_de_entrada\" para las opciones de generacin\n"
 "de plantillas\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "No se puede tener ms de una opcin de generacin de fichero\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "modo de empleo: %s fichero_de_entrada\n"
 
 # Este mensaje tal vez habra que cortarlo por algn lado. sv
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Dnombre[=valor]] [-i tamao] [-I [-K segundos]] [-Y camino] fichero_de_entrada\n"
 
 # Y este tambin. sv
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o fichero_de_salida] [fichero_de_entrada]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s tipored]* [-o fichero_de_salida] [fichero_de_entrada]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n netid]* [-o fichero_de_salida] [fichero_de_entrada]\n"
@@ -5549,7 +5553,7 @@
 msgid "while allocating hash table entry"
 msgstr "al asignar espacio para la entrada en la tabla `hash'"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "no se puede ejecutar stat() sobre el fichero `%s': %s"
@@ -5562,155 +5566,160 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "No se puede ejecutar nscd en modo seguro como usuario no privilegiado"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "al asignar espacio para el cach: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "no se puede abrir el `socket': %s"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "no se puede activar el `socket' para aceptar conexiones: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: peticin recibida (Versin = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr ""
 "no se pueden manejar peticiones de la versin %d, la versin\n"
 "actual es %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "no se puede escribir el resultado: %s"
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "error al obtener el id de los llamantes: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "al aceptar la conexin: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "lectura insuficiente mientras se lea la peticin: %s"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "la longitud de la clave en la peticin es demasiado larga: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "se acabaron los datos mientras se lea la clave de peticin: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "Fallo al ejecutar nscd como usuario `%s'"
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "fall `getgrouplist'"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "fall `setgroups'"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "al asignar espacio para la copia de la clave"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "al asignar espacio para la entrada en el cach"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "escritura insuficiente en %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "No se ha encontrado \"%s\" en el cach de grupos"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "gid numrico invlido \"%s\"!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "No se ha encontrado \"%d\" en el cach de grupo"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "No se ha encontrado \"%s\" en el cach de `hosts'"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Lee datos de configuracin de NOMBRE"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "No se divide y muestra los mensajes en la terminal actual"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "NMERO"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Comienza NMERO hilos"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Apagar el servidor"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Muestra una estadstica sobre la configuracin actual"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TABLA"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Invalida la cach especificada"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TABLA,s"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Utiliza una cach separada para cada usuario"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Daemon de Cach del Servicio de Nombres."
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "ya est funcionando"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Solamente root puede usar esta opcin"
 
@@ -5800,22 +5809,22 @@
 "%15ld%% tasa de aciertos de cach\n"
 "%15s  compruebe /etc/%s para cambios\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "No se ha encontrado \"%s\" en el cach de contraseas"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "uid numrico invlido \"%s\"!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "No se ha encontrado \"%d\" en el cach de contraseas"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "no se puede crear la lista de capacidades"
 
@@ -5867,7 +5876,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", ABI del SO: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "No se puede abrir el fichero de cach %s\n"
@@ -5914,17 +5923,17 @@
 msgid "Renaming of %s to %s failed"
 msgstr "Fall el renombramiento de %s a %s"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "el objeto compartido no est abierto"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr ""
 "El contador de generaciones TLS ha vuelto a cero! Por favor enve un informe\n"
 "con el script 'glibcbug'"
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "No se permite DST en programas SUID/SGID"
 
@@ -5946,185 +5955,199 @@
 msgid "cannot allocate dependency list"
 msgstr "no se pudo asignar espacio para la lista de dependencias"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "no se puede asignar espacio para la lista de bsqueda de los smbolos"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "No se admiten filtros con LD_TRACE_PRELINKING"
 
 # Vase "A bug's life".
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "HAY UN BICHO EN EL ENLAZADOR DINMICO!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "error al cargar las bibliotecas compartidas"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "no se puede asignar el registro del nombre"
 
 # He intentado mejorarlo un poco ...
 #
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "no se puede crear un cach para la ruta de bsqueda"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "no se puede crear una copia RUNPATH/RPATH"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "no se puede crear la matriz de la ruta de bsqueda"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "no se puede efectuar `stat' sobre el objeto compartido"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "no se puede abrir el dispositivo de `zero fill'"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "no se puede crear el descriptor del objeto compartido"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "no se pueden leer los datos del fichero"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "El alineamiento de la orden de carga ELF no est alineada a la pgina"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "La direccin/desplazamiento de la orden de carga ELF no est bien alineada"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "no se pueden crear las estructuras de datos TLS para el hilo inicial"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "no se pueden manejar los datos de TLS"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "fallo al asignar un segmento del objeto compartido"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "no se puede cargar el ejecutable dinmicamente"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "no se pueden cambiar las protecciones de memoria"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "no se pueden asignar pginas de tipo `zero-fill'"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "no se puede asignar memoria para la cabecera del programa"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "el fichero objeto no tiene seccin dinmica"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "no se puede efectuar dlopen() sobre el objeto compartido"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "no se puede crear la lista de bsqueda"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "fichero demasiado corto"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "cabecera ELF invlida"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "La codificacin de los datos del fichero ELF no es `big-endian'"
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "La codificacin de los datos del fichero ELF no es `little-endian'"
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "La identificacin de versin del fichero ELF no encaja con la actual"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "ABI del OS del fichero ELF invlida"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "Versin de ABI del fichero ELF invlida"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "error interno"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "La versin del fichero ELF no coincide con la actual"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "El `phentsize' del fichero ELF no es el tamao esperado"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "solamente pueden cargarse ET_DYN y ET_EXEC"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "no se puede abrir el fichero del objeto compartido"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "error de relocalizacin"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "no se puede extender el mbito global"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "sustitucin dinmica de un elemento por una cadena vaca"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "no se puede crear la lista de mbito"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "no se pueden crear las estructuras de datos TLS"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "modo invlido para dlopen()"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr ""
+"no se puede efectuar dlopen() sobre el objeto compartido: memoria esttica TLS\n"
+"demasiado pequea"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "no se puede hacer el segmento escribible para su relocalizacin"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s el `profiler' no encontr ningn PLTREL en el objeto %s\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: el `profiler' se qued sin memoria al ocultar el PLTREL de %s\n"
 
 # Se admiten sugerencias. sv
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "no se puede restaurar el `prot' del segmento despus de la relocalizacin"
 
@@ -6183,119 +6206,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Configura las asociaciones de tiempo de ejecucin del enlazador dinmico"
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "Se ha dado la ruta `%s' ms de una vez"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s no es un tipo de biblioteca conocido"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "No se puede efectuar `stat' sobre %s"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "No se puede efectuar `stat' sobre %s\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s no es un enlace simblico\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "No se puede efectuar `unlink' sobre %s"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "No se puede crear un enlace de %s a %s"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (cambiado)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (SALTADO)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "No se encuentra %s"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "No se puede efectuar `lstat' sobre %s"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Descartado el fichero %s dado que no es un fichero regular."
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "No se cre el enlace ya que no se encontr el soname para %s"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "No se puede abrir el directorio %s"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "No se puede efectuar `lstat' sobre %s"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "No se puede efectuar `stat' sobre %s"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "No se encontr el fichero de entrada %s.\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "biblioteca libc5 %s en un directorio equivocado"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "biblioteca libc6 %s en un directorio equivocado"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "biblioteca libc4 %s en un directorio equivocado"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "las bibliotecas %s y %s en el directorio %s tienen el mismo soname pero distinto tipo."
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "No se puede abrir el fichero de configuracin `%s'"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "No se puede cambiar al directorio /"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "No se puede leer el directorio de ficheros de cach %s\n"
glibc-2.3.2/po/fi.molibc-20030708/po/fi.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/fi.po libc-20030708/po/fi.po
--- glibc-2.3.2/po/fi.po	2002-12-03 03:11:53.000000000 +0900
+++ libc-20030708/po/fi.po	2003-03-10 02:47:01.000000000 +0900
@@ -1,11 +1,16 @@
 # Finnish messages for GNU libc.
-# Copyright  2002 Free Software Foundation, Inc.
-# Lauri Nurmi <lanurmi@iki.fi>, 2002.
+# Copyright  2003 Free Software Foundation, Inc.
+# Lauri Nurmi <lanurmi@iki.fi>, 2002, 2003.
 # Thanks to:
 # * Timo Laine <tila at surfeu.fi> for suggestions
 #
 # "locale" on suomennettu uudella sanalla "maa-asetusto".
 #
+# Pitisik signaalien nimien olla aktiivissa vai passiivissa?
+# esim. Terminated = Pttynyt vai Ptetty?
+# Aborted = Keskeytynyt vai Keskeytetty?
+# 
+#
 # (parempia) suomennosehdotuksia kaivataan sanoille:
 # exchange -- vaihto? (mit ihmett?)
 # ellipsis -- sanankatkaisu?  ATK-sanakirja sanoo nin.
@@ -13,9 +18,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.3.1\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-12-02 05:20+0300\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-08 21:53+0200\n"
 "Last-Translator: Lauri Nurmi <lanurmi@iki.fi>\n"
 "Language-Team: Finnish <translation-team-fi@lists.sourceforge.net>\n"
 "MIME-Version: 1.0\n"
@@ -79,7 +84,7 @@
 
 #: sysdeps/generic/siglist.h:41 stdio-common/../sysdeps/unix/siglist.c:41
 msgid "Terminated"
-msgstr "Pttynyt"
+msgstr "Ptetty"
 
 #: sysdeps/generic/siglist.h:42 stdio-common/../sysdeps/unix/siglist.c:42
 msgid "Urgent I/O condition"
@@ -87,11 +92,11 @@
 
 #: sysdeps/generic/siglist.h:43 stdio-common/../sysdeps/unix/siglist.c:43
 msgid "Stopped (signal)"
-msgstr "Pyshtynyt (signaali)"
+msgstr "Pysytetty (signaali)"
 
 #: sysdeps/generic/siglist.h:44 stdio-common/../sysdeps/unix/siglist.c:44
 msgid "Stopped"
-msgstr "Pyshtynyt"
+msgstr "Pysytetty"
 
 #: sysdeps/generic/siglist.h:45 stdio-common/../sysdeps/unix/siglist.c:45
 msgid "Continued"
@@ -103,11 +108,11 @@
 
 #: sysdeps/generic/siglist.h:47 stdio-common/../sysdeps/unix/siglist.c:47
 msgid "Stopped (tty input)"
-msgstr "Pyshtynyt (ptteen syte)"
+msgstr "Pysytetty (ptteen syte)"
 
 #: sysdeps/generic/siglist.h:48 stdio-common/../sysdeps/unix/siglist.c:48
 msgid "Stopped (tty output)"
-msgstr "Pyshtynyt (ptteen tuloste)"
+msgstr "Pysytetty (ptteen tuloste)"
 
 #: sysdeps/generic/siglist.h:49 stdio-common/../sysdeps/unix/siglist.c:49
 msgid "I/O possible"
@@ -268,7 +273,7 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
+msgid "conversion from `%s' and to `%s' are not supported"
 msgstr "muunnos \"%s\" <-> \"%s\" ei ole tuettu"
 
 #: iconv/iconv_prog.c:246
@@ -294,7 +299,7 @@
 msgid "error while closing output file"
 msgstr "virhe suljettaessa tulostiedostoa"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
@@ -302,9 +307,9 @@
 "Ilmoita ohjelmistovirheist \"glibcbug\"-skriptill (englanniksi) osoitteeseen <bugs@gnu.org>.\n"
 "Suomennoksen virheist voit ilmoittaa listalle <translation-team-fi@lists.sourceforge.net>.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -316,9 +321,9 @@
 "Tm on vapaa ohjelmisto; katso kopiointiehdot lhdekoodista. Takuuta EI\n"
 "ole, ei edes KAUPALLISESTI HYVKSYTTVST LAADUSTA tai SOPIVUUDESTA TIETTYYN TARKOITUKSEEN.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -370,15 +375,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Jokaisen tiedoston ksittelyss kytettv etuliite"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "tulostiedostoa ei tuotettu varoituksen takia"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "listtess hakupuuhun"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "tulostiedostoa ei voi luoda"
 
@@ -1288,7 +1293,7 @@
 msgid "unterminated symbolic name"
 msgstr "pttmtn symbolinen nimi"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "virheellinen ohjaussarja"
 
@@ -1318,39 +1323,39 @@
 msgid "trailing garbage at end of line"
 msgstr "roskaa rivin lopussa"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Tietoa jrjestelmst:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Nyt kytettviss olevien maa-asetustojen nimet"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Nyt kytettviss olevien merkistkarttojen nimet"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "Muuta tulostemuotoa:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Nyt valittujen kategorioiden nimet"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Nyt valittujen avainsanojen nimet"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Nyt lis tietoa"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Hae maa-asetustokohtaiset tiedot."
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1358,7 +1363,7 @@
 "NIMI\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "valmisteltaessa tulostetta"
 
@@ -1489,16 +1494,16 @@
 msgid "cannot create temporary file"
 msgstr "tilapist tiedostoa ei voi luoda"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "arkistotiedostoa ei voi alustaa"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "arkistotiedoston kokoa ei voi muuttaa"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "arkiston otsaketta ei voi kartoittaa"
 
@@ -1514,88 +1519,88 @@
 msgid "cannot map locale archive file"
 msgstr "maa-asetustoarkistoa \"%s\" ei voi kartoittaa"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "uutta arkistoa ei voi lukita"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "maa-asetustoarkistoa ei voi laajentaa"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "maa-asetustoarkiston tilaa ei voi muuttaa"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "uutta arkistoa ei voi nimet uudelleen"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "maa-asetustoarkistoa \"%s\" ei voi avata"
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "maa-asetustoarkiston \"%s\" tilaa ei voi lukea"
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "maa-asetustoarkistoa \"%s\" ei voi lukita"
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "arkiston otsaketta ei voi lukea"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "maa-asetusto \"%s\" on jo olemassa"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "ei voi list maa-asetustoarkistoon"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "maa-asetustojen aliastiedostoa \"%s\" ei lydy"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "Listtn %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "tiedoston \"%s\" tilan lukeminen eponnistui: %s: ei huomioida"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "\"%s\" ei ole hakemisto: ei huomioida"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "hakemistoa \"%s\" ei voi avata: %s: ei huomioida"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "eptydellinen valikoima maa-asetustotiedostoja hakemistossa \"%s\""
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "kaikkia tiedostoja hakemistossa \"%s\" ei voi lukea: ei huomioida"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "maa-asetusto \"%s\" ei ole arkistossa"
@@ -1664,8 +1669,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "vlin ylraja ei ole pienempi kuin alaraja"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "muisti lopussa"
 
@@ -1692,7 +1697,7 @@
 msgid "Another string for testing."
 msgstr "Toinen merkkijono testausta varten"
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NIMI"
 
@@ -1736,7 +1741,7 @@
 msgid "duplicate set definition"
 msgstr "kaksinkertainen joukon mrittely"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "tm on ensimminen mrittely"
 
@@ -1754,44 +1759,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "tuntematon direktiivi \"%s\": rivi ei huomioida"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "kaksinkertainen viestinumero"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "kaksinkertainen viestitunniste"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "virheellinen merkki: viesti ei huomioida"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "virheellinen rivi"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "vrn muotoinen rivi jtetty huomioimatta"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "tulostiedostoa \"%s\" ei voi avata"
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "pttmtn viesti"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "avattaessa vanhaa katalogitiedostoa"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "muunnosmoduulit eivt ole kytettviss"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "ohjausmerkki ei voi mritt"
 
@@ -1799,7 +1804,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: ei osaa ksitell yli kahdeksaa argumenttia\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "Onnistui"
@@ -2988,23 +2993,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sTuntematon signaali %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "muisti on yhteninen, kirjastossa on ohjelmistovirheit\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "muisti krsinyt ennen varattuja lohkoja\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "muisti krsinyt varattujen lohkojen jlkeen\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "lohko vapautettu kahdesti\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "vr mcheck_status, kirjastossa on ohjelmavirhe\n"
 
@@ -3040,6 +3045,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "DATATIEDOSTO [TULOSTIEDOSTO]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Tuntematon virhe"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3064,7 +3073,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: Muisti lopussa: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Tuntematon jrjestelmvirhe"
 
@@ -3457,25 +3466,21 @@
 msgid "Interrupted by a signal"
 msgstr "Signaalin keskeyttm"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Tuntematon virhe"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Kytt: %s [-v mrittely] muuttujanimi [polku]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "tuntematon mrittely \"%s\""
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "mrittelemtn"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Tunnistamaton muuttuja \"%s\""
@@ -3537,71 +3542,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: valitsin \"-W %s\" ei salli argumenttia\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "Ei vastaavuutta"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "Virheellinen snnllinen ilmaus"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Virheellinen vertailumerkki"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Virheellinen merkkiluokan nimi"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Kenoviiva lopussa"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Virheellinen takaisinviittaus"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "Pariton [ tai [^"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "Pariton ( tai \\("
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "Pariton \\{"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "Virheellinen \\{\\}:n sislt"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Virheellinen vlin loppu"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Muisti lopussa"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "Virheellinen edeltv snnllinen ilmaus"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "Ennenaikainen snnllisen ilmauksen loppu"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "Liian suuri snnllinen ilmaus"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr "Pariton ) tai \\)"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "Ei edeltv snnllist lauseketta"
 
@@ -3622,7 +3627,7 @@
 
 #: argp/argp-help.c:1189
 msgid "Mandatory or optional arguments to long options are also mandatory or optional for any corresponding short options."
-msgstr "Pakolliset tai valinnaiset argumentit pitkille optioille ovat pakollisia tai valinnaisia kaikille vastaaville lyhyille optioille."
+msgstr "Pakolliset tai valinnaiset argumentit pitkille valitsimille ovat pakollisia tai valinnaisia kaikille vastaaville lyhyille valitsimille."
 
 #: argp/argp-help.c:1572
 msgid "Usage:"
@@ -3755,24 +3760,24 @@
 msgid "Service configuration to be used"
 msgstr "Kytettvt palveluasetukset"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "%s ei tue luettelemista\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - hae merkintj hallinnollisesta tietokannasta."
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Tuetut tietokannat:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "vr mr argumentteja"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Tuntematon tietokanta: %s\n"
@@ -3801,68 +3806,72 @@
 msgid "invalid pointer size"
 msgstr "virheellinen osoittimen koko"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: Muistin varaaminen ei onnistu\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: socket: Kaikki portit kytss\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "yhdist osoitteeseen %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "Yritetn %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write (alustetaan vakiovirhetuloste): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (alustetaan vakiovirhetuloste): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: protokollavirhe piiriasetuksissa\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "socket: protokollavirhe piiriasetuksissa\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: vajaa luku"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "tiedoston tilan luku eponnistui"
 
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "ei ole tavallinen tiedosto"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "ei voi avata"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "tiedoston tilan luku eponnistui"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "virheellinen omistaja"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "kirjoitusoikeus muulla kuin omistajalla"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "kovalinkitetty johonkin"
 
@@ -4035,7 +4044,7 @@
 
 #: sunrpc/pm_getmaps.c:74
 msgid "pmap_getmaps rpc problem"
-msgstr "pmap_getmaps rpc-ongelma"
+msgstr "pmap_getmaps-rpc-ongelma"
 
 #: sunrpc/pmap_clnt.c:72
 msgid "__get_myaddress: ioctl (get interface configuration)"
@@ -4073,109 +4082,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "Vastausta yleislhetykseen ei pystyt vastaanottamaan"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: tuloste ylikirjoittaisi tiedoston %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: tiedostoa %s ei voi avata: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: kirjoitettaessa tulostetta %s: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "C-esikntj ei lydy: %s \n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "mitn C-esikntj (cpp) ei lydy\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: C-esikntj eponnistui signaalilla %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: C-esikntj eponnistui paluuarvolla %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "virheellinen verkkotyyppi :\"%s\"\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: liian monta mrittely\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: argumenttillistan koodausvirhe\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "tiedosto \"%s\" on olemassa ja saatetaan ylikirjoittaa\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "Voidaan antaa vain yksi sytetiedosto!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Tm toteutus ei tue uudentyyppist MT-turvallista koodia!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "Netid-lippua ei voi kytt inetd-lipun kanssa!\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "Lippua netid ei voi kytt ilman TIRPC:t!\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "Table-lippuja ei voi kytt \"newstyle\":n kanssa!\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "\"sytetiedosto\" vaaditaan mallin luontilippuja varten.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "Tiedostonluontilippuja voi olla vain yksi!\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "kytt: %s sytetiedosto\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Dnimi[=arvo]] [-i koko] [-I [-K sekuntit]] [-Y polku] sytetiedosto\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o tulostiedosto] [sytetiedosto]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s verkkotyyppi]* [-o tulostiedosto] [sytetiedosto]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n verkkoid]* [-o tulostiedosto] [sytetiedosto]\n"
@@ -5032,7 +5041,7 @@
 msgid "while allocating hash table entry"
 msgstr "varattaessa tilaa tiivistetaulukkomerkinnlle"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "tiedoston \"%s\" tilaa ei voi lukea: %s"
@@ -5045,153 +5054,158 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "Ohjelmaa nscd ei voi ajaa turvallisessa tilassa normaalin kyttjn oikeuksilla"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "varattaessa vlimuistia: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "pistoketta ei voi avata: %s"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "pistoketta ei voi asettaa vastaanottamaan yhteyksi: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: pyynt vastaanotettu (Versio = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "vanhaa pyyntversiota %d ei voi ksitell; nykyinen versio on %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "tulosta ei voi kirjoittaa: %s"
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "virhe kutsujan tunnisteen hakemisessa: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "hyvksyttess yhteyksi: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "vajaa luku luettaessa pyynt: %s"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "avaimen pituus pyynnss liian pitk: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "vajaa luku luettaessa pyyntavainta: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "Ohjelman nscd ajaminen kyttjn \"%s\" oikeuksilla eponnistui"
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "getgrouplist eponnistui"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "setgroups eponnistui"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "varattaessa tilaa avainkopiolle"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "varattaessa tilaa vlimuistimerkinnlle"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "vajaa kirjoitus tiedostossa %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "\"%s\" ei lytynyt ryhmvlimuistista!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "Virheellinen numeerinen gid \"%s\"!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "\"%d\" ei lytynyt ryhmvlimuistista!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "\"%s\" ei lytynyt isntvlimuistista!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Lue asetukset tiedostosta NIMI"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "l haaraudu ja nyt viestit nykyisess tty:ss"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "MR"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Kynnist MR siett"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Sammuta palvelin"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Nyt nykyiset asetustilastot"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TAULUKKO"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Poista kytst mritelty vlimuisti"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TAULUKKO,kyll"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Kyt erillist vlimuistia jokaiselle kyttjlle"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Nimipalvelun vlimuistidemoni."
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "on jo kynniss"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Vain root voi kytt tt valitsinta!"
 
@@ -5281,22 +5295,22 @@
 "%15ld%% vlimuistiosuma-aste\n"
 "%15s  tarkista muutokset tiedostosta /etc/%s\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "\"%s\" ei lytynyt salasanavlimuistista!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "Virheellinen numeerinen uid \"%s\"!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "\"%d\" ei lytynyt salasanavlimuistista!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "kykylistaa ei voi luoda"
 
@@ -5347,7 +5361,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", OS ABI: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "Vlimuistitiedostoa %s ei voi avata\n"
@@ -5393,15 +5407,15 @@
 msgid "Renaming of %s to %s failed"
 msgstr "Uudelleennimeminen %s -> %s eponnistui"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "jaettu objekti ei ole avoin"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr "TLS-luontilaskurin ylivuoto! Lhet raportti \"glibcbug\"-skriptill."
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "DST ei ole sallittu SUID/SGID-ohjelmissa"
 
@@ -5418,181 +5432,193 @@
 msgid "cannot allocate dependency list"
 msgstr "riippuvuuslistalle ei voi varata muistia"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "symbolihakulistalle ei voi varata muistia"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "Suodattimet eivt ole tuettuja LD_TRACE_RPELINKING:in kanssa"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "DYNAAMISEN LINKITTJN OHJELMISTOVIRHE!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "virhe ladattaessa jaettuja kirjastoja"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "nimitietueelle ei voi varata muistia"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "hakupolulle ei voi luoda vlimuistia"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "RUNPATH/RPATH-kopiota ei voi luoda"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "hakupolkutaulukkoa ei voi luoda"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "jaetun objektin tilaa ei voi lukea"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "nollatyttlaitetta ei voi avata"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "jaettua objektikahvaa ei voi luoda"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "tiedoston dataa ei voi lukea"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "ELF-latauskomennon tasaus ei ole sivutasattu"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "ELF-latauskomennon osoite/siirtym ei ole tasattu oikein"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "alkusikeelle ei voi varata TLS-tietorakenteita"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "TLS-dataa ei voi ksitell"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "segmentin kartoitus jaetusta objektista eponnistui"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "kynnistettv tiedostoa ei voi ladata dynaamisesti"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "muistin suojausta ei voi muuttaa"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "nollatytteisi sivuja ei voi kartoittaa"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "ohjelman otsakkeelle ei voi varata muistia"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "objektitiedostossa ei ole dynaamista osaa"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "jaettua objektia ei voi avata funktiolla dlopen()"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "hakulistaa ei voi luoda"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "tiedosto on liian lyhyt"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "virheellinen ELF-otsikko"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "ELF-tiedoston tavujrjestys ei ole \"big-endian\""
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "ELF-tiedoston tavujrjestys ei ole \"little-endian\""
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "ELF-tiedoston versiotunnus ei vastaa nykyist"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "ELF-tiedoston OS ABI on virheellinen"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "ELF-tiedoston ABI-versio virheellinen"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "sisinen virhe"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "ELF-tiedoston versio ei vastaa nykyist"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "ELF-tiedoston phent-koko ei ole odotetun kokoinen"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "vain ET_DYN ja ET_EXEC voidaan ladata"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "jaettua objektitiedostoa ei voi avata"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "uudelleensijoitusvirhe"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "globaalia aluetta ei voi laajentaa"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "tyhjn dynaamisen merkkijonon osan korvaus"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "aluelistaa ei voi luoda"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "TLS-tietorakenteita ei voi luoda"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "virheellinen tila funktiolle dlopen()"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "jaettua objektia ei voi avata funktiolla dlopen(): staattinen TLS-muisti on liian pieni"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "segmentti ei voi muuttaa kirjoitettavaksi uudelleensijoitusta varten"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: profiloija ei lytnyt PLTREL-kentt objektista %s\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: profiloijan muisti loppui varjostettaessa objektin %s PLTREL-kentt\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "segmentin suojausta ei voi palauttaa uudelleensijoituksen jlkeen"
 
@@ -5648,119 +5674,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Sd dynaamisen linkittjn ajonaikaiset sidonnat."
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "Polku \"%s\" on annettu useammin kuin kerran"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s ei ole tunnettu kirjastotyyppi"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "Tiedoston %s tilaa ei voi lukea"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "Tiedoston %s tilaa ei voi lukea\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s ei ole symbolinen linkki\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "Tiedoston %s linkityst ei voi poistaa"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "Linkitys %s -> %s ei onnistu"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (muutettu)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (OHITETTU)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "%s ei lydy"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "Tiedoston %s tilaa ei voi lukea"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Tiedostoa %s ei huomioitu, koska se ei ole tavallinen tiedosto."
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "Linkki ei luotu, koska tiedostolle %s ei lytynyt so-nime"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "Hakemistoa %s ei voi avata"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "Tiedoston %s tilaa ei voi lukea"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "Tiedoston %s tilaa ei voi lukea"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "Sytetiedostoa %s ei lydy.\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "libc5-kirjasto %s on vrss hakemistossa"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "libc6-kirjasto %s on vrss hakemistossa"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "libc4-kirjasto %s on vrss hakemistossa"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "kirjastoilla %s ja %s hakemistossa %s on sama so-nimi, mutta eri tyypit."
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "Asetustiedostoa %s ei voi avata"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "Juurihakemistoon / siirtyminen ei onnistu"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "Vlimuistihakemistoa %s ei voi avata\n"
glibc-2.3.2/po/fr.molibc-20030708/po/fr.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/fr.po libc-20030708/po/fr.po
--- glibc-2.3.2/po/fr.po	2002-10-13 11:01:44.000000000 +0900
+++ libc-20030708/po/fr.po	2003-03-04 03:12:33.000000000 +0900
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: GNU libc 2.3.1\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-10-12 12:00-0500\n"
+"Project-Id-Version: GNU libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-03 08:00-0500\n"
 "Last-Translator: Michel Robitaille <robitail@IRO.UMontreal.CA>\n"
 "Language-Team: French <traduc@traduc.org>\n"
 "MIME-Version: 1.0\n"
@@ -259,8 +259,8 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
-msgstr "conversions de  %s  vers  %s  ne sont pas supportes"
+msgid "conversion from `%s' and to `%s' are not supported"
+msgstr "conversions de  %s  et de , vers  %s  ne sont pas supportes"
 
 #: iconv/iconv_prog.c:246
 #, c-format
@@ -285,15 +285,15 @@
 msgid "error while closing output file"
 msgstr "Erreur lors de la fermeture du fichier de sortie"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
 msgstr "Rapporter toutes anomalies via le script  glibcbug   <bugs@gnu.org>.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -306,9 +306,9 @@
 "reproduction. AUCUNE garantie n'est donne; tant pour des raisons\n"
 "COMMERCIALES que pour RPONDRE  UN BESOIN PARTICULIER.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -360,15 +360,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Prfixe utilis pour tous les accs fichiers"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "Aucun fichier de sortie gnr en raison d'un avertissement dj mis"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "lors d'une insertion dans un arbre de recherche"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "Ne peut gnrer le fichier de sortie"
 
@@ -1288,7 +1288,7 @@
 msgid "unterminated symbolic name"
 msgstr "Nom symbolique incomplet"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "Squence d'chappement invalide"
 
@@ -1318,39 +1318,39 @@
 msgid "trailing garbage at end of line"
 msgstr "rebut en suffixe  la fin de la ligne"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Information systme:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "criture des noms disponibles des localisations"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "criture des noms disponibles des tables de caractres"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "Format de sortie de modification:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "criture des noms slectionns des catgories"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "criture des noms slectionns des mots cls"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Afficher plus informations"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Trouver l'information locale spcifique"
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1358,7 +1358,7 @@
 "NOM\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "lors de la prparation de la sortie"
 
@@ -1489,16 +1489,16 @@
 msgid "cannot create temporary file"
 msgstr "ne peut crer un fichier temporaire"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "ne peut initialiser le fichier d'archive"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "ne peut modifier la taille du fichier d'archive"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "ne peut mapper l'en-tte de l'archive"
 
@@ -1514,88 +1514,88 @@
 msgid "cannot map locale archive file"
 msgstr "ne peut mapper l'archive de localisation"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "ne peut verrouiller la nouvelle archive"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "ne peut augmenter la taille du fichier de l'archive de localisation"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "ne peut modifier les protections de l'archive des localisations dont la taille a chang"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "ne peut changer le nom de la nouvelle archive"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "ne peut ouvrir l'archive des localisations  %s "
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "ne peut valuer par `stat' l'archive des localisations  %s "
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "ne peut verrouiller l'archive des localisations  %s "
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "ne peut lire l'en-tte de l'archive"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "localisation  %s  existe dj"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "ne peut l'ajouter  l'archive des localisations"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "alias du fichier des localisations  %s  non trouv"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "Ajout de %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "chec d'valuation par stat() de  %s : %s: ignor"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr " %s  n'est pas un rpertoire; ignor"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "ne peut ouvrir le rpertoire  %s : %s: ignor"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "jeu incomplet de fichiers dea localisations dans  %s "
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "ne peut lire tous les fichiers dans  %s : ignor"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "localisation  %s  n'est pas dans l'archive"
@@ -1666,8 +1666,8 @@
 "La limite suprieure de l'intervalle n'est pas plus petite\n"
 "que la limite infrieure."
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "Mmoire puise"
 
@@ -1693,7 +1693,7 @@
 msgid "Another string for testing."
 msgstr "Une autre chane pour fins de test."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NOM"
 
@@ -1737,7 +1737,7 @@
 msgid "duplicate set definition"
 msgstr "Double dfinitions de jeux"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "Ceci est la premire dfinition."
 
@@ -1755,44 +1755,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "Directive inconnue  %s : ligne ignore"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "Double messages du numro"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "Double identificateurs de message"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "Caractres invalide: message ignor"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "Ligne invalide"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "Ligne incorrecte ignore"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "Ne peut ouvrir le fichier de sortie  %s "
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "Message incomplet"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "lors de l'ouverture du vieux fichier du catalogue"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "Module de conversion 'est pas disponible"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "Ne peut dterminer une squence de caractre"
 
@@ -1800,7 +1800,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: ne sait pas comment traiter plus de 8 arguments\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "Succs"
@@ -2989,23 +2989,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%ssignal inconnu %d.\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "La mmoire est consistente, la librairie est fautive.\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "Mmoire crase avant le bloc allou\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "Mmoire crase aprs la fin du bloc allou\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "Bloc libr deux fois\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "Statut de  mcheck_status  erron, la librarie est errone.\n"
 
@@ -3041,6 +3041,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "DATAFILE [FICHIER_DE_SORTIE]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Erreur inconnue"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3065,7 +3069,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: mmoire puise: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Erreur systme inconnue"
 
@@ -3465,25 +3469,21 @@
 msgid "Interrupted by a signal"
 msgstr "Interrompu par un signal"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Erreur inconnue"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Usage: %s [-v spcification] nom_de_variable [chemin_d_accs]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "spcification inconnu  %s "
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "indfini"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Variable non reconnue  %s "
@@ -3545,71 +3545,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: l'option  -W %s  ne permet pas d'argument\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "Pas de concordance"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "Expression rgulire invalide"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Caractre de fusionnement invalide"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Nom de classe de caractres invalide"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Barre oblique inverse en suffixe"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Rfrence arrire invalide"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "chec du pairage de [ ou de [^"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "chec du pairage de ( ou de \\("
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "chec du pairage de \\{"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "Contenu invalide de \\{\\}"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Fin d'intervalle invalide"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Mmoire puise"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "Expression rgulire prcdente invalide"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "Fin prmature de l'expression rgulire"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "Expression rgulire trop grosse"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr "chec du pairage de ) ou de \\)"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "Aucune expression rgulire prcdente"
 
@@ -3765,24 +3765,24 @@
 msgid "Service configuration to be used"
 msgstr "Configuration de service  tre utilise"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "numration non supporte sur %s\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent() - obtenir les entres de la base de donnes administratives"
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Base de donnes supportes:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "Mauvais nombre d'arguments"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Base de donnes inconnue:  %s \n"
@@ -3811,68 +3811,72 @@
 msgid "invalid pointer size"
 msgstr "Taille de pointeur invalide"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: ne peut allouer de la mmoire\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: socket: tous les ports sont occups\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "Connexion tablie  l'adresse %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "On tente %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: criture (configuration de stderr): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (configuration de stderr): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: chec du protocole dans la configuration du circuit\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "socket: chec de protocole dans la configuration du circuit.\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: lecture courte"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "chec d'valuation lstat()"
 
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "N'est pas un fichier rgulier"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "Ne peut ouvrir"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "chec d'valuation fstat()"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "Mauvais propritaire"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "accessible en criture par d'autres que le propritaire"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "lien direct rencontr"
 
@@ -4083,109 +4087,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "Ne peut recevoir l'accus rception  la requte faite par diffusion"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: la sortie craserait %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: incapable d'ouvrir %s: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: lors de l'criture sur la sortie %s: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "Ne peut trouver le prprocesseur C: %s\n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "Ne peut trouver un prprocesseur C (cpp)\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: chec du prprocesseur C -- code de terminaison: %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: chec du prprocesseur C -- code de terminaison: %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr " nettype  illgal : %s \n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: trop de dfinitions\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: erreur dans la liste d'arguments de codage\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "Le fichier  %s  existe dj et peut avoir t cras.\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "Ne peut spcifier plus d'un fichier d'entre!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Cette implantation ne supporte pas le nouveau style ou le code MT-safe!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "Ne utiliser le smaphore  netid  avec le smaphore  inetd !\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "Ne peut utiliser le smaphore  netid  sans  TIRPC !\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "Ne peut utiliser la table des smaphores avec  newstyle !\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "\"fichier_d_entre\" est requis pour la gnration du gabarit des indicateurs.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "Ne peut avoir plus d'un fichier de gnration de smaphores!\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "usage: %s fichier_d_entre\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Dname[=valeur]] [-i taille] [-I [-K secondes]] [-Y chemin] fichier\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o fichier_de_sortie] [fichier_d_entre]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s type_rseau]* [-o fichier_de_sortie] [fichier_d_entre]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n id_rseau]* [-o fichier_de_sortie] [fichier_d_entre]\n"
@@ -5042,7 +5046,7 @@
 msgid "while allocating hash table entry"
 msgstr "lors de l'allocation d'entres dans la table de hachage"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "Ne peut valuer par stat() le fichier  %s : %s"
@@ -5055,153 +5059,158 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "Ne peut excuter nscd en mode scuritaire en tant qu'usager sans privilge"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "lors de l'allocation de la cache: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "Ne peut ouvrir le socket:  %s "
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "Ne peut activer le socket pour accepter des connexions: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: requte reue (Version = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "Ne peut traiter une requte d'une vieille version %d; la version courante est %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "Ne peut crire les rsultats:  %s "
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "erreur lors de la recherche de l'identificateur de l'appelant: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "lors de l'acceptation de connexion: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "Lecture courte lors de la lecture de la requte:  %s "
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "La longueur de la cl de la requte est trop longue: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "Lecture courte lors de la lecture de la cl de requte: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "chec d'excution de nscd en tant qu'usager  %s "
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "chec de getgrouplist"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "chec de setgroups"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "lors de l'allocation d'une copie de cl"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "lors de l'allocation d'entre dans la cache"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "criture courte dans %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "N'a pas trouv  %s  dans la cache du groupe!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "gid numrique invalide   %s !"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "N'a pas trouv  %d  dans la cache du groupe!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "N'a pas trouv  %s  dans la cache de la liste des htes!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Lire les donnes de configuration du NOM"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "Ne pas cloner le processus par fork() et ne pas afficher de message sur le tty courant"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "NUMRO"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Dmarrage du NOMBRE de  threads "
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Arrter le serveur"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Afficher les statistiques de la configuration courante"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TABLE"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Invalide la cache spcifie"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TABLE,oui"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Utiliser une cache spare pour chaque usager"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr " Daemon  de la cache du service de noms"
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "dj en excution"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Seul ROOT est autoris  utiliser cette option!"
 
@@ -5291,22 +5300,22 @@
 "%15ld%% taux de reprage\n"
 "%15s  vrifier /etc/%s pour les changements\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "N'a pas trouv  %s  dans la cache des mots de passe!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "uid numrique invalide   %s !"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "N'a pas trouv  %d  dans la cache des mots de passe!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "Ne peut crer une liste des possibilits"
 
@@ -5357,7 +5366,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", ABI Systme d'exploitation: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "Ne peut ouvrir le fichier de la cache %s\n"
@@ -5403,15 +5412,15 @@
 msgid "Renaming of %s to %s failed"
 msgstr "CHEC du changement de nom de %s vers %s"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "Objet partag non ouvert"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr "Compteut de gnration TLS a boucl! SVP expdier un rapport avec le script 'glibcbug'"
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "DST non permis dans un programme SUID/SGID"
 
@@ -5428,181 +5437,193 @@
 msgid "cannot allocate dependency list"
 msgstr "Ne peut allouer une liste de dpendances"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "Ne peut allouer la liste des symboles recherches"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "Filtres non supports avec LD_TRACE_PRELINKING"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "PROBLME DANS LE CHARGEUR DE LIENS DYNAMIQUES"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "erreur lors du chargement des librairies partages"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "Ne peut allouer une nom d'enregistrement"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "Ne peut crer une cache pour le chemin de recherche"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "Ne peut crer une copie RUNPATH/RPATH"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "Ne peut crer un tableau des chemins de recherche"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "chec valuer par stat() l'objet partag"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "Ne peut ouvrir le fichier de priphrique rempli de zros"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "Ne peut crer un objet descripteur partag"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "Ne peut lire le fichier de donnes"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "Commande de chargement sur une page ELF qui n'est pas aligne"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "Commande de chargement sur une adresse ELF incorrectement aligne"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "ne peut allouer une structure de donnes TLS pour un thread initial"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "ne peut traiter les donnes TLS"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "chec d'adressage (mapping) du segement de l'objet partag"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "Ne peut dynamiquement charger un excutable"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "Ne peut modifier les protections de mmoire"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "Ne peut adresser des pages rempliez de zros"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "Ne peut allouer de la mmoire pour une en-tte de programme"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "Le fichier objet n'a pas de section dynamique"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "L'objet partag ne peut pas tre ouvert via dlopen()"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "Ne peut crer une liste de recherche"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "Fichier trop court"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "En-tte ELF invalide"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "Donnes d'encodage du fichier ELF n'est pas big-endian"
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "Donnes d'encodage du fichier ELF n'est pas little-endian"
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "Identificateur de version du fichier ELF ne concorde pas avec la version courante"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "Systme d'exploitation du fichier ELF ABI invalide"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "Version du fichier ELF ABI invalide"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "Erreur interne"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "Version du fichier ELF ne concorde pas avec la version courante"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr " Phentize  du fichier ELF ne concorde pas avec la taille prvue"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "Seuls ET_DYN et ET_EXEC peuvent tre chargs"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "Ne peut ouvrir le fichier d'objet partag"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "erreur de relocalisation"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "Ne peut augmenter l'tendue de la plage"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "La chane dynamique d'un jeton de substition est vide."
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "ne peut crer une liste d'tendue"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "ne peut crer les structures de donnes TLS"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "mode invalide pour dlopen()"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "l'objet partag ne peut pas tre ouvert via dlopen(): mmoire statiques TLS trop petite"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "Ne peut rendre le segment inscritible lors d'une relocalisation"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: profileur n'a repr aucun PLTREL dans l'objet %s\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: profileur mmoire puise par l'ombrage PLTREL de %s\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "ne peut restaurer le segment prot aprs reloc"
 
@@ -5658,119 +5679,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Configuration dynamique des ditions de liens lors de l'excution"
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "Chemin  %s  donn plus d'une fois"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s n'est pas un type de librairie connue"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "Ne peut valuer par stat %s"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "Ne peut valuer par stat %s\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s n,est pas un lien symbolique\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "Ne peut enlever le lien (unlink) %s"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "Ne peut tablir un lien entre %s et %s"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (a t modifi)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (ESCAMOT)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "Ne peut reprer %s"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "Ne peut valuer par lstat %s"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Ignorer le fichier %s tant donn que ce n'est pas un fichier rgulier"
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "Aucun lien cr tant donn qu'il n'a pas t repr pour %s"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "Ne peut ouvrir le rpertoire %s"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "Ne peut valuer par lstat %s"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "Ne peut valuer par stat %s"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "Fichier d'entre %s non repr\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "librairie libc5 %s est dans le mauvais rpertoire"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "librairie libc6 %s est dans el mauvais rpertoire"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "librairie libc4 %s est dans le mauvais rpertoire"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "Les librairies %s et %s du rpertoire %s ont le mme nom mais sont de types diffrents"
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "Ne peut ouvrir le fichier de configuration %s"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "Ne peut se positionner (chdir) dans /"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "Ne peut ouvrir le fichier de la cache des rpertoires %s\n"
glibc-2.3.2/po/gl.molibc-20030708/po/gl.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/gl.po libc-20030708/po/gl.po
--- glibc-2.3.2/po/gl.po	2002-10-06 03:15:44.000000000 +0900
+++ libc-20030708/po/gl.po	2003-03-04 04:35:16.000000000 +0900
@@ -4,9 +4,9 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.3\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-10-05 15:13+0200\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-03 20:13+0100\n"
 "Last-Translator: Jacobo Tarrio <jtarrio@trasno.net>\n"
 "Language-Team: Galician <gpul-traduccion@ceu.fi.udc.es>\n"
 "MIME-Version: 1.0\n"
@@ -259,8 +259,8 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
-msgstr "as conversins de `%s' a `%s' non estn soportadas"
+msgid "conversion from `%s' and to `%s' are not supported"
+msgstr "as conversins de `%s' e a `%s' non estn soportadas"
 
 #: iconv/iconv_prog.c:246
 #, c-format
@@ -285,15 +285,15 @@
 msgid "error while closing output file"
 msgstr "erro ao pecha-lo ficheiro de sada"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
 msgstr "Informe dos erros usando o script `glibcbug' a <bugs@gnu.org>.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -305,9 +305,9 @@
 "Isto  software libre; vexa o cdigo fonte polas condicins de copia. NON hai\n"
 "garanta; nin sequera de COMERCIABILIDADE ou APTITUDE PARA UN FIN DETERMINADO.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -359,15 +359,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Prefixo a empregar para tdolos accesos a ficheiro"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "non se producu un ficheiro de sada porque se deron avisos"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "ao inserir na rbore de busca"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "non se pode xera-lo ficheiro de sada"
 
@@ -1277,7 +1277,7 @@
 msgid "unterminated symbolic name"
 msgstr "nome simblico non rematado"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "secuencia de escape non vlida"
 
@@ -1307,39 +1307,39 @@
 msgid "trailing garbage at end of line"
 msgstr "lixo na fin da lia"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Informacin do sistema:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Escribi-los nomes dos `locales' dispoibles"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Escribi-los nomes dos mapas de caracteres dispoibles"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "Modifica-lo formato de sada:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Escribi-los nomes das categoras seleccionadas"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Escribi-los nomes das claves seleccionadas"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Amosar mis informacin"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Obter informacin especfica do `locale'."
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1347,7 +1347,7 @@
 "NOME\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "ao prepara-la sada"
 
@@ -1478,16 +1478,16 @@
 msgid "cannot create temporary file"
 msgstr "non se pode crea-lo ficheiro temporal"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "non se pode inicializa-lo ficheiro de arquivo"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "non se pode cambia-lo tamao do ficheiro de arquivo"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "non se pode mapea-la cabeceira do arquivo"
 
@@ -1503,88 +1503,88 @@
 msgid "cannot map locale archive file"
 msgstr "non se pode mapea-lo ficheiro de arquivo de locales"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "non se pode bloquea-lo novo arquivo"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "non se pode extende-lo ficheiro de arquivo de locales"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "non se pode cambia-lo modo do arquivo de locales co novo tamao"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "non se pode renomea-lo novo arquivo"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "non se pode abri-lo arquivo de locales \"%s\""
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "non se pode facer stat do arquivo de locales \"%s\""
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "non se pode bloquea-lo arquivo de locales \"%s\""
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "non se pode le-la cabeceira do arquivo"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "o locale '%s' xa existe"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "non se pode engadir no arquivo de locales"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "non se atopou o ficheiro de alias de locales `%s'"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "Engadindo %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "a chamada a stat de \"%s\" fallou: %s: ignrase"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "\"%s\" non  un directorio; ignrase"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "non se pode abr-lo directorio \"%s\": %s: ignorado"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "conxunto de ficheiros de locale incompleto en \"%s\""
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "non se poden ler tdolos ficheiros de \"%s\": ignorado"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "o locale \"%s\" non est no arquivo"
@@ -1653,8 +1653,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "o lmite superior do rango non  menor c lmite inferior"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "memoria esgotada"
 
@@ -1680,7 +1680,7 @@
 msgid "Another string for testing."
 msgstr "Outra cadea para facer probas."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NOME"
 
@@ -1725,7 +1725,7 @@
 msgid "duplicate set definition"
 msgstr "definicin de conxunto duplicada"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "esta  a primeira definicin"
 
@@ -1743,44 +1743,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "directiva `%s' descoecida: lia ignorada"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "nmero de mensaxe duplicado"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "identificador de mensaxes duplicado"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "carcter non vlido: mensaxe ignorada"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "lia non vlida"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "ignrase unha lia mal formada"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "non se pode abri-lo ficheiro de sada `%s'"
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "mensaxe non rematada"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "ao abrir un antigo ficheiro de catlogo"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "os mdulos de conversin non estn dispoibles"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "non se pode determina-lo carcter de escape"
 
@@ -1788,7 +1788,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: non se sabe como manexar mis de 8 argumentos\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "xito"
@@ -2977,23 +2977,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sSinal descoecido %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "a memoria  consistente, a biblioteca ten erros\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "memoria alterada antes do bloque reservado\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "memoria alterada despois do bloque reservado\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "bloque liberado das veces\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "mcheck_status falso, a biblioteca ten erros\n"
 
@@ -3029,6 +3029,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "FICHEIRO_DATOS [FICHEIRO_SADA]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Erro descoecido"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3053,7 +3057,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: Memoria esgotada: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Erro de sistema descoecido"
 
@@ -3446,25 +3450,21 @@
 msgid "Interrupted by a signal"
 msgstr "Interrompido por un sinal"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Erro descoecido"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Uso: %s [-v especificacin] nome_variable [nome]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "especificacin `%s' descoecida"
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "non definido"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Variable `%s' non recoecida"
@@ -3526,71 +3526,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: a opcin `-W %s' non acepta parmetros\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "Nada coincide"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "Expresin regular incorrecta"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Carcter de ordenacin incorrecto"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Nome da clase de caracteres incorrecto"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Barra invertida extra  final"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Referencia cara a atrs incorrecta"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "[ ou [^ sen parella"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "( ou \\( sen parella"
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "\\{ sen parella"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "Contido de \\{\\} incorrecto"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Final do rango incorrecto"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Memoria esgotada"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "Expresin regular precedente incorrecta"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "Final prematura da expresin regular"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "Expresin regular demasiado grande"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr ") ou \\) sen parella"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "Non hai unha expresin regular precedente"
 
@@ -3744,24 +3744,24 @@
 msgid "Service configuration to be used"
 msgstr "Configuracin do servicio a empregar"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "A enumeracin non est soportada en %s\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - obte-las entradas da base de datos administrativa."
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Bases de datos soportadas:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "nmero de parmetros incorrecto"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Base de datos descoecida: %s\n"
@@ -3790,68 +3790,72 @@
 msgid "invalid pointer size"
 msgstr "tamao de punteiro non vlido"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: Non se pode reservar memoria\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmp: socket: Tdolos portos estn sendo utilizados\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "conectarse ao enderezo %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "Probando %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write (configurando stderr): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (configurando stderr): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: fallo de protocolo no establecemento do circuito\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "socket: fallo do protocolo no establecemento do circuito\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: lectura curta"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "fallou a chamada a lstat"
 
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "non  un ficheiro normal"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "non se pode abrir"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "fallou a chamada a fstat"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "propietario incorrecto"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "escribible por algun distinto do propietario"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "ten un enlace duro nalgn sitio"
 
@@ -4062,109 +4066,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "Non se pode recibi-la resposta  multidifusin"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: a sada sobreescribira %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: non se pode abrir %s: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: ao escribir  sada %s: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "non podo atopa-lo preprocesador de C: %s \n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "non podo atopar un preprocesador de C (cpp)\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: O preprocesador de C fallou co sinal %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: O preprocesador de C fallou co cdigo de sada %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "tipo de rede ilegal :`%s'\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: demasiadas definicins\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: erro de codificacin da lista de parmetros\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "o ficheiro `%s' xa existe e pode ser sobreescrito\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "Non se pode indicar mis dun ficheiro de entrada!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Esta implementacin non soporta cdigo de novo estilo ou seguro para MT!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "Non se pode utiliza-la opcin netid coa opcin inetd!\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "Non se pode utiliza-la opcin netid sen TIRPC!\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "Non se poden utiliza-las opcins de tboa con newstyle!\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "Precsase dun ficheiro de \"entrada\" para as opcins de xeracin de patrns.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "Non se pode ter mis dunha opcin de xeracin de ficheiros\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "uso: %s ficheiro-de-entrada\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Dnome[=valor]] [-i tamao] [-I [-K segundos]] [-Y rota] entrada\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o sada] [entrada]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s tiporede]* [-o sada] [entrada]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n idrede]* [-o sada] [entrada]\n"
@@ -5021,7 +5025,7 @@
 msgid "while allocating hash table entry"
 msgstr "ao reservar espacio para a entrada da tboa hash"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "non se pode facer stat() sobre o ficheiro `%s': %s"
@@ -5034,153 +5038,158 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "Non se pode executar nscd en modo seguro coma usuario non privilexiado"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "ao reservar espacio para a cach: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "non se pode abrir un socket: %s"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "non se pode facer que o socket acepte conexins: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: peticin recibida (Version = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "non se pode manexa-la antiga peticin versin %d; a versin actual  %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "non se pode escribi-lo resultado: %s"
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "erro ao obte-lo identificador do chamante: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "ao aceptar unha conexin: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "lectura demasiado curta ao le-la peticin: %s"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "lonxitude da clave da peticin demasiado grande: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "lectura demasiado curta ao le-la clave de peticin: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "Non se puido executar nscd coma o usuario '%s'"
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "fallou a chamada a getgrouplist"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "fallou a chamada a setgroups"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "ao reservar espacio para a copia da clave"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "ao reservar espacio para a entrada de cach"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "escritura demasiado curta en %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "Non atopei \"%s\" na cach de grupos!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "Identificacin numrica de grupo \"%s\" non vlida!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "Non atopei \"%d\" na cach de grupos!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "Non atopei \"%s\" na cach de servidores!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Le-los datos de configuracin de NOME"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "Non bifurcar e visualiza-las mensaxes no terminal actual"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "NMERO"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Comezar NMERO fos"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Apaga-lo servidor"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Visualiza-la estatstica da configuracin actual"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TBOA"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Invalida-la cach especificada"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TBOA,si"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Usar unha cach separada para cada usuario"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Demo de Cache de Servicio de Nomes."
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "xa en execucin"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "S root pode usar esa opcin!"
 
@@ -5270,22 +5279,22 @@
 "%15ld%%  tasa de acertos de cach\n"
 "%15s  comprobe /etc/%s para ve-los cambios\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "Non atopei \"%s\" na cach de contrasinais!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "Identificacin numrica de usuario \"%s\" non vlida!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "Non atopei \"%d\" na cach de contrasinais!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "non se pode crea-la lista de capacidades"
 
@@ -5336,7 +5345,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", OS ABI: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "Non se puido abri-lo ficheiro de cach %s\n"
@@ -5382,15 +5391,15 @@
 msgid "Renaming of %s to %s failed"
 msgstr "Fallou o renomeado de %s a %s"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "o obxecto compartido non est aberto"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr "O xerador de TLS deu unha volta completa. Informe co script 'glibcbug'."
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "Non se admite DST en programas SUID/SGID"
 
@@ -5407,181 +5416,193 @@
 msgid "cannot allocate dependency list"
 msgstr "non se pode localiza-la lista de dependencias"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "non se pode localiza-la lista de busca de smbolos"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "Non se soportan os filtros con LD_TRACE_PRELINKING"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "ERRO NO LIGADOR DINMICO!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "erro ao carga-las bibliotecas compartidas"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "non se pode localiza-lo rexistro de nome"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "non se pode crea-la cach para a ruta de busca"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "non se pode crear unha copia de RUNPATH/RPATH"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "non se pode crea-lo vector de rutas de busca"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "non se puido facer stat sobre o obxecto compartido"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "non se pode abrir un dispositivo de recheo de ceros"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "non se pode crear un descriptor de obxecto compartido"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "non se pode le-los datos do ficheiro"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "O comando de carga ELF non est aliado coa pxina"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "O enderezo/desprazamento do comando de carga ELF non est ben aliado"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "non se poden crea-las estructuras de datos TLS para o fo inicial"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "non se poden manexa-los datos TLS"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "non se puido mapear un segmento dun obxecto compartido"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "non se pode cargar dinamicamente o executable"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "non se poden cambia-las proteccins de memoria"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "non se poden mapear pxinas de recheo de ceros"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "Non se pode reservar memoria para a cabeceira do programa"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "o ficheiro obxecto non ten unha seccin dinmica"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "non se pode facer dlopen() sobre o obxecto compartido"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "non se pode crea-la lista de busca"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "ficheiro pequeno de mis"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "cabeceira ELF non vlida"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "A codificacin dos datos do ficheiro ELF non  \"big-endian\""
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "A codificacin dos datos do ficheiro ELF non  \"little-endian\""
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "O identificador da versin do ficheiro ELF non coincide co actual"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "ABI do SO do ficheiro ELF non vlida"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "Versin do ABI do ficheiro ELF non vlida"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "erro interno"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "A versin do ficheiro ELF non coincide coa actual"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "O phentsize do ficheiro ELF non  o tamao esperado"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "s se pode cargar ET_DYN e ET_EXEC"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "non se pode abrir un ficheiro de obxecto compartido"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "erro de cambio de reserva"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "non se pode extende-lo alcance global"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "substitucin de elementos da cadea dinmica baleira"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "non se pode crea-la lista de alcance"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "non se poden crea-las estructuras de datos TLS"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "modo incorrecto para dlopen()"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "non se pode facer dlopen() sobre o obxecto compartido: a memoria TLS esttica  pequena de mis"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "non se pode face-lo segmento gravable para o movemento"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: o perfilador non atopou PLTREL no obxecto %s\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: o perfilador esgotou a memoria sombreando o PLTREL de %s\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "non se pode restaura-la proteccin do segmento despois de movelo"
 
@@ -5637,119 +5658,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Configura-las Asignacins de Tempo de Execucin do Ligador Dinmico"
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "Proporcionouse a ruta `%s' mis dunha vez"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s non  un tipo de biblioteca coecido"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "Non se puido executar `stat' sobre %s"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "Non se puido executar `stat' sobre %s\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s non  unha ligazn simblica\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "Non se puido borrar %s"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "Non se puido ligar %s a %s"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (cambiou)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (OMITIDO)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "Non se pode atopar %s"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "Non se pode facer lstat sobre %s"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Ignorouse o ficheiro %s porque non  un ficheiro normal"
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "Non se creou unha ligazn porque non se atopou o soname para %s"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "Non se puido abri-lo directorio %s"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "Non se pode facer lstat sobre %s"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "Non se pode executar `stat' sobre %s"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "Non se atopou o ficheiro de entrada %s.\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "biblioteca libc5 %s nun directorio incorrecto"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "biblioteca libc6 %s nun directorio incorrecto"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "biblioteca libc4 %s nun directorio incorrecto"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "as bibliotecas %s e %s do directorio %s teen o mesmo soname pero diferente tipo."
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "Non se puido abri-lo ficheiro de configuracin %s"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "Non se pode cambiar ao directorio /"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "Non se puido abri-lo directorio de ficheiros cach %s\n"
glibc-2.3.2/po/hr.molibc-20030708/po/hr.mo
glibc-2.3.2/po/hu.molibc-20030708/po/hu.mo
glibc-2.3.2/po/it.molibc-20030708/po/it.mo
glibc-2.3.2/po/ja.molibc-20030708/po/ja.mo
glibc-2.3.2/po/ko.molibc-20030708/po/ko.mo
glibc-2.3.2/po/nl.molibc-20030708/po/nl.mo
glibc-2.3.2/po/no.molibc-20030708/po/no.mo
glibc-2.3.2/po/pl.molibc-20030708/po/pl.mo
glibc-2.3.2/po/pt_BR.molibc-20030708/po/pt_BR.mo
glibc-2.3.2/po/sk.molibc-20030708/po/sk.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/sk.po libc-20030708/po/sk.po
--- glibc-2.3.2/po/sk.po	2002-10-14 17:29:01.000000000 +0900
+++ libc-20030708/po/sk.po	2003-03-04 03:12:34.000000000 +0900
@@ -1,13 +1,13 @@
 # Slovak translation of the GNU-libc-messages.
-# Copyright (C) 1998-2001, 2002 Free Software Foundation, Inc.
-# Marcel Telka <marcel@telka.sk>, 2002.
+# Copyright (C) 1998-2001, 2002, 2003 Free Software Foundation, Inc.
+# Marcel Telka <marcel@telka.sk>, 2002, 2003.
 # Stanislav Meduna <stano@meduna.org>, 1998-2001.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.3.1\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-10-14 09:46+0200\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-03 08:31+0200\n"
 "Last-Translator: Marcel Telka <marcel@telka.sk>\n"
 "Language-Team: Slovak <sk-i18n@lists.linux.sk>\n"
 "MIME-Version: 1.0\n"
@@ -260,7 +260,7 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
+msgid "conversion from `%s' and to `%s' are not supported"
 msgstr "konverzie z `%s' a do `%s' nie s podporovan"
 
 #: iconv/iconv_prog.c:246
@@ -286,15 +286,15 @@
 msgid "error while closing output file"
 msgstr "chyba poas zatvrania vstupnho sboru"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
 msgstr "Chyby hlste na adrese <bugs@gnu.org> - pouite skript `glibcbug'.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -302,14 +302,14 @@
 "This is free software; see the source for copying conditions.  There is NO\n"
 "warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n"
 msgstr ""
-"Autorsk prva (C) %s Free Software Foundation, Inc.\n"
+"Autorsk prva  %s Free Software Foundation, Inc.\n"
 "Toto je vone riten softvr; pre podmienky koprovania pozri zdrojov kd.\n"
 "Neposkytuje sa IADNA zruka; ani o sa tka OBCHODOVATENOSTI alebo VHODNOSTI\n"
 "NA KONKRTNY EL.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -360,15 +360,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Predpona pouit pre vetky prstupy k sborom"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "vstupn sbor nebol vytvoren kvli vskytu varovan"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "poas vkladania do vyhadvacieho stromu"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "nie je mon vygenerova vstupn sbor"
 
@@ -1278,7 +1278,7 @@
 msgid "unterminated symbolic name"
 msgstr "neukonen symbolick meno"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "neprpustn escape-sekvencia"
 
@@ -1308,39 +1308,39 @@
 msgid "trailing garbage at end of line"
 msgstr "smetie na konci riadku"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Systmov informcie:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Vypsa nzvy dostupnch nrodnch prostred"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Vypsa nzvy dostupnch znakovch sd"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "Modifikova vstupn formt:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Vypsa nzvy vybranch kategri"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Vypsa nzvy vybranch kovch slov"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Vypisova viac informci"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Zska informciu pecifick pre nrodn prostredie."
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1348,7 +1348,7 @@
 "NZOV\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "poas prpravy vstupu"
 
@@ -1479,16 +1479,16 @@
 msgid "cannot create temporary file"
 msgstr "nie je mon vytvori doasn sbor"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "nie je mon inicializova archvny sbor"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "nie je mon zmeni vekos archvneho sboru"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "nie je mon namapova hlaviku archvu"
 
@@ -1504,88 +1504,88 @@
 msgid "cannot map locale archive file"
 msgstr "nie je mon namapova sbor archvu nrodnho prostredia"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "nie je mon uzamkn nov archv"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "nie je mon rozri sbor archvu nrodnho prostredia"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "nie je mon zmeni md archvu nrodnho prostredia s upravenou vekosou"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "nie je mon premenova nov archv"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "nie je mon otvori archv nrodnho prostredia \"%s\""
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "nie je mon zisti stav archvu nrodnho prostredia \"%s\""
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "nie je mon uzamkn archv nrodnho prostredia \"%s\""
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "nie je mon preta hlaviku archvu"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "nrodn prostredie `%s' u existuje"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "nie je mon prida do archvu nrodnho prostredia"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "sbor aliasu nrodnho prostredia `%s' nebol njden"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "Pridvam %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "zistenie stavu \"%s\" zlyhalo: %s: ignorovan"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "\"%s\" nie je adresr; ignorovan"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "nie je mon otvori adresr \"%s\": %s: ignorovan"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "nekompletn skupina sborov nrodnch prostred v \"%s\""
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "nie je mon nata vetky sbory v \"%s\": ignorovan"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "nrodn prostredie \"%s\" nie je v archve"
@@ -1654,8 +1654,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "horn limit rozsahu je men ako doln"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "nedostatok pamti"
 
@@ -1681,7 +1681,7 @@
 msgid "Another string for testing."
 msgstr "In reazec pre testovanie."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NZOV"
 
@@ -1725,7 +1725,7 @@
 msgid "duplicate set definition"
 msgstr "duplicitn defincia sady"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "toto je prv defincia"
 
@@ -1743,44 +1743,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "neznma direktva `%s' - riadok ignorovan"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "duplicitn slo sprvy"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "duplicitn identifiktor sprvy"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "neprpustn znak: sprva ignorovan"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "neprpustn riadok"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "nesprvny riadok ignorovan"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "nie je mon otvori vstupn sbor `%s'"
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "neukonen sprva"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "poas otvrania starho katalgu"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "moduly konverzie nie s dostupn"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "nie je mon uri znak escape"
 
@@ -1788,7 +1788,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: nevie ako m spracova viac ako 8 argumentov\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "spech"
@@ -2977,23 +2977,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sNeznmy signl %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "pam je konzistentn, kninica je chybn\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "pam pred pridelenm blokom prepsan\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "pam za koncom pridelenho bloku prepsan\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "blok uvonen dvakrt\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "pochybn mcheck_status, kninica m chyby\n"
 
@@ -3029,6 +3029,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "DTOV_SBOR [VSTUPN_SBOR]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Neznma chyba"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3053,7 +3057,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: Nedostatok pamti: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Neznma chyba systmu"
 
@@ -3446,25 +3450,21 @@
 msgid "Interrupted by a signal"
 msgstr "Preruen signlom"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Neznma chyba"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Pouitie: %s [-v pecifikcia] meno_premennej [cesta]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "neznma pecifikcia \"%s\""
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "nedefinovan"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Nerozpoznan premenn `%s'"
@@ -3526,71 +3526,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: voba `-W %s' nedovouje poui argument\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "iadna zhoda"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "Neprpustn regulrny vraz"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Neprpustn znak triedenia"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Neprpustn nzov triedy znakov"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Koncov sptn lomtko"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Neprpustn sptn odkaz"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "Neprov [ or [^"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "Neprov ( or \\("
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "Neprov \\{"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "Neprpustn obsah \\{\\}"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Neprpustn koniec rozsahu"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Pam vyerpan"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "Neprpustn predchdzajci regulrny vraz"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "Predasn koniec regulrneho vrazu"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "Regulrny vraz prli vek"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr "Neprov ) or \\)"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "iadny predchdzajci regulrny vraz"
 
@@ -3744,24 +3744,24 @@
 msgid "Service configuration to be used"
 msgstr "Konfigurcia sluby, ktor m by pouit"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "Enumercia %s nie je podporovan\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - zska zznamy z administratvnej databzy."
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Podporovan databzy:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "chybn poet argumentov"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Neznma databza %s\n"
@@ -3790,68 +3790,72 @@
 msgid "invalid pointer size"
 msgstr "neprpustn vekost ukazovatea"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: Nie je mon prideli pam\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: socket: Vetky porty s pouit\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "spoji sa s adresou %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "Skam %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write (nastavenie stderr): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (nastavenie stderr): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: chyba protokolu poas prpravy okruhu\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "socket: chyba protokolu pri prprave okruhu\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: krtke tanie"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "lstat zlyhal"
 
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "nie je regulrny sbor"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "nie je mon otvori"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "fstat sa nepodaril"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "chybn vlastnk"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "zapisovaten nielen pre vlastnka"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "niekde existuje pevn odkaz"
 
@@ -4062,109 +4066,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "Nie je mon prija odpove na broadcast"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: vstup by prepsal %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: nie je mon otvori %s: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: poas zpisu vstupu %s: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "nie je mon njs preprocesor: %s \n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "nie je mon njs iadny C preprocesor (cpp)\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: C preprocesor zlyhal so signlom %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: C preprocesor zlyhal s vstupnm kdom %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "chybn nettype :`%s'\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: privea defines\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: chyba kdovania zoznamu argumentov\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "sbor `%s' u existuje a me by prepsan\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "Nie je mon zada viac ako jeden vstupn sbor!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Tto implementcia nepodporuje nov tl alebo MT-bezpen kd!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "Prznaky netid a inetd nie je mon poui sasne!\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "Nie je mon poui prznak netid bez TIRPC!\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "Pri pouit novho tlu nie je mon poui prznaky tabuky!\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "\"vst_sbor\" je vyadovan pri pouit prznakov tvorby vzoru.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "Nie je mon poui viac ako jeden prznak tvorby sboru!\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "pouitie:  %s vstupn_sbor\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Dnzov[=hodnota]] [-i vekos] [-I [-K sekundy]] [-Y cesta] vst_sbor\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o vst_sbor] [vst_sbor]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s nettype]* [-o vst_sbor] [vst_sbor]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n netid]* [-o vst_sbor] [vst_sbor]\n"
@@ -5027,7 +5031,7 @@
 msgid "while allocating hash table entry"
 msgstr "poas pridelenia zznamu hash-tabuky"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "nie je mon vykona stat() sboru `%s': %s"
@@ -5040,153 +5044,158 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "Nie je mon spusti nscd v bezpenom reime ako neprivilegovan pouvate"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "poas pridelenia cache: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "nie je mon otvori socket `%s'"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "nie je mon povoli socketu prijma spojenia: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: iados prijat (verzia = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "nie je mon spracova star verziu iadosti %d; aktulna verzia je %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "nie je mon zapsa vsledok: %s"
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "chyba pri zskan id volajceho: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "poas prijatia spojenia: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "nepln tanie iadosti: `%s'"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "dka ka v iadosti prli dlh: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "nepln tanie ka iadosti: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "Zlyhalo spustenie nscd ako pouvate '%s'"
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "getgrouplist zlyhalo"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "setgroups zlyhalo"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "poas pridelenia kpie ka"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "poas pridelenia zznamu cache"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "nepln zpis v %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "Nenjden \"%s\" v cache skupn!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "Neplatn seln gid \"%s\"!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "Nenjden \"%d\" v cache skupn!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "Nenjden \"%s\" v cache potaov!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Nata daje o konfigurcii z NZOV"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "Nespa samostatn proces a zobrazova sprvy na aktulnom terminli"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "POET"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Spusti POET vlkien"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Zastavi server"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Vypsa tatistiku aktulnej konfigurcie"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TABUKA"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Zneplatni zadan cache"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TABUKA,no"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Poui samostatn cache pre kadho pouvatea"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Dmon cache sluby nzvov."
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "u be"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Tto voba je dostupn iba superuvateovi!"
 
@@ -5276,22 +5285,22 @@
 "%15ld%% spenos cache\n"
 "%15s  skontrolujte /etc/%s na zmeny\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "Nenjden \"%s\" v cache hesiel!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "Neplatn seln uid \"%s\"!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "Nenjden \"%d\" v cache hesiel!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "nie je mon vytvori zoznam zluitenosti"
 
@@ -5342,7 +5351,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", OS ABI: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "Nie je mon otvori cache sbor %s\n"
@@ -5388,15 +5397,15 @@
 msgid "Renaming of %s to %s failed"
 msgstr "Premenovanie %s na %s zlyhalo"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "zdiean objekt nie je otvoren"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr "Potadlo generovania TLS pretieklo!  Prosm polite sprvu pomocou skriptu 'glibcbug'."
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "DST nie je pre SUID/SGID programy povolen"
 
@@ -5413,181 +5422,193 @@
 msgid "cannot allocate dependency list"
 msgstr "nie je mon prideli pam pre zoznam zvislost"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "nie je mon prideli pam pre vyhadvac zoznam symbolov"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "Filtre nie s podporovan s LD_TRACE_PRELINKING"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "CHYBA V DYNAMICKOM LINKERI!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "chyba poas natavania zdieanch kninc"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "nie je mon prideli pam pre zznam nzvu"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "Nie je mon vytvori cache pre hadanie v ceste"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "nie je mon vytvori kpiu RUNPATH/RPATH"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "nie je mon vytvori pole ciest"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "nepodarilo sa zisti stav zdieanho objektu"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "nie je mon otvori zariadenie pre naplnenie nulami"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "nie je mon vytvori deskriptor zdieanho objektu"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "nie je mon nata daje sboru"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "ELF zarovnanie prkazu nie je zarovnan na strnku"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "ELF zavdzacia adresa/posunutie nie je sprvne zarovnan"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "nie je mon prideli dtov truktry TLS pre poiaton vlkno"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "nie je mon spracova TLS dta"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "nepodarilo sa namapova segment zo zdieanho objektu"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "nie je mon dynamicky nata spustiten sbor"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "nie je mon zmeni ochranu pamti"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "nie je mon namapova strnky vyplnen nulami"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "nie je mon prideli pam pre hlaviku programu"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "objektov sbor neobsahuje iadnu dynamick sekciu"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "zdiean objekt neme by otvoren pomocou dlopen()"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "nie je mon vytvori vyhadvac zoznam"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "sbor je prli krtky"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "neprpustn ELF hlavika"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "Kdovanie dt v ELF sbore nie je big-endian"
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "Kdovanie dt v ELF sbore nie je little-endian"
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "Identifikcia verzie ELF sboru sa nezhoduje s aktulnou"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "Neplatn OS ABI ELF sboru"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "Neplatn verzia ABI ELF sboru"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "intern chyba"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "Verzia sboru ELF sa nezhoduje s aktulnou"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "phentsize ELF sboru nie je oakvan"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "iba ET_DYN a ET_EXEC mu by natan"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "nie je mon otvori sbor zdieanho objektu"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "chyba relokcie"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "nie je mon rozri globlny rozsah"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "przdna substitcia tokenu dynamickho reazca"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "nie je mon vytvori zoznam psobnosti"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "nie je mon dtov truktry TLS"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "neprpustn md pre dlopen()"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "zdiean objekt neme by otvoren pomocou dlopen(): statick pam TLS je prli mal"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "nie je mon zmeni segment na zapisovaten pre relokciu"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: profiler nenaiel PLTREL v objekte %s\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: profiler vyerpal pam pri vytvran kpie PLTREL z %s\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "nie je mon obnovi segment prot po reloc"
 
@@ -5643,119 +5664,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Konfigurcia runtime vzieb dynamickho linkera."
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "Cesta `%s' bola zadan viac ako raz"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s nie je znmy typ kninice"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "Zlyhal stat %s"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "Zlyhal stat %s\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s nie je symbolick odkaz\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "Nie je mon odstrni %s"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "Nie je mon vytvori odkaz %s na %s"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (zmenen)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (VYNECHAN)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "Nie je mon njs %s"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "Zlyhal lstat %s"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Sbor %s ignorovan, kee nie je regulrnym sborom."
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "Odkaz nebol vytvoren, kee pre %s nebolo mon njs soname"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "Nie je mon otvori adresr %s"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "Zlyhal lstat %s"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "Zlyhal stat %s"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "Vstupn sbor %s nebol njden.\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "libc5 kninica %s je v nesprvnom adresri"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "libc6 kninica %s je v nesprvnom adresri"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "libc4 kninica %s je v nesprvnom adresri"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "kninice %s a %s v adresri %s maj rovnak soname, ale odlin typ."
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "Nie je mon otvori konfiguran sbor %s"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "Nie je mon zmeni adresr na /"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "Nie je mon otvori adresr cache sboru %s\n"
glibc-2.3.2/po/sv.molibc-20030708/po/sv.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/sv.po libc-20030708/po/sv.po
--- glibc-2.3.2/po/sv.po	2002-10-15 05:03:36.000000000 +0900
+++ libc-20030708/po/sv.po	2003-03-05 03:25:34.000000000 +0900
@@ -1,13 +1,13 @@
 # GNU libc message catalog for swedish
-# Copyright  1996, 1998, 2001, 2002 Free Software Foundation, Inc.
-# Jan Djrv <jan.h.d@swipnet.se>, 1996, 1998, 2001, 2002.
-# Revision: 1.43
+# Copyright  1996, 1998, 2001, 2002, 2003 Free Software Foundation, Inc.
+# Jan Djrv <jan.h.d@swipnet.se>, 1996, 1998, 2001, 2002, 2003.
+# Revision: 1.46
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.3.1\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-10-14 21:09+0200\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-04 18:46+0100\n"
 "Last-Translator: Jan Djrv <jan.h.d@swipnet.se>\n"
 "Language-Team: Swedish <sv@li.org>\n"
 "MIME-Version: 1.0\n"
@@ -260,7 +260,7 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
+msgid "conversion from `%s' and to `%s' are not supported"
 msgstr "konvertering frn \"%s\" och till \"%s\" stds ej"
 
 #: iconv/iconv_prog.c:246
@@ -286,7 +286,7 @@
 msgid "error while closing output file"
 msgstr "fel vid stngning av utfilen"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
@@ -294,9 +294,9 @@
 "Rapportera fel med programmet \"glibcbug\" till <bugs@gnu.org>.\n"
 "Rapportera fel p versttningen till <sv@li.org>.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -309,9 +309,9 @@
 "INGEN garanti; inte ens fr SLJBARHET eller LMPLIGHET FR NGOT SPECIELLT\n"
 "NDAML.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -363,15 +363,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Prefix att anvnda fr alla filtkomster"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "ingen utfil skapad p grund av varningar"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "vid insttning i sktrd"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "kan inte generera utfil"
 
@@ -1283,7 +1283,7 @@
 msgid "unterminated symbolic name"
 msgstr "oavslutat symboliskt namn"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "ogiltig kontrollsekvens"
 
@@ -1313,39 +1313,39 @@
 msgid "trailing garbage at end of line"
 msgstr "avslutande skrp vid radslutet"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Systeminformation:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Skriv namn p tillgngliga lokaler"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Skriv namn p tillgngliga teckenuppsttningar"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "ndra utdataformat:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Skriv namn p valda kategorier"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Skriv namn p valda nyckelord"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Skriv mer information"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Hmta lokal-specifik information"
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1353,7 +1353,7 @@
 "NAMN\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "nr utdata frbereddes"
 
@@ -1484,16 +1484,16 @@
 msgid "cannot create temporary file"
 msgstr "kan inte skapa temporrfil"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "kan inte initiera arkivfil"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "kan inte byta storlek p arkivfil"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "kan inte lsa arkivhuvud med mmap"
 
@@ -1509,88 +1509,88 @@
 msgid "cannot map locale archive file"
 msgstr "kan inte ppna lokalarkivfil med mmap"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "kan inte lsa nytt arkiv"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "kan inte utka lokalarkivfil"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "kan inte ndra tkomstlge p storleksndrat lokalarkiv"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "kan inte byta namn p nytt arkiv"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "kan inte ppna lokalarkiv \"%s\""
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "kan inte ta status p lokalarkiv \"%s\""
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "kan inte lsa lokalarkiv \"%s\""
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "kan inte lsa arkivhuvud"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "lokal \"%s\" finns redan"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "kan inte lgga till till lokalarkiv"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "fil \"%s\" fr lokalalias hittas inte"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "Lgger till %s\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "ta status p \"%s\" misslyckades: %s: ignorerad"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "\"%s\" r inte en katalog, ignorerad"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "kan inte ppna katalog \"%s\": %s: ignorerad"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "ofullstndig uppsttning av lokalfiler i \"%s\""
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "kan inte lsa alla filer i \"%s\": ignorerad"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "lokal \"%s\" finns inte i arkivet"
@@ -1659,8 +1659,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "vre grns i intervall r inte mindre n undre grns"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "minne slut"
 
@@ -1686,7 +1686,7 @@
 msgid "Another string for testing."
 msgstr "En till strng fr test."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "NAMN"
 
@@ -1730,7 +1730,7 @@
 msgid "duplicate set definition"
 msgstr "dubblerad definition av mngd"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "detta r den frsta definitionen"
 
@@ -1748,44 +1748,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "oknt direktiv \"%s\": rad ignorerad"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "dubblerat meddelandenummer"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "dubblerad meddelandeidentifierare"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "ogiltigt tecken: meddelandet ignorerat"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "ogiltig rad"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "felaktig rad ignorerad"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "kan inte ppna utfil \"%s\""
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "oavslutat meddelande"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "nr gammal katalogfil ppnades"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "konverteringsmoduler inte tillgngliga"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "kan inte avgra kontrolltecken"
 
@@ -1793,7 +1793,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: kan inte hantera mer n 8 argument\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "Lyckat"
@@ -2982,23 +2982,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sOknd signal %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "minnet r konsistent, biblioteket r felaktigt\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "minnet frstrt fre allokerat block\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "minnet frstrt efter slutet p allokerat block\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "block frigjort tv gnger\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "felaktig mcheck_status, biblioteket r felaktigt\n"
 
@@ -3034,6 +3034,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "DATAFIL [UTFIL]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Oknt fel"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3058,7 +3062,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: Minnet slut: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Oknt systemfel"
 
@@ -3451,25 +3455,21 @@
 msgid "Interrupted by a signal"
 msgstr "Avbruten av en signal"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Oknt fel"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Anvndning: %s [-v specifikation] variabelnamn [skvg]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "oknd specifikation \"%s\""
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "odefinierad"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Oknd variabel \"%s\""
@@ -3531,71 +3531,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: flaggan \"-W %s\" tar inget argument\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "Ingen trff"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "Ogiltigt reguljrt uttryck"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Ogiltigt kollationeringstecken"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Ogiltigt teckenklassnamn"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "Avslutande omvnt snedstreck"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Ogiltig baktreferens"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "Obalanserade [ eller [^"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "Obalanserade ( eller \\("
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "Obalanserad \\{"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "Ogiltigt innehll i \\{\\}"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Ogiltigt intervallslut"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Minnet slut"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "Ogiltigt fregende reguljrt uttryck"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "Fr tidigt slut p reguljrt uttryck"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "Reguljrt uttryck fr stort"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr "Obalanserade ) eller \\)"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "Inget fregende reguljrt uttryck"
 
@@ -3749,24 +3749,24 @@
 msgid "Service configuration to be used"
 msgstr "Tjnstekonfiguration som ska anvndas"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "Upprkning stds inte p %s\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - hmta poster frn administrativ databas"
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Databaser som stds:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "fel antal argument"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Oknd databas: %s\n"
@@ -3795,68 +3795,72 @@
 msgid "invalid pointer size"
 msgstr "ogiltig pekarstorlek"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: Kan inte allokera minne\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: uttag (socket): Alla portar anvnds\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "anslut till adress %s: "
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "Provar %s...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write: (stter upp standard fel): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (stter upp standard fel): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: protokollfel i frbindelseuppsttning\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "uttag (socket): protokollfel i frbindelseuppsttning\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: lsning gav fr lite data"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "misslyckades ta status (lstat)"
 
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "inte en normal fil"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "kan inte ppna"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "misslyckades ta status (fstat)"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "olmplig gare"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "skrivbar fr andra n garen"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "hrdlnkad ngonstans"
 
@@ -4067,109 +4071,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "Kan inte ta emot svar p utsndning"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: utdata skulle skriva ver %s\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: kan inte ppna %s: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: nr resultatet %s skrevs: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "kan inte hitta C preprocessor: %s \n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "kan inte hitta ngon C preprocessor (cpp)\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: C preprocessorn avslutades med signal %d\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: C preprocessorn avslutades med kod %d\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "otillten nttyp: \"%s\"\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: fr mnga \"define\"\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: arglist kodningsfel\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "fil \"%s\" finns redan och kan bli verskriven\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "Kan inte ange mer n en infil!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Denna implementation stdjer inte \"newstyle\" eller trdsker kod!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "Kan inte ange netid-flaggan tillsammans med inetd-flaggan!\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "Kan inte ange netid-flaggan utan TIRPC!\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "Kan inte ange tabellflaggor med ny stil\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "\"infil\" r obligatorisk fr mallgenereringsflaggor.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "Kan inte ha mer n en filgenereringsflagga!\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "anvndning:  %s infil\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Dnamn[=vrde]] [-i storlek] [-I [-K sekunder]] [-Y skvg] infil\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o utfil] [infil]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s nttyp]* [-o utfil] [infil]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n ntid]* [-o utfil] [infil]\n"
@@ -4698,7 +4702,7 @@
 
 #: nis/nis_print.c:239
 msgid "\tAccess rights: "
-msgstr "\ttkomstrttigheter: "
+msgstr "\tRttigheter  : "
 
 #: nis/nis_print.c:252
 msgid "Group Flags :"
@@ -4710,7 +4714,7 @@
 "Group Members :\n"
 msgstr ""
 "\n"
-"Guppmedlemmar:\n"
+"Gruppmedlemmar:\n"
 
 #: nis/nis_print.c:266
 #, c-format
@@ -4725,7 +4729,7 @@
 #: nis/nis_print.c:268
 #, c-format
 msgid "Character Separator : %c\n"
-msgstr "Teckenseparator: %c\n"
+msgstr "Teckenseparator     : %c\n"
 
 #: nis/nis_print.c:269
 #, c-format
@@ -4747,7 +4751,7 @@
 
 #: nis/nis_print.c:277
 msgid "\t\tAccess Rights : "
-msgstr "\t\ttkomstrttigheter: "
+msgstr "\t\tRttigheter   : "
 
 #: nis/nis_print.c:286
 msgid "Linked Object Type : "
@@ -4798,7 +4802,7 @@
 
 #: nis/nis_print.c:324
 msgid "Access Rights : "
-msgstr "tkomstrttigheter: "
+msgstr "Rttigheter   : "
 
 #: nis/nis_print.c:326
 msgid ""
@@ -4811,7 +4815,7 @@
 #: nis/nis_print.c:329
 #, c-format
 msgid "Creation Time : %s"
-msgstr "Skapad: %s"
+msgstr "Skapad        : %s"
 
 #: nis/nis_print.c:331
 #, c-format
@@ -5026,7 +5030,7 @@
 msgid "while allocating hash table entry"
 msgstr "nr hashtabellspost allokerades"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "kan inte ta status p fil \"%s\": %s"
@@ -5039,153 +5043,158 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "Kan inte kra nscd i skert lge som opriviligierad anvndare"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "nr cache-post allokerades: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "kan inte ppna uttag (socket): %s"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "kan inte f uttag (socket) att acceptera frbindelser: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: begran mottagen (version = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "Kan inte hantera ldre frfrgansversion %d, nuvarande version r %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "kan inte skriva resultat: %s"
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "kunde inte hmta anropandes identitet: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "nr frbindelse accepterades: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "fattas data vid lsning av begran: %s"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "nyckellngd i begran fr lng: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "fattas data vid lsning av begransnyckel: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "Misslyckades att kra nscd som anvndare \"%s\""
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "getgrouplist misslyckades"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "setgroups misslyckades"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "nr nyckelkopia allokerades"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "nr cache-post allokerades"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "ofullstndig skrivning i %s: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "Hittar inte \"%s\" i gruppcache!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "Ogiltigt numeriskt gruppid (gid) \"%s\"!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "Hittar inte \"%d\" i gruppcache!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "Hittar inte \"%s\" i vrdcache!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Ls konfigurationsdata frn NAMN"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "Skapa inte barnprocess, visa meddelanden p nuvarande tty"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "ANTAL"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "Starta ANTAL trdar"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Avsluta servern"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "Skriv ut nuvarande konfigurationsstatistik"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TABELL"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Invalidera den angivna cachen"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TABELL,yes"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Anvnd separat cache fr varje anvndare"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Namntjnst cache-demon"
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "kr redan"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Bara root har tilltelse att anvnda denna operation!"
 
@@ -5275,22 +5284,22 @@
 "%15ld%% cache trffprocent\n"
 "%15s  kontrollera /etc/%s fr ndringar\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "Hittar inte \"%s\" i lsenordscache!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "Ogiltigt numeriskt anvndarid (uid) \"%s\"!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "Hittar inte \"%d\" i lsenordscache!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "kan inte skapa egenskapslista"
 
@@ -5341,7 +5350,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", OS ABI: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "Kan inte ppna cache-fil \"%s\"\n"
@@ -5387,17 +5396,17 @@
 msgid "Renaming of %s to %s failed"
 msgstr "Namnbyte p %s till %s misslyckades"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "delat objekt r inte ppnat"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr ""
 "Generationsrknare fr TLS slog runt!  Var snll och skicka felrapport med\n"
 "\"glibcbug\"-skriptet"
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "DST inte tillten i SUID/SGID-program"
 
@@ -5416,181 +5425,193 @@
 msgid "cannot allocate dependency list"
 msgstr "kan inte allokera beroendelista"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "kan inte allokera sklista fr symboler"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "Filter stds ej med LD_TRACE_PRELINKING"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "FEL I DYNAMISK LNKARE!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "fel nr delade bibliotek laddades"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "kan inte allokera namnpost"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "kan inte skapa cache fr skvg"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "kan inte skapa kopia av RUNPATH/RPATH"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "kan inte skapa skvgslista"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "kan inte ta status p delat objekt"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "kan inte ppna nollfyllnadsenhet"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "kan inte skapa delad objektdeskriptor"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "kan inte lsa fildata"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "ELF-laddkommando r inte p sidgrns"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "Address/position fr ELF-laddkommando r inte p rtt bytegrns"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "kan inte skapa TLS-datastrukturer fr frsta trden"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "kan inte hantera TLS-data"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "misslyckades att mappa segment frn delat objekt"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "kan inte ladda exekverbar fil dynamiskt"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "kan inte ndra minnesskydd"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "kan inte mappa nollfyllda sidor"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "Kan inte allokera minne fr programhuvud"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "objektfilen har ingen dynamisk sektion"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "delat objekt kan inte gras dlopen() p"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "kan inte skapa sklista"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "fil fr kort"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "ogiltigt ELF-huvud"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "Kodning fr ELF-fildata r inte \"big-endian\""
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "Kodning fr ELF-fildata r inte \"little-endian\""
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "ELF-filens versionsidentitet stmmer inte med nuvarande"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "ELF-fil har felaktig version p OS-ABI"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "ELF-fil har felaktig version p ABI"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "internt fel"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "ELF-filens version stmmer inte med nuvarande"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "ELF-filens vrde p \"phentsize\" r inte den frvntade"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "bara ET_DYN och ET_EXEC kan laddas"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "kan inte ppna delad objektfil"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "fel vid relokering"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "kan inte utka globalt omrde"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "substitution av \"dynamic string token\" r tom"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "kan inte skapa omfngslista"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "kan inte skapa datastrukturer fr TLS"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "ogiltiga flaggor fr dlopen()"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "delat objekt kan inte gras dlopen() p: statiskt TLS-minne r fr litet"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "kan inte gra segment skrivbart fr relokering"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: profileraren hittade inga PLTREL i objekt %s\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: profileraren fick slut minne fr kopiering av PLTREL i %s\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "kan inte terstlla segmentrttigheter efter relokering"
 
@@ -5646,119 +5667,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Konfigurera bindningar fr den dynamiska lnkaren."
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "Skvg \"%s\" given mer n en gng"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s r inte en knd bibliotekstyp"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "Kan inte ta status p %s"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "Kan inte ta status p %s\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s r inte en symbolisk lnk\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "Kan inte ta bort (unlink) %s"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "Kan inte lnka %s till %s"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (ndrad)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (HOPPAR VER)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "Kan inte hitta %s"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "Kan inte ta lnkstatus p %s"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Ignorerar fil %s eftersom den inte r en vanlig fil"
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "Ingen lnk skapad eftersom \"soname\" inte hittades fr %s"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "Kan inte ppna katalog %s"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "Kan inte ta status (lstat) p %s"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "Kan inte ta status p %s"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "Hittar inte infil %s.\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "libc5-bibliotek %s i fel katalog"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "libc6-bibliotek %s i fel katalog"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "libc4-bibliotek %s i fel katalog"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "bibliotek %s och %s i katalog %s har samma \"soname\" men olika typ."
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "Kan inte ppna konfigurationsfil \"%s\""
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "Kan inte byta katalog till /"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "Kan inte lsa cache-filkatalog \"%s\"\n"
glibc-2.3.2/po/tr.molibc-20030708/po/tr.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/tr.po libc-20030708/po/tr.po
--- glibc-2.3.2/po/tr.po	2002-10-06 03:15:39.000000000 +0900
+++ libc-20030708/po/tr.po	2003-03-04 13:20:34.000000000 +0900
@@ -1,13 +1,13 @@
 # Turkish translations for GNU libc messages.
-# Copyright (C) 2002 Free Software Foundation, Inc.
-# Nilgn Belma Bugner <nilgun@superonline.com>, 2001, 2002.
+# Copyright (C) 2003 Free Software Foundation, Inc.
+# Nilgn Belma Bugner <nilgun@superonline.com>, 2001, ..., 2003.
 # Onur Tolga ehitolu <onur@lcsl.metu.edu.tr>, 1998.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.3\n"
-"POT-Creation-Date: 2002-10-02 17:22-0700\n"
-"PO-Revision-Date: 2002-10-05 17:08+0300\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-03-04 05:51+0200\n"
 "Last-Translator: Nilgn Belma Bugner <nilgun@superonline.com>\n"
 "Language-Team: Turkish <gnu-tr-u12a@lists.sourceforge.net>\n"
 "MIME-Version: 1.0\n"
@@ -261,8 +261,8 @@
 
 #: iconv/iconv_prog.c:241
 #, c-format
-msgid "conversions from `%s' and to `%s' are not supported"
-msgstr "`%s'e ve ondan `%s'e dnm desteklenmiyor"
+msgid "conversion from `%s' and to `%s' are not supported"
+msgstr "`%s'den ve `%s'e dnm desteklenmiyor"
 
 #: iconv/iconv_prog.c:246
 #, c-format
@@ -287,7 +287,7 @@
 msgid "error while closing output file"
 msgstr "kt dosyas kapatlrken hata"
 
-#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:355 locale/programs/locale.c:268
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
 #: locale/programs/localedef.c:372 catgets/gencat.c:233
 #: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
 msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
@@ -296,9 +296,9 @@
 "ise `glibcbug' betiini kullanarak oluturacanz hata raporuyla\n"
 "<bugs@gnu.org> adresine bildiriniz.\n"
 
-#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:369 locale/programs/locale.c:281
-#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:904
-#: nss/getent.c:74 nscd/nscd.c:279 nscd/nscd_nischeck.c:90 elf/ldconfig.c:259
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
 #: elf/sprof.c:349
 #, c-format
 msgid ""
@@ -311,9 +311,9 @@
 "HBR garanti yoktur; hatta SATILABLRL veya AHS KULLANIMINIZA\n"
 "UYGUNLUU iin bile garanti verilmez.\n"
 
-#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:374 locale/programs/locale.c:286
-#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:909
-#: nss/getent.c:79 nscd/nscd.c:284 nscd/nscd_nischeck.c:95 elf/ldconfig.c:264
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
 #: elf/sprof.c:355
 #, c-format
 msgid "Written by %s.\n"
@@ -365,15 +365,15 @@
 msgid "Prefix used for all file accesses"
 msgstr "Tm dosya eriimlerinde kullanlan nek"
 
-#: iconv/iconvconfig.c:325 locale/programs/localedef.c:292
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
 msgid "no output file produced because warning were issued"
 msgstr "uyar yaynlandndan retilen bir kt dosyas yok"
 
-#: iconv/iconvconfig.c:403
+#: iconv/iconvconfig.c:405
 msgid "while inserting in search tree"
 msgstr "arama aacna eklenirken"
 
-#: iconv/iconvconfig.c:1202
+#: iconv/iconvconfig.c:1204
 msgid "cannot generate output file"
 msgstr "kt dosyas retilemiyor"
 
@@ -1283,7 +1283,7 @@
 msgid "unterminated symbolic name"
 msgstr "sonlandrlmam sembolik isim"
 
-#: locale/programs/linereader.c:537 catgets/gencat.c:1166
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
 msgid "invalid escape sequence"
 msgstr "geersiz escape dizisi"
 
@@ -1313,39 +1313,39 @@
 msgid "trailing garbage at end of line"
 msgstr "satr sonu bozuk"
 
-#: locale/programs/locale.c:73
+#: locale/programs/locale.c:75
 msgid "System information:"
 msgstr "Sistem bilgileri:"
 
-#: locale/programs/locale.c:75
+#: locale/programs/locale.c:77
 msgid "Write names of available locales"
 msgstr "Mevcut yerellerin isimlerini yazar"
 
-#: locale/programs/locale.c:77
+#: locale/programs/locale.c:79
 msgid "Write names of available charmaps"
 msgstr "Mevcut karakter elemlerin isimlerini yazar"
 
-#: locale/programs/locale.c:78
+#: locale/programs/locale.c:80
 msgid "Modify output format:"
 msgstr "Deitirme kt biemi:"
 
-#: locale/programs/locale.c:79
+#: locale/programs/locale.c:81
 msgid "Write names of selected categories"
 msgstr "Seilmi kategorilerin isimlerini yazar"
 
-#: locale/programs/locale.c:80
+#: locale/programs/locale.c:82
 msgid "Write names of selected keywords"
 msgstr "Seilmi anahtar kelimelerin isimlerini yazar"
 
-#: locale/programs/locale.c:81
+#: locale/programs/locale.c:83
 msgid "Print more information"
 msgstr "Daha fazla ileti basar"
 
-#: locale/programs/locale.c:86
+#: locale/programs/locale.c:88
 msgid "Get locale-specific information."
 msgstr "Dile zel bilgiler alnr"
 
-#: locale/programs/locale.c:89
+#: locale/programs/locale.c:91
 msgid ""
 "NAME\n"
 "[-a|-m]"
@@ -1353,7 +1353,7 @@
 "SM\n"
 "[-a|-m]"
 
-#: locale/programs/locale.c:488
+#: locale/programs/locale.c:512
 msgid "while preparing output"
 msgstr "kty hazrlarken"
 
@@ -1484,16 +1484,16 @@
 msgid "cannot create temporary file"
 msgstr "geici dosya oluturulamyor"
 
-#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:302
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
 msgid "cannot initialize archive file"
 msgstr "ariv dosyas ilklendirilemiyor"
 
-#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:309
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
 msgid "cannot resize archive file"
 msgstr "ariv dosyasnn boyutu deitirilemiyor"
 
-#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:318
-#: locale/programs/locarchive.c:508
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
 msgid "cannot map archive header"
 msgstr "ariv bal elenemiyor"
 
@@ -1509,88 +1509,88 @@
 msgid "cannot map locale archive file"
 msgstr "yerel ariv dosyas elenemiyor"
 
-#: locale/programs/locarchive.c:326
+#: locale/programs/locarchive.c:329
 msgid "cannot lock new archive"
 msgstr "yeni ariv kilitlenemiyor"
 
-#: locale/programs/locarchive.c:377
+#: locale/programs/locarchive.c:380
 msgid "cannot extend locale archive file"
 msgstr "yerel ariv dosyas geniletilemiyor"
 
-#: locale/programs/locarchive.c:386
+#: locale/programs/locarchive.c:389
 msgid "cannot change mode of resized locale archive"
 msgstr "boyutu deitirilen yerel arivin kipi deitirilemiyor"
 
-#: locale/programs/locarchive.c:394
+#: locale/programs/locarchive.c:397
 msgid "cannot rename new archive"
 msgstr "yeni arivin ismi deitirilemiyor"
 
-#: locale/programs/locarchive.c:447
+#: locale/programs/locarchive.c:450
 #, c-format
 msgid "cannot open locale archive \"%s\""
 msgstr "yerel ariv `%s' alamyor"
 
-#: locale/programs/locarchive.c:452
+#: locale/programs/locarchive.c:455
 #, c-format
 msgid "cannot stat locale archive \"%s\""
 msgstr "\"%s\" yerel arivi durumlanamyor"
 
-#: locale/programs/locarchive.c:471
+#: locale/programs/locarchive.c:474
 #, c-format
 msgid "cannot lock locale archive \"%s\""
 msgstr "\"%s\" yerel arivi kilitlenemiyor"
 
-#: locale/programs/locarchive.c:494
+#: locale/programs/locarchive.c:497
 msgid "cannot read archive header"
 msgstr "ariv bal okunamyor"
 
-#: locale/programs/locarchive.c:554
+#: locale/programs/locarchive.c:557
 #, c-format
 msgid "locale '%s' already exists"
 msgstr "`%s' yereli zaten var"
 
-#: locale/programs/locarchive.c:784 locale/programs/locarchive.c:799
-#: locale/programs/locarchive.c:811 locale/programs/locarchive.c:823
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
 #: locale/programs/locfile.c:343
 msgid "cannot add to locale archive"
 msgstr "yerel arive ekleme yaplamyor"
 
-#: locale/programs/locarchive.c:976
+#: locale/programs/locarchive.c:982
 #, c-format
 msgid "locale alias file `%s' not found"
 msgstr "`%s' yerel isim dosyas bulunamad"
 
-#: locale/programs/locarchive.c:1118
+#: locale/programs/locarchive.c:1126
 #, c-format
 msgid "Adding %s\n"
 msgstr "%s ekleniyor\n"
 
-#: locale/programs/locarchive.c:1124
+#: locale/programs/locarchive.c:1132
 #, c-format
 msgid "stat of \"%s\" failed: %s: ignored"
 msgstr "\"%s\" durumlamas baarsz: %s: yoksayld"
 
-#: locale/programs/locarchive.c:1130
+#: locale/programs/locarchive.c:1138
 #, c-format
 msgid "\"%s\" is no directory; ignored"
 msgstr "\"%s\" dizinsiz; yoksayld"
 
-#: locale/programs/locarchive.c:1137
+#: locale/programs/locarchive.c:1145
 #, c-format
 msgid "cannot open directory \"%s\": %s: ignored"
 msgstr "\"%s\" dizini alamyor: %s: yoksayld"
 
-#: locale/programs/locarchive.c:1209
+#: locale/programs/locarchive.c:1217
 #, c-format
 msgid "incomplete set of locale files in \"%s\""
 msgstr "\"%s\" iindeki yerel dosyalar kmesi tamamlanmam"
 
-#: locale/programs/locarchive.c:1273
+#: locale/programs/locarchive.c:1281
 #, c-format
 msgid "cannot read all files in \"%s\": ignored"
 msgstr "\"%s\" iindeki hibir dosya okunamyor: yoksayld"
 
-#: locale/programs/locarchive.c:1343
+#: locale/programs/locarchive.c:1351
 #, c-format
 msgid "locale \"%s\" not in archive"
 msgstr "\"%s\" yeri arivde deil"
@@ -1659,8 +1659,8 @@
 msgid "upper limit in range is not smaller then lower limit"
 msgstr "kapsamdaki st snr alt snrdan kk deil"
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:500 malloc/obstack.c:503
-#: posix/getconf.c:996
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
 msgid "memory exhausted"
 msgstr "bellek tkendi"
 
@@ -1686,7 +1686,7 @@
 msgid "Another string for testing."
 msgstr "Test edilecek dier dizge."
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:79
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
 msgid "NAME"
 msgstr "SM"
 
@@ -1708,7 +1708,7 @@
 "Generate message catalog.If INPUT-FILE is -, input is read from standard input.  If OUTPUT-FILE\n"
 "is -, output is written to standard output.\n"
 msgstr ""
-"leti katalou retilir.GRD-DOSYASI - verilirse standart girdi okunur.\n"
+"leti katalou retilir. GRD-DOSYASI - verilirse standart girdi okunur.\n"
 "IKTI-DOSYASI - verilirse standart ktya yazlr.\n"
 
 #: catgets/gencat.c:125
@@ -1731,7 +1731,7 @@
 msgid "duplicate set definition"
 msgstr "kme atamas tekrarlanm"
 
-#: catgets/gencat.c:446 catgets/gencat.c:619 catgets/gencat.c:648
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
 msgid "this is the first definition"
 msgstr "bu ilk tanm"
 
@@ -1749,44 +1749,44 @@
 msgid "unknown directive `%s': line ignored"
 msgstr "bilinmeyen `%s' ynergesi: satr yoksayld"
 
-#: catgets/gencat.c:617
+#: catgets/gencat.c:621
 msgid "duplicated message number"
 msgstr "tekrarlanm ileti numaras"
 
-#: catgets/gencat.c:645
+#: catgets/gencat.c:674
 msgid "duplicated message identifier"
 msgstr "ileti tantc tekrarlanm"
 
-#: catgets/gencat.c:702
+#: catgets/gencat.c:731
 msgid "invalid character: message ignored"
 msgstr "geersiz karakter: ileti yoksayld"
 
-#: catgets/gencat.c:745
+#: catgets/gencat.c:774
 msgid "invalid line"
 msgstr "satr geersiz"
 
-#: catgets/gencat.c:799
+#: catgets/gencat.c:828
 msgid "malformed line ignored"
 msgstr "hatal satr yoksayld"
 
-#: catgets/gencat.c:963 catgets/gencat.c:1004
+#: catgets/gencat.c:992 catgets/gencat.c:1033
 #, c-format
 msgid "cannot open output file `%s'"
 msgstr "`%s' kt dosyas alamyor"
 
-#: catgets/gencat.c:1188
+#: catgets/gencat.c:1217
 msgid "unterminated message"
 msgstr "sonlandrlmam ileti"
 
-#: catgets/gencat.c:1212
+#: catgets/gencat.c:1241
 msgid "while opening old catalog file"
 msgstr "eski katalog dosyas alrken"
 
-#: catgets/gencat.c:1303
+#: catgets/gencat.c:1332
 msgid "conversion modules not available"
 msgstr "dnm modlleri yok"
 
-#: catgets/gencat.c:1329
+#: catgets/gencat.c:1358
 msgid "cannot determine escape character"
 msgstr "ncelem karakteri saptanamyor"
 
@@ -1794,7 +1794,7 @@
 msgid "makecontext: does not know how to handle more than 8 arguments\n"
 msgstr "makecontext: 8 argmandan fazlasnn nasl elde edilecei bilinmiyor\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:178
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
 #: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
 msgid "Success"
 msgstr "Baarl"
@@ -2983,23 +2983,23 @@
 msgid "%s%sUnknown signal %d\n"
 msgstr "%s%sBilinmeyen sinyal %d\n"
 
-#: malloc/mcheck.c:296
+#: malloc/mcheck.c:346
 msgid "memory is consistent, library is buggy\n"
 msgstr "bellek tutarl, kitaplk hatal\n"
 
-#: malloc/mcheck.c:299
+#: malloc/mcheck.c:349
 msgid "memory clobbered before allocated block\n"
 msgstr "bellek ayrlm bloun ncesine tat\n"
 
-#: malloc/mcheck.c:302
+#: malloc/mcheck.c:352
 msgid "memory clobbered past end of allocated block\n"
 msgstr "bellek ayrlm bloun sonrasna tat\n"
 
-#: malloc/mcheck.c:305
+#: malloc/mcheck.c:355
 msgid "block freed twice\n"
 msgstr "blok iki kere serbest brakld\n"
 
-#: malloc/mcheck.c:308
+#: malloc/mcheck.c:358
 msgid "bogus mcheck_status, library is buggy\n"
 msgstr "mcheck_status sahte, kitaplk hatal\n"
 
@@ -3037,6 +3037,10 @@
 msgid "DATAFILE [OUTFILE]"
 msgstr "VERDOSYASI [IKTIDOSYASI]"
 
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr "Bilinmeyen hata"
+
 #: string/strsignal.c:69
 #, c-format
 msgid "Real-time signal %d"
@@ -3061,7 +3065,7 @@
 msgid "%s: Memory exhausted: %s\n"
 msgstr "%s: Bellek tkendi: %s\n"
 
-#: timezone/zic.c:390 misc/error.c:120
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
 msgid "Unknown system error"
 msgstr "Bilinmeyen sistem hatas"
 
@@ -3454,25 +3458,21 @@
 msgid "Interrupted by a signal"
 msgstr "Bir sinyal ile engellendi"
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr "Bilinmeyen hata"
-
-#: posix/getconf.c:883
+#: posix/getconf.c:889
 #, c-format
 msgid "Usage: %s [-v specification] variable_name [pathname]\n"
 msgstr "Kullanm: %s [-v zellik] deiken_ismi [dosyayolu_ismi]\n"
 
-#: posix/getconf.c:941
+#: posix/getconf.c:947
 #, c-format
 msgid "unknown specification \"%s\""
 msgstr "zellik \"%s\" bilinmiyor"
 
-#: posix/getconf.c:968 posix/getconf.c:984
+#: posix/getconf.c:974 posix/getconf.c:990
 msgid "undefined"
 msgstr "atanmam"
 
-#: posix/getconf.c:1006
+#: posix/getconf.c:1012
 #, c-format
 msgid "Unrecognized variable `%s'"
 msgstr "Tannmayan deiken `%s'"
@@ -3534,71 +3534,71 @@
 msgid "%s: option `-W %s' doesn't allow an argument\n"
 msgstr "%s: `-W %s' seenei argmansz kullanlr\n"
 
-#: posix/regcomp.c:181
+#: posix/regcomp.c:136
 msgid "No match"
 msgstr "Eleme yok"
 
-#: posix/regcomp.c:184
+#: posix/regcomp.c:139
 msgid "Invalid regular expression"
 msgstr "Dzenli ifade geersiz"
 
-#: posix/regcomp.c:187
+#: posix/regcomp.c:142
 msgid "Invalid collation character"
 msgstr "Karlatrma karakteri geersiz"
 
-#: posix/regcomp.c:190
+#: posix/regcomp.c:145
 msgid "Invalid character class name"
 msgstr "Geersiz karakter snf ismi"
 
-#: posix/regcomp.c:193
+#: posix/regcomp.c:148
 msgid "Trailing backslash"
 msgstr "zleyen tersbl"
 
-#: posix/regcomp.c:196
+#: posix/regcomp.c:151
 msgid "Invalid back reference"
 msgstr "Geriye bavuru geersiz"
 
-#: posix/regcomp.c:199
+#: posix/regcomp.c:154
 msgid "Unmatched [ or [^"
 msgstr "[ ya da [^ elemiyor"
 
-#: posix/regcomp.c:202
+#: posix/regcomp.c:157
 msgid "Unmatched ( or \\("
 msgstr "( ya da \\( elemiyor"
 
-#: posix/regcomp.c:205
+#: posix/regcomp.c:160
 msgid "Unmatched \\{"
 msgstr "\\{ elemiyor"
 
-#: posix/regcomp.c:208
+#: posix/regcomp.c:163
 msgid "Invalid content of \\{\\}"
 msgstr "\\{\\} ierii geersiz"
 
-#: posix/regcomp.c:211
+#: posix/regcomp.c:166
 msgid "Invalid range end"
 msgstr "Geersiz kapsam sonu"
 
-#: posix/regcomp.c:214
+#: posix/regcomp.c:169
 msgid "Memory exhausted"
 msgstr "Bellek tkendi"
 
-#: posix/regcomp.c:217
+#: posix/regcomp.c:172
 msgid "Invalid preceding regular expression"
 msgstr "nceleme dzenli ifadesi geersiz"
 
-#: posix/regcomp.c:220
+#: posix/regcomp.c:175
 msgid "Premature end of regular expression"
 msgstr "Dzenli ifadenin sonu eksik"
 
-#: posix/regcomp.c:223
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr "Dzenli ifade ok byk"
 
-#: posix/regcomp.c:226
+#: posix/regcomp.c:181
 msgid "Unmatched ) or \\)"
 msgstr ") ya da  \\) elemiyor"
 
-#: posix/regcomp.c:673
+#: posix/regcomp.c:615
 msgid "No previous regular expression"
 msgstr "nceki dzenli ifade yok"
 
@@ -3754,24 +3754,24 @@
 msgid "Service configuration to be used"
 msgstr "Kullanlacak yaplandrmay hizmete alr"
 
-#: nss/getent.c:136 nss/getent.c:305
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
 msgid "Enumeration not supported on %s\n"
 msgstr "Numaralama %s ile desteklenmiyor\n"
 
-#: nss/getent.c:729
+#: nss/getent.c:732
 msgid "getent - get entries from administrative database."
 msgstr "getent - ynetim veritabanndan girdiler alnyor."
 
-#: nss/getent.c:730
+#: nss/getent.c:733
 msgid "Supported databases:"
 msgstr "Desteklenen veritabanlar:"
 
-#: nss/getent.c:787 nscd/nscd.c:119 nscd/nscd_nischeck.c:64
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
 msgid "wrong number of arguments"
 msgstr "argman says hatal"
 
-#: nss/getent.c:797
+#: nss/getent.c:800
 #, c-format
 msgid "Unknown database: %s\n"
 msgstr "Bilinmeyen veritaban: %s\n"
@@ -3800,68 +3800,72 @@
 msgid "invalid pointer size"
 msgstr "imleyici uzunluu geersiz"
 
-#: inet/rcmd.c:174 inet/rcmd.c:177
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd: Bellek ayrlamad\n"
+
+#: inet/rcmd.c:185 inet/rcmd.c:188
 msgid "rcmd: socket: All ports in use\n"
 msgstr "rcmd: soket: Tm portlar kullanmda\n"
 
-#: inet/rcmd.c:211
+#: inet/rcmd.c:222
 #, c-format
 msgid "connect to address %s: "
 msgstr "%s adresine balant:"
 
-#: inet/rcmd.c:229
+#: inet/rcmd.c:240
 #, c-format
 msgid "Trying %s...\n"
 msgstr "%s deneniyor...\n"
 
-#: inet/rcmd.c:278
+#: inet/rcmd.c:289
 #, c-format
 msgid "rcmd: write (setting up stderr): %m\n"
 msgstr "rcmd: write (stderr ayarlamas): %m\n"
 
-#: inet/rcmd.c:299
+#: inet/rcmd.c:310
 #, c-format
 msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr "rcmd: poll (stderr ayarlamas): %m\n"
 
-#: inet/rcmd.c:302
+#: inet/rcmd.c:313
 msgid "poll: protocol failure in circuit setup\n"
 msgstr "poll: devre ayarnda protokol hatas\n"
 
-#: inet/rcmd.c:346
+#: inet/rcmd.c:358
 msgid "socket: protocol failure in circuit setup\n"
 msgstr "soket: devre ayarnda protokol hatas\n"
 
-#: inet/rcmd.c:368
+#: inet/rcmd.c:387
 #, c-format
 msgid "rcmd: %s: short read"
 msgstr "rcmd: %s: ksa okuma"
 
-#: inet/rcmd.c:524
+#: inet/rcmd.c:549
 msgid "lstat failed"
 msgstr "lstat baarsz"
 
-#: inet/rcmd.c:526
+#: inet/rcmd.c:551
 msgid "not regular file"
 msgstr "dzenli dosya deil"
 
-#: inet/rcmd.c:531
+#: inet/rcmd.c:556
 msgid "cannot open"
 msgstr "alamyor"
 
-#: inet/rcmd.c:533
+#: inet/rcmd.c:558
 msgid "fstat failed"
 msgstr "fstat baarsz"
 
-#: inet/rcmd.c:535
+#: inet/rcmd.c:560
 msgid "bad owner"
 msgstr "Sahip hatal"
 
-#: inet/rcmd.c:537
+#: inet/rcmd.c:562
 msgid "writeable by other than owner"
 msgstr "sahibinden bakas yazabilir"
 
-#: inet/rcmd.c:539
+#: inet/rcmd.c:564
 msgid "hard linked somewhere"
 msgstr "bir yere sabit bal"
 
@@ -4072,109 +4076,109 @@
 msgid "Cannot receive reply to broadcast"
 msgstr "yayndan yant alnamyor"
 
-#: sunrpc/rpc_main.c:289
+#: sunrpc/rpc_main.c:288
 #, c-format
 msgid "%s: output would overwrite %s\n"
 msgstr "%s: kt %s zerine yazacak\n"
 
-#: sunrpc/rpc_main.c:296
+#: sunrpc/rpc_main.c:295
 #, c-format
 msgid "%s: unable to open %s: %m\n"
 msgstr "%s: %s dosyasn amak mmkn deil: %m\n"
 
-#: sunrpc/rpc_main.c:308
+#: sunrpc/rpc_main.c:307
 #, c-format
 msgid "%s: while writing output %s: %m"
 msgstr "%s: %s ktsn yazarken: %m"
 
-#: sunrpc/rpc_main.c:343
+#: sunrpc/rpc_main.c:342
 #, c-format
 msgid "cannot find C preprocessor: %s \n"
 msgstr "C n ilemci bulunamyor: %s \n"
 
-#: sunrpc/rpc_main.c:351
+#: sunrpc/rpc_main.c:350
 msgid "cannot find any C preprocessor (cpp)\n"
 msgstr "hi C n ilemci (cpp) bulunamad\n"
 
-#: sunrpc/rpc_main.c:420
+#: sunrpc/rpc_main.c:419
 #, c-format
 msgid "%s: C preprocessor failed with signal %d\n"
 msgstr "%s: C nilemcisi %d sinyali vererek baarsz oldu\n"
 
-#: sunrpc/rpc_main.c:423
+#: sunrpc/rpc_main.c:422
 #, c-format
 msgid "%s: C preprocessor failed with exit code %d\n"
 msgstr "%s: C nilemcisi %d k kodu vererek baarsz oldu\n"
 
-#: sunrpc/rpc_main.c:463
+#: sunrpc/rpc_main.c:462
 #, c-format
 msgid "illegal nettype :`%s'\n"
 msgstr "kurald a tr: `%s'\n"
 
-#: sunrpc/rpc_main.c:1105
+#: sunrpc/rpc_main.c:1104
 msgid "rpcgen: too many defines\n"
 msgstr "rpcgen: ok fazla atama\n"
 
-#: sunrpc/rpc_main.c:1117
+#: sunrpc/rpc_main.c:1116
 msgid "rpcgen: arglist coding error\n"
 msgstr "rpcgen: argman listesi kodlama hatas\n"
 
 #. TRANS: the file will not be removed; this is an
 #. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: sunrpc/rpc_main.c:1149
 #, c-format
 msgid "file `%s' already exists and may be overwritten\n"
 msgstr "`%s' dosyas zaten var ve zerine yazlabilir\n"
 
-#: sunrpc/rpc_main.c:1195
+#: sunrpc/rpc_main.c:1194
 msgid "Cannot specify more than one input file!\n"
 msgstr "Bir girdi dosyasndan fazlas belirtilemez!\n"
 
-#: sunrpc/rpc_main.c:1365
+#: sunrpc/rpc_main.c:1364
 msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr "Bu tamamlama yenibiimi ya da MT-safe kodu desteklemez!\n"
 
-#: sunrpc/rpc_main.c:1374
+#: sunrpc/rpc_main.c:1373
 msgid "Cannot use netid flag with inetd flag!\n"
 msgstr "AKimlik flamas inetd flamas ile kullanlamaz!\n"
 
-#: sunrpc/rpc_main.c:1386
+#: sunrpc/rpc_main.c:1385
 msgid "Cannot use netid flag without TIRPC!\n"
 msgstr "AKimlik flamas TIRPC olmakszn kullanlamaz!\n"
 
-#: sunrpc/rpc_main.c:1393
+#: sunrpc/rpc_main.c:1392
 msgid "Cannot use table flags with newstyle!\n"
 msgstr "Tablo flamalar yenibiimle kullanlamaz!\n"
 
-#: sunrpc/rpc_main.c:1412
+#: sunrpc/rpc_main.c:1411
 msgid "\"infile\" is required for template generation flags.\n"
 msgstr "\"girdiDosyas\" ablon retim flamalar iin gerekli.\n"
 
-#: sunrpc/rpc_main.c:1417
+#: sunrpc/rpc_main.c:1416
 msgid "Cannot have more than one file generation flag!\n"
 msgstr "Birden fazla dosya retim flamas olamaz!?\n"
 
-#: sunrpc/rpc_main.c:1426
+#: sunrpc/rpc_main.c:1425
 #, c-format
 msgid "usage: %s infile\n"
 msgstr "kullanm: %s girdi-dosyas\n"
 
-#: sunrpc/rpc_main.c:1427
+#: sunrpc/rpc_main.c:1426
 #, c-format
 msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
 msgstr "\t%s [-abkCLNTM][-Disim[=deer]] [-i boyut] [-I [-K saniye]] [-Y dosyaYolu] girdiDosyas\n"
 
-#: sunrpc/rpc_main.c:1429
+#: sunrpc/rpc_main.c:1428
 #, c-format
 msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
 msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o ktDosyas] [girdiDosyas]\n"
 
-#: sunrpc/rpc_main.c:1431
+#: sunrpc/rpc_main.c:1430
 #, c-format
 msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
 msgstr "\t%s [-s aTr]* [-o ktDosyas] [girdiDosyas]\n"
 
-#: sunrpc/rpc_main.c:1432
+#: sunrpc/rpc_main.c:1431
 #, c-format
 msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
 msgstr "\t%s [-n aKimlik]* [-o ktDosyas] [girdiDosyas]\n"
@@ -5031,7 +5035,7 @@
 msgid "while allocating hash table entry"
 msgstr "arama (hash) tablosu girdisi ayrlrken"
 
-#: nscd/cache.c:150 nscd/connections.c:185
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
 msgid "cannot stat() file `%s': %s"
 msgstr "`%s' dosyas stat() olamyor: %s"
@@ -5044,153 +5048,158 @@
 msgid "Cannot run nscd in secure mode as unprivileged user"
 msgstr "nscd gvenli kipte yetkisiz kullanc olarak altrlamaz"
 
-#: nscd/connections.c:199
+#: nscd/connections.c:175
+#, c-format
+msgid "while allocating cache: %s"
+msgstr "arabellek girdisi ayrlrken: %s"
+
+#: nscd/connections.c:200
 #, c-format
 msgid "cannot open socket: %s"
 msgstr "soket alamyor: %s"
 
-#: nscd/connections.c:217
+#: nscd/connections.c:218
 #, c-format
 msgid "cannot enable socket to accept connections: %s"
 msgstr "balantlar kabul etmek zere soket etkinletirilemiyor: %s"
 
-#: nscd/connections.c:259
+#: nscd/connections.c:260
 #, c-format
 msgid "handle_request: request received (Version = %d)"
 msgstr "handle_request: istek alnd (Srm = %d)"
 
-#: nscd/connections.c:265
+#: nscd/connections.c:266
 #, c-format
 msgid "cannot handle old request version %d; current version is %d"
 msgstr "eski istem srm %d elde edilemedi; mevcut srm %d"
 
-#: nscd/connections.c:303 nscd/connections.c:325
+#: nscd/connections.c:304 nscd/connections.c:326
 #, c-format
 msgid "cannot write result: %s"
 msgstr "sonu yazlamyor: %s"
 
-#: nscd/connections.c:404 nscd/connections.c:498
+#: nscd/connections.c:405 nscd/connections.c:499
 #, c-format
 msgid "error getting callers id: %s"
 msgstr "arc kimlii alnrken hata: %s"
 
-#: nscd/connections.c:470
+#: nscd/connections.c:471
 #, c-format
 msgid "while accepting connection: %s"
 msgstr "balant kabul edilirken: %s"
 
-#: nscd/connections.c:481
+#: nscd/connections.c:482
 #, c-format
 msgid "short read while reading request: %s"
 msgstr "istenen okuma ksa: %s"
 
-#: nscd/connections.c:517
+#: nscd/connections.c:518
 #, c-format
 msgid "key length in request too long: %d"
 msgstr "istenen anahtar uzunluu fazla: %d"
 
-#: nscd/connections.c:531
+#: nscd/connections.c:532
 #, c-format
 msgid "short read while reading request key: %s"
 msgstr "istenen tu okunurken ksa okuma: %s"
 
-#: nscd/connections.c:590 nscd/connections.c:591 nscd/connections.c:610
-#: nscd/connections.c:623 nscd/connections.c:629 nscd/connections.c:636
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
 #, c-format
 msgid "Failed to run nscd as user '%s'"
 msgstr "nscd '%s' kullancs olarak altrlamad"
 
-#: nscd/connections.c:611
+#: nscd/connections.c:612
 msgid "getgrouplist failed"
 msgstr "getgrouplist baarsz"
 
-#: nscd/connections.c:624
+#: nscd/connections.c:625
 msgid "setgroups failed"
 msgstr "setgroups baarsz"
 
-#: nscd/grpcache.c:102 nscd/hstcache.c:110 nscd/pwdcache.c:108
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
 msgid "while allocating key copy"
 msgstr "tu kopyas ayrlrken"
 
-#: nscd/grpcache.c:152 nscd/hstcache.c:167 nscd/pwdcache.c:145
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
 msgid "while allocating cache entry"
 msgstr "arabellek girdisi ayrlrken"
 
-#: nscd/grpcache.c:195 nscd/hstcache.c:281 nscd/pwdcache.c:191
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
 msgid "short write in %s: %s"
 msgstr "%s iinde ksa yazma: %s"
 
-#: nscd/grpcache.c:217
+#: nscd/grpcache.c:218
 #, c-format
 msgid "Haven't found \"%s\" in group cache!"
 msgstr "\"%s\" grup arabelleinde yok!"
 
-#: nscd/grpcache.c:292
+#: nscd/grpcache.c:284
 #, c-format
 msgid "Invalid numeric gid \"%s\"!"
 msgstr "\"%s\" grup numaras geersiz!"
 
-#: nscd/grpcache.c:299
+#: nscd/grpcache.c:291
 #, c-format
 msgid "Haven't found \"%d\" in group cache!"
 msgstr "\"%d\" grup arabelleinde yok!"
 
-#: nscd/hstcache.c:303 nscd/hstcache.c:378 nscd/hstcache.c:456
-#: nscd/hstcache.c:533
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
 msgid "Haven't found \"%s\" in hosts cache!"
 msgstr "\"%s\" makinalar arabelleinde yok!"
 
-#: nscd/nscd.c:80
+#: nscd/nscd.c:85
 msgid "Read configuration data from NAME"
 msgstr "Yaplandrma verisini SM den okur"
 
-#: nscd/nscd.c:82
+#: nscd/nscd.c:87
 msgid "Do not fork and display messages on the current tty"
 msgstr "zerinde allan tty de iletiler ayrlmaz ve gsterilir"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "NUMBER"
 msgstr "SAYI"
 
-#: nscd/nscd.c:83
+#: nscd/nscd.c:88
 msgid "Start NUMBER threads"
 msgstr "SAYIl balklar balatr"
 
-#: nscd/nscd.c:84
+#: nscd/nscd.c:89
 msgid "Shut the server down"
 msgstr "Sunucuyu indirir"
 
-#: nscd/nscd.c:85
+#: nscd/nscd.c:90
 msgid "Print current configuration statistic"
 msgstr "u anki yaplandrma istatistiklerini basar"
 
-#: nscd/nscd.c:86
+#: nscd/nscd.c:91
 msgid "TABLE"
 msgstr "TABLO"
 
-#: nscd/nscd.c:87
+#: nscd/nscd.c:92
 msgid "Invalidate the specified cache"
 msgstr "Belirtilen arabellek geersiz klnd"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "TABLE,yes"
 msgstr "TABLO,evet"
 
-#: nscd/nscd.c:88
+#: nscd/nscd.c:93
 msgid "Use separate cache for each user"
 msgstr "Her kullanc iin ayr arabellek kullanlr"
 
-#: nscd/nscd.c:93
+#: nscd/nscd.c:98
 msgid "Name Service Cache Daemon."
 msgstr "Name Service Cache Daemon."
 
-#: nscd/nscd.c:126
+#: nscd/nscd.c:131
 msgid "already running"
 msgstr "Zaten alyor"
 
-#: nscd/nscd.c:192 nscd/nscd.c:212 nscd/nscd.c:218
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
 msgid "Only root is allowed to use this option!"
 msgstr "Bu seenek sadece root tarafndan kullanlabilir!"
 
@@ -5280,22 +5289,22 @@
 "%15ld%% arabellekleme oran\n"
 "      /etc/%s'deki deiiklikler iin %15s kontrol uyguland\n"
 
-#: nscd/pwdcache.c:213
+#: nscd/pwdcache.c:214
 #, c-format
 msgid "Haven't found \"%s\" in password cache!"
 msgstr "\"%s\" parola arabelleinde yok!"
 
-#: nscd/pwdcache.c:288
+#: nscd/pwdcache.c:280
 #, c-format
 msgid "Invalid numeric uid \"%s\"!"
 msgstr "\"%s\" kullanc numaras geersiz!"
 
-#: nscd/pwdcache.c:295
+#: nscd/pwdcache.c:287
 #, c-format
 msgid "Haven't found \"%d\" in password cache!"
 msgstr "\"%d\" parola arabelleinde yok!"
 
-#: elf/../sysdeps/generic/dl-sysdep.c:297
+#: elf/../sysdeps/generic/dl-sysdep.c:357
 msgid "cannot create capability list"
 msgstr "yetenek listesi oluturulamyor"
 
@@ -5346,7 +5355,7 @@
 msgid ", OS ABI: %s %d.%d.%d"
 msgstr ", OS ABI: %s %d.%d.%d"
 
-#: elf/cache.c:136 elf/ldconfig.c:1033
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
 msgid "Can't open cache file %s\n"
 msgstr "Arabellek dosyas %s alamyor\n"
@@ -5392,15 +5401,15 @@
 msgid "Renaming of %s to %s failed"
 msgstr "%s'in ismi %s olarak deitirilemedi"
 
-#: elf/dl-close.c:113
+#: elf/dl-close.c:128
 msgid "shared object not open"
 msgstr "paylaml nesne ak deil"
 
-#: elf/dl-close.c:357 elf/dl-open.c:436
+#: elf/dl-close.c:486 elf/dl-open.c:444
 msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr "TLS retecinin sayac baa dnd! Ltfen 'glibcbug' betiini kullanarak bir hata raporu gnderin."
 
-#: elf/dl-deps.c:111 elf/dl-open.c:177
+#: elf/dl-deps.c:111 elf/dl-open.c:183
 msgid "DST not allowed in SUID/SGID programs"
 msgstr "SUID/SGID programlarda DST'ye izin verilmez"
 
@@ -5417,181 +5426,193 @@
 msgid "cannot allocate dependency list"
 msgstr "bamllk listesi ayrlamad"
 
-#: elf/dl-deps.c:492 elf/dl-deps.c:547
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
 msgid "cannot allocate symbol search list"
 msgstr "sembol arama listesi ayrlamad"
 
-#: elf/dl-deps.c:532
+#: elf/dl-deps.c:534
 msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr "LD_TRACE_PRELINKING'li szgeler destenlenmez"
 
-#: elf/dl-error.c:73
+#: elf/dl-error.c:75
 msgid "DYNAMIC LINKER BUG!!!"
 msgstr "DNAMK BALAYICI HATASI!!!"
 
-#: elf/dl-error.c:106
+#: elf/dl-error.c:108
 msgid "error while loading shared libraries"
 msgstr "paylaml kitaplklar yklenirken hata olutu"
 
-#: elf/dl-load.c:338
+#: elf/dl-load.c:339
 msgid "cannot allocate name record"
 msgstr "isim kayd ayrlamad"
 
-#: elf/dl-load.c:440 elf/dl-load.c:520 elf/dl-load.c:614 elf/dl-load.c:709
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
 msgid "cannot create cache for search path"
 msgstr "dosya arama yolu iin arabellek oluturulamyor"
 
-#: elf/dl-load.c:545
+#: elf/dl-load.c:543
 msgid "cannot create RUNPATH/RPATH copy"
 msgstr "RUNPATH/RPATH kopyas oluturulamyor"
 
-#: elf/dl-load.c:600
+#: elf/dl-load.c:598
 msgid "cannot create search path array"
 msgstr "dosya arama yolu dizisi oluturulamyor"
 
-#: elf/dl-load.c:796
+#: elf/dl-load.c:794
 msgid "cannot stat shared object"
 msgstr "paylaml nesne durumlanamyor"
 
-#: elf/dl-load.c:840
+#: elf/dl-load.c:838
 msgid "cannot open zero fill device"
 msgstr "sfrlar ieren aygt alamaz"
 
-#: elf/dl-load.c:849 elf/dl-load.c:1855
+#: elf/dl-load.c:847 elf/dl-load.c:1902
 msgid "cannot create shared object descriptor"
 msgstr "paylaml nesne tanmlayc oluturulamyor"
 
-#: elf/dl-load.c:868 elf/dl-load.c:1351 elf/dl-load.c:1434
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
 msgid "cannot read file data"
 msgstr "dosya verisi okunamyor"
 
-#: elf/dl-load.c:908
+#: elf/dl-load.c:906
 msgid "ELF load command alignment not page-aligned"
 msgstr "ELF ykleme komutu hizalamas sayfa-hizalamal deil"
 
-#: elf/dl-load.c:915
+#: elf/dl-load.c:913
 msgid "ELF load command address/offset not properly aligned"
 msgstr "ELF ykleme komutu adresi/bavurusu gerei gibi hizalanamyor"
 
-#: elf/dl-load.c:996
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
+msgstr "ilk kanak iin TLS veri yaplar oluturulamyor"
+
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr "TLS verisi alnamyor"
+
+#: elf/dl-load.c:1047
 msgid "failed to map segment from shared object"
 msgstr "para paylaml nesneden eletirilemedi"
 
-#: elf/dl-load.c:1020
+#: elf/dl-load.c:1071
 msgid "cannot dynamically load executable"
 msgstr "altrlabilir dosya dinamik olarak yklenemiyor"
 
-#: elf/dl-load.c:1081
+#: elf/dl-load.c:1132
 msgid "cannot change memory protections"
 msgstr "bellek korumalar deitirilemiyor"
 
-#: elf/dl-load.c:1100
+#: elf/dl-load.c:1151
 msgid "cannot map zero-fill pages"
 msgstr "sfrlar ieren sayfalar eletirilemez"
 
-#: elf/dl-load.c:1118
+#: elf/dl-load.c:1169
 msgid "cannot allocate memory for program header"
 msgstr "uygulama bal iin bellek ayrlamad"
 
-#: elf/dl-load.c:1149
+#: elf/dl-load.c:1200
 msgid "object file has no dynamic section"
 msgstr "nesne dosyasnn dinamik blm yok"
 
-#: elf/dl-load.c:1193
+#: elf/dl-load.c:1240
 msgid "shared object cannot be dlopen()ed"
 msgstr "paylaml nesne dlopen()'lanamyor"
 
-#: elf/dl-load.c:1216
+#: elf/dl-load.c:1263
 msgid "cannot create searchlist"
 msgstr "arama listesi oluturulamyor"
 
-#: elf/dl-load.c:1351
+#: elf/dl-load.c:1398
 msgid "file too short"
 msgstr "dosya ok kk"
 
-#: elf/dl-load.c:1374
+#: elf/dl-load.c:1421
 msgid "invalid ELF header"
 msgstr "ELF bal geersiz"
 
-#: elf/dl-load.c:1383
+#: elf/dl-load.c:1430
 msgid "ELF file data encoding not big-endian"
 msgstr "ELF dosyas verisinin kodlamas en-kymetli-bayt-ilk (big-endian) deil"
 
-#: elf/dl-load.c:1385
+#: elf/dl-load.c:1432
 msgid "ELF file data encoding not little-endian"
 msgstr "ELF dosyas verisinin kodlamas en-kymetli-bayt-son (little-endian) deil"
 
-#: elf/dl-load.c:1389
+#: elf/dl-load.c:1436
 msgid "ELF file version ident does not match current one"
 msgstr "ELF dosyas srm kimlii mevcut biriyle elemiyor"
 
-#: elf/dl-load.c:1393
+#: elf/dl-load.c:1440
 msgid "ELF file OS ABI invalid"
 msgstr "ELF dosyas OS ABI geersiz"
 
-#: elf/dl-load.c:1395
+#: elf/dl-load.c:1442
 msgid "ELF file ABI version invalid"
 msgstr "ELF dosyas ABI srm geersiz"
 
-#: elf/dl-load.c:1398
+#: elf/dl-load.c:1445
 msgid "internal error"
 msgstr "i hata"
 
-#: elf/dl-load.c:1405
+#: elf/dl-load.c:1452
 msgid "ELF file version does not match current one"
 msgstr "ELF dosyas srm mevcut biriyle elemiyor"
 
-#: elf/dl-load.c:1413
+#: elf/dl-load.c:1460
 msgid "ELF file's phentsize not the expected size"
 msgstr "ELF dosyasnn phent uzunluu beklenen uzunlukta deil"
 
-#: elf/dl-load.c:1419
+#: elf/dl-load.c:1466
 msgid "only ET_DYN and ET_EXEC can be loaded"
 msgstr "sadece ET_DYN ve ET_EXEC ykl olabilir"
 
-#: elf/dl-load.c:1870
+#: elf/dl-load.c:1917
 msgid "cannot open shared object file"
 msgstr "paylaml nesne dosyas alamyor"
 
-#: elf/dl-lookup.c:248 elf/dl-lookup.c:413
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
 msgid "relocation error"
 msgstr "yeniden konumlama hatas"
 
-#: elf/dl-open.c:105
+#: elf/dl-open.c:111
 msgid "cannot extend global scope"
 msgstr "genel kapsam geniletilemiyor"
 
-#: elf/dl-open.c:208
+#: elf/dl-open.c:214
 msgid "empty dynamic string token substitution"
 msgstr "bo dinamik dizge simge ikamesi"
 
-#: elf/dl-open.c:345 elf/dl-open.c:356
+#: elf/dl-open.c:351 elf/dl-open.c:362
 msgid "cannot create scope list"
 msgstr "etki alan listesi oluturulamyor"
 
-#: elf/dl-open.c:416
+#: elf/dl-open.c:424
 msgid "cannot create TLS data structures"
 msgstr "TLS veri yaplar oluturulamyor"
 
-#: elf/dl-open.c:478
+#: elf/dl-open.c:486
 msgid "invalid mode for dlopen()"
 msgstr "dlopen() iin kip geersiz"
 
-#: elf/dl-reloc.c:88
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr "paylaml nesne dlopen()'lanamyor: statik TLS bellei ok kk"
+
+#: elf/dl-reloc.c:118
 msgid "cannot make segment writable for relocation"
 msgstr "yeniden konumlama iin para yazlabilir yaplamyor"
 
-#: elf/dl-reloc.c:174
+#: elf/dl-reloc.c:219
 #, c-format
 msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr "%s: profiler %s nesnesinde PLTREL bulamad\n"
 
-#: elf/dl-reloc.c:186
+#: elf/dl-reloc.c:231
 #, c-format
 msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr "%s: %s PLTREL glgelenirken profiler bellekd\n"
 
-#: elf/dl-reloc.c:201
+#: elf/dl-reloc.c:246
 msgid "cannot restore segment prot after reloc"
 msgstr "reloc ileminden sonra prot segman eski haline getirilemedi"
 
@@ -5647,119 +5668,119 @@
 msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr "Dinamik Balaycnn cra Zaman Bantlarn Yaplandrr."
 
-#: elf/ldconfig.c:282
+#: elf/ldconfig.c:294
 #, c-format
 msgid "Path `%s' given more than once"
 msgstr "`%s' dosya yolu birden fazla verilmi"
 
-#: elf/ldconfig.c:326
+#: elf/ldconfig.c:338
 #, c-format
 msgid "%s is not a known library type"
 msgstr "%s bilinen bir kitaplk tr deil"
 
-#: elf/ldconfig.c:344
+#: elf/ldconfig.c:356
 #, c-format
 msgid "Can't stat %s"
 msgstr "stat %s yaplamyor"
 
-#: elf/ldconfig.c:414
+#: elf/ldconfig.c:426
 #, c-format
 msgid "Can't stat %s\n"
 msgstr "stat %s yaplamyor\n"
 
-#: elf/ldconfig.c:424
+#: elf/ldconfig.c:436
 #, c-format
 msgid "%s is not a symbolic link\n"
 msgstr "%s bir sembolik ba deil\n"
 
-#: elf/ldconfig.c:443
+#: elf/ldconfig.c:455
 #, c-format
 msgid "Can't unlink %s"
 msgstr "%s ba kaldrlamad"
 
-#: elf/ldconfig.c:449
+#: elf/ldconfig.c:461
 #, c-format
 msgid "Can't link %s to %s"
 msgstr "%s den %s'e ba yaplamyor"
 
-#: elf/ldconfig.c:455
+#: elf/ldconfig.c:467
 msgid " (changed)\n"
 msgstr " (deiti)\n"
 
-#: elf/ldconfig.c:457
+#: elf/ldconfig.c:469
 msgid " (SKIPPED)\n"
 msgstr " (ATLANDI)\n"
 
-#: elf/ldconfig.c:512
+#: elf/ldconfig.c:524
 #, c-format
 msgid "Can't find %s"
 msgstr "%s bulunamyor"
 
-#: elf/ldconfig.c:528
+#: elf/ldconfig.c:540
 #, c-format
 msgid "Can't lstat %s"
 msgstr "lstat %s yaplamyor"
 
-#: elf/ldconfig.c:535
+#: elf/ldconfig.c:547
 #, c-format
 msgid "Ignored file %s since it is not a regular file."
 msgstr "Normal bir dosya olmadndan %s dosyas yoksayld"
 
-#: elf/ldconfig.c:543
+#: elf/ldconfig.c:555
 #, c-format
 msgid "No link created since soname could not be found for %s"
 msgstr "%s iin kitaplk ismi bulunamadndan ba oluturulmad"
 
-#: elf/ldconfig.c:634
+#: elf/ldconfig.c:646
 #, c-format
 msgid "Can't open directory %s"
 msgstr "%s dizini alamyor"
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:736
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
 #, c-format
 msgid "Cannot lstat %s"
 msgstr "lstat %s yaplamyor"
 
-#: elf/ldconfig.c:701
+#: elf/ldconfig.c:713
 #, c-format
 msgid "Cannot stat %s"
 msgstr "stat %s yaplamyor"
 
-#: elf/ldconfig.c:758 elf/readlib.c:93
+#: elf/ldconfig.c:770 elf/readlib.c:93
 #, c-format
 msgid "Input file %s not found.\n"
 msgstr "Girdi dosyas %s bulunamad.\n"
 
-#: elf/ldconfig.c:792
+#: elf/ldconfig.c:804
 #, c-format
 msgid "libc5 library %s in wrong directory"
 msgstr "libc5 kitapl %s yanl dizinde"
 
-#: elf/ldconfig.c:795
+#: elf/ldconfig.c:807
 #, c-format
 msgid "libc6 library %s in wrong directory"
 msgstr "libc6 kitapl %s yanl dizinde"
 
-#: elf/ldconfig.c:798
+#: elf/ldconfig.c:810
 #, c-format
 msgid "libc4 library %s in wrong directory"
 msgstr "libc4 kitapl %s yanl dizinde"
 
-#: elf/ldconfig.c:825
+#: elf/ldconfig.c:837
 #, c-format
 msgid "libraries %s and %s in directory %s have same soname but different type."
 msgstr "%s ve %s kitaplklar %s dizininde ve ayn isme sahip olduklar halde farkl trde."
 
-#: elf/ldconfig.c:928
+#: elf/ldconfig.c:940
 #, c-format
 msgid "Can't open configuration file %s"
 msgstr "Yaplandrma dosyas %s alamyor"
 
-#: elf/ldconfig.c:1012
+#: elf/ldconfig.c:1024
 msgid "Can't chdir to /"
 msgstr "/ dizinine geilemiyor"
 
-#: elf/ldconfig.c:1054
+#: elf/ldconfig.c:1066
 #, c-format
 msgid "Can't open cache file directory %s\n"
 msgstr "Arabellek dosyasnn dizini %s alamyor\n"
glibc-2.3.2/po/zh_CN.molibc-20030708/po/zh_CN.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/po/zh_CN.po libc-20030708/po/zh_CN.po
--- glibc-2.3.2/po/zh_CN.po	2002-09-24 14:38:27.000000000 +0900
+++ libc-20030708/po/zh_CN.po	2003-06-12 08:54:03.000000000 +0900
@@ -4,4985 +4,5214 @@
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: libc 2.2.5\n"
-"POT-Creation-Date: 2001-08-17 13:03-0700\n"
-"PO-Revision-Date: 2002-09-24 13:13+0800\n"
+"Project-Id-Version: libc 2.3.2\n"
+"POT-Creation-Date: 2003-02-22 15:34-0800\n"
+"PO-Revision-Date: 2003-06-06 15:10+0800\n"
 "Last-Translator: Wang Li <charles@linux.net.cn>\n"
 "Language-Team: Chinese (simplified) <i18n-translation@lists.linux.net.cn>\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=gb2312\n"
 "Content-Transfer-Encoding: 8bit\n"
 
-#: locale/programs/ld-monetary.c:278
-#, c-format
-msgid "\t\t\t\t\t\t\t      %s: value for field `%s' must be in range %d...%d"
-msgstr "\t\t\t\t\t\t\t      %s%s %d...%d "
-
-#: nis/nis_print.c:277
-msgid "\t\tAccess Rights : "
-msgstr "\t\t "
-
-#: nis/nis_print.c:275
-msgid "\t\tAttributes    : "
-msgstr "\t\t     "
-
-#: sunrpc/rpc_main.c:1427
-#, c-format
-msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
-msgstr "\t%s [-abkCLNTM][-D[=]] [-i ] [-I [-K ]] [-Y ] \n"
-
-#: sunrpc/rpc_main.c:1429
-#, c-format
-msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
-msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o ] []\n"
+#: sysdeps/generic/siglist.h:29 stdio-common/../sysdeps/unix/siglist.c:27
+msgid "Hangup"
+msgstr ""
 
-#: sunrpc/rpc_main.c:1432
-#, c-format
-msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
-msgstr "\t%s [-n  id]* [-o ] []\n"
+#: sysdeps/generic/siglist.h:30 stdio-common/../sysdeps/unix/siglist.c:28
+msgid "Interrupt"
+msgstr ""
 
-#: sunrpc/rpc_main.c:1431
-#, c-format
-msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
-msgstr "\t%s [-s ]* [-o ] []\n"
+#: sysdeps/generic/siglist.h:31 stdio-common/../sysdeps/unix/siglist.c:29
+msgid "Quit"
+msgstr ""
 
-#: nis/nis_print.c:239
-msgid "\tAccess rights: "
-msgstr "\t "
+#: sysdeps/generic/siglist.h:32 stdio-common/../sysdeps/unix/siglist.c:30
+msgid "Illegal instruction"
+msgstr ""
 
-#: nis/nis_print.c:297
-#, c-format
-msgid "\tEntry data of type %s\n"
+#: sysdeps/generic/siglist.h:33 stdio-common/../sysdeps/unix/siglist.c:31
+msgid "Trace/breakpoint trap"
 msgstr ""
 
-#: nis/nis_print.c:175
-#, c-format
-msgid "\tName       : %s\n"
-msgstr "\t     %s\n"
+#: sysdeps/generic/siglist.h:34
+msgid "Aborted"
+msgstr ""
 
-#: nis/nis_print.c:176
-msgid "\tPublic Key : "
-msgstr "\t     "
+#: sysdeps/generic/siglist.h:35 stdio-common/../sysdeps/unix/siglist.c:34
+msgid "Floating point exception"
+msgstr ""
 
-#: nis/nis_print.c:238
-#, c-format
-msgid "\tType         : %s\n"
-msgstr "\t     %s\n"
+#: sysdeps/generic/siglist.h:36 stdio-common/../sysdeps/unix/siglist.c:35
+msgid "Killed"
+msgstr ""
 
-#: nis/nis_print.c:205
-#, c-format
-msgid "\tUniversal addresses (%u)\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:37 stdio-common/../sysdeps/unix/siglist.c:36
+msgid "Bus error"
+msgstr ""
 
-#: nis/nis_print.c:273
-#, c-format
-msgid "\t[%d]\tName          : %s\n"
-msgstr "\t[%d]\t       %s\n"
+#: sysdeps/generic/siglist.h:38 stdio-common/../sysdeps/unix/siglist.c:37
+msgid "Segmentation fault"
+msgstr ""
 
-#: nis/nis_print.c:300
-#, c-format
-msgid "\t[%u] - [%u bytes] "
-msgstr "\t[%u] - [%u ] "
+#. TRANS Broken pipe; there is no process reading from the other end of a pipe.
+#. TRANS Every library function that returns this error code also generates a
+#. TRANS @code{SIGPIPE} signal; this signal terminates the program if not handled
+#. TRANS or blocked.  Thus, your program will never actually see @code{EPIPE}
+#. TRANS unless it has handled or blocked @code{SIGPIPE}.
+#: sysdeps/generic/siglist.h:39 stdio-common/../sysdeps/gnu/errlist.c:351
+#: stdio-common/../sysdeps/unix/siglist.c:39
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:62
+msgid "Broken pipe"
+msgstr ""
 
-#: nscd/nscd_stat.c:154
-#, c-format
-msgid ""
-"\n"
-"%s cache:\n"
-"\n"
-"%15s  cache is enabled\n"
-"%15Zd  suggested size\n"
-"%15ld  seconds time to live for positive entries\n"
-"%15ld  seconds time to live for negative entries\n"
-"%15ld  cache hits on positive entries\n"
-"%15ld  cache hits on negative entries\n"
-"%15ld  cache misses on positive entries\n"
-"%15ld  cache misses on negative entries\n"
-"%15ld%% cache hit rate\n"
-"%15s  check /etc/%s for changes\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:40 stdio-common/../sysdeps/unix/siglist.c:40
+msgid "Alarm clock"
+msgstr ""
 
-#: nis/nis_print.c:255
-msgid ""
-"\n"
-"Group Members :\n"
-msgstr ""
-"\n"
-"     \n"
+#: sysdeps/generic/siglist.h:41 stdio-common/../sysdeps/unix/siglist.c:41
+msgid "Terminated"
+msgstr ""
 
-#: nis/nis_print.c:326
-msgid ""
-"\n"
-"Time to Live  : "
+#: sysdeps/generic/siglist.h:42 stdio-common/../sysdeps/unix/siglist.c:42
+msgid "Urgent I/O condition"
 msgstr ""
-"\n"
-" "
-
-#: sunrpc/rpcinfo.c:679
-msgid "       rpcinfo -b prognum versnum\n"
-msgstr "       rpcinfo -b  \n"
-
-#: sunrpc/rpcinfo.c:680
-msgid "       rpcinfo -d prognum versnum\n"
-msgstr "       rpcinfo -d  \n"
 
-#: sunrpc/rpcinfo.c:678
-msgid "       rpcinfo -p [ host ]\n"
-msgstr "       rpcinfo -p [  ]\n"
+#: sysdeps/generic/siglist.h:43 stdio-common/../sysdeps/unix/siglist.c:43
+msgid "Stopped (signal)"
+msgstr " ()"
 
-#: sunrpc/rpcinfo.c:676
-msgid "       rpcinfo [ -n portnum ] -t host prognum [ versnum ]\n"
-msgstr "       rpcinfo [ -n  ] -t   [  ]\n"
+#: sysdeps/generic/siglist.h:44 stdio-common/../sysdeps/unix/siglist.c:44
+msgid "Stopped"
+msgstr ""
 
-#: nscd/nscd_stat.c:146 nscd/nscd_stat.c:148
-msgid "      no"
-msgstr "      "
+#: sysdeps/generic/siglist.h:45 stdio-common/../sysdeps/unix/siglist.c:45
+msgid "Continued"
+msgstr ""
 
-#: nscd/nscd_stat.c:146 nscd/nscd_stat.c:148
-msgid "     yes"
-msgstr "     "
+#: sysdeps/generic/siglist.h:46 stdio-common/../sysdeps/unix/siglist.c:46
+msgid "Child exited"
+msgstr ""
 
-#: nis/nis_print.c:352
-#, c-format
-msgid "    Data Length = %u\n"
-msgstr "     = %u\n"
+#: sysdeps/generic/siglist.h:47 stdio-common/../sysdeps/unix/siglist.c:47
+msgid "Stopped (tty input)"
+msgstr " (tty )"
 
-#: nis/nis_print_group_entry.c:123
-msgid "    Explicit members:\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:48 stdio-common/../sysdeps/unix/siglist.c:48
+msgid "Stopped (tty output)"
+msgstr " (tty )"
 
-#: nis/nis_print_group_entry.c:147 nis/nis_print_group_entry.c:163
-msgid "    Explicit nonmembers:\n"
+#: sysdeps/generic/siglist.h:49 stdio-common/../sysdeps/unix/siglist.c:49
+msgid "I/O possible"
 msgstr ""
 
-#: nis/nis_print_group_entry.c:131
-msgid "    Implicit members:\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:50 stdio-common/../sysdeps/unix/siglist.c:50
+msgid "CPU time limit exceeded"
+msgstr " CPU "
 
-#: nis/nis_print_group_entry.c:155
-msgid "    Implicit nonmembers:\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:51 stdio-common/../sysdeps/unix/siglist.c:51
+msgid "File size limit exceeded"
+msgstr ""
 
-#: nis/nis_print_group_entry.c:128
-msgid "    No explicit members\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:52 stdio-common/../sysdeps/unix/siglist.c:52
+msgid "Virtual timer expired"
+msgstr ""
 
-#: nis/nis_print_group_entry.c:152
-msgid "    No explicit nonmembers\n"
+#: sysdeps/generic/siglist.h:53 stdio-common/../sysdeps/unix/siglist.c:53
+msgid "Profiling timer expired"
 msgstr ""
 
-#: nis/nis_print_group_entry.c:136
-msgid "    No implicit members\n"
+#: sysdeps/generic/siglist.h:54 stdio-common/../sysdeps/unix/siglist.c:54
+msgid "Window changed"
 msgstr ""
 
-#: nis/nis_print_group_entry.c:160
-msgid "    No implicit nonmembers\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:55 stdio-common/../sysdeps/unix/siglist.c:56
+msgid "User defined signal 1"
+msgstr " 1"
 
-#: nis/nis_print_group_entry.c:144
-msgid "    No recursive members\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:56 stdio-common/../sysdeps/unix/siglist.c:57
+msgid "User defined signal 2"
+msgstr " 2"
 
-#: nis/nis_print_group_entry.c:168
-msgid "    No recursive nonmembers\n"
+#: sysdeps/generic/siglist.h:60 stdio-common/../sysdeps/unix/siglist.c:33
+msgid "EMT trap"
 msgstr ""
 
-#: nis/nis_print_group_entry.c:139
-msgid "    Recursive members:\n"
-msgstr ""
+#: sysdeps/generic/siglist.h:63 stdio-common/../sysdeps/unix/siglist.c:38
+msgid "Bad system call"
+msgstr ""
 
-#: sunrpc/rpcinfo.c:574
-msgid "   program vers proto   port\n"
-msgstr "        \n"
+#: sysdeps/generic/siglist.h:66
+msgid "Stack fault"
+msgstr ""
 
-#: argp/argp-help.c:1572
-msgid "  or: "
-msgstr "  "
+#: sysdeps/generic/siglist.h:69
+msgid "Information request"
+msgstr ""
 
-#: elf/ldconfig.c:457
-msgid " (SKIPPED)\n"
-msgstr " ()\n"
+#: sysdeps/generic/siglist.h:71
+msgid "Power failure"
+msgstr ""
 
-#: elf/ldconfig.c:455
-msgid " (changed)\n"
-msgstr " ()\n"
+#: sysdeps/generic/siglist.h:74 stdio-common/../sysdeps/unix/siglist.c:55
+msgid "Resource lost"
+msgstr ""
 
-#: timezone/zic.c:427
-#, c-format
-msgid " (rule from \"%s\", line %d)"
-msgstr ""
+#: sysdeps/mach/hurd/mips/dl-machine.c:68
+#: string/../sysdeps/mach/_strerror.c:57
+msgid "Error in unknown error system: "
+msgstr ""
 
-#: argp/argp-help.c:1584
-msgid " [OPTION...]"
-msgstr " [...]"
+#: sysdeps/mach/hurd/mips/dl-machine.c:83
+#: string/../sysdeps/generic/_strerror.c:44
+#: string/../sysdeps/mach/_strerror.c:87
+msgid "Unknown error "
+msgstr " "
 
-#: timezone/zic.c:424
+#: sysdeps/unix/sysv/linux/lddlibc4.c:64
 #, c-format
-msgid "\"%s\", line %d: %s"
-msgstr "%s %d%s"
+msgid "cannot open `%s'"
+msgstr "%s"
 
-#: timezone/zic.c:989
+#: sysdeps/unix/sysv/linux/lddlibc4.c:68
 #, c-format
-msgid "\"Zone %s\" line and -l option are mutually exclusive"
-msgstr ""
+msgid "cannot read header from `%s'"
+msgstr "%s"
 
-#: timezone/zic.c:997
+#: iconv/iconv_charmap.c:159 iconv/iconv_prog.c:293 catgets/gencat.c:288
 #, c-format
-msgid "\"Zone %s\" line and -p option are mutually exclusive"
-msgstr ""
-
-#: sunrpc/rpc_main.c:1412
-msgid "\"infile\" is required for template generation flags.\n"
-msgstr "\n"
+msgid "cannot open input file `%s'"
+msgstr "%s"
 
-#: argp/argp-help.c:209
+#: iconv/iconv_charmap.c:177 iconv/iconv_prog.c:311
 #, c-format
-msgid "%.*s: ARGP_HELP_FMT parameter requires a value"
-msgstr "%.*s ARGP_HELP_FMT "
+msgid "error while closing input `%s'"
+msgstr "%s"
 
-#: argp/argp-help.c:218
+#: iconv/iconv_charmap.c:443
 #, c-format
-msgid "%.*s: Unknown ARGP_HELP_FMT parameter"
-msgstr "%.*s ARGP_HELP_FMT "
+msgid "illegal input sequence at position %Zd"
+msgstr " %Zd "
 
-#: locale/programs/ld-address.c:581 locale/programs/ld-collate.c:2612
-#: locale/programs/ld-collate.c:3740 locale/programs/ld-ctype.c:2112
-#: locale/programs/ld-ctype.c:2849 locale/programs/ld-identification.c:448
-#: locale/programs/ld-measurement.c:237 locale/programs/ld-messages.c:331
-#: locale/programs/ld-monetary.c:936 locale/programs/ld-name.c:305
-#: locale/programs/ld-numeric.c:375 locale/programs/ld-paper.c:238
-#: locale/programs/ld-telephone.c:313 locale/programs/ld-time.c:1199
-#, c-format
-msgid "%1$s: definition does not end with `END %1$s'"
-msgstr "%1$sEND %1$s"
+#: iconv/iconv_charmap.c:462 iconv/iconv_prog.c:503
+msgid "incomplete character or shift sequence at end of buffer"
+msgstr ""
 
-#: elf/cache.c:190 elf/cache.c:200
-#, c-format
-msgid "%d libs found in cache `%s'\n"
-msgstr "%2$s %1$d \n"
+#: iconv/iconv_charmap.c:507 iconv/iconv_charmap.c:543 iconv/iconv_prog.c:546
+#: iconv/iconv_prog.c:582
+msgid "error while reading the input"
+msgstr ""
 
-#: timezone/zic.c:799
-#, c-format
-msgid "%s in ruleless zone"
-msgstr ""
+#: iconv/iconv_charmap.c:525 iconv/iconv_prog.c:564
+msgid "unable to allocate buffer for input"
+msgstr ""
 
-#: elf/../sysdeps/generic/readelflib.c:67
-#, c-format
-msgid "%s is a 32 bit ELF file.\n"
-msgstr "%s  32  ELF \n"
+#: iconv/iconv_prog.c:61
+msgid "Input/Output format specification:"
+msgstr "/"
 
-#: elf/../sysdeps/generic/readelflib.c:69
-#, c-format
-msgid "%s is a 64 bit ELF file.\n"
-msgstr "%s  64  ELF \n"
+#: iconv/iconv_prog.c:62
+msgid "encoding of original text"
+msgstr ""
 
-#: elf/../sysdeps/unix/sysv/linux/i386/readelflib.c:49
-#, c-format
-msgid "%s is for unknown machine %d.\n"
-msgstr "%s  %d\n"
+#: iconv/iconv_prog.c:63
+msgid "encoding for output"
+msgstr ""
 
-#: elf/ldconfig.c:326
-#, c-format
-msgid "%s is not a known library type"
-msgstr "%s "
+#: iconv/iconv_prog.c:64
+msgid "Information:"
+msgstr ""
 
-#: elf/../sysdeps/generic/readelflib.c:78
-#, c-format
-msgid "%s is not a shared object file (Type: %d).\n"
-msgstr "%s  (%d)\n"
+#: iconv/iconv_prog.c:65
+msgid "list all known coded character sets"
+msgstr ""
 
-#: elf/ldconfig.c:424
-#, c-format
-msgid "%s is not a symbolic link\n"
-msgstr "%s \n"
+#: iconv/iconv_prog.c:66 locale/programs/localedef.c:128
+msgid "Output control:"
+msgstr ""
+
+#: iconv/iconv_prog.c:67
+msgid "omit invalid characters from output"
+msgstr ""
+
+#: iconv/iconv_prog.c:68
+msgid "output file"
+msgstr ""
+
+#: iconv/iconv_prog.c:69
+msgid "suppress warnings"
+msgstr ""
+
+#: iconv/iconv_prog.c:70
+msgid "print progress information"
+msgstr ""
+
+#: iconv/iconv_prog.c:75
+msgid "Convert encoding of given files from one encoding to another."
+msgstr ""
+
+#: iconv/iconv_prog.c:79
+msgid "[FILE...]"
+msgstr "[...]"
+
+#: iconv/iconv_prog.c:199
+msgid "cannot open output file"
+msgstr ""
 
-#: elf/readlib.c:155
+#: iconv/iconv_prog.c:241
 #, c-format
-msgid "%s is not an ELF file - it has the wrong magic bytes at the start.\n"
-msgstr "%s  ELF  - \n"
+msgid "conversion from `%s' and to `%s' are not supported"
+msgstr "%s%s"
 
-#: assert/assert.c:54
+#: iconv/iconv_prog.c:246
 #, c-format
-msgid "%s%s%s:%u: %s%sAssertion `%s' failed.\n"
-msgstr "%s%s%s%u%s%s%s\n"
+msgid "conversion from `%s' is not supported"
+msgstr "%s"
 
-#: assert/assert-perr.c:56
+#: iconv/iconv_prog.c:253
 #, c-format
-msgid "%s%s%s:%u: %s%sUnexpected error: %s.\n"
-msgstr "%s%s%s%u%s%s%s\n"
+msgid "conversion to `%s' is not supported"
+msgstr "%s"
 
-#: stdio-common/psignal.c:62
+#: iconv/iconv_prog.c:257
 #, c-format
-msgid "%s%sUnknown signal %d\n"
-msgstr "%s%s %d\n"
+msgid "conversion from `%s' to `%s' is not supported"
+msgstr "%s%s"
+
+#: iconv/iconv_prog.c:263
+msgid "failed to start conversion processing"
+msgstr ""
+
+#: iconv/iconv_prog.c:358
+msgid "error while closing output file"
+msgstr ""
 
-#: timezone/zic.c:2234
+#: iconv/iconv_prog.c:407 iconv/iconvconfig.c:357 locale/programs/locale.c:274
+#: locale/programs/localedef.c:372 catgets/gencat.c:233
+#: malloc/memusagestat.c:602 debug/pcprofiledump.c:199
+msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
+msgstr "glibcbug <bugs@gnu.org>\n"
+
+#: iconv/iconv_prog.c:421 iconv/iconvconfig.c:371 locale/programs/locale.c:287
+#: locale/programs/localedef.c:386 catgets/gencat.c:246 posix/getconf.c:910
+#: nss/getent.c:74 nscd/nscd.c:330 nscd/nscd_nischeck.c:90 elf/ldconfig.c:271
+#: elf/sprof.c:349
 #, c-format
-msgid "%s: %d did not sign extend correctly\n"
+msgid ""
+"Copyright (C) %s Free Software Foundation, Inc.\n"
+"This is free software; see the source for copying conditions.  There is NO\n"
+"warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n"
 msgstr ""
 
-#: locale/programs/charmap.c:331
+#: iconv/iconv_prog.c:426 iconv/iconvconfig.c:376 locale/programs/locale.c:292
+#: locale/programs/localedef.c:391 catgets/gencat.c:251 posix/getconf.c:915
+#: nss/getent.c:79 nscd/nscd.c:335 nscd/nscd_nischeck.c:95 elf/ldconfig.c:276
+#: elf/sprof.c:355
 #, c-format
-msgid "%s: <mb_cur_max> must be greater than <mb_cur_min>\n"
-msgstr "%s<mb_cur_max>  <mb_cur_min>\n"
+msgid "Written by %s.\n"
+msgstr " %s \n"
 
-#: sunrpc/rpc_main.c:423
-#, c-format
-msgid "%s: C preprocessor failed with exit code %d\n"
-msgstr "%sC  %d\n"
+#: iconv/iconv_prog.c:456 iconv/iconv_prog.c:482
+msgid "conversion stopped due to problem in writing the output"
+msgstr ""
 
-#: sunrpc/rpc_main.c:420
+#: iconv/iconv_prog.c:499
 #, c-format
-msgid "%s: C preprocessor failed with signal %d\n"
-msgstr "%sC  %d \n"
+msgid "illegal input sequence at position %ld"
+msgstr " %ld "
 
-#: timezone/zic.c:1500
-#, c-format
-msgid "%s: Can't create %s: %s\n"
-msgstr "%s %s%s\n"
+#: iconv/iconv_prog.c:507
+msgid "internal error (illegal descriptor)"
+msgstr " ()"
 
-#: timezone/zic.c:2212
+#: iconv/iconv_prog.c:510
 #, c-format
-msgid "%s: Can't create directory %s: %s\n"
-msgstr "%s %s%s\n"
+msgid "unknown iconv() error %d"
+msgstr " iconv()  %d"
 
-#: timezone/zic.c:651
-#, c-format
-msgid "%s: Can't link from %s to %s: %s\n"
-msgstr "%s %s  %s%s\n"
+#: iconv/iconv_prog.c:753
+msgid ""
+"The following list contain all the coded character sets known.  This does\n"
+"not necessarily mean that all combinations of these names can be used for\n"
+"the FROM and TO command line parameters.  One coded character set can be\n"
+"listed with several different names (aliases).\n"
+"\n"
+"  "
+msgstr ""
 
-#: timezone/zic.c:825
-#, c-format
-msgid "%s: Can't open %s: %s\n"
-msgstr "%s %s%s\n"
+#: iconv/iconvconfig.c:110
+msgid "Create fastloading iconv module configuration file."
+msgstr " iconv "
 
-#: timezone/zic.c:1490
-#, c-format
-msgid "%s: Can't remove %s: %s\n"
-msgstr "%s %s%s\n"
+#: iconv/iconvconfig.c:114
+msgid "[DIR...]"
+msgstr "[...]"
 
-#: timezone/zic.c:636
-#, c-format
-msgid "%s: Can't unlink  %s: %s\n"
-msgstr "%s %s%s\n"
+#: iconv/iconvconfig.c:126
+msgid "Prefix used for all file accesses"
+msgstr ""
+
+#: iconv/iconvconfig.c:327 locale/programs/localedef.c:292
+msgid "no output file produced because warning were issued"
+msgstr ""
+
+#: iconv/iconvconfig.c:405
+msgid "while inserting in search tree"
+msgstr ""
+
+#: iconv/iconvconfig.c:1204
+msgid "cannot generate output file"
+msgstr ""
 
-#: timezone/zic.c:894
+#: locale/programs/charmap-dir.c:59
 #, c-format
-msgid "%s: Error closing %s: %s\n"
-msgstr "%s %s %s\n"
+msgid "cannot read character map directory `%s'"
+msgstr "%s"
 
-#: timezone/zic.c:887
+#: locale/programs/charmap.c:135
 #, c-format
-msgid "%s: Error reading %s\n"
-msgstr "%s %s \n"
+msgid "character map file `%s' not found"
+msgstr "%s"
 
-#: timezone/zic.c:1566
+#: locale/programs/charmap.c:193
 #, c-format
-msgid "%s: Error writing %s\n"
-msgstr "%s %s \n"
+msgid "default character map file `%s' not found"
+msgstr "%s"
 
-#: timezone/zic.c:872
+#: locale/programs/charmap.c:255
 #, c-format
-msgid "%s: Leap line in non leap seconds file %s\n"
+msgid "character map `%s' is not ASCII compatible, locale not ISO C compliant\n"
 msgstr ""
 
-#: timezone/zic.c:365
+#: locale/programs/charmap.c:332
 #, c-format
-msgid "%s: Memory exhausted: %s\n"
-msgstr "%s%s\n"
+msgid "%s: <mb_cur_max> must be greater than <mb_cur_min>\n"
+msgstr "%s<mb_cur_max>  <mb_cur_min>\n"
 
-#: timezone/zic.c:531
+#: locale/programs/charmap.c:352 locale/programs/charmap.c:369
+#: locale/programs/repertoire.c:175
 #, c-format
-msgid "%s: More than one -L option specified\n"
-msgstr "%s -L \n"
+msgid "syntax error in prolog: %s"
+msgstr "%s"
 
-#: timezone/zic.c:491
-#, c-format
-msgid "%s: More than one -d option specified\n"
-msgstr "%s -d \n"
+#: locale/programs/charmap.c:353
+msgid "invalid definition"
+msgstr ""
 
-#: timezone/zic.c:501
-#, c-format
-msgid "%s: More than one -l option specified\n"
-msgstr "%s -l \n"
+#: locale/programs/charmap.c:370 locale/programs/locfile.c:126
+#: locale/programs/locfile.c:153 locale/programs/repertoire.c:176
+msgid "bad argument"
+msgstr ""
 
-#: timezone/zic.c:511
+#: locale/programs/charmap.c:398
 #, c-format
-msgid "%s: More than one -p option specified\n"
-msgstr "%s -p \n"
+msgid "duplicate definition of <%s>"
+msgstr " <%s>"
 
-#: timezone/zic.c:521
+#: locale/programs/charmap.c:405
 #, c-format
-msgid "%s: More than one -y option specified\n"
-msgstr "%s -y \n"
+msgid "value for <%s> must be 1 or greater"
+msgstr "<%s> 1 "
 
-#: argp/argp-parse.c:646
+#: locale/programs/charmap.c:417
 #, c-format
-msgid "%s: Too many arguments\n"
-msgstr "%s\n"
+msgid "value of <%s> must be greater or equal than the value of <%s>"
+msgstr "<%s>  <%s> "
 
-#: locale/programs/ld-collate.c:457 locale/programs/ld-collate.c:483
-#: locale/programs/ld-collate.c:499
+#: locale/programs/charmap.c:440 locale/programs/repertoire.c:184
 #, c-format
-msgid "%s: `%s' mentioned more than once in definition of weight %d"
-msgstr ""
+msgid "argument to <%s> must be a single character"
+msgstr "<%s>"
 
-#: locale/programs/ld-collate.c:1336
-#, c-format
-msgid "%s: `%s' must be a character"
-msgstr "%s%s"
+#: locale/programs/charmap.c:466
+msgid "character sets with locking states are not supported"
+msgstr ""
 
-#: locale/programs/ld-address.c:248 locale/programs/ld-address.c:276
-#: locale/programs/ld-address.c:309 locale/programs/ld-address.c:321
+#: locale/programs/charmap.c:493 locale/programs/charmap.c:547
+#: locale/programs/charmap.c:579 locale/programs/charmap.c:673
+#: locale/programs/charmap.c:728 locale/programs/charmap.c:769
+#: locale/programs/charmap.c:810
 #, c-format
-msgid "%s: `%s' value does not match `%s' value"
-msgstr "%s%s%s"
+msgid "syntax error in %s definition: %s"
+msgstr "%s %s"
 
-#: locale/programs/ld-monetary.c:837 locale/programs/ld-numeric.c:318
-#, c-format
-msgid "%s: `-1' must be last entry in `%s' field"
-msgstr "%s-1%s"
+#: locale/programs/charmap.c:494 locale/programs/charmap.c:674
+#: locale/programs/charmap.c:770 locale/programs/repertoire.c:231
+msgid "no symbolic name given"
+msgstr ""
+
+#: locale/programs/charmap.c:548
+msgid "invalid encoding given"
+msgstr ""
+
+#: locale/programs/charmap.c:557
+msgid "too few bytes in character encoding"
+msgstr ""
+
+#: locale/programs/charmap.c:559
+msgid "too many bytes in character encoding"
+msgstr ""
+
+#: locale/programs/charmap.c:581 locale/programs/charmap.c:729
+#: locale/programs/charmap.c:812 locale/programs/repertoire.c:297
+msgid "no symbolic name given for end of range"
+msgstr ""
 
-#: locale/programs/ld-collate.c:447 locale/programs/ld-collate.c:473
+#: locale/programs/charmap.c:605 locale/programs/locfile.h:96
+#: locale/programs/repertoire.c:314
 #, c-format
-msgid "%s: `forward' and `backward' are mutually excluding each other"
+msgid "`%1$s' definition does not end with `END %1$s'"
+msgstr "%1$sEND %1%s"
+
+#: locale/programs/charmap.c:638
+msgid "only WIDTH definitions are allowed to follow the CHARMAP definition"
 msgstr ""
 
-#: locale/programs/ld-collate.c:1528
+#: locale/programs/charmap.c:646 locale/programs/charmap.c:709
 #, c-format
-msgid "%s: `position' must be used for a specific level in all sections or none"
-msgstr ""
+msgid "value for %s must be an integer"
+msgstr "%s "
 
-#: locale/programs/ld-ctype.c:2637 locale/programs/ld-ctype.c:2777
+#: locale/programs/charmap.c:837
 #, c-format
-msgid "%s: `translit_start' section does not end with `translit_end'"
-msgstr "%stranslit_starttranslit_end"
+msgid "%s: error in state machine"
+msgstr "%s"
 
-#: locale/programs/ld-collate.c:1136
+#: locale/programs/charmap.c:845 locale/programs/ld-address.c:605
+#: locale/programs/ld-collate.c:2635 locale/programs/ld-collate.c:3793
+#: locale/programs/ld-ctype.c:2216 locale/programs/ld-ctype.c:2977
+#: locale/programs/ld-identification.c:469
+#: locale/programs/ld-measurement.c:255 locale/programs/ld-messages.c:349
+#: locale/programs/ld-monetary.c:952 locale/programs/ld-name.c:324
+#: locale/programs/ld-numeric.c:392 locale/programs/ld-paper.c:258
+#: locale/programs/ld-telephone.c:330 locale/programs/ld-time.c:1217
+#: locale/programs/locfile.h:103 locale/programs/repertoire.c:325
 #, c-format
-msgid "%s: byte sequence of first character of sequence is not lower than that of the last character"
-msgstr ""
+msgid "%s: premature end of file"
+msgstr "%s"
 
-#: locale/programs/ld-collate.c:1094
+#: locale/programs/charmap.c:864 locale/programs/charmap.c:875
 #, c-format
-msgid "%s: byte sequences of first and last character must have the same length"
-msgstr "%s"
+msgid "unknown character `%s'"
+msgstr "%s"
 
-#: locale/programs/ld-collate.c:3663
+#: locale/programs/charmap.c:883
 #, c-format
-msgid "%s: cannot have `%s' as end of ellipsis range"
+msgid "number of bytes for byte sequence of beginning and end of range not the same: %d vs %d"
 msgstr ""
 
-#: locale/programs/ld-collate.c:3327
-#, c-format
-msgid "%s: cannot reorder after %.*s: symbol not known"
+#: locale/programs/charmap.c:987 locale/programs/ld-collate.c:2915
+#: locale/programs/repertoire.c:420
+msgid "invalid names for character range"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:2912 locale/programs/ld-ctype.c:2996
-#: locale/programs/ld-ctype.c:3016 locale/programs/ld-ctype.c:3037
-#: locale/programs/ld-ctype.c:3058 locale/programs/ld-ctype.c:3079
-#: locale/programs/ld-ctype.c:3100 locale/programs/ld-ctype.c:3140
-#: locale/programs/ld-ctype.c:3161 locale/programs/ld-ctype.c:3228
-#, c-format
-msgid "%s: character `%s' in charmap not representable with one byte"
+#: locale/programs/charmap.c:999 locale/programs/repertoire.c:432
+msgid "hexadecimal range format should use only capital characters"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:3272 locale/programs/ld-ctype.c:3297
+#: locale/programs/charmap.c:1017
 #, c-format
-msgid "%s: character `%s' needed as default value not representable with one byte"
-msgstr "%s%s"
+msgid "<%s> and <%s> are illegal names for range"
+msgstr "<%s>  <%s> "
 
-#: locale/programs/ld-ctype.c:2907
-#, c-format
-msgid "%s: character `%s' not defined in charmap while needed as default value"
-msgstr ""
+#: locale/programs/charmap.c:1023
+msgid "upper limit in range is not higher then lower limit"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:2991 locale/programs/ld-ctype.c:3011
-#: locale/programs/ld-ctype.c:3053 locale/programs/ld-ctype.c:3074
-#: locale/programs/ld-ctype.c:3095 locale/programs/ld-ctype.c:3135
-#: locale/programs/ld-ctype.c:3156 locale/programs/ld-ctype.c:3223
-#: locale/programs/ld-ctype.c:3265 locale/programs/ld-ctype.c:3290
-#, c-format
-msgid "%s: character `%s' not defined while needed as default value"
+#: locale/programs/charmap.c:1081
+msgid "resulting bytes for range not representable."
 msgstr ""
 
-#: timezone/zic.c:1933
+#: locale/programs/ld-address.c:134 locale/programs/ld-collate.c:1519
+#: locale/programs/ld-ctype.c:416 locale/programs/ld-identification.c:134
+#: locale/programs/ld-measurement.c:95 locale/programs/ld-messages.c:98
+#: locale/programs/ld-monetary.c:194 locale/programs/ld-name.c:95
+#: locale/programs/ld-numeric.c:99 locale/programs/ld-paper.c:92
+#: locale/programs/ld-telephone.c:95 locale/programs/ld-time.c:160
 #, c-format
-msgid "%s: command was '%s', result was %d\n"
-msgstr "%s%s %d\n"
+msgid "No definition for %s category found"
+msgstr ""
 
-#: locale/programs/ld-time.c:246
+#: locale/programs/ld-address.c:145 locale/programs/ld-address.c:183
+#: locale/programs/ld-address.c:201 locale/programs/ld-address.c:228
+#: locale/programs/ld-address.c:290 locale/programs/ld-address.c:309
+#: locale/programs/ld-address.c:322 locale/programs/ld-identification.c:147
+#: locale/programs/ld-measurement.c:106 locale/programs/ld-monetary.c:206
+#: locale/programs/ld-monetary.c:244 locale/programs/ld-monetary.c:260
+#: locale/programs/ld-monetary.c:272 locale/programs/ld-name.c:106
+#: locale/programs/ld-name.c:143 locale/programs/ld-numeric.c:113
+#: locale/programs/ld-numeric.c:127 locale/programs/ld-paper.c:103
+#: locale/programs/ld-paper.c:112 locale/programs/ld-telephone.c:106
+#: locale/programs/ld-telephone.c:163 locale/programs/ld-time.c:176
+#: locale/programs/ld-time.c:197
 #, c-format
-msgid "%s: direction flag in string %Zd in `era' field is not '+' nor '-'"
-msgstr ""
+msgid "%s: field `%s' not defined"
+msgstr "%s%s"
 
-#: locale/programs/ld-time.c:258
+#: locale/programs/ld-address.c:157 locale/programs/ld-address.c:209
+#: locale/programs/ld-address.c:235 locale/programs/ld-address.c:265
+#: locale/programs/ld-name.c:118 locale/programs/ld-telephone.c:118
 #, c-format
-msgid "%s: direction flag in string %Zd in `era' field is not a single character"
-msgstr ""
+msgid "%s: field `%s' must not be empty"
+msgstr "%s%s"
 
-#: locale/programs/ld-ctype.c:2729
+#: locale/programs/ld-address.c:169
 #, c-format
-msgid "%s: duplicate `default_missing' definition"
-msgstr "%sdefault_missing"
+msgid "%s: invalid escape `%%%c' sequence in field `%s'"
+msgstr "%1$s%3$s%%%2$c"
 
-#: locale/programs/ld-identification.c:431
+#: locale/programs/ld-address.c:220
 #, c-format
-msgid "%s: duplicate category version definition"
+msgid "%s: terminology language code `%s' not defined"
 msgstr ""
 
-#: locale/programs/ld-collate.c:2730
+#: locale/programs/ld-address.c:247 locale/programs/ld-address.c:276
 #, c-format
-msgid "%s: duplicate declaration of section `%s'"
-msgstr "%s%s"
+msgid "%s: language abbreviation `%s' not defined"
+msgstr "%s%s"
 
-#: locale/programs/ld-collate.c:2694
+#: locale/programs/ld-address.c:254 locale/programs/ld-address.c:282
+#: locale/programs/ld-address.c:316 locale/programs/ld-address.c:328
 #, c-format
-msgid "%s: duplicate definition of `%s'"
-msgstr "%s%s"
+msgid "%s: `%s' value does not match `%s' value"
+msgstr "%s%s%s"
 
-#: locale/programs/ld-collate.c:3712
+#: locale/programs/ld-address.c:301
 #, c-format
-msgid "%s: empty category description not allowed"
-msgstr "%s"
+msgid "%s: numeric country code `%d' not valid"
+msgstr "%s%d"
 
-#: locale/programs/ld-collate.c:755
+#: locale/programs/ld-address.c:497 locale/programs/ld-address.c:534
+#: locale/programs/ld-address.c:572 locale/programs/ld-ctype.c:2592
+#: locale/programs/ld-identification.c:365
+#: locale/programs/ld-measurement.c:222 locale/programs/ld-messages.c:302
+#: locale/programs/ld-monetary.c:694 locale/programs/ld-monetary.c:729
+#: locale/programs/ld-monetary.c:770 locale/programs/ld-name.c:281
+#: locale/programs/ld-numeric.c:264 locale/programs/ld-paper.c:225
+#: locale/programs/ld-telephone.c:289 locale/programs/ld-time.c:1106
+#: locale/programs/ld-time.c:1148
 #, c-format
-msgid "%s: empty weight string not allowed"
-msgstr "%s"
+msgid "%s: field `%s' declared more than once"
+msgstr "%s%s"
 
-#: locale/programs/charmap.c:836
+#: locale/programs/ld-address.c:501 locale/programs/ld-address.c:539
+#: locale/programs/ld-identification.c:369 locale/programs/ld-messages.c:312
+#: locale/programs/ld-monetary.c:698 locale/programs/ld-monetary.c:733
+#: locale/programs/ld-name.c:285 locale/programs/ld-numeric.c:268
+#: locale/programs/ld-telephone.c:293 locale/programs/ld-time.c:1000
+#: locale/programs/ld-time.c:1069 locale/programs/ld-time.c:1111
 #, c-format
-msgid "%s: error in state machine"
-msgstr "%s"
+msgid "%s: unknown character in field `%s'"
+msgstr "%s%s"
 
-#: locale/programs/ld-address.c:489 locale/programs/ld-address.c:526
-#: locale/programs/ld-address.c:564 locale/programs/ld-ctype.c:2485
-#: locale/programs/ld-identification.c:360
-#: locale/programs/ld-measurement.c:220 locale/programs/ld-messages.c:300
-#: locale/programs/ld-monetary.c:694 locale/programs/ld-monetary.c:729
-#: locale/programs/ld-monetary.c:770 locale/programs/ld-name.c:278
-#: locale/programs/ld-numeric.c:263 locale/programs/ld-paper.c:221
-#: locale/programs/ld-telephone.c:288 locale/programs/ld-time.c:1104
-#: locale/programs/ld-time.c:1146
+#: locale/programs/ld-address.c:586 locale/programs/ld-collate.c:3775
+#: locale/programs/ld-ctype.c:2957 locale/programs/ld-identification.c:450
+#: locale/programs/ld-measurement.c:236 locale/programs/ld-messages.c:331
+#: locale/programs/ld-monetary.c:934 locale/programs/ld-name.c:306
+#: locale/programs/ld-numeric.c:374 locale/programs/ld-paper.c:240
+#: locale/programs/ld-telephone.c:312 locale/programs/ld-time.c:1199
 #, c-format
-msgid "%s: field `%s' declared more than once"
-msgstr "%s%s"
+msgid "%s: incomplete `END' line"
+msgstr "%sEND"
 
-#: locale/programs/ld-ctype.c:1526 locale/programs/ld-ctype.c:1651
-#: locale/programs/ld-ctype.c:1757 locale/programs/ld-ctype.c:2348
-#: locale/programs/ld-ctype.c:3331
+#: locale/programs/ld-address.c:589 locale/programs/ld-collate.c:2638
+#: locale/programs/ld-collate.c:3777 locale/programs/ld-ctype.c:2219
+#: locale/programs/ld-ctype.c:2960 locale/programs/ld-identification.c:453
+#: locale/programs/ld-measurement.c:239 locale/programs/ld-messages.c:333
+#: locale/programs/ld-monetary.c:936 locale/programs/ld-name.c:308
+#: locale/programs/ld-numeric.c:376 locale/programs/ld-paper.c:242
+#: locale/programs/ld-telephone.c:314 locale/programs/ld-time.c:1201
 #, c-format
-msgid "%s: field `%s' does not contain exactly ten entries"
-msgstr "%s%s"
+msgid "%1$s: definition does not end with `END %1$s'"
+msgstr "%1$sEND %1$s"
 
-#: locale/programs/ld-address.c:154 locale/programs/ld-address.c:205
-#: locale/programs/ld-address.c:230 locale/programs/ld-address.c:259
-#: locale/programs/ld-name.c:115 locale/programs/ld-telephone.c:117
+#: locale/programs/ld-address.c:596 locale/programs/ld-collate.c:520
+#: locale/programs/ld-collate.c:572 locale/programs/ld-collate.c:869
+#: locale/programs/ld-collate.c:882 locale/programs/ld-collate.c:2625
+#: locale/programs/ld-collate.c:3784 locale/programs/ld-ctype.c:1947
+#: locale/programs/ld-ctype.c:2206 locale/programs/ld-ctype.c:2782
+#: locale/programs/ld-ctype.c:2968 locale/programs/ld-identification.c:460
+#: locale/programs/ld-measurement.c:246 locale/programs/ld-messages.c:340
+#: locale/programs/ld-monetary.c:943 locale/programs/ld-name.c:315
+#: locale/programs/ld-numeric.c:383 locale/programs/ld-paper.c:249
+#: locale/programs/ld-telephone.c:321 locale/programs/ld-time.c:1208
 #, c-format
-msgid "%s: field `%s' must not be empty"
-msgstr "%s%s"
+msgid "%s: syntax error"
+msgstr "%s"
 
-#: locale/programs/ld-address.c:142 locale/programs/ld-address.c:180
-#: locale/programs/ld-address.c:197 locale/programs/ld-address.c:224
-#: locale/programs/ld-address.c:284 locale/programs/ld-address.c:303
-#: locale/programs/ld-address.c:315 locale/programs/ld-identification.c:145
-#: locale/programs/ld-measurement.c:104 locale/programs/ld-monetary.c:206
-#: locale/programs/ld-monetary.c:244 locale/programs/ld-monetary.c:260
-#: locale/programs/ld-monetary.c:272 locale/programs/ld-name.c:104
-#: locale/programs/ld-name.c:141 locale/programs/ld-numeric.c:113
-#: locale/programs/ld-numeric.c:127 locale/programs/ld-paper.c:101
-#: locale/programs/ld-paper.c:109 locale/programs/ld-telephone.c:105
-#: locale/programs/ld-telephone.c:163 locale/programs/ld-time.c:175
-#: locale/programs/ld-time.c:195
+#: locale/programs/ld-collate.c:395
 #, c-format
-msgid "%s: field `%s' not defined"
-msgstr "%s%s"
+msgid "`%.*s' already defined in charmap"
+msgstr "%.*s"
 
-#: locale/programs/ld-messages.c:115 locale/programs/ld-messages.c:148
+#: locale/programs/ld-collate.c:404
 #, c-format
-msgid "%s: field `%s' undefined"
-msgstr "%s%s"
+msgid "`%.*s' already defined in repertoire"
+msgstr "%.*s"
 
-#: locale/programs/ld-time.c:279
+#: locale/programs/ld-collate.c:411
 #, c-format
-msgid "%s: garbage at end of offset value in string %Zd in `era' field"
+msgid "`%.*s' already defined as collating symbol"
 msgstr ""
 
-#: locale/programs/ld-time.c:339
+#: locale/programs/ld-collate.c:418
 #, c-format
-msgid "%s: garbage at end of starting date in string %Zd in `era' field "
+msgid "`%.*s' already defined as collating element"
 msgstr ""
 
-#: locale/programs/ld-time.c:416
+#: locale/programs/ld-collate.c:449 locale/programs/ld-collate.c:475
 #, c-format
-msgid "%s: garbage at end of stopping date in string %Zd in `era' field"
+msgid "%s: `forward' and `backward' are mutually excluding each other"
+msgstr "%sforwardbackward"
+
+#: locale/programs/ld-collate.c:459 locale/programs/ld-collate.c:485
+#: locale/programs/ld-collate.c:501
+#, c-format
+msgid "%s: `%s' mentioned more than once in definition of weight %d"
 msgstr ""
 
-#: posix/getopt.c:887 posix/getopt.c:890
+#: locale/programs/ld-collate.c:557
 #, c-format
-msgid "%s: illegal option -- %c\n"
-msgstr "%s -- %c\n"
+msgid "%s: too many rules; first entry only had %d"
+msgstr "%s %d"
 
-#: locale/programs/ld-address.c:578 locale/programs/ld-collate.c:3738
-#: locale/programs/ld-ctype.c:2846 locale/programs/ld-identification.c:445
-#: locale/programs/ld-measurement.c:234 locale/programs/ld-messages.c:329
-#: locale/programs/ld-monetary.c:934 locale/programs/ld-name.c:303
-#: locale/programs/ld-numeric.c:373 locale/programs/ld-paper.c:236
-#: locale/programs/ld-telephone.c:311 locale/programs/ld-time.c:1197
+#: locale/programs/ld-collate.c:593
 #, c-format
-msgid "%s: incomplete `END' line"
-msgstr "%sEND"
+msgid "%s: not enough sorting rules"
+msgstr "%s"
 
-#: locale/programs/ld-address.c:166
+#: locale/programs/ld-collate.c:759
 #, c-format
-msgid "%s: invalid escape `%%%c' sequence in field `%s'"
-msgstr "%1$s%3$s%%%2$c"
+msgid "%s: empty weight string not allowed"
+msgstr "%s"
 
-#: locale/programs/ld-name.c:127 locale/programs/ld-telephone.c:126
-#: locale/programs/ld-telephone.c:150
+#: locale/programs/ld-collate.c:854
 #, c-format
-msgid "%s: invalid escape sequence in field `%s'"
-msgstr "%s%s"
+msgid "%s: weights must use the same ellipsis symbol as the name"
+msgstr ""
 
-#: locale/programs/ld-time.c:271
+#: locale/programs/ld-collate.c:910
 #, c-format
-msgid "%s: invalid number for offset in string %Zd in `era' field"
+msgid "%s: too many values"
+msgstr "%s"
+
+#: locale/programs/ld-collate.c:1023 locale/programs/ld-collate.c:1194
+#, c-format
+msgid "order for `%.*s' already defined at %s:%Zu"
 msgstr ""
 
-#: locale/programs/ld-collate.c:3162
+#: locale/programs/ld-collate.c:1073
 #, c-format
-msgid "%s: invalid number of sorting rules"
+msgid "%s: the start and the end symbol of a range must stand for characters"
 msgstr ""
 
-#: posix/getopt.c:896 posix/getopt.c:899
+#: locale/programs/ld-collate.c:1100
 #, c-format
-msgid "%s: invalid option -- %c\n"
-msgstr "%s -- %c\n"
+msgid "%s: byte sequences of first and last character must have the same length"
+msgstr "%s"
 
-#: locale/programs/ld-time.c:330
+#: locale/programs/ld-collate.c:1142
 #, c-format
-msgid "%s: invalid starting date in string %Zd in `era' field"
+msgid "%s: byte sequence of first character of sequence is not lower than that of the last character"
 msgstr ""
 
-#: locale/programs/ld-time.c:407
+#: locale/programs/ld-collate.c:1263
 #, c-format
-msgid "%s: invalid stopping date in string %Zd in `era' field"
+msgid "%s: symbolic range ellipsis must not directly follow `order_start'"
 msgstr ""
 
-#: locale/programs/ld-measurement.c:112
+#: locale/programs/ld-collate.c:1267
 #, c-format
-msgid "%s: invalid value for field `%s'"
-msgstr "%s%s"
+msgid "%s: symbolic range ellipsis must not be directly followed by `order_end'"
+msgstr ""
 
-#: locale/programs/ld-address.c:242 locale/programs/ld-address.c:270
+#: locale/programs/ld-collate.c:1287 locale/programs/ld-ctype.c:1467
 #, c-format
-msgid "%s: language abbreviation `%s' not defined"
-msgstr "%s%s"
+msgid "`%s' and `%.*s' are no valid names for symbolic range"
+msgstr ""
 
-#: resolv/res_hconf.c:366
+#: locale/programs/ld-collate.c:1333 locale/programs/ld-collate.c:3712
 #, c-format
-msgid "%s: line %d: bad command `%s'\n"
-msgstr "%s %d%s\n"
+msgid "%s: order for `%.*s' already defined at %s:%Zu"
+msgstr ""
 
-#: resolv/res_hconf.c:165
+#: locale/programs/ld-collate.c:1342
 #, c-format
-msgid "%s: line %d: cannot specify more than %d services"
-msgstr "%s %d %d "
+msgid "%s: `%s' must be a character"
+msgstr "%s%s"
 
-#: resolv/res_hconf.c:231
+#: locale/programs/ld-collate.c:1535
 #, c-format
-msgid "%s: line %d: cannot specify more than %d trim domains"
-msgstr "%s %d %d "
+msgid "%s: `position' must be used for a specific level in all sections or none"
+msgstr ""
 
-#: resolv/res_hconf.c:319
+#: locale/programs/ld-collate.c:1560
 #, c-format
-msgid "%s: line %d: expected `on' or `off', found `%s'\n"
-msgstr "%s %donoff%s\n"
+msgid "symbol `%s' not defined"
+msgstr "%s"
 
-#: resolv/res_hconf.c:147
+#: locale/programs/ld-collate.c:1636 locale/programs/ld-collate.c:1742
 #, c-format
-msgid "%s: line %d: expected service, found `%s'\n"
-msgstr "%s %d service%s\n"
+msgid "symbol `%s' has the same encoding as"
+msgstr ""
 
-#: resolv/res_hconf.c:395
+#: locale/programs/ld-collate.c:1640 locale/programs/ld-collate.c:1746
 #, c-format
-msgid "%s: line %d: ignoring trailing garbage `%s'\n"
-msgstr ""
+msgid "symbol `%s'"
+msgstr "%s"
 
-#: resolv/res_hconf.c:256
+#: locale/programs/ld-collate.c:1788
+msgid "no definition of `UNDEFINED'"
+msgstr "UNDEFINIED"
+
+#: locale/programs/ld-collate.c:1817
+msgid "too many errors; giving up"
+msgstr ""
+
+#: locale/programs/ld-collate.c:2720
 #, c-format
-msgid "%s: line %d: list delimiter not followed by domain"
-msgstr "%s %d"
+msgid "%s: duplicate definition of `%s'"
+msgstr "%s%s"
 
-#: resolv/res_hconf.c:191
+#: locale/programs/ld-collate.c:2756
 #, c-format
-msgid "%s: line %d: list delimiter not followed by keyword"
-msgstr "%s %d"
+msgid "%s: duplicate declaration of section `%s'"
+msgstr "%s%s"
 
-#: locale/programs/ld-collate.c:3242 locale/programs/ld-collate.c:3365
-#: locale/programs/ld-collate.c:3716
+#: locale/programs/ld-collate.c:2895
 #, c-format
-msgid "%s: missing `order_end' keyword"
-msgstr "%sorder_end"
+msgid "%s: unknown character in collating symbol name"
+msgstr ""
 
-#: locale/programs/ld-collate.c:3379 locale/programs/ld-collate.c:3728
+#: locale/programs/ld-collate.c:3027
 #, c-format
-msgid "%s: missing `reorder-end' keyword"
-msgstr "%sreorder-end"
+msgid "%s: unknown character in equivalent definition name"
+msgstr "%s"
 
-#: locale/programs/ld-collate.c:3731
+#: locale/programs/ld-collate.c:3040
 #, c-format
-msgid "%s: missing `reorder-sections-end' keyword"
-msgstr "%sreorder-sections-end"
+msgid "%s: unknown character in equivalent definition value"
+msgstr "%s"
 
-#: locale/programs/ld-time.c:456
+#: locale/programs/ld-collate.c:3050
 #, c-format
-msgid "%s: missing era format in string %Zd in `era' field"
+msgid "%s: unknown symbol `%s' in equivalent definition"
+msgstr "%s%s"
+
+#: locale/programs/ld-collate.c:3059
+msgid "error while adding equivalent collating symbol"
 msgstr ""
 
-#: locale/programs/ld-time.c:444
+#: locale/programs/ld-collate.c:3089
 #, c-format
-msgid "%s: missing era name in string %Zd in `era' field"
-msgstr ""
+msgid "duplicate definition of script `%s'"
+msgstr "%s"
+
+#: locale/programs/ld-collate.c:3137
+#, c-format
+msgid "%s: unknown section name `%s'"
+msgstr "%s%s"
 
-#: locale/programs/ld-collate.c:3138
+#: locale/programs/ld-collate.c:3165
 #, c-format
 msgid "%s: multiple order definitions for section `%s'"
 msgstr "%s%s"
 
-#: locale/programs/ld-collate.c:3188
+#: locale/programs/ld-collate.c:3190
+#, c-format
+msgid "%s: invalid number of sorting rules"
+msgstr "%s"
+
+#: locale/programs/ld-collate.c:3217
 #, c-format
 msgid "%s: multiple order definitions for unnamed section"
 msgstr "%s"
 
-#: locale/programs/ld-messages.c:137 locale/programs/ld-messages.c:170
+#: locale/programs/ld-collate.c:3271 locale/programs/ld-collate.c:3394
+#: locale/programs/ld-collate.c:3753
 #, c-format
-msgid "%s: no correct regular expression for field `%s': %s"
-msgstr "%s%s%s"
+msgid "%s: missing `order_end' keyword"
+msgstr "%sorder_end"
 
-#: locale/programs/ld-identification.c:169
+#: locale/programs/ld-collate.c:3329
 #, c-format
-msgid "%s: no identification for category `%s'"
+msgid "%s: order for collating symbol %.*s not yet defined"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:2755
+#: locale/programs/ld-collate.c:3345
 #, c-format
-msgid "%s: no representable `default_missing' definition found"
+msgid "%s: order for collating element %.*s not yet defined"
 msgstr ""
 
-#: locale/programs/ld-collate.c:591
+#: locale/programs/ld-collate.c:3356
 #, c-format
-msgid "%s: not enough sorting rules"
+msgid "%s: cannot reorder after %.*s: symbol not known"
 msgstr ""
 
-#: locale/programs/ld-address.c:295
+#: locale/programs/ld-collate.c:3408 locale/programs/ld-collate.c:3765
 #, c-format
-msgid "%s: numeric country code `%d' not valid"
-msgstr "%s%d"
+msgid "%s: missing `reorder-end' keyword"
+msgstr "%sreorder-end"
 
-#: posix/getopt.c:743 posix/getopt.c:748
+#: locale/programs/ld-collate.c:3442 locale/programs/ld-collate.c:3637
 #, c-format
-msgid "%s: option `%c%s' doesn't allow an argument\n"
-msgstr "%s%c%s\n"
+msgid "%s: section `%.*s' not known"
+msgstr "%s%.*s"
 
-#: posix/getopt.c:688 posix/getopt.c:698
+#: locale/programs/ld-collate.c:3507
 #, c-format
-msgid "%s: option `%s' is ambiguous\n"
-msgstr "%s%s\n"
+msgid "%s: bad symbol <%.*s>"
+msgstr ""
 
-#: posix/getopt.c:782 posix/getopt.c:793 posix/getopt.c:1070
-#: posix/getopt.c:1082
+#: locale/programs/ld-collate.c:3700
 #, c-format
-msgid "%s: option `%s' requires an argument\n"
-msgstr "%s%s\n"
+msgid "%s: cannot have `%s' as end of ellipsis range"
+msgstr ""
 
-#: posix/getopt.c:730 posix/getopt.c:734
+#: locale/programs/ld-collate.c:3749
 #, c-format
-msgid "%s: option `--%s' doesn't allow an argument\n"
-msgstr "%s--%s\n"
+msgid "%s: empty category description not allowed"
+msgstr "%s"
 
-#: posix/getopt.c:1038 posix/getopt.c:1049
+#: locale/programs/ld-collate.c:3768
 #, c-format
-msgid "%s: option `-W %s' doesn't allow an argument\n"
-msgstr "%s-W %s\n"
+msgid "%s: missing `reorder-sections-end' keyword"
+msgstr "%sreorder-sections-end"
 
-#: posix/getopt.c:1004 posix/getopt.c:1014
-#, c-format
-msgid "%s: option `-W %s' is ambiguous\n"
-msgstr "%s-W %s\n"
+#: locale/programs/ld-ctype.c:435
+msgid "No character set name specified in charmap"
+msgstr ""
 
-#: posix/getopt.c:942 posix/getopt.c:952 posix/getopt.c:1136
-#: posix/getopt.c:1147
+#: locale/programs/ld-ctype.c:464
 #, c-format
-msgid "%s: option requires an argument -- %c\n"
-msgstr "%s -- %c\n"
+msgid "character L'\\u%0*x' in class `%s' must be in class `%s'"
+msgstr ""
 
-#: locale/programs/ld-collate.c:1327 locale/programs/ld-collate.c:3675
+# msgstr "%2$s L'\\u%0*x' %3$s"
+#: locale/programs/ld-ctype.c:479
 #, c-format
-msgid "%s: order for `%.*s' already defined at %s:%Zu"
+msgid "character L'\\u%0*x' in class `%s' must not be in class `%s'"
 msgstr ""
 
-#: locale/programs/ld-collate.c:3316
+#: locale/programs/ld-ctype.c:493 locale/programs/ld-ctype.c:551
 #, c-format
-msgid "%s: order for collating element %.*s not yet defined"
-msgstr ""
+msgid "internal error in %s, line %u"
+msgstr " %s  %u "
 
-#: locale/programs/ld-collate.c:3300
+#: locale/programs/ld-ctype.c:522
 #, c-format
-msgid "%s: order for collating symbol %.*s not yet defined"
-msgstr ""
+msgid "character '%s' in class `%s' must be in class `%s'"
+msgstr "%2$s%1$s%3$s"
 
-#: sunrpc/rpc_main.c:289
+#: locale/programs/ld-ctype.c:538
 #, c-format
-msgid "%s: output would overwrite %s\n"
-msgstr "%s %s\n"
+msgid "character '%s' in class `%s' must not be in class `%s'"
+msgstr "%2$s%1$s%3$s"
 
-#: timezone/zic.c:879 timezone/zic.c:1293 timezone/zic.c:1318
+#: locale/programs/ld-ctype.c:568 locale/programs/ld-ctype.c:606
 #, c-format
-msgid "%s: panic: Invalid l_value %d\n"
-msgstr ""
+msgid "<SP> character not in class `%s'"
+msgstr " <SP> %s"
 
-#: locale/programs/charmap.c:843 locale/programs/ld-address.c:597
-#: locale/programs/ld-collate.c:2609 locale/programs/ld-collate.c:3756
-#: locale/programs/ld-ctype.c:2109 locale/programs/ld-ctype.c:2866
-#: locale/programs/ld-identification.c:464
-#: locale/programs/ld-measurement.c:253 locale/programs/ld-messages.c:347
-#: locale/programs/ld-monetary.c:952 locale/programs/ld-name.c:321
-#: locale/programs/ld-numeric.c:391 locale/programs/ld-paper.c:254
-#: locale/programs/ld-telephone.c:329 locale/programs/ld-time.c:1215
-#: locale/programs/locfile.h:103 locale/programs/repertoire.c:325
+#: locale/programs/ld-ctype.c:580 locale/programs/ld-ctype.c:617
 #, c-format
-msgid "%s: premature end of file"
-msgstr "%s"
+msgid "<SP> character must not be in class `%s'"
+msgstr " <SP> %s"
+
+#: locale/programs/ld-ctype.c:595
+msgid "character <SP> not defined in character map"
+msgstr " <SP>"
+
+#: locale/programs/ld-ctype.c:709
+msgid "`digit' category has not entries in groups of ten"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:758
+msgid "no input digits defined and none of the standard names in the charmap"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:823
+msgid "not all characters used in `outdigit' are available in the charmap"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:840
+msgid "not all characters used in `outdigit' are available in the repertoire"
+msgstr ""
 
-#: locale/programs/ld-collate.c:3413 locale/programs/ld-collate.c:3601
+#: locale/programs/ld-ctype.c:1235
 #, c-format
-msgid "%s: section `%.*s' not known"
-msgstr "%s%.*s"
+msgid "character class `%s' already defined"
+msgstr "%s"
 
-#: locale/programs/ld-time.c:358
+#: locale/programs/ld-ctype.c:1241
 #, c-format
-msgid "%s: starting date is invalid in string %Zd in `era' field"
+msgid "implementation limit: no more than %Zd character classes allowed"
 msgstr ""
 
-#: locale/programs/ld-time.c:435
+#: locale/programs/ld-ctype.c:1267
 #, c-format
-msgid "%s: stopping date is invalid in string %Zd in `era' field"
+msgid "character map `%s' already defined"
 msgstr ""
 
-#: locale/programs/ld-collate.c:1261
+#: locale/programs/ld-ctype.c:1273
 #, c-format
-msgid "%s: symbolic range ellipsis must not be directly followed by `order_end'"
-msgstr ""
+msgid "implementation limit: no more than %d character maps allowed"
+msgstr " %d "
 
-#: locale/programs/ld-collate.c:1257
+#: locale/programs/ld-ctype.c:1538 locale/programs/ld-ctype.c:1663
+#: locale/programs/ld-ctype.c:1769 locale/programs/ld-ctype.c:2455
+#: locale/programs/ld-ctype.c:3443
 #, c-format
-msgid "%s: symbolic range ellipsis must not directly follow `order_start'"
-msgstr ""
+msgid "%s: field `%s' does not contain exactly ten entries"
+msgstr "%s%s"
 
-#: locale/programs/ld-address.c:588 locale/programs/ld-collate.c:518
-#: locale/programs/ld-collate.c:570 locale/programs/ld-collate.c:865
-#: locale/programs/ld-collate.c:878 locale/programs/ld-collate.c:2599
-#: locale/programs/ld-collate.c:3747 locale/programs/ld-ctype.c:1841
-#: locale/programs/ld-ctype.c:2099 locale/programs/ld-ctype.c:2675
-#: locale/programs/ld-ctype.c:2857 locale/programs/ld-identification.c:455
-#: locale/programs/ld-measurement.c:244 locale/programs/ld-messages.c:338
-#: locale/programs/ld-monetary.c:943 locale/programs/ld-name.c:312
-#: locale/programs/ld-numeric.c:382 locale/programs/ld-paper.c:245
-#: locale/programs/ld-telephone.c:320 locale/programs/ld-time.c:1206
+#: locale/programs/ld-ctype.c:1566 locale/programs/ld-ctype.c:2137
 #, c-format
-msgid "%s: syntax error"
-msgstr "%s"
+msgid "to-value <U%0*X> of range is smaller than from-value <U%0*X>"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:1693
+msgid "start and end character sequence of range must have the same length"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:1700
+msgid "to-value character sequence is smaller than from-value sequence"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:2057 locale/programs/ld-ctype.c:2108
+msgid "premature end of `translit_ignore' definition"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:2063 locale/programs/ld-ctype.c:2114
+#: locale/programs/ld-ctype.c:2156
+msgid "syntax error"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:2180
+#: locale/programs/ld-ctype.c:2287
 #, c-format
 msgid "%s: syntax error in definition of new character class"
 msgstr "%s"
 
-#: locale/programs/ld-ctype.c:2195
+#: locale/programs/ld-ctype.c:2302
 #, c-format
 msgid "%s: syntax error in definition of new character map"
 msgstr "%s"
 
-#: locale/programs/ld-ctype.c:3737
-#, c-format
-msgid "%s: table for class \"%s\": %lu bytes\n"
+#: locale/programs/ld-ctype.c:2477
+msgid "ellipsis range must be marked by two operands of same type"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:3805
-#, c-format
-msgid "%s: table for map \"%s\": %lu bytes\n"
+#: locale/programs/ld-ctype.c:2486
+msgid "with symbolic name range values the absolute ellipsis `...' must not be used"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:3937
-#, c-format
-msgid "%s: table for width: %lu bytes\n"
+#: locale/programs/ld-ctype.c:2501
+msgid "with UCS range values one must use the hexadecimal symbolic ellipsis `..'"
 msgstr ""
 
-#: locale/programs/ld-address.c:216
-#, c-format
-msgid "%s: terminology language code `%s' not defined"
+#: locale/programs/ld-ctype.c:2515
+msgid "with character code range values one must use the absolute ellipsis `...'"
 msgstr ""
 
-#: locale/programs/ld-collate.c:1067
+#: locale/programs/ld-ctype.c:2666
 #, c-format
-msgid "%s: the start and the end symbol of a range must stand for characters"
-msgstr ""
+msgid "duplicated definition for mapping `%s'"
+msgstr "%s"
 
-#: locale/programs/ld-time.c:485
+#: locale/programs/ld-ctype.c:2744 locale/programs/ld-ctype.c:2888
 #, c-format
-msgid "%s: third operand for value of field `%s' must not be larger than %d"
-msgstr ""
+msgid "%s: `translit_start' section does not end with `translit_end'"
+msgstr "%stranslit_starttranslit_end"
 
-#: locale/programs/ld-time.c:983
+#: locale/programs/ld-ctype.c:2839
 #, c-format
-msgid "%s: too few values for field `%s'"
-msgstr "%s%s"
+msgid "%s: duplicate `default_missing' definition"
+msgstr "%sdefault_missing"
 
-#: locale/programs/ld-collate.c:555
+#: locale/programs/ld-ctype.c:2844
+msgid "previous definition was here"
+msgstr ""
+
+#: locale/programs/ld-ctype.c:2866
 #, c-format
-msgid "%s: too many rules; first entry only had %d"
-msgstr "%s %d"
+msgid "%s: no representable `default_missing' definition found"
+msgstr ""
 
-#: locale/programs/ld-collate.c:906
+#: locale/programs/ld-ctype.c:3019
 #, c-format
-msgid "%s: too many values"
-msgstr "%s"
+msgid "%s: character `%s' not defined in charmap while needed as default value"
+msgstr ""
 
-#: locale/programs/ld-time.c:1030
+#: locale/programs/ld-ctype.c:3024 locale/programs/ld-ctype.c:3108
+#: locale/programs/ld-ctype.c:3128 locale/programs/ld-ctype.c:3149
+#: locale/programs/ld-ctype.c:3170 locale/programs/ld-ctype.c:3191
+#: locale/programs/ld-ctype.c:3212 locale/programs/ld-ctype.c:3252
+#: locale/programs/ld-ctype.c:3273 locale/programs/ld-ctype.c:3340
 #, c-format
-msgid "%s: too many values for field `%s'"
-msgstr "%s%s"
+msgid "%s: character `%s' in charmap not representable with one byte"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:3641
+#: locale/programs/ld-ctype.c:3103 locale/programs/ld-ctype.c:3123
+#: locale/programs/ld-ctype.c:3165 locale/programs/ld-ctype.c:3186
+#: locale/programs/ld-ctype.c:3207 locale/programs/ld-ctype.c:3247
+#: locale/programs/ld-ctype.c:3268 locale/programs/ld-ctype.c:3335
+#: locale/programs/ld-ctype.c:3377 locale/programs/ld-ctype.c:3402
 #, c-format
-msgid "%s: transliteration data from locale `%s' not available"
+msgid "%s: character `%s' not defined while needed as default value"
 msgstr ""
 
-#: sunrpc/rpc_main.c:296
+# msgstr "%s L'\\u%0*x' %s"
+#: locale/programs/ld-ctype.c:3144
 #, c-format
-msgid "%s: unable to open %s: %m\n"
-msgstr "%s %s%m\n"
+msgid "character `%s' not defined while needed as default value"
+msgstr ""
 
-#: locale/programs/ld-collate.c:2868
+#: locale/programs/ld-ctype.c:3384 locale/programs/ld-ctype.c:3409
 #, c-format
-msgid "%s: unknown character in collating symbol name"
+msgid "%s: character `%s' needed as default value not representable with one byte"
+msgstr "%s%s"
+
+#: locale/programs/ld-ctype.c:3464
+msgid "no output digits defined and none of the standard names in the charmap"
 msgstr ""
 
-#: locale/programs/ld-collate.c:3000
+#: locale/programs/ld-ctype.c:3755
 #, c-format
-msgid "%s: unknown character in equivalent definition name"
-msgstr "%s"
+msgid "%s: transliteration data from locale `%s' not available"
+msgstr ""
 
-#: locale/programs/ld-collate.c:3013
+#: locale/programs/ld-ctype.c:3851
 #, c-format
-msgid "%s: unknown character in equivalent definition value"
-msgstr "%s"
+msgid "%s: table for class \"%s\": %lu bytes\n"
+msgstr ""
 
-#: locale/programs/ld-address.c:493 locale/programs/ld-address.c:531
-#: locale/programs/ld-identification.c:364 locale/programs/ld-messages.c:310
-#: locale/programs/ld-monetary.c:698 locale/programs/ld-monetary.c:733
-#: locale/programs/ld-name.c:282 locale/programs/ld-numeric.c:267
-#: locale/programs/ld-telephone.c:292 locale/programs/ld-time.c:999
-#: locale/programs/ld-time.c:1067 locale/programs/ld-time.c:1109
+#: locale/programs/ld-ctype.c:3920
 #, c-format
-msgid "%s: unknown character in field `%s'"
-msgstr "%s%s"
+msgid "%s: table for map \"%s\": %lu bytes\n"
+msgstr ""
 
-#: locale/programs/ld-collate.c:3110
+#: locale/programs/ld-ctype.c:4053
 #, c-format
-msgid "%s: unknown section name `%s'"
-msgstr "%s%s"
+msgid "%s: table for width: %lu bytes\n"
+msgstr ""
 
-#: locale/programs/ld-collate.c:3023
+#: locale/programs/ld-identification.c:171
 #, c-format
-msgid "%s: unknown symbol `%s' in equivalent definition"
-msgstr "%s%s"
+msgid "%s: no identification for category `%s'"
+msgstr ""
 
-#: posix/getopt.c:841 posix/getopt.c:844
+#: locale/programs/ld-identification.c:436
 #, c-format
-msgid "%s: unrecognized option `%c%s'\n"
-msgstr "%s%c%s\n"
+msgid "%s: duplicate category version definition"
+msgstr ""
 
-#: posix/getopt.c:830 posix/getopt.c:833
+#: locale/programs/ld-measurement.c:114
 #, c-format
-msgid "%s: unrecognized option `--%s'\n"
-msgstr "%s--%s\n"
+msgid "%s: invalid value for field `%s'"
+msgstr "%s%s"
 
-#: timezone/zic.c:449
+#: locale/programs/ld-messages.c:115 locale/programs/ld-messages.c:149
 #, c-format
-msgid ""
-"%s: usage is %s [ -s ] [ -v ] [ -l localtime ] [ -p posixrules ] \\\n"
-"\t[ -d directory ] [ -L leapseconds ] [ -y yearistype ] [ filename ... ]\n"
-msgstr ""
-"%s %s [ -s ] [ -v ] [ -l  ] [ -p posix  ] \\\n"
-"\t[ -d  ] [ -L leapseconds ] [ -y yearistype ] [  ... ]\n"
+msgid "%s: field `%s' undefined"
+msgstr "%s%s"
 
-#: timezone/zdump.c:175
+#: locale/programs/ld-messages.c:122 locale/programs/ld-messages.c:156
 #, c-format
-msgid "%s: usage is %s [ -v ] [ -c cutoff ] zonename ...\n"
-msgstr "%s %s [ -v ] [ -c cutoff ]  ...\n"
+msgid "%s: value for field `%s' must not be an empty string"
+msgstr "%s%s"
 
-#: locale/programs/ld-monetary.c:740 locale/programs/ld-numeric.c:274
+#: locale/programs/ld-messages.c:138 locale/programs/ld-messages.c:172
 #, c-format
-msgid "%s: value for field `%s' must be a single character"
-msgstr "%s%s"
+msgid "%s: no correct regular expression for field `%s': %s"
+msgstr "%s%s%s"
 
-#: locale/programs/ld-monetary.c:308
+#: locale/programs/ld-monetary.c:224
 #, c-format
-msgid "%s: value for field `%s' must be in range %d...%d"
-msgstr "%s%s %d...%d "
+msgid "%s: value of field `int_curr_symbol' has wrong length"
+msgstr "%sint_curr_symbol"
 
-#: locale/programs/ld-messages.c:121 locale/programs/ld-messages.c:154
+#: locale/programs/ld-monetary.c:232
 #, c-format
-msgid "%s: value for field `%s' must not be an empty string"
-msgstr "%s%s"
+msgid "%s: value of field `int_curr_symbol' does not correspond to a valid name in ISO 4217"
+msgstr "%sint_curr_symbol ISO 4217 "
 
 #: locale/programs/ld-monetary.c:250 locale/programs/ld-numeric.c:119
 #, c-format
 msgid "%s: value for field `%s' must not be the empty string"
 msgstr "%s%s"
 
-#: locale/programs/ld-monetary.c:232
+#: locale/programs/ld-monetary.c:278 locale/programs/ld-monetary.c:308
 #, c-format
-msgid "%s: value of field `int_curr_symbol' does not correspond to a valid name in ISO 4217"
-msgstr "%sint_curr_symbol ISO 4217 "
+msgid "%s: value for field `%s' must be in range %d...%d"
+msgstr "%s%s %d...%d "
 
-#: locale/programs/ld-monetary.c:224
+#: locale/programs/ld-monetary.c:740 locale/programs/ld-numeric.c:275
 #, c-format
-msgid "%s: value of field `int_curr_symbol' has wrong length"
-msgstr "%sint_curr_symbol"
+msgid "%s: value for field `%s' must be a single character"
+msgstr "%s%s"
+
+#: locale/programs/ld-monetary.c:837 locale/programs/ld-numeric.c:319
+#, c-format
+msgid "%s: `-1' must be last entry in `%s' field"
+msgstr "%s-1%s"
 
-#: locale/programs/ld-monetary.c:859 locale/programs/ld-numeric.c:339
+#: locale/programs/ld-monetary.c:859 locale/programs/ld-numeric.c:340
 #, c-format
 msgid "%s: values for field `%s' must be smaller than 127"
 msgstr "%s%s 127"
 
-#: locale/programs/ld-time.c:509
-#, c-format
-msgid "%s: values for field `%s' must not be larger than %d"
-msgstr "%s%s %d"
+#: locale/programs/ld-monetary.c:902
+msgid "conversion rate value cannot be zero"
+msgstr " 0"
 
-#: locale/programs/ld-time.c:493 locale/programs/ld-time.c:501
+#: locale/programs/ld-name.c:130 locale/programs/ld-telephone.c:127
+#: locale/programs/ld-telephone.c:150
 #, c-format
-msgid "%s: values of field `%s' must not be larger than %d"
-msgstr "%s%s %d"
+msgid "%s: invalid escape sequence in field `%s'"
+msgstr "%s%s"
 
-#: locale/programs/ld-collate.c:850
+#: locale/programs/ld-time.c:248
 #, c-format
-msgid "%s: weights must use the same ellipsis symbol as the name"
+msgid "%s: direction flag in string %Zd in `era' field is not '+' nor '-'"
 msgstr ""
 
-#: sunrpc/rpc_main.c:308
+#: locale/programs/ld-time.c:259
 #, c-format
-msgid "%s: while writing output %s: %m"
-msgstr "%s %s %m"
-
-#: argp/argp-parse.c:170
-msgid "(PROGRAM ERROR) No version known!?"
-msgstr "() "
-
-#: argp/argp-parse.c:787
-msgid "(PROGRAM ERROR) Option should have been recognized!?"
-msgstr "() "
-
-#: nis/nis_print.c:133
-msgid "(Unknown object)\n"
-msgstr "()\n"
+msgid "%s: direction flag in string %Zd in `era' field is not a single character"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:133
+#: locale/programs/ld-time.c:272
 #, c-format
-msgid "(unknown authentication error - %d)"
-msgstr "( - %d)"
+msgid "%s: invalid number for offset in string %Zd in `era' field"
+msgstr ""
 
-#: sunrpc/rpcinfo.c:613
-msgid "(unknown)"
-msgstr "()"
+#: locale/programs/ld-time.c:280
+#, c-format
+msgid "%s: garbage at end of offset value in string %Zd in `era' field"
+msgstr ""
 
-#: elf/sprof.c:570
+#: locale/programs/ld-time.c:331
 #, c-format
-msgid "*** The file `%s' is stripped: no detailed analysis possible\n"
-msgstr "*** %s\n"
+msgid "%s: invalid starting date in string %Zd in `era' field"
+msgstr ""
 
-#: catgets/gencat.c:282
-msgid "*standard input*"
-msgstr "**"
+#: locale/programs/ld-time.c:340
+#, c-format
+msgid "%s: garbage at end of starting date in string %Zd in `era' field "
+msgstr ""
 
-#: elf/cache.c:105
+#: locale/programs/ld-time.c:359
 #, c-format
-msgid ", OS ABI: %s %d.%d.%d"
+msgid "%s: starting date is invalid in string %Zd in `era' field"
 msgstr ""
 
-#: catgets/gencat.c:125
-msgid ""
-"-o OUTPUT-FILE [INPUT-FILE]...\n"
-"[OUTPUT-FILE [INPUT-FILE]...]"
+#: locale/programs/ld-time.c:408
+#, c-format
+msgid "%s: invalid stopping date in string %Zd in `era' field"
 msgstr ""
-"-o  []...\n"
-"[ []...]"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:797
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:115
-msgid ".lib section in a.out corrupted"
-msgstr "a.out  .lib "
+#: locale/programs/ld-time.c:417
+#, c-format
+msgid "%s: garbage at end of stopping date in string %Zd in `era' field"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:119 sunrpc/clnt_perr.c:140
+#: locale/programs/ld-time.c:436
 #, c-format
-msgid "; low version = %lu, high version = %lu"
+msgid "%s: stopping date is invalid in string %Zd in `era' field"
 msgstr ""
 
-#: sunrpc/clnt_perr.c:126
-msgid "; why = "
+#: locale/programs/ld-time.c:445
+#, c-format
+msgid "%s: missing era name in string %Zd in `era' field"
 msgstr ""
 
-#: locale/programs/charmap.c:1004
+#: locale/programs/ld-time.c:457
 #, c-format
-msgid "<%s> and <%s> are illegal names for range"
-msgstr "<%s>  <%s> "
+msgid "%s: missing era format in string %Zd in `era' field"
+msgstr ""
 
-#: locale/programs/repertoire.c:448
+#: locale/programs/ld-time.c:486
 #, c-format
-msgid "<%s> and <%s> are invalid names for range"
-msgstr "<%s>  <%s> "
+msgid "%s: third operand for value of field `%s' must not be larger than %d"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:573 locale/programs/ld-ctype.c:608
+#: locale/programs/ld-time.c:494 locale/programs/ld-time.c:502
 #, c-format
-msgid "<SP> character must not be in class `%s'"
-msgstr " <SP> %s"
+msgid "%s: values of field `%s' must not be larger than %d"
+msgstr "%s%s %d"
 
-#: locale/programs/ld-ctype.c:561 locale/programs/ld-ctype.c:597
+#: locale/programs/ld-time.c:510
 #, c-format
-msgid "<SP> character not in class `%s'"
-msgstr " <SP> %s"
+msgid "%s: values for field `%s' must not be larger than %d"
+msgstr "%s%s %d"
 
-#. TRANS The experienced user will know what is wrong.
-#. TRANS @c This error code is a joke.  Its perror text is part of the joke.
-#. TRANS @c Don't change it.
-#: stdio-common/../sysdeps/gnu/errlist.c:622
-msgid "?"
-msgstr ""
+#: locale/programs/ld-time.c:984
+#, c-format
+msgid "%s: too few values for field `%s'"
+msgstr "%s%s"
 
-#: sysdeps/generic/siglist.h:34
-msgid "Aborted"
-msgstr ""
+#: locale/programs/ld-time.c:1029
+msgid "extra trailing semicolon"
+msgstr ""
 
-#: nis/nis_print.c:324
-msgid "Access Rights : "
-msgstr ""
+#: locale/programs/ld-time.c:1032
+#, c-format
+msgid "%s: too many values for field `%s'"
+msgstr "%s%s"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:793
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:114
-msgid "Accessing a corrupted shared library"
-msgstr ""
+#: locale/programs/linereader.c:275
+msgid "garbage at end of number"
+msgstr ""
 
-#. TRANS The requested socket address is already in use.  @xref{Socket Addresses}.
-#: stdio-common/../sysdeps/gnu/errlist.c:367
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:155
-msgid "Address already in use"
-msgstr ""
+#: locale/programs/linereader.c:387
+msgid "garbage at end of character code specification"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:31
-msgid "Address family for hostname not supported"
-msgstr ""
+#: locale/programs/linereader.c:473
+msgid "unterminated symbolic name"
+msgstr ""
 
-#. TRANS The address family specified for a socket is not supported; it is
-#. TRANS inconsistent with the protocol being used on the socket.  @xref{Sockets}.
-#: stdio-common/../sysdeps/gnu/errlist.c:362
-msgid "Address family not supported by protocol"
-msgstr ""
+#: locale/programs/linereader.c:537 catgets/gencat.c:1195
+msgid "invalid escape sequence"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:154
-msgid "Address family not supported by protocol family"
-msgstr ""
+#: locale/programs/linereader.c:600
+msgid "illegal escape sequence at end of string"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:761
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:98
-msgid "Advertise error"
-msgstr ""
+#: locale/programs/linereader.c:604 locale/programs/linereader.c:832
+msgid "unterminated string"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:40 sysdeps/generic/siglist.h:40
-msgid "Alarm clock"
-msgstr ""
+#: locale/programs/linereader.c:646
+msgid "non-symbolic character value should not be used"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:45
-msgid "All requests done"
-msgstr ""
+#: locale/programs/linereader.c:793
+#, c-format
+msgid "symbol `%.*s' not in charmap"
+msgstr ""
 
-#: malloc/memusagestat.c:57
-msgid "Also draw graph for total memory consumption"
+#: locale/programs/linereader.c:814
+#, c-format
+msgid "symbol `%.*s' not in repertoire map"
 msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:83
-msgid "Anode table overflow"
+#: locale/programs/linereader.h:162
+msgid "trailing garbage at end of line"
 msgstr ""
 
-#: intl/tst-gettext2.c:38
-msgid "Another string for testing."
-msgstr ""
+#: locale/programs/locale.c:75
+msgid "System information:"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:37
-msgid "Arg list too long"
-msgstr ""
+#: locale/programs/locale.c:77
+msgid "Write names of available locales"
+msgstr ""
 
-#. TRANS Argument list too long; used when the arguments passed to a new program
-#. TRANS being executed with one of the @code{exec} functions (@pxref{Executing a
-#. TRANS File}) occupy too much memory space.  This condition never arises in the
-#. TRANS GNU system.
-#: stdio-common/../sysdeps/gnu/errlist.c:70
-msgid "Argument list too long"
-msgstr ""
+#: locale/programs/locale.c:79
+msgid "Write names of available charmaps"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:63
-msgid "Argument out of domain"
-msgstr ""
+#: locale/programs/locale.c:80
+msgid "Modify output format:"
+msgstr ""
 
-#: nis/nis_error.c:66
-msgid "Attempt to remove a non-empty table"
-msgstr ""
+#: locale/programs/locale.c:81
+msgid "Write names of selected categories"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:116
-msgid "Attempting to link in more shared libraries than system limit"
-msgstr ""
+#: locale/programs/locale.c:82
+msgid "Write names of selected keywords"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:801
-msgid "Attempting to link in too many shared libraries"
-msgstr ""
+#: locale/programs/locale.c:83
+msgid "Print more information"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:354
-msgid "Authentication OK"
-msgstr ""
+#: locale/programs/locale.c:88
+msgid "Get locale-specific information."
+msgstr ""
 
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:562
-msgid "Authentication error"
-msgstr ""
+#: locale/programs/locale.c:91
+msgid ""
+"NAME\n"
+"[-a|-m]"
+msgstr ""
 
-#: nis/nis_print.c:109
-msgid "BOGUS OBJECT\n"
+#: locale/programs/locale.c:512
+msgid "while preparing output"
+msgstr ""
+
+#: locale/programs/localedef.c:121
+msgid "Input Files:"
+msgstr ""
+
+#: locale/programs/localedef.c:123
+msgid "Symbolic character names defined in FILE"
 msgstr ""
 
-#. TRANS Bad address; an invalid pointer was detected.
-#. TRANS In the GNU system, this error never happens; you get a signal instead.
-#: stdio-common/../sysdeps/gnu/errlist.c:115
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:44
-msgid "Bad address"
-msgstr ""
+#: locale/programs/localedef.c:124
+msgid "Source definitions are found in FILE"
+msgstr " FILE "
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:80
-msgid "Bad exchange descriptor"
-msgstr ""
+#: locale/programs/localedef.c:126
+msgid "FILE contains mapping from symbolic names to UCS4 values"
+msgstr ""
 
-#. TRANS Bad file descriptor; for example, I/O on a descriptor that has been
-#. TRANS closed or reading from a descriptor open only for writing (or vice
-#. TRANS versa).
-#: stdio-common/../sysdeps/gnu/errlist.c:83
-msgid "Bad file descriptor"
-msgstr ""
+#: locale/programs/localedef.c:130
+msgid "Create output even if warning messages were issued"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:39
-msgid "Bad file number"
-msgstr ""
+#: locale/programs/localedef.c:131
+msgid "Create old-style tables"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:749
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:87
-msgid "Bad font file format"
-msgstr ""
+#: locale/programs/localedef.c:132
+msgid "Optional output file prefix"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:641
-msgid "Bad message"
-msgstr ""
+#: locale/programs/localedef.c:133
+msgid "Be strictly POSIX conform"
+msgstr " POSIX"
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:84
-msgid "Bad request code"
-msgstr ""
+#: locale/programs/localedef.c:135
+msgid "Suppress warnings and information messages"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:81
-msgid "Bad request descriptor"
-msgstr ""
+#: locale/programs/localedef.c:136
+msgid "Print more messages"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:38 sysdeps/generic/siglist.h:63
-msgid "Bad system call"
-msgstr ""
+#: locale/programs/localedef.c:137
+msgid "Archive control:"
+msgstr ""
+
+#: locale/programs/localedef.c:139
+msgid "Don't add new data to archive"
+msgstr ""
+
+#: locale/programs/localedef.c:141
+msgid "Add locales named by parameters to archive"
+msgstr ""
+
+#: locale/programs/localedef.c:142
+msgid "Replace existing archive content"
+msgstr ""
+
+#: locale/programs/localedef.c:144
+msgid "Remove locales named by parameters from archive"
+msgstr ""
+
+#: locale/programs/localedef.c:145
+msgid "List content of archive"
+msgstr ""
+
+#: locale/programs/localedef.c:147
+msgid "locale.alias file to consult when making archive"
+msgstr " locale.alias "
 
-#: posix/../sysdeps/posix/gai_strerror.c:33
-msgid "Bad value for ai_flags"
-msgstr " ai_flags "
+#: locale/programs/localedef.c:152
+msgid "Compile locale specification"
+msgstr ""
 
-#: locale/programs/localedef.c:104
-msgid "Be strictly POSIX conform"
-msgstr " POSIX"
+#: locale/programs/localedef.c:155
+msgid ""
+"NAME\n"
+"[--add-to-archive|--delete-from-archive] FILE...\n"
+"--list-archive [FILE]"
+msgstr ""
+"\n"
+"[--add-to-archive|--delete-from-archive] ...\n"
+"--list-archive []"
+
+#: locale/programs/localedef.c:233
+msgid "cannot create directory for output files"
+msgstr ""
 
-#: nis/nis_print.c:305
-msgid "Binary data\n"
-msgstr "\n"
+#: locale/programs/localedef.c:244
+msgid "FATAL: system does not define `_POSIX2_LOCALEDEF'"
+msgstr "_POSIX2_LOCALEDEF"
 
-#. TRANS A file that isn't a block special file was given in a situation that
-#. TRANS requires one.  For example, trying to mount an ordinary file as a file
-#. TRANS system in Unix gives this error.
-#: stdio-common/../sysdeps/gnu/errlist.c:122
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:45
-msgid "Block device required"
-msgstr ""
+#: locale/programs/localedef.c:258 locale/programs/localedef.c:274
+#: locale/programs/localedef.c:599 locale/programs/localedef.c:619
+#, c-format
+msgid "cannot open locale definition file `%s'"
+msgstr "%s"
 
-#: sunrpc/pmap_rmt.c:348
-msgid "Broadcast poll problem"
+#: locale/programs/localedef.c:286
+#, c-format
+msgid "cannot write output files to `%s'"
+msgstr "%s"
+
+#: locale/programs/localedef.c:367
+#, c-format
+msgid ""
+"System's directory for character maps : %s\n"
+"                       repertoire maps: %s\n"
+"                       locale path    : %s\n"
+"%s"
 msgstr ""
 
-#. TRANS Broken pipe; there is no process reading from the other end of a pipe.
-#. TRANS Every library function that returns this error code also generates a
-#. TRANS @code{SIGPIPE} signal; this signal terminates the program if not handled
-#. TRANS or blocked.  Thus, your program will never actually see @code{EPIPE}
-#. TRANS unless it has handled or blocked @code{SIGPIPE}.
-#: stdio-common/../sysdeps/gnu/errlist.c:235
-#: stdio-common/../sysdeps/unix/siglist.c:39
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:62
-#: sysdeps/generic/siglist.h:39
-msgid "Broken pipe"
-msgstr ""
+#: locale/programs/localedef.c:567
+msgid "circular dependencies between locale definitions"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:36 sysdeps/generic/siglist.h:37
-msgid "Bus error"
-msgstr ""
+#: locale/programs/localedef.c:573
+#, c-format
+msgid "cannot add already read locale `%s' a second time"
+msgstr "%s"
 
-#: stdio-common/../sysdeps/unix/siglist.c:50 sysdeps/generic/siglist.h:50
-msgid "CPU time limit exceeded"
-msgstr " CPU "
+#: locale/programs/locarchive.c:89 locale/programs/locarchive.c:259
+msgid "cannot create temporary file"
+msgstr ""
 
-#: nis/nis_error.c:33
-msgid "Cache expired"
-msgstr ""
+#: locale/programs/locarchive.c:118 locale/programs/locarchive.c:305
+msgid "cannot initialize archive file"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:789
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:113
-msgid "Can not access a needed shared library"
-msgstr ""
+#: locale/programs/locarchive.c:125 locale/programs/locarchive.c:312
+msgid "cannot resize archive file"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:117
-msgid "Can not exec a shared library directly"
-msgstr ""
+#: locale/programs/locarchive.c:134 locale/programs/locarchive.c:321
+#: locale/programs/locarchive.c:511
+msgid "cannot map archive header"
+msgstr ""
 
-#: nis/ypclnt.c:794
-msgid "Can't bind to server which serves this domain"
-msgstr ""
+#: locale/programs/locarchive.c:156
+msgid "failed to create new locale archive"
+msgstr ""
 
-#: elf/ldconfig.c:1008
-msgid "Can't chdir to /"
-msgstr ""
+#: locale/programs/locarchive.c:168
+msgid "cannot change mode of new locale archive"
+msgstr ""
 
-#: nis/ypclnt.c:806
-msgid "Can't communicate with portmapper"
-msgstr " portmapper "
+#: locale/programs/locarchive.c:253
+msgid "cannot map locale archive file"
+msgstr ""
 
-#: nis/ypclnt.c:808
-msgid "Can't communicate with ypbind"
-msgstr " ypbind "
+#: locale/programs/locarchive.c:329
+msgid "cannot lock new archive"
+msgstr ""
 
-#: nis/ypclnt.c:810
-msgid "Can't communicate with ypserv"
-msgstr " ypserv "
+#: locale/programs/locarchive.c:380
+msgid "cannot extend locale archive file"
+msgstr ""
+
+#: locale/programs/locarchive.c:389
+msgid "cannot change mode of resized locale archive"
+msgstr ""
+
+#: locale/programs/locarchive.c:397
+msgid "cannot rename new archive"
+msgstr ""
 
-#: elf/cache.c:394
+#: locale/programs/locarchive.c:450
 #, c-format
-msgid "Can't create temporary cache file %s"
-msgstr " %s"
+msgid "cannot open locale archive \"%s\""
+msgstr "%s"
 
-#: elf/ldconfig.c:512
+#: locale/programs/locarchive.c:455
 #, c-format
-msgid "Can't find %s"
-msgstr " %s"
+msgid "cannot stat locale archive \"%s\""
+msgstr "%s stat() "
 
-#: elf/ldconfig.c:449
+#: locale/programs/locarchive.c:474
 #, c-format
-msgid "Can't link %s to %s"
-msgstr " %s  %s"
+msgid "cannot lock locale archive \"%s\""
+msgstr "%s"
 
-#: elf/ldconfig.c:528
+#: locale/programs/locarchive.c:497
+msgid "cannot read archive header"
+msgstr ""
+
+#: locale/programs/locarchive.c:557
 #, c-format
-msgid "Can't lstat %s"
-msgstr " %s  lstat "
+msgid "locale '%s' already exists"
+msgstr "%s"
+
+#: locale/programs/locarchive.c:788 locale/programs/locarchive.c:803
+#: locale/programs/locarchive.c:815 locale/programs/locarchive.c:827
+#: locale/programs/locfile.c:343
+msgid "cannot add to locale archive"
+msgstr ""
 
-#: elf/cache.c:131 elf/ldconfig.c:1029
+#: locale/programs/locarchive.c:982
 #, c-format
-msgid "Can't open cache file %s\n"
-msgstr " %s\n"
+msgid "locale alias file `%s' not found"
+msgstr "%s"
 
-#: elf/ldconfig.c:1050
+#: locale/programs/locarchive.c:1126
 #, c-format
-msgid "Can't open cache file directory %s\n"
-msgstr " %s\n"
+msgid "Adding %s\n"
+msgstr " %s\n"
 
-#: elf/ldconfig.c:924
+#: locale/programs/locarchive.c:1132
 #, c-format
-msgid "Can't open configuration file %s"
-msgstr " %s"
+msgid "stat of \"%s\" failed: %s: ignored"
+msgstr "%s stat%s"
 
-#: elf/ldconfig.c:634
+#: locale/programs/locarchive.c:1138
 #, c-format
-msgid "Can't open directory %s"
-msgstr " %s"
+msgid "\"%s\" is no directory; ignored"
+msgstr "%s"
 
-#: elf/cache.c:387
+#: locale/programs/locarchive.c:1145
 #, c-format
-msgid "Can't remove old temporary cache file %s"
-msgstr " %s"
+msgid "cannot open directory \"%s\": %s: ignored"
+msgstr "%s%s"
 
-#: elf/ldconfig.c:344
+#: locale/programs/locarchive.c:1217
 #, c-format
-msgid "Can't stat %s"
-msgstr " %s  stat "
+msgid "incomplete set of locale files in \"%s\""
+msgstr "%s"
 
-#: elf/ldconfig.c:414
+#: locale/programs/locarchive.c:1281
 #, c-format
-msgid "Can't stat %s\n"
-msgstr " %s  stat \n"
+msgid "cannot read all files in \"%s\": ignored"
+msgstr "%s"
 
-#: elf/ldconfig.c:443
+#: locale/programs/locarchive.c:1351
 #, c-format
-msgid "Can't unlink %s"
-msgstr ""
-
-#. TRANS No memory available.  The system cannot allocate more virtual memory
-#. TRANS because its capacity is full.
-#: stdio-common/../sysdeps/gnu/errlist.c:104
-msgid "Cannot allocate memory"
-msgstr ""
-
-#. TRANS The requested socket address is not available; for example, you tried
-#. TRANS to give a socket a name that doesn't match the local host name.
-#. TRANS @xref{Socket Addresses}.
-#: stdio-common/../sysdeps/gnu/errlist.c:374
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:156
-msgid "Cannot assign requested address"
-msgstr ""
-
-#: sunrpc/pmap_rmt.c:265
-msgid "Cannot create socket for broadcast rpc"
-msgstr " rpc "
-
-#: stdio-common/../sysdeps/gnu/errlist.c:805
-msgid "Cannot exec a shared library directly"
-msgstr ""
+msgid "locale \"%s\" not in archive"
+msgstr "%s"
 
-#: elf/readlib.c:99
+#: locale/programs/locfile.c:132
 #, c-format
-msgid "Cannot fstat file %s.\n"
-msgstr " %s  fstat \n"
+msgid "argument to `%s' must be a single character"
+msgstr "%s"
 
-#: sunrpc/rpc_main.c:1417
-msgid "Cannot have more than one file generation flag!\n"
-msgstr "\n"
+#: locale/programs/locfile.c:251
+msgid "syntax error: not inside a locale definition section"
+msgstr ""
 
-#: elf/ldconfig.c:689 elf/ldconfig.c:732
+#: locale/programs/locfile.c:625
 #, c-format
-msgid "Cannot lstat %s"
-msgstr " %s  lstat "
+msgid "cannot open output file `%s' for category `%s'"
+msgstr "%2$s%1$s"
 
-#: elf/readlib.c:118
+#: locale/programs/locfile.c:649
 #, c-format
-msgid "Cannot mmap file %s.\n"
-msgstr " %s  mmap \n"
-
-#: sunrpc/pmap_rmt.c:361
-msgid "Cannot receive reply to broadcast"
-msgstr ""
-
-#: sunrpc/pmap_clnt.c:136
-msgid "Cannot register service"
-msgstr ""
-
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:173
-msgid "Cannot send after socket shutdown"
-msgstr ""
+msgid "failure while writing data for category `%s'"
+msgstr "%s"
 
-#. TRANS The socket has already been shut down.
-#: stdio-common/../sysdeps/gnu/errlist.c:435
-msgid "Cannot send after transport endpoint shutdown"
-msgstr ""
+#: locale/programs/locfile.c:745
+#, c-format
+msgid "cannot create output file `%s' for category `%s'"
+msgstr "%2$s%1$s"
 
-#: sunrpc/pmap_rmt.c:323
-msgid "Cannot send broadcast packet"
-msgstr ""
+#: locale/programs/locfile.h:59
+msgid "expect string argument for `copy'"
+msgstr "copy"
 
-#: sunrpc/pmap_rmt.c:272
-msgid "Cannot set socket option SO_BROADCAST"
-msgstr " SO_BROADCAST"
+#: locale/programs/locfile.h:63
+msgid "locale name should consist only of portable characters"
+msgstr ""
 
-#: sunrpc/rpc_main.c:1195
-msgid "Cannot specify more than one input file!\n"
-msgstr "\n"
+#: locale/programs/locfile.h:82
+msgid "no other keyword shall be specified when `copy' is used"
+msgstr "copy"
 
-#: elf/ldconfig.c:701
+#: locale/programs/repertoire.c:230 locale/programs/repertoire.c:271
+#: locale/programs/repertoire.c:296
 #, c-format
-msgid "Cannot stat %s"
-msgstr " %s  stat "
-
-#: sunrpc/rpc_main.c:1374
-msgid "Cannot use netid flag with inetd flag!\n"
-msgstr " inetd  netid \n"
-
-#: sunrpc/rpc_main.c:1386
-msgid "Cannot use netid flag without TIRPC!\n"
-msgstr " TIRPC  netid \n"
+msgid "syntax error in repertoire map definition: %s"
+msgstr ""
 
-#: sunrpc/rpc_main.c:1393
-msgid "Cannot use table flags with newstyle!\n"
-msgstr "\n"
+#: locale/programs/repertoire.c:272
+msgid "no <Uxxxx> or <Uxxxxxxxx> value given"
+msgstr " <Uxxxx>  <Uxxxxxxxx>"
 
-#: elf/ldconfig.c:126
-msgid "Change to and use ROOT as root directory"
-msgstr " ROOT "
+#: locale/programs/repertoire.c:332
+msgid "cannot safe new repertoire map"
+msgstr ""
 
-#: elf/cache.c:426
+#: locale/programs/repertoire.c:343
 #, c-format
-msgid "Changing access rights of %s to %#o failed"
-msgstr " %s  %#o "
-
-#: stdio-common/../sysdeps/gnu/errlist.c:689
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:67
-msgid "Channel number out of range"
+msgid "repertoire map file `%s' not found"
 msgstr ""
 
-#: nis/nis_print.c:268
+#: locale/programs/repertoire.c:450
 #, c-format
-msgid "Character Separator : %c\n"
-msgstr "%c\n"
+msgid "<%s> and <%s> are invalid names for range"
+msgstr "<%s>  <%s> "
 
-#: stdio-common/../sysdeps/unix/siglist.c:46 sysdeps/generic/siglist.h:46
-msgid "Child exited"
-msgstr ""
+#: locale/programs/repertoire.c:457
+msgid "upper limit in range is not smaller then lower limit"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:373
-msgid "Client credential too weak"
-msgstr ""
+#: locale/programs/xmalloc.c:70 malloc/obstack.c:505 malloc/obstack.c:508
+#: posix/getconf.c:1002
+msgid "memory exhausted"
+msgstr ""
 
-#: nis/nis_print.c:270
-msgid "Columns             :\n"
-msgstr ""
+#: assert/assert-perr.c:57
+#, c-format
+msgid "%s%s%s:%u: %s%sUnexpected error: %s.\n"
+msgstr "%s%s%s%u%s%s%s\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:769
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:100
-msgid "Communication error on send"
-msgstr ""
+#: assert/assert.c:56
+#, c-format
+msgid "%s%s%s:%u: %s%sAssertion `%s' failed.\n"
+msgstr "%s%s%s%u%s%s%s\n"
 
-#: locale/programs/localedef.c:112
-msgid "Compile locale specification"
-msgstr ""
+#: intl/tst-codeset.c:40 intl/tst-codeset.c:50
+msgid "cheese"
+msgstr ""
 
-#. TRANS Go home and have a glass of warm, dairy-fresh milk.
-#: stdio-common/../sysdeps/gnu/errlist.c:632
-msgid "Computer bought the farm"
-msgstr ""
+#: intl/tst-gettext2.c:37
+msgid "First string for testing."
+msgstr ""
 
-#: elf/ldconfig.c:136
-msgid "Configure Dynamic Linker Run Time Bindings."
-msgstr ""
+#: intl/tst-gettext2.c:38
+msgid "Another string for testing."
+msgstr ""
 
-#. TRANS A remote host refused to allow the network connection (typically because
-#. TRANS it is not running the requested service).
-#: stdio-common/../sysdeps/gnu/errlist.c:452
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:176
-msgid "Connection refused"
-msgstr ""
+#: catgets/gencat.c:111 catgets/gencat.c:115 nscd/nscd.c:84
+msgid "NAME"
+msgstr ""
 
-#. TRANS A network connection was closed for reasons outside the control of the
-#. TRANS local host, such as by the remote machine rebooting or an unrecoverable
-#. TRANS protocol violation.
-#: stdio-common/../sysdeps/gnu/errlist.c:402
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:161
-msgid "Connection reset by peer"
-msgstr ""
+#: catgets/gencat.c:112
+msgid "Create C header file NAME containing symbol definitions"
+msgstr " C "
 
-#. TRANS A socket operation with a specified timeout received no response during
-#. TRANS the timeout period.
-#: stdio-common/../sysdeps/gnu/errlist.c:446
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:175
-msgid "Connection timed out"
-msgstr ""
+#: catgets/gencat.c:114
+msgid "Do not use existing catalog, force new output file"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:45 sysdeps/generic/siglist.h:45
-msgid "Continued"
-msgstr ""
+#: catgets/gencat.c:115
+msgid "Write output to file NAME"
+msgstr ""
 
-#: iconv/iconv_prog.c:73
-msgid "Convert encoding of given files from one encoding to another."
+#: catgets/gencat.c:120
+msgid ""
+"Generate message catalog.If INPUT-FILE is -, input is read from standard input.  If OUTPUT-FILE\n"
+"is -, output is written to standard output.\n"
 msgstr ""
 
-#: catgets/gencat.c:246 elf/ldconfig.c:259 elf/sprof.c:355
-#: iconv/iconv_prog.c:393 iconv/iconvconfig.c:335 locale/programs/locale.c:281
-#: locale/programs/localedef.c:311 nscd/nscd.c:287 nscd/nscd_nischeck.c:90
-#: nss/getent.c:63 posix/getconf.c:904
-#, c-format
+#: catgets/gencat.c:125
 msgid ""
-"Copyright (C) %s Free Software Foundation, Inc.\n"
-"This is free software; see the source for copying conditions.  There is NO\n"
-"warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n"
+"-o OUTPUT-FILE [INPUT-FILE]...\n"
+"[OUTPUT-FILE [INPUT-FILE]...]"
 msgstr ""
+"-o  []...\n"
+"[ []...]"
 
-#: nscd/nscd_conf.c:166
-#, c-format
-msgid "Could not create log file \"%s\""
-msgstr "%s"
+#: catgets/gencat.c:282
+msgid "*standard input*"
+msgstr "**"
 
-#: catgets/gencat.c:112
-msgid "Create C header file NAME containing symbol definitions"
-msgstr ""
+#: catgets/gencat.c:417 catgets/gencat.c:494
+msgid "illegal set number"
+msgstr ""
 
-#: iconv/iconvconfig.c:110
-msgid "Create fastloading iconv module configuration file."
-msgstr " iconv "
+#: catgets/gencat.c:444
+msgid "duplicate set definition"
+msgstr ""
 
-#: locale/programs/localedef.c:102
-msgid "Create old-style tables"
-msgstr ""
+#: catgets/gencat.c:446 catgets/gencat.c:623 catgets/gencat.c:677
+msgid "this is the first definition"
+msgstr ""
 
-#: locale/programs/localedef.c:101
-msgid "Create output even if warning messages were issued"
-msgstr ""
+#: catgets/gencat.c:522
+#, c-format
+msgid "unknown set `%s'"
+msgstr "%s"
 
-#: nis/nis_print.c:329
+#: catgets/gencat.c:563
+msgid "invalid quote character"
+msgstr ""
+
+#: catgets/gencat.c:576
 #, c-format
-msgid "Creation Time : %s"
-msgstr "%s"
+msgid "unknown directive `%s': line ignored"
+msgstr "%s"
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:48
-msgid "Cross-device link"
-msgstr ""
+#: catgets/gencat.c:621
+msgid "duplicated message number"
+msgstr ""
 
-#: malloc/memusagestat.c:67
-msgid "DATAFILE [OUTFILE]"
-msgstr " []"
+#: catgets/gencat.c:674
+msgid "duplicated message identifier"
+msgstr ""
 
-#: nis/nss_nisplus/nisplus-publickey.c:96
-#: nis/nss_nisplus/nisplus-publickey.c:172
-#, c-format
-msgid "DES entry for netname %s not unique\n"
-msgstr ""
+#: catgets/gencat.c:731
+msgid "invalid character: message ignored"
+msgstr ""
 
-#: nis/nis_print.c:115
-msgid "DIRECTORY\n"
-msgstr "\n"
+#: catgets/gencat.c:774
+msgid "invalid line"
+msgstr ""
 
-#: elf/dl-deps.c:101 elf/dl-open.c:188
-msgid "DST not allowed in SUID/SGID programs"
+#: catgets/gencat.c:828
+msgid "malformed line ignored"
 msgstr ""
 
-#: elf/dl-error.c:71
-msgid "DYNAMIC LINKER BUG!!!"
-msgstr ""
+#: catgets/gencat.c:992 catgets/gencat.c:1033
+#, c-format
+msgid "cannot open output file `%s'"
+msgstr "%s"
 
-#: nis/nis_error.c:52
-msgid "Database for table does not exist"
-msgstr ""
+#: catgets/gencat.c:1217
+msgid "unterminated message"
+msgstr ""
 
-#: nis/ypclnt.c:820
-msgid "Database is busy"
-msgstr ""
+#: catgets/gencat.c:1241
+msgid "while opening old catalog file"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:75
-msgid "Deadlock situation detected/avoided"
-msgstr ""
-
-#: nis/nis_print.c:229
-msgid "Default Access rights :\n"
-msgstr " \n"
-
-#. TRANS No default destination address was set for the socket.  You get this
-#. TRANS error when you try to transmit data over a connectionless socket,
-#. TRANS without first specifying a destination for the data with @code{connect}.
-#: stdio-common/../sysdeps/gnu/errlist.c:430
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:126
-msgid "Destination address required"
-msgstr ""
-
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:46
-msgid "Device busy"
-msgstr ""
-
-#: stdio-common/../sysdeps/gnu/errlist.c:669
-msgid "Device not a stream"
-msgstr ""
-
-#. TRANS Resource busy; a system resource that can't be shared is already in use.
-#. TRANS For example, if you try to delete a file that is the root of a currently
-#. TRANS mounted filesystem, you get this error.
-#: stdio-common/../sysdeps/gnu/errlist.c:129
-msgid "Device or resource busy"
-msgstr ""
-
-#: nis/nis_print.c:183
-#, c-format
-msgid "Diffie-Hellmann (%d bits)\n"
-msgstr ""
-
-#: nis/nis_print.c:321
-#, c-format
-msgid "Directory     : %s\n"
-msgstr "     %s\n"
-
-#. TRANS Directory not empty, where an empty directory was expected.  Typically,
-#. TRANS this error occurs when you are trying to delete a directory.
-#: stdio-common/../sysdeps/gnu/errlist.c:481
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:123
-msgid "Directory not empty"
-msgstr ""
-
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:79
-msgid "Disc quota exceeded"
-msgstr ""
-
-#. TRANS The user's disk quota was exceeded.
-#: stdio-common/../sysdeps/gnu/errlist.c:499
-msgid "Disk quota exceeded"
-msgstr ""
-
-#: nscd/nscd.c:86
-msgid "Do not fork and display messages on the current tty"
-msgstr ""
-
-#: catgets/gencat.c:114
-msgid "Do not use existing catalog, force new output file"
-msgstr ""
-
-#: nis/ypclnt.c:866
-msgid "Domain not bound"
-msgstr ""
+#: catgets/gencat.c:1332
+msgid "conversion modules not available"
+msgstr ""
 
-#: elf/ldconfig.c:124
-msgid "Don't build cache"
-msgstr ""
+#: catgets/gencat.c:1358
+msgid "cannot determine escape character"
+msgstr ""
 
-#: elf/ldconfig.c:125
-msgid "Don't generate links"
-msgstr ""
+#: stdlib/../sysdeps/unix/sysv/linux/ia64/makecontext.c:63
+msgid "makecontext: does not know how to handle more than 8 arguments\n"
+msgstr "makecontext 8 \n"
 
-#: debug/pcprofiledump.c:56
-msgid "Dump information generated by PC profiling."
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:12 posix/regcomp.c:133
+#: nis/nis_error.c:29 nis/ypclnt.c:787 nis/ypclnt.c:861
+msgid "Success"
+msgstr ""
 
-#: elf/dl-load.c:1293
-msgid "ELF file ABI version invalid"
-msgstr ""
+#. TRANS Operation not permitted; only the owner of the file (or other resource)
+#. TRANS or processes with special privileges can perform the operation.
+#: stdio-common/../sysdeps/gnu/errlist.c:17
+msgid "Operation not permitted"
+msgstr ""
 
-#: elf/dl-load.c:1290
-msgid "ELF file OS ABI invalid"
-msgstr ""
+#. TRANS No such file or directory.  This is a ``file doesn't exist'' error
+#. TRANS for ordinary files that are referenced in contexts where they are
+#. TRANS expected to already exist.
+#: stdio-common/../sysdeps/gnu/errlist.c:28
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:32
+msgid "No such file or directory"
+msgstr ""
 
-#: elf/dl-load.c:1299
-msgid "ELF file version does not match current one"
-msgstr "ELF "
+#. TRANS No process matches the specified process ID.
+#: stdio-common/../sysdeps/gnu/errlist.c:37
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:33
+msgid "No such process"
+msgstr ""
 
-#: elf/dl-load.c:1286
-msgid "ELF file version ident does not match current one"
-msgstr ""
+#. TRANS Interrupted function call; an asynchronous signal occurred and prevented
+#. TRANS completion of the call.  When this happens, you should try the call
+#. TRANS again.
+#. TRANS
+#. TRANS You can choose to have functions resume after a signal that is handled,
+#. TRANS rather than failing with @code{EINTR}; see @ref{Interrupted
+#. TRANS Primitives}.
+#: stdio-common/../sysdeps/gnu/errlist.c:52
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:34
+msgid "Interrupted system call"
+msgstr ""
 
-#: elf/dl-load.c:1305
-msgid "ELF file's phentsize not the expected size"
-msgstr ""
+#. TRANS Input/output error; usually used for physical read or write errors.
+#: stdio-common/../sysdeps/gnu/errlist.c:61
+msgid "Input/output error"
+msgstr "/"
 
-#: elf/dl-load.c:884
-msgid "ELF load command address/offset not properly aligned"
-msgstr "ELF /"
+#. TRANS No such device or address.  The system tried to use the device
+#. TRANS represented by a file you specified, and it couldn't find the device.
+#. TRANS This can mean that the device file was installed incorrectly, or that
+#. TRANS the physical device is missing or not correctly attached to the
+#. TRANS computer.
+#: stdio-common/../sysdeps/gnu/errlist.c:74
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:36
+msgid "No such device or address"
+msgstr ""
 
-#: elf/dl-load.c:881
-msgid "ELF load command alignment not page-aligned"
-msgstr ""
+#. TRANS Argument list too long; used when the arguments passed to a new program
+#. TRANS being executed with one of the @code{exec} functions (@pxref{Executing a
+#. TRANS File}) occupy too much memory space.  This condition never arises in the
+#. TRANS GNU system.
+#: stdio-common/../sysdeps/gnu/errlist.c:86
+msgid "Argument list too long"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:33 sysdeps/generic/siglist.h:60
-msgid "EMT trap"
-msgstr ""
+#. TRANS Invalid executable file format.  This condition is detected by the
+#. TRANS @code{exec} functions; see @ref{Executing a File}.
+#: stdio-common/../sysdeps/gnu/errlist.c:96
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:38
+msgid "Exec format error"
+msgstr ""
 
-#: nis/nis_print.c:124
-msgid "ENTRY\n"
-msgstr ""
+#. TRANS Bad file descriptor; for example, I/O on a descriptor that has been
+#. TRANS closed or reading from a descriptor open only for writing (or vice
+#. TRANS versa).
+#: stdio-common/../sysdeps/gnu/errlist.c:107
+msgid "Bad file descriptor"
+msgstr ""
 
-#: nis/nis_print.c:303
-msgid "Encrypted data\n"
-msgstr "\n"
+#. TRANS There are no child processes.  This error happens on operations that are
+#. TRANS supposed to manipulate child processes, when there aren't any processes
+#. TRANS to manipulate.
+#: stdio-common/../sysdeps/gnu/errlist.c:118
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:40
+msgid "No child processes"
+msgstr ""
 
-#: nis/nis_error.c:53
-msgid "Entry/table type mismatch"
-msgstr "/"
+#. TRANS Deadlock avoided; allocating a system resource would have resulted in a
+#. TRANS deadlock situation.  The system does not guarantee that it will notice
+#. TRANS all such situations.  This error means you got lucky and the system
+#. TRANS noticed; it might just hang.  @xref{File Locks}, for an example.
+#: stdio-common/../sysdeps/gnu/errlist.c:130
+msgid "Resource deadlock avoided"
+msgstr ""
 
-#: nss/getent.c:127 nss/getent.c:292
-#, c-format
-msgid "Enumeration not supported on %s\n"
-msgstr ""
+#. TRANS No memory available.  The system cannot allocate more virtual memory
+#. TRANS because its capacity is full.
+#: stdio-common/../sysdeps/gnu/errlist.c:140
+msgid "Cannot allocate memory"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:30
-msgid "Error 0"
-msgstr " 0"
+#. TRANS Permission denied; the file permissions do not allow the attempted operation.
+#: stdio-common/../sysdeps/gnu/errlist.c:149
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:43
+#: nis/nis_error.c:39 nis/ypclnt.c:817
+msgid "Permission denied"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:130
-msgid "Error 100"
-msgstr " 100"
+#. TRANS Bad address; an invalid pointer was detected.
+#. TRANS In the GNU system, this error never happens; you get a signal instead.
+#: stdio-common/../sysdeps/gnu/errlist.c:159
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:44
+msgid "Bad address"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:131
-msgid "Error 101"
-msgstr " 101"
+#. TRANS A file that isn't a block special file was given in a situation that
+#. TRANS requires one.  For example, trying to mount an ordinary file as a file
+#. TRANS system in Unix gives this error.
+#: stdio-common/../sysdeps/gnu/errlist.c:170
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:45
+msgid "Block device required"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:132
-msgid "Error 102"
-msgstr " 102"
+#. TRANS Resource busy; a system resource that can't be shared is already in use.
+#. TRANS For example, if you try to delete a file that is the root of a currently
+#. TRANS mounted filesystem, you get this error.
+#: stdio-common/../sysdeps/gnu/errlist.c:181
+msgid "Device or resource busy"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:133
-msgid "Error 103"
-msgstr " 103"
+#. TRANS File exists; an existing file was specified in a context where it only
+#. TRANS makes sense to specify a new file.
+#: stdio-common/../sysdeps/gnu/errlist.c:191
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:47
+msgid "File exists"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:134
-msgid "Error 104"
-msgstr " 104"
+#. TRANS An attempt to make an improper link across file systems was detected.
+#. TRANS This happens not only when you use @code{link} (@pxref{Hard Links}) but
+#. TRANS also when you rename a file with @code{rename} (@pxref{Renaming Files}).
+#: stdio-common/../sysdeps/gnu/errlist.c:202
+msgid "Invalid cross-device link"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:135
-msgid "Error 105"
-msgstr " 105"
+#. TRANS The wrong type of device was given to a function that expects a
+#. TRANS particular sort of device.
+#: stdio-common/../sysdeps/gnu/errlist.c:212
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:49
+msgid "No such device"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:136
-msgid "Error 106"
-msgstr " 106"
+#. TRANS A file that isn't a directory was specified when a directory is required.
+#: stdio-common/../sysdeps/gnu/errlist.c:221
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:50
+msgid "Not a directory"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:137
-msgid "Error 107"
-msgstr " 107"
+#. TRANS File is a directory; you cannot open a directory for writing,
+#. TRANS or create or remove hard links to it.
+#: stdio-common/../sysdeps/gnu/errlist.c:231
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:51
+msgid "Is a directory"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:138
-msgid "Error 108"
-msgstr " 108"
+#. TRANS Invalid argument.  This is used to indicate various kinds of problems
+#. TRANS with passing the wrong argument to a library function.
+#: stdio-common/../sysdeps/gnu/errlist.c:241
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:52
+msgid "Invalid argument"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:139
-msgid "Error 109"
-msgstr " 109"
+#. TRANS The current process has too many files open and can't open any more.
+#. TRANS Duplicate descriptors do count toward this limit.
+#. TRANS
+#. TRANS In BSD and GNU, the number of open files is controlled by a resource
+#. TRANS limit that can usually be increased.  If you get this error, you might
+#. TRANS want to increase the @code{RLIMIT_NOFILE} limit or make it unlimited;
+#. TRANS @pxref{Limits on Resources}.
+#: stdio-common/../sysdeps/gnu/errlist.c:256
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:54
+msgid "Too many open files"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:140
-msgid "Error 110"
-msgstr " 110"
+#. TRANS There are too many distinct file openings in the entire system.  Note
+#. TRANS that any number of linked channels count as just one file opening; see
+#. TRANS @ref{Linked Channels}.  This error never occurs in the GNU system.
+#: stdio-common/../sysdeps/gnu/errlist.c:267
+msgid "Too many open files in system"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:141
-msgid "Error 111"
-msgstr " 111"
+#. TRANS Inappropriate I/O control operation, such as trying to set terminal
+#. TRANS modes on an ordinary file.
+#: stdio-common/../sysdeps/gnu/errlist.c:277
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:55
+msgid "Inappropriate ioctl for device"
+msgstr " ioctl "
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:142
-msgid "Error 112"
-msgstr " 112"
+#. TRANS An attempt to execute a file that is currently open for writing, or
+#. TRANS write to a file that is currently being executed.  Often using a
+#. TRANS debugger to run a program is considered having it open for writing and
+#. TRANS will cause this error.  (The name stands for ``text file busy''.)  This
+#. TRANS is not an error in the GNU system; the text is copied as necessary.
+#: stdio-common/../sysdeps/gnu/errlist.c:290
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:56
+msgid "Text file busy"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:143
-msgid "Error 113"
-msgstr " 113"
+#. TRANS File too big; the size of a file would be larger than allowed by the system.
+#: stdio-common/../sysdeps/gnu/errlist.c:299
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:57
+msgid "File too large"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:144
-msgid "Error 114"
-msgstr " 114"
+#. TRANS No space left on device; write operation on a file failed because the
+#. TRANS disk is full.
+#: stdio-common/../sysdeps/gnu/errlist.c:309
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:58
+msgid "No space left on device"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:145
-msgid "Error 115"
-msgstr " 115"
+#. TRANS Invalid seek operation (such as on a pipe).
+#: stdio-common/../sysdeps/gnu/errlist.c:318
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:59
+msgid "Illegal seek"
+msgstr " seek "
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:146
-msgid "Error 116"
-msgstr " 116"
+#. TRANS An attempt was made to modify something on a read-only file system.
+#: stdio-common/../sysdeps/gnu/errlist.c:327
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:60
+msgid "Read-only file system"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:147
-msgid "Error 117"
-msgstr " 117"
+#. TRANS Too many links; the link count of a single file would become too large.
+#. TRANS @code{rename} can cause this error if the file being renamed already has
+#. TRANS as many links as it can take (@pxref{Renaming Files}).
+#: stdio-common/../sysdeps/gnu/errlist.c:338
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:61
+msgid "Too many links"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:148
-msgid "Error 118"
-msgstr " 118"
+#. TRANS Domain error; used by mathematical functions when an argument value does
+#. TRANS not fall into the domain over which the function is defined.
+#: stdio-common/../sysdeps/gnu/errlist.c:361
+msgid "Numerical argument out of domain"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:149
-msgid "Error 119"
-msgstr " 119"
+#. TRANS Range error; used by mathematical functions when the result value is
+#. TRANS not representable because of overflow or underflow.
+#: stdio-common/../sysdeps/gnu/errlist.c:371
+msgid "Numerical result out of range"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:166
-msgid "Error 136"
-msgstr " 136"
+#. TRANS Resource temporarily unavailable; the call might work if you try again
+#. TRANS later.  The macro @code{EWOULDBLOCK} is another name for @code{EAGAIN};
+#. TRANS they are always the same in the GNU C library.
+#. TRANS
+#. TRANS This error can happen in a few different situations:
+#. TRANS
+#. TRANS @itemize @bullet
+#. TRANS @item
+#. TRANS An operation that would block was attempted on an object that has
+#. TRANS non-blocking mode selected.  Trying the same operation again will block
+#. TRANS until some external condition makes it possible to read, write, or
+#. TRANS connect (whatever the operation).  You can use @code{select} to find out
+#. TRANS when the operation will be possible; @pxref{Waiting for I/O}.
+#. TRANS
+#. TRANS @strong{Portability Note:} In many older Unix systems, this condition
+#. TRANS was indicated by @code{EWOULDBLOCK}, which was a distinct error code
+#. TRANS different from @code{EAGAIN}.  To make your program portable, you should
+#. TRANS check for both codes and treat them the same.
+#. TRANS
+#. TRANS @item
+#. TRANS A temporary resource shortage made an operation impossible.  @code{fork}
+#. TRANS can return this error.  It indicates that the shortage is expected to
+#. TRANS pass, so your program can try the call again later and it may succeed.
+#. TRANS It is probably a good idea to delay for a few seconds before trying it
+#. TRANS again, to allow time for other processes to release scarce resources.
+#. TRANS Such shortages are usually fairly serious and affect the whole system,
+#. TRANS so usually an interactive program should report the error to the user
+#. TRANS and return to its command loop.
+#. TRANS @end itemize
+#: stdio-common/../sysdeps/gnu/errlist.c:408
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:41
+msgid "Resource temporarily unavailable"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:172
-msgid "Error 142"
-msgstr " 142"
+#. TRANS In the GNU C library, this is another name for @code{EAGAIN} (above).
+#. TRANS The values are always the same, on every operating system.
+#. TRANS
+#. TRANS C libraries in many older Unix systems have @code{EWOULDBLOCK} as a
+#. TRANS separate error code.
+#: stdio-common/../sysdeps/gnu/errlist.c:421
+msgid "Operation would block"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:88
-msgid "Error 58"
-msgstr " 58"
+#. TRANS An operation that cannot complete immediately was initiated on an object
+#. TRANS that has non-blocking mode selected.  Some functions that must always
+#. TRANS block (such as @code{connect}; @pxref{Connecting}) never return
+#. TRANS @code{EAGAIN}.  Instead, they return @code{EINPROGRESS} to indicate that
+#. TRANS the operation has begun and will take some time.  Attempts to manipulate
+#. TRANS the object before the call completes return @code{EALREADY}.  You can
+#. TRANS use the @code{select} function to find out when the pending operation
+#. TRANS has completed; @pxref{Waiting for I/O}.
+#: stdio-common/../sysdeps/gnu/errlist.c:437
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:180
+msgid "Operation now in progress"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:89
-msgid "Error 59"
-msgstr " 59"
+#. TRANS An operation is already in progress on an object that has non-blocking
+#. TRANS mode selected.
+#: stdio-common/../sysdeps/gnu/errlist.c:447
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:179
+msgid "Operation already in progress"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:102
-msgid "Error 72"
-msgstr " 72"
+#. TRANS A file that isn't a socket was specified when a socket is required.
+#: stdio-common/../sysdeps/gnu/errlist.c:456
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:125
+msgid "Socket operation on non-socket"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:103
-msgid "Error 73"
-msgstr " 73"
+#. TRANS The size of a message sent on a socket was larger than the supported
+#. TRANS maximum size.
+#: stdio-common/../sysdeps/gnu/errlist.c:466
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:127
+msgid "Message too long"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:105
-msgid "Error 75"
-msgstr " 75"
+#. TRANS The socket type does not support the requested communications protocol.
+#: stdio-common/../sysdeps/gnu/errlist.c:475
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:128
+msgid "Protocol wrong type for socket"
+msgstr " socket "
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:106
-msgid "Error 76"
-msgstr " 76"
+#. TRANS You specified a socket option that doesn't make sense for the
+#. TRANS particular protocol being used by the socket.  @xref{Socket Options}.
+#: stdio-common/../sysdeps/gnu/errlist.c:485
+msgid "Protocol not available"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:121
-msgid "Error 91"
-msgstr " 91"
+#. TRANS The socket domain does not support the requested communications protocol
+#. TRANS (perhaps because the requested protocol is completely invalid).
+#. TRANS @xref{Creating a Socket}.
+#: stdio-common/../sysdeps/gnu/errlist.c:496
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:150
+msgid "Protocol not supported"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:122
-msgid "Error 92"
-msgstr " 92"
+#. TRANS The socket type is not supported.
+#: stdio-common/../sysdeps/gnu/errlist.c:505
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:151
+msgid "Socket type not supported"
+msgstr ""
 
-#: nis/nis_error.c:57
-msgid "Error in RPC subsystem"
-msgstr "RPC "
+#. TRANS The operation you requested is not supported.  Some socket functions
+#. TRANS don't make sense for all types of sockets, and others may not be
+#. TRANS implemented for all communications protocols.  In the GNU system, this
+#. TRANS error can happen for many calls when the object does not support the
+#. TRANS particular operation; it is a generic indication that the server knows
+#. TRANS nothing to do for that call.
+#: stdio-common/../sysdeps/gnu/errlist.c:519
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:78
+msgid "Operation not supported"
+msgstr ""
 
-#: nis/nis_error.c:67
-msgid "Error in accessing NIS+ cold start file.  Is NIS+ installed?"
-msgstr " NIS+ NIS+ "
+#. TRANS The socket communications protocol family you requested is not supported.
+#: stdio-common/../sysdeps/gnu/errlist.c:528
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:153
+msgid "Protocol family not supported"
+msgstr ""
 
-#: string/../sysdeps/mach/_strerror.c:58
-#: sysdeps/mach/hurd/mips/dl-machine.c:68
-msgid "Error in unknown error system: "
-msgstr ""
+#. TRANS The address family specified for a socket is not supported; it is
+#. TRANS inconsistent with the protocol being used on the socket.  @xref{Sockets}.
+#: stdio-common/../sysdeps/gnu/errlist.c:538
+msgid "Address family not supported by protocol"
+msgstr ""
 
-#: nis/nis_error.c:60
-msgid "Error while talking to callback proc"
-msgstr ""
+#. TRANS The requested socket address is already in use.  @xref{Socket Addresses}.
+#: stdio-common/../sysdeps/gnu/errlist.c:547
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:155
+msgid "Address already in use"
+msgstr ""
 
-#: timezone/zdump.c:268
-msgid "Error writing standard output"
-msgstr ""
+#. TRANS The requested socket address is not available; for example, you tried
+#. TRANS to give a socket a name that doesn't match the local host name.
+#. TRANS @xref{Socket Addresses}.
+#: stdio-common/../sysdeps/gnu/errlist.c:558
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:156
+msgid "Cannot assign requested address"
+msgstr ""
 
-#: inet/ruserpass.c:184
-msgid "Error: .netrc file is readable by others."
-msgstr ".netrc "
+#. TRANS A socket operation failed because the network was down.
+#: stdio-common/../sysdeps/gnu/errlist.c:567
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:157
+msgid "Network is down"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:729
-msgid "Exchange full"
-msgstr ""
+#. TRANS A socket operation failed because the subnet containing the remote host
+#. TRANS was unreachable.
+#: stdio-common/../sysdeps/gnu/errlist.c:577
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:158
+msgid "Network is unreachable"
+msgstr ""
 
-#. TRANS Invalid executable file format.  This condition is detected by the
-#. TRANS @code{exec} functions; see @ref{Executing a File}.
-#: stdio-common/../sysdeps/gnu/errlist.c:76
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:38
-msgid "Exec format error"
-msgstr ""
+#. TRANS A network connection was reset because the remote host crashed.
+#: stdio-common/../sysdeps/gnu/errlist.c:586
+msgid "Network dropped connection on reset"
+msgstr ""
 
-#: locale/programs/localedef.c:190
-msgid "FATAL: system does not define `_POSIX2_LOCALEDEF'"
-msgstr "_POSIX2_LOCALEDEF"
+#. TRANS A network connection was aborted locally.
+#: stdio-common/../sysdeps/gnu/errlist.c:595
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:160
+msgid "Software caused connection abort"
+msgstr ""
 
-#: locale/programs/localedef.c:97
-msgid "FILE contains mapping from symbolic names to UCS4 values"
+#. TRANS A network connection was closed for reasons outside the control of the
+#. TRANS local host, such as by the remote machine rebooting or an unrecoverable
+#. TRANS protocol violation.
+#: stdio-common/../sysdeps/gnu/errlist.c:606
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:161
+msgid "Connection reset by peer"
 msgstr ""
 
-#: sunrpc/clnt_perr.c:381
-msgid "Failed (unspecified error)"
-msgstr " ()"
+#. TRANS The kernel's buffers for I/O operations are all in use.  In GNU, this
+#. TRANS error is always synonymous with @code{ENOMEM}; you may get one or the
+#. TRANS other from network operations.
+#: stdio-common/../sysdeps/gnu/errlist.c:617
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:162
+msgid "No buffer space available"
+msgstr ""
 
-#: nscd/nscd.c:400
-#, c-format
-msgid "Failed to look up user '%s' to run server as"
-msgstr ""
+#. TRANS You tried to connect a socket that is already connected.
+#. TRANS @xref{Connecting}.
+#: stdio-common/../sysdeps/gnu/errlist.c:627
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:163
+msgid "Transport endpoint is already connected"
+msgstr ""
 
-#: elf/readlib.c:109
-#, c-format
-msgid "File %s is too small, not checked."
-msgstr " %s "
+#. TRANS The socket is not connected to anything.  You get this error when you
+#. TRANS try to transmit data over a socket, without first specifying a
+#. TRANS destination for the data.  For a connectionless socket (for datagram
+#. TRANS protocols, such as UDP), you get @code{EDESTADDRREQ} instead.
+#: stdio-common/../sysdeps/gnu/errlist.c:639
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:164
+msgid "Transport endpoint is not connected"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:781
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:111
-msgid "File descriptor in bad state"
-msgstr ""
+#. TRANS No default destination address was set for the socket.  You get this
+#. TRANS error when you try to transmit data over a connectionless socket,
+#. TRANS without first specifying a destination for the data with @code{connect}.
+#: stdio-common/../sysdeps/gnu/errlist.c:650
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:126
+msgid "Destination address required"
+msgstr ""
 
-#. TRANS File exists; an existing file was specified in a context where it only
-#. TRANS makes sense to specify a new file.
-#: stdio-common/../sysdeps/gnu/errlist.c:135
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:47
-msgid "File exists"
-msgstr ""
+#. TRANS The socket has already been shut down.
+#: stdio-common/../sysdeps/gnu/errlist.c:659
+msgid "Cannot send after transport endpoint shutdown"
+msgstr ""
 
-#: elf/cache.c:147 elf/cache.c:157
-msgid "File is not a cache file.\n"
-msgstr "\n"
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:668
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:174
+msgid "Too many references: cannot splice"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:86
-msgid "File locking deadlock"
-msgstr ""
+#. TRANS A socket operation with a specified timeout received no response during
+#. TRANS the timeout period.
+#: stdio-common/../sysdeps/gnu/errlist.c:678
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:175
+msgid "Connection timed out"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:745
-msgid "File locking deadlock error"
-msgstr ""
+#. TRANS A remote host refused to allow the network connection (typically because
+#. TRANS it is not running the requested service).
+#: stdio-common/../sysdeps/gnu/errlist.c:688
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:176
+msgid "Connection refused"
+msgstr ""
+
+#. TRANS Too many levels of symbolic links were encountered in looking up a file name.
+#. TRANS This often indicates a cycle of symbolic links.
+#: stdio-common/../sysdeps/gnu/errlist.c:698
+msgid "Too many levels of symbolic links"
+msgstr ""
 
 #. TRANS Filename too long (longer than @code{PATH_MAX}; @pxref{Limits for
 #. TRANS Files}) or host name too long (in @code{gethostname} or
 #. TRANS @code{sethostname}; @pxref{Host Identification}).
-#: stdio-common/../sysdeps/gnu/errlist.c:465
+#: stdio-common/../sysdeps/gnu/errlist.c:709
 #: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:108
 msgid "File name too long"
 msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:51 sysdeps/generic/siglist.h:51
-msgid "File size limit exceeded"
-msgstr ""
+#. TRANS The remote host for a requested network connection is down.
+#: stdio-common/../sysdeps/gnu/errlist.c:718
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:177
+msgid "Host is down"
+msgstr ""
+
+#. TRANS The remote host for a requested network connection is not reachable.
+#: stdio-common/../sysdeps/gnu/errlist.c:727
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:178
+msgid "No route to host"
+msgstr ""
+
+#. TRANS Directory not empty, where an empty directory was expected.  Typically,
+#. TRANS this error occurs when you are trying to delete a directory.
+#: stdio-common/../sysdeps/gnu/errlist.c:737
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:123
+msgid "Directory not empty"
+msgstr ""
+
+#. TRANS This means that the per-user limit on new process would be exceeded by
+#. TRANS an attempted @code{fork}.  @xref{Limits on Resources}, for details on
+#. TRANS the @code{RLIMIT_NPROC} limit.
+#: stdio-common/../sysdeps/gnu/errlist.c:748
+msgid "Too many processes"
+msgstr ""
+
+#. TRANS The file quota system is confused because there are too many users.
+#. TRANS @c This can probably happen in a GNU system when using NFS.
+#: stdio-common/../sysdeps/gnu/errlist.c:758
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:124
+msgid "Too many users"
+msgstr ""
+
+#. TRANS The user's disk quota was exceeded.
+#: stdio-common/../sysdeps/gnu/errlist.c:767
+msgid "Disk quota exceeded"
+msgstr ""
+
+#. TRANS Stale NFS file handle.  This indicates an internal confusion in the NFS
+#. TRANS system which is due to file system rearrangements on the server host.
+#. TRANS Repairing this condition usually requires unmounting and remounting
+#. TRANS the NFS file system on the local host.
+#: stdio-common/../sysdeps/gnu/errlist.c:779
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:181
+msgid "Stale NFS file handle"
+msgstr ""
+
+#. TRANS An attempt was made to NFS-mount a remote file system with a file name that
+#. TRANS already specifies an NFS-mounted file.
+#. TRANS (This is an error on some operating systems, but we expect it to work
+#. TRANS properly on the GNU system, making this error code impossible.)
+#: stdio-common/../sysdeps/gnu/errlist.c:791
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:96
+msgid "Object is remote"
+msgstr ""
+
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:800
+msgid "RPC struct is bad"
+msgstr "RPC "
+
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:809
+msgid "RPC version wrong"
+msgstr "RPC "
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:53
-msgid "File table overflow"
-msgstr ""
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:818
+msgid "RPC program not available"
+msgstr "RPC "
 
-#. TRANS File too big; the size of a file would be larger than allowed by the system.
-#: stdio-common/../sysdeps/gnu/errlist.c:203
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:57
-msgid "File too large"
-msgstr ""
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:827
+msgid "RPC program version wrong"
+msgstr "RPC "
 
-#: intl/tst-gettext2.c:37
-msgid "First string for testing."
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:836
+msgid "RPC bad procedure for program"
 msgstr ""
 
-#: nis/nis_error.c:38
-msgid "First/next chain broken"
-msgstr ""
+#. TRANS No locks available.  This is used by the file locking facilities; see
+#. TRANS @ref{File Locks}.  This error is never generated by the GNU system, but
+#. TRANS it can result from an operation to an NFS server running another
+#. TRANS operating system.
+#: stdio-common/../sysdeps/gnu/errlist.c:848
+msgid "No locks available"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:34 sysdeps/generic/siglist.h:35
-msgid "Floating point exception"
-msgstr ""
+#. TRANS Inappropriate file type or format.  The file was the wrong type for the
+#. TRANS operation, or a data file had the wrong format.
+#. TRANS
+#. TRANS On some systems @code{chmod} returns this error if you try to set the
+#. TRANS sticky bit on a non-directory file; @pxref{Setting Permissions}.
+#: stdio-common/../sysdeps/gnu/errlist.c:861
+msgid "Inappropriate file type or format"
+msgstr ""
 
-#: elf/ldconfig.c:131
-msgid "Format to use: new, old or compat (default)"
-msgstr "()"
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:870
+msgid "Authentication error"
+msgstr ""
 
-#: nis/nis_error.c:68
-msgid "Full resync required for directory"
-msgstr ""
+#. TRANS ???
+#: stdio-common/../sysdeps/gnu/errlist.c:879
+msgid "Need authenticator"
+msgstr ""
 
 #. TRANS Function not implemented.  This indicates that the function called is
 #. TRANS not implemented at all, either in the C library itself or in the
 #. TRANS operating system.  When you get this error, you can be sure that this
 #. TRANS particular function will always fail with @code{ENOSYS} unless you
 #. TRANS install a new version of the C library or the operating system.
-#: stdio-common/../sysdeps/gnu/errlist.c:576
+#: stdio-common/../sysdeps/gnu/errlist.c:892
 msgid "Function not implemented"
 msgstr ""
 
-#: nis/nis_print.c:118
-msgid "GROUP\n"
-msgstr "\n"
+#. TRANS Not supported.  A function returns this error when certain parameter
+#. TRANS values are valid, but the functionality they request is not available.
+#. TRANS This can mean that the function does not implement a particular command
+#. TRANS or option value or flag bit at all.  For functions that operate on some
+#. TRANS object given in a parameter, such as a file descriptor or a port, it
+#. TRANS might instead mean that only @emph{that specific object} (file
+#. TRANS descriptor, port, etc.) is unable to support the other parameters given;
+#. TRANS different file descriptors might support different ranges of parameter
+#. TRANS values.
+#. TRANS
+#. TRANS If the entire function is not available at all in the implementation,
+#. TRANS it returns @code{ENOSYS} instead.
+#: stdio-common/../sysdeps/gnu/errlist.c:912
+msgid "Not supported"
+msgstr ""
 
-#: argp/argp-help.c:230
-#, c-format
-msgid "Garbage in ARGP_HELP_FMT: %s"
+#. TRANS While decoding a multibyte character the function came along an invalid
+#. TRANS or an incomplete sequence of bytes or the given wide character is invalid.
+#: stdio-common/../sysdeps/gnu/errlist.c:922
+msgid "Invalid or incomplete multibyte or wide character"
+msgstr ""
+
+#. TRANS In the GNU system, servers supporting the @code{term} protocol return
+#. TRANS this error for certain operations when the caller is not in the
+#. TRANS foreground process group of the terminal.  Users do not usually see this
+#. TRANS error because functions such as @code{read} and @code{write} translate
+#. TRANS it into a @code{SIGTTIN} or @code{SIGTTOU} signal.  @xref{Job Control},
+#. TRANS for information on process groups and these signals.
+#: stdio-common/../sysdeps/gnu/errlist.c:936
+msgid "Inappropriate operation for background process"
+msgstr ""
+
+#. TRANS In the GNU system, opening a file returns this error when the file is
+#. TRANS translated by a program and the translator program dies while starting
+#. TRANS up, before it has connected to the file.
+#: stdio-common/../sysdeps/gnu/errlist.c:947
+msgid "Translator died"
 msgstr ""
 
-#: malloc/memusagestat.c:64
-msgid "Generate graphic from memory profiling data"
+#. TRANS The experienced user will know what is wrong.
+#. TRANS @c This error code is a joke.  Its perror text is part of the joke.
+#. TRANS @c Don't change it.
+#: stdio-common/../sysdeps/gnu/errlist.c:958
+msgid "?"
+msgstr ""
+
+#. TRANS You did @strong{what}?
+#: stdio-common/../sysdeps/gnu/errlist.c:967
+msgid "You really blew it this time"
 msgstr ""
 
-#: catgets/gencat.c:120
-msgid ""
-"Generate message catalog.\\vIf INPUT-FILE is -, input is read from standard input.  If OUTPUT-FILE\n"
-"is -, output is written to standard output.\n"
+#. TRANS Go home and have a glass of warm, dairy-fresh milk.
+#: stdio-common/../sysdeps/gnu/errlist.c:976
+msgid "Computer bought the farm"
 msgstr ""
 
-#: malloc/memusagestat.c:55
-msgid "Generate output linear to time (default is linear to number of function calls)"
+#. TRANS This error code has no purpose.
+#: stdio-common/../sysdeps/gnu/errlist.c:985
+msgid "Gratuitous error"
 msgstr ""
 
-#: elf/ldconfig.c:123
-msgid "Generate verbose messages"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:993
+msgid "Bad message"
+msgstr ""
 
-#: nis/nis_error.c:37
-msgid "Generic system error"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1001
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:66
+msgid "Identifier removed"
+msgstr ""
 
-#: locale/programs/locale.c:86
-msgid "Get locale-specific information."
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1009
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:104
+msgid "Multihop attempted"
+msgstr ""
 
-#: argp/argp-parse.c:94
-msgid "Give a short usage message"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1017
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:91
+msgid "No data available"
+msgstr ""
 
-#: argp/argp-parse.c:93
-msgid "Give this help list"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1025
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:97
+msgid "Link has been severed"
+msgstr ""
 
-#. TRANS This error code has no purpose.
-#: stdio-common/../sysdeps/gnu/errlist.c:637
-msgid "Gratuitous error"
+#: stdio-common/../sysdeps/gnu/errlist.c:1033
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:65
+msgid "No message of desired type"
 msgstr ""
 
-#: nis/nis_print.c:323
-#, c-format
-msgid "Group         : %s\n"
-msgstr "     %s\n"
+#: stdio-common/../sysdeps/gnu/errlist.c:1041
+msgid "Out of streams resources"
+msgstr ""
 
-#: nis/nis_print.c:252
-msgid "Group Flags :"
-msgstr " "
+#: stdio-common/../sysdeps/gnu/errlist.c:1049
+msgid "Device not a stream"
+msgstr ""
 
-#: nis/nis_print_group_entry.c:115
-#, c-format
-msgid "Group entry for \"%s.%s\" group:\n"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1057
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:109
+msgid "Value too large for defined data type"
+msgstr ""
 
-#: argp/argp-parse.c:97
-msgid "Hang for SECS seconds (default 3600)"
-msgstr " SECS  ( 3600)"
+#: stdio-common/../sysdeps/gnu/errlist.c:1065
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:101
+msgid "Protocol error"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:27 sysdeps/generic/siglist.h:29
-msgid "Hangup"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1073
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:92
+msgid "Timer expired"
+msgstr ""
 
-#: nscd/grpcache.c:253
-#, c-format
-msgid "Haven't found \"%d\" in group cache!"
-msgstr "%d"
+#. TRANS Operation canceled; an asynchronous operation was canceled before it
+#. TRANS completed.  @xref{Asynchronous I/O}.  When you call @code{aio_cancel},
+#. TRANS the normal result is for the operations affected to complete with this
+#. TRANS error; @pxref{Cancel AIO Operations}.
+#: stdio-common/../sysdeps/gnu/errlist.c:1085
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:77
+msgid "Operation canceled"
+msgstr ""
 
-#: nscd/pwdcache.c:249
-#, c-format
-msgid "Haven't found \"%d\" in password cache!"
-msgstr "%d"
+#: stdio-common/../sysdeps/gnu/errlist.c:1093
+msgid "Interrupted system call should be restarted"
+msgstr ""
 
-#: nscd/grpcache.c:214
-#, c-format
-msgid "Haven't found \"%s\" in group cache!"
-msgstr "%s"
+#: stdio-common/../sysdeps/gnu/errlist.c:1101
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:67
+msgid "Channel number out of range"
+msgstr ""
 
-#: nscd/hstcache.c:299 nscd/hstcache.c:341 nscd/hstcache.c:386
-#: nscd/hstcache.c:430
-#, c-format
-msgid "Haven't found \"%s\" in hosts cache!"
-msgstr "%s"
+#: stdio-common/../sysdeps/gnu/errlist.c:1109
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:68
+msgid "Level 2 not synchronized"
+msgstr " 2 "
 
-#: nscd/pwdcache.c:210
-#, c-format
-msgid "Haven't found \"%s\" in password cache!"
-msgstr "%s"
+#: stdio-common/../sysdeps/gnu/errlist.c:1117
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:69
+msgid "Level 3 halted"
+msgstr " 3 "
 
-#. TRANS The remote host for a requested network connection is down.
-#: stdio-common/../sysdeps/gnu/errlist.c:470
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:177
-msgid "Host is down"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1125
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:70
+msgid "Level 3 reset"
+msgstr " 3 "
 
-#: resolv/herror.c:69
-msgid "Host name lookup failure"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1133
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:71
+msgid "Link number out of range"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:35
-msgid "I/O error"
-msgstr "I/O "
+#: stdio-common/../sysdeps/gnu/errlist.c:1141
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:72
+msgid "Protocol driver not attached"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:49 sysdeps/generic/siglist.h:49
-msgid "I/O possible"
+#: stdio-common/../sysdeps/gnu/errlist.c:1149
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:73
+msgid "No CSI structure available"
+msgstr " CSI "
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1157
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:74
+msgid "Level 2 halted"
+msgstr " 2 "
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1165
+msgid "Invalid exchange"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1173
+msgid "Invalid request descriptor"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1181
+msgid "Exchange full"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1189
+msgid "No anode"
+msgstr " anode"
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1197
+msgid "Invalid request code"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1205
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:85
+msgid "Invalid slot"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1213
+msgid "File locking deadlock error"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1221
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:87
+msgid "Bad font file format"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1229
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:94
+msgid "Machine is not on the network"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1237
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:95
+msgid "Package not installed"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1245
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:98
+msgid "Advertise error"
+msgstr ""
+
+#: stdio-common/../sysdeps/gnu/errlist.c:1253
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:99
+msgid "Srmount error"
 msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:32
-msgid "IOT trap"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1261
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:100
+msgid "Communication error on send"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:645
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:66
-msgid "Identifier removed"
+#: stdio-common/../sysdeps/gnu/errlist.c:1269
+msgid "RFS specific error"
 msgstr ""
 
-#: elf/ldconfig.c:535
-#, c-format
-msgid "Ignored file %s since it is not a regular file."
+#: stdio-common/../sysdeps/gnu/errlist.c:1277
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:110
+msgid "Name not unique on network"
 msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:118
-msgid "Illegal byte sequence"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1285
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:111
+msgid "File descriptor in bad state"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:30 sysdeps/generic/siglist.h:32
-msgid "Illegal instruction"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1293
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:112
+msgid "Remote address changed"
+msgstr ""
 
-#: nis/nis_error.c:62
-msgid "Illegal object type for operation"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1301
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:113
+msgid "Can not access a needed shared library"
+msgstr ""
 
-#. TRANS Invalid seek operation (such as on a pipe).
-#: stdio-common/../sysdeps/gnu/errlist.c:214
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:59
-msgid "Illegal seek"
-msgstr " seek "
+#: stdio-common/../sysdeps/gnu/errlist.c:1309
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:114
+msgid "Accessing a corrupted shared library"
+msgstr ""
 
-#. TRANS Inappropriate file type or format.  The file was the wrong type for the
-#. TRANS operation, or a data file had the wrong format.
-#. TRANS
-#. TRANS On some systems @code{chmod} returns this error if you try to set the
-#. TRANS sticky bit on a non-directory file; @pxref{Setting Permissions}.
-#: stdio-common/../sysdeps/gnu/errlist.c:557
-msgid "Inappropriate file type or format"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1317
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:115
+msgid ".lib section in a.out corrupted"
+msgstr "a.out  .lib "
 
-#. TRANS Inappropriate I/O control operation, such as trying to set terminal
-#. TRANS modes on an ordinary file.
-#: stdio-common/../sysdeps/gnu/errlist.c:189
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:55
-msgid "Inappropriate ioctl for device"
-msgstr " ioctl "
+#: stdio-common/../sysdeps/gnu/errlist.c:1325
+msgid "Attempting to link in too many shared libraries"
+msgstr ""
 
-#. TRANS In the GNU system, servers supporting the @code{term} protocol return
-#. TRANS this error for certain operations when the caller is not in the
-#. TRANS foreground process group of the terminal.  Users do not usually see this
-#. TRANS error because functions such as @code{read} and @code{write} translate
-#. TRANS it into a @code{SIGTTIN} or @code{SIGTTOU} signal.  @xref{Job Control},
-#. TRANS for information on process groups and these signals.
-#: stdio-common/../sysdeps/gnu/errlist.c:608
-msgid "Inappropriate operation for background process"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1333
+msgid "Cannot exec a shared library directly"
+msgstr ""
 
-#: sysdeps/generic/siglist.h:69
-msgid "Information request"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1341
+msgid "Streams pipe error"
+msgstr ""
 
-#: iconv/iconv_prog.c:62
-msgid "Information:"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1349
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:165
+msgid "Structure needs cleaning"
+msgstr ""
 
-#: locale/programs/localedef.c:92
-msgid "Input Files:"
-msgstr ""
+#: stdio-common/../sysdeps/gnu/errlist.c:1357
+msgid "Not a XENIX named type file"
+msgstr " XENIX "
 
-#: elf/ldconfig.c:754 elf/readlib.c:93
-#, c-format
-msgid "Input file %s not found.\n"
-msgstr " %s\n"
+#: stdio-common/../sysdeps/gnu/errlist.c:1365
+msgid "No XENIX semaphores available"
+msgstr " XENIX "
 
-#: iconv/iconv_prog.c:59
-msgid "Input/Output format specification:"
-msgstr "/"
+#: stdio-common/../sysdeps/gnu/errlist.c:1373
+msgid "Is a named type file"
+msgstr ""
 
-#. TRANS Input/output error; usually used for physical read or write errors.
-#: stdio-common/../sysdeps/gnu/errlist.c:53
-msgid "Input/output error"
-msgstr "/"
+#: stdio-common/../sysdeps/gnu/errlist.c:1381
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:170
+msgid "Remote I/O error"
+msgstr " I/O "
 
-#: nis/ypclnt.c:800
-msgid "Internal NIS error"
-msgstr " NIS "
+#: stdio-common/../sysdeps/gnu/errlist.c:1389
+msgid "No medium found"
+msgstr ""
 
-#: nis/ypclnt.c:864
-msgid "Internal ypbind error"
-msgstr " ypbind "
+#: stdio-common/../sysdeps/gnu/errlist.c:1397
+msgid "Wrong medium type"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:28 sysdeps/generic/siglist.h:30
-msgid "Interrupt"
-msgstr ""
+#: stdio-common/../sysdeps/unix/siglist.c:26
+msgid "Signal 0"
+msgstr " 0"
 
-#: posix/../sysdeps/posix/gai_strerror.c:46
-msgid "Interrupted by a signal"
-msgstr ""
+#: stdio-common/../sysdeps/unix/siglist.c:32
+msgid "IOT trap"
+msgstr ""
 
-#. TRANS Interrupted function call; an asynchronous signal occurred and prevented
-#. TRANS completion of the call.  When this happens, you should try the call
-#. TRANS again.
-#. TRANS
-#. TRANS You can choose to have functions resume after a signal that is handled,
-#. TRANS rather than failing with @code{EINTR}; see @ref{Interrupted
-#. TRANS Primitives}.
-#: stdio-common/../sysdeps/gnu/errlist.c:48
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:34
-msgid "Interrupted system call"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:30
+msgid "Error 0"
+msgstr " 0"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:685
-msgid "Interrupted system call should be restarted"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:31
+#: nis/nis_error.c:40
+msgid "Not owner"
+msgstr ""
 
-#. TRANS Invalid argument.  This is used to indicate various kinds of problems
-#. TRANS with passing the wrong argument to a library function.
-#: stdio-common/../sysdeps/gnu/errlist.c:165
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:52
-msgid "Invalid argument"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:35
+msgid "I/O error"
+msgstr "I/O "
 
-#: posix/regex.c:1384
-msgid "Invalid back reference"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:37
+msgid "Arg list too long"
+msgstr ""
 
-#: posix/regex.c:1378
-msgid "Invalid character class name"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:39
+msgid "Bad file number"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:357
-msgid "Invalid client credential"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:42
+msgid "Not enough space"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:365
-msgid "Invalid client verifier"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:46
+msgid "Device busy"
+msgstr ""
 
-#: posix/regex.c:1375
-msgid "Invalid collation character"
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:48
+msgid "Cross-device link"
+msgstr ""
+
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:53
+msgid "File table overflow"
+msgstr ""
+
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:63
+msgid "Argument out of domain"
 msgstr ""
 
-#: posix/regex.c:1396
-msgid "Invalid content of \\{\\}"
-msgstr " \\{\\} "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:64
+msgid "Result too large"
+msgstr ""
 
-#. TRANS An attempt to make an improper link across file systems was detected.
-#. TRANS This happens not only when you use @code{link} (@pxref{Hard Links}) but
-#. TRANS also when you rename a file with @code{rename} (@pxref{Renaming Files}).
-#: stdio-common/../sysdeps/gnu/errlist.c:142
-msgid "Invalid cross-device link"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:75
+msgid "Deadlock situation detected/avoided"
+msgstr "/"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:721
-msgid "Invalid exchange"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:76
+msgid "No record locks available"
+msgstr ""
 
-#: nis/nis_error.c:45
-msgid "Invalid object for operation"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:79
+msgid "Disc quota exceeded"
+msgstr ""
 
-#. TRANS While decoding a multibyte character the function came along an invalid
-#. TRANS or an incomplete sequence of bytes or the given wide character is invalid.
-#: stdio-common/../sysdeps/gnu/errlist.c:598
-msgid "Invalid or incomplete multibyte or wide character"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:80
+msgid "Bad exchange descriptor"
+msgstr ""
 
-#: posix/regex.c:1405
-msgid "Invalid preceding regular expression"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:81
+msgid "Bad request descriptor"
+msgstr ""
 
-#: posix/regex.c:1399
-msgid "Invalid range end"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:82
+msgid "Message tables full"
+msgstr ""
 
-#: posix/regex.c:1372
-msgid "Invalid regular expression"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:83
+msgid "Anode table overflow"
+msgstr "Anode "
 
-#: stdio-common/../sysdeps/gnu/errlist.c:737
-msgid "Invalid request code"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:84
+msgid "Bad request code"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:725
-msgid "Invalid request descriptor"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:86
+msgid "File locking deadlock"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:377
-msgid "Invalid server verifier"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:88
+msgid "Error 58"
+msgstr " 58"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:741
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:85
-msgid "Invalid slot"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:89
+msgid "Error 59"
+msgstr " 59"
 
-#: nscd/nscd.c:91
-msgid "Invalidate the specified cache"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:90
+msgid "Not a stream device"
+msgstr ""
 
-#. TRANS File is a directory; you cannot open a directory for writing,
-#. TRANS or create or remove hard links to it.
-#: stdio-common/../sysdeps/gnu/errlist.c:159
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:51
-msgid "Is a directory"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:93
+msgid "Out of stream resources"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:169
-msgid "Is a name file"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:102
+msgid "Error 72"
+msgstr " 72"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:825
-msgid "Is a named type file"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:103
+msgid "Error 73"
+msgstr " 73"
 
-#: nis/nis_print.c:191
-msgid "Kerberos.\n"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:105
+msgid "Error 75"
+msgstr " 75"
 
-#: stdio-common/../sysdeps/unix/siglist.c:35 sysdeps/generic/siglist.h:36
-msgid "Killed"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:106
+msgid "Error 76"
+msgstr " 76"
 
-#: nis/nis_print.c:127
-msgid "LINK\n"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:107
+msgid "Not a data message"
+msgstr ""
 
-#: nis/nis_local_names.c:126
-#, c-format
-msgid "LOCAL entry for UID %d in directory %s not unique\n"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:116
+msgid "Attempting to link in more shared libraries than system limit"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:717
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:74
-msgid "Level 2 halted"
-msgstr " 2 "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:117
+msgid "Can not exec a shared library directly"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:693
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:68
-msgid "Level 2 not synchronized"
-msgstr " 2 "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:118
+msgid "Illegal byte sequence"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:697
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:69
-msgid "Level 3 halted"
-msgstr " 3 "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:119
+msgid "Operation not applicable"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:701
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:70
-msgid "Level 3 reset"
-msgstr " 3 "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:120
+msgid "Number of symbolic links encountered during path name traversal exceeds MAXSYMLINKS"
+msgstr " MAXSYMLINKS"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:657
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:97
-msgid "Link has been severed"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:121
+msgid "Error 91"
+msgstr " 91"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:705
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:71
-msgid "Link number out of range"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:122
+msgid "Error 92"
+msgstr " 92"
 
-#: nis/nis_error.c:54
-msgid "Link points to illegal name"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:129
+msgid "Option not supported by protocol"
+msgstr ""
 
-#: nis/nis_print.c:286
-msgid "Linked Object Type : "
-msgstr " "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:130
+msgid "Error 100"
+msgstr " 100"
 
-#: nis/nis_print.c:288
-#, c-format
-msgid "Linked to : %s\n"
-msgstr " %s\n"
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:131
+msgid "Error 101"
+msgstr " 101"
 
-#: nis/ypclnt.c:812
-msgid "Local domain name not set"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:132
+msgid "Error 102"
+msgstr " 102"
 
-#: nis/ypclnt.c:802
-msgid "Local resource allocation failure"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:133
+msgid "Error 103"
+msgstr " 103"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:753
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:94
-msgid "Machine is not on the network"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:134
+msgid "Error 104"
+msgstr " 104"
 
-#: nis/nis_error.c:46
-msgid "Malformed name, or illegal name"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:135
+msgid "Error 105"
+msgstr " 105"
 
-#: argp/argp-help.c:1185
-msgid "Mandatory or optional arguments to long options are also mandatory or optional for any corresponding short options."
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:136
+msgid "Error 106"
+msgstr " 106"
 
-#: elf/ldconfig.c:130
-msgid "Manually link individual libraries."
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:137
+msgid "Error 107"
+msgstr " 107"
 
-#: nis/nis_print.c:172
-msgid "Master Server :\n"
-msgstr " \n"
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:138
+msgid "Error 108"
+msgstr " 108"
 
-#: nis/nis_error.c:76
-msgid "Master server busy, full dump rescheduled."
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:139
+msgid "Error 109"
+msgstr " 109"
 
-#: posix/../sysdeps/posix/gai_strerror.c:36
-msgid "Memory allocation failure"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:140
+msgid "Error 110"
+msgstr " 110"
 
-#: posix/regex.c:1402
-msgid "Memory exhausted"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:141
+msgid "Error 111"
+msgstr " 111"
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:82
-msgid "Message tables full"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:142
+msgid "Error 112"
+msgstr " 112"
 
-#. TRANS The size of a message sent on a socket was larger than the supported
-#. TRANS maximum size.
-#: stdio-common/../sysdeps/gnu/errlist.c:318
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:127
-msgid "Message too long"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:143
+msgid "Error 113"
+msgstr " 113"
 
-#: nis/nis_error.c:58
-msgid "Missing or malformed attribute"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:144
+msgid "Error 114"
+msgstr " 114"
 
-#: nis/nis_print.c:331
-#, c-format
-msgid "Mod. Time     : %s"
-msgstr "     %s"
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:145
+msgid "Error 115"
+msgstr " 115"
 
-#: nis/nis_error.c:51
-msgid "Modification failed"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:146
+msgid "Error 116"
+msgstr " 116"
 
-#: nis/nis_error.c:64
-msgid "Modify operation failed"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:147
+msgid "Error 117"
+msgstr " 117"
 
-#: locale/programs/locale.c:78
-msgid "Modify output format:"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:148
+msgid "Error 118"
+msgstr " 118"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:649
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:104
-msgid "Multihop attempted"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:149
+msgid "Error 119"
+msgstr " 119"
 
-#: nscd/nscd_conf.c:182
-msgid "Must specify user name for server-user option"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:152
+msgid "Operation not supported on transport endpoint"
+msgstr ""
 
-#: catgets/gencat.c:111 catgets/gencat.c:115 locale/programs/localedef.c:115
-#: nscd/nscd.c:83
-msgid "NAME"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:154
+msgid "Address family not supported by protocol family"
+msgstr ""
 
-#: locale/programs/locale.c:89
-msgid ""
-"NAME\n"
-"[-a|-m]"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:159
+msgid "Network dropped connection because of reset"
+msgstr ""
 
-#: nis/ypclnt.c:816
-msgid "NIS client/server version mismatch - can't supply service"
-msgstr "NIS / - "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:166
+msgid "Error 136"
+msgstr " 136"
 
-#: nis/ypclnt.c:814
-msgid "NIS map database is bad"
-msgstr "NIS "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:167
+msgid "Not a name file"
+msgstr ""
 
-#: nis/nis_error.c:69
-msgid "NIS+ operation failed"
-msgstr "NIS+ "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:168
+msgid "Not available"
+msgstr ""
 
-#: nis/nis_error.c:34
-msgid "NIS+ servers unreachable"
-msgstr "NIS+ "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:169
+msgid "Is a name file"
+msgstr ""
 
-#: nis/nis_error.c:70
-msgid "NIS+ service is unavailable or not installed"
-msgstr "NIS+ "
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:171
+msgid "Reserved for future use"
+msgstr ""
 
-#: nis/nis_print.c:112
-msgid "NO OBJECT\n"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:172
+msgid "Error 142"
+msgstr " 142"
 
-#: nscd/nscd.c:87
-msgid "NUMBER"
-msgstr ""
+#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:173
+msgid "Cannot send after socket shutdown"
+msgstr ""
 
-#: nis/nis_print.c:166
+#: stdio-common/psignal.c:63
 #, c-format
-msgid "Name : `%s'\n"
-msgstr ""
+msgid "%s%sUnknown signal %d\n"
+msgstr "%s%s %d\n"
+
+#: malloc/mcheck.c:346
+msgid "memory is consistent, library is buggy\n"
+msgstr "\n"
 
-#: nscd/nscd.c:97
-msgid "Name Service Cache Daemon."
+#: malloc/mcheck.c:349
+msgid "memory clobbered before allocated block\n"
 msgstr ""
 
-#: nis/nis_error.c:41
-msgid "Name not served by this server"
+#: malloc/mcheck.c:352
+msgid "memory clobbered past end of allocated block\n"
 msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:777
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:110
-msgid "Name not unique on network"
-msgstr ""
+#: malloc/mcheck.c:355
+msgid "block freed twice\n"
+msgstr "\n"
 
-#: posix/../sysdeps/posix/gai_strerror.c:38
-msgid "Name or service not known"
+#: malloc/mcheck.c:358
+msgid "bogus mcheck_status, library is buggy\n"
 msgstr ""
 
 #: malloc/memusagestat.c:53
 msgid "Name output file"
 msgstr ""
 
-#: nis/nis_error.c:50
-msgid "Name/entry isn't unique"
-msgstr "/"
-
-#: nis/nis_error.c:59
-msgid "Named object is not searchable"
-msgstr ""
-
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:567
-msgid "Need authenticator"
-msgstr ""
-
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:159
-msgid "Network dropped connection because of reset"
-msgstr ""
-
-#. TRANS A network connection was reset because the remote host crashed.
-#: stdio-common/../sysdeps/gnu/errlist.c:390
-msgid "Network dropped connection on reset"
-msgstr ""
-
-#. TRANS A socket operation failed because the network was down.
-#: stdio-common/../sysdeps/gnu/errlist.c:379
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:157
-msgid "Network is down"
-msgstr ""
-
-#. TRANS A socket operation failed because the subnet containing the remote host
-#. TRANS was unreachable.
-#: stdio-common/../sysdeps/gnu/errlist.c:385
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:158
-msgid "Network is unreachable"
-msgstr ""
-
-#: stdio-common/../sysdeps/gnu/errlist.c:713
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:73
-msgid "No CSI structure available"
-msgstr " CSI "
-
-#: stdio-common/../sysdeps/gnu/errlist.c:821
-msgid "No XENIX semaphores available"
-msgstr " XENIX "
+#: malloc/memusagestat.c:54
+msgid "Title string used in output graphic"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:37
-msgid "No address associated with hostname"
-msgstr ""
+#: malloc/memusagestat.c:55
+msgid "Generate output linear to time (default is linear to number of function calls)"
+msgstr ""
 
-#: resolv/herror.c:71
-msgid "No address associated with name"
-msgstr ""
+#: malloc/memusagestat.c:57
+msgid "Also draw graph for total memory consumption"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:733
-msgid "No anode"
+#: malloc/memusagestat.c:58
+msgid "make output graphic VALUE pixel wide"
 msgstr ""
 
-#. TRANS The kernel's buffers for I/O operations are all in use.  In GNU, this
-#. TRANS error is always synonymous with @code{ENOMEM}; you may get one or the
-#. TRANS other from network operations.
-#: stdio-common/../sysdeps/gnu/errlist.c:409
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:162
-msgid "No buffer space available"
-msgstr ""
+#: malloc/memusagestat.c:59
+msgid "make output graphic VALUE pixel high"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:433
-msgid "No character set name specified in charmap"
+#: malloc/memusagestat.c:64
+msgid "Generate graphic from memory profiling data"
 msgstr ""
 
-#. TRANS There are no child processes.  This error happens on operations that are
-#. TRANS supposed to manipulate child processes, when there aren't any processes
-#. TRANS to manipulate.
-#: stdio-common/../sysdeps/gnu/errlist.c:90
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:40
-msgid "No child processes"
-msgstr ""
+#: malloc/memusagestat.c:67
+msgid "DATAFILE [OUTFILE]"
+msgstr " []"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:653
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:91
-msgid "No data available"
-msgstr ""
+#: string/strerror.c:43 posix/../sysdeps/posix/gai_strerror.c:57
+msgid "Unknown error"
+msgstr ""
 
-#: locale/programs/ld-address.c:131 locale/programs/ld-collate.c:1513
-#: locale/programs/ld-ctype.c:415 locale/programs/ld-identification.c:132
-#: locale/programs/ld-measurement.c:93 locale/programs/ld-messages.c:98
-#: locale/programs/ld-monetary.c:194 locale/programs/ld-name.c:94
-#: locale/programs/ld-numeric.c:99 locale/programs/ld-paper.c:91
-#: locale/programs/ld-telephone.c:94 locale/programs/ld-time.c:160
+#: string/strsignal.c:69
 #, c-format
-msgid "No definition for %s category found"
-msgstr ""
+msgid "Real-time signal %d"
+msgstr " %d"
 
-#: nis/nis_error.c:74
-msgid "No file space on server"
-msgstr ""
+#: string/strsignal.c:73
+#, c-format
+msgid "Unknown signal %d"
+msgstr " %d"
 
-#: elf/ldconfig.c:543
+#: timezone/zdump.c:175
 #, c-format
-msgid "No link created since soname could not be found for %s"
-msgstr ""
+msgid "%s: usage is %s [ -v ] [ -c cutoff ] zonename ...\n"
+msgstr "%s %s [ -v ] [ -c cutoff ]  ...\n"
 
-#. TRANS No locks available.  This is used by the file locking facilities; see
-#. TRANS @ref{File Locks}.  This error is never generated by the GNU system, but
-#. TRANS it can result from an operation to an NFS server running another
-#. TRANS operating system.
-#: stdio-common/../sysdeps/gnu/errlist.c:548
-msgid "No locks available"
-msgstr ""
+#: timezone/zdump.c:268
+msgid "Error writing standard output"
+msgstr ""
 
-#: posix/regex.c:1369
-msgid "No match"
-msgstr ""
+#: timezone/zic.c:365
+#, c-format
+msgid "%s: Memory exhausted: %s\n"
+msgstr "%s%s\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:833
-msgid "No medium found"
-msgstr ""
+#: timezone/zic.c:390 misc/error.c:127 misc/error.c:155
+msgid "Unknown system error"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:661
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:65
-msgid "No message of desired type"
-msgstr ""
+#: timezone/zic.c:424
+#, c-format
+msgid "\"%s\", line %d: %s"
+msgstr "%s %d%s"
 
-#: nis/ypclnt.c:804
-msgid "No more records in map database"
+#: timezone/zic.c:427
+#, c-format
+msgid " (rule from \"%s\", line %d)"
 msgstr ""
 
-#: posix/regex.c:7956
-msgid "No previous regular expression"
-msgstr ""
+#: timezone/zic.c:439
+msgid "warning: "
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:76
-msgid "No record locks available"
-msgstr ""
+#: timezone/zic.c:449
+#, c-format
+msgid ""
+"%s: usage is %s [ -s ] [ -v ] [ -l localtime ] [ -p posixrules ] \\\n"
+"\t[ -d directory ] [ -L leapseconds ] [ -y yearistype ] [ filename ... ]\n"
+msgstr ""
+"%s %s [ -s ] [ -v ] [ -l  ] [ -p posix  ] \\\n"
+"\t[ -d  ] [ -L leapseconds ] [ -y yearistype ] [  ... ]\n"
 
-#: sunrpc/rpcinfo.c:570
-msgid "No remote programs registered.\n"
-msgstr "\n"
+#: timezone/zic.c:491
+#, c-format
+msgid "%s: More than one -d option specified\n"
+msgstr "%s -d \n"
 
-#. TRANS The remote host for a requested network connection is not reachable.
-#: stdio-common/../sysdeps/gnu/errlist.c:475
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:178
-msgid "No route to host"
-msgstr ""
+#: timezone/zic.c:501
+#, c-format
+msgid "%s: More than one -l option specified\n"
+msgstr "%s -l \n"
 
-#. TRANS No space left on device; write operation on a file failed because the
-#. TRANS disk is full.
-#: stdio-common/../sysdeps/gnu/errlist.c:209
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:58
-msgid "No space left on device"
-msgstr ""
+#: timezone/zic.c:511
+#, c-format
+msgid "%s: More than one -p option specified\n"
+msgstr "%s -p \n"
 
-#. TRANS The wrong type of device was given to a function that expects a
-#. TRANS particular sort of device.
-#: stdio-common/../sysdeps/gnu/errlist.c:148
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:49
-msgid "No such device"
-msgstr ""
+#: timezone/zic.c:521
+#, c-format
+msgid "%s: More than one -y option specified\n"
+msgstr "%s -y \n"
 
-#. TRANS No such device or address.  The system tried to use the device
-#. TRANS represented by a file you specified, and it couldn't find the device.
-#. TRANS This can mean that the device file was installed incorrectly, or that
-#. TRANS the physical device is missing or not correctly attached to the
-#. TRANS computer.
-#: stdio-common/../sysdeps/gnu/errlist.c:62
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:36
-msgid "No such device or address"
-msgstr ""
+#: timezone/zic.c:531
+#, c-format
+msgid "%s: More than one -L option specified\n"
+msgstr "%s -L \n"
 
-#. TRANS No such file or directory.  This is a ``file doesn't exist'' error
-#. TRANS for ordinary files that are referenced in contexts where they are
-#. TRANS expected to already exist.
-#: stdio-common/../sysdeps/gnu/errlist.c:32
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:32
-msgid "No such file or directory"
-msgstr ""
+#: timezone/zic.c:638
+#, c-format
+msgid "%s: Can't unlink  %s: %s\n"
+msgstr "%s %s%s\n"
 
-#: nis/ypclnt.c:798
-msgid "No such key in map"
-msgstr ""
+#: timezone/zic.c:645
+msgid "hard link failed, symbolic link used"
+msgstr ""
 
-#: nis/ypclnt.c:796
-msgid "No such map in server's domain"
-msgstr ""
+#: timezone/zic.c:653
+#, c-format
+msgid "%s: Can't link from %s to %s: %s\n"
+msgstr "%s %s  %s%s\n"
 
-#. TRANS No process matches the specified process ID.
-#: stdio-common/../sysdeps/gnu/errlist.c:37
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:33
-msgid "No such process"
-msgstr ""
+#: timezone/zic.c:751 timezone/zic.c:753
+msgid "same rule name in multiple files"
+msgstr ""
 
-#: nis/nis_error.c:61
-msgid "Non NIS+ namespace encountered"
+#: timezone/zic.c:794
+msgid "unruly zone"
 msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:34
-msgid "Non-recoverable failure in name resolution"
-msgstr ""
-
-#: nis/nis_print.c:180
-msgid "None.\n"
-msgstr "\n"
+#: timezone/zic.c:801
+#, c-format
+msgid "%s in ruleless zone"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:817
-msgid "Not a XENIX named type file"
-msgstr " XENIX "
+#: timezone/zic.c:822
+msgid "standard input"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:107
-msgid "Not a data message"
-msgstr ""
+#: timezone/zic.c:827
+#, c-format
+msgid "%s: Can't open %s: %s\n"
+msgstr "%s %s%s\n"
 
-#. TRANS A file that isn't a directory was specified when a directory is required.
-#: stdio-common/../sysdeps/gnu/errlist.c:153
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:50
-msgid "Not a directory"
-msgstr ""
+#: timezone/zic.c:838
+msgid "line too long"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:167
-msgid "Not a name file"
-msgstr ""
+#: timezone/zic.c:858
+msgid "input line of unknown type"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:90
-msgid "Not a stream device"
-msgstr ""
+#: timezone/zic.c:874
+#, c-format
+msgid "%s: Leap line in non leap seconds file %s\n"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:168
-msgid "Not available"
-msgstr ""
+#: timezone/zic.c:881 timezone/zic.c:1295 timezone/zic.c:1320
+#, c-format
+msgid "%s: panic: Invalid l_value %d\n"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:42
-msgid "Not enough space"
-msgstr ""
+#: timezone/zic.c:889
+#, c-format
+msgid "%s: Error reading %s\n"
+msgstr "%s %s \n"
 
-#: nis/nis_error.c:31
-msgid "Not found"
-msgstr ""
+#: timezone/zic.c:896
+#, c-format
+msgid "%s: Error closing %s: %s\n"
+msgstr "%s %s %s\n"
 
-#: nis/nis_error.c:49
-msgid "Not found, no such name"
-msgstr ""
+#: timezone/zic.c:901
+msgid "expected continuation line not found"
+msgstr ""
 
-#: nis/nis_error.c:44
-msgid "Not master server for this domain"
-msgstr ""
+#: timezone/zic.c:957
+msgid "wrong number of fields on Rule line"
+msgstr ""
 
-#: nis/nis_error.c:40
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:31
-msgid "Not owner"
-msgstr ""
+#: timezone/zic.c:961
+msgid "nameless rule"
+msgstr ""
 
-#. TRANS Not supported.  A function returns this error when certain parameter
-#. TRANS values are valid, but the functionality they request is not available.
-#. TRANS This can mean that the function does not implement a particular command
-#. TRANS or option value or flag bit at all.  For functions that operate on some
-#. TRANS object given in a parameter, such as a file descriptor or a port, it
-#. TRANS might instead mean that only @emph{that specific object} (file
-#. TRANS descriptor, port, etc.) is unable to support the other parameters given;
-#. TRANS different file descriptors might support different ranges of parameter
-#. TRANS values.
-#. TRANS
-#. TRANS If the entire function is not available at all in the implementation,
-#. TRANS it returns @code{ENOSYS} instead.
-#: stdio-common/../sysdeps/gnu/errlist.c:592
-msgid "Not supported"
-msgstr ""
+#: timezone/zic.c:966
+msgid "invalid saved time"
+msgstr ""
 
-#: nis/nis_print.c:267
+#: timezone/zic.c:985
+msgid "wrong number of fields on Zone line"
+msgstr ""
+
+#: timezone/zic.c:991
 #, c-format
-msgid "Number of Columns   : %d\n"
-msgstr "    %d\n"
+msgid "\"Zone %s\" line and -l option are mutually exclusive"
+msgstr ""
 
-#: nis/nis_print.c:366
+#: timezone/zic.c:999
 #, c-format
-msgid "Number of objects : %u\n"
+msgid "\"Zone %s\" line and -p option are mutually exclusive"
 msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:120
-msgid "Number of symbolic links encountered during path name traversal exceeds MAXSYMLINKS"
+#: timezone/zic.c:1011
+#, c-format
+msgid "duplicate zone name %s (file \"%s\", line %d)"
+msgstr " %s (%s %d)"
+
+#: timezone/zic.c:1027
+msgid "wrong number of fields on Zone continuation line"
 msgstr ""
 
-#. TRANS Domain error; used by mathematical functions when an argument value does
-#. TRANS not fall into the domain over which the function is defined.
-#: stdio-common/../sysdeps/gnu/errlist.c:241
-msgid "Numerical argument out of domain"
-msgstr ""
+#: timezone/zic.c:1067
+msgid "invalid UTC offset"
+msgstr " UTC "
 
-#. TRANS Range error; used by mathematical functions when the result value is
-#. TRANS not representable because of overflow or underflow.
-#: stdio-common/../sysdeps/gnu/errlist.c:247
-msgid "Numerical result out of range"
-msgstr ""
+#: timezone/zic.c:1070
+msgid "invalid abbreviation format"
+msgstr ""
 
-#: nis/nis_print.c:370
-#, c-format
-msgid "Object #%d:\n"
-msgstr " #%d\n"
+#: timezone/zic.c:1096
+msgid "Zone continuation line end time is not after end time of previous line"
+msgstr ""
 
-#: nis/nis_print.c:320
-#, c-format
-msgid "Object Name   : %s\n"
-msgstr "  %s\n"
+#: timezone/zic.c:1123
+msgid "wrong number of fields on Leap line"
+msgstr ""
 
-#: nis/nis_print.c:332
-msgid "Object Type   : "
-msgstr "  %s"
+#: timezone/zic.c:1132
+msgid "invalid leaping year"
+msgstr ""
 
-#. TRANS An attempt was made to NFS-mount a remote file system with a file name that
-#. TRANS already specifies an NFS-mounted file.
-#. TRANS (This is an error on some operating systems, but we expect it to work
-#. TRANS properly on the GNU system, making this error code impossible.)
-#: stdio-common/../sysdeps/gnu/errlist.c:515
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:96
-msgid "Object is remote"
-msgstr ""
+#: timezone/zic.c:1147 timezone/zic.c:1250
+msgid "invalid month name"
+msgstr ""
 
-#: nis/nis_error.c:43
-msgid "Object with same name exists"
-msgstr ""
+#: timezone/zic.c:1160 timezone/zic.c:1372 timezone/zic.c:1386
+msgid "invalid day of month"
+msgstr ""
 
-#: timezone/zic.c:2028
-msgid "Odd number of quotation marks"
-msgstr ""
+#: timezone/zic.c:1165
+msgid "time before zero"
+msgstr ""
 
-#: elf/ldconfig.c:129
-msgid "Only process directories specified on the command line.  Don't build cache."
-msgstr ""
+#: timezone/zic.c:1173 timezone/zic.c:2049 timezone/zic.c:2068
+msgid "time overflow"
+msgstr ""
 
-#: nscd/nscd.c:200 nscd/nscd.c:220 nscd/nscd.c:226
-msgid "Only root is allowed to use this option!"
-msgstr ""
+#: timezone/zic.c:1176 timezone/zic.c:1279
+msgid "invalid time of day"
+msgstr ""
 
-#. TRANS An operation is already in progress on an object that has non-blocking
-#. TRANS mode selected.
-#: stdio-common/../sysdeps/gnu/errlist.c:307
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:179
-msgid "Operation already in progress"
-msgstr ""
+#: timezone/zic.c:1195
+msgid "illegal CORRECTION field on Leap line"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:77
-msgid "Operation canceled"
-msgstr ""
+#: timezone/zic.c:1199
+msgid "illegal Rolling/Stationary field on Leap line"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:119
-msgid "Operation not applicable"
-msgstr ""
+#: timezone/zic.c:1214
+msgid "wrong number of fields on Link line"
+msgstr ""
 
-#. TRANS Operation not permitted; only the owner of the file (or other resource)
-#. TRANS or processes with special privileges can perform the operation.
-#: stdio-common/../sysdeps/gnu/errlist.c:25
-msgid "Operation not permitted"
-msgstr ""
+#: timezone/zic.c:1218
+msgid "blank FROM field on Link line"
+msgstr "Link  FROM "
 
-#. TRANS The operation you requested is not supported.  Some socket functions
-#. TRANS don't make sense for all types of sockets, and others may not be
-#. TRANS implemented for all communications protocols.  In the GNU system, this
-#. TRANS error can happen for many calls when the object does not support the
-#. TRANS particular operation; it is a generic indication that the server knows
-#. TRANS nothing to do for that call.
-#: stdio-common/../sysdeps/gnu/errlist.c:351
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:78
-msgid "Operation not supported"
-msgstr ""
+#: timezone/zic.c:1222
+msgid "blank TO field on Link line"
+msgstr "Link  TO "
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:152
-msgid "Operation not supported on transport endpoint"
-msgstr ""
+#: timezone/zic.c:1299
+msgid "invalid starting year"
+msgstr ""
 
-#. TRANS An operation that cannot complete immediately was initiated on an object
-#. TRANS that has non-blocking mode selected.  Some functions that must always
-#. TRANS block (such as @code{connect}; @pxref{Connecting}) never return
-#. TRANS @code{EAGAIN}.  Instead, they return @code{EINPROGRESS} to indicate that
-#. TRANS the operation has begun and will take some time.  Attempts to manipulate
-#. TRANS the object before the call completes return @code{EALREADY}.  You can
-#. TRANS use the @code{select} function to find out when the pending operation
-#. TRANS has completed; @pxref{Waiting for I/O}.
-#: stdio-common/../sysdeps/gnu/errlist.c:301
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:180
-msgid "Operation now in progress"
-msgstr ""
+#: timezone/zic.c:1303 timezone/zic.c:1328
+msgid "starting year too low to be represented"
+msgstr ""
 
-#. TRANS In the GNU C library, this is another name for @code{EAGAIN} (above).
-#. TRANS The values are always the same, on every operating system.
-#. TRANS
-#. TRANS C libraries in many older Unix systems have @code{EWOULDBLOCK} as a
-#. TRANS separate error code.
-#: stdio-common/../sysdeps/gnu/errlist.c:289
-msgid "Operation would block"
-msgstr ""
+#: timezone/zic.c:1305 timezone/zic.c:1330
+msgid "starting year too high to be represented"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:129
-msgid "Option not supported by protocol"
-msgstr ""
+#: timezone/zic.c:1324
+msgid "invalid ending year"
+msgstr ""
 
-#: locale/programs/localedef.c:103
-msgid "Optional output file prefix"
-msgstr ""
+#: timezone/zic.c:1333
+msgid "starting year greater than ending year"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:93
-msgid "Out of stream resources"
-msgstr ""
+#: timezone/zic.c:1340
+msgid "typed single year"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:665
-msgid "Out of streams resources"
-msgstr ""
+#: timezone/zic.c:1377
+msgid "invalid weekday name"
+msgstr ""
 
-#: iconv/iconv_prog.c:64 locale/programs/localedef.c:99
-msgid "Output control:"
-msgstr ""
+#: timezone/zic.c:1492
+#, c-format
+msgid "%s: Can't remove %s: %s\n"
+msgstr "%s %s%s\n"
 
-#: elf/sprof.c:72
-msgid "Output selection:"
-msgstr ""
+#: timezone/zic.c:1502
+#, c-format
+msgid "%s: Can't create %s: %s\n"
+msgstr "%s %s%s\n"
 
-#: nis/nis_print.c:322
+#: timezone/zic.c:1568
 #, c-format
-msgid "Owner         : %s\n"
-msgstr " %s\n"
+msgid "%s: Error writing %s\n"
+msgstr "%s %s \n"
 
-#: nis/nis_print.c:130
-msgid "PRIVATE\n"
+#: timezone/zic.c:1758
+msgid "can't determine time zone abbreviation to use just after until time"
 msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:757
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:95
-msgid "Package not installed"
-msgstr ""
+#: timezone/zic.c:1801
+msgid "too many transitions?!"
+msgstr ""
 
-#: nscd/nscd_conf.c:83
-#, c-format
-msgid "Parse error: %s"
-msgstr "%s"
+#: timezone/zic.c:1820
+msgid "internal error - addtype called with bad isdst"
+msgstr " -  isdst  addtype"
+
+#: timezone/zic.c:1824
+msgid "internal error - addtype called with bad ttisstd"
+msgstr " -  ttisstd  addtype"
+
+#: timezone/zic.c:1828
+msgid "internal error - addtype called with bad ttisgmt"
+msgstr " -  ttisgmt  addtype"
+
+#: timezone/zic.c:1847
+msgid "too many local time types"
+msgstr ""
+
+#: timezone/zic.c:1875
+msgid "too many leap seconds"
+msgstr ""
 
-#: nis/nis_error.c:55
-msgid "Partial success"
+#: timezone/zic.c:1881
+msgid "repeated leap second moment"
 msgstr ""
 
-#: nis/nis_error.c:63
-msgid "Passed object is not the same object on server"
+#: timezone/zic.c:1933
+msgid "Wild result from command execution"
 msgstr ""
 
-#: elf/ldconfig.c:282
+#: timezone/zic.c:1934
 #, c-format
-msgid "Path `%s' given more than once"
-msgstr "%s"
-
-#. TRANS Permission denied; the file permissions do not allow the attempted operation.
-#: nis/nis_error.c:39 nis/ypclnt.c:818
-#: stdio-common/../sysdeps/gnu/errlist.c:109
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:43
-msgid "Permission denied"
-msgstr ""
-
-#: sysdeps/generic/siglist.h:71
-msgid "Power failure"
-msgstr ""
-
-#: posix/regex.c:1408
-msgid "Premature end of regular expression"
-msgstr ""
+msgid "%s: command was '%s', result was %d\n"
+msgstr "%s%s %d\n"
 
-#: elf/ldconfig.c:122
-msgid "Print cache"
-msgstr ""
+#: timezone/zic.c:2029
+msgid "Odd number of quotation marks"
+msgstr ""
 
-#: nscd/nscd.c:89
-msgid "Print current configuration statistic"
-msgstr ""
+#: timezone/zic.c:2115
+msgid "use of 2/29 in non leap-year"
+msgstr ""
 
-#: locale/programs/locale.c:81
-msgid "Print more information"
-msgstr ""
+#: timezone/zic.c:2149
+msgid "no day in month matches rule"
+msgstr ""
 
-#: locale/programs/localedef.c:107
-msgid "Print more messages"
-msgstr ""
+#: timezone/zic.c:2172
+msgid "too many, or too long, time zone abbreviations"
+msgstr ""
 
-#: argp/argp-parse.c:154
-msgid "Print program version"
-msgstr ""
+#: timezone/zic.c:2213
+#, c-format
+msgid "%s: Can't create directory %s: %s\n"
+msgstr "%s %s%s\n"
 
-#: nis/nis_error.c:30
-msgid "Probable success"
+#: timezone/zic.c:2235
+#, c-format
+msgid "%s: %d did not sign extend correctly\n"
 msgstr ""
 
-#: nis/nis_error.c:32
-msgid "Probably not found"
-msgstr ""
+#: posix/../sysdeps/generic/wordexp.c:1801
+msgid "parameter null or not set"
+msgstr " null "
 
-#: posix/../sysdeps/posix/gai_strerror.c:42
-msgid "Processing request in progress"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:31
+msgid "Address family for hostname not supported"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:53 sysdeps/generic/siglist.h:53
-msgid "Profiling timer expired"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:32
+msgid "Temporary failure in name resolution"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:709
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:72
-msgid "Protocol driver not attached"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:33
+msgid "Bad value for ai_flags"
+msgstr " ai_flags "
 
-#: stdio-common/../sysdeps/gnu/errlist.c:677
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:101
-msgid "Protocol error"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:34
+msgid "Non-recoverable failure in name resolution"
+msgstr ""
 
-#. TRANS The socket communications protocol family you requested is not supported.
-#: stdio-common/../sysdeps/gnu/errlist.c:356
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:153
-msgid "Protocol family not supported"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:35
+msgid "ai_family not supported"
+msgstr " ai_family"
 
-#. TRANS You specified a socket option that doesn't make sense for the
-#. TRANS particular protocol being used by the socket.  @xref{Socket Options}.
-#: stdio-common/../sysdeps/gnu/errlist.c:329
-msgid "Protocol not available"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:36
+msgid "Memory allocation failure"
+msgstr ""
 
-#. TRANS The socket domain does not support the requested communications protocol
-#. TRANS (perhaps because the requested protocol is completely invalid).
-#. TRANS @xref{Creating a Socket}.
-#: stdio-common/../sysdeps/gnu/errlist.c:336
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:150
-msgid "Protocol not supported"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:37
+msgid "No address associated with hostname"
+msgstr ""
 
-#. TRANS The socket type does not support the requested communications protocol.
-#: stdio-common/../sysdeps/gnu/errlist.c:323
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:128
-msgid "Protocol wrong type for socket"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:38
+msgid "Name or service not known"
+msgstr ""
 
-#: nis/nis_error.c:65
-msgid "Query illegal for named table"
+#: posix/../sysdeps/posix/gai_strerror.c:39
+msgid "Servname not supported for ai_socktype"
 msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:29 sysdeps/generic/siglist.h:31
-msgid "Quit"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:40
+msgid "ai_socktype not supported"
+msgstr " ai_socktype"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:773
-msgid "RFS specific error"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:41
+msgid "System error"
+msgstr ""
 
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:540
-msgid "RPC bad procedure for program"
+#: posix/../sysdeps/posix/gai_strerror.c:42
+msgid "Processing request in progress"
 msgstr ""
 
-#: nis/ypclnt.c:792
-msgid "RPC failure on NIS operation"
-msgstr ""
+#: posix/../sysdeps/posix/gai_strerror.c:43
+msgid "Request canceled"
+msgstr ""
 
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:530
-msgid "RPC program not available"
-msgstr "RPC "
+#: posix/../sysdeps/posix/gai_strerror.c:44
+msgid "Request not canceled"
+msgstr ""
 
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:535
-msgid "RPC program version wrong"
-msgstr "RPC "
+#: posix/../sysdeps/posix/gai_strerror.c:45
+msgid "All requests done"
+msgstr ""
 
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:520
-msgid "RPC struct is bad"
-msgstr "RPC "
+#: posix/../sysdeps/posix/gai_strerror.c:46
+msgid "Interrupted by a signal"
+msgstr ""
 
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:525
-msgid "RPC version wrong"
-msgstr "RPC "
+#: posix/getconf.c:889
+#, c-format
+msgid "Usage: %s [-v specification] variable_name [pathname]\n"
+msgstr "%s [-v ]  []\n"
 
-#: sunrpc/clnt_perr.c:284
-msgid "RPC: (unknown error code)"
-msgstr "RPC()"
+#: posix/getconf.c:947
+#, c-format
+msgid "unknown specification \"%s\""
+msgstr "%s"
 
-#: sunrpc/clnt_perr.c:203
-msgid "RPC: Authentication error"
-msgstr "RPC"
+#: posix/getconf.c:974 posix/getconf.c:990
+msgid "undefined"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:183
-msgid "RPC: Can't decode result"
-msgstr "RPC"
+#: posix/getconf.c:1012
+#, c-format
+msgid "Unrecognized variable `%s'"
+msgstr "%s"
 
-#: sunrpc/clnt_perr.c:179
-msgid "RPC: Can't encode arguments"
-msgstr "RPC"
+#: posix/getopt.c:692 posix/getopt.c:704
+#, c-format
+msgid "%s: option `%s' is ambiguous\n"
+msgstr "%s%s\n"
 
-#: sunrpc/clnt_perr.c:243
-msgid "RPC: Failed (unspecified error)"
-msgstr "RPC ()"
+#: posix/getopt.c:737 posix/getopt.c:741
+#, c-format
+msgid "%s: option `--%s' doesn't allow an argument\n"
+msgstr "%s--%s\n"
 
-#: sunrpc/clnt_perr.c:199
-msgid "RPC: Incompatible versions of RPC"
-msgstr "RPCRPC "
+#: posix/getopt.c:750 posix/getopt.c:755
+#, c-format
+msgid "%s: option `%c%s' doesn't allow an argument\n"
+msgstr "%s%c%s\n"
 
-#: sunrpc/clnt_perr.c:235
-msgid "RPC: Port mapper failure"
-msgstr ""
+#: posix/getopt.c:791 posix/getopt.c:804 posix/getopt.c:1093
+#: posix/getopt.c:1106
+#, c-format
+msgid "%s: option `%s' requires an argument\n"
+msgstr "%s%s\n"
 
-#: sunrpc/clnt_perr.c:215
-msgid "RPC: Procedure unavailable"
-msgstr ""
+#: posix/getopt.c:842 posix/getopt.c:845
+#, c-format
+msgid "%s: unrecognized option `--%s'\n"
+msgstr "%s--%s\n"
 
-#: sunrpc/clnt_perr.c:239
-msgid "RPC: Program not registered"
-msgstr "RPC"
+#: posix/getopt.c:853 posix/getopt.c:856
+#, c-format
+msgid "%s: unrecognized option `%c%s'\n"
+msgstr "%s%c%s\n"
 
-#: sunrpc/clnt_perr.c:207
-msgid "RPC: Program unavailable"
-msgstr "RPC"
+#: posix/getopt.c:903 posix/getopt.c:906
+#, c-format
+msgid "%s: illegal option -- %c\n"
+msgstr "%s -- %c\n"
 
-#: sunrpc/clnt_perr.c:211
-msgid "RPC: Program/version mismatch"
-msgstr "RPC/"
+#: posix/getopt.c:912 posix/getopt.c:915
+#, c-format
+msgid "%s: invalid option -- %c\n"
+msgstr "%s -- %c\n"
 
-#: sunrpc/clnt_perr.c:223
-msgid "RPC: Remote system error"
-msgstr "RPC"
+#: posix/getopt.c:962 posix/getopt.c:973 posix/getopt.c:1159
+#: posix/getopt.c:1172
+#, c-format
+msgid "%s: option requires an argument -- %c\n"
+msgstr "%s -- %c\n"
 
-#: sunrpc/clnt_perr.c:219
-msgid "RPC: Server can't decode arguments"
-msgstr "RPC"
+#: posix/getopt.c:1025 posix/getopt.c:1036
+#, c-format
+msgid "%s: option `-W %s' is ambiguous\n"
+msgstr "%s-W %s\n"
 
-#: sunrpc/clnt_perr.c:176
-msgid "RPC: Success"
-msgstr "RPC"
+#: posix/getopt.c:1060 posix/getopt.c:1072
+#, c-format
+msgid "%s: option `-W %s' doesn't allow an argument\n"
+msgstr "%s-W %s\n"
 
-#: sunrpc/clnt_perr.c:195
-msgid "RPC: Timed out"
-msgstr "RPC"
+#: posix/regcomp.c:136
+msgid "No match"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:191
-msgid "RPC: Unable to receive"
-msgstr "RPC"
+#: posix/regcomp.c:139
+msgid "Invalid regular expression"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:187
-msgid "RPC: Unable to send"
-msgstr "RPC"
+#: posix/regcomp.c:142
+msgid "Invalid collation character"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:227
-msgid "RPC: Unknown host"
-msgstr "RPC"
+#: posix/regcomp.c:145
+msgid "Invalid character class name"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:231
-msgid "RPC: Unknown protocol"
-msgstr "RPC"
+#: posix/regcomp.c:148
+msgid "Trailing backslash"
+msgstr ""
 
-#: nis/nis_print.c:188
-#, c-format
-msgid "RSA (%d bits)\n"
-msgstr "RSA (%d )\n"
+#: posix/regcomp.c:151
+msgid "Invalid back reference"
+msgstr ""
+
+#: posix/regcomp.c:154
+msgid "Unmatched [ or [^"
+msgstr "  [  [^"
+
+#: posix/regcomp.c:157
+msgid "Unmatched ( or \\("
+msgstr " (  \\("
 
-#: elf/dl-sym.c:72 elf/dl-sym.c:134
-msgid "RTLD_NEXT used in code not dynamically loaded"
-msgstr ""
+#: posix/regcomp.c:160
+msgid "Unmatched \\{"
+msgstr " \\{"
 
-#: elf/sprof.c:84
-msgid "Read and display shared object profiling data"
+#: posix/regcomp.c:163
+msgid "Invalid content of \\{\\}"
+msgstr " \\{\\} "
+
+#: posix/regcomp.c:166
+msgid "Invalid range end"
 msgstr ""
 
-#: nscd/nscd.c:84
-msgid "Read configuration data from NAME"
-msgstr " NAME "
+#: posix/regcomp.c:169
+msgid "Memory exhausted"
+msgstr ""
 
-#. TRANS An attempt was made to modify something on a read-only file system.
-#: stdio-common/../sysdeps/gnu/errlist.c:219
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:60
-msgid "Read-only file system"
-msgstr ""
+#: posix/regcomp.c:172
+msgid "Invalid preceding regular expression"
+msgstr ""
 
-#: string/strsignal.c:67
-#, c-format
-msgid "Real-time signal %d"
-msgstr " %d"
+#: posix/regcomp.c:175
+msgid "Premature end of regular expression"
+msgstr ""
 
-#: posix/regex.c:1411
+#: posix/regcomp.c:178
 msgid "Regular expression too big"
 msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:829
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:170
-msgid "Remote I/O error"
-msgstr " I/O "
-
-#: stdio-common/../sysdeps/gnu/errlist.c:785
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:112
-msgid "Remote address changed"
-msgstr ""
+#: posix/regcomp.c:181
+msgid "Unmatched ) or \\)"
+msgstr " )  \\)"
 
-#: inet/ruserpass.c:185
-msgid "Remove password or make file unreadable by others."
-msgstr " make "
+#: posix/regcomp.c:615
+msgid "No previous regular expression"
+msgstr ""
 
-#: elf/cache.c:431
+#: argp/argp-help.c:213
 #, c-format
-msgid "Renaming of %s to %s failed"
-msgstr " %s  %s "
+msgid "%.*s: ARGP_HELP_FMT parameter requires a value"
+msgstr "%.*s ARGP_HELP_FMT "
 
-#: elf/sprof.c:532
+#: argp/argp-help.c:222
 #, c-format
-msgid "Reopening shared object `%s' failed"
-msgstr "%s"
-
-#: nis/nis_print.c:174
-msgid "Replicate :\n"
-msgstr ""
+msgid "%.*s: Unknown ARGP_HELP_FMT parameter"
+msgstr "%.*s ARGP_HELP_FMT "
 
-#: argp/argp-help.c:1639
+#: argp/argp-help.c:234
 #, c-format
-msgid "Report bugs to %s.\n"
-msgstr " %s\n"
-
-#: catgets/gencat.c:233 debug/pcprofiledump.c:181 iconv/iconv_prog.c:379
-#: iconv/iconvconfig.c:321 locale/programs/locale.c:268
-#: locale/programs/localedef.c:297 malloc/memusagestat.c:602
-msgid "Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"
-msgstr "glibcbug <bugs@gnu.org>\n"
+msgid "Garbage in ARGP_HELP_FMT: %s"
+msgstr ""
 
-#: nis/ypclnt.c:790
-msgid "Request arguments bad"
-msgstr ""
+#: argp/argp-help.c:1189
+msgid "Mandatory or optional arguments to long options are also mandatory or optional for any corresponding short options."
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:43
-msgid "Request canceled"
-msgstr ""
+#: argp/argp-help.c:1572
+msgid "Usage:"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:44
-msgid "Request not canceled"
-msgstr ""
+#: argp/argp-help.c:1576
+msgid "  or: "
+msgstr "  "
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:171
-msgid "Reserved for future use"
-msgstr ""
+#: argp/argp-help.c:1588
+msgid " [OPTION...]"
+msgstr " [...]"
 
-#: resolv/herror.c:67
-msgid "Resolver Error 0 (no error)"
-msgstr " 0 ()"
+#: argp/argp-help.c:1615
+#, c-format
+msgid "Try `%s --help' or `%s --usage' for more information.\n"
+msgstr "%s --help%s --usage\n"
 
-#: resolv/herror.c:107
-msgid "Resolver internal error"
-msgstr ""
+#: argp/argp-help.c:1643
+#, c-format
+msgid "Report bugs to %s.\n"
+msgstr " %s\n"
 
-#. TRANS Deadlock avoided; allocating a system resource would have resulted in a
-#. TRANS deadlock situation.  The system does not guarantee that it will notice
-#. TRANS all such situations.  This error means you got lucky and the system
-#. TRANS noticed; it might just hang.  @xref{File Locks}, for an example.
-#: stdio-common/../sysdeps/gnu/errlist.c:98
-msgid "Resource deadlock avoided"
-msgstr ""
+#: argp/argp-parse.c:100
+msgid "Give this help list"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:55 sysdeps/generic/siglist.h:74
-msgid "Resource lost"
-msgstr ""
+#: argp/argp-parse.c:101
+msgid "Give a short usage message"
+msgstr ""
 
-#. TRANS Resource temporarily unavailable; the call might work if you try again
-#. TRANS later.  The macro @code{EWOULDBLOCK} is another name for @code{EAGAIN};
-#. TRANS they are always the same in the GNU C library.
-#. TRANS
-#. TRANS This error can happen in a few different situations:
-#. TRANS
-#. TRANS @itemize @bullet
-#. TRANS @item
-#. TRANS An operation that would block was attempted on an object that has
-#. TRANS non-blocking mode selected.  Trying the same operation again will block
-#. TRANS until some external condition makes it possible to read, write, or
-#. TRANS connect (whatever the operation).  You can use @code{select} to find out
-#. TRANS when the operation will be possible; @pxref{Waiting for I/O}.
-#. TRANS
-#. TRANS @strong{Portability Note:} In many older Unix systems, this condition
-#. TRANS was indicated by @code{EWOULDBLOCK}, which was a distinct error code
-#. TRANS different from @code{EAGAIN}.  To make your program portable, you should
-#. TRANS check for both codes and treat them the same.
-#. TRANS
-#. TRANS @item
-#. TRANS A temporary resource shortage made an operation impossible.  @code{fork}
-#. TRANS can return this error.  It indicates that the shortage is expected to
-#. TRANS pass, so your program can try the call again later and it may succeed.
-#. TRANS It is probably a good idea to delay for a few seconds before trying it
-#. TRANS again, to allow time for other processes to release scarce resources.
-#. TRANS Such shortages are usually fairly serious and affect the whole system,
-#. TRANS so usually an interactive program should report the error to the user
-#. TRANS and return to its command loop.
-#. TRANS @end itemize
-#: stdio-common/../sysdeps/gnu/errlist.c:280
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:41
-msgid "Resource temporarily unavailable"
-msgstr ""
+#: argp/argp-parse.c:102
+msgid "Set the program name"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:64
-msgid "Result too large"
-msgstr ""
+#: argp/argp-parse.c:104
+msgid "Hang for SECS seconds (default 3600)"
+msgstr " SECS  ( 3600)"
 
-#: nis/nis_error.c:48
-msgid "Results sent to callback proc"
-msgstr ""
+#: argp/argp-parse.c:161
+msgid "Print program version"
+msgstr ""
 
-#: elf/sprof.c:87
-msgid "SHOBJ [PROFDATA]"
-msgstr ""
+#: argp/argp-parse.c:177
+msgid "(PROGRAM ERROR) No version known!?"
+msgstr "() "
 
-#: nis/nis_print.c:269
+#: argp/argp-parse.c:653
 #, c-format
-msgid "Search Path         : %s\n"
-msgstr "  %s\n"
-
-#: stdio-common/../sysdeps/unix/siglist.c:37 sysdeps/generic/siglist.h:38
-msgid "Segmentation fault"
-msgstr ""
+msgid "%s: Too many arguments\n"
+msgstr "%s\n"
 
-#: nis/nis_error.c:36
-msgid "Server busy, try again"
-msgstr ""
+#: argp/argp-parse.c:794
+msgid "(PROGRAM ERROR) Option should have been recognized!?"
+msgstr "() "
 
-#: nis/nis_error.c:42
-msgid "Server out of memory"
-msgstr ""
+#: resolv/herror.c:67
+msgid "Resolver Error 0 (no error)"
+msgstr " 0 ()"
 
-#: sunrpc/clnt_perr.c:361
-msgid "Server rejected credential"
-msgstr ""
+#: resolv/herror.c:68
+msgid "Unknown host"
+msgstr ""
 
-#: sunrpc/clnt_perr.c:369
-msgid "Server rejected verifier"
-msgstr ""
+#: resolv/herror.c:69
+msgid "Host name lookup failure"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:39
-msgid "Servname not supported for ai_socktype"
-msgstr ""
+#: resolv/herror.c:70
+msgid "Unknown server error"
+msgstr ""
 
-#: argp/argp-parse.c:95
-msgid "Set the program name"
-msgstr ""
+#: resolv/herror.c:71
+msgid "No address associated with name"
+msgstr ""
 
-#: nscd/nscd.c:88
-msgid "Shut the server down"
-msgstr ""
+#: resolv/herror.c:107
+msgid "Resolver internal error"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:26
-msgid "Signal 0"
-msgstr " 0"
+#: resolv/herror.c:110
+msgid "Unknown resolver error"
+msgstr ""
 
-#. TRANS A file that isn't a socket was specified when a socket is required.
-#: stdio-common/../sysdeps/gnu/errlist.c:312
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:125
-msgid "Socket operation on non-socket"
-msgstr ""
+#: resolv/res_hconf.c:147
+#, c-format
+msgid "%s: line %d: expected service, found `%s'\n"
+msgstr "%s %d service%s\n"
 
-#. TRANS The socket type is not supported.
-#: stdio-common/../sysdeps/gnu/errlist.c:341
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:151
-msgid "Socket type not supported"
-msgstr ""
+#: resolv/res_hconf.c:165
+#, c-format
+msgid "%s: line %d: cannot specify more than %d services"
+msgstr "%s %d %d "
 
-#. TRANS A network connection was aborted locally.
-#: stdio-common/../sysdeps/gnu/errlist.c:395
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:160
-msgid "Software caused connection abort"
-msgstr ""
+#: resolv/res_hconf.c:191
+#, c-format
+msgid "%s: line %d: list delimiter not followed by keyword"
+msgstr "%s %d"
 
-#: sunrpc/rpcinfo.c:658
-msgid "Sorry. You are not root\n"
-msgstr "\n"
+#: resolv/res_hconf.c:231
+#, c-format
+msgid "%s: line %d: cannot specify more than %d trim domains"
+msgstr "%s %d %d "
 
-#: locale/programs/localedef.c:95
-msgid "Source definitions are found in FILE"
-msgstr " FILE "
+#: resolv/res_hconf.c:256
+#, c-format
+msgid "%s: line %d: list delimiter not followed by domain"
+msgstr "%s %d"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:765
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:99
-msgid "Srmount error"
-msgstr ""
+#: resolv/res_hconf.c:319
+#, c-format
+msgid "%s: line %d: expected `on' or `off', found `%s'\n"
+msgstr "%s %donoff%s\n"
 
-#: sysdeps/generic/siglist.h:66
-msgid "Stack fault"
-msgstr ""
+#: resolv/res_hconf.c:366
+#, c-format
+msgid "%s: line %d: bad command `%s'\n"
+msgstr "%s %d%s\n"
 
-#. TRANS Stale NFS file handle.  This indicates an internal confusion in the NFS
-#. TRANS system which is due to file system rearrangements on the server host.
-#. TRANS Repairing this condition usually requires unmounting and remounting
-#. TRANS the NFS file system on the local host.
-#: stdio-common/../sysdeps/gnu/errlist.c:507
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:181
-msgid "Stale NFS file handle"
+#: resolv/res_hconf.c:395
+#, c-format
+msgid "%s: line %d: ignoring trailing garbage `%s'\n"
 msgstr ""
 
-#: nscd/nscd.c:87
-msgid "Start NUMBER threads"
-msgstr " NUMBER "
+#: nss/getent.c:51
+msgid "database [key ...]"
+msgstr " [ ...]"
 
-#: nis/nis_print.c:365
+#: nss/getent.c:56
+msgid "Service configuration to be used"
+msgstr ""
+
+#: nss/getent.c:136 nss/getent.c:308
 #, c-format
-msgid "Status            : %s\n"
-msgstr "     %s\n"
+msgid "Enumeration not supported on %s\n"
+msgstr "%s \n"
 
-#: stdio-common/../sysdeps/unix/siglist.c:44 sysdeps/generic/siglist.h:44
-msgid "Stopped"
-msgstr ""
+#: nss/getent.c:732
+msgid "getent - get entries from administrative database."
+msgstr "getent - "
 
-#: stdio-common/../sysdeps/unix/siglist.c:43 sysdeps/generic/siglist.h:43
-msgid "Stopped (signal)"
-msgstr " ()"
+#: nss/getent.c:733
+msgid "Supported databases:"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:47 sysdeps/generic/siglist.h:47
-msgid "Stopped (tty input)"
-msgstr " (tty )"
+#: nss/getent.c:790 nscd/nscd.c:124 nscd/nscd_nischeck.c:64
+msgid "wrong number of arguments"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:48 sysdeps/generic/siglist.h:48
-msgid "Stopped (tty output)"
-msgstr " (tty )"
+#: nss/getent.c:800
+#, c-format
+msgid "Unknown database: %s\n"
+msgstr "%s\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:809
-msgid "Streams pipe error"
-msgstr ""
+#: debug/pcprofiledump.c:52
+msgid "Don't buffer output"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:813
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:165
-msgid "Structure needs cleaning"
-msgstr ""
+#: debug/pcprofiledump.c:57
+msgid "Dump information generated by PC profiling."
+msgstr ""
 
-#: nis/nis_error.c:29 nis/ypclnt.c:788 nis/ypclnt.c:862 posix/regex.c:1366
-#: stdio-common/../sysdeps/gnu/errlist.c:20
-msgid "Success"
-msgstr ""
+#: debug/pcprofiledump.c:60
+msgid "[FILE]"
+msgstr "[]"
 
-#: nss/getent.c:703
-msgid "Supported databases:"
-msgstr ""
+#: debug/pcprofiledump.c:100
+msgid "cannot open input file"
+msgstr ""
 
-#: locale/programs/localedef.c:106
-msgid "Suppress warnings and information messages"
-msgstr ""
+#: debug/pcprofiledump.c:106
+msgid "cannot read header"
+msgstr ""
 
-#: locale/programs/localedef.c:94
-msgid "Symbolic character names defined in FILE"
-msgstr ""
+#: debug/pcprofiledump.c:170
+msgid "invalid pointer size"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:41
-msgid "System error"
-msgstr ""
+#: inet/rcmd.c:163 inet/rcmd.c:166
+msgid "rcmd: Cannot allocate memory\n"
+msgstr "rcmd\n"
 
-#: locale/programs/locale.c:73
-msgid "System information:"
-msgstr ""
+#: inet/rcmd.c:185 inet/rcmd.c:188
+msgid "rcmd: socket: All ports in use\n"
+msgstr "rcmdsocket\n"
 
-#: nis/ypclnt.c:868
-msgid "System resource allocation failure"
-msgstr ""
+#: inet/rcmd.c:222
+#, c-format
+msgid "connect to address %s: "
+msgstr " %s"
 
-#: locale/programs/localedef.c:292
+#: inet/rcmd.c:240
 #, c-format
-msgid ""
-"System's directory for character maps : %s\n"
-"                       repertoire maps: %s\n"
-"                       locale path    : %s\n"
-"%s"
+msgid "Trying %s...\n"
+msgstr " %s...\n"
+
+#: inet/rcmd.c:289
+#, c-format
+msgid "rcmd: write (setting up stderr): %m\n"
 msgstr ""
 
-#: nscd/nscd.c:90
-msgid "TABLE"
+#: inet/rcmd.c:310
+#, c-format
+msgid "rcmd: poll (setting up stderr): %m\n"
 msgstr ""
 
-#: nis/nis_print.c:121
-msgid "TABLE\n"
+#: inet/rcmd.c:313
+msgid "poll: protocol failure in circuit setup\n"
 msgstr ""
 
-#: nscd/nscd.c:92
-msgid "TABLE,yes"
+#: inet/rcmd.c:358
+msgid "socket: protocol failure in circuit setup\n"
 msgstr ""
 
-#: nis/nis_print.c:266
+#: inet/rcmd.c:387
 #, c-format
-msgid "Table Type          : %s\n"
-msgstr "   %s\n"
+msgid "rcmd: %s: short read"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:32
-msgid "Temporary failure in name resolution"
-msgstr ""
+#: inet/rcmd.c:549
+msgid "lstat failed"
+msgstr "lstat "
 
-#: stdio-common/../sysdeps/unix/siglist.c:41 sysdeps/generic/siglist.h:41
-msgid "Terminated"
-msgstr ""
+#: inet/rcmd.c:551
+msgid "not regular file"
+msgstr ""
 
-#. TRANS An attempt to execute a file that is currently open for writing, or
-#. TRANS write to a file that is currently being executed.  Often using a
-#. TRANS debugger to run a program is considered having it open for writing and
-#. TRANS will cause this error.  (The name stands for ``text file busy''.)  This
-#. TRANS is not an error in the GNU system; the text is copied as necessary.
-#: stdio-common/../sysdeps/gnu/errlist.c:198
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:56
-msgid "Text file busy"
-msgstr ""
+#: inet/rcmd.c:556
+msgid "cannot open"
+msgstr ""
 
-#: iconv/iconv_prog.c:680
-msgid ""
-"The following list contain all the coded character sets known.  This does\n"
-"not necessarily mean that all combinations of these names can be used for\n"
-"the FROM and TO command line parameters.  One coded character set can be\n"
-"listed with several different names (aliases).\n"
-"\n"
-"  "
-msgstr ""
+#: inet/rcmd.c:558
+msgid "fstat failed"
+msgstr "fstat "
 
-#: sunrpc/rpc_main.c:1365
-msgid "This implementation doesn't support newstyle or MT-safe code!\n"
-msgstr ""
+#: inet/rcmd.c:560
+msgid "bad owner"
+msgstr ""
 
-#: nis/nis_print.c:227
-msgid "Time to live : "
-msgstr " "
+#: inet/rcmd.c:562
+msgid "writeable by other than owner"
+msgstr ""
 
-#: stdio-common/../sysdeps/gnu/errlist.c:681
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:92
-msgid "Timer expired"
-msgstr ""
+#: inet/rcmd.c:564
+msgid "hard linked somewhere"
+msgstr ""
 
-#: malloc/memusagestat.c:54
-msgid "Title string used in output graphic"
-msgstr ""
+#: inet/ruserpass.c:170 inet/ruserpass.c:193
+msgid "out of memory"
+msgstr ""
 
-#: nis/nis_error.c:56
-msgid "Too many attributes"
-msgstr ""
+#: inet/ruserpass.c:184
+msgid "Error: .netrc file is readable by others."
+msgstr ".netrc "
 
-#. TRANS Too many levels of symbolic links were encountered in looking up a file name.
-#. TRANS This often indicates a cycle of symbolic links.
-#: stdio-common/../sysdeps/gnu/errlist.c:458
-msgid "Too many levels of symbolic links"
-msgstr ""
+#: inet/ruserpass.c:185
+msgid "Remove password or make file unreadable by others."
+msgstr " make "
 
-#. TRANS Too many links; the link count of a single file would become too large.
-#. TRANS @code{rename} can cause this error if the file being renamed already has
-#. TRANS as many links as it can take (@pxref{Renaming Files}).
-#: stdio-common/../sysdeps/gnu/errlist.c:226
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:61
-msgid "Too many links"
-msgstr ""
+#: inet/ruserpass.c:277
+#, c-format
+msgid "Unknown .netrc keyword %s"
+msgstr " .netrc  %s"
 
-#. TRANS The current process has too many files open and can't open any more.
-#. TRANS Duplicate descriptors do count toward this limit.
-#. TRANS
-#. TRANS In BSD and GNU, the number of open files is controlled by a resource
-#. TRANS limit that can usually be increased.  If you get this error, you might
-#. TRANS want to increase the @code{RLIMIT_NOFILE} limit or make it unlimited;
-#. TRANS @pxref{Limits on Resources}.
-#: stdio-common/../sysdeps/gnu/errlist.c:176
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:54
-msgid "Too many open files"
-msgstr ""
+#: sunrpc/auth_unix.c:115 sunrpc/auth_unix.c:118
+msgid "authunix_create: out of memory\n"
+msgstr "authunix_create\n"
 
-#. TRANS There are too many distinct file openings in the entire system.  Note
-#. TRANS that any number of linked channels count as just one file opening; see
-#. TRANS @ref{Linked Channels}.  This error never occurs in the GNU system.
-#: stdio-common/../sysdeps/gnu/errlist.c:183
-msgid "Too many open files in system"
-msgstr ""
+#: sunrpc/auth_unix.c:318
+msgid "auth_none.c - Fatal marshalling problem"
+msgstr ""
 
-#. TRANS This means that the per-user limit on new process would be exceeded by
-#. TRANS an attempted @code{fork}.  @xref{Limits on Resources}, for details on
-#. TRANS the @code{RLIMIT_NPROC} limit.
-#: stdio-common/../sysdeps/gnu/errlist.c:488
-msgid "Too many processes"
-msgstr ""
+#: sunrpc/clnt_perr.c:118 sunrpc/clnt_perr.c:139
+#, c-format
+msgid "; low version = %lu, high version = %lu"
+msgstr ""
 
-#. TRANS ???
-#: stdio-common/../sysdeps/gnu/errlist.c:440
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:174
-msgid "Too many references: cannot splice"
+#: sunrpc/clnt_perr.c:125
+msgid "; why = "
 msgstr ""
 
-#. TRANS The file quota system is confused because there are too many users.
-#. TRANS @c This can probably happen in a GNU system when using NFS.
-#: stdio-common/../sysdeps/gnu/errlist.c:494
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:124
-msgid "Too many users"
-msgstr ""
+#: sunrpc/clnt_perr.c:132
+#, c-format
+msgid "(unknown authentication error - %d)"
+msgstr "( - %d)"
 
-#: stdio-common/../sysdeps/unix/siglist.c:31 sysdeps/generic/siglist.h:33
-msgid "Trace/breakpoint trap"
-msgstr ""
+#: sunrpc/clnt_perr.c:177
+msgid "RPC: Success"
+msgstr "RPC"
 
-#: posix/regex.c:1381
-msgid "Trailing backslash"
-msgstr ""
+#: sunrpc/clnt_perr.c:180
+msgid "RPC: Can't encode arguments"
+msgstr "RPC"
 
-#. TRANS In the GNU system, opening a file returns this error when the file is
-#. TRANS translated by a program and the translator program dies while starting
-#. TRANS up, before it has connected to the file.
-#: stdio-common/../sysdeps/gnu/errlist.c:615
-msgid "Translator died"
-msgstr ""
+#: sunrpc/clnt_perr.c:184
+msgid "RPC: Can't decode result"
+msgstr "RPC"
 
-#. TRANS You tried to connect a socket that is already connected.
-#. TRANS @xref{Connecting}.
-#: stdio-common/../sysdeps/gnu/errlist.c:415
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:163
-msgid "Transport endpoint is already connected"
-msgstr ""
+#: sunrpc/clnt_perr.c:188
+msgid "RPC: Unable to send"
+msgstr "RPC"
 
-#. TRANS The socket is not connected to anything.  You get this error when you
-#. TRANS try to transmit data over a socket, without first specifying a
-#. TRANS destination for the data.  For a connectionless socket (for datagram
-#. TRANS protocols, such as UDP), you get @code{EDESTADDRREQ} instead.
-#: stdio-common/../sysdeps/gnu/errlist.c:423
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:164
-msgid "Transport endpoint is not connected"
-msgstr ""
+#: sunrpc/clnt_perr.c:192
+msgid "RPC: Unable to receive"
+msgstr "RPC"
+
+#: sunrpc/clnt_perr.c:196
+msgid "RPC: Timed out"
+msgstr "RPC"
+
+#: sunrpc/clnt_perr.c:200
+msgid "RPC: Incompatible versions of RPC"
+msgstr "RPCRPC "
+
+#: sunrpc/clnt_perr.c:204
+msgid "RPC: Authentication error"
+msgstr "RPC"
+
+#: sunrpc/clnt_perr.c:208
+msgid "RPC: Program unavailable"
+msgstr "RPC"
+
+#: sunrpc/clnt_perr.c:212
+msgid "RPC: Program/version mismatch"
+msgstr "RPC/"
+
+#: sunrpc/clnt_perr.c:216
+msgid "RPC: Procedure unavailable"
+msgstr ""
 
-#: argp/argp-help.c:1611
-#, c-format
-msgid "Try `%s --help' or `%s --usage' for more information.\n"
-msgstr "%s --help%s --usage\n"
+#: sunrpc/clnt_perr.c:220
+msgid "RPC: Server can't decode arguments"
+msgstr "RPC"
 
-#: inet/rcmd.c:223
-#, c-format
-msgid "Trying %s...\n"
-msgstr " %s...\n"
+#: sunrpc/clnt_perr.c:224
+msgid "RPC: Remote system error"
+msgstr "RPC"
 
-#: nis/nis_print.c:167
-#, c-format
-msgid "Type : %s\n"
-msgstr "  %s\n"
+#: sunrpc/clnt_perr.c:228
+msgid "RPC: Unknown host"
+msgstr "RPC"
 
-#: nis/nis_print.c:51
-msgid "UNKNOWN"
-msgstr ""
+#: sunrpc/clnt_perr.c:232
+msgid "RPC: Unknown protocol"
+msgstr "RPC"
 
-#: nis/nis_error.c:73
-msgid "Unable to authenticate NIS+ client"
-msgstr " NIS+ "
+#: sunrpc/clnt_perr.c:236
+msgid "RPC: Port mapper failure"
+msgstr ""
 
-#: nis/nis_error.c:72
-msgid "Unable to authenticate NIS+ server"
-msgstr " NIS+ "
+#: sunrpc/clnt_perr.c:240
+msgid "RPC: Program not registered"
+msgstr "RPC"
 
-#: nis/nis_error.c:47
-msgid "Unable to create callback"
-msgstr ""
+#: sunrpc/clnt_perr.c:244
+msgid "RPC: Failed (unspecified error)"
+msgstr "RPC ()"
 
-#: nis/nis_error.c:75
-msgid "Unable to create process on server"
-msgstr ""
+#: sunrpc/clnt_perr.c:285
+msgid "RPC: (unknown error code)"
+msgstr "RPC()"
 
-#: nis/nis_print.c:194
-#, c-format
-msgid "Unknown (type = %d, bits = %d)\n"
-msgstr " ( = %d = %d)\n"
+#: sunrpc/clnt_perr.c:357
+msgid "Authentication OK"
+msgstr ""
 
-#: inet/ruserpass.c:277
-#, c-format
-msgid "Unknown .netrc keyword %s"
-msgstr " .netrc  %s"
+#: sunrpc/clnt_perr.c:360
+msgid "Invalid client credential"
+msgstr ""
 
-#: elf/../sysdeps/generic/readelflib.c:71
-#, c-format
-msgid "Unknown ELFCLASS in file %s.\n"
-msgstr " %s  ELFCLASS\n"
+#: sunrpc/clnt_perr.c:364
+msgid "Server rejected credential"
+msgstr ""
 
-#: nis/ypclnt.c:822
-msgid "Unknown NIS error code"
-msgstr " NIS "
+#: sunrpc/clnt_perr.c:368
+msgid "Invalid client verifier"
+msgstr ""
 
-#: elf/cache.c:101
-msgid "Unknown OS"
-msgstr ""
+#: sunrpc/clnt_perr.c:372
+msgid "Server rejected verifier"
+msgstr ""
 
-#: nss/getent.c:771
-#, c-format
-msgid "Unknown database: %s\n"
-msgstr "%s\n"
+#: sunrpc/clnt_perr.c:376
+msgid "Client credential too weak"
+msgstr ""
 
-#: posix/../sysdeps/posix/gai_strerror.c:57
-msgid "Unknown error"
-msgstr ""
+#: sunrpc/clnt_perr.c:380
+msgid "Invalid server verifier"
+msgstr ""
 
-#: string/../sysdeps/generic/_strerror.c:48
-#: string/../sysdeps/mach/_strerror.c:88
-#: sysdeps/mach/hurd/mips/dl-machine.c:83
-msgid "Unknown error "
-msgstr " "
+#: sunrpc/clnt_perr.c:384
+msgid "Failed (unspecified error)"
+msgstr " ()"
 
-#: resolv/herror.c:68
-msgid "Unknown host"
-msgstr ""
+#: sunrpc/clnt_raw.c:117
+msgid "clnt_raw.c - Fatal header serialization error."
+msgstr "clnt_raw.c - "
 
-#: nis/nis_error.c:35
-msgid "Unknown object"
-msgstr ""
+#: sunrpc/clnt_tcp.c:134 sunrpc/clnt_tcp.c:137
+msgid "clnttcp_create: out of memory\n"
+msgstr "clnttcp_create\n"
 
-#: nscd/nscd_conf.c:187
-#, c-format
-msgid "Unknown option: %s %s %s"
-msgstr "%s %s %s"
+#: sunrpc/clnt_udp.c:141 sunrpc/clnt_udp.c:144
+msgid "clntudp_create: out of memory\n"
+msgstr "clntudp_create\n"
 
-#: resolv/herror.c:110
-msgid "Unknown resolver error"
-msgstr ""
+#: sunrpc/clnt_unix.c:131 sunrpc/clnt_unix.c:134
+msgid "clntunix_create: out of memory\n"
+msgstr "clntunix_create\n"
 
-#: resolv/herror.c:70
-msgid "Unknown server error"
-msgstr ""
+#: sunrpc/get_myaddr.c:78
+msgid "get_myaddress: ioctl (get interface configuration)"
+msgstr "get_myaddressioctl ()"
 
-#: string/strsignal.c:71
-#, c-format
-msgid "Unknown signal %d"
-msgstr " %d"
+#: sunrpc/pm_getmaps.c:74
+msgid "pmap_getmaps rpc problem"
+msgstr ""
 
-#: misc/error.c:117 timezone/zic.c:390
-msgid "Unknown system error"
-msgstr ""
+#: sunrpc/pmap_clnt.c:72
+msgid "__get_myaddress: ioctl (get interface configuration)"
+msgstr "__get_myaddressioctl ()"
 
-#: nis/ypclnt.c:870
-msgid "Unknown ypbind error"
-msgstr " ypbind "
+#: sunrpc/pmap_clnt.c:137
+msgid "Cannot register service"
+msgstr ""
 
-#: posix/regex.c:1390
-msgid "Unmatched ( or \\("
-msgstr " (  \\("
+#: sunrpc/pmap_rmt.c:190
+msgid "broadcast: ioctl (get interface configuration)"
+msgstr "broadcastioctl ()"
 
-#: posix/regex.c:1414
-msgid "Unmatched ) or \\)"
-msgstr " )  \\)"
+#: sunrpc/pmap_rmt.c:199
+msgid "broadcast: ioctl (get interface flags)"
+msgstr "broadcastioctl ()"
 
-#: posix/regex.c:1387
-msgid "Unmatched [ or [^"
-msgstr "  [  [^"
+#: sunrpc/pmap_rmt.c:269
+msgid "Cannot create socket for broadcast rpc"
+msgstr " rpc "
 
-#: posix/regex.c:1393
-msgid "Unmatched \\{"
-msgstr " \\{"
+#: sunrpc/pmap_rmt.c:276
+msgid "Cannot set socket option SO_BROADCAST"
+msgstr " SO_BROADCAST"
 
-#: posix/getconf.c:1006
-#, c-format
-msgid "Unrecognized variable `%s'"
-msgstr "%s"
+#: sunrpc/pmap_rmt.c:328
+msgid "Cannot send broadcast packet"
+msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:42 sysdeps/generic/siglist.h:42
-msgid "Urgent I/O condition"
+#: sunrpc/pmap_rmt.c:353
+msgid "Broadcast poll problem"
 msgstr ""
 
-#: argp/argp-help.c:1568
-msgid "Usage:"
-msgstr ""
+#: sunrpc/pmap_rmt.c:366
+msgid "Cannot receive reply to broadcast"
+msgstr ""
 
-#: posix/getconf.c:883
+#: sunrpc/rpc_main.c:288
 #, c-format
-msgid "Usage: %s [-v specification] variable_name [pathname]\n"
-msgstr ""
+msgid "%s: output would overwrite %s\n"
+msgstr "%s %s\n"
 
-#: sunrpc/rpcinfo.c:674
-msgid "Usage: rpcinfo [ -n portnum ] -u host prognum [ versnum ]\n"
-msgstr "rpcinfo [ -n  ] -u   [  ]\n"
+#: sunrpc/rpc_main.c:295
+#, c-format
+msgid "%s: unable to open %s: %m\n"
+msgstr "%s %s%m\n"
 
-#: elf/ldconfig.c:127
-msgid "Use CACHE as cache file"
-msgstr " CACHE "
+#: sunrpc/rpc_main.c:307
+#, c-format
+msgid "%s: while writing output %s: %m"
+msgstr "%s %s %m"
 
-#: elf/ldconfig.c:128
-msgid "Use CONF as configuration file"
-msgstr " CONF "
+#: sunrpc/rpc_main.c:342
+#, c-format
+msgid "cannot find C preprocessor: %s \n"
+msgstr " C %s\n"
 
-#: nscd/nscd.c:92
-msgid "Use separate cache for each user"
-msgstr ""
+#: sunrpc/rpc_main.c:350
+msgid "cannot find any C preprocessor (cpp)\n"
+msgstr " C  (cpp)\n"
 
-#: stdio-common/../sysdeps/unix/siglist.c:56 sysdeps/generic/siglist.h:55
-msgid "User defined signal 1"
-msgstr " 1"
+#: sunrpc/rpc_main.c:419
+#, c-format
+msgid "%s: C preprocessor failed with signal %d\n"
+msgstr "%sC  %d \n"
 
-#: stdio-common/../sysdeps/unix/siglist.c:57 sysdeps/generic/siglist.h:56
-msgid "User defined signal 2"
-msgstr " 2"
+#: sunrpc/rpc_main.c:422
+#, c-format
+msgid "%s: C preprocessor failed with exit code %d\n"
+msgstr "%sC  %d\n"
 
-#: stdio-common/../sysdeps/gnu/errlist.c:673
-#: stdio-common/../sysdeps/unix/sysv/sysv4/solaris2/sparc/errlist.c:109
-msgid "Value too large for defined data type"
-msgstr ""
+#: sunrpc/rpc_main.c:462
+#, c-format
+msgid "illegal nettype :`%s'\n"
+msgstr "%s\n"
 
-#: stdio-common/../sysdeps/unix/siglist.c:52 sysdeps/generic/siglist.h:52
-msgid "Virtual timer expired"
-msgstr ""
+#: sunrpc/rpc_main.c:1104
+msgid "rpcgen: too many defines\n"
+msgstr "rpcgen\n"
 
-#: timezone/zic.c:1932
-msgid "Wild result from command execution"
+#: sunrpc/rpc_main.c:1116
+msgid "rpcgen: arglist coding error\n"
 msgstr ""
 
-#: stdio-common/../sysdeps/unix/siglist.c:54 sysdeps/generic/siglist.h:54
-msgid "Window changed"
-msgstr ""
+#. TRANS: the file will not be removed; this is an
+#. TRANS: informative message.
+#: sunrpc/rpc_main.c:1149
+#, c-format
+msgid "file `%s' already exists and may be overwritten\n"
+msgstr "%s\n"
 
-#: locale/programs/locale.c:77
-msgid "Write names of available charmaps"
-msgstr ""
+#: sunrpc/rpc_main.c:1194
+msgid "Cannot specify more than one input file!\n"
+msgstr "\n"
 
-#: locale/programs/locale.c:75
-msgid "Write names of available locales"
+#: sunrpc/rpc_main.c:1364
+msgid "This implementation doesn't support newstyle or MT-safe code!\n"
 msgstr ""
 
-#: locale/programs/locale.c:79
-msgid "Write names of selected categories"
-msgstr ""
+#: sunrpc/rpc_main.c:1373
+msgid "Cannot use netid flag with inetd flag!\n"
+msgstr " inetd  netid \n"
 
-#: locale/programs/locale.c:80
-msgid "Write names of selected keywords"
-msgstr ""
+#: sunrpc/rpc_main.c:1385
+msgid "Cannot use netid flag without TIRPC!\n"
+msgstr " TIRPC  netid \n"
 
-#: catgets/gencat.c:115
-msgid "Write output to file NAME"
-msgstr ""
+#: sunrpc/rpc_main.c:1392
+msgid "Cannot use table flags with newstyle!\n"
+msgstr "\n"
 
-#: elf/cache.c:402 elf/cache.c:411 elf/cache.c:415
-msgid "Writing of cache data failed"
-msgstr ""
+#: sunrpc/rpc_main.c:1411
+msgid "\"infile\" is required for template generation flags.\n"
+msgstr "\n"
 
-#: elf/cache.c:419
-msgid "Writing of cache data failed."
-msgstr ""
+#: sunrpc/rpc_main.c:1416
+msgid "Cannot have more than one file generation flag!\n"
+msgstr "\n"
 
-#: catgets/gencat.c:251 elf/ldconfig.c:264 elf/sprof.c:361
-#: iconv/iconv_prog.c:398 iconv/iconvconfig.c:340 locale/programs/locale.c:286
-#: locale/programs/localedef.c:316 nscd/nscd.c:292 nscd/nscd_nischeck.c:95
-#: nss/getent.c:68 posix/getconf.c:909
+#: sunrpc/rpc_main.c:1425
 #, c-format
-msgid "Written by %s.\n"
-msgstr ""
-
-#: stdio-common/../sysdeps/gnu/errlist.c:837
-msgid "Wrong medium type"
-msgstr ""
+msgid "usage: %s infile\n"
+msgstr "%s \n"
 
-#: nis/ypclnt.c:174
+#: sunrpc/rpc_main.c:1426
 #, c-format
-msgid "YPBINDPROC_DOMAIN: %s\n"
-msgstr ""
+msgid "\t%s [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile\n"
+msgstr "\t%s [-abkCLNTM][-D[=]] [-i ] [-I [-K ]] [-Y ] \n"
 
-#: nis/nis_error.c:71
-msgid "Yes, 42 is the meaning of life"
-msgstr ""
+#: sunrpc/rpc_main.c:1428
+#, c-format
+msgid "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]\n"
+msgstr "\t%s [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o ] []\n"
 
-#. TRANS You did @strong{what}?
-#: stdio-common/../sysdeps/gnu/errlist.c:627
-msgid "You really blew it this time"
-msgstr ""
+#: sunrpc/rpc_main.c:1430
+#, c-format
+msgid "\t%s [-s nettype]* [-o outfile] [infile]\n"
+msgstr "\t%s [-s ]* [-o ] []\n"
 
-#: timezone/zic.c:1094
-msgid "Zone continuation line end time is not after end time of previous line"
-msgstr ""
+#: sunrpc/rpc_main.c:1431
+#, c-format
+msgid "\t%s [-n netid]* [-o outfile] [infile]\n"
+msgstr "\t%s [-n  id]* [-o ] []\n"
 
-#: iconv/iconvconfig.c:114
-msgid "[DIR...]"
-msgstr "[...]"
+#: sunrpc/rpc_scan.c:116
+msgid "constant or identifier expected"
+msgstr ""
 
-#: iconv/iconv_prog.c:77
-msgid "[FILE...]"
-msgstr "[...]"
+#: sunrpc/rpc_scan.c:312
+msgid "illegal character in file: "
+msgstr ""
 
-#: debug/pcprofiledump.c:59
-msgid "[FILE]"
-msgstr "[]"
+#: sunrpc/rpc_scan.c:351 sunrpc/rpc_scan.c:377
+msgid "unterminated string constant"
+msgstr ""
 
-#: sunrpc/pmap_clnt.c:72
-msgid "__get_myaddress: ioctl (get interface configuration)"
+#: sunrpc/rpc_scan.c:383
+msgid "empty char string"
 msgstr ""
 
-#: locale/programs/ld-collate.c:417
-#, c-format
-msgid "`%.*s' already defined as collating element"
-msgstr ""
+#: sunrpc/rpc_scan.c:525 sunrpc/rpc_scan.c:535
+msgid "preprocessor error"
+msgstr ""
 
-#: locale/programs/ld-collate.c:410
+#: sunrpc/rpcinfo.c:237 sunrpc/rpcinfo.c:383
 #, c-format
-msgid "`%.*s' already defined as collating symbol"
-msgstr ""
+msgid "program %lu is not available\n"
+msgstr " %lu \n"
 
-#: locale/programs/ld-collate.c:394
+#: sunrpc/rpcinfo.c:264 sunrpc/rpcinfo.c:310 sunrpc/rpcinfo.c:333
+#: sunrpc/rpcinfo.c:407 sunrpc/rpcinfo.c:453 sunrpc/rpcinfo.c:476
+#: sunrpc/rpcinfo.c:510
 #, c-format
-msgid "`%.*s' already defined in charmap"
-msgstr ""
+msgid "program %lu version %lu is not available\n"
+msgstr " %lu  %lu \n"
 
-#: locale/programs/ld-collate.c:403
+#: sunrpc/rpcinfo.c:515
 #, c-format
-msgid "`%.*s' already defined in repertoire"
-msgstr ""
+msgid "program %lu version %lu ready and waiting\n"
+msgstr " %lu  %lu \n"
 
-#: locale/programs/charmap.c:604 locale/programs/locfile.h:96
-#: locale/programs/repertoire.c:314
-#, c-format
-msgid "`%1$s' definition does not end with `END %1$s'"
-msgstr ""
+#: sunrpc/rpcinfo.c:556 sunrpc/rpcinfo.c:563
+msgid "rpcinfo: can't contact portmapper"
+msgstr "rpcinfo portmapper "
+
+#: sunrpc/rpcinfo.c:570
+msgid "No remote programs registered.\n"
+msgstr "\n"
+
+#: sunrpc/rpcinfo.c:574
+msgid "   program vers proto   port\n"
+msgstr "        \n"
+
+#: sunrpc/rpcinfo.c:613
+msgid "(unknown)"
+msgstr "()"
 
-#: locale/programs/ld-collate.c:1281 locale/programs/ld-ctype.c:1455
+#: sunrpc/rpcinfo.c:637
 #, c-format
-msgid "`%s' and `%.*s' are no valid names for symbolic range"
-msgstr ""
+msgid "rpcinfo: broadcast failed: %s\n"
+msgstr "rpcinfo%s\n"
+
+#: sunrpc/rpcinfo.c:658
+msgid "Sorry. You are not root\n"
+msgstr "\n"
 
-#: elf/sprof.c:762
+#: sunrpc/rpcinfo.c:665
 #, c-format
-msgid "`%s' is no correct profile data file for `%s'"
-msgstr ""
+msgid "rpcinfo: Could not delete registration for prog %s version %s\n"
+msgstr "rpcinfo %s  %s \n"
 
-#: locale/programs/ld-ctype.c:699
-msgid "`digit' category has not entries in groups of ten"
-msgstr ""
+#: sunrpc/rpcinfo.c:674
+msgid "Usage: rpcinfo [ -n portnum ] -u host prognum [ versnum ]\n"
+msgstr "rpcinfo [ -n  ] -u   [  ]\n"
 
-#: posix/../sysdeps/posix/gai_strerror.c:35
-msgid "ai_family not supported"
-msgstr " ai_family"
+#: sunrpc/rpcinfo.c:676
+msgid "       rpcinfo [ -n portnum ] -t host prognum [ versnum ]\n"
+msgstr "       rpcinfo [ -n  ] -t   [  ]\n"
 
-#: posix/../sysdeps/posix/gai_strerror.c:40
-msgid "ai_socktype not supported"
-msgstr " ai_socktype"
+#: sunrpc/rpcinfo.c:678
+msgid "       rpcinfo -p [ host ]\n"
+msgstr "       rpcinfo -p [  ]\n"
 
-#: nscd/nscd.c:130
-msgid "already running"
-msgstr ""
+#: sunrpc/rpcinfo.c:679
+msgid "       rpcinfo -b prognum versnum\n"
+msgstr "       rpcinfo -b  \n"
+
+#: sunrpc/rpcinfo.c:680
+msgid "       rpcinfo -d prognum versnum\n"
+msgstr "       rpcinfo -d  \n"
 
-#: locale/programs/charmap.c:439 locale/programs/repertoire.c:184
+#: sunrpc/rpcinfo.c:695
 #, c-format
-msgid "argument to <%s> must be a single character"
-msgstr "<%s>"
+msgid "rpcinfo: %s is unknown service\n"
+msgstr "rpcinfo%s \n"
 
-#: locale/programs/locfile.c:126
+#: sunrpc/rpcinfo.c:732
 #, c-format
-msgid "argument to `%s' must be a single character"
-msgstr "%s"
+msgid "rpcinfo: %s is unknown host\n"
+msgstr "rpcinfo%s \n"
 
-#: sunrpc/auth_unix.c:322
-msgid "auth_none.c - Fatal marshalling problem"
+#: sunrpc/svc_run.c:76
+msgid "svc_run: - poll failed"
 msgstr ""
 
-#: sunrpc/auth_unix.c:114 sunrpc/auth_unix.c:117 sunrpc/auth_unix.c:150
-#: sunrpc/auth_unix.c:153
-msgid "authunix_create: out of memory\n"
-msgstr "authunix_create\n"
+#: sunrpc/svc_simple.c:87
+#, c-format
+msgid "can't reassign procedure number %ld\n"
+msgstr " %ld\n"
 
-#: locale/programs/charmap.c:369 locale/programs/locfile.c:120
-#: locale/programs/locfile.c:147 locale/programs/repertoire.c:176
-msgid "bad argument"
-msgstr ""
+#: sunrpc/svc_simple.c:96
+msgid "couldn't create an rpc server\n"
+msgstr " rpc \n"
 
-#: inet/rcmd.c:514
-msgid "bad owner"
-msgstr ""
+#: sunrpc/svc_simple.c:104
+#, c-format
+msgid "couldn't register prog %ld vers %ld\n"
+msgstr " %ld  %ld\n"
 
-#: timezone/zic.c:1216
-msgid "blank FROM field on Link line"
-msgstr "Link  FROM "
+#: sunrpc/svc_simple.c:111
+msgid "registerrpc: out of memory\n"
+msgstr "registerrpc\n"
 
-#: timezone/zic.c:1220
-msgid "blank TO field on Link line"
-msgstr "Link  TO "
+#: sunrpc/svc_simple.c:175
+#, c-format
+msgid "trouble replying to prog %d\n"
+msgstr ""
 
-#: malloc/mcheck.c:302
-msgid "block freed twice\n"
-msgstr "\n"
+#: sunrpc/svc_simple.c:183
+#, c-format
+msgid "never registered prog %d\n"
+msgstr " %d\n"
 
-#: malloc/mcheck.c:305
-msgid "bogus mcheck_status, library is buggy\n"
-msgstr ""
+#: sunrpc/svc_tcp.c:155
+msgid "svc_tcp.c - tcp socket creation problem"
+msgstr "svc_tcp.c - tcp "
 
-#: sunrpc/pmap_rmt.c:186
-msgid "broadcast: ioctl (get interface configuration)"
-msgstr "broadcastioctl ()"
+#: sunrpc/svc_tcp.c:170
+msgid "svc_tcp.c - cannot getsockname or listen"
+msgstr "svc_tcp.c -  getsockname  listen "
 
-#: sunrpc/pmap_rmt.c:195
-msgid "broadcast: ioctl (get interface flags)"
-msgstr "broadcastioctl ()"
+#: sunrpc/svc_tcp.c:181 sunrpc/svc_tcp.c:184
+msgid "svctcp_create: out of memory\n"
+msgstr "svctcp_create\n"
 
-#: sunrpc/svc_udp.c:541
-msgid "cache_set: could not allocate new rpc_buffer"
-msgstr "cache_set rpc_buffer"
+#: sunrpc/svc_tcp.c:225 sunrpc/svc_tcp.c:228
+msgid "svc_tcp: makefd_xprt: out of memory\n"
+msgstr "svc_tcpmakefd_xprt\n"
 
-#: sunrpc/svc_udp.c:535
-msgid "cache_set: victim alloc failed"
-msgstr ""
+#: sunrpc/svc_udp.c:128
+msgid "svcudp_create: socket creation problem"
+msgstr "svcudp_create: "
 
-#: sunrpc/svc_udp.c:524
-msgid "cache_set: victim not found"
-msgstr ""
+#: sunrpc/svc_udp.c:142
+msgid "svcudp_create - cannot getsockname"
+msgstr "svcudp_create -  getsockname"
 
-#: timezone/zic.c:1757
-msgid "can't determine time zone abbreviation to use just after until time"
-msgstr ""
+#: sunrpc/svc_udp.c:154 sunrpc/svc_udp.c:157
+msgid "svcudp_create: out of memory\n"
+msgstr "svcudp_create\n"
 
-#: sunrpc/svc_simple.c:88
-#, c-format
-msgid "can't reassign procedure number %ld\n"
-msgstr ""
+#: sunrpc/svc_udp.c:182 sunrpc/svc_udp.c:185
+msgid "svcudp_create: xp_pad is too small for IP_PKTINFO\n"
+msgstr "svcudp_createxp_pad  IP_PKTINFO \n"
 
-#: elf/dl-reloc.c:152
-msgid "can't restore segment prot after reloc"
-msgstr ""
+#: sunrpc/svc_udp.c:471
+msgid "enablecache: cache already enabled"
+msgstr "enablecache"
 
-#: locale/programs/localedef.c:487
-#, c-format
-msgid "cannot add already read locale `%s' a second time"
-msgstr "%s"
+#: sunrpc/svc_udp.c:477
+msgid "enablecache: could not allocate cache"
+msgstr "enablecache"
 
-#: elf/dl-deps.c:454
-msgid "cannot allocate dependency list"
-msgstr ""
+#: sunrpc/svc_udp.c:485
+msgid "enablecache: could not allocate cache data"
+msgstr "enablecache"
 
-#: elf/dl-load.c:1039
-msgid "cannot allocate memory for program header"
-msgstr ""
+#: sunrpc/svc_udp.c:492
+msgid "enablecache: could not allocate cache fifo"
+msgstr ""
 
-#: elf/dl-load.c:348
-msgid "cannot allocate name record"
-msgstr ""
+#: sunrpc/svc_udp.c:528
+msgid "cache_set: victim not found"
+msgstr "cache_set victim"
 
-#: elf/sprof.c:930 elf/sprof.c:982
-msgid "cannot allocate symbol data"
-msgstr ""
+#: sunrpc/svc_udp.c:539
+msgid "cache_set: victim alloc failed"
+msgstr "cache_set victim "
 
-#: elf/dl-deps.c:484
-msgid "cannot allocate symbol search list"
-msgstr ""
+#: sunrpc/svc_udp.c:545
+msgid "cache_set: could not allocate new rpc_buffer"
+msgstr "cache_set rpc_buffer"
 
-#: elf/dl-version.c:292
-msgid "cannot allocate version reference table"
-msgstr ""
+#: sunrpc/svc_unix.c:150
+msgid "svc_unix.c - AF_UNIX socket creation problem"
+msgstr "svc_unix.c - AF_UNIX "
 
-#: elf/dl-load.c:1008
-msgid "cannot change memory protections"
-msgstr ""
+#: sunrpc/svc_unix.c:166
+msgid "svc_unix.c - cannot getsockname or listen"
+msgstr "svc_unix.c -  getsockname  listen "
 
-#: elf/dl-load.c:540
-msgid "cannot create RUNPATH/RPATH copy"
-msgstr " RUNPATH/RPATH "
+#: sunrpc/svc_unix.c:178 sunrpc/svc_unix.c:181
+msgid "svcunix_create: out of memory\n"
+msgstr "svcunix_create\n"
 
-#: elf/dl-load.c:456 elf/dl-load.c:525 elf/dl-load.c:553 elf/dl-load.c:600
-#: elf/dl-load.c:693
-msgid "cannot create cache for search path"
-msgstr ""
+#: sunrpc/svc_unix.c:222 sunrpc/svc_unix.c:225
+msgid "svc_unix: makefd_xprt: out of memory\n"
+msgstr "svc_unixmakefd_xprt\n"
 
-#: elf/sprof.c:715 elf/sprof.c:773
-msgid "cannot create internal descriptor"
-msgstr ""
+#: sunrpc/xdr.c:570 sunrpc/xdr.c:573
+msgid "xdr_bytes: out of memory\n"
+msgstr "xdr_bytes\n"
 
-#: elf/sprof.c:413
-msgid "cannot create internal descriptors"
-msgstr ""
+#: sunrpc/xdr.c:725 sunrpc/xdr.c:728
+msgid "xdr_string: out of memory\n"
+msgstr "xdr_string\n"
 
-#: locale/programs/locfile.c:693
-#, c-format
-msgid "cannot create output file `%s' for category `%s'"
-msgstr ""
+#: sunrpc/xdr_array.c:111 sunrpc/xdr_array.c:114
+msgid "xdr_array: out of memory\n"
+msgstr "xdr_array\n"
 
-#: elf/dl-load.c:590
-msgid "cannot create search path array"
-msgstr ""
+#: sunrpc/xdr_rec.c:158 sunrpc/xdr_rec.c:161
+msgid "xdrrec_create: out of memory\n"
+msgstr "xdrrec_create\n"
 
-#: elf/dl-load.c:1125
-msgid "cannot create searchlist"
-msgstr ""
+#: sunrpc/xdr_ref.c:88 sunrpc/xdr_ref.c:91
+msgid "xdr_reference: out of memory\n"
+msgstr "xdr_reference\n"
 
-#: elf/dl-load.c:830 elf/dl-load.c:1724
-msgid "cannot create shared object descriptor"
-msgstr ""
+#: nis/nis_callback.c:189
+msgid "unable to free arguments"
+msgstr ""
 
-#: catgets/gencat.c:1315
-msgid "cannot determine escape character"
-msgstr ""
+#: nis/nis_error.c:30
+msgid "Probable success"
+msgstr ""
 
-#: elf/dl-load.c:958
-msgid "cannot dynamically load executable"
-msgstr ""
+#: nis/nis_error.c:31
+msgid "Not found"
+msgstr ""
 
-#: nscd/connections.c:183
-#, c-format
-msgid "cannot enable socket to accept connections: %s"
-msgstr "%s"
+#: nis/nis_error.c:32
+msgid "Probably not found"
+msgstr ""
 
-#: elf/dl-open.c:121
-msgid "cannot extend global scope"
-msgstr ""
+#: nis/nis_error.c:33
+msgid "Cache expired"
+msgstr ""
 
-#: sunrpc/rpc_main.c:343
-#, c-format
-msgid "cannot find C preprocessor: %s \n"
-msgstr " C %s\n"
+#: nis/nis_error.c:34
+msgid "NIS+ servers unreachable"
+msgstr "NIS+ "
 
-#: sunrpc/rpc_main.c:351
-msgid "cannot find any C preprocessor (cpp)\n"
-msgstr " C  (cpp)\n"
+#: nis/nis_error.c:35
+msgid "Unknown object"
+msgstr ""
 
-#: iconv/iconvconfig.c:1159
-msgid "cannot generate output file"
-msgstr ""
+#: nis/nis_error.c:36
+msgid "Server busy, try again"
+msgstr ""
 
-#: nscd/connections.c:227
-#, c-format
-msgid "cannot handle old request version %d; current version is %d"
-msgstr " %d %d"
+#: nis/nis_error.c:37
+msgid "Generic system error"
+msgstr ""
 
-#: elf/sprof.c:670
-msgid "cannot load profiling data"
+#: nis/nis_error.c:38
+msgid "First/next chain broken"
 msgstr ""
 
-#: elf/dl-reloc.c:62
-msgid "cannot make segment writable for relocation"
+#: nis/nis_error.c:41
+msgid "Name not served by this server"
 msgstr ""
 
-#: elf/dl-load.c:1024
-msgid "cannot map zero-fill pages"
-msgstr ""
+#: nis/nis_error.c:42
+msgid "Server out of memory"
+msgstr ""
 
-#: inet/rcmd.c:510
-msgid "cannot open"
-msgstr ""
+#: nis/nis_error.c:43
+msgid "Object with same name exists"
+msgstr ""
 
-#: sysdeps/unix/sysv/linux/lddlibc4.c:64
-#, c-format
-msgid "cannot open `%s'"
-msgstr "%s"
+#: nis/nis_error.c:44
+msgid "Not master server for this domain"
+msgstr ""
 
-#: debug/pcprofiledump.c:96
-msgid "cannot open input file"
-msgstr ""
+#: nis/nis_error.c:45
+msgid "Invalid object for operation"
+msgstr ""
 
-#: catgets/gencat.c:288 iconv/iconv_charmap.c:159 iconv/iconv_prog.c:265
-#, c-format
-msgid "cannot open input file `%s'"
-msgstr "%s"
+#: nis/nis_error.c:46
+msgid "Malformed name, or illegal name"
+msgstr ""
 
-#: locale/programs/localedef.c:203 locale/programs/localedef.c:218
-#: locale/programs/localedef.c:513 locale/programs/localedef.c:533
-#, c-format
-msgid "cannot open locale definition file `%s'"
-msgstr "%s"
+#: nis/nis_error.c:47
+msgid "Unable to create callback"
+msgstr ""
 
-#: iconv/iconv_prog.c:209
-msgid "cannot open output file"
-msgstr ""
+#: nis/nis_error.c:48
+msgid "Results sent to callback proc"
+msgstr ""
 
-#: catgets/gencat.c:949 catgets/gencat.c:990
-#, c-format
-msgid "cannot open output file `%s'"
-msgstr "%s"
+#: nis/nis_error.c:49
+msgid "Not found, no such name"
+msgstr ""
 
-#: locale/programs/locfile.c:571
-#, c-format
-msgid "cannot open output file `%s' for category `%s'"
-msgstr "%2$s%1$s"
+#: nis/nis_error.c:50
+msgid "Name/entry isn't unique"
+msgstr "/"
 
-#: elf/dl-load.c:1737
-msgid "cannot open shared object file"
-msgstr ""
+#: nis/nis_error.c:51
+msgid "Modification failed"
+msgstr ""
 
-#: nscd/connections.c:165
-#, c-format
-msgid "cannot open socket: %s"
-msgstr "%s"
+#: nis/nis_error.c:52
+msgid "Database for table does not exist"
+msgstr ""
 
-#: elf/dl-load.c:822
-msgid "cannot open zero fill device"
-msgstr ""
+#: nis/nis_error.c:53
+msgid "Entry/table type mismatch"
+msgstr "/"
 
-#: locale/programs/charmap-dir.c:61
-#, c-format
-msgid "cannot read character map directory `%s'"
-msgstr ""
+#: nis/nis_error.c:54
+msgid "Link points to illegal name"
+msgstr ""
 
-#: nscd/connections.c:125
-msgid "cannot read configuration file; this is fatal"
-msgstr ""
+#: nis/nis_error.c:55
+msgid "Partial success"
+msgstr ""
 
-#: elf/dl-load.c:846 elf/dl-load.c:1247 elf/dl-load.c:1319 elf/dl-load.c:1333
-msgid "cannot read file data"
-msgstr ""
+#: nis/nis_error.c:56
+msgid "Too many attributes"
+msgstr ""
 
-#: debug/pcprofiledump.c:102
-msgid "cannot read header"
-msgstr ""
+#: nis/nis_error.c:57
+msgid "Error in RPC subsystem"
+msgstr "RPC "
 
-#: sysdeps/unix/sysv/linux/lddlibc4.c:68
-#, c-format
-msgid "cannot read header from `%s'"
-msgstr "%s"
+#: nis/nis_error.c:58
+msgid "Missing or malformed attribute"
+msgstr ""
 
-#: nscd/nscd_stat.c:128
-msgid "cannot read statistics data"
-msgstr ""
+#: nis/nis_error.c:59
+msgid "Named object is not searchable"
+msgstr ""
 
-#: locale/programs/repertoire.c:331
-msgid "cannot safe new repertoire map"
+#: nis/nis_error.c:60
+msgid "Error while talking to callback proc"
+msgstr ""
+
+#: nis/nis_error.c:61
+msgid "Non NIS+ namespace encountered"
 msgstr ""
 
-#: elf/dl-load.c:784
-msgid "cannot stat shared object"
-msgstr " stat "
+#: nis/nis_error.c:62
+msgid "Illegal object type for operation"
+msgstr ""
 
-#: nscd/cache.c:150 nscd/connections.c:151
-#, c-format
-msgid "cannot stat() file `%s': %s"
-msgstr "%s stat() %s"
+#: nis/nis_error.c:63
+msgid "Passed object is not the same object on server"
+msgstr ""
 
-#: locale/programs/localedef.c:230
-#, c-format
-msgid "cannot write output files to `%s'"
-msgstr "%s"
+#: nis/nis_error.c:64
+msgid "Modify operation failed"
+msgstr ""
 
-#: nscd/connections.c:265 nscd/connections.c:287
-#, c-format
-msgid "cannot write result: %s"
-msgstr "%s"
+#: nis/nis_error.c:65
+msgid "Query illegal for named table"
+msgstr ""
 
-#: nscd/nscd_stat.c:87
-#, c-format
-msgid "cannot write statistics: %s"
-msgstr "%s"
+#: nis/nis_error.c:66
+msgid "Attempt to remove a non-empty table"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:517
-#, c-format
-msgid "character '%s' in class `%s' must be in class `%s'"
-msgstr "%2$s%1$s%3$s"
+#: nis/nis_error.c:67
+msgid "Error in accessing NIS+ cold start file.  Is NIS+ installed?"
+msgstr " NIS+ NIS+ "
 
-#: locale/programs/ld-ctype.c:532
-#, c-format
-msgid "character '%s' in class `%s' must not be in class `%s'"
-msgstr "%2$s%1$s%3$s"
+#: nis/nis_error.c:68
+msgid "Full resync required for directory"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:587
-msgid "character <SP> not defined in character map"
-msgstr ""
+#: nis/nis_error.c:69
+msgid "NIS+ operation failed"
+msgstr "NIS+ "
 
-#: locale/programs/ld-ctype.c:461
-#, c-format
-msgid "character L'\\u%0*x' in class `%s' must be in class `%s'"
-msgstr ""
+#: nis/nis_error.c:70
+msgid "NIS+ service is unavailable or not installed"
+msgstr "NIS+ "
 
-# msgstr "%2$s L'\\u%0*x' %3$s"
-#: locale/programs/ld-ctype.c:475
-#, c-format
-msgid "character L'\\u%0*x' in class `%s' must not be in class `%s'"
+#: nis/nis_error.c:71
+msgid "Yes, 42 is the meaning of life"
 msgstr ""
 
-# msgstr "%s L'\\u%0*x' %s"
-#: locale/programs/ld-ctype.c:3032
-#, c-format
-msgid "character `%s' not defined while needed as default value"
-msgstr ""
+#: nis/nis_error.c:72
+msgid "Unable to authenticate NIS+ server"
+msgstr " NIS+ "
 
-#: locale/programs/ld-ctype.c:1223
-#, c-format
-msgid "character class `%s' already defined"
-msgstr "%s"
+#: nis/nis_error.c:73
+msgid "Unable to authenticate NIS+ client"
+msgstr " NIS+ "
 
-#: locale/programs/ld-ctype.c:1255
-#, c-format
-msgid "character map `%s' already defined"
-msgstr ""
+#: nis/nis_error.c:74
+msgid "No file space on server"
+msgstr ""
 
-#: locale/programs/charmap.c:254
-#, c-format
-msgid "character map `%s' is not ASCII compatible, locale not ISO C compliant\n"
+#: nis/nis_error.c:75
+msgid "Unable to create process on server"
+msgstr ""
+
+#: nis/nis_error.c:76
+msgid "Master server busy, full dump rescheduled."
 msgstr ""
 
-#: locale/programs/charmap.c:140
+#: nis/nis_local_names.c:126
 #, c-format
-msgid "character map file `%s' not found"
+msgid "LOCAL entry for UID %d in directory %s not unique\n"
 msgstr ""
 
-#: locale/programs/charmap.c:465
-msgid "character sets with locking states are not supported"
-msgstr ""
+#: nis/nis_print.c:51
+msgid "UNKNOWN"
+msgstr ""
 
-#: intl/tst-codeset.c:40 intl/tst-codeset.c:50
-msgid "cheese"
-msgstr ""
+#: nis/nis_print.c:109
+msgid "BOGUS OBJECT\n"
+msgstr ""
 
-#: locale/programs/localedef.c:482
-msgid "circular dependencies between locale definitions"
-msgstr ""
+#: nis/nis_print.c:112
+msgid "NO OBJECT\n"
+msgstr "\n"
 
-#: sunrpc/clnt_raw.c:115
-msgid "clnt_raw.c - Fatal header serialization error."
-msgstr ""
+#: nis/nis_print.c:115
+msgid "DIRECTORY\n"
+msgstr "\n"
 
-#: sunrpc/clnt_tcp.c:134 sunrpc/clnt_tcp.c:137
-msgid "clnttcp_create: out of memory\n"
-msgstr "clnttcp_create\n"
+#: nis/nis_print.c:118
+msgid "GROUP\n"
+msgstr "\n"
 
-#: sunrpc/clnt_udp.c:141 sunrpc/clnt_udp.c:144
-msgid "clntudp_create: out of memory\n"
-msgstr "clntudp_create\n"
+#: nis/nis_print.c:121
+msgid "TABLE\n"
+msgstr "\n"
 
-#: sunrpc/clnt_unix.c:131 sunrpc/clnt_unix.c:134
-msgid "clntunix_create: out of memory\n"
-msgstr "clntunix_create\n"
+#: nis/nis_print.c:124
+msgid "ENTRY\n"
+msgstr "\n"
 
-#: inet/rcmd.c:209
-#, c-format
-msgid "connect to address %s: "
-msgstr " %s"
+#: nis/nis_print.c:127
+msgid "LINK\n"
+msgstr "\n"
 
-#: sunrpc/rpc_scan.c:116
-msgid "constant or identifier expected"
-msgstr ""
+#: nis/nis_print.c:130
+msgid "PRIVATE\n"
+msgstr "\n"
 
-#: iconv/iconv_prog.c:231
-#, c-format
-msgid "conversion from `%s' to `%s' not supported"
-msgstr "%s%s"
+#: nis/nis_print.c:133
+msgid "(Unknown object)\n"
+msgstr "()\n"
 
-#: catgets/gencat.c:1289
-msgid "conversion modules not available"
-msgstr ""
+#: nis/nis_print.c:166
+#, c-format
+msgid "Name : `%s'\n"
+msgstr " %s\n"
 
-#: locale/programs/ld-monetary.c:902
-msgid "conversion rate value cannot be zero"
-msgstr " 0"
+#: nis/nis_print.c:167
+#, c-format
+msgid "Type : %s\n"
+msgstr "  %s\n"
 
-#: iconv/iconv_prog.c:427 iconv/iconv_prog.c:452
-msgid "conversion stopped due to problem in writing the output"
-msgstr ""
+#: nis/nis_print.c:172
+msgid "Master Server :\n"
+msgstr " \n"
 
-#: sunrpc/svc_simple.c:97
-msgid "couldn't create an rpc server\n"
-msgstr " rpc \n"
+#: nis/nis_print.c:174
+msgid "Replicate :\n"
+msgstr ""
 
-#: sunrpc/svc_simple.c:105
+#: nis/nis_print.c:175
 #, c-format
-msgid "couldn't register prog %ld vers %ld\n"
-msgstr " %ld  %ld\n"
+msgid "\tName       : %s\n"
+msgstr "\t     %s\n"
 
-#: nss/getent.c:51
-msgid "database [key ...]"
-msgstr " [ ...]"
+#: nis/nis_print.c:176
+msgid "\tPublic Key : "
+msgstr "\t     "
 
-#: locale/programs/charmap.c:197
-#, c-format
-msgid "default character map file `%s' not found"
-msgstr ""
+#: nis/nis_print.c:180
+msgid "None.\n"
+msgstr "\n"
 
-#: locale/programs/charmap.c:397
+#: nis/nis_print.c:183
 #, c-format
-msgid "duplicate definition of <%s>"
-msgstr " <%s>"
+msgid "Diffie-Hellmann (%d bits)\n"
+msgstr ""
 
-#: locale/programs/ld-collate.c:3062
+#: nis/nis_print.c:188
 #, c-format
-msgid "duplicate definition of script `%s'"
-msgstr "%s"
+msgid "RSA (%d bits)\n"
+msgstr "RSA (%d )\n"
 
-#: catgets/gencat.c:430
-msgid "duplicate set definition"
+#: nis/nis_print.c:191
+msgid "Kerberos.\n"
 msgstr ""
 
-#: timezone/zic.c:1009
+#: nis/nis_print.c:194
 #, c-format
-msgid "duplicate zone name %s (file \"%s\", line %d)"
-msgstr " %s (%s %d)"
+msgid "Unknown (type = %d, bits = %d)\n"
+msgstr " ( = %d = %d)\n"
 
-#: locale/programs/ld-ctype.c:2559
+#: nis/nis_print.c:205
 #, c-format
-msgid "duplicated definition for mapping `%s'"
+msgid "\tUniversal addresses (%u)\n"
 msgstr ""
 
-#: catgets/gencat.c:631
-msgid "duplicated message identifier"
-msgstr ""
+#: nis/nis_print.c:227
+msgid "Time to live : "
+msgstr " "
 
-#: catgets/gencat.c:603
-msgid "duplicated message number"
-msgstr ""
+#: nis/nis_print.c:229
+msgid "Default Access rights :\n"
+msgstr " \n"
 
-#: locale/programs/ld-ctype.c:2370
-msgid "ellipsis range must be marked by two operands of same type"
-msgstr ""
+#: nis/nis_print.c:238
+#, c-format
+msgid "\tType         : %s\n"
+msgstr "\t     %s\n"
 
-#: sunrpc/rpc_scan.c:383
-msgid "empty char string"
-msgstr ""
+#: nis/nis_print.c:239
+msgid "\tAccess rights: "
+msgstr "\t "
 
-#: elf/dl-open.c:219
-msgid "empty dynamic string token substitution"
-msgstr ""
+#: nis/nis_print.c:252
+msgid "Group Flags :"
+msgstr " "
 
-#: elf/dl-deps.c:113
-msgid "empty dynamics string token substitution"
+#: nis/nis_print.c:255
+msgid ""
+"\n"
+"Group Members :\n"
 msgstr ""
+"\n"
+"     \n"
 
-#: sunrpc/svc_udp.c:467
-msgid "enablecache: cache already enabled"
-msgstr "enablecache"
+#: nis/nis_print.c:266
+#, c-format
+msgid "Table Type          : %s\n"
+msgstr "   %s\n"
 
-#: sunrpc/svc_udp.c:473
-msgid "enablecache: could not allocate cache"
-msgstr "enablecache"
+#: nis/nis_print.c:267
+#, c-format
+msgid "Number of Columns   : %d\n"
+msgstr "    %d\n"
 
-#: sunrpc/svc_udp.c:481
-msgid "enablecache: could not allocate cache data"
-msgstr "enablecache"
+#: nis/nis_print.c:268
+#, c-format
+msgid "Character Separator : %c\n"
+msgstr "%c\n"
 
-#: sunrpc/svc_udp.c:488
-msgid "enablecache: could not allocate cache fifo"
+#: nis/nis_print.c:269
+#, c-format
+msgid "Search Path         : %s\n"
+msgstr "  %s\n"
+
+#: nis/nis_print.c:270
+msgid "Columns             :\n"
 msgstr ""
 
-#: iconv/iconv_prog.c:61
-msgid "encoding for output"
-msgstr ""
+#: nis/nis_print.c:273
+#, c-format
+msgid "\t[%d]\tName          : %s\n"
+msgstr "\t[%d]\t       %s\n"
 
-#: iconv/iconv_prog.c:60
-msgid "encoding of original text"
-msgstr ""
+#: nis/nis_print.c:275
+msgid "\t\tAttributes    : "
+msgstr "\t\t     "
 
-#: nscd/connections.c:366 nscd/connections.c:460
-#, c-format
-msgid "error getting callers id: %s"
-msgstr ""
+#: nis/nis_print.c:277
+msgid "\t\tAccess Rights : "
+msgstr "\t\t "
 
-#: locale/programs/ld-collate.c:3032
-msgid "error while adding equivalent collating symbol"
-msgstr ""
+#: nis/nis_print.c:286
+msgid "Linked Object Type : "
+msgstr " "
 
-#: iconv/iconv_charmap.c:177 iconv/iconv_prog.c:283
+#: nis/nis_print.c:288
 #, c-format
-msgid "error while closing input `%s'"
-msgstr "%s"
-
-#: iconv/iconv_prog.c:330
-msgid "error while closing output file"
-msgstr ""
+msgid "Linked to : %s\n"
+msgstr " %s\n"
 
-#: elf/sprof.c:706
-msgid "error while closing the profiling data file"
+#: nis/nis_print.c:297
+#, c-format
+msgid "\tEntry data of type %s\n"
 msgstr ""
 
-#: iconv/iconv_charmap.c:507 iconv/iconv_charmap.c:538 iconv/iconv_prog.c:516
-#: iconv/iconv_prog.c:547
-msgid "error while reading the input"
-msgstr ""
+#: nis/nis_print.c:300
+#, c-format
+msgid "\t[%u] - [%u bytes] "
+msgstr "\t[%u] - [%u ] "
 
-#: locale/programs/locfile.h:59
-msgid "expect string argument for `copy'"
-msgstr ""
+#: nis/nis_print.c:303
+msgid "Encrypted data\n"
+msgstr "\n"
 
-#: timezone/zic.c:899
-msgid "expected continuation line not found"
-msgstr ""
+#: nis/nis_print.c:305
+msgid "Binary data\n"
+msgstr "\n"
 
-#: locale/programs/ld-time.c:1027
-msgid "extra trailing semicolon"
-msgstr ""
+#: nis/nis_print.c:320
+#, c-format
+msgid "Object Name   : %s\n"
+msgstr "  %s\n"
 
-#: elf/sprof.c:404
+#: nis/nis_print.c:321
 #, c-format
-msgid "failed to load shared object `%s'"
-msgstr "%s"
+msgid "Directory     : %s\n"
+msgstr "     %s\n"
 
-#: elf/sprof.c:600
-msgid "failed to load symbol data"
-msgstr ""
+#: nis/nis_print.c:322
+#, c-format
+msgid "Owner         : %s\n"
+msgstr " %s\n"
 
-#: elf/dl-load.c:771
-msgid "failed to map segment from shared object"
-msgstr ""
+#: nis/nis_print.c:323
+#, c-format
+msgid "Group         : %s\n"
+msgstr "     %s\n"
 
-#: elf/sprof.c:698
-msgid "failed to mmap the profiling data file"
-msgstr ""
+#: nis/nis_print.c:324
+msgid "Access Rights : "
+msgstr ""
 
-#: iconv/iconv_prog.c:235
-msgid "failed to start conversion processing"
+#: nis/nis_print.c:326
+msgid ""
+"\n"
+"Time to Live  : "
 msgstr ""
+"\n"
+" "
 
-#: locale/programs/locfile.c:596
+#: nis/nis_print.c:329
 #, c-format
-msgid "failure while writing data for category `%s'"
-msgstr ""
+msgid "Creation Time : %s"
+msgstr "%s"
+
+#: nis/nis_print.c:331
+#, c-format
+msgid "Mod. Time     : %s"
+msgstr "     %s"
+
+#: nis/nis_print.c:332
+msgid "Object Type   : "
+msgstr "  %s"
 
-#: elf/../sysdeps/generic/readelflib.c:35
+#: nis/nis_print.c:352
 #, c-format
-msgid "file %s is truncated\n"
-msgstr " %s \n"
+msgid "    Data Length = %u\n"
+msgstr "     = %u\n"
 
-#. TRANS: the file will not be removed; this is an
-#. TRANS: informative message.
-#: sunrpc/rpc_main.c:1150
+#: nis/nis_print.c:365
 #, c-format
-msgid "file `%s' already exists and may be overwritten\n"
-msgstr "%s\n"
+msgid "Status            : %s\n"
+msgstr "     %s\n"
 
-#: elf/dl-load.c:1247
-msgid "file too short"
-msgstr ""
+#: nis/nis_print.c:366
+#, c-format
+msgid "Number of objects : %u\n"
+msgstr " %u\n"
 
-#: inet/rcmd.c:512
-msgid "fstat failed"
-msgstr "fstat "
+#: nis/nis_print.c:370
+#, c-format
+msgid "Object #%d:\n"
+msgstr " #%d\n"
 
-#: locale/programs/linereader.c:388
-msgid "garbage at end of character code specification"
+#: nis/nis_print_group_entry.c:115
+#, c-format
+msgid "Group entry for \"%s.%s\" group:\n"
 msgstr ""
 
-#: locale/programs/linereader.c:276
-msgid "garbage at end of number"
-msgstr ""
-
-#: elf/sprof.c:77
-msgid "generate call graph"
-msgstr ""
+#: nis/nis_print_group_entry.c:123
+msgid "    Explicit members:\n"
+msgstr "    \n"
 
-#: elf/sprof.c:76
-msgid "generate flat profile with counts and ticks"
-msgstr ""
+#: nis/nis_print_group_entry.c:128
+msgid "    No explicit members\n"
+msgstr "    \n"
 
-#: sunrpc/get_myaddr.c:78
-msgid "get_myaddress: ioctl (get interface configuration)"
-msgstr "get_myaddressioctl ()"
+#: nis/nis_print_group_entry.c:131
+msgid "    Implicit members:\n"
+msgstr "    \n"
 
-#: nss/getent.c:702
-msgid "getent - get entries from administrative database."
-msgstr "getent - "
+#: nis/nis_print_group_entry.c:136
+msgid "    No implicit members\n"
+msgstr "    \n"
 
-#: nscd/connections.c:221
-#, c-format
-msgid "handle_request: request received (Version = %d)"
-msgstr " ( = %d)"
+#: nis/nis_print_group_entry.c:139
+msgid "    Recursive members:\n"
+msgstr "    \n"
 
-#: timezone/zic.c:643
-msgid "hard link failed, symbolic link used"
-msgstr ""
+#: nis/nis_print_group_entry.c:144
+msgid "    No recursive members\n"
+msgstr "    \n"
 
-#: inet/rcmd.c:518
-msgid "hard linked somewhere"
+#: nis/nis_print_group_entry.c:147 nis/nis_print_group_entry.c:163
+msgid "    Explicit nonmembers:\n"
 msgstr ""
 
-#: locale/programs/charmap.c:986 locale/programs/repertoire.c:430
-msgid "hexadecimal range format should use only capital characters"
+#: nis/nis_print_group_entry.c:152
+msgid "    No explicit nonmembers\n"
 msgstr ""
 
-#: timezone/zic.c:1193
-msgid "illegal CORRECTION field on Leap line"
+#: nis/nis_print_group_entry.c:155
+msgid "    Implicit nonmembers:\n"
 msgstr ""
 
-#: timezone/zic.c:1197
-msgid "illegal Rolling/Stationary field on Leap line"
+#: nis/nis_print_group_entry.c:160
+msgid "    No implicit nonmembers\n"
 msgstr ""
 
-#: sunrpc/rpc_scan.c:312
-msgid "illegal character in file: "
-msgstr ""
-
-#: locale/programs/linereader.c:600
-msgid "illegal escape sequence at end of string"
-msgstr ""
+#: nis/nis_print_group_entry.c:168
+msgid "    No recursive nonmembers\n"
+msgstr ""
 
-#: iconv/iconv_charmap.c:443
+#: nis/nss_nisplus/nisplus-publickey.c:96
+#: nis/nss_nisplus/nisplus-publickey.c:172
 #, c-format
-msgid "illegal input sequence at position %Zd"
+msgid "DES entry for netname %s not unique\n"
 msgstr ""
 
-#: iconv/iconv_prog.c:469
+#: nis/nss_nisplus/nisplus-publickey.c:208
 #, c-format
-msgid "illegal input sequence at position %ld"
-msgstr " %ld "
+msgid "netname2user: missing group id list in `%s'."
+msgstr ""
 
-#: sunrpc/rpc_main.c:463
+#: nis/nss_nisplus/nisplus-publickey.c:285
+#: nis/nss_nisplus/nisplus-publickey.c:291
+#: nis/nss_nisplus/nisplus-publickey.c:350
+#: nis/nss_nisplus/nisplus-publickey.c:359
 #, c-format
-msgid "illegal nettype :`%s'\n"
-msgstr "%s\n"
-
-#: catgets/gencat.c:403 catgets/gencat.c:480
-msgid "illegal set number"
+msgid "netname2user: (nis+ lookup): %s\n"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:1229
+#: nis/nss_nisplus/nisplus-publickey.c:304
 #, c-format
-msgid "implementation limit: no more than %Zd character classes allowed"
+msgid "netname2user: DES entry for %s in directory %s not unique"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:1261
+#: nis/nss_nisplus/nisplus-publickey.c:322
 #, c-format
-msgid "implementation limit: no more than %d character maps allowed"
-msgstr ""
+msgid "netname2user: principal name `%s' too long"
+msgstr "netname2user%s"
 
-#: iconv/iconv_charmap.c:462 iconv/iconv_prog.c:473
-msgid "incomplete character or shift sequence at end of buffer"
+#: nis/nss_nisplus/nisplus-publickey.c:372
+#, c-format
+msgid "netname2user: LOCAL entry for %s in directory %s not unique"
 msgstr ""
 
-#: timezone/zic.c:856
-msgid "input line of unknown type"
-msgstr ""
-
-#: elf/dl-load.c:1294
-msgid "internal error"
-msgstr ""
-
-#: iconv/iconv_prog.c:477
-msgid "internal error (illegal descriptor)"
-msgstr " ()"
+#: nis/nss_nisplus/nisplus-publickey.c:379
+msgid "netname2user: should not have uid 0"
+msgstr "netname2useruid  0"
 
-#: timezone/zic.c:1819
-msgid "internal error - addtype called with bad isdst"
-msgstr " -  isdst  addtype"
+#: nis/ypclnt.c:174
+#, c-format
+msgid "YPBINDPROC_DOMAIN: %s\n"
+msgstr "YPBINDPROC_DOMAIN%s\n"
 
-#: timezone/zic.c:1827
-msgid "internal error - addtype called with bad ttisgmt"
-msgstr " -  ttisgmt  addtype"
+#: nis/ypclnt.c:789
+msgid "Request arguments bad"
+msgstr ""
 
-#: timezone/zic.c:1823
-msgid "internal error - addtype called with bad ttisstd"
-msgstr " -  ttisstd  addtype"
+#: nis/ypclnt.c:791
+msgid "RPC failure on NIS operation"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:488 locale/programs/ld-ctype.c:544
-#, c-format
-msgid "internal error in %s, line %u"
-msgstr " %s  %u "
+#: nis/ypclnt.c:793
+msgid "Can't bind to server which serves this domain"
+msgstr ""
 
-#: elf/dl-load.c:1267
-msgid "invalid ELF header"
-msgstr " ELF "
+#: nis/ypclnt.c:795
+msgid "No such map in server's domain"
+msgstr ""
 
-#: timezone/zic.c:1065
-msgid "invalid UTC offset"
-msgstr " UTC "
+#: nis/ypclnt.c:797
+msgid "No such key in map"
+msgstr ""
 
-#: timezone/zic.c:1068
-msgid "invalid abbreviation format"
-msgstr ""
+#: nis/ypclnt.c:799
+msgid "Internal NIS error"
+msgstr " NIS "
 
-#: catgets/gencat.c:688
-msgid "invalid character: message ignored"
-msgstr ""
+#: nis/ypclnt.c:801
+msgid "Local resource allocation failure"
+msgstr ""
 
-#: timezone/zic.c:1158 timezone/zic.c:1370 timezone/zic.c:1384
-msgid "invalid day of month"
+#: nis/ypclnt.c:803
+msgid "No more records in map database"
 msgstr ""
 
-#: locale/programs/charmap.c:352
-msgid "invalid definition"
-msgstr ""
+#: nis/ypclnt.c:805
+msgid "Can't communicate with portmapper"
+msgstr " portmapper "
 
-#: locale/programs/charmap.c:547
-msgid "invalid encoding given"
-msgstr ""
+#: nis/ypclnt.c:807
+msgid "Can't communicate with ypbind"
+msgstr " ypbind "
 
-#: timezone/zic.c:1322
-msgid "invalid ending year"
-msgstr ""
+#: nis/ypclnt.c:809
+msgid "Can't communicate with ypserv"
+msgstr " ypserv "
 
-#: catgets/gencat.c:1152 locale/programs/linereader.c:538
-msgid "invalid escape sequence"
-msgstr ""
+#: nis/ypclnt.c:811
+msgid "Local domain name not set"
+msgstr ""
 
-#: timezone/zic.c:1130
-msgid "invalid leaping year"
-msgstr ""
+#: nis/ypclnt.c:813
+msgid "NIS map database is bad"
+msgstr "NIS "
 
-#: catgets/gencat.c:731
-msgid "invalid line"
-msgstr ""
+#: nis/ypclnt.c:815
+msgid "NIS client/server version mismatch - can't supply service"
+msgstr "NIS / - "
 
-#: elf/dl-open.c:349
-msgid "invalid mode for dlopen()"
-msgstr " dlopen() "
+#: nis/ypclnt.c:819
+msgid "Database is busy"
+msgstr ""
 
-#: timezone/zic.c:1145 timezone/zic.c:1248
-msgid "invalid month name"
-msgstr ""
+#: nis/ypclnt.c:821
+msgid "Unknown NIS error code"
+msgstr " NIS "
 
-#: locale/programs/charmap.c:974 locale/programs/ld-collate.c:2888
-#: locale/programs/repertoire.c:418
-msgid "invalid names for character range"
-msgstr ""
+#: nis/ypclnt.c:863
+msgid "Internal ypbind error"
+msgstr " ypbind "
 
-#: debug/pcprofiledump.c:166
-msgid "invalid pointer size"
-msgstr ""
+#: nis/ypclnt.c:865
+msgid "Domain not bound"
+msgstr ""
 
-#: catgets/gencat.c:549
-msgid "invalid quote character"
-msgstr ""
+#: nis/ypclnt.c:867
+msgid "System resource allocation failure"
+msgstr ""
 
-#: timezone/zic.c:964
-msgid "invalid saved time"
-msgstr ""
+#: nis/ypclnt.c:869
+msgid "Unknown ypbind error"
+msgstr " ypbind "
 
-#: timezone/zic.c:1297
-msgid "invalid starting year"
-msgstr ""
+#: nis/ypclnt.c:908
+msgid "yp_update: cannot convert host to netname\n"
+msgstr "yp_update\n"
 
-#: timezone/zic.c:1174 timezone/zic.c:1277
-msgid "invalid time of day"
-msgstr ""
+#: nis/ypclnt.c:920
+msgid "yp_update: cannot get server address\n"
+msgstr "yp_update\n"
 
-#: timezone/zic.c:1375
-msgid "invalid weekday name"
-msgstr ""
+#: nscd/cache.c:88
+msgid "while allocating hash table entry"
+msgstr ""
 
-#: nscd/connections.c:479
+#: nscd/cache.c:150 nscd/connections.c:187
 #, c-format
-msgid "key length in request too long: %d"
-msgstr "%d"
+msgid "cannot stat() file `%s': %s"
+msgstr "%s stat() %s"
 
-#: elf/ldconfig.c:794
-#, c-format
-msgid "libc4 library %s in wrong directory"
-msgstr "libc4  %s "
+#: nscd/connections.c:146
+msgid "cannot read configuration file; this is fatal"
+msgstr ""
 
-#: elf/ldconfig.c:788
-#, c-format
-msgid "libc5 library %s in wrong directory"
-msgstr "libc5  %s "
+#: nscd/connections.c:153
+msgid "Cannot run nscd in secure mode as unprivileged user"
+msgstr ""
 
-#: elf/ldconfig.c:791
+#: nscd/connections.c:175
 #, c-format
-msgid "libc6 library %s in wrong directory"
-msgstr "libc5  %s "
+msgid "while allocating cache: %s"
+msgstr "%s"
 
-#: elf/ldconfig.c:821
+#: nscd/connections.c:200
 #, c-format
-msgid "libraries %s and %s in directory %s have same soname but different type."
-msgstr " %3$s  %1$s  %2$s  so "
-
-#: timezone/zic.c:836
-msgid "line too long"
-msgstr ""
-
-#: iconv/iconv_prog.c:63
-msgid "list all known coded character sets"
-msgstr ""
+msgid "cannot open socket: %s"
+msgstr "%s"
 
-#: locale/programs/locfile.h:63
-msgid "locale name should consist only of portable characters"
-msgstr ""
+#: nscd/connections.c:218
+#, c-format
+msgid "cannot enable socket to accept connections: %s"
+msgstr "%s"
 
-#: inet/rcmd.c:503
-msgid "lstat failed"
-msgstr "lstat "
+#: nscd/connections.c:260
+#, c-format
+msgid "handle_request: request received (Version = %d)"
+msgstr " ( = %d)"
 
-#: malloc/memusagestat.c:59
-msgid "make output graphic VALUE pixel high"
-msgstr ""
+#: nscd/connections.c:266
+#, c-format
+msgid "cannot handle old request version %d; current version is %d"
+msgstr " %d %d"
 
-#: malloc/memusagestat.c:58
-msgid "make output graphic VALUE pixel wide"
-msgstr ""
+#: nscd/connections.c:304 nscd/connections.c:326
+#, c-format
+msgid "cannot write result: %s"
+msgstr "%s"
 
-#: stdlib/../sysdeps/unix/sysv/linux/ia64/makecontext.c:63
-msgid "makecontext: does not know how to handle more than 8 arguments\n"
+#: nscd/connections.c:405 nscd/connections.c:499
+#, c-format
+msgid "error getting callers id: %s"
 msgstr ""
 
-#: catgets/gencat.c:785
-msgid "malformed line ignored"
-msgstr ""
+#: nscd/connections.c:471
+#, c-format
+msgid "while accepting connection: %s"
+msgstr "%s"
 
-#: elf/sprof.c:550
-msgid "mapping of section header string table failed"
-msgstr ""
+#: nscd/connections.c:482
+#, c-format
+msgid "short read while reading request: %s"
+msgstr "%s"
 
-#: elf/sprof.c:540
-msgid "mapping of section headers failed"
-msgstr ""
+#: nscd/connections.c:518
+#, c-format
+msgid "key length in request too long: %d"
+msgstr "%d"
 
-#: malloc/mcheck.c:296
-msgid "memory clobbered before allocated block\n"
-msgstr ""
+#: nscd/connections.c:532
+#, c-format
+msgid "short read while reading request key: %s"
+msgstr "%s"
 
-#: malloc/mcheck.c:299
-msgid "memory clobbered past end of allocated block\n"
+#: nscd/connections.c:591 nscd/connections.c:592 nscd/connections.c:611
+#: nscd/connections.c:624 nscd/connections.c:630 nscd/connections.c:637
+#, c-format
+msgid "Failed to run nscd as user '%s'"
 msgstr ""
 
-#: locale/programs/xmalloc.c:70 malloc/obstack.c:489 malloc/obstack.c:493
-#: posix/getconf.c:996
-msgid "memory exhausted"
-msgstr ""
-
-#: malloc/mcheck.c:293
-msgid "memory is consistent, library is buggy\n"
-msgstr "\n"
+#: nscd/connections.c:612
+msgid "getgrouplist failed"
+msgstr "getgrouplist "
 
-#: elf/cache.c:143
-msgid "mmap of cache file failed.\n"
-msgstr ""
+#: nscd/connections.c:625
+msgid "setgroups failed"
+msgstr "setgroups "
 
-#: elf/../sysdeps/generic/readelflib.c:110
-msgid "more than one dynamic segment\n"
-msgstr "\n"
+#: nscd/grpcache.c:103 nscd/hstcache.c:111 nscd/pwdcache.c:109
+msgid "while allocating key copy"
+msgstr ""
 
-#: timezone/zic.c:959
-msgid "nameless rule"
-msgstr ""
+#: nscd/grpcache.c:153 nscd/hstcache.c:168 nscd/pwdcache.c:146
+msgid "while allocating cache entry"
+msgstr ""
 
-#: nis/nss_nisplus/nisplus-publickey.c:281
-#: nis/nss_nisplus/nisplus-publickey.c:287
-#: nis/nss_nisplus/nisplus-publickey.c:346
-#: nis/nss_nisplus/nisplus-publickey.c:355
+#: nscd/grpcache.c:196 nscd/hstcache.c:282 nscd/pwdcache.c:192
 #, c-format
-msgid "netname2user: (nis+ lookup): %s\n"
+msgid "short write in %s: %s"
 msgstr ""
 
-#: nis/nss_nisplus/nisplus-publickey.c:300
+#: nscd/grpcache.c:218
 #, c-format
-msgid "netname2user: DES entry for %s in directory %s not unique"
-msgstr ""
+msgid "Haven't found \"%s\" in group cache!"
+msgstr "%s"
 
-#: nis/nss_nisplus/nisplus-publickey.c:368
+#: nscd/grpcache.c:284
 #, c-format
-msgid "netname2user: LOCAL entry for %s in directory %s not unique"
+msgid "Invalid numeric gid \"%s\"!"
 msgstr ""
 
-#: nis/nss_nisplus/nisplus-publickey.c:207
+#: nscd/grpcache.c:291
 #, c-format
-msgid "netname2user: missing group id list in `%s'."
-msgstr ""
+msgid "Haven't found \"%d\" in group cache!"
+msgstr "%d"
 
-#: nis/nss_nisplus/nisplus-publickey.c:318
+#: nscd/hstcache.c:304 nscd/hstcache.c:370 nscd/hstcache.c:435
+#: nscd/hstcache.c:500
 #, c-format
-msgid "netname2user: principal name `%s' too long"
-msgstr "netname2user%s"
+msgid "Haven't found \"%s\" in hosts cache!"
+msgstr "%s"
 
-#: nis/nss_nisplus/nisplus-publickey.c:375
-msgid "netname2user: should not have uid 0"
-msgstr "netname2useruid  0"
+#: nscd/nscd.c:85
+msgid "Read configuration data from NAME"
+msgstr " NAME "
 
-#: sunrpc/svc_simple.c:183
-#, c-format
-msgid "never registered prog %d\n"
+#: nscd/nscd.c:87
+msgid "Do not fork and display messages on the current tty"
 msgstr ""
 
-#: locale/programs/repertoire.c:272
-msgid "no <Uxxxx> or <Uxxxxxxxx> value given"
-msgstr " <Uxxxx>  <Uxxxxxxxx>"
-
-#: timezone/zic.c:2148
-msgid "no day in month matches rule"
+#: nscd/nscd.c:88
+msgid "NUMBER"
 msgstr ""
 
-#: locale/programs/ld-collate.c:1770
-msgid "no definition of `UNDEFINED'"
-msgstr "UNDEFINIED"
+#: nscd/nscd.c:88
+msgid "Start NUMBER threads"
+msgstr " NUMBER "
 
-#: elf/sprof.c:272
-#, c-format
-msgid "no filename for profiling data given and shared object `%s' has no soname"
+#: nscd/nscd.c:89
+msgid "Shut the server down"
+msgstr ""
+
+#: nscd/nscd.c:90
+msgid "Print current configuration statistic"
+msgstr ""
+
+#: nscd/nscd.c:91
+msgid "TABLE"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:747
-msgid "no input digits defined and none of the standard names in the charmap"
+#: nscd/nscd.c:92
+msgid "Invalidate the specified cache"
 msgstr ""
 
-#: locale/programs/locfile.h:82
-msgid "no other keyword shall be specified when `copy' is used"
-msgstr "copy"
+#: nscd/nscd.c:93
+msgid "TABLE,yes"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:3351
-msgid "no output digits defined and none of the standard names in the charmap"
+#: nscd/nscd.c:93
+msgid "Use separate cache for each user"
+msgstr ""
+
+#: nscd/nscd.c:98
+msgid "Name Service Cache Daemon."
 msgstr ""
 
-#: iconv/iconvconfig.c:308 locale/programs/localedef.c:236
-msgid "no output file produced because warning were issued"
-msgstr ""
+#: nscd/nscd.c:131
+msgid "already running"
+msgstr ""
 
-#: locale/programs/charmap.c:493 locale/programs/charmap.c:673
-#: locale/programs/charmap.c:769 locale/programs/repertoire.c:231
-msgid "no symbolic name given"
-msgstr ""
+#: nscd/nscd.c:243 nscd/nscd.c:263 nscd/nscd.c:269
+msgid "Only root is allowed to use this option!"
+msgstr ""
 
-#: locale/programs/charmap.c:580 locale/programs/charmap.c:728
-#: locale/programs/charmap.c:811 locale/programs/repertoire.c:297
-msgid "no symbolic name given for end of range"
-msgstr ""
+#: nscd/nscd_conf.c:83
+#, c-format
+msgid "Parse error: %s"
+msgstr "%s"
 
-#: locale/programs/linereader.c:646
-msgid "non-symbolic character value should not be used"
-msgstr ""
+#: nscd/nscd_conf.c:166
+#, c-format
+msgid "Could not create log file \"%s\""
+msgstr "%s"
 
-#: locale/programs/ld-ctype.c:812
-msgid "not all characters used in `outdigit' are available in the charmap"
+#: nscd/nscd_conf.c:182
+msgid "Must specify user name for server-user option"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:829
-msgid "not all characters used in `outdigit' are available in the repertoire"
-msgstr ""
+#: nscd/nscd_conf.c:187
+#, c-format
+msgid "Unknown option: %s %s %s"
+msgstr "%s %s %s"
 
-#: inet/rcmd.c:505
-msgid "not regular file"
-msgstr ""
+#: nscd/nscd_stat.c:87
+#, c-format
+msgid "cannot write statistics: %s"
+msgstr "%s"
+
+#: nscd/nscd_stat.c:105
+msgid "nscd not running!\n"
+msgstr "nscd \n"
+
+#: nscd/nscd_stat.c:116
+msgid "write incomplete"
+msgstr ""
+
+#: nscd/nscd_stat.c:128
+msgid "cannot read statistics data"
+msgstr ""
 
 #: nscd/nscd_stat.c:131
 #, c-format
@@ -4995,578 +5224,637 @@
 "\n"
 "%15d  \n"
 
-#: nscd/nscd_stat.c:105
-msgid "nscd not running!\n"
-msgstr "nscd \n"
-
-#: elf/dl-load.c:1059
-msgid "object file has no dynamic section"
-msgstr ""
+#: nscd/nscd_stat.c:146 nscd/nscd_stat.c:148
+msgid "      no"
+msgstr "      "
 
-#: iconv/iconv_prog.c:65
-msgid "omit invalid characters from output"
-msgstr ""
+#: nscd/nscd_stat.c:146 nscd/nscd_stat.c:148
+msgid "     yes"
+msgstr "     "
 
-#: elf/dl-load.c:1309
-msgid "only ET_DYN and ET_EXEC can be loaded"
+#: nscd/nscd_stat.c:154
+#, c-format
+msgid ""
+"\n"
+"%s cache:\n"
+"\n"
+"%15s  cache is enabled\n"
+"%15Zd  suggested size\n"
+"%15ld  seconds time to live for positive entries\n"
+"%15ld  seconds time to live for negative entries\n"
+"%15ld  cache hits on positive entries\n"
+"%15ld  cache hits on negative entries\n"
+"%15ld  cache misses on positive entries\n"
+"%15ld  cache misses on negative entries\n"
+"%15ld%% cache hit rate\n"
+"%15s  check /etc/%s for changes\n"
 msgstr ""
 
-#: locale/programs/charmap.c:637
-msgid "only WIDTH definitions are allowed to follow the CHARMAP definition"
-msgstr ""
+#: nscd/pwdcache.c:214
+#, c-format
+msgid "Haven't found \"%s\" in password cache!"
+msgstr "%s"
 
-#: locale/programs/ld-collate.c:1018 locale/programs/ld-collate.c:1188
+#: nscd/pwdcache.c:280
 #, c-format
-msgid "order for `%.*s' already defined at %s:%Zu"
+msgid "Invalid numeric uid \"%s\"!"
 msgstr ""
 
-#: inet/ruserpass.c:170 inet/ruserpass.c:193
-msgid "out of memory"
-msgstr ""
+#: nscd/pwdcache.c:287
+#, c-format
+msgid "Haven't found \"%d\" in password cache!"
+msgstr "%d"
 
-#: iconv/iconv_prog.c:66
-msgid "output file"
-msgstr ""
+#: elf/../sysdeps/generic/dl-sysdep.c:357
+msgid "cannot create capability list"
+msgstr ""
 
-#: posix/../sysdeps/generic/wordexp.c:1801
-msgid "parameter null or not set"
-msgstr " null "
+#: elf/../sysdeps/generic/readelflib.c:35
+#, c-format
+msgid "file %s is truncated\n"
+msgstr " %s \n"
 
-#: sunrpc/pm_getmaps.c:74
-msgid "pmap_getmaps rpc problem"
-msgstr ""
+#: elf/../sysdeps/generic/readelflib.c:67
+#, c-format
+msgid "%s is a 32 bit ELF file.\n"
+msgstr "%s  32  ELF \n"
 
-#: inet/rcmd.c:293
-msgid "poll: protocol failure in circuit setup\n"
-msgstr ""
+#: elf/../sysdeps/generic/readelflib.c:69
+#, c-format
+msgid "%s is a 64 bit ELF file.\n"
+msgstr "%s  64  ELF \n"
 
-#: locale/programs/ld-ctype.c:1950 locale/programs/ld-ctype.c:2001
-msgid "premature end of `translit_ignore' definition"
-msgstr ""
+#: elf/../sysdeps/generic/readelflib.c:71
+#, c-format
+msgid "Unknown ELFCLASS in file %s.\n"
+msgstr " %s  ELFCLASS\n"
 
-#: sunrpc/rpc_scan.c:525 sunrpc/rpc_scan.c:535
-msgid "preprocessor error"
-msgstr ""
+#: elf/../sysdeps/generic/readelflib.c:78
+#, c-format
+msgid "%s is not a shared object file (Type: %d).\n"
+msgstr "%s  (%d)\n"
 
-#: locale/programs/ld-ctype.c:2733
-msgid "previous definition was here"
-msgstr ""
+#: elf/../sysdeps/generic/readelflib.c:109
+msgid "more than one dynamic segment\n"
+msgstr "\n"
 
-#: elf/sprof.c:74
-msgid "print list of count paths and their number of use"
-msgstr ""
+#: elf/../sysdeps/unix/sysv/linux/i386/readelflib.c:49
+#, c-format
+msgid "%s is for unknown machine %d.\n"
+msgstr "%s  %d\n"
 
-#: iconv/iconv_prog.c:68
-msgid "print progress information"
-msgstr ""
+#: elf/cache.c:69
+msgid "unknown"
+msgstr ""
+
+#: elf/cache.c:105
+msgid "Unknown OS"
+msgstr ""
+
+#: elf/cache.c:110
+#, c-format
+msgid ", OS ABI: %s %d.%d.%d"
+msgstr ""
 
-#: elf/sprof.c:687
+#: elf/cache.c:136 elf/ldconfig.c:1045
 #, c-format
-msgid "profiling data file `%s' does not match shared object `%s'"
+msgid "Can't open cache file %s\n"
+msgstr " %s\n"
+
+#: elf/cache.c:148
+msgid "mmap of cache file failed.\n"
 msgstr ""
 
-#: sunrpc/rpcinfo.c:237 sunrpc/rpcinfo.c:383
-#, c-format
-msgid "program %lu is not available\n"
-msgstr " %lu \n"
+#: elf/cache.c:152 elf/cache.c:162
+msgid "File is not a cache file.\n"
+msgstr "\n"
 
-#: sunrpc/rpcinfo.c:264 sunrpc/rpcinfo.c:310 sunrpc/rpcinfo.c:333
-#: sunrpc/rpcinfo.c:407 sunrpc/rpcinfo.c:453 sunrpc/rpcinfo.c:476
-#: sunrpc/rpcinfo.c:510
+#: elf/cache.c:195 elf/cache.c:205
 #, c-format
-msgid "program %lu version %lu is not available\n"
-msgstr " %lu  %lu \n"
+msgid "%d libs found in cache `%s'\n"
+msgstr "%2$s %1$d \n"
 
-#: sunrpc/rpcinfo.c:515
+#: elf/cache.c:392
 #, c-format
-msgid "program %lu version %lu ready and waiting\n"
-msgstr " %lu  %lu \n"
+msgid "Can't remove old temporary cache file %s"
+msgstr " %s"
 
-#: inet/rcmd.c:354
+#: elf/cache.c:399
 #, c-format
-msgid "rcmd: %s: short read"
-msgstr ""
+msgid "Can't create temporary cache file %s"
+msgstr " %s"
 
-#: inet/rcmd.c:290
-#, c-format
-msgid "rcmd: poll (setting up stderr): %m\n"
+#: elf/cache.c:407 elf/cache.c:416 elf/cache.c:420
+msgid "Writing of cache data failed"
 msgstr ""
 
-#: inet/rcmd.c:172 inet/rcmd.c:175
-msgid "rcmd: socket: All ports in use\n"
+#: elf/cache.c:424
+msgid "Writing of cache data failed."
 msgstr ""
 
-#: inet/rcmd.c:270
+#: elf/cache.c:431
 #, c-format
-msgid "rcmd: write (setting up stderr): %m\n"
+msgid "Changing access rights of %s to %#o failed"
+msgstr " %s  %#o "
+
+#: elf/cache.c:436
+#, c-format
+msgid "Renaming of %s to %s failed"
+msgstr " %s  %s "
+
+#: elf/dl-close.c:128
+msgid "shared object not open"
+msgstr ""
+
+#: elf/dl-close.c:486 elf/dl-open.c:444
+msgid "TLS generation counter wrapped!  Please send report with the 'glibcbug' script."
 msgstr ""
 
-#: sunrpc/svc_simple.c:112
-msgid "registerrpc: out of memory\n"
-msgstr "registerrpc\n"
+#: elf/dl-deps.c:111 elf/dl-open.c:183
+msgid "DST not allowed in SUID/SGID programs"
+msgstr ""
 
-#: timezone/zic.c:1880
-msgid "repeated leap second moment"
+#: elf/dl-deps.c:124
+msgid "empty dynamics string token substitution"
 msgstr ""
 
-#: locale/programs/repertoire.c:342
+#: elf/dl-deps.c:130
 #, c-format
-msgid "repertoire map file `%s' not found"
+msgid "cannot load auxiliary `%s' because of empty dynamic string token substitution\n"
 msgstr ""
 
-#: locale/programs/charmap.c:1068
-msgid "resulting bytes for range not representable."
+#: elf/dl-deps.c:461
+msgid "cannot allocate dependency list"
+msgstr ""
+
+#: elf/dl-deps.c:494 elf/dl-deps.c:549
+msgid "cannot allocate symbol search list"
+msgstr ""
+
+#: elf/dl-deps.c:534
+msgid "Filters not supported with LD_TRACE_PRELINKING"
 msgstr ""
 
-#: sunrpc/rpc_main.c:1117
-msgid "rpcgen: arglist coding error\n"
+#: elf/dl-error.c:75
+msgid "DYNAMIC LINKER BUG!!!"
 msgstr ""
 
-#: sunrpc/rpc_main.c:1105
-msgid "rpcgen: too many defines\n"
-msgstr "rpcgen\n"
+#: elf/dl-error.c:108
+msgid "error while loading shared libraries"
+msgstr ""
 
-#: sunrpc/rpcinfo.c:732
-#, c-format
-msgid "rpcinfo: %s is unknown host\n"
-msgstr "rpcinfo%s \n"
+#: elf/dl-load.c:339
+msgid "cannot allocate name record"
+msgstr ""
 
-#: sunrpc/rpcinfo.c:695
-#, c-format
-msgid "rpcinfo: %s is unknown service\n"
-msgstr "rpcinfo%s \n"
+#: elf/dl-load.c:441 elf/dl-load.c:520 elf/dl-load.c:612 elf/dl-load.c:707
+msgid "cannot create cache for search path"
+msgstr ""
 
-#: sunrpc/rpcinfo.c:665
-#, c-format
-msgid "rpcinfo: Could not delete registration for prog %s version %s\n"
-msgstr "rpcinfo %s  %s \n"
+#: elf/dl-load.c:543
+msgid "cannot create RUNPATH/RPATH copy"
+msgstr " RUNPATH/RPATH "
 
-#: sunrpc/rpcinfo.c:637
-#, c-format
-msgid "rpcinfo: broadcast failed: %s\n"
-msgstr "rpcinfo%s\n"
+#: elf/dl-load.c:598
+msgid "cannot create search path array"
+msgstr ""
 
-#: sunrpc/rpcinfo.c:556 sunrpc/rpcinfo.c:563
-msgid "rpcinfo: can't contact portmapper"
-msgstr "rpcinfo portmapper "
+#: elf/dl-load.c:794
+msgid "cannot stat shared object"
+msgstr " stat "
 
-#: timezone/zic.c:749 timezone/zic.c:751
-msgid "same rule name in multiple files"
-msgstr ""
+#: elf/dl-load.c:838
+msgid "cannot open zero fill device"
+msgstr ""
 
-#: elf/dl-load.c:1104
-msgid "shared object cannot be dlopen()ed"
-msgstr " dlopen() "
+#: elf/dl-load.c:847 elf/dl-load.c:1902
+msgid "cannot create shared object descriptor"
+msgstr ""
 
-#: elf/dl-close.c:61
-msgid "shared object not open"
-msgstr ""
+#: elf/dl-load.c:866 elf/dl-load.c:1398 elf/dl-load.c:1481
+msgid "cannot read file data"
+msgstr ""
 
-#: nscd/connections.c:493
-#, c-format
-msgid "short read while reading request key: %s"
+#: elf/dl-load.c:906
+msgid "ELF load command alignment not page-aligned"
 msgstr ""
 
-#: nscd/connections.c:443
-#, c-format
-msgid "short read while reading request: %s"
+#: elf/dl-load.c:913
+msgid "ELF load command address/offset not properly aligned"
+msgstr "ELF /"
+
+#: elf/dl-load.c:988
+msgid "cannot allocate TLS data structures for initial thread"
 msgstr ""
 
-#: nscd/grpcache.c:193 nscd/hstcache.c:278 nscd/pwdcache.c:189
-#, c-format
-msgid "short write in %s: %s"
+#: elf/dl-load.c:1012
+msgid "cannot handle TLS data"
+msgstr " TLS "
+
+#: elf/dl-load.c:1047
+msgid "failed to map segment from shared object"
 msgstr ""
 
-#: inet/rcmd.c:335
-msgid "socket: protocol failure in circuit setup\n"
+#: elf/dl-load.c:1071
+msgid "cannot dynamically load executable"
+msgstr ""
+
+#: elf/dl-load.c:1132
+msgid "cannot change memory protections"
+msgstr ""
+
+#: elf/dl-load.c:1151
+msgid "cannot map zero-fill pages"
 msgstr ""
 
-#: timezone/zic.c:820
-msgid "standard input"
-msgstr ""
+#: elf/dl-load.c:1169
+msgid "cannot allocate memory for program header"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:1681
-msgid "start and end character sequence of range must have the same length"
-msgstr ""
+#: elf/dl-load.c:1200
+msgid "object file has no dynamic section"
+msgstr ""
 
-#: timezone/zic.c:1331
-msgid "starting year greater than ending year"
-msgstr ""
+#: elf/dl-load.c:1240
+msgid "shared object cannot be dlopen()ed"
+msgstr " dlopen() "
 
-#: timezone/zic.c:1303 timezone/zic.c:1328
-msgid "starting year too high to be represented"
+#: elf/dl-load.c:1263
+msgid "cannot create searchlist"
+msgstr ""
+
+#: elf/dl-load.c:1398
+msgid "file too short"
+msgstr ""
+
+#: elf/dl-load.c:1421
+msgid "invalid ELF header"
+msgstr " ELF "
+
+#: elf/dl-load.c:1430
+msgid "ELF file data encoding not big-endian"
 msgstr ""
 
-#: timezone/zic.c:1301 timezone/zic.c:1326
-msgid "starting year too low to be represented"
+#: elf/dl-load.c:1432
+msgid "ELF file data encoding not little-endian"
 msgstr ""
 
-#: iconv/iconv_prog.c:67
-msgid "suppress warnings"
+#: elf/dl-load.c:1436
+msgid "ELF file version ident does not match current one"
 msgstr ""
 
-#: sunrpc/svc_run.c:76
-msgid "svc_run: - poll failed"
+#: elf/dl-load.c:1440
+msgid "ELF file OS ABI invalid"
 msgstr ""
 
-#: sunrpc/svc_tcp.c:171
-msgid "svc_tcp.c - cannot getsockname or listen"
-msgstr "svc_tcp.c -  getsockname  listen "
+#: elf/dl-load.c:1442
+msgid "ELF file ABI version invalid"
+msgstr ""
 
-#: sunrpc/svc_tcp.c:156
-msgid "svc_tcp.c - tcp socket creation problem"
-msgstr "svc_tcp.c - tcp "
+#: elf/dl-load.c:1445
+msgid "internal error"
+msgstr ""
 
-#: sunrpc/svc_tcp.c:224 sunrpc/svc_tcp.c:227
-msgid "svc_tcp: makefd_xprt: out of memory\n"
-msgstr "svc_tcpmakefd_xprt\n"
+#: elf/dl-load.c:1452
+msgid "ELF file version does not match current one"
+msgstr "ELF "
 
-#: sunrpc/svc_unix.c:150
-msgid "svc_unix.c - AF_UNIX socket creation problem"
-msgstr "svc_unix.c - AF_UNIX "
+#: elf/dl-load.c:1460
+msgid "ELF file's phentsize not the expected size"
+msgstr ""
 
-#: sunrpc/svc_unix.c:166
-msgid "svc_unix.c - cannot getsockname or listen"
-msgstr "svc_unix.c -  getsockname  listen "
+#: elf/dl-load.c:1466
+msgid "only ET_DYN and ET_EXEC can be loaded"
+msgstr ""
 
-#: sunrpc/svc_unix.c:220 sunrpc/svc_unix.c:223
-msgid "svc_unix: makefd_xprt: out of memory\n"
-msgstr "svc_unixmakefd_xprt\n"
+#: elf/dl-load.c:1917
+msgid "cannot open shared object file"
+msgstr ""
 
-#: sunrpc/svc_tcp.c:182 sunrpc/svc_tcp.c:185
-msgid "svctcp_create: out of memory\n"
-msgstr "svctcp_create\n"
+#: elf/dl-lookup.c:265 elf/dl-lookup.c:430
+msgid "relocation error"
+msgstr ""
 
-#: sunrpc/svc_udp.c:143
-msgid "svcudp_create - cannot getsockname"
-msgstr "svcudp_create -  getsockname"
+#: elf/dl-open.c:111
+msgid "cannot extend global scope"
+msgstr ""
 
-#: sunrpc/svc_udp.c:155 sunrpc/svc_udp.c:158
-msgid "svcudp_create: out of memory\n"
-msgstr "svcudp_create\n"
+#: elf/dl-open.c:214
+msgid "empty dynamic string token substitution"
+msgstr ""
 
-#: sunrpc/svc_udp.c:129
-msgid "svcudp_create: socket creation problem"
-msgstr "svcudp_create: "
+#: elf/dl-open.c:351 elf/dl-open.c:362
+msgid "cannot create scope list"
+msgstr ""
+
+#: elf/dl-open.c:424
+msgid "cannot create TLS data structures"
+msgstr " TLS "
 
-#: sunrpc/svc_udp.c:179 sunrpc/svc_udp.c:182
-msgid "svcudp_create: xp_pad is too small for IP_PKTINFO\n"
-msgstr "svcudp_createxp_pad  IP_PKTINFO \n"
+#: elf/dl-open.c:486
+msgid "invalid mode for dlopen()"
+msgstr " dlopen() "
 
-#: sunrpc/svc_unix.c:178 sunrpc/svc_unix.c:181
-msgid "svcunix_create: out of memory\n"
-msgstr "svcunix_create\n"
+#: elf/dl-reloc.c:58
+msgid "shared object cannot be dlopen()ed: static TLS memory too small"
+msgstr " dlopen()  TLS "
 
-#: locale/programs/linereader.c:750
-#, c-format
-msgid "symbol `%.*s' not in charmap"
+#: elf/dl-reloc.c:118
+msgid "cannot make segment writable for relocation"
 msgstr ""
 
-#: locale/programs/linereader.c:771
+#: elf/dl-reloc.c:219
 #, c-format
-msgid "symbol `%.*s' not in repertoire map"
+msgid "%s: profiler found no PLTREL in object %s\n"
 msgstr ""
 
-#: locale/programs/ld-collate.c:1630 locale/programs/ld-collate.c:1729
-#, c-format
-msgid "symbol `%s'"
-msgstr "%s"
-
-#: locale/programs/ld-collate.c:1627 locale/programs/ld-collate.c:1726
+#: elf/dl-reloc.c:231
 #, c-format
-msgid "symbol `%s' has the same encoding as"
+msgid "%s: profiler out of memory shadowing PLTREL of %s\n"
 msgstr ""
 
-#: locale/programs/ld-collate.c:1552
-#, c-format
-msgid "symbol `%s' not defined"
-msgstr "%s"
+#: elf/dl-reloc.c:246
+#, fuzzy
+msgid "cannot restore segment prot after reloc"
+msgstr ""
 
-#: locale/programs/ld-ctype.c:1956 locale/programs/ld-ctype.c:2007
-#: locale/programs/ld-ctype.c:2049
-msgid "syntax error"
-msgstr ""
+#: elf/dl-sym.c:74 elf/dl-sym.c:145
+msgid "RTLD_NEXT used in code not dynamically loaded"
+msgstr ""
 
-#: locale/programs/charmap.c:492 locale/programs/charmap.c:546
-#: locale/programs/charmap.c:578 locale/programs/charmap.c:672
-#: locale/programs/charmap.c:727 locale/programs/charmap.c:768
-#: locale/programs/charmap.c:809
-#, c-format
-msgid "syntax error in %s definition: %s"
-msgstr "%s %s"
+#: elf/dl-version.c:302
+msgid "cannot allocate version reference table"
+msgstr ""
 
-#: locale/programs/charmap.c:351 locale/programs/charmap.c:368
-#: locale/programs/repertoire.c:175
-#, c-format
-msgid "syntax error in prolog: %s"
-msgstr ""
+#: elf/ldconfig.c:122
+msgid "Print cache"
+msgstr ""
 
-#: locale/programs/repertoire.c:230 locale/programs/repertoire.c:271
-#: locale/programs/repertoire.c:296
-#, c-format
-msgid "syntax error in repertoire map definition: %s"
-msgstr ""
+#: elf/ldconfig.c:123
+msgid "Generate verbose messages"
+msgstr ""
 
-#: locale/programs/locfile.c:245
-msgid "syntax error: not inside a locale definition section"
-msgstr ""
+#: elf/ldconfig.c:124
+msgid "Don't build cache"
+msgstr ""
 
-#: catgets/gencat.c:432 catgets/gencat.c:605 catgets/gencat.c:634
-msgid "this is the first definition"
-msgstr ""
+#: elf/ldconfig.c:125
+msgid "Don't generate links"
+msgstr ""
 
-#: timezone/zic.c:1163
-msgid "time before zero"
-msgstr ""
+#: elf/ldconfig.c:126
+msgid "Change to and use ROOT as root directory"
+msgstr " ROOT "
 
-#: timezone/zic.c:1171 timezone/zic.c:2048 timezone/zic.c:2067
-msgid "time overflow"
-msgstr ""
+#: elf/ldconfig.c:127
+msgid "Use CACHE as cache file"
+msgstr " CACHE "
 
-#: locale/programs/ld-ctype.c:1554 locale/programs/ld-ctype.c:2030
-#, c-format
-msgid "to-value <U%0*X> of range is smaller than from-value <U%0*X>"
-msgstr ""
+#: elf/ldconfig.c:128
+msgid "Use CONF as configuration file"
+msgstr " CONF "
 
-#: locale/programs/ld-ctype.c:1688
-msgid "to-value character sequence is smaller than from-value sequence"
-msgstr ""
+#: elf/ldconfig.c:129
+msgid "Only process directories specified on the command line.  Don't build cache."
+msgstr ""
 
-#: locale/programs/charmap.c:556
-msgid "too few bytes in character encoding"
-msgstr ""
+#: elf/ldconfig.c:130
+msgid "Manually link individual libraries."
+msgstr ""
 
-#: locale/programs/charmap.c:558
-msgid "too many bytes in character encoding"
-msgstr ""
+#: elf/ldconfig.c:131
+msgid "Format to use: new, old or compat (default)"
+msgstr "()"
 
-#: timezone/zic.c:1874
-msgid "too many leap seconds"
+#: elf/ldconfig.c:136
+msgid "Configure Dynamic Linker Run Time Bindings."
 msgstr ""
 
-#: timezone/zic.c:1846
-msgid "too many local time types"
-msgstr ""
+#: elf/ldconfig.c:294
+#, c-format
+msgid "Path `%s' given more than once"
+msgstr "%s"
 
-#: timezone/zic.c:1800
-msgid "too many transitions?!"
-msgstr ""
+#: elf/ldconfig.c:338
+#, c-format
+msgid "%s is not a known library type"
+msgstr "%s "
 
-#: timezone/zic.c:2171
-msgid "too many, or too long, time zone abbreviations"
-msgstr ""
+#: elf/ldconfig.c:356
+#, c-format
+msgid "Can't stat %s"
+msgstr " %s  stat "
 
-#: locale/programs/linereader.h:160
-msgid "trailing garbage at end of line"
-msgstr ""
+#: elf/ldconfig.c:426
+#, c-format
+msgid "Can't stat %s\n"
+msgstr " %s  stat \n"
 
-#: sunrpc/svc_simple.c:175
+#: elf/ldconfig.c:436
 #, c-format
-msgid "trouble replying to prog %d\n"
-msgstr ""
+msgid "%s is not a symbolic link\n"
+msgstr "%s \n"
 
-#: timezone/zic.c:1338
-msgid "typed single year"
+#: elf/ldconfig.c:455
+#, c-format
+msgid "Can't unlink %s"
 msgstr ""
 
-#: iconv/iconv_charmap.c:524 iconv/iconv_prog.c:533
-msgid "unable to allocate buffer for input"
-msgstr ""
-
-#: nis/nis_callback.c:189
-msgid "unable to free arguments"
-msgstr ""
+#: elf/ldconfig.c:461
+#, c-format
+msgid "Can't link %s to %s"
+msgstr " %s  %s"
 
-#: posix/getconf.c:968 posix/getconf.c:984
-msgid "undefined"
-msgstr ""
+#: elf/ldconfig.c:467
+msgid " (changed)\n"
+msgstr " ()\n"
 
-#: elf/cache.c:69
-msgid "unknown"
-msgstr ""
+#: elf/ldconfig.c:469
+msgid " (SKIPPED)\n"
+msgstr " ()\n"
 
-#: locale/programs/charmap.c:861 locale/programs/charmap.c:872
+#: elf/ldconfig.c:524
 #, c-format
-msgid "unknown character `%s'"
-msgstr "%s"
+msgid "Can't find %s"
+msgstr " %s"
 
-#: catgets/gencat.c:562
+#: elf/ldconfig.c:540
 #, c-format
-msgid "unknown directive `%s': line ignored"
-msgstr "%s"
+msgid "Can't lstat %s"
+msgstr " %s  lstat "
 
-#: iconv/iconv_prog.c:480
+#: elf/ldconfig.c:547
 #, c-format
-msgid "unknown iconv() error %d"
-msgstr " iconv()  %d"
+msgid "Ignored file %s since it is not a regular file."
+msgstr ""
 
-#: catgets/gencat.c:508
+#: elf/ldconfig.c:555
 #, c-format
-msgid "unknown set `%s'"
-msgstr "%s"
+msgid "No link created since soname could not be found for %s"
+msgstr ""
 
-#: posix/getconf.c:941
+#: elf/ldconfig.c:646
 #, c-format
-msgid "unknown specification \"%s\""
-msgstr "%s"
+msgid "Can't open directory %s"
+msgstr " %s"
 
-#: timezone/zic.c:792
-msgid "unruly zone"
-msgstr ""
+#: elf/ldconfig.c:701 elf/ldconfig.c:748
+#, c-format
+msgid "Cannot lstat %s"
+msgstr " %s  lstat "
 
-#: catgets/gencat.c:1174
-msgid "unterminated message"
-msgstr ""
+#: elf/ldconfig.c:713
+#, c-format
+msgid "Cannot stat %s"
+msgstr " %s  stat "
 
-#: locale/programs/linereader.c:604 locale/programs/linereader.c:789
-msgid "unterminated string"
-msgstr ""
+#: elf/ldconfig.c:770 elf/readlib.c:93
+#, c-format
+msgid "Input file %s not found.\n"
+msgstr " %s\n"
 
-#: sunrpc/rpc_scan.c:351 sunrpc/rpc_scan.c:377
-msgid "unterminated string constant"
-msgstr ""
+#: elf/ldconfig.c:804
+#, c-format
+msgid "libc5 library %s in wrong directory"
+msgstr "libc5  %s "
 
-#: locale/programs/linereader.c:474
-msgid "unterminated symbolic name"
-msgstr ""
+#: elf/ldconfig.c:807
+#, c-format
+msgid "libc6 library %s in wrong directory"
+msgstr "libc5  %s "
 
-#: locale/programs/charmap.c:1010
-msgid "upper limit in range is not higher then lower limit"
-msgstr ""
+#: elf/ldconfig.c:810
+#, c-format
+msgid "libc4 library %s in wrong directory"
+msgstr "libc4  %s "
 
-#: locale/programs/repertoire.c:455
-msgid "upper limit in range is not smaller then lower limit"
-msgstr ""
+#: elf/ldconfig.c:837
+#, c-format
+msgid "libraries %s and %s in directory %s have same soname but different type."
+msgstr " %3$s  %1$s  %2$s  so "
 
-#: sunrpc/rpc_main.c:1426
+#: elf/ldconfig.c:940
 #, c-format
-msgid "usage: %s infile\n"
-msgstr "%s \n"
+msgid "Can't open configuration file %s"
+msgstr " %s"
 
-#: timezone/zic.c:2114
-msgid "use of 2/29 in non leap-year"
-msgstr ""
+#: elf/ldconfig.c:1024
+msgid "Can't chdir to /"
+msgstr " /"
 
-#: locale/programs/charmap.c:645 locale/programs/charmap.c:708
+#: elf/ldconfig.c:1066
 #, c-format
-msgid "value for %s must be an integer"
-msgstr "%s "
+msgid "Can't open cache file directory %s\n"
+msgstr " %s\n"
 
-#: locale/programs/charmap.c:404
+#: elf/readlib.c:99
 #, c-format
-msgid "value for <%s> must be 1 or greater"
-msgstr "<%s> 1 "
+msgid "Cannot fstat file %s.\n"
+msgstr " %s  fstat \n"
 
-#: locale/programs/charmap.c:416
+#: elf/readlib.c:109
 #, c-format
-msgid "value of <%s> must be greater or equal than the value of <%s>"
-msgstr "<%s>  <%s> "
-
-#: timezone/zic.c:439
-msgid "warning: "
-msgstr ""
+msgid "File %s is too small, not checked."
+msgstr " %s "
 
-#: nscd/connections.c:432
+#: elf/readlib.c:118
 #, c-format
-msgid "while accepting connection: %s"
-msgstr "%s"
-
-#: nscd/grpcache.c:150 nscd/hstcache.c:165 nscd/pwdcache.c:143
-msgid "while allocating cache entry"
-msgstr ""
+msgid "Cannot mmap file %s.\n"
+msgstr " %s  mmap \n"
 
-#: nscd/cache.c:88
-msgid "while allocating hash table entry"
-msgstr ""
+#: elf/readlib.c:158
+#, c-format
+msgid "%s is not an ELF file - it has the wrong magic bytes at the start.\n"
+msgstr "%s  ELF  - \n"
 
-#: nscd/grpcache.c:100 nscd/hstcache.c:108 nscd/pwdcache.c:106
-msgid "while allocating key copy"
-msgstr ""
+#: elf/sprof.c:72
+msgid "Output selection:"
+msgstr ""
 
-#: iconv/iconvconfig.c:369
-msgid "while inserting in search tree"
-msgstr ""
+#: elf/sprof.c:74
+msgid "print list of count paths and their number of use"
+msgstr ""
 
-#: catgets/gencat.c:1198
-msgid "while opening old catalog file"
+#: elf/sprof.c:76
+msgid "generate flat profile with counts and ticks"
 msgstr ""
 
-#: locale/programs/locale.c:353
-msgid "while preparing output"
-msgstr ""
+#: elf/sprof.c:77
+msgid "generate call graph"
+msgstr ""
 
-#: elf/sprof.c:679
-msgid "while stat'ing profiling data file"
+#: elf/sprof.c:84
+msgid "Read and display shared object profiling data"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:2394
-msgid "with UCS range values one must use the hexadecimal symbolic ellipsis `..'"
+#: elf/sprof.c:87
+msgid "SHOBJ [PROFDATA]"
 msgstr ""
 
-#: locale/programs/ld-ctype.c:2408
-msgid "with character code range values one must use the absolute ellipsis `...'"
-msgstr ""
+#: elf/sprof.c:398
+#, c-format
+msgid "failed to load shared object `%s'"
+msgstr "%s"
 
-#: locale/programs/ld-ctype.c:2379
-msgid "with symbolic name range values the absolute ellipsis `...' must not be used"
-msgstr ""
+#: elf/sprof.c:407
+msgid "cannot create internal descriptors"
+msgstr ""
 
-#: nscd/nscd_stat.c:116
-msgid "write incomplete"
-msgstr ""
+#: elf/sprof.c:526
+#, c-format
+msgid "Reopening shared object `%s' failed"
+msgstr "%s"
 
-#: inet/rcmd.c:516
-msgid "writeable by other than owner"
+#: elf/sprof.c:534
+msgid "mapping of section headers failed"
 msgstr ""
 
-#: nscd/nscd.c:123 nscd/nscd_nischeck.c:64 nss/getent.c:761
-msgid "wrong number of arguments"
-msgstr ""
-
-#: timezone/zic.c:1121
-msgid "wrong number of fields on Leap line"
+#: elf/sprof.c:544
+msgid "mapping of section header string table failed"
 msgstr ""
 
-#: timezone/zic.c:1212
-msgid "wrong number of fields on Link line"
-msgstr ""
+#: elf/sprof.c:564
+#, c-format
+msgid "*** The file `%s' is stripped: no detailed analysis possible\n"
+msgstr "*** %s\n"
 
-#: timezone/zic.c:955
-msgid "wrong number of fields on Rule line"
-msgstr ""
+#: elf/sprof.c:594
+msgid "failed to load symbol data"
+msgstr ""
 
-#: timezone/zic.c:1025
-msgid "wrong number of fields on Zone continuation line"
+#: elf/sprof.c:664
+msgid "cannot load profiling data"
 msgstr ""
 
-#: timezone/zic.c:983
-msgid "wrong number of fields on Zone line"
-msgstr ""
+#: elf/sprof.c:673
+msgid "while stat'ing profiling data file"
+msgstr ""
 
-#: sunrpc/xdr_array.c:106 sunrpc/xdr_array.c:109
-msgid "xdr_array: out of memory\n"
-msgstr "xdr_array\n"
+#: elf/sprof.c:681
+#, c-format
+msgid "profiling data file `%s' does not match shared object `%s'"
+msgstr ""
 
-#: sunrpc/xdr.c:558 sunrpc/xdr.c:561
-msgid "xdr_bytes: out of memory\n"
-msgstr "xdr_bytes\n"
+#: elf/sprof.c:692
+msgid "failed to mmap the profiling data file"
+msgstr ""
 
-#: sunrpc/xdr_ref.c:89 sunrpc/xdr_ref.c:92
-msgid "xdr_reference: out of memory\n"
-msgstr "xdr_reference\n"
+#: elf/sprof.c:700
+msgid "error while closing the profiling data file"
+msgstr ""
 
-#: sunrpc/xdr.c:710 sunrpc/xdr.c:713
-msgid "xdr_string: out of memory\n"
-msgstr "xdr_string\n"
+#: elf/sprof.c:709 elf/sprof.c:779
+msgid "cannot create internal descriptor"
+msgstr ""
 
-#: sunrpc/xdr_rec.c:155 sunrpc/xdr_rec.c:158
-msgid "xdrrec_create: out of memory\n"
-msgstr "xdrrec_create\n"
+#: elf/sprof.c:755
+#, c-format
+msgid "`%s' is no correct profile data file for `%s'"
+msgstr ""
 
-#: nis/ypclnt.c:909
-msgid "yp_update: cannot convert host to netname\n"
-msgstr "yp_update\n"
+#: elf/sprof.c:936 elf/sprof.c:988
+msgid "cannot allocate symbol data"
+msgstr ""
 
-#: nis/ypclnt.c:921
-msgid "yp_update: cannot get server address\n"
-msgstr "yp_update\n"
+#~ msgid "\t\t\t\t\t\t\t      %s: value for field `%s' must be in range %d...%d"
+#~ msgstr "\t\t\t\t\t\t\t      %s%s %d...%d "
glibc-2.3.2/po/zh_TW.molibc-20030708/po/zh_TW.mo
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/Makefile libc-20030708/posix/Makefile
--- glibc-2.3.2/posix/Makefile	2003-02-23 18:23:05.000000000 +0900
+++ libc-20030708/posix/Makefile	2003-07-08 22:58:09.000000000 +0900
@@ -75,7 +75,8 @@
 		   tst-chmod bug-regex1 bug-regex2 bug-regex3 bug-regex4 \
 		   tst-gnuglob tst-regex bug-regex5 bug-regex6 bug-regex7 \
 		   bug-regex8 bug-regex9 bug-regex10 bug-regex11 bug-regex12 \
-		   bug-regex13 bug-regex14 bug-regex15 bug-regex16
+		   bug-regex13 bug-regex14 bug-regex15 bug-regex16 tst-nice \
+		   tst-nanosleep transbug
 ifeq (yes,$(build-shared))
 test-srcs	:= globtest
 tests           += wordexp-test tst-exec tst-spawn
@@ -117,6 +118,15 @@
 
 CFLAGS-regex.c = -Wno-strict-prototypes
 CFLAGS-getaddrinfo.c = -DRESOLVER
+CFLAGS-pread.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-pread64.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-pwrite.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-pwrite64.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-sleep.c = -fexceptions
+CFLAGS-wait.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-waitid.c = -fexceptions
+CFLAGS-waitpid.c = -fexceptions -fasynchronous-unwind-tables
+
 tstgetopt-ARGS = -a -b -cfoobar --required foobar --optional=bazbug \
 		--none random --col --color --colour
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/bits/posix1_lim.h libc-20030708/posix/bits/posix1_lim.h
--- glibc-2.3.2/posix/bits/posix1_lim.h	2003-02-18 07:42:16.000000000 +0900
+++ libc-20030708/posix/bits/posix1_lim.h	2003-07-08 22:58:09.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,92,93,96,98,2000,01,02 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1993,96,98,2000,01,02,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -60,7 +60,11 @@
 #define _POSIX_MQ_PRIO_MAX	32
 
 /* Number of simultaneous supplementary group IDs per process.  */
-#define	_POSIX_NGROUPS_MAX	0
+#ifdef __USE_XOPEN2K
+# define _POSIX_NGROUPS_MAX	8
+#else
+# define _POSIX_NGROUPS_MAX	0
+#endif
 
 /* Number of files one process can have open at once.  */
 #define	_POSIX_OPEN_MAX		16
@@ -135,7 +139,7 @@
    The current maximum can be got from `sysconf'.  */
 
 #ifndef	NGROUPS_MAX
-# define NGROUPS_MAX	_POSIX_NGROUPS_MAX
+# define NGROUPS_MAX	8
 #endif
 
 #endif	/* bits/posix1_lim.h  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/bug-regex4.c libc-20030708/posix/bug-regex4.c
--- glibc-2.3.2/posix/bug-regex4.c	2002-07-27 17:20:58.000000000 +0900
+++ libc-20030708/posix/bug-regex4.c	2003-04-15 23:55:47.000000000 +0900
@@ -43,9 +43,9 @@
     }
   else
     {
-      match[0] = re_search_2 (&regex, "xyabez", 6, "", 0, 1, 9, NULL, 10);
+      match[0] = re_search_2 (&regex, "xyabez", 6, "", 0, 1, 5, NULL, 6);
       match[1] = re_search_2 (&regex, NULL, 0, "abc", 3, 0, 3, NULL, 3);
-      match[2] = re_search_2 (&regex, "xya", 3, "bd", 2, 2, 6, NULL, 8);
+      match[2] = re_search_2 (&regex, "xya", 3, "bd", 2, 2, 3, NULL, 5);
       if (match[0] != 2 || match[1] != 0 || match[2] != 2)
 	{
 	  printf ("re_search_2 returned %d,%d,%d, expected 2,0,2\n",
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/confstr.c libc-20030708/posix/confstr.c
--- glibc-2.3.2/posix/confstr.c	2003-02-13 06:15:00.000000000 +0900
+++ libc-20030708/posix/confstr.c	2003-03-05 12:02:26.000000000 +0900
@@ -143,12 +143,13 @@
 
     case _CS_GNU_LIBC_VERSION:
       string = "glibc " VERSION;
-      string_len = strlen (string);
+      string_len = sizeof ("glibc " VERSION);
+      break;
 
     case _CS_GNU_LIBPTHREAD_VERSION:
 #ifdef LIBPTHREAD_VERSION
       string = LIBPTHREAD_VERSION;
-      string_len = strlen (string);
+      string_len = sizeof LIBPTHREAD_VERSION;
       break;
 #else
       /* No thread library.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/fnmatch.c libc-20030708/posix/fnmatch.c
--- glibc-2.3.2/posix/fnmatch.c	2002-08-04 13:32:39.000000000 +0900
+++ libc-20030708/posix/fnmatch.c	2003-03-16 10:03:46.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1991-93,96-99,2000,01,02 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1992,1993,1996,1997,1998,1999,2000,2001,2002,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -333,7 +334,7 @@
       /* Convert the strings into wide characters.  */
       memset (&ps, '\0', sizeof (ps));
       n = mbsrtowcs (NULL, &pattern, 0, &ps);
-      if (__builtin_expect (n, 0) == (size_t) -1)
+      if (__builtin_expect (n == (size_t) -1, 0))
 	/* Something wrong.
 	   XXX Do we have to set `errno' to something which mbsrtows hasn't
 	   already done?  */
@@ -344,7 +345,7 @@
 
       assert (mbsinit (&ps));
       n = mbsrtowcs (NULL, &string, 0, &ps);
-      if (__builtin_expect (n, 0) == (size_t) -1)
+      if (__builtin_expect (n == (size_t) -1, 0))
 	/* Something wrong.
 	   XXX Do we have to set `errno' to something which mbsrtows hasn't
 	   already done?  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/fnmatch_loop.c libc-20030708/posix/fnmatch_loop.c
--- glibc-2.3.2/posix/fnmatch_loop.c	2002-03-11 17:32:00.000000000 +0900
+++ libc-20030708/posix/fnmatch_loop.c	2003-07-08 22:58:09.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1991-1993, 1996-2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1992,1993,1996,1997,1998,1999,2000,2001,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -539,11 +540,13 @@
 				if (! is_range)
 				  {
 # ifdef WIDE_CHAR_VERSION
-				    for (c1 = 0; c1 < wextra[idx]; ++c1)
+				    for (c1 = 0;
+					 (int32_t) c1 < wextra[idx];
+					 ++c1)
 				      if (n[c1] != wextra[1 + c1])
 					break;
 
-				    if (c1 == wextra[idx])
+				    if ((int32_t) c1 == wextra[idx])
 				      goto matched;
 # else
 				    for (c1 = 0; c1 < extra[idx]; ++c1)
@@ -619,7 +622,7 @@
 
 # ifdef WIDE_CHAR_VERSION
 			/* Search in the `names' array for the characters.  */
-			fcollseq = collseq_table_lookup (collseq, fn);
+			fcollseq = __collseq_table_lookup (collseq, fn);
 			if (fcollseq == ~((uint32_t) 0))
 			  /* XXX We don't know anything about the character
 			     we are supposed to match.  This means we are
@@ -629,7 +632,7 @@
 			if (is_seqval)
 			  lcollseq = cold;
 			else
-			  lcollseq = collseq_table_lookup (collseq, cold);
+			  lcollseq = __collseq_table_lookup (collseq, cold);
 # else
 			fcollseq = collseq[fn];
 			lcollseq = is_seqval ? cold : collseq[(UCHAR) cold];
@@ -791,7 +794,7 @@
 			      {
 # ifdef WIDE_CHAR_VERSION
 				hcollseq =
-				  collseq_table_lookup (collseq, cend);
+				  __collseq_table_lookup (collseq, cend);
 				if (hcollseq == ~((uint32_t) 0))
 				  {
 				    /* Hum, no information about the upper
@@ -932,7 +935,7 @@
 	case L('/'):
 	  if (NO_LEADING_PERIOD (flags))
 	    {
-	      if (n == string_end || c != *n)
+	      if (n == string_end || c != (UCHAR) *n)
 		return FNM_NOMATCH;
 
 	      new_no_leading_period = 1;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/getconf.c libc-20030708/posix/getconf.c
--- glibc-2.3.2/posix/getconf.c	2003-02-13 06:09:19.000000000 +0900
+++ libc-20030708/posix/getconf.c	2003-06-12 08:54:03.000000000 +0900
@@ -865,6 +865,9 @@
 #ifdef _CS_GNU_LIBPTHREAD_VERSION
     { "GNU_LIBPTHREAD_VERSION", _CS_GNU_LIBPTHREAD_VERSION, CONFSTR },
 #endif
+#ifdef _PC_2_SYMLINKS
+    { "POSIX2_SYMLINKS", _PC_2_SYMLINKS, PATHCONF },
+#endif
 
     { NULL, 0, SYSCONF }
   };
@@ -954,7 +957,9 @@
     usage ();
 
   for (c = vars; c->name != NULL; ++c)
-    if (!strcmp (c->name, argv[1]))
+    if (strcmp (c->name, argv[1]) == 0
+	|| (strncmp (c->name, "_POSIX_", 7) == 0
+	    && strcmp (c->name + 7, argv[1]) == 0))
       {
 	long int value;
 	size_t clen;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/ChangeLog libc-20030708/posix/glob/ChangeLog
--- glibc-2.3.2/posix/glob/ChangeLog	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/ChangeLog	1996-07-26 09:34:28.000000000 +0900
@@ -0,0 +1,23 @@
+Sat Jul 20 21:55:31 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	Win32 hacks from <Rob_Tulloh@tivoli.com>.
+	* posix/glob.c [WIN32]: Don't include <pwd.h>; don't use d_ino;
+	use void * for my_realloc; include <malloc.h> for alloca.
+	(glob) [WIN32]: Use "c:/users/default" for ~ if no HOME variable.
+	* posix/fnmatch.h [WIN32]: Use prototypes even if [!__STDC__].
+	* posix/glob.h: Likewise.
+
+Fri Jul 19 16:56:41 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	* posix/glob.h [!_AMIGA && !VMS]: Check this instead of just [!_AMIGA]
+	for `struct stat;' forward decl.
+
+Sat Jun 22 10:44:09 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	* posix/glob.c: Include <alloca.h> only [HAVE_ALLOCA_H], not [sparc].
+
+Fri Jun 21 00:27:51 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	* posix/fnmatch.c (fnmatch): Fix \*[*?]+ case to increment name ptr
+ 	only for ?s, not for *s.  Fix from Chet Ramey.
+
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/Makefile.ami libc-20030708/posix/glob/Makefile.ami
--- glibc-2.3.2/posix/glob/Makefile.ami	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/Makefile.ami	2002-08-27 07:40:48.000000000 +0900
@@ -0,0 +1,69 @@
+# Makefile for standalone distribution of libglob.a (fnmatch, glob).
+
+# Copyright (C) 1991, 92, 93, 94, 95, 97 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+
+# This library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public License
+# as published by the Free Software Foundation; either version 2.1 of
+# the License, or (at your option) any later version.
+
+# This library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; see the file COPYING.LIB.  If not,
+# write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+# Boston, MA 02111-1307, USA.
+
+# Ultrix 2.2 make doesn't expand the value of VPATH.
+VPATH = /glob/
+# This must repeat the value, because configure will remove `VPATH = .'.
+srcdir = /glob/
+
+CC = sc
+RM = delete
+CPPFLAGS =
+CFLAGS =
+
+# Information determined by configure.
+DEFS = Define HAVE_HEADER_STDC Define HAVE_UNISTD_H Define HAVE_STRING_H \
+	Define HAVE_DIRENT_H
+
+# How to invoke ar.
+AR = join
+ARFLAGS = as
+
+# How to invoke ranlib.
+RANLIB = ;
+
+.PHONY: all
+all: glob.lib
+
+glob.lib : glob.o fnmatch.o
+	$(AR) $(ARFLAGS) $@ glob.o fnmatch.o
+	$(RANLIB) $@
+
+# For some reason, Unix make wants the dependencies on the source files.
+# Otherwise it refuses to use an implicit rule!
+# And, get this: it doesn't work to use $(srcdir)foo.c!!
+glob.o: $(srcdir)glob.h $(srcdir)fnmatch.h glob.c
+fnmatch.o: $(srcdir)fnmatch.h fnmatch.c
+
+OUTPUT_OPTION =
+.c.o:
+	$(CC) IDir "" \
+	      $(DEFS) $(CPPFLAGS) $(CFLAGS) $< $(OUTPUT_OPTION)
+
+.PHONY: clean realclean glob-clean glob-realclean distclean
+clean glob-clean:
+	-$(RM) glob.lib "#?.o" core
+distclean glob-realclean: clean
+	-$(RM) TAGS tags Makefile config.status config.h config.log
+realcean: distclean
+
+# For inside the C library.
+glob.tar glob.tar.Z:
+	$(MAKE) -C .. $@
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/Makefile.in libc-20030708/posix/glob/Makefile.in
--- glibc-2.3.2/posix/glob/Makefile.in	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/Makefile.in	2002-08-27 07:39:49.000000000 +0900
@@ -0,0 +1,66 @@
+# Makefile for standalone distribution of libglob.a (fnmatch, glob).
+
+# Copyright (C) 1991, 92, 93, 94, 95 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+
+# This library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public License
+# as published by the Free Software Foundation; either version 2.1 of
+# the License, or (at your option) any later version.
+
+# This library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with this library; see the file COPYING.LIB.  If
+# not, write to the Free Software Foundation, Inc., 59 Temple Place, 
+# Suite 330, Boston, MA 02111 USA.
+
+# Ultrix 2.2 make doesn't expand the value of VPATH.
+VPATH = @srcdir@
+# This must repeat the value, because configure will remove `VPATH = .'.
+srcdir = @srcdir@
+
+CC = @CC@
+CPPFLAGS = @CPPFLAGS@
+CFLAGS = @CFLAGS@
+
+# Information determined by configure.
+DEFS = @DEFS@
+
+# How to invoke ar.
+AR = @AR@
+ARFLAGS = rv
+
+# How to invoke ranlib.
+RANLIB = @RANLIB@
+
+.PHONY: all
+all: libglob.a
+
+libglob.a: glob.o fnmatch.o
+	$(AR) $(ARFLAGS) $@ glob.o fnmatch.o
+	$(RANLIB) $@
+
+# For some reason, Unix make wants the dependencies on the source files.
+# Otherwise it refuses to use an implicit rule!
+# And, get this: it doesn't work to use $(srcdir)/foo.c!!
+glob.o: $(srcdir)/glob.h $(srcdir)/fnmatch.h glob.c
+fnmatch.o: $(srcdir)/fnmatch.h fnmatch.c
+
+.c.o:
+	$(CC) -I. -I$(srcdir) -c \
+	      $(DEFS) $(CPPFLAGS) $(CFLAGS) $< $(OUTPUT_OPTION)
+
+.PHONY: clean realclean glob-clean glob-realclean distclean
+clean glob-clean:
+	-rm -f libglob.a *.o core
+distclean glob-realclean: clean
+	-rm -f TAGS tags Makefile config.status config.h config.log
+realcean: distclean
+
+# For inside the C library.
+glob.tar glob.tar.Z:
+	$(MAKE) -C .. $@
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/SCOPTIONS libc-20030708/posix/glob/SCOPTIONS
--- glibc-2.3.2/posix/glob/SCOPTIONS	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/SCOPTIONS	1996-05-10 02:54:36.000000000 +0900
@@ -0,0 +1,13 @@
+ERRORREXX
+OPTIMIZE
+NOVERSION
+OPTIMIZERTIME
+OPTIMIZERALIAS
+DEFINE INCLUDEDIR="include:"
+DEFINE LIBDIR="lib:"
+DEFINE NO_ALLOCA
+DEFINE NO_FLOAT
+DEFINE NO_ARCHIVES
+IGNORE=161
+IGNORE=100
+STARTUP=cres
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/SMakefile libc-20030708/posix/glob/SMakefile
--- glibc-2.3.2/posix/glob/SMakefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/SMakefile	2001-07-06 13:55:38.000000000 +0900
@@ -0,0 +1,68 @@
+# Makefile for standalone distribution of libglob.a (fnmatch, glob).
+# Copyright (C) 1991, 92, 93, 94, 95, 97 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+
+# The GNU C Library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+
+# The GNU C Library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; if not, write to the Free
+# Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+# 02111-1307 USA.
+
+# Ultrix 2.2 make doesn't expand the value of VPATH.
+VPATH = /glob/
+# This must repeat the value, because configure will remove `VPATH = .'.
+srcdir = /glob/
+
+CC = sc
+CPPFLAGS =
+CFLAGS =
+MAKE = smake
+RM = delete
+
+# Information determined by configure.
+DEFS = Define HAVE_HEADER_STDC Define HAVE_UNISTD_H Define HAVE_STRING_H \
+	Define HAVE_DIRENT_H
+
+# How to invoke ar.
+AR = join
+ARFLAGS = as
+
+# How to invoke ranlib.
+RANLIB = ;
+
+.PHONY: all
+all: glob.lib
+
+glob.lib : glob.o fnmatch.o
+	$(AR) $(ARFLAGS) $@ glob.o fnmatch.o
+	$(RANLIB) $@
+
+# For some reason, Unix make wants the dependencies on the source files.
+# Otherwise it refuses to use an implicit rule!
+# And, get this: it doesn't work to use $(srcdir)foo.c!!
+glob.o: $(srcdir)glob.h $(srcdir)fnmatch.h glob.c
+fnmatch.o: $(srcdir)fnmatch.h fnmatch.c
+
+.c.o:
+	$(CC) IDir "" \
+	      $(DEFS) $(CPPFLAGS) $(CFLAGS) $< $(OUTPUT_OPTION)
+
+.PHONY: clean realclean glob-clean glob-realclean distclean
+clean glob-clean:
+	-$(RM) -f glob.lib *.o core
+distclean glob-realclean: clean
+	-$(RM) -f TAGS tags Makefile config.status config.h config.log
+realcean: distclean
+
+# For inside the C library.
+glob.tar glob.tar.Z:
+	$(MAKE) -C .. $@
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/configure libc-20030708/posix/glob/configure
--- glibc-2.3.2/posix/glob/configure	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/configure	1996-03-02 02:19:22.000000000 +0900
@@ -0,0 +1,1664 @@
+#! /bin/sh
+
+# Guess values for system-dependent variables and create Makefiles.
+# Generated automatically using autoconf version 2.7 
+# Copyright (C) 1992, 1993, 1994 Free Software Foundation, Inc.
+#
+# This configure script is free software; the Free Software Foundation
+# gives unlimited permission to copy, distribute and modify it.
+
+# Defaults:
+ac_help=
+ac_default_prefix=/usr/local
+# Any additions from configure.in:
+
+# Initialize some variables set by options.
+# The variables have the same names as the options, with
+# dashes changed to underlines.
+build=NONE
+cache_file=./config.cache
+exec_prefix=NONE
+host=NONE
+no_create=
+nonopt=NONE
+no_recursion=
+prefix=NONE
+program_prefix=NONE
+program_suffix=NONE
+program_transform_name=s,x,x,
+silent=
+site=
+srcdir=
+target=NONE
+verbose=
+x_includes=NONE
+x_libraries=NONE
+bindir='${exec_prefix}/bin'
+sbindir='${exec_prefix}/sbin'
+libexecdir='${exec_prefix}/libexec'
+datadir='${prefix}/share'
+sysconfdir='${prefix}/etc'
+sharedstatedir='${prefix}/com'
+localstatedir='${prefix}/var'
+libdir='${exec_prefix}/lib'
+includedir='${prefix}/include'
+oldincludedir='/usr/include'
+infodir='${prefix}/info'
+mandir='${prefix}/man'
+
+# Initialize some other variables.
+subdirs=
+MFLAGS= MAKEFLAGS=
+
+ac_prev=
+for ac_option
+do
+
+  # If the previous option needs an argument, assign it.
+  if test -n "$ac_prev"; then
+    eval "$ac_prev=\$ac_option"
+    ac_prev=
+    continue
+  fi
+
+  case "$ac_option" in
+  -*=*) ac_optarg=`echo "$ac_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
+  *) ac_optarg= ;;
+  esac
+
+  # Accept the important Cygnus configure options, so we can diagnose typos.
+
+  case "$ac_option" in
+
+  -bindir | --bindir | --bindi | --bind | --bin | --bi)
+    ac_prev=bindir ;;
+  -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
+    bindir="$ac_optarg" ;;
+
+  -build | --build | --buil | --bui | --bu)
+    ac_prev=build ;;
+  -build=* | --build=* | --buil=* | --bui=* | --bu=*)
+    build="$ac_optarg" ;;
+
+  -cache-file | --cache-file | --cache-fil | --cache-fi \
+  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
+    ac_prev=cache_file ;;
+  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
+  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
+    cache_file="$ac_optarg" ;;
+
+  -datadir | --datadir | --datadi | --datad | --data | --dat | --da)
+    ac_prev=datadir ;;
+  -datadir=* | --datadir=* | --datadi=* | --datad=* | --data=* | --dat=* \
+  | --da=*)
+    datadir="$ac_optarg" ;;
+
+  -disable-* | --disable-*)
+    ac_feature=`echo $ac_option|sed -e 's/-*disable-//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_feature| sed 's/[-a-zA-Z0-9_]//g'`"; then
+      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
+    fi
+    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
+    eval "enable_${ac_feature}=no" ;;
+
+  -enable-* | --enable-*)
+    ac_feature=`echo $ac_option|sed -e 's/-*enable-//' -e 's/=.*//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_feature| sed 's/[-_a-zA-Z0-9]//g'`"; then
+      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
+    fi
+    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
+    case "$ac_option" in
+      *=*) ;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "enable_${ac_feature}='$ac_optarg'" ;;
+
+  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
+  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
+  | --exec | --exe | --ex)
+    ac_prev=exec_prefix ;;
+  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
+  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
+  | --exec=* | --exe=* | --ex=*)
+    exec_prefix="$ac_optarg" ;;
+
+  -gas | --gas | --ga | --g)
+    # Obsolete; use --with-gas.
+    with_gas=yes ;;
+
+  -help | --help | --hel | --he)
+    # Omit some internal or obsolete options to make the list less imposing.
+    # This message is too long to be a string in the A/UX 3.1 sh.
+    cat << EOF
+Usage: configure [options] [host]
+Options: [defaults in brackets after descriptions]
+Configuration:
+  --cache-file=FILE       cache test results in FILE
+  --help                  print this message
+  --no-create             do not create output files
+  --quiet, --silent       do not print \`checking...' messages
+  --version               print the version of autoconf that created configure
+Directory and file names:
+  --prefix=PREFIX         install architecture-independent files in PREFIX
+                          [$ac_default_prefix]
+  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
+                          [same as prefix]
+  --bindir=DIR            user executables in DIR [EPREFIX/bin]
+  --sbindir=DIR           system admin executables in DIR [EPREFIX/sbin]
+  --libexecdir=DIR        program executables in DIR [EPREFIX/libexec]
+  --datadir=DIR           read-only architecture-independent data in DIR
+                          [PREFIX/share]
+  --sysconfdir=DIR        read-only single-machine data in DIR [PREFIX/etc]
+  --sharedstatedir=DIR    modifiable architecture-independent data in DIR
+                          [PREFIX/com]
+  --localstatedir=DIR     modifiable single-machine data in DIR [PREFIX/var]
+  --libdir=DIR            object code libraries in DIR [EPREFIX/lib]
+  --includedir=DIR        C header files in DIR [PREFIX/include]
+  --oldincludedir=DIR     C header files for non-gcc in DIR [/usr/include]
+  --infodir=DIR           info documentation in DIR [PREFIX/info]
+  --mandir=DIR            man documentation in DIR [PREFIX/man]
+  --srcdir=DIR            find the sources in DIR [configure dir or ..]
+  --program-prefix=PREFIX prepend PREFIX to installed program names
+  --program-suffix=SUFFIX append SUFFIX to installed program names
+  --program-transform-name=PROGRAM
+                          run sed PROGRAM on installed program names
+EOF
+    cat << EOF
+Host type:
+  --build=BUILD           configure for building on BUILD [BUILD=HOST]
+  --host=HOST             configure for HOST [guessed]
+  --target=TARGET         configure for TARGET [TARGET=HOST]
+Features and packages:
+  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
+  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
+  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
+  --x-includes=DIR        X include files are in DIR
+  --x-libraries=DIR       X library files are in DIR
+EOF
+    if test -n "$ac_help"; then
+      echo "--enable and --with options recognized:$ac_help"
+    fi
+    exit 0 ;;
+
+  -host | --host | --hos | --ho)
+    ac_prev=host ;;
+  -host=* | --host=* | --hos=* | --ho=*)
+    host="$ac_optarg" ;;
+
+  -includedir | --includedir | --includedi | --included | --include \
+  | --includ | --inclu | --incl | --inc)
+    ac_prev=includedir ;;
+  -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
+  | --includ=* | --inclu=* | --incl=* | --inc=*)
+    includedir="$ac_optarg" ;;
+
+  -infodir | --infodir | --infodi | --infod | --info | --inf)
+    ac_prev=infodir ;;
+  -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
+    infodir="$ac_optarg" ;;
+
+  -libdir | --libdir | --libdi | --libd)
+    ac_prev=libdir ;;
+  -libdir=* | --libdir=* | --libdi=* | --libd=*)
+    libdir="$ac_optarg" ;;
+
+  -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
+  | --libexe | --libex | --libe)
+    ac_prev=libexecdir ;;
+  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
+  | --libexe=* | --libex=* | --libe=*)
+    libexecdir="$ac_optarg" ;;
+
+  -localstatedir | --localstatedir | --localstatedi | --localstated \
+  | --localstate | --localstat | --localsta | --localst \
+  | --locals | --local | --loca | --loc | --lo)
+    ac_prev=localstatedir ;;
+  -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
+  | --localstate=* | --localstat=* | --localsta=* | --localst=* \
+  | --locals=* | --local=* | --loca=* | --loc=* | --lo=*)
+    localstatedir="$ac_optarg" ;;
+
+  -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
+    ac_prev=mandir ;;
+  -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
+    mandir="$ac_optarg" ;;
+
+  -nfp | --nfp | --nf)
+    # Obsolete; use --without-fp.
+    with_fp=no ;;
+
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c)
+    no_create=yes ;;
+
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
+    no_recursion=yes ;;
+
+  -oldincludedir | --oldincludedir | --oldincludedi | --oldincluded \
+  | --oldinclude | --oldinclud | --oldinclu | --oldincl | --oldinc \
+  | --oldin | --oldi | --old | --ol | --o)
+    ac_prev=oldincludedir ;;
+  -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
+  | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
+  | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
+    oldincludedir="$ac_optarg" ;;
+
+  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
+    ac_prev=prefix ;;
+  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
+    prefix="$ac_optarg" ;;
+
+  -program-prefix | --program-prefix | --program-prefi | --program-pref \
+  | --program-pre | --program-pr | --program-p)
+    ac_prev=program_prefix ;;
+  -program-prefix=* | --program-prefix=* | --program-prefi=* \
+  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
+    program_prefix="$ac_optarg" ;;
+
+  -program-suffix | --program-suffix | --program-suffi | --program-suff \
+  | --program-suf | --program-su | --program-s)
+    ac_prev=program_suffix ;;
+  -program-suffix=* | --program-suffix=* | --program-suffi=* \
+  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
+    program_suffix="$ac_optarg" ;;
+
+  -program-transform-name | --program-transform-name \
+  | --program-transform-nam | --program-transform-na \
+  | --program-transform-n | --program-transform- \
+  | --program-transform | --program-transfor \
+  | --program-transfo | --program-transf \
+  | --program-trans | --program-tran \
+  | --progr-tra | --program-tr | --program-t)
+    ac_prev=program_transform_name ;;
+  -program-transform-name=* | --program-transform-name=* \
+  | --program-transform-nam=* | --program-transform-na=* \
+  | --program-transform-n=* | --program-transform-=* \
+  | --program-transform=* | --program-transfor=* \
+  | --program-transfo=* | --program-transf=* \
+  | --program-trans=* | --program-tran=* \
+  | --progr-tra=* | --program-tr=* | --program-t=*)
+    program_transform_name="$ac_optarg" ;;
+
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil)
+    silent=yes ;;
+
+  -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
+    ac_prev=sbindir ;;
+  -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
+  | --sbi=* | --sb=*)
+    sbindir="$ac_optarg" ;;
+
+  -sharedstatedir | --sharedstatedir | --sharedstatedi \
+  | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
+  | --sharedst | --shareds | --shared | --share | --shar \
+  | --sha | --sh)
+    ac_prev=sharedstatedir ;;
+  -sharedstatedir=* | --sharedstatedir=* | --sharedstatedi=* \
+  | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
+  | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
+  | --sha=* | --sh=*)
+    sharedstatedir="$ac_optarg" ;;
+
+  -site | --site | --sit)
+    ac_prev=site ;;
+  -site=* | --site=* | --sit=*)
+    site="$ac_optarg" ;;
+
+  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
+    ac_prev=srcdir ;;
+  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
+    srcdir="$ac_optarg" ;;
+
+  -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
+  | --syscon | --sysco | --sysc | --sys | --sy)
+    ac_prev=sysconfdir ;;
+  -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
+  | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
+    sysconfdir="$ac_optarg" ;;
+
+  -target | --target | --targe | --targ | --tar | --ta | --t)
+    ac_prev=target ;;
+  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
+    target="$ac_optarg" ;;
+
+  -v | -verbose | --verbose | --verbos | --verbo | --verb)
+    verbose=yes ;;
+
+  -version | --version | --versio | --versi | --vers)
+    echo "configure generated by autoconf version 2.7"
+    exit 0 ;;
+
+  -with-* | --with-*)
+    ac_package=`echo $ac_option|sed -e 's/-*with-//' -e 's/=.*//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_package| sed 's/[-_a-zA-Z0-9]//g'`"; then
+      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
+    fi
+    ac_package=`echo $ac_package| sed 's/-/_/g'`
+    case "$ac_option" in
+      *=*) ;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "with_${ac_package}='$ac_optarg'" ;;
+
+  -without-* | --without-*)
+    ac_package=`echo $ac_option|sed -e 's/-*without-//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_package| sed 's/[-a-zA-Z0-9_]//g'`"; then
+      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
+    fi
+    ac_package=`echo $ac_package| sed 's/-/_/g'`
+    eval "with_${ac_package}=no" ;;
+
+  --x)
+    # Obsolete; use --with-x.
+    with_x=yes ;;
+
+  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
+  | --x-incl | --x-inc | --x-in | --x-i)
+    ac_prev=x_includes ;;
+  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
+  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
+    x_includes="$ac_optarg" ;;
+
+  -x-libraries | --x-libraries | --x-librarie | --x-librari \
+  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
+    ac_prev=x_libraries ;;
+  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
+  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
+    x_libraries="$ac_optarg" ;;
+
+  -*) { echo "configure: error: $ac_option: invalid option; use --help to show usage" 1>&2; exit 1; }
+    ;;
+
+  *)
+    if test -n "`echo $ac_option| sed 's/[-a-z0-9.]//g'`"; then
+      echo "configure: warning: $ac_option: invalid host type" 1>&2
+    fi
+    if test "x$nonopt" != xNONE; then
+      { echo "configure: error: can only configure for one host and one target at a time" 1>&2; exit 1; }
+    fi
+    nonopt="$ac_option"
+    ;;
+
+  esac
+done
+
+if test -n "$ac_prev"; then
+  { echo "configure: error: missing argument to --`echo $ac_prev | sed 's/_/-/g'`" 1>&2; exit 1; }
+fi
+
+trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
+
+# File descriptor usage:
+# 0 standard input
+# 1 file creation
+# 2 errors and warnings
+# 3 some systems may open it to /dev/tty
+# 4 used on the Kubota Titan
+# 6 checking for... messages and results
+# 5 compiler messages saved in config.log
+if test "$silent" = yes; then
+  exec 6>/dev/null
+else
+  exec 6>&1
+fi
+exec 5>./config.log
+
+echo "\
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+" 1>&5
+
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Also quote any args containing shell metacharacters.
+ac_configure_args=
+for ac_arg
+do
+  case "$ac_arg" in
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c) ;;
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r) ;;
+  *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?]*)
+  ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+  *) ac_configure_args="$ac_configure_args $ac_arg" ;;
+  esac
+done
+
+# NLS nuisances.
+# Only set LANG and LC_ALL to C if already set.
+# These must not be set unconditionally because not all systems understand
+# e.g. LANG=C (notably SCO).
+if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
+if test "${LANG+set}"   = set; then LANG=C;   export LANG;   fi
+
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -rf conftest* confdefs.h
+# AIX cpp loses on an empty file, so make sure it contains at least a newline.
+echo > confdefs.h
+
+# A filename unique to this package, relative to the directory that
+# configure is in, which we can look for to find out if srcdir is correct.
+ac_unique_file=fnmatch.c
+
+# Find the source files, if location was not specified.
+if test -z "$srcdir"; then
+  ac_srcdir_defaulted=yes
+  # Try the directory containing this script, then its parent.
+  ac_prog=$0
+  ac_confdir=`echo $ac_prog|sed 's%/[^/][^/]*$%%'`
+  test "x$ac_confdir" = "x$ac_prog" && ac_confdir=.
+  srcdir=$ac_confdir
+  if test ! -r $srcdir/$ac_unique_file; then
+    srcdir=..
+  fi
+else
+  ac_srcdir_defaulted=no
+fi
+if test ! -r $srcdir/$ac_unique_file; then
+  if test "$ac_srcdir_defaulted" = yes; then
+    { echo "configure: error: can not find sources in $ac_confdir or .." 1>&2; exit 1; }
+  else
+    { echo "configure: error: can not find sources in $srcdir" 1>&2; exit 1; }
+  fi
+fi
+srcdir=`echo "${srcdir}" | sed 's%\([^/]\)/*$%\1%'`
+
+# Prefer explicitly selected file to automatically selected ones.
+if test -z "$CONFIG_SITE"; then
+  if test "x$prefix" != xNONE; then
+    CONFIG_SITE="$prefix/share/config.site $prefix/etc/config.site"
+  else
+    CONFIG_SITE="$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site"
+  fi
+fi
+for ac_site_file in $CONFIG_SITE; do
+  if test -r "$ac_site_file"; then
+    echo "loading site script $ac_site_file"
+    . "$ac_site_file"
+  fi
+done
+
+if test -r "$cache_file"; then
+  echo "loading cache $cache_file"
+  . $cache_file
+else
+  echo "creating cache $cache_file"
+  > $cache_file
+fi
+
+ac_ext=c
+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+
+if (echo "testing\c"; echo 1,2,3) | grep c >/dev/null; then
+  # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.
+  if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then
+    ac_n= ac_c='
+' ac_t='	'
+  else
+    ac_n=-n ac_c= ac_t=
+  fi
+else
+  ac_n= ac_c='\c' ac_t=
+fi
+
+					# Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_CC="gcc"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  ac_prog_rejected=no
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      if test "$ac_dir/$ac_word" = "/usr/ucb/cc"; then
+        ac_prog_rejected=yes
+	continue
+      fi
+      ac_cv_prog_CC="cc"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# -gt 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    set dummy "$ac_dir/$ac_word" "$@"
+    shift
+    ac_cv_prog_CC="$@"
+  fi
+fi
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+  test -z "$CC" && { echo "configure: error: no acceptable cc found in \$PATH" 1>&2; exit 1; }
+fi
+
+echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.c <<EOF
+#ifdef __GNUC__
+  yes;
+#endif
+EOF
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:601: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+  ac_cv_prog_gcc=yes
+else
+  ac_cv_prog_gcc=no
+fi
+fi
+
+echo "$ac_t""$ac_cv_prog_gcc" 1>&6
+if test $ac_cv_prog_gcc = yes; then
+  GCC=yes
+  if test "${CFLAGS+set}" != set; then
+    echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_gcc_g'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  echo 'void f(){}' > conftest.c
+if test -z "`${CC-cc} -g -c conftest.c 2>&1`"; then
+  ac_cv_prog_gcc_g=yes
+else
+  ac_cv_prog_gcc_g=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_prog_gcc_g" 1>&6
+    if test $ac_cv_prog_gcc_g = yes; then
+      CFLAGS="-g -O"
+    else
+      CFLAGS="-O"
+    fi
+  fi
+else
+  GCC=
+  test "${CFLAGS+set}" = set || CFLAGS="-g"
+fi
+
+# Extract the first word of "ar", so it can be a program name with args.
+set dummy ar; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_AR'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$AR"; then
+  ac_cv_prog_AR="$AR" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_AR="ar"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_prog_AR" && ac_cv_prog_AR="ar"
+fi
+fi
+AR="$ac_cv_prog_AR"
+if test -n "$AR"; then
+  echo "$ac_t""$AR" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+# Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_RANLIB="ranlib"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_prog_RANLIB" && ac_cv_prog_RANLIB=":"
+fi
+fi
+RANLIB="$ac_cv_prog_RANLIB"
+if test -n "$RANLIB"; then
+  echo "$ac_t""$RANLIB" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
+# On Suns, sometimes $CPP names a directory.
+if test -n "$CPP" && test -d "$CPP"; then
+  CPP=
+fi
+if test -z "$CPP"; then
+if eval "test \"`echo '$''{'ac_cv_prog_CPP'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+    # This must be in double quotes, not single quotes, because CPP may get
+  # substituted into the Makefile and "${CC-cc}" will confuse make.
+  CPP="${CC-cc} -E"
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp.
+  cat > conftest.$ac_ext <<EOF
+#line 709 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:715: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  CPP="${CC-cc} -E -traditional-cpp"
+  cat > conftest.$ac_ext <<EOF
+#line 724 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:730: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  CPP=/lib/cpp
+fi
+rm -f conftest*
+fi
+rm -f conftest*
+  ac_cv_prog_CPP="$CPP"
+fi
+  CPP="$ac_cv_prog_CPP"
+else
+  ac_cv_prog_CPP="$CPP"
+fi
+echo "$ac_t""$CPP" 1>&6
+			echo $ac_n "checking for AIX""... $ac_c" 1>&6
+cat > conftest.$ac_ext <<EOF
+#line 751 "configure"
+#include "confdefs.h"
+#ifdef _AIX
+  yes
+#endif
+
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "yes" >/dev/null 2>&1; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
+#define _ALL_SOURCE 1
+EOF
+
+else
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+fi
+rm -f conftest*
+
+
+ac_safe=`echo "minix/config.h" | tr './\055' '___'`
+echo $ac_n "checking for minix/config.h""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 778 "configure"
+#include "confdefs.h"
+#include <minix/config.h>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:783: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
+fi
+rm -f conftest*
+fi
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  MINIX=yes
+else
+  echo "$ac_t""no" 1>&6
+MINIX=
+fi
+
+if test "$MINIX" = yes; then
+  cat >> confdefs.h <<\EOF
+#define _POSIX_SOURCE 1
+EOF
+
+  cat >> confdefs.h <<\EOF
+#define _POSIX_1_SOURCE 2
+EOF
+
+  cat >> confdefs.h <<\EOF
+#define _MINIX 1
+EOF
+
+fi
+
+echo $ac_n "checking for POSIXized ISC""... $ac_c" 1>&6
+if test -d /etc/conf/kconfig.d &&
+  grep _POSIX_VERSION /usr/include/sys/unistd.h >/dev/null 2>&1
+then
+  echo "$ac_t""yes" 1>&6
+  ISC=yes # If later tests want to check for ISC.
+  cat >> confdefs.h <<\EOF
+#define _POSIX_SOURCE 1
+EOF
+
+  if test "$GCC" = yes; then
+    CC="$CC -posix"
+  else
+    CC="$CC -Xp"
+  fi
+else
+  echo "$ac_t""no" 1>&6
+  ISC=
+fi
+
+echo $ac_n "checking for working const""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 843 "configure"
+#include "confdefs.h"
+
+int main() { return 0; }
+int t() {
+
+/* Ultrix mips cc rejects this.  */
+typedef int charset[2]; const charset x;
+/* SunOS 4.1.1 cc rejects this.  */
+char const *const *ccp;
+char **p;
+/* NEC SVR4.0.2 mips cc rejects this.  */
+struct point {int x, y;};
+static struct point const zero = {0,0};
+/* AIX XL C 1.02.0.0 rejects this.
+   It does not let you subtract one const X* pointer from another in an arm
+   of an if-expression whose if-part is not a constant expression */
+const char *g = "string";
+ccp = &g + (g ? g-g : 0);
+/* HPUX 7.0 cc rejects these. */
+++ccp;
+p = (char**) ccp;
+ccp = (char const *const *) p;
+{ /* SCO 3.2v4 cc rejects this.  */
+  char *t;
+  char const *s = 0 ? (char *) 0 : (char const *) 0;
+
+  *t++ = 0;
+}
+{ /* Someone thinks the Sun supposedly-ANSI compiler will reject this.  */
+  int x[] = {25, 17};
+  const int *foo = &x[0];
+  ++foo;
+}
+{ /* Sun SC1.0 ANSI compiler rejects this -- but not the above. */
+  typedef const int *iptr;
+  iptr p = 0;
+  ++p;
+}
+{ /* AIX XL C 1.02.0.0 rejects this saying
+     "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
+  struct s { int j; const int *ap[3]; };
+  struct s *b; b->j = 5;
+}
+{ /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
+  const int foo = 10;
+}
+
+; return 0; }
+EOF
+if { (eval echo configure:893: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_c_const=yes
+else
+  rm -rf conftest*
+  ac_cv_c_const=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_c_const" 1>&6
+if test $ac_cv_c_const = no; then
+  cat >> confdefs.h <<\EOF
+#define const 
+EOF
+
+fi
+
+# If we cannot run a trivial program, we must be cross compiling.
+echo $ac_n "checking whether cross-compiling""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_c_cross'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_c_cross=yes
+else
+cat > conftest.$ac_ext <<EOF
+#line 921 "configure"
+#include "confdefs.h"
+main(){return(0);}
+EOF
+{ (eval echo configure:925: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_c_cross=no
+else
+  ac_cv_c_cross=yes
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_c_cross" 1>&6
+cross_compiling=$ac_cv_c_cross
+
+echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 943 "configure"
+#include "confdefs.h"
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:951: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  ac_cv_header_stdc=yes
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+cat > conftest.$ac_ext <<EOF
+#line 966 "configure"
+#include "confdefs.h"
+#include <string.h>
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "memchr" >/dev/null 2>&1; then
+  :
+else
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+cat > conftest.$ac_ext <<EOF
+#line 984 "configure"
+#include "confdefs.h"
+#include <stdlib.h>
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "free" >/dev/null 2>&1; then
+  :
+else
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+if test "$cross_compiling" = yes; then
+  :
+else
+cat > conftest.$ac_ext <<EOF
+#line 1005 "configure"
+#include "confdefs.h"
+#include <ctype.h>
+#define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+#define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
+int main () { int i; for (i = 0; i < 256; i++)
+if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);
+exit (0); }
+
+EOF
+{ (eval echo configure:1016: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  :
+else
+  ac_cv_header_stdc=no
+fi
+fi
+rm -fr conftest*
+fi
+fi
+
+echo "$ac_t""$ac_cv_header_stdc" 1>&6
+if test $ac_cv_header_stdc = yes; then
+  cat >> confdefs.h <<\EOF
+#define STDC_HEADERS 1
+EOF
+
+fi
+
+for ac_hdr in memory.h unistd.h string.h
+do
+ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1043 "configure"
+#include "confdefs.h"
+#include <$ac_hdr>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1048: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
+fi
+rm -f conftest*
+fi
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdefghijklmnopqrstuvwxyz./\055' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ___'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+
+ac_header_dirent=no
+for ac_hdr in dirent.h sys/ndir.h sys/dir.h ndir.h
+do
+ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+echo $ac_n "checking for $ac_hdr that defines DIR""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_dirent_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1081 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <$ac_hdr>
+int main() { return 0; }
+int t() {
+DIR *dirp = 0;
+; return 0; }
+EOF
+if { (eval echo configure:1090: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_header_dirent_$ac_safe=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_header_dirent_$ac_safe=no"
+fi
+rm -f conftest*
+
+fi
+if eval "test \"`echo '$ac_cv_header_dirent_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdedfghijklmnopqrstuvwxyz./\055' 'ABCDEDFGHIJKLMNOPQRSTUVWXYZ___'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
+EOF
+ ac_header_dirent=$ac_hdr; break
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+# Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
+if test $ac_header_dirent = dirent.h; then
+echo $ac_n "checking for -ldir""... $ac_c" 1>&6
+ac_lib_var=`echo dir | tr '.-/+' '___p'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-ldir  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 1121 "configure"
+#include "confdefs.h"
+
+int main() { return 0; }
+int t() {
+opendir()
+; return 0; }
+EOF
+if { (eval echo configure:1129: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  LIBS="$LIBS -ldir"
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+else
+echo $ac_n "checking for -lx""... $ac_c" 1>&6
+ac_lib_var=`echo x | tr '.-/+' '___p'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-lx  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 1156 "configure"
+#include "confdefs.h"
+
+int main() { return 0; }
+int t() {
+opendir()
+; return 0; }
+EOF
+if { (eval echo configure:1164: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  LIBS="$LIBS -lx"
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+fi
+
+echo $ac_n "checking whether closedir returns void""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_closedir_void'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_func_closedir_void=yes
+else
+cat > conftest.$ac_ext <<EOF
+#line 1192 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <$ac_header_dirent>
+int closedir(); main() { exit(closedir(opendir(".")) != 0); }
+EOF
+{ (eval echo configure:1198: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_func_closedir_void=no
+else
+  ac_cv_func_closedir_void=yes
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_func_closedir_void" 1>&6
+if test $ac_cv_func_closedir_void = yes; then
+  cat >> confdefs.h <<\EOF
+#define CLOSEDIR_VOID 1
+EOF
+
+fi
+
+# The Ultrix 4.2 mips builtin alloca declared by alloca.h only works
+# for constant arguments.  Useless!
+echo $ac_n "checking for working alloca.h""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_alloca_h'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1223 "configure"
+#include "confdefs.h"
+#include <alloca.h>
+int main() { return 0; }
+int t() {
+char *p = alloca(2 * sizeof(int));
+; return 0; }
+EOF
+if { (eval echo configure:1231: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_header_alloca_h=yes
+else
+  rm -rf conftest*
+  ac_cv_header_alloca_h=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_header_alloca_h" 1>&6
+if test $ac_cv_header_alloca_h = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_ALLOCA_H 1
+EOF
+
+fi
+
+echo $ac_n "checking for alloca""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_alloca'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1255 "configure"
+#include "confdefs.h"
+
+#ifdef __GNUC__
+# define alloca __builtin_alloca
+#else
+# if HAVE_ALLOCA_H
+#  include <alloca.h>
+# else
+#  ifdef _AIX
+ #pragma alloca
+#  else
+#   ifndef alloca /* predefined by HP cc +Olibcalls */
+char *alloca ();
+#   endif
+#  endif
+# endif
+#endif
+
+int main() { return 0; }
+int t() {
+char *p = (char *) alloca(1);
+; return 0; }
+EOF
+if { (eval echo configure:1279: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_func_alloca=yes
+else
+  rm -rf conftest*
+  ac_cv_func_alloca=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_func_alloca" 1>&6
+if test $ac_cv_func_alloca = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_ALLOCA 1
+EOF
+
+fi
+
+if test $ac_cv_func_alloca = no; then
+  # The SVR3 libPW and SVR4 libucb both contain incompatible functions
+  # that cause trouble.  Some versions do not even contain alloca or
+  # contain a buggy version.  If you still want to use their alloca,
+  # use ar to extract alloca.o from them instead of compiling alloca.c.
+  ALLOCA=alloca.o
+  cat >> confdefs.h <<\EOF
+#define C_ALLOCA 1
+EOF
+
+
+echo $ac_n "checking whether alloca needs Cray hooks""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_os_cray'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1314 "configure"
+#include "confdefs.h"
+#if defined(CRAY) && ! defined(CRAY2)
+webecray
+#else
+wenotbecray
+#endif
+
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "webecray" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_os_cray=yes
+else
+  rm -rf conftest*
+  ac_cv_os_cray=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_os_cray" 1>&6
+if test $ac_cv_os_cray = yes; then
+for ac_func in _getb67 GETB67 getb67; do
+  echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1343 "configure"
+#include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+char $ac_func();
+
+int main() { return 0; }
+int t() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
+EOF
+if { (eval echo configure:1365: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
+fi
+rm -f conftest*
+
+fi
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  cat >> confdefs.h <<EOF
+#define CRAY_STACKSEG_END $ac_func
+EOF
+
+  break
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+done
+fi
+
+echo $ac_n "checking stack direction for C alloca""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_c_stack_direction'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_c_stack_direction=0
+else
+cat > conftest.$ac_ext <<EOF
+#line 1397 "configure"
+#include "confdefs.h"
+find_stack_direction ()
+{
+  static char *addr = 0;
+  auto char dummy;
+  if (addr == 0)
+    {
+      addr = &dummy;
+      return find_stack_direction ();
+    }
+  else
+    return (&dummy > addr) ? 1 : -1;
+}
+main ()
+{
+  exit (find_stack_direction() < 0);
+}
+EOF
+{ (eval echo configure:1416: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_c_stack_direction=1
+else
+  ac_cv_c_stack_direction=-1
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_c_stack_direction" 1>&6
+cat >> confdefs.h <<EOF
+#define STACK_DIRECTION $ac_cv_c_stack_direction
+EOF
+
+fi
+
+echo $ac_n "checking for strcoll""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_strcoll'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_func_strcoll=no
+else
+cat > conftest.$ac_ext <<EOF
+#line 1441 "configure"
+#include "confdefs.h"
+#include <string.h>
+main ()
+{
+  exit (strcoll ("abc", "def") >= 0 ||
+	strcoll ("ABC", "DEF") >= 0 ||
+	strcoll ("123", "456") >= 0);
+}
+EOF
+{ (eval echo configure:1451: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_func_strcoll=yes
+else
+  ac_cv_func_strcoll=no
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_func_strcoll" 1>&6
+if test $ac_cv_func_strcoll = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_STRCOLL 1
+EOF
+
+fi
+
+trap '' 1 2 15
+cat > confcache <<\EOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs.  It is not useful on other systems.
+# If it contains results you don't want to keep, you may remove or edit it.
+#
+# By default, configure uses ./config.cache as the cache file,
+# creating it if it does not exist already.  You can give configure
+# the --cache-file=FILE option to use a different cache file; that is
+# what configure does when it calls configure scripts in
+# subdirectories, so they share the cache.
+# Giving --cache-file=/dev/null disables caching, for debugging configure.
+# config.status only pays attention to the cache file if you give it the
+# --recheck option to rerun configure.
+#
+EOF
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(set) 2>&1 |
+  sed -n "s/^\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\)=\(.*\)/\1=\${\1='\2'}/p" \
+  >> confcache
+if cmp -s $cache_file confcache; then
+  :
+else
+  if test -w $cache_file; then
+    echo "updating cache $cache_file"
+    cat confcache > $cache_file
+  else
+    echo "not updating unwritable cache $cache_file"
+  fi
+fi
+rm -f confcache
+
+trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
+
+test "x$prefix" = xNONE && prefix=$ac_default_prefix
+# Let make expand exec_prefix.
+test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
+
+# Any assignment to VPATH causes Sun make to only execute
+# the first set of double-colon rules, so remove it if not needed.
+# If there is a colon in the path, we need to keep it.
+if test "x$srcdir" = x.; then
+  ac_vpsub='/^[ 	]*VPATH[ 	]*=[^:]*$/d'
+fi
+
+trap 'rm -f $CONFIG_STATUS conftest*; exit 1' 1 2 15
+
+# Transform confdefs.h into DEFS.
+# Protect against shell expansion while executing Makefile rules.
+# Protect against Makefile macro expansion.
+cat > conftest.defs <<\EOF
+s%#define \([A-Za-z_][A-Za-z0-9_]*\) *\(.*\)%-D\1=\2%g
+s%[ 	`~#$^&*(){}\\|;'"<>?]%\\&%g
+s%\[%\\&%g
+s%\]%\\&%g
+s%\$%$$%g
+EOF
+DEFS=`sed -f conftest.defs confdefs.h | tr '\012' ' '`
+rm -f conftest.defs
+
+
+# Without the "./", some shells look in PATH for config.status.
+: ${CONFIG_STATUS=./config.status}
+
+echo creating $CONFIG_STATUS
+rm -f $CONFIG_STATUS
+cat > $CONFIG_STATUS <<EOF
+#! /bin/sh
+# Generated automatically by configure.
+# Run this file to recreate the current configuration.
+# This directory was configured as follows,
+# on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
+#
+# $0 $ac_configure_args
+#
+# Compiler output produced by configure, useful for debugging
+# configure, is in ./config.log if it exists.
+
+ac_cs_usage="Usage: $CONFIG_STATUS [--recheck] [--version] [--help]"
+for ac_option
+do
+  case "\$ac_option" in
+  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
+    echo "running \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion"
+    exec \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;
+  -version | --version | --versio | --versi | --vers | --ver | --ve | --v)
+    echo "$CONFIG_STATUS generated by autoconf version 2.7"
+    exit 0 ;;
+  -help | --help | --hel | --he | --h)
+    echo "\$ac_cs_usage"; exit 0 ;;
+  *) echo "\$ac_cs_usage"; exit 1 ;;
+  esac
+done
+
+ac_given_srcdir=$srcdir
+
+trap 'rm -fr `echo "Makefile" | sed "s/:[^ ]*//g"` conftest*; exit 1' 1 2 15
+EOF
+cat >> $CONFIG_STATUS <<EOF
+
+# Protect against being on the right side of a sed subst in config.status.
+sed 's/%@/@@/; s/@%/@@/; s/%g\$/@g/; /@g\$/s/[\\\\&%]/\\\\&/g;
+ s/@@/%@/; s/@@/@%/; s/@g\$/%g/' > conftest.subs <<\\CEOF
+$ac_vpsub
+$extrasub
+s%@CFLAGS@%$CFLAGS%g
+s%@CPPFLAGS@%$CPPFLAGS%g
+s%@CXXFLAGS@%$CXXFLAGS%g
+s%@DEFS@%$DEFS%g
+s%@LDFLAGS@%$LDFLAGS%g
+s%@LIBS@%$LIBS%g
+s%@exec_prefix@%$exec_prefix%g
+s%@prefix@%$prefix%g
+s%@program_transform_name@%$program_transform_name%g
+s%@bindir@%$bindir%g
+s%@sbindir@%$sbindir%g
+s%@libexecdir@%$libexecdir%g
+s%@datadir@%$datadir%g
+s%@sysconfdir@%$sysconfdir%g
+s%@sharedstatedir@%$sharedstatedir%g
+s%@localstatedir@%$localstatedir%g
+s%@libdir@%$libdir%g
+s%@includedir@%$includedir%g
+s%@oldincludedir@%$oldincludedir%g
+s%@infodir@%$infodir%g
+s%@mandir@%$mandir%g
+s%@CC@%$CC%g
+s%@AR@%$AR%g
+s%@RANLIB@%$RANLIB%g
+s%@CPP@%$CPP%g
+s%@ALLOCA@%$ALLOCA%g
+
+CEOF
+EOF
+cat >> $CONFIG_STATUS <<EOF
+
+CONFIG_FILES=\${CONFIG_FILES-"Makefile"}
+EOF
+cat >> $CONFIG_STATUS <<\EOF
+for ac_file in .. $CONFIG_FILES; do if test "x$ac_file" != x..; then
+  # Support "outfile[:infile]", defaulting infile="outfile.in".
+  case "$ac_file" in
+  *:*) ac_file_in=`echo "$ac_file"|sed 's%.*:%%'`
+       ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
+  *) ac_file_in="${ac_file}.in" ;;
+  esac
+
+  # Adjust relative srcdir, etc. for subdirectories.
+
+  # Remove last slash and all that follows it.  Not all systems have dirname.
+  ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
+  if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
+    # The file is in a subdirectory.
+    test ! -d "$ac_dir" && mkdir "$ac_dir"
+    ac_dir_suffix="/`echo $ac_dir|sed 's%^\./%%'`"
+    # A "../" for each directory in $ac_dir_suffix.
+    ac_dots=`echo $ac_dir_suffix|sed 's%/[^/]*%../%g'`
+  else
+    ac_dir_suffix= ac_dots=
+  fi
+
+  case "$ac_given_srcdir" in
+  .)  srcdir=.
+      if test -z "$ac_dots"; then top_srcdir=.
+      else top_srcdir=`echo $ac_dots|sed 's%/$%%'`; fi ;;
+  /*) srcdir="$ac_given_srcdir$ac_dir_suffix"; top_srcdir="$ac_given_srcdir" ;;
+  *) # Relative path.
+    srcdir="$ac_dots$ac_given_srcdir$ac_dir_suffix"
+    top_srcdir="$ac_dots$ac_given_srcdir" ;;
+  esac
+
+  echo creating "$ac_file"
+  rm -f "$ac_file"
+  configure_input="Generated automatically from `echo $ac_file_in|sed 's%.*/%%'` by configure."
+  case "$ac_file" in
+  *Makefile*) ac_comsub="1i\\
+# $configure_input" ;;
+  *) ac_comsub= ;;
+  esac
+  sed -e "$ac_comsub
+s%@configure_input@%$configure_input%g
+s%@srcdir@%$srcdir%g
+s%@top_srcdir@%$top_srcdir%g
+" -f conftest.subs $ac_given_srcdir/$ac_file_in > $ac_file
+fi; done
+rm -f conftest.subs
+
+
+
+exit 0
+EOF
+chmod +x $CONFIG_STATUS
+rm -fr confdefs* $ac_clean_files
+test "$no_create" = yes || ${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS || exit 1
+
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/configure.bat libc-20030708/posix/glob/configure.bat
--- glibc-2.3.2/posix/glob/configure.bat	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/configure.bat	1995-03-09 10:19:41.000000000 +0900
@@ -0,0 +1,26 @@
+@echo off
+echo Configuring glob for GO32
+rem This batch file assumes a unix-type "sed" program
+
+echo # Makefile generated by "configure.bat"> Makefile
+
+if exist config.sed del config.sed
+
+echo "s/@srcdir@/./					">> config.sed
+echo "s/@CC@/gcc/					">> config.sed
+echo "s/@CFLAGS@/-O2 -g/				">> config.sed
+echo "s/@CPPFLAGS@/-DHAVE_CONFIG_H -I../		">> config.sed
+echo "s/@AR@/ar/					">> config.sed
+echo "s/@RANLIB@/ranlib/				">> config.sed
+echo "s/@LDFLAGS@//					">> config.sed
+echo "s/@DEFS@//					">> config.sed
+echo "s/@ALLOCA@//					">> config.sed
+echo "s/@LIBS@//					">> config.sed
+echo "s/@LIBOBJS@//					">> config.sed
+echo "s/^Makefile *:/_Makefile:/			">> config.sed
+echo "s/^config.h *:/_config.h:/			">> config.sed
+
+sed -e "s/^\"//" -e "s/\"$//" -e "s/[ 	]*$//" config.sed > config2.sed
+sed -f config2.sed Makefile.in >> Makefile
+del config.sed
+del config2.sed
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/glob/configure.in libc-20030708/posix/glob/configure.in
--- glibc-2.3.2/posix/glob/configure.in	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/glob/configure.in	1995-02-23 11:30:35.000000000 +0900
@@ -0,0 +1,19 @@
+dnl Process this file with autoconf to produce a configure script.
+AC_INIT(fnmatch.c)		dnl A distinctive file to look for in srcdir.
+AC_PREREQ(2.1)			dnl Minimum Autoconf version required.
+AC_PROG_CC
+AC_CHECK_PROG(AR, ar, ar, ar)
+AC_PROG_RANLIB
+AC_PROG_CPP			dnl Later checks need this.
+dnl These two want to come early.
+AC_AIX
+AC_MINIX
+AC_ISC_POSIX
+AC_CONST
+AC_HEADER_STDC
+AC_CHECK_HEADERS(memory.h unistd.h string.h)
+AC_HEADER_DIRENT
+AC_FUNC_CLOSEDIR_VOID
+AC_FUNC_ALLOCA
+AC_FUNC_STRCOLL
+AC_OUTPUT(Makefile)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/globtest.sh libc-20030708/posix/globtest.sh
--- glibc-2.3.2/posix/globtest.sh	2002-04-29 13:19:36.000000000 +0900
+++ libc-20030708/posix/globtest.sh	2003-06-12 08:54:03.000000000 +0900
@@ -30,6 +30,7 @@
 
 trap 'chmod 777 $testdir/noread; rm -fr $testdir $testout' 1 2 3 15
 
+test -d $testdir/noread && chmod 777 $testdir/noread
 rm -fr $testdir 2>/dev/null
 mkdir $testdir
 echo 1 > $testdir/file1
@@ -44,6 +45,7 @@
 chmod a-r $testdir/noread
 echo 1_1 > $testdir/dir1/file1_1
 echo 1_2 > $testdir/dir1/file1_2
+ln -fs dir1 $testdir/link1
 
 # Run some tests.
 result=0
@@ -61,6 +63,7 @@
 `dir2'
 `file1'
 `file2'
+`link1'
 `noread'
 `~file4'
 EOF
@@ -81,6 +84,7 @@
 `dir2'
 `file1'
 `file2'
+`link1'
 `noread'
 `~file4'
 EOF
@@ -101,6 +105,7 @@
 `dir2/'
 `file1'
 `file2'
+`link1/'
 `noread/'
 `~file4'
 EOF
@@ -124,6 +129,7 @@
 `dir2'
 `file1'
 `file2'
+`link1'
 `noread'
 `~file4'
 EOF
@@ -232,6 +238,8 @@
 cat <<"EOF" | cmp - $testout >> $logfile || failed=1
 `dir1/file1_1'
 `dir1/file1_2'
+`link1/file1_1'
+`link1/file1_2'
 EOF
 if test $failed -ne 0; then
   echo "Subdirs test failed" >> $logfile
@@ -258,6 +266,7 @@
 sort > $testout
 cat <<"EOF" | cmp - $testout >> $logfile || failed=1
 `dir1/file1_1'
+`link1/file1_1'
 EOF
 if test $failed -ne 0; then
   echo "Wildcard subdir test failed" >> $logfile
@@ -272,6 +281,8 @@
 cat <<"EOF" | cmp - $testout >> $logfile || failed=1
 `dir1/file1_1'
 `dir1/file1_2'
+`link1/file1_1'
+`link1/file1_2'
 EOF
 if test $failed -ne 0; then
   echo "Wildcard2 subdir test failed" >> $logfile
@@ -284,6 +295,7 @@
 sort > $testout
 cat <<"EOF" | cmp - $testout >> $logfile || failed=1
 `dir1/file1_1'
+`link1/file1_1'
 EOF
 if test $failed -ne 0; then
   echo "Wildcard3 subdir test failed" >> $logfile
@@ -322,6 +334,8 @@
 cat <<"EOF" | cmp - $testout >> $logfile || failed=1
 `dir1/file1_1'
 `dir1/file1_2'
+`link1/file1_1'
+`link1/file1_2'
 EOF
 if test $failed -ne 0; then
   echo "Wildcard6 subdir test failed" >> $logfile
@@ -336,6 +350,8 @@
 cat <<"EOF" | cmp - $testout >> $logfile || failed=1
 `dir1/file1_1'
 `dir1/file1_2'
+`link1/file1_1'
+`link1/file1_2'
 EOF
 if test $failed -ne 0; then
   echo "Brackets test failed" >> $logfile
@@ -544,6 +560,8 @@
 `dir1/file1_1'
 `dir1/file1_2'
 `file1'
+`link1/file1_1'
+`link1/file1_2'
 EOF
 if test $failed -ne 0; then
   echo "GLOB_APPEND test failed" >> $logfile
@@ -560,6 +578,8 @@
 `dir1/file1_1'
 `dir1/file1_2'
 `file1'
+`link1/file1_1'
+`link1/file1_2'
 EOF
 if test $failed -ne 0; then
   echo "GLOB_APPEND2 test failed" >> $logfile
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/regcomp.c libc-20030708/posix/regcomp.c
--- glibc-2.3.2/posix/regcomp.c	2003-02-21 10:17:47.000000000 +0900
+++ libc-20030708/posix/regcomp.c	2003-07-08 22:58:09.000000000 +0900
@@ -104,7 +104,8 @@
 					re_charset_t *mbcset,
 					int *equiv_class_alloc,
 					const unsigned char *name);
-static reg_errcode_t build_charclass (re_bitset_ptr_t sbcset,
+static reg_errcode_t build_charclass (RE_TRANSLATE_TYPE trans,
+				      re_bitset_ptr_t sbcset,
 				      re_charset_t *mbcset,
 				      int *char_class_alloc,
 				      const unsigned char *class_name,
@@ -112,11 +113,13 @@
 #else  /* not RE_ENABLE_I18N */
 static reg_errcode_t build_equiv_class (re_bitset_ptr_t sbcset,
 					const unsigned char *name);
-static reg_errcode_t build_charclass (re_bitset_ptr_t sbcset,
+static reg_errcode_t build_charclass (RE_TRANSLATE_TYPE trans,
+				      re_bitset_ptr_t sbcset,
 				      const unsigned char *class_name,
 				      reg_syntax_t syntax);
 #endif /* not RE_ENABLE_I18N */
-static bin_tree_t *build_word_op (re_dfa_t *dfa, int not, reg_errcode_t *err);
+static bin_tree_t *build_word_op (re_dfa_t *dfa, RE_TRANSLATE_TYPE trans,
+				  int not, reg_errcode_t *err);
 static void free_bin_tree (bin_tree_t *tree);
 static bin_tree_t *create_tree (bin_tree_t *left, bin_tree_t *right,
 				re_token_type_t type, int index);
@@ -288,6 +291,7 @@
 #endif
 
 static inline void
+__attribute ((always_inline))
 re_set_fastmap (char *fastmap, int icase, int ch)
 {
   fastmap[ch] = 1;
@@ -2073,12 +2077,12 @@
 	dfa->has_mb_node = 1;
       break;
     case OP_WORD:
-      tree = build_word_op (dfa, 0, err);
+      tree = build_word_op (dfa, regexp->trans, 0, err);
       if (BE (*err != REG_NOERROR && tree == NULL, 0))
 	return NULL;
       break;
     case OP_NOTWORD:
-      tree = build_word_op (dfa, 1, err);
+      tree = build_word_op (dfa, regexp->trans, 1, err);
       if (BE (*err != REG_NOERROR && tree == NULL, 0))
 	return NULL;
       break;
@@ -2512,6 +2516,7 @@
      Return the index of the symbol in the SYMB_TABLE.  */
 
   static inline int32_t
+  __attribute ((always_inline))
   seek_collating_symbol_entry (name, name_len)
 	 const unsigned char *name;
 	 size_t name_len;
@@ -2544,6 +2549,7 @@
      Return the value if succeeded, UINT_MAX otherwise.  */
 
   static inline unsigned int
+  __attribute ((always_inline))
   lookup_collation_sequence_value (br_elem)
 	 bracket_elem_t *br_elem;
     {
@@ -2557,12 +2563,12 @@
 	  else
 	    {
 	      wint_t wc = __btowc (br_elem->opr.ch);
-	      return collseq_table_lookup (collseqwc, wc);
+	      return __collseq_table_lookup (collseqwc, wc);
 	    }
 	}
       else if (br_elem->type == MB_CHAR)
 	{
-	  return collseq_table_lookup (collseqwc, br_elem->opr.wch);
+	  return __collseq_table_lookup (collseqwc, br_elem->opr.wch);
 	}
       else if (br_elem->type == COLL_SYM)
 	{
@@ -2611,6 +2617,7 @@
      update it.  */
 
   static inline reg_errcode_t
+  __attribute ((always_inline))
 # ifdef RE_ENABLE_I18N
   build_range_exp (sbcset, mbcset, range_alloc, start_elem, end_elem)
 	 re_charset_t *mbcset;
@@ -2683,7 +2690,7 @@
 	  if (nrules == 0)
 	    ch_collseq = collseqmb[ch];
 	  else
-	    ch_collseq = collseq_table_lookup (collseqwc, __btowc (ch));
+	    ch_collseq = __collseq_table_lookup (collseqwc, __btowc (ch));
 	  if (start_collseq <= ch_collseq && ch_collseq <= end_collseq)
 	    bitset_set (sbcset, ch);
 	}
@@ -2697,6 +2704,7 @@
      pointer argument sinse we may update it.  */
 
   static inline reg_errcode_t
+  __attribute ((always_inline))
 # ifdef RE_ENABLE_I18N
   build_collating_symbol (sbcset, mbcset, coll_sym_alloc, name)
 	 re_charset_t *mbcset;
@@ -2949,7 +2957,7 @@
 		goto parse_bracket_exp_free_return;
 	      break;
 	    case CHAR_CLASS:
-	      *err = build_charclass (sbcset,
+	      *err = build_charclass (regexp->trans, sbcset,
 #ifdef RE_ENABLE_I18N
 				      mbcset, &char_class_alloc,
 #endif /* RE_ENABLE_I18N */
@@ -3200,12 +3208,13 @@
 
 static reg_errcode_t
 #ifdef RE_ENABLE_I18N
-build_charclass (sbcset, mbcset, char_class_alloc, class_name, syntax)
+build_charclass (trans, sbcset, mbcset, char_class_alloc, class_name, syntax)
      re_charset_t *mbcset;
      int *char_class_alloc;
 #else /* not RE_ENABLE_I18N */
-build_charclass (sbcset, class_name, syntax)
+build_charclass (trans, sbcset, class_name, syntax)
 #endif /* not RE_ENABLE_I18N */
+     RE_TRANSLATE_TYPE trans;
      re_bitset_ptr_t sbcset;
      const unsigned char *class_name;
      reg_syntax_t syntax;
@@ -3235,11 +3244,14 @@
   mbcset->char_classes[mbcset->nchar_classes++] = __wctype (name);
 #endif /* RE_ENABLE_I18N */
 
-#define BUILD_CHARCLASS_LOOP(ctype_func)\
-    for (i = 0; i < SBC_MAX; ++i)	\
-      {					\
-	if (ctype_func (i))		\
-	  bitset_set (sbcset, i);	\
+#define BUILD_CHARCLASS_LOOP(ctype_func)	\
+    for (i = 0; i < SBC_MAX; ++i)		\
+      {						\
+	if (ctype_func (i))			\
+	  {					\
+	    int ch = trans ? trans[i] : i;	\
+	    bitset_set (sbcset, ch);		\
+	  }					\
       }
 
   if (strcmp (name, "alnum") == 0)
@@ -3273,8 +3285,9 @@
 }
 
 static bin_tree_t *
-build_word_op (dfa, not, err)
+build_word_op (dfa, trans, not, err)
      re_dfa_t *dfa;
+     RE_TRANSLATE_TYPE trans;
      int not;
      reg_errcode_t *err;
 {
@@ -3324,11 +3337,11 @@
     }
 
   /* We don't care the syntax in this case.  */
-  ret = build_charclass (sbcset,
+  ret = build_charclass (trans, sbcset,
 #ifdef RE_ENABLE_I18N
 			 mbcset, &alloc,
 #endif /* RE_ENABLE_I18N */
-			 (const unsigned char *) "alpha", 0);
+			 (const unsigned char *) "alnum", 0);
 
   if (BE (ret != REG_NOERROR, 0))
     {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/regex.h libc-20030708/posix/regex.h
--- glibc-2.3.2/posix/regex.h	2002-05-24 17:38:26.000000000 +0900
+++ libc-20030708/posix/regex.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,6 +1,6 @@
 /* Definitions for data structures and routines for the regular
    expression library.
-   Copyright (C) 1985,1989-93,1995-98,2000,2001,2002
+   Copyright (C) 1985,1989-93,1995-98,2000,2001,2002,2003
    Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
@@ -22,6 +22,8 @@
 #ifndef _REGEX_H
 #define _REGEX_H 1
 
+#include <sys/types.h>
+
 /* Allow the use in C++ code.  */
 #ifdef __cplusplus
 extern "C" {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/regexec.c libc-20030708/posix/regexec.c
--- glibc-2.3.2/posix/regexec.c	2003-03-01 09:13:12.000000000 +0900
+++ libc-20030708/posix/regexec.c	2003-07-08 22:58:09.000000000 +0900
@@ -50,10 +50,10 @@
 			   int ret_len);
 static unsigned re_copy_regs (struct re_registers *regs, regmatch_t *pmatch,
 			      int nregs, int regs_allocated);
-static inline re_dfastate_t *acquire_init_state_context (reg_errcode_t *err,
-							 const regex_t *preg,
-							 const re_match_context_t *mctx,
-							 int idx);
+static re_dfastate_t *acquire_init_state_context (reg_errcode_t *err,
+						  const regex_t *preg,
+						  const re_match_context_t *mctx,
+						  int idx);
 static reg_errcode_t prune_impossible_nodes (const regex_t *preg,
 					     re_match_context_t *mctx);
 static int check_matching (const regex_t *preg, re_match_context_t *mctx,
@@ -906,7 +906,7 @@
    We must select appropriate initial state depending on the context,
    since initial states may have constraints like "\<", "^", etc..  */
 
-static inline re_dfastate_t *
+static re_dfastate_t *
 acquire_init_state_context (err, preg, mctx, idx)
      reg_errcode_t *err;
      const regex_t *preg;
@@ -1507,7 +1507,7 @@
 
 /* Helper functions.  */
 
-static inline reg_errcode_t
+static reg_errcode_t
 clean_state_log_if_need (mctx, next_state_log_idx)
     re_match_context_t *mctx;
     int next_state_log_idx;
@@ -3334,12 +3334,6 @@
 	 match it the context.  */
       if (constraint)
 	{
-	  if (constraint & NEXT_WORD_CONSTRAINT)
-	    for (j = 0; j < BITSET_UINTS; ++j)
-	      accepts[j] &= dfa->word_char[j];
-	  if (constraint & NEXT_NOTWORD_CONSTRAINT)
-	    for (j = 0; j < BITSET_UINTS; ++j)
-	      accepts[j] &= ~dfa->word_char[j];
 	  if (constraint & NEXT_NEWLINE_CONSTRAINT)
 	    {
 	      int accepts_newline = bitset_contain (accepts, NEWLINE_CHAR);
@@ -3349,6 +3343,17 @@
 	      else
 		continue;
 	    }
+	  if (constraint & NEXT_ENDBUF_CONSTRAINT)
+	    {
+	      bitset_empty (accepts);
+	      continue;
+	    }
+	  if (constraint & NEXT_WORD_CONSTRAINT)
+	    for (j = 0; j < BITSET_UINTS; ++j)
+	      accepts[j] &= dfa->word_char[j];
+	  if (constraint & NEXT_NOTWORD_CONSTRAINT)
+	    for (j = 0; j < BITSET_UINTS; ++j)
+	      accepts[j] &= ~dfa->word_char[j];
 	}
 
       /* Then divide `accepts' into DFA states, or create a new
@@ -3523,7 +3528,7 @@
 	      if (elem_len <= char_len)
 		{
 		  collseqwc = _NL_CURRENT (LC_COLLATE, _NL_COLLATE_COLLSEQWC);
-		  in_collseq = collseq_table_lookup (collseqwc, wc);
+		  in_collseq = __collseq_table_lookup (collseqwc, wc);
 		}
 	      else
 		in_collseq = find_collation_sequence_value (pin, elem_len);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/sched.h libc-20030708/posix/sched.h
--- glibc-2.3.2/posix/sched.h	2003-02-07 04:11:56.000000000 +0900
+++ libc-20030708/posix/sched.h	2003-05-12 01:30:10.000000000 +0900
@@ -64,13 +64,20 @@
 
 
 #ifdef __USE_GNU
+/* Access macros for `cpu_set'.  */
+#define CPU_SETSIZE __CPU_SETSIZE
+#define CPU_SET(cpu, cpusetp)	__CPU_SET (cpu, cpusetp)
+#define CPU_CLR(cpu, cpusetp)	__CPU_CLR (cpu, cpusetp)
+#define CPU_ISSET(cpu, cpusetp)	__CPU_ISSET (cpu, cpusetp)
+#define CPU_ZERO(cpusetp)	__CPU_ZERO (cpusetp)
+
+
 /* Set the CPU affinity for a task */
-extern int sched_setaffinity (__pid_t __pid, unsigned int __len,
-			      unsigned long int *__mask) __THROW;
+extern int sched_setaffinity (__pid_t __pid, __const cpu_set_t *__mask)
+     __THROW;
 
 /* Get the CPU affinity for a task */
-extern int sched_getaffinity (__pid_t __pid, unsigned int __len,
-			      unsigned long int *__mask) __THROW;
+extern int sched_getaffinity (__pid_t __pid, cpu_set_t *__mask) __THROW;
 #endif
 
 __END_DECLS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/spawn.h libc-20030708/posix/spawn.h
--- glibc-2.3.2/posix/spawn.h	2001-07-08 04:21:16.000000000 +0900
+++ libc-20030708/posix/spawn.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX spawn interface.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -62,20 +62,26 @@
 __BEGIN_DECLS
 
 /* Spawn a new process executing PATH with the attributes describes in *ATTRP.
-   Before running the process perform the actions described in FILE-ACTIONS. */
+   Before running the process perform the actions described in FILE-ACTIONS.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW. */
 extern int posix_spawn (pid_t *__restrict __pid,
 			__const char *__restrict __path,
 			__const posix_spawn_file_actions_t *__restrict
 			__file_actions,
 			__const posix_spawnattr_t *__restrict __attrp,
 			char *__const argv[__restrict_arr],
-			char *__const envp[__restrict_arr]) __THROW;
+			char *__const envp[__restrict_arr]);
+
+/* Similar to `posix_spawn' but search for FILE in the PATH.
 
-/* Similar to `posix_spawn' but search for FILE in the PATH.  */
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
 extern int posix_spawnp (pid_t *__pid, __const char *__file,
 			 __const posix_spawn_file_actions_t *__file_actions,
 			 __const posix_spawnattr_t *__attrp,
-			 char *__const argv[], char *__const envp[]) __THROW;
+			 char *__const argv[], char *__const envp[]);
 
 
 /* Initialize data structure with attributes for `spawn' to default values.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/sys/wait.h libc-20030708/posix/sys/wait.h
--- glibc-2.3.2/posix/sys/wait.h	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/posix/sys/wait.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1994,96,97,98,99,2000,2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1994,1996-2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -105,8 +105,11 @@
 
 
 /* Wait for a child to die.  When one does, put its status in *STAT_LOC
-   and return its process ID.  For errors, return (pid_t) -1.  */
-extern __pid_t wait (__WAIT_STATUS __stat_loc) __THROW;
+   and return its process ID.  For errors, return (pid_t) -1.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern __pid_t wait (__WAIT_STATUS __stat_loc);
 
 #ifdef	__USE_BSD
 /* Special values for the PID argument to `waitpid' and `wait4'.  */
@@ -125,8 +128,11 @@
    is not already dead, return (pid_t) 0.  If successful,
    return PID and store the dead child's status in STAT_LOC.
    Return (pid_t) -1 for errors.  If the WUNTRACED bit is
-   set in OPTIONS, return status for stopped children; otherwise don't.  */
-extern __pid_t waitpid (__pid_t __pid, int *__stat_loc, int __options) __THROW;
+   set in OPTIONS, return status for stopped children; otherwise don't.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern __pid_t waitpid (__pid_t __pid, int *__stat_loc, int __options);
 
 #if defined __USE_SVID || defined __USE_XOPEN
 # define __need_siginfo_t
@@ -138,9 +144,12 @@
    If IDTYPE is P_ALL, match any process.
    If the WNOHANG bit is set in OPTIONS, and that child
    is not already dead, clear *INFOP and return 0.  If successful, store
-   exit code and status in *INFOP.  */
+   exit code and status in *INFOP.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int waitid (idtype_t __idtype, __id_t __id, siginfo_t *__infop,
-		   int __options) __THROW;
+		   int __options);
 #endif
 
 #if defined __USE_BSD || defined __USE_XOPEN_EXTENDED
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/transbug.c libc-20030708/posix/transbug.c
--- glibc-2.3.2/posix/transbug.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/transbug.c	2003-06-25 20:04:48.000000000 +0900
@@ -0,0 +1,142 @@
+#include <stdio.h>
+#include <ctype.h>
+#include <errno.h>
+#include <locale.h>
+#include <regex.h>
+#include <stdlib.h>
+#include <unistd.h>
+#include <string.h>
+
+/* lowercase chars mapped to uppercase */
+static const char casetable[] = {
+  '\000', '\001', '\002', '\003', '\004', '\005', '\006', '\007',
+  '\010', '\011', '\012', '\013', '\014', '\015', '\016', '\017',
+  '\020', '\021', '\022', '\023', '\024', '\025', '\026', '\027',
+  '\030', '\031', '\032', '\033', '\034', '\035', '\036', '\037',
+  /* ' '     '!'     '"'     '#'     '$'     '%'     '&'     ''' */
+  '\040', '\041', '\042', '\043', '\044', '\045', '\046', '\047',
+  /* '('     ')'     '*'     '+'     ','     '-'     '.'     '/' */
+  '\050', '\051', '\052', '\053', '\054', '\055', '\056', '\057',
+  /* '0'     '1'     '2'     '3'     '4'     '5'     '6'     '7' */
+  '\060', '\061', '\062', '\063', '\064', '\065', '\066', '\067',
+  /* '8'     '9'     ':'     ';'     '<'     '='     '>'     '?' */
+  '\070', '\071', '\072', '\073', '\074', '\075', '\076', '\077',
+  /* '@'     'A'     'B'     'C'     'D'     'E'     'F'     'G' */
+  '\100', '\141', '\142', '\143', '\144', '\145', '\146', '\147',
+  /* 'H'     'I'     'J'     'K'     'L'     'M'     'N'     'O' */
+  '\150', '\151', '\152', '\153', '\154', '\155', '\156', '\157',
+  /* 'P'     'Q'     'R'     'S'     'T'     'U'     'V'     'W' */
+  '\160', '\161', '\162', '\163', '\164', '\165', '\166', '\167',
+  /* 'X'     'Y'     'Z'     '['     '\'     ']'     '^'     '_' */
+  '\170', '\171', '\172', '\133', '\134', '\135', '\136', '\137',
+  /* '`'     'a'     'b'     'c'     'd'     'e'     'f'     'g' */
+  '\140', '\141', '\142', '\143', '\144', '\145', '\146', '\147',
+  /* 'h'     'i'     'j'     'k'     'l'     'm'     'n'     'o' */
+  '\150', '\151', '\152', '\153', '\154', '\155', '\156', '\157',
+  /* 'p'     'q'     'r'     's'     't'     'u'     'v'     'w' */
+  '\160', '\161', '\162', '\163', '\164', '\165', '\166', '\167',
+  /* 'x'     'y'     'z'     '{'     '|'     '}'     '~' */
+  '\170', '\171', '\172', '\173', '\174', '\175', '\176', '\177',
+
+  /* Latin 1: */
+  '\200', '\201', '\202', '\203', '\204', '\205', '\206', '\207',
+  '\210', '\211', '\212', '\213', '\214', '\215', '\216', '\217',
+  '\220', '\221', '\222', '\223', '\224', '\225', '\226', '\227',
+  '\230', '\231', '\232', '\233', '\234', '\235', '\236', '\237',
+  '\240', '\241', '\242', '\243', '\244', '\245', '\246', '\247',
+  '\250', '\251', '\252', '\253', '\254', '\255', '\256', '\257',
+  '\260', '\261', '\262', '\263', '\264', '\265', '\266', '\267',
+  '\270', '\271', '\272', '\273', '\274', '\275', '\276', '\277',
+  '\340', '\341', '\342', '\343', '\344', '\345', '\346', '\347',
+  '\350', '\351', '\352', '\353', '\354', '\355', '\356', '\357',
+  '\360', '\361', '\362', '\363', '\364', '\365', '\366', '\327',
+  '\370', '\371', '\372', '\373', '\374', '\375', '\376', '\337',
+  '\340', '\341', '\342', '\343', '\344', '\345', '\346', '\347',
+  '\350', '\351', '\352', '\353', '\354', '\355', '\356', '\357',
+  '\360', '\361', '\362', '\363', '\364', '\365', '\366', '\367',
+  '\370', '\371', '\372', '\373', '\374', '\375', '\376', '\377',
+};
+
+
+static int
+run_test (const char *pattern, struct re_registers *regs)
+{
+  static char text[] = "1111AAAA2222bbbb";
+
+  struct re_pattern_buffer pat;
+
+  const char *err;
+  int res;
+  int start2;
+
+  memset (&pat, '\0', sizeof (pat));
+  memset (regs, '\0', 2 * sizeof (regs[0]));
+  pat.allocated = 0;		/* regex will allocate the buffer */
+  pat.fastmap = (char *) malloc (256);
+  if (pat.fastmap == NULL)
+    {
+      puts ("out of memory");
+      exit (1);
+    }
+
+  pat.translate = (char *) casetable;
+
+  err = re_compile_pattern (pattern, strlen (pattern), &pat);
+  if (err != NULL)
+    {
+      fprintf (stderr, "/%s/: %s\n", pattern, err);
+      exit (1);
+    }
+  res = re_search (&pat, text, strlen (text), 0, strlen (text), &regs[0]);
+  if (res < 0)
+    printf ("search 1: res = %d\n", res);
+  else
+    printf ("search 1: res = %d, start = %d, end = %d\n",
+	    res, regs[0].start[0], regs[0].end[0]);
+
+  if (regs[0].end == NULL)
+    start2 = 8;
+  else
+    start2 = regs[0].end[0] + 1;
+  regs[1] = regs[0];
+  res = re_search (&pat, text, strlen (text), start2, strlen (text), &regs[1]);
+  if (res < 0)
+    printf ("search 2: res = %d\n", res);
+  else
+    printf ("search 2: res = %d, start = %d, end = %d\n",
+	    res, regs[1].start[0], regs[1].end[0]);
+
+  return res < 0 ? 1 : 0;
+}
+
+
+static int
+do_test (void)
+{
+  static const char lower[] = "[[:lower:]]+";
+  static const char upper[] = "[[:upper:]]+";
+  struct re_registers regs[4];
+
+  setlocale (LC_ALL, "C");
+
+  (void) re_set_syntax (RE_SYNTAX_GNU_AWK);
+
+  int result;
+#define CHECK(exp) \
+  if (exp) { puts (#exp); result = 1; }
+
+  result = run_test (lower, regs);
+  result |= run_test (upper, &regs[2]);
+  if (! result)
+    {
+      CHECK (regs[0].start[0] != regs[2].start[0]);
+      CHECK (regs[0].end[0] != regs[2].end[0]);
+      CHECK (regs[1].start[0] != regs[3].start[0]);
+      CHECK (regs[1].end[0] != regs[3].end[0]);
+    }
+
+  return result;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/tst-nanosleep.c libc-20030708/posix/tst-nanosleep.c
--- glibc-2.3.2/posix/tst-nanosleep.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/tst-nanosleep.c	2003-07-08 22:58:09.000000000 +0900
@@ -0,0 +1,58 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <stdio.h>
+#include <unistd.h>
+#include <sys/time.h>
+#include <time.h>
+
+
+/* Test that nanosleep() does sleep.  */
+static int
+do_test (void)
+{
+  /* Current time.  */
+  struct timeval tv1;
+  (void) gettimeofday (&tv1, NULL);
+
+  struct timespec ts;
+  ts.tv_sec = 1;
+  ts.tv_nsec = 0;
+  TEMP_FAILURE_RETRY (nanosleep (&ts, &ts));
+
+  /* At least one second must have passed.  */
+  struct timeval tv2;
+  (void) gettimeofday (&tv2, NULL);
+
+  tv2.tv_sec -= tv1.tv_sec;
+  tv2.tv_usec -= tv1.tv_usec;
+  if (tv2.tv_usec < 0)
+    --tv2.tv_sec;
+
+  if (tv2.tv_sec < 1)
+    {
+      puts ("nanosleep didn't sleep long enough");
+      return 1;
+    }
+
+  return 0;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/tst-nice.c libc-20030708/posix/tst-nice.c
--- glibc-2.3.2/posix/tst-nice.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/posix/tst-nice.c	2003-03-20 20:40:36.000000000 +0900
@@ -0,0 +1,66 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <stdio.h>
+#include <unistd.h>
+
+
+/* Test that nice() does not incorrectly return 0.  */
+static int
+do_test (void)
+{
+  int ret;
+  const int incr = 10;
+  int old;
+
+  /* Discover current nice value.  */
+  errno = 0;
+  old = nice (0);
+  if (old == -1 && errno != 0)
+    {
+      printf ("break: nice(%d) return: %d, %m\n", 0, old);
+      return 1;
+    }
+
+  /* Nice ourselves up.  */
+  errno = 0;
+  ret = nice (incr);
+  if (ret == -1 && errno != 0)
+    {
+      printf ("break: nice(%d) return: %d, %m\n", incr, ret);
+      return 1;
+    }
+
+  /* Check for return value being zero when it shouldn't.  Cannot simply
+     check for expected value since nice values are capped at 2^n-1.
+     But we assume that we didn't start at the cap and so should have
+     increased some.  */
+  if (ret <= old)
+    {
+      printf ("FAIL: retval (%d) of nice(%d) != %d\n", ret, incr, old + incr);
+      return 1;
+    }
+
+  printf ("PASS: nice(%d) from %d return: %d\n", incr, old, ret);
+
+  return 0;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/posix/unistd.h libc-20030708/posix/unistd.h
--- glibc-2.3.2/posix/unistd.h	2002-10-14 13:03:29.000000000 +0900
+++ libc-20030708/posix/unistd.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -30,34 +30,30 @@
 /* These may be used to determine what facilities are present at compile time.
    Their values can be obtained at run time from `sysconf'.  */
 
-/* POSIX Standard approved as ISO/IEC 9945-1 as of August, 1988 and
-   extended by POSIX-1b (aka POSIX-4) and POSIX-1c (aka POSIX threads).  */
-#define	_POSIX_VERSION	199506L
+/* POSIX Standard approved as ISO/IEC 9945-1 as of December 2001.  */
+#define	_POSIX_VERSION	200112L
 
 /* These are not #ifdef __USE_POSIX2 because they are
    in the theoretically application-owned namespace.  */
 
-/* POSIX Standard approved as ISO/IEC 9945-2 as of December, 1993.  */
-#define	_POSIX2_C_VERSION	199209L
-
 /* The utilities on GNU systems also correspond to this version.  */
-#define _POSIX2_VERSION	199209L
+#define _POSIX2_VERSION	200112L
 
 /* If defined, the implementation supports the
    C Language Bindings Option.  */
-#define	_POSIX2_C_BIND	1
+#define	_POSIX2_C_BIND	200112L
 
 /* If defined, the implementation supports the
    C Language Development Utilities Option.  */
-#define	_POSIX2_C_DEV	1
+#define	_POSIX2_C_DEV	200112L
 
 /* If defined, the implementation supports the
    Software Development Utilities Option.  */
-#define	_POSIX2_SW_DEV	1
+#define	_POSIX2_SW_DEV	200112L
 
 /* If defined, the implementation supports the
    creation of locales with the localedef utility.  */
-#define _POSIX2_LOCALEDEF       1
+#define _POSIX2_LOCALEDEF       200112L
 
 /* X/Open version number to which the library conforms.  It is selectable.  */
 #ifdef __USE_UNIX98
@@ -302,31 +298,51 @@
 extern __off64_t lseek64 (int __fd, __off64_t __offset, int __whence) __THROW;
 #endif
 
-/* Close the file descriptor FD.  */
-extern int close (int __fd) __THROW;
+/* Close the file descriptor FD.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int close (int __fd);
 
 /* Read NBYTES into BUF from FD.  Return the
-   number read, -1 for errors or 0 for EOF.  */
-extern ssize_t read (int __fd, void *__buf, size_t __nbytes) __THROW;
+   number read, -1 for errors or 0 for EOF.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t read (int __fd, void *__buf, size_t __nbytes);
 
-/* Write N bytes of BUF to FD.  Return the number written, or -1.  */
-extern ssize_t write (int __fd, __const void *__buf, size_t __n) __THROW;
+/* Write N bytes of BUF to FD.  Return the number written, or -1.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t write (int __fd, __const void *__buf, size_t __n);
 
 #ifdef __USE_UNIX98
 # ifndef __USE_FILE_OFFSET64
-extern ssize_t pread (int __fd, void *__buf, size_t __nbytes, __off_t __offset)
-     __THROW;
+/* Read NBYTES into BUF from FD at the given position OFFSET without
+   changing the file pointer.  Return the number read, -1 for errors
+   or 0 for EOF.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t pread (int __fd, void *__buf, size_t __nbytes,
+		      __off_t __offset);
+
+/* Write N bytes of BUF to FD at the given position OFFSET without
+   changing the file pointer.  Return the number written, or -1.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern ssize_t pwrite (int __fd, __const void *__buf, size_t __n,
-		       __off_t __offset) __THROW;
+		       __off_t __offset);
 # else
 #  ifdef __REDIRECT
 extern ssize_t __REDIRECT (pread, (int __fd, void *__buf, size_t __nbytes,
-				   __off64_t __offset) __THROW,
+				   __off64_t __offset),
 			   pread64);
 extern ssize_t __REDIRECT (pwrite, (int __fd, __const void *__buf,
-				    size_t __nbytes, __off64_t __offset)
-			   __THROW,
-			pwrite64);
+				    size_t __nbytes, __off64_t __offset),
+			   pwrite64);
 #  else
 #   define pread pread64
 #   define pwrite pwrite64
@@ -338,11 +354,11 @@
    changing the file pointer.  Return the number read, -1 for errors
    or 0 for EOF.  */
 extern ssize_t pread64 (int __fd, void *__buf, size_t __nbytes,
-			__off64_t __offset) __THROW;
+			__off64_t __offset);
 /* Write N bytes of BUF to FD at the given position OFFSET without
    changing the file pointer.  Return the number written, or -1.  */
 extern ssize_t pwrite64 (int __fd, __const void *__buf, size_t __n,
-			 __off64_t __offset) __THROW;
+			 __off64_t __offset);
 # endif
 #endif
 
@@ -367,8 +383,11 @@
    If a signal handler does a `longjmp' or modifies the handling of the
    SIGALRM signal while inside `sleep' call, the handling of the SIGALRM
    signal afterwards is undefined.  There is no return value to indicate
-   error, but if `sleep' returns SECONDS, it probably didn't work.  */
-extern unsigned int sleep (unsigned int __seconds) __THROW;
+   error, but if `sleep' returns SECONDS, it probably didn't work.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern unsigned int sleep (unsigned int __seconds);
 
 #if defined __USE_BSD || defined __USE_XOPEN_EXTENDED
 /* Set an alarm to go off (generating a SIGALRM signal) in VALUE
@@ -379,14 +398,20 @@
      __THROW;
 
 /* Sleep USECONDS microseconds, or until a signal arrives that is not blocked
-   or ignored.  */
-extern int usleep (__useconds_t __useconds) __THROW;
+   or ignored.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int usleep (__useconds_t __useconds);
 #endif
 
 
 /* Suspend the process until a signal arrives.
-   This always returns -1 and sets `errno' to EINTR.  */
-extern int pause (void) __THROW;
+   This always returns -1 and sets `errno' to EINTR.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int pause (void);
 
 
 /* Change the owner and group of FILE.  */
@@ -674,12 +699,18 @@
 
 
 /* Return the pathname of the terminal FD is open on, or NULL on errors.
-   The returned storage is good only until the next call to this function.  */
-extern char *ttyname (int __fd) __THROW;
+   The returned storage is good only until the next call to this function.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern char *ttyname (int __fd);
 
 /* Store at most BUFLEN characters of the pathname of the terminal FD is
-   open on in BUF.  Return 0 on success, otherwise an error number.  */
-extern int ttyname_r (int __fd, char *__buf, size_t __buflen) __THROW;
+   open on in BUF.  Return 0 on success, otherwise an error number.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int ttyname_r (int __fd, char *__buf, size_t __buflen);
 
 /* Return 1 if FD is a valid descriptor associated
    with a terminal, zero if not.  */
@@ -721,13 +752,19 @@
 extern int tcsetpgrp (int __fd, __pid_t __pgrp_id) __THROW;
 
 
-/* Return the login name of the user.  */
-extern char *getlogin (void) __THROW;
+/* Return the login name of the user.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern char *getlogin (void);
 #if defined __USE_REENTRANT || defined __USE_UNIX98
 /* Return at most NAME_LEN characters of the login name of the user in NAME.
    If it cannot be determined or some other error occurred, return the error
-   code.  Otherwise return 0.  */
-extern int getlogin_r (char *__name, size_t __name_len) __THROW;
+   code.  Otherwise return 0.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern int getlogin_r (char *__name, size_t __name_len);
 #endif
 
 #ifdef	__USE_BSD
@@ -819,8 +856,11 @@
 
 
 #if defined __USE_BSD || defined __USE_XOPEN
-/* Make all changes done to FD actually appear on disk.  */
-extern int fsync (int __fd) __THROW;
+/* Make all changes done to FD actually appear on disk.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int fsync (int __fd);
 #endif /* Use BSD || X/Open.  */
 
 
@@ -914,7 +954,10 @@
 
 /* `lockf' is a simpler interface to the locking facilities of `fcntl'.
    LEN is always relative to the current file position.
-   The CMD argument is one of the following.  */
+   The CMD argument is one of the following.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 
 # define F_ULOCK 0	/* Unlock a previously locked region.  */
 # define F_LOCK  1	/* Lock a region for exclusive use.  */
@@ -922,17 +965,17 @@
 # define F_TEST  3	/* Test a region for other processes locks.  */
 
 # ifndef __USE_FILE_OFFSET64
-extern int lockf (int __fd, int __cmd, __off_t __len) __THROW;
+extern int lockf (int __fd, int __cmd, __off_t __len);
 # else
 #  ifdef __REDIRECT
-extern int __REDIRECT (lockf, (int __fd, int __cmd, __off64_t __len) __THROW,
+extern int __REDIRECT (lockf, (int __fd, int __cmd, __off64_t __len),
 		       lockf64);
 #  else
 #   define lockf lockf64
 #  endif
 # endif
 # ifdef __USE_LARGEFILE64
-extern int lockf64 (int __fd, int __cmd, __off64_t __len) __THROW;
+extern int lockf64 (int __fd, int __cmd, __off64_t __len);
 # endif
 #endif /* Use misc and F_LOCK not already defined.  */
 
@@ -984,25 +1027,6 @@
 extern char *ctermid (char *__s) __THROW;
 #endif
 
-
-#ifdef __USE_POSIX199309
-/* This function is only available if the system has POSIX threads.  */
-
-/* Install handlers to be called when a new process is created with FORK.
-   The PREPARE handler is called in the parent process just before performing
-   FORK. The PARENT handler is called in the parent process just after FORK.
-   The CHILD handler is called in the child process.  Each of the three
-   handlers can be NULL, meaning that no handler needs to be called at that
-   point.
-   PTHREAD_ATFORK can be called several times, in which case the PREPARE
-   handlers are called in LIFO order (last added with PTHREAD_ATFORK,
-   first called before FORK), and the PARENT and CHILD handlers are called
-   in FIFO (first added, first called). */
-extern int pthread_atfork (void (*__prepare) (void),
-			   void (*__parent) (void),
-			   void (*__child) (void)) __THROW;
-#endif
-
 __END_DECLS
 
 #endif /* unistd.h  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/pwd/pwd.h libc-20030708/pwd/pwd.h
--- glibc-2.3.2/pwd/pwd.h	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/pwd/pwd.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,92,95,96,97,98,99,2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1992,1995-2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -66,30 +66,55 @@
 
 
 #if defined __USE_SVID || defined __USE_MISC || defined __USE_XOPEN_EXTENDED
-/* Rewind the password-file stream.  */
-extern void setpwent (void) __THROW;
+/* Rewind the password-file stream.
 
-/* Close the password-file stream.  */
-extern void endpwent (void) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void setpwent (void);
 
-/* Read an entry from the password-file stream, opening it if necessary.  */
-extern struct passwd *getpwent (void) __THROW;
+/* Close the password-file stream.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void endpwent (void);
+
+/* Read an entry from the password-file stream, opening it if necessary.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct passwd *getpwent (void);
 #endif
 
 #ifdef	__USE_SVID
-/* Read an entry from STREAM.  */
-extern struct passwd *fgetpwent (FILE *__stream) __THROW;
+/* Read an entry from STREAM.
 
-/* Write the given entry onto the given stream.  */
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern struct passwd *fgetpwent (FILE *__stream);
+
+/* Write the given entry onto the given stream.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int putpwent (__const struct passwd *__restrict __p,
-		     FILE *__restrict __f) __THROW;
+		     FILE *__restrict __f);
 #endif
 
-/* Search for an entry with a matching user ID.  */
-extern struct passwd *getpwuid (__uid_t __uid) __THROW;
+/* Search for an entry with a matching user ID.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct passwd *getpwuid (__uid_t __uid);
 
-/* Search for an entry with a matching username.  */
-extern struct passwd *getpwnam (__const char *__name) __THROW;
+/* Search for an entry with a matching username.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct passwd *getpwnam (__const char *__name);
 
 #if defined __USE_POSIX || defined __USE_MISC
 
@@ -108,29 +133,38 @@
    POSIX people would choose.  */
 
 # if defined __USE_SVID || defined __USE_MISC
+/* This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int getpwent_r (struct passwd *__restrict __resultbuf,
 		       char *__restrict __buffer, size_t __buflen,
-		       struct passwd **__restrict __result) __THROW;
+		       struct passwd **__restrict __result);
 # endif
 
 extern int getpwuid_r (__uid_t __uid,
 		       struct passwd *__restrict __resultbuf,
 		       char *__restrict __buffer, size_t __buflen,
-		       struct passwd **__restrict __result) __THROW;
+		       struct passwd **__restrict __result);
 
 extern int getpwnam_r (__const char *__restrict __name,
 		       struct passwd *__restrict __resultbuf,
 		       char *__restrict __buffer, size_t __buflen,
-		       struct passwd **__restrict __result) __THROW;
+		       struct passwd **__restrict __result);
 
 
 # ifdef	__USE_SVID
 /* Read an entry from STREAM.  This function is not standardized and
-   probably never will.  */
+   probably never will.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int fgetpwent_r (FILE *__restrict __stream,
 			struct passwd *__restrict __resultbuf,
 			char *__restrict __buffer, size_t __buflen,
-			struct passwd **__restrict __result) __THROW;
+			struct passwd **__restrict __result);
 # endif
 
 #endif	/* POSIX or reentrant */
@@ -138,8 +172,13 @@
 #ifdef __USE_GNU
 /* Re-construct the password-file line for the given uid
    in the given buffer.  This knows the format that the caller
-   will expect, but this need not be the format of the password file.  */
-extern int getpw (__uid_t __uid, char *__buffer) __THROW;
+   will expect, but this need not be the format of the password file.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int getpw (__uid_t __uid, char *__buffer);
 #endif
 
 __END_DECLS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/resolv/Makefile libc-20030708/resolv/Makefile
--- glibc-2.3.2/resolv/Makefile	2003-02-26 08:40:08.000000000 +0900
+++ libc-20030708/resolv/Makefile	2003-05-10 13:38:04.000000000 +0900
@@ -34,6 +34,8 @@
 
 tests = tst-aton tst-leaks
 
+generate := mtrace-tst-leaks tst-leaks.mtrace
+
 include ../Makeconfig
 
 extra-libs := libresolv libnss_dns
@@ -93,6 +95,8 @@
 tst-leaks-ENV = MALLOC_TRACE=$(objpfx)tst-leaks.mtrace
 $(objpfx)mtrace-tst-leaks: $(objpfx)tst-leaks.out
 	$(common-objpfx)malloc/mtrace $(objpfx)tst-leaks.mtrace > $@
+ifeq (no,$(cross-compiling))
 ifneq (no,$(PERL))
 tests: $(objpfx)mtrace-tst-leaks
 endif
+endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/resolv/netdb.h libc-20030708/resolv/netdb.h
--- glibc-2.3.2/resolv/netdb.h	2002-08-10 11:52:19.000000000 +0900
+++ libc-20030708/resolv/netdb.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,97,98,99,2000,01,02 Free Software Foundation, Inc.
+  /* Copyright (C) 1996-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -104,102 +104,146 @@
 };
 
 /* Open host data base files and mark them as staying open even after
-   a later search if STAY_OPEN is non-zero.  */
-extern void sethostent (int __stay_open) __THROW;
+   a later search if STAY_OPEN is non-zero.
 
-/* Close host data base files and clear `stay open' flag.  */
-extern void endhostent (void) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void sethostent (int __stay_open);
+
+/* Close host data base files and clear `stay open' flag.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void endhostent (void);
 
 /* Get next entry from host data base file.  Open data base if
-   necessary.  */
-extern struct hostent *gethostent (void) __THROW;
+   necessary.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct hostent *gethostent (void);
 
 /* Return entry from host data base which address match ADDR with
-   length LEN and type TYPE.  */
+   length LEN and type TYPE.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern struct hostent *gethostbyaddr (__const void *__addr, __socklen_t __len,
-				      int __type) __THROW;
+				      int __type);
 
-/* Return entry from host data base for host with NAME.  */
-extern struct hostent *gethostbyname (__const char *__name) __THROW;
+/* Return entry from host data base for host with NAME.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct hostent *gethostbyname (__const char *__name);
 
 #ifdef __USE_MISC
 /* Return entry from host data base for host with NAME.  AF must be
    set to the address type which is `AF_INET' for IPv4 or `AF_INET6'
-   for IPv6.  */
-extern struct hostent *gethostbyname2 (__const char *__name, int __af) __THROW;
+   for IPv6.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern struct hostent *gethostbyname2 (__const char *__name, int __af);
 
 /* Reentrant versions of the functions above.  The additional
    arguments specify a buffer of BUFLEN starting at BUF.  The last
    argument is a pointer to a variable which gets the value which
    would be stored in the global variable `herrno' by the
-   non-reentrant functions.  */
+   non-reentrant functions.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern int gethostent_r (struct hostent *__restrict __result_buf,
 			 char *__restrict __buf, size_t __buflen,
 			 struct hostent **__restrict __result,
-			 int *__restrict __h_errnop) __THROW;
+			 int *__restrict __h_errnop);
 
 extern int gethostbyaddr_r (__const void *__restrict __addr, __socklen_t __len,
 			    int __type,
 			    struct hostent *__restrict __result_buf,
 			    char *__restrict __buf, size_t __buflen,
 			    struct hostent **__restrict __result,
-			    int *__restrict __h_errnop) __THROW;
+			    int *__restrict __h_errnop);
 
 extern int gethostbyname_r (__const char *__restrict __name,
 			    struct hostent *__restrict __result_buf,
 			    char *__restrict __buf, size_t __buflen,
 			    struct hostent **__restrict __result,
-			    int *__restrict __h_errnop) __THROW;
+			    int *__restrict __h_errnop);
 
 extern int gethostbyname2_r (__const char *__restrict __name, int __af,
 			     struct hostent *__restrict __result_buf,
 			     char *__restrict __buf, size_t __buflen,
 			     struct hostent **__restrict __result,
-			     int *__restrict __h_errnop) __THROW;
+			     int *__restrict __h_errnop);
 #endif	/* misc */
 
 
 /* Open network data base files and mark them as staying open even
-   after a later search if STAY_OPEN is non-zero.  */
-extern void setnetent (int __stay_open) __THROW;
+   after a later search if STAY_OPEN is non-zero.
 
-/* Close network data base files and clear `stay open' flag.  */
-extern void endnetent (void) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void setnetent (int __stay_open);
+
+/* Close network data base files and clear `stay open' flag.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void endnetent (void);
 
 /* Get next entry from network data base file.  Open data base if
-   necessary.  */
-extern struct netent *getnetent (void) __THROW;
+   necessary.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct netent *getnetent (void);
 
 /* Return entry from network data base which address match NET and
-   type TYPE.  */
-extern struct netent *getnetbyaddr (uint32_t __net, int __type)
-     __THROW;
+   type TYPE.
 
-/* Return entry from network data base for network with NAME.  */
-extern struct netent *getnetbyname (__const char *__name) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct netent *getnetbyaddr (uint32_t __net, int __type);
+
+/* Return entry from network data base for network with NAME.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct netent *getnetbyname (__const char *__name);
 
 #ifdef	__USE_MISC
 /* Reentrant versions of the functions above.  The additional
    arguments specify a buffer of BUFLEN starting at BUF.  The last
    argument is a pointer to a variable which gets the value which
    would be stored in the global variable `herrno' by the
-   non-reentrant functions.  */
+   non-reentrant functions.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern int getnetent_r (struct netent *__restrict __result_buf,
 			char *__restrict __buf, size_t __buflen,
 			struct netent **__restrict __result,
-			int *__restrict __h_errnop) __THROW;
+			int *__restrict __h_errnop);
 
 extern int getnetbyaddr_r (uint32_t __net, int __type,
 			   struct netent *__restrict __result_buf,
 			   char *__restrict __buf, size_t __buflen,
 			   struct netent **__restrict __result,
-			   int *__restrict __h_errnop) __THROW;
+			   int *__restrict __h_errnop);
 
 extern int getnetbyname_r (__const char *__restrict __name,
 			   struct netent *__restrict __result_buf,
 			   char *__restrict __buf, size_t __buflen,
 			   struct netent **__restrict __result,
-			   int *__restrict __h_errnop) __THROW;
+			   int *__restrict __h_errnop);
 #endif	/* misc */
 
 
@@ -213,44 +257,63 @@
 };
 
 /* Open service data base files and mark them as staying open even
-   after a later search if STAY_OPEN is non-zero.  */
-extern void setservent (int __stay_open) __THROW;
+   after a later search if STAY_OPEN is non-zero.
 
-/* Close service data base files and clear `stay open' flag.  */
-extern void endservent (void) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void setservent (int __stay_open);
+
+/* Close service data base files and clear `stay open' flag.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void endservent (void);
 
 /* Get next entry from service data base file.  Open data base if
-   necessary.  */
-extern struct servent *getservent (void) __THROW;
+   necessary.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct servent *getservent (void);
 
 /* Return entry from network data base for network with NAME and
-   protocol PROTO.  */
+   protocol PROTO.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern struct servent *getservbyname (__const char *__name,
-				      __const char *__proto) __THROW;
+				      __const char *__proto);
 
 /* Return entry from service data base which matches port PORT and
-   protocol PROTO.  */
-extern struct servent *getservbyport (int __port, __const char *__proto)
-     __THROW;
+   protocol PROTO.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct servent *getservbyport (int __port, __const char *__proto);
 
 
 #ifdef	__USE_MISC
 /* Reentrant versions of the functions above.  The additional
-   arguments specify a buffer of BUFLEN starting at BUF.  */
+   arguments specify a buffer of BUFLEN starting at BUF.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern int getservent_r (struct servent *__restrict __result_buf,
 			 char *__restrict __buf, size_t __buflen,
-			 struct servent **__restrict __result) __THROW;
+			 struct servent **__restrict __result);
 
 extern int getservbyname_r (__const char *__restrict __name,
 			    __const char *__restrict __proto,
 			    struct servent *__restrict __result_buf,
 			    char *__restrict __buf, size_t __buflen,
-			    struct servent **__restrict __result) __THROW;
+			    struct servent **__restrict __result);
 
 extern int getservbyport_r (int __port, __const char *__restrict __proto,
 			    struct servent *__restrict __result_buf,
 			    char *__restrict __buf, size_t __buflen,
-			    struct servent **__restrict __result) __THROW;
+			    struct servent **__restrict __result);
 #endif	/* misc */
 
 
@@ -263,64 +326,108 @@
 };
 
 /* Open protocol data base files and mark them as staying open even
-   after a later search if STAY_OPEN is non-zero.  */
-extern void setprotoent (int __stay_open) __THROW;
+   after a later search if STAY_OPEN is non-zero.
 
-/* Close protocol data base files and clear `stay open' flag.  */
-extern void endprotoent (void) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void setprotoent (int __stay_open);
+
+/* Close protocol data base files and clear `stay open' flag.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void endprotoent (void);
 
 /* Get next entry from protocol data base file.  Open data base if
-   necessary.  */
-extern struct protoent *getprotoent (void) __THROW;
+   necessary.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct protoent *getprotoent (void);
 
-/* Return entry from protocol data base for network with NAME.  */
-extern struct protoent *getprotobyname (__const char *__name) __THROW;
+/* Return entry from protocol data base for network with NAME.
 
-/* Return entry from protocol data base which number is PROTO.  */
-extern struct protoent *getprotobynumber (int __proto) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct protoent *getprotobyname (__const char *__name);
+
+/* Return entry from protocol data base which number is PROTO.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct protoent *getprotobynumber (int __proto);
 
 
 #ifdef	__USE_MISC
 /* Reentrant versions of the functions above.  The additional
-   arguments specify a buffer of BUFLEN starting at BUF.  */
+   arguments specify a buffer of BUFLEN starting at BUF.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern int getprotoent_r (struct protoent *__restrict __result_buf,
 			  char *__restrict __buf, size_t __buflen,
-			  struct protoent **__restrict __result) __THROW;
+			  struct protoent **__restrict __result);
 
 extern int getprotobyname_r (__const char *__restrict __name,
 			     struct protoent *__restrict __result_buf,
 			     char *__restrict __buf, size_t __buflen,
-			     struct protoent **__restrict __result) __THROW;
+			     struct protoent **__restrict __result);
 
 extern int getprotobynumber_r (int __proto,
 			       struct protoent *__restrict __result_buf,
 			       char *__restrict __buf, size_t __buflen,
-			       struct protoent **__restrict __result) __THROW;
-#endif	/* misc */
+			       struct protoent **__restrict __result);
+
+
+/* Establish network group NETGROUP for enumeration.
 
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int setnetgrent (__const char *__netgroup);
 
-/* Establish network group NETGROUP for enumeration.  */
-extern int setnetgrent (__const char *__netgroup) __THROW;
+/* Free all space allocated by previous `setnetgrent' call.
 
-/* Free all space allocated by previous `setnetgrent' call.  */
-extern void endnetgrent (void) __THROW;
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern void endnetgrent (void);
 
 /* Get next member of netgroup established by last `setnetgrent' call
-   and return pointers to elements in HOSTP, USERP, and DOMAINP.  */
+   and return pointers to elements in HOSTP, USERP, and DOMAINP.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int getnetgrent (char **__restrict __hostp,
 			char **__restrict __userp,
-			char **__restrict __domainp) __THROW;
+			char **__restrict __domainp);
 
-#ifdef	__USE_MISC
-/* Test whether NETGROUP contains the triple (HOST,USER,DOMAIN).  */
+
+/* Test whether NETGROUP contains the triple (HOST,USER,DOMAIN).
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int innetgr (__const char *__netgroup, __const char *__host,
-		    __const char *__user, __const char *domain) __THROW;
+		    __const char *__user, __const char *domain);
+
+/* Reentrant version of `getnetgrent' where result is placed in BUFFER.
 
-/* Reentrant version of `getnetgrent' where result is placed in BUFFER.  */
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int getnetgrent_r (char **__restrict __hostp,
 			  char **__restrict __userp,
 			  char **__restrict __domainp,
-			  char *__restrict __buffer, size_t __buflen) __THROW;
+			  char *__restrict __buffer, size_t __buflen);
 #endif	/* misc */
 
 
@@ -330,60 +437,98 @@
    executed as REMUSER.  In *FD2P the descriptor to the socket for the
    connection is returned.  The caller must have the right to use a
    reserved port.  When the function returns *AHOST contains the
-   official host name.  */
+   official host name.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int rcmd (char **__restrict __ahost, unsigned short int __rport,
 		 __const char *__restrict __locuser,
 		 __const char *__restrict __remuser,
-		 __const char *__restrict __cmd, int *__restrict __fd2p)
-     __THROW;
+		 __const char *__restrict __cmd, int *__restrict __fd2p);
 
 /* This is the equivalent function where the protocol can be selected
-   and which therefore can be used for IPv6.  */
+   and which therefore can be used for IPv6.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int rcmd_af (char **__restrict __ahost, unsigned short int __rport,
 		    __const char *__restrict __locuser,
 		    __const char *__restrict __remuser,
 		    __const char *__restrict __cmd, int *__restrict __fd2p,
-		    sa_family_t __af) __THROW;
+		    sa_family_t __af);
 
 /* Call `rexecd' at port RPORT on remote machine *AHOST to execute
    CMD.  The process runs at the remote machine using the ID of user
    NAME whose cleartext password is PASSWD.  In *FD2P the descriptor
    to the socket for the connection is returned.  When the function
-   returns *AHOST contains the official host name.  */
+   returns *AHOST contains the official host name.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int rexec (char **__restrict __ahost, int __rport,
 		  __const char *__restrict __name,
 		  __const char *__restrict __pass,
-		  __const char *__restrict __cmd, int *__restrict __fd2p)
-     __THROW;
+		  __const char *__restrict __cmd, int *__restrict __fd2p);
 
 /* This is the equivalent function where the protocol can be selected
-   and which therefore can be used for IPv6.  */
+   and which therefore can be used for IPv6.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int rexec_af (char **__restrict __ahost, int __rport,
 		     __const char *__restrict __name,
 		     __const char *__restrict __pass,
 		     __const char *__restrict __cmd, int *__restrict __fd2p,
-		     sa_family_t __af) __THROW;
+		     sa_family_t __af);
 
 /* Check whether user REMUSER on system RHOST is allowed to login as LOCUSER.
    If SUSER is not zero the user tries to become superuser.  Return 0 if
-   it is possible.  */
+   it is possible.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int ruserok (__const char *__rhost, int __suser,
-		    __const char *__remuser, __const char *__locuser) __THROW;
+		    __const char *__remuser, __const char *__locuser);
 
 /* This is the equivalent function where the protocol can be selected
-   and which therefore can be used for IPv6.  */
+   and which therefore can be used for IPv6.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int ruserok_af (__const char *__rhost, int __suser,
 		       __const char *__remuser, __const char *__locuser,
-		       sa_family_t __af) __THROW;
+		       sa_family_t __af);
 
 /* Try to allocate reserved port, returning a descriptor for a socket opened
    at this port or -1 if unsuccessful.  The search for an available port
-   will start at ALPORT and continues with lower numbers.  */
-extern int rresvport (int *__alport) __THROW;
+   will start at ALPORT and continues with lower numbers.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int rresvport (int *__alport);
 
 /* This is the equivalent function where the protocol can be selected
-   and which therefore can be used for IPv6.  */
-extern int rresvport_af (int *__alport, sa_family_t __af) __THROW;
+   and which therefore can be used for IPv6.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int rresvport_af (int *__alport, sa_family_t __af);
 #endif
 
 
@@ -424,6 +569,10 @@
 # define AI_PASSIVE	0x0001	/* Socket address is intended for `bind'.  */
 # define AI_CANONNAME	0x0002	/* Request for canonical name.  */
 # define AI_NUMERICHOST	0x0004	/* Don't use name resolution.  */
+# define AI_V4MAPPED	0x0008	/* IPv4 mapped addresses are acceptable.  */
+# define AI_ALL		0x0010	/* Return IPv4 mapped and IPv6 addresses.  */
+# define AI_ADDRCONFIG	0x0020	/* Use configuration of this host to choose
+				   returned address type..  */
 
 /* Error values for `getaddrinfo' function.  */
 # define EAI_BADFLAGS	  -1	/* Invalid value for `ai_flags' field.  */
@@ -455,11 +604,14 @@
 # define NI_DGRAM	16	/* Look up UDP service rather than TCP.  */
 
 /* Translate name of a service location and/or a service name to set of
-   socket addresses.  */
+   socket addresses.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int getaddrinfo (__const char *__restrict __name,
 			__const char *__restrict __service,
 			__const struct addrinfo *__restrict __req,
-			struct addrinfo **__restrict __pai) __THROW;
+			struct addrinfo **__restrict __pai);
 
 /* Free `addrinfo' structure AI including associated storage.  */
 extern void freeaddrinfo (struct addrinfo *__ai) __THROW;
@@ -467,33 +619,45 @@
 /* Convert error return from getaddrinfo() to a string.  */
 extern __const char *gai_strerror (int __ecode) __THROW;
 
-/* Translate a socket address to a location and service name.  */
+/* Translate a socket address to a location and service name.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int getnameinfo (__const struct sockaddr *__restrict __sa,
 			socklen_t __salen, char *__restrict __host,
 			socklen_t __hostlen, char *__restrict __serv,
-			socklen_t __servlen, unsigned int __flags) __THROW;
+			socklen_t __servlen, unsigned int __flags);
+#endif	/* POSIX */
 
-# ifdef __USE_GNU
+#ifdef __USE_GNU
 /* Enqueue ENT requests from the LIST.  If MODE is GAI_WAIT wait until all
    requests are handled.  If WAIT is GAI_NOWAIT return immediately after
-   queueing the requests and signal completion according to SIG.  */
+   queueing the requests and signal completion according to SIG.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int getaddrinfo_a (int __mode, struct gaicb *__list[__restrict_arr],
-			  int __ent, struct sigevent *__restrict __sig)
-     __THROW;
+			  int __ent, struct sigevent *__restrict __sig);
 
 /* Suspend execution of the thread until at least one of the ENT requests
    in LIST is handled.  If TIMEOUT is not a null pointer it specifies the
-   longest time the function keeps waiting before returning with an error.  */
+   longest time the function keeps waiting before returning with an error.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int gai_suspend (__const struct gaicb *__const __list[], int __ent,
-			__const struct timespec *__timeout) __THROW;
+			__const struct timespec *__timeout);
 
 /* Get the error status of the request REQ.  */
 extern int gai_error (struct gaicb *__req) __THROW;
 
 /* Cancel the requests associated with GAICBP.  */
 extern int gai_cancel (struct gaicb *__gaicbp) __THROW;
-# endif	/* GNU */
-#endif	/* POSIX */
+#endif	/* GNU */
 
 __END_DECLS
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/resolv/res_send.c libc-20030708/resolv/res_send.c
--- glibc-2.3.2/resolv/res_send.c	2002-10-18 06:45:42.000000000 +0900
+++ libc-20030708/resolv/res_send.c	2003-07-08 22:58:09.000000000 +0900
@@ -108,63 +108,46 @@
 
 /* From ev_streams.c.  */
 
-static inline struct iovec
-evConsIovec(void *buf, size_t cnt) {
-	struct iovec ret;
-
-	memset(&ret, 0xf5, sizeof ret);
-	ret.iov_base = buf;
-	ret.iov_len = cnt;
-	return (ret);
+static inline void
+__attribute ((always_inline))
+evConsIovec(void *buf, size_t cnt, struct iovec *vec) {
+	memset(vec, 0xf5, sizeof (*vec));
+	vec->iov_base = buf;
+	vec->iov_len = cnt;
 }
 
 /* From ev_timers.c.  */
 
 #define BILLION 1000000000
 
-static inline struct timespec
-evTimeSpec(struct timeval tv) {
-        struct timespec ts;
-
-        ts.tv_sec = tv.tv_sec;
-        ts.tv_nsec = tv.tv_usec * 1000;
-        return (ts);
+static inline void
+evConsTime(struct timespec *res, time_t sec, long nsec) {
+	res->tv_sec = sec;
+	res->tv_nsec = nsec;
 }
 
-static inline struct timespec
-evConsTime(time_t sec, long nsec) {
-	struct timespec x;
-
-	x.tv_sec = sec;
-	x.tv_nsec = nsec;
-	return (x);
-}
-
-static inline struct timespec
-evAddTime(struct timespec addend1, struct timespec addend2) {
-	struct timespec x;
-
-	x.tv_sec = addend1.tv_sec + addend2.tv_sec;
-	x.tv_nsec = addend1.tv_nsec + addend2.tv_nsec;
-	if (x.tv_nsec >= BILLION) {
-		x.tv_sec++;
-		x.tv_nsec -= BILLION;
+static inline void
+evAddTime(struct timespec *res, const struct timespec *addend1,
+	  const struct timespec *addend2) {
+	res->tv_sec = addend1->tv_sec + addend2->tv_sec;
+	res->tv_nsec = addend1->tv_nsec + addend2->tv_nsec;
+	if (res->tv_nsec >= BILLION) {
+		res->tv_sec++;
+		res->tv_nsec -= BILLION;
 	}
-	return (x);
 }
 
-static inline struct timespec
-evSubTime(struct timespec minuend, struct timespec subtrahend) {
-	struct timespec x;
-
-	x.tv_sec = minuend.tv_sec - subtrahend.tv_sec;
-	if (minuend.tv_nsec >= subtrahend.tv_nsec)
-		x.tv_nsec = minuend.tv_nsec - subtrahend.tv_nsec;
+static inline void
+evSubTime(struct timespec *res, const struct timespec *minuend,
+	  const struct timespec *subtrahend) {
+       res->tv_sec = minuend->tv_sec - subtrahend->tv_sec;
+	if (minuend->tv_nsec >= subtrahend->tv_nsec)
+		res->tv_nsec = minuend->tv_nsec - subtrahend->tv_nsec;
 	else {
-		x.tv_nsec = BILLION - subtrahend.tv_nsec + minuend.tv_nsec;
-		x.tv_sec--;
+		res->tv_nsec = (BILLION
+				- subtrahend->tv_nsec + minuend->tv_nsec);
+		res->tv_sec--;
 	}
-	return (x);
 }
 
 static inline int
@@ -176,13 +159,14 @@
 	return (x < 0L ? (-1) : x > 0L ? (1) : (0));
 }
 
-static inline struct timespec
-evNowTime() {
+static inline void
+evNowTime(struct timespec *res) {
 	struct timeval now;
 
 	if (gettimeofday(&now, NULL) < 0)
-		return (evConsTime(0, 0));
-	return (evTimeSpec(now));
+		evConsTime(res, 0, 0);
+	else
+		TIMEVAL_TO_TIMESPEC (&now, res);
 }
 
 #endif
@@ -561,9 +545,11 @@
 				res_sendhookact act;
 
 #ifdef _LIBC
-				act = (*statp->qhook)((struct sockaddr_in **)
-						      &nsap, &buf, &buflen,
+				struct sockaddr_in *nsap4;
+				nsap4 = (struct sockaddr_in *) nsap;
+				act = (*statp->qhook)(&nsap4, &buf, &buflen,
 						      ans, anssiz, &resplen);
+				nsap = (struct sockaddr_in6 *) nsap4;
 #else
 				act = (*statp->qhook)(&nsap, &buf, &buflen,
 						      ans, anssiz, &resplen);
@@ -768,9 +754,10 @@
 	 * Send length & message
 	 */
 	putshort((u_short)buflen, (u_char*)&len);
-	iov[0] = evConsIovec(&len, INT16SZ);
-	iov[1] = evConsIovec((void*)buf, buflen);
-	if (writev(statp->_vcsock, iov, 2) != (INT16SZ + buflen)) {
+	evConsIovec(&len, INT16SZ, &iov[0]);
+	evConsIovec((void*)buf, buflen, &iov[1]);
+	if (TEMP_FAILURE_RETRY (writev(statp->_vcsock, iov, 2))
+	    != (INT16SZ + buflen)) {
 		*terrno = errno;
 		Perror(statp, stderr, "write failed", errno);
 		res_nclose(statp);
@@ -782,7 +769,8 @@
  read_len:
 	cp = ans;
 	len = INT16SZ;
-	while ((n = read(statp->_vcsock, (char *)cp, (int)len)) > 0) {
+	while ((n = TEMP_FAILURE_RETRY (read(statp->_vcsock, (char *)cp,
+					     (int)len))) > 0) {
 		cp += n;
 		if ((len -= n) <= 0)
 			break;
@@ -998,9 +986,9 @@
 		seconds /= statp->nscount;
 	if (seconds <= 0)
 		seconds = 1;
-	now = evNowTime();
-	timeout = evConsTime(seconds, 0);
-	finish = evAddTime(now, timeout);
+	evNowTime(&now);
+	evConsTime(&timeout, seconds, 0);
+	evAddTime(&finish, &now, &timeout);
  wait:
 #ifdef _LIBC
         /* Convert struct timespec in milliseconds.  */
@@ -1021,9 +1009,9 @@
 	}
 	if (n < 0) {
 		if (errno == EINTR) {
-			now = evNowTime();
+			evNowTime(&now);
 			if (evCmpTime(finish, now) > 0) {
-				timeout = evSubTime(finish, now);
+				evSubTime(&timeout, &finish, &now);
 				goto wait;
 			}
 		}
@@ -1244,7 +1232,7 @@
 	if (sigmask)
 		sigprocmask(SIG_SETMASK, &sigs, NULL);
 	if (tsp)
-		*tsp = evTimeSpec(tv);
+		TIMEVAL_TO_TIMESPEC (tv, *tsp);
 	return (n);
 }
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/rt/Makefile libc-20030708/rt/Makefile
--- glibc-2.3.2/rt/Makefile	2003-01-05 18:48:59.000000000 +0900
+++ libc-20030708/rt/Makefile	2003-07-08 22:58:09.000000000 +0900
@@ -38,7 +38,7 @@
 		 $(clock-routines) $(timer-routines) \
 		 $(shm-routines)
 
-tests := tst-shm tst-clock tst-timer \
+tests := tst-shm tst-clock tst-clock_nanosleep tst-timer \
 	 tst-aio tst-aio64 tst-aio2 tst-aio3 tst-aio4 tst-aio5 tst-aio6 \
 	 tst-aio7
 
@@ -49,6 +49,10 @@
 
 include ../Rules
 
+CFLAGS-aio_suspend.c = -fexceptions
+CFLAGS-clock_nanosleep.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-librt-cancellation.c = -fasynchronous-unwind-tables
+
 # Depend on libc.so so a DT_NEEDED is generated in the shared objects.
 # This ensures they will load libc.so for needed symbols if loaded by
 # a statically-linked program that hasn't already loaded it.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/rt/aio.h libc-20030708/rt/aio.h
--- glibc-2.3.2/rt/aio.h	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/rt/aio.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1996,1997,1998,1999,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -161,9 +161,12 @@
 extern int aio_cancel (int __fildes, struct aiocb *__aiocbp) __THROW;
 
 /* Suspend calling thread until at least one of the asynchronous I/O
-   operations referenced by LIST has completed.  */
+   operations referenced by LIST has completed.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int aio_suspend (__const struct aiocb *__const __list[], int __nent,
-			__const struct timespec *__restrict __timeout) __THROW;
+			__const struct timespec *__restrict __timeout);
 
 /* Force all operations associated with file desriptor described by
    `aio_fildes' member of AIOCBP.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/rt/tst-aio7.c libc-20030708/rt/tst-aio7.c
--- glibc-2.3.2/rt/tst-aio7.c	2002-10-01 07:02:39.000000000 +0900
+++ libc-20030708/rt/tst-aio7.c	2003-03-09 03:54:21.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test for AIO POSIX compliance.
-   Copyright (C) 2001,02 Free Software Foundation, Inc.
+   Copyright (C) 2001,02, 03 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -117,12 +117,13 @@
 
   /* Test for aio_suspend() suspending even if completed elements in list.  */
   {
-    const int BYTES = 8, ELEMS = 2;
+#define BYTES 8
+    const int ELEMS = 2;
     int i, r, fd;
-    char buff[BYTES];
+    static char buff[BYTES];
     char name[] = "/tmp/aio7.XXXXXX";
     struct timespec timeout;
-    struct aiocb cb0, cb1;
+    static struct aiocb cb0, cb1;
     struct aiocb *list[ELEMS];
 
     fd = mkstemp (name);
@@ -180,6 +181,9 @@
 	puts ("aio_suspend([done,blocked],2,3) suspended thread");
 	++result;
       }
+
+    /* Note that CB1 is still pending, and so cannot be an auto variable.
+       Thus we also test that exiting with an outstanding request works.  */
   }
 
   return result;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/rt/tst-clock_nanosleep.c libc-20030708/rt/tst-clock_nanosleep.c
--- glibc-2.3.2/rt/tst-clock_nanosleep.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/rt/tst-clock_nanosleep.c	2003-05-18 02:37:34.000000000 +0900
@@ -0,0 +1,58 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <stdio.h>
+#include <unistd.h>
+#include <sys/time.h>
+#include <time.h>
+
+
+/* Test that clock_nanosleep() does sleep.  */
+static int
+do_test (void)
+{
+  /* Current time.  */
+  struct timeval tv1;
+  (void) gettimeofday (&tv1, NULL);
+
+  struct timespec ts;
+  ts.tv_sec = 1;
+  ts.tv_nsec = 0;
+  TEMP_FAILURE_RETRY (clock_nanosleep (CLOCK_REALTIME, 0, &ts, &ts));
+
+  /* At least one second must have passed.  */
+  struct timeval tv2;
+  (void) gettimeofday (&tv2, NULL);
+
+  tv2.tv_sec -= tv1.tv_sec;
+  tv2.tv_usec -= tv1.tv_usec;
+  if (tv2.tv_usec < 0)
+    --tv2.tv_sec;
+
+  if (tv2.tv_sec < 1)
+    {
+      puts ("clock_nanosleep didn't sleep long enough");
+      return 1;
+    }
+
+  return 0;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/scripts/abilist.awk libc-20030708/scripts/abilist.awk
--- glibc-2.3.2/scripts/abilist.awk	2002-12-24 04:11:45.000000000 +0900
+++ libc-20030708/scripts/abilist.awk	2003-04-15 23:55:47.000000000 +0900
@@ -1,6 +1,33 @@
 # This awk script processes the output of objdump --dynamic-syms
 # into a simple format that should not change when the ABI is not changing.
 
+BEGIN {
+  if (combine_fullname)
+    combine = 1;
+  if (combine)
+    parse_names = 1;
+}
+
+# Per-file header.
+/[^ :]+\.so\.[0-9.]+:[ 	]+.file format .*$/ {
+  emit(0);
+
+  seen_opd = 0;
+
+  sofullname = $1;
+  sub(/:$/, "", sofullname);
+  soname = sofullname;
+  sub(/^.*\//, "", soname);
+  sub(/\.so\.[0-9.]+$/, "", soname);
+
+  suppress = ((filename_regexp != "" && sofullname !~ filename_regexp) \
+	      || (libname_regexp != "" && soname !~ libname_regexp));
+
+  next
+}
+
+suppress { next }
+
 # Normalize columns.
 /^[0-9a-fA-F]+      / { sub(/      /, "  -   ") }
 
@@ -22,14 +49,18 @@
 
   if (version == "GLIBC_PRIVATE") next;
 
+  desc = "";
   if (type == "D" && $4 == ".tbss") {
     type = "T";
   }
   else if (type == "D" && $4 == ".opd") {
-    type = "O";
+    type = "F";
     size = "";
+    if (seen_opd < 0)
+      type = "O";
+    seen_opd = 1;
   }
-  else if (type == "DO" && $4 == "*ABS*") {
+  else if ($4 == "*ABS*") {
     type = "A";
     size = "";
   }
@@ -37,15 +68,26 @@
     type = "D";
   }
   else if (type == "DF") {
+    if (symbol ~ /^\./ && seen_opd >= 0)
+      next;
+    seen_opd = -1;
     type = "F";
     size = "";
   }
   else {
-    print symbol, version, weak, "?", type, $4, $5;
-    next;
+    desc = symbol " " version " " weak " ? " type " " $4 " " $5;
+  }
+  if (size == " 0x") {
+    desc = symbol " " version " " weak " ? " type " " $4 " " $5;
   }
 
-  desc = " " symbol " " (weak == "w" ? tolower(type) : type) size;
+  # Disabled -- weakness should not matter to shared library ABIs any more.
+  #if (weak == "w") type = tolower(type);
+  if (desc == "")
+    desc = " " symbol " " type size;
+
+  if (combine)
+    version = soname " " version (combine_fullname ? " " sofullname : "");
 
   if (version in versions) {
     versions[version] = versions[version] "\n" desc;
@@ -63,8 +105,12 @@
   print "Don't grok this line:", $0
 }
 
-END {
-  nverlist = 0;
+function emit(end) {
+  if (!end && (combine || ! parse_names || soname == ""))
+    return;
+  tofile = parse_names && !combine;
+
+  nverslist = 0;
   for (version in versions) {
     if (nverslist == 0) {
       verslist = version;
@@ -92,13 +138,42 @@
     ++nverslist;
   }
 
+  if (tofile) {
+    out = prefix soname ".symlist";
+    if (soname in outfiles)
+      out = out "." ++outfiles[soname];
+    else
+      outfiles[soname] = 1;
+    printf "" > out;
+  }
+
   split(verslist, order, "\n");
   for (i = 1; i <= nverslist; ++i) {
     version = order[i];
 
-    print version;
-    outpipe = "sort";
+    if (tofile) {
+      print version >> out;
+      close(out);
+      outpipe = "sort >> " out;
+    }
+    else {
+      if (combine)
+	print "";
+      print prefix version;
+      outpipe = "sort";
+    }
     print versions[version] | outpipe;
     close(outpipe);
+
+    delete versions[version];
   }
+  for (version in versions)
+    delete versions[version];
+
+  if (tofile)
+    print "wrote", out, "for", sofullname;
+}
+
+END {
+  emit(1);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/scripts/config.guess libc-20030708/scripts/config.guess
--- glibc-2.3.2/scripts/config.guess	2002-07-10 16:24:32.000000000 +0900
+++ libc-20030708/scripts/config.guess	2003-07-08 22:58:09.000000000 +0900
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
 
-timestamp='2002-07-03'
+timestamp='2003-06-06'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -98,30 +98,32 @@
 # Historically, `CC_FOR_BUILD' used to be named `HOST_CC'. We still
 # use `HOST_CC' if defined, but it is deprecated.
 
-# This shell variable is my proudest work .. or something. --bje
+# Portable tmp directory creation inspired by the Autoconf team.
 
-set_cc_for_build='tmpdir=${TMPDIR-/tmp}/config-guess-$$ ;
-(old=`umask` && umask 077 && mkdir $tmpdir && umask $old && unset old)
-   || (echo "$me: cannot create $tmpdir" >&2 && exit 1) ;
-dummy=$tmpdir/dummy ;
-files="$dummy.c $dummy.o $dummy.rel $dummy" ;
-trap '"'"'rm -f $files; rmdir $tmpdir; exit 1'"'"' 1 2 15 ;
+set_cc_for_build='
+trap "exitcode=\$?; (rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null) && exit \$exitcode" 0 ;
+trap "rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null; exit 1" 1 2 13 15 ;
+: ${TMPDIR=/tmp} ;
+ { tmp=`(umask 077 && mktemp -d -q "$TMPDIR/cgXXXXXX") 2>/dev/null` && test -n "$tmp" && test -d "$tmp" ; } ||
+ { test -n "$RANDOM" && tmp=$TMPDIR/cg$$-$RANDOM && (umask 077 && mkdir $tmp) ; } ||
+ { tmp=$TMPDIR/cg-$$ && (umask 077 && mkdir $tmp) && echo "Warning: creating insecure temp directory" >&2 ; } ||
+ { echo "$me: cannot create a temporary directory in $TMPDIR" >&2 ; exit 1 ; } ;
+dummy=$tmp/dummy ;
+tmpfiles="$dummy.c $dummy.o $dummy.rel $dummy" ;
 case $CC_FOR_BUILD,$HOST_CC,$CC in
  ,,)    echo "int x;" > $dummy.c ;
 	for c in cc gcc c89 c99 ; do
-	  if ($c $dummy.c -c -o $dummy.o) >/dev/null 2>&1 ; then
+	  if ($c -c -o $dummy.o $dummy.c) >/dev/null 2>&1 ; then
 	     CC_FOR_BUILD="$c"; break ;
 	  fi ;
 	done ;
-	rm -f $files ;
 	if test x"$CC_FOR_BUILD" = x ; then
 	  CC_FOR_BUILD=no_compiler_found ;
 	fi
 	;;
  ,,*)   CC_FOR_BUILD=$CC ;;
  ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac ;
-unset files'
+esac ;'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (ghazi@noc.rutgers.edu 1994-08-24)
@@ -178,7 +180,18 @@
 		;;
 	esac
 	# The OS release
-	release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+	# Debian GNU/NetBSD machines have a different userland, and
+	# thus, need a distinct triplet. However, they do not need
+	# kernel version information, so it can be replaced with a
+	# suitable tag, in the style of linux-gnu.
+	case "${UNAME_VERSION}" in
+	    Debian*)
+		release='-gnu'
+		;;
+	    *)
+		release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+		;;
+	esac
 	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
@@ -227,63 +240,47 @@
 	if test $UNAME_RELEASE = "V4.0"; then
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
 	fi
+	# According to Compaq, /usr/sbin/psrinfo has been available on
+	# OSF/1 and Tru64 systems produced since 1995.  I hope that
+	# covers most systems running today.  This code pipes the CPU
+	# types through head -n 1, so we only detect the type of CPU 0.
+	ALPHA_CPU_TYPE=`/usr/sbin/psrinfo -v | sed -n -e 's/^  The alpha \(.*\) processor.*$/\1/p' | head -n 1`
+	case "$ALPHA_CPU_TYPE" in
+	    "EV4 (21064)")
+		UNAME_MACHINE="alpha" ;;
+	    "EV4.5 (21064)")
+		UNAME_MACHINE="alpha" ;;
+	    "LCA4 (21066/21068)")
+		UNAME_MACHINE="alpha" ;;
+	    "EV5 (21164)")
+		UNAME_MACHINE="alphaev5" ;;
+	    "EV5.6 (21164A)")
+		UNAME_MACHINE="alphaev56" ;;
+	    "EV5.6 (21164PC)")
+		UNAME_MACHINE="alphapca56" ;;
+	    "EV5.7 (21164PC)")
+		UNAME_MACHINE="alphapca57" ;;
+	    "EV6 (21264)")
+		UNAME_MACHINE="alphaev6" ;;
+	    "EV6.7 (21264A)")
+		UNAME_MACHINE="alphaev67" ;;
+	    "EV6.8CB (21264C)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.8AL (21264B)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.8CX (21264D)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.9A (21264/EV69A)")
+		UNAME_MACHINE="alphaev69" ;;
+	    "EV7 (21364)")
+		UNAME_MACHINE="alphaev7" ;;
+	    "EV7.9 (21364A)")
+		UNAME_MACHINE="alphaev79" ;;
+	esac
 	# A Vn.n version is a released version.
 	# A Tn.n version is a released field test version.
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses "1.2" for uname -r.
-	cat <<EOF >$dummy.s
-	.data
-\$Lformat:
-	.byte 37,100,45,37,120,10,0	# "%d-%x\n"
-
-	.text
-	.globl main
-	.align 4
-	.ent main
-main:
-	.frame \$30,16,\$26,0
-	ldgp \$29,0(\$27)
-	.prologue 1
-	.long 0x47e03d80 # implver \$0
-	lda \$2,-1
-	.long 0x47e20c21 # amask \$2,\$1
-	lda \$16,\$Lformat
-	mov \$0,\$17
-	not \$1,\$18
-	jsr \$26,printf
-	ldgp \$29,0(\$26)
-	mov 0,\$16
-	jsr \$26,exit
-	.end main
-EOF
-	eval $set_cc_for_build
-	$CC_FOR_BUILD $dummy.s -o $dummy 2>/dev/null
-	if test "$?" = 0 ; then
-		case `$dummy` in
-			0-0)
-				UNAME_MACHINE="alpha"
-				;;
-			1-0)
-				UNAME_MACHINE="alphaev5"
-				;;
-			1-1)
-				UNAME_MACHINE="alphaev56"
-				;;
-			1-101)
-				UNAME_MACHINE="alphapca56"
-				;;
-			2-303)
-				UNAME_MACHINE="alphaev6"
-				;;
-			2-307)
-				UNAME_MACHINE="alphaev67"
-				;;
-			2-1307)
-				UNAME_MACHINE="alphaev68"
-				;;
-		esac
-	fi
-	rm -f $dummy.s $dummy && dir $tmpdir
 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[VTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
 	exit 0 ;;
     Alpha\ *:Windows_NT*:*)
@@ -324,7 +321,10 @@
     NILE*:*:*:dcosx)
 	echo pyramid-pyramid-svr4
 	exit 0 ;;
-    DSR?6000:UNIX_SV:4.2*:7*)
+    DRS?6000:unix:4.0:6*)
+	echo sparc-icl-nx6
+	exit 0 ;;
+    DRS?6000:UNIX_SV:4.2*:7*)
 	case `/usr/bin/uname -p` in
 	    sparc) echo sparc-icl-nx7 && exit 0 ;;
 	esac ;;
@@ -434,16 +434,18 @@
 	  exit (-1);
 	}
 EOF
-	$CC_FOR_BUILD $dummy.c -o $dummy \
+	$CC_FOR_BUILD -o $dummy $dummy.c \
 	  && $dummy `echo "${UNAME_RELEASE}" | sed -n 's/\([0-9]*\).*/\1/p'` \
-	  && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
-	rm -f $dummy.c $dummy && rmdir $tmpdir
+	  && exit 0
 	echo mips-mips-riscos${UNAME_RELEASE}
 	exit 0 ;;
     Motorola:PowerMAX_OS:*:*)
 	echo powerpc-motorola-powermax
 	exit 0 ;;
-    Night_Hawk:*:*:PowerMAX_OS)
+    Motorola:*:4.3:PL8-*)
+	echo powerpc-harris-powermax
+	exit 0 ;;
+    Night_Hawk:*:*:PowerMAX_OS | Synergy:PowerMAX_OS:*:*)
 	echo powerpc-harris-powermax
 	exit 0 ;;
     Night_Hawk:Power_UNIX:*:*)
@@ -518,8 +520,7 @@
 			exit(0);
 			}
 EOF
-		$CC_FOR_BUILD $dummy.c -o $dummy && $dummy && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
-		rm -f $dummy.c $dummy && rmdir $tmpdir
+		$CC_FOR_BUILD -o $dummy $dummy.c && $dummy && exit 0
 		echo rs6000-ibm-aix3.2.5
 	elif grep bos324 /usr/include/stdio.h >/dev/null 2>&1; then
 		echo rs6000-ibm-aix3.2.4
@@ -617,11 +618,21 @@
                   exit (0);
               }
 EOF
-		    (CCOPTS= $CC_FOR_BUILD $dummy.c -o $dummy 2>/dev/null) && HP_ARCH=`$dummy`
-		    if test -z "$HP_ARCH"; then HP_ARCH=hppa; fi
-		    rm -f $dummy.c $dummy && rmdir $tmpdir
+		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
+		    test -z "$HP_ARCH" && HP_ARCH=hppa
 		fi ;;
 	esac
+	if [ ${HP_ARCH} = "hppa2.0w" ]
+	then
+	    # avoid double evaluation of $set_cc_for_build
+	    test -n "$CC_FOR_BUILD" || eval $set_cc_for_build
+	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E -) | grep __LP64__ >/dev/null
+	    then
+		HP_ARCH="hppa2.0w"
+	    else
+		HP_ARCH="hppa64"
+	    fi
+	fi
 	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
 	exit 0 ;;
     ia64:HP-UX:*:*)
@@ -655,8 +666,7 @@
 	  exit (0);
 	}
 EOF
-	$CC_FOR_BUILD $dummy.c -o $dummy && $dummy && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
-	rm -f $dummy.c $dummy && rmdir $tmpdir
+	$CC_FOR_BUILD -o $dummy $dummy.c && $dummy && exit 0
 	echo unknown-hitachi-hiuxwe2
 	exit 0 ;;
     9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
@@ -714,15 +724,15 @@
     CRAY*TS:*:*:*)
 	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
-    CRAY*T3D:*:*:*)
-	echo alpha-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
     CRAY*T3E:*:*:*)
 	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
     CRAY*SV1:*:*:*)
 	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
+    *:UNICOS/mp:*:*)
+	echo nv1-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/' 
+	exit 0 ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
@@ -738,7 +748,7 @@
     *:BSD/OS:*:*)
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit 0 ;;
-    *:FreeBSD:*:*)
+    *:FreeBSD:*:*|*:GNU/FreeBSD:*:*)
 	# Determine whether the default compiler uses glibc.
 	eval $set_cc_for_build
 	sed 's/^	//' << EOF >$dummy.c
@@ -750,7 +760,6 @@
 	#endif
 EOF
 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^LIBC=`
-	rm -f $dummy.c && rmdir $tmpdir
 	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`${LIBC:+-$LIBC}
 	exit 0 ;;
     i*:CYGWIN*:*)
@@ -762,14 +771,17 @@
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
 	exit 0 ;;
-    x86:Interix*:3*)
-	echo i386-pc-interix3
+    x86:Interix*:[34]*)
+	echo i586-pc-interix${UNAME_RELEASE}|sed -e 's/\..*//'
+	exit 0 ;;
+    [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
+	echo i${UNAME_MACHINE}-pc-mks
 	exit 0 ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&T UWIN. Should we
 	# UNAME_MACHINE based on the output of uname instead of i386?
-	echo i386-pc-interix
+	echo i586-pc-interix
 	exit 0 ;;
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
@@ -789,6 +801,9 @@
     arm*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit 0 ;;
+    cris:Linux:*:*)
+	echo cris-axis-linux-gnu
+	exit 0 ;;
     ia64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit 0 ;;
@@ -812,8 +827,26 @@
 	#endif
 EOF
 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^CPU=`
-	rm -f $dummy.c && rmdir $tmpdir
-	test x"${CPU}" != x && echo "${CPU}-pc-linux-gnu" && exit 0
+	test x"${CPU}" != x && echo "${CPU}-unknown-linux-gnu" && exit 0
+	;;
+    mips64:Linux:*:*)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#undef CPU
+	#undef mips64
+	#undef mips64el
+	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
+	CPU=mips64el
+	#else
+	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
+	CPU=mips64
+	#else
+	CPU=
+	#endif
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^CPU=`
+	test x"${CPU}" != x && echo "${CPU}-unknown-linux-gnu" && exit 0
 	;;
     ppc:Linux:*:*)
 	echo powerpc-unknown-linux-gnu
@@ -875,7 +908,7 @@
 		;;
 	  a.out-i386-linux)
 		echo "${UNAME_MACHINE}-pc-linux-gnuaout"
-		exit 0 ;;		
+		exit 0 ;;
 	  coff-i386)
 		echo "${UNAME_MACHINE}-pc-linux-gnucoff"
 		exit 0 ;;
@@ -908,7 +941,6 @@
 	#endif
 EOF
 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^LIBC=`
-	rm -f $dummy.c && rmdir $tmpdir
 	test x"${LIBC}" != x && echo "${UNAME_MACHINE}-pc-linux-${LIBC}" && exit 0
 	test x"${TENTATIVE}" != x && echo "${TENTATIVE}" && exit 0
 	;;
@@ -926,6 +958,23 @@
         # Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
 	exit 0 ;;
+    i*86:OS/2:*:*)
+	# If we were able to find `uname', then EMX Unix compatibility
+	# is probably installed.
+	echo ${UNAME_MACHINE}-pc-os2-emx
+	exit 0 ;;
+    i*86:XTS-300:*:STOP)
+	echo ${UNAME_MACHINE}-unknown-stop
+	exit 0 ;;
+    i*86:atheos:*:*)
+	echo ${UNAME_MACHINE}-unknown-atheos
+	exit 0 ;;
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+	echo i386-unknown-lynxos${UNAME_RELEASE}
+	exit 0 ;;
+    i*86:*DOS:*:*)
+	echo ${UNAME_MACHINE}-pc-msdosdjgpp
+	exit 0 ;;
     i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
 	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h >/dev/null 2>/dev/null; then
@@ -960,9 +1009,6 @@
 		echo ${UNAME_MACHINE}-pc-sysv32
 	fi
 	exit 0 ;;
-    i*86:*DOS:*:*)
-	echo ${UNAME_MACHINE}-pc-msdosdjgpp
-	exit 0 ;;
     pc:*:*:*)
 	# Left here for compatibility:
         # uname -m prints for DJGPP always 'pc', but it prints nothing about
@@ -986,9 +1032,15 @@
 	# "miniframe"
 	echo m68010-convergent-sysv
 	exit 0 ;;
+    mc68k:UNIX:SYSTEM5:3.51m)
+	echo m68k-convergent-sysv
+	exit 0 ;;
+    M680?0:D-NIX:5.3:*)
+	echo m68k-diab-dnix
+	exit 0 ;;
     M68*:*:R3V[567]*:*)
 	test -r /sysV68 && echo 'm68k-motorola-sysv' && exit 0 ;;
-    3[34]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0)
+    3[34]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0)
 	OS_REL=''
 	test -r /etc/.relid \
 	&& OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
@@ -1005,9 +1057,6 @@
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
 	exit 0 ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
-	echo i386-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
     TSUNAMI:LynxOS:2.*:*)
 	echo sparc-unknown-lynxos${UNAME_RELEASE}
 	exit 0 ;;
@@ -1079,6 +1128,9 @@
     SX-5:SUPER-UX:*:*)
 	echo sx5-nec-superux${UNAME_RELEASE}
 	exit 0 ;;
+    SX-6:SUPER-UX:*:*)
+	echo sx6-nec-superux${UNAME_RELEASE}
+	exit 0 ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
 	exit 0 ;;
@@ -1086,7 +1138,11 @@
 	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
 	exit 0 ;;
     *:Darwin:*:*)
-	echo `uname -p`-apple-darwin${UNAME_RELEASE}
+	case `uname -p` in
+	    *86) UNAME_PROCESSOR=i686 ;;
+	    powerpc) UNAME_PROCESSOR=powerpc ;;
+	esac
+	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
 	exit 0 ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
 	UNAME_PROCESSOR=`uname -p`
@@ -1099,7 +1155,7 @@
     *:QNX:*:4*)
 	echo i386-pc-qnx
 	exit 0 ;;
-    NSR-[GKLNPTVW]:NONSTOP_KERNEL:*:*)
+    NSR-[DGKLNPTVW]:NONSTOP_KERNEL:*:*)
 	echo nsr-tandem-nsk${UNAME_RELEASE}
 	exit 0 ;;
     *:NonStop-UX:*:*)
@@ -1122,11 +1178,6 @@
 	fi
 	echo ${UNAME_MACHINE}-unknown-plan9
 	exit 0 ;;
-    i*86:OS/2:*:*)
-	# If we were able to find `uname', then EMX Unix compatibility
-	# is probably installed.
-	echo ${UNAME_MACHINE}-pc-os2-emx
-	exit 0 ;;
     *:TOPS-10:*:*)
 	echo pdp10-unknown-tops10
 	exit 0 ;;
@@ -1145,12 +1196,6 @@
     *:ITS:*:*)
 	echo pdp10-unknown-its
 	exit 0 ;;
-    i*86:XTS-300:*:STOP)
-	echo ${UNAME_MACHINE}-unknown-stop
-	exit 0 ;;
-    i*86:atheos:*:*)
-	echo ${UNAME_MACHINE}-unknown-atheos
-	exit 0 ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1>&2
@@ -1271,8 +1316,7 @@
 }
 EOF
 
-$CC_FOR_BUILD $dummy.c -o $dummy 2>/dev/null && $dummy && rm -f $dummy.c $dummy && rmdir $tmpdir && exit 0
-rm -f $dummy.c $dummy && rmdir $tmpdir
+$CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null && $dummy && exit 0
 
 # Apollos put the system type in the environment.
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/scripts/config.sub libc-20030708/scripts/config.sub
--- glibc-2.3.2/scripts/config.sub	2002-07-10 16:24:32.000000000 +0900
+++ libc-20030708/scripts/config.sub	2003-07-08 22:58:09.000000000 +0900
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
 
-timestamp='2002-07-03'
+timestamp='2003-06-06'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -118,7 +118,7 @@
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | freebsd*-gnu* | storm-chaos* | os2-emx* | windows32-* | rtmk-nova*)
+  nto-qnx* | linux-gnu* | freebsd*-gnu* | netbsd*-gnu* | storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
@@ -229,7 +229,7 @@
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
-	| c4x | clipper \
+	| clipper \
 	| d10v | d30v | dlx | dsp16xx \
 	| fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
@@ -239,21 +239,25 @@
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
+	| mips64vr | mips64vrel \
 	| mips64orion | mips64orionel \
 	| mips64vr4100 | mips64vr4100el \
 	| mips64vr4300 | mips64vr4300el \
 	| mips64vr5000 | mips64vr5000el \
 	| mipsisa32 | mipsisa32el \
+	| mipsisa32r2 | mipsisa32r2el \
 	| mipsisa64 | mipsisa64el \
 	| mipsisa64sb1 | mipsisa64sb1el \
+	| mipsisa64sr71k | mipsisa64sr71kel \
 	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
+	| msp430 \
 	| ns16k | ns32k \
 	| openrisc | or32 \
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[1234] | sh3e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
+	| sh | sh[1234] | sh[23]e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
 	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv9 | sparcv9b \
 	| strongarm \
@@ -292,7 +296,7 @@
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
 	| avr-* \
 	| bs2000-* \
-	| c[123]* | c30-* | [cjt]90-* | c54x-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
 	| clipper-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
@@ -307,25 +311,31 @@
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
+	| mips64vr-* | mips64vrel-* \
 	| mips64orion-* | mips64orionel-* \
 	| mips64vr4100-* | mips64vr4100el-* \
 	| mips64vr4300-* | mips64vr4300el-* \
 	| mips64vr5000-* | mips64vr5000el-* \
 	| mipsisa32-* | mipsisa32el-* \
+	| mipsisa32r2-* | mipsisa32r2el-* \
 	| mipsisa64-* | mipsisa64el-* \
 	| mipsisa64sb1-* | mipsisa64sb1el-* \
-	| mipstx39 | mipstx39el \
-	| none-* | np1-* | ns16k-* | ns32k-* \
+	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
+	| mipstx39-* | mipstx39el-* \
+	| msp430-* \
+	| none-* | np1-* | nv1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
 	| romp-* | rs6000-* \
-	| sh-* | sh[1234]-* | sh3e-* | sh[34]eb-* | shbe-* \
+	| sh-* | sh[1234]-* | sh[23]e-* | sh[34]eb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
 	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
 	| sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
-	| tahoe-* | thumb-* | tic30-* | tic54x-* | tic80-* | tron-* \
+	| tahoe-* | thumb-* \
+	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tron-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
 	| x86-* | x86_64-* | xps100-* | xscale-* | xstormy16-* \
@@ -363,6 +373,9 @@
 		basic_machine=a29k-none
 		os=-bsd
 		;;
+	amd64)
+		basic_machine=x86_64-pc
+		;;
 	amdahl)
 		basic_machine=580-amdahl
 		os=-sysv
@@ -712,6 +725,10 @@
 	np1)
 		basic_machine=np1-gould
 		;;
+	nv1)
+		basic_machine=nv1-cray
+		os=-unicosmp
+		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -745,49 +762,55 @@
 	pbb)
 		basic_machine=m68k-tti
 		;;
-        pc532 | pc532-*)
+	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
 	pentium | p5 | k5 | k6 | nexgen | viac3)
 		basic_machine=i586-pc
 		;;
-	pentiumpro | p6 | 6x86 | athlon)
+	pentiumpro | p6 | 6x86 | athlon | athlon_*)
 		basic_machine=i686-pc
 		;;
-	pentiumii | pentium2)
+	pentiumii | pentium2 | pentiumiii | pentium3)
 		basic_machine=i686-pc
 		;;
+	pentium4)
+		basic_machine=i786-pc
+		;;
 	pentium-* | p5-* | k5-* | k6-* | nexgen-* | viac3-*)
 		basic_machine=i586-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	pentiumpro-* | p6-* | 6x86-* | athlon-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
-	pentiumii-* | pentium2-*)
+	pentiumii-* | pentium2-* | pentiumiii-* | pentium3-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
+	pentium4-*)
+		basic_machine=i786-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pn)
 		basic_machine=pn-gould
 		;;
 	power)	basic_machine=power-ibm
 		;;
 	ppc)	basic_machine=powerpc-unknown
-	        ;;
+		;;
 	ppc-*)	basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppcle | powerpclittle | ppc-le | powerpc-little)
 		basic_machine=powerpcle-unknown
-	        ;;
+		;;
 	ppcle-* | powerpclittle-*)
 		basic_machine=powerpcle-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64)	basic_machine=powerpc64-unknown
-	        ;;
+		;;
 	ppc64-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64le | powerpc64little | ppc64-le | powerpc64-little)
 		basic_machine=powerpc64le-unknown
-	        ;;
+		;;
 	ppc64le-* | powerpc64little-*)
 		basic_machine=powerpc64le-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
@@ -818,6 +841,12 @@
 		basic_machine=a29k-amd
 		os=-udi
 		;;
+	sb1)
+		basic_machine=mipsisa64sb1-unknown
+		;;
+	sb1el)
+		basic_machine=mipsisa64sb1el-unknown
+		;;
 	sequent)
 		basic_machine=i386-sequent
 		;;
@@ -883,7 +912,7 @@
 	sun386 | sun386i | roadrunner)
 		basic_machine=i386-sun
 		;;
-        sv1)
+	sv1)
 		basic_machine=sv1-cray
 		os=-unicos
 		;;
@@ -891,10 +920,6 @@
 		basic_machine=i386-sequent
 		os=-dynix
 		;;
-	t3d)
-		basic_machine=alpha-cray
-		os=-unicos
-		;;
 	t3e)
 		basic_machine=alphaev5-cray
 		os=-unicos
@@ -903,10 +928,22 @@
 		basic_machine=t90-cray
 		os=-unicos
 		;;
+        tic4x | c4x*)
+		basic_machine=tic4x-unknown
+		os=-coff
+		;;
 	tic54x | c54x*)
 		basic_machine=tic54x-unknown
 		os=-coff
 		;;
+	tic55x | c55x*)
+		basic_machine=tic55x-unknown
+		os=-coff
+		;;
+	tic6x | c6x*)
+		basic_machine=tic6x-unknown
+		os=-coff
+		;;
 	tx39)
 		basic_machine=mipstx39-unknown
 		;;
@@ -941,8 +978,8 @@
 		os=-vms
 		;;
 	vpp*|vx|vx-*)
-               basic_machine=f301-fujitsu
-               ;;
+		basic_machine=f301-fujitsu
+		;;
 	vxworks960)
 		basic_machine=i960-wrs
 		os=-vxworks
@@ -963,11 +1000,7 @@
 		basic_machine=hppa1.1-winbond
 		os=-proelf
 		;;
-	windows32)
-		basic_machine=i386-pc
-		os=-windows32-msvcrt
-		;;
-        xps | xps100)
+	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
 	ymp)
@@ -1013,7 +1046,7 @@
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh3 | sh4 | sh3eb | sh4eb | sh[1234]le | sh3ele)
+	sh3 | sh4 | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
 	sh64)
@@ -1022,7 +1055,7 @@
 	sparc | sparcv9 | sparcv9b)
 		basic_machine=sparc-sun
 		;;
-        cydra)
+	cydra)
 		basic_machine=cydra-cydrome
 		;;
 	orion)
@@ -1037,10 +1070,6 @@
 	pmac | pmac-mpw)
 		basic_machine=powerpc-apple
 		;;
-	c4x*)
-		basic_machine=c4x-none
-		os=-coff
-		;;
 	*-unknown)
 		# Make sure to match an already-canonicalized machine name.
 		;;
@@ -1103,11 +1132,12 @@
 	      | -chorusos* | -chorusrdb* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
 	      | -mingw32* | -linux-gnu* | -uxpv* | -beos* | -mpeix* | -udk* \
-	      | -interix* | -uwin* | -rhapsody* | -darwin* | -opened* \
+	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
 	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
-	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* | -powermax*)
+	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
+	      | -powermax* | -dnix* | -nx6 | -nx7)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1119,8 +1149,10 @@
 			;;
 		esac
 		;;
+	-nto-qnx*)
+		;;
 	-nto*)
-		os=-nto-qnx
+		os=`echo $os | sed -e 's|nto|nto-qnx|'`
 		;;
 	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
 	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
@@ -1172,7 +1204,7 @@
 		os=-rtmk-nova
 		;;
 	-ns2 )
-	        os=-nextstep2
+		os=-nextstep2
 		;;
 	-nsk*)
 		os=-nsk
@@ -1211,8 +1243,14 @@
 	-xenix)
 		os=-xenix
 		;;
-        -*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
-	        os=-mint
+	-*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
+		os=-mint
+		;;
+	-aros*)
+		os=-aros
+		;;
+	-kaos*)
+		os=-kaos
 		;;
 	-none)
 		;;
@@ -1249,7 +1287,7 @@
 	pdp10-*)
 		os=-tops20
 		;;
-        pdp11-*)
+	pdp11-*)
 		os=-none
 		;;
 	*-dec | vax-*)
@@ -1342,19 +1380,19 @@
 	*-next)
 		os=-nextstep3
 		;;
-        *-gould)
+	*-gould)
 		os=-sysv
 		;;
-        *-highlevel)
+	*-highlevel)
 		os=-bsd
 		;;
 	*-encore)
 		os=-bsd
 		;;
-        *-sgi)
+	*-sgi)
 		os=-irix
 		;;
-        *-siemens)
+	*-siemens)
 		os=-sysv4
 		;;
 	*-masscomp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/scripts/merge-abilist.awk libc-20030708/scripts/merge-abilist.awk
--- glibc-2.3.2/scripts/merge-abilist.awk	2003-01-17 02:28:31.000000000 +0900
+++ libc-20030708/scripts/merge-abilist.awk	2003-03-03 16:11:44.000000000 +0900
@@ -12,9 +12,11 @@
 #	 function F
 #	 variable D 0x4
 
+BEGIN { current = "UNSET" }
+
 /^[^| ]/ {
   if (NF < 2 && config == "") {
-    print "BAD LINE:", $0 > "/dev/stderr";
+    print FILENAME ":" FNR ": BAD SET LINE:", $0 > "/dev/stderr";
     exit 2;
   }
 
@@ -44,8 +46,8 @@
 }
 
 /^\| / {
-  if (NF < 3) {
-    print "BAD LINE:", $0 > "/dev/stderr";
+  if (NF < 3 || current == "UNSET") {
+    print FILENAME ":" FNR ": BAD | LINE:", $0 > "/dev/stderr";
     exit 2;
   }
 
@@ -61,12 +63,20 @@
 
 {
   if (current == "") next;
+  if (current == "UNSET") {
+    print FILENAME ":" FNR ": IGNORED LINE:", $0 > "/dev/stderr";
+    next;
+  }
 
   ns = split(seen[$0], s, ",");
   nc = split(current, c, ",");
   for (i = 1; i <= nc; ++i) {
+    if (c[i] == "")
+      continue;
     # Sorted insert.
     for (j = 1; j <= ns; ++j) {
+      if (c[i] == s[j])
+        break;
       if (c[i] < s[j]) {
 	for (k = ns; k >= j; --k)
 	  s[k + 1] = s[k];
@@ -75,7 +85,7 @@
 	break;
       }
     }
-    if (j >= ns)
+    if (j > ns)
       s[++ns] = c[i];
   }
 
@@ -97,7 +107,9 @@
   ns = split("", s);
   for (configs in stanzas) {
     # Sorted insert.
-    for (j = 1; j <= ns; ++j)
+    for (j = 1; j <= ns; ++j) {
+      if (configs == s[j])
+        break;
       if (configs < s[j]) {
 	for (k = ns; k >= j; --k)
 	  s[k + 1] = s[k];
@@ -105,7 +117,8 @@
 	++ns;
 	break;
       }
-    if (j >= ns)
+    }
+    if (j > ns)
       s[++ns] = configs;
   }
 
@@ -118,15 +131,22 @@
     # S[I] is a sorted, comma-separated list of SET:CONFIG pairs.
     # All we have to do is pretty-print them.
     nc = split(s[i], c, ",");
-    lastvers = "";
+    lastvers = lastconf = "";
     for (j = 1; j <= nc; ++j) {
       split(c[j], temp, ":");
       version = temp[1];
       conf = temp[2];
       if (version != lastvers)
 	printf "%s%s", (lastvers != "" ? "\n| " : ""), version;
+      # Hack: if CONF is foo.*/bar and LASTCONF was foo.*,
+      # then we can omit the foo.*/bar since foo.* matches already.
+      # Note we don't update LASTCONF, so foo.*/baz next time will match too.
+      else if ((slash = index(conf, ".*/")) > 0 && \
+	       substr(conf, 1, slash + 2 - 1) == lastconf)
+        continue;
       printf " %s", conf;
       lastvers = version;
+      lastconf = conf;
     }
     print "";
     outpipe = "sort";
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/scripts/rpm2dynsym.sh libc-20030708/scripts/rpm2dynsym.sh
--- glibc-2.3.2/scripts/rpm2dynsym.sh	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/scripts/rpm2dynsym.sh	2003-03-28 07:48:49.000000000 +0900
@@ -0,0 +1,36 @@
+#!/bin/sh
+
+# This script takes rpm package files, finds *.so.N files in them,
+# and runs objdump --dynamic-syms on them.  The arguments are rpm file
+# names.  For each rpm, it creates an output file with the name
+# "NAME-VERSION-RELEASE.ARCH.dynsym", the variable parts being extracted
+# from the rpm's headers (not its file name).  Each file contains the
+# collected objdump output for all the *.so.N files in the corresponding rpm.
+# This can be processed with abilist.awk or sent to someone who will do that.
+# This does not do a lot of error-checking, so you should always watch stderr
+# and sanity-check the resulting output files.
+
+RPM=${RPM:-rpm}
+RPM2CPIO=${RPM2CPIO:-rpm2cpio}
+CPIO=${CPIO:-cpio}
+OBJDUMP=${OBJDUMP:-objdump}
+
+unpackdir=/tmp/rpm2dynsym$$
+trap 'rm -rf $unpackdir' 0 1 2 15
+
+for rpm; do
+  name=`$RPM -qp $rpm --queryformat '%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\n'`
+  mkdir $unpackdir || exit
+  $RPM2CPIO "$rpm" | {
+    cd $unpackdir
+    $CPIO -i -d --no-absolute-filenames -uv '*.so.*' '*.so' 2>&1 |
+    while read file b; do
+      test x"$b" = x || break
+      case "$file" in
+      *.so.[0-9]*) $OBJDUMP --dynamic-syms $file ;;
+      esac
+    done
+  } > $name.dynsym
+  echo wrote $name.dynsym for $rpm
+  rm -rf $unpackdir
+done
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/shadow/shadow.h libc-20030708/shadow/shadow.h
--- glibc-2.3.2/shadow/shadow.h	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/shadow/shadow.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -54,46 +54,90 @@
   };
 
 
-/* Open database for reading.  */
-extern void setspent (void) __THROW;
+/* Open database for reading.
 
-/* Close database.  */
-extern void endspent (void) __THROW;
-
-/* Get next entry from database, perhaps after opening the file.  */
-extern struct spwd *getspent (void) __THROW;
-
-/* Get shadow entry matching NAME.  */
-extern struct spwd *getspnam (__const char *__name) __THROW;
-
-/* Read shadow entry from STRING.  */
-extern struct spwd *sgetspent (__const char *__string) __THROW;
-
-/* Read next shadow entry from STREAM.  */
-extern struct spwd *fgetspent (FILE *__stream) __THROW;
-
-/* Write line containing shadow password entry to stream.  */
-extern int putspent (__const struct spwd *__p, FILE *__stream) __THROW;
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern void setspent (void);
+
+/* Close database.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern void endspent (void);
+
+/* Get next entry from database, perhaps after opening the file.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern struct spwd *getspent (void);
+
+/* Get shadow entry matching NAME.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern struct spwd *getspnam (__const char *__name);
+
+/* Read shadow entry from STRING.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern struct spwd *sgetspent (__const char *__string);
+
+/* Read next shadow entry from STREAM.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern struct spwd *fgetspent (FILE *__stream);
+
+/* Write line containing shadow password entry to stream.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int putspent (__const struct spwd *__p, FILE *__stream);
 
 
 #ifdef __USE_MISC
-/* Reentrant versions of some of the functions above.  */
+/* Reentrant versions of some of the functions above.
+
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
 extern int getspent_r (struct spwd *__result_buf, char *__buffer,
-		       size_t __buflen, struct spwd **__result) __THROW;
+		       size_t __buflen, struct spwd **__result);
 
 extern int getspnam_r (__const char *__name, struct spwd *__result_buf,
 		       char *__buffer, size_t __buflen,
-		       struct spwd **__result)__THROW;
+		       struct spwd **__result);
 
 extern int sgetspent_r (__const char *__string, struct spwd *__result_buf,
 			char *__buffer, size_t __buflen,
-			struct spwd **__result) __THROW;
+			struct spwd **__result);
 
 extern int fgetspent_r (FILE *__stream, struct spwd *__result_buf,
 			char *__buffer, size_t __buflen,
-			struct spwd **__result) __THROW;
+			struct spwd **__result);
 #endif	/* misc */
 
+
+/* The simple locking functionality provided here is not suitable for
+   multi-threaded applications.  */
+
 /* Protect password file against multi writers.  */
 extern int lckpwdf (void) __THROW;
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/Makefile libc-20030708/signal/Makefile
--- glibc-2.3.2/signal/Makefile	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/signal/Makefile	2003-07-08 22:58:09.000000000 +0900
@@ -1,4 +1,5 @@
-# Copyright (C) 1991, 92, 93, 94, 95, 96, 97, 98 Free Software Foundation, Inc.
+# Copyright (C) 1991,1992,1993,1994,1995,1996,1997,1998,2003
+#	Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -37,9 +38,15 @@
 		   allocrtsig sigtimedwait sigwaitinfo sigqueue \
 		   sighold sigrelse sigignore sigset
 
-tests		:= tst-signal
+tests		:= tst-signal tst-sigset tst-sigsimple
 
 distribute	:= sigsetops.h testrtsig.h sigset-cvt-mask.h
 
 
 include ../Rules
+
+CFLAGS-sigpause.c = -fexceptions
+CFLAGS-sigsuspend.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-sigtimedwait.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-sigwait.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-sigwaitinfo.c = -fexceptions -fasynchronous-unwind-tables
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/sigaddset.c libc-20030708/signal/sigaddset.c
--- glibc-2.3.2/signal/sigaddset.c	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/signal/sigaddset.c	2003-05-02 00:11:50.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1996 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1996, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,3 +32,4 @@
 
   return __sigaddset (set, signo);
 }
+libc_hidden_def (sigaddset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/sigdelset.c libc-20030708/signal/sigdelset.c
--- glibc-2.3.2/signal/sigdelset.c	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/signal/sigdelset.c	2003-05-02 00:11:50.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1996 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1996, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,3 +32,4 @@
 
   return __sigdelset (set, signo);
 }
+libc_hidden_def (sigdelset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/sigfillset.c libc-20030708/signal/sigfillset.c
--- glibc-2.3.2/signal/sigfillset.c	2002-08-04 11:19:59.000000000 +0900
+++ libc-20030708/signal/sigfillset.c	1970-01-01 09:00:00.000000000 +0900
@@ -1,38 +0,0 @@
-/* Copyright (C) 1991,96,97,2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <errno.h>
-#include <signal.h>
-#include <string.h>
-
-/* Set all signals in SET.  */
-int
-sigfillset (set)
-     sigset_t *set;
-{
-  if (set == NULL)
-    {
-      __set_errno (EINVAL);
-      return -1;
-    }
-
-  memset (set, 0xff, sizeof (sigset_t));
-
-  return 0;
-}
-libc_hidden_def (sigfillset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/sighold.c libc-20030708/signal/sighold.c
--- glibc-2.3.2/signal/sighold.c	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/signal/sighold.c	2003-04-28 23:53:22.000000000 +0900
@@ -1,5 +1,5 @@
 /* Add SIG to the calling process' signal mask.
-   Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -33,7 +33,7 @@
     return -1;
 
   /* Add the specified signal.  */
-  if (__sigaddset (&set, sig) < 0)
+  if (sigaddset (&set, sig) < 0)
     return -1;
 
   /* Set the new mask.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/signal.h libc-20030708/signal/signal.h
--- glibc-2.3.2/signal/signal.h	2003-02-20 05:39:25.000000000 +0900
+++ libc-20030708/signal/signal.h	2003-04-28 23:53:22.000000000 +0900
@@ -142,8 +142,11 @@
    BSD definition defines the argument as a mask of the signal, while
    the more modern interface in X/Open defines it as the signal
    number.  We go with the BSD version unless the user explicitly
-   selects the X/Open version.  */
-extern int __sigpause (int __sig_or_mask, int __is_sig) __THROW;
+   selects the X/Open version.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int __sigpause (int __sig_or_mask, int __is_sig);
 
 #ifdef __USE_BSD
 /* Set the mask of blocked signals to MASK,
@@ -153,7 +156,7 @@
 #else
 # ifdef __USE_XOPEN
 #  ifdef __GNUC__
-extern int sigpause (int __sig) __THROW __asm__ ("__xpg_sigpause");
+extern int sigpause (int __sig) __asm__ ("__xpg_sigpause");
 #  endif
 /* Remove a signal from the signal mask and suspend the process.  */
 #  define sigpause(sig) __sigpause ((sig), 1)
@@ -242,8 +245,11 @@
 			sigset_t *__restrict __oset) __THROW;
 
 /* Change the set of blocked signals to SET,
-   wait until a signal arrives, and restore the set of blocked signals.  */
-extern int sigsuspend (__const sigset_t *__set) __THROW;
+   wait until a signal arrives, and restore the set of blocked signals.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int sigsuspend (__const sigset_t *__set);
 
 /* Get and/or set the action for signal SIG.  */
 extern int sigaction (int __sig, __const struct sigaction *__restrict __act,
@@ -253,21 +259,28 @@
 extern int sigpending (sigset_t *__set) __THROW;
 
 
-/* Select any of pending signals from SET or wait for any to arrive.  */
-extern int sigwait (__const sigset_t *__restrict __set, int *__restrict __sig)
-     __THROW;
+/* Select any of pending signals from SET or wait for any to arrive.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int sigwait (__const sigset_t *__restrict __set, int *__restrict __sig);
 
 # ifdef __USE_POSIX199309
-/* Select any of pending signals from SET and place information in INFO.  */
+/* Select any of pending signals from SET and place information in INFO.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int sigwaitinfo (__const sigset_t *__restrict __set,
-			siginfo_t *__restrict __info) __THROW;
+			siginfo_t *__restrict __info);
 
 /* Select any of pending signals from SET and place information in INFO.
-   Wait the time specified by TIMEOUT if no signal is pending.  */
+   Wait the time specified by TIMEOUT if no signal is pending.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int sigtimedwait (__const sigset_t *__restrict __set,
 			 siginfo_t *__restrict __info,
-			 __const struct timespec *__restrict __timeout)
-     __THROW;
+			 __const struct timespec *__restrict __timeout);
 
 /* Send signal SIG to the process PID.  Associate data in VAL with the
    signal.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/sigrelse.c libc-20030708/signal/sigrelse.c
--- glibc-2.3.2/signal/sigrelse.c	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/signal/sigrelse.c	2003-04-28 23:53:22.000000000 +0900
@@ -1,5 +1,5 @@
 /* Remove SIG from the calling process' signal mask.
-   Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -33,7 +33,7 @@
     return -1;
 
   /* Remove the specified signal.  */
-  if (__sigdelset (&set, sig) < 0)
+  if (sigdelset (&set, sig) < 0)
     return -1;
 
   /* Set the new mask.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/tst-sigset.c libc-20030708/signal/tst-sigset.c
--- glibc-2.3.2/signal/tst-sigset.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/signal/tst-sigset.c	2003-04-01 15:49:23.000000000 +0900
@@ -0,0 +1,43 @@
+/* Test sig*set functions.  */
+
+#include <signal.h>
+#include <stdio.h>
+
+#define TEST_FUNCTION do_test ()
+static int
+do_test (void)
+{
+  int result = 0;
+  int sig = -1;
+
+#define TRY(call)							      \
+  if (call)								      \
+    {									      \
+      printf ("%s (sig = %d): %m\n", #call, sig);			      \
+      result = 1;							      \
+    }									      \
+  else
+
+
+  sigset_t set;
+  TRY (sigemptyset (&set) != 0);
+
+#ifdef SIGRTMAX
+  int max_sig = SIGRTMAX;
+#else
+  int max_sig = NSIG - 1;
+#endif
+
+  for (sig = 1; sig <= max_sig; ++sig)
+    {
+      TRY (sigismember (&set, sig) != 0);
+      TRY (sigaddset (&set, sig) != 0);
+      TRY (sigismember (&set, sig) == 0);
+      TRY (sigdelset (&set, sig) != 0);
+      TRY (sigismember (&set, sig) != 0);
+    }
+
+  return result;
+}
+
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/signal/tst-sigsimple.c libc-20030708/signal/tst-sigsimple.c
--- glibc-2.3.2/signal/tst-sigsimple.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/signal/tst-sigsimple.c	2003-04-18 08:29:08.000000000 +0900
@@ -0,0 +1,57 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <signal.h>
+#include <stdio.h>
+#include <string.h>
+
+
+static int
+do_test (void)
+{
+  int result = 0;
+  int e;
+
+#define RUN(test) \
+  errno = 0;								      \
+  e = test;								      \
+  if (e != -1)								      \
+    {									      \
+      printf ("%s returned %d\n", #test, e);				      \
+      result = 1;							      \
+    }									      \
+  else if (errno != EINVAL)						      \
+    {									      \
+      printf ("%s didn't set errno to EINVAL (%s instead)\n",		      \
+	      #test, strerror (errno));					      \
+      result = 1;							      \
+    }
+
+  RUN (sighold (-1));
+  RUN (sighold (_NSIG + 100));
+
+  RUN (sigrelse (-1));
+  RUN (sigrelse (_NSIG + 100));
+
+  return result;
+}
+
+#define TEST_FUNCTION do_test ()
+#include "../test-skeleton.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/socket/sys/socket.h libc-20030708/socket/sys/socket.h
--- glibc-2.3.2/socket/sys/socket.h	2001-07-08 04:21:17.000000000 +0900
+++ libc-20030708/socket/sys/socket.h	2003-04-28 23:53:22.000000000 +0900
@@ -1,5 +1,5 @@
 /* Declarations of socket constants, types, and functions.
-   Copyright (C) 1991,92,1994-1999,2000,2001 Free Software Foundation, Inc.
+   Copyright (C) 1991,92,1994-2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -117,9 +117,11 @@
 /* Open a connection on socket FD to peer at ADDR (which LEN bytes long).
    For connectionless socket types, just set the default address to send to
    and the only address from which to accept transmissions.
-   Return 0 on success, -1 for errors.  */
-extern int connect (int __fd, __CONST_SOCKADDR_ARG __addr, socklen_t __len)
-     __THROW;
+   Return 0 on success, -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int connect (int __fd, __CONST_SOCKADDR_ARG __addr, socklen_t __len);
 
 /* Put the address of the peer connected to socket FD into *ADDR
    (which is *LEN bytes long), and its actual length into *LEN.  */
@@ -127,39 +129,54 @@
 			socklen_t *__restrict __len) __THROW;
 
 
-/* Send N bytes of BUF to socket FD.  Returns the number sent or -1.  */
-extern ssize_t send (int __fd, __const void *__buf, size_t __n, int __flags)
-     __THROW;
+/* Send N bytes of BUF to socket FD.  Returns the number sent or -1.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t send (int __fd, __const void *__buf, size_t __n, int __flags);
 
 /* Read N bytes into BUF from socket FD.
-   Returns the number read or -1 for errors.  */
-extern ssize_t recv (int __fd, void *__buf, size_t __n, int __flags)
-     __THROW;
+   Returns the number read or -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t recv (int __fd, void *__buf, size_t __n, int __flags);
 
 /* Send N bytes of BUF on socket FD to peer at address ADDR (which is
-   ADDR_LEN bytes long).  Returns the number sent, or -1 for errors.  */
+   ADDR_LEN bytes long).  Returns the number sent, or -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern ssize_t sendto (int __fd, __const void *__buf, size_t __n,
 		       int __flags, __CONST_SOCKADDR_ARG __addr,
-		       socklen_t __addr_len) __THROW;
+		       socklen_t __addr_len);
 
 /* Read N bytes into BUF through socket FD.
    If ADDR is not NULL, fill in *ADDR_LEN bytes of it with tha address of
    the sender, and store the actual size of the address in *ADDR_LEN.
-   Returns the number of bytes read or -1 for errors.  */
-extern ssize_t recvfrom (int __fd, void *__restrict __buf, size_t __n, int __flags,
-			 __SOCKADDR_ARG __addr, socklen_t *__restrict __addr_len)
-     __THROW;
+   Returns the number of bytes read or -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t recvfrom (int __fd, void *__restrict __buf, size_t __n,
+			 int __flags, __SOCKADDR_ARG __addr,
+			 socklen_t *__restrict __addr_len);
 
 
 /* Send a message described MESSAGE on socket FD.
-   Returns the number of bytes sent, or -1 for errors.  */
-extern ssize_t sendmsg (int __fd, __const struct msghdr *__message, int __flags)
-     __THROW;
+   Returns the number of bytes sent, or -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t sendmsg (int __fd, __const struct msghdr *__message,
+			int __flags);
 
 /* Receive a message as described by MESSAGE from socket FD.
-   Returns the number of bytes read or -1 for errors.  */
-extern ssize_t recvmsg (int __fd, struct msghdr *__message, int __flags)
-     __THROW;
+   Returns the number of bytes read or -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern ssize_t recvmsg (int __fd, struct msghdr *__message, int __flags);
 
 
 /* Put the current value for socket FD's option OPTNAME at protocol level LEVEL
@@ -185,10 +202,12 @@
    When a connection arrives, open a new socket to communicate with it,
    set *ADDR (which is *ADDR_LEN bytes long) to the address of the connecting
    peer and *ADDR_LEN to the address's actual length, and return the
-   new socket's descriptor, or -1 for errors.  */
+   new socket's descriptor, or -1 for errors.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int accept (int __fd, __SOCKADDR_ARG __addr,
-		   socklen_t *__restrict __addr_len)
-     __THROW;
+		   socklen_t *__restrict __addr_len);
 
 /* Shut down all or part of the connection open on socket FD.
    HOW determines what to shut down:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/soft-fp/soft-fp.h libc-20030708/soft-fp/soft-fp.h
--- glibc-2.3.2/soft-fp/soft-fp.h	2002-11-02 11:15:53.000000000 +0900
+++ libc-20030708/soft-fp/soft-fp.h	2003-06-12 08:54:03.000000000 +0900
@@ -1,5 +1,5 @@
 /* Software floating-point emulation.
-   Copyright (C) 1997,1998,1999,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997,1998,1999,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson (rth@cygnus.com),
 		  Jakub Jelinek (jj@ultra.linux.cz),
@@ -55,7 +55,7 @@
 #define FP_EX_OVERFLOW		0
 #endif
 #ifndef FP_EX_UNDERFLOW
-#define FP_EX_UNDERFLOW		
+#define FP_EX_UNDERFLOW		0
 #endif
 #ifndef FP_EX_DIVZERO
 #define FP_EX_DIVZERO		0
@@ -74,7 +74,7 @@
 #else
 #define FP_DECL_EX int _fex = 0
 #endif
-  
+
 #ifndef FP_INIT_ROUNDMODE
 #define FP_INIT_ROUNDMODE do {} while (0)
 #endif
@@ -94,7 +94,7 @@
 
 #define FP_SET_EXCEPTION(ex)				\
   _fex |= (ex)
-  
+
 #define FP_UNSET_EXCEPTION(ex)				\
   _fex &= ~(ex)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/Makefile libc-20030708/stdio-common/Makefile
--- glibc-2.3.2/stdio-common/Makefile	2003-01-31 04:26:54.000000000 +0900
+++ libc-20030708/stdio-common/Makefile	2003-06-12 08:54:04.000000000 +0900
@@ -38,11 +38,9 @@
 
 install-others = $(inst_includedir)/bits/stdio_lim.h
 
-generated = errlist-compat.c
-
 include ../Makeconfig
 
-aux	:= errlist siglist
+aux	:= errlist siglist printf-parsemb printf-parsewc
 distribute := _itoa.h _itowa.h _i18n_number.h \
 	      printf-parse.h stdio_lim.h.in tst-unbputc.sh tst-printf.sh
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/_itoa.c libc-20030708/stdio-common/_itoa.c
--- glibc-2.3.2/stdio-common/_itoa.c	2002-03-13 04:27:44.000000000 +0900
+++ libc-20030708/stdio-common/_itoa.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,6 @@
 /* Internal function for converting integers to ASCII.
-   Copyright (C) 1994,1995,1996,1999,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1994, 1995, 1996, 1999, 2000, 2002, 2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Torbjorn Granlund <tege@matematik.su.se>
    and Ulrich Drepper <drepper@gnu.org>.
@@ -81,41 +82,41 @@
 const struct base_table_t _itoa_base_table[] attribute_hidden =
 {
 #if BITS_PER_MP_LIMB == 64
-  /*  2 */ {SEL1(0ul) 1, 1},
-  /*  3 */ {SEL1(0xaaaaaaaaaaaaaaabul) 0, 1},
-  /*  4 */ {SEL1(0ul) 1, 2},
-  /*  5 */ {SEL1(0xcccccccccccccccdul) 0, 2},
-  /*  6 */ {SEL1(0xaaaaaaaaaaaaaaabul) 0, 2},
-  /*  7 */ {SEL1(0x2492492492492493ul) 1, 3},
-  /*  8 */ {SEL1(0ul) 1, 3},
-  /*  9 */ {SEL1(0xe38e38e38e38e38ful) 0, 3},
-  /* 10 */ {SEL1(0xcccccccccccccccdul) 0, 3},
-  /* 11 */ {SEL1(0x2e8ba2e8ba2e8ba3ul) 0, 1},
-  /* 12 */ {SEL1(0xaaaaaaaaaaaaaaabul) 0, 3},
-  /* 13 */ {SEL1(0x4ec4ec4ec4ec4ec5ul) 0, 2},
-  /* 14 */ {SEL1(0x2492492492492493ul) 1, 4},
-  /* 15 */ {SEL1(0x8888888888888889ul) 0, 3},
-  /* 16 */ {SEL1(0ul) 1, 4},
-  /* 17 */ {SEL1(0xf0f0f0f0f0f0f0f1ul) 0, 4},
-  /* 18 */ {SEL1(0xe38e38e38e38e38ful) 0, 4},
-  /* 19 */ {SEL1(0xd79435e50d79435ful) 0, 4},
-  /* 20 */ {SEL1(0xcccccccccccccccdul) 0, 4},
-  /* 21 */ {SEL1(0x8618618618618619ul) 1, 5},
-  /* 22 */ {SEL1(0x2e8ba2e8ba2e8ba3ul) 0, 2},
-  /* 23 */ {SEL1(0x642c8590b21642c9ul) 1, 5},
-  /* 24 */ {SEL1(0xaaaaaaaaaaaaaaabul) 0, 4},
-  /* 25 */ {SEL1(0x47ae147ae147ae15ul) 1, 5},
-  /* 26 */ {SEL1(0x4ec4ec4ec4ec4ec5ul) 0, 3},
-  /* 27 */ {SEL1(0x97b425ed097b425ful) 0, 4},
-  /* 28 */ {SEL1(0x2492492492492493ul) 1, 5},
-  /* 29 */ {SEL1(0x1a7b9611a7b9611bul) 1, 5},
-  /* 30 */ {SEL1(0x8888888888888889ul) 0, 4},
-  /* 31 */ {SEL1(0x0842108421084211ul) 1, 5},
-  /* 32 */ {SEL1(0ul) 1, 5},
-  /* 33 */ {SEL1(0x0f83e0f83e0f83e1ul) 0, 1},
-  /* 34 */ {SEL1(0xf0f0f0f0f0f0f0f1ul) 0, 5},
-  /* 35 */ {SEL1(0xea0ea0ea0ea0ea0ful) 0, 5},
-  /* 36 */ {SEL1(0xe38e38e38e38e38ful) 0, 5}
+  /*  2 */ {SEL1(0ull) 1, 1},
+  /*  3 */ {SEL1(0xaaaaaaaaaaaaaaabull) 0, 1},
+  /*  4 */ {SEL1(0ull) 1, 2},
+  /*  5 */ {SEL1(0xcccccccccccccccdull) 0, 2},
+  /*  6 */ {SEL1(0xaaaaaaaaaaaaaaabull) 0, 2},
+  /*  7 */ {SEL1(0x2492492492492493ull) 1, 3},
+  /*  8 */ {SEL1(0ull) 1, 3},
+  /*  9 */ {SEL1(0xe38e38e38e38e38full) 0, 3},
+  /* 10 */ {SEL1(0xcccccccccccccccdull) 0, 3},
+  /* 11 */ {SEL1(0x2e8ba2e8ba2e8ba3ull) 0, 1},
+  /* 12 */ {SEL1(0xaaaaaaaaaaaaaaabull) 0, 3},
+  /* 13 */ {SEL1(0x4ec4ec4ec4ec4ec5ull) 0, 2},
+  /* 14 */ {SEL1(0x2492492492492493ull) 1, 4},
+  /* 15 */ {SEL1(0x8888888888888889ull) 0, 3},
+  /* 16 */ {SEL1(0ull) 1, 4},
+  /* 17 */ {SEL1(0xf0f0f0f0f0f0f0f1ull) 0, 4},
+  /* 18 */ {SEL1(0xe38e38e38e38e38full) 0, 4},
+  /* 19 */ {SEL1(0xd79435e50d79435full) 0, 4},
+  /* 20 */ {SEL1(0xcccccccccccccccdull) 0, 4},
+  /* 21 */ {SEL1(0x8618618618618619ull) 1, 5},
+  /* 22 */ {SEL1(0x2e8ba2e8ba2e8ba3ull) 0, 2},
+  /* 23 */ {SEL1(0x642c8590b21642c9ull) 1, 5},
+  /* 24 */ {SEL1(0xaaaaaaaaaaaaaaabull) 0, 4},
+  /* 25 */ {SEL1(0x47ae147ae147ae15ull) 1, 5},
+  /* 26 */ {SEL1(0x4ec4ec4ec4ec4ec5ull) 0, 3},
+  /* 27 */ {SEL1(0x97b425ed097b425full) 0, 4},
+  /* 28 */ {SEL1(0x2492492492492493ull) 1, 5},
+  /* 29 */ {SEL1(0x1a7b9611a7b9611bull) 1, 5},
+  /* 30 */ {SEL1(0x8888888888888889ull) 0, 4},
+  /* 31 */ {SEL1(0x0842108421084211ull) 1, 5},
+  /* 32 */ {SEL1(0ull) 1, 5},
+  /* 33 */ {SEL1(0x0f83e0f83e0f83e1ull) 0, 1},
+  /* 34 */ {SEL1(0xf0f0f0f0f0f0f0f1ull) 0, 5},
+  /* 35 */ {SEL1(0xea0ea0ea0ea0ea0full) 0, 5},
+  /* 36 */ {SEL1(0xe38e38e38e38e38full) 0, 5}
 #endif
 #if BITS_PER_MP_LIMB == 32
   /*  2 */ {SEL1(0ul) 1, 1, {0, 31, 0x80000000ul SEL2(0xfffffffful)}},
@@ -423,3 +424,23 @@
 
   return buflim;
 }
+
+char *
+_fitoa_word (unsigned long value, char *buf, unsigned int base, int upper_case)
+{
+  char tmpbuf[sizeof (value) * 4];	      /* Worst case length: base 2.  */
+  char *cp = _itoa_word (value, tmpbuf + sizeof (value) * 4, base, upper_case);
+  while (cp < tmpbuf + sizeof (value) * 4)
+    *buf++ = *cp++;
+  return buf;
+}
+
+char *
+_fitoa (unsigned long long value, char *buf, unsigned int base, int upper_case)
+{
+  char tmpbuf[sizeof (value) * 4];	      /* Worst case length: base 2.  */
+  char *cp = _itoa (value, tmpbuf + sizeof (value) * 4, base, upper_case);
+  while (cp < tmpbuf + sizeof (value) * 4)
+    *buf++ = *cp++;
+  return buf;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/_itoa.h libc-20030708/stdio-common/_itoa.h
--- glibc-2.3.2/stdio-common/_itoa.h	2002-04-09 03:37:21.000000000 +0900
+++ libc-20030708/stdio-common/_itoa.h	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Internal function for converting integers to ASCII.
-   Copyright (C) 1994, 95, 96, 97, 98, 99, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1994,95,96,97,98,99,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -34,7 +34,7 @@
 extern const char _itoa_lower_digits[];
 extern const char _itoa_lower_digits_internal[] attribute_hidden;
 
-static inline char * __attribute__ ((unused))
+static inline char * __attribute__ ((unused, always_inline))
 _itoa_word (unsigned long value, char *buflim,
 	    unsigned int base, int upper_case)
 {
@@ -69,24 +69,11 @@
 }
 #undef SPECIAL
 
-static inline char * __attribute__ ((unused))
-_fitoa_word (unsigned long value, char *buf, unsigned int base, int upper_case)
-{
-  char tmpbuf[sizeof (value) * 4];		/* Worst case length: base 2.  */
-  char *cp = _itoa_word (value, tmpbuf + sizeof (value) * 4, base, upper_case);
-  while (cp < tmpbuf + sizeof (value) * 4)
-    *buf++ = *cp++;
-  return buf;
-}
-
-static inline char * __attribute__ ((unused))
-_fitoa (unsigned long long value, char *buf, unsigned int base, int upper_case)
-{
-  char tmpbuf[sizeof (value) * 4];		/* Worst case length: base 2.  */
-  char *cp = _itoa (value, tmpbuf + sizeof (value) * 4, base, upper_case);
-  while (cp < tmpbuf + sizeof (value) * 4)
-    *buf++ = *cp++;
-  return buf;
-}
+/* Similar to the _itoa functions, but output starts at buf and pointer
+   after the last written character is returned.  */
+extern char *_fitoa_word (unsigned long value, char *buf, unsigned int base,
+			  int upper_case) attribute_hidden;
+extern char *_fitoa (unsigned long long value, char *buf, unsigned int base,
+		     int upper_case) attribute_hidden;
 
 #endif	/* itoa.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/_itowa.h libc-20030708/stdio-common/_itowa.h
--- glibc-2.3.2/stdio-common/_itowa.h	2002-03-13 04:19:19.000000000 +0900
+++ libc-20030708/stdio-common/_itowa.h	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Internal function for converting integers to ASCII.
-   Copyright (C) 1994, 95, 96, 97, 98, 99, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1994,95,96,97,98,99,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,7 +31,7 @@
 			unsigned int base, int upper_case);
 
 static inline wchar_t *
-__attribute__ ((unused))
+__attribute__ ((unused, always_inline))
 _itowa_word (unsigned long value, wchar_t *buflim,
 	     unsigned int base, int upper_case)
 {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/perror.c libc-20030708/stdio-common/perror.c
--- glibc-2.3.2/stdio-common/perror.c	2002-08-11 03:09:08.000000000 +0900
+++ libc-20030708/stdio-common/perror.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1993,1997,1998,2000-2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1993,1997,1998,2000-2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -55,7 +55,6 @@
 perror (const char *s)
 {
   int errnum = errno;
-#ifdef USE_IN_LIBIO
   FILE *fp;
   int fd = -1;
 
@@ -83,11 +82,6 @@
       perror_internal (fp, s, errnum);
       /* Close the stream.  */
       fclose (fp);
-
-      ((_IO_FILE *) stderr)->_offset = _IO_pos_BAD;
     }
-#else
-  perror_internal (stderr, s, errnum);
-#endif
 }
 libc_hidden_def (perror)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/printf-parse.h libc-20030708/stdio-common/printf-parse.h
--- glibc-2.3.2/stdio-common/printf-parse.h	2002-11-02 11:15:53.000000000 +0900
+++ libc-20030708/stdio-common/printf-parse.h	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Internal header for parsing printf format strings.
-   Copyright (C) 1995-1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of th GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,15 +17,9 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <ctype.h>
-#include <limits.h>
 #include <printf.h>
 #include <stdint.h>
 #include <stddef.h>
-#include <string.h>
-
-#define NDEBUG 1
-#include <assert.h>
 
 
 struct printf_spec
@@ -51,17 +45,13 @@
 /* The various kinds off arguments that can be passed to printf.  */
 union printf_arg
   {
-    unsigned char pa_char;
     wchar_t pa_wchar;
-    short int pa_short_int;
     int pa_int;
     long int pa_long_int;
     long long int pa_long_long_int;
-    unsigned short int pa_u_short_int;
     unsigned int pa_u_int;
     unsigned long int pa_u_long_int;
     unsigned long long int pa_u_long_long_int;
-    float pa_float;
     double pa_double;
     long double pa_long_double;
     const char *pa_string;
@@ -70,9 +60,10 @@
   };
 
 
+#ifndef DONT_NEED_READ_INT
 /* Read a simple integer from a string and update the string pointer.
    It is assumed that the first character is a digit.  */
-static inline unsigned int
+static unsigned int
 read_int (const UCHAR_T * *pstr)
 {
   unsigned int retval = **pstr - L_('0');
@@ -85,35 +76,7 @@
 
   return retval;
 }
-
-
-
-/* Find the next spec in FORMAT, or the end of the string.  Returns
-   a pointer into FORMAT, to a '%' or a '\0'.  */
-static inline const UCHAR_T *
-#ifdef COMPILE_WPRINTF
-find_spec (const UCHAR_T *format)
-#else
-find_spec (const UCHAR_T *format, mbstate_t *ps)
-#endif
-{
-#ifdef COMPILE_WPRINTF
-  return (const UCHAR_T *) __wcschrnul ((const CHAR_T *) format, L'%');
-#else
-  while (*format != L_('\0') && *format != L_('%'))
-    {
-      int len;
-
-      /* Remove any hints of a wrong encoding.  */
-      ps->__count = 0;
-      if (! isascii (*format) && (len = __mbrlen (format, MB_CUR_MAX, ps)) > 0)
-	format += len;
-      else
-	++format;
-    }
-  return format;
 #endif
-}
 
 
 /* These are defined in reg-printf.c.  */
@@ -121,334 +84,25 @@
 extern printf_function **__printf_function_table attribute_hidden;
 
 
+/* Find the next spec in FORMAT, or the end of the string.  Returns
+   a pointer into FORMAT, to a '%' or a '\0'.  */
+extern const unsigned char *__find_specmb (const UCHAR_T *format,
+					   mbstate_t *ps) attribute_hidden;
+
+extern const unsigned int *__find_specwc (const UCHAR_T *format)
+     attribute_hidden;
+
+
 /* FORMAT must point to a '%' at the beginning of a spec.  Fills in *SPEC
    with the parsed details.  POSN is the number of arguments already
    consumed.  At most MAXTYPES - POSN types are filled in TYPES.  Return
    the number of args consumed by this spec; *MAX_REF_ARG is updated so it
    remains the highest argument index used.  */
-static inline size_t
-#ifdef COMPILE_WPRINTF
-parse_one_spec (const UCHAR_T *format, size_t posn, struct printf_spec *spec,
-		size_t *max_ref_arg)
-#else
-parse_one_spec (const UCHAR_T *format, size_t posn, struct printf_spec *spec,
-		size_t *max_ref_arg, mbstate_t *ps)
-#endif
-{
-  unsigned int n;
-  size_t nargs = 0;
-
-  /* Skip the '%'.  */
-  ++format;
-
-  /* Clear information structure.  */
-  spec->data_arg = -1;
-  spec->info.alt = 0;
-  spec->info.space = 0;
-  spec->info.left = 0;
-  spec->info.showsign = 0;
-  spec->info.group = 0;
-  spec->info.i18n = 0;
-  spec->info.pad = ' ';
-  spec->info.wide = sizeof (UCHAR_T) > 1;
-
-  /* Test for positional argument.  */
-  if (ISDIGIT (*format))
-    {
-      const UCHAR_T *begin = format;
-
-      n = read_int (&format);
-
-      if (n > 0 && *format == L_('$'))
-	/* Is positional parameter.  */
-	{
-	  ++format;		/* Skip the '$'.  */
-	  spec->data_arg = n - 1;
-	  *max_ref_arg = MAX (*max_ref_arg, n);
-	}
-      else
-	/* Oops; that was actually the width and/or 0 padding flag.
-	   Step back and read it again.  */
-	format = begin;
-    }
-
-  /* Check for spec modifiers.  */
-  do
-    {
-      switch (*format)
-	{
-	case L_(' '):
-	  /* Output a space in place of a sign, when there is no sign.  */
-	  spec->info.space = 1;
-	  continue;
-	case L_('+'):
-	  /* Always output + or - for numbers.  */
-	  spec->info.showsign = 1;
-	  continue;
-	case L_('-'):
-	  /* Left-justify things.  */
-	  spec->info.left = 1;
-	  continue;
-	case L_('#'):
-	  /* Use the "alternate form":
-	     Hex has 0x or 0X, FP always has a decimal point.  */
-	  spec->info.alt = 1;
-	  continue;
-	case L_('0'):
-	  /* Pad with 0s.  */
-	  spec->info.pad = '0';
-	  continue;
-	case L_('\''):
-	  /* Show grouping in numbers if the locale information
-	     indicates any.  */
-	  spec->info.group = 1;
-	  continue;
-	case L_('I'):
-	  /* Use the internationalized form of the output.  Currently
-	     means to use the `outdigits' of the current locale.  */
-	  spec->info.i18n = 1;
-	  continue;
-	default:
-	  break;
-	}
-      break;
-    }
-  while (*++format);
-
-  if (spec->info.left)
-    spec->info.pad = ' ';
-
-  /* Get the field width.  */
-  spec->width_arg = -1;
-  spec->info.width = 0;
-  if (*format == L_('*'))
-    {
-      /* The field width is given in an argument.
-	 A negative field width indicates left justification.  */
-      const UCHAR_T *begin = ++format;
-
-      if (ISDIGIT (*format))
-	{
-	  /* The width argument might be found in a positional parameter.  */
-	  n = read_int (&format);
-
-	  if (n > 0 && *format == L_('$'))
-	    {
-	      spec->width_arg = n - 1;
-	      *max_ref_arg = MAX (*max_ref_arg, n);
-	      ++format;		/* Skip '$'.  */
-	    }
-	}
-
-      if (spec->width_arg < 0)
-	{
-	  /* Not in a positional parameter.  Consume one argument.  */
-	  spec->width_arg = posn++;
-	  ++nargs;
-	  format = begin;	/* Step back and reread.  */
-	}
-    }
-  else if (ISDIGIT (*format))
-    /* Constant width specification.  */
-    spec->info.width = read_int (&format);
-
-  /* Get the precision.  */
-  spec->prec_arg = -1;
-  /* -1 means none given; 0 means explicit 0.  */
-  spec->info.prec = -1;
-  if (*format == L_('.'))
-    {
-      ++format;
-      if (*format == L_('*'))
-	{
-	  /* The precision is given in an argument.  */
-	  const UCHAR_T *begin = ++format;
-
-	  if (ISDIGIT (*format))
-	    {
-	      n = read_int (&format);
-
-	      if (n > 0 && *format == L_('$'))
-		{
-		  spec->prec_arg = n - 1;
-		  *max_ref_arg = MAX (*max_ref_arg, n);
-		  ++format;
-		}
-	    }
-
-	  if (spec->prec_arg < 0)
-	    {
-	      /* Not in a positional parameter.  */
-	      spec->prec_arg = posn++;
-	      ++nargs;
-	      format = begin;
-	    }
-	}
-      else if (ISDIGIT (*format))
-	spec->info.prec = read_int (&format);
-      else
-	/* "%.?" is treated like "%.0?".  */
-	spec->info.prec = 0;
-    }
-
-  /* Check for type modifiers.  */
-  spec->info.is_long_double = 0;
-  spec->info.is_short = 0;
-  spec->info.is_long = 0;
-  spec->info.is_char = 0;
-
-  switch (*format++)
-    {
-    case L_('h'):
-      /* ints are short ints or chars.  */
-      if (*format != L_('h'))
-	spec->info.is_short = 1;
-      else
-	{
-	  ++format;
-	  spec->info.is_char = 1;
-	}
-      break;
-    case L_('l'):
-      /* ints are long ints.  */
-      spec->info.is_long = 1;
-      if (*format != L_('l'))
-	break;
-      ++format;
-      /* FALLTHROUGH */
-    case L_('L'):
-      /* doubles are long doubles, and ints are long long ints.  */
-    case L_('q'):
-      /* 4.4 uses this for long long.  */
-      spec->info.is_long_double = 1;
-      break;
-    case L_('z'):
-    case L_('Z'):
-      /* ints are size_ts.  */
-      assert (sizeof (size_t) <= sizeof (unsigned long long int));
-#if LONG_MAX != LONG_LONG_MAX
-      spec->info.is_long_double = sizeof (size_t) > sizeof (unsigned long int);
-#endif
-      spec->info.is_long = sizeof (size_t) > sizeof (unsigned int);
-      break;
-    case L_('t'):
-      assert (sizeof (ptrdiff_t) <= sizeof (long long int));
-#if LONG_MAX != LONG_LONG_MAX
-      spec->info.is_long_double = (sizeof (ptrdiff_t) > sizeof (long int));
-#endif
-      spec->info.is_long = sizeof (ptrdiff_t) > sizeof (int);
-      break;
-    case L_('j'):
-      assert (sizeof (uintmax_t) <= sizeof (unsigned long long int));
-#if LONG_MAX != LONG_LONG_MAX
-      spec->info.is_long_double = (sizeof (uintmax_t)
-				   > sizeof (unsigned long int));
-#endif
-      spec->info.is_long = sizeof (uintmax_t) > sizeof (unsigned int);
-      break;
-    default:
-      /* Not a recognized modifier.  Backup.  */
-      --format;
-      break;
-    }
-
-  /* Get the format specification.  */
-  spec->info.spec = (wchar_t) *format++;
-  if (__builtin_expect (__printf_function_table != NULL, 0)
-      && spec->info.spec <= UCHAR_MAX
-      && __printf_arginfo_table[spec->info.spec] != NULL)
-    /* We don't try to get the types for all arguments if the format
-       uses more than one.  The normal case is covered though.  */
-    spec->ndata_args = (*__printf_arginfo_table[spec->info.spec])
-      (&spec->info, 1, &spec->data_arg_type);
-  else
-    {
-      /* Find the data argument types of a built-in spec.  */
-      spec->ndata_args = 1;
-
-      switch (spec->info.spec)
-	{
-	case L'i':
-	case L'd':
-	case L'u':
-	case L'o':
-	case L'X':
-	case L'x':
-#if LONG_MAX != LONG_LONG_MAX
-	  if (spec->info.is_long_double)
-	    spec->data_arg_type = PA_INT|PA_FLAG_LONG_LONG;
-	  else
-#endif
-	    if (spec->info.is_long)
-	      spec->data_arg_type = PA_INT|PA_FLAG_LONG;
-	    else if (spec->info.is_short)
-	      spec->data_arg_type = PA_INT|PA_FLAG_SHORT;
-	    else if (spec->info.is_char)
-	      spec->data_arg_type = PA_CHAR;
-	    else
-	      spec->data_arg_type = PA_INT;
-	  break;
-	case L'e':
-	case L'E':
-	case L'f':
-	case L'F':
-	case L'g':
-	case L'G':
-	case L'a':
-	case L'A':
-	  if (spec->info.is_long_double)
-	    spec->data_arg_type = PA_DOUBLE|PA_FLAG_LONG_DOUBLE;
-	  else
-	    spec->data_arg_type = PA_DOUBLE;
-	  break;
-	case L'c':
-	  spec->data_arg_type = PA_CHAR;
-	  break;
-	case L'C':
-	  spec->data_arg_type = PA_WCHAR;
-	  break;
-	case L's':
-	  spec->data_arg_type = PA_STRING;
-	  break;
-	case L'S':
-	  spec->data_arg_type = PA_WSTRING;
-	  break;
-	case L'p':
-	  spec->data_arg_type = PA_POINTER;
-	  break;
-	case L'n':
-	  spec->data_arg_type = PA_INT|PA_FLAG_PTR;
-	  break;
-
-	case L'm':
-	default:
-	  /* An unknown spec will consume no args.  */
-	  spec->ndata_args = 0;
-	  break;
-	}
-    }
-
-  if (spec->data_arg == -1 && spec->ndata_args > 0)
-    {
-      /* There are args consumed, but no positional spec.  Use the
-	 next sequential arg position.  */
-      spec->data_arg = posn;
-      nargs += spec->ndata_args;
-    }
-
-  if (spec->info.spec == L'\0')
-    /* Format ended before this spec was complete.  */
-    spec->end_of_fmt = spec->next_fmt = format - 1;
-  else
-    {
-      /* Find the next format spec.  */
-      spec->end_of_fmt = format;
-#ifdef COMPILE_WPRINTF
-      spec->next_fmt = find_spec (format);
-#else
-      spec->next_fmt = find_spec (format, ps);
-#endif
-    }
-
-  return nargs;
-}
+extern size_t __parse_one_specmb (const unsigned char *format, size_t posn,
+				  struct printf_spec *spec,
+				  size_t *max_ref_arg, mbstate_t *ps)
+     attribute_hidden;
+
+extern size_t __parse_one_specwc (const unsigned int *format, size_t posn,
+				  struct printf_spec *spec,
+				  size_t *max_ref_arg) attribute_hidden;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/printf-parsemb.c libc-20030708/stdio-common/printf-parsemb.c
--- glibc-2.3.2/stdio-common/printf-parsemb.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/stdio-common/printf-parsemb.c	2003-07-08 22:58:09.000000000 +0900
@@ -0,0 +1,409 @@
+/* Helper functions for parsing printf format strings.
+   Copyright (C) 1995-1999, 2000, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of th GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <ctype.h>
+#include <limits.h>
+#include <stdlib.h>
+#include <string.h>
+#include <sys/param.h>
+#include <wchar.h>
+#include <wctype.h>
+
+#ifndef COMPILE_WPRINTF
+# define CHAR_T		char
+# define UCHAR_T	unsigned char
+# define INT_T		int
+# define L_(Str)	Str
+# define ISDIGIT(Ch)	isdigit (Ch)
+#else
+# define CHAR_T		wchar_t
+# define UCHAR_T	unsigned int
+# define INT_T		wint_t
+# define L_(Str)	L##Str
+# define ISDIGIT(Ch)	iswdigit (Ch)
+#endif
+
+#include "printf-parse.h"
+
+#define NDEBUG 1
+#include <assert.h>
+
+
+
+/* Find the next spec in FORMAT, or the end of the string.  Returns
+   a pointer into FORMAT, to a '%' or a '\0'.  */
+const UCHAR_T *
+#ifdef COMPILE_WPRINTF
+__find_specwc (const UCHAR_T *format)
+#else
+__find_specmb (const UCHAR_T *format, mbstate_t *ps)
+#endif
+{
+#ifdef COMPILE_WPRINTF
+  return (const UCHAR_T *) __wcschrnul ((const CHAR_T *) format, L'%');
+#else
+  while (*format != L_('\0') && *format != L_('%'))
+    {
+      int len;
+
+      /* Remove any hints of a wrong encoding.  */
+      ps->__count = 0;
+      if (! isascii (*format) && (len = __mbrlen (format, MB_CUR_MAX, ps)) > 0)
+	format += len;
+      else
+	++format;
+    }
+  return format;
+#endif
+}
+
+
+/* FORMAT must point to a '%' at the beginning of a spec.  Fills in *SPEC
+   with the parsed details.  POSN is the number of arguments already
+   consumed.  At most MAXTYPES - POSN types are filled in TYPES.  Return
+   the number of args consumed by this spec; *MAX_REF_ARG is updated so it
+   remains the highest argument index used.  */
+size_t
+attribute_hidden
+#ifdef COMPILE_WPRINTF
+__parse_one_specwc (const UCHAR_T *format, size_t posn,
+		    struct printf_spec *spec, size_t *max_ref_arg)
+#else
+__parse_one_specmb (const UCHAR_T *format, size_t posn,
+		    struct printf_spec *spec, size_t *max_ref_arg,
+		    mbstate_t *ps)
+#endif
+{
+  unsigned int n;
+  size_t nargs = 0;
+
+  /* Skip the '%'.  */
+  ++format;
+
+  /* Clear information structure.  */
+  spec->data_arg = -1;
+  spec->info.alt = 0;
+  spec->info.space = 0;
+  spec->info.left = 0;
+  spec->info.showsign = 0;
+  spec->info.group = 0;
+  spec->info.i18n = 0;
+  spec->info.pad = ' ';
+  spec->info.wide = sizeof (UCHAR_T) > 1;
+
+  /* Test for positional argument.  */
+  if (ISDIGIT (*format))
+    {
+      const UCHAR_T *begin = format;
+
+      n = read_int (&format);
+
+      if (n > 0 && *format == L_('$'))
+	/* Is positional parameter.  */
+	{
+	  ++format;		/* Skip the '$'.  */
+	  spec->data_arg = n - 1;
+	  *max_ref_arg = MAX (*max_ref_arg, n);
+	}
+      else
+	/* Oops; that was actually the width and/or 0 padding flag.
+	   Step back and read it again.  */
+	format = begin;
+    }
+
+  /* Check for spec modifiers.  */
+  do
+    {
+      switch (*format)
+	{
+	case L_(' '):
+	  /* Output a space in place of a sign, when there is no sign.  */
+	  spec->info.space = 1;
+	  continue;
+	case L_('+'):
+	  /* Always output + or - for numbers.  */
+	  spec->info.showsign = 1;
+	  continue;
+	case L_('-'):
+	  /* Left-justify things.  */
+	  spec->info.left = 1;
+	  continue;
+	case L_('#'):
+	  /* Use the "alternate form":
+	     Hex has 0x or 0X, FP always has a decimal point.  */
+	  spec->info.alt = 1;
+	  continue;
+	case L_('0'):
+	  /* Pad with 0s.  */
+	  spec->info.pad = '0';
+	  continue;
+	case L_('\''):
+	  /* Show grouping in numbers if the locale information
+	     indicates any.  */
+	  spec->info.group = 1;
+	  continue;
+	case L_('I'):
+	  /* Use the internationalized form of the output.  Currently
+	     means to use the `outdigits' of the current locale.  */
+	  spec->info.i18n = 1;
+	  continue;
+	default:
+	  break;
+	}
+      break;
+    }
+  while (*++format);
+
+  if (spec->info.left)
+    spec->info.pad = ' ';
+
+  /* Get the field width.  */
+  spec->width_arg = -1;
+  spec->info.width = 0;
+  if (*format == L_('*'))
+    {
+      /* The field width is given in an argument.
+	 A negative field width indicates left justification.  */
+      const UCHAR_T *begin = ++format;
+
+      if (ISDIGIT (*format))
+	{
+	  /* The width argument might be found in a positional parameter.  */
+	  n = read_int (&format);
+
+	  if (n > 0 && *format == L_('$'))
+	    {
+	      spec->width_arg = n - 1;
+	      *max_ref_arg = MAX (*max_ref_arg, n);
+	      ++format;		/* Skip '$'.  */
+	    }
+	}
+
+      if (spec->width_arg < 0)
+	{
+	  /* Not in a positional parameter.  Consume one argument.  */
+	  spec->width_arg = posn++;
+	  ++nargs;
+	  format = begin;	/* Step back and reread.  */
+	}
+    }
+  else if (ISDIGIT (*format))
+    /* Constant width specification.  */
+    spec->info.width = read_int (&format);
+
+  /* Get the precision.  */
+  spec->prec_arg = -1;
+  /* -1 means none given; 0 means explicit 0.  */
+  spec->info.prec = -1;
+  if (*format == L_('.'))
+    {
+      ++format;
+      if (*format == L_('*'))
+	{
+	  /* The precision is given in an argument.  */
+	  const UCHAR_T *begin = ++format;
+
+	  if (ISDIGIT (*format))
+	    {
+	      n = read_int (&format);
+
+	      if (n > 0 && *format == L_('$'))
+		{
+		  spec->prec_arg = n - 1;
+		  *max_ref_arg = MAX (*max_ref_arg, n);
+		  ++format;
+		}
+	    }
+
+	  if (spec->prec_arg < 0)
+	    {
+	      /* Not in a positional parameter.  */
+	      spec->prec_arg = posn++;
+	      ++nargs;
+	      format = begin;
+	    }
+	}
+      else if (ISDIGIT (*format))
+	spec->info.prec = read_int (&format);
+      else
+	/* "%.?" is treated like "%.0?".  */
+	spec->info.prec = 0;
+    }
+
+  /* Check for type modifiers.  */
+  spec->info.is_long_double = 0;
+  spec->info.is_short = 0;
+  spec->info.is_long = 0;
+  spec->info.is_char = 0;
+
+  switch (*format++)
+    {
+    case L_('h'):
+      /* ints are short ints or chars.  */
+      if (*format != L_('h'))
+	spec->info.is_short = 1;
+      else
+	{
+	  ++format;
+	  spec->info.is_char = 1;
+	}
+      break;
+    case L_('l'):
+      /* ints are long ints.  */
+      spec->info.is_long = 1;
+      if (*format != L_('l'))
+	break;
+      ++format;
+      /* FALLTHROUGH */
+    case L_('L'):
+      /* doubles are long doubles, and ints are long long ints.  */
+    case L_('q'):
+      /* 4.4 uses this for long long.  */
+      spec->info.is_long_double = 1;
+      break;
+    case L_('z'):
+    case L_('Z'):
+      /* ints are size_ts.  */
+      assert (sizeof (size_t) <= sizeof (unsigned long long int));
+#if LONG_MAX != LONG_LONG_MAX
+      spec->info.is_long_double = sizeof (size_t) > sizeof (unsigned long int);
+#endif
+      spec->info.is_long = sizeof (size_t) > sizeof (unsigned int);
+      break;
+    case L_('t'):
+      assert (sizeof (ptrdiff_t) <= sizeof (long long int));
+#if LONG_MAX != LONG_LONG_MAX
+      spec->info.is_long_double = (sizeof (ptrdiff_t) > sizeof (long int));
+#endif
+      spec->info.is_long = sizeof (ptrdiff_t) > sizeof (int);
+      break;
+    case L_('j'):
+      assert (sizeof (uintmax_t) <= sizeof (unsigned long long int));
+#if LONG_MAX != LONG_LONG_MAX
+      spec->info.is_long_double = (sizeof (uintmax_t)
+				   > sizeof (unsigned long int));
+#endif
+      spec->info.is_long = sizeof (uintmax_t) > sizeof (unsigned int);
+      break;
+    default:
+      /* Not a recognized modifier.  Backup.  */
+      --format;
+      break;
+    }
+
+  /* Get the format specification.  */
+  spec->info.spec = (wchar_t) *format++;
+  if (__builtin_expect (__printf_function_table != NULL, 0)
+      && spec->info.spec <= UCHAR_MAX
+      && __printf_arginfo_table[spec->info.spec] != NULL)
+    /* We don't try to get the types for all arguments if the format
+       uses more than one.  The normal case is covered though.  */
+    spec->ndata_args = (*__printf_arginfo_table[spec->info.spec])
+      (&spec->info, 1, &spec->data_arg_type);
+  else
+    {
+      /* Find the data argument types of a built-in spec.  */
+      spec->ndata_args = 1;
+
+      switch (spec->info.spec)
+	{
+	case L'i':
+	case L'd':
+	case L'u':
+	case L'o':
+	case L'X':
+	case L'x':
+#if LONG_MAX != LONG_LONG_MAX
+	  if (spec->info.is_long_double)
+	    spec->data_arg_type = PA_INT|PA_FLAG_LONG_LONG;
+	  else
+#endif
+	    if (spec->info.is_long)
+	      spec->data_arg_type = PA_INT|PA_FLAG_LONG;
+	    else if (spec->info.is_short)
+	      spec->data_arg_type = PA_INT|PA_FLAG_SHORT;
+	    else if (spec->info.is_char)
+	      spec->data_arg_type = PA_CHAR;
+	    else
+	      spec->data_arg_type = PA_INT;
+	  break;
+	case L'e':
+	case L'E':
+	case L'f':
+	case L'F':
+	case L'g':
+	case L'G':
+	case L'a':
+	case L'A':
+	  if (spec->info.is_long_double)
+	    spec->data_arg_type = PA_DOUBLE|PA_FLAG_LONG_DOUBLE;
+	  else
+	    spec->data_arg_type = PA_DOUBLE;
+	  break;
+	case L'c':
+	  spec->data_arg_type = PA_CHAR;
+	  break;
+	case L'C':
+	  spec->data_arg_type = PA_WCHAR;
+	  break;
+	case L's':
+	  spec->data_arg_type = PA_STRING;
+	  break;
+	case L'S':
+	  spec->data_arg_type = PA_WSTRING;
+	  break;
+	case L'p':
+	  spec->data_arg_type = PA_POINTER;
+	  break;
+	case L'n':
+	  spec->data_arg_type = PA_INT|PA_FLAG_PTR;
+	  break;
+
+	case L'm':
+	default:
+	  /* An unknown spec will consume no args.  */
+	  spec->ndata_args = 0;
+	  break;
+	}
+    }
+
+  if (spec->data_arg == -1 && spec->ndata_args > 0)
+    {
+      /* There are args consumed, but no positional spec.  Use the
+	 next sequential arg position.  */
+      spec->data_arg = posn;
+      nargs += spec->ndata_args;
+    }
+
+  if (spec->info.spec == L'\0')
+    /* Format ended before this spec was complete.  */
+    spec->end_of_fmt = spec->next_fmt = format - 1;
+  else
+    {
+      /* Find the next format spec.  */
+      spec->end_of_fmt = format;
+#ifdef COMPILE_WPRINTF
+      spec->next_fmt = __find_specwc (format);
+#else
+      spec->next_fmt = __find_specmb (format, ps);
+#endif
+    }
+
+  return nargs;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/printf-parsewc.c libc-20030708/stdio-common/printf-parsewc.c
--- glibc-2.3.2/stdio-common/printf-parsewc.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/stdio-common/printf-parsewc.c	2003-06-12 07:05:47.000000000 +0900
@@ -0,0 +1,2 @@
+#define COMPILE_WPRINTF	1
+#include "printf-parsemb.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/printf-prs.c libc-20030708/stdio-common/printf-prs.c
--- glibc-2.3.2/stdio-common/printf-prs.c	2002-04-09 03:17:43.000000000 +0900
+++ libc-20030708/stdio-common/printf-prs.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,92,95,96,99,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991,92,95,96,99,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -70,6 +70,7 @@
 # endif
 #endif
 
+#define DONT_NEED_READ_INT
 #include "printf-parse.h"
 
 
@@ -88,10 +89,10 @@
   max_ref_arg = 0;
 
   /* Search for format specifications.  */
-  for (fmt = find_spec (fmt, &mbstate); *fmt != '\0'; fmt = spec.next_fmt)
+  for (fmt = __find_specmb (fmt, &mbstate); *fmt != '\0'; fmt = spec.next_fmt)
     {
       /* Parse this spec.  */
-      nargs += parse_one_spec (fmt, nargs, &spec, &max_ref_arg, &mbstate);
+      nargs += __parse_one_specmb (fmt, nargs, &spec, &max_ref_arg, &mbstate);
 
       /* If the width is determined by an argument this is an int.  */
       if (spec.width_arg != -1 && (size_t) spec.width_arg < n)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/reg-printf.c libc-20030708/stdio-common/reg-printf.c
--- glibc-2.3.2/stdio-common/reg-printf.c	2002-11-04 17:58:51.000000000 +0900
+++ libc-20030708/stdio-common/reg-printf.c	2003-04-15 23:55:47.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1996, 1997, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1996,1997,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -46,7 +46,7 @@
   if (__printf_function_table == NULL)
     {
       __printf_arginfo_table = (printf_arginfo_function **)
-	malloc ((UCHAR_MAX + 1) * sizeof (void *) * 2);
+	calloc (UCHAR_MAX + 1, sizeof (void *) * 2);
       if (__printf_arginfo_table == NULL)
 	return -1;
       __printf_function_table = (printf_function **)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/sscanf.c libc-20030708/stdio-common/sscanf.c
--- glibc-2.3.2/stdio-common/sscanf.c	2002-08-11 03:09:08.000000000 +0900
+++ libc-20030708/stdio-common/sscanf.c	2003-03-06 04:58:03.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,95,96,98,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1995,1996,1998,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -27,9 +27,7 @@
 /* Read formatted input from S, according to the format string FORMAT.  */
 /* VARARGS2 */
 int
-sscanf (s, format)
-     const char *s;
-     const char *format;
+sscanf (const char *s, const char *format, ...)
 {
   va_list arg;
   int done;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/tst-fphex.c libc-20030708/stdio-common/tst-fphex.c
--- glibc-2.3.2/stdio-common/tst-fphex.c	2002-10-24 10:15:31.000000000 +0900
+++ libc-20030708/stdio-common/tst-fphex.c	2003-07-08 22:58:09.000000000 +0900
@@ -39,7 +39,7 @@
       int n = snprintf (buf, sizeof buf, t->fmt, t->value);
       if (n != strlen (t->expect) || strcmp (buf, t->expect) != 0)
 	{
-	  printf ("%s\tExpected \"%s\" (%u)\n\tGot      \"%s\" (%d, %u)\n",
+	  printf ("%s\tExpected \"%s\" (%Zu)\n\tGot      \"%s\" (%d, %Zu)\n",
 		  t->fmt, t->expect, strlen (t->expect), buf, n, strlen (buf));
 	  result = 1;
 	}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/tst-sprintf.c libc-20030708/stdio-common/tst-sprintf.c
--- glibc-2.3.2/stdio-common/tst-sprintf.c	2001-12-14 16:13:14.000000000 +0900
+++ libc-20030708/stdio-common/tst-sprintf.c	2003-07-08 22:58:09.000000000 +0900
@@ -1,4 +1,5 @@
 #include <stdio.h>
+#include <stdlib.h>
 #include <string.h>
 
 
@@ -11,9 +12,30 @@
   if (sprintf (buf, "%.0ls", L"foo") != 0
       || strlen (buf) != 0)
     {
-      puts ("sprintf (buf, \"%.0ls\", L\"foo\") produced some output\n");
+      puts ("sprintf (buf, \"%.0ls\", L\"foo\") produced some output");
       result = 1;
     }
 
+#define SIZE (1024*70000)
+#define STR(x) #x
+
+  char *dst = malloc (SIZE + 1);
+
+  if (dst == NULL)
+    {
+      puts ("memory allocation failure");
+      result = 1;
+    }
+  else
+    {
+      sprintf (dst, "%*s", SIZE, "");
+      if (strnlen (dst, SIZE + 1) != SIZE)
+	{
+	  puts ("sprintf (dst, \"%*s\", " STR(SIZE) ", \"\") did not produce enough output");
+	  result = 1;
+	}
+      free (dst);
+    }
+
   return result;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/vfprintf.c libc-20030708/stdio-common/vfprintf.c
--- glibc-2.3.2/stdio-common/vfprintf.c	2003-01-31 03:30:25.000000000 +0900
+++ libc-20030708/stdio-common/vfprintf.c	2003-06-12 08:54:04.000000000 +0900
@@ -581,10 +581,8 @@
 	  else								      \
 	    if (is_long_num)						      \
 	      signed_number = args_value[fspec->data_arg].pa_long_int;	      \
-	    else if (!is_short)						      \
+	    else  /* `char' and `short int' will be promoted to `int'.  */    \
 	      signed_number = args_value[fspec->data_arg].pa_int;	      \
-	    else	      						      \
-	      signed_number = args_value[fspec->data_arg].pa_short_int;	      \
 									      \
 	  is_negative = signed_number < 0;				      \
 	  number.word = is_negative ? (- signed_number) : signed_number;      \
@@ -675,12 +673,12 @@
 	      number.word = args_value[fspec->data_arg].pa_u_long_int;	      \
 	    else if (is_char)						      \
 	      number.word = (unsigned char)				      \
-		args_value[fspec->data_arg].pa_char;			      \
+		args_value[fspec->data_arg].pa_u_int;			      \
 	    else if (!is_short)						      \
 	      number.word = args_value[fspec->data_arg].pa_u_int;	      \
 	    else							      \
 	      number.word = (unsigned short int)			      \
-		args_value[fspec->data_arg].pa_u_short_int;		      \
+		args_value[fspec->data_arg].pa_u_int;			      \
 									      \
 	LABEL (number):							      \
 	  if (prec < 0)							      \
@@ -977,7 +975,7 @@
 	outchar (__btowc ((unsigned char) va_arg (ap, int))); /* Promoted. */ \
       else								      \
 	outchar (__btowc ((unsigned char)				      \
-			  args_value[fspec->data_arg].pa_char));	      \
+			  args_value[fspec->data_arg].pa_int));		      \
       if (left)								      \
 	PAD (L' ');							      \
       break;								      \
@@ -1096,7 +1094,7 @@
       if (fspec == NULL)						      \
 	outchar ((unsigned char) va_arg (ap, int)); /* Promoted.  */	      \
       else								      \
-	outchar ((unsigned char) args_value[fspec->data_arg].pa_char);	      \
+	outchar ((unsigned char) args_value[fspec->data_arg].pa_int);	      \
       if (left)								      \
 	PAD (' ');							      \
       break;								      \
@@ -1296,13 +1294,13 @@
 
 #ifdef COMPILE_WPRINTF
   /* Find the first format specifier.  */
-  f = lead_str_end = find_spec ((const UCHAR_T *) format);
+  f = lead_str_end = __find_specwc ((const UCHAR_T *) format);
 #else
   /* Put state for processing format string in initial state.  */
   memset (&mbstate, '\0', sizeof (mbstate_t));
 
   /* Find the first format specifier.  */
-  f = lead_str_end = find_spec (format, &mbstate);
+  f = lead_str_end = __find_specmb (format, &mbstate);
 #endif
 
   /* Lock stream.  */
@@ -1598,9 +1596,9 @@
 
       /* Look for next format specifier.  */
 #ifdef COMPILE_WPRINTF
-      f = find_spec ((end_of_spec = ++f));
+      f = __find_specwc ((end_of_spec = ++f));
 #else
-      f = find_spec ((end_of_spec = ++f), &mbstate);
+      f = __find_specmb ((end_of_spec = ++f), &mbstate);
 #endif
 
       /* Write the following constant string.  */
@@ -1679,10 +1677,10 @@
 
 	/* Parse the format specifier.  */
 #ifdef COMPILE_WPRINTF
-	nargs += parse_one_spec (f, nargs, &specs[nspecs], &max_ref_arg);
+	nargs += __parse_one_specwc (f, nargs, &specs[nspecs], &max_ref_arg);
 #else
-	nargs += parse_one_spec (f, nargs, &specs[nspecs], &max_ref_arg,
-				 &mbstate);
+	nargs += __parse_one_specmb (f, nargs, &specs[nspecs], &max_ref_arg,
+				     &mbstate);
 #endif
       }
 
@@ -1737,13 +1735,13 @@
 	  args_value[cnt].mem = va_arg (ap_save, type);			      \
 	  break
 
-	T (PA_CHAR, pa_char, int); /* Promoted.  */
+	T (PA_CHAR, pa_int, int); /* Promoted.  */
 	T (PA_WCHAR, pa_wchar, wint_t);
-	T (PA_INT|PA_FLAG_SHORT, pa_short_int, int); /* Promoted.  */
+	T (PA_INT|PA_FLAG_SHORT, pa_int, int); /* Promoted.  */
 	T (PA_INT, pa_int, int);
 	T (PA_INT|PA_FLAG_LONG, pa_long_int, long int);
 	T (PA_INT|PA_FLAG_LONG_LONG, pa_long_long_int, long long int);
-	T (PA_FLOAT, pa_float, double);	/* Promoted.  */
+	T (PA_FLOAT, pa_double, double);	/* Promoted.  */
 	T (PA_DOUBLE, pa_double, double);
 	T (PA_DOUBLE|PA_FLAG_LONG_DOUBLE, pa_long_double, long double);
 	T (PA_STRING, pa_string, const char *);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdio-common/vfscanf.c libc-20030708/stdio-common/vfscanf.c
--- glibc-2.3.2/stdio-common/vfscanf.c	2003-01-16 08:41:19.000000000 +0900
+++ libc-20030708/stdio-common/vfscanf.c	2003-04-15 23:55:47.000000000 +0900
@@ -290,13 +290,13 @@
 #define is_hexa number_signed
   /* Decimal point character.  */
 #ifdef COMPILE_WSCANF
-  wchar_t decimal;
+  wint_t decimal;
 #else
   const char *decimal;
 #endif
   /* The thousands character of the current locale.  */
 #ifdef COMPILE_WSCANF
-  wchar_t thousands;
+  wint_t thousands;
 #else
   const char *thousands;
 #endif
@@ -1254,7 +1254,7 @@
 			_NL_CURRENT (LC_CTYPE, _NL_CTYPE_INDIGITS0_WC + n);
 		      wcdigits[n] += from_level;
 
-		      if (c == *wcdigits[n])
+		      if (c == (wint_t) *wcdigits[n])
 			{
 			  to_level = from_level;
 			  break;
@@ -1316,7 +1316,7 @@
 			  for (n = 0; n < 10; ++n)
 			    {
 #ifdef COMPILE_WSCANF
-			      if (c == *wcdigits[n])
+			      if (c == (wint_t) *wcdigits[n])
 				break;
 
 			      /* Advance the pointer to the next string.  */
@@ -1441,7 +1441,7 @@
 		    if (!ISXDIGIT (c))
 		      break;
 		  }
-		else if (!ISDIGIT (c) || c - L_('0') >= base)
+		else if (!ISDIGIT (c) || (int) (c - L_('0')) >= base)
 		  {
 		    if (base == 10 && (flags & GROUP)
 #ifdef COMPILE_WSCANF
@@ -1762,7 +1762,8 @@
 	      else if (got_e && wp[wpsize - 1] == exp_char
 		       && (c == L_('-') || c == L_('+')))
 		ADDW (c);
-	      else if (wpsize > 0 && !got_e && TOLOWER (c) == exp_char)
+	      else if (wpsize > 0 && !got_e
+		       && (CHAR_T) TOLOWER (c) == exp_char)
 		{
 		  ADDW (exp_char);
 		  got_e = got_dot = 1;
@@ -1993,7 +1994,7 @@
 			  wchar_t wc;
 
 			  for (wc = runp[-1] + 1; wc <= runp[1]; ++wc)
-			    if (wc == c)
+			    if ((wint_t) wc == c)
 			      break;
 
 			  if (wc <= runp[1] && !not_in)
@@ -2010,9 +2011,9 @@
 			}
 		      else
 			{
-			  if (*runp == c && !not_in)
+			  if ((wint_t) *runp == c && !not_in)
 			    break;
-			  if (*runp == c && not_in)
+			  if ((wint_t) *runp == c && not_in)
 			    {
 			      ungetc (c, s);
 			      goto out;
@@ -2211,7 +2212,7 @@
 			  wchar_t wc;
 
 			  for (wc = runp[-1] + 1; wc <= runp[1]; ++wc)
-			    if (wc == c)
+			    if ((wint_t) wc == c)
 			      break;
 
 			  if (wc <= runp[1] && !not_in)
@@ -2228,9 +2229,9 @@
 			}
 		      else
 			{
-			  if (*runp == c && !not_in)
+			  if ((wint_t) *runp == c && !not_in)
 			    break;
-			  if (*runp == c && not_in)
+			  if ((wint_t) *runp == c && not_in)
 			    {
 			      ungetc (c, s);
 			      goto out2;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/Makefile libc-20030708/stdlib/Makefile
--- glibc-2.3.2/stdlib/Makefile	2002-12-17 15:43:56.000000000 +0900
+++ libc-20030708/stdlib/Makefile	2003-07-08 22:58:09.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1991-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1991-2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -49,6 +49,7 @@
 	rpmatch strfmon strfmon_l getsubopt xpg_basename fmtmsg		      \
 	strtoimax strtoumax wcstoimax wcstoumax				      \
 	getcontext setcontext makecontext swapcontext
+aux =	grouping groupingwc
 
 # These routines will be omitted from the libc shared object.
 # Instead the static object files will be included in a special archive
@@ -73,7 +74,7 @@
 routines := $(strip $(routines) $(mpn-routines))	\
 	    dbl2mpn ldbl2mpn				\
 	    mpn2flt mpn2dbl mpn2ldbl
-aux := fpioconst mp_clz_tab
+aux += fpioconst mp_clz_tab
 distribute := $(distribute) $(mpn-headers) gen-mpn-copy fpioconst.h
 
 generated += isomac isomac.out
@@ -81,6 +82,7 @@
 CFLAGS-bsearch.c = $(exceptions)
 CFLAGS-msort.c = $(exceptions)
 CFLAGS-qsort.c = $(exceptions)
+CFLAGS-system.c = -fexceptions
 
 include ../Makeconfig
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/cxa_finalize.c libc-20030708/stdlib/cxa_finalize.c
--- glibc-2.3.2/stdlib/cxa_finalize.c	2002-12-06 19:43:29.000000000 +0900
+++ libc-20030708/stdlib/cxa_finalize.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -18,12 +18,13 @@
 
 #include <assert.h>
 #include <stdlib.h>
-#include <atomicity.h>
+#include <atomic.h>
 #include "exit.h"
 #include <fork.h>
 
 /* If D is non-NULL, call all functions registered with `__cxa_atexit'
-   with the same dso handle.  Otherwise, if D is NULL, do nothing.  */
+   with the same dso handle.  Otherwise, if D is NULL, call all of the
+   registered handlers.  */
 void
 __cxa_finalize (void *d)
 {
@@ -36,12 +37,15 @@
       for (f = &funcs->fns[funcs->idx - 1]; f >= &funcs->fns[0]; --f)
 	if ((d == NULL || d == f->func.cxa.dso_handle)
 	    /* We don't want to run this cleanup more than once.  */
-	    && compare_and_swap (&f->flavor, ef_cxa, ef_free))
+	    && ! atomic_compare_and_exchange_bool_acq (&f->flavor, ef_free,
+						       ef_cxa))
 	  (*f->func.cxa.fn) (f->func.cxa.arg, 0);
     }
 
-  /* Remove the registered fork handlers.  */
+  /* Remove the registered fork handlers.  We do not have to
+     unregister anything if the program is going to terminate anyway.  */
 #ifdef UNREGISTER_ATFORK
-  UNREGISTER_ATFORK (d);
+  if (d != NULL)
+    UNREGISTER_ATFORK (d);
 #endif
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/fpioconst.c libc-20030708/stdlib/fpioconst.c
--- glibc-2.3.2/stdlib/fpioconst.c	2002-03-11 17:32:01.000000000 +0900
+++ libc-20030708/stdlib/fpioconst.c	2003-03-14 12:59:41.000000000 +0900
@@ -1,5 +1,6 @@
 /* Table of MP integer constants 10^(2^i), used for floating point <-> decimal.
-   Copyright (C) 1995, 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1995, 1996, 1997, 1998, 1999, 2002, 2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -235,195 +236,198 @@
 {
 #define TENS_P0_IDX	0
 #define TENS_P0_SIZE	2
-  [TENS_P0_IDX] = 0x0000000000000000, 0x000000000000000a,
+  [TENS_P0_IDX] = 0x0000000000000000ull, 0x000000000000000aull,
 
 #define TENS_P1_IDX	(TENS_P0_IDX + TENS_P0_SIZE)
 #define TENS_P1_SIZE	2
-  [TENS_P1_IDX] = 0x0000000000000000, 0x0000000000000064,
+  [TENS_P1_IDX] = 0x0000000000000000ull, 0x0000000000000064ull,
 
 #define TENS_P2_IDX	(TENS_P1_IDX + TENS_P1_SIZE)
 #define TENS_P2_SIZE	2
-  [TENS_P2_IDX] = 0x0000000000000000, 0x0000000000002710,
+  [TENS_P2_IDX] = 0x0000000000000000ull, 0x0000000000002710ull,
 
 #define TENS_P3_IDX	(TENS_P2_IDX + TENS_P2_SIZE)
 #define TENS_P3_SIZE	2
-  [TENS_P3_IDX] = 0x0000000000000000, 0x0000000005f5e100,
+  [TENS_P3_IDX] = 0x0000000000000000ull, 0x0000000005f5e100ull,
 
 #define TENS_P4_IDX	(TENS_P3_IDX + TENS_P3_SIZE)
 #define TENS_P4_SIZE	2
-  [TENS_P4_IDX] = 0x0000000000000000, 0x002386f26fc10000,
+  [TENS_P4_IDX] = 0x0000000000000000ull, 0x002386f26fc10000ull,
 
 #define TENS_P5_IDX	(TENS_P4_IDX + TENS_P4_SIZE)
 #define TENS_P5_SIZE	3
-  [TENS_P5_IDX] = 0x0000000000000000, 0x85acef8100000000, 0x000004ee2d6d415b,
+  [TENS_P5_IDX] = 0x0000000000000000ull, 0x85acef8100000000ull,
+  0x000004ee2d6d415bull,
 
 #define TENS_P6_IDX	(TENS_P5_IDX + TENS_P5_SIZE)
 #define TENS_P6_SIZE	5
-  [TENS_P6_IDX] = 0x0000000000000000, 0x0000000000000000, 0x6e38ed64bf6a1f01,
-  0xe93ff9f4daa797ed, 0x0000000000184f03,
+  [TENS_P6_IDX] = 0x0000000000000000ull, 0x0000000000000000ull,
+  0x6e38ed64bf6a1f01ull, 0xe93ff9f4daa797edull, 0x0000000000184f03ull,
 
 #define TENS_P7_IDX	(TENS_P6_IDX + TENS_P6_SIZE)
 #define TENS_P7_SIZE	8
-  [TENS_P7_IDX] = 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x03df99092e953e01, 0x2374e42f0f1538fd, 0xc404dc08d3cff5ec,
-  0xa6337f19bccdb0da, 0x0000024ee91f2603,
+  [TENS_P7_IDX] = 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x03df99092e953e01ull, 0x2374e42f0f1538fdull,
+  0xc404dc08d3cff5ecull, 0xa6337f19bccdb0daull, 0x0000024ee91f2603ull,
 
 #define TENS_P8_IDX	(TENS_P7_IDX + TENS_P7_SIZE)
 #define TENS_P8_SIZE	15
-  [TENS_P8_IDX] = 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0xbed3875b982e7c01,
-  0x12152f87d8d99f72, 0xcf4a6e706bde50c6, 0x26b2716ed595d80f,
-  0x1d153624adc666b0, 0x63ff540e3c42d35a, 0x65f9ef17cc5573c0,
-  0x80dcc7f755bc28f2, 0x5fdcefcef46eeddc, 0x00000000000553f7,
+  [TENS_P8_IDX] = 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0xbed3875b982e7c01ull, 0x12152f87d8d99f72ull, 0xcf4a6e706bde50c6ull,
+  0x26b2716ed595d80full, 0x1d153624adc666b0ull, 0x63ff540e3c42d35aull,
+  0x65f9ef17cc5573c0ull, 0x80dcc7f755bc28f2ull, 0x5fdcefcef46eeddcull,
+  0x00000000000553f7ull,
 #ifndef __NO_LONG_DOUBLE_MATH
 # define TENS_P9_IDX	(TENS_P8_IDX + TENS_P8_SIZE)
 # define TENS_P9_SIZE	28
-  [TENS_P9_IDX] = 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x77f27267fc6cf801, 0x5d96976f8f9546dc, 0xc31e1ad9b83a8a97,
-  0x94e6574746c40513, 0x4475b579c88976c1, 0xaa1da1bf28f8733b,
-  0x1e25cfea703ed321, 0xbc51fb2eb21a2f22, 0xbfa3edac96e14f5d,
-  0xe7fc7153329c57ae, 0x85a91924c3fc0695, 0xb2908ee0f95f635e,
-  0x1366732a93abade4, 0x69be5b0e9449775c, 0xb099bc817343afac,
-  0xa269974845a71d46, 0x8a0b1f138cb07303, 0xc1d238d98cab8a97,
-  0x0000001c633415d4,
+  [TENS_P9_IDX] = 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x77f27267fc6cf801ull, 0x5d96976f8f9546dcull,
+  0xc31e1ad9b83a8a97ull, 0x94e6574746c40513ull, 0x4475b579c88976c1ull,
+  0xaa1da1bf28f8733bull, 0x1e25cfea703ed321ull, 0xbc51fb2eb21a2f22ull,
+  0xbfa3edac96e14f5dull, 0xe7fc7153329c57aeull, 0x85a91924c3fc0695ull,
+  0xb2908ee0f95f635eull, 0x1366732a93abade4ull, 0x69be5b0e9449775cull,
+  0xb099bc817343afacull, 0xa269974845a71d46ull, 0x8a0b1f138cb07303ull,
+  0xc1d238d98cab8a97ull, 0x0000001c633415d4ull,
 
 # define TENS_P10_IDX	(TENS_P9_IDX + TENS_P9_SIZE)
 # define TENS_P10_SIZE	55
-  [TENS_P10_IDX] = 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0xf55b2b722919f001,
-  0x1ec29f866e7c215b, 0x15c51a88991c4e87, 0x4c7d1e1a140ac535,
-  0x0ed1440ecc2cd819, 0x7de16cfb896634ee, 0x9fce837d1e43f61f,
-  0x233e55c7231d2b9c, 0xf451218b65dc60d7, 0xc96359861c5cd134,
-  0xa7e89431922bbb9f, 0x62be695a9f9f2a07, 0x045b7a748e1042c4,
-  0x8ad822a51abe1de3, 0xd814b505ba34c411, 0x8fc51a16bf3fdeb3,
-  0xf56deeecb1b896bc, 0xb6f4654b31fb6bfd, 0x6b7595fb101a3616,
-  0x80d98089dc1a47fe, 0x9a20288280bda5a5, 0xfc8f1f9031eb0f66,
-  0xe26a7b7e976a3310, 0x3ce3a0b8df68368a, 0x75a351a28e4262ce,
-  0x445975836cb0b6c9, 0xc356e38a31b5653f, 0x0190fba035faaba6,
-  0x88bc491b9fc4ed52, 0x005b80411640114a, 0x1e8d4649f4f3235e,
-  0x73c5534936a8de06, 0xc1a6970ca7e6bd2a, 0xd2db49ef47187094,
-  0xae6209d4926c3f5b, 0x34f4a3c62d433949, 0xd9d61a05d4305d94,
-  0x0000000000000325,
+  [TENS_P10_IDX] = 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0xf55b2b722919f001ull, 0x1ec29f866e7c215bull, 0x15c51a88991c4e87ull,
+  0x4c7d1e1a140ac535ull, 0x0ed1440ecc2cd819ull, 0x7de16cfb896634eeull,
+  0x9fce837d1e43f61full, 0x233e55c7231d2b9cull, 0xf451218b65dc60d7ull,
+  0xc96359861c5cd134ull, 0xa7e89431922bbb9full, 0x62be695a9f9f2a07ull,
+  0x045b7a748e1042c4ull, 0x8ad822a51abe1de3ull, 0xd814b505ba34c411ull,
+  0x8fc51a16bf3fdeb3ull, 0xf56deeecb1b896bcull, 0xb6f4654b31fb6bfdull,
+  0x6b7595fb101a3616ull, 0x80d98089dc1a47feull, 0x9a20288280bda5a5ull,
+  0xfc8f1f9031eb0f66ull, 0xe26a7b7e976a3310ull, 0x3ce3a0b8df68368aull,
+  0x75a351a28e4262ceull, 0x445975836cb0b6c9ull, 0xc356e38a31b5653full,
+  0x0190fba035faaba6ull, 0x88bc491b9fc4ed52ull, 0x005b80411640114aull,
+  0x1e8d4649f4f3235eull, 0x73c5534936a8de06ull, 0xc1a6970ca7e6bd2aull,
+  0xd2db49ef47187094ull, 0xae6209d4926c3f5bull, 0x34f4a3c62d433949ull,
+  0xd9d61a05d4305d94ull, 0x0000000000000325ull,
 
 # define TENS_P11_IDX	(TENS_P10_IDX + TENS_P10_SIZE)
 # define TENS_P11_SIZE	108
-  [TENS_P11_IDX] = 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0xe30968651333e001, 0x49e28dcfb27d4d3f, 0xee87e354ec2e4721,
-  0x368b8abbb6067584, 0x2ed56d55a5e5a191, 0xea50d142fd827773,
-  0x98342c9e51b78db2, 0x866ed6f1c850dabc, 0x9279498719342c12,
-  0x66912e4ad2f869c2, 0x57a7842d71c7fd8f, 0xfb7fedcc235552eb,
-  0x38209ce1f3861ce0, 0x34c101349713b449, 0xa7a8289c8c6c54de,
-  0xe3cb64f32dbb6643, 0xe3892ee98074ff01, 0xa8f16f9210c17f94,
-  0x967abbb3a8281ed6, 0x9952fbed5a151440, 0xafe609c313b41e44,
-  0xf111821fa2bca416, 0x91bac974fb1264b4, 0x8e48ff35d6c7d6ab,
-  0xc4a656654419bd43, 0x33554c36685e5510, 0x0dbd21feab498697,
-  0x982da4663cfe491d, 0x9e110c7bcbea4ca7, 0x5fc5a04779c56b8a,
-  0x1aa9f44484d80e2e, 0x6a57b1ab730f203c, 0x87a7dc62d752f7a6,
-  0x40660460944545ff, 0xc9ac375d77c1a42f, 0x744695f0e866d7ef,
-  0xa1fc6b9681428c85, 0x7bf03c19d7917c7b, 0x5715f7915b33eb41,
-  0xdb0708fd8f6cae5f, 0x785ce6b7b125ac8e, 0x6f46eadb56c6815b,
-  0x195355d84eeebeee, 0x9d7389c0a244de3c, 0xcf99d01953761abd,
-  0x0d76ce39de9ec24b, 0x2e55ecee70beb181, 0xf56d9d4bd5f86079,
-  0x13ef5a83fb8886fb, 0x3f3389a4408f43c5, 0x58ccf45cfad37943,
-  0x415c7f3ef82df846, 0x8b3d5cf42915e818, 0xf8dbb57a6a445f27,
-  0x8ad803ecca8f0070, 0x038f9245b2e87c34, 0xc7c9dee0bedd8a6c,
-  0x2ad3fa140eac7d56, 0xf775677ce0de0840, 0x92be221ef1bd0ad5,
-  0xce9d04a487fa1fb9, 0x3f6f7024d2c36fa9, 0x907855eeb028af62,
-  0x4efac5dcd83e49d6, 0x77cd8c6be7151aab, 0x0af908b40a753b7d,
-  0xe50f30278c983623, 0x1d08e2d694222771, 0xf2ee5ca6f7e928e6,
-  0x11eb962b1b61b93c, 0xce2bcba19648b21c, 0x7bbebe3034f77154,
-  0x8ce329ace526a319, 0xb5dc53d5de4a74d2, 0x000000000009e8b3,
+  [TENS_P11_IDX] = 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0xe30968651333e001ull, 0x49e28dcfb27d4d3full,
+  0xee87e354ec2e4721ull, 0x368b8abbb6067584ull, 0x2ed56d55a5e5a191ull,
+  0xea50d142fd827773ull, 0x98342c9e51b78db2ull, 0x866ed6f1c850dabcull,
+  0x9279498719342c12ull, 0x66912e4ad2f869c2ull, 0x57a7842d71c7fd8full,
+  0xfb7fedcc235552ebull, 0x38209ce1f3861ce0ull, 0x34c101349713b449ull,
+  0xa7a8289c8c6c54deull, 0xe3cb64f32dbb6643ull, 0xe3892ee98074ff01ull,
+  0xa8f16f9210c17f94ull, 0x967abbb3a8281ed6ull, 0x9952fbed5a151440ull,
+  0xafe609c313b41e44ull, 0xf111821fa2bca416ull, 0x91bac974fb1264b4ull,
+  0x8e48ff35d6c7d6abull, 0xc4a656654419bd43ull, 0x33554c36685e5510ull,
+  0x0dbd21feab498697ull, 0x982da4663cfe491dull, 0x9e110c7bcbea4ca7ull,
+  0x5fc5a04779c56b8aull, 0x1aa9f44484d80e2eull, 0x6a57b1ab730f203cull,
+  0x87a7dc62d752f7a6ull, 0x40660460944545ffull, 0xc9ac375d77c1a42full,
+  0x744695f0e866d7efull, 0xa1fc6b9681428c85ull, 0x7bf03c19d7917c7bull,
+  0x5715f7915b33eb41ull, 0xdb0708fd8f6cae5full, 0x785ce6b7b125ac8eull,
+  0x6f46eadb56c6815bull, 0x195355d84eeebeeeull, 0x9d7389c0a244de3cull,
+  0xcf99d01953761abdull, 0x0d76ce39de9ec24bull, 0x2e55ecee70beb181ull,
+  0xf56d9d4bd5f86079ull, 0x13ef5a83fb8886fbull, 0x3f3389a4408f43c5ull,
+  0x58ccf45cfad37943ull, 0x415c7f3ef82df846ull, 0x8b3d5cf42915e818ull,
+  0xf8dbb57a6a445f27ull, 0x8ad803ecca8f0070ull, 0x038f9245b2e87c34ull,
+  0xc7c9dee0bedd8a6cull, 0x2ad3fa140eac7d56ull, 0xf775677ce0de0840ull,
+  0x92be221ef1bd0ad5ull, 0xce9d04a487fa1fb9ull, 0x3f6f7024d2c36fa9ull,
+  0x907855eeb028af62ull, 0x4efac5dcd83e49d6ull, 0x77cd8c6be7151aabull,
+  0x0af908b40a753b7dull, 0xe50f30278c983623ull, 0x1d08e2d694222771ull,
+  0xf2ee5ca6f7e928e6ull, 0x11eb962b1b61b93cull, 0xce2bcba19648b21cull,
+  0x7bbebe3034f77154ull, 0x8ce329ace526a319ull, 0xb5dc53d5de4a74d2ull,
+  0x000000000009e8b3ull,
 
 # define TENS_P12_IDX	(TENS_P11_IDX + TENS_P11_SIZE)
 # define TENS_P12_SIZE	214
-  [TENS_P12_IDX] = 0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0x0000000000000000,
-  0x0000000000000000, 0x0000000000000000, 0xd4724e8d2a67c001,
-  0xf89a1e908efe7ae7, 0x54e05154ef084117, 0x506be82913b1bb51,
-  0xe599574efb29b172, 0x806c0ed3f0da6146, 0x45155e93b86ae5be,
-  0x7e1e7c34c0591cc2, 0x1d1f4cce7c4823da, 0xd6bfdf759b8ba1e8,
-  0xc2dfae78e341be10, 0x0f237f1a016b67b2, 0xaf6a25743dbeabcd,
-  0x142e0e80cab3e6d7, 0x2c23481161959127, 0xcb4bf98287009701,
-  0x88052f8cf8169c84, 0xbc13176168dde6d4, 0x54ab9c41ff0b0905,
-  0x1a1c304e7613b224, 0x441c2d473bfe167b, 0x78f061814f6cea9c,
-  0x30c7ae41eb659fb8, 0xa1ebcad7947e0d0e, 0x2130504dd97d9556,
-  0xf2acd5071a8309cb, 0xfd82373a3f8ec72a, 0x280f4d3295a842bc,
-  0x811a4f04f3618ac0, 0xd3967a1b6dc3a5b4, 0xdcfe388f15b8c898,
-  0x8738b909454eb2a0, 0x2bd9cc1110c4e996, 0x655fec303297cd0c,
-  0xf4090ee8ae0725b1, 0x398c6fed037d19ee, 0xc994a4503b9af26b,
-  0x75a697b2b5341743, 0x3ccb5b92ac50b9c1, 0xa8329761ffe06205,
-  0xeb83cadbdfea5242, 0x3c20ee69e79dadf7, 0x7021b97a1e0a6817,
-  0x176ca776743074fa, 0xeca19beb77fb8af6, 0xaf63b71292baf1de,
-  0xa4eb8f8cde35c88b, 0x40b464a0e137d5e9, 0x42923bbd87d1cde8,
-  0x2e2690f3cd8f62ff, 0x59c89f1b095edc16, 0x5138753d1fa8fd5d,
-  0x80152f18390a2b29, 0xf984d83e2dd8d925, 0xc19e1faf7a872e74,
-  0xecf9b5d0ed4d542d, 0xc53c0adf9462ea75, 0x37a2d4390caea134,
-  0x2181327ec8fa2e8a, 0x2d2408206e7bb827, 0x5893d4b850be10e0,
-  0x1f2b2322ab312bb9, 0xbf627ede440b3f25, 0xb608b89572dac789,
-  0x86deb3f078787e2a, 0xbb9373f46fee7aab, 0xf7d8b57e27ecf57b,
-  0x3d04e8d2fca26a9f, 0x3172826ac9df13cb, 0xa8fcd8e0cd9e8d7c,
-  0x307641d9b2c39497, 0x2608c4cf1cc939c1, 0x3d326a7eb6d1c7bf,
-  0x8e13e25feeaf19e6, 0x2dfe6d97ee63302b, 0xe41d3cc425971d58,
-  0xab8db59a0a80627c, 0xe90afb779eea37c8, 0x9ee3352c90ca19cf,
-  0xfe78d6823613c850, 0x5b060904788f6e50, 0x3fecb534b71bd1a4,
-  0x20c33857b32c450c, 0x0239f4cea6e9cfda, 0xa19adb9548497187,
-  0x95aca6a8b492ed8a, 0xcf1b23504dcd6cd9, 0x1a67778cfbe8b12a,
-  0xc32da38338eb3acc, 0xa03f40a8fb126ab1, 0xe9ce4724ed5bf546,
-  0x73a130d84c4a74fd, 0xa2ebd6c1d9960e2d, 0x6f233b7c94ab6feb,
-  0x8e7b9a7349126080, 0xd298f9994b8c9091, 0xa96ddeff35e836b5,
-  0x6b0dd9bc96119b31, 0x282566fbc6cc3f8d, 0xd6769f3b72b882e7,
-  0x00fc509ba674343d, 0xd6266a3fdcbf7789, 0x4e89541bae9641fd,
-  0x53400d0311953407, 0xe5b533458e0dd75a, 0x108b89bc108f19ad,
-  0xe03b2b6341a4c954, 0x97aced8e437b3d7f, 0x2c5508c2cbd66670,
-  0x5c4f2ef0650ebc69, 0x9985a2df904ff6bf, 0x5ed8d2399faddd9e,
-  0xe3e51cb925585832, 0x56c02d9a0ff4f1d4, 0xc1a08a138c4ef804,
-  0xe6d2767113fd01c8, 0x9d0176cca7c234f4, 0x4d8bfa89d0d73df2,
-  0x2b17e0b2544f10cd, 0xfd86fe49b70a5c7d, 0x214495bbdf373f41,
-  0x00d313d584e857fd, 0xa4ba47440496fcbe, 0xaec29e6ee8cac982,
-  0x7000a51987ec7038, 0xff66e42caeee333b, 0x03b4f63b8afd6b25,
-  0x5ab8d9c7bd7991dc, 0x48741a6c2ed4684e, 0x2fdc6349af06940d,
-  0xe974996fb03d7ecd, 0x52ec8721ac7867f9, 0x8edd2d00bcdd9d4a,
-  0x41c759f83557de06, 0xa75409f23956d4b9, 0xb6100fab123cd8a1,
-  0x2e8d623b3e7b21e2, 0xbca35f7792959da2, 0x35fcb457200c03a5,
-  0xf74eb9281bb6c6e4, 0x87cc1d213d5d0b54, 0x18ae42404964046f,
-  0x8bd2b496d868b275, 0xc234d8f51c5563f4, 0xf9151ffff868e970,
-  0x271133eeae7be4a2, 0x25254932bb0fd922, 0x104bcd64a60a9fc0,
-  0x0000006230290145
+  [TENS_P12_IDX] = 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0x0000000000000000ull, 0x0000000000000000ull, 0x0000000000000000ull,
+  0xd4724e8d2a67c001ull, 0xf89a1e908efe7ae7ull, 0x54e05154ef084117ull,
+  0x506be82913b1bb51ull, 0xe599574efb29b172ull, 0x806c0ed3f0da6146ull,
+  0x45155e93b86ae5beull, 0x7e1e7c34c0591cc2ull, 0x1d1f4cce7c4823daull,
+  0xd6bfdf759b8ba1e8ull, 0xc2dfae78e341be10ull, 0x0f237f1a016b67b2ull,
+  0xaf6a25743dbeabcdull, 0x142e0e80cab3e6d7ull, 0x2c23481161959127ull,
+  0xcb4bf98287009701ull, 0x88052f8cf8169c84ull, 0xbc13176168dde6d4ull,
+  0x54ab9c41ff0b0905ull, 0x1a1c304e7613b224ull, 0x441c2d473bfe167bull,
+  0x78f061814f6cea9cull, 0x30c7ae41eb659fb8ull, 0xa1ebcad7947e0d0eull,
+  0x2130504dd97d9556ull, 0xf2acd5071a8309cbull, 0xfd82373a3f8ec72aull,
+  0x280f4d3295a842bcull, 0x811a4f04f3618ac0ull, 0xd3967a1b6dc3a5b4ull,
+  0xdcfe388f15b8c898ull, 0x8738b909454eb2a0ull, 0x2bd9cc1110c4e996ull,
+  0x655fec303297cd0cull, 0xf4090ee8ae0725b1ull, 0x398c6fed037d19eeull,
+  0xc994a4503b9af26bull, 0x75a697b2b5341743ull, 0x3ccb5b92ac50b9c1ull,
+  0xa8329761ffe06205ull, 0xeb83cadbdfea5242ull, 0x3c20ee69e79dadf7ull,
+  0x7021b97a1e0a6817ull, 0x176ca776743074faull, 0xeca19beb77fb8af6ull,
+  0xaf63b71292baf1deull, 0xa4eb8f8cde35c88bull, 0x40b464a0e137d5e9ull,
+  0x42923bbd87d1cde8ull, 0x2e2690f3cd8f62ffull, 0x59c89f1b095edc16ull,
+  0x5138753d1fa8fd5dull, 0x80152f18390a2b29ull, 0xf984d83e2dd8d925ull,
+  0xc19e1faf7a872e74ull, 0xecf9b5d0ed4d542dull, 0xc53c0adf9462ea75ull,
+  0x37a2d4390caea134ull, 0x2181327ec8fa2e8aull, 0x2d2408206e7bb827ull,
+  0x5893d4b850be10e0ull, 0x1f2b2322ab312bb9ull, 0xbf627ede440b3f25ull,
+  0xb608b89572dac789ull, 0x86deb3f078787e2aull, 0xbb9373f46fee7aabull,
+  0xf7d8b57e27ecf57bull, 0x3d04e8d2fca26a9full, 0x3172826ac9df13cbull,
+  0xa8fcd8e0cd9e8d7cull, 0x307641d9b2c39497ull, 0x2608c4cf1cc939c1ull,
+  0x3d326a7eb6d1c7bfull, 0x8e13e25feeaf19e6ull, 0x2dfe6d97ee63302bull,
+  0xe41d3cc425971d58ull, 0xab8db59a0a80627cull, 0xe90afb779eea37c8ull,
+  0x9ee3352c90ca19cfull, 0xfe78d6823613c850ull, 0x5b060904788f6e50ull,
+  0x3fecb534b71bd1a4ull, 0x20c33857b32c450cull, 0x0239f4cea6e9cfdaull,
+  0xa19adb9548497187ull, 0x95aca6a8b492ed8aull, 0xcf1b23504dcd6cd9ull,
+  0x1a67778cfbe8b12aull, 0xc32da38338eb3accull, 0xa03f40a8fb126ab1ull,
+  0xe9ce4724ed5bf546ull, 0x73a130d84c4a74fdull, 0xa2ebd6c1d9960e2dull,
+  0x6f233b7c94ab6febull, 0x8e7b9a7349126080ull, 0xd298f9994b8c9091ull,
+  0xa96ddeff35e836b5ull, 0x6b0dd9bc96119b31ull, 0x282566fbc6cc3f8dull,
+  0xd6769f3b72b882e7ull, 0x00fc509ba674343dull, 0xd6266a3fdcbf7789ull,
+  0x4e89541bae9641fdull, 0x53400d0311953407ull, 0xe5b533458e0dd75aull,
+  0x108b89bc108f19adull, 0xe03b2b6341a4c954ull, 0x97aced8e437b3d7full,
+  0x2c5508c2cbd66670ull, 0x5c4f2ef0650ebc69ull, 0x9985a2df904ff6bfull,
+  0x5ed8d2399faddd9eull, 0xe3e51cb925585832ull, 0x56c02d9a0ff4f1d4ull,
+  0xc1a08a138c4ef804ull, 0xe6d2767113fd01c8ull, 0x9d0176cca7c234f4ull,
+  0x4d8bfa89d0d73df2ull, 0x2b17e0b2544f10cdull, 0xfd86fe49b70a5c7dull,
+  0x214495bbdf373f41ull, 0x00d313d584e857fdull, 0xa4ba47440496fcbeull,
+  0xaec29e6ee8cac982ull, 0x7000a51987ec7038ull, 0xff66e42caeee333bull,
+  0x03b4f63b8afd6b25ull, 0x5ab8d9c7bd7991dcull, 0x48741a6c2ed4684eull,
+  0x2fdc6349af06940dull, 0xe974996fb03d7ecdull, 0x52ec8721ac7867f9ull,
+  0x8edd2d00bcdd9d4aull, 0x41c759f83557de06ull, 0xa75409f23956d4b9ull,
+  0xb6100fab123cd8a1ull, 0x2e8d623b3e7b21e2ull, 0xbca35f7792959da2ull,
+  0x35fcb457200c03a5ull, 0xf74eb9281bb6c6e4ull, 0x87cc1d213d5d0b54ull,
+  0x18ae42404964046full, 0x8bd2b496d868b275ull, 0xc234d8f51c5563f4ull,
+  0xf9151ffff868e970ull, 0x271133eeae7be4a2ull, 0x25254932bb0fd922ull,
+  0x104bcd64a60a9fc0ull, 0x0000006230290145ull
 #endif
 };
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/fpioconst.h libc-20030708/stdlib/fpioconst.h
--- glibc-2.3.2/stdlib/fpioconst.h	2002-03-12 18:24:56.000000000 +0900
+++ libc-20030708/stdlib/fpioconst.h	2003-03-14 13:21:27.000000000 +0900
@@ -1,5 +1,6 @@
 /* Header file for constants used in floating point <-> decimal conversions.
-   Copyright (C) 1995,1996,1997,1998,1999,2002 Free Software Foundation, Inc.
+   Copyright (C) 1995, 1996, 1997, 1998, 1999, 2002, 2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,7 +23,7 @@
 
 #include <float.h>
 #include <math.h>
-#include "gmp.h"
+#include <gmp.h>
 
 
 /* These values are used by __printf_fp, where they are noncritical (if the
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/grouping.c libc-20030708/stdlib/grouping.c
--- glibc-2.3.2/stdlib/grouping.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/stdlib/grouping.c	2003-06-12 07:10:28.000000000 +0900
@@ -0,0 +1,202 @@
+/* Internal header for proving correct grouping in strings of numbers.
+   Copyright (C) 1995,1996,1997,1998,2000,2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>, 1995.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <limits.h>
+#include <stddef.h>
+#include <string.h>
+
+#ifndef MAX
+#define MAX(a,b)	({ typeof(a) _a = (a); typeof(b) _b = (b); \
+			   _a > _b ? _a : _b; })
+#endif
+
+#ifdef USE_WIDE_CHAR
+# include <wctype.h>
+# define L_(Ch) L##Ch
+# define UCHAR_TYPE wint_t
+# define STRING_TYPE wchar_t
+#else
+# define L_(Ch) Ch
+# define UCHAR_TYPE unsigned char
+# define STRING_TYPE char
+#endif
+
+#include "grouping.h"
+
+/* Find the maximum prefix of the string between BEGIN and END which
+   satisfies the grouping rules.  It is assumed that at least one digit
+   follows BEGIN directly.  */
+
+const STRING_TYPE *
+#ifdef USE_WIDE_CHAR
+__correctly_grouped_prefixwc (const STRING_TYPE *begin, const STRING_TYPE *end,
+			      wchar_t thousands,
+#else
+__correctly_grouped_prefixmb (const STRING_TYPE *begin, const STRING_TYPE *end,
+			      const char *thousands,
+#endif
+			      const char *grouping)
+{
+#ifndef USE_WIDE_CHAR
+  size_t thousands_len;
+  int cnt;
+#endif
+
+  if (grouping == NULL)
+    return end;
+
+#ifndef USE_WIDE_CHAR
+  thousands_len = strlen (thousands);
+#endif
+
+  while (end > begin)
+    {
+      const STRING_TYPE *cp = end - 1;
+      const char *gp = grouping;
+
+      /* Check first group.  */
+      while (cp >= begin)
+	{
+#ifdef USE_WIDE_CHAR
+	  if (*cp == thousands)
+	    break;
+#else
+	  if (cp[thousands_len - 1] == *thousands)
+	    {
+	      for (cnt = 1; thousands[cnt] != '\0'; ++cnt)
+		if (thousands[cnt] != cp[thousands_len - 1 - cnt])
+		  break;
+	      if (thousands[cnt] == '\0')
+		break;
+	    }
+#endif
+	  --cp;
+	}
+
+      /* We allow the representation to contain no grouping at all even if
+	 the locale specifies we can have grouping.  */
+      if (cp < begin)
+	return end;
+
+      if (end - cp == (int) *gp + 1)
+	{
+	  /* This group matches the specification.  */
+
+	  const STRING_TYPE *new_end;
+
+	  if (cp < begin)
+	    /* There is just one complete group.  We are done.  */
+	    return end;
+
+	  /* CP points to a thousands separator character.  The preceding
+	     remainder of the string from BEGIN to NEW_END is the part we
+	     will consider if there is a grouping error in this trailing
+	     portion from CP to END.  */
+	  new_end = cp - 1;
+
+	  /* Loop while the grouping is correct.  */
+	  while (1)
+	    {
+	      /* Get the next grouping rule.  */
+	      ++gp;
+	      if (*gp == 0)
+		/* If end is reached use last rule.  */
+	        --gp;
+
+	      /* Skip the thousands separator.  */
+	      --cp;
+
+	      if (*gp == CHAR_MAX
+#if CHAR_MIN < 0
+		  || *gp < 0
+#endif
+		  )
+	        {
+	          /* No more thousands separators are allowed to follow.  */
+	          while (cp >= begin)
+		    {
+#ifdef USE_WIDE_CHAR
+		      if (*cp == thousands)
+			break;
+#else
+		      for (cnt = 0; thousands[cnt] != '\0'; ++cnt)
+			if (thousands[cnt] != cp[thousands_len - cnt - 1])
+			  break;
+		      if (thousands[cnt] == '\0')
+			break;
+#endif
+		      --cp;
+		    }
+
+	          if (cp < begin)
+		    /* OK, only digits followed.  */
+		    return end;
+	        }
+	      else
+	        {
+		  /* Check the next group.  */
+	          const STRING_TYPE *group_end = cp;
+
+		  while (cp >= begin)
+		    {
+#ifdef USE_WIDE_CHAR
+		      if (*cp == thousands)
+			break;
+#else
+		      for (cnt = 0; thousands[cnt] != '\0'; ++cnt)
+			if (thousands[cnt] != cp[thousands_len - cnt - 1])
+			  break;
+		      if (thousands[cnt] == '\0')
+			break;
+#endif
+		      --cp;
+		    }
+
+		  if (cp < begin && group_end - cp <= (int) *gp)
+		    /* Final group is correct.  */
+		    return end;
+
+		  if (cp < begin || group_end - cp != (int) *gp)
+		    /* Incorrect group.  Punt.  */
+		    break;
+		}
+	    }
+
+	  /* The trailing portion of the string starting at NEW_END
+	     contains a grouping error.  So we will look for a correctly
+	     grouped number in the preceding portion instead.  */
+	  end = new_end;
+	}
+      else
+	{
+	  /* Even the first group was wrong; determine maximum shift.  */
+	  if (end - cp > (int) *gp + 1)
+	    end = cp + (int) *gp + 1;
+	  else if (cp < begin)
+	    /* This number does not fill the first group, but is correct.  */
+	    return end;
+	  else
+	    /* CP points to a thousands separator character.  */
+	    end = cp;
+	}
+    }
+
+  return MAX (begin, end);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/grouping.h libc-20030708/stdlib/grouping.h
--- glibc-2.3.2/stdlib/grouping.h	2001-07-08 04:21:18.000000000 +0900
+++ libc-20030708/stdlib/grouping.h	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Internal header for proving correct grouping in strings of numbers.
-   Copyright (C) 1995, 1996, 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1995,1996,1997,1998,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>, 1995.
 
@@ -18,169 +18,17 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <limits.h>
-
-#ifndef MAX
-#define MAX(a,b)	({ typeof(a) _a = (a); typeof(b) _b = (b); \
-			   _a > _b ? _a : _b; })
-#endif
-
 /* Find the maximum prefix of the string between BEGIN and END which
    satisfies the grouping rules.  It is assumed that at least one digit
    follows BEGIN directly.  */
-
-static inline const STRING_TYPE *
-correctly_grouped_prefix (const STRING_TYPE *begin, const STRING_TYPE *end,
-#ifdef USE_WIDE_CHAR
-			  wchar_t thousands,
-#else
-			  const char *thousands,
-#endif
-			  const char *grouping)
-{
-#ifndef USE_WIDE_CHAR
-  size_t thousands_len;
-  int cnt;
-#endif
-
-  if (grouping == NULL)
-    return end;
-
-#ifndef USE_WIDE_CHAR
-  thousands_len = strlen (thousands);
-#endif
-
-  while (end > begin)
-    {
-      const STRING_TYPE *cp = end - 1;
-      const char *gp = grouping;
-
-      /* Check first group.  */
-      while (cp >= begin)
-	{
-#ifdef USE_WIDE_CHAR
-	  if (*cp == thousands)
-	    break;
-#else
-	  if (cp[thousands_len - 1] == *thousands)
-	    {
-	      for (cnt = 1; thousands[cnt] != '\0'; ++cnt)
-		if (thousands[cnt] != cp[thousands_len - 1 - cnt])
-		  break;
-	      if (thousands[cnt] == '\0')
-		break;
-	    }
-#endif
-	  --cp;
-	}
-
-      /* We allow the representation to contain no grouping at all even if
-	 the locale specifies we can have grouping.  */
-      if (cp < begin)
-	return end;
-
-      if (end - cp == (int) *gp + 1)
-	{
-	  /* This group matches the specification.  */
-
-	  const STRING_TYPE *new_end;
-
-	  if (cp < begin)
-	    /* There is just one complete group.  We are done.  */
-	    return end;
-
-	  /* CP points to a thousands separator character.  The preceding
-	     remainder of the string from BEGIN to NEW_END is the part we
-	     will consider if there is a grouping error in this trailing
-	     portion from CP to END.  */
-	  new_end = cp - 1;
-
-	  /* Loop while the grouping is correct.  */
-	  while (1)
-	    {
-	      /* Get the next grouping rule.  */
-	      ++gp;
-	      if (*gp == 0)
-		/* If end is reached use last rule.  */
-	        --gp;
-
-	      /* Skip the thousands separator.  */
-	      --cp;
-
-	      if (*gp == CHAR_MAX
-#if CHAR_MIN < 0
-		  || *gp < 0
-#endif
-		  )
-	        {
-	          /* No more thousands separators are allowed to follow.  */
-	          while (cp >= begin)
-		    {
-#ifdef USE_WIDE_CHAR
-		      if (*cp == thousands)
-			break;
-#else
-		      for (cnt = 0; thousands[cnt] != '\0'; ++cnt)
-			if (thousands[cnt] != cp[thousands_len - cnt - 1])
-			  break;
-		      if (thousands[cnt] == '\0')
-			break;
-#endif
-		      --cp;
-		    }
-
-	          if (cp < begin)
-		    /* OK, only digits followed.  */
-		    return end;
-	        }
-	      else
-	        {
-		  /* Check the next group.  */
-	          const STRING_TYPE *group_end = cp;
-
-		  while (cp >= begin)
-		    {
-#ifdef USE_WIDE_CHAR
-		      if (*cp == thousands)
-			break;
-#else
-		      for (cnt = 0; thousands[cnt] != '\0'; ++cnt)
-			if (thousands[cnt] != cp[thousands_len - cnt - 1])
-			  break;
-		      if (thousands[cnt] == '\0')
-			break;
-#endif
-		      --cp;
-		    }
-
-		  if (cp < begin && group_end - cp <= (int) *gp)
-		    /* Final group is correct.  */
-		    return end;
-
-		  if (cp < begin || group_end - cp != (int) *gp)
-		    /* Incorrect group.  Punt.  */
-		    break;
-		}
-	    }
-
-	  /* The trailing portion of the string starting at NEW_END
-	     contains a grouping error.  So we will look for a correctly
-	     grouped number in the preceding portion instead.  */
-	  end = new_end;
-	}
-      else
-	{
-	  /* Even the first group was wrong; determine maximum shift.  */
-	  if (end - cp > (int) *gp + 1)
-	    end = cp + (int) *gp + 1;
-	  else if (cp < begin)
-	    /* This number does not fill the first group, but is correct.  */
-	    return end;
-	  else
-	    /* CP points to a thousands separator character.  */
-	    end = cp;
-	}
-    }
-
-  return MAX (begin, end);
-}
+extern const wchar_t *__correctly_grouped_prefixwc (const wchar_t *begin,
+						    const wchar_t *end,
+						    wchar_t thousands,
+						    const char *grouping)
+     attribute_hidden;
+
+extern const char *__correctly_grouped_prefixmb (const char *begin,
+						 const char *end,
+						 const char *thousands,
+						 const char *grouping)
+     attribute_hidden;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/groupingwc.c libc-20030708/stdlib/groupingwc.c
--- glibc-2.3.2/stdlib/groupingwc.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/stdlib/groupingwc.c	2003-06-12 07:10:46.000000000 +0900
@@ -0,0 +1,2 @@
+#define USE_WIDE_CHAR	1
+#include "grouping.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/rpmatch.c libc-20030708/stdlib/rpmatch.c
--- glibc-2.3.2/stdlib/rpmatch.c	2001-07-08 04:21:18.000000000 +0900
+++ libc-20030708/stdlib/rpmatch.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,7 +1,7 @@
 /* Determine whether string value is affirmation or negative response
    according to current locale's data.
    This file is part of the GNU C Library.
-   Copyright (C) 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2000, 2003 Free Software Foundation, Inc.
 
    The GNU C Library is free software; you can redistribute it and/or
    modify it under the terms of the GNU Lesser General Public
@@ -29,11 +29,11 @@
 {
   /* Match against one of the response patterns, compiling the pattern
      first if necessary.  */
-  auto inline int try (const int tag, const int match, const int nomatch,
-		       const char **lastp, regex_t *re);
+  auto int try (const int tag, const int match, const int nomatch,
+		const char **lastp, regex_t *re);
 
-  inline int try (const int tag, const int match, const int nomatch,
-		  const char **lastp, regex_t *re)
+  int try (const int tag, const int match, const int nomatch,
+	   const char **lastp, regex_t *re)
     {
       const char *pattern = nl_langinfo (tag);
       if (pattern != *lastp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/stdlib.h libc-20030708/stdlib/stdlib.h
--- glibc-2.3.2/stdlib/stdlib.h	2002-08-28 11:11:33.000000000 +0900
+++ libc-20030708/stdlib/stdlib.h	2003-04-28 23:53:23.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-99,2000,01,02 Free Software Foundation, Inc.
+/* Copyright (C) 1991-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -410,7 +410,9 @@
 /* Read a number from a string S in base 64 as above.  */
 extern long int a64l (__const char *__s) __THROW __attribute_pure__;
 
+#endif	/* Use SVID || extended X/Open.  */
 
+#if defined __USE_SVID || defined __USE_XOPEN_EXTENDED || defined __USE_BSD
 # include <sys/types.h>	/* we need int32_t... */
 
 /* These are the functions that actually do things.  The `random', `srandom',
@@ -463,7 +465,7 @@
 extern int setstate_r (char *__restrict __statebuf,
 		       struct random_data *__restrict __buf) __THROW;
 # endif	/* Use misc.  */
-#endif	/* Use SVID || extended X/Open.  */
+#endif	/* Use SVID || extended X/Open || BSD. */
 
 
 __BEGIN_NAMESPACE_STD
@@ -664,18 +666,21 @@
    The last six characters of TEMPLATE must be "XXXXXX";
    they are replaced with a string that makes the filename unique.
    Returns a file descriptor open on the file for reading and writing,
-   or -1 if it cannot create a uniquely-named file.  */
+   or -1 if it cannot create a uniquely-named file.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
 # ifndef __USE_FILE_OFFSET64
-extern int mkstemp (char *__template) __THROW;
+extern int mkstemp (char *__template);
 # else
 #  ifdef __REDIRECT
-extern int __REDIRECT (mkstemp, (char *__template) __THROW, mkstemp64);
+extern int __REDIRECT (mkstemp, (char *__template), mkstemp64);
 #  else
 #   define mkstemp mkstemp64
 #  endif
 # endif
 # ifdef __USE_LARGEFILE64
-extern int mkstemp64 (char *__template) __THROW;
+extern int mkstemp64 (char *__template);
 # endif
 #endif
 
@@ -690,8 +695,11 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Execute the given line as a shell command.  */
-extern int system (__const char *__command) __THROW;
+/* Execute the given line as a shell command.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int system (__const char *__command);
 __END_NAMESPACE_STD
 
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/strtod.c libc-20030708/stdlib/strtod.c
--- glibc-2.3.2/stdlib/strtod.c	2003-02-22 18:10:31.000000000 +0900
+++ libc-20030708/stdlib/strtod.c	2003-06-12 08:54:04.000000000 +0900
@@ -64,9 +64,11 @@
 /* The gmp headers need some configuration frobs.  */
 #define HAVE_ALLOCA 1
 
+/* Include gmp-mparam.h first, such that definitions of _SHORT_LIMB
+   and _LONG_LONG_LIMB in it can take effect into gmp.h.  */
+#include <gmp-mparam.h>
 #include <gmp.h>
 #include <gmp-impl.h>
-#include <gmp-mparam.h>
 #include <longlong.h>
 #include "fpioconst.h"
 
@@ -157,7 +159,7 @@
 #  define MAX_FAC_PER_LIMB	1000000000UL
 #elif	BITS_PER_MP_LIMB == 64
 #  define MAX_DIG_PER_LIMB	19
-#  define MAX_FAC_PER_LIMB	10000000000000000000UL
+#  define MAX_FAC_PER_LIMB	10000000000000000000ULL
 #else
 #  error "mp_limb_t size " BITS_PER_MP_LIMB "not accounted for"
 #endif
@@ -166,14 +168,14 @@
 /* Local data structure.  */
 static const mp_limb_t _tens_in_limb[MAX_DIG_PER_LIMB + 1] =
 {    0,                   10,                   100,
-     1000,                10000,                100000,
-     1000000,             10000000,             100000000,
-     1000000000
+     1000,                10000,                100000L,
+     1000000L,            10000000L,            100000000L,
+     1000000000L
 #if BITS_PER_MP_LIMB > 32
-	       ,	   10000000000U,          100000000000U,
-     1000000000000U,       10000000000000U,       100000000000000U,
-     1000000000000000U,    10000000000000000U,    100000000000000000U,
-     1000000000000000000U, 10000000000000000000U
+	        ,	  10000000000ULL,       100000000000ULL,
+     1000000000000ULL,    10000000000000ULL,    100000000000000ULL,
+     1000000000000000ULL, 10000000000000000ULL, 100000000000000000ULL,
+     1000000000000000000ULL, 10000000000000000000ULL
 #endif
 #if BITS_PER_MP_LIMB > 64
   #error "Need to expand tens_in_limb table to" MAX_DIG_PER_LIMB
@@ -205,7 +207,7 @@
 
 /* Return a floating point number of the needed type according to the given
    multi-precision number after possible rounding.  */
-static inline FLOAT
+static FLOAT
 round_and_return (mp_limb_t *retval, int exponent, int negative,
 		  mp_limb_t round_limb, mp_size_t round_bit, int more_bits)
 {
@@ -300,7 +302,7 @@
    character od the string that is not part of the integer as the function
    value.  If the EXPONENT is small enough to be taken as an additional
    factor for the resulting number (see code) multiply by it.  */
-static inline const STRING_TYPE *
+static const STRING_TYPE *
 str_to_mpn (const STRING_TYPE *str, int digcnt, mp_limb_t *n, mp_size_t *nsize,
 	    int *exponent
 #ifndef USE_WIDE_CHAR
@@ -399,10 +401,11 @@
    Tege doesn't like this function so I have to write it here myself. :)
    --drepper */
 static inline void
+__attribute ((always_inline))
 __mpn_lshift_1 (mp_limb_t *ptr, mp_size_t size, unsigned int count,
 		mp_limb_t limb)
 {
-  if (count == BITS_PER_MP_LIMB)
+  if (__builtin_constant_p (count) && count == BITS_PER_MP_LIMB)
     {
       /* Optimize the case of shifting by exactly a word:
 	 just copy words, with no actual bit-shifting.  */
@@ -566,7 +569,7 @@
   for (cnt = 0; decimal[cnt] != '\0'; ++cnt)
     if (cp[cnt] != decimal[cnt])
       break;
-  if (decimal[cnt] == '\0' && cp[1] >= '0' && cp[1] <= '9')
+  if (decimal[cnt] == '\0' && cp[cnt] >= '0' && cp[cnt] <= '9')
     {
       /* We accept it.  This funny construct is here only to indent
 	 the code directly.  */
@@ -690,7 +693,13 @@
 			 || (CHAR_TYPE) TOLOWER (c) != L_('p')))
       && (base != 16 && (CHAR_TYPE) TOLOWER (c) != L_('e')))
     {
-      tp = correctly_grouped_prefix (start_of_digits, cp, thousands, grouping);
+#ifdef USE_WIDE_CHAR
+      tp = __correctly_grouped_prefixwc (start_of_digits, cp, thousands,
+					 grouping);
+#else
+      tp = __correctly_grouped_prefixmb (start_of_digits, cp, thousands,
+					 grouping);
+#endif
       /* If TP is at the start of the digits, there was no correctly
 	 grouped prefix of the string; so no number found.  */
       RETURN (0.0, tp == start_of_digits ? (base == 16 ? cp - 1 : nptr) : tp);
@@ -731,7 +740,13 @@
   if (grouping && dig_no > 0)
     {
       /* Check the grouping of the digits.  */
-      tp = correctly_grouped_prefix (start_of_digits, cp, thousands, grouping);
+#ifdef USE_WIDE_CHAR
+      tp = __correctly_grouped_prefixwc (start_of_digits, cp, thousands,
+					 grouping);
+#else
+      tp = __correctly_grouped_prefixmb (start_of_digits, cp, thousands,
+					 grouping);
+#endif
       if (cp != tp)
         {
 	  /* Less than the entire string was correctly grouped.  */
@@ -880,7 +895,7 @@
   if (dig_no == int_no && dig_no > 0 && exponent < 0)
     do
       {
-	while (expp[-1] < L_('0') || expp[-1] > L_('9'))
+	while (! (base == 16 ? ISXDIGIT (expp[-1]) : ISDIGIT (expp[-1])))
 	  --expp;
 
 	if (expp[-1] != L_('0'))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/stdlib/tst-strtod.c libc-20030708/stdlib/tst-strtod.c
--- glibc-2.3.2/stdlib/tst-strtod.c	2003-02-22 18:08:26.000000000 +0900
+++ libc-20030708/stdlib/tst-strtod.c	2003-07-08 22:58:09.000000000 +0900
@@ -71,6 +71,7 @@
     { "-Inf", -HUGE_VAL, '\0', 0 },
     { "+InFiNiTy", HUGE_VAL, '\0', 0 },
 #endif
+    { "0x80000Ap-23", 0x80000Ap-23, '\0', 0 },
     { NULL, 0, '\0', 0 }
   };
 
@@ -149,10 +150,10 @@
     }
 
   const char input2[] = "+1.000000000116415321826934814453125";
-  if (strtold (input2, NULL) != +1.000000000116415321826934814453125)
+  if (strtold (input2, NULL) != +1.000000000116415321826934814453125L)
     {
       printf ("input2: %La != %La\n", strtold (input2, NULL),
-	      +1.000000000116415321826934814453125);
+	      +1.000000000116415321826934814453125L);
       status = 1;
     }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/streams/stropts.h libc-20030708/streams/stropts.h
--- glibc-2.3.2/streams/stropts.h	2002-10-25 17:02:16.000000000 +0900
+++ libc-20030708/streams/stropts.h	2003-04-28 23:53:23.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,31 +44,41 @@
 /* Test whether FILDES is associated with a STREAM-based file.  */
 extern int isastream (int __fildes) __THROW;
 
-/* Receive next message from a STREAMS file.  */
+/* Receive next message from a STREAMS file.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int getmsg (int __fildes, struct strbuf *__restrict __ctlptr,
 		   struct strbuf *__restrict __dataptr,
-		   int *__restrict __flagsp) __THROW;
+		   int *__restrict __flagsp);
 
 /* Receive next message from a STREAMS file, with *FLAGSP allowing to
-   control which message.  */
+   control which message.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int getpmsg (int __fildes, struct strbuf *__restrict __ctlptr,
 		    struct strbuf *__restrict __dataptr,
-		    int *__restrict __bandp, int *__restrict __flagsp)
-     __THROW;
+		    int *__restrict __bandp, int *__restrict __flagsp);
 
 /* Perform the I/O control operation specified by REQUEST on FD.
    One argument may follow; its presence and type depend on REQUEST.
    Return value depends on REQUEST.  Usually -1 indicates error.  */
 extern int ioctl (int __fd, unsigned long int __request, ...) __THROW;
 
-/* Send a message on a STREAM.  */
+/* Send a message on a STREAM.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int putmsg (int __fildes, __const struct strbuf *__ctlptr,
-		   __const struct strbuf *__dataptr, int __flags) __THROW;
+		   __const struct strbuf *__dataptr, int __flags);
+
+/* Send a message on a STREAM to the BAND.
 
-/* Send a message on a STREAM to the BAND.  */
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int putpmsg (int __fildes, __const struct strbuf *__ctlptr,
-		    __const struct strbuf *__dataptr, int __band, int __flags)
-     __THROW;
+		    __const struct strbuf *__dataptr, int __band, int __flags);
 
 /* Attach a STREAMS-based file descriptor FILDES to a file PATH in the
    file system name space.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/string-inlines.c libc-20030708/string/string-inlines.c
--- glibc-2.3.2/string/string-inlines.c	2003-01-01 07:58:40.000000000 +0900
+++ libc-20030708/string/string-inlines.c	1970-01-01 09:00:00.000000000 +0900
@@ -1,39 +0,0 @@
-/* Copyright (C) 1999, 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/*  <bits/string.h> and <bits/string2.h> declare some extern inline
-    functions.  These functions are declared additionally here if
-    inlining is not possible.  */
-
-#undef __USE_STRING_INLINES
-#define __USE_STRING_INLINES
-#define _FORCE_INLINES
-#define __STRING_INLINE /* empty */
-
-/* This is to avoid PLT entries for the x86 version.  */
-#define __memcpy_g __memcpy_g_internal
-#define __strchr_g __strchr_g_internal
-
-#include <string.h>
-
-#ifdef __memcpy_c
-# undef __memcpy_g
-strong_alias (__memcpy_g_internal, __memcpy_g)
-# undef __strchr_g
-strong_alias (__strchr_g_internal, __strchr_g)
-#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/string.h libc-20030708/string/string.h
--- glibc-2.3.2/string/string.h	2002-08-28 10:04:45.000000000 +0900
+++ libc-20030708/string/string.h	2003-04-28 23:53:23.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1993, 1995-2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1993, 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -239,13 +239,19 @@
 
 
 __BEGIN_NAMESPACE_STD
-/* Return a string describing the meaning of the `errno' code in ERRNUM.  */
-extern char *strerror (int __errnum) __THROW;
+/* Return a string describing the meaning of the `errno' code in ERRNUM.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern char *strerror (int __errnum);
 __END_NAMESPACE_STD
 #if defined __USE_XOPEN2K || defined __USE_MISC
 /* Reentrant version of `strerror'.  If a temporary buffer is required, at
-   most BUFLEN bytes of BUF will be used.  */
-extern char *strerror_r (int __errnum, char *__buf, size_t __buflen) __THROW;
+   most BUFLEN bytes of BUF will be used.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern char *strerror_r (int __errnum, char *__buf, size_t __buflen);
 #endif
 
 /* We define this function always since `bzero' is sometimes needed when
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/strxfrm.c libc-20030708/string/strxfrm.c
--- glibc-2.3.2/string/strxfrm.c	2002-10-09 17:53:03.000000000 +0900
+++ libc-20030708/string/strxfrm.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995-1999,2000,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1995-1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Ulrich Drepper <drepper@cygnus.com>, 1995.
 
@@ -51,7 +51,7 @@
 #ifndef WIDE_CHAR_VERSION
 
 /* We need UTF-8 encoding of numbers.  */
-static inline int
+static int
 utf8_encode (char *buf, int val)
 {
   int retval;
@@ -196,9 +196,6 @@
       idxarr = (int32_t *) alloca (srclen * sizeof (int32_t));
       rulearr = (unsigned char *) alloca (srclen + 1);
     }
-  /* This element is only read, the value never used but to determine
-     another value which then is ignored.  */
-  rulearr[srclen] = '\0';
 
   idxmax = 0;
   do
@@ -211,6 +208,10 @@
     }
   while (*usrc != L('\0'));
 
+  /* This element is only read, the value never used but to determine
+     another value which then is ignored.  */
+  rulearr[idxmax] = '\0';
+
   /* Now the passes over the weights.  We now use the indeces we found
      before.  */
   needed = 0;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-memchr.c libc-20030708/string/test-memchr.c
--- glibc-2.3.2/string/test-memchr.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-memchr.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure memchr functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -50,7 +50,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -74,7 +76,7 @@
   align &= 7;
   if (align + len >= page_size)
     return;
-                                  
+
   for (i = 0; i < len; ++i)
     {
       buf1[align + i] = 1 + 23 * i % 127;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-memcmp.c libc-20030708/string/test-memcmp.c
--- glibc-2.3.2/string/test-memcmp.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-memcmp.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure memcmp functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -54,7 +54,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -110,7 +112,8 @@
 do_random_tests (void)
 {
   size_t i, j, n, align1, align2, pos, len;
-  int result, r;
+  int result;
+  long r;
   unsigned char *p1 = buf1 + page_size - 512;
   unsigned char *p2 = buf2 + page_size - 512;
 
@@ -159,11 +162,14 @@
       FOR_EACH_IMPL (impl, 1)
 	{
 	  r = CALL (impl, p1 + align1, p2 + align2, len);
+	  /* Test whether on 64-bit architectures where ABI requires
+	     callee to promote has the promotion been done.  */
+	  asm ("" : "=g" (r) : "0" (r));
 	  if ((r == 0 && result)
 	      || (r < 0 && result >= 0)
 	      || (r > 0 && result <= 0))
 	    {
-	      error (0, 0, "Iteration %zd - wrong result in function %s (%zd, %zd, %zd, %zd) %d != %d, p1 %p p2 %p",
+	      error (0, 0, "Iteration %zd - wrong result in function %s (%zd, %zd, %zd, %zd) %ld != %d, p1 %p p2 %p",
 		     n, impl->name, align1, align2, len, pos, r, result, p1, p2);
 	      ret = 1;
 	    }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-memcpy.c libc-20030708/string/test-memcpy.c
--- glibc-2.3.2/string/test-memcpy.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-memcpy.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure memcpy functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -71,7 +71,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -172,7 +174,7 @@
 	      if (align2 + len > size2)
 		align2 = size2 - len;
 	    }
-	}	    
+	}
       p1 = buf1 + page_size - size1;
       p2 = buf2 + page_size - size2;
       c = random () & 255;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-memmove.c libc-20030708/string/test-memmove.c
--- glibc-2.3.2/string/test-memmove.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-memmove.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure memmove functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -70,7 +70,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-memset.c libc-20030708/string/test-memset.c
--- glibc-2.3.2/string/test-memset.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-memset.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure memset functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -59,7 +59,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strcat.c libc-20030708/string/test-strcat.c
--- glibc-2.3.2/string/test-strcat.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-strcat.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strcat functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -59,7 +59,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strchr.c libc-20030708/string/test-strchr.c
--- glibc-2.3.2/string/test-strchr.c	2002-11-10 08:24:03.000000000 +0900
+++ libc-20030708/string/test-strchr.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strchr functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -34,7 +34,7 @@
 {
   for (; *s != (char) c; ++s)
     if (*s == '\0')
-      return NULL;  
+      return NULL;
   return (char *) s;
 }
 
@@ -63,7 +63,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -87,7 +89,7 @@
   align &= 7;
   if (align + len >= page_size)
     return;
-                                  
+
   for (i = 0; i < len; ++i)
     {
       buf1[align + i] = 32 + 23 * i % (max_char - 32);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strcmp.c libc-20030708/string/test-strcmp.c
--- glibc-2.3.2/string/test-strcmp.c	2002-11-10 08:24:03.000000000 +0900
+++ libc-20030708/string/test-strcmp.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strcmp functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -68,7 +68,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -126,7 +128,8 @@
 do_random_tests (void)
 {
   size_t i, j, n, align1, align2, pos, len1, len2;
-  int result, r;
+  int result;
+  long r;
   unsigned char *p1 = buf1 + page_size - 512;
   unsigned char *p2 = buf2 + page_size - 512;
 
@@ -196,11 +199,14 @@
       FOR_EACH_IMPL (impl, 1)
 	{
 	  r = CALL (impl, p1 + align1, p2 + align2);
+	  /* Test whether on 64-bit architectures where ABI requires
+	     callee to promote has the promotion been done.  */
+	  asm ("" : "=g" (r) : "0" (r));
 	  if ((r == 0 && result)
 	      || (r < 0 && result >= 0)
 	      || (r > 0 && result <= 0))
 	    {
-	      error (0, 0, "Iteration %zd - wrong result in function %s (%zd, %zd, %zd, %zd, %zd) %d != %d, p1 %p p2 %p",
+	      error (0, 0, "Iteration %zd - wrong result in function %s (%zd, %zd, %zd, %zd, %zd) %ld != %d, p1 %p p2 %p",
 		     n, impl->name, align1, align2, len1, len2, pos, r, result, p1, p2);
 	      ret = 1;
 	    }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strcpy.c libc-20030708/string/test-strcpy.c
--- glibc-2.3.2/string/test-strcpy.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-strcpy.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strcpy functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -61,7 +61,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));;
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strlen.c libc-20030708/string/test-strlen.c
--- glibc-2.3.2/string/test-strlen.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-strlen.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strlen functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -58,7 +58,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -81,7 +83,7 @@
   align &= 7;
   if (align + len >= page_size)
     return;
-                                  
+
   for (i = 0; i < len; ++i)
     buf1[align + i] = 1 + 7 * i % max_char;
   buf1[align + len] = 0;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strncmp.c libc-20030708/string/test-strncmp.c
--- glibc-2.3.2/string/test-strncmp.c	2002-11-10 08:24:03.000000000 +0900
+++ libc-20030708/string/test-strncmp.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strncmp functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -68,7 +68,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -132,7 +134,8 @@
 do_random_tests (void)
 {
   size_t i, j, n, align1, align2, pos, len1, len2, size;
-  int result, r;
+  int result;
+  long r;
   unsigned char *p1 = buf1 + page_size - 512;
   unsigned char *p2 = buf2 + page_size - 512;
 
@@ -206,11 +209,14 @@
       FOR_EACH_IMPL (impl, 1)
 	{
 	  r = CALL (impl, p1 + align1, p2 + align2, size);
+	  /* Test whether on 64-bit architectures where ABI requires
+	     callee to promote has the promotion been done.  */
+	  asm ("" : "=g" (r) : "0" (r));
 	  if ((r == 0 && result)
 	      || (r < 0 && result >= 0)
 	      || (r > 0 && result <= 0))
 	    {
-	      error (0, 0, "Iteration %zd - wrong result in function %s (%zd, %zd, %zd, %zd, %zd, %zd) %d != %d, p1 %p p2 %p",
+	      error (0, 0, "Iteration %zd - wrong result in function %s (%zd, %zd, %zd, %zd, %zd, %zd) %ld != %d, p1 %p p2 %p",
 		     n, impl->name, align1, align2, len1, len2, pos, size, r, result, p1, p2);
 	      ret = 1;
 	    }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strncpy.c libc-20030708/string/test-strncpy.c
--- glibc-2.3.2/string/test-strncpy.c	2002-12-07 18:01:32.000000000 +0900
+++ libc-20030708/string/test-strncpy.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strncpy functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -93,7 +93,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute__ ((unused));
+      hp_timing_t stop __attribute__ ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strpbrk.c libc-20030708/string/test-strpbrk.c
--- glibc-2.3.2/string/test-strpbrk.c	2002-11-10 08:24:03.000000000 +0900
+++ libc-20030708/string/test-strpbrk.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strpbrk functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -73,7 +73,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strrchr.c libc-20030708/string/test-strrchr.c
--- glibc-2.3.2/string/test-strrchr.c	2002-11-08 04:14:44.000000000 +0900
+++ libc-20030708/string/test-strrchr.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strrchr functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -53,7 +53,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
@@ -77,7 +79,7 @@
   align &= 7;
   if (align + len >= page_size)
     return;
-                                  
+
   for (i = 0; i < len; ++i)
     {
       buf1[align + i] = random () & max_char;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/test-strspn.c libc-20030708/string/test-strspn.c
--- glibc-2.3.2/string/test-strspn.c	2002-11-10 08:24:03.000000000 +0900
+++ libc-20030708/string/test-strspn.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test and measure strspn functions.
-   Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Jakub Jelinek <jakub@redhat.com>, 1999.
 
@@ -77,7 +77,9 @@
 
   if (HP_TIMING_AVAIL)
     {
-      hp_timing_t start, stop, best_time = ~ (hp_timing_t) 0;
+      hp_timing_t start __attribute ((unused));
+      hp_timing_t stop __attribute ((unused));
+      hp_timing_t best_time = ~ (hp_timing_t) 0;
       size_t i;
 
       for (i = 0; i < 32; ++i)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/string/tester.c libc-20030708/string/tester.c
--- glibc-2.3.2/string/tester.c	2003-01-14 15:44:06.000000000 +0900
+++ libc-20030708/string/tester.c	2003-04-15 23:55:47.000000000 +0900
@@ -89,8 +89,8 @@
 	  int k;
 	  for (k = 0; k < 0x3f; k++)
 	    {
-	      buf1[j] = '0' ^ (k & 4);
-	      buf2[j] = '4' ^ (k & 4);
+	      buf1[k] = '0' ^ (k & 4);
+	      buf2[k] = '4' ^ (k & 4);
 	    }
 	  buf1[i] = buf1[0x3f] = 0;
 	  buf2[j] = buf2[0x3f] = 0;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sunrpc/Makefile libc-20030708/sunrpc/Makefile
--- glibc-2.3.2/sunrpc/Makefile	2002-10-18 02:05:56.000000000 +0900
+++ libc-20030708/sunrpc/Makefile	2003-06-12 08:54:04.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1994-2001, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1994-2001, 2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -54,7 +54,8 @@
 	  $(rpcsvc:%=rpcsvc/%) rpcsvc/bootparam.h
 install-others = $(inst_sysconfdir)/rpc
 generated = $(rpcsvc:%.x=rpcsvc/%.h) $(rpcsvc:%.x=x%.c) $(rpcsvc:%.x=x%.stmp) \
-	    $(rpcsvc:%.x=rpcsvc/%.stmp) rpc-proto.c rpc-proto.d rpcgen
+	    $(rpcsvc:%.x=rpcsvc/%.stmp) rpcgen
+generated-dirs := rpcsvc
 
 routines := auth_none auth_unix authuxprot bindrsvprt \
 	    clnt_gen clnt_perr clnt_raw clnt_simp clnt_tcp \
@@ -167,26 +168,20 @@
 # Gratuitous dependency on generated .c file here just gets it mentioned to
 # avoid being an intermediate file and getting removed.
 define o-iterator-doit
-$(rpcsvc:%.x=$(objpfx)x%$o): $(objpfx)x%$o: $(objpfx)x%.c $(objpfx)rpcsvc/%.h \
-					    $(objpfx)rpc-proto.d
+$(rpcsvc:%.x=$(objpfx)x%$o): $(objpfx)x%$o: $(objpfx)x%.c $(objpfx)rpcsvc/%.h
 endef
 object-suffixes-left = $(filter-out $(librpcsvc-inhibit-o),$(object-suffixes))
 include $(o-iterator)
 
-ifndef no_deps
--include $(objpfx)rpc-proto.d
+rpcsvc-dt-files := $(foreach o,$(filter-out $(librpcsvc-inhibit-o),\
+					    $(object-suffixes)),\
+			     $(rpcsvc:%.x=$(objpfx)x%$o.dt))
+rpcsvc-depfiles := $(patsubst %.dt,%.d,$(wildcard $(rpcsvc-dt-files))) \
+		   $(wildcard $(rpcsvc-dt-files:.dt=.d))
+ifdef rpcsvc-depfiles
+ifneq ($(no_deps),t)
+-include $(rpcsvc-depfiles)
+endif
 endif
-
-$(objpfx)rpc-proto.d: $(objpfx)%.d: $(objpfx)%.c
-	$(+make-deps)
-# Special file to generate dependencies for the RPC service objects.
-# Collect all include directives from the source files.
-$(objpfx)rpc-proto.c: $(rpcsvc:%=rpcsvc/%)
-	$(make-target-directory)
-	{ echo '#include <rpc/types.h>'; \
-	  echo '#include <rpc/xdr.h>'; \
-	  echo '#include <rpc/rpc.h>'; \
-	  sed -n '/^%#include/s/%//p' $^; } > $@T
-	mv -f $@T $@
 
 $(objpfx)thrsvc: $(shared-thread-library)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sunrpc/xdr.c libc-20030708/sunrpc/xdr.c
--- glibc-2.3.2/sunrpc/xdr.c	2002-02-25 19:03:26.000000000 +0900
+++ libc-20030708/sunrpc/xdr.c	2003-04-15 23:55:47.000000000 +0900
@@ -704,6 +704,13 @@
       return FALSE;
     }
   nodesize = size + 1;
+  if (nodesize == 0)
+    {
+      /* This means an overflow.  It a bug in the caller which
+	 provided a too large maxsize but nevertheless catch it
+	 here.  */
+      return FALSE;
+    }
 
   /*
    * now deal with the actual bytes
@@ -711,10 +718,6 @@
   switch (xdrs->x_op)
     {
     case XDR_DECODE:
-      if (nodesize == 0)
-	{
-	  return TRUE;
-	}
       if (sp == NULL)
 	*cpp = sp = (char *) mem_alloc (nodesize);
       if (sp == NULL)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/alphaev6/memchr.S libc-20030708/sysdeps/alpha/alphaev6/memchr.S
--- glibc-2.3.2/sysdeps/alpha/alphaev6/memchr.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/alphaev6/memchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Mosberger (davidm@cs.arizona.edu).
    EV6 optimized by Rick Gorton <rick.gorton@alpha-processor.com>.
@@ -190,3 +190,4 @@
 #if !__BOUNDED_POINTERS__
 weak_alias (__memchr, __ubp_memchr)
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/alphaev6/memcpy.S libc-20030708/sysdeps/alpha/alphaev6/memcpy.S
--- glibc-2.3.2/sysdeps/alpha/alphaev6/memcpy.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/alphaev6/memcpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    EV6 optimized by Rick Gorton <rick.gorton@alpha-processor.com>.
 
@@ -252,3 +252,4 @@
 	nop				# E :
 
 END(memcpy)
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/alphaev6/memset.S libc-20030708/sysdeps/alpha/alphaev6/memset.S
--- glibc-2.3.2/sysdeps/alpha/alphaev6/memset.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/alphaev6/memset.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    Contributed by Richard Henderson (rth@tamu.edu)
    EV6 optimized by Rick Gorton <rick.gorton@alpha-processor.com>.
    This file is part of the GNU C Library.
@@ -221,3 +221,4 @@
 	ret $31,($26),1		# L0 :
 
 	END(memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/alphaev67/strcat.S libc-20030708/sysdeps/alpha/alphaev67/strcat.S
--- glibc-2.3.2/sysdeps/alpha/alphaev67/strcat.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/alphaev67/strcat.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    Contributed by Richard Henderson <rth@tamu.edu>, 1996.
    EV67 optimized by Rick Gorton <rick.gorton@alpha-processor.com>.
    This file is part of the GNU C Library.
@@ -59,3 +59,4 @@
 	jmp	$31, __stxcpy	# L0 :
 
 	END(strcat)
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/alphaev67/strchr.S libc-20030708/sysdeps/alpha/alphaev67/strchr.S
--- glibc-2.3.2/sysdeps/alpha/alphaev67/strchr.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/alphaev67/strchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    Contributed by Richard Henderson <rth@tamu.edu>, 1996.
    EV67 optimized by Rick Gorton <rick.gorton@alpha-processor.com>.
    This file is part of the GNU C Library.
@@ -98,3 +98,4 @@
 	END(strchr)
 
 weak_alias (strchr, index)
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/alphaev67/strlen.S libc-20030708/sysdeps/alpha/alphaev67/strlen.S
--- glibc-2.3.2/sysdeps/alpha/alphaev67/strlen.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/alphaev67/strlen.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    Contributed by David Mosberger (davidm@cs.arizona.edu).
    EV67 optimized by Rick Gorton <rick.gorton@alpha-processor.com>.
    This file is part of the GNU C Library.
@@ -58,3 +58,4 @@
 	ret	$31, ($26)	# L0 :
 
 	END(strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/alphaev67/strrchr.S libc-20030708/sysdeps/alpha/alphaev67/strrchr.S
--- glibc-2.3.2/sysdeps/alpha/alphaev67/strrchr.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/alphaev67/strrchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    EV67 optimized by Rick Gorton <rick.gorton@alpha-processor.com>.
    This file is part of the GNU C Library.
 
@@ -114,3 +114,4 @@
 END(strrchr)
 
 weak_alias (strrchr, rindex)
+libc_hidden_builtin_def (strrchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/bits/atomic.h libc-20030708/sysdeps/alpha/bits/atomic.h
--- glibc-2.3.2/sysdeps/alpha/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/alpha/bits/atomic.h	2003-07-01 08:21:38.000000000 +0900
@@ -0,0 +1,369 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+
+#ifdef UP
+# define __MB		/* nothing */
+#else
+# define __MB		"	mb\n"
+#endif
+
+
+/* Compare and exchange.  For all of the "xxx" routines, we expect a
+   "__prev" and a "__cmp" variable to be provided by the enclosing scope,
+   in which values are returned.  */
+
+#define __arch_compare_and_exchange_xxx_8_int(mem, new, old, mb1, mb2)	\
+({									\
+  unsigned long __tmp, __snew, __addr64;				\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"	andnot	%[__addr8],7,%[__addr64]\n"			\
+	"	insbl	%[__new],%[__addr8],%[__snew]\n"		\
+	"1:	ldq_l	%[__tmp],0(%[__addr64])\n"			\
+	"	extbl	%[__tmp],%[__addr8],%[__prev]\n"		\
+	"	cmpeq	%[__prev],%[__old],%[__cmp]\n"			\
+	"	beq	%[__cmp],2f\n"					\
+	"	mskbl	%[__tmp],%[__addr8],%[__tmp]\n"			\
+	"	or	%[__snew],%[__tmp],%[__tmp]\n"			\
+	"	stq_c	%[__tmp],0(%[__addr64])\n"			\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	"2:"								\
+	: [__prev] "=&r" (__prev),					\
+	  [__snew] "=&r" (__snew),					\
+	  [__tmp] "=&r" (__tmp),					\
+	  [__cmp] "=&r" (__cmp),					\
+	  [__addr64] "=&r" (__addr64)					\
+	: [__addr8] "r" (mem),						\
+	  [__old] "Ir" ((uint64_t)(uint8_t)(old)),			\
+	  [__new] "r" (new)						\
+	: "memory");							\
+})
+
+#define __arch_compare_and_exchange_xxx_16_int(mem, new, old, mb1, mb2) \
+({									\
+  unsigned long __tmp, __snew, __addr64;				\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"	andnot	%[__addr16],7,%[__addr64]\n"			\
+	"	inswl	%[__new],%[__addr16],%[__snew]\n"		\
+	"1:	ldq_l	%[__tmp],0(%[__addr64])\n"			\
+	"	extwl	%[__tmp],%[__addr16],%[__prev]\n"		\
+	"	cmpeq	%[__prev],%[__old],%[__cmp]\n"			\
+	"	beq	%[__cmp],2f\n"					\
+	"	mskwl	%[__tmp],%[__addr16],%[__tmp]\n"		\
+	"	or	%[__snew],%[__tmp],%[__tmp]\n"			\
+	"	stq_c	%[__tmp],0(%[__addr64])\n"			\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	"2:"								\
+	: [__prev] "=&r" (__prev),					\
+	  [__snew] "=&r" (__snew),					\
+	  [__tmp] "=&r" (__tmp),					\
+	  [__cmp] "=&r" (__cmp),					\
+	  [__addr64] "=&r" (__addr64)					\
+	: [__addr16] "r" (mem),						\
+	  [__old] "Ir" ((uint64_t)(uint16_t)(old)),			\
+	  [__new] "r" (new)						\
+	: "memory");							\
+})
+
+#define __arch_compare_and_exchange_xxx_32_int(mem, new, old, mb1, mb2) \
+({									\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"1:	ldl_l	%[__prev],%[__mem]\n"				\
+	"	cmpeq	%[__prev],%[__old],%[__cmp]\n"			\
+	"	beq	%[__cmp],2f\n"					\
+	"	mov	%[__new],%[__cmp]\n"				\
+	"	stl_c	%[__cmp],%[__mem]\n"				\
+	"	beq	%[__cmp],1b\n"					\
+		mb2							\
+	"2:"								\
+	: [__prev] "=&r" (__prev),					\
+	  [__cmp] "=&r" (__cmp)						\
+	: [__mem] "m" (*(mem)),						\
+	  [__old] "Ir" ((uint64_t)(atomic32_t)(old)),			\
+	  [__new] "Ir" (new)						\
+	: "memory");							\
+})
+
+#define __arch_compare_and_exchange_xxx_64_int(mem, new, old, mb1, mb2) \
+({									\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"1:	ldq_l	%[__prev],%[__mem]\n"				\
+	"	cmpeq	%[__prev],%[__old],%[__cmp]\n"			\
+	"	beq	%[__cmp],2f\n"					\
+	"	mov	%[__new],%[__cmp]\n"				\
+	"	stq_c	%[__cmp],%[__mem]\n"				\
+	"	beq	%[__cmp],1b\n"					\
+		mb2							\
+	"2:"								\
+	: [__prev] "=&r" (__prev),					\
+	  [__cmp] "=&r" (__cmp)						\
+	: [__mem] "m" (*(mem)),						\
+	  [__old] "Ir" (old),						\
+	  [__new] "Ir" (new)						\
+	: "memory");							\
+})
+
+/* For all "bool" routines, we return FALSE if exchange succesful.  */
+
+#define __arch_compare_and_exchange_bool_8_int(mem, new, old, mb1, mb2)	\
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_8_int(mem, new, old, mb1, mb2);	\
+   !__cmp; })
+
+#define __arch_compare_and_exchange_bool_16_int(mem, new, old, mb1, mb2) \
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_16_int(mem, new, old, mb1, mb2);	\
+   !__cmp; })
+
+#define __arch_compare_and_exchange_bool_32_int(mem, new, old, mb1, mb2) \
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_32_int(mem, new, old, mb1, mb2);	\
+   !__cmp; })
+
+#define __arch_compare_and_exchange_bool_64_int(mem, new, old, mb1, mb2) \
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_64_int(mem, new, old, mb1, mb2);	\
+   !__cmp; })
+
+/* For all "val" routines, return the old value whether exchange
+   successful or not.  */
+
+#define __arch_compare_and_exchange_val_8_int(mem, new, old, mb1, mb2)	\
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_8_int(mem, new, old, mb1, mb2);	\
+   __prev; })
+
+#define __arch_compare_and_exchange_val_16_int(mem, new, old, mb1, mb2) \
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_16_int(mem, new, old, mb1, mb2);	\
+   __prev; })
+
+#define __arch_compare_and_exchange_val_32_int(mem, new, old, mb1, mb2) \
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_32_int(mem, new, old, mb1, mb2);	\
+   __prev; })
+
+#define __arch_compare_and_exchange_val_64_int(mem, new, old, mb1, mb2) \
+({ unsigned long __prev; int __cmp;					\
+   __arch_compare_and_exchange_xxx_64_int(mem, new, old, mb1, mb2);	\
+   __prev; })
+
+/* Compare and exchange with "acquire" semantics, ie barrier after.  */
+
+#define atomic_compare_and_exchange_bool_acq(mem, new, old)	\
+  __atomic_val_bysize (__arch_compare_and_exchange_bool, int,	\
+		       mem, new, old, "", __MB)
+
+#define atomic_compare_and_exchange_val_acq(mem, new, old)	\
+  __atomic_val_bysize (__arch_compare_and_exchange_val, int,	\
+		       mem, new, old, "", __MB)
+
+/* Compare and exchange with "release" semantics, ie barrier before.  */
+
+#define atomic_compare_and_exchange_bool_rel(mem, new, old)	\
+  __atomic_val_bysize (__arch_compare_and_exchange_bool, int,	\
+		       mem, new, old, __MB, "")
+
+#define atomic_compare_and_exchange_val_rel(mem, new, old)	\
+  __atomic_val_bysize (__arch_compare_and_exchange_val, int,	\
+		       mem, new, old, __MB, "")
+
+
+/* Atomically store value and return the previous value.  */
+
+#define __arch_exchange_8_int(mem, value, mb1, mb2)			\
+({									\
+  unsigned long __ret, __tmp, __addr64, __sval;				\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"	andnot	%[__addr8],7,%[__addr64]\n"			\
+	"	insbl	%[__value],%[__addr8],%[__sval]\n"		\
+	"1:	ldq_l	%[__tmp],0(%[__addr64])\n"			\
+	"	extbl	%[__tmp],%[__addr8],%[__ret]\n"			\
+	"	mskbl	%[__tmp],%[__addr8],%[__tmp]\n"			\
+	"	or	%[__sval],%[__tmp],%[__tmp]\n"			\
+	"	stq_c	%[__tmp],0(%[__addr64])\n"			\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	: [__ret] "=&r" (__ret),					\
+	  [__sval] "=&r" (__sval),					\
+	  [__tmp] "=&r" (__tmp),					\
+	  [__addr64] "=&r" (__addr64)					\
+	: [__addr8] "r" (mem),						\
+	  [__value] "r" (value)						\
+	: "memory");							\
+  __ret; })
+
+#define __arch_exchange_16_int(mem, value, mb1, mb2)			\
+({									\
+  unsigned long __ret, __tmp, __addr64, __sval;				\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"	andnot	%[__addr16],7,%[__addr64]\n"			\
+	"	inswl	%[__value],%[__addr16],%[__sval]\n"		\
+	"1:	ldq_l	%[__tmp],0(%[__addr64])\n"			\
+	"	extwl	%[__tmp],%[__addr16],%[__ret]\n"		\
+	"	mskwl	%[__tmp],%[__addr16],%[__tmp]\n"		\
+	"	or	%[__sval],%[__tmp],%[__tmp]\n"			\
+	"	stq_c	%[__tmp],0(%[__addr64])\n"			\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	: [__ret] "=&r" (__ret),					\
+	  [__sval] "=&r" (__sval),					\
+	  [__tmp] "=&r" (__tmp),					\
+	  [__addr64] "=&r" (__addr64)					\
+	: [__addr16] "r" (mem),						\
+	  [__value] "r" (value)						\
+	: "memory");							\
+  __ret; })
+
+#define __arch_exchange_32_int(mem, value, mb1, mb2)			\
+({									\
+  signed int __ret, __tmp;						\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"1:	ldl_l	%[__ret],%[__mem]\n"				\
+	"	mov	%[__val],%[__tmp]\n"				\
+	"	stl_c	%[__tmp],%[__mem]\n"				\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	: [__ret] "=&r" (__ret),					\
+	  [__tmp] "=&r" (__tmp)						\
+	: [__mem] "m" (*(mem)),						\
+	  [__val] "Ir" (value)						\
+	: "memory");							\
+  __ret; })
+
+#define __arch_exchange_64_int(mem, value, mb1, mb2)			\
+({									\
+  unsigned long __ret, __tmp;						\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"1:	ldq_l	%[__ret],%[__mem]\n"				\
+	"	mov	%[__val],%[__tmp]\n"				\
+	"	stq_c	%[__tmp],%[__mem]\n"				\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	: [__ret] "=&r" (__ret),					\
+	  [__tmp] "=&r" (__tmp)						\
+	: [__mem] "m" (*(mem)),						\
+	  [__val] "Ir" (value)						\
+	: "memory");							\
+  __ret; })
+
+#define atomic_exchange_acq(mem, value) \
+  __atomic_val_bysize (__arch_exchange, int, mem, value, "", __MB)
+
+#define atomic_exchange_rel(mem, value) \
+  __atomic_val_bysize (__arch_exchange, int, mem, value, __MB, "")
+
+
+/* Atomically add value and return the previous (unincremented) value.  */
+
+#define __arch_exchange_and_add_8_int(mem, value, mb1, mb2) \
+  ({ __builtin_trap (); 0; })
+
+#define __arch_exchange_and_add_16_int(mem, value, mb1, mb2) \
+  ({ __builtin_trap (); 0; })
+
+#define __arch_exchange_and_add_32_int(mem, value, mb1, mb2)		\
+({									\
+  signed int __ret, __tmp;						\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"1:	ldl_l	%[__ret],%[__mem]\n"				\
+	"	addl	%[__ret],%[__val],%[__tmp]\n"			\
+	"	stl_c	%[__tmp],%[__mem]\n"				\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	: [__ret] "=&r" (__ret),					\
+	  [__tmp] "=&r" (__tmp)						\
+	: [__mem] "m" (*(mem)),						\
+	  [__val] "Ir" ((signed int)(value))				\
+	: "memory");							\
+  __ret; })
+
+#define __arch_exchange_and_add_64_int(mem, value, mb1, mb2)		\
+({									\
+  unsigned long __ret, __tmp;						\
+  __asm__ __volatile__ (						\
+		mb1							\
+	"1:	ldq_l	%[__ret],%[__mem]\n"				\
+	"	addq	%[__ret],%[__val],%[__tmp]\n"			\
+	"	stq_c	%[__tmp],%[__mem]\n"				\
+	"	beq	%[__tmp],1b\n"					\
+		mb2							\
+	: [__ret] "=&r" (__ret),					\
+	  [__tmp] "=&r" (__tmp)						\
+	: [__mem] "m" (*(mem)),						\
+	  [__val] "Ir" ((unsigned long)(value))				\
+	: "memory");							\
+  __ret; })
+
+/* ??? Barrier semantics for atomic_exchange_and_add appear to be 
+   undefined.  Use full barrier for now, as that's safe.  */
+#define atomic_exchange_and_add(mem, value) \
+  __atomic_val_bysize (__arch_exchange_and_add, int, mem, value, __MB, __MB)
+
+
+/* ??? Blah, I'm lazy.  Implement these later.  Can do better than the
+   compare-and-exchange loop provided by generic code.
+
+#define atomic_decrement_if_positive(mem)
+#define atomic_bit_test_set(mem, bit)
+
+*/
+
+#ifndef UP
+# define atomic_full_barrier()	__asm ("mb" : : : "memory");
+# define atomic_read_barrier()	__asm ("mb" : : : "memory");
+# define atomic_write_barrier()	__asm ("wmb" : : : "memory");
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/bits/setjmp.h libc-20030708/sysdeps/alpha/bits/setjmp.h
--- glibc-2.3.2/sysdeps/alpha/bits/setjmp.h	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/bits/setjmp.h	2003-04-15 23:55:47.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define the machine-dependent type `jmp_buf'.  Alpha version.
-   Copyright (C) 1992, 1997 Free Software Foundation, Inc.
+   Copyright (C) 1992, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,7 +17,10 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#ifndef _SETJMP_H
+#ifndef _BITS_SETJMP_H
+#define _BITS_SETJMP_H  1
+
+#if !defined _SETJMP_H && !defined _PTHREAD_H
 # error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
 #endif
 
@@ -80,3 +83,5 @@
 #define _JMPBUF_UNWINDS(_jmpbuf, _address)				\
      ((void *)(_address) < (void *)((_jmpbuf)[JB_SP]))
 #endif
+
+#endif  /* bits/setjmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/dl-machine.h libc-20030708/sysdeps/alpha/dl-machine.h
--- glibc-2.3.2/sysdeps/alpha/dl-machine.h	2003-02-14 15:01:15.000000000 +0900
+++ libc-20030708/sysdeps/alpha/dl-machine.h	2003-06-12 08:54:04.000000000 +0900
@@ -303,6 +303,7 @@
 	.globl _start						\n\
 	.ent _start						\n\
 _start:								\n\
+	.frame $31,0,$31,0					\n\
 	br	$gp, 0f						\n\
 0:	ldgp	$gp, 0($gp)					\n\
 	.prologue 0						\n\
@@ -314,7 +315,7 @@
 	.globl _dl_start_user					\n\
 	.ent _dl_start_user					\n\
 _dl_start_user:							\n\
-	.frame $30,0,$31,0					\n\
+	.frame $31,0,$31,0					\n\
 	.prologue 0						\n\
 	/* Save the user entry point address in s0.  */		\n\
 	mov	$0, $9						\n\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/elf/initfini.c libc-20030708/sysdeps/alpha/elf/initfini.c
--- glibc-2.3.2/sysdeps/alpha/elf/initfini.c	2002-02-09 10:58:04.000000000 +0900
+++ libc-20030708/sysdeps/alpha/elf/initfini.c	2003-07-08 22:58:09.000000000 +0900
@@ -1,5 +1,5 @@
 /* Special .init and .fini section support for Alpha.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -45,21 +45,19 @@
 /*@_init_PROLOG_BEGINS*/				\n\
 	.section .init, \"ax\", @progbits		\n\
 	.globl	_init					\n\
-	.ent	_init					\n\
+	.type	_init, @function			\n\
+	.usepv	_init, std				\n\
 _init:							\n\
 	ldgp	$29, 0($27)				\n\
 	subq	$30, 16, $30				\n\
 	lda	$27, __gmon_start__			\n\
 	stq	$26, 0($30)				\n\
 	stq	$29, 8($30)				\n\
-	.prologue 1					\n\
 	beq	$27, 1f					\n\
 	jsr	$26, ($27), __gmon_start__		\n\
 	ldq	$29, 8($30)				\n\
 	.align 3					\n\
 1:							\n\
-	.end	_init					\n\
-	.size	_init, 0				\n\
 /*@_init_PROLOG_ENDS*/					\n\
 							\n\
 /*@_init_EPILOG_BEGINS*/				\n\
@@ -73,16 +71,14 @@
 /*@_fini_PROLOG_BEGINS*/				\n\
 	.section .fini, \"ax\", @progbits		\n\
 	.globl	_fini					\n\
-	.ent	_fini					\n\
+	.type	_fini,@function				\n\
+	.usepv	_fini,std				\n\
 _fini:							\n\
 	ldgp	$29, 0($27)				\n\
 	subq	$30, 16, $30				\n\
 	stq	$26, 0($30)				\n\
 	stq	$29, 8($30)				\n\
-	.prologue 1					\n\
 	.align 3					\n\
-	.end	_fini					\n\
-	.size	_fini, 0				\n\
 /*@_fini_PROLOG_ENDS*/					\n\
 							\n\
 /*@_fini_EPILOG_BEGINS*/				\n\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/elf/start.S libc-20030708/sysdeps/alpha/elf/start.S
--- glibc-2.3.2/sysdeps/alpha/elf/start.S	2002-12-10 12:41:51.000000000 +0900
+++ libc-20030708/sysdeps/alpha/elf/start.S	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,6 @@
 /* Startup code for Alpha/ELF.
-   Copyright (C) 1993,1995,1996,1997,1998,2000,2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1993, 1995, 1996, 1997, 1998, 2000, 2001, 2002, 2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson <rth@tamu.edu>
 
@@ -26,8 +27,7 @@
 	.ent _start, 0
 	.type _start,@function
 _start:
-	.frame fp, 0, zero
-	mov	zero, fp
+	.frame	$31, 0, $31
 	br	gp, 1f
 1:	ldgp	gp, 0(gp)
 	subq	sp, 16, sp
@@ -65,6 +65,5 @@
 	.data
 	.globl __data_start
 __data_start:
-	.long 0
 	.weak data_start
 	data_start = __data_start
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/fpu/bits/mathdef.h libc-20030708/sysdeps/alpha/fpu/bits/mathdef.h
--- glibc-2.3.2/sysdeps/alpha/fpu/bits/mathdef.h	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/fpu/bits/mathdef.h	2003-04-15 23:55:47.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,9 +33,6 @@
 typedef float float_t;
 typedef double double_t;
 
-/* Signal that types stay as they were declared.  */
-#   define FLT_EVAL_METHOD	0
-
 /* Define `INFINITY' as value of type `float'.  */
 #   define INFINITY	HUGE_VALF
 
@@ -45,9 +42,6 @@
 typedef double float_t;
 typedef double double_t;
 
-/* Signal that both types are `double'.  */
-#   define FLT_EVAL_METHOD	1
-
 /* Define `INFINITY' as value of type `float'.  */
 #   define INFINITY	HUGE_VALF
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/fpu/bits/mathinline.h libc-20030708/sysdeps/alpha/fpu/bits/mathinline.h
--- glibc-2.3.2/sysdeps/alpha/fpu/bits/mathinline.h	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/fpu/bits/mathinline.h	2003-07-08 22:58:09.000000000 +0900
@@ -58,7 +58,8 @@
       !isunordered(__x, __y) && __x != __y; }))
 #endif /* ISO C99 */
 
-#if !defined __NO_MATH_INLINES && defined __OPTIMIZE__
+#if (!defined __NO_MATH_INLINES || defined __LIBC_INTERNAL_MATH_INLINES) \
+    && defined __OPTIMIZE__
 
 #define __inline_copysign(NAME, TYPE)					\
 __MATH_INLINE TYPE							\
@@ -176,6 +177,19 @@
   return __x < __y ? 0.0 : __x - __y;
 }
 
+/* Test for negative number.  Used in the signbit() macro.  */
+__MATH_INLINE int __signbitf (float __x) __THROW
+{
+  __extension__ union { float __f; int __i; } __u = { __f: __x };
+  return __u.__i < 0;
+}
+
+__MATH_INLINE int __signbit (double __x) __THROW
+{
+  __extension__ union { double __d; long __i; } __u = { __d: __x };
+  return __u.__i < 0;
+}
+
 #endif /* C99 */
 
 #endif /* __NO_MATH_INLINES */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/fpu/libm-test-ulps libc-20030708/sysdeps/alpha/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/alpha/fpu/libm-test-ulps	2002-08-20 02:57:42.000000000 +0900
+++ libc-20030708/sysdeps/alpha/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -94,7 +94,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
@@ -107,10 +107,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
@@ -145,7 +145,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -239,7 +239,7 @@
 ifloat: 2
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
@@ -258,7 +258,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -266,7 +266,7 @@
 idouble: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -453,12 +453,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -513,7 +513,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/memchr.S libc-20030708/sysdeps/alpha/memchr.S
--- glibc-2.3.2/sysdeps/alpha/memchr.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/memchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Mosberger (davidm@cs.arizona.edu).
 
@@ -173,3 +173,4 @@
 #if !__BOUNDED_POINTERS__
 weak_alias (__memchr, __ubp_memchr)
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/memset.S libc-20030708/sysdeps/alpha/memset.S
--- glibc-2.3.2/sysdeps/alpha/memset.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/memset.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    Contributed by Richard Henderson (rth@tamu.edu)
    This file is part of the GNU C Library.
 
@@ -134,3 +134,4 @@
 $done:	ret
 
 	END(memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/setjmp.S libc-20030708/sysdeps/alpha/setjmp.S
--- glibc-2.3.2/sysdeps/alpha/setjmp.S	2003-01-01 04:13:27.000000000 +0900
+++ libc-20030708/sysdeps/alpha/setjmp.S	2003-07-08 22:58:09.000000000 +0900
@@ -74,6 +74,7 @@
 
 ENTRY(_setjmp)
 	ldgp	gp, 0(pv)
+	.prologue 1
 	mov	0, a1
 	br	$sigsetjmp_local
 END(_setjmp)
@@ -81,6 +82,7 @@
 
 ENTRY(setjmp)
 	ldgp	gp, 0(pv)
+	.prologue 1
 	mov	1, a1
 	br	$sigsetjmp_local
 END(setjmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strcat.S libc-20030708/sysdeps/alpha/strcat.S
--- glibc-2.3.2/sysdeps/alpha/strcat.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strcat.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson <rth@tamu.edu>, 1996.
 
@@ -69,3 +69,4 @@
 	jmp	$31, __stxcpy
 
 	END(strcat)
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strchr.S libc-20030708/sysdeps/alpha/strchr.S
--- glibc-2.3.2/sysdeps/alpha/strchr.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson (rth@tamu.edu)
 
@@ -92,3 +92,4 @@
 	END(strchr)
 
 weak_alias (strchr, index)
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strcmp.S libc-20030708/sysdeps/alpha/strcmp.S
--- glibc-2.3.2/sysdeps/alpha/strcmp.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strcmp.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    Contributed by Richard Henderson (rth@tamu.edu)
    This file is part of the GNU C Library.
 
@@ -192,3 +192,4 @@
 	ret			# e1    :
 
 	END(strcmp)
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strcpy.S libc-20030708/sysdeps/alpha/strcpy.S
--- glibc-2.3.2/sysdeps/alpha/strcpy.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strcpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson <rth@tamu.edu>, 1996.
 
@@ -39,3 +39,4 @@
 	jmp	$31, __stxcpy	# do the copy
 
 	END(strcpy)
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strlen.S libc-20030708/sysdeps/alpha/strlen.S
--- glibc-2.3.2/sysdeps/alpha/strlen.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strlen.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    Contributed by David Mosberger (davidm@cs.arizona.edu).
    This file is part of the GNU C Library.
 
@@ -74,3 +74,4 @@
 	ret
 
 	END(strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strncmp.S libc-20030708/sysdeps/alpha/strncmp.S
--- glibc-2.3.2/sysdeps/alpha/strncmp.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strncmp.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    Contributed by Richard Henderson (rth@tamu.edu)
    This file is part of the GNU C Library.
 
@@ -221,3 +221,4 @@
 	ret
 
 	END(strncmp)
+libc_hidden_builtin_def (strncmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strncpy.S libc-20030708/sysdeps/alpha/strncpy.S
--- glibc-2.3.2/sysdeps/alpha/strncpy.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strncpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    Contributed by Richard Henderson (rth@tamu.edu)
    This file is part of the GNU C Library.
 
@@ -85,3 +85,4 @@
 	ret			# .. e1 :
 
 	END(strncpy)
+libc_hidden_builtin_def (strncpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/alpha/strrchr.S libc-20030708/sysdeps/alpha/strrchr.S
--- glibc-2.3.2/sysdeps/alpha/strrchr.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/alpha/strrchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -108,3 +108,4 @@
 	END(strrchr)
 
 weak_alias (strrchr, rindex)
+libc_hidden_builtin_def (strrchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/arm/libm-test-ulps libc-20030708/sysdeps/arm/libm-test-ulps
--- glibc-2.3.2/sysdeps/arm/libm-test-ulps	2001-04-18 03:55:56.000000000 +0900
+++ libc-20030708/sysdeps/arm/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -134,7 +134,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.7 + 1.2 i) == 1.3848657645312111080 - 0.97242170335830028619 i":
@@ -145,10 +145,10 @@
 idouble: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.7 + 1.2 i) == 0.4548202223691477654 + 0.7070296600921537682 i":
@@ -187,7 +187,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -280,7 +280,7 @@
 ifloat: 1
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.7 + 1.2 i) == 0.27487868678117583582 + 1.1698665727426565139 i":
@@ -307,7 +307,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Real part of: ctan (0.7 + 1.2 i) == 0.1720734197630349001 + 0.9544807059989405538 i":
@@ -320,7 +320,7 @@
 ifloat: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -509,12 +509,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -604,7 +604,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/arm/memset.S libc-20030708/sysdeps/arm/memset.S
--- glibc-2.3.2/sysdeps/arm/memset.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/arm/memset.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Philip Blundell <philb@gnu.org>
 
@@ -65,3 +65,4 @@
 	strb	a2, [a4], $1
 	RETINSTR(mov,pc,lr)
 END(memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/arm/strlen.S libc-20030708/sysdeps/arm/strlen.S
--- glibc-2.3.2/sysdeps/arm/strlen.S	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/arm/strlen.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Code contributed by Matthew Wilcox <willy@odie.barnet.ac.uk>
 
@@ -61,3 +61,4 @@
 	addne   r0, r0, $1              @  must be zero)
 	RETINSTR(mov,pc,lr)
 END(strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/arm/sysdep.h libc-20030708/sysdeps/arm/sysdep.h
--- glibc-2.3.2/sysdeps/arm/sysdep.h	2001-07-08 04:21:19.000000000 +0900
+++ libc-20030708/sysdeps/arm/sysdep.h	2003-03-22 05:51:59.000000000 +0900
@@ -1,5 +1,5 @@
 /* Assembler macros for ARM.
-   Copyright (C) 1997, 1998 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -76,7 +76,7 @@
 #define CALL_MCOUNT			\
 	str	lr,[sp, #-4]!	;	\
 	bl	PLTJMP(mcount)	;	\
-	ldr	lr, [sp], #4
+	ldr	lr, [sp], #4	;
 #else
 #define CALL_MCOUNT		/* Do nothing.  */
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/backtracesymsfd.c libc-20030708/sysdeps/generic/backtracesymsfd.c
--- glibc-2.3.2/sysdeps/generic/backtracesymsfd.c	2001-07-08 04:21:20.000000000 +0900
+++ libc-20030708/sysdeps/generic/backtracesymsfd.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* Write formatted list with names for addresses in backtrace to a file.
-   Copyright (C) 1998 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -23,11 +23,12 @@
 #include <sys/uio.h>
 
 #include <stdio-common/_itoa.h>
+#include <not-cancel.h>
 
 #if __ELF_NATIVE_CLASS == 32
 # define WORD_WIDTH 8
 #else
-/* We assyme 64bits.  */
+/* We assume 64bits.  */
 # define WORD_WIDTH 16
 #endif
 
@@ -55,7 +56,8 @@
       iov[2].iov_base = (void *) "]\n";
       iov[2].iov_len = 2;
 
-      __writev (fd, iov, 3);
+      /* We prefer to use the non-cancelable interface if it is available.  */
+      writev_not_cancel_no_status (fd, iov, 3);
     }
 }
 weak_alias (__backtrace_symbols_fd, backtrace_symbols_fd)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bits/atomic.h libc-20030708/sysdeps/generic/bits/atomic.h
--- glibc-2.3.2/sysdeps/generic/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/bits/atomic.h	2003-03-23 08:00:14.000000000 +0900
@@ -0,0 +1,43 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _BITS_ATOMIC_H
+#define _BITS_ATOMIC_H	1
+
+/* We have by default no support for atomic operations.  So define
+   them non-atomic.  If this is a problem somebody will have to come
+   up with real definitions.  */
+
+/* The only basic operation needed is compare and exchange.  */
+#define atomic_compare_and_exchange_val_acq(mem, newval, oldval) \
+  ({ __typeof (mem) __gmemp = (mem);				      \
+     __typeof (*mem) __gret = *__gmemp;				      \
+     __typeof (*mem) __gnewval = (newval);			      \
+								      \
+     if (__gret == (oldval))					      \
+       *__gmemp = __gnewval;					      \
+     __gret; })
+
+#define atomic_compare_and_exchange_bool_acq(mem, newval, oldval) \
+  ({ __typeof (mem) __gmemp = (mem);				      \
+     __typeof (*mem) __gnewval = (newval);			      \
+								      \
+     *__gmemp == (oldval) ? (*__gmemp = __gnewval, 0) : 1; })
+
+#endif	/* bits/atomic.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bits/confname.h libc-20030708/sysdeps/generic/bits/confname.h
--- glibc-2.3.2/sysdeps/generic/bits/confname.h	2003-02-24 10:38:15.000000000 +0900
+++ libc-20030708/sysdeps/generic/bits/confname.h	2003-03-14 15:20:58.000000000 +0900
@@ -62,8 +62,10 @@
 #define _PC_REC_XFER_ALIGN		_PC_REC_XFER_ALIGN
     _PC_ALLOC_SIZE_MIN,
 #define _PC_ALLOC_SIZE_MIN		_PC_ALLOC_SIZE_MIN
-    _PC_SYMLINK_MAX
+    _PC_SYMLINK_MAX,
 #define _PC_SYMLINK_MAX			_PC_SYMLINK_MAX
+    _PC_2_SYMLINKS
+#define _PC_2_SYMLINKS			_PC_2_SYMLINKS
   };
 
 /* Values for the argument to `sysconf'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bits/in.h libc-20030708/sysdeps/generic/bits/in.h
--- glibc-2.3.2/sysdeps/generic/bits/in.h	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/bits/in.h	2003-07-08 22:58:10.000000000 +0900
@@ -64,8 +64,8 @@
 /* IPV6 socket options.  */
 #define IPV6_ADDRFORM		1
 #define IPV6_RXINFO		2
-#define IPV6_RXHOPOPTS		3
-#define IPV6_RXDSTOPTS		4
+#define IPV6_HOPOPTS		3
+#define IPV6_DSTOPTS		4
 #define IPV6_RTHDR		5
 #define IPV6_PKTOPTIONS		6
 #define IPV6_CHECKSUM		7
@@ -85,6 +85,8 @@
 /* Obsolete synonyms for the above.  */
 #define IPV6_ADD_MEMBERSHIP	IPV6_JOIN_GROUP
 #define IPV6_DROP_MEMBERSHIP	IPV6_LEAVE_GROUP
+#define IPV6_RXHOPOPTS		IPV6_HOPOPTS
+#define IPV6_RXDSTOPTS		IPV6_DSTOPTS
 
 /* Routing header options for IPv6.  */
 #define IPV6_RTHDR_LOOSE	0	/* Hop doesn't need to be neighbour. */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bits/libc-lock.h libc-20030708/sysdeps/generic/bits/libc-lock.h
--- glibc-2.3.2/sysdeps/generic/bits/libc-lock.h	2002-12-06 19:48:04.000000000 +0900
+++ libc-20030708/sysdeps/generic/bits/libc-lock.h	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* libc-internal interface for mutex locks.  Stub version.
-   Copyright (C) 1996,97,99,2000,01,02 Free Software Foundation, Inc.
+   Copyright (C) 1996,97,99,2000-2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -40,6 +40,7 @@
 /* Define an initialized recursive lock variable NAME with storage
    class CLASS.  */
 #define __libc_lock_define_initialized_recursive(CLASS,NAME)
+#define __rtld_lock_define_initialized_recursive(CLASS,NAME)
 
 /* Initialize the named lock variable, leaving it in a consistent, unlocked
    state.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bits/sched.h libc-20030708/sysdeps/generic/bits/sched.h
--- glibc-2.3.2/sysdeps/generic/bits/sched.h	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/bits/sched.h	2003-05-12 01:30:11.000000000 +0900
@@ -1,6 +1,6 @@
 /* Definitions of constants and data structure for POSIX 1003.1b-1993
    scheduling interface.
-   Copyright (C) 1996, 1997, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,3 +33,39 @@
 {
   int __sched_priority;
 };
+
+
+#if defined _SCHED_H && !defined __cpu_set_t_defined
+# define __cpu_set_t_defined
+/* Size definition for CPU sets.  */
+# define __CPU_SETSIZE	1024
+# define __NCPUBITS	(8 * sizeof (__cpu_mask))
+
+/* Type for array elements in 'cpu_set'.  */
+typedef unsigned long int __cpu_mask;
+
+/* Basic access functions.  */
+# define __CPUELT(cpu)	((cpu) / __NCPUBITS)
+# define __CPUMASK(cpu)	((__cpu_mask) 1 << ((cpu) % __NCPUBITS))
+
+/* Data structure to describe CPU mask.  */
+typedef struct
+{
+  __cpu_mask __bits[__CPU_SETSIZE / __NCPUBITS];
+} cpu_set_t;
+
+/* Access functions for CPU masks.  */
+# define __CPU_ZERO(cpusetp) \
+  do {									      \
+    unsigned int __i;							      \
+    cpu_set *__arr = (cpusetp);						      \
+    for (__i = 0; __i < sizeof (cpu_set) / sizeof (__cpu_mask); ++__i)	      \
+      __arr->__bits[__i] = 0;						      \
+  } while (0)
+# define __CPU_SET(cpu, cpusetp) \
+  ((cpusetp)->__bits[__CPUELT (cpu)] |= __CPUMASK (cpu))
+# define __CPU_CLR(cpu, cpusetp) \
+  ((cpusetp)->__bits[__CPUELT (cpu)] &= ~__CPUMASK (cpu))
+# define __CPU_ISSET(cpu, cpusetp) \
+  (((cpusetp)->__bits[__CPUELT (cpu)] & __CPUMASK (cpu)) != 0)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bits/time.h libc-20030708/sysdeps/generic/bits/time.h
--- glibc-2.3.2/sysdeps/generic/bits/time.h	2002-10-23 15:21:18.000000000 +0900
+++ libc-20030708/sysdeps/generic/bits/time.h	2003-03-03 13:42:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* System-dependent timing definitions.  Generic version.
-   Copyright (C) 1996,1997,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1999-2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,6 +44,8 @@
 #  ifdef __USE_POSIX199309
 /* Identifier for system-wide realtime clock.  */
 #   define CLOCK_REALTIME		0
+/* Monotonic system-wide clock.  */
+#   define CLOCK_MONOTONIC		1
 /* High-resolution timer from the CPU.  */
 #   define CLOCK_PROCESS_CPUTIME_ID	2
 /* Thread-specific CPU-time clock.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bits/typesizes.h libc-20030708/sysdeps/generic/bits/typesizes.h
--- glibc-2.3.2/sysdeps/generic/bits/typesizes.h	2002-10-24 08:48:45.000000000 +0900
+++ libc-20030708/sysdeps/generic/bits/typesizes.h	2003-03-28 21:28:17.000000000 +0900
@@ -1,5 +1,5 @@
 /* bits/typesizes.h -- underlying types for *_t.  Generic version.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -54,7 +54,7 @@
 #define __SWBLK_T_TYPE		__SLONGWORD_TYPE
 #define __KEY_T_TYPE		__S32_TYPE
 #define __CLOCKID_T_TYPE	__S32_TYPE
-#define __TIMER_T_TYPE		__S32_TYPE
+#define __TIMER_T_TYPE		void *
 #define __BLKSIZE_T_TYPE	__SLONGWORD_TYPE
 #define __FSID_T_TYPE		struct { int __val[2]; }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/bp-thunks.h libc-20030708/sysdeps/generic/bp-thunks.h
--- glibc-2.3.2/sysdeps/generic/bp-thunks.h	2003-01-16 09:46:14.000000000 +0900
+++ libc-20030708/sysdeps/generic/bp-thunks.h	2003-05-02 14:47:13.000000000 +0900
@@ -1,5 +1,5 @@
 /* Bounded-pointer syscall thunk support.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Greg McGary <greg@mcgary.org>
 
@@ -21,6 +21,8 @@
 #ifndef _bpthunks_h_
 #define _bpthunks_h_
 
+#ifndef __ASSEMBLER__
+
 /* This header is included by the syscall BP thunks defined in
    sysd-syscalls, as created by sysdeps/unix/make-syscalls.sh.  It
    includes all headers that contain prototype declarations for system
@@ -63,4 +65,6 @@
 #include <sys/utsname.h>
 #include <sys/wait.h>
 
+#endif /* Not __ASSEMBLER__.  */
+
 #endif /* _bpthunks_h_ */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/check_fds.c libc-20030708/sysdeps/generic/check_fds.c
--- glibc-2.3.2/sysdeps/generic/check_fds.c	2002-04-15 03:27:21.000000000 +0900
+++ libc-20030708/sysdeps/generic/check_fds.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,6 +32,7 @@
 #endif
 
 #include <device-nrs.h>
+#include <not-cancel.h>
 
 
 /* Should other OSes (e.g., Hurd) have different versions which can
@@ -39,6 +40,7 @@
 static void
 check_one_fd (int fd, int mode)
 {
+  /* Note that fcntl() with this parameter is not a cancellation point.  */
   if (__builtin_expect (__libc_fcntl (fd, F_GETFD), 0) == -1
       && errno == EBADF)
     {
@@ -47,7 +49,7 @@
       /* Something is wrong with this descriptor, it's probably not
 	 opened.  Open /dev/null so that the SUID program we are
 	 about to start does not accidently use this descriptor.  */
-      int nullfd = __libc_open (_PATH_DEVNULL, mode);
+      int nullfd = open_not_cancel (_PATH_DEVNULL, mode, 0);
       /* We are very paranoid here.  With all means we try to ensure
 	 that we are actually opening the /dev/null device and nothing
 	 else.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/check_pf.c libc-20030708/sysdeps/generic/check_pf.c
--- glibc-2.3.2/sysdeps/generic/check_pf.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/check_pf.c	2003-06-10 17:52:14.000000000 +0900
@@ -0,0 +1,50 @@
+/* Determine protocol families for which interfaces exist.  Generic version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <ifaddrs.h>
+#include <netdb.h>
+
+
+void
+attribute_hidden
+__check_pf (bool *seen_ipv4, bool *seen_ipv6)
+{
+  /* Get the interface list via getifaddrs.  */
+  struct ifaddrs *ifa = NULL;
+  if (getifaddrs (&ifa) != 0)
+    {
+      /* We cannot determine what interfaces are available.  Be
+	 pessimistic.  */
+      *seen_ipv4 = true;
+      *seen_ipv6 = true;
+      return;
+    }
+
+  *seen_ipv4 = false;
+  *seen_ipv6 = false;
+
+  struct ifaddrs *runp;
+  for (runp = ifa; runp != NULL; runp = runp->ifa_next)
+    if (runp->ifa_addr->sa_family == PF_INET)
+      *seen_ipv4 = true;
+    else if (runp->ifa_addr->sa_family == PF_INET6)
+      *seen_ipv6 = true;
+
+  (void) freeifaddrs (ifa);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-cache.c libc-20030708/sysdeps/generic/dl-cache.c
--- glibc-2.3.2/sysdeps/generic/dl-cache.c	2002-12-29 05:38:50.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-cache.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Support for reading /etc/ld.so.cache files written by Linux ldconfig.
-   Copyright (C) 1996,1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -133,6 +133,45 @@
 while (0)
 
 
+int
+internal_function
+_dl_cache_libcmp (const char *p1, const char *p2)
+{
+  while (*p1 != '\0')
+    {
+      if (*p1 >= '0' && *p1 <= '9')
+        {
+          if (*p2 >= '0' && *p2 <= '9')
+            {
+	      /* Must compare this numerically.  */
+	      int val1;
+	      int val2;
+
+	      val1 = *p1++ - '0';
+	      val2 = *p2++ - '0';
+	      while (*p1 >= '0' && *p1 <= '9')
+	        val1 = val1 * 10 + *p1++ - '0';
+	      while (*p2 >= '0' && *p2 <= '9')
+	        val2 = val2 * 10 + *p2++ - '0';
+	      if (val1 != val2)
+		return val1 - val2;
+	    }
+	  else
+            return 1;
+        }
+      else if (*p2 >= '0' && *p2 <= '9')
+        return -1;
+      else if (*p1 != *p2)
+        return *p1 - *p2;
+      else
+	{
+	  ++p1;
+	  ++p2;
+	}
+    }
+  return *p1 - *p2;
+}
+
 
 /* Look up NAME in ld.so.cache and return the file name stored there,
    or null if none is found.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-cache.h libc-20030708/sysdeps/generic/dl-cache.h
--- glibc-2.3.2/sysdeps/generic/dl-cache.h	2002-08-25 18:25:04.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-cache.h	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Support for reading /etc/ld.so.cache files written by Linux ldconfig.
-   Copyright (C) 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,6 +32,10 @@
 # define LD_SO_CACHE SYSCONFDIR "/ld.so.cache"
 #endif
 
+#ifndef add_system_dir
+# define add_system_dir(dir) add_dir (dir)
+#endif
+
 #define CACHEMAGIC "ld.so-1.7.0"
 
 /* libc5 and glibc 2.0/2.1 use the same format.  For glibc 2.2 another
@@ -97,41 +101,5 @@
 (((addr) + __alignof__ (struct cache_file_new) -1)	\
  & (~(__alignof__ (struct cache_file_new) - 1)))
 
-static inline int
-__attribute__ ((__unused__))
-_dl_cache_libcmp (const char *p1, const char *p2)
-{
-  while (*p1 != '\0')
-    {
-      if (*p1 >= '0' && *p1 <= '9')
-        {
-          if (*p2 >= '0' && *p2 <= '9')
-            {
-	      /* Must compare this numerically.  */
-	      int val1;
-	      int val2;
-
-	      val1 = *p1++ - '0';
-	      val2 = *p2++ - '0';
-	      while (*p1 >= '0' && *p1 <= '9')
-	        val1 = val1 * 10 + *p1++ - '0';
-	      while (*p2 >= '0' && *p2 <= '9')
-	        val2 = val2 * 10 + *p2++ - '0';
-	      if (val1 != val2)
-		return val1 - val2;
-	    }
-	  else
-            return 1;
-        }
-      else if (*p2 >= '0' && *p2 <= '9')
-        return -1;
-      else if (*p1 != *p2)
-        return *p1 - *p2;
-      else
-	{
-	  ++p1;
-	  ++p2;
-	}
-    }
-  return *p1 - *p2;
-}
+extern int _dl_cache_libcmp (const char *p1, const char *p2)
+     internal_function;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-fptr.c libc-20030708/sysdeps/generic/dl-fptr.c
--- glibc-2.3.2/sysdeps/generic/dl-fptr.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-fptr.c	2003-05-10 13:38:05.000000000 +0900
@@ -0,0 +1,323 @@
+/* Manage function descriptors.  Generic version.
+   Copyright (C) 1999,2000,2001,2002,2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <libintl.h>
+#include <unistd.h>
+#include <string.h>
+#include <sys/param.h>
+#include <sys/mman.h>
+#include <link.h>
+#include <ldsodefs.h>
+#include <elf/dynamic-link.h>
+#include <dl-fptr.h>
+#include <atomic.h>
+
+#ifndef ELF_MACHINE_BOOT_FPTR_TABLE_LEN
+/* ELF_MACHINE_BOOT_FPTR_TABLE_LEN should be greater than the number of
+   dynamic symbols in ld.so.  */
+#define ELF_MACHINE_BOOT_FPTR_TABLE_LEN 256
+#endif
+
+#ifndef ELF_MACHINE_LOAD_ADDRESS
+# error "ELF_MACHINE_LOAD_ADDRESS is not defined."
+#endif
+
+#ifndef COMPARE_AND_SWAP
+#define COMPARE_AND_SWAP(ptr,old,new) \
+  atomic_compare_and_exchange_bool_acq ((ptr), (old), (new))
+#endif
+
+ElfW(Addr) _dl_boot_fptr_table [ELF_MACHINE_BOOT_FPTR_TABLE_LEN];
+
+static struct local
+  {
+    struct fdesc_table *root;
+    struct fdesc *free_list;
+    unsigned int npages;		/* # of pages to allocate */
+    /* the next to members MUST be consecutive! */
+    struct fdesc_table boot_table;
+    struct fdesc boot_fdescs[1024];
+  }
+local =
+  {
+    .root = &local.boot_table,
+    .npages = 2,
+    .boot_table =
+      {
+	.len = sizeof (local.boot_fdescs) / sizeof (local.boot_fdescs[0]),
+	.first_unused = 0
+      }
+  };
+
+/* Create a new fdesc table and return a pointer to the first fdesc
+   entry.  The fdesc lock must have been acquired already.  */
+
+static struct fdesc_table *
+new_fdesc_table (struct local *l, size_t *size)
+{
+  size_t old_npages = l->npages;
+  size_t new_npages = old_npages + old_npages;
+  struct fdesc_table *new_table;
+
+  /* If someone has just created a new table, we return NULL to tell
+     the caller to use the new table.  */
+  if (! COMPARE_AND_SWAP (&l->npages, old_npages, new_npages))
+    return (struct fdesc_table *) NULL;
+
+  *size = old_npages * GL(dl_pagesize);
+  new_table = __mmap (NULL, *size,
+		      PROT_READ | PROT_WRITE, MAP_ANON | MAP_PRIVATE, -1, 0);
+  if (new_table == MAP_FAILED)
+    INTUSE(_dl_signal_error) (errno, NULL, NULL,
+			      N_("cannot map pages for fdesc table"));
+
+  new_table->len
+    = (*size - sizeof (*new_table)) / sizeof (struct fdesc);
+  new_table->first_unused = 1;
+  return new_table;
+}
+
+
+static ElfW(Addr)
+make_fdesc (ElfW(Addr) ip, ElfW(Addr) gp)
+{
+  struct fdesc *fdesc = NULL;
+  struct fdesc_table *root;
+  unsigned int old;
+  struct local *l;
+
+  ELF_MACHINE_LOAD_ADDRESS (l, local);
+
+ retry:
+  root = l->root;
+  while (1)
+    {
+      old = root->first_unused;
+      if (old >= root->len)
+	break;
+      else if (COMPARE_AND_SWAP (&root->first_unused, old, old + 1))
+	{
+	  fdesc = &root->fdesc[old];
+	  goto install;
+	}
+    }
+
+  if (l->free_list)
+    {
+      /* Get it from free-list.  */
+      do
+	{
+	  fdesc = l->free_list;
+	  if (fdesc == NULL)
+	    goto retry;
+	}
+      while (! COMPARE_AND_SWAP ((ElfW(Addr) *) &l->free_list,
+				 (ElfW(Addr)) fdesc, fdesc->ip));
+    }
+  else
+    {
+      /* Create a new fdesc table.  */
+      size_t size;
+      struct fdesc_table *new_table = new_fdesc_table (l, &size);
+
+      if (new_table == NULL)
+	goto retry;
+
+      new_table->next = root;
+      if (! COMPARE_AND_SWAP ((ElfW(Addr) *) &l->root,
+			      (ElfW(Addr)) root,
+			      (ElfW(Addr)) new_table))
+	{
+	  /* Someone has just installed a new table. Return NULL to
+	     tell the caller to use the new table.  */
+	  __munmap (new_table, size);
+	  goto retry;
+	}
+
+      /* Note that the first entry was reserved while allocating the
+	 memory for the new page.  */
+      fdesc = &new_table->fdesc[0];
+    }
+
+ install:
+  fdesc->ip = ip;
+  fdesc->gp = gp;
+
+  return (ElfW(Addr)) fdesc;
+}
+
+
+static inline ElfW(Addr) *
+make_fptr_table (struct link_map *map)
+{
+  const ElfW(Sym) *symtab
+    = (const void *) D_PTR (map, l_info[DT_SYMTAB]);
+  const char *strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
+  ElfW(Addr) *fptr_table;
+  size_t size;
+  size_t len;
+
+  /* XXX Apparently the only way to find out the size of the dynamic
+     symbol section is to assume that the string table follows right
+     afterwards...  */
+  len = ((strtab - (char *) symtab)
+	 / map->l_info[DT_SYMENT]->d_un.d_val);
+  size = ((len * sizeof (fptr_table[0]) + GL(dl_pagesize) - 1)
+	  & -GL(dl_pagesize));
+  /* XXX We don't support here in the moment systems without MAP_ANON.
+     There probably are none for IA-64.  In case this is proven wrong
+     we will have to open /dev/null here and use the file descriptor
+     instead of the hard-coded -1.  */
+  fptr_table = __mmap (NULL, size,
+		       PROT_READ | PROT_WRITE, MAP_ANON | MAP_PRIVATE,
+		       -1, 0);
+  if (fptr_table == MAP_FAILED)
+    INTUSE(_dl_signal_error) (errno, NULL, NULL,
+			      N_("cannot map pages for fptr table"));
+
+  if (COMPARE_AND_SWAP ((ElfW(Addr) *) &map->l_mach.fptr_table,
+			(ElfW(Addr)) NULL, (ElfW(Addr)) fptr_table))
+    map->l_mach.fptr_table_len = len;
+  else
+    __munmap (fptr_table, len * sizeof (fptr_table[0]));
+
+  return map->l_mach.fptr_table;
+}
+
+
+ElfW(Addr)
+_dl_make_fptr (struct link_map *map, const ElfW(Sym) *sym,
+	       ElfW(Addr) ip)
+{
+  ElfW(Addr) *ftab = map->l_mach.fptr_table;
+  const ElfW(Sym) *symtab;
+  Elf_Symndx symidx;
+  struct local *l;
+
+  if (__builtin_expect (ftab == NULL, 0))
+    ftab = make_fptr_table (map);
+
+  symtab = (const void *) D_PTR (map, l_info[DT_SYMTAB]);
+  symidx = sym - symtab;
+
+  if (symidx >= map->l_mach.fptr_table_len)
+    INTUSE(_dl_signal_error) (0, NULL, NULL, N_("\
+internal error: symidx out of range of fptr table"));
+
+  while (ftab[symidx] == 0)
+    {
+      /* GOT has already been relocated in elf_get_dynamic_info -
+	 don't try to relocate it again.  */
+      ElfW(Addr) fdesc
+	= make_fdesc (ip, map->l_info[DT_PLTGOT]->d_un.d_ptr);
+
+      if (__builtin_expect (COMPARE_AND_SWAP (&ftab[symidx], (ElfW(Addr)) NULL,
+					      fdesc), 1))
+	{
+	  /* Noone has updated the entry and the new function
+	     descriptor has been installed.  */
+#if 0
+	  const char *strtab
+	    = (const void *) D_PTR (map, l_info[DT_STRTAB]);
+
+	  ELF_MACHINE_LOAD_ADDRESS (l, local);
+	  if (l->root != &l->boot_table
+	      || l->boot_table.first_unused > 20)
+	    _dl_debug_printf ("created fdesc symbol `%s' at %lx\n",
+			      strtab + sym->st_name, ftab[symidx]);
+#endif
+	  break;
+	}
+      else
+	{
+	  /* We created a duplicated function descriptor. We put it on
+	     free-list.  */
+	  struct fdesc *f = (struct fdesc *) fdesc;
+
+	  ELF_MACHINE_LOAD_ADDRESS (l, local);
+
+	  do
+	    f->ip = (ElfW(Addr)) l->free_list;
+	  while (! COMPARE_AND_SWAP ((ElfW(Addr) *) &l->free_list,
+				     f->ip, fdesc));
+	}
+    }
+
+  return ftab[symidx];
+}
+
+
+void
+_dl_unmap (struct link_map *map)
+{
+  ElfW(Addr) *ftab = map->l_mach.fptr_table;
+  struct fdesc *head = NULL, *tail = NULL;
+  size_t i;
+
+  __munmap ((void *) map->l_map_start,
+	    map->l_map_end - map->l_map_start);
+
+  if (ftab == NULL)
+    return;
+
+  /* String together the fdesc structures that are being freed.  */
+  for (i = 0; i < map->l_mach.fptr_table_len; ++i)
+    {
+      if (ftab[i])
+	{
+	  *(struct fdesc **) ftab[i] = head;
+	  head = (struct fdesc *) ftab[i];
+	  if (tail == NULL)
+	    tail = head;
+	}
+    }
+
+  /* Prepend the new list to the free_list: */
+  if (tail)
+    do
+      tail->ip = (ElfW(Addr)) local.free_list;
+    while (! COMPARE_AND_SWAP ((ElfW(Addr) *) &local.free_list,
+			       tail->ip, (ElfW(Addr)) head));
+
+  __munmap (ftab, (map->l_mach.fptr_table_len
+		   * sizeof (map->l_mach.fptr_table[0])));
+
+  map->l_mach.fptr_table = NULL;
+}
+
+
+ElfW(Addr)
+_dl_lookup_address (const void *address)
+{
+  ElfW(Addr) addr = (ElfW(Addr)) address;
+  struct fdesc_table *t;
+  unsigned long int i;
+
+  for (t = local.root; t != NULL; t = t->next)
+    {
+      i = (struct fdesc *) addr - &t->fdesc[0];
+      if (i < t->first_unused && addr == (ElfW(Addr)) &t->fdesc[i])
+	{
+	  addr = t->fdesc[i].ip;
+	  break;
+	}
+    }
+
+  return addr;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-fptr.h libc-20030708/sysdeps/generic/dl-fptr.h
--- glibc-2.3.2/sysdeps/generic/dl-fptr.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-fptr.h	2003-05-02 11:37:21.000000000 +0900
@@ -0,0 +1,44 @@
+/* Function descriptors. Generic version.
+   Copyright (C) 1995, 1996, 1997, 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef dl_fptr_h
+#define dl_fptr_h 1
+
+/* An FDESC is a function descriptor.  */
+
+struct fdesc
+  {
+    ElfW(Addr) ip;	/* code entry point */
+    ElfW(Addr) gp;	/* global pointer */
+  };
+
+struct fdesc_table
+  {
+    struct fdesc_table *next;
+    unsigned int len;			/* # of entries in fdesc table */
+    volatile unsigned int first_unused;	/* index of first available entry */
+    struct fdesc fdesc[0];
+  };
+
+extern ElfW(Addr) _dl_boot_fptr_table [];
+
+extern ElfW(Addr) _dl_make_fptr (struct link_map *, const ElfW(Sym) *,
+				 ElfW(Addr));
+
+#endif /* !dl_fptr_h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-hash.h libc-20030708/sysdeps/generic/dl-hash.h
--- glibc-2.3.2/sysdeps/generic/dl-hash.h	2001-07-08 04:21:20.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-hash.h	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Compute hash value for given string according to ELF standard.
-   Copyright (C) 1995, 1996, 1997, 1998 Free Software Foundation, Inc.
+   Copyright (C) 1995, 1996, 1997, 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -24,7 +24,7 @@
 /* This is the hashing function specified by the ELF ABI.  In the
    first five operations no overflow is possible so we optimized it a
    bit.  */
-static inline unsigned int
+static unsigned int
 _dl_elf_hash (const unsigned char *name)
 {
   unsigned long int hash = 0;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-symaddr.c libc-20030708/sysdeps/generic/dl-symaddr.c
--- glibc-2.3.2/sysdeps/generic/dl-symaddr.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-symaddr.c	2003-05-02 12:28:25.000000000 +0900
@@ -0,0 +1,33 @@
+/* Get the symbol address.  Generic version.
+   Copyright (C) 1999, 2000, 2001, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <ldsodefs.h>
+#include <dl-fptr.h>
+
+void *
+_dl_symbol_address (struct link_map *map, const ElfW(Sym) *ref)
+{
+  ElfW(Addr) value = (map ? map->l_addr : 0) + ref->st_value;
+
+  /* Return the pointer to function descriptor. */
+  if (ELFW(ST_TYPE) (ref->st_info) == STT_FUNC)
+    return (void *) _dl_make_fptr (map, ref, value);
+  else
+    return (void *) value;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-sysdep.c libc-20030708/sysdeps/generic/dl-sysdep.c
--- glibc-2.3.2/sysdeps/generic/dl-sysdep.c	2003-02-23 14:04:15.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-sysdep.c	2003-07-08 22:58:10.000000000 +0900
@@ -79,14 +79,23 @@
   ElfW(Word) phnum = 0;
   ElfW(Addr) user_entry;
   ElfW(auxv_t) *av;
+#ifdef HAVE_AUX_SECURE
+# define set_seen(tag) (tag)	/* Evaluate for the side effects.  */
+# define set_seen_secure() ((void) 0)
+#else
   uid_t uid = 0;
   gid_t gid = 0;
-#ifdef HAVE_AUX_XID
-# define set_seen(tag) (tag) /* Evaluate for the side effects.  */
-#else
   unsigned int seen = 0;
-# define M(type) (1 << (type))
-# define set_seen(tag) seen |= M ((tag)->a_type)
+# define set_seen_secure() (seen = -1)
+# ifdef HAVE_AUX_XID
+#  define set_seen(tag) (tag)	/* Evaluate for the side effects.  */
+# else
+#  define M(type) (1 << (type))
+#  define set_seen(tag) seen |= M ((tag)->a_type)
+# endif
+#endif
+#if defined NEED_DL_SYSINFO && !defined __ASSUME_VSYSCALL
+  ElfW(Word) new_sysinfo = 0;
 #endif
 
   DL_FIND_ARG_COMPONENTS (start_argptr, _dl_argc, INTUSE(_dl_argv), _environ,
@@ -115,6 +124,7 @@
 	_dl_base_addr = av->a_un.a_val;
 	break;
 #endif
+#ifndef HAVE_AUX_SECURE
       case AT_UID:
       case AT_EUID:
 	uid ^= av->a_un.a_val;
@@ -123,6 +133,13 @@
       case AT_EGID:
 	gid ^= av->a_un.a_val;
 	break;
+#endif
+      case AT_SECURE:
+#ifndef HAVE_AUX_SECURE
+	seen = -1;
+#endif
+	INTUSE(__libc_enable_secure) = av->a_un.a_val;
+	break;
       case AT_PLATFORM:
 	GL(dl_platform) = av->a_un.a_ptr;
 	break;
@@ -137,8 +154,18 @@
 	break;
 #ifdef NEED_DL_SYSINFO
       case AT_SYSINFO:
+# ifndef __ASSUME_VSYSCALL
+	new_sysinfo = av->a_un.a_val;
+# else
 	GL(dl_sysinfo) = av->a_un.a_val;
+# endif
 	break;
+      case AT_SYSINFO_EHDR:
+	GL(dl_sysinfo_dso) = av->a_un.a_ptr;
+	break;
+#endif
+#ifdef DL_PLATFORM_AUXV
+      DL_PLATFORM_AUXV
 #endif
       }
 
@@ -146,26 +173,37 @@
   DL_SYSDEP_OSCHECK (dl_fatal);
 #endif
 
-  /* Fill in the values we have not gotten from the kernel through the
-     auxiliary vector.  */
-#ifndef HAVE_AUX_XID
-# define SEE(UID, var, uid) \
+#ifndef HAVE_AUX_SECURE
+  if (seen != -1)
+    {
+      /* Fill in the values we have not gotten from the kernel through the
+	 auxiliary vector.  */
+# ifndef HAVE_AUX_XID
+#  define SEE(UID, var, uid) \
    if ((seen & M (AT_##UID)) == 0) var ^= __get##uid ()
-  SEE (UID, uid, uid);
-  SEE (EUID, uid, euid);
-  SEE (GID, gid, gid);
-  SEE (EGID, gid, egid);
+      SEE (UID, uid, uid);
+      SEE (EUID, uid, euid);
+      SEE (GID, gid, gid);
+      SEE (EGID, gid, egid);
+# endif
+
+      /* If one of the two pairs of IDs does not match this is a setuid
+	 or setgid run.  */
+      INTUSE(__libc_enable_secure) = uid | gid;
+    }
 #endif
 
-  /* If one of the two pairs of IDs does not mattch this is a setuid
-     or setgid run.  */
-  INTUSE(__libc_enable_secure) = uid | gid;
-
 #ifndef HAVE_AUX_PAGESIZE
   if (GL(dl_pagesize) == 0)
     GL(dl_pagesize) = __getpagesize ();
 #endif
 
+#if defined NEED_DL_SYSINFO && !defined __ASSUME_VSYSCALL
+  /* Only set the sysinfo value if we also have the vsyscall DSO.  */
+  if (GL(dl_sysinfo_dso) != 0)
+    GL(dl_sysinfo) = new_sysinfo;
+#endif
+
 #ifdef DL_SYSDEP_INIT
   DL_SYSDEP_INIT;
 #endif
@@ -213,60 +251,81 @@
   buf[63] = '\0';
 
   /* The following code assumes that the AT_* values are encoded
-  starting from 0 with AT_NULL, 1 for AT_IGNORE, and all other values
-  close by (otherwise the array will be too large).  In case we have
-  to support a platform where these requirements are not fulfilled
-  some alternative implementation has to be used.  */
+     starting from 0 with AT_NULL, 1 for AT_IGNORE, and all other values
+     close by (otherwise the array will be too large).  In case we have
+     to support a platform where these requirements are not fulfilled
+     some alternative implementation has to be used.  */
   for (av = _dl_auxv; av->a_type != AT_NULL; ++av)
     {
       static const struct
       {
 	const char label[20];
-	enum { dec, hex, str } form;
+	enum { unused, dec, hex, str } form;
       } auxvars[] =
 	{
-	  [AT_EXECFD - 2] =		{ "AT_EXECFD:      ", dec },
-	  [AT_PHDR - 2] =		{ "AT_PHDR:        0x", hex },
-	  [AT_PHENT - 2] =		{ "AT_PHENT:       ", dec },
-	  [AT_PHNUM - 2] =		{ "AT_PHNUM:       ", dec },
-	  [AT_PAGESZ - 2] =		{ "AT_PAGESZ:      ", dec },
-	  [AT_BASE - 2] =		{ "AT_BASE:        0x", hex },
-	  [AT_FLAGS - 2] =		{ "AT_FLAGS:       0x", hex },
-	  [AT_ENTRY - 2] =		{ "AT_ENTRY:       0x", hex },
-	  [AT_NOTELF - 2] =		{ "AT_NOTELF:      ", hex },
-	  [AT_UID - 2] =		{ "AT_UID:         ", dec },
-	  [AT_EUID - 2] =		{ "AT_EUID:        ", dec },
-	  [AT_GID - 2] =		{ "AT_GID:         ", dec },
-	  [AT_EGID - 2] =		{ "AT_EGID:        ", dec },
-	  [AT_PLATFORM - 2] =		{ "AT_PLATFORM:    ", str },
-	  [AT_HWCAP - 2] =		{ "AT_HWCAP:       ", hex },
-	  [AT_CLKTCK - 2] =		{ "AT_CLKTCK:      ", dec },
-	  [AT_FPUCW - 2] =		{ "AT_FPUCW:       ", hex },
-	  [AT_DCACHEBSIZE - 2] =	{ "AT_DCACHEBSIZE: 0x", hex },
-	  [AT_ICACHEBSIZE - 2] =	{ "AT_ICACHEBSIZE: 0x", hex },
-	  [AT_UCACHEBSIZE - 2] =	{ "AT_UCACHEBSIZE: 0x", hex },
-	  [AT_SYSINFO - 2] =		{ "AT_SYSINFO:     0x", hex }
+	  [AT_EXECFD - 2] =		{ "AT_EXECFD:       ", dec },
+	  [AT_PHDR - 2] =		{ "AT_PHDR:         0x", hex },
+	  [AT_PHENT - 2] =		{ "AT_PHENT:        ", dec },
+	  [AT_PHNUM - 2] =		{ "AT_PHNUM:        ", dec },
+	  [AT_PAGESZ - 2] =		{ "AT_PAGESZ:       ", dec },
+	  [AT_BASE - 2] =		{ "AT_BASE:         0x", hex },
+	  [AT_FLAGS - 2] =		{ "AT_FLAGS:        0x", hex },
+	  [AT_ENTRY - 2] =		{ "AT_ENTRY:        0x", hex },
+	  [AT_NOTELF - 2] =		{ "AT_NOTELF:       ", hex },
+	  [AT_UID - 2] =		{ "AT_UID:          ", dec },
+	  [AT_EUID - 2] =		{ "AT_EUID:         ", dec },
+	  [AT_GID - 2] =		{ "AT_GID:          ", dec },
+	  [AT_EGID - 2] =		{ "AT_EGID:         ", dec },
+	  [AT_PLATFORM - 2] =		{ "AT_PLATFORM:     ", str },
+	  [AT_HWCAP - 2] =		{ "AT_HWCAP:        ", hex },
+	  [AT_CLKTCK - 2] =		{ "AT_CLKTCK:       ", dec },
+	  [AT_FPUCW - 2] =		{ "AT_FPUCW:        ", hex },
+	  [AT_DCACHEBSIZE - 2] =	{ "AT_DCACHEBSIZE:  0x", hex },
+	  [AT_ICACHEBSIZE - 2] =	{ "AT_ICACHEBSIZE:  0x", hex },
+	  [AT_UCACHEBSIZE - 2] =	{ "AT_UCACHEBSIZE:  0x", hex },
+#ifdef NEED_DL_SYSINFO
+	  [AT_SYSINFO - 2] =		{ "AT_SYSINFO:      0x", hex },
+	  [AT_SYSINFO_EHDR - 2] =	{ "AT_SYSINFO_EHDR: 0x", hex },
+#endif
+	  [AT_SECURE - 2] =		{ "AT_SECURE:       ", dec },
 	};
       unsigned int idx = (unsigned int) (av->a_type - 2);
 
       assert (AT_NULL == 0);
       assert (AT_IGNORE == 1);
-      if (idx < sizeof (auxvars) / sizeof (auxvars[0]))
+
+      if (av->a_type == AT_HWCAP)
 	{
-	  if (av->a_type != AT_HWCAP || _dl_procinfo (av->a_un.a_val) < 0)
-	    {
-	      const char *val = av->a_un.a_ptr;
-
-	      if (__builtin_expect (auxvars[idx].form, dec) == dec)
-		val = _itoa ((unsigned long int) av->a_un.a_val,
-			     buf + sizeof buf - 1, 10, 0);
-	      else if (__builtin_expect (auxvars[idx].form, hex) == hex)
-		val = _itoa ((unsigned long int) av->a_un.a_val,
-			     buf + sizeof buf - 1, 16, 0);
+	  /* This is handled special.  */
+	  if (_dl_procinfo (av->a_un.a_val) == 0)
+	    continue;
+	}
 
-	      _dl_printf ("%s%s\n", auxvars[idx].label, val);
-	    }
+      if (idx < sizeof (auxvars) / sizeof (auxvars[0])
+	  && auxvars[idx].form != unused)
+	{
+	  const char *val = av->a_un.a_ptr;
+
+	  if (__builtin_expect (auxvars[idx].form, dec) == dec)
+	    val = _itoa ((unsigned long int) av->a_un.a_val,
+			 buf + sizeof buf - 1, 10, 0);
+	  else if (__builtin_expect (auxvars[idx].form, hex) == hex)
+	    val = _itoa ((unsigned long int) av->a_un.a_val,
+			 buf + sizeof buf - 1, 16, 0);
+
+	  _dl_printf ("%s%s\n", auxvars[idx].label, val);
+
+	  continue;
 	}
+
+      /* Unknown value: print a generic line.  */
+      char buf2[17];
+      buf[sizeof (buf2) - 1] = '\0';
+      const char *val2 = _itoa ((unsigned long int) av->a_un.a_val,
+				buf2 + sizeof buf2 - 1, 16, 0);
+      const char *val =  _itoa ((unsigned long int) av->a_type,
+				buf + sizeof buf - 1, 16, 0);
+      _dl_printf ("AT_??? (0x%s): 0x%s\n", val, val2);
     }
 }
 
@@ -338,7 +397,7 @@
 
   /* Determine the total size of all strings together.  */
   if (cnt == 1)
-    total = temp[0].len;
+    total = temp[0].len + 1;
   else
     {
       total = (1UL << (cnt - 2)) * (temp[0].len + temp[cnt - 1].len + 2);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-sysdep.h libc-20030708/sysdeps/generic/dl-sysdep.h
--- glibc-2.3.2/sysdeps/generic/dl-sysdep.h	2002-12-20 03:36:08.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-sysdep.h	2003-03-04 16:56:25.000000000 +0900
@@ -1,5 +1,5 @@
 /* System-specific settings for dynamic linker code.  Generic version.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,6 +17,9 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#ifndef _DL_SYSDEP_H
+#define _DL_SYSDEP_H   1
+
 /* This macro must be defined to either 0 or 1.
 
    If 1, then an errno global variable hidden in ld.so will work right with
@@ -30,3 +33,5 @@
 #else
 # define RTLD_PRIVATE_ERRNO 0
 #endif
+
+#endif /* dl-sysdep.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/dl-tls.c libc-20030708/sysdeps/generic/dl-tls.c
--- glibc-2.3.2/sysdeps/generic/dl-tls.c	2003-01-31 05:58:27.000000000 +0900
+++ libc-20030708/sysdeps/generic/dl-tls.c	2003-04-28 23:53:23.000000000 +0900
@@ -294,7 +294,7 @@
 
   /* Allocate a correctly aligned chunk of memory.  */
   result = __libc_memalign (GL(dl_tls_static_align), size);
-  if (__builtin_expect (result != NULL, 0))
+  if (__builtin_expect (result != NULL, 1))
     {
       /* Allocate the DTV.  */
       void *allocated = result;
@@ -359,7 +359,7 @@
 	    /* Unused entry.  */
 	    continue;
 
-	  if (map->l_tls_offset == 0)
+	  if (map->l_tls_offset == NO_TLS_OFFSET)
 	    {
 	      /* For dynamically loaded modules we simply store
 		 the value indicating deferred allocation.  */
@@ -370,7 +370,7 @@
 	  assert (map->l_tls_modid == cnt);
 	  assert (map->l_tls_blocksize >= map->l_tls_initimage_size);
 # if TLS_TCB_AT_TP
-	  assert (map->l_tls_offset >= map->l_tls_blocksize);
+	  assert ((size_t) map->l_tls_offset >= map->l_tls_blocksize);
 	  dest = (char *) result - map->l_tls_offset;
 # elif TLS_DTV_AT_TP
 	  dest = (char *) result + map->l_tls_offset;
@@ -415,7 +415,10 @@
   dtv_t *dtv = GET_DTV (tcb);
 
   /* The array starts with dtv[-1].  */
-  free (dtv - 1);
+#ifdef SHARED
+  if (dtv != GL(dl_initial_dtv))
+#endif
+    free (dtv - 1);
 
   if (dealloc_tcb)
     {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/elf/backtracesyms.c libc-20030708/sysdeps/generic/elf/backtracesyms.c
--- glibc-2.3.2/sysdeps/generic/elf/backtracesyms.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/elf/backtracesyms.c	2003-03-10 18:12:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* Return list with names for address in backtrace.
-   Copyright (C) 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1998,1999,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -48,7 +48,7 @@
   /* Fill in the information we can get from `dladdr'.  */
   for (cnt = 0; cnt < size; ++cnt)
     {
-      status[cnt] = _dl_addr (array[cnt], &info[cnt]);
+      status[cnt] = _dl_addr (array[cnt], &info[cnt], NULL, NULL);
       if (status[cnt] && info[cnt].dli_fname && info[cnt].dli_fname[0] != '\0')
 	/* We have some info, compute the length of the string which will be
 	   "<file-name>(<sym-name>) [+offset].  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/elf/backtracesymsfd.c libc-20030708/sysdeps/generic/elf/backtracesymsfd.c
--- glibc-2.3.2/sysdeps/generic/elf/backtracesymsfd.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/elf/backtracesymsfd.c	2003-03-10 18:12:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* Write formatted list with names for addresses in backtrace to a file.
-   Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -48,7 +48,7 @@
       Dl_info info;
       size_t last = 0;
 
-      if (_dl_addr (array[cnt], &info)
+      if (_dl_addr (array[cnt], &info, NULL, NULL)
 	  && info.dli_fname && info.dli_fname[0] != '\0')
 	{
 	  /* Name of the file.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/enbl-secure.c libc-20030708/sysdeps/generic/enbl-secure.c
--- glibc-2.3.2/sysdeps/generic/enbl-secure.c	2001-07-08 04:21:20.000000000 +0900
+++ libc-20030708/sysdeps/generic/enbl-secure.c	2003-05-10 13:38:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define and initialize the `__libc_enable_secure' flag.  Generic version.
-   Copyright (C) 1996, 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -23,12 +23,15 @@
 #include <unistd.h>
 #include <libc-internal.h>
 
+/* If nonzero __libc_enable_secure is already set.  */
+int __libc_enable_secure_decided;
 /* Safest assumption, if somehow the initializer isn't run.  */
 int __libc_enable_secure = 1;
 
 void
 __libc_init_secure (void)
 {
-  __libc_enable_secure = (__geteuid () != __getuid ()
-			  || __getegid () != __getgid ());
+  if (__libc_enable_secure_decided == 0)
+    __libc_enable_secure = (__geteuid () != __getuid ()
+			    || __getegid () != __getgid ());
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/glob.c libc-20030708/sysdeps/generic/glob.c
--- glibc-2.3.2/sysdeps/generic/glob.c	2003-01-17 09:21:12.000000000 +0900
+++ libc-20030708/sysdeps/generic/glob.c	2003-06-12 08:54:04.000000000 +0900
@@ -1388,7 +1388,9 @@
 		  /* If we shall match only directories use the information
 		     provided by the dirent call if possible.  */
 		  if ((flags & GLOB_ONLYDIR)
-		      && d->d_type != DT_UNKNOWN && d->d_type != DT_DIR)
+		      && d->d_type != DT_UNKNOWN
+		      && d->d_type != DT_DIR
+		      && d->d_type != DT_LNK)
 		    continue;
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/ifaddrs.c libc-20030708/sysdeps/generic/ifaddrs.c
--- glibc-2.3.2/sysdeps/generic/ifaddrs.c	2002-07-25 07:56:04.000000000 +0900
+++ libc-20030708/sysdeps/generic/ifaddrs.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* getifaddrs -- get names and addresses of all network interfaces
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -30,6 +30,7 @@
   __set_errno (ENOSYS);
   return -1;
 }
+libc_hidden_def (getifaddrs)
 stub_warning (getifaddrs)
 
 void
@@ -41,4 +42,5 @@
   /* Can't be called properly if getifaddrs never succeeded.  */
   abort ();
 }
+libc_hidden_def (freeifaddrs)
 stub_warning (freeifaddrs)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/ifreq.c libc-20030708/sysdeps/generic/ifreq.c
--- glibc-2.3.2/sysdeps/generic/ifreq.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/ifreq.c	2003-06-12 07:21:54.000000000 +0900
@@ -0,0 +1,80 @@
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Andreas Jaeger <aj@suse.de>.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include "ifreq.h"
+
+
+void
+__ifreq (struct ifreq **ifreqs, int *num_ifs, int sockfd)
+{
+  int fd = sockfd;
+  struct ifconf ifc;
+  int rq_len;
+  int nifs;
+# define RQ_IFS	4
+
+  if (fd < 0)
+    fd = __opensock ();
+  if (fd < 0)
+    {
+      *num_ifs = 0;
+      *ifreqs = NULL;
+      return;
+    }
+
+  ifc.ifc_buf = NULL;
+  rq_len = RQ_IFS * sizeof (struct ifreq) / 2; /* Doubled in the loop.  */
+  do
+    {
+      ifc.ifc_len = rq_len *= 2;
+      ifc.ifc_buf = realloc (ifc.ifc_buf, ifc.ifc_len);
+      if (ifc.ifc_buf == NULL || __ioctl (fd, SIOCGIFCONF, &ifc) < 0)
+	{
+	  if (ifc.ifc_buf)
+	    free (ifc.ifc_buf);
+
+	  if (fd != sockfd)
+	    __close (fd);
+	  *num_ifs = 0;
+	  *ifreqs = NULL;
+	  return;
+	}
+    }
+  while (rq_len < sizeof (struct ifreq) + ifc.ifc_len);
+
+  if (fd != sockfd)
+    __close (fd);
+
+#ifdef _HAVE_SA_LEN
+  struct ifreq *ifr = ifreqs;
+  nifs = 0;
+  while ((char *) ifr < ifc.ifc_buf + ifc.ifc_len)
+    {
+      ++nifs;
+      ifr = __if_nextreq (ifr);
+      if (ifr == NULL)
+	break;
+    }
+#else
+  nifs = ifc.ifc_len / sizeof (struct ifreq);
+#endif
+
+  *num_ifs = nifs;
+  *ifreqs = realloc (ifc.ifc_buf, nifs * sizeof (struct ifreq));
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/ifreq.h libc-20030708/sysdeps/generic/ifreq.h
--- glibc-2.3.2/sysdeps/generic/ifreq.h	2002-12-03 07:36:28.000000000 +0900
+++ libc-20030708/sysdeps/generic/ifreq.h	2003-07-08 22:58:10.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>.
 
@@ -28,70 +28,13 @@
 __if_nextreq (struct ifreq *ifr)
 {
 #ifdef _HAVE_SA_LEN
-  if (ifr->ifa_addr > sizeof ifr->ifa_addr)
-    return (struct ifreq *) ((char *) &ifr->ifa_addr + ifr->ifa_addr.sa_len);
+  if (ifr->ifr_addr.sa_len > sizeof ifr->ifr_addr)
+    return (struct ifreq *) ((char *) &ifr->ifr_addr + ifr->ifr_addr.sa_len);
 #endif
   return ifr + 1;
 }
 
-static inline void
-__ifreq (struct ifreq **ifreqs, int *num_ifs, int sockfd)
-{
-  int fd = sockfd;
-  struct ifconf ifc;
-  int rq_len;
-  int nifs;
-# define RQ_IFS	4
-
-  if (fd < 0)
-    fd = __opensock ();
-  if (fd < 0)
-    {
-      *num_ifs = 0;
-      *ifreqs = NULL;
-      return;
-    }
-
-  ifc.ifc_buf = NULL;
-  rq_len = RQ_IFS * sizeof (struct ifreq) / 2; /* Doubled in the loop.  */
-  do
-    {
-      ifc.ifc_len = rq_len *= 2;
-      ifc.ifc_buf = realloc (ifc.ifc_buf, ifc.ifc_len);
-      if (ifc.ifc_buf == NULL || __ioctl (fd, SIOCGIFCONF, &ifc) < 0)
-	{
-	  if (ifc.ifc_buf)
-	    free (ifc.ifc_buf);
-
-	  if (fd != sockfd)
-	    __close (fd);
-	  *num_ifs = 0;
-	  *ifreqs = NULL;
-	  return;
-	}
-    }
-  while (rq_len < sizeof (struct ifreq) + ifc.ifc_len);
-
-  if (fd != sockfd)
-    __close (fd);
-
-#ifdef _HAVE_SA_LEN
-  struct ifreq *ifr = ifreqs;
-  nifs = 0;
-  while ((char *) ifr < ifc.ifc_buf + ifc.ifc_len)
-    {
-      ++nifs;
-      ifr = __if_nextreq (ifr);
-      if (ifr == NULL)
-	break;
-    }
-#else
-  nifs = ifc.ifc_len / sizeof (struct ifreq);
-#endif
-
-  *num_ifs = nifs;
-  *ifreqs = realloc (ifc.ifc_buf, nifs * sizeof (struct ifreq));
-}
+extern void __ifreq (struct ifreq **ifreqs, int *num_ifs, int sockfd);
 
 
 static inline void
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/ldconfig.h libc-20030708/sysdeps/generic/ldconfig.h
--- glibc-2.3.2/sysdeps/generic/ldconfig.h	2002-09-15 11:18:58.000000000 +0900
+++ libc-20030708/sysdeps/generic/ldconfig.h	2003-03-14 14:32:49.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 1999.
 
@@ -32,6 +32,8 @@
 #define FLAG_X8664_LIB64	0x0300
 #define FLAG_S390_LIB64		0x0400
 #define FLAG_POWERPC_LIB64	0x0500
+#define FLAG_MIPS64_LIBN32	0x0600
+#define FLAG_MIPS64_LIBN64	0x0700
 
 /* Declared in cache.c.  */
 extern void print_cache (const char *cache_name);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/ldsodefs.h libc-20030708/sysdeps/generic/ldsodefs.h
--- glibc-2.3.2/sysdeps/generic/ldsodefs.h	2003-01-04 05:42:47.000000000 +0900
+++ libc-20030708/sysdeps/generic/ldsodefs.h	2003-06-12 08:54:04.000000000 +0900
@@ -97,9 +97,16 @@
 /* Reloc type classes as returned by elf_machine_type_class().
    ELF_RTYPE_CLASS_PLT means this reloc should not be satisfied by
    some PLT symbol, ELF_RTYPE_CLASS_COPY means this reloc should not be
-   satisfied by any symbol in the executable.  */
+   satisfied by any symbol in the executable.  Some architectures do
+   not support copy relocations.  In this case we define the macro to
+   zero so that the code for handling them gets automatically optimized
+   out.  */
 #define ELF_RTYPE_CLASS_PLT 1
-#define ELF_RTYPE_CLASS_COPY 2
+#ifndef DL_NO_COPY_RELOCS
+# define ELF_RTYPE_CLASS_COPY 2
+#else
+# define ELF_RTYPE_CLASS_COPY 0
+#endif
 
 /* ELF uses the PF_x macros to specify the segment permissions, mmap
    uses PROT_xxx.  In most cases the three macros have the values 1, 2,
@@ -166,7 +173,7 @@
 
 /* Test whether given NAME matches any of the names of the given object.  */
 static __inline int
-__attribute__ ((unused))
+__attribute__ ((unused, always_inline))
 _dl_name_match_p (const char *__name, struct link_map *__map)
 {
   int __found = strcmp (__name, __map->l_name) == 0;
@@ -387,6 +394,10 @@
 #ifdef NEED_DL_SYSINFO
   /* Syscall handling improvements.  This is very specific to x86.  */
   EXTERN uintptr_t _dl_sysinfo;
+
+  /* The vsyscall page is a virtual DSO pre-mapped by the kernel.
+     This points to its ELF header.  */
+  EXTERN const ElfW(Ehdr) *_dl_sysinfo_dso;
 #endif
 
 #ifdef SHARED
@@ -554,6 +565,16 @@
      internal_function attribute_hidden;
 
 
+/* Collect the directories in the search path for LOADER's dependencies.
+   The data structure is defined in <dlfcn.h>.  If COUNTING is true,
+   SI->dls_cnt and SI->dls_size are set; if false, those must be as set
+   by a previous call with COUNTING set, and SI must point to SI->dls_size
+   bytes to be used in filling in the result.  */
+extern void _dl_rtld_di_serinfo (struct link_map *loader,
+				 Dl_serinfo *si, bool counting)
+     internal_function;
+
+
 /* Search loaded objects' symbol tables for a definition of the symbol
    referred to by UNDEF.  *SYM is the symbol table entry containing the
    reference; it is replaced with the defining symbol, and the base load
@@ -775,6 +796,9 @@
 extern void _dl_get_tls_static_info (size_t *sizep, size_t *alignp)
      internal_function;
 
+extern void _dl_allocate_static_tls (struct link_map *map)
+     internal_function attribute_hidden;
+
 /* These are internal entry points to the two halves of _dl_allocate_tls,
    only used within rtld.c itself at startup time.  */
 extern void *_dl_allocate_tls_storage (void)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/libc-start.c libc-20030708/sysdeps/generic/libc-start.c
--- glibc-2.3.2/sysdeps/generic/libc-start.c	2003-02-15 07:59:15.000000000 +0900
+++ libc-20030708/sysdeps/generic/libc-start.c	2003-05-10 13:38:05.000000000 +0900
@@ -44,22 +44,52 @@
 #endif
 
 
-extern int BP_SYM (__libc_start_main) (int (*main) (int, char **, char **),
-				       int argc,
-				       char *__unbounded *__unbounded ubp_av,
-				       void (*init) (void),
-				       void (*fini) (void),
-				       void (*rtld_fini) (void),
-				       void *__unbounded stack_end)
+#ifdef LIBC_START_MAIN
+# define STATIC static inline
+#else
+# define STATIC
+# define LIBC_START_MAIN BP_SYM (__libc_start_main)
+#endif
+
+#ifdef MAIN_AUXVEC_ARG
+/* main gets passed a pointer to the auxiliary.  */
+# define MAIN_AUXVEC_DECL	, void *
+# define MAIN_AUXVEC_PARAM	, auxvec
+#else
+# define MAIN_AUXVEC_DECL
+# define MAIN_AUXVEC_PARAM
+#endif
+
+STATIC int LIBC_START_MAIN (int (*main) (int, char **, char **
+					 MAIN_AUXVEC_DECL),
+			    int argc,
+			    char *__unbounded *__unbounded ubp_av,
+#ifdef LIBC_START_MAIN_AUXVEC_ARG
+			    ElfW(auxv_t) *__unbounded auxvec,
+#endif
+#ifdef INIT_MAIN_ARGS
+			    __typeof (main) init,
+#else
+			    void (*init) (void),
+#endif
+			    void (*fini) (void),
+			    void (*rtld_fini) (void),
+			    void *__unbounded stack_end)
      __attribute__ ((noreturn));
 
-int
-/* GKM FIXME: GCC: this should get __BP_ prefix by virtue of the
-   BPs in the arglist of startup_info.main and startup_info.init. */
-BP_SYM (__libc_start_main) (int (*main) (int, char **, char **),
-		   int argc, char *__unbounded *__unbounded ubp_av,
-		   void (*init) (void), void (*fini) (void),
-		   void (*rtld_fini) (void), void *__unbounded stack_end)
+STATIC int
+LIBC_START_MAIN (int (*main) (int, char **, char ** MAIN_AUXVEC_DECL),
+		 int argc, char *__unbounded *__unbounded ubp_av,
+#ifdef LIBC_START_MAIN_AUXVEC_ARG
+		 ElfW(auxv_t) *__unbounded auxvec,
+#endif
+#ifdef INIT_MAIN_ARGS
+		 __typeof (main) init,
+#else
+		 void (*init) (void),
+#endif
+		 void (*fini) (void),
+		 void (*rtld_fini) (void), void *__unbounded stack_end)
 {
   char *__unbounded *__unbounded ubp_ev = &ubp_av[argc + 1];
 #if __BOUNDED_POINTERS__
@@ -80,13 +110,18 @@
 
 #ifndef SHARED
 # ifdef HAVE_AUX_VECTOR
-  void *__unbounded *__unbounded auxvec;
   /* First process the auxiliary vector since we need to find the
      program header to locate an eventually present PT_TLS entry.  */
-  for (auxvec = (void *__unbounded *__unbounded) ubp_ev;
-       *auxvec != NULL; ++auxvec);
-  ++auxvec;
-  _dl_aux_init ((ElfW(auxv_t) *) auxvec);
+#  ifndef LIBC_START_MAIN_AUXVEC_ARG
+  ElfW(auxv_t) *__unbounded auxvec;
+  {
+    char *__unbounded *__unbounded evp = ubp_ev;
+    while (*evp++ != NULL)
+      ;
+    auxvec = (ElfW(auxv_t) *__unbounded) evp;
+  }
+#  endif
+  _dl_aux_init (auxvec);
 # endif
 # ifdef DL_SYSDEP_OSCHECK
   if (!__libc_multiple_libcs)
@@ -106,13 +141,6 @@
   if (__pthread_initialize_minimal)
 # endif
     __pthread_initialize_minimal ();
-
-  /* Some security at this point.  Prevent starting a SUID binary where
-     the standard file descriptors are not opened.  We have to do this
-     only for statically linked applications since otherwise the dynamic
-     loader did the work already.  */
-  if (__builtin_expect (__libc_enable_secure, 0))
-    __libc_check_standard_fds ();
 #endif
 
   /* Register the destructor of the dynamic linker if there is any.  */
@@ -130,47 +158,71 @@
   if (fini)
     __cxa_atexit ((void (*) (void *)) fini, NULL, NULL);
 
+#ifndef SHARED
+  /* Some security at this point.  Prevent starting a SUID binary where
+     the standard file descriptors are not opened.  We have to do this
+     only for statically linked applications since otherwise the dynamic
+     loader did the work already.  */
+  if (__builtin_expect (__libc_enable_secure, 0))
+    __libc_check_standard_fds ();
+#endif
+
   /* Call the initializer of the program, if any.  */
 #ifdef SHARED
   if (__builtin_expect (GL(dl_debug_mask) & DL_DEBUG_IMPCALLS, 0))
     _dl_debug_printf ("\ninitialize program: %s\n\n", argv[0]);
 #endif
   if (init)
-    (*init) ();
+    (*init) (
+#ifdef INIT_MAIN_ARGS
+	     argc, argv, __environ MAIN_AUXVEC_PARAM
+#endif
+	     );
 
 #ifdef SHARED
   if (__builtin_expect (GL(dl_debug_mask) & DL_DEBUG_IMPCALLS, 0))
     _dl_debug_printf ("\ntransferring control: %s\n\n", argv[0]);
 #endif
 
-#ifdef HAVE_CANCELBUF
-  if (setjmp (THREAD_SELF->cancelbuf) == 0)
-#endif
+#ifdef HAVE_CLEANUP_JMP_BUF
+  /* Memory for the cancellation buffer.  */
+  struct pthread_unwind_buf unwind_buf;
+
+  int not_first_call;
+  not_first_call = setjmp ((struct __jmp_buf_tag *) unwind_buf.cancel_jmp_buf);
+  if (__builtin_expect (! not_first_call, 1))
     {
-      /* XXX This is where the try/finally handling must be used.  */
+      struct pthread *self = THREAD_SELF;
+
+      /* Store old info.  */
+      unwind_buf.priv.data.prev = THREAD_GETMEM (self, cleanup_jmp_buf);
+      unwind_buf.priv.data.cleanup = THREAD_GETMEM (self, cleanup);
+
+      /* Store the new cleanup handler info.  */
+      THREAD_SETMEM (self, cleanup_jmp_buf, &unwind_buf);
 
-      result = main (argc, argv, __environ);
+      /* Run the program.  */
+      result = main (argc, argv, __environ MAIN_AUXVEC_PARAM);
     }
-#ifdef HAVE_CANCELBUF
   else
     {
-# ifdef HAVE_PTR_NTHREADS
       /* One less thread.  Decrement the counter.  If it is zero we
 	 terminate the entire process.  */
       result = 0;
-      int *const ptr;
-#  ifdef SHARED
-      ptr = __libc_pthread_functions.ptr_nthreads;
-#  else
+# ifdef SHARED
+      int *const ptr = __libc_pthread_functions.ptr_nthreads;
+# else
       extern int __nptl_nthreads __attribute ((weak));
-      ptr = &__nptl_nthreads;
-#  endif
+      int *const ptr = &__nptl_nthreads;
+# endif
 
       if (! atomic_decrement_and_test (ptr))
-# endif
 	/* Not much left to do but to exit the thread, not the process.  */
 	__exit_thread (0);
     }
+#else
+  /* Nothing fancy, just call the function.  */
+  result = main (argc, argv, __environ MAIN_AUXVEC_PARAM);
 #endif
 
   exit (result);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/lockf.c libc-20030708/sysdeps/generic/lockf.c
--- glibc-2.3.2/sysdeps/generic/lockf.c	2001-07-08 04:21:21.000000000 +0900
+++ libc-20030708/sysdeps/generic/lockf.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1994, 1996, 1997, 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1994,1996,1997,1998,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -67,5 +67,8 @@
       return -1;
     }
 
+  /* lockf() is a cancellation point but so is fcntl() if F_SETLKW is
+     used.  Therefore we don't have to care about cancellation here,
+     the fcntl() function will take care of it.  */
   return __fcntl (fd, cmd, &fl);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/memchr.c libc-20030708/sysdeps/generic/memchr.c
--- glibc-2.3.2/sysdeps/generic/memchr.c	2001-07-08 04:21:21.000000000 +0900
+++ libc-20030708/sysdeps/generic/memchr.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,93,96,97,99,2000 Free Software Foundation, Inc.
+/* Copyright (C) 1991,93,96,97,99,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Based on strlen implementation by Torbjorn Granlund (tege@sics.se),
    with help from Dan Sahlin (dan@sics.se) and
@@ -212,3 +212,4 @@
 #ifdef weak_alias
 weak_alias (__memchr, BP_SYM (memchr))
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/memcmp.c libc-20030708/sysdeps/generic/memcmp.c
--- glibc-2.3.2/sysdeps/generic/memcmp.c	2001-07-08 04:21:21.000000000 +0900
+++ libc-20030708/sysdeps/generic/memcmp.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1993, 1995, 1997, 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1993,1995,1997,1998,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Torbjorn Granlund (tege@sics.se).
 
@@ -131,9 +131,6 @@
 /* memcmp_common_alignment -- Compare blocks at SRCP1 and SRCP2 with LEN `op_t'
    objects (not LEN bytes!).  Both SRCP1 and SRCP2 should be aligned for
    memory operations on `op_t's.  */
-#ifdef	__GNUC__
-__inline
-#endif
 static int
 memcmp_common_alignment (srcp1, srcp2, len)
      long int srcp1;
@@ -221,9 +218,6 @@
 /* memcmp_not_common_alignment -- Compare blocks at SRCP1 and SRCP2 with LEN
    `op_t' objects (not LEN bytes!).  SRCP2 should be aligned for memory
    operations on `op_t', but SRCP1 *should be unaligned*.  */
-#ifdef	__GNUC__
-__inline
-#endif
 static int
 memcmp_not_common_alignment (srcp1, srcp2, len)
      long int srcp1;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/memcpy.c libc-20030708/sysdeps/generic/memcpy.c
--- glibc-2.3.2/sysdeps/generic/memcpy.c	2001-07-08 04:21:21.000000000 +0900
+++ libc-20030708/sysdeps/generic/memcpy.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Copy memory to memory until the specified number of bytes
    has been copied.  Overlap is NOT handled correctly.
-   Copyright (C) 1991, 1997 Free Software Foundation, Inc.
+   Copyright (C) 1991, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Torbjorn Granlund (tege@sics.se).
 
@@ -62,3 +62,4 @@
 
   return dstpp;
 }
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/memmove.c libc-20030708/sysdeps/generic/memmove.c
--- glibc-2.3.2/sysdeps/generic/memmove.c	2001-07-08 04:21:21.000000000 +0900
+++ libc-20030708/sysdeps/generic/memmove.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Copy memory to memory until the specified number of bytes
    has been copied.  Overlap is handled correctly.
-   Copyright (C) 1991, 1995, 1996, 1997 Free Software Foundation, Inc.
+   Copyright (C) 1991, 1995, 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Torbjorn Granlund (tege@sics.se).
 
@@ -107,3 +107,6 @@
 
   RETURN (dest);
 }
+#ifndef memmove
+libc_hidden_builtin_def (memmove)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/memset.c libc-20030708/sysdeps/generic/memset.c
--- glibc-2.3.2/sysdeps/generic/memset.c	2001-07-08 04:21:21.000000000 +0900
+++ libc-20030708/sysdeps/generic/memset.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -88,3 +88,4 @@
 
   return dstpp;
 }
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/not-cancel.h libc-20030708/sysdeps/generic/not-cancel.h
--- glibc-2.3.2/sysdeps/generic/not-cancel.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/not-cancel.h	2003-04-20 01:39:47.000000000 +0900
@@ -0,0 +1,31 @@
+/* Uncancelable versions of cancelable interfaces.  Generic version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/* By default we have none.  Map the name to the normal functions.  */
+#define open_not_cancel(name, flags, mode...) \
+  __libc_open (name, flags, ##mode)
+#define close_not_cancel_no_status(fd) \
+  (void) __close (fd)
+#define read_not_cancel(fd, buf, n) \
+  __read (fd, buf, n)
+#define write_not_cancel(fd, buf, n) \
+  __write (fd, buf, n)
+#define writev_not_cancel_no_status(fd, iov, n) \
+  (void) __writev (fd, iov, n)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/pselect.c libc-20030708/sysdeps/generic/pselect.c
--- glibc-2.3.2/sysdeps/generic/pselect.c	2002-12-15 16:27:46.000000000 +0900
+++ libc-20030708/sysdeps/generic/pselect.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 1998, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996,1997,1998,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -50,6 +50,9 @@
   if (sigmask != NULL)
     __sigprocmask (SIG_SETMASK, sigmask, &savemask);
 
+  /* Note the pselect() is a cancellation point.  But since we call
+     select() which itself is a cancellation point we do not have
+     to do anything here.  */
   retval = __select (nfds, readfds, writefds, exceptfds,
 		     timeout != NULL ? &tval : NULL);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/remap_file_pages.c libc-20030708/sysdeps/generic/remap_file_pages.c
--- glibc-2.3.2/sysdeps/generic/remap_file_pages.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/remap_file_pages.c	2003-03-03 18:44:55.000000000 +0900
@@ -0,0 +1,35 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/mman.h>
+#include <errno.h>
+
+/* Remap arbitrary pages of a shared backing store within an existing
+   VMA.  */
+
+int
+__remap_file_pages (void *start, size_t size, int prot, size_t pgoff,
+		    int flags)
+{
+  __set_errno (ENOSYS);
+  return -1;
+}
+
+stub_warning (remap_file_pages)
+#include <stub-tag.h>
+weak_alias (__remap_file_pages, remap_file_pages)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/sched_getaffinity.c libc-20030708/sysdeps/generic/sched_getaffinity.c
--- glibc-2.3.2/sysdeps/generic/sched_getaffinity.c	2003-02-07 04:12:53.000000000 +0900
+++ libc-20030708/sysdeps/generic/sched_getaffinity.c	2003-05-12 01:30:11.000000000 +0900
@@ -17,16 +17,15 @@
    02111-1307 USA.  */
 
 #include <errno.h>
-#include <sys/types.h>
 #include <sched.h>
+#include <sys/types.h>
 
 
 /* Retrieve the CPU affinity mask for a particular process.  */
 int
-sched_getaffinity (pid, len, mask)
+sched_getaffinity (pid, cpuset)
      pid_t pid;
-     unsigned int len;
-     unsigned long int *mask;
+     cpu_set_t *cpuset;
 {
   __set_errno (ENOSYS);
   return -1;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/sched_setaffinity.c libc-20030708/sysdeps/generic/sched_setaffinity.c
--- glibc-2.3.2/sysdeps/generic/sched_setaffinity.c	2003-02-07 04:13:06.000000000 +0900
+++ libc-20030708/sysdeps/generic/sched_setaffinity.c	2003-05-12 01:30:11.000000000 +0900
@@ -23,10 +23,9 @@
 
 /* Retrieve the CPU affinity mask for a particular process.  */
 int
-sched_setaffinity (pid, len, mask)
+sched_setaffinity (pid, cpuset)
      pid_t pid;
-     unsigned int len;
-     unsigned long int *mask;
+     const cpu_set_t *cpuset;
 {
   __set_errno (ENOSYS);
   return -1;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/semtimedop.c libc-20030708/sysdeps/generic/semtimedop.c
--- glibc-2.3.2/sysdeps/generic/semtimedop.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/semtimedop.c	2003-04-03 08:44:57.000000000 +0900
@@ -0,0 +1,37 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/sem.h>
+#include <errno.h>
+
+/* Perform user-defined atomical operation of array of semaphores.  */
+
+int
+semtimedop (semid, sops, nsops, timeout)
+     int semid;
+     struct sembuf *sops;
+     size_t nsops;
+     const struct timespec *timeout;
+{
+  __set_errno (ENOSYS);
+  return -1;
+}
+
+stub_warning (semtimedop)
+#include <stub-tag.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/sigfillset.c libc-20030708/sysdeps/generic/sigfillset.c
--- glibc-2.3.2/sysdeps/generic/sigfillset.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/sigfillset.c	2003-04-21 16:45:03.000000000 +0900
@@ -0,0 +1,43 @@
+/* Copyright (C) 1991,96,97,2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <signal.h>
+#include <string.h>
+
+/* Set all signals in SET.  */
+int
+sigfillset (set)
+     sigset_t *set;
+{
+  if (set == NULL)
+    {
+      __set_errno (EINVAL);
+      return -1;
+    }
+
+  memset (set, 0xff, sizeof (sigset_t));
+
+  /* If the implementation uses a cancellation signal don't set the bit.  */
+#ifdef SIGCANCEL
+  __sigdelset (set, SIGCANCEL);
+#endif
+
+  return 0;
+}
+libc_hidden_def (sigfillset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strcat.c libc-20030708/sysdeps/generic/strcat.c
--- glibc-2.3.2/sysdeps/generic/strcat.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strcat.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -49,3 +49,4 @@
 
   return dest;
 }
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strchr.c libc-20030708/sysdeps/generic/strchr.c
--- glibc-2.3.2/sysdeps/generic/strchr.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strchr.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,93,94,95,96,97,99,2000 Free Software Foundation, Inc.
+/* Copyright (C) 1991,93,94,95,96,97,99,2000,03 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Based on strlen implementation by Torbjorn Granlund (tege@sics.se),
    with help from Dan Sahlin (dan@sics.se) and
@@ -187,3 +187,4 @@
 #undef index
 weak_alias (strchr, index)
 #endif
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strcmp.c libc-20030708/sysdeps/generic/strcmp.c
--- glibc-2.3.2/sysdeps/generic/strcmp.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strcmp.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,3 +44,4 @@
 
   return c1 - c2;
 }
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strcpy.c libc-20030708/sysdeps/generic/strcpy.c
--- glibc-2.3.2/sysdeps/generic/strcpy.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strcpy.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1997, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -47,3 +47,4 @@
 
   return dest;
 }
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strcspn.c libc-20030708/sysdeps/generic/strcspn.c
--- glibc-2.3.2/sysdeps/generic/strcspn.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strcspn.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1994, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1994, 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -48,3 +48,4 @@
 
   return count;
 }
+libc_hidden_builtin_def (strcspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/string-inlines.c libc-20030708/sysdeps/generic/string-inlines.c
--- glibc-2.3.2/sysdeps/generic/string-inlines.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/generic/string-inlines.c	2003-04-30 07:49:00.000000000 +0900
@@ -0,0 +1,35 @@
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*  <bits/string.h> and <bits/string2.h> declare some extern inline
+    functions.  These functions are declared additionally here if
+    inlining is not possible.  */
+
+#undef __USE_STRING_INLINES
+#define __USE_STRING_INLINES
+#define _FORCE_INLINES
+#define __STRING_INLINE /* empty */
+#define __NO_INLINE__
+
+#include <string.h>
+#undef index
+#undef rindex
+
+#undef __NO_INLINE__
+#include <bits/string.h>
+#include <bits/string2.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strlen.c libc-20030708/sysdeps/generic/strlen.c
--- glibc-2.3.2/sysdeps/generic/strlen.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strlen.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1993, 1997, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1993, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Torbjorn Granlund (tege@sics.se),
    with help from Dan Sahlin (dan@sics.se);
@@ -150,3 +150,4 @@
 	}
     }
 }
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strncmp.c libc-20030708/sysdeps/generic/strncmp.c
--- glibc-2.3.2/sysdeps/generic/strncmp.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strncmp.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -70,3 +70,4 @@
 
   return c1 - c2;
 }
+libc_hidden_builtin_def (strncmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strncpy.c libc-20030708/sysdeps/generic/strncpy.c
--- glibc-2.3.2/sysdeps/generic/strncpy.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strncpy.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -84,3 +84,4 @@
 
   return s;
 }
+libc_hidden_builtin_def (strncpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strpbrk.c libc-20030708/sysdeps/generic/strpbrk.c
--- glibc-2.3.2/sysdeps/generic/strpbrk.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strpbrk.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1994, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1994, 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -43,3 +43,4 @@
 
   return NULL;
 }
+libc_hidden_builtin_def (strpbrk)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strrchr.c libc-20030708/sysdeps/generic/strrchr.c
--- glibc-2.3.2/sysdeps/generic/strrchr.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strrchr.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1995, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1995, 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -47,3 +47,4 @@
 #undef rindex
 weak_alias (strrchr, rindex)
 #endif
+libc_hidden_builtin_def (strrchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strspn.c libc-20030708/sysdeps/generic/strspn.c
--- glibc-2.3.2/sysdeps/generic/strspn.c	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/generic/strspn.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,3 +44,4 @@
 
   return count;
 }
+libc_hidden_builtin_def (strspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strstr.c libc-20030708/sysdeps/generic/strstr.c
--- glibc-2.3.2/sysdeps/generic/strstr.c	2001-12-24 18:10:05.000000000 +0900
+++ libc-20030708/sysdeps/generic/strstr.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Return the offset of one string within another.
-   Copyright (C) 1994, 1996, 1997, 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1994,1996,1997,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -120,3 +120,4 @@
 ret0:
   return 0;
 }
+libc_hidden_builtin_def (strstr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/strtol.c libc-20030708/sysdeps/generic/strtol.c
--- glibc-2.3.2/sysdeps/generic/strtol.c	2002-08-28 19:14:20.000000000 +0900
+++ libc-20030708/sysdeps/generic/strtol.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Convert string representation of a number into an integer value.
-   Copyright (C) 1991,92,94,95,96,97,98,99,2000,01,02
+   Copyright (C) 1991,92,94,95,96,97,98,99,2000,2001,2002,2003
    	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
@@ -374,7 +374,11 @@
 		    || (int) (TOUPPER (c) - L_('A') + 10) >= base))
 	      break;
 
-	  end = correctly_grouped_prefix (s, end, thousands, grouping);
+# ifdef USE_WIDE_CHAR
+	  end = __correctly_grouped_prefixwc (s, end, thousands, grouping);
+# else
+	  end = __correctly_grouped_prefixmb (s, end, thousands, grouping);
+# endif
 	}
     }
   else
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/sysdep.h libc-20030708/sysdeps/generic/sysdep.h
--- glibc-2.3.2/sysdeps/generic/sysdep.h	2003-01-10 04:43:34.000000000 +0900
+++ libc-20030708/sysdeps/generic/sysdep.h	2003-07-08 22:58:10.000000000 +0900
@@ -46,4 +46,85 @@
 #ifndef JUMPTARGET
 #define JUMPTARGET(sym)		sym
 #endif
+
+/* Makros to generate eh_frame unwind information.  */
+# ifdef HAVE_ASM_CFI_DIRECTIVES
+#  define cfi_startproc			.cfi_startproc
+#  define cfi_endproc			.cfi_endproc
+#  define cfi_def_cfa(reg, off)		.cfi_def_cfa reg, off
+#  define cfi_def_cfa_register(reg)	.cfi_def_cfa_register reg
+#  define cfi_def_cfa_offset(off)	.cfi_def_cfa_offset off
+#  define cfi_adjust_cfa_offset(off)	.cfi_adjust_cfa_offset off
+#  define cfi_offset(reg, off)		.cfi_offset reg, off
+#  define cfi_rel_offset(reg, off)	.cfi_rel_offset reg, off
+#  define cfi_register(r1, r2)		.cfi_register r1, r2
+#  define cfi_return_column(reg)	.cfi_return_column reg
+#  define cfi_restore(reg)		.cfi_restore reg
+#  define cfi_undefined(reg)		.cfi_undefined reg
+#  define cfi_remember_state		.cfi_remember_state
+#  define cfi_restore_state		.cfi_restore_state
+# else
+#  define cfi_startproc
+#  define cfi_endproc
+#  define cfi_def_cfa(reg, off)
+#  define cfi_def_cfa_register(reg)
+#  define cfi_def_cfa_offset(off)
+#  define cfi_adjust_cfa_offset(off)
+#  define cfi_offset(reg, off)
+#  define cfi_rel_offset(reg, off)
+#  define cfi_register(r1, r2)
+#  define cfi_return_column(reg)
+#  define cfi_restore(reg)
+#  define cfi_undefined(reg)
+#  define cfi_remember_state
+#  define cfi_restore_state
+# endif
+
+#else /* ! ASSEMBLER */
+# ifdef HAVE_ASM_CFI_DIRECTIVES
+#  define CFI_STRINGIFY(Name) CFI_STRINGIFY2 (Name)
+#  define CFI_STRINGIFY2(Name) #Name
+#  define CFI_STARTPROC	".cfi_startproc"
+#  define CFI_ENDPROC	".cfi_endproc"
+#  define CFI_DEF_CFA(reg, off)	\
+   ".cfi_def_cfa " CFI_STRINGIFY(reg) "," CFI_STRINGIFY(off)
+#  define CFI_DEF_CFA_REGISTER(reg) \
+   ".cfi_def_cfa_register " CFI_STRINGIFY(reg)
+#  define CFI_DEF_CFA_OFFSET(off) \
+   ".cfi_def_cfa_offset " CFI_STRINGIFY(off)
+#  define CFI_ADJUST_CFA_OFFSET(off) \
+   ".cfi_adjust_cfa_offset " CFI_STRINGIFY(off)
+#  define CFI_OFFSET(reg, off) \
+   ".cfi_offset " CFI_STRINGIFY(reg) "," CFI_STRINGIFY(off)
+#  define CFI_REL_OFFSET(reg, off) \
+   ".cfi_rel_offset " CFI_STRINGIFY(reg) "," CFI_STRINGIFY(off)
+#  define CFI_REGISTER(r1, r2) \
+   ".cfi_register " CFI_STRINGIFY(r1) "," CFI_STRINGIFY(r2)
+#  define CFI_RETURN_COLUMN(reg) \
+   ".cfi_return_column " CFI_STRINGIFY(reg)
+#  define CFI_RESTORE(reg) \
+   ".cfi_restore " CFI_STRINGIFY(reg)
+#  define CFI_UNDEFINED(reg) \
+   ".cfi_undefined " CFI_STRINGIFY(reg)
+#  define CFI_REMEMBER_STATE \
+   ".cfi_remember_state"
+#  define CFI_RESTORE_STATE \
+   ".cfi_restore_state"
+# else
+#  define CFI_STARTPROC
+#  define CFI_ENDPROC
+#  define CFI_DEF_CFA(reg, off)
+#  define CFI_DEF_CFA_REGISTER(reg)
+#  define CFI_DEF_CFA_OFFSET(off)
+#  define CFI_ADJUST_CFA_OFFSET(off)
+#  define CFI_OFFSET(reg, off)
+#  define CFI_REL_OFFSET(reg, off)
+#  define CFI_REGISTER(r1, r2)
+#  define CFI_RETURN_COLUMN(reg)
+#  define CFI_RESTORE(reg)
+#  define CFI_UNDEFINED(reg)
+#  define CFI_REMEMBER_STATE
+#  define CFI_RESTORE_STATE
+# endif
+
 #endif /* __ASSEMBLER__ */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/unwind-dw2-fde.c libc-20030708/sysdeps/generic/unwind-dw2-fde.c
--- glibc-2.3.2/sysdeps/generic/unwind-dw2-fde.c	2002-05-15 08:46:28.000000000 +0900
+++ libc-20030708/sysdeps/generic/unwind-dw2-fde.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,13 +1,14 @@
 /* Subroutines needed for unwinding stack frames for exception handling.  */
-/* Copyright (C) 1997, 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003
+   Free Software Foundation, Inc.
    Contributed by Jason Merrill <jason@cygnus.com>.
 
-This file is part of GNU CC.
+This file is part of GCC.
 
-GNU CC is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2, or (at your option)
-any later version.
+GCC is free software; you can redistribute it and/or modify it under
+the terms of the GNU General Public License as published by the Free
+Software Foundation; either version 2, or (at your option) any later
+version.
 
 In addition to the permissions in the GNU General Public License, the
 Free Software Foundation gives you unlimited permission to link the
@@ -18,15 +19,15 @@
 the file, and distribution when not linked into a combine
 executable.)
 
-GNU CC is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
+GCC is distributed in the hope that it will be useful, but WITHOUT ANY
+WARRANTY; without even the implied warranty of MERCHANTABILITY or
+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+for more details.
 
 You should have received a copy of the GNU General Public License
-along with GNU CC; see the file COPYING.  If not, write to
-the Free Software Foundation, 59 Temple Place - Suite 330,
-Boston, MA 02111-1307, USA.  */
+along with GCC; see the file COPYING.  If not, write to the Free
+Software Foundation, 59 Temple Place - Suite 330, Boston, MA
+02111-1307, USA.  */
 
 #ifdef _LIBC
 # include <shlib-compat.h>
@@ -44,6 +45,7 @@
 #include <unwind-pe.h>
 #include <unwind-dw2-fde.h>
 #else
+#ifndef _Unwind_Find_FDE
 #include "tconfig.h"
 #include "tsystem.h"
 #include "dwarf2.h"
@@ -53,6 +55,7 @@
 #include "unwind-dw2-fde.h"
 #include "gthr.h"
 #endif
+#endif
 
 /* The unseen_objects list contains objects that have been registered
    but not yet categorized in any way.  The seen_objects list has had
@@ -109,7 +112,7 @@
 			     void *tbase, void *dbase)
 {
   /* If .eh_frame is empty, don't register at all.  */
-  if (*(uword *)begin == 0)
+  if (*(uword *) begin == 0)
     return;
 
   ob->pc_begin = (void *)-1;
@@ -118,6 +121,9 @@
   ob->u.single = begin;
   ob->s.i = 0;
   ob->s.b.encoding = DW_EH_PE_omit;
+#ifdef DWARF2_OBJECT_END_PTR_EXTENSION
+  ob->fde_end = NULL;
+#endif
 
   init_object_mutex_once ();
   __gthread_mutex_lock (&object_mutex);
@@ -141,7 +147,7 @@
   struct object *ob;
 
   /* If .eh_frame is empty, don't register at all.  */
-  if (*(uword *)begin == 0)
+  if (*(uword *) begin == 0)
     return;
 
   ob = (struct object *) malloc (sizeof (struct object));
@@ -206,7 +212,7 @@
   struct object *ob = 0;
 
   /* If .eh_frame is empty, we haven't registered.  */
-  if (*(uword *)begin == 0)
+  if (*(uword *) begin == 0)
     return ob;
 
   init_object_mutex_once ();
@@ -260,7 +266,7 @@
 __deregister_frame (void *begin)
 {
   /* If .eh_frame is empty, we haven't registered.  */
-  if (*(uword *)begin != 0)
+  if (*(uword *) begin != 0)
     free (INTUSE(__deregister_frame_info_bases) (begin));
 }
 
@@ -297,18 +303,20 @@
 {
   const unsigned char *aug, *p;
   _Unwind_Ptr dummy;
+  _Unwind_Word utmp;
+  _Unwind_Sword stmp;
 
   aug = cie->augmentation;
   if (aug[0] != 'z')
     return DW_EH_PE_absptr;
 
   p = aug + strlen (aug) + 1;		/* Skip the augmentation string.  */
-  p = read_uleb128 (p, &dummy);		/* Skip code alignment.  */
-  p = read_sleb128 (p, &dummy);		/* Skip data alignment.  */
+  p = read_uleb128 (p, &utmp);		/* Skip code alignment.  */
+  p = read_sleb128 (p, &stmp);		/* Skip data alignment.  */
   p++;					/* Skip return address column.  */
 
   aug++;				/* Skip 'z' */
-  p = read_uleb128 (p, &dummy);		/* Skip augmentation length.  */
+  p = read_uleb128 (p, &utmp);		/* Skip augmentation length.  */
   while (1)
     {
       /* This is what we're looking for.  */
@@ -345,14 +353,21 @@
 
 /* Comparison routines.  Three variants of increasing complexity.  */
 
-static saddr
+static int
 fde_unencoded_compare (struct object *ob __attribute__((unused)),
 		       fde *x, fde *y)
 {
-  return *(saddr *)x->pc_begin - *(saddr *)y->pc_begin;
+  _Unwind_Ptr x_ptr = *(_Unwind_Ptr *) x->pc_begin;
+  _Unwind_Ptr y_ptr = *(_Unwind_Ptr *) y->pc_begin;
+
+  if (x_ptr > y_ptr)
+    return 1;
+  if (x_ptr < y_ptr)
+    return -1;
+  return 0;
 }
 
-static saddr
+static int
 fde_single_encoding_compare (struct object *ob, fde *x, fde *y)
 {
   _Unwind_Ptr base, x_ptr, y_ptr;
@@ -361,10 +376,14 @@
   read_encoded_value_with_base (ob->s.b.encoding, base, x->pc_begin, &x_ptr);
   read_encoded_value_with_base (ob->s.b.encoding, base, y->pc_begin, &y_ptr);
 
-  return x_ptr - y_ptr;
+  if (x_ptr > y_ptr)
+    return 1;
+  if (x_ptr < y_ptr)
+    return -1;
+  return 0;
 }
 
-static saddr
+static int
 fde_mixed_encoding_compare (struct object *ob, fde *x, fde *y)
 {
   int x_encoding, y_encoding;
@@ -378,10 +397,14 @@
   read_encoded_value_with_base (y_encoding, base_from_object (y_encoding, ob),
 				y->pc_begin, &y_ptr);
 
-  return x_ptr - y_ptr;
+  if (x_ptr > y_ptr)
+    return 1;
+  if (x_ptr < y_ptr)
+    return -1;
+  return 0;
 }
 
-typedef saddr (*fde_compare_t) (struct object *, fde *, fde *);
+typedef int (*fde_compare_t) (struct object *, fde *, fde *);
 
 
 /* This is a special mix of insertion sort and heap sort, optimized for
@@ -401,7 +424,7 @@
   struct fde_vector *erratic;
 };
 
-static inline int
+static int
 start_fde_sort (struct fde_accumulator *accu, size_t count)
 {
   size_t size;
@@ -439,7 +462,7 @@
    chain to determine what should be placed in the ERRATIC array, and
    what is the linear sequence.  This overlay is safe from aliasing.  */
 
-static inline void
+static void
 fde_split (struct object *ob, fde_compare_t fde_compare,
 	   struct fde_vector *linear, struct fde_vector *erratic)
 {
@@ -459,13 +482,13 @@
       fde **probe;
 
       for (probe = chain_end;
-           probe != &marker && fde_compare (ob, linear->array[i], *probe) < 0;
-           probe = chain_end)
-        {
-          chain_end = (fde **)erratic->array[probe - linear->array];
-          erratic->array[probe - linear->array] = NULL;
-        }
-      erratic->array[i] = (fde *)chain_end;
+	   probe != &marker && fde_compare (ob, linear->array[i], *probe) < 0;
+	   probe = chain_end)
+	{
+	  chain_end = (fde **) erratic->array[probe - linear->array];
+	  erratic->array[probe - linear->array] = NULL;
+	}
+      erratic->array[i] = (fde *) chain_end;
       chain_end = &linear->array[i];
     }
 
@@ -490,11 +513,11 @@
 {
   /* For a description of this algorithm, see:
      Samuel P. Harbison, Guy L. Steele Jr.: C, a reference manual, 2nd ed.,
-     p. 60-61. */
+     p. 60-61.  */
   fde ** a = erratic->array;
   /* A portion of the array is called a "heap" if for all i>=0:
      If i and 2i+1 are valid indices, then a[i] >= a[2i+1].
-     If i and 2i+2 are valid indices, then a[i] >= a[2i+2]. */
+     If i and 2i+2 are valid indices, then a[i] >= a[2i+2].  */
 #define SWAP(x,y) do { fde * tmp = x; x = y; y = tmp; } while (0)
   size_t n = erratic->count;
   size_t m = n;
@@ -502,54 +525,54 @@
 
   while (m > 0)
     {
-      /* Invariant: a[m..n-1] is a heap. */
+      /* Invariant: a[m..n-1] is a heap.  */
       m--;
       for (i = m; 2*i+1 < n; )
-        {
-          if (2*i+2 < n
-              && fde_compare (ob, a[2*i+2], a[2*i+1]) > 0
-              && fde_compare (ob, a[2*i+2], a[i]) > 0)
-            {
-              SWAP (a[i], a[2*i+2]);
-              i = 2*i+2;
-            }
-          else if (fde_compare (ob, a[2*i+1], a[i]) > 0)
-            {
-              SWAP (a[i], a[2*i+1]);
-              i = 2*i+1;
-            }
-          else
-            break;
-        }
+	{
+	  if (2*i+2 < n
+	      && fde_compare (ob, a[2*i+2], a[2*i+1]) > 0
+	      && fde_compare (ob, a[2*i+2], a[i]) > 0)
+	    {
+	      SWAP (a[i], a[2*i+2]);
+	      i = 2*i+2;
+	    }
+	  else if (fde_compare (ob, a[2*i+1], a[i]) > 0)
+	    {
+	      SWAP (a[i], a[2*i+1]);
+	      i = 2*i+1;
+	    }
+	  else
+	    break;
+	}
     }
   while (n > 1)
     {
-      /* Invariant: a[0..n-1] is a heap. */
+      /* Invariant: a[0..n-1] is a heap.  */
       n--;
       SWAP (a[0], a[n]);
       for (i = 0; 2*i+1 < n; )
-        {
-          if (2*i+2 < n
-              && fde_compare (ob, a[2*i+2], a[2*i+1]) > 0
-              && fde_compare (ob, a[2*i+2], a[i]) > 0)
-            {
-              SWAP (a[i], a[2*i+2]);
-              i = 2*i+2;
-            }
-          else if (fde_compare (ob, a[2*i+1], a[i]) > 0)
-            {
-              SWAP (a[i], a[2*i+1]);
-              i = 2*i+1;
-            }
-          else
-            break;
-        }
+	{
+	  if (2*i+2 < n
+	      && fde_compare (ob, a[2*i+2], a[2*i+1]) > 0
+	      && fde_compare (ob, a[2*i+2], a[i]) > 0)
+	    {
+	      SWAP (a[i], a[2*i+2]);
+	      i = 2*i+2;
+	    }
+	  else if (fde_compare (ob, a[2*i+1], a[i]) > 0)
+	    {
+	      SWAP (a[i], a[2*i+1]);
+	      i = 2*i+1;
+	    }
+	  else
+	    break;
+	}
     }
 #undef SWAP
 }
 
-/* Merge V1 and V2, both sorted, and put the result into V1. */
-static inline void
+/* Merge V1 and V2, both sorted, and put the result into V1.  */
+static void
 fde_merge (struct object *ob, fde_compare_t fde_compare,
 	   struct fde_vector *v1, struct fde_vector *v2)
 {
@@ -560,21 +583,23 @@
   if (i2 > 0)
     {
       i1 = v1->count;
-      do {
-        i2--;
-        fde2 = v2->array[i2];
-        while (i1 > 0 && fde_compare (ob, v1->array[i1-1], fde2) > 0)
-          {
-            v1->array[i1+i2] = v1->array[i1-1];
-            i1--;
-          }
-        v1->array[i1+i2] = fde2;
-      } while (i2 > 0);
+      do
+	{
+	  i2--;
+	  fde2 = v2->array[i2];
+	  while (i1 > 0 && fde_compare (ob, v1->array[i1-1], fde2) > 0)
+	    {
+	      v1->array[i1+i2] = v1->array[i1-1];
+	      i1--;
+	    }
+	  v1->array[i1+i2] = fde2;
+	}
+      while (i2 > 0);
       v1->count += v2->count;
     }
 }
 
-static inline void
+static void
 end_fde_sort (struct object *ob, struct fde_accumulator *accu, size_t count)
 {
   fde_compare_t fde_compare;
@@ -619,7 +644,7 @@
   int encoding = DW_EH_PE_absptr;
   _Unwind_Ptr base = 0;
 
-  for (; this_fde->length != 0; this_fde = next_fde (this_fde))
+  for (; ! last_fde (ob, this_fde); this_fde = next_fde (this_fde))
     {
       struct dwarf_cie *this_cie;
       _Unwind_Ptr mask, pc_begin;
@@ -659,8 +684,8 @@
 	continue;
 
       count += 1;
-      if ((void *)pc_begin < ob->pc_begin)
-	ob->pc_begin = (void *)pc_begin;
+      if ((void *) pc_begin < ob->pc_begin)
+	ob->pc_begin = (void *) pc_begin;
     }
 
   return count;
@@ -673,7 +698,7 @@
   int encoding = ob->s.b.encoding;
   _Unwind_Ptr base = base_from_object (ob->s.b.encoding, ob);
 
-  for (; this_fde->length != 0; this_fde = next_fde (this_fde))
+  for (; ! last_fde (ob, this_fde); this_fde = next_fde (this_fde))
     {
       struct dwarf_cie *this_cie;
 
@@ -696,7 +721,7 @@
 
       if (encoding == DW_EH_PE_absptr)
 	{
-	  if (*(_Unwind_Ptr *)this_fde->pc_begin == 0)
+	  if (*(_Unwind_Ptr *) this_fde->pc_begin == 0)
 	    continue;
 	}
       else
@@ -729,7 +754,7 @@
    be faster.  We can be called multiple times, should we have failed to
    allocate a sorted fde array on a previous occasion.  */
 
-static inline void
+static void
 init_object (struct object* ob)
 {
   struct fde_accumulator accu;
@@ -764,7 +789,7 @@
     {
       fde **p;
       for (p = ob->u.array; *p; ++p)
-        add_fdes (ob, &accu, *p);
+	add_fdes (ob, &accu, *p);
     }
   else
     add_fdes (ob, &accu, ob->u.single);
@@ -790,7 +815,7 @@
   int encoding = ob->s.b.encoding;
   _Unwind_Ptr base = base_from_object (ob->s.b.encoding, ob);
 
-  for (; this_fde->length != 0; this_fde = next_fde (this_fde))
+  for (; ! last_fde (ob, this_fde); this_fde = next_fde (this_fde))
     {
       struct dwarf_cie *this_cie;
       _Unwind_Ptr pc_begin, pc_range;
@@ -814,8 +839,8 @@
 
       if (encoding == DW_EH_PE_absptr)
 	{
-	  pc_begin = ((_Unwind_Ptr *)this_fde->pc_begin)[0];
-	  pc_range = ((_Unwind_Ptr *)this_fde->pc_begin)[1];
+	  pc_begin = ((_Unwind_Ptr *) this_fde->pc_begin)[0];
+	  pc_range = ((_Unwind_Ptr *) this_fde->pc_begin)[1];
 	  if (pc_begin == 0)
 	    continue;
 	}
@@ -842,8 +867,8 @@
 	    continue;
 	}
 
-      if ((_Unwind_Ptr)pc - pc_begin < pc_range)
-        return this_fde;
+      if ((_Unwind_Ptr) pc - pc_begin < pc_range)
+	return this_fde;
     }
 
   return NULL;
@@ -852,7 +877,7 @@
 /* Binary search for an FDE containing the given PC.  Here are three
    implementations of increasing complexity.  */
 
-static inline fde *
+static fde *
 binary_search_unencoded_fdes (struct object *ob, void *pc)
 {
   struct fde_vector *vec = ob->u.sort;
@@ -865,8 +890,8 @@
       void *pc_begin;
       uaddr pc_range;
 
-      pc_begin = ((void **)f->pc_begin)[0];
-      pc_range = ((uaddr *)f->pc_begin)[1];
+      pc_begin = ((void **) f->pc_begin)[0];
+      pc_range = ((uaddr *) f->pc_begin)[1];
 
       if (pc < pc_begin)
 	hi = i;
@@ -879,7 +904,7 @@
   return NULL;
 }
 
-static inline fde *
+static fde *
 binary_search_single_encoding_fdes (struct object *ob, void *pc)
 {
   struct fde_vector *vec = ob->u.sort;
@@ -898,9 +923,9 @@
 					&pc_begin);
       read_encoded_value_with_base (encoding & 0x0F, 0, p, &pc_range);
 
-      if ((_Unwind_Ptr)pc < pc_begin)
+      if ((_Unwind_Ptr) pc < pc_begin)
 	hi = i;
-      else if ((_Unwind_Ptr)pc >= pc_begin + pc_range)
+      else if ((_Unwind_Ptr) pc >= pc_begin + pc_range)
 	lo = i + 1;
       else
 	return f;
@@ -909,7 +934,7 @@
   return NULL;
 }
 
-static inline fde *
+static fde *
 binary_search_mixed_encoding_fdes (struct object *ob, void *pc)
 {
   struct fde_vector *vec = ob->u.sort;
@@ -929,9 +954,9 @@
 					f->pc_begin, &pc_begin);
       read_encoded_value_with_base (encoding & 0x0F, 0, p, &pc_range);
 
-      if ((_Unwind_Ptr)pc < pc_begin)
+      if ((_Unwind_Ptr) pc < pc_begin)
 	hi = i;
-      else if ((_Unwind_Ptr)pc >= pc_begin + pc_range)
+      else if ((_Unwind_Ptr) pc >= pc_begin + pc_range)
 	lo = i + 1;
       else
 	return f;
@@ -969,14 +994,14 @@
     {
       /* Long slow labourious linear search, cos we've no memory.  */
       if (ob->s.b.from_array)
-        {
-          fde **p;
+	{
+	  fde **p;
 	  for (p = ob->u.array; *p ; p++)
 	    {
 	      fde *f = linear_search_fdes (ob, *p, pc);
-              if (f)
+	      if (f)
 		return f;
-            }
+	    }
 	  return NULL;
 	}
       else
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/unwind-dw2-fde.h libc-20030708/sysdeps/generic/unwind-dw2-fde.h
--- glibc-2.3.2/sysdeps/generic/unwind-dw2-fde.h	2001-11-16 08:09:20.000000000 +0900
+++ libc-20030708/sysdeps/generic/unwind-dw2-fde.h	2003-04-15 23:55:47.000000000 +0900
@@ -1,13 +1,14 @@
 /* Subroutines needed for unwinding stack frames for exception handling.  */
-/* Copyright (C) 1997, 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003
+   Free Software Foundation, Inc.
    Contributed by Jason Merrill <jason@cygnus.com>.
 
-This file is part of GNU CC.
+This file is part of GCC.
 
-GNU CC is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2, or (at your option)
-any later version.
+GCC is free software; you can redistribute it and/or modify it under
+the terms of the GNU General Public License as published by the Free
+Software Foundation; either version 2, or (at your option) any later
+version.
 
 In addition to the permissions in the GNU General Public License, the
 Free Software Foundation gives you unlimited permission to link the
@@ -18,15 +19,15 @@
 the file, and distribution when not linked into a combine
 executable.)
 
-GNU CC is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
+GCC is distributed in the hope that it will be useful, but WITHOUT ANY
+WARRANTY; without even the implied warranty of MERCHANTABILITY or
+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
+for more details.
 
 You should have received a copy of the GNU General Public License
-along with GNU CC; see the file COPYING.  If not, write to
-the Free Software Foundation, 59 Temple Place - Suite 330,
-Boston, MA 02111-1307, USA.  */
+along with GCC; see the file COPYING.  If not, write to the Free
+Software Foundation, 59 Temple Place - Suite 330, Boston, MA
+02111-1307, USA.  */
 
 
 struct fde_vector
@@ -57,12 +58,16 @@
       unsigned long mixed_encoding : 1;
       unsigned long encoding : 8;
       /* ??? Wish there was an easy way to detect a 64-bit host here;
-	 we've got 32 bits left to play with... */
+	 we've got 32 bits left to play with...  */
       unsigned long count : 21;
     } b;
     size_t i;
   } s;
 
+#ifdef DWARF2_OBJECT_END_PTR_EXTENSION
+  char *fde_end;
+#endif
+
   struct object *next;
 };
 #endif
@@ -116,7 +121,7 @@
    is located, and what the register lifetimes and stack layout are
    within the function.
 
-   The data structures are defined in the DWARF specfication, although
+   The data structures are defined in the DWARF specification, although
    not in a very readable way (see LITERATURE).
 
    Every time an exception is thrown, the code needs to locate the FDE
@@ -125,7 +130,7 @@
    a) in a linear search, find the shared image (i.e. DLL) containing
       the PC
    b) using the FDE table for that shared object, locate the FDE using
-      binary search (which requires the sorting).  */   
+      binary search (which requires the sorting).  */
 
 /* The first few fields of a CIE.  The CIE_id field is 0 for a CIE,
    to distinguish it from a valid FDE.  FDEs are aligned to an addressing
@@ -159,7 +164,17 @@
 static inline fde *
 next_fde (fde *f)
 {
-  return (fde *)((char *)f + f->length + sizeof (f->length));
+  return (fde *) ((char *) f + f->length + sizeof (f->length));
 }
 
 extern fde * _Unwind_Find_FDE (void *, struct dwarf_eh_bases *);
+
+static inline int
+last_fde (struct object *obj __attribute__ ((__unused__)), fde *f)
+{
+#ifdef DWARF2_OBJECT_END_PTR_EXTENSION
+  return (char *)f == obj->fde_end || f->length == 0;
+#else
+  return f->length == 0;
+#endif
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/unwind-dw2.c libc-20030708/sysdeps/generic/unwind-dw2.c
--- glibc-2.3.2/sysdeps/generic/unwind-dw2.c	2003-01-08 14:01:02.000000000 +0900
+++ libc-20030708/sysdeps/generic/unwind-dw2.c	2003-04-15 23:55:47.000000000 +0900
@@ -1,22 +1,23 @@
 /* DWARF2 exception handling and frame unwind runtime interface routines.
-   Copyright (C) 1997,1998,1999,2000,2001,2003 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003
+   Free Software Foundation, Inc.
 
-   This file is part of GNU CC.
+   This file is part of GCC.
 
-   GNU CC is free software; you can redistribute it and/or modify
-   it under the terms of the GNU General Public License as published by
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2, or (at your option)
    any later version.
 
-   GNU CC is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-   GNU General Public License for more details.
+   GCC is distributed in the hope that it will be useful, but WITHOUT
+   ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
+   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
+   License for more details.
 
    You should have received a copy of the GNU General Public License
-   along with GNU CC; see the file COPYING.  If not, write to
-   the Free Software Foundation, 59 Temple Place - Suite 330,
-   Boston, MA 02111-1307, USA.  */
+   along with GCC; see the file COPYING.  If not, write to the Free
+   Software Foundation, 59 Temple Place - Suite 330, Boston, MA
+   02111-1307, USA.  */
 
 #ifdef _LIBC
 #include <stdlib.h>
@@ -37,7 +38,8 @@
 #include "gthr.h"
 #endif
 
-#if !USING_SJLJ_EXCEPTIONS
+
+#ifndef __USING_SJLJ_EXCEPTIONS__
 
 #ifndef STACK_GROWS_DOWNWARD
 #define STACK_GROWS_DOWNWARD 0
@@ -52,7 +54,14 @@
 #define DWARF_FRAME_REGISTERS FIRST_PSEUDO_REGISTER
 #endif
 
-/* This is the register and unwind state for a particular frame.  */
+/* Dwarf frame registers used for pre gcc 3.0 compiled glibc.  */
+#ifndef PRE_GCC3_DWARF_FRAME_REGISTERS
+#define PRE_GCC3_DWARF_FRAME_REGISTERS DWARF_FRAME_REGISTERS
+#endif
+
+/* This is the register and unwind state for a particular frame.  This
+   provides the information necessary to unwind up past a frame and return
+   to its caller.  */
 struct _Unwind_Context
 {
   void *reg[DWARF_FRAME_REGISTERS+1];
@@ -80,7 +89,7 @@
   {
     struct {
       union {
-	unsigned int reg;
+	_Unwind_Word reg;
 	_Unwind_Sword offset;
 	const unsigned char *exp;
       } loc;
@@ -112,8 +121,8 @@
 
   /* The information we care about from the CIE/FDE.  */
   _Unwind_Personality_Fn personality;
-  signed int data_align;
-  unsigned int code_align;
+  _Unwind_Sword data_align;
+  _Unwind_Word code_align;
   unsigned char retaddr_column;
   unsigned char fde_encoding;
   unsigned char lsda_encoding;
@@ -138,10 +147,10 @@
 read_pointer (const void *p) { const union unaligned *up = p; return up->p; }
 
 static inline int
-read_1u (const void *p) { return *(const unsigned char *)p; }
+read_1u (const void *p) { return *(const unsigned char *) p; }
 
 static inline int
-read_1s (const void *p) { return *(const signed char *)p; }
+read_1s (const void *p) { return *(const signed char *) p; }
 
 static inline int
 read_2u (const void *p) { const union unaligned *up = p; return up->u2; }
@@ -170,6 +179,14 @@
   return * (_Unwind_Word *) context->reg[index];
 }
 
+/* Get the value of the CFA as saved in CONTEXT.  */
+
+_Unwind_Word
+_Unwind_GetCFA (struct _Unwind_Context *context)
+{
+  return (_Unwind_Word) context->cfa;
+}
+
 /* Overwrite the saved value for register REG in CONTEXT with VAL.  */
 
 inline void
@@ -206,6 +223,17 @@
   return (_Unwind_Ptr) context->bases.func;
 }
 
+void *
+_Unwind_FindEnclosingFunction (void *pc)
+{
+  struct dwarf_eh_bases bases;
+  struct dwarf_fde *fde = _Unwind_Find_FDE (pc-1, &bases);
+  if (fde)
+    return bases.func;
+  else
+    return NULL;
+}
+
 #ifndef __ia64__
 _Unwind_Ptr
 _Unwind_GetDataRelBase (struct _Unwind_Context *context)
@@ -231,7 +259,7 @@
   const unsigned char *aug = cie->augmentation;
   const unsigned char *p = aug + strlen (aug) + 1;
   const unsigned char *ret = NULL;
-  _Unwind_Ptr tmp;
+  _Unwind_Word utmp;
 
   /* g++ v2 "eh" has pointer immediately following augmentation string,
      so it must be handled first.  */
@@ -244,8 +272,8 @@
 
   /* Immediately following the augmentation are the code and
      data alignment and return address column.  */
-  p = read_uleb128 (p, &tmp); fs->code_align = tmp;
-  p = read_sleb128 (p, &tmp); fs->data_align = (saddr) tmp;
+  p = read_uleb128 (p, &fs->code_align);
+  p = read_sleb128 (p, &fs->data_align);
   fs->retaddr_column = *p++;
   fs->lsda_encoding = DW_EH_PE_omit;
 
@@ -254,8 +282,8 @@
      the size.  */
   if (*aug == 'z')
     {
-      p = read_uleb128 (p, &tmp);
-      ret = p + tmp;
+      p = read_uleb128 (p, &utmp);
+      ret = p + utmp;
 
       fs->saw_z = 1;
       ++aug;
@@ -303,7 +331,7 @@
 execute_stack_op (const unsigned char *op_ptr, const unsigned char *op_end,
 		  struct _Unwind_Context *context, _Unwind_Word initial)
 {
-  _Unwind_Word stack[64];	/* ??? Assume this is enough. */
+  _Unwind_Word stack[64];	/* ??? Assume this is enough.  */
   int stack_elt;
 
   stack[0] = initial;
@@ -312,9 +340,8 @@
   while (op_ptr < op_end)
     {
       enum dwarf_location_atom op = *op_ptr++;
-      _Unwind_Word result = 0, reg;
-      _Unwind_Sword offset;
-      _Unwind_Ptr ptrtmp;
+      _Unwind_Word result, reg, utmp;
+      _Unwind_Sword offset, stmp;
 
       switch (op)
 	{
@@ -391,12 +418,11 @@
 	  op_ptr += 8;
 	  break;
 	case DW_OP_constu:
-	  op_ptr = read_uleb128 (op_ptr, &ptrtmp);
-	  result = ptrtmp;
+	  op_ptr = read_uleb128 (op_ptr, &result);
 	  break;
 	case DW_OP_consts:
-	  op_ptr = read_sleb128 (op_ptr, &ptrtmp);
-	  result = (saddr)ptrtmp;
+	  op_ptr = read_sleb128 (op_ptr, &stmp);
+	  result = stmp;
 	  break;
 
 	case DW_OP_reg0:
@@ -434,7 +460,7 @@
 	  result = _Unwind_GetGR (context, op - DW_OP_reg0);
 	  break;
 	case DW_OP_regx:
-	  op_ptr = read_uleb128 (op_ptr, &ptrtmp); reg = ptrtmp;
+	  op_ptr = read_uleb128 (op_ptr, &reg);
 	  result = _Unwind_GetGR (context, reg);
 	  break;
 
@@ -470,12 +496,12 @@
 	case DW_OP_breg29:
 	case DW_OP_breg30:
 	case DW_OP_breg31:
-	  op_ptr = read_sleb128 (op_ptr, &ptrtmp); offset = (saddr)ptrtmp;
+	  op_ptr = read_sleb128 (op_ptr, &offset);
 	  result = _Unwind_GetGR (context, op - DW_OP_breg0) + offset;
 	  break;
 	case DW_OP_bregx:
-	  op_ptr = read_uleb128 (op_ptr, &ptrtmp); reg = ptrtmp;
-	  op_ptr = read_sleb128 (op_ptr, &ptrtmp); offset = (saddr)ptrtmp;
+	  op_ptr = read_uleb128 (op_ptr, &reg);
+	  op_ptr = read_sleb128 (op_ptr, &offset);
 	  result = _Unwind_GetGR (context, reg) + offset;
 	  break;
 
@@ -533,14 +559,14 @@
 	    {
 	    case DW_OP_deref:
 	      {
-		void *ptr = (void *)(_Unwind_Ptr) result;
+		void *ptr = (void *) (_Unwind_Ptr) result;
 		result = (_Unwind_Ptr) read_pointer (ptr);
 	      }
 	      break;
 
 	    case DW_OP_deref_size:
 	      {
-		void *ptr = (void *)(_Unwind_Ptr) result;
+		void *ptr = (void *) (_Unwind_Ptr) result;
 		switch (*op_ptr++)
 		  {
 		  case 1:
@@ -572,12 +598,12 @@
 	      result = ~result;
 	      break;
 	    case DW_OP_plus_uconst:
-	      op_ptr = read_uleb128 (op_ptr, &ptrtmp); reg = ptrtmp;
-	      result += reg;
+	      op_ptr = read_uleb128 (op_ptr, &utmp);
+	      result += utmp;
 	      break;
-	    /* Avoid warnings.  */
+
 	    default:
-	      break;
+	      abort ();
 	    }
 	  break;
 
@@ -597,68 +623,68 @@
 	  {
 	    /* Binary operations.  */
 	    _Unwind_Word first, second;
-	  if ((stack_elt -= 2) < 0)
-	    abort ();
-	  second = stack[stack_elt];
-	  first = stack[stack_elt + 1];
+	    if ((stack_elt -= 2) < 0)
+	      abort ();
+	    second = stack[stack_elt];
+	    first = stack[stack_elt + 1];
 
-	  switch (op)
-	    {
-	    case DW_OP_and:
-	      result = second & first;
-	      break;
-	    case DW_OP_div:
-	      result = (_Unwind_Sword)second / (_Unwind_Sword)first;
-	      break;
-	    case DW_OP_minus:
-	      result = second - first;
-	      break;
-	    case DW_OP_mod:
-	      result = (_Unwind_Sword)second % (_Unwind_Sword)first;
-	      break;
-	    case DW_OP_mul:
-	      result = second * first;
-	      break;
-	    case DW_OP_or:
-	      result = second | first;
-	      break;
-	    case DW_OP_plus:
-	      result = second + first;
-	      break;
-	    case DW_OP_shl:
-	      result = second << first;
-	      break;
-	    case DW_OP_shr:
-	      result = second >> first;
-	      break;
-	    case DW_OP_shra:
-	      result = (_Unwind_Sword)second >> first;
-	      break;
-	    case DW_OP_xor:
-	      result = second ^ first;
-	      break;
-	    case DW_OP_le:
-	      result = (_Unwind_Sword)first <= (_Unwind_Sword)second;
-	      break;
-	    case DW_OP_ge:
-	      result = (_Unwind_Sword)first >= (_Unwind_Sword)second;
-	      break;
-	    case DW_OP_eq:
-	      result = (_Unwind_Sword)first == (_Unwind_Sword)second;
-	      break;
-	    case DW_OP_lt:
-	      result = (_Unwind_Sword)first < (_Unwind_Sword)second;
-	      break;
-	    case DW_OP_gt:
-	      result = (_Unwind_Sword)first > (_Unwind_Sword)second;
-	      break;
-	    case DW_OP_ne:
-	      result = (_Unwind_Sword)first != (_Unwind_Sword)second;
-	      break;
-	    default:
-	      /* Avoid warnings.  */
-	      break;
-	    }
+	    switch (op)
+	      {
+	      case DW_OP_and:
+		result = second & first;
+		break;
+	      case DW_OP_div:
+		result = (_Unwind_Sword) second / (_Unwind_Sword) first;
+		break;
+	      case DW_OP_minus:
+		result = second - first;
+		break;
+	      case DW_OP_mod:
+		result = (_Unwind_Sword) second % (_Unwind_Sword) first;
+		break;
+	      case DW_OP_mul:
+		result = second * first;
+		break;
+	      case DW_OP_or:
+		result = second | first;
+		break;
+	      case DW_OP_plus:
+		result = second + first;
+		break;
+	      case DW_OP_shl:
+		result = second << first;
+		break;
+	      case DW_OP_shr:
+		result = second >> first;
+		break;
+	      case DW_OP_shra:
+		result = (_Unwind_Sword) second >> first;
+		break;
+	      case DW_OP_xor:
+		result = second ^ first;
+		break;
+	      case DW_OP_le:
+		result = (_Unwind_Sword) first <= (_Unwind_Sword) second;
+		break;
+	      case DW_OP_ge:
+		result = (_Unwind_Sword) first >= (_Unwind_Sword) second;
+		break;
+	      case DW_OP_eq:
+		result = (_Unwind_Sword) first == (_Unwind_Sword) second;
+		break;
+	      case DW_OP_lt:
+		result = (_Unwind_Sword) first < (_Unwind_Sword) second;
+		break;
+	      case DW_OP_gt:
+		result = (_Unwind_Sword) first > (_Unwind_Sword) second;
+		break;
+	      case DW_OP_ne:
+		result = (_Unwind_Sword) first != (_Unwind_Sword) second;
+		break;
+
+	      default:
+		abort ();
+	      }
 	  }
 	  break;
 
@@ -714,20 +740,26 @@
   /* Don't allow remember/restore between CIE and FDE programs.  */
   fs->regs.prev = NULL;
 
+  /* The comparison with the return address uses < rather than <= because
+     we are only interested in the effects of code before the call; for a
+     noreturn function, the return address may point to unrelated code with
+     a different stack configuration that we are not interested in.  We
+     assume that the call itself is unwind info-neutral; if not, or if
+     there are delay instructions that adjust the stack, these must be
+     reflected at the point immediately before the call insn.  */
   while (insn_ptr < insn_end && fs->pc < context->ra)
     {
       unsigned char insn = *insn_ptr++;
-      _Unwind_Word reg;
-      _Unwind_Sword offset;
-      _Unwind_Ptr ptrtmp;
+      _Unwind_Word reg, utmp;
+      _Unwind_Sword offset, stmp;
 
       if ((insn & 0xc0) == DW_CFA_advance_loc)
 	fs->pc += (insn & 0x3f) * fs->code_align;
       else if ((insn & 0xc0) == DW_CFA_offset)
 	{
 	  reg = insn & 0x3f;
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  offset = ptrtmp * fs->data_align;
+	  insn_ptr = read_uleb128 (insn_ptr, &utmp);
+	  offset = (_Unwind_Sword) utmp * fs->data_align;
 	  fs->regs.reg[reg].how = REG_SAVED_OFFSET;
 	  fs->regs.reg[reg].loc.offset = offset;
 	}
@@ -757,28 +789,31 @@
 	  break;
 
 	case DW_CFA_offset_extended:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp); reg = ptrtmp;
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  offset = ptrtmp * fs->data_align;
+	  insn_ptr = read_uleb128 (insn_ptr, &reg);
+	  insn_ptr = read_uleb128 (insn_ptr, &utmp);
+	  offset = (_Unwind_Sword) utmp * fs->data_align;
 	  fs->regs.reg[reg].how = REG_SAVED_OFFSET;
 	  fs->regs.reg[reg].loc.offset = offset;
 	  break;
 
 	case DW_CFA_restore_extended:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp); reg = ptrtmp;
+	  insn_ptr = read_uleb128 (insn_ptr, &reg);
 	  fs->regs.reg[reg].how = REG_UNSAVED;
 	  break;
 
 	case DW_CFA_undefined:
 	case DW_CFA_same_value:
+	  insn_ptr = read_uleb128 (insn_ptr, &reg);
+	  break;
+
 	case DW_CFA_nop:
 	  break;
 
 	case DW_CFA_register:
 	  {
 	    _Unwind_Word reg2;
-	    insn_ptr = read_uleb128 (insn_ptr, &ptrtmp); reg = ptrtmp;
-	    insn_ptr = read_uleb128 (insn_ptr, &ptrtmp); reg2 = ptrtmp;
+	    insn_ptr = read_uleb128 (insn_ptr, &reg);
+	    insn_ptr = read_uleb128 (insn_ptr, &reg2);
 	    fs->regs.reg[reg].how = REG_SAVED_REG;
 	    fs->regs.reg[reg].loc.reg = reg2;
 	  }
@@ -793,7 +828,7 @@
 		unused_rs = unused_rs->prev;
 	      }
 	    else
-	      new_rs = alloca (sizeof (struct frame_state_reg_info));
+	      new_rs = __builtin_alloca (sizeof (struct frame_state_reg_info));
 
 	    *new_rs = fs->regs;
 	    fs->regs.prev = new_rs;
@@ -810,60 +845,55 @@
 	  break;
 
 	case DW_CFA_def_cfa:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  fs->cfa_reg = ptrtmp;
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  fs->cfa_offset = ptrtmp;
+	  insn_ptr = read_uleb128 (insn_ptr, &fs->cfa_reg);
+	  insn_ptr = read_uleb128 (insn_ptr, &utmp);
+	  fs->cfa_offset = utmp;
 	  fs->cfa_how = CFA_REG_OFFSET;
 	  break;
 
 	case DW_CFA_def_cfa_register:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  fs->cfa_reg = ptrtmp;
+	  insn_ptr = read_uleb128 (insn_ptr, &fs->cfa_reg);
 	  fs->cfa_how = CFA_REG_OFFSET;
 	  break;
 
 	case DW_CFA_def_cfa_offset:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  fs->cfa_offset = ptrtmp;
+	  insn_ptr = read_uleb128 (insn_ptr, &utmp);
+	  fs->cfa_offset = utmp;
 	  /* cfa_how deliberately not set.  */
 	  break;
 
 	case DW_CFA_def_cfa_expression:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
+	  insn_ptr = read_uleb128 (insn_ptr, &utmp);
 	  fs->cfa_exp = insn_ptr;
 	  fs->cfa_how = CFA_EXP;
-	  insn_ptr += ptrtmp;
+	  insn_ptr += utmp;
 	  break;
 
 	case DW_CFA_expression:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp); reg = ptrtmp;
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
+	  insn_ptr = read_uleb128 (insn_ptr, &reg);
+	  insn_ptr = read_uleb128 (insn_ptr, &utmp);
 	  fs->regs.reg[reg].how = REG_SAVED_EXP;
 	  fs->regs.reg[reg].loc.exp = insn_ptr;
-	  insn_ptr += ptrtmp;
+	  insn_ptr += utmp;
 	  break;
 
 	  /* From the 2.1 draft.  */
 	case DW_CFA_offset_extended_sf:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp); reg = ptrtmp;
-	  insn_ptr = read_sleb128 (insn_ptr, &ptrtmp);
-	  offset = (saddr)ptrtmp * fs->data_align;
+	  insn_ptr = read_uleb128 (insn_ptr, &reg);
+	  insn_ptr = read_sleb128 (insn_ptr, &stmp);
+	  offset = stmp * fs->data_align;
 	  fs->regs.reg[reg].how = REG_SAVED_OFFSET;
 	  fs->regs.reg[reg].loc.offset = offset;
 	  break;
 
 	case DW_CFA_def_cfa_sf:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  fs->cfa_reg = ptrtmp;
-	  insn_ptr = read_sleb128 (insn_ptr, &ptrtmp);
-	  fs->cfa_offset = (saddr)ptrtmp;
+	  insn_ptr = read_uleb128 (insn_ptr, &fs->cfa_reg);
+	  insn_ptr = read_sleb128 (insn_ptr, &fs->cfa_offset);
 	  fs->cfa_how = CFA_REG_OFFSET;
 	  break;
 
 	case DW_CFA_def_cfa_offset_sf:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  fs->cfa_offset = ptrtmp;
+	  insn_ptr = read_sleb128 (insn_ptr, &fs->cfa_offset);
 	  /* cfa_how deliberately not set.  */
 	  break;
 
@@ -877,16 +907,15 @@
 	  break;
 
 	case DW_CFA_GNU_args_size:
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  context->args_size = ptrtmp;
+	  insn_ptr = read_uleb128 (insn_ptr, &context->args_size);
 	  break;
 
 	case DW_CFA_GNU_negative_offset_extended:
 	  /* Obsoleted by DW_CFA_offset_extended_sf, but used by
 	     older PowerPC code.  */
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp); reg = ptrtmp;
-	  insn_ptr = read_uleb128 (insn_ptr, &ptrtmp);
-	  offset = ptrtmp * fs->data_align;
+	  insn_ptr = read_uleb128 (insn_ptr, &reg);
+	  insn_ptr = read_uleb128 (insn_ptr, &utmp);
+	  offset = (_Unwind_Word) utmp * fs->data_align;
 	  fs->regs.reg[reg].how = REG_SAVED_OFFSET;
 	  fs->regs.reg[reg].loc.offset = -offset;
 	  break;
@@ -897,6 +926,11 @@
     }
 }
 
+/* Given the _Unwind_Context CONTEXT for a stack frame, look up the FDE for
+   its caller and decode it into FS.  This function also sets the
+   args_size and lsda members of CONTEXT, as they are really information
+   about the caller's frame.  */
+
 static _Unwind_Reason_Code
 uw_frame_state_for (struct _Unwind_Context *context, _Unwind_FrameState *fs)
 {
@@ -913,7 +947,7 @@
     {
       /* Couldn't find frame unwind info for this function.  Try a
 	 target-specific fallback mechanism.  This will necessarily
-	 not profide a personality routine or LSDA.  */
+	 not provide a personality routine or LSDA.  */
 #ifdef MD_FALLBACK_FRAME_STATE_FOR
       MD_FALLBACK_FRAME_STATE_FOR (context, fs, success);
       return _URC_END_OF_STACK;
@@ -937,12 +971,12 @@
   execute_cfa_program (insn, end, context, fs);
 
   /* Locate augmentation for the fde.  */
-  aug = (unsigned char *)fde + sizeof (*fde);
+  aug = (unsigned char *) fde + sizeof (*fde);
   aug += 2 * size_of_encoded_value (fs->fde_encoding);
   insn = NULL;
   if (fs->saw_z)
     {
-      _Unwind_Ptr i;
+      _Unwind_Word i;
       aug = read_uleb128 (aug, &i);
       insn = aug + i;
     }
@@ -965,10 +999,10 @@
   void *eh_ptr;
   long cfa_offset;
   long args_size;
-  long reg_or_offset[DWARF_FRAME_REGISTERS+1];
+  long reg_or_offset[PRE_GCC3_DWARF_FRAME_REGISTERS+1];
   unsigned short cfa_reg;
   unsigned short retaddr_column;
-  char saved[DWARF_FRAME_REGISTERS+1];
+  char saved[PRE_GCC3_DWARF_FRAME_REGISTERS+1];
 } frame_state;
 
 #ifndef STATIC
@@ -1001,7 +1035,7 @@
   if (fs.cfa_how == CFA_EXP)
     return 0;
 
-  for (reg = 0; reg < DWARF_FRAME_REGISTERS + 1; reg++)
+  for (reg = 0; reg < PRE_GCC3_DWARF_FRAME_REGISTERS + 1; reg++)
     {
       state_in->saved[reg] = fs.regs.reg[reg].how;
       switch (state_in->saved[reg])
@@ -1059,7 +1093,7 @@
 	 that this will not be a problem.  */
       {
 	const unsigned char *exp = fs->cfa_exp;
-	_Unwind_Ptr len;
+	_Unwind_Word len;
 
 	exp = read_uleb128 (exp, &len);
 	cfa = (void *) (_Unwind_Ptr)
@@ -1087,7 +1121,7 @@
       case REG_SAVED_EXP:
 	{
 	  const unsigned char *exp = fs->regs.reg[i].loc.exp;
-	  _Unwind_Ptr len;
+	  _Unwind_Word len;
 	  _Unwind_Ptr val;
 
 	  exp = read_uleb128 (exp, &len);
@@ -1099,6 +1133,11 @@
       }
 }
 
+/* CONTEXT describes the unwind state for a frame, and FS describes the FDE
+   of its caller.  Update CONTEXT to refer to the caller as well.  Note
+   that the args_size and lsda members are not updated here, but later in
+   uw_frame_state_for.  */
+
 static void
 uw_update_context (struct _Unwind_Context *context, _Unwind_FrameState *fs)
 {
@@ -1113,14 +1152,16 @@
 /* Fill in CONTEXT for top-of-stack.  The only valid registers at this
    level will be the return address and the CFA.  */
 
-#define uw_init_context(CONTEXT)					\
-do {									\
-  /* Do any necessary initialization to access arbitrary stack frames.	\
-     On the SPARC, this means flushing the register windows.  */	\
-  __builtin_unwind_init ();						\
-  uw_init_context_1 (CONTEXT, __builtin_dwarf_cfa (),			\
-		     __builtin_return_address (0));			\
-} while (0)
+#define uw_init_context(CONTEXT)					   \
+  do									   \
+    {									   \
+      /* Do any necessary initialization to access arbitrary stack frames. \
+	 On the SPARC, this means flushing the register windows.  */	   \
+      __builtin_unwind_init ();						   \
+      uw_init_context_1 (CONTEXT, __builtin_dwarf_cfa (),		   \
+			 __builtin_return_address (0));			   \
+    }									   \
+  while (0)
 
 static void
 uw_init_context_1 (struct _Unwind_Context *context,
@@ -1154,12 +1195,14 @@
    macro because __builtin_eh_return must be invoked in the context of
    our caller.  */
 
-#define uw_install_context(CURRENT, TARGET)				\
-do {									\
-  long offset = uw_install_context_1 ((CURRENT), (TARGET));		\
-  void *handler = __builtin_frob_return_addr ((TARGET)->ra);		\
-  __builtin_eh_return (offset, handler);				\
-} while (0)
+#define uw_install_context(CURRENT, TARGET)				 \
+  do									 \
+    {									 \
+      long offset = uw_install_context_1 ((CURRENT), (TARGET));		 \
+      void *handler = __builtin_frob_return_addr ((TARGET)->ra);	 \
+      __builtin_eh_return (offset, handler);				 \
+    }									 \
+  while (0)
 
 static inline void
 init_dwarf_reg_size_table (void)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/unwind-pe.h libc-20030708/sysdeps/generic/unwind-pe.h
--- glibc-2.3.2/sysdeps/generic/unwind-pe.h	2002-03-19 07:19:28.000000000 +0900
+++ libc-20030708/sysdeps/generic/unwind-pe.h	2003-04-15 23:55:47.000000000 +0900
@@ -1,28 +1,28 @@
 /* Exception handling and frame unwind runtime interface routines.
    Copyright (C) 2001, 2002 Free Software Foundation, Inc.
 
-   This file is part of GNU CC.
+   This file is part of GCC.
 
-   GNU CC is free software; you can redistribute it and/or modify
-   it under the terms of the GNU General Public License as published by
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2, or (at your option)
    any later version.
 
-   GNU CC is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-   GNU General Public License for more details.
+   GCC is distributed in the hope that it will be useful, but WITHOUT
+   ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
+   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
+   License for more details.
 
    You should have received a copy of the GNU General Public License
-   along with GNU CC; see the file COPYING.  If not, write to
-   the Free Software Foundation, 59 Temple Place - Suite 330,
-   Boston, MA 02111-1307, USA.  */
+   along with GCC; see the file COPYING.  If not, write to the Free
+   Software Foundation, 59 Temple Place - Suite 330, Boston, MA
+   02111-1307, USA.  */
 
 /* @@@ Really this should be out of line, but this also causes link
    compatibility problems with the base ABI.  This is slightly better
    than duplicating code, however.  */
 
-/* If using C++, references to abort have to be qualified with std::. */
+/* If using C++, references to abort have to be qualified with std::.  */
 #if __cplusplus
 #define __gxx_abort std::abort
 #else
@@ -52,28 +52,24 @@
 #define DW_EH_PE_indirect	0x80
 
 
-#ifdef _LIBC
+#if defined(_LIBC) && !defined(NO_BASE_OF_ENCODED_VALUE)
 /* Prototypes.  */
 extern unsigned int size_of_encoded_value (unsigned char encoding);
 extern const unsigned char *read_encoded_value_with_base
   (unsigned char encoding, _Unwind_Ptr base,
    const unsigned char *p, _Unwind_Ptr *val);
-#endif
-
 
+#else
 
 /* Given an encoding, return the number of bytes the format occupies.
    This is only defined for fixed-size encodings, and so does not
    include leb128.  */
 
-#ifndef _LIBC
+# ifndef _LIBC
 static
-#endif
+# endif
 unsigned int
 size_of_encoded_value (unsigned char encoding)
-#if defined(_LIBC) && !defined(NO_BASE_OF_ENCODED_VALUE)
-;
-#else
 {
   if (encoding == DW_EH_PE_omit)
     return 0;
@@ -125,19 +121,68 @@
 
 #endif
 
+/* Read an unsigned leb128 value from P, store the value in VAL, return
+   P incremented past the value.  We assume that a word is large enough to
+   hold any value so encoded; if it is smaller than a pointer on some target,
+   pointers should not be leb128 encoded on that target.  */
+
+static const unsigned char *
+read_uleb128 (const unsigned char *p, _Unwind_Word *val)
+{
+  unsigned int shift = 0;
+  unsigned char byte;
+  _Unwind_Word result;
+
+  result = 0;
+  do
+    {
+      byte = *p++;
+      result |= (byte & 0x7f) << shift;
+      shift += 7;
+    }
+  while (byte & 0x80);
+
+  *val = result;
+  return p;
+}
+
+/* Similar, but read a signed leb128 value.  */
+
+static const unsigned char *
+read_sleb128 (const unsigned char *p, _Unwind_Sword *val)
+{
+  unsigned int shift = 0;
+  unsigned char byte;
+  _Unwind_Word result;
+
+  result = 0;
+  do
+    {
+      byte = *p++;
+      result |= (byte & 0x7f) << shift;
+      shift += 7;
+    }
+  while (byte & 0x80);
+
+  /* Sign-extend a negative value.  */
+  if (shift < 8 * sizeof(result) && (byte & 0x40) != 0)
+    result |= -(1L << shift);
+
+  *val = (_Unwind_Sword) result;
+  return p;
+}
+
+#if !(defined(_LIBC) && !defined(NO_BASE_OF_ENCODED_VALUE))
 /* Load an encoded value from memory at P.  The value is returned in VAL;
    The function returns P incremented past the value.  BASE is as given
    by base_of_encoded_value for this encoding in the appropriate context.  */
 
-#ifndef _LIBC
+# ifndef _LIBC
 static
-#endif
+# endif
 const unsigned char *
 read_encoded_value_with_base (unsigned char encoding, _Unwind_Ptr base,
 			      const unsigned char *p, _Unwind_Ptr *val)
-#if defined(_LIBC) && !defined(NO_BASE_OF_ENCODED_VALUE)
-;
-#else
 {
   union unaligned
     {
@@ -151,56 +196,37 @@
     } __attribute__((__packed__));
 
   union unaligned *u = (union unaligned *) p;
-  _Unwind_Ptr result;
+  _Unwind_Internal_Ptr result;
 
   if (encoding == DW_EH_PE_aligned)
     {
-      _Unwind_Ptr a = (_Unwind_Ptr)p;
+      _Unwind_Internal_Ptr a = (_Unwind_Internal_Ptr) p;
       a = (a + sizeof (void *) - 1) & - sizeof(void *);
-      result = *(_Unwind_Ptr *) a;
-      p = (const unsigned char *)(a + sizeof (void *));
+      result = *(_Unwind_Internal_Ptr *) a;
+      p = (const unsigned char *) (a + sizeof (void *));
     }
   else
     {
       switch (encoding & 0x0f)
 	{
 	case DW_EH_PE_absptr:
-	  result = (_Unwind_Ptr) u->ptr;
+	  result = (_Unwind_Internal_Ptr) u->ptr;
 	  p += sizeof (void *);
 	  break;
 
 	case DW_EH_PE_uleb128:
 	  {
-	    unsigned int shift = 0;
-	    unsigned char byte;
-
-	    result = 0;
-	    do
-	      {
-		byte = *p++;
-		result |= (_Unwind_Ptr)(byte & 0x7f) << shift;
-		shift += 7;
-	      }
-	    while (byte & 0x80);
+	    _Unwind_Word tmp;
+	    p = read_uleb128 (p, &tmp);
+	    result = (_Unwind_Internal_Ptr) tmp;
 	  }
 	  break;
 
 	case DW_EH_PE_sleb128:
 	  {
-	    unsigned int shift = 0;
-	    unsigned char byte;
-
-	    result = 0;
-	    do
-	      {
-		byte = *p++;
-		result |= (_Unwind_Ptr)(byte & 0x7f) << shift;
-		shift += 7;
-	      }
-	    while (byte & 0x80);
-
-	    if (shift < 8 * sizeof(result) && (byte & 0x40) != 0)
-	      result |= -(1L << shift);
+	    _Unwind_Sword tmp;
+	    p = read_sleb128 (p, &tmp);
+	    result = (_Unwind_Internal_Ptr) tmp;
 	  }
 	  break;
 
@@ -237,9 +263,9 @@
       if (result != 0)
 	{
 	  result += ((encoding & 0x70) == DW_EH_PE_pcrel
-		     ? (_Unwind_Ptr)u : base);
+		     ? (_Unwind_Internal_Ptr) u : base);
 	  if (encoding & DW_EH_PE_indirect)
-	    result = *(_Unwind_Ptr *)result;
+	    result = *(_Unwind_Internal_Ptr *) result;
 	}
     }
 
@@ -263,20 +289,3 @@
 }
 
 #endif
-
-/* Read an unsigned leb128 value from P, store the value in VAL, return
-   P incremented past the value.  */
-
-static inline const unsigned char *
-read_uleb128 (const unsigned char *p, _Unwind_Ptr *val)
-{
-  return read_encoded_value_with_base (DW_EH_PE_uleb128, 0, p, val);
-}
-
-/* Similar, but read a signed leb128 value.  */
-
-static inline const unsigned char *
-read_sleb128 (const unsigned char *p, _Unwind_Ptr *val)
-{
-  return read_encoded_value_with_base (DW_EH_PE_sleb128, 0, p, val);
-}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/unwind.h libc-20030708/sysdeps/generic/unwind.h
--- glibc-2.3.2/sysdeps/generic/unwind.h	2001-11-16 08:09:20.000000000 +0900
+++ libc-20030708/sysdeps/generic/unwind.h	2003-04-15 23:55:47.000000000 +0900
@@ -1,26 +1,36 @@
 /* Exception handling and frame unwind runtime interface routines.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
 
-   This file is part of GNU CC.
+   This file is part of GCC.
 
-   GNU CC is free software; you can redistribute it and/or modify
-   it under the terms of the GNU General Public License as published by
+   GCC is free software; you can redistribute it and/or modify it
+   under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2, or (at your option)
    any later version.
 
-   GNU CC is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-   GNU General Public License for more details.
+   GCC is distributed in the hope that it will be useful, but WITHOUT
+   ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
+   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public
+   License for more details.
 
    You should have received a copy of the GNU General Public License
-   along with GNU CC; see the file COPYING.  If not, write to
-   the Free Software Foundation, 59 Temple Place - Suite 330,
-   Boston, MA 02111-1307, USA.  */
+   along with GCC; see the file COPYING.  If not, write to the Free
+   Software Foundation, 59 Temple Place - Suite 330, Boston, MA
+   02111-1307, USA.  */
+
+/* As a special exception, if you include this header file into source
+   files compiled by GCC, this header file does not by itself cause
+   the resulting executable to be covered by the GNU General Public
+   License.  This exception does not however invalidate any other
+   reasons why the executable file might be covered by the GNU General
+   Public License.  */
 
 /* This is derived from the C++ ABI for IA-64.  Where we diverge
    for cross-architecture compatibility are noted with "@@@".  */
 
+#ifndef _UNWIND_H
+#define _UNWIND_H	1
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -31,7 +41,12 @@
    inefficient for 32-bit and smaller machines.  */
 typedef unsigned _Unwind_Word __attribute__((__mode__(__word__)));
 typedef signed _Unwind_Sword __attribute__((__mode__(__word__)));
+#if defined(__ia64__) && defined(__hpux__)
+typedef unsigned _Unwind_Ptr __attribute__((__mode__(__word__)));
+#else
 typedef unsigned _Unwind_Ptr __attribute__((__mode__(__pointer__)));
+#endif
+typedef unsigned _Unwind_Internal_Ptr __attribute__((__mode__(__pointer__)));
 
 /* @@@ The IA-64 ABI uses a 64-bit word to identify the producer and
    consumer of an exception.  We'll go along with this for now even on
@@ -87,6 +102,7 @@
 #define _UA_CLEANUP_PHASE	2
 #define _UA_HANDLER_FRAME	4
 #define _UA_FORCE_UNWIND	8
+#define _UA_END_OF_STACK	16
 
 /* This is an opaque type used to refer to a system-specific data
    structure used by the system unwinder. This context is created and
@@ -125,6 +141,9 @@
 extern _Unwind_Ptr _Unwind_GetIP (struct _Unwind_Context *);
 extern void _Unwind_SetIP (struct _Unwind_Context *, _Unwind_Ptr);
 
+/* @@@ Retrieve the CFA of the given context.  */
+extern _Unwind_Word _Unwind_GetCFA (struct _Unwind_Context *);
+
 extern void *_Unwind_GetLanguageSpecificData (struct _Unwind_Context *);
 
 extern _Unwind_Ptr _Unwind_GetRegionStart (struct _Unwind_Context *);
@@ -135,15 +154,15 @@
    library and language-specific exception handling semantics.  It is
    specific to the code fragment described by an unwind info block, and
    it is always referenced via the pointer in the unwind info block, and
-   hence it has no ABI-specified name. 
+   hence it has no ABI-specified name.
 
    Note that this implies that two different C++ implementations can
    use different names, and have different contents in the language
-   specific data area.  Moreover, that the language specific data 
+   specific data area.  Moreover, that the language specific data
    area contains no version info because name of the function invoked
    provides more effective versioning by detecting at link time the
    lack of code to handle the different data format.  */
-   
+
 typedef _Unwind_Reason_Code (*_Unwind_Personality_Fn)
      (int, _Unwind_Action, _Unwind_Exception_Class,
       struct _Unwind_Exception *, struct _Unwind_Context *);
@@ -186,6 +205,12 @@
 extern _Unwind_Ptr _Unwind_GetTextRelBase (struct _Unwind_Context *);
 #endif
 
+/* @@@ Given an address, return the entry point of the function that
+   contains it.  */
+extern void * _Unwind_FindEnclosingFunction (void *pc);
+
 #ifdef __cplusplus
 }
 #endif
+
+#endif	/* unwind.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/generic/wordexp.c libc-20030708/sysdeps/generic/wordexp.c
--- glibc-2.3.2/sysdeps/generic/wordexp.c	2002-09-24 14:12:10.000000000 +0900
+++ libc-20030708/sysdeps/generic/wordexp.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* POSIX.2 wordexp implementation.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Tim Waugh <tim@cyberelk.demon.co.uk>.
 
@@ -89,19 +89,18 @@
   return NULL;
 }
 
-static inline char *
+static char *
 w_addchar (char *buffer, size_t *actlen, size_t *maxlen, char ch)
      /* (lengths exclude trailing zero) */
 {
-  /* Add a character to the buffer, allocating room for it if needed.
-   */
+  /* Add a character to the buffer, allocating room for it if needed.  */
 
   if (*actlen == *maxlen)
     {
       char *old_buffer = buffer;
       assert (buffer == NULL || *maxlen != 0);
       *maxlen += W_CHUNK;
-      buffer = realloc (buffer, 1 + *maxlen);
+      buffer = (char *) realloc (buffer, 1 + *maxlen);
 
       if (buffer == NULL)
 	free (old_buffer);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/gnu/Makefile libc-20030708/sysdeps/gnu/Makefile
--- glibc-2.3.2/sysdeps/gnu/Makefile	2002-11-12 10:55:34.000000000 +0900
+++ libc-20030708/sysdeps/gnu/Makefile	2003-05-10 13:38:05.000000000 +0900
@@ -1,4 +1,5 @@
-# Copyright (C) 1996,97,98,99,2001,02 Free Software Foundation, Inc.
+# Copyright (C) 1996,1997,1998,1999,2001,2002,2003
+#	Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -34,9 +35,10 @@
 vpath errlist.c $(full_config_sysdirs)
 ifeq ($(versioning),yes)
 $(objpfx)errlist-compat.c: errlist.c $(..)sysdeps/gnu/errlist-compat.awk \
-			   $(common-objpfx)Versions.v.i
+			   $(common-objpfx)Versions.v.i $(before-compile)
 else
-$(objpfx)errlist-compat.c: errlist.c $(..)sysdeps/gnu/errlist-compat.awk
+$(objpfx)errlist-compat.c: errlist.c $(..)sysdeps/gnu/errlist-compat.awk \
+			   $(before-compile)
 endif
 	$(AWK) -v maxerr=`\
 	  $(CC) -S $(CPPFLAGS) $(CFLAGS) -DNOT_IN_libc -DEMIT_ERR_MAX $< -o - \
@@ -47,6 +49,7 @@
 # Make it unwritable so noone will edit it by mistake.
 	-chmod a-w $@T
 	mv -f $@T $@
+generated += errlist-compat.c
 
 # This will force the generation above to happy if need be.
 $(foreach o,.d $(object-suffixes),$(objpfx)errlist$o):$(objpfx)errlist-compat.c
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/gnu/ifaddrs.c libc-20030708/sysdeps/gnu/ifaddrs.c
--- glibc-2.3.2/sysdeps/gnu/ifaddrs.c	2002-12-03 07:36:30.000000000 +0900
+++ libc-20030708/sysdeps/gnu/ifaddrs.c	2003-04-28 23:53:23.000000000 +0900
@@ -1,5 +1,5 @@
 /* getifaddrs -- get names and addresses of all network interfaces
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -151,9 +151,13 @@
 
   return 0;
 }
+#ifndef getifaddrs
+libc_hidden_def (getifaddrs)
+#endif
 
 void
 freeifaddrs (struct ifaddrs *ifa)
 {
   free (ifa);
 }
+libc_hidden_def (freeifaddrs)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/gnu/siglist.c libc-20030708/sysdeps/gnu/siglist.c
--- glibc-2.3.2/sysdeps/gnu/siglist.c	2002-12-22 03:38:36.000000000 +0900
+++ libc-20030708/sysdeps/gnu/siglist.c	2003-04-01 21:00:59.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define list of all signal numbers and their names.
-   Copyright (C) 1997, 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,11 +31,6 @@
 };
 strong_alias (__new_sys_siglist, _sys_siglist_internal)
 
-#if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)
-strong_alias (_sys_siglist_internal, __old_sys_siglist)
-declare_symbol (__old_sys_siglist, object, OLD_SIGLIST_SIZE * __WORDSIZE / 8)
-#endif
-
 const char *const __new_sys_sigabbrev[NSIG] =
 {
 #define init_sig(sig, abbrev, desc)   [sig] = abbrev,
@@ -45,6 +40,9 @@
 strong_alias (__new_sys_sigabbrev, _sys_sigabbrev_internal)
 
 #if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)
+strong_alias (_sys_siglist_internal, __old_sys_siglist)
+declare_symbol (__old_sys_siglist, object, OLD_SIGLIST_SIZE * __WORDSIZE / 8)
+
 strong_alias (_sys_sigabbrev_internal, __old_sys_sigabbrev)
 declare_symbol (__old_sys_sigabbrev, object, OLD_SIGLIST_SIZE * __WORDSIZE / 8)
 
@@ -54,7 +52,26 @@
 compat_symbol (libc, __old_sys_sigabbrev, sys_sigabbrev, GLIBC_2_0);
 #endif
 
+#if SHLIB_COMPAT (libc, GLIBC_2_1, GLIBC_2_3_3) && defined OLD2_SIGLIST_SIZE
+strong_alias (_sys_siglist_internal, __old2_sys_siglist)
+declare_symbol (__old2_sys_siglist, object, OLD2_SIGLIST_SIZE * __WORDSIZE / 8)
+
+strong_alias (_sys_sigabbrev_internal, __old2_sys_sigabbrev)
+declare_symbol (__old2_sys_sigabbrev, object,
+		OLD2_SIGLIST_SIZE * __WORDSIZE / 8)
+
+strong_alias (__old2_sys_siglist, _old2_sys_siglist)
+compat_symbol (libc, __old2_sys_siglist, _sys_siglist, GLIBC_2_1);
+compat_symbol (libc, _old2_sys_siglist, sys_siglist, GLIBC_2_1);
+compat_symbol (libc, __old2_sys_sigabbrev, sys_sigabbrev, GLIBC_2_1);
+
+strong_alias (__new_sys_siglist, _new_sys_siglist)
+versioned_symbol (libc, __new_sys_siglist, _sys_siglist, GLIBC_2_3_3);
+versioned_symbol (libc, _new_sys_siglist, sys_siglist, GLIBC_2_3_3);
+versioned_symbol (libc, __new_sys_sigabbrev, sys_sigabbrev, GLIBC_2_3_3);
+#else
 strong_alias (__new_sys_siglist, _new_sys_siglist)
 versioned_symbol (libc, __new_sys_siglist, _sys_siglist, GLIBC_2_1);
 versioned_symbol (libc, _new_sys_siglist, sys_siglist, GLIBC_2_1);
 versioned_symbol (libc, __new_sys_sigabbrev, sys_sigabbrev, GLIBC_2_1);
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/gnu/utmpx.h libc-20030708/sysdeps/gnu/utmpx.h
--- glibc-2.3.2/sysdeps/gnu/utmpx.h	2001-07-08 04:21:22.000000000 +0900
+++ libc-20030708/sysdeps/gnu/utmpx.h	2003-04-28 23:53:23.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -47,41 +47,79 @@
 
 __BEGIN_DECLS
 
-/* Open user accounting database.  */
-extern void setutxent (void) __THROW;
+/* Open user accounting database.
 
-/* Close user accounting database.  */
-extern void endutxent (void) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void setutxent (void);
 
-/* Get the next entry from the user accounting database.  */
-extern struct utmpx *getutxent (void) __THROW;
+/* Close user accounting database.
 
-/* Get the user accounting database entry corresponding to ID.  */
-extern struct utmpx *getutxid (__const struct utmpx *__id) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern void endutxent (void);
 
-/* Get the user accounting database entry corresponding to LINE.  */
-extern struct utmpx *getutxline (__const struct utmpx *__line) __THROW;
+/* Get the next entry from the user accounting database.
 
-/* Write the entry UTMPX into the user accounting database.  */
-extern struct utmpx *pututxline (__const struct utmpx *__utmpx) __THROW;
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct utmpx *getutxent (void);
+
+/* Get the user accounting database entry corresponding to ID.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct utmpx *getutxid (__const struct utmpx *__id);
+
+/* Get the user accounting database entry corresponding to LINE.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct utmpx *getutxline (__const struct utmpx *__line);
+
+/* Write the entry UTMPX into the user accounting database.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern struct utmpx *pututxline (__const struct utmpx *__utmpx);
 
 
 #ifdef __USE_GNU
-/* Change name of the utmpx file to be examined.  */
-extern int utmpxname (__const char *__file) __THROW;
+/* Change name of the utmpx file to be examined.
 
-/* Append entry UTMP to the wtmpx-like file WTMPX_FILE.  */
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern int utmpxname (__const char *__file);
+
+/* Append entry UTMP to the wtmpx-like file WTMPX_FILE.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern void updwtmpx (__const char *__wtmpx_file,
-		      __const struct utmpx *__utmpx) __THROW;
+		      __const struct utmpx *__utmpx);
 
 
-/* Copy the information in UTMPX to UTMP. */
+/* Copy the information in UTMPX to UTMP.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern void getutmp (__const struct utmpx *__utmpx,
-		     struct utmp *__utmp) __THROW;
+		     struct utmp *__utmp);
+
+/* Copy the information in UTMP to UTMPX.
 
-/* Copy the information in UTMP to UTMPX. */
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern void getutmpx (__const struct utmp *__utmp,
-		      struct utmpx *__utmpx) __THROW;
+		      struct utmpx *__utmpx);
 #endif
 
 __END_DECLS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/hppa/fpu/libm-test-ulps libc-20030708/sysdeps/hppa/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/hppa/fpu/libm-test-ulps	2002-11-19 15:40:57.000000000 +0900
+++ libc-20030708/sysdeps/hppa/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -94,7 +94,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
@@ -107,10 +107,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
@@ -145,7 +145,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -239,7 +239,7 @@
 ifloat: 2
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
@@ -258,7 +258,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -266,7 +266,7 @@
 idouble: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -453,12 +453,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -513,7 +513,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/Versions libc-20030708/sysdeps/i386/Versions
--- glibc-2.3.2/sysdeps/i386/Versions	2000-06-15 15:53:58.000000000 +0900
+++ libc-20030708/sysdeps/i386/Versions	2003-05-02 00:11:51.000000000 +0900
@@ -9,7 +9,14 @@
   }
   GLIBC_2.1.1 {
     # extern inline functions used by <bits/string.h>
-    __memcpy_c; __memset_cc; __memset_cg; __memset_gg; __strchr_c; __strchr_g;
-    __strchrnul_c; __strchrnul_g;
+    __memcpy_c; __memset_cc; __memset_cg; __memset_gg;
+    __memcpy_by2; __memcpy_by4; __memcpy_g; __mempcpy_by2; __mempcpy_by4;
+    __mempcpy_byn; __memset_ccn_by2; __memset_ccn_by4; __memset_gcn_by2;
+    __memset_gcn_by4; __stpcpy_g; __strcat_c; __strcat_g; __strchr_c;
+    __strchr_g; __strchrnul_c; __strchrnul_g; __strcmp_gg; __strcpy_g;
+    __strcspn_c1; __strcspn_cg; __strcspn_g; __strlen_g; __strncat_g;
+    __strncmp_g; __strncpy_by2; __strncpy_by4; __strncpy_byn; __strncpy_gg;
+    __strpbrk_cg; __strpbrk_g; __strrchr_c; __strrchr_g; __strspn_c1;
+    __strspn_cg; __strspn_g; __strstr_cg; __strstr_g;
   }
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/bits/byteswap.h libc-20030708/sysdeps/i386/bits/byteswap.h
--- glibc-2.3.2/sysdeps/i386/bits/byteswap.h	2003-01-08 09:06:02.000000000 +0900
+++ libc-20030708/sysdeps/i386/bits/byteswap.h	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Macros to swap the order of bytes in integer values.
-   Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -64,7 +64,8 @@
 # if __GNUC__ >= 2
 /* To swap the bytes in a word the i486 processors and up provide the
    `bswap' opcode.  On i386 we have to use three instructions.  */
-#  if !defined __i486__ && !defined __pentium__ && !defined __pentiumpro__
+#  if !defined __i486__ && !defined __pentium__ && !defined __pentiumpro__ \
+      && !defined __pentium4__
 #   define __bswap_32(x)						      \
      (__extension__							      \
       ({ register unsigned int __v, __x = (x);				      \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/bits/setjmp.h libc-20030708/sysdeps/i386/bits/setjmp.h
--- glibc-2.3.2/sysdeps/i386/bits/setjmp.h	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/bits/setjmp.h	2003-04-15 23:55:47.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,8 +17,10 @@
    02111-1307 USA.  */
 
 /* Define the machine-dependent type `jmp_buf'.  Intel 386 version.  */
+#ifndef _BITS_SETJMP_H
+#define _BITS_SETJMP_H	1
 
-#ifndef _SETJMP_H
+#if !defined _SETJMP_H && !defined _PTHREAD_H
 # error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
 #endif
 
@@ -40,3 +42,5 @@
    containing a local variable at ADDRESS.  */
 #define _JMPBUF_UNWINDS(jmpbuf, address) \
   ((void *) (address) < (void *) (jmpbuf)[JB_SP])
+
+#endif	/* bits/setjmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/dl-machine.h libc-20030708/sysdeps/i386/dl-machine.h
--- glibc-2.3.2/sysdeps/i386/dl-machine.h	2003-01-12 17:37:35.000000000 +0900
+++ libc-20030708/sysdeps/i386/dl-machine.h	2003-06-12 08:54:04.000000000 +0900
@@ -23,7 +23,7 @@
 #define ELF_MACHINE_NAME "i386"
 
 #include <sys/param.h>
-
+#include <sysdep.h>
 #include <tls.h>
 
 /* Return nonzero iff ELF header is compatible with the running host.  */
@@ -95,7 +95,7 @@
 /* Set up the loaded object described by L so its unrelocated PLT
    entries will jump to the on-demand fixup code in dl-runtime.c.  */
 
-static inline int __attribute__ ((unused))
+static inline int __attribute__ ((unused, always_inline))
 elf_machine_runtime_setup (struct link_map *l, int lazy, int profile)
 {
   Elf32_Addr *got;
@@ -168,35 +168,51 @@
 	.text\n\
 	.globl _dl_runtime_resolve\n\
 	.type _dl_runtime_resolve, @function\n\
+	" CFI_STARTPROC "\n\
 	.align 16\n\
 _dl_runtime_resolve:\n\
+	" CFI_ADJUST_CFA_OFFSET (8) "\n\
 	pushl %eax		# Preserve registers otherwise clobbered.\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	pushl %ecx\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	pushl %edx\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	movl 16(%esp), %edx	# Copy args pushed by PLT in register.  Note\n\
 	movl 12(%esp), %eax	# that `fixup' takes its parameters in regs.\n\
 	call fixup		# Call resolver.\n\
 	popl %edx		# Get register content back.\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	popl %ecx\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	xchgl %eax, (%esp)	# Get %eax contents end store function address.\n\
 	ret $8			# Jump to function address.\n\
+	" CFI_ENDPROC "\n\
 	.size _dl_runtime_resolve, .-_dl_runtime_resolve\n\
 \n\
 	.globl _dl_runtime_profile\n\
 	.type _dl_runtime_profile, @function\n\
+	" CFI_STARTPROC "\n\
 	.align 16\n\
 _dl_runtime_profile:\n\
+	" CFI_ADJUST_CFA_OFFSET (8) "\n\
 	pushl %eax		# Preserve registers otherwise clobbered.\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	pushl %ecx\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	pushl %edx\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	movl 20(%esp), %ecx	# Load return address\n\
 	movl 16(%esp), %edx	# Copy args pushed by PLT in register.  Note\n\
 	movl 12(%esp), %eax	# that `fixup' takes its parameters in regs.\n\
 	call profile_fixup	# Call resolver.\n\
 	popl %edx		# Get register content back.\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	popl %ecx\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	xchgl %eax, (%esp)	# Get %eax contents end store function address.\n\
 	ret $8			# Jump to function address.\n\
+	" CFI_ENDPROC "\n\
 	.size _dl_runtime_profile, .-_dl_runtime_profile\n\
 	.previous\n\
 ");
@@ -207,23 +223,35 @@
 	.globl _dl_runtime_profile\n\
 	.type _dl_runtime_resolve, @function\n\
 	.type _dl_runtime_profile, @function\n\
+	" CFI_STARTPROC "\n\
 	.align 16\n\
 _dl_runtime_resolve:\n\
 _dl_runtime_profile:\n\
+	" CFI_ADJUST_CFA_OFFSET (8) "\n\
 	pushl %eax		# Preserve registers otherwise clobbered.\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	pushl %ecx\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	pushl %edx\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	movl 16(%esp), %edx	# Push the arguments for `fixup'\n\
 	movl 12(%esp), %eax\n\
 	pushl %edx\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	pushl %eax\n\
+	" CFI_ADJUST_CFA_OFFSET (4) "\n\
 	call fixup		# Call resolver.\n\
 	popl %edx		# Pop the parameters\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	popl %ecx\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	popl %edx		# Get register content back.\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	popl %ecx\n\
+	" CFI_ADJUST_CFA_OFFSET (-4) "\n\
 	xchgl %eax, (%esp)	# Get %eax contents end store function address.\n\
 	ret $8			# Jump to function address.\n\
+	" CFI_ENDPROC "\n\
 	.size _dl_runtime_resolve, .-_dl_runtime_resolve\n\
 	.size _dl_runtime_profile, .-_dl_runtime_profile\n\
 	.previous\n\
@@ -521,7 +549,7 @@
       struct link_map *sym_map = RESOLVE_MAP (&sym, version, r_type);
       Elf32_Addr value = sym == NULL ? 0 : sym_map->l_addr + sym->st_value;
 # else
-      Elf32_Addr value = RESOLVE (&sym, version, ELF32_R_TYPE (reloc->r_info));
+      Elf32_Addr value = RESOLVE (&sym, version, r_type);
       if (sym != NULL)
 	value += sym->st_value;
 # endif
@@ -533,11 +561,13 @@
 	case R_386_32:
 	  *reloc_addr = value + reloc->r_addend;
 	  break;
+# ifndef RESOLVE_CONFLICT_FIND_MAP
+	  /* Not needed for dl-conflict.c.  */
 	case R_386_PC32:
 	  *reloc_addr = (value + reloc->r_addend - (Elf32_Addr) reloc_addr);
 	  break;
 
-# ifdef USE_TLS
+#  ifdef USE_TLS
 	case R_386_TLS_DTPMOD32:
 	  /* Get the information from the link map returned by the
 	     resolv function.  */
@@ -570,9 +600,7 @@
 	    = (sym == NULL ? 0 : sym->st_value - sym_map->l_tls_offset)
 	      + reloc->r_addend;
 	  break;
-# endif	/* use TLS */
-# ifndef RESOLVE_CONFLICT_FIND_MAP
-	  /* Not needed for dl-conflict.c.  */
+#  endif	/* use TLS */
 	case R_386_COPY:
 	  if (sym == NULL)
 	    /* This can happen in trace mode if an object could not be
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/elf/start.S libc-20030708/sysdeps/i386/elf/start.S
--- glibc-2.3.2/sysdeps/i386/elf/start.S	2002-12-10 12:41:52.000000000 +0900
+++ libc-20030708/sysdeps/i386/elf/start.S	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Startup code compliant to the ELF i386 ABI.
-   Copyright (C) 1995,1996,1997,1998,2000,2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-1998,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -67,6 +67,27 @@
 	pushl %edx		/* Push address of the shared library
 				   termination function.  */
 
+#ifdef SHARED
+	/* Load PIC register.  */
+	call 1f
+	addl $_GLOBAL_OFFSET_TABLE_, %ebx
+
+	/* Push address of our own entry points to .fini and .init.  */
+	leal __libc_csu_fini@GOTOFF(%ebx), %eax
+	pushl %eax
+	leal __libc_csu_init@GOTOFF(%ebx), %eax
+	pushl %eax
+
+	pushl %ecx		/* Push second argument: argv.  */
+	pushl %esi		/* Push first argument: argc.  */
+
+	leal BP_SYM (main)@GOTOFF(%ebx), %eax
+	pushl %eax
+
+	/* Call the user's main function, and exit with its value.
+	   But let the libc call main.    */
+	call BP_SYM (__libc_start_main)@PLT
+#else
 	/* Push address of our own entry points to .fini and .init.  */
 	pushl $__libc_csu_fini
 	pushl $__libc_csu_init
@@ -79,9 +100,15 @@
 	/* Call the user's main function, and exit with its value.
 	   But let the libc call main.    */
 	call BP_SYM (__libc_start_main)
+#endif
 
 	hlt			/* Crash if somehow `exit' does return.  */
 
+#ifdef SHARED
+1:	movl	(%esp), %ebx
+	ret
+#endif
+
 /* To fulfill the System V/i386 ABI we need this symbol.  Yuck, it's so
    meaningless since we don't support machines < 80386.  */
 	.section .rodata
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/Makefile libc-20030708/sysdeps/i386/fpu/Makefile
--- glibc-2.3.2/sysdeps/i386/fpu/Makefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/Makefile	2003-04-29 16:14:48.000000000 +0900
@@ -0,0 +1,3 @@
+ifeq ($(subdir),math)
+$(objpfx)libm.so: $(elfobjdir)/ld.so
+endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/bits/mathinline.h libc-20030708/sysdeps/i386/fpu/bits/mathinline.h
--- glibc-2.3.2/sysdeps/i386/fpu/bits/mathinline.h	2002-12-17 04:31:12.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/bits/mathinline.h	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Inline math functions for i387.
-   Copyright (C) 1995,96,97,98,99,2000,2001 Free Software Foundation, Inc.
+   Copyright (C) 1995,96,97,98,99,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by John C. Bowman <bowman@math.ualberta.ca>, 1995.
 
@@ -437,8 +437,10 @@
   return __value)
 
 
+#ifdef __FAST_MATH__
 __inline_mathopNP (sqrt, "fsqrt")
 __inline_mathopNP_ (long double, __sqrtl, "fsqrt")
+#endif
 
 #if __GNUC_PREREQ (2, 8)
 __inline_mathcodeNP_ (double, fabs, __x, return __builtin_fabs (__x))
@@ -511,7 +513,8 @@
   __asm __volatile ("fldcw %0" : : "m" (__cw));				      \
   return __value)
 
-#define __ldexp_code \
+#ifdef __FAST_MATH__
+# define __ldexp_code \
   register long double __value;						      \
   __asm __volatile__							      \
     ("fscale"								      \
@@ -523,6 +526,7 @@
 {
   __ldexp_code;
 }
+#endif
 
 
 /* Optimized versions for some non-standardized functions.  */
@@ -530,11 +534,10 @@
 
 # ifdef __FAST_MATH__
 __inline_mathcodeNP (expm1, __x, __expm1_code)
-# endif
 
 /* We cannot rely on M_SQRT being defined.  So we do it for ourself
    here.  */
-# define __M_SQRT2	1.41421356237309504880L	/* sqrt(2) */
+#  define __M_SQRT2	1.41421356237309504880L	/* sqrt(2) */
 
 __inline_mathcodeNP (log1p, __x, \
   register long double __value;						      \
@@ -573,12 +576,12 @@
      : "=t" (__junk), "=u" (__value) : "0" (__x));			      \
   return __value)
 
+# endif
 #endif
 
 #ifdef __USE_ISOC99
 #ifdef __FAST_MATH__
 __inline_mathop_declNP (log2, "fld1; fxch; fyl2x", "0" (__x) : "st(1)")
-#endif /* __FAST_MATH__ */
 
 __MATH_INLINE float
 ldexpf (float __x, int __y) __THROW
@@ -592,7 +595,6 @@
   __ldexp_code;
 }
 
-#ifdef __FAST_MATH__
 __inline_mathcodeNP3 (fma, __x, __y, __z, return (__x * __y) + __z)
 
 __inline_mathopNP (rint, "frndint")
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/fedisblxcpt.c libc-20030708/sysdeps/i386/fpu/fedisblxcpt.c
--- glibc-2.3.2/sysdeps/i386/fpu/fedisblxcpt.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/fedisblxcpt.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Disable floating-point exceptions.
-   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 1999.
 
@@ -19,6 +19,9 @@
    02111-1307 USA.  */
 
 #include <fenv.h>
+#include <unistd.h>
+#include <ldsodefs.h>
+#include <dl-procinfo.h>
 
 int
 fedisableexcept (int excepts)
@@ -35,5 +38,18 @@
   new_exc |= excepts;
   __asm__ ("fldcw %0" : : "m" (*&new_exc));
 
+  /* If the CPU supports SSE we set the MXCSR as well.  */
+  if ((GL(dl_hwcap_mask) & HWCAP_I386_XMM) != 0)
+    {
+      unsigned int xnew_exc;
+
+      /* Get the current control word.  */
+      __asm__ ("stmxcsr %0" : "=m" (*&xnew_exc));
+
+      xnew_exc |= excepts << 7;
+
+      __asm__ ("ldmxcsr %0" : : "m" (*&xnew_exc));
+    }
+
   return old_exc;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/feenablxcpt.c libc-20030708/sysdeps/i386/fpu/feenablxcpt.c
--- glibc-2.3.2/sysdeps/i386/fpu/feenablxcpt.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/feenablxcpt.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Enable floating-point exceptions.
-   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 1999.
 
@@ -19,11 +19,15 @@
    02111-1307 USA.  */
 
 #include <fenv.h>
+#include <unistd.h>
+#include <ldsodefs.h>
+#include <dl-procinfo.h>
 
 int
 feenableexcept (int excepts)
 {
-  unsigned short int new_exc, old_exc;
+  unsigned short int new_exc;
+  unsigned short int old_exc;
 
   /* Get the current control word.  */
   __asm__ ("fstcw %0" : "=m" (*&new_exc));
@@ -34,5 +38,18 @@
   new_exc &= ~excepts;
   __asm__ ("fldcw %0" : : "m" (*&new_exc));
 
+  /* If the CPU supports SSE we set the MXCSR as well.  */
+  if ((GL(dl_hwcap_mask) & HWCAP_I386_XMM) != 0)
+    {
+      unsigned int xnew_exc;
+
+      /* Get the current control word.  */
+      __asm__ ("ldmxcsr %0" : "=m" (*&xnew_exc));
+
+      xnew_exc &= ~(excepts << 7);
+
+      __asm__ ("stmxcsr %0" : : "m" (*&xnew_exc));
+    }
+
   return old_exc;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/fegetenv.c libc-20030708/sysdeps/i386/fpu/fegetenv.c
--- glibc-2.3.2/sysdeps/i386/fpu/fegetenv.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/fegetenv.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Store current floating-point environment.
-   Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,1999,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -25,6 +25,10 @@
 __fegetenv (fenv_t *envp)
 {
   __asm__ ("fnstenv %0" : "=m" (*envp));
+  /* And load it right back since the processor changes the mask.
+     Intel thought this opcode to be used in interrupt handlers which
+     would block all exceptions.  */
+  __asm__ ("fldenv %0" : : "m" (*envp));
 
   /* Success.  */
   return 0;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/feholdexcpt.c libc-20030708/sysdeps/i386/fpu/feholdexcpt.c
--- glibc-2.3.2/sysdeps/i386/fpu/feholdexcpt.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/feholdexcpt.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Store current floating-point environment and clear exceptions.
-   Copyright (C) 1997, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -19,6 +19,9 @@
    02111-1307 USA.  */
 
 #include <fenv.h>
+#include <unistd.h>
+#include <ldsodefs.h>
+#include <dl-procinfo.h>
 
 int
 feholdexcept (fenv_t *envp)
@@ -32,5 +35,19 @@
   work = envp->__control_word | 0x3f;
   __asm__ ("fldcw %0" : : "m" (*&work));
 
+  /* If the CPU supports SSE we set the MXCSR as well.  */
+  if ((GL(dl_hwcap_mask) & HWCAP_I386_XMM) != 0)
+    {
+      unsigned int xwork;
+
+      /* Get the current control word.  */
+      __asm__ ("stmxcsr %0" : "=m" (*&xwork));
+
+      /* Set all exceptions to non-stop.  */
+      xwork |= 0x1f80;
+
+      __asm__ ("ldmxcsr %0" : : "m" (*&xwork));
+    }
+
   return 0;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/fesetround.c libc-20030708/sysdeps/i386/fpu/fesetround.c
--- glibc-2.3.2/sysdeps/i386/fpu/fesetround.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/fesetround.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Set current rounding direction.
-   Copyright (C) 1997 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -19,6 +19,9 @@
    02111-1307 USA.  */
 
 #include <fenv.h>
+#include <unistd.h>
+#include <ldsodefs.h>
+#include <dl-procinfo.h>
 
 int
 fesetround (int round)
@@ -34,5 +37,16 @@
   cw |= round;
   __asm__ ("fldcw %0" : : "m" (*&cw));
 
+  /* If the CPU supports SSE we set the MXCSR as well.  */
+  if ((GL(dl_hwcap_mask) & HWCAP_I386_XMM) != 0)
+    {
+      unsigned int xcw;
+
+      __asm__ ("stmxcsr %0" : "=m" (*&xcw));
+      xcw &= ~0x6000;
+      xcw |= round << 3;
+      __asm__ ("ldmxcsr %0" : : "m" (*&xcw));
+    }
+
   return 0;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/ftestexcept.c libc-20030708/sysdeps/i386/fpu/ftestexcept.c
--- glibc-2.3.2/sysdeps/i386/fpu/ftestexcept.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/ftestexcept.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Test exception in current environment.
-   Copyright (C) 1997 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -19,14 +19,22 @@
    02111-1307 USA.  */
 
 #include <fenv.h>
+#include <unistd.h>
+#include <dl-procinfo.h>
+#include <ldsodefs.h>
 
 int
 fetestexcept (int excepts)
 {
   int temp;
+  int xtemp = 0;
 
   /* Get current exceptions.  */
   __asm__ ("fnstsw %0" : "=a" (temp));
 
-  return temp & excepts & FE_ALL_EXCEPT;
+  /* If the CPU supports SSE we test the MXCSR as well.  */
+  if ((GL(dl_hwcap_mask) & HWCAP_I386_XMM) != 0)
+    __asm__ ("stmxcsr %0" : "=m" (*&xtemp));
+
+  return (temp | xtemp) & excepts & FE_ALL_EXCEPT;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/fpu/libm-test-ulps libc-20030708/sysdeps/i386/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/i386/fpu/libm-test-ulps	2003-02-28 07:27:36.000000000 +0900
+++ libc-20030708/sysdeps/i386/fpu/libm-test-ulps	2003-03-22 15:14:23.000000000 +0900
@@ -121,7 +121,7 @@
 ldouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 ildouble: 1
@@ -136,7 +136,7 @@
 ldouble: 1
 
 # ccosh
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 double: 1
 float: 1
 idouble: 1
@@ -181,7 +181,7 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 idouble: 1
 ildouble: 1
@@ -343,10 +343,10 @@
 ifloat: 1
 
 # csinh
-Test "Real part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Real part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 float: 1
 idouble: 1
@@ -363,10 +363,12 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
+double: 1
+idouble: 1
 ildouble: 439
 ldouble: 439
-Test "Imaginary part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Imaginary part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 float: 1
 ifloat: 1
 ildouble: 2
@@ -381,10 +383,10 @@
 ldouble: 3
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 ildouble: 5
 ldouble: 5
-Test "Imaginary part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Imaginary part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 float: 1
 ifloat: 1
 ildouble: 25
@@ -624,12 +626,12 @@
 idouble: 1
 ildouble: 1
 ldouble: 1
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 float: 1
 ifloat: 1
 double: 1
 idouble: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -693,7 +695,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
@@ -1057,11 +1059,15 @@
 ldouble: 2
 
 Function: Real part of "ctan":
+double: 1
+idouble: 1
 ildouble: 439
 ldouble: 439
 
 Function: Imaginary part of "ctan":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
 ildouble: 3
 ldouble: 3
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i486/atomicity.h libc-20030708/sysdeps/i386/i486/atomicity.h
--- glibc-2.3.2/sysdeps/i386/i486/atomicity.h	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i486/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,57 +0,0 @@
-/* Low-level functions for atomic operations.  ix86 version, x >= 4.
-   Copyright (C) 1997, 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-
-static inline uint32_t
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, uint32_t val)
-{
-  register uint32_t result;
-  __asm__ __volatile__ ("lock; xaddl %0,%1"
-			: "=r" (result), "=m" (*mem) : "0" (val), "1" (*mem));
-  return result;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  __asm__ __volatile__ ("lock; addl %1,%0"
-			: "=m" (*mem) : "ir" (val), "0" (*mem));
-}
-
-static inline char
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  char ret;
-  long int readval;
-
-  __asm__ __volatile__ ("lock; cmpxchgl %3, %1; sete %0"
-                        : "=q" (ret), "=m" (*p), "=a" (readval)
-                        : "r" (newval), "1" (*p), "a" (oldval));
-  return ret;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i486/bits/atomic.h libc-20030708/sysdeps/i386/i486/bits/atomic.h
--- glibc-2.3.2/sysdeps/i386/i486/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/i386/i486/bits/atomic.h	2003-05-12 01:30:11.000000000 +0900
@@ -0,0 +1,359 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+
+#ifndef LOCK_PREFIX
+# ifdef UP
+#  define LOCK_PREFIX	/* nothing */
+# else
+#  define LOCK_PREFIX "lock;"
+# endif
+#endif
+
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchgb %b2, %1"			      \
+		       : "=a" (ret), "=m" (*mem)			      \
+		       : "q" (newval), "m" (*mem), "0" (oldval));	      \
+     ret; })
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchgw %w2, %1"			      \
+		       : "=a" (ret), "=m" (*mem)			      \
+		       : "r" (newval), "m" (*mem), "0" (oldval));	      \
+     ret; })
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchgl %2, %1"			      \
+		       : "=a" (ret), "=m" (*mem)			      \
+		       : "r" (newval), "m" (*mem), "0" (oldval));	      \
+     ret; })
+
+/* XXX We do not really need 64-bit compare-and-exchange.  At least
+   not in the moment.  Using it would mean causing portability
+   problems since not many other 32-bit architectures have support for
+   such an operation.  So don't define any code for now.  If it is
+   really going to be used the code below can be used on Intel Pentium
+   and later, but NOT on i486.  */
+#if 1
+# define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret = *(mem); abort (); ret = (newval); ret = (oldval); })
+#else
+# ifdef __PIC__
+#  define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile ("xchgl %2, %%ebx\n\t"				      \
+		       LOCK_PREFIX "cmpxchg8b %1\n\t"			      \
+		       "xchgl %2, %%ebx"				      \
+		       : "=A" (ret), "=m" (*mem)			      \
+		       : "DS" (((unsigned long long int) (newval))	      \
+			       & 0xffffffff),				      \
+			 "c" (((unsigned long long int) (newval)) >> 32),     \
+			 "m" (*mem), "a" (((unsigned long long int) (oldval)) \
+					  & 0xffffffff),		      \
+			 "d" (((unsigned long long int) (oldval)) >> 32));    \
+     ret; })
+# else
+#  define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchg8b %1"			      \
+		       : "=A" (ret), "=m" (*mem)			      \
+		       : "b" (((unsigned long long int) (newval))	      \
+			      & 0xffffffff),				      \
+			 "c" (((unsigned long long int) (newval)) >> 32),     \
+			 "m" (*mem), "a" (((unsigned long long int) (oldval)) \
+					  & 0xffffffff),		      \
+			 "d" (((unsigned long long int) (oldval)) >> 32));    \
+     ret; })
+# endif
+#endif
+
+
+/* Note that we need no lock prefix.  */
+#define atomic_exchange_acq(mem, newvalue) \
+  ({ __typeof (*mem) result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile ("xchgb %b0, %1"				      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (newvalue), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile ("xchgw %w0, %1"				      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (newvalue), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile ("xchgl %0, %1"					      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (newvalue), "m" (*mem));			      \
+     else								      \
+       {								      \
+	 result = 0;							      \
+	 abort ();							      \
+       }								      \
+     result; })
+
+
+#define atomic_exchange_and_add(mem, value) \
+  ({ __typeof (*mem) result;						      \
+     __typeof (value) addval = (value);					      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "xaddb %b0, %1"			      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (addval), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "xaddw %w0, %1"			      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (addval), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "xaddl %0, %1"			      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (addval), "m" (*mem));			      \
+     else								      \
+       {								      \
+	 __typeof (mem) memp = (mem);					      \
+	 do								      \
+	   result = *memp;						      \
+	 while (__arch_compare_and_exchange_val_64_acq (memp,		      \
+							result + addval,      \
+							result) == result);   \
+       }								      \
+     result; })
+
+
+#define atomic_add(mem, value) \
+  (void) ({ if (__builtin_constant_p (value) && (value) == 1)		      \
+	      atomic_increment (mem);					      \
+	    else if (__builtin_constant_p (value) && (value) == 1)	      \
+	      atomic_decrement (mem);					      \
+	    else if (sizeof (*mem) == 1)				      \
+	      __asm __volatile (LOCK_PREFIX "addb %b1, %0"		      \
+				: "=m" (*mem)				      \
+				: "ir" (value), "m" (*mem));		      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "addw %w1, %0"		      \
+				: "=m" (*mem)				      \
+				: "ir" (value), "m" (*mem));		      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "addl %1, %0"		      \
+				: "=m" (*mem)				      \
+				: "ir" (value), "m" (*mem));		      \
+	    else							      \
+	      {								      \
+		__typeof (value) addval = (value);			      \
+		__typeof (*mem) oldval;					      \
+		__typeof (mem) memp = (mem);				      \
+		do							      \
+		  oldval = *memp;					      \
+		while (__arch_compare_and_exchange_val_64_acq		      \
+		       (memp, oldval + addval, oldval) == oldval);	      \
+	      }								      \
+	    })
+
+
+#define atomic_add_negative(mem, value) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "addb %b2, %0; sets %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "iq" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "addw %w2, %0; sets %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "addl %2, %0; sets %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else								      \
+       abort ();							      \
+     __result; })
+
+
+#define atomic_add_zero(mem, value) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "addb %b2, %0; setz %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "addw %w2, %0; setz %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "addl %2, %0; setz %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else								      \
+       abort ();							      \
+     __result; })
+
+
+#define atomic_increment(mem) \
+  (void) ({ if (sizeof (*mem) == 1)					      \
+	      __asm __volatile (LOCK_PREFIX "incb %b0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "incw %w0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "incl %0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else							      \
+	      {								      \
+		__typeof (*mem) oldval;					      \
+		__typeof (mem) memp = (mem);				      \
+		do							      \
+		  oldval = *memp;					      \
+		while (__arch_compare_and_exchange_val_64_acq		      \
+		       (memp, oldval + 1, oldval) == oldval);		      \
+	      }								      \
+	    })
+
+
+#define atomic_increment_and_test(mem) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "incb %0; sete %b1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "incw %0; sete %w1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "incl %0; sete %1"			      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else								      \
+       abort ();							      \
+     __result; })
+
+
+#define atomic_decrement(mem) \
+  (void) ({ if (sizeof (*mem) == 1)					      \
+	      __asm __volatile (LOCK_PREFIX "decb %b0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "decw %w0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "decl %0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else							      \
+	      {								      \
+		__typeof (*mem) oldval;					      \
+		__typeof (mem) memp = (mem);				      \
+		do							      \
+		  oldval = *memp;					      \
+		while (__arch_compare_and_exchange_val_64_acq		      \
+		       (memp, oldval - 1, oldval) == oldval); 		      \
+	      }								      \
+	    })
+
+
+#define atomic_decrement_and_test(mem) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "decb %b0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "decw %w0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "decl %0; sete %1"			      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else								      \
+       abort ();							      \
+     __result; })
+
+
+#define atomic_bit_set(mem, bit) \
+  (void) ({ if (sizeof (*mem) == 1)					      \
+	      __asm __volatile (LOCK_PREFIX "orb %b2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "ir" (1 << (bit)));	      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "orw %w2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "ir" (1 << (bit)));	      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "orl %2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "ir" (1 << (bit)));	      \
+	    else							      \
+	      abort ();							      \
+	    })
+
+
+#define atomic_bit_test_set(mem, bit) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "btsb %3, %1; setc %0"		      \
+			 : "=q" (__result), "=m" (*mem)			      \
+			 : "m" (*mem), "ir" (bit));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "btsw %3, %1; setc %0"		      \
+			 : "=q" (__result), "=m" (*mem)			      \
+			 : "m" (*mem), "ir" (bit));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "btsl %3, %1; setc %0"		      \
+			 : "=q" (__result), "=m" (*mem)			      \
+			 : "m" (*mem), "ir" (bit));			      \
+     else							      	      \
+       abort ();							      \
+     __result; })
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i486/strcat.S libc-20030708/sysdeps/i386/i486/strcat.S
--- glibc-2.3.2/sysdeps/i386/i486/strcat.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i486/strcat.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* strcat(dest, src) -- Append SRC on the end of DEST.
    For Intel 80x86, x>=4.
-   Copyright (C) 1994, 1995, 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994,1995,1996,1997,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@ipd.info.uni-karlsruhe.de>.
    Optimised a little by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>
@@ -267,3 +267,4 @@
 	LEAVE
 	RET_PTR
 END (BP_SYM (strcat))
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i486/string-inlines.c libc-20030708/sysdeps/i386/i486/string-inlines.c
--- glibc-2.3.2/sysdeps/i386/i486/string-inlines.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/i386/i486/string-inlines.c	2003-04-30 07:49:22.000000000 +0900
@@ -0,0 +1,65 @@
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*  <bits/string.h> and <bits/string2.h> declare some extern inline
+    functions.  These functions are declared additionally here if
+    inlining is not possible.  */
+
+#undef __USE_STRING_INLINES
+#define __USE_STRING_INLINES
+#define _FORCE_INLINES
+#define __STRING_INLINE /* empty */
+#define __NO_INLINE__
+
+/* This is to avoid PLT entries for the x86 version.  */
+#define __memcpy_g __memcpy_g_internal
+#define __strchr_g __strchr_g_internal
+
+#include <string.h>
+#undef index
+#undef rindex
+
+#undef __NO_INLINE__
+#include <bits/string.h>
+#include <bits/string2.h>
+
+void *
+(__memcpy_c) (void *d, const void *s, size_t n)
+{
+  return memcpy (d, s, n);
+}
+
+void *
+__memset_cc (void *s, unsigned long int pattern, size_t n)
+{
+  return memset (s, pattern & 0xff, n);
+}
+strong_alias (__memset_cc, __memset_cg)
+
+void *
+__memset_gg (void *s, char c, size_t n)
+{
+  return memset (s, c, n);
+}
+
+#ifdef __memcpy_c
+# undef __memcpy_g
+strong_alias (__memcpy_g_internal, __memcpy_g)
+# undef __strchr_g
+strong_alias (__strchr_g_internal, __strchr_g)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i486/strlen.S libc-20030708/sysdeps/i386/i486/strlen.S
--- glibc-2.3.2/sysdeps/i386/i486/strlen.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i486/strlen.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* strlen(str) -- determine the length of the string STR.
    Optimized for Intel 80x86, x>=4.
-   Copyright (C) 1991, 92, 93, 94, 95, 96, 97, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1991-1997, 2000, 2003 Free Software Foundation, Inc.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>.
    This file is part of the GNU C Library.
 
@@ -136,3 +136,4 @@
 	LEAVE
 	ret
 END (BP_SYM (strlen))
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i586/memcpy.S libc-20030708/sysdeps/i386/i586/memcpy.S
--- glibc-2.3.2/sysdeps/i386/i586/memcpy.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i586/memcpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Highly optimized version for i586.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -116,3 +116,4 @@
 	LEAVE
 	RET_PTR
 END (BP_SYM (memcpy))
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i586/memset.S libc-20030708/sysdeps/i386/i586/memset.S
--- glibc-2.3.2/sysdeps/i386/i586/memset.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i586/memset.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* memset/bzero -- set memory area to CH/0
    Highly optimized version for ix86, x>=5.
-   Copyright (C) 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Torbjorn Granlund, <tege@matematik.su.se>
 
@@ -114,3 +114,4 @@
 	RET_PTR
 #endif
 END (BP_SYM (memset))
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i586/strchr.S libc-20030708/sysdeps/i386/i586/strchr.S
--- glibc-2.3.2/sysdeps/i386/i586/strchr.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i586/strchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Find character CH in a NUL terminated string.
    Highly optimized version for ix85, x>=5.
-   Copyright (C) 1995, 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1995, 1996, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper, <drepper@gnu.ai.mit.edu>.
 
@@ -339,3 +339,4 @@
 
 #undef index
 weak_alias (BP_SYM (strchr), BP_SYM (index))
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i586/strcpy.S libc-20030708/sysdeps/i386/i586/strcpy.S
--- glibc-2.3.2/sysdeps/i386/i586/strcpy.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i586/strcpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* strcpy/stpcpy implementation for i586.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -159,3 +159,6 @@
 	LEAVE
 	RET_PTR
 END (BP_SYM (STRCPY))
+#ifndef USE_AS_STPCPY
+libc_hidden_builtin_def (strcpy)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i586/strlen.S libc-20030708/sysdeps/i386/i586/strlen.S
--- glibc-2.3.2/sysdeps/i386/i586/strlen.S	2002-03-12 10:28:49.000000000 +0900
+++ libc-20030708/sysdeps/i386/i586/strlen.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* strlen -- Compute length of NUL terminated string.
    Highly optimized version for ix86, x>=5.
-   Copyright (C) 1995, 1996, 1997, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995,1996,1997,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper, <drepper@gnu.ai.mit.edu>.
 
@@ -186,3 +186,4 @@
 	LEAVE
 	ret
 END (BP_SYM (strlen))
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i686/dl-hash.h libc-20030708/sysdeps/i386/i686/dl-hash.h
--- glibc-2.3.2/sysdeps/i386/i686/dl-hash.h	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i686/dl-hash.h	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Compute hash alue for given string according to ELF standard.
-   Copyright (C) 1998 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -26,7 +26,7 @@
    optimized for the PII processors.  Though it will run on i586 it
    would be much slower than the generic C implementation.  So don't
    use it.  */
-static inline unsigned int
+static unsigned int
 _dl_elf_hash (const unsigned char *name)
 {
   unsigned int result;
@@ -71,10 +71,9 @@
      "jnz 2b\n"
      "1:\t"
      : "=&r" (result), "=r" (name), "=&c" (temp0), "=&r" (temp1)
-     : "0" (0), "1" (name));		
+     : "0" (0), "1" (name));
 
   return result;
 }
 
 #endif /* dl-hash.h */
-
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i686/hp-timing.h libc-20030708/sysdeps/i386/i686/hp-timing.h
--- glibc-2.3.2/sysdeps/i386/i686/hp-timing.h	2002-02-01 15:34:46.000000000 +0900
+++ libc-20030708/sysdeps/i386/i686/hp-timing.h	2003-04-28 23:53:24.000000000 +0900
@@ -1,5 +1,5 @@
 /* High precision, low overhead timing functions.  i686 version.
-   Copyright (C) 1998, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -149,7 +149,7 @@
   do {									      \
     char __buf[20];							      \
     char *__cp = _itoa (Val, __buf + sizeof (__buf), 10, 0);		      \
-    int __len = (Len);							      \
+    size_t __len = (Len);						      \
     char *__dest = (Buf);						      \
     while (__len-- > 0 && __cp < __buf + sizeof (__buf))		      \
       *__dest++ = *__cp++;						      \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i686/memcpy.S libc-20030708/sysdeps/i386/i686/memcpy.S
--- glibc-2.3.2/sysdeps/i386/i686/memcpy.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i686/memcpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,7 +1,7 @@
 /* Copy memory block and return pointer to beginning of destination block
    For Intel 80x86, x>=6.
    This file is part of the GNU C Library.
-   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1999.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -59,3 +59,4 @@
 	LEAVE
 	RET_PTR
 END (BP_SYM (memcpy))
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i686/memmove.S libc-20030708/sysdeps/i386/i686/memmove.S
--- glibc-2.3.2/sysdeps/i386/i686/memmove.S	2003-02-04 16:11:27.000000000 +0900
+++ libc-20030708/sysdeps/i386/i686/memmove.S	2003-05-02 00:11:51.000000000 +0900
@@ -92,3 +92,4 @@
 	LEAVE
 	RET_PTR
 END (BP_SYM (memmove))
+libc_hidden_builtin_def (memmove)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i686/memset.S libc-20030708/sysdeps/i386/i686/memset.S
--- glibc-2.3.2/sysdeps/i386/i686/memset.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/i686/memset.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* memset/bzero -- set memory area to CH/0
    Highly optimized version for ix86, x>=6.
-   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1999.
 
@@ -93,3 +93,4 @@
 	RET_PTR
 #endif
 END (BP_SYM (memset))
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/i686/strcmp.S libc-20030708/sysdeps/i386/i686/strcmp.S
--- glibc-2.3.2/sysdeps/i386/i686/strcmp.S	2002-03-12 10:28:14.000000000 +0900
+++ libc-20030708/sysdeps/i386/i686/strcmp.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Highly optimized version for ix86, x>=6.
-   Copyright (C) 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1999.
 
@@ -69,3 +69,4 @@
 	LEAVE
 	ret
 END (BP_SYM (strcmp))
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/memchr.S libc-20030708/sysdeps/i386/memchr.S
--- glibc-2.3.2/sysdeps/i386/memchr.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/memchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,7 +1,7 @@
 /* memchr (str, chr, len) -- Return pointer to first occurrence of CHR in STR less
    than LEN.
    For Intel 80x86, x>=3.
-   Copyright (C) 1994, 1995, 1996, 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994-1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>
    Optimised a little by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>
@@ -330,3 +330,4 @@
 #if !__BOUNDED_POINTERS__
 weak_alias (__memchr, __ubp_memchr)
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/memset.c libc-20030708/sysdeps/i386/memset.c
--- glibc-2.3.2/sysdeps/i386/memset.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/memset.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Set a block of memory to some byte value.
    For Intel 80x86, x>=3.
-   Copyright (C) 1991, 1992, 1993, 1997, 1998 Free Software Foundation, Inc.
+   Copyright (C) 1991,1992,1993,1997,1998,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Torbjorn Granlund (tege@sics.se).
 
@@ -79,6 +79,7 @@
 
   return dstpp;
 }
+libc_hidden_builtin_def (memset)
 
 #else
 #include <sysdeps/generic/memset.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/strchr.S libc-20030708/sysdeps/i386/strchr.S
--- glibc-2.3.2/sysdeps/i386/strchr.S	2002-08-12 09:17:45.000000000 +0900
+++ libc-20030708/sysdeps/i386/strchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* strchr (str, ch) -- Return pointer to first occurrence of CH in STR.
    For Intel 80x86, x>=3.
-   Copyright (C) 1994, 1995, 1996, 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1994-1997,1999,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>
    Some optimisations by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>
@@ -289,3 +289,4 @@
 END (BP_SYM (strchr))
 
 weak_alias (BP_SYM (strchr), BP_SYM (index))
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/strcspn.S libc-20030708/sysdeps/i386/strcspn.S
--- glibc-2.3.2/sysdeps/i386/strcspn.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/strcspn.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,7 +1,7 @@
 /* strcspn (str, ss) -- Return the length of the initial segment of STR
 			which contains no characters from SS.
    For Intel 80x86, x>=3.
-   Copyright (C) 1994, 1995, 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994,1995,1996,1997,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>
    Bug fixes by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>
@@ -179,3 +179,4 @@
 	LEAVE
 	ret
 END (BP_SYM (strcspn))
+libc_hidden_builtin_def (strcspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/string-inlines.c libc-20030708/sysdeps/i386/string-inlines.c
--- glibc-2.3.2/sysdeps/i386/string-inlines.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/i386/string-inlines.c	2003-04-30 07:49:14.000000000 +0900
@@ -0,0 +1,189 @@
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*  <bits/string.h> and <bits/string2.h> declare some extern inline
+    functions.  These functions are declared additionally here if
+    inlining is not possible.  */
+
+#undef __USE_STRING_INLINES
+#define __USE_STRING_INLINES
+#define _FORCE_INLINES
+#define __STRING_INLINE /* empty */
+#define __NO_INLINE__
+
+#include <string.h>
+#undef index
+#undef rindex
+
+#undef __NO_INLINE__
+#include <bits/string.h>
+#include <bits/string2.h>
+
+/* Functions which are inlines in i486 but not i386.  */
+void *
+__memcpy_by2 (void *dest, const void *src, size_t n)
+{
+  return memcpy (dest, src, n);
+}
+strong_alias (__memcpy_by2, __memcpy_by4)
+strong_alias (__memcpy_by2, __memcpy_g)
+strong_alias (__memcpy_by2, __memcpy_g_internal)
+
+void *
+__memset_ccn_by2 (void *s, unsigned int c, size_t n)
+{
+  return memset (s, c & 0xff, n);
+}
+strong_alias (__memset_ccn_by2, __memset_ccn_by4)
+
+void *
+__memset_gcn_by2 (void *s, int c, size_t n)
+{
+  return memset (s, c, n);
+}
+strong_alias (__memset_gcn_by2, __memset_gcn_by4)
+
+size_t
+__strlen_g (const char *s)
+{
+  return strlen (s);
+}
+
+char *
+__strcpy_g (char *d, const char *s)
+{
+  return strcpy (d, s);
+}
+
+char *
+__mempcpy_by2 (char *d, const char *s, size_t n)
+{
+  return mempcpy (d, s, n);
+}
+strong_alias (__mempcpy_by2, __mempcpy_by4)
+strong_alias (__mempcpy_by2, __mempcpy_byn)
+
+char *
+__stpcpy_g (char *d, const char *s)
+{
+  return stpcpy (d, s);
+}
+
+char *
+__strncpy_by2 (char *d, const char s[], size_t srclen, size_t n)
+{
+  return strncpy (d, s, n);
+}
+strong_alias (__strncpy_by2, __strncpy_by4)
+strong_alias (__strncpy_by2, __strncpy_byn)
+
+char *
+__strncpy_gg (char *d, const char *s, size_t n)
+{
+  return strncpy (d, s, n);
+}
+
+char *
+__strcat_c (char *d, const char s[], size_t srclen)
+{
+  return strcat (d, s);
+}
+
+char *
+__strcat_g (char *d, const char *s)
+{
+  return strcat (d, s);
+}
+
+char *
+__strncat_g (char *d, const char s[], size_t n)
+{
+  return strncat (d, s, n);
+}
+
+int
+__strcmp_gg (const char *s1, const char *s2)
+{
+  return strcmp (s1, s2);
+}
+
+int
+__strncmp_g (const char *s1, const char *s2, size_t n)
+{
+  return strncmp (s1, s2, n);
+}
+
+char *
+__strrchr_c (const char *s, int c)
+{
+  return strrchr (s, c >> 8);
+}
+
+char *
+__strrchr_g (const char *s, int c)
+{
+  return strrchr (s, c);
+}
+
+size_t
+__strcspn_cg (const char *s, const char reject[], size_t reject_len)
+{
+  return strcspn (s, reject);
+}
+
+size_t
+__strcspn_g (const char *s, const char *reject)
+{
+  return strcspn (s, reject);
+}
+
+size_t
+__strspn_cg (const char *s, const char accept[], size_t accept_len)
+{
+  return strspn (s, accept);
+}
+
+size_t
+__strspn_g (const char *s, const char *accept)
+{
+  return strspn (s, accept);
+}
+
+char *
+__strpbrk_cg (const char *s, const char accept[], size_t accept_len)
+{
+  return strpbrk (s, accept);
+}
+
+char *
+__strpbrk_g (const char *s, const char *accept)
+{
+  return strpbrk (s, accept);
+}
+
+char *
+__strstr_cg (const char *haystack, const char needle[], size_t needle_len)
+{
+  return strstr (haystack, needle);
+}
+
+char *
+__strstr_g (const char *haystack, const char needle[])
+{
+  return strstr (haystack, needle);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/strlen.c libc-20030708/sysdeps/i386/strlen.c
--- glibc-2.3.2/sysdeps/i386/strlen.c	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/strlen.c	2003-05-02 00:11:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Determine the length of a string.  For Intel 80x86, x>=3.
-   Copyright (C) 1991, 1992, 1993, 1996, 1997 Free Software Foundation, Inc.
+   Copyright (C) 1991,1992,1993,1996,1997,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Torbjorn Granlund (tege@sics.se).
 
@@ -33,3 +33,4 @@
 
   return -2 - cnt;
 }
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/strpbrk.S libc-20030708/sysdeps/i386/strpbrk.S
--- glibc-2.3.2/sysdeps/i386/strpbrk.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/strpbrk.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,7 +1,7 @@
 /* strcspn (str, ss) -- Return the length of the initial segement of STR
 			which contains no characters from SS.
    For Intel 80x86, x>=3.
-   Copyright (C) 1994, 1995, 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994-1997, 2000, 2003 Free Software Foundation, Inc.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>
    Bug fixes by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>
    This file is part of the GNU C Library.
@@ -188,3 +188,4 @@
 	LEAVE
 	RET_PTR
 END (BP_SYM (strpbrk))
+libc_hidden_builtin_def (strpbrk)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/strrchr.S libc-20030708/sysdeps/i386/strrchr.S
--- glibc-2.3.2/sysdeps/i386/strrchr.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/strrchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* strrchr (str, ch) -- Return pointer to last occurrence of CH in STR.
    For Intel 80x86, x>=3.
-   Copyright (C) 1994, 1995, 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994-1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>
    Some optimisations by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>
@@ -331,3 +331,4 @@
 END (BP_SYM (strrchr))
 
 weak_alias (BP_SYM (strrchr), BP_SYM (rindex))
+libc_hidden_builtin_def (strrchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/strspn.S libc-20030708/sysdeps/i386/strspn.S
--- glibc-2.3.2/sysdeps/i386/strspn.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/i386/strspn.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,7 +1,7 @@
 /* strcspn (str, ss) -- Return the length of the initial segment of STR
 			which contains only characters from SS.
    For Intel 80x86, x>=3.
-   Copyright (C) 1994, 1995, 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1994-1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>
    Bug fixes by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>
@@ -179,3 +179,4 @@
 	LEAVE
 	ret
 END (BP_SYM (strspn))
+libc_hidden_builtin_def (strspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/i386/sysdep.h libc-20030708/sysdeps/i386/sysdep.h
--- glibc-2.3.2/sysdeps/i386/sysdep.h	2003-01-10 04:43:34.000000000 +0900
+++ libc-20030708/sysdeps/i386/sysdep.h	2003-03-10 18:10:46.000000000 +0900
@@ -64,6 +64,14 @@
   ASM_SIZE_DIRECTIVE(name)						      \
   STABS_FUN_END(name)
 
+#ifdef HAVE_CPP_ASM_DEBUGINFO
+/* Disable that goop, because we just pass -g through to the assembler
+   and it generates proper line number information directly.  */
+# define STABS_CURRENT_FILE1(name)
+# define STABS_CURRENT_FILE(name)
+# define STABS_FUN(name)
+# define STABS_FUN_END(name)
+#else
 /* Remove the following two lines once the gdb bug is fixed.  */
 #define STABS_CURRENT_FILE(name)					      \
   STABS_CURRENT_FILE1 (#name)
@@ -77,6 +85,7 @@
   .stabs #namestr,36,0,0,name;
 #define STABS_FUN_END(name)						      \
   1: .stabs "",36,0,0,1b-name;
+#endif
 
 /* If compiled for profiling, call `mcount' at the start of each function.  */
 #ifdef	PROF
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/atomicity.h libc-20030708/sysdeps/ia64/atomicity.h
--- glibc-2.3.2/sysdeps/ia64/atomicity.h	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,48 +0,0 @@
-/* Low-level functions for atomic operations.  IA-64 version.
-   Copyright (C) 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-#include <ia64intrin.h>
-
-
-static inline uint32_t
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, uint32_t val)
-{
-  return __sync_fetch_and_add (mem, val);
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  __sync_fetch_and_add (mem, val);
-}
-
-static inline int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  return __sync_bool_compare_and_swap (p, oldval, newval);
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/bits/atomic.h libc-20030708/sysdeps/ia64/bits/atomic.h
--- glibc-2.3.2/sysdeps/ia64/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/ia64/bits/atomic.h	2003-07-08 22:58:10.000000000 +0900
@@ -0,0 +1,126 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+#include <ia64intrin.h>
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+
+#define __arch_compare_and_exchange_bool_8_acq(mem, newval, oldval) \
+  (abort (), 0)
+
+#define __arch_compare_and_exchange_bool_16_acq(mem, newval, oldval) \
+  (abort (), 0)
+
+#define __arch_compare_and_exchange_bool_32_acq(mem, newval, oldval) \
+  (!__sync_bool_compare_and_swap_si ((int *) (mem), (int) (long) (oldval), \
+				     (int) (long) (newval)))
+
+#define __arch_compare_and_exchange_bool_64_acq(mem, newval, oldval) \
+  (!__sync_bool_compare_and_swap_di ((long *) (mem), (long) (oldval), \
+				     (long) (newval)))
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+  __sync_val_compare_and_swap_si ((int *) (mem), (int) (long) (oldval), \
+				  (int) (long) (newval))
+
+#define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  __sync_val_compare_and_swap_di ((long *) (mem), (long) (oldval), \
+				  (long) (newval))
+
+/* Atomically store newval and return the old value.  */
+#define atomic_exchange_acq(mem, value) \
+  __sync_lock_test_and_set (mem, value)
+
+#define atomic_exchange_rel(mem, value) \
+  (__sync_synchronize (), __sync_lock_test_and_set (mem, value))
+
+
+#define atomic_exchange_and_add(mem, value) \
+  ({ __typeof (*mem) __result;						      \
+     if (sizeof (*mem) == 4)						      \
+       __result = __sync_fetch_and_add_si ((int *) (mem), (int) (value));     \
+     else if (sizeof (*mem) == 8)					      \
+       __result = __sync_fetch_and_add_di ((long *) (mem), (long) (value));   \
+     else								      \
+       abort ();							      \
+     __result; })
+
+#define atomic_decrement_if_positive(mem) \
+  ({ __typeof (*mem) __oldval, __val;					      \
+     __typeof (mem) __memp = (mem);					      \
+									      \
+     __val = (*__memp);							      \
+     do									      \
+       {								      \
+	 __oldval = __val;						      \
+	 if (__builtin_expect (__val <= 0, 0))				      \
+	   break;							      \
+	 __val = atomic_compare_and_exchange_val_acq (__memp,	__oldval - 1, \
+						      __oldval);	      \
+       }								      \
+     while (__builtin_expect (__val != __oldval, 0));			      \
+     __oldval; })
+
+#define atomic_bit_test_set(mem, bit) \
+  ({ __typeof (*mem) __oldval, __val;					      \
+     __typeof (mem) __memp = (mem);					      \
+     __typeof (*mem) __mask = ((__typeof (*mem)) 1 << (bit));		      \
+									      \
+     __val = (*__memp);							      \
+     do									      \
+       {								      \
+	 __oldval = __val;						      \
+	 __val = atomic_compare_and_exchange_val_acq (__memp,		      \
+						      __oldval | __mask,      \
+						      __oldval);	      \
+       }								      \
+     while (__builtin_expect (__val != __oldval, 0));			      \
+     __oldval & __mask; })
+
+#define atomic_full_barrier() __sync_synchronize ()
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/dl-fptr.c libc-20030708/sysdeps/ia64/dl-fptr.c
--- glibc-2.3.2/sysdeps/ia64/dl-fptr.c	2002-11-14 06:41:52.000000000 +0900
+++ libc-20030708/sysdeps/ia64/dl-fptr.c	1970-01-01 09:00:00.000000000 +0900
@@ -1,288 +0,0 @@
-/* Manage function descriptors.  IA-64 version.
-   Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <ia64intrin.h>
-#include <unistd.h>
-#include <string.h>
-#include <sys/param.h>
-#include <sys/mman.h>
-#include <link.h>
-#include <ldsodefs.h>
-#include <elf/dynamic-link.h>
-#include <dl-machine.h>
-#ifdef _LIBC_REENTRANT
-# include <ia64intrin.h>
-# include <signal.h>
-# include <time.h>
-#endif
-
-Elf64_Addr __ia64_boot_fptr_table[IA64_BOOT_FPTR_TABLE_LEN];
-
-static struct local
-  {
-    struct ia64_fdesc_table *root;
-    struct ia64_fdesc *free_list;
-    unsigned int npages;		/* # of pages to allocate */
-#ifdef _LIBC_REENTRANT
-    volatile int lock;
-    sigset_t full_sigset;
-#endif
-    /* the next to members MUST be consecutive! */
-    struct ia64_fdesc_table boot_table;
-    struct ia64_fdesc boot_fdescs[1024];
-  }
-local =
-  {
-    root: &local.boot_table,
-    npages: 2,
-    boot_table:
-      {
-	len: sizeof (local.boot_fdescs) / sizeof (local.boot_fdescs[0]),
-	first_unused: 0
-      }
-  };
-
-/* Locking is tricky: we may get a signal while holding the lock and
-   the signal handler may end up calling into the dynamic loader
-   again.  Also, if a real-time process spins on the lock, a
-   non-realtime process may never get the chance to release it's lock,
-   unless the realtime process relinquishes the CPU from time to time.
-   Hence we (a) block signals before acquiring the lock and (b) do a
-   nanosleep() when we detect prolongued contention.  */
-#ifdef _LIBC_REENTRANT
-# define lock(l)						\
-{								\
-  sigset_t _saved_set;						\
-  int i = 10000;						\
-  if (!__sigismember (&(l)->full_sigset, SIGINT))		\
-    __sigfillset (&(l)->full_sigset);				\
-								\
-  while (__sync_lock_test_and_set (&(l)->lock, 1))		\
-    {								\
-      struct timespec ts;					\
-      if (i > 0)						\
-	{							\
-	  --i;							\
-	  continue;						\
-	}							\
-      ts.tv_sec = 0;						\
-      ts.tv_nsec = 1*1000*1000;					\
-      __nanosleep (&ts, NULL);					\
-    }								\
-  __sigprocmask (SIG_BLOCK, &(l)->full_sigset, &_saved_set);
-# define unlock(l)						\
-  __sigprocmask (SIG_SETMASK, &_saved_set, NULL);		\
-  __sync_lock_release (&(l)->lock);				\
-}
-#else
-# define lock(l)
-# define unlock(l)
-#endif
-
-/* Create a new fdesc table and return a pointer to the first fdesc
-   entry.  The fdesc lock must have been acquired already.  */
-
-static struct ia64_fdesc *
-new_fdesc_table (struct local *l)
-{
-  size_t size = l->npages * GL(dl_pagesize);
-  struct ia64_fdesc_table *new_table;
-  struct ia64_fdesc *fdesc;
-
-  l->npages += l->npages;
-  new_table = __mmap (0, size, PROT_READ | PROT_WRITE,
-		      MAP_ANON | MAP_PRIVATE, -1, 0);
-  if (new_table == MAP_FAILED)
-    _dl_signal_error (errno, NULL, NULL, "cannot map pages for fdesc table");
-
-  new_table->len = (size - sizeof (*new_table)) / sizeof (struct ia64_fdesc);
-  fdesc = &new_table->fdesc[0];
-  new_table->first_unused = 1;
-  new_table->next = l->root;
-  l->root = new_table;
-  return fdesc;
-}
-
-static Elf64_Addr
-make_fdesc (Elf64_Addr ip, Elf64_Addr gp)
-{
-  struct ia64_fdesc *fdesc = NULL;
-  struct ia64_fdesc_table *t;
-  unsigned int old;
-  struct local *l;
-
-  asm ("movl %0 = @gprel (local);; add %0 = %0, gp" : "=&r"(l));
-
-  t = l->root;
-  while (1)
-    {
-      old = t->first_unused;
-      if (old >= t->len)
-	break;
-      else if (__sync_bool_compare_and_swap (&t->first_unused, old, old + 1))
-	{
-	  fdesc = &t->fdesc[old];
-	  goto install;
-	}
-    }
-
-  lock (l);
-  {
-    if (l->free_list)
-      {
-	fdesc = l->free_list;		/* get it from free-list */
-	l->free_list = (struct ia64_fdesc *) fdesc->ip;
-      }
-    else
-      fdesc = new_fdesc_table (l);	/* create new fdesc table */
-  }
-  unlock (l);
-
- install:
-  fdesc->ip = ip;
-  fdesc->gp = gp;
-
-  return (Elf64_Addr) fdesc;
-}
-
-static inline Elf64_Addr *
-make_fptr_table (struct link_map *map)
-{
-  const Elf64_Sym *symtab = (const void *) D_PTR (map, l_info[DT_SYMTAB]);
-  const char *strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
-  Elf64_Addr *fptr_table;
-  size_t size;
-  size_t len;
-
-  /* XXX Apparently the only way to find out the size of the dynamic
-     symbol section is to assume that the string table follows right
-     afterwards...  */
-  len = ((strtab - (char *) symtab) / map->l_info[DT_SYMENT]->d_un.d_val);
-  size = ((len * sizeof (fptr_table[0]) + GL(dl_pagesize) - 1)
-	  & -GL(dl_pagesize));
-  /* XXX We don't support here in the moment systems without MAP_ANON.
-     There probably are none for IA-64.  In case this is proven wrong
-     we will have to open /dev/null here and use the file descriptor
-     instead of the hard-coded -1.  */
-  fptr_table = __mmap (NULL, size, PROT_READ | PROT_WRITE,
-		       MAP_ANON | MAP_PRIVATE, -1, 0);
-  if (fptr_table == MAP_FAILED)
-    _dl_signal_error (errno, NULL, NULL, "cannot map pages for fptr table");
-
-  map->l_mach.fptr_table_len = len;
-  map->l_mach.fptr_table = fptr_table;
-  return fptr_table;
-}
-
-Elf64_Addr
-__ia64_make_fptr (struct link_map *map, const Elf64_Sym *sym, Elf64_Addr ip)
-{
-  Elf64_Addr *ftab = map->l_mach.fptr_table;
-  const Elf64_Sym *symtab;
-  Elf_Symndx symidx;
-
-  if (__builtin_expect (!map->l_mach.fptr_table, 0))
-    ftab = make_fptr_table (map);
-
-  symtab = (const void *) D_PTR (map, l_info[DT_SYMTAB]);
-  symidx = sym - symtab;
-
-  if (symidx >= map->l_mach.fptr_table_len)
-    _dl_signal_error (0, NULL, NULL,
-		      "internal error: symidx out of range of fptr table");
-
-  if (!ftab[symidx])
-    {
-      /* GOT has already been relocated in elf_get_dynamic_info -
-	 don't try to relocate it again.  */
-      ftab[symidx] = make_fdesc (ip, map->l_info[DT_PLTGOT]->d_un.d_ptr);
-#if 0
-      {
-	const char *strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
-	struct local *l;
-
-	asm ("addl %0 = @gprel (local), gp" : "=r" (l));
-	if (l->root != &l->boot_table || l->boot_table.first_unused > 20)
-	  _dl_debug_printf ("created fdesc symbol `%s' at %lx\n",
-			    strtab + sym->st_name, ftab[symidx]);
-      }
-#endif
-    }
-
-  return ftab[symidx];
-}
-
-void
-_dl_unmap (struct link_map *map)
-{
-  Elf64_Addr *ftab = map->l_mach.fptr_table;
-  struct ia64_fdesc *head = NULL, *tail = NULL;
-  size_t i;
-
-  __munmap ((void *) map->l_map_start, map->l_map_end - map->l_map_start);
-
-  if (!ftab)
-    return;
-
-  /* String together the fdesc structures that are being freed.  */
-  for (i = 0; i < map->l_mach.fptr_table_len; ++i)
-    {
-      if (ftab[i])
-	{
-	  *(struct ia64_fdesc **) ftab[i] = head;
-	  head = (struct ia64_fdesc *) ftab[i];
-	  if (!tail)
-	    tail = head;
-	}
-    }
-
-  /* Prepend the new list to the free_list: */
-  if (tail)
-    {
-      lock (&local);
-      {
-	*(struct ia64_fdesc **) tail = local.free_list;
-	local.free_list = head;
-      }
-      unlock (&local);
-    }
-
-  __munmap (ftab,
-	    map->l_mach.fptr_table_len * sizeof (map->l_mach.fptr_table[0]));
-  map->l_mach.fptr_table = NULL;
-}
-
-Elf64_Addr
-_dl_lookup_address (const void *address)
-{
-  Elf64_Addr addr = (Elf64_Addr) address;
-  struct ia64_fdesc_table *t;
-  unsigned long int i;
-
-  for (t = local.root; t != NULL; t = t->next)
-    {
-      i = (struct ia64_fdesc *) addr - &t->fdesc[0];
-      if (i < t->first_unused && addr == (Elf64_Addr) &t->fdesc[i])
-	{
-	  addr = t->fdesc[i].ip;
-	  break;
-	}
-    }
-  return addr;
-}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/dl-fptr.h libc-20030708/sysdeps/ia64/dl-fptr.h
--- glibc-2.3.2/sysdeps/ia64/dl-fptr.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/ia64/dl-fptr.h	2003-05-02 11:37:50.000000000 +0900
@@ -0,0 +1,36 @@
+/* Function descriptors.  IA64 version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef dl_ia64_fptr_h
+#define dl_ia64_fptr_h 1
+
+#include <ia64intrin.h>
+#include <sysdeps/generic/dl-fptr.h>
+
+#define COMPARE_AND_SWAP(ptr,old,new)	\
+  __sync_bool_compare_and_swap ((ptr), (old), (new))
+
+/* There are currently 123 dynamic symbols in ld.so.
+   ELF_MACHINE_BOOT_FPTR_TABLE_LEN needs to be at least that big.  */
+#define ELF_MACHINE_BOOT_FPTR_TABLE_LEN	200
+
+#define ELF_MACHINE_LOAD_ADDRESS(var,symbol)	\
+  asm ("addl %0 = @gprel (" #symbol "), gp" : "=r" (var));
+
+#endif /* !dl_ia64_fptr_h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/dl-lookupcfg.h libc-20030708/sysdeps/ia64/dl-lookupcfg.h
--- glibc-2.3.2/sysdeps/ia64/dl-lookupcfg.h	2002-01-30 09:22:50.000000000 +0900
+++ libc-20030708/sysdeps/ia64/dl-lookupcfg.h	2003-03-28 21:28:18.000000000 +0900
@@ -1,5 +1,5 @@
 /* Configuration of lookup functions.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -23,11 +23,13 @@
 #define ELF_FUNCTION_PTR_IS_SPECIAL
 #define DL_UNMAP_IS_SPECIAL
 
+/* We do not support copy relocations for IA-64.  */
+#define DL_NO_COPY_RELOCS
+
 /* Forward declaration.  */
 struct link_map;
 
-extern void *_dl_symbol_address (const struct link_map *map,
-				 const Elf64_Sym *ref);
+extern void *_dl_symbol_address (struct link_map *map, const Elf64_Sym *ref);
 
 #define DL_SYMBOL_ADDRESS(map, ref) _dl_symbol_address(map, ref)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/dl-machine.h libc-20030708/sysdeps/ia64/dl-machine.h
--- glibc-2.3.2/sysdeps/ia64/dl-machine.h	2003-01-12 17:37:35.000000000 +0900
+++ libc-20030708/sysdeps/ia64/dl-machine.h	2003-05-02 14:47:13.000000000 +0900
@@ -26,44 +26,22 @@
 #include <string.h>
 #include <link.h>
 #include <errno.h>
+#include <dl-fptr.h>
 #include <tls.h>
 
 /* Translate a processor specific dynamic tag to the index
    in l_info array.  */
 #define DT_IA_64(x) (DT_IA_64_##x - DT_LOPROC + DT_NUM)
 
-/* There are currently 123 dynamic symbols in ld.so.
-   IA64_BOOT_FPTR_TABLE_LEN needs to be at least that big.  */
-#define IA64_BOOT_FPTR_TABLE_LEN	200
-
-/* An FDESC is a function descriptor.  */
-
-struct ia64_fdesc
-  {
-    Elf64_Addr ip;	/* code entry point */
-    Elf64_Addr gp;	/* global pointer */
-  };
-
-struct ia64_fdesc_table
-  {
-    struct ia64_fdesc_table *next;
-    unsigned int len;			/* # of entries in fdesc table */
-    volatile unsigned int first_unused;	/* index of first available entry */
-    struct ia64_fdesc fdesc[0];
-  };
-
-extern Elf64_Addr __ia64_make_fptr (struct link_map *, const Elf64_Sym *,
-				    Elf64_Addr);
-
 static inline void
 __ia64_init_bootstrap_fdesc_table (struct link_map *map)
 {
   Elf64_Addr *boot_table;
 
   /* careful: this will be called before got has been relocated... */
-  asm (";; addl %0 = @gprel (__ia64_boot_fptr_table), gp" : "=r"(boot_table));
+  asm (";; addl %0 = @gprel (_dl_boot_fptr_table), gp" : "=r"(boot_table));
 
-  map->l_mach.fptr_table_len = IA64_BOOT_FPTR_TABLE_LEN;
+  map->l_mach.fptr_table_len = ELF_MACHINE_BOOT_FPTR_TABLE_LEN;
   map->l_mach.fptr_table = boot_table;
 }
 
@@ -142,7 +120,7 @@
 
       /* This function will be called to perform the relocation.  */
       if (!profile)
-	doit = (Elf64_Addr) ((struct ia64_fdesc *) &_dl_runtime_resolve)->ip;
+	doit = (Elf64_Addr) ((struct fdesc *) &_dl_runtime_resolve)->ip;
       else
 	{
 	  if (_dl_name_match_p (GL(dl_profile), l))
@@ -151,7 +129,7 @@
 		 want profiling and the timers are started.  */
 	      GL(dl_profile_map) = l;
 	    }
-	  doit = (Elf64_Addr) ((struct ia64_fdesc *) &_dl_runtime_profile)->ip;
+	  doit = (Elf64_Addr) ((struct fdesc *) &_dl_runtime_profile)->ip;
 	}
 
       reserve[1] = doit;
@@ -301,8 +279,10 @@
 "_start:\n"								      \
 "0:	{ .mii\n"							      \
 "	  .prologue\n"							      \
-"	  .save ar.pfs, r32\n"						      \
 "	  .save rp, r0\n"						      \
+"	  .body\n"							      \
+"	  .prologue\n"							      \
+"	  .save ar.pfs, r32\n"						      \
 "	  alloc loc0 = ar.pfs, 0, 3, 4, 0\n"				      \
 "	  .body\n"							      \
 "	  mov r2 = ip\n"						      \
@@ -332,8 +312,10 @@
 "	.proc _dl_start_user#\n"					      \
 "_dl_start_user:\n"							      \
 "	 .prologue\n"							      \
-"	 .save ar.pfs, r32\n"						      \
 "	 .save rp, r0\n"						      \
+"	  .body\n"							      \
+"	 .prologue\n"							      \
+"	 .save ar.pfs, r32\n"						      \
 "	 .body\n"							      \
 "	{ .mii\n"							      \
 "	  /* Save the pointer to the user entry point fptr in loc2.  */\n"    \
@@ -575,7 +557,7 @@
 	      return;
 	    }
 	  else if (R_IA64_TYPE (r_type) == R_IA64_TYPE (R_IA64_FPTR64LSB))
-	    value = __ia64_make_fptr (sym_map, sym, value);
+	    value = _dl_make_fptr (sym_map, sym, value);
 	  else if (R_IA64_TYPE (r_type) == R_IA64_TYPE (R_IA64_PCREL64LSB))
 	    value -= (Elf64_Addr) reloc_addr & -16;
 #if defined USE_TLS && (!defined RTLD_BOOTSTRAP || defined USE___THREAD)
@@ -583,7 +565,7 @@
 # ifdef RTLD_BOOTSTRAP
 	    /* During startup the dynamic linker is always index 1.  */
 	    value = 1;
-# else	      
+# else
 	    /* Get the information from the link map returned by the
 	       resolv function.  */
 	    value = sym_map->l_tls_modid;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/dl-symaddr.c libc-20030708/sysdeps/ia64/dl-symaddr.c
--- glibc-2.3.2/sysdeps/ia64/dl-symaddr.c	2001-07-26 08:53:58.000000000 +0900
+++ libc-20030708/sysdeps/ia64/dl-symaddr.c	1970-01-01 09:00:00.000000000 +0900
@@ -1,33 +0,0 @@
-/* Get the symbol address.  IA-64 version.
-   Copyright (C) 1999, 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <ldsodefs.h>
-#include <dl-machine.h>
-
-void *
-_dl_symbol_address (const struct link_map *map, const Elf64_Sym *ref)
-{
-  Elf64_Addr value = (map ? map->l_addr : 0) + ref->st_value;
-
-  /* On ia64, we have to return the pointer to function descriptor. */
-  if (ELFW(ST_TYPE) (ref->st_info) == STT_FUNC)
-    return (void *) __ia64_make_fptr (map, ref, value);
-  else
-    return (void *) value;
-}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/elf/initfini.c libc-20030708/sysdeps/ia64/elf/initfini.c
--- glibc-2.3.2/sysdeps/ia64/elf/initfini.c	2002-11-09 04:35:09.000000000 +0900
+++ libc-20030708/sysdeps/ia64/elf/initfini.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Special .init and .fini section support for ia64.
-   Copyright (C) 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -46,6 +46,7 @@
 	--davidm 02/10/29 */
 
 static void
+__attribute__ ((used))
 gmon_initializer (void)
 {
   extern void weak_function __gmon_start__ (void);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/elf/start.S libc-20030708/sysdeps/ia64/elf/start.S
--- glibc-2.3.2/sysdeps/ia64/elf/start.S	2002-12-10 12:41:52.000000000 +0900
+++ libc-20030708/sysdeps/ia64/elf/start.S	2003-04-01 21:01:00.000000000 +0900
@@ -40,6 +40,9 @@
 	.type _start,@function
 _start:
 	.prologue
+	.save rp, r0
+	.body
+	.prologue
 	{ .mlx
 	  alloc r2 = ar.pfs,0,0,7,0
 	  movl r3 = FPSR_DEFAULT
@@ -76,8 +79,7 @@
 	{ .mmi
 	  ld8 out3 = [out3]	/* pointer to `init' function descriptor */
 	  ld8 out4 = [out4]	/* pointer to `fini' function descriptor */
-	  .save rp, r4
-	  mov r4 = r0		/* terminate unwind chain with a NULL return-pointer */
+	  nop 0
 	}
 	.body
 	{ .mib
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/fpu/libm-test-ulps libc-20030708/sysdeps/ia64/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/ia64/fpu/libm-test-ulps	2002-06-21 07:06:37.000000000 +0900
+++ libc-20030708/sysdeps/ia64/fpu/libm-test-ulps	2003-03-28 21:28:18.000000000 +0900
@@ -1,10 +1,5 @@
 # Begin of automatic generation
 
-# acos
-Test "acos (0.0625) == 1.50825556499840522843072005474337068":
-ildouble: 622
-ldouble: 622
-
 # cacos
 Test "Imaginary part of: cacos (0.75 + 1.25 i) == 1.11752014915610270578240049553777969 - 1.13239363160530819522266333696834467 i":
 float: 1
@@ -84,7 +79,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 ildouble: 1
@@ -99,7 +94,7 @@
 ldouble: 1
 
 # ccosh
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 double: 1
 float: 1
 idouble: 1
@@ -122,8 +117,6 @@
 Test "Real part of: cexp (0.75 + 1.25 i) == 0.667537446429131586942201977015932112 + 2.00900045494094876258347228145863909 i":
 float: 1
 ifloat: 1
-ildouble: 202
-ldouble: 202
 Test "Imaginary part of: cexp (0.75 + 1.25 i) == 0.667537446429131586942201977015932112 + 2.00900045494094876258347228145863909 i":
 ildouble: 1
 ldouble: 1
@@ -146,7 +139,7 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 idouble: 1
 ildouble: 1
@@ -223,6 +216,9 @@
 ifloat: 1
 
 # cos
+Test "cos (0.80190127184058835) == 0.69534156199418473":
+double: 1
+idouble: 1
 Test "cos (M_PI_6l * 2.0) == 0.5":
 double: 1
 float: 1
@@ -247,8 +243,6 @@
 Test "Real part of: cpow (0.75 + 1.25 i, 0.0 + 1.0 i) == 0.331825439177608832276067945276730566 + 0.131338600281188544930936345230903032 i":
 float: 1
 ifloat: 1
-ildouble: 587
-ldouble: 587
 Test "Imaginary part of: cpow (0.75 + 1.25 i, 0.0 + 1.0 i) == 0.331825439177608832276067945276730566 + 0.131338600281188544930936345230903032 i":
 float: 1
 ifloat: 1
@@ -259,8 +253,8 @@
 float: 4
 idouble: 1
 ifloat: 4
-ildouble: 768
-ldouble: 768
+ildouble: 1
+ldouble: 1
 Test "Imaginary part of: cpow (0.75 + 1.25 i, 0.75 + 1.25 i) == 0.117506293914473555420279832210420483 + 0.346552747708338676483025352060418001 i":
 ildouble: 1
 ldouble: 1
@@ -272,8 +266,8 @@
 float: 3
 idouble: 2
 ifloat: 3
-ildouble: 370
-ldouble: 370
+ildouble: 3
+ldouble: 3
 Test "Real part of: cpow (2 + 0 i, 10 + 0 i) == 1024.0 + 0.0 i":
 ildouble: 1
 ldouble: 1
@@ -308,10 +302,10 @@
 ifloat: 1
 
 # csinh
-Test "Real part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Real part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 float: 1
 idouble: 1
@@ -336,14 +330,16 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
-ildouble: 436
-ldouble: 436
-Test "Imaginary part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+ildouble: 2
+ldouble: 2
+Test "Imaginary part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 float: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
 Test "Real part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
 ildouble: 1
 ldouble: 1
@@ -354,10 +350,10 @@
 ifloat: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 ildouble: 1
 ldouble: 1
-Test "Imaginary part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Imaginary part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 float: 1
 ifloat: 1
 ildouble: 24
@@ -584,12 +580,12 @@
 Test "lgamma (-0.5) == log(2*sqrt(pi))":
 ildouble: 1
 ldouble: 1
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -610,6 +606,9 @@
 ldouble: 1
 
 # sincos
+Test "sincos (0.80190127184058835, &sin_res, &cos_res) puts 0.69534156199418473 in cos_res":
+double: 1
+idouble: 1
 Test "sincos (M_PI_6l*2.0, &sin_res, &cos_res) puts 0.5 in cos_res":
 double: 1
 float: 1
@@ -646,7 +645,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
@@ -794,10 +793,6 @@
 idouble: 1
 
 # Maximal error of functions:
-Function: "acos":
-ildouble: 622
-ldouble: 622
-
 Function: Imaginary part of "cacos":
 float: 1
 ifloat: 1
@@ -889,8 +884,6 @@
 Function: Real part of "cexp":
 float: 1
 ifloat: 1
-ildouble: 202
-ldouble: 202
 
 Function: Imaginary part of "cexp":
 float: 1
@@ -933,8 +926,8 @@
 float: 5
 idouble: 2
 ifloat: 5
-ildouble: 768
-ldouble: 768
+ildouble: 3
+ldouble: 3
 
 Function: Imaginary part of "cpow":
 double: 2
@@ -977,14 +970,16 @@
 Function: Real part of "ctan":
 double: 1
 idouble: 1
-ildouble: 436
-ldouble: 436
+ildouble: 2
+ldouble: 2
 
 Function: Imaginary part of "ctan":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
 
 Function: Real part of "ctanh":
 double: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/memchr.S libc-20030708/sysdeps/ia64/memchr.S
--- glibc-2.3.2/sysdeps/ia64/memchr.S	2001-08-18 11:57:52.000000000 +0900
+++ libc-20030708/sysdeps/ia64/memchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard memchr() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -130,3 +130,4 @@
 #if !__BOUNDED_POINTERS__
 weak_alias (__memchr, __ubp_memchr)
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/memcpy.S libc-20030708/sysdeps/ia64/memcpy.S
--- glibc-2.3.2/sysdeps/ia64/memcpy.S	2002-10-11 16:36:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/memcpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard memcpy() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop for Itanium <Dan.Pop@cern.ch>.
    Rewritten for McKinley by Sverre Jarp, HP Labs/CERN <Sverre.Jarp@cern.ch>
 
@@ -409,6 +409,7 @@
 	LOOP(48)
 	LOOP(56)
 END(memcpy)
+libc_hidden_builtin_def (memcpy)
 
 	.rodata
 	.align 8
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/memmove.S libc-20030708/sysdeps/ia64/memmove.S
--- glibc-2.3.2/sysdeps/ia64/memmove.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/memmove.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard memmove() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -239,3 +239,4 @@
 	data8	.loop56 - .loop56
 
 END(memmove)
+libc_hidden_builtin_def (memmove)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/memset.S libc-20030708/sysdeps/ia64/memset.S
--- glibc-2.3.2/sysdeps/ia64/memset.S	2002-10-11 16:36:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/memset.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard memset() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop for Itanium <Dan.Pop@cern.ch>.
    Rewritten for McKinley by Sverre Jarp, HP Labs/CERN <Sverre.Jarp@cern.ch>
 
@@ -389,4 +389,4 @@
 	br.ret.sptk.many rp
 ;; }
 END(memset)
-
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/strcat.S libc-20030708/sysdeps/ia64/strcat.S
--- glibc-2.3.2/sysdeps/ia64/strcat.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/strcat.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* IA-64 assembly version of the standard strcat() function.  
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -60,3 +60,4 @@
 	mov	ar.pfs = save_pfs
 	br.ret.sptk.many b0
 END(strcat)
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/strchr.S libc-20030708/sysdeps/ia64/strchr.S
--- glibc-2.3.2/sysdeps/ia64/strchr.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/strchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard strchr() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -109,3 +109,4 @@
 END(strchr)
 
 weak_alias(strchr, index)
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/strcmp.S libc-20030708/sysdeps/ia64/strcmp.S
--- glibc-2.3.2/sysdeps/ia64/strcmp.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/strcmp.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard strcmp() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -51,3 +51,4 @@
 	sub	ret0 = val1, val2
 	br.ret.sptk.many b0
 END(strcmp)
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/strcpy.S libc-20030708/sysdeps/ia64/strcpy.S
--- glibc-2.3.2/sysdeps/ia64/strcpy.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/strcpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard strcpy() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -142,3 +142,4 @@
 	ld8	r[MEMLAT] = [tmp]
 	br.cond.sptk .back3
 END(strcpy)
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/strlen.S libc-20030708/sysdeps/ia64/strlen.S
--- glibc-2.3.2/sysdeps/ia64/strlen.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/strlen.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard strlen() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -95,3 +95,4 @@
 	ld8	val2 = [str], 8		// bomb out here
 	br.cond.sptk	.back
 END(strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/strncmp.S libc-20030708/sysdeps/ia64/strncmp.S
--- glibc-2.3.2/sysdeps/ia64/strncmp.S	2001-07-08 04:21:23.000000000 +0900
+++ libc-20030708/sysdeps/ia64/strncmp.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard strncmp() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -59,3 +59,4 @@
 .restore_and_exit:
 	br.ret.sptk.many b0
 END(strncmp)	
+libc_hidden_builtin_def (strncmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ia64/strncpy.S libc-20030708/sysdeps/ia64/strncpy.S
--- glibc-2.3.2/sysdeps/ia64/strncpy.S	2002-12-07 18:01:32.000000000 +0900
+++ libc-20030708/sysdeps/ia64/strncpy.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* Optimized version of the standard strncpy() function.
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    Contributed by Dan Pop <Dan.Pop@cern.ch>
 	      and Jakub Jelinek <jakub@redhat.com>.
 
@@ -229,3 +229,4 @@
 (p5)	mov	r[MEMLAT - 1] = r0
 	br.cond.sptk .back4
 END(strncpy)
+libc_hidden_builtin_def (strncpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/dbl-64/dbl2mpn.c libc-20030708/sysdeps/ieee754/dbl-64/dbl2mpn.c
--- glibc-2.3.2/sysdeps/ieee754/dbl-64/dbl2mpn.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/dbl-64/dbl2mpn.c	2003-03-14 12:59:34.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1994, 1995, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1993,1994,1995,1996,1997,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -45,7 +45,7 @@
 #elif BITS_PER_MP_LIMB == 64
   /* Hopefully the compiler will combine the two bitfield extracts
      and this composition into just the original quadword extract.  */
-  res_ptr[0] = ((unsigned long int) u.ieee.mantissa0 << 32) | u.ieee.mantissa1;
+  res_ptr[0] = ((mp_limb_t) u.ieee.mantissa0 << 32) | u.ieee.mantissa1;
   #define N 1
 #else
   #error "mp_limb size " BITS_PER_MP_LIMB "not accounted for"
@@ -101,7 +101,8 @@
     }
   else
     /* Add the implicit leading one bit for a normalized number.  */
-    res_ptr[N - 1] |= 1L << (DBL_MANT_DIG - 1 - ((N - 1) * BITS_PER_MP_LIMB));
+    res_ptr[N - 1] |= (mp_limb_t) 1 << (DBL_MANT_DIG - 1
+					- ((N - 1) * BITS_PER_MP_LIMB));
 
   return N;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/dbl-64/mpn2dbl.c libc-20030708/sysdeps/ieee754/dbl-64/mpn2dbl.c
--- glibc-2.3.2/sysdeps/ieee754/dbl-64/mpn2dbl.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/dbl-64/mpn2dbl.c	2003-03-14 12:59:34.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -34,10 +34,12 @@
   u.ieee.exponent = expt + IEEE754_DOUBLE_BIAS;
 #if BITS_PER_MP_LIMB == 32
   u.ieee.mantissa1 = frac_ptr[0];
-  u.ieee.mantissa0 = frac_ptr[1] & ((1 << (DBL_MANT_DIG - 32)) - 1);
+  u.ieee.mantissa0 = frac_ptr[1] & (((mp_limb_t) 1
+				     << (DBL_MANT_DIG - 32)) - 1);
 #elif BITS_PER_MP_LIMB == 64
-  u.ieee.mantissa1 = frac_ptr[0] & ((1L << 32) - 1);
-  u.ieee.mantissa0 = (frac_ptr[0] >> 32) & ((1 << (DBL_MANT_DIG - 32)) - 1);
+  u.ieee.mantissa1 = frac_ptr[0] & (((mp_limb_t) 1 << 32) - 1);
+  u.ieee.mantissa0 = (frac_ptr[0] >> 32) & (((mp_limb_t) 1
+					     << (DBL_MANT_DIG - 32)) - 1);
 #else
   #error "mp_limb size " BITS_PER_MP_LIMB "not accounted for"
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/flt-32/mpn2flt.c libc-20030708/sysdeps/ieee754/flt-32/mpn2flt.c
--- glibc-2.3.2/sysdeps/ieee754/flt-32/mpn2flt.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/flt-32/mpn2flt.c	2003-03-14 12:59:34.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1997,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,7 +33,7 @@
   u.ieee.negative = sign;
   u.ieee.exponent = expt + IEEE754_FLOAT_BIAS;
 #if BITS_PER_MP_LIMB > FLT_MANT_DIG
-  u.ieee.mantissa = frac_ptr[0] & ((1 << FLT_MANT_DIG) - 1);
+  u.ieee.mantissa = frac_ptr[0] & (((mp_limb_t) 1 << FLT_MANT_DIG) - 1);
 #else
   #error "mp_limb size " BITS_PER_MP_LIMB "not accounted for"
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/ldbl-128/ldbl2mpn.c libc-20030708/sysdeps/ieee754/ldbl-128/ldbl2mpn.c
--- glibc-2.3.2/sysdeps/ieee754/ldbl-128/ldbl2mpn.c	2002-07-11 12:09:36.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/ldbl-128/ldbl2mpn.c	2003-03-14 12:59:34.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1995, 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,1998,1999,2002,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -49,8 +50,8 @@
 #elif BITS_PER_MP_LIMB == 64
   /* Hopefully the compiler will combine the two bitfield extracts
      and this composition into just the original quadword extract.  */
-  res_ptr[0] = ((unsigned long int) u.ieee.mantissa2 << 32) | u.ieee.mantissa3;
-  res_ptr[1] = ((unsigned long int) u.ieee.mantissa0 << 32) | u.ieee.mantissa1;
+  res_ptr[0] = ((mp_limb_t) u.ieee.mantissa2 << 32) | u.ieee.mantissa3;
+  res_ptr[1] = ((mp_limb_t) u.ieee.mantissa0 << 32) | u.ieee.mantissa1;
   #define N 2
 #else
   #error "mp_limb size " BITS_PER_MP_LIMB "not accounted for"
@@ -133,7 +134,8 @@
     }
   else
     /* Add the implicit leading one bit for a normalized number.  */
-    res_ptr[N - 1] |= 1L << (LDBL_MANT_DIG - 1 - ((N - 1) * BITS_PER_MP_LIMB));
+    res_ptr[N - 1] |= (mp_limb_t) 1 << (LDBL_MANT_DIG - 1
+					- ((N - 1) * BITS_PER_MP_LIMB));
 
   return N;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/ldbl-128/mpn2ldbl.c libc-20030708/sysdeps/ieee754/ldbl-128/mpn2ldbl.c
--- glibc-2.3.2/sysdeps/ieee754/ldbl-128/mpn2ldbl.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/ldbl-128/mpn2ldbl.c	2003-03-14 12:59:34.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1995, 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,1998,1999,2002,2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -37,12 +38,14 @@
   u.ieee.mantissa3 = frac_ptr[0];
   u.ieee.mantissa2 = frac_ptr[1];
   u.ieee.mantissa1 = frac_ptr[2];
-  u.ieee.mantissa0 = frac_ptr[3] & ((1 << (LDBL_MANT_DIG - 96)) - 1);
+  u.ieee.mantissa0 = frac_ptr[3] & (((mp_limb_t) 1
+				     << (LDBL_MANT_DIG - 96)) - 1);
 #elif BITS_PER_MP_LIMB == 64
-  u.ieee.mantissa3 = frac_ptr[0] & ((1L << 32) - 1);
+  u.ieee.mantissa3 = frac_ptr[0] & (((mp_limb_t) 1 << 32) - 1);
   u.ieee.mantissa2 = frac_ptr[0] >> 32;
-  u.ieee.mantissa1 = frac_ptr[1] & ((1L << 32) - 1);
-  u.ieee.mantissa0 = (frac_ptr[1] >> 32) & ((1 << (LDBL_MANT_DIG - 96)) - 1);
+  u.ieee.mantissa1 = frac_ptr[1] & (((mp_limb_t) 1 << 32) - 1);
+  u.ieee.mantissa0 = (frac_ptr[1] >> 32) & (((mp_limb_t) 1
+					     << (LDBL_MANT_DIG - 96)) - 1);
 #else
   #error "mp_limb size " BITS_PER_MP_LIMB "not accounted for"
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/ldbl-96/e_gammal_r.c libc-20030708/sysdeps/ieee754/ldbl-96/e_gammal_r.c
--- glibc-2.3.2/sysdeps/ieee754/ldbl-96/e_gammal_r.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/ldbl-96/e_gammal_r.c	2003-04-15 23:55:49.000000000 +0900
@@ -1,5 +1,5 @@
 /* Implementation of gamma function according to ISO C.
-   Copyright (C) 1997, 1999, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -45,8 +45,11 @@
       return x - x;
     }
   if ((es & 0x7fff) == 0x7fff && ((hx & 0x7fffffff) | lx) != 0)
-    /* NaN, return it.  */
-    return x;
+    {
+      /* NaN, return it.  */
+      *signgamp = 0;
+      return x;
+    }
   if ((es & 0x8000) != 0 && x < 0xffffffff && __rintl (x) == x)
     {
       /* Return value for integer x < 0 is NaN with invalid exception.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/ldbl-96/ldbl2mpn.c libc-20030708/sysdeps/ieee754/ldbl-96/ldbl2mpn.c
--- glibc-2.3.2/sysdeps/ieee754/ldbl-96/ldbl2mpn.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/ldbl-96/ldbl2mpn.c	2003-03-14 12:59:34.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1996, 1997, 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,1998,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -47,7 +47,7 @@
 #elif BITS_PER_MP_LIMB == 64
   /* Hopefully the compiler will combine the two bitfield extracts
      and this composition into just the original quadword extract.  */
-  res_ptr[0] = ((unsigned long int) u.ieee.mantissa0 << 32) | u.ieee.mantissa1;
+  res_ptr[0] = ((mp_limb_t) u.ieee.mantissa0 << 32) | u.ieee.mantissa1;
   #define N 1
 #else
   #error "mp_limb size " BITS_PER_MP_LIMB "not accounted for"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/ieee754/ldbl-96/mpn2ldbl.c libc-20030708/sysdeps/ieee754/ldbl-96/mpn2ldbl.c
--- glibc-2.3.2/sysdeps/ieee754/ldbl-96/mpn2ldbl.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/ieee754/ldbl-96/mpn2ldbl.c	2003-03-14 12:59:34.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1996, 1997, 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,1998,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -37,7 +37,7 @@
   u.ieee.mantissa1 = frac_ptr[0];
   u.ieee.mantissa0 = frac_ptr[1];
 #elif BITS_PER_MP_LIMB == 64
-  u.ieee.mantissa1 = frac_ptr[0] & ((1L << 32) - 1);
+  u.ieee.mantissa1 = frac_ptr[0] & (((mp_limb_t) 1 << 32) - 1);
   u.ieee.mantissa0 = frac_ptr[0] >> 32;
 #else
   #error "mp_limb size " BITS_PER_MP_LIMB "not accounted for"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/dl-machine.h libc-20030708/sysdeps/m68k/dl-machine.h
--- glibc-2.3.2/sysdeps/m68k/dl-machine.h	2003-01-27 06:07:32.000000000 +0900
+++ libc-20030708/sysdeps/m68k/dl-machine.h	2003-03-02 00:33:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* Machine-dependent ELF dynamic relocation inline functions.  m68k version.
-   Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -158,7 +158,7 @@
 	| Save the user entry point address in %a4.\n\
 	move.l %d0, %a4\n\
 	| Remember the highest stack address.\n\
-	lea __libc_stack_end(%pc), %a0\n\
+	move.l __libc_stack_end@GOTPC(%pc), %a0\n\
 	move.l %sp, (%a0)\n\
 	| See if we were run as a command with the executable file\n\
 	| name as an extra leading argument.\n\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/fpu/bits/mathinline.h libc-20030708/sysdeps/m68k/fpu/bits/mathinline.h
--- glibc-2.3.2/sysdeps/m68k/fpu/bits/mathinline.h	2002-09-24 09:00:25.000000000 +0900
+++ libc-20030708/sysdeps/m68k/fpu/bits/mathinline.h	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,6 @@
 /* Definitions of inline math functions implemented by the m68881/2.
-   Copyright (C) 1991,92,93,94,96,97,98,99,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,92,93,94,96,97,98,99,2000,2002, 2003
+     Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -176,28 +177,6 @@
    for the function names.  */
 
 #define __inline_functions(float_type, s)				  \
-__m81_inline float_type							  \
-__m81_u(__CONCAT(__frexp,s))(float_type __value, int *__expptr)	__THROW	  \
-{									  \
-  float_type __mantissa, __exponent;					  \
-  int __iexponent;							  \
-  unsigned long __fpsr;							  \
-  __asm("ftst%.x %1\n"							  \
-	"fmove%.l %/fpsr, %0" : "=dm" (__fpsr) : "f" (__value));	  \
-  if (__fpsr & (7 << 24))						  \
-    {									  \
-      /* Not finite or zero.  */					  \
-      *__expptr = 0;							  \
-      return __value;							  \
-    }									  \
-  __asm("fgetexp%.x %1, %0" : "=f" (__exponent) : "f" (__value));	  \
-  __iexponent = (int) __exponent + 1;					  \
-  *__expptr = __iexponent;						  \
-  __asm("fscale%.l %2, %0" : "=f" (__mantissa)				  \
-	: "0" (__value), "dmi" (-__iexponent));				  \
-  return __mantissa;							  \
-}									  \
-									  \
 __m81_defun (float_type, __CONCAT(__floor,s), (float_type __x))	__THROW	  \
 {									  \
   float_type __result;							  \
@@ -386,8 +365,6 @@
   return __CONCAT(__,name) args2;			\
 }
 
-__inline_forward(double,frexp, (double __value, int *__expptr),
-		 (__value, __expptr))
 __inline_forward_c(double,floor, (double __x), (__x))
 __inline_forward_c(double,ceil, (double __x), (__x))
 # ifdef __USE_MISC
@@ -416,8 +393,6 @@
 
 # if defined __USE_MISC || defined __USE_ISOC99
 
-__inline_forward(float,frexpf, (float __value, int *__expptr),
-		 (__value, __expptr))
 __inline_forward_c(float,floorf, (float __x), (__x))
 __inline_forward_c(float,ceilf, (float __x), (__x))
 #  ifdef __USE_MISC
@@ -438,8 +413,6 @@
 		 (__x, __sinx, __cosx))
 # endif
 
-__inline_forward(long double,frexpl, (long double __value, int *__expptr),
-		 (__value, __expptr))
 __inline_forward_c(long double,floorl, (long double __x), (__x))
 __inline_forward_c(long double,ceill, (long double __x), (__x))
 # ifdef __USE_MISC
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/fpu/libm-test-ulps libc-20030708/sysdeps/m68k/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/m68k/fpu/libm-test-ulps	2003-01-12 16:54:07.000000000 +0900
+++ libc-20030708/sysdeps/m68k/fpu/libm-test-ulps	2003-07-08 22:58:10.000000000 +0900
@@ -119,14 +119,12 @@
 ldouble: 1
 
 # ccos
-Test "Real part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Real part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
-ildouble: 1
-ldouble: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
 float: 1
 ifloat: 1
@@ -139,10 +137,10 @@
 ldouble: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 ildouble: 1
@@ -189,10 +187,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Real part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
-ildouble: 1
-ldouble: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Real part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 ildouble: 1
 ldouble: 1
 Test "Imaginary part of: clog10 (-3 + inf i) == inf + pi/2*log10(e) i":
@@ -336,10 +331,10 @@
 ldouble: 1
 
 # csin
-Test "Real part of: csin (-2 - 3 i) == -9.1544991469114295734 + 4.1689069599665643507 i":
+Test "Real part of: csin (-2 - 3 i) == -9.15449914691142957346729954460983256 + 4.16890695996656435075481305885375484 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: csin (-2 - 3 i) == -9.1544991469114295734 + 4.1689069599665643507 i":
+Test "Imaginary part of: csin (-2 - 3 i) == -9.15449914691142957346729954460983256 + 4.16890695996656435075481305885375484 i":
 float: 1
 ifloat: 1
 Test "Real part of: csin (0.75 + 1.25 i) == 1.28722291002649188575873510790565441 + 1.17210635989270256101081285116138863 i":
@@ -352,14 +347,12 @@
 ifloat: 1
 
 # csinh
-Test "Real part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Real part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 float: 1
 ifloat: 1
-ildouble: 2
-ldouble: 2
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
 float: 1
 ifloat: 1
@@ -370,10 +363,9 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
-ildouble: 439
-ldouble: 439
-Test "Imaginary part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
+double: 1
+idouble: 1
 ildouble: 1
 ldouble: 1
 Test "Real part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -384,12 +376,9 @@
 ldouble: 2
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
-ildouble: 2
-ldouble: 2
-Test "Imaginary part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
-ildouble: 25
-ldouble: 25
+Test "Imaginary part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
+ildouble: 1
+ldouble: 1
 Test "Imaginary part of: ctanh (0 + pi/4 i) == 0.0 + 1.0 i":
 double: 1
 idouble: 1
@@ -599,12 +588,12 @@
 Test "lgamma (0.5) == log(sqrt(pi))":
 ildouble: 1
 ldouble: 1
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 float: 1
 ifloat: 1
 ildouble: 1
 ldouble: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -698,7 +687,7 @@
 ifloat: 1
 ildouble: 1
 ldouble: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
@@ -1032,28 +1021,24 @@
 Function: Imaginary part of "csinh":
 float: 1
 ifloat: 1
-ildouble: 2
-ldouble: 2
 
 Function: Real part of "ctan":
-ildouble: 439
-ldouble: 439
+double: 1
+idouble: 1
+ildouble: 1
+ldouble: 1
 
 Function: Imaginary part of "ctan":
 ildouble: 2
 ldouble: 2
 
-Function: Real part of "ctanh":
-ildouble: 2
-ldouble: 2
-
 Function: Imaginary part of "ctanh":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-ildouble: 25
-ldouble: 25
+ildouble: 1
+ldouble: 1
 
 Function: "erfc":
 float: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/fpu/s_frexp.c libc-20030708/sysdeps/m68k/fpu/s_frexp.c
--- glibc-2.3.2/sysdeps/m68k/fpu/s_frexp.c	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/m68k/fpu/s_frexp.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -28,11 +28,28 @@
 #define __CONCATX(a,b) __CONCAT(a,b)
 
 float_type
-__CONCATX(__,FUNC) (value, expptr)
-     float_type value;
-     int *expptr;
+__CONCATX(__,FUNC) (float_type value, int *expptr)
 {
-  return __m81_u(__CONCATX(__,FUNC))(value, expptr);
+  float_type mantissa, exponent;
+  int iexponent;
+  unsigned long fpsr;
+
+  __asm ("ftst%.x %1\n"
+	 "fmove%.l %/fpsr, %0"
+	 : "=dm" (fpsr) : "f" (value));
+  if (fpsr & (7 << 24))
+    {
+      /* Not finite or zero.  */
+      *expptr = 0;
+      return value;
+    }
+  __asm ("fgetexp%.x %1, %0" : "=f" (exponent) : "f" (value));
+  iexponent = (int) exponent + 1;
+  *expptr = iexponent;
+  __asm ("fscale%.l %2, %0"
+	 : "=f" (mantissa)
+	 : "0" (value), "dmi" (-iexponent));
+  return mantissa;
 }
 
 #define weak_aliasx(a,b) weak_alias(a,b)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/fpu/s_frexpl.c libc-20030708/sysdeps/m68k/fpu/s_frexpl.c
--- glibc-2.3.2/sysdeps/m68k/fpu/s_frexpl.c	1996-06-06 14:22:18.000000000 +0900
+++ libc-20030708/sysdeps/m68k/fpu/s_frexpl.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,3 +1,59 @@
-#define FUNC frexpl
-#define float_type long double
-#include <s_frexp.c>
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <math.h>
+
+long double
+__frexpl (long double value, int *expptr)
+{
+  long double mantissa, exponent;
+  int iexponent;
+  unsigned long fpsr;
+
+  __asm ("ftst%.x %1\n"
+	 "fmove%.l %/fpsr, %0"
+	 : "=dm" (fpsr) : "f" (value));
+  if (fpsr & (7 << 24))
+    {
+      /* Not finite or zero.  */
+      *expptr = 0;
+      return value;
+    }
+  __asm ("fgetexp%.x %1, %0" : "=f" (exponent) : "f" (value));
+  iexponent = (int) exponent + 1;
+  *expptr = iexponent;
+  /* Unnormalized numbers must be handled specially, otherwise fscale
+     results in overflow.  */
+  if (iexponent <= -16384)
+    {
+      value *= 0x1p16383L;
+      iexponent += 16383;
+    }
+  else if (iexponent >= 16384)
+    {
+      value *= 0x1p-16383L;
+      iexponent -= 16383;
+    }
+
+  __asm ("fscale%.l %2, %0"
+	 : "=f" (mantissa)
+	 : "0" (value), "dmi" (-iexponent));
+  return mantissa;
+}
+
+weak_alias (__frexpl, frexpl)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/m68020/atomicity.h libc-20030708/sysdeps/m68k/m68020/atomicity.h
--- glibc-2.3.2/sysdeps/m68k/m68020/atomicity.h	2001-08-16 01:14:06.000000000 +0900
+++ libc-20030708/sysdeps/m68k/m68020/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,64 +0,0 @@
-/* Low-level functions for atomic operations.  m680x0 version, x >= 2.
-   Copyright (C) 1997 Free Software Foundation, Inc.
-   Contributed by Andreas Schwab <schwab@issan.informatik.uni-dortmund.de>.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-
-static inline int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  register int result = *mem;
-  register int temp;
-  __asm__ __volatile__ ("1: move%.l %0,%1;"
-			"   add%.l %2,%1;"
-			"   cas%.l %0,%1,%3;"
-			"   jbne 1b"
-			: "=d" (result), "=&d" (temp)
-			: "d" (val), "m" (*mem), "0" (result) : "memory");
-  return result;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  /* XXX Use cas here as well?  */
-  __asm__ __volatile__ ("add%.l %0,%1"
-			: : "id" (val), "m" (*mem) : "memory");
-}
-
-static inline int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  char ret;
-  long int readval;
-
-  __asm__ __volatile__ ("cas%.l %2,%3,%1; seq %0"
-                        : "=dm" (ret), "=m" (*p), "=d" (readval)
-                        : "d" (newval), "m" (*p), "2" (oldval));
-  return ret;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/m68020/bits/atomic.h libc-20030708/sysdeps/m68k/m68020/bits/atomic.h
--- glibc-2.3.2/sysdeps/m68k/m68020/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/m68k/m68020/bits/atomic.h	2003-05-12 01:30:11.000000000 +0900
@@ -0,0 +1,261 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Andreas Schwab <schwab@suse.de>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  ({ __typeof (*(mem)) __ret;						      \
+     __asm __volatile ("cas%.b %0,%2,%1"				      \
+		       : "=d" (__ret), "=m" (*(mem))			      \
+		       : "d" (newval), "m" (*(mem)), "0" (oldval));	      \
+     __ret; })
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  ({ __typeof (*(mem)) __ret;						      \
+     __asm __volatile ("cas%.w %0,%2,%1"				      \
+		       : "=d" (__ret), "=m" (*(mem))			      \
+		       : "d" (newval), "m" (*(mem)), "0" (oldval));	      \
+     __ret; })
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+  ({ __typeof (*(mem)) __ret;						      \
+     __asm __volatile ("cas%.l %0,%2,%1"				      \
+		       : "=d" (__ret), "=m" (*(mem))			      \
+		       : "d" (newval), "m" (*(mem)), "0" (oldval));	      \
+     __ret; })
+
+# define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  ({ __typeof (*(mem)) __ret;						      \
+     __typeof (mem) __memp = (mem);					      \
+     __asm __volatile ("cas2%.l %0:%R0,%1:%R1,(%2):(%3)"		      \
+		       : "=d" (__ret)					      \
+		       : "d" (newval), "r" (__memp),			      \
+			 "r" ((char *) __memp + 4), "0" (oldval)	      \
+		       : "memory");					      \
+     __ret; })
+
+#define atomic_exchange_acq(mem, newvalue) \
+  ({ __typeof (*(mem)) __result = *(mem);				      \
+     if (sizeof (*(mem)) == 1)						      \
+       __asm __volatile ("1: cas%.b %0,%2,%1;"				      \
+			 "   jbne 1b"					      \
+			 : "=d" (__result), "=m" (*(mem))		      \
+			 : "d" (newvalue), "m" (*(mem)), "0" (__result));     \
+     else if (sizeof (*(mem)) == 2)					      \
+       __asm __volatile ("1: cas%.w %0,%2,%1;"				      \
+			 "   jbne 1b"					      \
+			 : "=d" (__result), "=m" (*(mem))		      \
+			 : "d" (newvalue), "m" (*(mem)), "0" (__result));     \
+     else if (sizeof (*(mem)) == 4)					      \
+       __asm __volatile ("1: cas%.l %0,%2,%1;"				      \
+			 "   jbne 1b"					      \
+			 : "=d" (__result), "=m" (*(mem))		      \
+			 : "d" (newvalue), "m" (*(mem)), "0" (__result));     \
+     else								      \
+       {								      \
+	 __typeof (mem) __memp = (mem);					      \
+	 __asm __volatile ("1: cas2%.l %0:%R0,%1:%R1,(%2):(%3);"	      \
+			   "   jbne 1b"					      \
+			   : "=d" (__result)				      \
+			   : "d" (newvalue), "r" (__memp),		      \
+			     "r" ((char *) __memp + 4), "0" (__result)	      \
+			   : "memory");					      \
+       }								      \
+     __result; })
+
+#define atomic_exchange_and_add(mem, value) \
+  ({ __typeof (*(mem)) __result = *(mem);				      \
+     __typeof (*(mem)) __temp;						      \
+     if (sizeof (*(mem)) == 1)						      \
+       __asm __volatile ("1: move%.b %0,%2;"				      \
+			 "   add%.b %3,%2;"				      \
+			 "   cas%.b %0,%2,%1;"				      \
+			 "   jbne 1b"					      \
+			 : "=d" (__result), "=m" (*(mem)),		      \
+			   "=&d" (__temp)				      \
+			 : "d" (value), "1" (*(mem)), "0" (__result));	      \
+     else if (sizeof (*(mem)) == 2)					      \
+       __asm __volatile ("1: move%.w %0,%2;"				      \
+			 "   add%.w %3,%2;"				      \
+			 "   cas%.w %0,%2,%1;"				      \
+			 "   jbne 1b"					      \
+			 : "=d" (__result), "=m" (*(mem)),		      \
+			   "=&d" (__temp)				      \
+			 : "d" (value), "1" (*(mem)), "0" (__result));	      \
+     else if (sizeof (*(mem)) == 4)					      \
+       __asm __volatile ("1: move%.l %0,%2;"				      \
+			 "   add%.l %3,%2;"				      \
+			 "   cas%.l %0,%2,%1;"				      \
+			 "   jbne 1b"					      \
+			 : "=d" (__result), "=m" (*(mem)),		      \
+			   "=&d" (__temp)				      \
+			 : "d" (value), "1" (*(mem)), "0" (__result));	      \
+     else								      \
+       {								      \
+	 __typeof (mem) __memp = (mem);					      \
+	 __asm __volatile ("1: move%.l %0,%1;"				      \
+			   "   move%.l %R0,%R1;"			      \
+			   "   add%.l %2,%1;"				      \
+			   "   addx%.l %R2,%R1;"			      \
+			   "   cas2%.l %0:%R0,%1:%R1,(%3):(%4);"	      \
+			   "   jbne 1b"					      \
+			   : "=d" (__result), "=&d" (__temp)		      \
+			   : "d" (value), "r" (__memp),			      \
+			     "r" ((char *) __memp + 4), "0" (__result)	      \
+			   : "memory");					      \
+       }								      \
+     __result; })
+
+#define atomic_add(mem, value) \
+  (void) ({ if (sizeof (*(mem)) == 1)					      \
+	      __asm __volatile ("add%.b %1,%0"				      \
+				: "=m" (*(mem))				      \
+				: "id" (value), "0" (*(mem)));		      \
+	    else if (sizeof (*(mem)) == 2)				      \
+	      __asm __volatile ("add%.w %1,%0"				      \
+				: "=m" (*(mem))				      \
+				: "id" (value), "0" (*(mem)));		      \
+	    else if (sizeof (*(mem)) == 4)				      \
+	      __asm __volatile ("add%.l %1,%0"				      \
+				: "=m" (*(mem))				      \
+				: "id" (value), "0" (*(mem)));		      \
+	    else							      \
+	      {								      \
+		__typeof (mem) __memp = (mem);				      \
+		__typeof (*(mem)) __oldval = *__memp;			      \
+		__typeof (*(mem)) __temp;				      \
+		__asm __volatile ("1: move%.l %0,%1;"			      \
+				  "   move%.l %R0,%R1;"			      \
+				  "   add%.l %2,%1;"			      \
+				  "   addx%.l %R2,%R1;"			      \
+				  "   cas2%.l %0:%R0,%1:%R1,(%3):(%4);"	      \
+				  "   jbne 1b"				      \
+				  : "=d" (__oldval), "=&d" (__temp)	      \
+				  : "d" (value), "r" (__memp),		      \
+				    "r" ((char *) __memp + 4), "0" (__oldval) \
+				  : "memory");				      \
+	      }								      \
+	    })
+
+#define atomic_increment_and_test(mem) \
+  ({ char __result;							      \
+     if (sizeof (*(mem)) == 1)						      \
+       __asm __volatile ("addq%.b %#1,%1; seq %0"			      \
+			 : "=dm" (__result), "=m" (*(mem))		      \
+			 : "1" (*(mem)));				      \
+     else if (sizeof (*(mem)) == 2)					      \
+       __asm __volatile ("addq%.w %#1,%1; seq %0"			      \
+			 : "=dm" (__result), "=m" (*(mem))		      \
+			 : "1" (*(mem)));				      \
+     else if (sizeof (*(mem)) == 4)					      \
+       __asm __volatile ("addq%.l %#1,%1; seq %0"			      \
+			 : "=dm" (__result), "=m" (*(mem))		      \
+			 : "1" (*(mem)));				      \
+     else								      \
+       {								      \
+	 __typeof (mem) __memp = (mem);					      \
+	 __typeof (*(mem)) __oldval = *__memp;				      \
+	 __typeof (*(mem)) __temp;					      \
+	 __asm __volatile ("1: move%.l %1,%2;"				      \
+			   "   move%.l %R1,%R2;"			      \
+			   "   addq%.l %#1,%2;"				      \
+			   "   addx%.l %5,%R2;"				      \
+			   "   seq %0;"					      \
+			   "   cas2%.l %1:%R1,%2:%R2,(%3):(%4);"	      \
+			   "   jbne 1b"					      \
+			   : "=&dm" (__result), "=d" (__oldval),	      \
+			     "=&d" (__temp)				      \
+			   : "r" (__memp), "r" ((char *) __memp + 4),	      \
+			     "d" (0), "1" (__oldval)			      \
+			   : "memory");					      \
+       }								      \
+     __result; })
+
+#define atomic_decrement_and_test(mem) \
+  ({ char __result;							      \
+     if (sizeof (*(mem)) == 1)						      \
+       __asm __volatile ("subq%.b %#1,%1; seq %0"			      \
+			 : "=dm" (__result), "=m" (*(mem))		      \
+			 : "1" (*(mem)));				      \
+     else if (sizeof (*(mem)) == 2)					      \
+       __asm __volatile ("subq%.w %#1,%1; seq %0"			      \
+			 : "=dm" (__result), "=m" (*(mem))		      \
+			 : "1" (*(mem)));				      \
+     else if (sizeof (*(mem)) == 4)					      \
+       __asm __volatile ("subq%.l %#1,%1; seq %0"			      \
+			 : "=dm" (__result), "=m" (*(mem))		      \
+			 : "1" (*(mem)));				      \
+     else								      \
+       {								      \
+	 __typeof (mem) __memp = (mem);					      \
+	 __typeof (*(mem)) __oldval = *__memp;				      \
+	 __typeof (*(mem)) __temp;					      \
+	 __asm __volatile ("1: move%.l %1,%2;"				      \
+			   "   move%.l %R1,%R2;"			      \
+			   "   subq%.l %#1,%2;"				      \
+			   "   subx%.l %5,%R2;"				      \
+			   "   seq %0;"					      \
+			   "   cas2%.l %1:%R1,%2:%R2,(%3):(%4);"	      \
+			   "   jbne 1b"					      \
+			   : "=&dm" (__result), "=d" (__oldval),	      \
+			     "=&d" (__temp)				      \
+			   : "r" (__memp), "r" ((char *) __memp + 4),	      \
+			     "d" (0), "1" (__oldval)			      \
+			   : "memory");					      \
+       }								      \
+     __result; })
+
+#define atomic_bit_set(mem, bit) \
+  __asm __volatile ("bfset %0{%1,#1}"					      \
+		    : "=m" (*(mem))					      \
+		    : "di" (sizeof (*(mem)) * 8 - (bit) - 1), "m" (*(mem)))
+
+#define atomic_bit_test_set(mem, bit) \
+  ({ char __result;							      \
+     __asm __volatile ("bfset %1{%2,#1}; sne %0"			      \
+		       : "=dm" (__result), "=m" (*(mem))		      \
+		       : "di" (sizeof (*(mem)) * 8 - (bit) - 1),	      \
+			 "m" (*(mem)));					      \
+     __result; })
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/memchr.S libc-20030708/sysdeps/m68k/memchr.S
--- glibc-2.3.2/sysdeps/m68k/memchr.S	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/m68k/memchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,7 +1,7 @@
 /* memchr (str, ch, n) -- Return pointer to first occurrence of CH in the
    first N bytes of STR.
    For Motorola 68000.
-   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Schwab <schwab@gnu.org>.
 
@@ -229,3 +229,4 @@
 #if !__BOUNDED_POINTERS__
 weak_alias (__memchr, __ubp_memchr)
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/m68k/strchr.S libc-20030708/sysdeps/m68k/strchr.S
--- glibc-2.3.2/sysdeps/m68k/strchr.S	2001-07-08 04:21:24.000000000 +0900
+++ libc-20030708/sysdeps/m68k/strchr.S	2003-05-02 00:11:51.000000000 +0900
@@ -1,6 +1,6 @@
 /* strchr (str, ch) -- Return pointer to first occurrence of CH in STR.
    For Motorola 68000.
-   Copyright (C) 1999 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Schwab <schwab@gnu.org>.
 
@@ -255,3 +255,4 @@
 END(strchr)
 
 weak_alias (strchr, index)
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/configure libc-20030708/sysdeps/mach/configure
--- glibc-2.3.2/sysdeps/mach/configure	2003-02-26 09:46:36.000000000 +0900
+++ libc-20030708/sysdeps/mach/configure	2003-07-08 22:58:10.000000000 +0900
@@ -96,7 +96,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/mach_types.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -119,7 +123,8 @@
   ac_cv_header_mach_mach_types_h=yes
 else
   echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
   ac_cv_header_mach_mach_types_h=no
 fi
 rm -f conftest.err conftest.$ac_ext
@@ -142,7 +147,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/mach_types.defs>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -165,7 +174,8 @@
   ac_cv_header_mach_mach_types_defs=yes
 else
   echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
   ac_cv_header_mach_mach_types_defs=no
 fi
 rm -f conftest.err conftest.$ac_ext
@@ -191,7 +201,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/mach_types.h>
 int
 main ()
@@ -216,7 +230,8 @@
   libc_cv_mach_task_t=task_t
 else
   echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
 libc_cv_mach_task_t=task_port_t
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -233,7 +248,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/mach_types.h>
 int
 main ()
@@ -258,7 +277,8 @@
   libc_cv_mach_thread_t=thread_t
 else
   echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
 libc_cv_mach_thread_t=thread_port_t
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -276,7 +296,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/task_info.h>
 int
 main ()
@@ -304,7 +328,8 @@
   libc_cv_mach_task_creation_time=yes
 else
   echo "$as_me: failed program was:" >&5
-cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
 libc_cv_mach_task_creation_time=no
 fi
 rm -f conftest.$ac_objext conftest.$ac_ext
@@ -312,7 +337,9 @@
 echo "$as_me:$LINENO: result: $libc_cv_mach_task_creation_time" >&5
 echo "${ECHO_T}$libc_cv_mach_task_creation_time" >&6
 if test $libc_cv_mach_task_creation_time = no; then
-  DEFINES="$DEFINES -DNO_CREATION_TIME=1"
+  { { echo "$as_me:$LINENO: error: you need Mach headers supporting task_info.creation_time" >&5
+echo "$as_me: error: you need Mach headers supporting task_info.creation_time" >&2;}
+   { (exit 1); exit 1; }; }
 fi
 
 mach_interface_list=
@@ -330,7 +357,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/${ifc}.defs>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -353,7 +384,8 @@
   eval "$as_ac_Header=yes"
 else
   echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
   eval "$as_ac_Header=no"
 fi
 rm -f conftest.err conftest.$ac_ext
@@ -394,7 +426,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/mach_host.defs>
 
 _ACEOF
@@ -423,7 +459,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/machine/ndr_def.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -446,7 +486,8 @@
   ac_cv_header_mach_machine_ndr_def_h=yes
 else
   echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
   ac_cv_header_mach_machine_ndr_def_h=no
 fi
 rm -f conftest.err conftest.$ac_ext
@@ -463,7 +504,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <machine/ndr_def.h>
 _ACEOF
 if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
@@ -486,7 +531,8 @@
   ac_cv_header_machine_ndr_def_h=yes
 else
   echo "$as_me: failed program was:" >&5
-  cat conftest.$ac_ext >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
   ac_cv_header_machine_ndr_def_h=no
 fi
 rm -f conftest.err conftest.$ac_ext
@@ -509,7 +555,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/i386/mach_i386.defs>
 
 _ACEOF
@@ -538,7 +588,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <mach/i386/mach_i386.defs>
 
 _ACEOF
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/configure.in libc-20030708/sysdeps/mach/configure.in
--- glibc-2.3.2/sysdeps/mach/configure.in	2002-10-23 15:21:18.000000000 +0900
+++ libc-20030708/sysdeps/mach/configure.in	2003-07-08 22:58:10.000000000 +0900
@@ -41,7 +41,7 @@
 long s = i->creation_time.seconds;
 ], libc_cv_mach_task_creation_time=yes, libc_cv_mach_task_creation_time=no)])
 if test $libc_cv_mach_task_creation_time = no; then
-  DEFINES="$DEFINES -DNO_CREATION_TIME=1"
+  AC_MSG_ERROR([you need Mach headers supporting task_info.creation_time])
 fi
 
 dnl
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/Makefile libc-20030708/sysdeps/mach/hurd/Makefile
--- glibc-2.3.2/sysdeps/mach/hurd/Makefile	2003-02-18 03:58:05.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/Makefile	2003-07-08 22:58:10.000000000 +0900
@@ -190,7 +190,6 @@
 
 ifeq ($(subdir),csu)
 
-sysdep_routines += set-init
 extra-objs += static-start.o
 
 # We need special startup code for statically linked binaries.
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/alpha/init-first.c libc-20030708/sysdeps/mach/hurd/alpha/init-first.c
--- glibc-2.3.2/sysdeps/mach/hurd/alpha/init-first.c	2002-06-19 06:14:08.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/alpha/init-first.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Initialization code run first thing by the ELF startup code.  Alpha/Hurd.
-   Copyright (C) 1995,96,97,98,99,2000,2001,02 Free Software Foundation, Inc.
+   Copyright (C) 1995,96,97,98,99,2000,01,02,03 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -28,7 +28,6 @@
 #include "hurdmalloc.h"		/* XXX */
 
 extern void __mach_init (void);
-extern void __libc_init (int, char **, char **);
 extern void __init_misc (int, char **, char **);
 #ifdef USE_NONOPTION_FLAGS
 extern void __getopt_clean_environment (char **);
@@ -72,7 +71,6 @@
   _dl_non_dynamic_init ();
 #endif
   __init_misc (argc, argv, envp);
-  __libc_init (argc, argv, envp);
 
 #ifdef USE_NONOPTION_FLAGS
   /* This is a hack to make the special getopt in GNU libc working.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/i386/init-first.c libc-20030708/sysdeps/mach/hurd/i386/init-first.c
--- glibc-2.3.2/sysdeps/mach/hurd/i386/init-first.c	2002-12-03 07:36:40.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/i386/init-first.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Initialization code run first thing by the ELF startup code.  For i386/Hurd.
-   Copyright (C) 1995,96,97,98,99,2000,2001,02 Free Software Foundation, Inc.
+   Copyright (C) 1995,96,97,98,99,2000,01,02,03 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +32,6 @@
 #include <fpu_control.h>
 
 extern void __mach_init (void);
-extern void __libc_init (int, char **, char **);
 extern void __init_misc (int, char **, char **);
 #ifdef USE_NONOPTION_FLAGS
 extern void __getopt_clean_environment (char **);
@@ -86,7 +85,6 @@
   _dl_non_dynamic_init ();
 #endif
   __init_misc (argc, argv, envp);
-  __libc_init (argc, argv, envp);
 
 #ifdef USE_NONOPTION_FLAGS
   /* This is a hack to make the special getopt in GNU libc working.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/mips/init-first.c libc-20030708/sysdeps/mach/hurd/mips/init-first.c
--- glibc-2.3.2/sysdeps/mach/hurd/mips/init-first.c	2002-10-03 09:17:51.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/mips/init-first.c	2003-07-08 22:58:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* Initialization code run first thing by the ELF startup code.  For Mips/Hurd.
-   Copyright (C) 1996,1997,1998,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1998,2000,01,02,03 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -26,7 +26,6 @@
 #include "hurdmalloc.h"		/* XXX */
 
 extern void __mach_init (void);
-extern void __libc_init (int, char **, char **);
 extern void __init_misc (int, char **, char **);
 #ifdef USE_NONOPTION_FLAGS
 extern void __getopt_clean_environment (char **);
@@ -114,7 +113,6 @@
   _dl_non_dynamic_init ();
 #endif
   __init_misc (argc, argv, __environ);
-  __libc_init (argc, argv, __environ);
 
 #ifdef USE_NONOPTION_FLAGS
   /* This is a hack to make the special getopt in GNU libc working.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/powerpc/init-first.c libc-20030708/sysdeps/mach/hurd/powerpc/init-first.c
--- glibc-2.3.2/sysdeps/mach/hurd/powerpc/init-first.c	2002-03-13 12:39:01.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/powerpc/init-first.c	2003-07-08 22:58:11.000000000 +0900
@@ -1,5 +1,5 @@
 /* Initialization code run first thing by the ELF startup code.  PowerPC/Hurd.
-   Copyright (C) 1995-2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -28,7 +28,6 @@
 #include "hurdmalloc.h"		/* XXX */
 
 extern void __mach_init (void);
-extern void __libc_init (int, char **, char **);
 extern void __init_misc (int, char **, char **);
 #ifdef USE_NONOPTION_FLAGS
 extern void __getopt_clean_environment (char **);
@@ -77,7 +76,6 @@
   _dl_non_dynamic_init ();
 #endif
   __init_misc (argc, argv, envp);
-  __libc_init (argc, argv, envp);
 
 #ifdef USE_NONOPTION_FLAGS
   /* This is a hack to make the special getopt in GNU libc working.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/set-init.c libc-20030708/sysdeps/mach/hurd/set-init.c
--- glibc-2.3.2/sysdeps/mach/hurd/set-init.c	2001-07-08 04:20:52.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/set-init.c	1970-01-01 09:00:00.000000000 +0900
@@ -1,23 +0,0 @@
-/* Copyright (C) 1991, 1992, 1994, 1995, 1997 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <stdlib.h>
-#include <set-hooks.h>
-
-DEFINE_HOOK_RUNNER (__libc_subinit, __libc_init,
-		    (int argc, char **argv, char **envp), (argc, argv, envp))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/times.c libc-20030708/sysdeps/mach/hurd/times.c
--- glibc-2.3.2/sysdeps/mach/hurd/times.c	2002-02-19 16:34:49.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/times.c	2003-07-08 22:58:10.000000000 +0900
@@ -1,5 +1,5 @@
 /* Return CPU and real time used by process and its children.  Hurd version.
-   Copyright (C) 2001,02 Free Software Foundation, Inc.
+   Copyright (C) 2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,17 +33,6 @@
   return t->seconds * 1000000 + t->microseconds;
 }
 
-#if NO_CREATION_TIME
-static time_value_t startup_time;
-static void times_init (void) __attribute__ ((unused));
-static void
-times_init (void)
-{
-  __gettimeofday ((struct timeval *) &startup_time, NULL);
-}
-text_set_element (__libc_subinit, times_init);
-#endif
-
 /* Store the CPU time used by this process and all its
    dead children (and their dead children) in BUFFER.
    Return the elapsed real time, or (clock_t) -1 for errors.
@@ -80,12 +69,7 @@
   if (__gettimeofday ((struct timeval *) &now, NULL) < 0)
     return -1;
 
-#if NO_CREATION_TIME
-# define our_creation_time	startup_time
-#else
-# define our_creation_time	bi.creation_time
-#endif
   return (clock_from_time_value (&now)
-	  - clock_from_time_value (&our_creation_time));
+	  - clock_from_time_value (&bi.creation_time));
 }
 weak_alias (__times, times)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mach/hurd/tmpfile.c libc-20030708/sysdeps/mach/hurd/tmpfile.c
--- glibc-2.3.2/sysdeps/mach/hurd/tmpfile.c	2002-06-13 05:57:55.000000000 +0900
+++ libc-20030708/sysdeps/mach/hurd/tmpfile.c	2003-04-28 23:53:24.000000000 +0900
@@ -1,5 +1,5 @@
 /* Open a stdio stream on an anonymous temporary file.  Hurd version.
-   Copyright (C) 2001,02 Free Software Foundation, Inc.
+   Copyright (C) 2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -23,19 +23,14 @@
 #include <hurd/fd.h>
 #include <fcntl.h>
 #include <unistd.h>
-
-#ifdef USE_IN_LIBIO
-# include <iolibio.h>
-# define __fdopen INTUSE(_IO_fdopen)
-# define tmpfile __new_tmpfile
-#endif
+#include <iolibio.h>
 
 /* This returns a new stream opened on a temporary file (generated
    by tmpnam).  The file is opened with mode "w+b" (binary read/write).
    If we couldn't generate a unique filename or the file couldn't
    be opened, NULL is returned.  */
 FILE *
-tmpfile (void)
+__tmpfile (void)
 {
   error_t err;
   file_t file;
@@ -62,16 +57,13 @@
 
   /* Open a stream on the unnamed file.
      It will cease to exist when this stream is closed.  */
-  if ((f = __fdopen (fd, "w+b")) == NULL)
+  if ((f = INTUSE(_IO_fdopen) (fd, "w+b")) == NULL)
     __close (fd);
 
   return f;
 }
 
-#ifdef USE_IN_LIBIO
-# undef tmpfile
-# include <shlib-compat.h>
-versioned_symbol (libc, __new_tmpfile, tmpfile, GLIBC_2_1);
-#endif
+#include <shlib-compat.h>
+versioned_symbol (libc, __tmpfile, tmpfile, GLIBC_2_1);
 
-weak_alias (tmpfile, tmpfile64)
+weak_alias (__tmpfile, tmpfile64)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/Implies libc-20030708/sysdeps/mips/Implies
--- glibc-2.3.2/sysdeps/mips/Implies	2000-01-29 16:28:21.000000000 +0900
+++ libc-20030708/sysdeps/mips/Implies	2003-04-01 21:01:02.000000000 +0900
@@ -1,4 +1,3 @@
-wordsize-32
 # MIPS uses IEEE 754 floating point.
 ieee754/flt-32
 ieee754/dbl-64
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/add_n.S libc-20030708/sysdeps/mips/add_n.S
--- glibc-2.3.2/sysdeps/mips/add_n.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/add_n.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS2 __mpn_add_n -- Add two limb vectors of the same length > 0 and
 store sum in a third limb vector.
 
-Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
 
 This file is part of the GNU MP Library.
 
@@ -43,12 +43,12 @@
 
 	addiu	$7,$7,-1
 	and	$9,$7,4-1	/* number of limbs in first loop */
-	beq	$9,$0,.L0	/* if multiple of 4 limbs, skip first loop */
+	beq	$9,$0,L(L0)	/* if multiple of 4 limbs, skip first loop */
 	move	$2,$0
 
 	subu	$7,$7,$9
 
-.Loop0:	addiu	$9,$9,-1
+L(Loop0):	addiu	$9,$9,-1
 	lw	$12,4($5)
 	addu	$11,$11,$2
 	lw	$13,4($6)
@@ -62,13 +62,13 @@
 	addiu	$6,$6,4
 	move	$10,$12
 	move	$11,$13
-	bne	$9,$0,.Loop0
-	 addiu	$4,$4,4
+	bne	$9,$0,L(Loop0)
+	addiu	$4,$4,4
 
-.L0:	beq	$7,$0,.Lend
-	 nop
+L(L0):	beq	$7,$0,L(end)
+	nop
 
-.Loop:	addiu	$7,$7,-4
+L(Loop):	addiu	$7,$7,-4
 
 	lw	$12,4($5)
 	addu	$11,$11,$2
@@ -109,10 +109,10 @@
 	addiu	$5,$5,16
 	addiu	$6,$6,16
 
-	bne	$7,$0,.Loop
-	 addiu	$4,$4,16
+	bne	$7,$0,L(Loop)
+	addiu	$4,$4,16
 
-.Lend:	addu	$11,$11,$2
+L(end):	addu	$11,$11,$2
 	sltu	$8,$11,$2
 	addu	$11,$10,$11
 	sltu	$2,$11,$10
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/addmul_1.S libc-20030708/sysdeps/mips/addmul_1.S
--- glibc-2.3.2/sysdeps/mips/addmul_1.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/addmul_1.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS __mpn_addmul_1 -- Multiply a limb vector with a single limb and
 add the product to a second limb vector.
 
-Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
 
 This file is part of the GNU MP Library.
 
@@ -46,14 +46,14 @@
 	multu	$8,$7
 
 	addiu	$6,$6,-1
-	beq	$6,$0,$LC0
+	beq	$6,$0,L(LC0)
 	move	$2,$0		/* zero cy2 */
 
 	addiu	$6,$6,-1
-	beq	$6,$0,$LC1
+	beq	$6,$0,L(LC1)
 	lw	$8,0($5)	/* load new s1 limb as early as possible */
 
-Loop:	lw	$10,0($4)
+L(Loop):	lw	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	addiu	$5,$5,4
@@ -67,11 +67,11 @@
 	addu	$2,$2,$10
 	sw	$3,0($4)
 	addiu	$4,$4,4
-	bne	$6,$0,Loop	/* should be "bnel" */
+	bne	$6,$0,L(Loop)	/* should be "bnel" */
 	addu	$2,$9,$2	/* add high product limb and carry from addition */
 
 	/* cool down phase 1 */
-$LC1:	lw	$10,0($4)
+L(LC1):	lw	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	addu	$3,$3,$2
@@ -85,7 +85,7 @@
 	addu	$2,$9,$2	/* add high product limb and carry from addition */
 
 	/* cool down phase 0 */
-$LC0:	lw	$10,0($4)
+L(LC0):	lw	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	addu	$3,$3,$2
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/atomicity.h libc-20030708/sysdeps/mips/atomicity.h
--- glibc-2.3.2/sysdeps/mips/atomicity.h	2002-07-16 09:52:17.000000000 +0900
+++ libc-20030708/sysdeps/mips/atomicity.h	2003-03-14 14:30:31.000000000 +0900
@@ -1,5 +1,5 @@
 /* Low-level functions for atomic operations. Mips version.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +32,9 @@
     ("/* Inline exchange & add */\n"
      "1:\n\t"
      ".set	push\n\t"
+#if _MIPS_SIM == _MIPS_SIM_ABI32
      ".set	mips2\n\t"
+#endif
      "ll	%0,%3\n\t"
      "addu	%1,%4,%0\n\t"
      "sc	%1,%2\n\t"
@@ -56,7 +58,9 @@
     ("/* Inline atomic add */\n"
      "1:\n\t"
      ".set	push\n\t"
+#if _MIPS_SIM == _MIPS_SIM_ABI32
      ".set	mips2\n\t"
+#endif
      "ll	%0,%2\n\t"
      "addu	%0,%3,%0\n\t"
      "sc	%0,%1\n\t"
@@ -78,12 +82,22 @@
     ("/* Inline compare & swap */\n"
      "1:\n\t"
      ".set	push\n\t"
+#if _MIPS_SIM == _MIPS_SIM_ABI32
      ".set	mips2\n\t"
+#endif
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+     "lld	%1,%5\n\t"
+#else
      "ll	%1,%5\n\t"
+#endif
      "move	%0,$0\n\t"
      "bne	%1,%3,2f\n\t"
      "move	%0,%4\n\t"
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+     "scd	%0,%2\n\t"
+#else
      "sc	%0,%2\n\t"
+#endif
      ".set	pop\n\t"
      "beqz	%0,1b\n"
      "2:\n\t"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/bits/endian.h libc-20030708/sysdeps/mips/bits/endian.h
--- glibc-2.3.2/sysdeps/mips/bits/endian.h	1997-11-26 12:52:55.000000000 +0900
+++ libc-20030708/sysdeps/mips/bits/endian.h	2003-04-01 21:01:02.000000000 +0900
@@ -5,4 +5,9 @@
 # error "Never use <bits/endian.h> directly; include <endian.h> instead."
 #endif
 
-#define __BYTE_ORDER __BIG_ENDIAN
+#if __MIPSEB
+# define __BYTE_ORDER __BIG_ENDIAN
+#endif
+#if __MIPSEL
+# define __BYTE_ORDER __LITTLE_ENDIAN
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/bits/setjmp.h libc-20030708/sysdeps/mips/bits/setjmp.h
--- glibc-2.3.2/sysdeps/mips/bits/setjmp.h	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/bits/setjmp.h	2003-03-21 07:29:44.000000000 +0900
@@ -1,5 +1,6 @@
 /* Define the machine-dependent type `jmp_buf'.  MIPS version.
-   Copyright (C) 1992,93,95,97,2000 Free Software Foundation, Inc.
+   Copyright (C) 1992, 1993, 1995, 1997, 2000, 2002, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -23,26 +24,47 @@
 
 typedef struct
   {
+#if _MIPS_SIM == _MIPS_SIM_ABI32
     /* Program counter.  */
-    void * __pc;
+    __ptr_t __pc;
 
     /* Stack pointer.  */
-    void * __sp;
+    __ptr_t __sp;
 
     /* Callee-saved registers s0 through s7.  */
     int __regs[8];
 
     /* The frame pointer.  */
-    void * __fp;
+    __ptr_t __fp;
 
     /* The global pointer.  */
-    void * __gp;
+    __ptr_t __gp;
+#else
+    /* Program counter.  */
+    __extension__ long long __pc;
+
+    /* Stack pointer.  */
+    __extension__ long long __sp;
+
+    /* Callee-saved registers s0 through s7.  */
+    __extension__ long long __regs[8];
+
+    /* The frame pointer.  */
+    __extension__ long long __fp;
+
+    /* The global pointer.  */
+    __extension__ long long __gp;
+#endif
 
     /* Floating point status register.  */
     int __fpc_csr;
 
     /* Callee-saved floating point registers.  */
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+    double __fpregs[8];
+#else
     double __fpregs[6];
+#endif
   } __jmp_buf[1];
 
 #ifdef __USE_MISC
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/bits/wordsize.h libc-20030708/sysdeps/mips/bits/wordsize.h
--- glibc-2.3.2/sysdeps/mips/bits/wordsize.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/bits/wordsize.h	2003-03-18 00:47:12.000000000 +0900
@@ -0,0 +1,19 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define __WORDSIZE	_MIPS_SZPTR
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/dl-machine.h libc-20030708/sysdeps/mips/dl-machine.h
--- glibc-2.3.2/sysdeps/mips/dl-machine.h	2003-02-12 18:42:22.000000000 +0900
+++ libc-20030708/sysdeps/mips/dl-machine.h	2003-03-22 21:50:46.000000000 +0900
@@ -32,6 +32,8 @@
 #error ENTRY_POINT needs to be defined for MIPS.
 #endif
 
+#include <sys/asm.h>
+
 /* The offset of gp from GOT might be system-dependent.  It's set by
    ld.  The same value is also */
 #define OFFSET_GP_GOT 0x7ff0
@@ -72,6 +74,13 @@
 static inline int __attribute_used__
 elf_machine_matches_host (const ElfW(Ehdr) *ehdr)
 {
+#if _MIPS_SIM == _MIPS_SIM_ABI32 || _MIPS_SIM == _MIPS_SIM_NABI32
+  /* Don't link o32 and n32 together.  */
+  if (((ehdr->e_flags & EF_MIPS_ABI2) != 0)
+      != (_MIPS_SIM != _MIPS_SIM_ABI32))
+    return 0;
+#endif
+
   switch (ehdr->e_machine)
     {
     case EM_MIPS:
@@ -91,7 +100,7 @@
 
 /* Return the link-time address of _DYNAMIC.  Conveniently, this is the
    first element of the GOT.  This must be inlined in a function which
-   uses global data.  */
+   uses global data.  We assume its $gp points to the primary GOT.  */
 static inline ElfW(Addr)
 elf_machine_dynamic (void)
 {
@@ -99,6 +108,9 @@
   return *elf_mips_got_from_gpreg (gp);
 }
 
+#define STRINGXP(X) __STRING(X)
+#define STRINGXV(X) STRINGV_(X)
+#define STRINGV_(...) # __VA_ARGS__
 
 /* Return the run-time load address of the shared object.  */
 static inline ElfW(Addr)
@@ -106,10 +118,10 @@
 {
   ElfW(Addr) addr;
   asm ("	.set noreorder\n"
-       "	la %0, here\n"
-       "	bltzal $0, here\n"
+       "	" STRINGXP (PTR_LA) " %0, 0f\n"
+       "	bltzal $0, 0f\n"
        "	nop\n"
-       "here:	subu %0, $31, %0\n"
+       "0:	" STRINGXP (PTR_SUBU) " %0, $31, %0\n"
        "	.set reorder\n"
        :	"=r" (addr)
        :	/* No inputs */
@@ -118,7 +130,11 @@
 }
 
 /* The MSB of got[1] of a gnu object is set to identify gnu objects.  */
-#define ELF_MIPS_GNU_GOT1_MASK	0x80000000
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+# define ELF_MIPS_GNU_GOT1_MASK	0x8000000000000000L
+#else
+# define ELF_MIPS_GNU_GOT1_MASK	0x80000000L
+#endif
 
 /* We can't rely on elf_machine_got_rel because _dl_object_relocation_scope
    fiddles with global data.  */
@@ -242,6 +258,55 @@
   return NULL;
 }
 
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+#define ELF_DL_FRAME_SIZE 40
+
+#define ELF_DL_SAVE_ARG_REGS "\
+	sw	$15, 36($29)\n						      \
+	sw	$4, 16($29)\n						      \
+	sw	$5, 20($29)\n						      \
+	sw	$6, 24($29)\n						      \
+	sw	$7, 28($29)\n						      \
+"
+
+#define ELF_DL_RESTORE_ARG_REGS "\
+	lw	$31, 36($29)\n						      \
+	lw	$4, 16($29)\n						      \
+	lw	$5, 20($29)\n						      \
+	lw	$6, 24($29)\n						      \
+	lw	$7, 28($29)\n						      \
+"
+
+#define IFABIO32(X) X
+
+#else /* _MIPS_SIM == _MIPS_SIM_NABI32 || _MIPS_SIM == _MIPS_SIM_ABI64 */
+
+#define ELF_DL_FRAME_SIZE 64
+
+#define ELF_DL_SAVE_ARG_REGS "\
+	sd	$15, 56($29)\n						      \
+	sd	$4, 8($29)\n						      \
+	sd	$5, 16($29)\n						      \
+	sd	$6, 24($29)\n						      \
+	sd	$7, 32($29)\n						      \
+	sd	$8, 40($29)\n						      \
+	sd	$9, 48($29)\n						      \
+"
+
+#define ELF_DL_RESTORE_ARG_REGS "\
+	ld	$31, 56($29)\n						      \
+	ld	$4, 8($29)\n						      \
+	ld	$5, 16($29)\n						      \
+	ld	$6, 24($29)\n						      \
+	ld	$7, 32($29)\n						      \
+	ld	$8, 40($29)\n						      \
+	ld	$9, 48($29)\n						      \
+"
+
+#define IFABIO32(X)
+
+#endif
+
 /* Define mips specific runtime resolver. The function __dl_runtime_resolve
    is called from assembler function _dl_runtime_resolve which converts
    special argument registers t7 ($15) and t8 ($24):
@@ -272,9 +337,8 @@
 {									      \
   struct link_map *l = elf_machine_runtime_link_map (old_gpreg, stub_pc);     \
   const ElfW(Sym) *const symtab						      \
-    = (const void *) D_PTR (l, l_info[DT_SYMTAB]);			      \
-  const char *strtab							      \
-    = (const void *) D_PTR (l, l_info[DT_STRTAB]);			      \
+    = (const ElfW(Sym) *) D_PTR (l, l_info[DT_SYMTAB]);			      \
+  const char *strtab = (const void *) D_PTR (l, l_info[DT_STRTAB]);	      \
   ElfW(Addr) *got							      \
     = (ElfW(Addr) *) D_PTR (l, l_info[DT_PLTGOT]);			      \
   const ElfW(Word) local_gotno						      \
@@ -333,36 +397,30 @@
 	.type	_dl_runtime_resolve,@function\n				      \
 	.ent	_dl_runtime_resolve\n					      \
 _dl_runtime_resolve:\n							      \
-	.frame	$29, 40, $31\n						      \
+	.frame	$29, " STRINGXP(ELF_DL_FRAME_SIZE) ", $31\n		      \
 	.set noreorder\n						      \
 	# Save GP.\n							      \
 	move	$3, $28\n						      \
+	# Save arguments and sp value in stack.\n			      \
+	" STRINGXP(PTR_SUBIU) "  $29, " STRINGXP(ELF_DL_FRAME_SIZE) "\n	      \
 	# Modify t9 ($25) so as to point .cpload instruction.\n		      \
-	addu	$25, 8\n						      \
+	" IFABIO32(STRINGXP(PTR_ADDIU) "	$25, 12\n") "		      \
 	# Compute GP.\n							      \
-	.cpload $25\n							      \
+	" STRINGXP(SETUP_GP) "\n					      \
+	" STRINGXV(SETUP_GP64 (0, _dl_runtime_resolve)) "\n		      \
 	.set reorder\n							      \
 	# Save slot call pc.\n						      \
 	move	$2, $31\n						      \
-	# Save arguments and sp value in stack.\n			      \
-	subu	$29, 40\n						      \
-	.cprestore 32\n							      \
-	sw	$15, 36($29)\n						      \
-	sw	$4, 16($29)\n						      \
-	sw	$5, 20($29)\n						      \
-	sw	$6, 24($29)\n						      \
-	sw	$7, 28($29)\n						      \
+	" IFABIO32(STRINGXP(CPRESTORE(32))) "\n				      \
+	" ELF_DL_SAVE_ARG_REGS "					      \
 	move	$4, $24\n						      \
 	move	$5, $15\n						      \
 	move	$6, $3\n						      \
 	move	$7, $2\n						      \
 	jal	__dl_runtime_resolve\n					      \
-	lw	$31, 36($29)\n						      \
-	lw	$4, 16($29)\n						      \
-	lw	$5, 20($29)\n						      \
-	lw	$6, 24($29)\n						      \
-	lw	$7, 28($29)\n						      \
-	addu	$29, 40\n						      \
+	" ELF_DL_RESTORE_ARG_REGS "					      \
+	" STRINGXP(RESTORE_GP64) "\n					      \
+	" STRINGXP(PTR_ADDIU) "	$29, " STRINGXP(ELF_DL_FRAME_SIZE) "\n	      \
 	move	$25, $2\n						      \
 	jr	$25\n							      \
 	.end	_dl_runtime_resolve\n					      \
@@ -374,7 +432,6 @@
 #define ELF_MACHINE_USER_ADDRESS_MASK	0x80000000UL
 
 
-
 /* Initial entry point code for the dynamic linker.
    The C function `_dl_start' is the real entry point;
    its return value is the user program's entry point.
@@ -392,71 +449,71 @@
 
 #define RTLD_START asm (\
 	".text\n"\
-	_RTLD_PROLOGUE(ENTRY_POINT)\
-	".set noreorder\n\
-	bltzal $0, 0f\n\
-	nop\n\
-0:	.cpload $31\n\
-	.set reorder\n\
+	_RTLD_PROLOGUE(ENTRY_POINT) "\
+	" STRINGXV(SETUP_GPX($25)) "\n\
+	" STRINGXV(SETUP_GPX64($18,$25)) "\n\
 	# i386 ABI book says that the first entry of GOT holds\n\
 	# the address of the dynamic structure. Though MIPS ABI\n\
 	# doesn't say nothing about this, I emulate this here.\n\
-	la $4, _DYNAMIC\n\
+	" STRINGXP(PTR_LA) " $4, _DYNAMIC\n\
 	# Subtract OFFSET_GP_GOT\n\
-	sw $4, -0x7ff0($28)\n\
+	" STRINGXP(PTR_S) " $4, -0x7ff0($28)\n\
 	move $4, $29\n\
-	subu $29, 16\n\
+	" STRINGXP(PTR_SUBIU) " $29, 16\n\
 	\n\
-	la $8, coff\n\
-	bltzal $8, coff\n\
-coff:	subu $8, $31, $8\n\
+	" STRINGXP(PTR_LA) " $8, .Lcoff\n\
+	bltzal $8, .Lcoff\n\
+.Lcoff:	" STRINGXP(PTR_SUBU) " $8, $31, $8\n\
 	\n\
-	la $25, _dl_start\n\
-	addu $25, $8\n\
+	" STRINGXP(PTR_LA) " $25, _dl_start\n\
+	" STRINGXP(PTR_ADDU) " $25, $8\n\
 	jalr $25\n\
 	\n\
-	addiu $29, 16\n\
+	" STRINGXP(PTR_ADDIU) " $29, 16\n\
 	# Get the value of label '_dl_start_user' in t9 ($25).\n\
-	la $25, _dl_start_user\n\
+	" STRINGXP(PTR_LA) " $25, _dl_start_user\n\
 	.globl _dl_start_user\n\
+	.type _dl_start_user,@function\n\
+	.ent _dl_start_user\n\
 _dl_start_user:\n\
-	.set noreorder\n\
-	.cpload $25\n\
-	.set reorder\n\
+	" STRINGXP(SETUP_GP) "\n\
+	" STRINGXV(SETUP_GP64($18,_dl_start_user)) "\n\
 	move $16, $28\n\
 	# Save the user entry point address in a saved register.\n\
 	move $17, $2\n\
 	# Store the highest stack address\n\
-	sw $29, __libc_stack_end\n\
+	" STRINGXP(PTR_S) " $29, __libc_stack_end\n\
 	# See if we were run as a command with the executable file\n\
 	# name as an extra leading argument.\n\
 	lw $2, _dl_skip_args\n\
 	beq $2, $0, 1f\n\
 	# Load the original argument count.\n\
-	lw $4, 0($29)\n\
+	" STRINGXP(PTR_L) " $4, 0($29)\n\
 	# Subtract _dl_skip_args from it.\n\
 	subu $4, $2\n\
 	# Adjust the stack pointer to skip _dl_skip_args words.\n\
-	sll $2, 2\n\
-	addu $29, $2\n\
+	sll $2, " STRINGXP (PTRLOG) "\n\
+	" STRINGXP(PTR_ADDU) " $29, $2\n\
 	# Save back the modified argument count.\n\
-	sw $4, 0($29)\n\
+	" STRINGXP(PTR_S) " $4, 0($29)\n\
 1:	# Call _dl_init (struct link_map *main_map, int argc, char **argv, char **env) \n\
-	lw $4, _rtld_local\n\
-	lw $5, 0($29)\n\
-	la $6, 4($29)\n\
-	sll $7, $5, 2\n\
-	addu $7, $7, $6\n\
-	addu $7, $7, 4\n\
-	subu $29, 16\n\
+	" STRINGXP(PTR_L) " $4, _rtld_local\n\
+	" STRINGXP(PTR_L) /* or lw???  fixme */ " $5, 0($29)\n\
+	" STRINGXP(PTR_LA) " $6, " STRINGXP (PTRSIZE) "($29)\n\
+	sll $7, $5, " STRINGXP (PTRLOG) "\n\
+	" STRINGXP(PTR_ADDU) " $7, $7, $6\n\
+	" STRINGXP(PTR_ADDU) " $7, $7, " STRINGXP (PTRSIZE) " \n\
+	" STRINGXP(PTR_SUBIU) " $29, 32\n\
+	" STRINGXP(SAVE_GP(16)) "\n\
 	# Call the function to run the initializers.\n\
 	jal _dl_init_internal\n\
-	addiu $29, 16\n\
+	" STRINGXP(PTR_ADDIU)  " $29, 32\n\
 	# Pass our finalizer function to the user in $2 as per ELF ABI.\n\
-	la $2, _dl_fini\n\
+	" STRINGXP(PTR_LA) " $2, _dl_fini\n\
 	# Jump to the user entry point.\n\
 	move $25, $17\n\
-	jr $25\n\t"\
+	jr $25\n\
+	.end _dl_start_user\n\t"\
 	_RTLD_EPILOGUE(ENTRY_POINT)\
 	".previous"\
 );
@@ -472,9 +529,15 @@
    MAP is the object containing the reloc.  */
 
 static inline void
+#ifdef RTLD_BOOTSTRAP
+  __attribute__ ((always_inline))
+#endif
 elf_machine_rel (struct link_map *map, const ElfW(Rel) *reloc,
 		 const ElfW(Sym) *sym, const struct r_found_version *version,
-		 ElfW(Addr) *const reloc_addr)
+		 /* We use void* because the location to be relocated
+		    is not required to be properly aligned for a
+		    ELFW(Addr).  */
+		 void /* ElfW(Addr) */ *const reloc_addr)
 {
   const unsigned long int r_type = ELFW(R_TYPE) (reloc->r_info);
 
@@ -490,21 +553,46 @@
 
   switch (r_type)
     {
+#if _MIPS_SIM == _MIPS_SIM_ABI64
+    case (R_MIPS_64 << 8) | R_MIPS_REL32:
+#else
     case R_MIPS_REL32:
+#endif
       {
 	int symidx = ELFW(R_SYM) (reloc->r_info);
+	ElfW(Addr) reloc_value;
+
+	/* Support relocations on mis-aligned offsets.  Should we ever
+	   implement RELA, this should be replaced with an assignment
+	   from reloc->r_addend.  */
+	__builtin_memcpy (&reloc_value, reloc_addr, sizeof (reloc_value));
 
 	if (symidx)
 	  {
 	    const ElfW(Word) gotsym
 	      = (const ElfW(Word)) map->l_info[DT_MIPS (GOTSYM)]->d_un.d_val;
 
-	    if (symidx < gotsym)
+	    if ((ElfW(Word))symidx < gotsym)
 	      {
+		/* This wouldn't work for a symbol imported from other
+		   libraries for which there's no GOT entry, but MIPS
+		   requires every symbol referenced in a dynamic
+		   relocation to have a GOT entry in the primary GOT,
+		   so we only get here for locally-defined symbols.
+		   For section symbols, we should *NOT* be adding
+		   sym->st_value (per the definition of the meaning of
+		   S in reloc expressions in the ELF64 MIPS ABI),
+		   since it should have already been added to
+		   reloc_value by the linker, but older versions of
+		   GNU ld didn't add it, and newer versions don't emit
+		   useless relocations to section symbols any more, so
+		   it is safe to keep on adding sym->st_value, even
+		   though it's not ABI compliant.  Some day we should
+		   bite the bullet and stop doing this.  */
 #ifndef RTLD_BOOTSTRAP
 		if (map != &GL(dl_rtld_map))
 #endif
-		  *reloc_addr += sym->st_value + map->l_addr;
+		  reloc_value += sym->st_value + map->l_addr;
 	      }
 	    else
 	      {
@@ -515,7 +603,7 @@
 		  = (const ElfW(Word))
 		    map->l_info[DT_MIPS (LOCAL_GOTNO)]->d_un.d_val;
 
-		*reloc_addr += got[symidx + local_gotno - gotsym];
+		reloc_value += got[symidx + local_gotno - gotsym];
 #endif
 	      }
 	  }
@@ -523,11 +611,27 @@
 #ifndef RTLD_BOOTSTRAP
 	  if (map != &GL(dl_rtld_map))
 #endif
-	    *reloc_addr += map->l_addr;
+	    reloc_value += map->l_addr;
+
+	__builtin_memcpy (reloc_addr, &reloc_value, sizeof (reloc_value));
       }
       break;
     case R_MIPS_NONE:		/* Alright, Wilbur.  */
       break;
+#if _MIPS_SIM == _MIPS_SIM_ABI64
+    case R_MIPS_64:
+      /* For full compliance with the ELF64 ABI, one must precede the
+	 _REL32/_64 pair of relocations with a _64 relocation, such
+	 that the in-place addend is read as a 64-bit value.  IRIX
+	 didn't pick up on this requirement, so we treat the
+	 _REL32/_64 relocation as a 64-bit relocation even if it's by
+	 itself.  For ABI compliance, we ignore such _64 dummy
+	 relocations.  For RELA, this may be simply removed, since
+	 it's totally unnecessary.  */
+      if (ELFW(R_SYM) (reloc->r_info) == 0)
+	break;
+      /* Fall through.  */
+#endif
     default:
       _dl_reloc_bad_type (map, r_type, 0);
       break;
@@ -536,7 +640,7 @@
 
 static inline void
 elf_machine_rel_relative (ElfW(Addr) l_addr, const ElfW(Rel) *reloc,
-			  ElfW(Addr) *const reloc_addr)
+			  void /* ElfW(Addr) */ *const reloc_addr)
 {
   /* XXX Nothing to do.  There is no relative relocation, right?  */
 }
@@ -661,7 +765,7 @@
 	 of got[1] of a gnu object is set to identify gnu objects.
 	 Where we can store l for non gnu objects? XXX  */
       if ((got[1] & ELF_MIPS_GNU_GOT1_MASK) != 0)
-	got[1] = (ElfW(Addr)) ((unsigned) l | ELF_MIPS_GNU_GOT1_MASK);
+	got[1] = ((ElfW(Addr)) l | ELF_MIPS_GNU_GOT1_MASK);
       else
 	_dl_mips_gnu_objects = 0;
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/elf/ldsodefs.h libc-20030708/sysdeps/mips/elf/ldsodefs.h
--- glibc-2.3.2/sysdeps/mips/elf/ldsodefs.h	2002-02-07 07:56:54.000000000 +0900
+++ libc-20030708/sysdeps/mips/elf/ldsodefs.h	2003-03-23 00:07:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Run-time dynamic linker data structures for loaded ELF shared objects.
-   Copyright (C) 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,9 +17,93 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#ifndef _MIPS_LDSODEFS_H
+#define _MIPS_LDSODEFS_H
 
 /* The MIPS ABI specifies that the dynamic section has to be read-only.  */
 
 #define DL_RO_DYN_SECTION 1
 
 #include_next <ldsodefs.h>
+
+/* The 64-bit MIPS ELF ABI uses an unusual reloc format.  Each
+   relocation entry specifies up to three actual relocations, all at
+   the same address.  The first relocation which required a symbol
+   uses the symbol in the r_sym field.  The second relocation which
+   requires a symbol uses the symbol in the r_ssym field.  If all
+   three relocations require a symbol, the third one uses a zero
+   value.
+
+   We define these structures in internal headers because we're not
+   sure we want to make them part of the ABI yet.  Eventually, some of
+   this may move into elf/elf.h.  */
+
+/* An entry in a 64 bit SHT_REL section.  */
+
+typedef struct
+{
+  Elf32_Word    r_sym;		/* Symbol index */
+  unsigned char r_ssym;		/* Special symbol for 2nd relocation */
+  unsigned char r_type3;	/* 3rd relocation type */
+  unsigned char r_type2;	/* 2nd relocation type */
+  unsigned char r_type1;	/* 1st relocation type */
+} _Elf64_Mips_R_Info;
+
+typedef union
+{
+  Elf64_Xword	r_info_number;
+  _Elf64_Mips_R_Info r_info_fields;
+} _Elf64_Mips_R_Info_union;
+
+typedef struct
+{
+  Elf64_Addr	r_offset;		/* Address */
+  _Elf64_Mips_R_Info_union r_info;	/* Relocation type and symbol index */
+} Elf64_Mips_Rel;
+
+typedef struct
+{
+  Elf64_Addr	r_offset;		/* Address */
+  _Elf64_Mips_R_Info_union r_info;	/* Relocation type and symbol index */
+  Elf64_Sxword	r_addend;		/* Addend */
+} Elf64_Mips_Rela;
+
+#define ELF64_MIPS_R_SYM(i) \
+  ((__extension__ (_Elf64_Mips_R_Info_union)(i)).r_info_fields.r_sym)
+#define ELF64_MIPS_R_TYPE(i) \
+  (((_Elf64_Mips_R_Info_union)(i)).r_info_fields.r_type1 \
+   | ((Elf32_Word)(__extension__ (_Elf64_Mips_R_Info_union)(i) \
+		   ).r_info_fields.r_type2 << 8) \
+   | ((Elf32_Word)(__extension__ (_Elf64_Mips_R_Info_union)(i) \
+		   ).r_info_fields.r_type3 << 16) \
+   | ((Elf32_Word)(__extension__ (_Elf64_Mips_R_Info_union)(i) \
+		   ).r_info_fields.r_ssym << 24))
+#define ELF64_MIPS_R_INFO(sym, type) \
+  (__extension__ (_Elf64_Mips_R_Info_union) \
+   (__extension__ (_Elf64_Mips_R_Info) \
+   { (sym), ELF64_MIPS_R_SSYM (type), \
+       ELF64_MIPS_R_TYPE3 (type), \
+       ELF64_MIPS_R_TYPE2 (type), \
+       ELF64_MIPS_R_TYPE1 (type) \
+   }).r_info_number)
+/* These macros decompose the value returned by ELF64_MIPS_R_TYPE, and
+   compose it back into a value that it can be used as an argument to
+   ELF64_MIPS_R_INFO.  */
+#define ELF64_MIPS_R_SSYM(i) (((i) >> 24) & 0xff)
+#define ELF64_MIPS_R_TYPE3(i) (((i) >> 16) & 0xff)
+#define ELF64_MIPS_R_TYPE2(i) (((i) >> 8) & 0xff)
+#define ELF64_MIPS_R_TYPE1(i) ((i) & 0xff)
+#define ELF64_MIPS_R_TYPEENC(type1, type2, type3, ssym) \
+  ((type1) \
+   | ((Elf32_Word)(type2) << 8) \
+   | ((Elf32_Word)(type3) << 16) \
+   | ((Elf32_Word)(ssym) << 24))
+
+#undef ELF64_R_SYM
+#define ELF64_R_SYM(i) ELF64_MIPS_R_SYM (i)
+#undef ELF64_R_TYPE
+#define ELF64_R_TYPE(i) ELF64_MIPS_R_TYPE (i)
+#undef ELF64_R_INFO
+#define ELF64_R_INFO(sym, type) ELF64_MIPS_R_INFO ((sym), (type))
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/elf/start.S libc-20030708/sysdeps/mips/elf/start.S
--- glibc-2.3.2/sysdeps/mips/elf/start.S	2002-12-10 12:41:54.000000000 +0900
+++ libc-20030708/sysdeps/mips/elf/start.S	2003-03-18 00:47:12.000000000 +0900
@@ -1,5 +1,6 @@
 /* Startup code compliant to the ELF Mips ABI.
-   Copyright (C) 1995, 1997, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995, 1997, 2000, 2001, 2002, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,6 +20,7 @@
 
 #define __ASSEMBLY__ 1
 #include <entry.h>
+#include <sys/asm.h>
 
 #ifndef ENTRY_POINT
 #error ENTRY_POINT needs to be defined for start.S on MIPS/ELF.
@@ -52,42 +54,41 @@
 		      char **argv, void (*init) (void), void (*fini) (void),
 		      void (*rtld_fini) (void), void *stack_end)
 */
-#ifdef __PIC__
-/* A macro to (re)initialize gp. We can get the run time address of 0f in
-   ra ($31) by blezal instruction. In this early phase, we can't save gp
-   in stack and .cprestore doesn't work properly. So we set gp by using
-   this macro. */
-#define SET_GP \
-	.set noreorder;	\
-	bltzal $0,0f;	\
-	nop;		\
-0:	.cpload $31;	\
-	.set reorder;
-#endif
-
+	
 	.text
 	.globl ENTRY_POINT
 	.type ENTRY_POINT,@function
 ENTRY_POINT:
 #ifdef __PIC__
-	SET_GP
+	SETUP_GPX($0)
+	SETUP_GPX64($25,$0)
 #else
-	la $28, _gp		/* Setup GP correctly if we're non-PIC.  */
-#endif
+	PTR_LA $28, _gp		/* Setup GP correctly if we're non-PIC.  */
 	move $31, $0
+#endif
 
-	la $4, main		/* main */
-	lw $5, 0($29)		/* argc */
-	addu $6, $29, 4		/* argv  */
-	/* Allocate space on the stack for seven arguments and make sure
-	   the stack is aligned to double words (8 bytes).  */
-	and $29, 0xfffffff8
-	subu $29, 32
-	la $7, __libc_csu_init		/* init */
-	la $8, __libc_csu_fini
-	sw $8, 16($29)		/* fini */
-	sw $2, 20($29)		/* rtld_fini */
-	sw $29, 24($29)		/* stack_end */
+	PTR_LA $4, main		/* main */
+	PTR_L $5, 0($29)		/* argc */
+	PTR_ADDIU $6, $29, PTRSIZE	/* argv  */
+	
+	/* Allocate space on the stack for seven arguments (o32 only)
+	   and make sure the stack is aligned to double words (8 bytes) 
+	   on o32 and quad words (16 bytes) on n32 and n64.  */
+	
+	and $29, -2 * SZREG
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+	PTR_SUBIU $29, 32
+#endif
+	PTR_LA $7, __libc_csu_init		/* init */
+	PTR_LA $8, __libc_csu_fini
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+	PTR_S $8, 16($29)		/* fini */
+	PTR_S $2, 20($29)		/* rtld_fini */
+	PTR_S $29, 24($29)		/* stack_end */
+#else
+	move $9, $2		/* rtld_fini */
+	move $10, $29		/* stack_end */
+#endif
 	jal __libc_start_main
 hlt:	b hlt			/* Crash if somehow it does return.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/fpu/bits/mathdef.h libc-20030708/sysdeps/mips/fpu/bits/mathdef.h
--- glibc-2.3.2/sysdeps/mips/fpu/bits/mathdef.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/fpu/bits/mathdef.h	2003-03-15 00:30:43.000000000 +0900
@@ -0,0 +1,48 @@
+/* Copyright (C) 1997, 1998, 1999, 2000, 2002, 2003
+	Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#if !defined _MATH_H && !defined _COMPLEX_H
+# error "Never use <bits/mathdef.h> directly; include <math.h> instead"
+#endif
+
+#if defined  __USE_ISOC99 && defined _MATH_H && !defined _MATH_H_MATHDEF
+# define _MATH_H_MATHDEF	1
+
+/* Normally, there is no long double type and the `float' and `double'
+   expressions are evaluated as `double'.  */
+typedef double float_t;		/* `float' expressions are evaluated as
+				   `double'.  */
+typedef double double_t;	/* `double' expressions are evaluated as
+				   `double'.  */
+
+/* Define `INFINITY' as value of type `float'.  */
+# define INFINITY	HUGE_VALF
+
+
+/* The values returned by `ilogb' for 0 and NaN respectively.  */
+# define FP_ILOGB0	(-2147483647)
+# define FP_ILOGBNAN	2147483647
+
+#endif	/* ISO C99 */
+
+#if ! defined __NO_LONG_DOUBLE_MATH && _MIPS_SIM == _MIPS_SIM_ABI32
+/* Signal that we do not really have a `long double'.  This disables the
+   declaration of all the `long double' function variants.  */
+# define __NO_LONG_DOUBLE_MATH	1
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/fpu/libm-test-ulps libc-20030708/sysdeps/mips/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/mips/fpu/libm-test-ulps	2002-10-16 08:39:37.000000000 +0900
+++ libc-20030708/sysdeps/mips/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -94,7 +94,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
@@ -107,10 +107,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
@@ -145,7 +145,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -239,7 +239,7 @@
 ifloat: 2
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
@@ -258,7 +258,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -266,7 +266,7 @@
 idouble: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -453,12 +453,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -513,7 +513,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/ieee754.h libc-20030708/sysdeps/mips/ieee754.h
--- glibc-2.3.2/sysdeps/mips/ieee754.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/ieee754.h	2003-03-21 02:59:45.000000000 +0900
@@ -0,0 +1,325 @@
+/* Copyright (C) 1992, 1995, 1996, 1999, 2002, 2003
+	Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _IEEE754_H
+
+#define _IEEE754_H 1
+#include <features.h>
+
+#include <endian.h>
+
+#include <float.h>
+
+__BEGIN_DECLS
+
+union ieee754_float
+  {
+    float f;
+
+    /* This is the IEEE 754 single-precision format.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:8;
+	unsigned int mantissa:23;
+#endif				/* Big endian.  */
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+	unsigned int mantissa:23;
+	unsigned int exponent:8;
+	unsigned int negative:1;
+#endif				/* Little endian.  */
+      } ieee;
+
+    /* This format makes it easier to see if a NaN is a signalling NaN.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:8;
+	unsigned int quiet_nan:1;
+	unsigned int mantissa:22;
+#endif				/* Big endian.  */
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+	unsigned int mantissa:22;
+	unsigned int quiet_nan:1;
+	unsigned int exponent:8;
+	unsigned int negative:1;
+#endif				/* Little endian.  */
+      } ieee_nan;
+  };
+
+#define IEEE754_FLOAT_BIAS	0x7f /* Added to exponent.  */
+
+
+union ieee754_double
+  {
+    double d;
+
+    /* This is the IEEE 754 double-precision format.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:11;
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa0:20;
+	unsigned int mantissa1:32;
+#endif				/* Big endian.  */
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+# if	__FLOAT_WORD_ORDER == BIG_ENDIAN
+	unsigned int mantissa0:20;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+	unsigned int mantissa1:32;
+# else
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:20;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+# endif
+#endif				/* Little endian.  */
+      } ieee;
+
+    /* This format makes it easier to see if a NaN is a signalling NaN.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:11;
+	unsigned int quiet_nan:1;
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa0:19;
+	unsigned int mantissa1:32;
+#else
+# if	__FLOAT_WORD_ORDER == BIG_ENDIAN
+	unsigned int mantissa0:19;
+	unsigned int quiet_nan:1;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+	unsigned int mantissa1:32;
+# else
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:19;
+	unsigned int quiet_nan:1;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+# endif
+#endif
+      } ieee_nan;
+  };
+
+#define IEEE754_DOUBLE_BIAS	0x3ff /* Added to exponent.  */
+
+#if LDBL_MANT_DIG == 113
+
+union ieee854_long_double
+  {
+    long double d;
+
+    /* This is the IEEE 854 quad-precision format.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:15;
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa0:16;
+	unsigned int mantissa1:32;
+	unsigned int mantissa2:32;
+	unsigned int mantissa3:32;
+#endif				/* Big endian.  */
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa3:32;
+	unsigned int mantissa2:32;
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:16;
+	unsigned int exponent:15;
+	unsigned int negative:1;
+#endif				/* Little endian.  */
+      } ieee;
+
+    /* This format makes it easier to see if a NaN is a signalling NaN.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:15;
+	unsigned int quiet_nan:1;
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa0:15;
+	unsigned int mantissa1:32;
+	unsigned int mantissa2:32;
+	unsigned int mantissa3:32;
+#endif				/* Big endian.  */
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa3:32;
+	unsigned int mantissa2:32;
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:15;
+	unsigned int quiet_nan:1;
+	unsigned int exponent:15;
+	unsigned int negative:1;
+#endif				/* Little endian.  */
+      } ieee_nan;
+  };
+
+#define IEEE854_LONG_DOUBLE_BIAS 0x3fff /* Added to exponent.  */
+
+#elif LDBL_MANT_DIG == 64
+
+union ieee854_long_double
+  {
+    long double d;
+
+    /* This is the IEEE 854 double-extended-precision format.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:15;
+	unsigned int empty:16;
+	unsigned int mantissa0:32;
+	unsigned int mantissa1:32;
+#endif
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+# if	__FLOAT_WORD_ORDER == BIG_ENDIAN
+	unsigned int exponent:15;
+	unsigned int negative:1;
+	unsigned int empty:16;
+	unsigned int mantissa0:32;
+	unsigned int mantissa1:32;
+# else
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:32;
+	unsigned int exponent:15;
+	unsigned int negative:1;
+	unsigned int empty:16;
+# endif
+#endif
+      } ieee;
+
+    /* This is for NaNs in the IEEE 854 double-extended-precision format.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:15;
+	unsigned int empty:16;
+	unsigned int one:1;
+	unsigned int quiet_nan:1;
+	unsigned int mantissa0:30;
+	unsigned int mantissa1:32;
+#endif
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+# if	__FLOAT_WORD_ORDER == BIG_ENDIAN
+	unsigned int exponent:15;
+	unsigned int negative:1;
+	unsigned int empty:16;
+	unsigned int mantissa0:30;
+	unsigned int quiet_nan:1;
+	unsigned int one:1;
+	unsigned int mantissa1:32;
+# else
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:30;
+	unsigned int quiet_nan:1;
+	unsigned int one:1;
+	unsigned int exponent:15;
+	unsigned int negative:1;
+	unsigned int empty:16;
+# endif
+#endif
+      } ieee_nan;
+  };
+
+#define IEEE854_LONG_DOUBLE_BIAS 0x3fff
+
+#elif LDBL_MANT_DIG == 53
+
+union ieee854_long_double
+  {
+    long double d;
+
+    /* This is the IEEE 754 double-precision format.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:11;
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa0:20;
+	unsigned int mantissa1:32;
+#endif				/* Big endian.  */
+#if	__BYTE_ORDER == __LITTLE_ENDIAN
+# if	__FLOAT_WORD_ORDER == BIG_ENDIAN
+	unsigned int mantissa0:20;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+	unsigned int mantissa1:32;
+# else
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:20;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+# endif
+#endif				/* Little endian.  */
+      } ieee;
+
+    /* This format makes it easier to see if a NaN is a signalling NaN.  */
+    struct
+      {
+#if	__BYTE_ORDER == __BIG_ENDIAN
+	unsigned int negative:1;
+	unsigned int exponent:11;
+	unsigned int quiet_nan:1;
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa0:19;
+	unsigned int mantissa1:32;
+#else
+# if	__FLOAT_WORD_ORDER == BIG_ENDIAN
+	unsigned int mantissa0:19;
+	unsigned int quiet_nan:1;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+	unsigned int mantissa1:32;
+# else
+	/* Together these comprise the mantissa.  */
+	unsigned int mantissa1:32;
+	unsigned int mantissa0:19;
+	unsigned int quiet_nan:1;
+	unsigned int exponent:11;
+	unsigned int negative:1;
+# endif
+#endif
+      } ieee_nan;
+  };
+
+#define IEEE854_LONG_DOUBLE_BIAS	0x3ff /* Added to exponent.  */
+
+#endif /* LDBL_MANT_DIG == 53 */
+
+__END_DECLS
+
+#endif /* ieee754.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/lshift.S libc-20030708/sysdeps/mips/lshift.S
--- glibc-2.3.2/sysdeps/mips/lshift.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/lshift.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,6 +1,6 @@
 /* MIPS2 __mpn_lshift --
 
-Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
 
 This file is part of the GNU MP Library.
 
@@ -44,12 +44,12 @@
 	addu	$4,$4,$2	/* make r4 point at end of res */
 	addiu	$6,$6,-1
 	and	$9,$6,4-1	/* number of limbs in first loop */
-	beq	$9,$0,.L0	/* if multiple of 4 limbs, skip first loop */
-	 srl	$2,$10,$13	/* compute function result */
+	beq	$9,$0,L(L0)	/* if multiple of 4 limbs, skip first loop */
+	srl	$2,$10,$13	/* compute function result */
 
 	subu	$6,$6,$9
 
-.Loop0:	lw	$3,-8($5)
+L(Loop0):	lw	$3,-8($5)
 	addiu	$4,$4,-4
 	addiu	$5,$5,-4
 	addiu	$9,$9,-1
@@ -57,13 +57,13 @@
 	srl	$12,$3,$13
 	move	$10,$3
 	or	$8,$11,$12
-	bne	$9,$0,.Loop0
-	 sw	$8,0($4)
+	bne	$9,$0,L(Loop0)
+	sw	$8,0($4)
 
-.L0:	beq	$6,$0,.Lend
-	 nop
+L(L0):	beq	$6,$0,L(Lend)
+	nop
 
-.Loop:	lw	$3,-8($5)
+L(Loop):	lw	$3,-8($5)
 	addiu	$4,$4,-16
 	addiu	$6,$6,-4
 	sll	$11,$10,$7
@@ -89,10 +89,10 @@
 
 	addiu	$5,$5,-16
 	or	$8,$14,$9
-	bgtz	$6,.Loop
-	 sw	$8,0($4)
+	bgtz	$6,L(Loop)
+	sw	$8,0($4)
 
-.Lend:	sll	$8,$10,$7
+L(Lend):	sll	$8,$10,$7
 	j	$31
 	sw	$8,-4($4)
 	END (__mpn_lshift)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/machine-gmon.h libc-20030708/sysdeps/mips/machine-gmon.h
--- glibc-2.3.2/sysdeps/mips/machine-gmon.h	2002-02-13 16:30:11.000000000 +0900
+++ libc-20030708/sysdeps/mips/machine-gmon.h	2003-03-18 00:53:37.000000000 +0900
@@ -1,5 +1,6 @@
 /* Machine-specific calling sequence for `mcount' profiling function.  MIPS
-   Copyright (C) 1996, 1997, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -20,14 +21,17 @@
 #define _MCOUNT_DECL(frompc,selfpc) \
 static void __attribute_used__ __mcount (u_long frompc, u_long selfpc)
 
-/* Call __mcount with our the return PC for our caller,
+/* Call __mcount with the return PC for our caller,
    and the return PC our caller will return to.  */
+
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+
 #ifdef __PIC__
-#define CPLOAD ".cpload $25;"
-#define CPRESTORE ".cprestore 44\n\t"
+# define CPLOAD ".cpload $25;"
+# define CPRESTORE ".cprestore 44\n\t"
 #else
-#define CPLOAD
-#define CPRESTORE
+# define CPLOAD
+# define CPRESTORE
 #endif
 
 #define MCOUNT asm(\
@@ -66,3 +70,70 @@
         ".set reorder;\n\t" \
         ".set at\n\t" \
         ".end _mcount");
+
+#else
+
+#ifdef __PIC__
+# define CPSETUP ".cpsetup $25, 88, _mcount;"
+# define CPRETURN ".cpreturn;"
+#else
+# define CPSETUP
+# define CPRETURN
+#endif
+
+#if defined _ABIN32 && _MIPS_SIM == _ABIN32
+# define PTR_ADDU_STRING "add" /* no u */
+# define PTR_SUBU_STRING "sub" /* no u */
+#elif defined _ABI64 && _MIPS_SIM == _ABI64
+# define PTR_ADDU_STRING "daddu"
+# define PTR_SUBU_STRING "dsubu"
+#else
+# error "Unknown ABI"
+#endif
+
+#define MCOUNT asm(\
+	".globl _mcount;\n\t" \
+	".align 3;\n\t" \
+	".type _mcount,@function;\n\t" \
+	".ent _mcount\n\t" \
+        "_mcount:\n\t" \
+        ".frame $sp,88,$31\n\t" \
+        ".set noreorder;\n\t" \
+        ".set noat;\n\t" \
+        PTR_SUBU_STRING " $29,$29,96;\n\t" \
+        CPSETUP \
+        "sd $4,24($29);\n\t" \
+        "sd $5,32($29);\n\t" \
+        "sd $6,40($29);\n\t" \
+        "sd $7,48($29);\n\t" \
+        "sd $8,56($29);\n\t" \
+        "sd $9,64($29);\n\t" \
+        "sd $10,72($29);\n\t" \
+        "sd $11,80($29);\n\t" \
+        "sd $2,16($29);\n\t" \
+        "sd $1,0($29);\n\t" \
+        "sd $31,8($29);\n\t" \
+        "move $5,$31;\n\t" \
+        "move $4,$1;\n\t" \
+        "jal __mcount;\n\t" \
+        "nop;\n\t" \
+        "ld $4,24($29);\n\t" \
+        "ld $5,32($29);\n\t" \
+        "ld $6,40($29);\n\t" \
+        "ld $7,48($29);\n\t" \
+        "ld $8,56($29);\n\t" \
+        "ld $9,64($29);\n\t" \
+        "ld $10,72($29);\n\t" \
+        "ld $11,80($29);\n\t" \
+        "ld $2,16($29);\n\t" \
+        "ld $31,8($29);\n\t" \
+        "ld $1,0($29);\n\t" \
+        CPRETURN \
+        PTR_ADDU_STRING " $29,$29,96;\n\t" \
+        "j $31;\n\t" \
+        "move $31,$1;\n\t" \
+        ".set reorder;\n\t" \
+        ".set at\n\t" \
+        ".end _mcount");
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/memcpy.S libc-20030708/sysdeps/mips/memcpy.S
--- glibc-2.3.2/sysdeps/mips/memcpy.S	2002-09-10 20:22:59.000000000 +0900
+++ libc-20030708/sysdeps/mips/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
 
@@ -21,12 +21,7 @@
 #include <endian.h>
 
 
-/* void *memcpy(void *s1, const void *s2, size_t n);
-
-   This routine could be optimized further for MIPS64, but this is left
-   as an exercise for the future. When it is done, the file should be kept
-   as a sisterfile to this one, and placed in the sysdeps/mips/mips64 
-   directory.  */
+/* void *memcpy(void *s1, const void *s2, size_t n);  */
 
 #if __BYTE_ORDER == __BIG_ENDIAN
 #  define LWHI	lwl		/* high part is left in big-endian	*/
@@ -44,27 +39,29 @@
 	.set	noreorder
 
 	slti	t0, a2, 8		# Less than 8?
-	bne	t0, zero, $last8
+	bne	t0, zero, L(last8)
 	move	v0, a0			# Setup exit value before too late
 
 	xor	t0, a1, a0		# Find a0/a1 displacement
 	andi	t0, 0x3
-	bne	t0, zero, $shift	# Go handle the unaligned case
+	bne	t0, zero, L(shift)	# Go handle the unaligned case
 	subu	t1, zero, a1
 	andi	t1, 0x3			# a0/a1 are aligned, but are we
-	beq	t1, zero, $chk8w	#  starting in the middle of a word?
+	beq	t1, zero, L(chk8w)	#  starting in the middle of a word?
 	subu	a2, t1
 	LWHI	t0, 0(a1)		# Yes we are... take care of that
 	addu	a1, t1
 	SWHI	t0, 0(a0)
 	addu	a0, t1
 
-$chk8w:	andi	t0, a2, 0x1f		# 32 or more bytes left?
-	beq	t0, a2, $chk1w
+L(chk8w):	
+	andi	t0, a2, 0x1f		# 32 or more bytes left?
+	beq	t0, a2, L(chk1w)
 	subu	a3, a2, t0		# Yes
 	addu	a3, a1			# a3 = end address of loop
 	move	a2, t0			# a2 = what will be left after loop
-$lop8w:	lw	t0,  0(a1)		# Loop taking 8 words at a time
+L(lop8w):	
+	lw	t0,  0(a1)		# Loop taking 8 words at a time
 	lw	t1,  4(a1)
 	lw	t2,  8(a1)
 	lw	t3, 12(a1)
@@ -81,50 +78,59 @@
 	sw	t4, -16(a0)
 	sw	t5, -12(a0)
 	sw	t6,  -8(a0)
-	bne	a1, a3, $lop8w
+	bne	a1, a3, L(lop8w)
 	sw	t7,  -4(a0)
 
-$chk1w:	andi	t0, a2, 0x3		# 4 or more bytes left?
-	beq	t0, a2, $last8
+L(chk1w):	
+	andi	t0, a2, 0x3		# 4 or more bytes left?
+	beq	t0, a2, L(last8)
 	subu	a3, a2, t0		# Yes, handle them one word at a time
 	addu	a3, a1			# a3 again end address
 	move	a2, t0
-$lop1w:	lw	t0, 0(a1)
+L(lop1w):	
+	lw	t0, 0(a1)
 	addiu	a0, 4
 	addiu	a1, 4
-	bne	a1, a3, $lop1w
+	bne	a1, a3, L(lop1w)
 	sw	t0, -4(a0)
 
-$last8:	blez	a2, $lst8e		# Handle last 8 bytes, one at a time
+L(last8):	
+	blez	a2, L(lst8e)		# Handle last 8 bytes, one at a time
 	addu	a3, a2, a1
-$lst8l:	lb	t0, 0(a1)
+L(lst8l):	
+	lb	t0, 0(a1)
 	addiu	a0, 1
 	addiu	a1, 1
-	bne	a1, a3, $lst8l
+	bne	a1, a3, L(lst8l)
 	sb	t0, -1(a0)
-$lst8e:	jr	ra			# Bye, bye
+L(lst8e):	
+	jr	ra			# Bye, bye
 	nop
 
-$shift:	subu	a3, zero, a0		# Src and Dest unaligned 
+L(shift):	
+	subu	a3, zero, a0		# Src and Dest unaligned 
 	andi	a3, 0x3			#  (unoptimized case...)
-	beq	a3, zero, $shft1
+	beq	a3, zero, L(shft1)
 	subu	a2, a3			# a2 = bytes left
 	LWHI	t0, 0(a1)		# Take care of first odd part
 	LWLO	t0, 3(a1)
 	addu	a1, a3
 	SWHI	t0, 0(a0)
 	addu	a0, a3
-$shft1:	andi	t0, a2, 0x3
+L(shft1):	
+	andi	t0, a2, 0x3
 	subu	a3, a2, t0
 	addu	a3, a1
-$shfth:	LWHI	t1, 0(a1)		# Limp through, word by word
+L(shfth):	
+	LWHI	t1, 0(a1)		# Limp through, word by word
 	LWLO	t1, 3(a1)
 	addiu	a0, 4
 	addiu	a1, 4
-	bne	a1, a3, $shfth
+	bne	a1, a3, L(shfth)
 	sw	t1, -4(a0)
-	b	$last8			# Handle anything which may be left
+	b	L(last8)		# Handle anything which may be left
 	move	a2, t0
 
 	.set	reorder
 END (memcpy)
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/memset.S libc-20030708/sysdeps/mips/memset.S
--- glibc-2.3.2/sysdeps/mips/memset.S	2002-09-10 20:22:59.000000000 +0900
+++ libc-20030708/sysdeps/mips/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
 
@@ -21,12 +21,7 @@
 #include <endian.h>
 
 
-/* void *memset(void *s, int c, size_t n).
-
-   This routine could be optimized further for MIPS64, but this is left
-   as an exercise for the future. When it is done, the file should be kept
-   as a sisterfile to this one, and placed in the sysdeps/mips/mips64 
-   directory.  */
+/* void *memset(void *s, int c, size_t n).  */
 
 #if __BYTE_ORDER == __BIG_ENDIAN
 # define SWHI	swl		/* high part is left in big-endian	*/
@@ -38,46 +33,54 @@
 	.set	noreorder
 
 	slti	t1, a2, 8		# Less than 8?
-	bne	t1, zero, $last8
+	bne	t1, zero, L(last8)
 	move	v0, a0			# Setup exit value before too late
 
-	beq	a1, zero, $ueven	# If zero pattern, no need to extend
+	beq	a1, zero, L(ueven)	# If zero pattern, no need to extend
 	andi	a1, 0xff		# Avoid problems with bogus arguments
 	sll	t0, a1, 8
 	or	a1, t0
 	sll	t0, a1, 16
 	or	a1, t0			# a1 is now pattern in full word
 
-$ueven:	subu	t0, zero, a0		# Unaligned address?
+L(ueven):	
+	subu	t0, zero, a0		# Unaligned address?
 	andi	t0, 0x3
-	beq	t0, zero, $chkw
+	beq	t0, zero, L(chkw)
 	subu	a2, t0
 	SWHI	a1, 0(a0)		# Yes, handle first unaligned part
 	addu	a0, t0			# Now both a0 and a2 are updated
 
-$chkw:	andi	t0, a2, 0x7		# Enough left for one loop iteration?
-	beq	t0, a2, $chkl
+L(chkw):	
+	andi	t0, a2, 0x7		# Enough left for one loop iteration?
+	beq	t0, a2, L(chkl)
 	subu	a3, a2, t0
 	addu	a3, a0			# a3 is last loop address +1
 	move	a2, t0			# a2 is now # of bytes left after loop
-$loopw:	addiu	a0, 8			# Handle 2 words pr. iteration
+L(loopw):	
+	addiu	a0, 8			# Handle 2 words pr. iteration
 	sw	a1, -8(a0)
-	bne	a0, a3, $loopw
+	bne	a0, a3, L(loopw)
 	sw	a1, -4(a0)
 
-$chkl:	andi	t0, a2, 0x4		# Check if there is at least a full
-	beq	t0, zero, $last8	#  word remaining after the loop
+L(chkl):	
+	andi	t0, a2, 0x4		# Check if there is at least a full
+	beq	t0, zero, L(last8)	#  word remaining after the loop
 	subu	a2, t0
 	sw	a1, 0(a0)		# Yes...
 	addiu	a0, 4
 
-$last8:	blez	a2, $exit		# Handle last 8 bytes (if cnt>0)
+L(last8):	
+	blez	a2, L(exit)		# Handle last 8 bytes (if cnt>0)
 	addu	a3, a2, a0		# a3 is last address +1
-$lst8l:	addiu	a0, 1
-	bne	a0, a3, $lst8l
+L(lst8l):	
+	addiu	a0, 1
+	bne	a0, a3, L(lst8l)
 	sb	a1, -1(a0)
-$exit:	j	ra			# Bye, bye
+L(exit):	
+	j	ra			# Bye, bye
 	nop
 
 	.set	reorder
 END (memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips32/Implies libc-20030708/sysdeps/mips/mips32/Implies
--- glibc-2.3.2/sysdeps/mips/mips32/Implies	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips32/Implies	2003-03-29 17:15:28.000000000 +0900
@@ -0,0 +1,2 @@
+mips
+wordsize-32
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips32/Makefile libc-20030708/sysdeps/mips/mips32/Makefile
--- glibc-2.3.2/sysdeps/mips/mips32/Makefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips32/Makefile	2003-03-29 17:15:28.000000000 +0900
@@ -0,0 +1,3 @@
+ifeq ($(filter -mabi=32,$(CC)),)
+CC += -mabi=32
+endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/Implies libc-20030708/sysdeps/mips/mips64/Implies
--- glibc-2.3.2/sysdeps/mips/mips64/Implies	1999-07-14 16:27:44.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/Implies	2003-03-18 01:20:44.000000000 +0900
@@ -1,4 +1,3 @@
-wordsize-64
 # MIPS uses IEEE 754 floating point.
 ieee754/flt-32
 ieee754/dbl-64
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/__longjmp.c libc-20030708/sysdeps/mips/mips64/__longjmp.c
--- glibc-2.3.2/sysdeps/mips/mips64/__longjmp.c	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/__longjmp.c	2003-03-21 07:29:44.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1992, 1995, 1997, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1992, 1995, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Brendan Kehoe (brendan@zen.org).
 
@@ -38,6 +38,7 @@
   register int val asm ("a1");
 
   /* Pull back the floating point callee-saved registers.  */
+#if defined _ABI64 && _MIPS_SIM == _ABI64
   asm volatile ("l.d $f24, %0" : : "m" (env[0].__fpregs[0]));
   asm volatile ("l.d $f25, %0" : : "m" (env[0].__fpregs[1]));
   asm volatile ("l.d $f26, %0" : : "m" (env[0].__fpregs[2]));
@@ -46,6 +47,14 @@
   asm volatile ("l.d $f29, %0" : : "m" (env[0].__fpregs[5]));
   asm volatile ("l.d $f30, %0" : : "m" (env[0].__fpregs[6]));
   asm volatile ("l.d $f31, %0" : : "m" (env[0].__fpregs[7]));
+#else
+  asm volatile ("l.d $f20, %0" : : "m" (env[0].__fpregs[0]));
+  asm volatile ("l.d $f22, %0" : : "m" (env[0].__fpregs[1]));
+  asm volatile ("l.d $f24, %0" : : "m" (env[0].__fpregs[2]));
+  asm volatile ("l.d $f26, %0" : : "m" (env[0].__fpregs[3]));
+  asm volatile ("l.d $f28, %0" : : "m" (env[0].__fpregs[4]));
+  asm volatile ("l.d $f30, %0" : : "m" (env[0].__fpregs[5]));
+#endif
 
   /* Get and reconstruct the floating point csr.  */
   asm volatile ("lw $2, %0" : : "m" (env[0].__fpc_csr));
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/add_n.S libc-20030708/sysdeps/mips/mips64/add_n.S
--- glibc-2.3.2/sysdeps/mips/mips64/add_n.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/add_n.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS3 __mpn_add_n -- Add two limb vectors of the same length > 0 and
  * store sum in a third limb vector.
  *
- * Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+ * Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
  *
  * This file is part of the GNU MP Library.
  *
@@ -22,6 +22,7 @@
  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /*
  * INPUT PARAMETERS
@@ -38,10 +39,10 @@
 	.globl	__mpn_add_n
 	.ent	__mpn_add_n
 __mpn_add_n:
-	.set	noreorder
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP /* ??? unused */
 #endif
+	.set	noreorder
 	.set	nomacro
 
 	ld	$10,0($5)
@@ -49,12 +50,12 @@
 
 	daddiu	$7,$7,-1
 	and	$9,$7,4-1	# number of limbs in first loop
-	beq	$9,$0,.L0	# if multiple of 4 limbs, skip first loop
-	 move	$2,$0
+	beq	$9,$0,L(L0)	# if multiple of 4 limbs, skip first loop
+	move	$2,$0
 
 	dsubu	$7,$7,$9
 
-.Loop0:	daddiu	$9,$9,-1
+L(Loop0):	daddiu	$9,$9,-1
 	ld	$12,8($5)
 	daddu	$11,$11,$2
 	ld	$13,8($6)
@@ -68,13 +69,13 @@
 	daddiu	$6,$6,8
 	move	$10,$12
 	move	$11,$13
-	bne	$9,$0,.Loop0
-	 daddiu	$4,$4,8
+	bne	$9,$0,L(Loop0)
+	daddiu	$4,$4,8
 
-.L0:	beq	$7,$0,.Lend
-	 nop
+L(L0):	beq	$7,$0,L(Lend)
+	nop
 
-.Loop:	daddiu	$7,$7,-4
+L(Loop):	daddiu	$7,$7,-4
 
 	ld	$12,8($5)
 	daddu	$11,$11,$2
@@ -115,10 +116,10 @@
 	daddiu	$5,$5,32
 	daddiu	$6,$6,32
 
-	bne	$7,$0,.Loop
-	 daddiu	$4,$4,32
+	bne	$7,$0,L(Loop)
+	daddiu	$4,$4,32
 
-.Lend:	daddu	$11,$11,$2
+L(Lend):	daddu	$11,$11,$2
 	sltu	$8,$11,$2
 	daddu	$11,$10,$11
 	sltu	$2,$11,$10
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/addmul_1.S libc-20030708/sysdeps/mips/mips64/addmul_1.S
--- glibc-2.3.2/sysdeps/mips/mips64/addmul_1.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/addmul_1.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS3 __mpn_addmul_1 -- Multiply a limb vector with a single limb and
  * add the product to a second limb vector.
  *
- * Copyright (C) 1992, 1994, 1995 Free Software Foundation, Inc.
+ * Copyright (C) 1992, 1994, 1995, 2002, 2003 Free Software Foundation, Inc.
  *
  * This file is part of the GNU MP Library.
  *
@@ -22,6 +22,7 @@
  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /* INPUT PARAMETERS
  * res_ptr	$4
@@ -38,10 +39,10 @@
 	.globl	__mpn_addmul_1
 	.ent	__mpn_addmul_1
 __mpn_addmul_1:
-	.set    noreorder
 #ifdef PIC
-	.cpload t9
+	SETUP_GP /* ??? unused */
 #endif
+	.set    noreorder
 	.set    nomacro
 
  # warm up phase 0
@@ -52,14 +53,14 @@
 	dmultu	$8,$7
 
 	daddiu	$6,$6,-1
-	beq	$6,$0,$LC0
-	 move	$2,$0		# zero cy2
+	beq	$6,$0,L(LC0)
+	move	$2,$0		# zero cy2
 
 	daddiu	$6,$6,-1
-	beq	$6,$0,$LC1
+	beq	$6,$0,L(LC1)
 	ld	$8,0($5)	# load new s1 limb as early as possible
 
-Loop:	ld	$10,0($4)
+L(Loop):	ld	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	daddiu	$5,$5,8
@@ -73,11 +74,11 @@
 	daddu	$2,$2,$10
 	sd	$3,0($4)
 	daddiu	$4,$4,8
-	bne	$6,$0,Loop
-	 daddu	$2,$9,$2	# add high product limb and carry from addition
+	bne	$6,$0,L(Loop)
+	daddu	$2,$9,$2	# add high product limb and carry from addition
 
  # cool down phase 1
-$LC1:	ld	$10,0($4)
+L(LC1):	ld	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	daddu	$3,$3,$2
@@ -91,7 +92,7 @@
 	daddu	$2,$9,$2	# add high product limb and carry from addition
 
  # cool down phase 0
-$LC0:	ld	$10,0($4)
+L(LC0):	ld	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	daddu	$3,$3,$2
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/bits/setjmp.h libc-20030708/sysdeps/mips/mips64/bits/setjmp.h
--- glibc-2.3.2/sysdeps/mips/mips64/bits/setjmp.h	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/bits/setjmp.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,57 +0,0 @@
-/* Define the machine-dependent type `jmp_buf'.  MIPS version.
-   Copyright (C) 1996, 1997 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _SETJMP_H
-# error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
-#endif
-
-typedef struct
-  {
-    /* Program counter.  */
-    __ptr_t __pc;
-
-    /* Stack pointer.  */
-    __ptr_t __sp;
-
-    /* Callee-saved registers s0 through s7.  */
-    int __regs[8];
-
-    /* The frame pointer.  */
-    __ptr_t __fp;
-
-    /* The global pointer.  */
-    __ptr_t __gp;
-
-    /* Floating point status register.  */
-    int __fpc_csr;
-
-    /* Callee-saved floating point registers.  */
-    double __fpregs[8];
-  } __jmp_buf[1];
-
-#ifdef __USE_MISC
-/* Offset to the program counter in `jmp_buf'.  */
-# define JB_PC	0
-#endif
-
-
-/* Test if longjmp to JMPBUF would unwind the frame
-   containing a local variable at ADDRESS.  */
-#define _JMPBUF_UNWINDS(jmpbuf, address) \
-  ((__ptr_t) (address) < (jmpbuf)[0].__sp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/bsd-_setjmp.S libc-20030708/sysdeps/mips/mips64/bsd-_setjmp.S
--- glibc-2.3.2/sysdeps/mips/mips64/bsd-_setjmp.S	2003-01-01 04:13:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/bsd-_setjmp.S	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* BSD `_setjmp' entry point to `sigsetjmp (..., 0)'.  MIPS64 version.
-   Copyright (C) 1996, 1997, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,16 +22,26 @@
    in setjmp doesn't clobber the state restored by longjmp.  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 #ifdef __PIC__
 	.option pic2
 #endif
 ENTRY (_setjmp)
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP
 #endif
-	dla t9, C_SYMBOL_NAME (__sigsetjmp)
+	SETUP_GP64 (v0, C_SYMBOL_NAME (_setjmp))
+	PTR_LA t9, C_SYMBOL_NAME (__sigsetjmp)
+#if _MIPS_SIM == _MIPS_SIM_ABI32
 	nop
-	jr t9
-	dli a1, 0		/* Pass a second argument of zero.  */
+#endif	
+	RESTORE_GP64
+	move	a1, zero		/* Pass a second argument of zero.  */
+#ifdef __PIC__
+	jr	t9
+#else
+	j	C_SYMBOL_NAME (__sigsetjmp)
+#endif
+	.end	_setjmp
 libc_hidden_def (_setjmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/bsd-setjmp.S libc-20030708/sysdeps/mips/mips64/bsd-setjmp.S
--- glibc-2.3.2/sysdeps/mips/mips64/bsd-setjmp.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/bsd-setjmp.S	2003-03-18 00:47:12.000000000 +0900
@@ -1,5 +1,5 @@
 /* BSD `setjmp' entry point to `sigsetjmp (..., 1)'.  MIPS64 version.
-   Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,15 +22,25 @@
    in setjmp doesn't clobber the state restored by longjmp.  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 #ifdef PIC
 	.option pic2
 #endif
 ENTRY (setjmp)
-#ifdef PIC
-	.cpload t9
+#ifdef __PIC__
+	SETUP_GP
 #endif
-	dla t9, C_SYMBOL_NAME (__sigsetjmp)
+	SETUP_GP64 (v0, C_SYMBOL_NAME (setjmp))
+	PTR_LA t9, C_SYMBOL_NAME (__sigsetjmp)
+#if _MIPS_SIM == _MIPS_SIM_ABI32
 	nop
-	jr t9
+#endif	
+	RESTORE_GP64
 	dli a1, 1		/* Pass a second argument of one.  */
+#ifdef __PIC__
+	jr	t9
+#else
+	j	C_SYMBOL_NAME (__sigsetjmp)
+#endif
+	.end	setjmp
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/dl-machine.h libc-20030708/sysdeps/mips/mips64/dl-machine.h
--- glibc-2.3.2/sysdeps/mips/mips64/dl-machine.h	2002-03-01 06:35:57.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/dl-machine.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,594 +0,0 @@
-/* Machine-dependent ELF dynamic relocation inline functions.  MIPS64 version.
-   Copyright (C) 1996,1997,1999,2000,2001,2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-   Contributed by Kazumoto Kojima <kkojima@info.kanagawa-u.ac.jp>.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef dl_machine_h
-#define dl_machine_h
-
-#define ELF_MACHINE_NAME "MIPS"
-
-#define ELF_MACHINE_NO_PLT
-
-#include <entry.h>
-
-#ifndef ENTRY_POINT
-#error ENTRY_POINT needs to be defined for MIPS.
-#endif
-
-#ifndef _RTLD_PROLOGUE
-# define _RTLD_PROLOGUE(entry) "\n\t.globl " __STRING(entry)	\
-			       "\n\t.ent " __STRING(entry)	\
-			       "\n\t" __STRING(entry) ":\n\t"
-#endif
-
-#ifndef _RTLD_EPILOGUE
-# define _RTLD_EPILOGUE(entry) "\t.end " __STRING(entry) "\n"
-#endif
-
-/* A reloc type used for ld.so cmdline arg lookups to reject PLT entries.
-   This makes no sense on MIPS but we have to define this to R_MIPS_REL32
-   to avoid the asserts in dl-lookup.c from blowing.  */
-#define ELF_MACHINE_JMP_SLOT			R_MIPS_REL32
-#define elf_machine_type_class(type)		ELF_RTYPE_CLASS_PLT
-
-/* Translate a processor specific dynamic tag to the index
-   in l_info array.  */
-#define DT_MIPS(x) (DT_MIPS_##x - DT_LOPROC + DT_NUM)
-
-#if 0
-/* We may need 64k alignment. */
-#define ELF_MACHINE_ALIGN_MASK 0xffff
-#endif
-
-/*
- * MIPS libraries are usually linked to a non-zero base address.  We
- * subtrace the base address from the address where we map the object
- * to.  This results in more efficient address space usage.
- */
-#if 0
-#define MAP_BASE_ADDR(l) ((l)->l_info[DT_MIPS(BASE_ADDRESS)] ? \
-			  (l)->l_info[DT_MIPS(BASE_ADDRESS)]->d_un.d_ptr : 0)
-#else
-#define MAP_BASE_ADDR(l) 0x5ffe0000
-#endif
-
-/* If there is a DT_MIPS_RLD_MAP entry in the dynamic section, fill it in
-   with the run-time address of the r_debug structure  */
-#define ELF_MACHINE_DEBUG_SETUP(l,r) \
-do { if ((l)->l_info[DT_MIPS (RLD_MAP)]) \
-       *(ElfW(Addr) *)((l)->l_info[DT_MIPS (RLD_MAP)]->d_un.d_ptr) = \
-       (ElfW(Addr)) (r); \
-   } while (0)
-
-/* Return nonzero iff ELF  header is compatible with the running host.  */
-static inline int __attribute__ ((unused))
-elf_machine_matches_host (const ElfW(Ehdr) *ehdr)
-{
-  switch (ehdr->e_machine)
-    {
-    case EM_MIPS:
-    case EM_MIPS_RS3_LE:
-      return 1;
-    default:
-      return 0;
-    }
-}
-
-static inline ElfW(Addr) *
-elf_mips_got_from_gpreg (ElfW(Addr) gpreg)
-{
-  /* FIXME: the offset of gp from GOT may be system-dependent. */
-  return (ElfW(Addr) *) (gpreg - 0x7ff0);
-}
-
-/* Return the link-time address of _DYNAMIC.  Conveniently, this is the
-   first element of the GOT.  This must be inlined in a function which
-   uses global data.  */
-static inline ElfW(Addr)
-elf_machine_dynamic (void)
-{
-  register ElfW(Addr) gp __asm__ ("$28");
-
-  return *elf_mips_got_from_gpreg (gp);
-}
-
-
-/* Return the run-time load address of the shared object.  */
-static inline ElfW(Addr)
-elf_machine_load_address (void)
-{
-  ElfW(Addr) addr;
-  asm ("	.set noreorder\n"
-       "	dla %0, here\n"
-       "	bltzal $0, here\n"
-       "	nop\n"
-       "here:	dsubu %0, $31, %0\n"
-       "	.set reorder\n"
-       :	"=r" (addr)
-       :	/* No inputs */
-       :	"$31");
-  return addr;
-}
-
-/* The MSB of got[1] of a gnu object is set to identify gnu objects. */
-#define ELF_MIPS_GNU_GOT1_MASK 0x80000000
-
-/* Relocate GOT. */
-static inline void
-elf_machine_got_rel (struct link_map *map, int lazy)
-{
-  ElfW(Addr) *got;
-  ElfW(Sym) *sym;
-  int i, n;
-  const char *strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
-
-#define RESOLVE_GOTSYM(sym) \
-    ({ \
-      const ElfW(Sym) *ref = sym; \
-      ElfW(Addr) sym_loadaddr; \
-      sym_loadaddr = _dl_lookup_symbol (strtab + sym->st_name, &ref, \
-					map->l_scope, \
-					map->l_name, R_MIPS_REL32);\
-      (ref)? sym_loadaddr + ref->st_value: 0; \
-    })
-
-  got = (ElfW(Addr) *) D_PTR (map, l_info[DT_PLTGOT]);
-
-  /* got[0] is reserved. got[1] is also reserved for the dynamic object
-     generated by gnu ld. Skip these reserved entries from relocation.  */
-  i = (got[1] & ELF_MIPS_GNU_GOT1_MASK)? 2: 1;
-  n = map->l_info[DT_MIPS (LOCAL_GOTNO)]->d_un.d_val;
-  /* Add the run-time display to all local got entries. */
-  while (i < n)
-    got[i++] += map->l_addr;
-
-  /* Handle global got entries. */
-  got += n;
-  sym = (ElfW(Sym) *) D_PTR (map, l_info[DT_SYMTAB]);
-  sym += map->l_info[DT_MIPS (GOTSYM)]->d_un.d_val;
-  i = (map->l_info[DT_MIPS (SYMTABNO)]->d_un.d_val
-       - map->l_info[DT_MIPS (GOTSYM)]->d_un.d_val);
-
-  while (i--)
-    {
-      if (sym->st_shndx == SHN_UNDEF)
-	{
-	  if (ELFW(ST_TYPE) (sym->st_info) == STT_FUNC)
-	    {
-	      if (sym->st_value && lazy)
-		*got = sym->st_value + map->l_addr;
-	      else
-		*got = RESOLVE_GOTSYM (sym);
-	    }
-	  else /* if (*got == 0 || *got == QS) */
-	    *got = RESOLVE_GOTSYM (sym);
-	}
-      else if (sym->st_shndx == SHN_COMMON)
-	*got = RESOLVE_GOTSYM (sym);
-      else if (ELFW(ST_TYPE) (sym->st_info) == STT_FUNC
-	       && *got != sym->st_value
-	       && lazy)
-	*got += map->l_addr;
-      else if (ELFW(ST_TYPE) (sym->st_info) == STT_SECTION)
-	{
-	  if (sym->st_other == 0)
-	    *got += map->l_addr;
-	}
-      else
-	*got = RESOLVE_GOTSYM (sym);
-
-      got++;
-      sym++;
-    }
-
-#undef RESOLVE_GOTSYM
-
-  return;
-}
-
-/* Set up the loaded object described by L so its stub function
-   will jump to the on-demand fixup code in dl-runtime.c.  */
-
-static inline int
-elf_machine_runtime_setup (struct link_map *l, int lazy, int profile)
-{
-  ElfW(Addr) *got;
-  extern void _dl_runtime_resolve (ElfW(Word));
-  extern int _dl_mips_gnu_objects;
-
-#ifdef RTLD_BOOTSTRAP
-    {
-      return lazy;
-    }
-#endif
-  if (lazy)
-    {
-      /* The GOT entries for functions have not yet been filled in.
-	 Their initial contents will arrange when called to put an
-	 offset into the .dynsym section in t8, the return address
-	 in t7 and then jump to _GLOBAL_OFFSET_TABLE[0].  */
-      got = (ElfW(Addr) *) D_PTR (l, l_info[DT_PLTGOT]);
-
-      /* This function will get called to fix up the GOT entry indicated by
-	 the register t8, and then jump to the resolved address.  */
-      got[0] = (ElfW(Addr)) &_dl_runtime_resolve;
-
-      /* Store l to _GLOBAL_OFFSET_TABLE[1] for gnu object. The MSB
-	 of got[1] of a gnu object is set to identify gnu objects.
-	 Where we can store l for non gnu objects? XXX  */
-      if ((got[1] & ELF_MIPS_GNU_GOT1_MASK) != 0)
-	got[1] = (ElfW(Addr)) ((unsigned) l | ELF_MIPS_GNU_GOT1_MASK);
-      else
-	_dl_mips_gnu_objects = 0;
-    }
-
-  /* Relocate global offset table.  */
-  elf_machine_got_rel (l, lazy);
-
-  return lazy;
-}
-
-/* Get link_map for this object.  */
-static inline struct link_map *
-elf_machine_runtime_link_map (ElfW(Addr) gpreg, ElfW(Addr) stub_pc)
-{
-  extern int _dl_mips_gnu_objects;
-
-  /* got[1] is reserved to keep its link map address for the shared
-     object generated by the gnu linker.  If all are such objects, we
-     can find the link map from current GPREG simply.  If not so, get
-     the link map for caller's object containing STUB_PC.  */
-
-  if (_dl_mips_gnu_objects)
-    {
-      ElfW(Addr) *got = elf_mips_got_from_gpreg (gpreg);
-      ElfW(Word) g1;
-
-      g1 = ((ElfW(Word) *) got)[1];
-
-      if ((g1 & ELF_MIPS_GNU_GOT1_MASK) != 0)
-	{
-	  struct link_map *l =
-	    (struct link_map *) (g1 & ~ELF_MIPS_GNU_GOT1_MASK);
-	  ElfW(Addr) base, limit;
-	  const ElfW(Phdr) *p = l->l_phdr;
-	  ElfW(Half) this, nent = l->l_phnum;
-
-	  /* For the common case of a stub being called from the containing
-	     object, STUB_PC will point to somewhere within the object that
-	     is described by the link map fetched via got[1].  Otherwise we
-	     have to scan all maps.  */
-	  for (this = 0; this < nent; this++)
-	    {
-	      if (p[this].p_type == PT_LOAD)
-		{
-		  base = p[this].p_vaddr + l->l_addr;
-		  limit = base + p[this].p_memsz;
-		  if (stub_pc >= base && stub_pc < limit)
-		    return l;
-		}
-	      this++;
-	    }
-	}
-    }
-
-    {
-      struct link_map *l = GL(dl_loaded);
-
-      while (l)
-	{
-	  ElfW(Addr) base, limit;
-	  const ElfW(Phdr) *p = l->l_phdr;
-	  ElfW(Half) this, nent = l->l_phnum;
-
-	  for (this = 0; this < nent; this++)
-	    {
-	      if (p[this].p_type == PT_LOAD)
-		{
-		  base = p[this].p_vaddr + l->l_addr;
-		  limit = base + p[this].p_memsz;
-		  if (stub_pc >= base && stub_pc < limit)
-		    return l;
-		}
-	    }
-	  l = l->l_next;
-	}
-    }
-
-  _dl_signal_error (0, NULL, NULL, "cannot find runtime link map");
-  return NULL;
-}
-
-/* Mips has no PLT but define elf_machine_relplt to be elf_machine_rel. */
-#define elf_machine_relplt elf_machine_rel
-
-/* Define mips specific runtime resolver. The function __dl_runtime_resolve
-   is called from assembler function _dl_runtime_resolve which converts
-   special argument registers t7 ($15) and t8 ($24):
-     t7  address to return to the caller of the function
-     t8  index for this function symbol in .dynsym
-   to usual c arguments.  */
-
-#define ELF_MACHINE_RUNTIME_TRAMPOLINE					      \
-/* The flag _dl_mips_gnu_objects is set if all dynamic objects are	      \
-   generated by the gnu linker. */					      \
-int _dl_mips_gnu_objects = 1;						      \
-									      \
-/* This is called from assembly stubs below which the compiler can't see.  */ \
-static ElfW(Addr)							      \
-__dl_runtime_resolve (ElfW(Word), ElfW(Word), ElfW(Addr), ElfW(Addr))	      \
-                  __attribute__ ((unused));				      \
-									      \
-static ElfW(Addr)							      \
-__dl_runtime_resolve (ElfW(Word) sym_index,				      \
-		      ElfW(Word) return_address,			      \
-		      ElfW(Addr) old_gpreg,				      \
-		      ElfW(Addr) stub_pc)				      \
-{									      \
-  struct link_map *l = elf_machine_runtime_link_map (old_gpreg, stub_pc);     \
-  const ElfW(Sym) *const symtab						      \
-    = (const ElfW(Sym) *) D_PTR (l, l_info[DT_SYMTAB]);			      \
-  const char *strtab = (const void *) D_PTR (l, l_info[DT_STRTAB]);	      \
-  const ElfW(Addr) *got							      \
-    = (const ElfW(Addr) *) D_PTR (l, l_info[DT_PLTGOT]);		      \
-  const ElfW(Word) local_gotno						      \
-    = (const ElfW(Word)) l->l_info[DT_MIPS (LOCAL_GOTNO)]->d_un.d_val;	      \
-  const ElfW(Word) gotsym						      \
-    = (const ElfW(Word)) l->l_info[DT_MIPS (GOTSYM)]->d_un.d_val;	      \
-  const ElfW(Sym) *definer;						      \
-  ElfW(Addr) loadbase;							      \
-  ElfW(Addr) funcaddr;							      \
-									      \
-  /* Look up the symbol's run-time value.  */				      \
-  definer = &symtab[sym_index];						      \
-									      \
-  loadbase = _dl_lookup_symbol (strtab + definer->st_name, &definer,	      \
-				l->l_scope, l->l_name,			      \
-				R_MIPS_REL32);				      \
-									      \
-  /* Apply the relocation with that value.  */				      \
-  funcaddr = loadbase + definer->st_value;				      \
-  *(got + local_gotno + sym_index - gotsym) = funcaddr;			      \
-									      \
-  return funcaddr;							      \
-}									      \
-									      \
-asm ("\n								      \
-	.text\n								      \
-	.align	3\n							      \
-	.globl	_dl_runtime_resolve\n					      \
-	.type	_dl_runtime_resolve,@function\n				      \
-	.ent	_dl_runtime_resolve\n					      \
-_dl_runtime_resolve:\n							      \
-	.set noreorder\n						      \
-	# Save old GP to $3.\n						      \
-	move	$3,$28\n						      \
-	# Modify t9 ($25) so as to point .cpload instruction.\n		      \
-	daddu	$25,2*8\n						      \
-	# Compute GP.\n							      \
-	.cpload $25\n							      \
-	.set reorder\n							      \
-	# Save slot call pc.\n						      \
-        move	$2, $31\n						      \
-	# Save arguments and sp value in stack.\n			      \
-	dsubu	$29, 10*8\n						      \
-	.cprestore 8*8\n						      \
-	sd	$15, 9*8($29)\n						      \
-	sd	$4, 3*8($29)\n						      \
-	sd	$5, 4*8($29)\n						      \
-	sd	$6, 5*8($29)\n						      \
-	sd	$7, 6*8($29)\n						      \
-	sd	$16, 7*8($29)\n						      \
-	move	$16, $29\n						      \
-	move	$4, $24\n						      \
-	move	$5, $15\n						      \
-	move	$6, $3\n						      \
-	move	$7, $2\n						      \
-	jal	__dl_runtime_resolve\n					      \
-	move	$29, $16\n						      \
-	ld	$31, 9*8($29)\n						      \
-	ld	$4, 3*8($29)\n						      \
-	ld	$5, 4*8($29)\n						      \
-	ld	$6, 5*8($29)\n						      \
-	ld	$7, 6*8($29)\n						      \
-	ld	$16, 7*8($29)\n						      \
-	daddu	$29, 10*8\n						      \
-	move	$25, $2\n						      \
-	jr	$25\n							      \
-	.end	_dl_runtime_resolve\n					      \
-	.previous\n							      \
-");
-
-/* Mask identifying addresses reserved for the user program,
-   where the dynamic linker should not map anything.  */
-#define ELF_MACHINE_USER_ADDRESS_MASK	0x80000000UL
-
-
-
-/* Initial entry point code for the dynamic linker.
-   The C function `_dl_start' is the real entry point;
-   its return value is the user program's entry point.
-   Note how we have to be careful about two things:
-
-   1) That we allocate a minimal stack of 24 bytes for
-      every function call, the MIPS ABI states that even
-      if all arguments are passed in registers the procedure
-      called can use the 16 byte area pointed to by $sp
-      when it is called to store away the arguments passed
-      to it.
-
-   2) That under Linux the entry is named __start
-      and not just plain _start.  */
-
-#define RTLD_START asm ("\
-	.text\n\
-	.align	3\n"\
-_RTLD_PROLOGUE (ENTRY_POINT)\
-"	.globl _dl_start_user\n\
-	.set noreorder\n\
-	bltzal $0, 0f\n\
-	nop\n\
-0:	.cpload $31\n\
-	.set reorder\n\
-	# i386 ABI book says that the first entry of GOT holds\n\
-	# the address of the dynamic structure. Though MIPS ABI\n\
-	# doesn't say nothing about this, I emulate this here.\n\
-	dla $4, _DYNAMIC\n\
-	sd $4, -0x7ff0($28)\n\
-	dsubu $29, 16\n\
-	move $4, $29\n\
-	jal _dl_start\n\
-	daddiu $29, 16\n\
-	# Get the value of label '_dl_start_user' in t9 ($25).\n\
-	dla $25, _dl_start_user\n\
-_dl_start_user:\n\
-	.set noreorder\n\
-	.cpload $25\n\
-	.set reorder\n\
-	move $16, $28\n\
-	# Save the user entry point address in saved register.\n\
-	move $17, $2\n\
-	# Store the highest stack address\n\
-	sd $29, __libc_stack_end\n\
-	# See if we were run as a command with the executable file\n\
-	# name as an extra leading argument.\n\
-	ld $2, _dl_skip_args\n\
-	beq $2, $0, 1f\n\
-	# Load the original argument count.\n\
-	ld $4, 0($29)\n\
-	# Subtract _dl_skip_args from it.\n\
-	dsubu $4, $2\n\
-	# Adjust the stack pointer to skip _dl_skip_args words.\n\
-	dsll $2,2\n\
-	daddu $29, $2\n\
-	# Save back the modified argument count.\n\
-	sd $4, 0($29)\n\
-1:	# Call _dl_init (struct link_map *main_map, int argc, char **argv, char **env) \n\
-	ld $4, _rtld_local\n\
-	ld $5, 0($29)\n\
-	dla $6, 4($29)\n\
-	dla $7, 8($29)\n\
-	dsubu $29, 16\n\
-	# Call the function to run the initializers.\n\
-	jal _dl_init_internal\n\
-	daddiu $29, 16\n\
-	# Pass our finalizer function to the user in ra.\n\
-	dla $31, _dl_fini\n\
-	# Jump to the user entry point.\n\
-1:	# Call _dl_init (struct link_map *main_map, int argc, char **argv, char **env) \n\
-	lw $4, _rtld_local\n\
-	lw $5, 0($29)\n\
-	la $6, 4($29)\n\
-	la $7, 8($29)\n\
-	subu $29, 16\n\
-	# Call the function to run the initializers.\n\
-	jal _dl_init_internal\n\
-	addiu $29, 16\n\
-	# Pass our finalizer function to the user in ra.\n\
-	dla $31, _dl_fini\n\
-	# Jump to the user entry point.\n\
-	move $25, $17\n\
-	ld $4, 0($29)\n\
-	ld $5, 1*8($29)\n\
-	ld $6, 2*8$29)\n\
-	ld $7, 3*8($29)\n\
-	jr $25\n"\
-_RTLD_EPILOGUE(ENTRY_POINT) \
-	"\n.previous"\
-);
-
-
-/* The MIPS never uses Elfxx_Rela relocations.  */
-#define ELF_MACHINE_NO_RELA 1
-
-#endif /* !dl_machine_h */
-
-#ifdef RESOLVE
-
-/* Perform the relocation specified by RELOC and SYM (which is fully resolved).
-   MAP is the object containing the reloc.  */
-
-static inline void
-elf_machine_rel (struct link_map *map, const ElfW(Rel) *reloc,
-		 const ElfW(Sym) *sym, const struct r_found_version *version,
-		 ElfW(Addr) *const reloc_addr)
-{
-  const unsigned long int r_type = ELFW(R_TYPE) (reloc->r_info);
-  ElfW(Addr) loadbase;
-  ElfW(Addr) undo __attribute__ ((unused));
-
-  switch (r_type)
-    {
-    case R_MIPS_REL32:
-      {
-	ElfW(Addr) undo = 0;
-
-	if (ELFW(ST_BIND) (sym->st_info) == STB_LOCAL
-	    && (ELFW(ST_TYPE) (sym->st_info) == STT_SECTION
-		|| ELFW(ST_TYPE) (sym->st_info) == STT_NOTYPE))
-	  {
-	    *reloc_addr += map->l_addr;
-	    break;
-	  }
-#ifndef RTLD_BOOTSTRAP
-	/* This is defined in rtld.c, but nowhere in the static libc.a;
-	   make the reference weak so static programs can still link.  This
-	   declaration cannot be done when compiling rtld.c (i.e.  #ifdef
-	   RTLD_BOOTSTRAP) because rtld.c contains the common defn for
-	   _dl_rtld_map, which is incompatible with a weak decl in the same
-	   file.  */
-# ifndef SHARED
-	weak_extern (GL(dl_rtld_map));
-# endif
-	if (map == &GL(dl_rtld_map))
-	  /* Undo the relocation done here during bootstrapping.  Now we will
-	     relocate it anew, possibly using a binding found in the user
-	     program or a loaded library rather than the dynamic linker's
-	     built-in definitions used while loading those libraries.  */
-	  undo = map->l_addr + sym->st_value;
-#endif
-	  loadbase = RESOLVE (&sym, version, 0);
-	  *reloc_addr += (sym ? (loadbase + sym->st_value) : 0) - undo;
-	}
-      break;
-#ifndef RTLD_BOOTSTRAP
-    case R_MIPS_NONE:		/* Alright, Wilbur.  */
-      break;
-#endif
-    default:
-      _dl_reloc_bad_type (map, r_type, 0);
-      break;
-    }
-}
-
-static inline void
-elf_machine_rel_relative (ElfW(Addr) l_addr, const ElfW(Rel) *reloc,
-			  ElfW(Addr) *const reloc_addr)
-{
-  /* XXX Nothing to do.  There is no relative relocation, right?  */
-}
-
-static inline void
-elf_machine_lazy_rel (struct link_map *map, ElfW(Addr) l_addr,
-		      const ElfW(Rel) *reloc)
-{
-  /* Do nothing.  */
-}
-
-#endif /* RESOLVE */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/gmp-mparam.h libc-20030708/sysdeps/mips/mips64/gmp-mparam.h
--- glibc-2.3.2/sysdeps/mips/mips64/gmp-mparam.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/gmp-mparam.h	2003-03-18 00:47:12.000000000 +0900
@@ -0,0 +1,31 @@
+/* gmp-mparam.h -- Compiler/machine parameter header file.
+
+Copyright (C) 1991, 1993, 1994, 2002, 2003 Free Software Foundation, Inc.
+
+This file is part of the GNU MP Library.
+
+The GNU MP Library is free software; you can redistribute it and/or modify
+it under the terms of the GNU Lesser General Public License as published by
+the Free Software Foundation; either version 2.1 of the License, or (at your
+option) any later version.
+
+The GNU MP Library is distributed in the hope that it will be useful, but
+WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
+or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public
+License for more details.
+
+You should have received a copy of the GNU Lesser General Public License
+along with the GNU MP Library; see the file COPYING.LIB.  If not, write to
+the Free Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA. */
+
+#if defined __GMP_H__ && ! defined _LONG_LONG_LIMB
+#error "Included too late for _LONG_LONG_LIMB to take effect"
+#endif
+
+#define _LONG_LONG_LIMB
+#define BITS_PER_MP_LIMB 64
+#define BYTES_PER_MP_LIMB 8
+#define BITS_PER_LONGINT __WORDSIZE
+#define BITS_PER_INT 32
+#define BITS_PER_SHORTINT 16
+#define BITS_PER_CHAR 8
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/lshift.S libc-20030708/sysdeps/mips/mips64/lshift.S
--- glibc-2.3.2/sysdeps/mips/mips64/lshift.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/lshift.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,6 +1,6 @@
 /* MIPS3 __mpn_lshift --
  *
- * Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+ * Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
  *
  * This file is part of the GNU MP Library.
  *
@@ -21,6 +21,7 @@
  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /* INPUT PARAMETERS
  * res_ptr	$4
@@ -37,10 +38,10 @@
 	.globl	__mpn_lshift
 	.ent	__mpn_lshift
 __mpn_lshift:
-	.set	noreorder
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP /* ??? unused */
 #endif
+	.set	noreorder
 	.set	nomacro
 
 	dsll	$2,$6,3
@@ -50,12 +51,12 @@
 	daddu	$4,$4,$2	# make r4 point at end of res
 	daddiu	$6,$6,-1
 	and	$9,$6,4-1	# number of limbs in first loop
-	beq	$9,$0,.L0	# if multiple of 4 limbs, skip first loop
-	 dsrl	$2,$10,$13	# compute function result
+	beq	$9,$0,L(L0)	# if multiple of 4 limbs, skip first loop
+	dsrl	$2,$10,$13	# compute function result
 
 	dsubu	$6,$6,$9
 
-.Loop0:	ld	$3,-16($5)
+L(Loop0):	ld	$3,-16($5)
 	daddiu	$4,$4,-8
 	daddiu	$5,$5,-8
 	daddiu	$9,$9,-1
@@ -63,13 +64,13 @@
 	dsrl	$12,$3,$13
 	move	$10,$3
 	or	$8,$11,$12
-	bne	$9,$0,.Loop0
-	 sd	$8,0($4)
+	bne	$9,$0,L(Loop0)
+	sd	$8,0($4)
 
-.L0:	beq	$6,$0,.Lend
-	 nop
+L(L0):	beq	$6,$0,L(Lend)
+	nop
 
-.Loop:	ld	$3,-16($5)
+L(Loop):	ld	$3,-16($5)
 	daddiu	$4,$4,-32
 	daddiu	$6,$6,-4
 	dsll	$11,$10,$7
@@ -95,10 +96,10 @@
 
 	daddiu	$5,$5,-32
 	or	$8,$14,$9
-	bgtz	$6,.Loop
-	 sd	$8,0($4)
+	bgtz	$6,L(Loop)
+	sd	$8,0($4)
 
-.Lend:	dsll	$8,$10,$7
+L(Lend):	dsll	$8,$10,$7
 	j	$31
 	sd	$8,-8($4)
 	.end	__mpn_lshift
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/memcpy.S libc-20030708/sysdeps/mips/mips64/memcpy.S
--- glibc-2.3.2/sysdeps/mips/mips64/memcpy.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -0,0 +1,140 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
+   Ported to mips3 n32/n64 by Alexandre Oliva <aoliva@redhat.com>
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <endian.h>
+#include <sys/asm.h>
+
+
+/* void *memcpy(void *s1, const void *s2, size_t n);
+	
+   This could probably be optimized further.  */
+
+#if __BYTE_ORDER == __BIG_ENDIAN
+#  define LDHI	ldl		/* high part is left in big-endian	*/
+#  define SDHI	sdl		/* high part is left in big-endian	*/
+#  define LDLO	ldr		/* low part is right in big-endian	*/
+#  define SDLO	sdr		/* low part is right in big-endian	*/
+#else
+#  define LDHI	ldr		/* high part is right in little-endian	*/
+#  define SDHI	sdr		/* high part is right in little-endian	*/
+#  define LDLO	ldl		/* low part is left in little-endian	*/
+#  define SDLO	sdl		/* low part is left in little-endian	*/
+#endif
+
+ENTRY (memcpy)
+	.set	noreorder
+
+	slti	t0, a2, 16		# Less than 16?
+	bne	t0, zero, L(last16)
+	move	v0, a0			# Setup exit value before too late
+
+	xor	t0, a1, a0		# Find a0/a1 displacement
+	andi	t0, 0x7
+	bne	t0, zero, L(shift)	# Go handle the unaligned case
+	PTR_SUBU t1, zero, a1
+	andi	t1, 0x7			# a0/a1 are aligned, but are we
+	beq	t1, zero, L(chk8w)	#  starting in the middle of a word?
+	PTR_SUBU a2, t1
+	LDHI	t0, 0(a1)		# Yes we are... take care of that
+	PTR_ADDU a1, t1
+	SDHI	t0, 0(a0)
+	PTR_ADDU a0, t1
+
+L(chk8w):
+	andi	t0, a2, 0x3f		# 64 or more bytes left?
+	beq	t0, a2, L(chk1w)
+	PTR_SUBU a3, a2, t0		# Yes
+	PTR_ADDU a3, a1			# a3 = end address of loop
+	move	a2, t0			# a2 = what will be left after loop
+L(lop8w):	
+	ld	t0,  0(a1)		# Loop taking 8 words at a time
+	ld	t1,  8(a1)
+	ld	t2, 16(a1)
+	ld	t3, 24(a1)
+	ld	ta0, 32(a1)
+	ld	ta1, 40(a1)
+	ld	ta2, 48(a1)
+	ld	ta3, 56(a1)
+	PTR_ADDIU a0, 64
+	PTR_ADDIU a1, 64
+	sd	t0, -64(a0)
+	sd	t1, -56(a0)
+	sd	t2, -48(a0)
+	sd	t3, -40(a0)
+	sd	ta0, -32(a0)
+	sd	ta1, -24(a0)
+	sd	ta2, -16(a0)
+	bne	a1, a3, L(lop8w)
+	sd	ta3,  -8(a0)
+
+L(chk1w):
+	andi	t0, a2, 0x7		# 8 or more bytes left?
+	beq	t0, a2, L(last16)
+	PTR_SUBU a3, a2, t0		# Yes, handle them one dword at a time
+	PTR_ADDU a3, a1			# a3 again end address
+	move	a2, t0
+L(lop1w):
+	ld	t0, 0(a1)
+	PTR_ADDIU a0, 8
+	PTR_ADDIU a1, 8
+	bne	a1, a3, L(lop1w)
+	sd	t0, -8(a0)
+
+L(last16):
+	blez	a2, L(lst16e)		# Handle last 16 bytes, one at a time
+	PTR_ADDU a3, a2, a1
+L(lst16l):
+	lb	t0, 0(a1)
+	PTR_ADDIU a0, 1
+	PTR_ADDIU a1, 1
+	bne	a1, a3, L(lst16l)
+	sb	t0, -1(a0)
+L(lst16e):
+	jr	ra			# Bye, bye
+	nop
+
+L(shift):
+	PTR_SUBU a3, zero, a0		# Src and Dest unaligned 
+	andi	a3, 0x7			#  (unoptimized case...)
+	beq	a3, zero, L(shft1)
+	PTR_SUBU a2, a3			# a2 = bytes left
+	LDHI	t0, 0(a1)		# Take care of first odd part
+	LDLO	t0, 7(a1)
+	PTR_ADDU a1, a3
+	SDHI	t0, 0(a0)
+	PTR_ADDU a0, a3
+L(shft1):
+	andi	t0, a2, 0x7
+	PTR_SUBU a3, a2, t0
+	PTR_ADDU a3, a1
+L(shfth):
+	LDHI	t1, 0(a1)		# Limp through, dword by dword
+	LDLO	t1, 7(a1)
+	PTR_ADDIU a0, 8
+	PTR_ADDIU a1, 8
+	bne	a1, a3, L(shfth)
+	sd	t1, -8(a0)
+	b	L(last16)		# Handle anything which may be left
+	move	a2, t0
+
+	.set	reorder
+END (memcpy)
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/memset.S libc-20030708/sysdeps/mips/mips64/memset.S
--- glibc-2.3.2/sysdeps/mips/mips64/memset.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -0,0 +1,92 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
+   Ported to mips3 n32/n64 by Alexandre Oliva <aoliva@redhat.com>
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <endian.h>
+#include <sys/asm.h>
+
+
+/* void *memset(void *s, int c, size_t n);
+	
+   This could probably be optimized further.  */
+
+#if __BYTE_ORDER == __BIG_ENDIAN
+# define SDHI	sdl		/* high part is left in big-endian	*/
+#else
+# define SDHI	sdr		/* high part is right in little-endian	*/
+#endif
+
+ENTRY (memset)
+	.set	noreorder
+
+	slti	ta1, a2, 16		# Less than 16?
+	bne	ta1, zero, L(last16)
+	move	v0, a0			# Setup exit value before too late
+
+	beq	a1, zero, L(ueven)	# If zero pattern, no need to extend
+	andi	a1, 0xff		# Avoid problems with bogus arguments
+	dsll	ta0, a1, 8
+	or	a1, ta0
+	dsll	ta0, a1, 16
+	or	a1, ta0			# a1 is now pattern in full word
+	dsll	ta0, a1, 32
+	or	a1, ta0			# a1 is now pattern in double word
+
+L(ueven):
+	PTR_SUBU ta0, zero, a0		# Unaligned address?
+	andi	ta0, 0x7
+	beq	ta0, zero, L(chkw)
+	PTR_SUBU a2, ta0
+	SDHI	a1, 0(a0)		# Yes, handle first unaligned part
+	PTR_ADDU a0, ta0		# Now both a0 and a2 are updated
+
+L(chkw):
+	andi	ta0, a2, 0xf		# Enough left for one loop iteration?
+	beq	ta0, a2, L(chkl)
+	PTR_SUBU a3, a2, ta0
+	PTR_ADDU a3, a0			# a3 is last loop address +1
+	move	a2, ta0			# a2 is now # of bytes left after loop
+L(loopw):
+	PTR_ADDIU a0, 16		# Handle 2 dwords pr. iteration
+	sd	a1, -16(a0)
+	bne	a0, a3, L(loopw)
+	sd	a1,  -8(a0)
+
+L(chkl):
+	andi	ta0, a2, 0x8		# Check if there is at least a double
+	beq	ta0, zero, L(last16)	#  word remaining after the loop
+	PTR_SUBU a2, ta0
+	sd	a1, 0(a0)		# Yes...
+	PTR_ADDIU a0, 8
+
+L(last16):
+	blez	a2, L(exit)		# Handle last 16 bytes (if cnt>0)
+	PTR_ADDU a3, a2, a0		# a3 is last address +1
+L(lst16l):
+	PTR_ADDIU a0, 1
+	bne	a0, a3, L(lst16l)
+	sb	a1, -1(a0)
+L(exit):
+	j	ra			# Bye, bye
+	nop
+
+	.set	reorder
+END (memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/mul_1.S libc-20030708/sysdeps/mips/mips64/mul_1.S
--- glibc-2.3.2/sysdeps/mips/mips64/mul_1.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/mul_1.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,8 @@
 /* MIPS3 __mpn_mul_1 -- Multiply a limb vector with a single limb and
  * store the product in a second limb vector.
  *
- * Copyright (C) 1992, 1994, 1995, 2000 Free Software Foundation, Inc.
+ * Copyright (C) 1992, 1994, 1995, 2000, 2002, 2003
+ * Free Software Foundation, Inc.
  *
  * This file is part of the GNU MP Library.
  *
@@ -22,6 +23,7 @@
  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /* INPUT PARAMETERS
  * res_ptr	$4
@@ -38,10 +40,10 @@
 	.globl	__mpn_mul_1
 	.ent	__mpn_mul_1
 __mpn_mul_1:
-	.set    noreorder
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP /* ??? unused */
 #endif
+	.set    noreorder
 	.set    nomacro
 
  # warm up phase 0
@@ -52,14 +54,14 @@
 	dmultu	$8,$7
 
 	daddiu	$6,$6,-1
-	beq	$6,$0,$LC0
-	 move	$2,$0		# zero cy2
+	beq	$6,$0,L(LC0)
+	move	$2,$0		# zero cy2
 
 	daddiu	$6,$6,-1
-	beq	$6,$0,$LC1
+	beq	$6,$0,L(LC1)
 	ld	$8,0($5)	# load new s1 limb as early as possible
 
-Loop:	mflo	$10
+L(Loop):	mflo	$10
 	mfhi	$9
 	daddiu	$5,$5,8
 	daddu	$10,$10,$2	# add old carry limb to low product limb
@@ -69,11 +71,11 @@
 	sltu	$2,$10,$2	# carry from previous addition -> $2
 	sd	$10,0($4)
 	daddiu	$4,$4,8
-	bne	$6,$0,Loop
-	 daddu	$2,$9,$2	# add high product limb and carry from addition
+	bne	$6,$0,L(Loop)
+	daddu	$2,$9,$2	# add high product limb and carry from addition
 
  # cool down phase 1
-$LC1:	mflo	$10
+L(LC1):	mflo	$10
 	mfhi	$9
 	daddu	$10,$10,$2
 	sltu	$2,$10,$2
@@ -83,7 +85,7 @@
 	daddu	$2,$9,$2	# add high product limb and carry from addition
 
  # cool down phase 0
-$LC0:	mflo	$10
+L(LC0):	mflo	$10
 	mfhi	$9
 	daddu	$10,$10,$2
 	sltu	$2,$10,$2
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/n32/Implies libc-20030708/sysdeps/mips/mips64/n32/Implies
--- glibc-2.3.2/sysdeps/mips/mips64/n32/Implies	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/n32/Implies	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1,4 @@
+mips/mips64
+mips
+wordsize-32
+ieee754/ldbl-128
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/n32/Makefile libc-20030708/sysdeps/mips/mips64/n32/Makefile
--- glibc-2.3.2/sysdeps/mips/mips64/n32/Makefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/n32/Makefile	2003-04-01 21:01:02.000000000 +0900
@@ -0,0 +1,6 @@
+# `long double' is a distinct type we support.
+long-double-fcts = yes
+
+ifeq ($(filter -mabi=n32,$(CC)),)
+CC += -mabi=n32
+endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/n64/Implies libc-20030708/sysdeps/mips/mips64/n64/Implies
--- glibc-2.3.2/sysdeps/mips/mips64/n64/Implies	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/n64/Implies	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1,4 @@
+mips/mips64
+mips
+wordsize-64
+ieee754/ldbl-128
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/n64/Makefile libc-20030708/sysdeps/mips/mips64/n64/Makefile
--- glibc-2.3.2/sysdeps/mips/mips64/n64/Makefile	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/n64/Makefile	2003-04-01 21:01:02.000000000 +0900
@@ -0,0 +1,6 @@
+# `long double' is a distinct type we support.
+long-double-fcts = yes
+
+ifeq ($(filter -mabi=64,$(CC)),)
+CC += -mabi=64
+endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/rshift.S libc-20030708/sysdeps/mips/mips64/rshift.S
--- glibc-2.3.2/sysdeps/mips/mips64/rshift.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/rshift.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,6 +1,6 @@
 /* MIPS3 __mpn_rshift --
  *
- * Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+ * Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
  *
  * This file is part of the GNU MP Library.
  *
@@ -21,6 +21,7 @@
  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /* INPUT PARAMETERS
  * res_ptr	$4
@@ -37,22 +38,22 @@
 	.globl	__mpn_rshift
 	.ent	__mpn_rshift
 __mpn_rshift:
-	.set	noreorder
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP /* ??? unused */
 #endif
+	.set	noreorder
 	.set	nomacro
 
 	ld	$10,0($5)	# load first limb
 	dsubu	$13,$0,$7
 	daddiu	$6,$6,-1
 	and	$9,$6,4-1	# number of limbs in first loop
-	beq	$9,$0,.L0	# if multiple of 4 limbs, skip first loop
-	 dsll	$2,$10,$13	# compute function result
+	beq	$9,$0,L(L0)	# if multiple of 4 limbs, skip first loop
+	dsll	$2,$10,$13	# compute function result
 
 	dsubu	$6,$6,$9
 
-.Loop0:	ld	$3,8($5)
+L(Loop0):	ld	$3,8($5)
 	daddiu	$4,$4,8
 	daddiu	$5,$5,8
 	daddiu	$9,$9,-1
@@ -60,13 +61,13 @@
 	dsll	$12,$3,$13
 	move	$10,$3
 	or	$8,$11,$12
-	bne	$9,$0,.Loop0
-	 sd	$8,-8($4)
+	bne	$9,$0,L(Loop0)
+	sd	$8,-8($4)
 
-.L0:	beq	$6,$0,.Lend
-	 nop
+L(L0):	beq	$6,$0,L(Lend)
+	nop
 
-.Loop:	ld	$3,8($5)
+L(Loop):	ld	$3,8($5)
 	daddiu	$4,$4,32
 	daddiu	$6,$6,-4
 	dsrl	$11,$10,$7
@@ -92,10 +93,10 @@
 
 	daddiu	$5,$5,32
 	or	$8,$14,$9
-	bgtz	$6,.Loop
-	 sd	$8,-8($4)
+	bgtz	$6,L(Loop)
+	sd	$8,-8($4)
 
-.Lend:	dsrl	$8,$10,$7
+L(Lend):	dsrl	$8,$10,$7
 	j	$31
 	sd	$8,0($4)
 	.end	__mpn_rshift
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/setjmp.S libc-20030708/sysdeps/mips/mips64/setjmp.S
--- glibc-2.3.2/sysdeps/mips/mips64/setjmp.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/setjmp.S	2003-03-20 19:27:55.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,6 +17,7 @@
    02111-1307 USA.  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /* The function __sigsetjmp_aux saves all the registers, but it can't
    reliably access the stack or frame pointers, so we pass them in as
@@ -26,10 +27,18 @@
 #endif
 ENTRY (__sigsetjmp)
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP
 #endif
+	SETUP_GP64 (v0, C_SYMBOL_NAME (__sigsetjmp))
 	move a2, sp
 	move a3, fp
-	dla t9, __sigsetjmp_aux
+	PTR_LA t9, __sigsetjmp_aux
+#if _MIPS_SIM == _MIPS_SIM_ABI32
 	nop
+#endif	
+	RESTORE_GP64
+#if _MIPS_SIM != _MIPS_SIM_ABI32
+	move a4, gp
+#endif
 	jr t9
+	.end __sigsetjmp
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/setjmp_aux.c libc-20030708/sysdeps/mips/mips64/setjmp_aux.c
--- glibc-2.3.2/sysdeps/mips/mips64/setjmp_aux.c	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/setjmp_aux.c	2003-03-21 07:29:44.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Brendan Kehoe (brendan@zen.org).
 
@@ -25,9 +25,11 @@
    access them in C.  */
 
 int
-__sigsetjmp_aux (jmp_buf env, int savemask, int sp, int fp)
+__sigsetjmp_aux (jmp_buf env, int savemask, long long sp, long long fp,
+		 long long gp)
 {
   /* Store the floating point callee-saved registers...  */
+#if defined _ABI64 && _MIPS_SIM == _ABI64
   asm volatile ("s.d $f24, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[0]));
   asm volatile ("s.d $f25, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[1]));
   asm volatile ("s.d $f26, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[2]));
@@ -36,6 +38,14 @@
   asm volatile ("s.d $f29, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[5]));
   asm volatile ("s.d $f30, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[6]));
   asm volatile ("s.d $f31, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[7]));
+#else
+  asm volatile ("s.d $f20, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[0]));
+  asm volatile ("s.d $f22, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[1]));
+  asm volatile ("s.d $f24, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[2]));
+  asm volatile ("s.d $f26, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[3]));
+  asm volatile ("s.d $f28, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[4]));
+  asm volatile ("s.d $f30, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[5]));
+#endif
 
   /* .. and the PC;  */
   asm volatile ("sd $31, %0" : : "m" (env[0].__jmpbuf[0].__pc));
@@ -47,7 +57,7 @@
   env[0].__jmpbuf[0].__fp = fp;
 
   /* .. and the GP; */
-  asm volatile ("sd $gp, %0" : : "m" (env[0].__jmpbuf[0].__gp));
+  env[0].__jmpbuf[0].__gp = gp;
 
   /* .. and the callee-saved registers; */
   asm volatile ("sd $16, %0" : : "m" (env[0].__jmpbuf[0].__regs[0]));
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/soft-fp/sfp-machine.h libc-20030708/sysdeps/mips/mips64/soft-fp/sfp-machine.h
--- glibc-2.3.2/sysdeps/mips/mips64/soft-fp/sfp-machine.h	2000-09-05 17:37:09.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/soft-fp/sfp-machine.h	2003-03-18 00:47:12.000000000 +0900
@@ -1,7 +1,7 @@
 #define _FP_W_TYPE_SIZE		64
-#define _FP_W_TYPE		unsigned long
-#define _FP_WS_TYPE		signed long
-#define _FP_I_TYPE		long
+#define _FP_W_TYPE		unsigned long long
+#define _FP_WS_TYPE		signed long long
+#define _FP_I_TYPE		long long
 
 #define _FP_MUL_MEAT_S(R,X,Y)					\
   _FP_MUL_MEAT_1_imm(_FP_WFRACBITS_S,R,X,Y)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/sub_n.S libc-20030708/sysdeps/mips/mips64/sub_n.S
--- glibc-2.3.2/sysdeps/mips/mips64/sub_n.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/sub_n.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS3 __mpn_sub_n -- Subtract two limb vectors of the same length > 0 and
  * store difference in a third limb vector.
  *
- * Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+ * Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
  *
  * This file is part of the GNU MP Library.
  *
@@ -22,6 +22,7 @@
  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /* INPUT PARAMETERS
  * res_ptr	$4
@@ -38,10 +39,10 @@
 	.globl	__mpn_sub_n
 	.ent	__mpn_sub_n
 __mpn_sub_n:
-	.set	noreorder
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP /* ??? unused */
 #endif
+	.set	noreorder
 	.set	nomacro
 
 	ld	$10,0($5)
@@ -49,12 +50,12 @@
 
 	daddiu	$7,$7,-1
 	and	$9,$7,4-1	# number of limbs in first loop
-	beq	$9,$0,.L0	# if multiple of 4 limbs, skip first loop
-	 move	$2,$0
+	beq	$9,$0,L(L0)	# if multiple of 4 limbs, skip first loop
+	move	$2,$0
 
 	dsubu	$7,$7,$9
 
-.Loop0:	daddiu	$9,$9,-1
+L(Loop0):	daddiu	$9,$9,-1
 	ld	$12,8($5)
 	daddu	$11,$11,$2
 	ld	$13,8($6)
@@ -68,13 +69,13 @@
 	daddiu	$6,$6,8
 	move	$10,$12
 	move	$11,$13
-	bne	$9,$0,.Loop0
-	 daddiu	$4,$4,8
+	bne	$9,$0,L(Loop0)
+	daddiu	$4,$4,8
 
-.L0:	beq	$7,$0,.Lend
-	 nop
+L(L0):	beq	$7,$0,L(Lend)
+	nop
 
-.Loop:	daddiu	$7,$7,-4
+L(Loop):	daddiu	$7,$7,-4
 
 	ld	$12,8($5)
 	daddu	$11,$11,$2
@@ -115,10 +116,10 @@
 	daddiu	$5,$5,32
 	daddiu	$6,$6,32
 
-	bne	$7,$0,.Loop
-	 daddiu	$4,$4,32
+	bne	$7,$0,L(Loop)
+	daddiu	$4,$4,32
 
-.Lend:	daddu	$11,$11,$2
+L(Lend):	daddu	$11,$11,$2
 	sltu	$8,$11,$2
 	dsubu	$11,$10,$11
 	sltu	$2,$10,$11
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mips64/submul_1.S libc-20030708/sysdeps/mips/mips64/submul_1.S
--- glibc-2.3.2/sysdeps/mips/mips64/submul_1.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mips64/submul_1.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,8 @@
 /* MIPS3 __mpn_submul_1 -- Multiply a limb vector with a single limb and
  * subtract the product from a second limb vector.
  *
- * Copyright (C) 1992, 1994, 1995, 2000 Free Software Foundation, Inc.
+ * Copyright (C) 1992, 1994, 1995, 2000, 2002, 2003
+ * Free Software Foundation, Inc.
  *
  * This file is part of the GNU MP Library.
  *
@@ -22,6 +23,7 @@
  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 /* INPUT PARAMETERS
  * res_ptr	$4
@@ -38,10 +40,10 @@
 	.globl	__mpn_submul_1
 	.ent	__mpn_submul_1
 __mpn_submul_1:
-	.set    noreorder
 #ifdef __PIC__
-	.cpload t9
+	SETUP_GP /* ??? unused */
 #endif
+	.set    noreorder
 	.set    nomacro
 
  # warm up phase 0
@@ -52,14 +54,14 @@
 	dmultu	$8,$7
 
 	daddiu	$6,$6,-1
-	beq	$6,$0,$LC0
-	 move	$2,$0		# zero cy2
+	beq	$6,$0,L(LC0)
+	move	$2,$0		# zero cy2
 
 	daddiu	$6,$6,-1
-	beq	$6,$0,$LC1
+	beq	$6,$0,L(LC1)
 	ld	$8,0($5)	# load new s1 limb as early as possible
 
-Loop:	ld	$10,0($4)
+L(Loop):	ld	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	daddiu	$5,$5,8
@@ -73,11 +75,11 @@
 	daddu	$2,$2,$10
 	sd	$3,0($4)
 	daddiu	$4,$4,8
-	bne	$6,$0,Loop
-	 daddu	$2,$9,$2	# add high product limb and carry from addition
+	bne	$6,$0,L(Loop)
+	daddu	$2,$9,$2	# add high product limb and carry from addition
 
  # cool down phase 1
-$LC1:	ld	$10,0($4)
+L(LC1):	ld	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	daddu	$3,$3,$2
@@ -91,7 +93,7 @@
 	daddu	$2,$9,$2	# add high product limb and carry from addition
 
  # cool down phase 0
-$LC0:	ld	$10,0($4)
+L(LC0):	ld	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	daddu	$3,$3,$2
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mipsel/bits/endian.h libc-20030708/sysdeps/mips/mipsel/bits/endian.h
--- glibc-2.3.2/sysdeps/mips/mipsel/bits/endian.h	1997-11-26 12:53:00.000000000 +0900
+++ libc-20030708/sysdeps/mips/mipsel/bits/endian.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,8 +0,0 @@
-/* The MIPS architecture has selectable endianness.
-   This file is for a machine using little-endian mode.  */
-
-#ifndef _ENDIAN_H
-# error "Never use <bits/endian.h> directly; include <endian.h> instead."
-#endif
-
-#define __BYTE_ORDER __LITTLE_ENDIAN
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/mul_1.S libc-20030708/sysdeps/mips/mul_1.S
--- glibc-2.3.2/sysdeps/mips/mul_1.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/mul_1.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS __mpn_mul_1 -- Multiply a limb vector with a single limb and
 store the product in a second limb vector.
 
-Copyright (C) 1995, 1998, 2000 Free Software Foundation, Inc.
+Copyright (C) 1995, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
 
 This file is part of the GNU MP Library.
 
@@ -46,14 +46,14 @@
 	multu	$8,$7
 
 	addiu	$6,$6,-1
-	beq	$6,$0,$LC0
+	beq	$6,$0,L(LC0)
 	move	$2,$0		/* zero cy2 */
 
 	addiu	$6,$6,-1
-	beq	$6,$0,$LC1
+	beq	$6,$0,L(LC1)
 	lw	$8,0($5)	/* load new s1 limb as early as possible */
 
-Loop:	mflo	$10
+L(Loop):	mflo	$10
 	mfhi	$9
 	addiu	$5,$5,4
 	addu	$10,$10,$2	/* add old carry limb to low product limb */
@@ -63,11 +63,11 @@
 	sltu	$2,$10,$2	/* carry from previous addition -> $2 */
 	sw	$10,0($4)
 	addiu	$4,$4,4
-	bne	$6,$0,Loop	/* should be "bnel" */
+	bne	$6,$0,L(Loop)	/* should be "bnel" */
 	addu	$2,$9,$2	/* add high product limb and carry from addition */
 
 	/* cool down phase 1 */
-$LC1:	mflo	$10
+L(LC1):	mflo	$10
 	mfhi	$9
 	addu	$10,$10,$2
 	sltu	$2,$10,$2
@@ -77,7 +77,7 @@
 	addu	$2,$9,$2	/* add high product limb and carry from addition */
 
 	/* cool down phase 0 */
-$LC0:	mflo	$10
+L(LC0):	mflo	$10
 	mfhi	$9
 	addu	$10,$10,$2
 	sltu	$2,$10,$2
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/rshift.S libc-20030708/sysdeps/mips/rshift.S
--- glibc-2.3.2/sysdeps/mips/rshift.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/rshift.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,6 +1,6 @@
 /* MIPS2 __mpn_rshift --
 
-Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
 
 This file is part of the GNU MP Library.
 
@@ -41,12 +41,12 @@
 	subu	$13,$0,$7
 	addiu	$6,$6,-1
 	and	$9,$6,4-1	/* number of limbs in first loop */
-	beq	$9,$0,.L0	/* if multiple of 4 limbs, skip first loop*/
+	beq	$9,$0,L(L0)	/* if multiple of 4 limbs, skip first loop*/
 	 sll	$2,$10,$13	/* compute function result */
 
 	subu	$6,$6,$9
 
-.Loop0:	lw	$3,4($5)
+L(Loop0):	lw	$3,4($5)
 	addiu	$4,$4,4
 	addiu	$5,$5,4
 	addiu	$9,$9,-1
@@ -54,13 +54,13 @@
 	sll	$12,$3,$13
 	move	$10,$3
 	or	$8,$11,$12
-	bne	$9,$0,.Loop0
+	bne	$9,$0,L(Loop0)
 	 sw	$8,-4($4)
 
-.L0:	beq	$6,$0,.Lend
+L(L0):	beq	$6,$0,L(Lend)
 	 nop
 
-.Loop:	lw	$3,4($5)
+L(Loop):	lw	$3,4($5)
 	addiu	$4,$4,16
 	addiu	$6,$6,-4
 	srl	$11,$10,$7
@@ -86,10 +86,10 @@
 
 	addiu	$5,$5,16
 	or	$8,$14,$9
-	bgtz	$6,.Loop
+	bgtz	$6,L(Loop)
 	 sw	$8,-4($4)
 
-.Lend:	srl	$8,$10,$7
+L(Lend):	srl	$8,$10,$7
 	j	$31
 	sw	$8,0($4)
 	END (__mpn_rshift)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/setjmp_aux.c libc-20030708/sysdeps/mips/setjmp_aux.c
--- glibc-2.3.2/sysdeps/mips/setjmp_aux.c	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/setjmp_aux.c	2003-03-20 19:27:55.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Brendan Kehoe (brendan@zen.org).
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/sgidefs.h libc-20030708/sysdeps/mips/sgidefs.h
--- glibc-2.3.2/sysdeps/mips/sgidefs.h	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/sgidefs.h	2003-03-28 21:28:18.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ralf Baechle <ralf@gnu.org>.
 
@@ -28,6 +28,8 @@
 #define _MIPS_ISA_MIPS3 3
 #define _MIPS_ISA_MIPS4 4
 #define _MIPS_ISA_MIPS5 5
+#define _MIPS_ISA_MIPS32 6
+#define _MIPS_ISA_MIPS64 7
 
 /*
  * Subprogram calling convention
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/sub_n.S libc-20030708/sysdeps/mips/sub_n.S
--- glibc-2.3.2/sysdeps/mips/sub_n.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/sub_n.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS2 __mpn_sub_n -- Subtract two limb vectors of the same length > 0 and
 store difference in a third limb vector.
 
-Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
 
 This file is part of the GNU MP Library.
 
@@ -43,12 +43,12 @@
 
 	addiu	$7,$7,-1
 	and	$9,$7,4-1	/* number of limbs in first loop */
-	beq	$9,$0,.L0	/* if multiple of 4 limbs, skip first loop */
-	 move	$2,$0
+	beq	$9,$0,L(L0)	/* if multiple of 4 limbs, skip first loop */
+	move	$2,$0
 
 	subu	$7,$7,$9
 
-.Loop0:	addiu	$9,$9,-1
+L(Loop0):	addiu	$9,$9,-1
 	lw	$12,4($5)
 	addu	$11,$11,$2
 	lw	$13,4($6)
@@ -62,13 +62,13 @@
 	addiu	$6,$6,4
 	move	$10,$12
 	move	$11,$13
-	bne	$9,$0,.Loop0
-	 addiu	$4,$4,4
+	bne	$9,$0,L(Loop0)
+	addiu	$4,$4,4
 
-.L0:	beq	$7,$0,.Lend
-	 nop
+L(L0):	beq	$7,$0,L(Lend)
+	nop
 
-.Loop:	addiu	$7,$7,-4
+L(Loop):	addiu	$7,$7,-4
 
 	lw	$12,4($5)
 	addu	$11,$11,$2
@@ -109,10 +109,10 @@
 	addiu	$5,$5,16
 	addiu	$6,$6,16
 
-	bne	$7,$0,.Loop
-	 addiu	$4,$4,16
+	bne	$7,$0,L(Loop)
+	addiu	$4,$4,16
 
-.Lend:	addu	$11,$11,$2
+L(Lend):	addu	$11,$11,$2
 	sltu	$8,$11,$2
 	subu	$11,$10,$11
 	sltu	$2,$10,$11
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/submul_1.S libc-20030708/sysdeps/mips/submul_1.S
--- glibc-2.3.2/sysdeps/mips/submul_1.S	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/submul_1.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,7 +1,7 @@
 /* MIPS __mpn_submul_1 -- Multiply a limb vector with a single limb and
 subtract the product from a second limb vector.
 
-Copyright (C) 1995, 2000 Free Software Foundation, Inc.
+Copyright (C) 1995, 2000, 2002, 2003 Free Software Foundation, Inc.
 
 This file is part of the GNU MP Library.
 
@@ -46,14 +46,14 @@
 	multu	$8,$7
 
 	addiu	$6,$6,-1
-	beq	$6,$0,$LC0
+	beq	$6,$0,L(LC0)
 	move	$2,$0		/* zero cy2 */
 
 	addiu	$6,$6,-1
-	beq	$6,$0,$LC1
+	beq	$6,$0,L(LC1)
 	lw	$8,0($5)	/* load new s1 limb as early as possible */
 
-Loop:	lw	$10,0($4)
+L(Loop):	lw	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	addiu	$5,$5,4
@@ -67,11 +67,11 @@
 	addu	$2,$2,$10
 	sw	$3,0($4)
 	addiu	$4,$4,4
-	bne	$6,$0,Loop	/* should be "bnel" */
+	bne	$6,$0,L(Loop)	/* should be "bnel" */
 	addu	$2,$9,$2	/* add high product limb and carry from addition */
 
 	/* cool down phase 1 */
-$LC1:	lw	$10,0($4)
+L(LC1):	lw	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	addu	$3,$3,$2
@@ -85,7 +85,7 @@
 	addu	$2,$9,$2	/* add high product limb and carry from addition */
 
 	/* cool down phase 0 */
-$LC0:	lw	$10,0($4)
+L(LC0):	lw	$10,0($4)
 	mflo	$3
 	mfhi	$9
 	addu	$3,$3,$2
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/sys/asm.h libc-20030708/sysdeps/mips/sys/asm.h
--- glibc-2.3.2/sysdeps/mips/sys/asm.h	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/sys/asm.h	2003-03-28 21:28:18.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ralf Baechle <ralf@gnu.org>.
 
@@ -23,12 +23,12 @@
 #include <sgidefs.h>
 
 #ifndef CAT
-#ifdef __STDC__
-#define __CAT(str1,str2) str1##str2
-#else
-#define __CAT(str1,str2) str1/**/str2
-#endif
-#define CAT(str1,str2) __CAT(str1,str2)
+# ifdef __STDC__
+#  define __CAT(str1,str2) str1##str2
+# else
+#  define __CAT(str1,str2) str1/**/str2
+# endif
+# define CAT(str1,str2) __CAT(str1,str2)
 #endif
 
 /*
@@ -37,26 +37,113 @@
  * 64 bit address space isn't used yet, so we may use the R3000 32 bit
  * defines for now.
  */
-#define PTR	.word
-#define PTRSIZE	4
-#define PTRLOG	2
+#if (_MIPS_SIM == _MIPS_SIM_ABI32) || (_MIPS_SIM == _MIPS_SIM_NABI32)
+# define PTR .word
+# define PTRSIZE 4
+# define PTRLOG 2
+#elif (_MIPS_SIM == _MIPS_SIM_ABI64)
+# define PTR .dword
+# define PTRSIZE 8
+# define PTRLOG 3
+#endif
 
 /*
  * PIC specific declarations
  */
-#ifdef __PIC__
-#define CPRESTORE(register)                             \
+#if (_MIPS_SIM == _MIPS_SIM_ABI32)
+# ifdef __PIC__
+#  define CPRESTORE(register) \
 		.cprestore register
-#define CPADD(register)                                 \
+#  define CPLOAD(register) \
+		.cpload register
+# else
+#  define CPRESTORE(register)
+#  define CPLOAD(register)
+# endif
+
+# define CPADD(register) \
 		.cpadd	register
-#define CPLOAD(register)                                \
-		.cpload	register
-#else
-#define CPRESTORE(register)
-#define CPADD(register)
-#define CPLOAD(register)
+
+/*
+ * Set gp when at 1st instruction
+ */
+# define SETUP_GP					\
+		.set noreorder;				\
+		.cpload $25;				\
+		.set reorder
+/* Set gp when not at 1st instruction */
+# define SETUP_GPX(r)					\
+		.set noreorder;				\
+		move r, $31;	 /* Save old ra.  */	\
+		bal 10f; /* Find addr of cpload.  */	\
+		nop;					\
+10:							\
+		.cpload $31;				\
+		move $31, r;				\
+		.set reorder
+# define SETUP_GPX_L(r, l)				\
+		.set noreorder;				\
+		move r, $31;	 /* Save old ra.  */	\
+		bal l;   /* Find addr of cpload.  */	\
+		nop;					\
+l:							\
+		.cpload $31;				\
+		move $31, r;				\
+		.set reorder
+# define SAVE_GP(x) \
+		.cprestore x /* Save gp trigger t9/jalr conversion.	 */
+# define SETUP_GP64(a, b)
+# define SETUP_GPX64(a, b)
+# define SETUP_GPX64_L(cp_reg, ra_save, l)
+# define RESTORE_GP64
+# define USE_ALT_CP(a)
+#else /* (_MIPS_SIM == _MIPS_SIM_ABI64) || (_MIPS_SIM == _MIPS_SIM_NABI32) */
+/*
+ * For callee-saved gp calling convention:
+ */
+# define SETUP_GP
+# define SETUP_GPX(r)
+# define SETUP_GPX_L(r, l)
+# define SAVE_GP(x)
+
+# define SETUP_GP64(gpoffset, proc) \
+		.cpsetup $25, gpoffset, proc
+# define SETUP_GPX64(cp_reg, ra_save)			\
+		move ra_save, $31; /* Save old ra.  */	\
+		.set noreorder;				\
+		bal 10f; /* Find addr of .cpsetup.  */	\
+		nop;					\
+10:							\
+		.set reorder;				\
+		.cpsetup $31, cp_reg, 10b;		\
+		move $31, ra_save
+# define SETUP_GPX64_L(cp_reg, ra_save, l)  \
+		move ra_save, $31; /* Save old ra.  */	\
+		.set noreorder;				\
+		bal l;   /* Find addr of .cpsetup.  */	\
+		nop;					\
+l:							\
+		.set reorder;				\
+		.cpsetup $31, cp_reg, l;		\
+		move $31, ra_save
+# define RESTORE_GP64 \
+		.cpreturn
+/* Use alternate register for context pointer.  */
+# define USE_ALT_CP(reg)	\
+		.cplocal reg
+#endif /* _MIPS_SIM != _MIPS_SIM_ABI32 */
+
+/*
+ * Stack Frame Definitions
+ */
+#if (_MIPS_SIM == _MIPS_SIM_ABI32)
+# define NARGSAVE 4 /* Space for 4 argument registers must be allocated.  */
+#endif
+#if (_MIPS_SIM == _MIPS_SIM_ABI64 || _MIPS_SIM == _MIPS_SIM_NABI32)
+# define NARGSAVE 0 /* No caller responsibilities.  */
 #endif
 
+
 /*
  * LEAF - declare leaf routine
  */
@@ -80,9 +167,11 @@
 /*
  * END - mark end of function
  */
-#define	END(function)                                   \
+#ifndef END
+# define END(function)                                   \
 		.end	function;		        \
 		.size	function,.-function
+#endif
 
 /*
  * EXPORT - export definition of symbol
@@ -141,237 +230,244 @@
  * MIPS IV implementations are free to treat this as a nop.  The R5000
  * is one of them.  So we should have an option not to use this instruction.
  */
-#if (_MIPS_ISA == _MIPS_ISA_MIPS4) || (_MIPS_ISA == _MIPS_ISA_MIPS5)
-#define PREF(hint,addr)                                 \
+#if (_MIPS_ISA == _MIPS_ISA_MIPS4) || (_MIPS_ISA == _MIPS_ISA_MIPS5) || \
+    (_MIPS_ISA == _MIPS_ISA_MIPS32) || (_MIPS_ISA == _MIPS_ISA_MIPS64)
+# define PREF(hint,addr)                                 \
 		pref	hint,addr
-#define PREFX(hint,addr)                                \
+# define PREFX(hint,addr)                                \
 		prefx	hint,addr
 #else
-#define PREF
-#define PREFX
+# define PREF
+# define PREFX
 #endif
 
 /*
  * MIPS ISA IV/V movn/movz instructions and equivalents for older CPUs.
  */
 #if _MIPS_ISA == _MIPS_ISA_MIPS1
-#define MOVN(rd,rs,rt)                                  \
+# define MOVN(rd,rs,rt)					\
 		.set	push;				\
 		.set	reorder;			\
-		beqz	rt,9f;                          \
-		move	rd,rs;                          \
+		beqz	rt,9f;				\
+		move	rd,rs;				\
 		.set	pop;				\
 9:
-#define MOVZ(rd,rs,rt)                                  \
+# define MOVZ(rd,rs,rt)					\
 		.set	push;				\
 		.set	reorder;			\
-		bnez	rt,9f;                          \
-		move	rd,rt;                          \
+		bnez	rt,9f;				\
+		move	rd,rt;				\
 		.set	pop;				\
 9:
 #endif /* _MIPS_ISA == _MIPS_ISA_MIPS1 */
 #if (_MIPS_ISA == _MIPS_ISA_MIPS2) || (_MIPS_ISA == _MIPS_ISA_MIPS3)
-#define MOVN(rd,rs,rt)                                  \
+# define MOVN(rd,rs,rt)					\
 		.set	push;				\
 		.set	noreorder;			\
-		bnezl	rt,9f;                          \
-		move	rd,rs;                          \
+		bnezl	rt,9f;				\
+		move	rd,rs;				\
 		.set	pop;				\
 9:
-#define MOVZ(rd,rs,rt)                                  \
+# define MOVZ(rd,rs,rt)					\
 		.set	push;				\
 		.set	noreorder;			\
-		beqzl	rt,9f;                          \
-		movz	rd,rs;                          \
+		beqzl	rt,9f;				\
+		movz	rd,rs;				\
 		.set	pop;				\
 9:
 #endif /* (_MIPS_ISA == _MIPS_ISA_MIPS2) || (_MIPS_ISA == _MIPS_ISA_MIPS3) */
-#if (_MIPS_ISA == _MIPS_ISA_MIPS4) || (_MIPS_ISA == _MIPS_ISA_MIPS5)
-#define MOVN(rd,rs,rt)                                  \
+#if (_MIPS_ISA == _MIPS_ISA_MIPS4) || (_MIPS_ISA == _MIPS_ISA_MIPS5) || \
+    (_MIPS_ISA == _MIPS_ISA_MIPS32) || (_MIPS_ISA == _MIPS_ISA_MIPS64)
+# define MOVN(rd,rs,rt)					\
 		movn	rd,rs,rt
-#define MOVZ(rd,rs,rt)                                  \
+# define MOVZ(rd,rs,rt)					\
 		movz	rd,rs,rt
 #endif /* (_MIPS_ISA == _MIPS_ISA_MIPS4) || (_MIPS_ISA == _MIPS_ISA_MIPS5) */
 
 /*
  * Stack alignment
  */
-#if (_MIPS_ISA == _MIPS_ISA_MIPS1) || (_MIPS_ISA == _MIPS_ISA_MIPS2)
-#define ALSZ	7
-#define ALMASK	~7
-#endif
-#if (_MIPS_ISA == _MIPS_ISA_MIPS3) || (_MIPS_ISA == _MIPS_ISA_MIPS4) || \
-    (_MIPS_ISA == _MIPS_ISA_MIPS5)
-#define ALSZ	15
-#define ALMASK	~15
+#if (_MIPS_SIM == _MIPS_SIM_ABI64) || (_MIPS_SIM == _MIPS_SIM_NABI32)
+# define ALSZ	15
+# define ALMASK	~15
+#else
+# define ALSZ	7
+# define ALMASK	~7
 #endif
 
 /*
  * Size of a register
  */
-#ifdef __mips64
-#define SZREG	8
+#if (_MIPS_SIM == _MIPS_SIM_ABI64) || (_MIPS_SIM == _MIPS_SIM_NABI32)
+# define SZREG	8
 #else
-#define SZREG	4
+# define SZREG	4
 #endif
 
 /*
  * Use the following macros in assemblercode to load/store registers,
  * pointers etc.
  */
-#if (_MIPS_ISA == _MIPS_ISA_MIPS1) || (_MIPS_ISA == _MIPS_ISA_MIPS2)
-#define REG_S sw
-#define REG_L lw
-#define PTR_SUBU subu
-#define PTR_ADDU addu
-#endif
-#if (_MIPS_ISA == _MIPS_ISA_MIPS3) || (_MIPS_ISA == _MIPS_ISA_MIPS4) || \
-    (_MIPS_ISA == _MIPS_ISA_MIPS5)
-#define REG_S sd
-#define REG_L ld
-/* We still live in a 32 bit address space ...  */
-#define PTR_SUBU subu
-#define PTR_ADDU addu
+#if (SZREG == 4)
+# define REG_S sw
+# define REG_L lw
+#else
+# define REG_S sd
+# define REG_L ld
 #endif
 
 /*
  * How to add/sub/load/store/shift C int variables.
  */
 #if (_MIPS_SZINT == 32)
-#define INT_ADD	add
-#define INT_ADDI	addi
-#define INT_ADDU	addu
-#define INT_ADDIU	addiu
-#define INT_SUB	add
-#define INT_SUBI	subi
-#define INT_SUBU	subu
-#define INT_SUBIU	subu
-#define INT_L		lw
-#define INT_S		sw
-#define LONG_SLL	sll
-#define LONG_SLLV	sllv
-#define LONG_SRL	srl
-#define LONG_SRLV	srlv
-#define LONG_SRA	sra
-#define LONG_SRAV	srav
+# define INT_ADD	add
+# define INT_ADDI	addi
+# define INT_ADDU	addu
+# define INT_ADDIU	addiu
+# define INT_SUB	add
+# define INT_SUBI	subi
+# define INT_SUBU	subu
+# define INT_SUBIU	subu
+# define INT_L		lw
+# define INT_S		sw
 #endif
 
 #if (_MIPS_SZINT == 64)
-#define INT_ADD	dadd
-#define INT_ADDI	daddi
-#define INT_ADDU	daddu
-#define INT_ADDIU	daddiu
-#define INT_SUB	dadd
-#define INT_SUBI	dsubi
-#define INT_SUBU	dsubu
-#define INT_SUBIU	dsubu
-#define INT_L		ld
-#define INT_S		sd
-#define LONG_SLL	dsll
-#define LONG_SLLV	dsllv
-#define LONG_SRL	dsrl
-#define LONG_SRLV	dsrlv
-#define LONG_SRA	dsra
-#define LONG_SRAV	dsrav
+# define INT_ADD	dadd
+# define INT_ADDI	daddi
+# define INT_ADDU	daddu
+# define INT_ADDIU	daddiu
+# define INT_SUB	dadd
+# define INT_SUBI	dsubi
+# define INT_SUBU	dsubu
+# define INT_SUBIU	dsubu
+# define INT_L		ld
+# define INT_S		sd
 #endif
 
 /*
  * How to add/sub/load/store/shift C long variables.
  */
 #if (_MIPS_SZLONG == 32)
-#define LONG_ADD	add
-#define LONG_ADDI	addi
-#define LONG_ADDU	addu
-#define LONG_ADDIU	addiu
-#define LONG_SUB	add
-#define LONG_SUBI	subi
-#define LONG_SUBU	subu
-#define LONG_SUBIU	subu
-#define LONG_L		lw
-#define LONG_S		sw
-#define LONG_SLL	sll
-#define LONG_SLLV	sllv
-#define LONG_SRL	srl
-#define LONG_SRLV	srlv
-#define LONG_SRA	sra
-#define LONG_SRAV	srav
+# define LONG_ADD	add
+# define LONG_ADDI	addi
+# define LONG_ADDU	addu
+# define LONG_ADDIU	addiu
+# define LONG_SUB	add
+# define LONG_SUBI	subi
+# define LONG_SUBU	subu
+# define LONG_SUBIU	subu
+# define LONG_L		lw
+# define LONG_S		sw
+# define LONG_SLL	sll
+# define LONG_SLLV	sllv
+# define LONG_SRL	srl
+# define LONG_SRLV	srlv
+# define LONG_SRA	sra
+# define LONG_SRAV	srav
 #endif
 
 #if (_MIPS_SZLONG == 64)
-#define LONG_ADD	dadd
-#define LONG_ADDI	daddi
-#define LONG_ADDU	daddu
-#define LONG_ADDIU	daddiu
-#define LONG_SUB	dadd
-#define LONG_SUBI	dsubi
-#define LONG_SUBU	dsubu
-#define LONG_SUBIU	dsubu
-#define LONG_L		ld
-#define LONG_S		sd
-#define LONG_SLL	dsll
-#define LONG_SLLV	dsllv
-#define LONG_SRL	dsrl
-#define LONG_SRLV	dsrlv
-#define LONG_SRA	dsra
-#define LONG_SRAV	dsrav
+# define LONG_ADD	dadd
+# define LONG_ADDI	daddi
+# define LONG_ADDU	daddu
+# define LONG_ADDIU	daddiu
+# define LONG_SUB	dadd
+# define LONG_SUBI	dsubi
+# define LONG_SUBU	dsubu
+# define LONG_SUBIU	dsubu
+# define LONG_L		ld
+# define LONG_S		sd
+# define LONG_SLL	dsll
+# define LONG_SLLV	dsllv
+# define LONG_SRL	dsrl
+# define LONG_SRLV	dsrlv
+# define LONG_SRA	dsra
+# define LONG_SRAV	dsrav
 #endif
 
 /*
  * How to add/sub/load/store/shift pointers.
  */
-#if (_MIPS_SZLONG == 32)
-#define PTR_ADD	add
-#define PTR_ADDI	addi
-#define PTR_ADDU	addu
-#define PTR_ADDIU	addiu
-#define PTR_SUB		add
-#define PTR_SUBI	subi
-#define PTR_SUBU	subu
-#define PTR_SUBIU	subu
-#define PTR_L		lw
-#define PTR_S		sw
-#define PTR_SLL		sll
-#define PTR_SLLV	sllv
-#define PTR_SRL		srl
-#define PTR_SRLV	srlv
-#define PTR_SRA		sra
-#define PTR_SRAV	srav
-
-#define PTR_SCALESHIFT	2
-#endif
-
-#if (_MIPS_SZLONG == 64)
-#define PTR_ADD	dadd
-#define PTR_ADDI	daddi
-#define PTR_ADDU	daddu
-#define PTR_ADDIU	daddiu
-#define PTR_SUB		dadd
-#define PTR_SUBI	dsubi
-#define PTR_SUBU	dsubu
-#define PTR_SUBIU	dsubu
-#define PTR_L		ld
-#define PTR_S		sd
-#define PTR_SLL		dsll
-#define PTR_SLLV	dsllv
-#define PTR_SRL		dsrl
-#define PTR_SRLV	dsrlv
-#define PTR_SRA		dsra
-#define PTR_SRAV	dsrav
+#if (_MIPS_SIM == _MIPS_SIM_ABI32 && _MIPS_SZPTR == 32)
+# define PTR_ADD	add
+# define PTR_ADDI	addi
+# define PTR_ADDU	addu
+# define PTR_ADDIU	addiu
+# define PTR_SUB	add
+# define PTR_SUBI	subi
+# define PTR_SUBU	subu
+# define PTR_SUBIU	subu
+# define PTR_L		lw
+# define PTR_LA		la
+# define PTR_S		sw
+# define PTR_SLL	sll
+# define PTR_SLLV	sllv
+# define PTR_SRL	srl
+# define PTR_SRLV	srlv
+# define PTR_SRA	sra
+# define PTR_SRAV	srav
+
+# define PTR_SCALESHIFT	2
+#endif
+
+#if _MIPS_SIM == _MIPS_SIM_NABI32
+# define PTR_ADD	add
+# define PTR_ADDI	addi
+# define PTR_ADDU	add /* no u */
+# define PTR_ADDIU	addi /* no u */
+# define PTR_SUB	add
+# define PTR_SUBI	subi
+# define PTR_SUBU	sub /* no u */
+# define PTR_SUBIU	sub /* no u */
+# define PTR_L		lw
+# define PTR_LA		la
+# define PTR_S		sw
+# define PTR_SLL	sll
+# define PTR_SLLV	sllv
+# define PTR_SRL	srl
+# define PTR_SRLV	srlv
+# define PTR_SRA	sra
+# define PTR_SRAV	srav
+
+# define PTR_SCALESHIFT	2
+#endif
+
+#if (_MIPS_SIM == _MIPS_SIM_ABI32 && _MIPS_SZPTR == 64 /* o64??? */) \
+    || _MIPS_SIM == _MIPS_SIM_ABI64
+# define PTR_ADD	dadd
+# define PTR_ADDI	daddi
+# define PTR_ADDU	daddu
+# define PTR_ADDIU	daddiu
+# define PTR_SUB	dadd
+# define PTR_SUBI	dsubi
+# define PTR_SUBU	dsubu
+# define PTR_SUBIU	dsubu
+# define PTR_L		ld
+# define PTR_LA		dla
+# define PTR_S		sd
+# define PTR_SLL	dsll
+# define PTR_SLLV	dsllv
+# define PTR_SRL	dsrl
+# define PTR_SRLV	dsrlv
+# define PTR_SRA	dsra
+# define PTR_SRAV	dsrav
 
-#define PTR_SCALESHIFT	3
+# define PTR_SCALESHIFT	3
 #endif
 
 /*
  * Some cp0 registers were extended to 64bit for MIPS III.
  */
-#if (_MIPS_ISA == _MIPS_ISA_MIPS1) || (_MIPS_ISA == _MIPS_ISA_MIPS2)
-#define MFC0	mfc0
-#define MTC0	mtc0
+#if (_MIPS_ISA == _MIPS_ISA_MIPS1) || (_MIPS_ISA == _MIPS_ISA_MIPS2) || \
+    (_MIPS_ISA == _MIPS_ISA_MIPS32)
+# define MFC0	mfc0
+# define MTC0	mtc0
 #endif
 #if (_MIPS_ISA == _MIPS_ISA_MIPS3) || (_MIPS_ISA == _MIPS_ISA_MIPS4) || \
-    (_MIPS_ISA == _MIPS_ISA_MIPS5)
-#define MFC0	dmfc0
-#define MTC0	dmtc0
+    (_MIPS_ISA == _MIPS_ISA_MIPS5) || (_MIPS_ISA == _MIPS_ISA_MIPS64)
+# define MFC0	dmfc0
+# define MTC0	dmtc0
 #endif
 
 #endif /* sys/asm.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/sys/regdef.h libc-20030708/sysdeps/mips/sys/regdef.h
--- glibc-2.3.2/sysdeps/mips/sys/regdef.h	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/sys/regdef.h	2003-04-15 23:55:49.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ralf Baechle <ralf@gnu.org>.
 
@@ -31,6 +31,20 @@
 #define a1      $5
 #define a2      $6
 #define a3      $7
+#if _MIPS_SIM != _MIPS_SIM_ABI32
+#define a4      $8
+#define a5      $9
+#define a6      $10
+#define a7      $11
+#define t0      $12
+#define t1      $13
+#define t2      $14
+#define t3      $15
+#define ta0     a4
+#define ta1     a5
+#define ta2     a6
+#define ta3     a7
+#else /* if _MIPS_SIM == _MIPS_SIM_ABI32 */
 #define t0      $8      /* caller saved */
 #define t1      $9
 #define t2      $10
@@ -39,6 +53,11 @@
 #define t5      $13
 #define t6      $14
 #define t7      $15
+#define ta0     t4
+#define ta1     t5
+#define ta2     t6
+#define ta3     t7
+#endif /* _MIPS_SIM == _MIPS_SIM_ABI32 */
 #define s0      $16     /* callee saved */
 #define s1      $17
 #define s2      $18
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/mips/sys/ucontext.h libc-20030708/sysdeps/mips/sys/ucontext.h
--- glibc-2.3.2/sysdeps/mips/sys/ucontext.h	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/mips/sys/ucontext.h	2003-03-18 00:47:12.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 1999 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -25,7 +25,11 @@
 #include <signal.h>
 
 /* Type for general register.  */
-typedef unsigned int greg_t;
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+typedef __uint32_t greg_t;
+#else
+typedef __uint64_t greg_t;
+#endif
 
 /* Number of general registers.  */
 #define NGREG	36
@@ -115,9 +119,15 @@
 {
   union
   {
+#if _MIPS_SIM == _MIPS_SIM_ABI32
     double fp_dregs[16];
     float fp_fregs[32];
     unsigned int fp_regs[32];
+#else
+    double fp_dregs[32];
+    /* float fp_fregs[32]; */
+    __uint64_t fp_regs[32];
+#endif
   } fp_r;
   unsigned int fp_csr;
   unsigned int fp_pad;
@@ -133,12 +143,16 @@
 /* Userlevel context.  */
 typedef struct ucontext
 {
+#if _MIPS_SIM == _MIPS_SIM_ABI32
   unsigned long int uc_flags;
+#else
+  __uint64_t uc_flags;
+#endif
   struct ucontext *uc_link;
   __sigset_t uc_sigmask;
   stack_t uc_stack;
   mcontext_t uc_mcontext;
-  long int uc_filler[48];
+  int uc_filler[48];
 } ucontext_t;
 
 #endif /* sys/ucontext.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/clock_getres.c libc-20030708/sysdeps/posix/clock_getres.c
--- glibc-2.3.2/sysdeps/posix/clock_getres.c	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/posix/clock_getres.c	2003-07-08 22:58:11.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -24,7 +24,7 @@
 #include <libc-internal.h>
 
 
-#if HP_TIMING_AVAIL
+#if HP_TIMING_AVAIL && !defined HANDLED_CPUTIME
 /* Clock frequency of the processor.  */
 static long int nsec;
 #endif
@@ -38,26 +38,45 @@
 
   switch (clock_id)
     {
-    case CLOCK_REALTIME:
-      {
-	long int clk_tck = sysconf (_SC_CLK_TCK);
+#define HANDLE_REALTIME \
+      do {								      \
+	long int clk_tck = sysconf (_SC_CLK_TCK);			      \
+									      \
+	if (__builtin_expect (clk_tck != -1, 1))			      \
+	  {								      \
+	    /* This implementation assumes that the realtime clock has a      \
+	       resolution higher than 1 second.  This is the case for any     \
+	       reasonable implementation.  */				      \
+	    res->tv_sec = 0;						      \
+	    res->tv_nsec = 1000000000 / clk_tck;			      \
+									      \
+	    retval = 0;							      \
+	  }								      \
+      } while (0)
 
-	if (__builtin_expect (clk_tck != -1, 1))
-	  {
-	    /* This implementation assumes that the realtime clock has a
-	       resolution higher than 1 second.  This is the case for any
-	       reasonable implementation.  */
-	    res->tv_sec = 0;
-	    res->tv_nsec = 1000000000 / clk_tck;
+#ifdef SYSDEP_GETRES
+      SYSDEP_GETRES;
+#endif
 
-	    retval = 0;
-	  }
-      }
+#ifndef HANDLED_REALTIME
+    case CLOCK_REALTIME:
+      HANDLE_REALTIME;
       break;
+#endif	/* handled REALTIME */
 
+    default:
 #if HP_TIMING_AVAIL
+      if ((clock_id & ((1 << CLOCK_IDFIELD_SIZE) - 1))
+	  != CLOCK_THREAD_CPUTIME_ID)
+#endif
+	{
+	  __set_errno (EINVAL);
+	  break;
+	}
+
+#if HP_TIMING_AVAIL && !defined HANDLED_CPUTIME
+      /* FALLTHROUGH.  */
     case CLOCK_PROCESS_CPUTIME_ID:
-    case CLOCK_THREAD_CPUTIME_ID:
       {
 	if (__builtin_expect (nsec == 0, 0))
 	  {
@@ -84,10 +103,6 @@
       }
       break;
 #endif
-
-    default:
-      __set_errno (EINVAL);
-      break;
     }
 
   return retval;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/fpathconf.c libc-20030708/sysdeps/posix/fpathconf.c
--- glibc-2.3.2/sysdeps/posix/fpathconf.c	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/posix/fpathconf.c	2003-03-14 15:22:16.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1991,1995,1996,1998,2000,2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1995,1996,1998,2000,2001,2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -229,6 +230,10 @@
       /* In general there are no limits.  If a system has one it should
 	 overwrite this case.  */
       return -1;
+
+    case _PC_2_SYMLINKS:
+      /* Unix systems generally have symlinks.  */
+      return 1;
     }
 }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/getaddrinfo.c libc-20030708/sysdeps/posix/getaddrinfo.c
--- glibc-2.3.2/sysdeps/posix/getaddrinfo.c	2002-12-17 10:13:35.000000000 +0900
+++ libc-20030708/sysdeps/posix/getaddrinfo.c	2003-07-08 22:58:12.000000000 +0900
@@ -37,8 +37,10 @@
 
 #include <assert.h>
 #include <errno.h>
+#include <ifaddrs.h>
 #include <netdb.h>
 #include <resolv.h>
+#include <stdbool.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -111,12 +113,17 @@
 		const struct addrinfo *req, struct addrinfo **pai);
   };
 
-#if PF_UNSPEC == 0
-static const struct addrinfo default_hints;
-#else
 static const struct addrinfo default_hints =
-	{ 0, PF_UNSPEC, 0, 0, 0, NULL, NULL, NULL };
-#endif
+  {
+    .ai_flags = AI_DEFAULT,
+    .ai_family = PF_UNSPEC,
+    .ai_socktype = 0,
+    .ai_protocol = 0,
+    .ai_addrlen = 0,
+    .ai_addr = NULL,
+    .ai_canonname = NULL,
+    .ai_next = NULL
+  };
 
 
 #if 0
@@ -265,93 +272,137 @@
   return 0;
 }
 
-#define gethosts(_family, _type)				\
- {								\
-  int i, herrno;						\
-  size_t tmpbuflen;						\
-  struct hostent th;						\
-  char *tmpbuf = NULL;						\
-  tmpbuflen = 512;						\
-  no_data = 0;							\
-  do {								\
-    tmpbuf = extend_alloca (tmpbuf, tmpbuflen, 2 * tmpbuflen);	\
-    rc = __gethostbyname2_r (name, _family, &th, tmpbuf,	\
-         tmpbuflen, &h, &herrno);				\
-  } while (rc == ERANGE && herrno == NETDB_INTERNAL);		\
-  if (rc != 0)							\
-    {								\
-      if (herrno == NETDB_INTERNAL)				\
-	{							\
-	  __set_h_errno (herrno);				\
-	  return -EAI_SYSTEM;					\
-	}							\
-      if (herrno == TRY_AGAIN)					\
-	no_data = EAI_AGAIN;					\
-      else							\
-	no_data = herrno == NO_DATA;				\
-    }								\
-  else if (h != NULL)						\
-    {								\
-      for (i = 0; h->h_addr_list[i]; i++)			\
-	{							\
-	  if (*pat == NULL) {					\
-	    *pat = __alloca (sizeof (struct gaih_addrtuple));	\
-	    (*pat)->scopeid = 0;				\
-	  }							\
-	  (*pat)->next = NULL;					\
-	  (*pat)->family = _family;				\
-	  memcpy ((*pat)->addr, h->h_addr_list[i],		\
-		 sizeof(_type));				\
-	  pat = &((*pat)->next);				\
-	}							\
-    }								\
+#define gethosts(_family, _type) \
+ {									      \
+  int i, herrno;							      \
+  size_t tmpbuflen;							      \
+  struct hostent th;							      \
+  char *tmpbuf = NULL;							      \
+  tmpbuflen = 512;							      \
+  no_data = 0;								      \
+  do {									      \
+    tmpbuf = extend_alloca (tmpbuf, tmpbuflen, 2 * tmpbuflen);		      \
+    rc = __gethostbyname2_r (name, _family, &th, tmpbuf,		      \
+         tmpbuflen, &h, &herrno);					      \
+  } while (rc == ERANGE && herrno == NETDB_INTERNAL);			      \
+  if (rc != 0)								      \
+    {									      \
+      if (herrno == NETDB_INTERNAL)					      \
+	{								      \
+	  __set_h_errno (herrno);					      \
+	  return -EAI_SYSTEM;						      \
+	}								      \
+      if (herrno == TRY_AGAIN)						      \
+	no_data = EAI_AGAIN;						      \
+      else								      \
+	no_data = herrno == NO_DATA;					      \
+    }									      \
+  else if (h != NULL)							      \
+    {									      \
+      for (i = 0; h->h_addr_list[i]; i++)				      \
+	{								      \
+	  if (*pat == NULL) {						      \
+	    *pat = __alloca (sizeof (struct gaih_addrtuple));		      \
+	    (*pat)->scopeid = 0;					      \
+	  }								      \
+	  (*pat)->next = NULL;						      \
+	  (*pat)->family = _family;					      \
+	  memcpy ((*pat)->addr, h->h_addr_list[i],			      \
+		 sizeof(_type));					      \
+	  pat = &((*pat)->next);					      \
+	}								      \
+      if (_family == AF_INET6)						      \
+	got_ipv6 = true;						      \
+    }									      \
+  else if (_family == AF_INET6 && (req->ai_flags & AI_V4MAPPED))	      \
+    {									      \
+      /* We have to add V4 mapped addresses.  Maybe we discard them	      \
+         later again but we get them anyhow for now.  */		      \
+      while ((rc = __gethostbyname2_r (name, AF_INET6, &th, tmpbuf,	      \
+				       tmpbuflen, &h, &herrno)) == ERANGE     \
+	     && herrno == NETDB_INTERNAL)				      \
+	tmpbuf = extend_alloca (tmpbuf, tmpbuflen, 2 * tmpbuflen);	      \
+									      \
+      if (rc != 0)							      \
+	{								      \
+	  if (herrno == NETDB_INTERNAL)					      \
+	    {								      \
+	      __set_h_errno (herrno);					      \
+	      return -EAI_SYSTEM;					      \
+	    }								      \
+	  if (herrno == TRY_AGAIN)					      \
+	    no_data = EAI_AGAIN;					      \
+	  else								      \
+	    no_data = herrno == NO_DATA;				      \
+	}								      \
+      else if (h != NULL)						      \
+	{								      \
+	  for (i = 0; h->h_addr_list[i]; ++i)				      \
+	    {								      \
+	      if (*pat == NULL)						      \
+		{							      \
+		  *pat = __alloca (sizeof (struct gaih_addrtuple));	      \
+		  (*pat)->scopeid = 0;					      \
+		}							      \
+	      uint32_t *addr = (uint32_t *) (*pat)->addr;		      \
+	      (*pat)->next = NULL;					      \
+	      (*pat)->family = _family;					      \
+	      addr[3] = *(uint32_t *) h->h_addr_list[i];		      \
+	      addr[2] = htonl (0xffff);					      \
+	      addr[1] = 0;						      \
+	      addr[0] = 0;						      \
+	      pat = &((*pat)->next);					      \
+	    }								      \
+	}								      \
+    }									      \
  }
 
-#define gethosts2(_family, _type)				\
- {								\
-  int i, herrno;						\
-  size_t tmpbuflen;						\
-  struct hostent th;						\
-  char *tmpbuf = NULL;						\
-  tmpbuflen = 512;						\
-  no_data = 0;							\
-  do {								\
-    tmpbuf = extend_alloca (tmpbuf, tmpbuflen, 2 * tmpbuflen);	\
-    rc = 0;							\
-    status = DL_CALL_FCT (fct, (name, _family, &th, tmpbuf,	\
-           tmpbuflen, &rc, &herrno));			        \
-  } while (rc == ERANGE && herrno == NETDB_INTERNAL);		\
-  if (status == NSS_STATUS_SUCCESS && rc == 0)			\
-    h = &th;							\
-  else								\
-    h = NULL;							\
-  if (rc != 0)							\
-    {								\
-      if (herrno == NETDB_INTERNAL)				\
-	{							\
-	  __set_h_errno (herrno);				\
-	  return -EAI_SYSTEM;					\
-	}							\
-      if (herrno == TRY_AGAIN)					\
-	no_data = EAI_AGAIN;					\
-      else							\
-	no_data = herrno == NO_DATA;				\
-    }								\
-  else if (h != NULL)						\
-    {								\
-      for (i = 0; h->h_addr_list[i]; i++)			\
-	{							\
-	  if (*pat == NULL) {					\
-	    *pat = __alloca (sizeof (struct gaih_addrtuple));	\
-	    (*pat)->scopeid = 0;				\
-	  }							\
-	  (*pat)->next = NULL;					\
-	  (*pat)->family = _family;				\
-	  memcpy ((*pat)->addr, h->h_addr_list[i],		\
-		 sizeof(_type));				\
-	  pat = &((*pat)->next);				\
-	}							\
-    }								\
+
+#define gethosts2(_family, _type) \
+ {									      \
+  int i, herrno;							      \
+  size_t tmpbuflen;							      \
+  struct hostent th;							      \
+  char *tmpbuf = NULL;							      \
+  tmpbuflen = 512;							      \
+  no_data = 0;								      \
+  do {									      \
+    tmpbuf = extend_alloca (tmpbuf, tmpbuflen, 2 * tmpbuflen);		      \
+    rc = 0;								      \
+    status = DL_CALL_FCT (fct, (name, _family, &th, tmpbuf,		      \
+           tmpbuflen, &rc, &herrno));					      \
+  } while (rc == ERANGE && herrno == NETDB_INTERNAL);			      \
+  if (status == NSS_STATUS_SUCCESS && rc == 0)				      \
+    h = &th;								      \
+  else									      \
+    h = NULL;								      \
+  if (rc != 0)								      \
+    {									      \
+      if (herrno == NETDB_INTERNAL)					      \
+	{								      \
+	  __set_h_errno (herrno);					      \
+	  return -EAI_SYSTEM;						      \
+	}								      \
+      if (herrno == TRY_AGAIN)						      \
+	no_data = EAI_AGAIN;						      \
+      else								      \
+	no_data = herrno == NO_DATA;					      \
+    }									      \
+  else if (h != NULL)							      \
+    {									      \
+      for (i = 0; h->h_addr_list[i]; i++)				      \
+	{								      \
+	  if (*pat == NULL) {						      \
+	    *pat = __alloca (sizeof (struct gaih_addrtuple));		      \
+	    (*pat)->scopeid = 0;					      \
+	  }								      \
+	  (*pat)->next = NULL;						      \
+	  (*pat)->family = _family;					      \
+	  memcpy ((*pat)->addr, h->h_addr_list[i],			      \
+		 sizeof(_type));					      \
+	  pat = &((*pat)->next);					      \
+	}								      \
+    }									      \
  }
 
 typedef enum nss_status (*nss_gethostbyname2_r)
@@ -368,6 +419,7 @@
   struct gaih_servtuple *st = (struct gaih_servtuple *) &nullserv;
   struct gaih_addrtuple *at = NULL;
   int rc;
+  bool got_ipv6 = false;
 
   if (req->ai_protocol || req->ai_socktype)
     {
@@ -490,6 +542,13 @@
 	{
 	  if (req->ai_family == AF_UNSPEC || req->ai_family == AF_INET)
 	    at->family = AF_INET;
+	  else if (req->ai_flags & AI_V4MAPPED)
+	    {
+	      ((uint32_t *) at->addr)[3] = *(uint32_t *) at->addr;
+	      ((uint32_t *) at->addr)[2] = htonl (0xffff);
+	      ((uint32_t *) at->addr)[1] = 0;
+	      ((uint32_t *) at->addr)[0] = 0;
+	    }
 	  else
 	    return -EAI_ADDRFAMILY;
 	}
@@ -507,6 +566,8 @@
 	    {
 	      if (req->ai_family == AF_UNSPEC || req->ai_family == AF_INET6)
 		at->family = AF_INET6;
+	      else if (IN6_IS_ADDR_V4MAPPED (at->addr))
+		*(uint32_t *) at->addr = ((uint32_t *) at->addr)[3];
 	      else
 		return -EAI_ADDRFAMILY;
 
@@ -610,7 +671,10 @@
 	      no_inet6_data = no_data;
 	    }
 	  else if (req->ai_family == AF_INET)
-	    gethosts (AF_INET, struct in_addr);
+	    {
+	      gethosts (AF_INET, struct in_addr);
+	      no_inet6_data = no_data;
+	    }
 
 	  if (no_data != 0 && no_inet6_data != 0)
 	    {
@@ -677,13 +741,11 @@
 	    int herrno;
 	    struct hostent th;
 	    size_t tmpbuflen = 512;
-	    char *tmpbuf;
+	    char *tmpbuf = NULL;
 
 	    do
 	      {
-		tmpbuflen *= 2;
-		tmpbuf = __alloca (tmpbuflen);
-
+		tmpbuf = extend_alloca (tmpbuf, tmpbuflen, tmpbuflen * 2);
 		rc = __gethostbyaddr_r (at2->addr,
 					((at2->family == AF_INET6)
 					 ? sizeof(struct in6_addr)
@@ -692,7 +754,7 @@
 					&h, &herrno);
 
 	      }
-	    while (rc == errno && herrno == NETDB_INTERNAL);
+	    while (rc == ERANGE && herrno == NETDB_INTERNAL);
 
 	    if (rc != 0 && herrno == NETDB_INTERNAL)
 	      {
@@ -749,6 +811,14 @@
 	  {
 	    family = AF_INET6;
 	    socklen = sizeof (struct sockaddr_in6);
+
+	    /* If we looked up IPv4 mapped address discard them here if
+	       the caller isn't interested in all address and we have
+	       found at least one IPv6 address.  */
+	    if (! got_ipv6
+		&& (req->ai_flags & (AI_V4MAPPED|AI_ALL)) == AI_V4MAPPED
+		&& IN6_IS_ADDR_V4MAPPED (at2->addr))
+	      goto ignore;
 	  }
 	else
 	  {
@@ -767,7 +837,7 @@
 	    (*pai)->ai_socktype = st2->socktype;
 	    (*pai)->ai_protocol = st2->protocol;
 	    (*pai)->ai_addrlen = socklen;
-	    (*pai)->ai_addr = (void *) (*pai) + sizeof(struct addrinfo);
+	    (*pai)->ai_addr = (void *) (*pai) + sizeof (struct addrinfo);
 #if SALEN
 	    (*pai)->ai_addr->sa_len = socklen;
 #endif /* SALEN */
@@ -807,6 +877,7 @@
 	    pai = &((*pai)->ai_next);
 	  }
 
+      ignore:
 	at2 = at2->next;
       }
   }
@@ -831,6 +902,7 @@
   struct addrinfo *p = NULL, **end;
   struct gaih *g = gaih, *pg = NULL;
   struct gaih_service gaih_service, *pservice;
+  struct addrinfo local_hints;
 
   if (name != NULL && name[0] == '*' && name[1] == 0)
     name = NULL;
@@ -844,12 +916,41 @@
   if (hints == NULL)
     hints = &default_hints;
 
-  if (hints->ai_flags & ~(AI_PASSIVE|AI_CANONNAME|AI_NUMERICHOST))
+  if (hints->ai_flags
+      & ~(AI_PASSIVE|AI_CANONNAME|AI_NUMERICHOST|AI_ADDRCONFIG|AI_V4MAPPED
+	  |AI_ALL))
     return EAI_BADFLAGS;
 
   if ((hints->ai_flags & AI_CANONNAME) && name == NULL)
     return EAI_BADFLAGS;
 
+  if (hints->ai_flags & AI_ADDRCONFIG)
+    {
+      /* Determine whether we have IPv4 or IPv6 interfaces or both.
+	 We cannot cache the results since new interfaces could be
+	 added at any time.  */
+      bool seen_ipv4;
+      bool seen_ipv6;
+      __check_pf (&seen_ipv4, &seen_ipv6);
+
+      /* Now make a decision on what we return, if anything.  */
+      if (hints->ai_family == PF_UNSPEC)
+	{
+	  /* If we haven't seen both IPv4 and IPv6 interfaces we can
+	     narrow down the search.  */
+	  if (! seen_ipv4 || ! seen_ipv6)
+	    {
+	      local_hints = *hints;
+	      local_hints.ai_family = seen_ipv4 ? PF_INET : PF_INET6;
+	      hints = &local_hints;
+	    }
+	}
+      else if ((hints->ai_family == PF_INET && ! seen_ipv4)
+	       || (hints->ai_family == PF_INET6 && ! seen_ipv6))
+	/* We cannot possibly return a valid answer.  */
+	return EAI_NONAME;
+    }
+
   if (service && service[0])
     {
       char *c;
@@ -923,6 +1024,8 @@
 }
 libc_hidden_def (getaddrinfo)
 
+static_link_warning (getaddrinfo)
+
 void
 freeaddrinfo (struct addrinfo *ai)
 {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/pathconf.c libc-20030708/sysdeps/posix/pathconf.c
--- glibc-2.3.2/sysdeps/posix/pathconf.c	2001-07-08 04:21:27.000000000 +0900
+++ libc-20030708/sysdeps/posix/pathconf.c	2003-03-14 15:22:16.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1991,1995,1996,1998,2000,2001 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1995,1996,1998,2000,2001,2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -225,6 +226,10 @@
       /* In general there are no limits.  If a system has one it should
 	 overwrite this case.  */
       return -1;
+
+    case _PC_2_SYMLINKS:
+      /* Unix systems generally have symlinks.  */
+      return 1;
     }
 }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/remove.c libc-20030708/sysdeps/posix/remove.c
--- glibc-2.3.2/sysdeps/posix/remove.c	2002-08-11 03:09:09.000000000 +0900
+++ libc-20030708/sysdeps/posix/remove.c	2003-04-28 23:53:24.000000000 +0900
@@ -1,5 +1,5 @@
 /* ANSI C `remove' function to delete a file or directory.  POSIX.1 version.
-   Copyright (C) 1995,96,97,2002 Free Software Foundation, Inc.
+   Copyright (C) 1995,96,97,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -25,17 +25,15 @@
 remove (file)
      const char *file;
 {
-  int save;
+  /* First try to unlink since this is more frequently the necessary action. */
+  if (__unlink (file) != 0
+      /* If it is indeed a directory...  */
+      && (errno != EISDIR
+	  /* ...try to remove it.  */
+	  || __rmdir (file) != 0))
+    /* Cannot remove the object for whatever reason.  */
+    return -1;
 
-  save = errno;
-  if (__rmdir (file) == 0)
-    return 0;
-  else if (errno == ENOTDIR && __unlink (file) == 0)
-    {
-      __set_errno (save);
-      return 0;
-    }
-
-  return -1;
+  return 0;
 }
 libc_hidden_def (remove)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/sigpause.c libc-20030708/sysdeps/posix/sigpause.c
--- glibc-2.3.2/sysdeps/posix/sigpause.c	2003-01-28 18:02:08.000000000 +0900
+++ libc-20030708/sysdeps/posix/sigpause.c	2003-07-08 22:58:13.000000000 +0900
@@ -34,14 +34,15 @@
     {
       /* The modern X/Open implementation is requested.  */
       if (__sigprocmask (0, NULL, &set) < 0
-	  /* Perform the tests from sigdelset ourselves.  */
-	  || sig_or_mask <= 0 || sig_or_mask >= NSIG
-	  || __sigdelset (&set, sig_or_mask) < 0)
+	  || sigdelset (&set, sig_or_mask) < 0)
 	return -1;
     }
   else if (sigset_set_old_mask (&set, sig_or_mask) < 0)
     return -1;
 
+  /* Note the sigpause() is a cancellation point.  But since we call
+     sigsuspend() which itself is a cancellation point we do not have
+     to do anything here.  */
   return __sigsuspend (&set);
 }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/sprofil.c libc-20030708/sysdeps/posix/sprofil.c
--- glibc-2.3.2/sysdeps/posix/sprofil.c	2002-12-16 13:26:25.000000000 +0900
+++ libc-20030708/sysdeps/posix/sprofil.c	2003-06-12 08:54:04.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001,02 Free Software Foundation, Inc.
+/* Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    Contributed by David Mosberger-Tang <davidm@hpl.hp.com>.
    This file is part of the GNU C Library.
 
@@ -104,7 +104,7 @@
   return pc;
 }
 
-static inline void
+static void
 profil_count (void *pcp, int prof_uint)
 {
   struct region *region, *r = prof_info.last;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/sysconf.c libc-20030708/sysdeps/posix/sysconf.c
--- glibc-2.3.2/sysdeps/posix/sysconf.c	2003-02-18 07:45:41.000000000 +0900
+++ libc-20030708/sysdeps/posix/sysconf.c	2003-03-19 08:49:45.000000000 +0900
@@ -938,7 +938,7 @@
 #endif
 
     case _SC_MONOTONIC_CLOCK:
-#ifdef _POSIX_MONOTONIC_CLOCK
+#if _POSIX_MONOTONIC_CLOCK
       return _POSIX_MONOTONIC_CLOCK;
 #else
       return -1;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/system.c libc-20030708/sysdeps/posix/system.c
--- glibc-2.3.2/sysdeps/posix/system.c	2003-01-05 09:30:53.000000000 +0900
+++ libc-20030708/sysdeps/posix/system.c	2003-07-08 22:58:13.000000000 +0900
@@ -162,6 +162,9 @@
 	}
       while (child != pid);
 #else
+      /* Note the system() is a cancellation point.  But since we call
+	 waitpid() which itself is a cancellation point we do not
+	 have to do anything here.  */
       if (TEMP_FAILURE_RETRY (__waitpid (pid, &status, 0)) != pid)
 	status = -1;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/posix/waitid.c libc-20030708/sysdeps/posix/waitid.c
--- glibc-2.3.2/sysdeps/posix/waitid.c	2002-12-15 18:38:00.000000000 +0900
+++ libc-20030708/sysdeps/posix/waitid.c	2003-07-08 22:58:13.000000000 +0900
@@ -1,5 +1,5 @@
 /* Pseudo implementation of waitid.
-   Copyright (C) 1997, 1998, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Zack Weinberg <zack@rabi.phys.columbia.edu>, 1997.
 
@@ -66,6 +66,9 @@
       return -1;
     }
 
+  /* Note the waitid() is a cancellation point.  But since we call
+     waitpid() which itself is a cancellation point we do not have
+     to do anything here.  */
   child = __waitpid (pid, &status, options);
 
   if (child == -1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/bits/atomic.h libc-20030708/sysdeps/powerpc/bits/atomic.h
--- glibc-2.3.2/sysdeps/powerpc/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/bits/atomic.h	2003-05-21 23:20:34.000000000 +0900
@@ -0,0 +1,236 @@
+/* Atomic operations.  PowerPC Common version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Paul Mackerras <paulus@au.ibm.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+ * Never include sysdeps/powerpc/bits/atomic.h directly.
+ * Alway use include/atomic.h which will include either
+ * sysdeps/powerpc/powerpc32/bits/atomic.h
+ * or
+ * sysdeps/powerpc/powerpc64/bits/atomic.h
+ * as appropriate and which in turn include this file.
+ */
+
+#include <stdint.h>
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+/*
+ * Powerpc does not have byte and halfword forms of load and reserve and
+ * store conditional. So for powerpc we stub out the 8- and 16-bit forms.
+ */
+#define __arch_compare_and_exchange_bool_8_acq(mem, newval, oldval) \
+  (abort (), 0)
+
+#define __arch_compare_and_exchange_bool_16_acq(mem, newval, oldval) \
+  (abort (), 0)
+  
+#define __arch_compare_and_exchange_bool_8_rel(mem, newval, oldval) \
+  (abort (), 0)
+
+#define __arch_compare_and_exchange_bool_16_rel(mem, newval, oldval) \
+  (abort (), 0)
+
+#ifdef UP
+# define __ARCH_ACQ_INSTR	""
+# define __ARCH_REL_INSTR	""
+#else
+# define __ARCH_ACQ_INSTR	"isync"
+# ifndef __ARCH_REL_INSTR
+#  define __ARCH_REL_INSTR	"sync"
+# endif
+#endif
+
+#define atomic_full_barrier()	__asm ("sync" ::: "memory")
+#define atomic_write_barrier()	__asm ("eieio" ::: "memory")
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval)	      \
+  ({									      \
+      __typeof (*(mem)) __tmp;						      \
+      __typeof (mem)  __memp = (mem);					      \
+      __asm __volatile (						      \
+		        "1:	lwarx	%0,0,%1\n"			      \
+		        "	cmpw	%0,%2\n"			      \
+		        "	bne	2f\n"				      \
+		        "	stwcx.	%3,0,%1\n"			      \
+		        "	bne-	1b\n"				      \
+		        "2:	" __ARCH_ACQ_INSTR			      \
+		        : "=&r" (__tmp)					      \
+		        : "b" (__memp), "r" (oldval), "r" (newval)	      \
+		        : "cr0", "memory");				      \
+      __tmp;								      \
+  })
+
+#define __arch_compare_and_exchange_val_32_rel(mem, newval, oldval)	      \
+  ({									      \
+      __typeof (*(mem)) __tmp;						      \
+      __typeof (mem)  __memp = (mem);					      \
+      __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+		        "1:	lwarx	%0,0,%1\n"			      \
+		        "	cmpw	%0,%2\n"			      \
+		        "	bne	2f\n"				      \
+		        "	stwcx.	%3,0,%1\n"			      \
+		        "	bne-	1b\n"				      \
+		        "2:	"					      \
+		        : "=&r" (__tmp)					      \
+		        : "b" (__memp), "r" (oldval), "r" (newval)	      \
+		        : "cr0", "memory");				      \
+      __tmp;								      \
+  })
+
+#define __arch_atomic_exchange_32_acq(mem, value)			      \
+  ({									      \
+    __typeof (*mem) __val;						      \
+    __asm __volatile (							      \
+		      "1:	lwarx	%0,0,%2\n"			      \
+		      "		stwcx.	%3,0,%2\n"			      \
+		      "		bne-	1b\n"				      \
+		      "   " __ARCH_ACQ_INSTR				      \
+		      : "=&r" (__val), "=m" (*mem)			      \
+		      : "b" (mem), "r" (value), "1" (*mem)		      \
+		      : "cr0", "memory");				      \
+    __val;								      \
+  })
+
+#define __arch_atomic_exchange_32_rel(mem, value) \
+  ({									      \
+    __typeof (*mem) __val;						      \
+    __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+		      "1:	lwarx	%0,0,%2\n"			      \
+		      "		stwcx.	%3,0,%2\n"			      \
+		      "		bne-	1b"				      \
+		      : "=&r" (__val), "=m" (*mem)			      \
+		      : "b" (mem), "r" (value), "1" (*mem)		      \
+		      : "cr0", "memory");				      \
+    __val;								      \
+  })
+
+#define __arch_atomic_exchange_and_add_32(mem, value) \
+  ({									      \
+    __typeof (*mem) __val, __tmp;					      \
+    __asm __volatile ("1:	lwarx	%0,0,%3\n"			      \
+		      "		add	%1,%0,%4\n"			      \
+		      "		stwcx.	%1,0,%3\n"			      \
+		      "		bne-	1b"				      \
+		      : "=&b" (__val), "=&r" (__tmp), "=m" (*mem)	      \
+		      : "b" (mem), "r" (value), "2" (*mem)		      \
+		      : "cr0", "memory");				      \
+    __val;								      \
+  })
+
+#define __arch_atomic_decrement_if_positive_32(mem) \
+  ({ int __val, __tmp;							      \
+     __asm __volatile ("1:	lwarx	%0,0,%3\n"			      \
+		       "	cmpwi	0,%0,0\n"			      \
+		       "	addi	%1,%0,-1\n"			      \
+		       "	ble	2f\n"				      \
+		       "	stwcx.	%1,0,%3\n"			      \
+		       "	bne-	1b\n"				      \
+		       "2:	" __ARCH_ACQ_INSTR			      \
+		       : "=&b" (__val), "=&r" (__tmp), "=m" (*mem)	      \
+		       : "b" (mem), "2" (*mem)				      \
+		       : "cr0", "memory");				      \
+     __val;								      \
+  })
+
+#define atomic_compare_and_exchange_val_acq(mem, newval, oldval) \
+  ({									      \
+    __typeof (*(mem)) __result;						      \
+    if (sizeof (*mem) == 4)						      \
+      __result = __arch_compare_and_exchange_val_32_acq(mem, newval, oldval); \
+    else if (sizeof (*mem) == 8)					      \
+      __result = __arch_compare_and_exchange_val_64_acq(mem, newval, oldval); \
+    else 								      \
+       abort ();							      \
+    __result;								      \
+  })
+  
+#define atomic_compare_and_exchange_val_rel(mem, newval, oldval) \
+  ({									      \
+    __typeof (*(mem)) __result;						      \
+    if (sizeof (*mem) == 4)						      \
+      __result = __arch_compare_and_exchange_val_32_rel(mem, newval, oldval); \
+    else if (sizeof (*mem) == 8)					      \
+      __result = __arch_compare_and_exchange_val_64_rel(mem, newval, oldval); \
+    else 								      \
+       abort ();							      \
+    __result;								      \
+  })
+
+#define atomic_exchange_acq(mem, value) \
+  ({									      \
+    __typeof (*(mem)) __result;						      \
+    if (sizeof (*mem) == 4)						      \
+      __result = __arch_atomic_exchange_32_acq (mem, value);		      \
+    else if (sizeof (*mem) == 8)					      \
+      __result = __arch_atomic_exchange_64_acq (mem, value);		      \
+    else 								      \
+       abort ();							      \
+    __result;								      \
+  })
+
+#define atomic_exchange_rel(mem, value) \
+  ({									      \
+    __typeof (*(mem)) __result;						      \
+    if (sizeof (*mem) == 4)						      \
+      __result = __arch_atomic_exchange_32_rel (mem, value);		      \
+    else if (sizeof (*mem) == 8)					      \
+      __result = __arch_atomic_exchange_64_rel (mem, value);		      \
+    else 								      \
+       abort ();							      \
+    __result;								      \
+  })
+
+#define atomic_exchange_and_add(mem, value) \
+  ({									      \
+    __typeof (*(mem)) __result;						      \
+    if (sizeof (*mem) == 4)						      \
+      __result = __arch_atomic_exchange_and_add_32 (mem, value);	      \
+    else if (sizeof (*mem) == 8)					      \
+      __result = __arch_atomic_exchange_and_add_64 (mem, value);	      \
+    else 								      \
+       abort ();							      \
+    __result;								      \
+  })
+
+
+/* Decrement *MEM if it is > 0, and return the old value.  */
+#define atomic_decrement_if_positive(mem) \
+  ({ __typeof (*(mem)) __result;					      \
+    if (sizeof (*mem) == 4)						      \
+      __result = __arch_atomic_decrement_if_positive_32 (mem);		      \
+    else if (sizeof (*mem) == 8)					      \
+      __result = __arch_atomic_decrement_if_positive_64 (mem);		      \
+    else								      \
+       abort ();							      \
+    __result;								      \
+  })
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/bits/setjmp.h libc-20030708/sysdeps/powerpc/bits/setjmp.h
--- glibc-2.3.2/sysdeps/powerpc/bits/setjmp.h	2002-12-16 04:44:44.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/bits/setjmp.h	2003-04-15 23:55:49.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,8 +17,10 @@
    02111-1307 USA.  */
 
 /* Define the machine-dependent type `jmp_buf'.  PowerPC version.  */
+#ifndef _BITS_SETJMP_H
+#define _BITS_SETJMP_H  1
 
-#ifndef _SETJMP_H
+#if !defined _SETJMP_H && !defined _PTHREAD_H
 # error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
 #endif
 
@@ -43,7 +45,7 @@
 #  define JB_CR     21 /* Condition code registers.  */
 #  define JB_FPRS   22 /* FPRs 14 through 31 are saved, 18*2 words total.  */
 #  define JB_SIZE   (58*4)
-# endif 
+# endif
 #endif
 
 #ifndef	_ASM
@@ -58,3 +60,5 @@
    containing a local variable at ADDRESS.  */
 #define _JMPBUF_UNWINDS(jmpbuf, address) \
   ((void *) (address) < (void *) (jmpbuf)[JB_GPR1])
+
+#endif  /* bits/setjmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/dl-tls.h libc-20030708/sysdeps/powerpc/dl-tls.h
--- glibc-2.3.2/sysdeps/powerpc/dl-tls.h	2003-02-28 13:54:53.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/dl-tls.h	2003-04-28 23:53:24.000000000 +0900
@@ -25,19 +25,25 @@
   unsigned long int ti_offset;
 } tls_index;
 
-
-#ifdef SHARED
-
-extern void *__tls_get_addr (tls_index *ti);
-
 /* The thread pointer points 0x7000 past the first static TLS block.  */
-# define TLS_TP_OFFSET		0x7000
+#define TLS_TP_OFFSET		0x7000
 
 /* Dynamic thread vector pointers point 0x8000 past the start of each
    TLS block.  */
-# define TLS_DTV_OFFSET		0x8000
+#define TLS_DTV_OFFSET		0x8000
+
+/* Compute the value for a @tprel reloc.  */
+#define TLS_TPREL_VALUE(sym_map, sym, reloc) \
+  ((sym_map)->l_tls_offset + (sym)->st_value + (reloc)->r_addend \
+   - TLS_TP_OFFSET)
+
+/* Compute the value for a @dtprel reloc.  */
+#define TLS_DTPREL_VALUE(sym, reloc) \
+  ((sym)->st_value + (reloc)->r_addend - TLS_DTV_OFFSET)
+
+#ifdef SHARED
+extern void *__tls_get_addr (tls_index *ti);
 
 # define GET_ADDR_OFFSET	(ti->ti_offset + TLS_DTV_OFFSET)
 # define __TLS_GET_ADDR(__ti)	(__tls_get_addr (__ti) - TLS_DTV_OFFSET)
-
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/elf/libc-start.c libc-20030708/sysdeps/powerpc/elf/libc-start.c
--- glibc-2.3.2/sysdeps/powerpc/elf/libc-start.c	2003-02-26 08:40:09.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/elf/libc-start.c	2003-03-16 08:09:18.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998,2000,2001,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,31 +22,9 @@
 #include <bp-start.h>
 #include <bp-sym.h>
 
-extern void __libc_init_first (int argc, char **argv, char **envp);
-
 extern int __cache_line_size;
 weak_extern (__cache_line_size)
 
-extern int __libc_multiple_libcs;
-extern void *__libc_stack_end;
-
-#ifndef SHARED
-# include <tls.h>
-extern void __pthread_initialize_minimal (void)
-# if !(USE_TLS - 0) && !defined NONTLS_INIT_TP
-     __attribute__ ((weak))
-# endif
-     ;
-#endif
-
-struct startup_info
-{
-  void *__unbounded sda_base;
-  int (*main) (int, char **, char **, void *);
-  int (*init) (int, char **, char **, void *);
-  void (*fini) (void);
-};
-
 /* Scan the Aux Vector for the "Data Cache Block Size" entry.  If found
    verify that the static extern __cache_line_size is defined by checking
    for not NULL.  If it is defined then assign the cache block size
@@ -66,16 +44,35 @@
         break;
       }
 }
+/* This is used in sysdeps/generic/libc-start.c.  */
+#define AUX_VECTOR_INIT __aux_init_cache
+
+/* The main work is done in the generic function.  */
+#define LIBC_START_MAIN generic_start_main
+#define LIBC_START_MAIN_AUXVEC_ARG
+#define MAIN_AUXVEC_ARG
+#define INIT_MAIN_ARGS
+#include <sysdeps/generic/libc-start.c>
+
+
+struct startup_info
+{
+  void *__unbounded sda_base;
+  int (*main) (int, char **, char **, void *);
+  int (*init) (int, char **, char **, void *);
+  void (*fini) (void);
+};
 
 
 int
 /* GKM FIXME: GCC: this should get __BP_ prefix by virtue of the
    BPs in the arglist of startup_info.main and startup_info.init. */
 BP_SYM (__libc_start_main) (int argc, char *__unbounded *__unbounded ubp_av,
-		   char *__unbounded *__unbounded ubp_ev,
-		   ElfW(auxv_t) *__unbounded auxvec, void (*rtld_fini) (void),
-		   struct startup_info *__unbounded stinfo,
-		   char *__unbounded *__unbounded stack_on_entry)
+			    char *__unbounded *__unbounded ubp_ev,
+			    ElfW(auxv_t) *__unbounded auxvec,
+			    void (*rtld_fini) (void),
+			    struct startup_info *__unbounded stinfo,
+			    char *__unbounded *__unbounded stack_on_entry)
 {
 #if __BOUNDED_POINTERS__
   char **argv;
@@ -83,15 +80,6 @@
 # define argv ubp_av
 #endif
 
-#ifndef SHARED
-  /* The next variable is only here to work around a bug in gcc <= 2.7.2.2.
-     If the address would be taken inside the expression the optimizer
-     would try to be too smart and throws it away.  Grrr.  */
-  int *dummy_addr = &_dl_starting_up;
-
-  __libc_multiple_libcs = dummy_addr && !_dl_starting_up;
-#endif
-
   /* the PPC SVR4 ABI says that the top thing on the stack will
      be a NULL pointer, so if not we assume that we're being called
      as a statically-linked program by Linux...	 */
@@ -110,78 +98,14 @@
       while (*temp != NULL)
         ++temp;
       auxvec = (ElfW(auxv_t) *)++temp;
-
-# ifndef SHARED
-      _dl_aux_init (auxvec);
-# endif
 #endif
       rtld_fini = NULL;
     }
 
-  INIT_ARGV_and_ENVIRON;
-
   /* Initialize the __cache_line_size variable from the aux vector.  */
-  __aux_init_cache(auxvec);
-
-  /* Store something that has some relationship to the end of the
-     stack, for backtraces.  This variable should be thread-specific.
-     Use +8 so it works for both 32- and 64-bit.  */
-  __libc_stack_end = stack_on_entry + 8;
-
-#ifndef SHARED
-# ifdef DL_SYSDEP_OSCHECK
-  if (!__libc_multiple_libcs)
-    {
-      /* This needs to run to initiliaze _dl_osversion before TLS
-	 setup might check it.  */
-      DL_SYSDEP_OSCHECK (__libc_fatal);
-    }
-# endif
-  /* Initialize the thread library at least a bit since the libgcc
-     functions are using thread functions if these are available and
-     we need to setup errno.  If there is no thread library and we
-     handle TLS the function is defined in the libc to initialized the
-     TLS handling.  */
-# if !(USE_TLS - 0) && !defined NONTLS_INIT_TP
-  if (__pthread_initialize_minimal)
-# endif
-    __pthread_initialize_minimal ();
-
-  /* Some security at this point.  Prevent starting a SUID binary where
-     the standard file descriptors are not opened.  We have to do this
-     only for statically linked applications since otherwise the dynamic
-     loader did the work already.  */
-  if (__builtin_expect (__libc_enable_secure, 0))
-    __libc_check_standard_fds ();
-#endif
-
-  /* Register the destructor of the dynamic linker if there is any.  */
-  if (rtld_fini != NULL)
-    __cxa_atexit ((void (*) (void *)) rtld_fini, NULL, NULL);
-
-  /* Call the initializer of the libc.  */
-#ifdef SHARED
-  if (__builtin_expect (GL(dl_debug_mask) & DL_DEBUG_IMPCALLS, 0))
-    _dl_debug_printf ("\ninitialize libc\n\n");
-#endif
-  __libc_init_first (argc, argv, __environ);
-
-  /* Register the destructor of the program, if any.  */
-  if (stinfo->fini)
-    __cxa_atexit ((void (*) (void *)) stinfo->fini, NULL, NULL);
-
-  /* Call the initializer of the program, if any.  */
-#ifdef SHARED
-  if (__builtin_expect (GL(dl_debug_mask) & DL_DEBUG_IMPCALLS, 0))
-    _dl_debug_printf ("\ninitialize program: %s\n\n", argv[0]);
-#endif
-  if (stinfo->init)
-    stinfo->init (argc, argv, __environ, auxvec);
-
-#ifdef SHARED
-  if (__builtin_expect (GL(dl_debug_mask) & DL_DEBUG_IMPCALLS, 0))
-    _dl_debug_printf ("\ntransferring control: %s\n\n", argv[0]);
-#endif
+  __aux_init_cache (auxvec);
 
-  exit (stinfo->main (argc, argv, __environ, auxvec));
+  return generic_start_main (stinfo->main, argc, ubp_av, auxvec,
+			     stinfo->init, stinfo->fini, rtld_fini,
+			     stack_on_entry);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/fpu/bits/mathdef.h libc-20030708/sysdeps/powerpc/fpu/bits/mathdef.h
--- glibc-2.3.2/sysdeps/powerpc/fpu/bits/mathdef.h	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/fpu/bits/mathdef.h	2003-04-15 23:55:49.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997,1998,1999,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -39,9 +39,6 @@
 typedef double double_t;	/* `double' expressions are evaluated as
 				   `double'.  */
 
-/* Signal that types stay as they were declared.  */
-#   define FLT_EVAL_METHOD	0
-
 /* Define `INFINITY' as value of type `float'.  */
 #   define INFINITY	HUGE_VALF
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/fpu/libm-test-ulps libc-20030708/sysdeps/powerpc/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/powerpc/fpu/libm-test-ulps	2002-09-03 07:15:28.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -91,7 +91,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
@@ -104,10 +104,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
@@ -142,7 +142,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -236,7 +236,7 @@
 ifloat: 2
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
@@ -255,7 +255,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -263,7 +263,7 @@
 idouble: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -437,12 +437,12 @@
 ifloat: 1
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -497,7 +497,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/fpu/w_sqrt.c libc-20030708/sysdeps/powerpc/fpu/w_sqrt.c
--- glibc-2.3.2/sysdeps/powerpc/fpu/w_sqrt.c	2002-05-15 05:46:17.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/fpu/w_sqrt.c	2003-03-08 06:18:23.000000000 +0900
@@ -1,5 +1,5 @@
-/* Single-precision floating point square root.
-   Copyright (C) 1997, 2002 Free Software Foundation, Inc.
+/* Double-precision floating point square root.
+   Copyright (C) 1997, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -79,7 +79,7 @@
 	  t_sqrt = __t_sqrt + (xi0 >> (52-32-8-1)  & 0x3fe);
 	  sg = t_sqrt[0];
 	  sy = t_sqrt[1];
-	  
+
 	  /* Here we have three Newton-Rhapson iterations each of a
 	     division and a square root and the remainder of the
 	     argument reduction, all interleaved.   */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/nofpu/libm-test-ulps libc-20030708/sysdeps/powerpc/nofpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/powerpc/nofpu/libm-test-ulps	2002-10-20 05:06:29.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/nofpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -94,7 +94,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
@@ -107,10 +107,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
@@ -145,7 +145,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -239,7 +239,7 @@
 ifloat: 2
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
@@ -258,7 +258,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -266,7 +266,7 @@
 idouble: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -453,12 +453,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -513,7 +513,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/atomicity.h libc-20030708/sysdeps/powerpc/powerpc32/atomicity.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/atomicity.h	2003-02-21 07:11:52.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,98 +0,0 @@
-/* Low-level functions for atomic operations.  PowerPC version.
-   Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-static inline int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  int tmp, result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%2	\n\
-	add%I3	%1,%0,%3	\n\
-	stwcx.	%1,0,%2	\n\
-	bne-	0b	\n\
-" : "=&b"(result), "=&r"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-  return result;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  int tmp;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	add%I2	%0,%0,%2	\n\
-	stwcx.	%0,0,%1	\n\
-	bne-	0b	\n\
-" : "=&b"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-}
-
-static inline int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  int result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	sub%I2c.	%0,%0,%2	\n\
-	cntlzw	%0,%0	\n\
-	bne-	1f	\n\
-	stwcx.	%3,0,%1	\n\
-	bne-	0b	\n\
-1:	\n\
-" : "=&b"(result) : "r"(p), "Ir"(oldval), "r"(newval) : "cr0", "memory");
-  return result >> 5;
-}
-
-static inline long int
-__attribute__ ((unused))
-always_swap (volatile long int *p, long int newval)
-{
-  long int result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	stwcx.	%2,0,%1	\n\
-	bne-	0b	\n\
-" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
-  return result;
-}
-
-static inline int
-__attribute__ ((unused))
-test_and_set (volatile long int *p, long int newval)
-{
-  int result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	cmpwi	%0,0	\n\
-	bne-	1f	\n\
-	stwcx.	%2,0,%1	\n\
-	bne-	0b	\n\
-1:	\n\
-" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
-  return result;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/bits/atomic.h libc-20030708/sysdeps/powerpc/powerpc32/bits/atomic.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/bits/atomic.h	2003-05-21 23:20:34.000000000 +0900
@@ -0,0 +1,100 @@
+/* Atomic operations.  PowerPC32 version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Paul Mackerras <paulus@au.ibm.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+ * The 32-bit exchange_bool is different on powerpc64 because the subf
+ * does signed 64-bit arthmatic while the lwarx is 32-bit unsigned
+ * (a load word and zero (high 32) form).  So powerpc64 has a slightly
+ * different version in sysdeps/powerpc/powerpc64/bits/atomic.h.
+ */
+# define __arch_compare_and_exchange_bool_32_acq(mem, newval, oldval)         \
+({									      \
+  unsigned int __tmp;							      \
+  __asm __volatile (							      \
+		    "1:	lwarx	%0,0,%1\n"				      \
+		    "	subf.	%0,%2,%0\n"				      \
+		    "	bne	2f\n"					      \
+		    "	stwcx.	%3,0,%1\n"				      \
+		    "	bne-	1b\n"					      \
+		    "2:	" __ARCH_ACQ_INSTR				      \
+		    : "=&r" (__tmp)					      \
+		    : "b" (mem), "r" (oldval), "r" (newval)		      \
+		    : "cr0", "memory");					      \
+  __tmp != 0;								      \
+})
+
+# define __arch_compare_and_exchange_bool_32_rel(mem, newval, oldval)	      \
+({									      \
+  unsigned int __tmp;							      \
+  __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+		    "1:	lwarx	%0,0,%1\n"				      \
+		    "	subf.	%0,%2,%0\n"				      \
+		    "	bne	2f\n"					      \
+		    "	stwcx.	%3,0,%1\n"				      \
+		    "	bne-	1b\n"					      \
+		    "2:	"						      \
+		    : "=&r" (__tmp)					      \
+		    : "b" (mem), "r" (oldval), "r" (newval)		      \
+		    : "cr0", "memory");					      \
+  __tmp != 0;								      \
+})
+
+/* 
+ * Powerpc32 processors don't implement the 64-bit (doubleword) forms of
+ * load and reserve (ldarx) and store conditional (stdcx.) instructions.  
+ * So for powerpc32 we stub out the 64-bit forms.
+ */
+# define __arch_compare_and_exchange_bool_64_acq(mem, newval, oldval) \
+  (abort (), 0)
+
+# define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+  
+# define __arch_compare_and_exchange_bool_64_rel(mem, newval, oldval) \
+  (abort (), 0)
+
+# define __arch_compare_and_exchange_val_64_rel(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+# define __arch_atomic_exchange_64_acq(mem, value) \
+    ({ abort (); (*mem) = (value); })
+
+# define __arch_atomic_exchange_64_rel(mem, value) \
+    ({ abort (); (*mem) = (value); })
+
+# define __arch_atomic_exchange_and_add_64(mem, value) \
+    ({ abort (); (*mem) = (value); })
+
+# define __arch_atomic_decrement_if_positive_64(mem) \
+    ({ abort (); (*mem)--; })
+    
+/* 
+ * Older powerpc32 processors don't support the new "light weight" 
+ * sync (lwsync).  So the only safe option is to use normal sync 
+ * for all powerpc32 applications. 
+ */
+# define atomic_read_barrier()	__asm ("sync" ::: "memory")
+
+/*
+ * Include the rest of the atomic ops macros which are common to both
+ * powerpc32 and powerpc64. 
+ */
+#include_next <bits/atomic.h>
+
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/dl-machine.c libc-20030708/sysdeps/powerpc/powerpc32/dl-machine.c
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/dl-machine.c	2002-11-22 04:09:30.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/dl-machine.c	2003-05-21 23:20:34.000000000 +0900
@@ -1,5 +1,5 @@
 /* Machine-dependent ELF dynamic relocation functions.  PowerPC version.
-   Copyright (C) 1995-2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -368,26 +368,24 @@
   return finaladdr;
 }
 
-static void
-dl_reloc_overflow (struct link_map *map,
-		   const char *name,
-		   Elf32_Addr *const reloc_addr,
-		   const Elf32_Sym *sym,
-		   const Elf32_Sym *refsym)
+void
+_dl_reloc_overflow (struct link_map *map,
+		    const char *name,
+		    Elf32_Addr *const reloc_addr,
+		    const Elf32_Sym *refsym)
 {
   char buffer[128];
   char *t;
-  const Elf32_Sym *errsym = sym ?: refsym;
   t = stpcpy (buffer, name);
   t = stpcpy (t, " relocation at 0x00000000");
   _itoa_word ((unsigned) reloc_addr, t, 16, 0);
-  if (errsym)
+  if (refsym)
     {
       const char *strtab;
 
       strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
       t = stpcpy (t, " for symbol `");
-      t = stpcpy (t, strtab + errsym->st_name);
+      t = stpcpy (t, strtab + refsym->st_name);
       t = stpcpy (t, "'");
     }
   t = stpcpy (t, " out of range");
@@ -397,6 +395,7 @@
 void
 __process_machine_rela (struct link_map *map,
 			const Elf32_Rela *reloc,
+			struct link_map *sym_map,
 			const Elf32_Sym *sym,
 			const Elf32_Sym *refsym,
 			Elf32_Addr *const reloc_addr,
@@ -423,19 +422,19 @@
 
     case R_PPC_ADDR24:
       if (__builtin_expect (finaladdr > 0x01fffffc && finaladdr < 0xfe000000, 0))
-	dl_reloc_overflow (map,  "R_PPC_ADDR24", reloc_addr, sym, refsym);
+	_dl_reloc_overflow (map,  "R_PPC_ADDR24", reloc_addr, refsym);
       *reloc_addr = (*reloc_addr & 0xfc000003) | (finaladdr & 0x3fffffc);
       break;
 
     case R_PPC_ADDR16:
       if (__builtin_expect (finaladdr > 0x7fff && finaladdr < 0xffff8000, 0))
-	dl_reloc_overflow (map,  "R_PPC_ADDR16", reloc_addr, sym, refsym);
+	_dl_reloc_overflow (map,  "R_PPC_ADDR16", reloc_addr, refsym);
       *(Elf32_Half*) reloc_addr = finaladdr;
       break;
 
     case R_PPC_UADDR16:
       if (__builtin_expect (finaladdr > 0x7fff && finaladdr < 0xffff8000, 0))
-	dl_reloc_overflow (map,  "R_PPC_UADDR16", reloc_addr, sym, refsym);
+	_dl_reloc_overflow (map,  "R_PPC_UADDR16", reloc_addr, refsym);
       ((char *) reloc_addr)[0] = finaladdr >> 8;
       ((char *) reloc_addr)[1] = finaladdr;
       break;
@@ -456,7 +455,7 @@
     case R_PPC_ADDR14_BRTAKEN:
     case R_PPC_ADDR14_BRNTAKEN:
       if (__builtin_expect (finaladdr > 0x7fff && finaladdr < 0xffff8000, 0))
-	dl_reloc_overflow (map,  "R_PPC_ADDR14", reloc_addr, sym, refsym);
+	_dl_reloc_overflow (map,  "R_PPC_ADDR14", reloc_addr, refsym);
       *reloc_addr = (*reloc_addr & 0xffff0003) | (finaladdr & 0xfffc);
       if (rinfo != R_PPC_ADDR14)
 	*reloc_addr = ((*reloc_addr & 0xffdfffff)
@@ -468,7 +467,7 @@
       {
 	Elf32_Sword delta = finaladdr - (Elf32_Word) reloc_addr;
 	if (delta << 6 >> 6 != delta)
-	  dl_reloc_overflow (map,  "R_PPC_REL24", reloc_addr, sym, refsym);
+	  _dl_reloc_overflow (map,  "R_PPC_REL24", reloc_addr, refsym);
 	*reloc_addr = (*reloc_addr & 0xfc000003) | (delta & 0x3fffffc);
       }
       break;
@@ -541,6 +540,53 @@
       }
       break;
 
+#ifdef USE_TLS
+#define CHECK_STATIC_TLS(map, sym_map)					      \
+    do {								      \
+      if (__builtin_expect ((sym_map)->l_tls_offset == NO_TLS_OFFSET, 0))     \
+	_dl_allocate_static_tls (sym_map);				      \
+    } while (0)
+# define DO_TLS_RELOC(suffix)						      \
+    case R_PPC_DTPREL##suffix:						      \
+      /* During relocation all TLS symbols are defined and used.	      \
+	 Therefore the offset is already correct.  */			      \
+      if (sym_map != NULL)						      \
+	do_reloc##suffix ("R_PPC_DTPREL"#suffix,			      \
+			  TLS_DTPREL_VALUE (sym, reloc));		      \
+      break;								      \
+    case R_PPC_TPREL##suffix:						      \
+      if (sym_map != NULL)						      \
+	{								      \
+	  CHECK_STATIC_TLS (map, sym_map);				      \
+	  do_reloc##suffix ("R_PPC_TPREL"#suffix,			      \
+			    TLS_TPREL_VALUE (sym_map, sym, reloc));	      \
+	}								      \
+      break;
+
+    inline void do_reloc16 (const char *r_name, Elf32_Addr value)
+      {
+	if (__builtin_expect (value > 0x7fff && value < 0xffff8000, 0))
+	  _dl_reloc_overflow (map, r_name, reloc_addr, refsym);
+	*(Elf32_Half *) reloc_addr = value;
+      }
+    inline void do_reloc16_LO (const char *r_name, Elf32_Addr value)
+      {
+	*(Elf32_Half *) reloc_addr = value;
+      }
+    inline void do_reloc16_HI (const char *r_name, Elf32_Addr value)
+      {
+	*(Elf32_Half *) reloc_addr = value >> 16;
+      }
+    inline void do_reloc16_HA (const char *r_name, Elf32_Addr value)
+      {
+	*(Elf32_Half *) reloc_addr = (value + 0x8000) >> 16;
+      }
+    DO_TLS_RELOC (16)
+    DO_TLS_RELOC (16_LO)
+    DO_TLS_RELOC (16_HI)
+    DO_TLS_RELOC (16_HA)
+#endif
+
     default:
       _dl_reloc_bad_type (map, rinfo, 0);
       return;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/dl-machine.h libc-20030708/sysdeps/powerpc/powerpc32/dl-machine.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/dl-machine.h	2003-01-31 05:25:20.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/dl-machine.h	2003-05-21 23:20:34.000000000 +0900
@@ -23,6 +23,7 @@
 #define ELF_MACHINE_NAME "powerpc"
 
 #include <assert.h>
+#include <dl-tls.h>
 
 /* Return nonzero iff ELF header is compatible with the running host.  */
 static inline int
@@ -275,11 +276,21 @@
 /* We never want to use a PLT entry as the destination of a
    reloc, when what is being relocated is a branch. This is
    partly for efficiency, but mostly so we avoid loops.  */
+#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD)
+#define elf_machine_type_class(type)			\
+  ((((type) == R_PPC_JMP_SLOT				\
+    || (type) == R_PPC_REL24				\
+    || ((type) >= R_PPC_DTPMOD32 /* contiguous TLS */	\
+	&& (type) <= R_PPC_DTPREL32)			\
+    || (type) == R_PPC_ADDR24) * ELF_RTYPE_CLASS_PLT)	\
+   | (((type) == R_PPC_COPY) * ELF_RTYPE_CLASS_COPY))
+#else
 #define elf_machine_type_class(type) \
   ((((type) == R_PPC_JMP_SLOT				\
     || (type) == R_PPC_REL24				\
     || (type) == R_PPC_ADDR24) * ELF_RTYPE_CLASS_PLT)	\
    | (((type) == R_PPC_COPY) * ELF_RTYPE_CLASS_COPY))
+#endif
 
 /* A reloc type used for ld.so cmdline arg lookups to reject PLT entries.  */
 #define ELF_MACHINE_JMP_SLOT	R_PPC_JMP_SLOT
@@ -325,11 +336,18 @@
    has been determined.  */
 extern void __process_machine_rela (struct link_map *map,
 				    const Elf32_Rela *reloc,
+				    struct link_map *sym_map,
 				    const Elf32_Sym *sym,
 				    const Elf32_Sym *refsym,
 				    Elf32_Addr *const reloc_addr,
 				    Elf32_Addr finaladdr,
-				    int rinfo);
+				    int rinfo) attribute_hidden;
+
+/* Call _dl_signal_error when a resolved value overflows a relocated area.  */
+extern void _dl_reloc_overflow (struct link_map *map,
+				const char *name,
+				Elf32_Addr *const reloc_addr,
+				const Elf32_Sym *refsym) attribute_hidden;
 
 /* Perform the relocation specified by RELOC and SYM (which is fully resolved).
    LOADADDR is the load address of the object; INFO is an array indexed
@@ -341,43 +359,41 @@
 		  Elf32_Addr *const reloc_addr)
 {
   const Elf32_Sym *const refsym = sym;
-  Elf32_Word finaladdr;
-  const int rinfo = ELF32_R_TYPE (reloc->r_info);
+  Elf32_Addr value;
+  const int r_type = ELF32_R_TYPE (reloc->r_info);
+  struct link_map *sym_map = NULL;
 
 #ifndef RESOLVE_CONFLICT_FIND_MAP
-  if (__builtin_expect (rinfo == R_PPC_NONE, 0))
-    return;
-
-  /* The condition on the next two lines is a hack around a bug in Solaris
-     tools on Sparc.  It's not clear whether it should really be here at all,
-     but if not the binutils need to be changed.  */
-  if (rinfo == R_PPC_RELATIVE
-      || (sym->st_shndx != SHN_UNDEF
-	  && ELF32_ST_BIND (sym->st_info) == STB_LOCAL))
+  if (r_type == R_PPC_RELATIVE)
     {
-      /* Has already been relocated.  */
-      Elf32_Word loadbase = map->l_addr;
-      finaladdr = loadbase + reloc->r_addend;
+      *reloc_addr = map->l_addr + reloc->r_addend;
+      return;
     }
+
+  if (__builtin_expect (r_type == R_PPC_NONE, 0))
+    return;
+
+  /* binutils on ppc32 includes st_value in r_addend for relocations
+     against local symbols.  */
+  if (__builtin_expect (ELF32_ST_BIND (sym->st_info) == STB_LOCAL, 0)
+      && sym->st_shndx != SHN_UNDEF)
+    value = map->l_addr;
   else
     {
-      Elf32_Word loadbase
-	= (Elf32_Word) (char *) (RESOLVE (&sym, version,
-					  ELF32_R_TYPE(reloc->r_info)));
-      if (sym == NULL)
-	{
-	  /* Weak symbol that wasn't actually defined anywhere.  */
-	  assert (loadbase == 0);
-	  finaladdr = reloc->r_addend;
-	}
-      else
-	finaladdr = (loadbase + (Elf32_Word) (char *) sym->st_value
-		     + reloc->r_addend);
+# if defined USE_TLS && !defined RTLD_BOOTSTRAP
+      sym_map = RESOLVE_MAP (&sym, version, r_type);
+      value = sym == NULL ? 0 : sym_map->l_addr + sym->st_value;
+# else
+      value = RESOLVE (&sym, version, r_type);
+#  ifndef RTLD_BOOTSTRAP
+      if (sym != NULL)
+#  endif
+	value += sym->st_value;
+# endif
     }
+  value += reloc->r_addend;
 #else
-  finaladdr = reloc->r_addend;
-  if (rinfo == R_PPC_JMP_SLOT)
-    RESOLVE_CONFLICT_FIND_MAP (map, reloc_addr);
+  value = reloc->r_addend;
 #endif
 
   /* A small amount of code is duplicated here for speed.  In libc,
@@ -386,15 +402,56 @@
      R_PPC_ADDR32, and 16% are R_PPC_JMP_SLOT (which this routine
      wouldn't usually handle).  As an bonus, doing this here allows
      the switch statement in __process_machine_rela to work.  */
-  if (rinfo == R_PPC_RELATIVE
-      || rinfo == R_PPC_GLOB_DAT
-      || rinfo == R_PPC_ADDR32)
+  switch (r_type)
     {
-      *reloc_addr = finaladdr;
+    case R_PPC_GLOB_DAT:
+    case R_PPC_ADDR32:
+      *reloc_addr = value;
+      break;
+
+#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD) \
+    && !defined RESOLVE_CONFLICT_FIND_MAP
+# ifdef RTLD_BOOTSTRAP
+#  define NOT_BOOTSTRAP 0
+# else
+#  define NOT_BOOTSTRAP 1
+# endif
+
+    case R_PPC_DTPMOD32:
+      if (!NOT_BOOTSTRAP)
+	/* During startup the dynamic linker is always index 1.  */
+	*reloc_addr = 1;
+      else if (sym_map != NULL)
+	/* Get the information from the link map returned by the
+	   RESOLVE_MAP function.  */
+	*reloc_addr = sym_map->l_tls_modid;
+      break;
+    case R_PPC_DTPREL32:
+      /* During relocation all TLS symbols are defined and used.
+	 Therefore the offset is already correct.  */
+      if (NOT_BOOTSTRAP && sym_map != NULL)
+	*reloc_addr = TLS_DTPREL_VALUE (sym, reloc);
+      break;
+    case R_PPC_TPREL32:
+      if (!NOT_BOOTSTRAP || sym_map != NULL)
+	{
+	  if (NOT_BOOTSTRAP)
+	    CHECK_STATIC_TLS (map, sym_map);
+	  *reloc_addr = TLS_TPREL_VALUE (sym_map, sym, reloc);
+	}
+      break;
+#endif /* USE_TLS etc. */
+
+#ifdef RESOLVE_CONFLICT_FIND_MAP
+    case R_PPC_JMP_SLOT:
+      RESOLVE_CONFLICT_FIND_MAP (map, reloc_addr);
+      /* FALLTHROUGH */
+#endif
+
+    default:
+      __process_machine_rela (map, reloc, sym_map, sym, refsym,
+			      reloc_addr, value, r_type);
     }
-  else
-    __process_machine_rela (map, reloc, sym, refsym,
-			    reloc_addr, finaladdr, rinfo);
 }
 
 static inline void
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/elf/configure libc-20030708/sysdeps/powerpc/powerpc32/elf/configure
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/elf/configure	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/elf/configure	2003-03-04 06:20:51.000000000 +0900
@@ -0,0 +1,52 @@
+# This file is generated from configure.in by Autoconf.  DO NOT EDIT!
+ # Local configure fragment for sysdeps/powerpc32/elf.
+
+if test "$usetls" != no; then
+# Check for support of thread-local storage handling in assembler and
+# linker.
+echo "$as_me:$LINENO: checking for powerpc32 TLS support" >&5
+echo $ECHO_N "checking for powerpc32 TLS support... $ECHO_C" >&6
+if test "${libc_cv_powerpc32_tls+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat > conftest.s <<\EOF
+	.section ".tdata","awT",@progbits
+x:	.long	1
+x1:	.long	1
+x2:	.long	1
+	.text
+	addi	3,31,x@got@tlsgd
+	addi	3,31,x1@got@tlsld
+	addi	9,3,x1@dtprel
+	addis	9,3,x2@dtprel@ha
+	addi	9,9,x2@dtprel@l
+	lwz	0,x1@dtprel(3)
+	addis	9,3,x2@dtprel@ha
+	lwz	0,x2@dtprel@l(9)
+	lwz	9,x3@got@tprel(31)
+	add	9,9,x@tls
+	addi	9,2,x1@tprel
+	addis	9,2,x2@tprel@ha
+	addi	9,9,x2@tprel@l
+EOF
+if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  libc_cv_powerpc32_tls=yes
+else
+  libc_cv_powerpc32_tls=no
+fi
+rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_powerpc32_tls" >&5
+echo "${ECHO_T}$libc_cv_powerpc32_tls" >&6
+if test $libc_cv_powerpc32_tls = yes; then
+  cat >>confdefs.h <<\_ACEOF
+#define HAVE_TLS_SUPPORT 1
+_ACEOF
+
+fi
+fi
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/elf/configure.in libc-20030708/sysdeps/powerpc/powerpc32/elf/configure.in
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/elf/configure.in	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/elf/configure.in	2003-03-04 06:20:51.000000000 +0900
@@ -0,0 +1,38 @@
+GLIBC_PROVIDES dnl See aclocal.m4 in the top level source directory.
+# Local configure fragment for sysdeps/powerpc32/elf.
+
+if test "$usetls" != no; then
+# Check for support of thread-local storage handling in assembler and
+# linker.
+AC_CACHE_CHECK(for powerpc32 TLS support, libc_cv_powerpc32_tls, [dnl
+cat > conftest.s <<\EOF
+	.section ".tdata","awT",@progbits
+x:	.long	1
+x1:	.long	1
+x2:	.long	1
+	.text
+	addi	3,31,x@got@tlsgd
+	addi	3,31,x1@got@tlsld
+	addi	9,3,x1@dtprel
+	addis	9,3,x2@dtprel@ha
+	addi	9,9,x2@dtprel@l
+	lwz	0,x1@dtprel(3)
+	addis	9,3,x2@dtprel@ha
+	lwz	0,x2@dtprel@l(9)
+	lwz	9,x3@got@tprel(31)
+	add	9,9,x@tls
+	addi	9,2,x1@tprel
+	addis	9,2,x2@tprel@ha
+	addi	9,9,x2@tprel@l
+EOF
+dnl
+if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.s 1>&AS_MESSAGE_LOG_FD); then
+  libc_cv_powerpc32_tls=yes
+else
+  libc_cv_powerpc32_tls=no
+fi
+rm -f conftest*])
+if test $libc_cv_powerpc32_tls = yes; then
+  AC_DEFINE(HAVE_TLS_SUPPORT)
+fi
+fi
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/elf/start.S libc-20030708/sysdeps/powerpc/powerpc32/elf/start.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/elf/start.S	2002-12-10 12:41:54.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/elf/start.S	2003-06-12 08:54:04.000000000 +0900
@@ -1,5 +1,5 @@
 /* Startup code for programs linked with GNU libc.
-   Copyright (C) 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998,1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,29 +21,50 @@
 #include "bp-sym.h"
 
  /* These are the various addresses we require.  */
+#ifdef PIC
+	.section ".data"
+#else
 	.section ".rodata"
+#endif
 	.align	2
 L(start_addresses):
 	.long	_SDA_BASE_
-	.long	JUMPTARGET(BP_SYM (main))
-	.long 	JUMPTARGET(__libc_csu_init)
-	.long 	JUMPTARGET(__libc_csu_fini)
+	.long	BP_SYM (main)
+	.long 	__libc_csu_init
+	.long 	__libc_csu_fini
 	ASM_SIZE_DIRECTIVE(L(start_addresses))
 
 	.section ".text"
+#ifdef PIC
+L(start_addressesp):
+	.long	L(start_addresses)-L(branch)
+#endif
 ENTRY(_start)
  /* Save the stack pointer, in case we're statically linked under Linux.  */
 	mr	r9,r1
  /* Set up an initial stack frame, and clear the LR.  */
 	clrrwi	r1,r1,4
+#ifdef PIC
+	bcl	20,31,L(branch)
+L(branch):
+	li	r0,0
+	mflr	r13
+#else
 	li	r0,0
+#endif
 	stwu	r1,-16(r1)
 	mtlr	r0
 	stw	r0,0(r1)
  /* Set r13 to point at the 'small data area', and put the address of
     start_addresses in r8...  */
+#ifdef PIC
+	lwz	r8,L(start_addressesp)-L(branch)(r13)
+	add	r8,r13,r8
+	lwz	r13,0(r8)
+#else
 	lis	r8,L(start_addresses)@ha
 	lwzu	r13,L(start_addresses)@l(r8)
+#endif
  /* and continue in libc-start, in glibc.  */
 	b	JUMPTARGET(BP_SYM (__libc_start_main))
 END(_start)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/memset.S libc-20030708/sysdeps/powerpc/powerpc32/memset.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/memset.S	2002-08-24 04:46:49.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized memset implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,27 +21,23 @@
 #include <bp-sym.h>
 #include <bp-asm.h>
 
-/* Define a global static that can hold the cache line size.  The 
+/* Define a global static that can hold the cache line size.  The
    assumption is that startup code will access the "aux vector" to
-   to obtain the value set by the kernel and store it into this 
+   to obtain the value set by the kernel and store it into this
    variable.  */
-   
+
 	.globl __cache_line_size
-	.section	".data","aw"
-	.align 2
-	.type	 __cache_line_size,@object
-	.size	 __cache_line_size,4
-__cache_line_size:
-	.long 0
-	.section	".text"
+	.lcomm __cache_line_size,4,4
+
 /* __ptr_t [r3] memset (__ptr_t s [r3], int c [r4], size_t n [r5]));
    Returns 's'.
 
    The memset is done in four sizes: byte (8 bits), word (32 bits),
    32-byte blocks (256 bits) and __cache_line_size (128, 256, 1024 bits).
-   There is a special case for setting whole cache lines to 0, which 
+   There is a special case for setting whole cache lines to 0, which
    takes advantage of the dcbz instruction.  */
 
+	.section	".text"
 EALIGN (BP_SYM (memset), 5, 1)
 
 #define rTMP	r0
@@ -123,14 +119,14 @@
 	cmplwi	cr1, rCHR, 0
 	clrrwi.	rALIGN, rLEN, 5
 	mtcrf	0x01, rLEN	/* 40th instruction from .align */
-	
+
 /* Check if we can use the special case for clearing memory using dcbz.
-   This requires that we know the correct cache line size for this    
+   This requires that we know the correct cache line size for this
    processor.  Getting the __cache_line_size may require establishing GOT
    addressability, so branch out of line to set this up.  */
-	beq	cr1, L(checklinesize) 
-	
-/* Store blocks of 32-bytes (256-bits) starting on a 32-byte boundary. 
+	beq	cr1, L(checklinesize)
+
+/* Store blocks of 32-bytes (256-bits) starting on a 32-byte boundary.
    Can't assume that rCHR is zero or that the cache line size is either
    32-bytes or even known.  */
 L(nondcbz):
@@ -172,7 +168,7 @@
 
 	.align 5
 	nop
-/* Clear cache lines of memory in 128-byte chunks.  
+/* Clear cache lines of memory in 128-byte chunks.
    This code is optimized for processors with 32-byte cache lines.
    It is further optimized for the 601 processor, which requires
    some care in how the code is aligned in the i-cache.  */
@@ -259,22 +255,22 @@
 	stw	rCHR, -4(rMEMP)
 	stw	rCHR, -8(rMEMP)
 	blr
-	
+
 L(checklinesize):
 #ifdef SHARED
 	mflr rTMP
 /* If the remaining length is less the 32 bytes then don't bother getting
 	 the cache line size.  */
-	beq	L(medium)	
-/* Establishes GOT addressability so we can load __cache_line_size 
+	beq	L(medium)
+/* Establishes GOT addressability so we can load __cache_line_size
    from static. This value was set from the aux vector during startup.  */
 	bl   _GLOBAL_OFFSET_TABLE_@local-4
 	mflr rGOT
 	lwz	 rGOT,__cache_line_size@got(rGOT)
 	lwz	 rCLS,0(rGOT)
 	mtlr rTMP
-#else 
-/* Load __cache_line_size from static. This value was set from the 
+#else
+/* Load __cache_line_size from static. This value was set from the
    aux vector during startup.  */
 	lis	 rCLS,__cache_line_size@ha
 /* If the remaining length is less the 32 bytes then don't bother getting
@@ -282,22 +278,22 @@
 	beq	L(medium)
 	lwz  rCLS,__cache_line_size@l(rCLS)
 #endif
-	
+
 /*If the cache line size was not set then goto to L(nondcbz), which is
-	safe for any cache line size.  */	
+	safe for any cache line size.  */
 	cmplwi cr1,rCLS,0
 	beq	cr1,L(nondcbz)
-	
+
 /* If the cache line size is 32 bytes then goto to L(zloopstart),
-	 which is coded specificly for 32-byte lines (and 601).  */	
+	 which is coded specificly for 32-byte lines (and 601).  */
 	cmplwi cr1,rCLS,32
 	beq	cr1,L(zloopstart)
-	
-/* Now we know the cache line size and it is not 32-bytes.  However 
-	 we may not yet be aligned to the cache line and may have a partial 
-	 line to fill.  Touch it 1st to fetch the cache line.  */	
-	dcbtst 0,rMEMP	
-	
+
+/* Now we know the cache line size and it is not 32-bytes.  However
+	 we may not yet be aligned to the cache line and may have a partial
+	 line to fill.  Touch it 1st to fetch the cache line.  */
+	dcbtst 0,rMEMP
+
 	addi rCLM,rCLS,-1
 L(getCacheAligned):
 	cmplwi cr1,rLEN,32
@@ -317,8 +313,8 @@
 	stw	 rCHR,-8(rMEMP)
 	stw	 rCHR,-4(rMEMP)
 	b	 L(getCacheAligned)
-	
-/* Now we are aligned to the cache line and can use dcbz.  */	
+
+/* Now we are aligned to the cache line and can use dcbz.  */
 L(cacheAligned):
 	cmplw cr1,rLEN,rCLS
 	blt	 cr1,L(handletail32)
@@ -327,12 +323,13 @@
 	add	 rMEMP,rMEMP,rCLS
 	b	 L(cacheAligned)
 
-/* We are here because; the cache line size was set, it was not 
-   32-bytes, and the remainder (rLEN) is now less than the actual cache 
-   line size.  Set up the preconditions for L(nondcbz) and go there to 
-   store the remaining bytes.  */			
+/* We are here because; the cache line size was set, it was not
+   32-bytes, and the remainder (rLEN) is now less than the actual cache
+   line size.  Set up the preconditions for L(nondcbz) and go there to
+   store the remaining bytes.  */
 L(handletail32):
 	clrrwi.	rALIGN, rLEN, 5
 	b		L(nondcbz)
-		
+
 END (BP_SYM (memset))
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/strchr.S libc-20030708/sysdeps/powerpc/powerpc32/strchr.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/strchr.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/strchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strchr implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -128,3 +128,4 @@
 END (BP_SYM (strchr))
 
 weak_alias (BP_SYM (strchr), BP_SYM (index))
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/strcmp.S libc-20030708/sysdeps/powerpc/powerpc32/strcmp.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/strcmp.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/strcmp.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strcmp implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -124,3 +124,4 @@
 	/* GKM FIXME: check high bounds.  */
 	blr
 END (BP_SYM (strcmp))
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/strcpy.S libc-20030708/sysdeps/powerpc/powerpc32/strcpy.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/strcpy.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/strcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strcpy implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -118,3 +118,4 @@
 	blr
 
 END (BP_SYM (strcpy))
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/strlen.S libc-20030708/sysdeps/powerpc/powerpc32/strlen.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/strlen.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/strlen.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strlen implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -157,3 +157,4 @@
 	/* GKM FIXME: check high bound.  */
 	blr
 END (BP_SYM (strlen))
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc32/sysdep.h libc-20030708/sysdeps/powerpc/powerpc32/sysdep.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc32/sysdep.h	2003-02-21 05:26:54.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc32/sysdep.h	2003-03-25 19:49:24.000000000 +0900
@@ -131,6 +131,19 @@
 #define	PSEUDO_END(name)						      \
   END (name)
 
+#define PSEUDO_NOERRNO(name, syscall_name, args)			      \
+  .section ".text";							      \
+  ENTRY (name)								      \
+    DO_CALL (SYS_ify (syscall_name));
+
+#define PSEUDO_RET_NOERRNO						      \
+    blr
+#define ret_NOERRNO PSEUDO_RET_NOERRNO
+
+#undef	PSEUDO_END_NOERRNO
+#define	PSEUDO_END_NOERRNO(name)					      \
+  END (name)
+
 /* Local labels stripped out by the linker.  */
 #undef L
 #define L(x) .L##x
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/atomicity.h libc-20030708/sysdeps/powerpc/powerpc64/atomicity.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/atomicity.h	2002-09-18 08:50:02.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,132 +0,0 @@
-/* Low-level functions for atomic operations.  PowerPC64 version.
-   Copyright (C) 1997, 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Library General Public License as
-   published by the Free Software Foundation; either version 2 of the
-   License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Library General Public License for more details.
-
-   You should have received a copy of the GNU Library General Public
-   License along with the GNU C Library; see the file COPYING.LIB.  If not,
-   write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
-   Boston, MA 02111-1307, USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-#if BROKEN_PPC_ASM_CR0
-# define __ATOMICITY_INLINE /* nothing */
-#else
-# define __ATOMICITY_INLINE inline
-#endif
-
-static __ATOMICITY_INLINE int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  int tmp, result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%2	\n\
-	add%I3	%1,%0,%3	\n\
-	stwcx.	%1,0,%2	\n\
-	bne-	0b	\n\
-" : "=&b"(result), "=&r"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-  return result;
-}
-
-static __ATOMICITY_INLINE void
-__attribute__ ((unused))
-atomic_add_long (volatile long *mem, int val)
-{
-  int tmp;
-  __asm__ ("\n\
-0:	ldarx	%0,0,%1	\n\
-	add%I2	%0,%0,%2	\n\
-	stdcx.	%0,0,%1	\n\
-	bne-	0b	\n\
-" : "=&b"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-}
-
-
-static __ATOMICITY_INLINE int
-__attribute__ ((unused))
-exchange_and_add_long (volatile long *mem, int val)
-{
-  int tmp, result;
-  __asm__ ("\n\
-0:	ldarx	%0,0,%2	\n\
-	add%I3	%1,%0,%3	\n\
-	stdcx.	%1,0,%2	\n\
-	bne-	0b	\n\
-" : "=&b"(result), "=&r"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-  return result;
-}
-
-static __ATOMICITY_INLINE void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  int tmp;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	add%I2	%0,%0,%2	\n\
-	stwcx.	%0,0,%1	\n\
-	bne-	0b	\n\
-" : "=&b"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-}
-
-static __ATOMICITY_INLINE int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  int result;
-  __asm__ ("\n\
-0:	ldarx	%0,0,%1	\n\
-	sub%I2c.	%0,%0,%2	\n\
-	cntlzw	%0,%0	\n\
-	bne-	1f	\n\
-	stdcx.	%3,0,%1	\n\
-	bne-	0b	\n\
-1:	\n\
-" : "=&b"(result) : "r"(p), "Ir"(oldval), "r"(newval) : "cr0", "memory");
-  return result >> 5;
-}
-
-static __ATOMICITY_INLINE long int
-__attribute__ ((unused))
-always_swap (volatile long int *p, long int newval)
-{
-  long int result;
-  __asm__ ("\n\
-0:	ldarx	%0,0,%1	\n\
-	stdcx.	%2,0,%1	\n\
-	bne-	0b	\n\
-" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
-  return result;
-}
-
-static __ATOMICITY_INLINE int
-__attribute__ ((unused))
-test_and_set (volatile long int *p, long int newval)
-{
-  int result;
-  __asm__ ("\n\
-0:	ldarx	%0,0,%1	\n\
-	cmpdi	%0,0	\n\
-	bne-	1f	\n\
-	stdcx.	%2,0,%1	\n\
-	bne-	0b	\n\
-1:	\n\
-" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
-  return result;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/bits/atomic.h libc-20030708/sysdeps/powerpc/powerpc64/bits/atomic.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/bits/atomic.h	2003-05-21 23:20:34.000000000 +0900
@@ -0,0 +1,205 @@
+/* Atomic operations.  PowerPC64 version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Paul Mackerras <paulus@au.ibm.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+ * The 32-bit exchange_bool is different on powerpc64 because the subf
+ * does signed 64-bit arthmatic while the lwarx is 32-bit unsigned
+ * (a load word and zero (high 32) form) load.
+ * In powerpc64 register values are 64-bit by default,  including oldval.
+ * Net we need to extend sign word the result of lwarx to 64-bit so the
+ * 64-bit subtract from gives the expected result and sets the condition
+ * correctly.
+ */
+# define __arch_compare_and_exchange_bool_32_acq(mem, newval, oldval) \
+({									      \
+  unsigned int __tmp;							      \
+  __asm __volatile (							      \
+		    "1:	lwarx	%0,0,%1\n"				      \
+		    "	extsw	%0,%0\n"				      \
+		    "	subf.	%0,%2,%0\n"				      \
+		    "	bne	2f\n"					      \
+		    "	stwcx.	%3,0,%1\n"				      \
+		    "	bne-	1b\n"					      \
+		    "2:	" __ARCH_ACQ_INSTR				      \
+		    : "=&r" (__tmp)					      \
+		    : "b" (mem), "r" (oldval), "r" (newval)		      \
+		    : "cr0", "memory");					      \
+  __tmp != 0;								      \
+})
+
+# define __arch_compare_and_exchange_bool_32_rel(mem, newval, oldval) \
+({									      \
+  unsigned int __tmp;							      \
+  __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+		    "1:	lwarx	%0,0,%1\n"				      \
+		    "	extsw	%0,%0\n"				      \
+		    "	subf.	%0,%2,%0\n"				      \
+		    "	bne	2f\n"					      \
+		    "	stwcx.	%3,0,%1\n"				      \
+		    "	bne-	1b\n"					      \
+		    "2:	"						      \
+		    : "=&r" (__tmp)					      \
+		    : "b" (mem), "r" (oldval), "r" (newval)		      \
+		    : "cr0", "memory");					      \
+  __tmp != 0;								      \
+})
+
+/* 
+ * Only powerpc64 processors support Load doubleword and reserve index (ldarx) 
+ * and Store doubleword conditional indexed (stdcx) instructions.  So here
+ * we define the 64-bit forms.
+ */
+# define __arch_compare_and_exchange_bool_64_acq(mem, newval, oldval) \
+({									      \
+  unsigned long	__tmp;							      \
+  __asm __volatile (							      \
+		    "1:	ldarx	%0,0,%1\n"				      \
+		    "	subf.	%0,%2,%0\n"				      \
+		    "	bne	2f\n"					      \
+		    "	stdcx.	%3,0,%1\n"				      \
+		    "	bne-	1b\n"					      \
+		    "2:	" __ARCH_ACQ_INSTR				      \
+		    : "=&r" (__tmp)					      \
+		    : "b" (mem), "r" (oldval), "r" (newval)		      \
+		    : "cr0", "memory");					      \
+  __tmp != 0;								      \
+})
+
+# define __arch_compare_and_exchange_bool_64_rel(mem, newval, oldval) \
+({									      \
+  unsigned long	__tmp;							      \
+  __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+		    "1:	ldarx	%0,0,%1\n"				      \
+		    "	subf.	%0,%2,%0\n"				      \
+		    "	bne	2f\n"					      \
+		    "	stdcx.	%3,0,%1\n"				      \
+		    "	bne-	1b\n"					      \
+		    "2:	"						      \
+		    : "=&r" (__tmp)					      \
+		    : "b" (mem), "r" (oldval), "r" (newval)		      \
+		    : "cr0", "memory");					      \
+  __tmp != 0;								      \
+})
+
+#define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  ({									      \
+      __typeof (*(mem)) __tmp;						      \
+      __typeof (mem)  __memp = (mem);					      \
+      __asm __volatile (						      \
+		        "1:	ldarx	%0,0,%1\n"			      \
+		        "	cmpd	%0,%2\n"			      \
+		        "	bne	2f\n"				      \
+		        "	stdcx.	%3,0,%1\n"			      \
+		        "	bne-	1b\n"				      \
+		        "2:	" __ARCH_ACQ_INSTR			      \
+		        : "=&r" (__tmp)					      \
+		        : "b" (__memp), "r" (oldval), "r" (newval)	      \
+		        : "cr0", "memory");				      \
+      __tmp;								      \
+  })
+
+#define __arch_compare_and_exchange_val_64_rel(mem, newval, oldval) \
+  ({									      \
+      __typeof (*(mem)) __tmp;						      \
+      __typeof (mem)  __memp = (mem);					      \
+      __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+		        "1:	ldarx	%0,0,%1\n"			      \
+		        "	cmpd	%0,%2\n"			      \
+		        "	bne	2f\n"				      \
+		        "	stdcx.	%3,0,%1\n"			      \
+		        "	bne-	1b\n"				      \
+		        "2:	"					      \
+		        : "=&r" (__tmp)					      \
+		        : "b" (__memp), "r" (oldval), "r" (newval)	      \
+		        : "cr0", "memory");				      \
+      __tmp;								      \
+  })
+
+# define __arch_atomic_exchange_64_acq(mem, value) \
+    ({									      \
+      __typeof (*mem) __val;						      \
+      __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+			"1:	ldarx	%0,0,%2\n"			      \
+			"	stdcx.	%3,0,%2\n"			      \
+			"	bne-	1b\n"				      \
+		  " " __ARCH_ACQ_INSTR					      \
+			: "=&r" (__val), "=m" (*mem)			      \
+			: "b" (mem), "r" (value), "1" (*mem)		      \
+			: "cr0", "memory");				      \
+      __val;								      \
+    })
+
+# define __arch_atomic_exchange_64_rel(mem, value) \
+    ({									      \
+      __typeof (*mem) __val;						      \
+      __asm __volatile (__ARCH_REL_INSTR "\n"				      \
+			"1:	ldarx	%0,0,%2\n"			      \
+			"	stdcx.	%3,0,%2\n"			      \
+			"	bne-	1b"				      \
+			: "=&r" (__val), "=m" (*mem)			      \
+			: "b" (mem), "r" (value), "1" (*mem)		      \
+			: "cr0", "memory");				      \
+      __val;								      \
+    })
+
+# define __arch_atomic_exchange_and_add_64(mem, value) \
+    ({									      \
+      __typeof (*mem) __val, __tmp;					      \
+      __asm __volatile ("1:	ldarx	%0,0,%3\n"			      \
+			"	add	%1,%0,%4\n"			      \
+			"	stdcx.	%1,0,%3\n"			      \
+			"	bne-	1b"				      \
+			: "=&b" (__val), "=&r" (__tmp), "=m" (*mem)	      \
+			: "b" (mem), "r" (value), "2" (*mem)		      \
+			: "cr0", "memory");				      \
+      __val;								      \
+    })
+
+# define __arch_atomic_decrement_if_positive_64(mem) \
+  ({ int __val, __tmp;							      \
+     __asm __volatile ("1:	ldarx	%0,0,%3\n"			      \
+		       "	cmpdi	0,%0,0\n"			      \
+		       "	addi	%1,%0,-1\n"			      \
+		       "	ble	2f\n"				      \
+		       "	stdcx.	%1,0,%3\n"			      \
+		       "	bne-	1b\n"				      \
+		       "2:	" __ARCH_ACQ_INSTR			      \
+		       : "=&b" (__val), "=&r" (__tmp), "=m" (*mem)	      \
+		       : "b" (mem), "2" (*mem)				      \
+		       : "cr0", "memory");				      \
+     __val;								      \
+  })
+
+/* 
+ * All powerpc64 processors support the new "light weight"  sync (lwsync).   
+ */
+# define atomic_read_barrier()	__asm ("lwsync" ::: "memory")
+/* 
+ * "light weight" sync can also be used for the release barrier.   
+ */
+# ifndef UP
+#  define __ARCH_REL_INSTR	"lwsync"
+# endif
+
+/*
+ * Include the rest of the atomic ops macros which are common to both
+ * powerpc32 and powerpc64. 
+ */
+#include_next <bits/atomic.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/dl-machine.c libc-20030708/sysdeps/powerpc/powerpc64/dl-machine.c
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/dl-machine.c	2002-09-29 05:12:57.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/dl-machine.c	2003-05-21 23:20:34.000000000 +0900
@@ -1,5 +1,5 @@
 /* Machine-dependent ELF dynamic relocation functions.  PowerPC64 version.
-   Copyright (C) 1995,96,97,98,99,2000,01, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -27,22 +27,20 @@
 _dl_reloc_overflow (struct link_map *map,
 		   const char *name,
 		   Elf64_Addr *const reloc_addr,
-		   const Elf64_Sym *sym,
 		   const Elf64_Sym *refsym)
 {
   char buffer[128];
   char *t;
-  const Elf64_Sym *errsym = sym ?: refsym;
   t = stpcpy (buffer, name);
   t = stpcpy (t, " reloc at 0x");
   _itoa_word ((unsigned long) reloc_addr, t, 16, 0);
-  if (errsym)
+  if (refsym)
     {
       const char *strtab;
 
       strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
       t = stpcpy (t, " for symbol `");
-      t = stpcpy (t, strtab + errsym->st_name);
+      t = stpcpy (t, strtab + refsym->st_name);
       t = stpcpy (t, "'");
     }
   t = stpcpy (t, " out of range");
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/dl-machine.h libc-20030708/sysdeps/powerpc/powerpc64/dl-machine.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/dl-machine.h	2003-03-01 09:06:31.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/dl-machine.h	2003-07-08 22:58:13.000000000 +0900
@@ -26,6 +26,7 @@
 
 #include <assert.h>
 #include <sys/param.h>
+#include <dl-tls.h>
 
 /* Translate a processor specific dynamic tag to the index
    in l_info array.  */
@@ -238,6 +239,18 @@
 "_dl_start_user:\n"							\
 "	.quad	._dl_start_user, .TOC.@tocbase, 0\n"			\
 "	.previous\n"							\
+"	.section	\".toc\",\"aw\"\n"  \
+".LC__dl_starting_up:\n"  \
+"	.tc _dl_starting_up_internal[TC],_dl_starting_up_internal\n"  \
+".LC__rtld_global:\n"  \
+"	.tc _rtld_global[TC],_rtld_global\n"  \
+".LC__dl_argc:\n"  \
+"	.tc _dl_argc[TC],_dl_argc\n"  \
+".LC__dl_argv:\n"  \
+"	.tc _dl_argv_internal[TC],_dl_argv_internal\n"  \
+".LC__dl_fini:\n"  \
+"	.tc _dl_fini[TC],_dl_fini\n"  \
+"	.previous\n"							\
 "	.globl	._dl_start_user\n"					\
 "	.type	._dl_start_user,@function\n"				\
 /* Now, we do our main work of calling initialisation procedures.  \
@@ -249,9 +262,9 @@
 /* the address of _start in r30.  */					\
 "	mr	30,3\n"							\
 /* &_dl_argc in 29, &_dl_argv in 27, and _dl_loaded in 28.  */		\
-"	ld	28,_rtld_global@got(2)\n"    \
-"	ld	29,_dl_argc@got(2)\n"					\
-"	ld	27,_dl_argv@got(2)\n"					\
+"	ld	28,.LC__rtld_global@toc(2)\n"    \
+"	ld	29,.LC__dl_argc@toc(2)\n"					\
+"	ld	27,.LC__dl_argv@toc(2)\n"					\
 /* _dl_init (_dl_loaded, _dl_argc, _dl_argv, _dl_argv+_dl_argc+1).  */	\
 "	ld	3,0(28)\n"						\
 "	lwa	4,0(29)\n"						\
@@ -278,8 +291,8 @@
 "	addi	6,6,8\n"						\
 /* Pass a termination function pointer (in this case _dl_fini) in	\
    r7.  */								\
-"	ld	7,_dl_fini@got(2)\n"					\
-"	ld 	26,_dl_starting_up@got(2)\n"				\
+"	ld	7,.LC__dl_fini@toc(2)\n"					\
+"	ld 	26,.LC__dl_starting_up@toc(2)\n"				\
 /* Pass the stack pointer in r1 (so far so good), pointing to a NULL	\
    value.  This lets our startup code distinguish between a program	\
    linked statically, which linux will call with argc on top of the	\
@@ -330,12 +343,11 @@
    of the main executable's symbols, as for a COPY reloc.  */
 
 #if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD)
-#define elf_machine_type_class(type) \
-  (   (((type) == R_PPC64_DTPMOD64	\
-    ||  (type) == R_PPC64_DTPREL64	\
-    ||  (type) == R_PPC64_TPREL64 \
-    ||  (type) == R_PPC64_ADDR24) * ELF_RTYPE_CLASS_PLT)	\
-    | (((type) == R_PPC64_COPY) * ELF_RTYPE_CLASS_COPY))
+#define elf_machine_type_class(type)					      \
+  /* This covers all the TLS relocs, though most won't appear.  */	      \
+  (((((type) >= R_PPC64_DTPMOD64 && (type) <= R_PPC64_TPREL16_HIGHESTA)	      \
+    || (type) == R_PPC64_ADDR24) * ELF_RTYPE_CLASS_PLT)			      \
+   | (((type) == R_PPC64_COPY) * ELF_RTYPE_CLASS_COPY))
 #else
 #define elf_machine_type_class(type) \
   ((((type) == R_PPC64_ADDR24) * ELF_RTYPE_CLASS_PLT)	\
@@ -472,9 +484,6 @@
   Elf64_FuncDesc *plt = (Elf64_FuncDesc *) reloc_addr;
   Elf64_FuncDesc *rel = (Elf64_FuncDesc *) finaladdr;
   Elf64_Addr offset = 0;
-#ifndef RTLD_BOOTSTRAP
-  weak_extern (GL(dl_rtld_map));
-#endif
 
   /* If sym_map is NULL, it's a weak undefined sym;  Leave the plt zero.  */
   if (sym_map == NULL)
@@ -483,7 +492,7 @@
   /* If the opd entry is not yet relocated (because it's from a shared
      object that hasn't been processed yet), then manually reloc it.  */
   if (map != sym_map && !sym_map->l_relocated
-#ifndef RTLD_BOOTSTRAP
+#if !defined RTLD_BOOTSTRAP && defined SHARED
       /* Bootstrap map doesn't have l_relocated set for it.  */
       && sym_map != &GL(dl_rtld_map)
 #endif
@@ -509,6 +518,21 @@
   return finaladdr;
 }
 
+static inline void
+elf_machine_plt_conflict (Elf64_Addr *reloc_addr, Elf64_Addr finaladdr)
+{
+  Elf64_FuncDesc *plt = (Elf64_FuncDesc *) reloc_addr;
+  Elf64_FuncDesc *rel = (Elf64_FuncDesc *) finaladdr;
+
+  plt->fd_func = rel->fd_func;
+  plt->fd_aux = rel->fd_aux;
+  plt->fd_toc = rel->fd_toc;
+  PPC_DCBST (&plt->fd_func);
+  PPC_DCBST (&plt->fd_aux);
+  PPC_DCBST (&plt->fd_toc);
+  PPC_SYNC;
+}
+
 /* Return the final value of a plt relocation.  */
 static inline Elf64_Addr
 elf_machine_plt_value (struct link_map *map, const Elf64_Rela *reloc,
@@ -528,14 +552,14 @@
 #define PPC_HIGHERA(v) PPC_HIGHER ((v) + 0x8000)
 #define PPC_HIGHEST(v) (((v) >> 48) & 0xffff)
 #define PPC_HIGHESTA(v) PPC_HIGHEST ((v) + 0x8000)
-#define BIT_INSERT(old, val, mask) ((old & ~(Elf64_Addr) mask) | (val & mask))
+#define BIT_INSERT(var, val, mask) \
+  ((var) = ((var) & ~(Elf64_Addr) (mask)) | ((val) & (mask)))
 
 #define dont_expect(X) __builtin_expect ((X), 0)
 
 extern void _dl_reloc_overflow (struct link_map *map,
                                 const char *name,
                                 Elf64_Addr *const reloc_addr,
-                                const Elf64_Sym *sym,
                                 const Elf64_Sym *refsym)
                                 attribute_hidden;
 
@@ -546,6 +570,27 @@
   *reloc_addr = l_addr + reloc->r_addend;
 }
 
+#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD)
+/* This computes the value used by TPREL* relocs.  */
+static Elf64_Addr __attribute__ ((const))
+elf_machine_tprel (struct link_map *map,
+		   struct link_map *sym_map,
+		   const Elf64_Sym *sym,
+		   const Elf64_Rela *reloc)
+{
+# ifndef RTLD_BOOTSTRAP
+  if (sym_map)
+    {
+      CHECK_STATIC_TLS (map, sym_map);
+# endif
+      return TLS_TPREL_VALUE (sym_map, sym, reloc);
+# ifndef RTLD_BOOTSTRAP
+    }
+# endif
+  return 0;
+}
+#endif
+
 /* Perform the relocation specified by RELOC and SYM (which is fully
    resolved).  MAP is the object containing the reloc.  */
 static inline void
@@ -555,9 +600,7 @@
 		  const struct r_found_version *version,
 		  Elf64_Addr *const reloc_addr)
 {
-  int r_type = ELF64_R_TYPE (reloc->r_info);
-  struct link_map *sym_map;
-  Elf64_Addr value, raw_value;
+  const int r_type = ELF64_R_TYPE (reloc->r_info);
 #ifndef RTLD_BOOTSTRAP
   const Elf64_Sym *const refsym = sym;
 #endif
@@ -568,17 +611,16 @@
       return;
     }
 
-  if (r_type == R_PPC64_NONE)
+  if (__builtin_expect (r_type == R_PPC64_NONE, 0))
     return;
 
-  sym_map = RESOLVE_MAP (&sym, version, r_type);
-  value = raw_value = reloc->r_addend;
-  if (sym_map)
-    {
-      raw_value += sym->st_value;
-      value = raw_value + sym_map->l_addr;
-    }
+  /* We need SYM_MAP even in the absence of TLS, for elf_machine_fixup_plt.  */
+  struct link_map *sym_map = RESOLVE_MAP (&sym, version, r_type);
+  Elf64_Addr value = ((sym_map == NULL ? 0 : sym_map->l_addr + sym->st_value)
+		      + reloc->r_addend);
 
+  /* For relocs that don't edit code, return.
+     For relocs that might edit instructions, break from the switch.  */
   switch (r_type)
     {
     case R_PPC64_ADDR64:
@@ -586,132 +628,135 @@
       *reloc_addr = value;
       return;
 
-#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD)
-
-    case R_PPC64_DTPMOD64:
-#ifdef RTLD_BOOTSTRAP
-    /* During startup the dynamic linker is always index 1.  */
-      *reloc_addr = 1;
+    case R_PPC64_JMP_SLOT:
+#ifdef RESOLVE_CONFLICT_FIND_MAP
+      elf_machine_plt_conflict (reloc_addr, value);
 #else
-    /* Get the information from the link map returned by the
-       resolve function.  */
-      if (sym_map != NULL)
-	*reloc_addr = sym_map->l_tls_modid;
+      elf_machine_fixup_plt (map, sym_map, reloc, reloc_addr, value);
 #endif
       return;
 
-    case R_PPC64_TPREL64:
-#ifdef RTLD_BOOTSTRAP
-      *reloc_addr = (sym_map->l_tls_offset - TLS_TCB_SIZE
-		     + raw_value - TLS_TP_OFFSET);
-#else
-      if (sym_map)
-	{
-	  CHECK_STATIC_TLS (map, sym_map);
-	  *reloc_addr = (sym_map->l_tls_offset - TLS_TCB_SIZE
-			 + raw_value - TLS_TP_OFFSET);
-	}
-#endif
+#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD)
+    case R_PPC64_DTPMOD64:
+# ifdef RTLD_BOOTSTRAP
+      /* During startup the dynamic linker is always index 1.  */
+      *reloc_addr = 1;
+# else
+      /* Get the information from the link map returned by the
+	 resolve function.  */
+      if (sym_map != NULL)
+        *reloc_addr = sym_map->l_tls_modid;
+# endif
       return;
 
     case R_PPC64_DTPREL64:
-#ifndef RTLD_BOOTSTRAP
       /* During relocation all TLS symbols are defined and used.
-	 Therefore the offset is already correct.  */
-      *reloc_addr = raw_value - TLS_DTV_OFFSET;
-#endif
+         Therefore the offset is already correct.  */
+# ifndef RTLD_BOOTSTRAP
+      if (sym_map != NULL)
+	*reloc_addr = TLS_DTPREL_VALUE (sym, reloc);
+# endif
       return;
-#endif
-
-    case R_PPC64_JMP_SLOT:
 
-      elf_machine_fixup_plt (map, sym_map, reloc, reloc_addr, value);
+    case R_PPC64_TPREL64:
+      *reloc_addr = elf_machine_tprel (map, sym_map, sym, reloc);
       return;
 
-#ifndef RTLD_BOOTSTRAP /* None of the following appear in ld.so */
-    case R_PPC64_ADDR16_LO_DS:
+    case R_PPC64_TPREL16_LO_DS:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
       if (dont_expect ((value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_ADDR16_LO_DS",
-                            reloc_addr, sym, refsym);
+        _dl_reloc_overflow (map, "R_PPC64_TPREL16_LO_DS", reloc_addr, refsym);
       *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
 					       value, 0xfffc);
       break;
 
-    case R_PPC64_TPREL16_LO_DS:
-      if (dont_expect ((value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_TPREL16_LO_DS",
-                            reloc_addr, sym, refsym);
+    case R_PPC64_TPREL16_DS:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      if (dont_expect ((value + 0x8000) >= 0x10000 || (value & 3) != 0))
+        _dl_reloc_overflow (map, "R_PPC64_TPREL16_DS", reloc_addr, refsym);
       *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
+					       value, 0xfffc);
       break;
 
-    case R_PPC64_DTPREL16_LO_DS:
-      if (dont_expect ((value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_DTPREL16_LO_DS",
-                            reloc_addr, sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
+    case R_PPC64_TPREL16:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      if (dont_expect ((value + 0x8000) >= 0x10000))
+        _dl_reloc_overflow (map, "R_PPC64_TPREL16", reloc_addr, refsym);
+      *(Elf64_Half *) reloc_addr = PPC_LO (value);
       break;
 
-    case R_PPC64_GOT_TPREL16_LO_DS:
-      if (dont_expect ((value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_GOT_TPREL16_LO_DS",
-                            reloc_addr, sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
+    case R_PPC64_TPREL16_LO:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      *(Elf64_Half *) reloc_addr = PPC_LO (value);
+      break;
+
+    case R_PPC64_TPREL16_HI:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      *(Elf64_Half *) reloc_addr = PPC_HI (value);
+      break;
+
+    case R_PPC64_TPREL16_HA:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      *(Elf64_Half *) reloc_addr = PPC_HA (value);
+      break;
+
+    case R_PPC64_TPREL16_HIGHER:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      *(Elf64_Half *) reloc_addr = PPC_HIGHER (value);
+      break;
+
+    case R_PPC64_TPREL16_HIGHEST:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      *(Elf64_Half *) reloc_addr = PPC_HIGHEST (value);
+      break;
+
+    case R_PPC64_TPREL16_HIGHERA:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      *(Elf64_Half *) reloc_addr = PPC_HIGHERA (value);
+      break;
+
+    case R_PPC64_TPREL16_HIGHESTA:
+      value = elf_machine_tprel (map, sym_map, sym, reloc);
+      *(Elf64_Half *) reloc_addr = PPC_HIGHESTA (value);
       break;
+#endif /* USE_TLS etc. */
 
-    case R_PPC64_GOT_DTPREL16_LO_DS:
+#ifndef RTLD_BOOTSTRAP /* None of the following appear in ld.so */
+    case R_PPC64_ADDR16_LO_DS:
       if (dont_expect ((value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_GOT_DTPREL16_LO_DS",
-                            reloc_addr, sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
+        _dl_reloc_overflow (map, "R_PPC64_ADDR16_LO_DS", reloc_addr, refsym);
+      BIT_INSERT (*(Elf64_Half *) reloc_addr, value, 0xfffc);
       break;
 
     case R_PPC64_ADDR16_LO:
-    case R_PPC64_TPREL16_LO:
-    case R_PPC64_DTPREL16_LO:
-    case R_PPC64_GOT_TLSGD16_LO:
-    case R_PPC64_GOT_TLSLD16_LO:
       *(Elf64_Half *) reloc_addr = PPC_LO (value);
       break;
 
     case R_PPC64_ADDR16_HI:
-    case R_PPC64_TPREL16_HI:
-    case R_PPC64_DTPREL16_HI:
-    case R_PPC64_GOT_TPREL16_HI:
-    case R_PPC64_GOT_DTPREL16_HI:
-    case R_PPC64_GOT_TLSGD16_HI:
-    case R_PPC64_GOT_TLSLD16_HI:
       *(Elf64_Half *) reloc_addr = PPC_HI (value);
       break;
 
     case R_PPC64_ADDR16_HA:
-    case R_PPC64_TPREL16_HA:
-    case R_PPC64_DTPREL16_HA:
-    case R_PPC64_GOT_TLSGD16_HA:
-    case R_PPC64_GOT_TLSLD16_HA:
       *(Elf64_Half *) reloc_addr = PPC_HA (value);
       break;
 
-    case R_PPC64_REL24:
+    case R_PPC64_ADDR30:
       {
         Elf64_Addr delta = value - (Elf64_Xword) reloc_addr;
-        if (dont_expect ((delta + 0x2000000) >= 0x4000000 || (delta & 3) != 0))
-          _dl_reloc_overflow (map, "R_PPC64_REL24", reloc_addr, sym, refsym);
-        *(Elf64_Word *) reloc_addr = BIT_INSERT (*(Elf64_Word *) reloc_addr,
-                                                delta, 0x3fffffc);
+        if (dont_expect ((delta + 0x80000000) >= 0x10000000
+			 || (delta & 3) != 0))
+          _dl_reloc_overflow (map, "R_PPC64_ADDR30", reloc_addr, refsym);
+        BIT_INSERT (*(Elf64_Word *) reloc_addr, delta, 0xfffffffc);
       }
       break;
 
     case R_PPC64_COPY:
       if (dont_expect (sym == NULL))
-      /* This can happen in trace mode when an object could not be found. */
+	/* This can happen in trace mode when an object could not be found. */
         return;
       if (dont_expect (sym->st_size > refsym->st_size
-        || (GL(dl_verbose) && sym->st_size < refsym->st_size)))
-	      {
+		       || (GL(dl_verbose) && sym->st_size < refsym->st_size)))
+	{
           const char *strtab;
 
           strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
@@ -719,8 +764,8 @@
                             " in shared object," \
                             " consider re-linking\n",
                             _dl_argv[0] ?: "<program name unknown>",
-                              strtab + refsym->st_name);
-	      }
+			    strtab + refsym->st_name);
+	}
       memcpy (reloc_addr, (char *) value, MIN (sym->st_size, refsym->st_size));
       return;
 
@@ -744,22 +789,27 @@
       ((char *) reloc_addr)[3] = (value >> 0) & 0xff;
       return;
 
+    case R_PPC64_ADDR32:
+      if (dont_expect ((value + 0x80000000) >= 0x10000000))
+        _dl_reloc_overflow (map, "R_PPC64_ADDR32", reloc_addr, refsym);
+      *(Elf64_Word *) reloc_addr = value;
+      return;
+
     case R_PPC64_ADDR24:
       if (dont_expect ((value + 0x2000000) >= 0x4000000 || (value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_ADDR24", reloc_addr, sym, refsym);
-      *(Elf64_Word *) reloc_addr = BIT_INSERT (*(Elf64_Word *) reloc_addr,
-					       value, 0x3fffffc);
+        _dl_reloc_overflow (map, "R_PPC64_ADDR24", reloc_addr, refsym);
+      BIT_INSERT (*(Elf64_Word *) reloc_addr, value, 0x3fffffc);
       break;
 
     case R_PPC64_ADDR16:
       if (dont_expect ((value + 0x8000) >= 0x10000))
-        _dl_reloc_overflow (map, "R_PPC64_ADDR16", reloc_addr, sym, refsym);
+        _dl_reloc_overflow (map, "R_PPC64_ADDR16", reloc_addr, refsym);
       *(Elf64_Half *) reloc_addr = value;
       break;
 
     case R_PPC64_UADDR16:
       if (dont_expect ((value + 0x8000) >= 0x10000))
-        _dl_reloc_overflow (map, "R_PPC64_UADDR16", reloc_addr, sym, refsym);
+        _dl_reloc_overflow (map, "R_PPC64_UADDR16", reloc_addr, refsym);
       /* We are big-endian.  */
       ((char *) reloc_addr)[0] = (value >> 8) & 0xff;
       ((char *) reloc_addr)[1] = (value >> 0) & 0xff;
@@ -767,64 +817,23 @@
 
     case R_PPC64_ADDR16_DS:
       if (dont_expect ((value + 0x8000) >= 0x10000 || (value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_ADDR16_DS", reloc_addr, sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-					       value, 0xfffc);
-      break;
-
-    case R_PPC64_TPREL16_DS:
-      if (dont_expect ((value + 0x8000) >= 0x10000 || (value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_TPREL16_DS", reloc_addr,
-                            sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
-      break;
-
-    case R_PPC64_DTPREL16_DS:
-      if (dont_expect ((value + 0x8000) >= 0x10000 || (value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_DTPREL16_DS", reloc_addr,
-                            sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
-      break;
-
-    case R_PPC64_GOT_TPREL16_DS:
-      if (dont_expect ((value + 0x8000) >= 0x10000 || (value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_GOT_TPREL16_DS", reloc_addr,
-                            sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
-      break;
-
-    case R_PPC64_GOT_DTPREL16_DS:
-      if (dont_expect ((value + 0x8000) >= 0x10000 || (value & 3) != 0))
-        _dl_reloc_overflow (map, "R_PPC64_GOT_DTPREL16_DS",
-                            reloc_addr, sym, refsym);
-      *(Elf64_Half *) reloc_addr = BIT_INSERT (*(Elf64_Half *) reloc_addr,
-                                              value, 0xfffc);
+        _dl_reloc_overflow (map, "R_PPC64_ADDR16_DS", reloc_addr, refsym);
+      BIT_INSERT (*(Elf64_Half *) reloc_addr, value, 0xfffc);
       break;
 
     case R_PPC64_ADDR16_HIGHER:
-    case R_PPC64_TPREL16_HIGHER:
-    case R_PPC64_DTPREL16_HIGHER:
       *(Elf64_Half *) reloc_addr = PPC_HIGHER (value);
       break;
 
     case R_PPC64_ADDR16_HIGHEST:
-    case R_PPC64_TPREL16_HIGHEST:
-    case R_PPC64_DTPREL16_HIGHEST:
       *(Elf64_Half *) reloc_addr = PPC_HIGHEST (value);
       break;
 
     case R_PPC64_ADDR16_HIGHERA:
-    case R_PPC64_TPREL16_HIGHERA:
-    case R_PPC64_DTPREL16_HIGHERA:
       *(Elf64_Half *) reloc_addr = PPC_HIGHERA (value);
       break;
 
     case R_PPC64_ADDR16_HIGHESTA:
-    case R_PPC64_TPREL16_HIGHESTA:
-    case R_PPC64_DTPREL16_HIGHESTA:
       *(Elf64_Half *) reloc_addr = PPC_HIGHESTA (value);
       break;
 
@@ -832,26 +841,30 @@
     case R_PPC64_ADDR14_BRTAKEN:
     case R_PPC64_ADDR14_BRNTAKEN:
       {
-        Elf64_Word insn;
         if (dont_expect ((value + 0x8000) >= 0x10000 || (value & 3) != 0))
-	        _dl_reloc_overflow (map, "R_PPC64_ADDR14", reloc_addr, sym, refsym);
-        insn = BIT_INSERT (*(Elf64_Word *) reloc_addr, value, 0xfffc);
+	  _dl_reloc_overflow (map, "R_PPC64_ADDR14", reloc_addr, refsym);
+        Elf64_Word insn = *(Elf64_Word *) reloc_addr;
+        BIT_INSERT (insn, value, 0xfffc);
         if (r_type != R_PPC64_ADDR14)
-	        {
-	          insn &= ~(1 << 21);
-	          if (r_type == R_PPC64_ADDR14_BRTAKEN)
-	            insn |= 1 << 21;
-	          if ((insn & (0x14 << 21)) == (0x04 << 21))
-	            insn |= 0x02 << 21;
-	          else if ((insn & (0x14 << 21)) == (0x10 << 21))
-	            insn |= 0x08 << 21;
-	        }
+	  {
+	    insn &= ~(1 << 21);
+	    if (r_type == R_PPC64_ADDR14_BRTAKEN)
+	      insn |= 1 << 21;
+	    if ((insn & (0x14 << 21)) == (0x04 << 21))
+	      insn |= 0x02 << 21;
+	    else if ((insn & (0x14 << 21)) == (0x10 << 21))
+	      insn |= 0x08 << 21;
+	  }
         *(Elf64_Word *) reloc_addr = insn;
       }
       break;
 
     case R_PPC64_REL32:
-      *(Elf64_Word *) reloc_addr = value - (Elf64_Xword) reloc_addr;
+      *(Elf64_Word *) reloc_addr = value - (Elf64_Addr) reloc_addr;
+      return;
+
+    case R_PPC64_REL64:
+      *reloc_addr = value - (Elf64_Addr) reloc_addr;
       return;
 #endif /* !RTLD_BOOTSTRAP */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/elf/configure libc-20030708/sysdeps/powerpc/powerpc64/elf/configure
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/elf/configure	2003-02-26 08:41:08.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/elf/configure	2003-03-13 06:39:43.000000000 +0900
@@ -70,7 +70,3 @@
 fi
 fi
 
-cat >>confdefs.h <<\_ACEOF
-#define PI_STATIC_AND_HIDDEN 1
-_ACEOF
-
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/elf/configure.in libc-20030708/sysdeps/powerpc/powerpc64/elf/configure.in
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/elf/configure.in	2003-02-26 08:26:57.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/elf/configure.in	2003-03-13 06:39:43.000000000 +0900
@@ -56,6 +56,3 @@
 fi
 fi
 
-dnl It is always possible to access static and hidden symbols in an
-dnl position independent way.
-AC_DEFINE(PI_STATIC_AND_HIDDEN)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/elf/start.S libc-20030708/sysdeps/powerpc/powerpc64/elf/start.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/elf/start.S	2002-12-10 12:41:54.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/elf/start.S	2003-07-08 22:58:13.000000000 +0900
@@ -1,5 +1,5 @@
 /* Startup code for programs linked with GNU libc.  PowerPC64 version.
-   Copyright (C) 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998,1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,7 +21,11 @@
 #include "bp-sym.h"
 
  /* These are the various addresses we require.  */
+#ifdef PIC
+	.section ".data.rel.ro.local"
+#else
 	.section ".rodata"
+#endif
 	.align	3
 L(start_addresses):
 	.quad	0 /* was _SDA_BASE_  but not in 64-bit ABI*/
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/memcpy.S libc-20030708/sysdeps/powerpc/powerpc64/memcpy.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/memcpy.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -0,0 +1,211 @@
+/* Optimized memcpy implementation for PowerPC64.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* __ptr_t [r3] memcpy (__ptr_t dst [r3], __ptr_t src [r4], size_t len [r5]);
+   Returns 'dst'.
+
+   Memcpy handles short copies (< 32-bytes) using an unaligned
+   word lwz/stw loop.  The tail (remaining 1-3) bytes is handled with the
+   appropriate combination of byte and halfword load/stores. There is no
+   attempt to optimize the alignment of short moves.  The 64-bit
+   implementations of POWER3 and POWER4 do a reasonable job of handling
+   unligned load/stores that do not cross 32-byte boundries.
+
+   Longer moves (>= 32-bytes) justify the effort to get at least the
+   destination doubleword (8-byte) aligned.  Further optimization is
+   posible when both source and destination are doubleword aligned.
+   Each case has a optimized unrolled loop.   */
+
+EALIGN (BP_SYM (memcpy), 5, 0)
+    cmpldi cr1,5,31
+    neg   0,3
+    std   30,-16(1)
+    std   31,-8(1)
+    rldicl. 0,0,0,61
+    mr    12,4
+    mr    31,5
+    mr    30,3
+    ble-  cr1,.L2
+    subf  31,0,5
+
+  /* Move 0-7 bytes as needed to get the destination doubleword alligned.  */
+    beq   0f
+    mtcrf 0x01,0
+1:  bf    31,2f
+    lbz   6,0(12)
+    addi  12,12,1
+    stb   6,0(3)
+    addi  3,3,1
+2:  bf    30,4f
+    lhz   6,0(12)
+    addi  12,12,2
+    sth   6,0(3)
+    addi  3,3,2
+4:  bf    29,0f
+    lwz   6,0(12)
+    addi  12,12,4
+    stw   6,0(3)
+    addi  3,3,4
+0:
+  /* Copy doublewords from source to destination, assumpting the
+     destination is aligned on a doubleword boundary.
+
+     First verify that there is > 7 bytes to copy and check if the source
+     is also doubleword aligned.  If there are < 8 bytes to copy fall
+     through to the tail byte copy code.  Otherwise if the source and
+     destination are both doubleword aligned use an optimized doubleword
+     copy loop.  Otherwise the source has a different alignment and we use
+     a load, shift, store strategy.  */
+    rldicl. 0,12,0,61
+    cmpldi cr6,31,7
+    ble-  cr6,.L2  /* less than 8 bytes left.  */
+    bne-  0,.L6   /* Source is not DW aligned.  */
+    srdi. 9,31,3
+    mr    10,3
+    mr    11,12
+
+  /* Move doublewords where destination and source are aligned.
+     Use a unrolled loop to copy 4 doubleword (32-bytes) per iteration.
+     If the remainder is >0 and < 32 bytes copy 1-3 doublewords.  */
+    cmpldi	cr1,9,4
+    beq   0f
+    mtcrf 0x01,9
+    blt   cr1,2f
+    ld    6,0(11)
+    .align  4
+4:
+    ld    7,8(11)
+    addi  9,9,-4
+    std   6,0(10)
+    ld    6,16(11)
+    std   7,8(10)
+    ld    7,24(11)
+    addi  11,11,32
+    cmpldi	cr1,9,4
+    std   6,16(10)
+    blt   cr1,3f
+    ld    6,0(11)
+    std   7,24(10)
+    addi  10,10,32
+    b     4b
+3:  std   7,24(10)
+    addi  10,10,32
+2:  bf    30,1f
+    ld    6,0(11)
+    ld    7,8(11)
+    addi  11,11,16
+    std   6,0(10)
+    std   7,8(10)
+    addi  10,10,16
+1:  bf    31,0f
+    ld    6,0(11)
+    addi  11,11,8
+    std   6,0(10)
+    addi  10,10,8
+0:
+
+.L8:
+    rldicr 0,31,0,60
+    rldicl 31,31,0,61
+    add   3,3,0
+    add   12,12,0
+
+	/* Copy the tail for up to 31 bytes.  If this is the tail of a longer
+	   copy then the destination will be aligned and the length will be
+	   less than 8.  So it is normally not worth the set-up overhead to
+	   get doubleword aligned and do doubleword load/store.  */
+.L2:
+    mr.   10,31
+    cmpldi	cr1,31,4
+    beq   0f
+    mtcrf 0x01,31
+    blt   cr1,2f
+4:  lwz   6,0(12)
+    addi  12,12,4
+    addi  10,10,-4
+    stw   6,0(3)
+    cmpldi	cr1,10,4
+    addi  3,3,4
+    bge   cr1,4b
+2:  bf    30,1f
+    lhz   6,0(12)
+    addi  12,12,2
+    sth   6,0(3)
+    addi  3,3,2
+1:  bf    31,0f
+    lbz   6,0(12)
+    addi  12,12,1
+    stb   6,0(3)
+    addi  3,3,1
+0:
+  /* Return original dst pointer.  */
+    ld 31,-8(1)
+    mr 3,30
+    ld 30,-16(1)
+    blr
+
+.L6:
+    srdi 11,31,3
+    mr 4,3
+    mr 5,12
+
+  /* Copy doublewords where the destination is aligned but the source is
+     not.  Use aligned doubleword loads from the source, shifted to realign
+     the data, to allow aligned destination stores.  */
+    andi. 10,5,7
+    andi. 0,11,1
+    subf  5,10,5
+    ld    6,0(5)
+    sldi  10,10,3
+    ld    7,8(5)
+    subfic  9,10,64
+    beq   2f
+    sld   0,6,10
+    addi  11,11,-1
+    mr    6,7
+    addi  4,4,-8
+    cmpldi  11,0
+    b     1f
+2:  addi  5,5,8
+    .align  4
+0:  sld   0,6,10
+    srd   8,7,9
+    addi  11,11,-2
+    ld    6,8(5)
+    or    0,0,8
+    cmpldi  11,0
+    std   0,0(4)
+    sld   0,7,10
+1:  srd   8,6,9
+    or    0,0,8
+    beq   8f
+    ld    7,16(5)
+    std   0,8(4)
+    addi  5,5,16
+    addi  4,4,16
+    b     0b
+8:
+    std   0,8(4)
+    b .L8
+END_GEN_TB (BP_SYM (memcpy),TB_TOCLESS)
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/memset.S libc-20030708/sysdeps/powerpc/powerpc64/memset.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/memset.S	2002-09-18 08:50:02.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized memset implementation for PowerPC64.
-   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,17 +21,12 @@
 #include <bp-sym.h>
 #include <bp-asm.h>
 
-/* Define a global static that can hold the cache line size.  The 
+/* Define a global static that can hold the cache line size.  The
    assumption is that startup code will access the "aux vector" to
-   to obtain the value set by the kernel and store it into this 
+   to obtain the value set by the kernel and store it into this
    variable.  */
 	.globl __cache_line_size
-	.section	".data"
-	.align 2
-	.type	__cache_line_size,@object
-	.size	__cache_line_size,4
-__cache_line_size:
-	.long	0
+	.lcomm __cache_line_size,4,4
 	.section	".toc","aw"
 .LC0:
 	.tc __cache_line_size[TC],__cache_line_size
@@ -81,7 +76,7 @@
 	andi.	rALIGN, rMEMP0, 7
 	mr	rMEMP, rMEMP0
 	ble-	cr1, L(small)
-	
+
 /* Align to doubleword boundary.  */
 	cmpldi	cr5, rLEN, 31
 	rlwimi	rCHR, rCHR, 8, 16, 23 /* Replicate byte to halfword.  */
@@ -108,9 +103,9 @@
 	bf+	31, L(g0)
 	stb	rCHR, 0(rMEMP0)
 	bt	30, L(aligned)
-L(g0):	
-	sth	rCHR, -2(rMEMP)	
-	
+L(g0):
+	sth	rCHR, -2(rMEMP)
+
 /* Handle the case of size < 31.  */
 L(aligned2):
 	rlwimi	rCHR, rCHR, 16, 0, 15 /* Replicate halfword to word.  */
@@ -138,9 +133,9 @@
 L(caligned):
 	cmpldi	cr1, rCHR, 0
 	clrrdi.	rALIGN, rLEN, 5
-	mtcrf	0x01, rLEN	
+	mtcrf	0x01, rLEN
 	beq	cr1, L(zloopstart) /* Special case for clearing memory using dcbz.  */
-L(nondcbz):	
+L(nondcbz):
 	srdi	rTMP, rALIGN, 5
 	mtctr	rTMP
 	beq	L(medium)	/* We may not actually get to do a full line.  */
@@ -168,21 +163,21 @@
 	.align 5
 /* Clear lines of memory in 128-byte chunks.  */
 L(zloopstart):
-/* If the remaining length is less the 32 bytes, don't bother getting 
+/* If the remaining length is less the 32 bytes, don't bother getting
 	 the cache line size.  */
 	beq	L(medium)
 	ld	rCLS,.LC0@toc(r2)
-	lwz	rCLS,0(rCLS)	
-/* If the cache line size was not set just goto to L(nondcbz) which is 
-	 safe for any cache line size.  */	
+	lwz	rCLS,0(rCLS)
+/* If the cache line size was not set just goto to L(nondcbz) which is
+	 safe for any cache line size.  */
 	cmpldi	cr1,rCLS,0
 	beq		cr1,L(nondcbz)
-	
-	
+
+
 /* Now we know the cache line size, and it is not 32-bytes, but
-	 we may not yet be aligned to the cache line. May have a partial 
-	 line to fill, so touch it 1st.  */	
-	dcbt	0,rMEMP	
+	 we may not yet be aligned to the cache line. May have a partial
+	 line to fill, so touch it 1st.  */
+	dcbt	0,rMEMP
 	addi	rCLM,rCLS,-1
 L(getCacheAligned):
 	cmpldi	cr1,rLEN,32
@@ -196,8 +191,8 @@
 	std		rCHR,-16(rMEMP)
 	std		rCHR,-8(rMEMP)
 	b		L(getCacheAligned)
-	
-/* Now we are aligned to the cache line and can use dcbz.  */	
+
+/* Now we are aligned to the cache line and can use dcbz.  */
 L(cacheAligned):
 	cmpld	cr1,rLEN,rCLS
 	blt		cr1,L(handletail32)
@@ -208,7 +203,7 @@
 
 /* We are here because the cache line size was set and was not 32-bytes
    and the remainder (rLEN) is less than the actual cache line size.
-   So set up the preconditions for L(nondcbz) and go there.  */			
+   So set up the preconditions for L(nondcbz) and go there.  */
 L(handletail32):
 	clrrwi.	rALIGN, rLEN, 5
 	b		L(nondcbz)
@@ -264,7 +259,7 @@
 	bf-	29, L(medium_29f)
 L(medium_29t):
 	stwu	rCHR, -4(rMEMP)
-	blt-	cr1, L(medium_27f) 
+	blt-	cr1, L(medium_27f)
 L(medium_27t):
 	std	rCHR, -8(rMEMP)
 	stdu	rCHR, -16(rMEMP)
@@ -274,8 +269,9 @@
 	std	rCHR, -8(rMEMP)
 	blr
 END_GEN_TB (BP_SYM (memset),TB_TOCLESS)
+libc_hidden_builtin_def (memset)
 
-/* Copied from bzero.S to prevent the linker from inserting a stub 
+/* Copied from bzero.S to prevent the linker from inserting a stub
    between bzero and memset.  */
 ENTRY (BP_SYM (__bzero))
 #if __BOUNDED_POINTERS__
@@ -293,4 +289,3 @@
 END_GEN_TB (BP_SYM (__bzero),TB_TOCLESS)
 
 weak_alias (BP_SYM (__bzero), BP_SYM (bzero))
-
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/strchr.S libc-20030708/sysdeps/powerpc/powerpc64/strchr.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/strchr.S	2002-09-18 08:50:02.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/strchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strchr implementation for PowerPC64.
-   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -29,6 +29,11 @@
 
 #define rTMP1	r0
 #define rRTN	r3	/* outgoing result */
+/* Note:  The Bounded pointer support in this code is broken.  This code
+   was inherited from PPC32 and and that support was never completed.  
+   Currently PPC gcc does not support -fbounds-check or -fbounded-pointers.
+   These artifacts are left in the code as a reminder in case we need
+   bounded pointer support in the future.  */
 #if __BOUNDED_POINTERS__
 # define rSTR	r4
 # define rCHR	r5	/* byte we're looking for, spread over the whole word */
@@ -39,8 +44,8 @@
 # define rWORD	r5	/* the current word */
 #endif
 #define rCLZB	rCHR	/* leading zero byte count */
-#define rFEFE	r6	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r7	/* constant 0x7f7f7f7f */
+#define rFEFE	r6	/* constant 0xfefefefefefefeff (-0x0101010101010101) */
+#define r7F7F	r7	/* constant 0x7f7f7f7f7f7f7f7f */
 #define rTMP2	r9
 #define rIGN	r10	/* number of bits we should ignore in the first word */
 #define rMASK	r11	/* mask with the bits to ignore set to 0 */
@@ -49,18 +54,23 @@
 	CHECK_BOUNDS_LOW (rSTR, rTMP1, rTMP2)
 	STORE_RETURN_BOUNDS (rTMP1, rTMP2)
 
+	dcbt	0,rRTN
 	rlwimi	rCHR, rCHR, 8, 16, 23
 	li	rMASK, -1
 	rlwimi	rCHR, rCHR, 16, 0, 15
-	rlwinm	rIGN, rRTN, 3, 27, 28
+	rlwinm	rIGN, rRTN, 3, 26, 28
+	insrdi	rCHR, rCHR, 32, 0
 	lis	rFEFE, -0x101
 	lis	r7F7F, 0x7f7f
-	clrrdi	rSTR, rRTN, 2
+	clrrdi	rSTR, rRTN, 3
 	addi	rFEFE, rFEFE, -0x101
 	addi	r7F7F, r7F7F, 0x7f7f
+	sldi	rTMP1, rFEFE, 32
+	insrdi	r7F7F, r7F7F, 32, 0
+	add	rFEFE, rFEFE, rTMP1
 /* Test the first (partial?) word.  */
-	lwz	rWORD, 0(rSTR)
-	srw	rMASK, rMASK, rIGN
+	ld	rWORD, 0(rSTR)
+	srd	rMASK, rMASK, rIGN
 	orc	rWORD, rWORD, rMASK
 	add	rTMP1, rFEFE, rWORD
 	nor	rTMP2, r7F7F, rWORD
@@ -71,7 +81,7 @@
 
 /* The loop.  */
 
-L(loop):lwzu rWORD, 4(rSTR)
+L(loop):ldu rWORD, 8(rSTR)
 	and.	rTMP1, rTMP1, rTMP2
 /* Test for 0.	*/
 	add	rTMP1, rFEFE, rWORD
@@ -104,12 +114,12 @@
 	add	rTMP1, rTMP1, r7F7F
 	nor	rWORD, rMASK, rFEFE
 	nor	rTMP2, rIGN, rTMP1
-	cmplw	rWORD, rTMP2
+	cmpld	rWORD, rTMP2
 	bgtlr
-	cntlzw	rCLZB, rTMP2
-	srwi	rCLZB, rCLZB, 3
+	cntlzd	rCLZB, rTMP2
+	srdi	rCLZB, rCLZB, 3
 	add	rRTN, rSTR, rCLZB
-	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, twlge)
+	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, tdlge)
 	STORE_RETURN_VALUE (rSTR)
 	blr
 
@@ -118,13 +128,14 @@
 	or	rIGN, r7F7F, rTMP3
 	add	rTMP1, rTMP1, r7F7F
 	nor	rTMP2, rIGN, rTMP1
-	cntlzw	rCLZB, rTMP2
-	subi	rSTR, rSTR, 4
-	srwi	rCLZB, rCLZB, 3
+	cntlzd	rCLZB, rTMP2
+	subi	rSTR, rSTR, 8
+	srdi	rCLZB, rCLZB, 3
 	add	rRTN, rSTR, rCLZB
-	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, twlge)
+	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, tdlge)
 	STORE_RETURN_VALUE (rSTR)
 	blr
 END (BP_SYM (strchr))
 
 weak_alias (BP_SYM (strchr), BP_SYM (index))
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/strcmp.S libc-20030708/sysdeps/powerpc/powerpc64/strcmp.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/strcmp.S	2002-09-18 08:50:02.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/strcmp.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strcmp implementation for PowerPC64.
-   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,42 +31,50 @@
 #define rRTN	r3
 #define rSTR1	r3	/* first string arg */
 #define rSTR2	r4	/* second string arg */
+/* Note:  The Bounded pointer support in this code is broken.  This code
+   was inherited from PPC32 and and that support was never completed.  
+   Current PPC gcc does not support -fbounds-check or -fbounded-pointers.
+   These artifacts are left in the code as a reminder in case we need
+   bounded pointer support in the future.  */
 #if __BOUNDED_POINTERS__
 # define rHIGH1	r11
 # define rHIGH2 r12
 #endif
 #define rWORD1	r5	/* current word in s1 */
 #define rWORD2	r6	/* current word in s2 */
-#define rFEFE	r7	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r8	/* constant 0x7f7f7f7f */
-#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f) */
+#define rFEFE	r7	/* constant 0xfefefefefefefeff (-0x0101010101010101) */
+#define r7F7F	r8	/* constant 0x7f7f7f7f7f7f7f7f */
+#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f7f7f7f7f) */
 #define rBITDIF	r10	/* bits that differ in s1 & s2 words */
 
 	CHECK_BOUNDS_LOW (rSTR1, rTMP, rHIGH1)
 	CHECK_BOUNDS_LOW (rSTR2, rTMP, rHIGH2)
 
+	dcbt	0,rSTR1
 	or	rTMP, rSTR2, rSTR1
-	clrldi.	rTMP, rTMP, 62
+	dcbt	0,rSTR2
+	clrldi.	rTMP, rTMP, 61
 	lis	rFEFE, -0x101
 	bne	L(unaligned)
 
-	lwz	rWORD1, 0(rSTR1)
-	lwz	rWORD2, 0(rSTR2)
+	ld	rWORD1, 0(rSTR1)
+	ld	rWORD2, 0(rSTR2)
 	lis	r7F7F, 0x7f7f
 	addi	rFEFE, rFEFE, -0x101
-	clrldi	rFEFE,rFEFE,32 /* clear upper 32 */
 	addi	r7F7F, r7F7F, 0x7f7f
+	sldi	rTMP, rFEFE, 32
+	insrdi	r7F7F, r7F7F, 32, 0
+	add	rFEFE, rFEFE, rTMP
 	b	L(g1)
 
-L(g0):	lwzu	rWORD1, 4(rSTR1)
+L(g0):	ldu	rWORD1, 8(rSTR1)
 	bne	cr1, L(different)
-	lwzu	rWORD2, 4(rSTR2)
+	ldu	rWORD2, 8(rSTR2)
 L(g1):	add	rTMP, rFEFE, rWORD1
 	nor	rNEG, r7F7F, rWORD1
 
-	clrldi	rNEG,rNEG,32 /* clear upper 32 */
 	and.	rTMP, rTMP, rNEG
-	cmpw	cr1, rWORD1, rWORD2
+	cmpd	cr1, rWORD1, rWORD2
 	beq+	L(g0)
 L(endstring):
 /* OK. We've hit the end of the string. We need to be careful that
@@ -77,29 +85,34 @@
 	add	rTMP, rTMP, r7F7F
 	xor.	rBITDIF, rWORD1, rWORD2
 
-	extsw.	rBITDIF,rBITDIF /* propagate sign for blt */
 	andc	rNEG, rNEG, rTMP
 	blt-	L(highbit)
-	cntlzw	rBITDIF, rBITDIF
-	cntlzw	rNEG, rNEG
+	cntlzd	rBITDIF, rBITDIF
+	cntlzd	rNEG, rNEG
 	addi	rNEG, rNEG, 7
-	cmpw	cr1, rNEG, rBITDIF
+	cmpd	cr1, rNEG, rBITDIF
 	sub	rRTN, rWORD1, rWORD2
-	bgelr+	cr1
+	blt-	cr1, L(equal)
+	sradi	rRTN, rRTN, 63
+	ori	rRTN, rRTN, 1
+	blr
 L(equal):
 	li	rRTN, 0
 	/* GKM FIXME: check high bounds.  */
 	blr
 
 L(different):
-	lwz	rWORD1, -4(rSTR1)
+	ld	rWORD1, -8(rSTR1)
 	xor.	rBITDIF, rWORD1, rWORD2
-
-	extsw.	rBITDIF,rBITDIF /* propagate sign for bgelr */
 	sub	rRTN, rWORD1, rWORD2
-	bgelr+
+	blt-	L(highbit)
+	sradi	rRTN, rRTN, 63
+	ori	rRTN, rRTN, 1
+	blr
 L(highbit):
-	ori	rRTN, rWORD2, 1
+	srdi	rWORD2, rWORD2, 56
+	srdi	rWORD1, rWORD1, 56
+	sub	rRTN, rWORD1, rWORD2
 	/* GKM FIXME: check high bounds.  */
 	blr
 
@@ -116,12 +129,12 @@
 	lbzu	rWORD2, 1(rSTR2)
 L(u1):	cmpwi	cr1, rWORD1, 0
 	beq-	cr1, L(u3)
-	cmpw	rWORD1, rWORD2
+	cmpd	rWORD1, rWORD2
 	bne-	L(u3)
 	lbzu	rWORD1, 1(rSTR1)
 	lbzu	rWORD2, 1(rSTR2)
-	cmpwi	cr1, rWORD1, 0
-	cmpw	rWORD1, rWORD2
+	cmpdi	cr1, rWORD1, 0
+	cmpd	rWORD1, rWORD2
 	bne+	cr1, L(u0)
 L(u3):	sub	rRTN, rWORD1, rWORD2
 	/* GKM FIXME: check high bounds.  */
@@ -131,3 +144,4 @@
 	/* GKM FIXME: check high bounds.  */
 	blr
 END (BP_SYM (strcmp))
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/strcpy.S libc-20030708/sysdeps/powerpc/powerpc64/strcpy.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/strcpy.S	2002-09-18 08:50:02.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/strcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strcpy implementation for PowerPC64.
-   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -29,6 +29,11 @@
 
 #define rTMP	r0
 #define rRTN	r3	/* incoming DEST arg preserved as result */
+/* Note.  The Bounded pointer support in this code is broken.  This code
+   was inherited from PPC32 and and that support was never completed.  
+   Current PPC gcc does not support -fbounds-check or -fbounded-pointers.
+   These artifacts are left in the code as a reminder in case we need
+   bounded pointer support in the future.  */
 #if __BOUNDED_POINTERS__
 # define rDEST	r4	/* pointer to previous word in dest */
 # define rSRC	r5	/* pointer to previous word in src */
@@ -39,39 +44,44 @@
 # define rDEST	r5	/* pointer to previous word in dest */
 #endif
 #define rWORD	r6	/* current word from src */
-#define rFEFE	r7	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r8	/* constant 0x7f7f7f7f */
-#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f) */
+#define rFEFE	r7	/* constant 0xfefefefefefefeff (-0x0101010101010101) */
+#define r7F7F	r8	/* constant 0x7f7f7f7f7f7f7f7f */
+#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f7f7f7f7f) */
 #define rALT	r10	/* alternate word from src */
 
 	CHECK_BOUNDS_LOW (rSRC, rLOW, rHIGH)
 	CHECK_BOUNDS_LOW (rDEST, rLOW, rHIGH)
 	STORE_RETURN_BOUNDS (rLOW, rHIGH)
 
+	dcbt	0,rSRC
 	or	rTMP, rSRC, rRTN
-	clrldi.	rTMP, rTMP, 62
+	clrldi.	rTMP, rTMP, 61
 #if __BOUNDED_POINTERS__
-	addi	rDEST, rDEST, -4
+	addi	rDEST, rDEST, -8
 #else
-	addi	rDEST, rRTN, -4
+	addi	rDEST, rRTN, -8
 #endif
+	dcbtst	0,rRTN
 	bne	L(unaligned)
 
 	lis	rFEFE, -0x101
 	lis	r7F7F, 0x7f7f
-	lwz	rWORD, 0(rSRC)
+	ld	rWORD, 0(rSRC)
 	addi	rFEFE, rFEFE, -0x101
 	addi	r7F7F, r7F7F, 0x7f7f
+	sldi	rTMP, rFEFE, 32
+	insrdi	r7F7F, r7F7F, 32, 0
+	add	rFEFE, rFEFE, rTMP
 	b	L(g2)
 
-L(g0):	lwzu	rALT, 4(rSRC)
-	stwu	rWORD, 4(rDEST)
+L(g0):	ldu	rALT, 8(rSRC)
+	stdu	rWORD, 8(rDEST)
 	add	rTMP, rFEFE, rALT
 	nor	rNEG, r7F7F, rALT
 	and.	rTMP, rTMP, rNEG
 	bne-	L(g1)
-	lwzu	rWORD, 4(rSRC)
-	stwu	rALT, 4(rDEST)
+	ldu	rWORD, 8(rSRC)
+	stdu	rALT, 8(rDEST)
 L(g2):	add	rTMP, rFEFE, rWORD
 	nor	rNEG, r7F7F, rWORD
 	and.	rTMP, rTMP, rNEG
@@ -79,16 +89,29 @@
 
 	mr	rALT, rWORD
 /* We've hit the end of the string.  Do the rest byte-by-byte.  */
-L(g1):	rlwinm.	rTMP, rALT, 8, 24, 31
-	stb	rTMP, 4(rDEST)
+L(g1):
+	extrdi.	rTMP, rALT, 8, 0
+	stb	rTMP, 8(rDEST)
 	beqlr-
-	rlwinm.	rTMP, rALT, 16, 24, 31
-	stb	rTMP, 5(rDEST)
+	extrdi.	rTMP, rALT, 8, 8
+	stb	rTMP, 9(rDEST)
 	beqlr-
-	rlwinm.	rTMP, rALT, 24, 24, 31
-	stb	rTMP, 6(rDEST)
+	extrdi.	rTMP, rALT, 8, 16
+	stb	rTMP, 10(rDEST)
 	beqlr-
-	stb	rALT, 7(rDEST)
+	extrdi.	rTMP, rALT, 8, 24
+	stb	rTMP, 11(rDEST)
+	beqlr-
+	extrdi.	rTMP, rALT, 8, 32
+	stb	rTMP, 12(rDEST)
+	beqlr-
+	extrdi.	rTMP, rALT, 8, 40
+	stb	rTMP, 13(rDEST)
+	beqlr-
+	extrdi.	rTMP, rALT, 8, 48
+	stb	rTMP, 14(rDEST)
+	beqlr-
+	stb	rALT, 15(rDEST)
 	/* GKM FIXME: check high bound.  */
 	blr
 
@@ -118,3 +141,4 @@
 	blr
 
 END (BP_SYM (strcpy))
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/strlen.S libc-20030708/sysdeps/powerpc/powerpc64/strlen.S
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/strlen.S	2002-09-18 08:50:02.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/strlen.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Optimized strlen implementation for PowerPC64.
-   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -60,7 +60,12 @@
    2) How popular are bytes with the high bit set? If they are very rare,
    on some processors it might be useful to use the simpler expression
    ~((x - 0x01010101) | 0x7f7f7f7f) (that is, on processors with only one
-   ALU), but this fails when any character has its high bit set.  */
+   ALU), but this fails when any character has its high bit set.  
+   
+   Answer:
+   1) Added a Data Cache Block Touch early to prefetch the first 128 
+   byte cache line. Adding dcbt instructions to the loop would not be 
+   effective since most strings will be shorter than the cache line.*/
 
 /* Some notes on register usage: Under the SVR4 ABI, we can use registers
    0 and 3 through 12 (so long as we don't call any procedures) without
@@ -80,63 +85,68 @@
 #define rSTR	r4	/* current string position */
 #define rPADN	r5	/* number of padding bits we prepend to the
 			   string to make it start at a word boundary */
-#define rFEFE	r6	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r7	/* constant 0x7f7f7f7f */
-#define rWORD1	r8	/* current string word */
-#define rWORD2	r9	/* next string word */
-#define rMASK	r9	/* mask for first string word */
+#define rFEFE	r6	/* constant 0xfefefefefefefeff (-0x0101010101010101) */
+#define r7F7F	r7	/* constant 0x7f7f7f7f7f7f7f7f */
+#define rWORD1	r8	/* current string doubleword */
+#define rWORD2	r9	/* next string doubleword */
+#define rMASK	r9	/* mask for first string doubleword */
 #define rTMP2	r10
 #define rTMP3	r11
 #define rTMP4	r12
 
+/* Note:  The Bounded pointer support in this code is broken.  This code
+   was inherited from PPC32 and and that support was never completed.  
+   Current PPC gcc does not support -fbounds-check or -fbounded-pointers.
+   These artifacts are left in the code as a reminder in case we need
+   bounded pointer support in the future.  */
 	CHECK_BOUNDS_LOW (rRTN, rTMP1, rTMP2)
 
-	clrrdi	rSTR, rRTN, 2
+	dcbt	0,rRTN
+	clrrdi	rSTR, rRTN, 3
 	lis	r7F7F, 0x7f7f
-	rlwinm	rPADN, rRTN, 3, 27, 28
-	lwz	rWORD1, 0(rSTR)
-	li	rMASK, -1
+	rlwinm	rPADN, rRTN, 3, 26, 28
+	ld	rWORD1, 0(rSTR)
 	addi	r7F7F, r7F7F, 0x7f7f
-/* That's the setup done, now do the first pair of words.
-   We make an exception and use method (2) on the first two words, to reduce
-   overhead.  */
-	srw	rMASK, rMASK, rPADN
+	li	rMASK, -1
+	insrdi	r7F7F, r7F7F, 32, 0
+/* That's the setup done, now do the first pair of doublewords.
+   We make an exception and use method (2) on the first two doublewords, 
+   to reduce overhead.  */
+	srd	rMASK, rMASK, rPADN
 	and	rTMP1, r7F7F, rWORD1
 	or	rTMP2, r7F7F, rWORD1
+	lis	rFEFE, -0x101
 	add	rTMP1, rTMP1, r7F7F
+	addi	rFEFE, rFEFE, -0x101
 	nor	rTMP1, rTMP2, rTMP1
 	and.	rWORD1, rTMP1, rMASK
 	mtcrf	0x01, rRTN
 	bne	L(done0)
-	lis	rFEFE, -0x101
-	addi	rFEFE, rFEFE, -0x101
-	clrldi	rFEFE,rFEFE,32 /* clear upper 32 */
+	sldi  rTMP1, rFEFE, 32
+	add  rFEFE, rFEFE, rTMP1
 /* Are we now aligned to a doubleword boundary?  */
-	bt	29, L(loop)
+	bt	28, L(loop)
 
-/* Handle second word of pair.  */
-	lwzu	rWORD1, 4(rSTR)
+/* Handle second doubleword of pair.  */
+	ldu	rWORD1, 8(rSTR)
 	and	rTMP1, r7F7F, rWORD1
 	or	rTMP2, r7F7F, rWORD1
 	add	rTMP1, rTMP1, r7F7F
 	nor.	rWORD1, rTMP2, rTMP1
-	clrldi.	rWORD1,rWORD1,32 /* clear upper 32 */
 	bne	L(done0)
 
 /* The loop.  */
 
 L(loop):
-	lwz	rWORD1, 4(rSTR)
-	lwzu	rWORD2, 8(rSTR)
+	ld	rWORD1, 8(rSTR)
+	ldu	rWORD2, 16(rSTR)
 	add	rTMP1, rFEFE, rWORD1
 	nor	rTMP2, r7F7F, rWORD1
 	and.	rTMP1, rTMP1, rTMP2
-	clrldi.	rTMP1,rTMP1,32 /* clear upper 32 */
 	add	rTMP3, rFEFE, rWORD2
 	nor	rTMP4, r7F7F, rWORD2
 	bne	L(done1)
 	and.	rTMP1, rTMP3, rTMP4
-	clrldi.	rTMP1,rTMP1,32 /* clear upper 32 */
 	beq	L(loop)
 
 	and	rTMP1, r7F7F, rWORD2
@@ -146,18 +156,19 @@
 
 L(done1):
 	and	rTMP1, r7F7F, rWORD1
-	subi	rSTR, rSTR, 4
+	subi	rSTR, rSTR, 8
 	add	rTMP1, rTMP1, r7F7F
 	andc	rWORD1, rTMP2, rTMP1
 
-/* When we get to here, rSTR points to the first word in the string that
+/* When we get to here, rSTR points to the first doubleword in the string that
    contains a zero byte, and the most significant set bit in rWORD1 is in that
    byte.  */
 L(done0):
-	cntlzw	rTMP3, rWORD1
+	cntlzd	rTMP3, rWORD1
 	subf	rTMP1, rRTN, rSTR
-	srwi	rTMP3, rTMP3, 3
+	srdi	rTMP3, rTMP3, 3
 	add	rRTN, rTMP1, rTMP3
 	/* GKM FIXME: check high bound.  */
 	blr
 END (BP_SYM (strlen))
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/powerpc64/sysdep.h libc-20030708/sysdeps/powerpc/powerpc64/sysdep.h
--- glibc-2.3.2/sysdeps/powerpc/powerpc64/sysdep.h	2003-01-12 17:09:45.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/powerpc64/sysdep.h	2003-07-08 22:58:13.000000000 +0900
@@ -34,11 +34,16 @@
   .pushsection;          \
   .section ".data";      \
   .align ALIGNARG(2);    \
-0:  .long  0;            \
+__mcount:            \
+  .long  0;            \
+  .previous;              \
+	.section	".toc","aw";  \
+.LC__mcount:; \
+	.tc __mcount[TC],__mcount; \
   .previous;              \
   mflr  r0;              \
   std   r0,16(r1);        \
-  ld    r0,0b@got(r2);    \
+  ld    r0,.LC__mcount@toc(r2);    \
   bl    JUMPTARGET(_mcount);
 #else /* SYSV_ELF_PROFILING */
 #define CALL_MCOUNT      \
@@ -52,11 +57,16 @@
   .pushsection;          \
   .section ".data";      \
   .align ALIGNARG(2);    \
-0:  .long  0;            \
+__mcount:            \
+  .long  0;            \
+  .previous;              \
+	.section	".toc","aw";  \
+.LC__mcount:; \
+	.tc __mcount[TC],__mcount; \
   .previous;              \
   mflr  r0;              \
   std   r0,16(r1);        \
-  ld    r0,0b@got(r2);    \
+  ld    r0,.LC__mcount@toc(r2);    \
   bl    JUMPTARGET(_mcount);
 #else /* SYSV_ELF_PROFILING */
 #define CALL_MCOUNT  \
@@ -225,6 +235,20 @@
 #define	PSEUDO_END(name) \
   END (name)
 
+#define PSEUDO_NOERRNO(name, syscall_name, args) \
+  .section ".text";	\
+  ENTRY (name) \
+  DO_CALL (SYS_ify (syscall_name));
+
+#define PSEUDO_RET_NOERRNO \
+    blr
+
+#define ret_NOERRNO PSEUDO_RET_NOERRNO
+
+#undef	PSEUDO_END_NOERRNO
+#define	PSEUDO_END_NOERRNO(name) \
+  END (name)
+
 /* Label in text section.  */
 /* ppc64 function descriptors which requires . notation */
 #define C_TEXT(name) .##name
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/strcat.c libc-20030708/sysdeps/powerpc/strcat.c
--- glibc-2.3.2/sysdeps/powerpc/strcat.c	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/strcat.c	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* strcat version that uses fast strcpy/strlen.
-   Copyright (C) 1997 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -28,3 +28,4 @@
   strcpy (dest + strlen (dest), src);
   return dest;
 }
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/test-arith.c libc-20030708/sysdeps/powerpc/test-arith.c
--- glibc-2.3.2/sysdeps/powerpc/test-arith.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/test-arith.c	2001-07-06 13:56:01.000000000 +0900
@@ -0,0 +1,605 @@
+/* Test floating-point arithmetic operations.
+   Copyright (C) 1997, 1998 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+#ifndef _GNU_SOURCE
+#define _GNU_SOURCE
+#endif
+#include <math.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <fenv.h>
+#include <assert.h>
+
+#ifndef ESIZE
+typedef double tocheck_t;
+#define ESIZE 11
+#define MSIZE 52
+#define FUNC(x) x
+#endif
+
+#define R_NEAREST 1
+#define R_ZERO 2
+#define R_UP 4
+#define R_DOWN 8
+#define R_ALL (R_NEAREST|R_ZERO|R_UP|R_DOWN)
+static fenv_t rmodes[4];
+static const char * const rmnames[4] =
+{ "nearest","zero","+Inf","-Inf" };
+
+typedef union {
+  tocheck_t tc;
+  unsigned char c[sizeof(tocheck_t)];
+} union_t;
+
+/* Don't try reading these in a font that doesn't distinguish
+   O and zero.  */
+typedef enum {
+  P_Z    = 0x0,  /* 00000...0 */
+  P_000O = 0x1,  /* 00011...1 */
+  P_001Z = 0x2,  /* 00100...0 */
+  P_00O  = 0x3,  /* 00111...1 */
+  P_01Z  = 0x4,  /* 01000...0 */
+  P_010O = 0x5,  /* 01011...1 */
+  P_011Z = 0x6,  /* 01100...0 */
+  P_0O   = 0x7,  /* 01111...1 */
+  P_1Z   = 0x8,  /* 10000...0 */
+  P_100O = 0x9,  /* 10011...1 */
+  P_101Z = 0xa,  /* 10100...0 */
+  P_10O  = 0xb,  /* 10111...1 */
+  P_11Z  = 0xc,  /* 11000...0 */
+  P_110O = 0xd,  /* 11011...1 */
+  P_111Z = 0xe,  /* 11100...0 */
+  P_O    = 0xf,  /* 11111...1 */
+  P_Z1   = 0x11, /* 000...001 */
+  P_Z10  = 0x12, /* 000...010 */
+  P_Z11  = 0x13, /* 000...011 */
+  P_0O00 = 0x14, /* 011...100 */
+  P_0O01 = 0x15, /* 011...101 */
+  P_0O0  = 0x16, /* 011...110 */
+  P_1Z1  = 0x19, /* 100...001 */
+  P_1Z10 = 0x1a, /* 100...010 */
+  P_1Z11 = 0x1b, /* 100...011 */
+  P_O00  = 0x1c, /* 111...100 */
+  P_O01  = 0x1d, /* 111...101 */
+  P_O0   = 0x1e, /* 111...110 */
+  P_R    = 0x20, /* rrr...rrr */ /* ('r' means random. ) */
+  P_Ro   = 0x21, /* rrr...rrr, with odd parity.  */
+  P_0R   = 0x22, /* 0rr...rrr */
+  P_1R   = 0x23, /* 1rr...rrr */
+  P_Rno  = 0x24, /* rrr...rrr, but not all ones.  */
+} pattern_t;
+
+static void
+pattern_fill(pattern_t ptn, unsigned char *start, int bitoffset, int count)
+{
+#define bitset(count, value) \
+      start[(count)/8] = (start[(count)/8] & ~(1 << 7-(count)%8)  \
+                          |  (value) << 7-(count)%8)
+  int i;
+
+  if (ptn >= 0 && ptn <= 0xf)
+    {
+      /* Patterns between 0 and 0xF have the following format:
+	 The LSBit is used to fill the last n-3 bits of the pattern;
+	 The next 3 bits are the first 3 bits of the pattern. */
+      for (i = 0; i < count; i++)
+	if (i < 3)
+	  bitset((bitoffset+i), ptn >> (3-i) & 1);
+	else
+	  bitset((bitoffset+i), ptn >> 0 & 1);
+    }
+  else if (ptn <= 0x1f)
+    {
+      /* Patterns between 0x10 and 0x1F have the following format:
+	 The two LSBits are the last two bits of the pattern;
+	 The 0x8 bit is the first bit of the pattern;
+	 The 0x4 bit is used to fill the remainder. */
+      for (i = 0; i < count; i++)
+	if (i == 0)
+	  bitset((bitoffset+i), ptn >> 3 & 1);
+	else if (i >= count-2)
+	  bitset((bitoffset+i), ptn >> (count-1-i) & 1);
+	else
+	  bitset((bitoffset+i), ptn >> 2 & 1);
+    }
+  else switch (ptn)
+    {
+    case P_0R: case P_1R:
+      assert(count > 0);
+      bitset(bitoffset, ptn & 1);
+      count--;
+      bitoffset++;
+    case P_R:
+      for (; count > 0; count--, bitoffset++)
+	bitset(bitoffset, rand() & 1);
+      break;
+    case P_Ro:
+      {
+	int op = 1;
+	assert(count > 0);
+	for (; count > 1; count--, bitoffset++)
+	  bitset(bitoffset, op ^= (rand() & 1));
+	bitset(bitoffset, op);
+	break;
+      }
+    case P_Rno:
+      {
+	int op = 1;
+	assert(count > 0);
+	for (; count > 1; count--, bitoffset++)
+	{
+	  int r = rand() & 1;
+	  op &= r;
+	  bitset(bitoffset, r);
+	}
+	bitset(bitoffset, rand() & (op ^ 1));
+	break;
+      }
+
+    default:
+      assert(0);
+    }
+#undef bitset
+}
+
+static tocheck_t
+pattern(int negative, pattern_t exp, pattern_t mant)
+{
+  union_t result;
+#if 0
+  int i;
+#endif
+
+  pattern_fill(negative ? P_O : P_Z, result.c, 0, 1);
+  pattern_fill(exp, result.c, 1, ESIZE);
+  pattern_fill(mant, result.c, ESIZE+1, MSIZE);
+#if 0
+  printf("neg=%d exp=%02x mant=%02x: ", negative, exp, mant);
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", result.c[i]);
+  printf("\n");
+#endif
+  return result.tc;
+}
+
+/* Return the closest different tocheck_t to 'x' in the direction of
+   'direction', or 'x' if there is no such value.  Assumes 'x' is not
+   a NaN.  */
+static tocheck_t
+delta(tocheck_t x, int direction)
+{
+  union_t xx;
+  int i;
+
+  xx.tc = x;
+  if (xx.c[0] & 0x80)
+    direction = -direction;
+  if (direction == +1)
+    {
+      union_t tx;
+      tx.tc = pattern(xx.c[0] >> 7, P_O, P_Z);
+      if (memcmp(tx.c, xx.c, sizeof(tocheck_t)) == 0)
+	return x;
+    }
+  for (i = sizeof(tocheck_t)-1; i > 0; i--)
+    {
+      xx.c[i] += direction;
+      if (xx.c[i] != (direction > 0 ? 0 : 0xff))
+	return xx.tc;
+    }
+  if (direction < 0 && (xx.c[0] & 0x7f) == 0)
+    return pattern(~(xx.c[0] >> 7) & 1, P_Z, P_Z1);
+  else
+    {
+      xx.c[0] += direction;
+      return xx.tc;
+    }
+}
+
+static int nerrors = 0;
+
+#ifdef FE_ALL_INVALID
+static const int all_exceptions = FE_ALL_INVALID | FE_ALL_EXCEPT;
+#else
+static const int all_exceptions = FE_ALL_EXCEPT;
+#endif
+
+static void
+check_result(int line, const char *rm, tocheck_t expected, tocheck_t actual)
+{
+  if (memcmp(&expected, &actual, sizeof(tocheck_t)) != 0)
+    {
+      unsigned char *ex, *ac;
+      size_t i;
+
+      printf("%s:%d:round %s:result failed\n"
+	     " expected result 0x", __FILE__, line, rm);
+      ex = (unsigned char *)&expected;
+      ac = (unsigned char *)&actual;
+      for (i = 0; i < sizeof(tocheck_t); i++)
+	printf("%02x", ex[i]);
+      printf(" got 0x");
+      for (i = 0; i < sizeof(tocheck_t); i++)
+	printf("%02x", ac[i]);
+      printf("\n");
+      nerrors++;
+    }
+}
+
+static const struct {
+  int except;
+  const char *name;
+} excepts[] = {
+#define except_entry(ex) { ex, #ex } ,
+#ifdef FE_INEXACT
+  except_entry(FE_INEXACT)
+#else
+# define FE_INEXACT 0
+#endif
+#ifdef FE_DIVBYZERO
+  except_entry(FE_DIVBYZERO)
+#else
+# define FE_DIVBYZERO 0
+#endif
+#ifdef FE_UNDERFLOW
+  except_entry(FE_UNDERFLOW)
+#else
+# define FE_UNDERFLOW 0
+#endif
+#ifdef FE_OVERFLOW
+  except_entry(FE_OVERFLOW)
+#else
+# define FE_OVERFLOW 0
+#endif
+#ifdef FE_INVALID
+  except_entry(FE_INVALID)
+#else
+# define FE_INVALID 0
+#endif
+#ifdef FE_INVALID_SNAN
+  except_entry(FE_INVALID_SNAN)
+#else
+# define FE_INVALID_SNAN FE_INVALID
+#endif
+#ifdef FE_INVALID_ISI
+  except_entry(FE_INVALID_ISI)
+#else
+# define FE_INVALID_ISI FE_INVALID
+#endif
+#ifdef FE_INVALID_IDI
+  except_entry(FE_INVALID_IDI)
+#else
+# define FE_INVALID_IDI FE_INVALID
+#endif
+#ifdef FE_INVALID_ZDZ
+  except_entry(FE_INVALID_ZDZ)
+#else
+# define FE_INVALID_ZDZ FE_INVALID
+#endif
+#ifdef FE_INVALID_COMPARE
+  except_entry(FE_INVALID_COMPARE)
+#else
+# define FE_INVALID_COMPARE FE_INVALID
+#endif
+#ifdef FE_INVALID_SOFTWARE
+  except_entry(FE_INVALID_SOFTWARE)
+#else
+# define FE_INVALID_SOFTWARE FE_INVALID
+#endif
+#ifdef FE_INVALID_SQRT
+  except_entry(FE_INVALID_SQRT)
+#else
+# define FE_INVALID_SQRT FE_INVALID
+#endif
+#ifdef FE_INVALID_INTEGER_CONVERSION
+  except_entry(FE_INVALID_INTEGER_CONVERSION)
+#else
+# define FE_INVALID_INTEGER_CONVERSION FE_INVALID
+#endif
+};
+
+static int excepts_missing = 0;
+
+static void
+check_excepts(int line, const char *rm, int expected, int actual)
+{
+  if (expected & excepts_missing)
+    expected = expected & ~excepts_missing | FE_INVALID_SNAN;
+  if ((expected & all_exceptions) != actual)
+    {
+      size_t i;
+      printf("%s:%d:round %s:exceptions failed\n"
+	     " expected exceptions ", __FILE__, line,rm);
+      for (i = 0; i < sizeof(excepts)/sizeof(excepts[0]); i++)
+	if (expected & excepts[i].except)
+	  printf("%s ",excepts[i].name);
+      if ((expected & all_exceptions) == 0)
+	printf("- ");
+      printf("got");
+      for (i = 0; i < sizeof(excepts)/sizeof(excepts[0]); i++)
+	if (actual & excepts[i].except)
+	  printf(" %s",excepts[i].name);
+      if ((actual & all_exceptions) == 0)
+	printf("- ");
+      printf(".\n");
+      nerrors++;
+    }
+}
+
+typedef enum {
+  B_ADD, B_SUB, B_MUL, B_DIV, B_NEG, B_ABS, B_SQRT
+} op_t;
+typedef struct {
+  int line;
+  op_t op;
+  int a_sgn;
+  pattern_t a_exp, a_mant;
+  int b_sgn;
+  pattern_t b_exp, b_mant;
+  int rmode;
+  int excepts;
+  int x_sgn;
+  pattern_t x_exp, x_mant;
+} optest_t;
+static const optest_t optests[] = {
+  /* Additions of zero.  */
+  {__LINE__,B_ADD, 0,P_Z,P_Z, 0,P_Z,P_Z, R_ALL,0, 0,P_Z,P_Z },
+  {__LINE__,B_ADD, 1,P_Z,P_Z, 0,P_Z,P_Z, R_ALL & ~R_DOWN,0, 0,P_Z,P_Z },
+  {__LINE__,B_ADD, 1,P_Z,P_Z, 0,P_Z,P_Z, R_DOWN,0, 1,P_Z,P_Z },
+  {__LINE__,B_ADD, 1,P_Z,P_Z, 1,P_Z,P_Z, R_ALL,0, 1,P_Z,P_Z },
+
+  /* Additions with NaN.  */
+  {__LINE__,B_ADD, 0,P_O,P_101Z, 0,P_Z,P_Z, R_ALL,0, 0,P_O,P_101Z },
+  {__LINE__,B_ADD, 0,P_O,P_01Z, 0,P_Z,P_Z, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_11Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_O,P_0O, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_O },
+  {__LINE__,B_ADD, 0,P_Z,P_Z, 0,P_O,P_11Z, R_ALL,0, 0,P_O,P_11Z },
+  {__LINE__,B_ADD, 0,P_O,P_001Z, 0,P_O,P_001Z, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_101Z },
+  {__LINE__,B_ADD, 0,P_O,P_1Z, 0,P_Z,P_Z, R_ALL,0, 0,P_O,P_1Z },
+  {__LINE__,B_ADD, 0,P_0O,P_Z, 0,P_O,P_10O, R_ALL,0, 0,P_O,P_10O },
+
+  /* Additions with infinity.  */
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_Z,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 1,P_Z,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 0,P_Z,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 1,P_Z,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_O,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 1,P_O,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 1,P_O,P_Z, R_ALL,
+   FE_INVALID | FE_INVALID_ISI, 0,P_O,P_1Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 0,P_O,P_Z, R_ALL,
+   FE_INVALID | FE_INVALID_ISI, 0,P_O,P_1Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_0O,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 0,P_0O,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 1,P_0O,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 1,P_0O,P_Z, R_ALL,0, 1,P_O,P_Z },
+
+  /* Overflow (and zero).  */
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 0,P_O0,P_Z, R_NEAREST | R_UP,
+   FE_INEXACT | FE_OVERFLOW, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 0,P_O0,P_Z, R_ZERO | R_DOWN,
+   FE_INEXACT | FE_OVERFLOW, 0,P_O0,P_O },
+  {__LINE__,B_ADD, 1,P_O0,P_Z, 1,P_O0,P_Z, R_NEAREST | R_DOWN,
+   FE_INEXACT | FE_OVERFLOW, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O0,P_Z, 1,P_O0,P_Z, R_ZERO | R_UP,
+   FE_INEXACT | FE_OVERFLOW, 1,P_O0,P_O },
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 1,P_O0,P_Z, R_ALL & ~R_DOWN,
+   0, 0,P_Z,P_Z },
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 1,P_O0,P_Z, R_DOWN,
+   0, 1,P_Z,P_Z },
+
+  /* Negation.  */
+  {__LINE__,B_NEG, 0,P_Z,P_Z,   0,0,0, R_ALL, 0, 1,P_Z,P_Z },
+  {__LINE__,B_NEG, 1,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_NEG, 0,P_O,P_Z,   0,0,0, R_ALL, 0, 1,P_O,P_Z },
+  {__LINE__,B_NEG, 1,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_NEG, 0,P_O,P_1Z,  0,0,0, R_ALL, 0, 1,P_O,P_1Z },
+  {__LINE__,B_NEG, 1,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_NEG, 0,P_O,P_01Z, 0,0,0, R_ALL, 0, 1,P_O,P_01Z },
+  {__LINE__,B_NEG, 1,P_O,P_01Z, 0,0,0, R_ALL, 0, 0,P_O,P_01Z },
+  {__LINE__,B_NEG, 0,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 1,P_1Z,P_1Z1 },
+  {__LINE__,B_NEG, 1,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 0,P_1Z,P_1Z1 },
+  {__LINE__,B_NEG, 0,P_Z,P_Z1,  0,0,0, R_ALL, 0, 1,P_Z,P_Z1 },
+  {__LINE__,B_NEG, 1,P_Z,P_Z1,  0,0,0, R_ALL, 0, 0,P_Z,P_Z1 },
+
+  /* Absolute value.  */
+  {__LINE__,B_ABS, 0,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_ABS, 1,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_ABS, 0,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_ABS, 1,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_ABS, 0,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_ABS, 1,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_ABS, 0,P_O,P_01Z, 0,0,0, R_ALL, 0, 0,P_O,P_01Z },
+  {__LINE__,B_ABS, 1,P_O,P_01Z, 0,0,0, R_ALL, 0, 0,P_O,P_01Z },
+  {__LINE__,B_ABS, 0,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 0,P_1Z,P_1Z1 },
+  {__LINE__,B_ABS, 1,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 0,P_1Z,P_1Z1 },
+  {__LINE__,B_ABS, 0,P_Z,P_Z1,  0,0,0, R_ALL, 0, 0,P_Z,P_Z1 },
+  {__LINE__,B_ABS, 1,P_Z,P_Z1,  0,0,0, R_ALL, 0, 0,P_Z,P_Z1 },
+
+  /* Square root.  */
+  {__LINE__,B_SQRT, 0,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_SQRT, 1,P_Z,P_Z,   0,0,0, R_ALL, 0, 1,P_Z,P_Z },
+  {__LINE__,B_SQRT, 0,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_SQRT, 1,P_O,P_1Z,  0,0,0, R_ALL, 0, 1,P_O,P_1Z },
+  {__LINE__,B_SQRT, 0,P_O,P_01Z, 0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_11Z },
+  {__LINE__,B_SQRT, 1,P_O,P_01Z, 0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 1,P_O,P_11Z },
+
+  {__LINE__,B_SQRT, 0,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_SQRT, 0,P_0O,P_Z,  0,0,0, R_ALL, 0, 0,P_0O,P_Z },
+
+  {__LINE__,B_SQRT, 1,P_O,P_Z,   0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SQRT, 0,P_O,P_1Z },
+  {__LINE__,B_SQRT, 1,P_1Z,P_1Z1, 0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SQRT, 0,P_O,P_1Z },
+  {__LINE__,B_SQRT, 1,P_Z,P_Z1,  0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SQRT, 0,P_O,P_1Z },
+
+};
+
+static void
+check_op(void)
+{
+  size_t i;
+  int j;
+  tocheck_t r, a, b, x;
+  int raised;
+
+  for (i = 0; i < sizeof(optests)/sizeof(optests[0]); i++)
+    {
+      a = pattern(optests[i].a_sgn, optests[i].a_exp,
+		  optests[i].a_mant);
+      b = pattern(optests[i].b_sgn, optests[i].b_exp,
+		  optests[i].b_mant);
+      x = pattern(optests[i].x_sgn, optests[i].x_exp,
+		  optests[i].x_mant);
+      for (j = 0; j < 4; j++)
+	if (optests[i].rmode & 1<<j)
+	  {
+	    fesetenv(rmodes+j);
+	    switch (optests[i].op)
+	      {
+	      case B_ADD: r = a + b; break;
+	      case B_SUB: r = a - b; break;
+	      case B_MUL: r = a * b; break;
+	      case B_DIV: r = a / b; break;
+	      case B_NEG: r = -a; break;
+	      case B_ABS: r = FUNC(fabs)(a); break;
+	      case B_SQRT: r = FUNC(sqrt)(a); break;
+	      }
+	    raised = fetestexcept(all_exceptions);
+	    check_result(optests[i].line,rmnames[j],x,r);
+	    check_excepts(optests[i].line,rmnames[j],
+			  optests[i].excepts,raised);
+	  }
+    }
+}
+
+static void
+fail_xr(int line, const char *rm, tocheck_t x, tocheck_t r, tocheck_t xx,
+	int xflag)
+{
+  size_t i;
+  unsigned char *cx, *cr, *cxx;
+
+  printf("%s:%d:round %s:fail\n with x=0x", __FILE__, line,rm);
+  cx = (unsigned char *)&x;
+  cr = (unsigned char *)&r;
+  cxx = (unsigned char *)&xx;
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", cx[i]);
+  printf(" r=0x");
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", cr[i]);
+  printf(" xx=0x");
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", cxx[i]);
+  printf(" inexact=%d\n", xflag != 0);
+  nerrors++;
+}
+
+static void
+check_sqrt(tocheck_t a)
+{
+  int j;
+  tocheck_t r0, r1, r2, x0, x1, x2;
+  int raised = 0;
+  int ok;
+
+  for (j = 0; j < 4; j++)
+    {
+      int excepts;
+
+      fesetenv(rmodes+j);
+      r1 = FUNC(sqrt)(a);
+      excepts = fetestexcept(all_exceptions);
+      fesetenv(FE_DFL_ENV);
+      raised |= excepts & ~FE_INEXACT;
+      x1 = r1 * r1 - a;
+      if (excepts & FE_INEXACT)
+	{
+	  r0 = delta(r1,-1); r2 = delta(r1,1);
+	  switch (1 << j)
+	    {
+	    case R_NEAREST:
+	      x0 = r0 * r0 - a; x2 = r2 * r2 - a;
+	      ok = fabs(x0) >= fabs(x1) && fabs(x1) <= fabs(x2);
+	      break;
+	    case R_ZERO:  case R_DOWN:
+	      x2 = r2 * r2 - a;
+	      ok = x1 <= 0 && x2 >= 0;
+	      break;
+	    case R_UP:
+	      x0 = r0 * r0 - a;
+	      ok = x1 >= 0 && x0 <= 0;
+	      break;
+	    default:
+	      assert(0);
+	    }
+	}
+      else
+	ok = x1 == 0;
+      if (!ok)
+	fail_xr(__LINE__,rmnames[j],a,r1,x1,excepts&FE_INEXACT);
+    }
+  check_excepts(__LINE__,"all",0,raised);
+}
+
+int main(int argc, char **argv)
+{
+  int i;
+
+  _LIB_VERSION = _IEEE_;
+
+  /* Set up environments for rounding modes.  */
+  fesetenv(FE_DFL_ENV);
+  fesetround(FE_TONEAREST);
+  fegetenv(rmodes+0);
+  fesetround(FE_TOWARDZERO);
+  fegetenv(rmodes+1);
+  fesetround(FE_UPWARD);
+  fegetenv(rmodes+2);
+  fesetround(FE_DOWNWARD);
+  fegetenv(rmodes+3);
+
+#if defined(FE_INVALID_SOFTWARE) || defined(FE_INVALID_SQRT)
+  /* There's this really stupid feature of the 601... */
+  fesetenv(FE_DFL_ENV);
+  feraiseexcept(FE_INVALID_SOFTWARE);
+  if (!fetestexcept(FE_INVALID_SOFTWARE))
+    excepts_missing |= FE_INVALID_SOFTWARE;
+  fesetenv(FE_DFL_ENV);
+  feraiseexcept(FE_INVALID_SQRT);
+  if (!fetestexcept(FE_INVALID_SQRT))
+    excepts_missing |= FE_INVALID_SQRT;
+#endif
+
+  check_op();
+  for (i = 0; i < 100000; i++)
+    check_sqrt(pattern(0, P_Rno, P_R));
+  for (i = 0; i < 100; i++)
+    check_sqrt(pattern(0, P_Z, P_R));
+  check_sqrt(pattern(0,P_Z,P_Z1));
+
+  printf("%d errors.\n", nerrors);
+  return nerrors == 0 ? 0 : 1;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/powerpc/test-arithf.c libc-20030708/sysdeps/powerpc/test-arithf.c
--- glibc-2.3.2/sysdeps/powerpc/test-arithf.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/powerpc/test-arithf.c	1997-08-11 02:49:46.000000000 +0900
@@ -0,0 +1,6 @@
+typedef float tocheck_t;
+#define ESIZE 8
+#define MSIZE 23
+#define FUNC(x) x##f
+
+#include "test-arith.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/pthread/aio_misc.h libc-20030708/sysdeps/pthread/aio_misc.h
--- glibc-2.3.2/sysdeps/pthread/aio_misc.h	2002-03-11 17:32:01.000000000 +0900
+++ libc-20030708/sysdeps/pthread/aio_misc.h	2003-07-08 22:58:13.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1999, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -90,38 +90,41 @@
 
 
 /* Lock for global I/O list of requests.  */
-extern pthread_mutex_t __aio_requests_mutex;
+extern pthread_mutex_t __aio_requests_mutex attribute_hidden;
 
 
 /* Enqueue request.  */
 extern struct requestlist *__aio_enqueue_request (aiocb_union *aiocbp,
 						  int operation)
-     internal_function;
+     attribute_hidden internal_function;
 
 /* Find request entry for given AIO control block.  */
 extern struct requestlist *__aio_find_req (aiocb_union *elem)
-     internal_function;
+     attribute_hidden internal_function;
 
 /* Find request entry for given file descriptor.  */
-extern struct requestlist *__aio_find_req_fd (int fildes) internal_function;
+extern struct requestlist *__aio_find_req_fd (int fildes)
+     attribute_hidden internal_function;
 
 /* Remove request from the list.  */
 extern void __aio_remove_request (struct requestlist *last,
 				  struct requestlist *req, int all)
-     internal_function;
+     attribute_hidden internal_function;
 
 /* Release the entry for the request.  */
-extern void __aio_free_request (struct requestlist *req) internal_function;
+extern void __aio_free_request (struct requestlist *req)
+     attribute_hidden internal_function;
 
 /* Notify initiator of request and tell this everybody listening.  */
-extern void __aio_notify (struct requestlist *req) internal_function;
+extern void __aio_notify (struct requestlist *req)
+     attribute_hidden internal_function;
 
 /* Notify initiator of request.  */
 extern int __aio_notify_only (struct sigevent *sigev, pid_t caller_pid)
-     internal_function;
+     attribute_hidden internal_function;
 
 /* Send the signal.  */
 extern int __aio_sigqueue (int sig, const union sigval val, pid_t caller_pid)
-     internal_function;
+     attribute_hidden internal_function;
 
 #endif /* aio_misc.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/pthread/aio_suspend.c libc-20030708/sysdeps/pthread/aio_suspend.c
--- glibc-2.3.2/sysdeps/pthread/aio_suspend.c	2003-01-03 17:15:27.000000000 +0900
+++ libc-20030708/sysdeps/pthread/aio_suspend.c	2003-07-08 22:58:13.000000000 +0900
@@ -35,9 +35,54 @@
 #include <stdlib.h>
 #include <sys/time.h>
 
+#include <bits/libc-lock.h>
 #include "aio_misc.h"
 
 
+struct clparam
+{
+  const struct aiocb *const *list;
+  struct waitlist *waitlist;
+  struct requestlist **requestlist;
+  pthread_cond_t *cond;
+  int nent;
+};
+
+
+static void
+cleanup (void *arg)
+{
+  const struct clparam *param = (const struct clparam *) arg;
+
+  /* Now remove the entry in the waiting list for all requests
+     which didn't terminate.  */
+  int cnt = param->nent;
+  while (cnt-- > 0)
+    if (param->list[cnt] != NULL
+	&& param->list[cnt]->__error_code == EINPROGRESS)
+      {
+	struct waitlist **listp;
+
+	assert (param->requestlist[cnt] != NULL);
+
+	/* There is the chance that we cannot find our entry anymore. This
+	   could happen if the request terminated and restarted again.  */
+	listp = &param->requestlist[cnt]->waiting;
+	while (*listp != NULL && *listp != &param->waitlist[cnt])
+	  listp = &(*listp)->next;
+
+	if (*listp != NULL)
+	  *listp = (*listp)->next;
+      }
+
+  /* Release the conditional variable.  */
+  (void) pthread_cond_destroy (param->cond);
+
+  /* Release the mutex.  */
+  pthread_mutex_unlock (&__aio_requests_mutex);
+}
+
+
 int
 aio_suspend (list, nent, timeout)
      const struct aiocb *const list[];
@@ -87,12 +132,16 @@
   /* Only if none of the entries is NULL or finished to be wait.  */
   if (cnt == nent && any)
     {
-      int oldstate;
+      struct clparam clparam =
+	{
+	  .list = list,
+	  .waitlist = waitlist,
+	  .requestlist = requestlist,
+	  .cond = &cond,
+	  .nent = nent
+	};
 
-      /* Since `pthread_cond_wait'/`pthread_cond_timedwait' are cancelation
-	 points we must be careful.  We added entries to the waiting lists
-	 which we must remove.  So defer cancelation for now.  */
-      pthread_setcancelstate (PTHREAD_CANCEL_DISABLE, &oldstate);
+      pthread_cleanup_push (cleanup, &clparam);
 
       if (timeout == NULL)
 	result = pthread_cond_wait (&cond, &__aio_requests_mutex);
@@ -116,8 +165,7 @@
 					   &abstime);
 	}
 
-      /* Now it's time to restore the cancellation state.  */
-      pthread_setcancelstate (oldstate, NULL);
+      pthread_cleanup_pop (0);
     }
 
   /* Now remove the entry in the waiting list for all requests
@@ -151,6 +199,8 @@
 	 form expected from `aio_suspend'.  */
       if (result == ETIMEDOUT)
 	__set_errno (EAGAIN);
+      else
+	__set_errno (result);
 
       result = -1;
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/pthread/lio_listio64.c libc-20030708/sysdeps/pthread/lio_listio64.c
--- glibc-2.3.2/sysdeps/pthread/lio_listio64.c	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/pthread/lio_listio64.c	2003-05-12 01:30:12.000000000 +0900
@@ -1,5 +1,5 @@
 /* Enqueue and list of read or write requests, 64bit offset version.
-   Copyright (C) 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -42,6 +42,7 @@
      int nent;
      struct sigevent *sig;
 {
+  struct sigevent defsigev;
   struct requestlist *requests[nent];
   int cnt;
   volatile int total = 0;
@@ -54,6 +55,12 @@
       return -1;
     }
 
+  if (sig == NULL)
+    {
+      defsigev.sigev_notify = SIGEV_NONE;
+      sig = &defsigev;
+    }
+
   /* Request the mutex.  */
   pthread_mutex_lock (&__aio_requests_mutex);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/Versions libc-20030708/sysdeps/s390/Versions
--- glibc-2.3.2/sysdeps/s390/Versions	2003-01-28 19:20:09.000000000 +0900
+++ libc-20030708/sysdeps/s390/Versions	2003-03-23 08:00:12.000000000 +0900
@@ -3,4 +3,4 @@
     # runtime interface to TLS
     __tls_get_offset;
   }
-}
\ 
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/bits/atomic.h libc-20030708/sysdeps/s390/bits/atomic.h
--- glibc-2.3.2/sysdeps/s390/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/s390/bits/atomic.h	2003-05-10 13:38:05.000000000 +0900
@@ -0,0 +1,76 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Martin Schwidefsky <schwidefsky@de.ibm.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+  ({ __typeof (mem) __archmem = (mem);					      \
+     __typeof (*mem) __archold = (oldval);				      \
+     __asm __volatile ("cs %0,%2,%1"					      \
+		       : "+d" (__archold), "=Q" (*__archmem)		      \
+		       : "d" (newval), "m" (*__archmem) : "cc" );	      \
+     __archold; })
+
+#ifdef __s390x__
+# define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  ({ __typeof (mem) __archmem = (mem);					      \
+     __typeof (*mem) __archold = (oldval);				      \
+     __asm __volatile ("csg %0,%2,%1"					      \
+		       : "+d" (__archold), "=Q" (*__archmem)		      \
+		       : "d" ((long) (newval)), "m" (*__archmem) : "cc" );    \
+     __archold; })
+#else
+/* For 31 bit we do not really need 64-bit compare-and-exchange. We can
+   implement them by use of the csd instruction. The straightforward
+   implementation causes warnings so we skip the definition for now.  */
+# define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/fpu/fegetenv.c libc-20030708/sysdeps/s390/fpu/fegetenv.c
--- glibc-2.3.2/sysdeps/s390/fpu/fegetenv.c	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/fpu/fegetenv.c	2003-05-10 13:38:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Store current floating-point environment.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Denis Joseph Barrow (djbarrow@de.ibm.com).
 
@@ -36,7 +36,7 @@
      no way to find out the ieee instruction pointer if there was no fault.  */
   _FPU_GETCW (envp->fpc);
   envp->ieee_instruction_pointer =
-    ptrace (PTRACE_PEEKUSER, getpid (), PT_IEEE_IP);
+    (void *) ptrace (PTRACE_PEEKUSER, getpid (), PT_IEEE_IP);
 
   /* Success.  */
   return 0;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/fpu/libm-test-ulps libc-20030708/sysdeps/s390/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/s390/fpu/libm-test-ulps	2002-09-05 08:12:20.000000000 +0900
+++ libc-20030708/sysdeps/s390/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -94,7 +94,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
@@ -107,10 +107,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
@@ -145,7 +145,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -239,7 +239,7 @@
 ifloat: 2
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
@@ -258,7 +258,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -266,7 +266,7 @@
 idouble: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -453,12 +453,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -513,7 +513,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/atomicity.h libc-20030708/sysdeps/s390/s390-32/atomicity.h
--- glibc-2.3.2/sysdeps/s390/s390-32/atomicity.h	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,76 +0,0 @@
-/* Low-level functions for atomic operations.  S390 version.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
-   Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-static inline int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  int result;
-  __asm__ __volatile__(
-        "       L     %0,%2\n"
-        "       LA    2,%1\n"
-        "0:     LR    0,%0\n"
-        "       AR    0,%3\n"
-        "       CS    %0,0,0(2)\n"
-        "       JL    0b"
-        : "=&d" (result), "=m" (*mem)
-        : "1" (*mem), "d" (val) : "0", "1", "2" );
-  return result;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  __asm__ __volatile__(
-        "       LA    2,%0\n"
-	"0:     L     0,%1\n"
-        "       LR    1,0\n"
-        "       AR    1,%2\n"
-        "       CS    0,1,0(2)\n"
-        "       JL    0b"
-        : "=m" (*mem) : "0" (*mem), "d" (val) : "0", "1", "2" );
-}
-
-static inline int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  int retval;
-
-  __asm__ __volatile__(
-        "  la   1,%1\n"
-        "  lr   0,%2\n"
-        "  cs   0,%3,0(1)\n"
-        "  ipm  %0\n"
-        "  srl  %0,28\n"
-        "0:"
-        : "=&r" (retval), "+m" (*p)
-        : "d" (oldval) , "d" (newval)
-        : "memory", "0", "1", "cc");
-  return !retval;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/backtrace.c libc-20030708/sysdeps/s390/s390-32/backtrace.c
--- glibc-2.3.2/sysdeps/s390/s390-32/backtrace.c	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/backtrace.c	2003-03-28 21:28:18.000000000 +0900
@@ -71,7 +71,7 @@
 	   out of range.  */
 	break;
 
-      array[cnt++] = stack->save_grps[8];
+      array[cnt++] = stack->save_grps[8] & 0x7fffffff;
 
       stack = (struct layout *) stack->back_chain;
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/dl-machine.h libc-20030708/sysdeps/s390/s390-32/dl-machine.h
--- glibc-2.3.2/sysdeps/s390/s390-32/dl-machine.h	2003-01-28 19:27:31.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/dl-machine.h	2003-04-28 23:53:24.000000000 +0900
@@ -424,7 +424,8 @@
 	  *reloc_addr = value + reloc->r_addend;
 	  break;
 
-#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD)
+#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD) \
+    && !defined RESOLVE_CONFLICT_FIND_MAP
 	case R_390_TLS_DTPMOD:
 # ifdef RTLD_BOOTSTRAP
 	  /* During startup the dynamic linker is always the module
@@ -466,6 +467,8 @@
 #endif  /* use TLS */
 
 #ifndef RTLD_BOOTSTRAP
+# ifndef RESOLVE_CONFLICT_FIND_MAP
+	/* Not needed in dl-conflict.c.  */
 	case R_390_COPY:
 	  if (sym == NULL)
 	    /* This can happen in trace mode if an object could not be
@@ -486,6 +489,7 @@
 	  memcpy (reloc_addr, (void *) value, MIN (sym->st_size,
 						   refsym->st_size));
 	  break;
+# endif
 	case R_390_32:
 	  *reloc_addr = value + reloc->r_addend;
 	  break;
@@ -495,6 +499,7 @@
 	case R_390_8:
 	  *(char *) reloc_addr = value + reloc->r_addend;
 	  break;
+# ifndef RESOLVE_CONFLICT_FIND_MAP
 	case R_390_PC32:
 	  *reloc_addr = value + reloc->r_addend - (Elf32_Addr) reloc_addr;
 	  break;
@@ -509,6 +514,7 @@
 	  break;
 	case R_390_NONE:
 	  break;
+# endif
 #endif
 #if !defined(RTLD_BOOTSTRAP) || defined(_NDEBUG)
 	default:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/elf/start.S libc-20030708/sysdeps/s390/s390-32/elf/start.S
--- glibc-2.3.2/sysdeps/s390/s390-32/elf/start.S	2002-12-10 12:41:54.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/elf/start.S	2003-07-08 22:58:13.000000000 +0900
@@ -1,5 +1,5 @@
 /* Startup code compliant to the ELF s390 ABI.
-   Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
    This file is part of the GNU C Library.
 
@@ -66,19 +66,35 @@
 	l       %r6,.L2-.Llit(%r13)     # load pointer to __libc_csu_fini
 	l       %r5,.L1-.Llit(%r13)     # load pointer to __libc_csu_init
 	l       %r2,.L3-.Llit(%r13)     # load pointer to main
+	l       %r1,.L4-.Llit(%r13)	# load pointer to __libc_start_main
+#ifdef PIC
+	l       %r12,.L5-.Llit(%r13)    # load .got pointer
+	la	%r6,0(%r13,%r6)
+	la	%r5,0(%r13,%r5)
+	la	%r2,0(%r13,%r2)
+	la	%r1,0(%r13,%r1)
+	la	%r12,0(%r13,%r12)
+#endif
 
 	/* ok, now branch to the libc main routine */
-	l       %r1,.L4-.Llit(%r13)
 	basr    %r14,%r1
 
 	/* crash if __libc_start_main returns */
 	.word   0
 
 .Llit:
+#ifndef PIC
 .L1:    .long  __libc_csu_init
 .L2:    .long  __libc_csu_fini
 .L3:    .long  main
 .L4:    .long  __libc_start_main
+#else
+.L1:    .long  __libc_csu_init-.Llit
+.L2:    .long  __libc_csu_fini-.Llit
+.L3:    .long  main-.Llit
+.L4:    .long  __libc_start_main@plt-.Llit
+.L5:    .long  _GLOBAL_OFFSET_TABLE_-.Llit
+#endif
 
 /* FIXME: FPU flags or what ?!? */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/memchr.S libc-20030708/sysdeps/s390/s390-32/memchr.S
--- glibc-2.3.2/sysdeps/s390/s390-32/memchr.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/memchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Search a character in a block of memory.  For IBM S390
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
@@ -39,3 +39,4 @@
 	slr   %r2,%r2
 1:      br    %r14
 END(memchr)
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/memcpy.S libc-20030708/sysdeps/s390/s390-32/memcpy.S
--- glibc-2.3.2/sysdeps/s390/s390-32/memcpy.S	2001-08-03 08:39:44.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* memcpy - copy a block from source to destination.  S/390 version.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
@@ -56,4 +56,4 @@
 	lr      %r2,%r1             # return destination address
 	br	%r14
 END(memcpy)
-	
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/memset.S libc-20030708/sysdeps/s390/s390-32/memset.S
--- glibc-2.3.2/sysdeps/s390/s390-32/memset.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Set a block of memory to some byte value.  For IBM S390
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
@@ -42,3 +42,4 @@
 .L1:
 	br      %r14
 END(memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/strcmp.S libc-20030708/sysdeps/s390/s390-32/strcmp.S
--- glibc-2.3.2/sysdeps/s390/s390-32/strcmp.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/strcmp.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,6 +1,6 @@
 /* strcmp - compare two string.  S/390 version.
    This file is part of the GNU C Library.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -39,3 +39,4 @@
 2:	lhi   %r2,-1
 	br    %r14
 END(strcmp)
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/strcpy.S libc-20030708/sysdeps/s390/s390-32/strcpy.S
--- glibc-2.3.2/sysdeps/s390/s390-32/strcpy.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/strcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,6 +1,6 @@
 /* strcpy - copy a string from source to destination. For IBM S390
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -34,3 +34,4 @@
 	jo    0b
 	br    %r14
 END(strcpy)
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/strncpy.S libc-20030708/sysdeps/s390/s390-32/strncpy.S
--- glibc-2.3.2/sysdeps/s390/s390-32/strncpy.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/strncpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,7 +1,7 @@
 /* strncpy - copy at most n characters from a string from source to
    destination.  For IBM S390
    This file is part of the GNU C Library.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -77,3 +77,4 @@
 .Lexit: l     %r2,24(%r15)          # return dst pointer
 	br    %r14
 END(strncpy)
+libc_hidden_builtin_def (strncpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-32/sysdep.h libc-20030708/sysdeps/s390/s390-32/sysdep.h
--- glibc-2.3.2/sysdeps/s390/s390-32/sysdep.h	2003-01-14 10:04:15.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-32/sysdep.h	2003-03-07 19:06:56.000000000 +0900
@@ -111,7 +111,7 @@
 
 /* Local label name for asm code. */
 #ifndef L
-#define L(name)		name
+#define L(name)		.L##name
 #endif
 
 #endif	/* __ASSEMBLER__ */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/atomicity.h libc-20030708/sysdeps/s390/s390-64/atomicity.h
--- glibc-2.3.2/sysdeps/s390/s390-64/atomicity.h	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,76 +0,0 @@
-/* Low-level functions for atomic operations.  64 bit S/390 version.
-   Copyright (C) 2001 Free Software Foundation, Inc.
-   Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-static inline int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  int result;
-  __asm__ __volatile__(
-        "       L     %0,%2\n"
-        "       LA    2,%1\n"
-        "0:     LR    0,%0\n"
-        "       AR    0,%3\n"
-        "       CS    %0,0,0(2)\n"
-        "       JL    0b"
-        : "=&d" (result), "=m" (*mem)
-        : "1" (*mem), "d" (val) : "0", "1", "2" );
-  return result;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  __asm__ __volatile__(
-        "       LA    2,%0\n"
-	"0:     L     0,%1\n"
-        "       LR    1,0\n"
-        "       AR    1,%2\n"
-        "       CS    0,1,0(2)\n"
-        "       JL    0b"
-        : "=m" (*mem) : "0" (*mem), "d" (val) : "0", "1", "2" );
-}
-
-static inline int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  int retval;
-
-  __asm__ __volatile__(
-        "  la   1,%1\n"
-        "  lgr  0,%2\n"
-        "  csg  0,%3,0(1)\n"
-        "  ipm  %0\n"
-        "  srl  %0,28\n"
-        "0:"
-        : "=&r" (retval), "+m" (*p)
-        : "d" (oldval) , "d" (newval)
-        : "memory", "0", "1", "cc");
-  return !retval;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/backtrace.c libc-20030708/sysdeps/s390/s390-64/backtrace.c
--- glibc-2.3.2/sysdeps/s390/s390-64/backtrace.c	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/backtrace.c	2003-05-10 13:38:05.000000000 +0900
@@ -70,7 +70,7 @@
 	   out of range.  */
 	break;
 
-      array[cnt++] = stack->save_grps[8];
+      array[cnt++] = (void *) stack->save_grps[8];
 
       stack = (struct layout *) stack->back_chain;
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/dl-machine.h libc-20030708/sysdeps/s390/s390-64/dl-machine.h
--- glibc-2.3.2/sysdeps/s390/s390-64/dl-machine.h	2003-01-28 19:28:21.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/dl-machine.h	2003-04-28 23:53:24.000000000 +0900
@@ -392,7 +392,8 @@
 	  *reloc_addr = value + reloc->r_addend;
 	  break;
 
-#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD)
+#if defined USE_TLS && (!defined RTLD_BOOTSTRAP || USE___THREAD) \
+    && !defined RESOLVE_CONFLICT_FIND_MAP
 	case R_390_TLS_DTPMOD:
 # ifdef RTLD_BOOTSTRAP
 	  /* During startup the dynamic linker is always the module
@@ -434,6 +435,8 @@
 #endif  /* use TLS */
 
 #ifndef RTLD_BOOTSTRAP
+# ifndef RESOLVE_CONFLICT_FIND_MAP
+	/* Not needed for dl-conflict.c.  */
 	case R_390_COPY:
 	  if (sym == NULL)
 	    /* This can happen in trace mode if an object could not be
@@ -454,6 +457,7 @@
 	  memcpy (reloc_addr, (void *) value, MIN (sym->st_size,
 						   refsym->st_size));
 	  break;
+# endif
 	case R_390_64:
 	  *reloc_addr = value + reloc->r_addend;
 	  break;
@@ -466,6 +470,7 @@
 	case R_390_8:
 	  *(char *) reloc_addr = value + reloc->r_addend;
 	  break;
+# ifndef RESOLVE_CONFLICT_FIND_MAP
 	case R_390_PC64:
 	  *reloc_addr = value +reloc->r_addend - (Elf64_Addr) reloc_addr;
 	  break;
@@ -489,6 +494,7 @@
 	  break;
 	case R_390_NONE:
 	  break;
+# endif
 #endif
 #if !defined(RTLD_BOOTSTRAP) || defined(_NDEBUG)
 	default:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/elf/start.S libc-20030708/sysdeps/s390/s390-64/elf/start.S
--- glibc-2.3.2/sysdeps/s390/s390-64/elf/start.S	2002-12-10 12:41:54.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/elf/start.S	2003-07-08 22:58:13.000000000 +0900
@@ -1,5 +1,5 @@
 /* Startup code compliant to the 64 bit S/390 ELF ABI.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
    This file is part of the GNU C Library.
 
@@ -64,7 +64,11 @@
 	larl	%r2,main		# load pointer to main
 
 	/* Ok, now branch to the libc main routine.  */
+#ifdef PIC
+	brasl	%r14,__libc_start_main@plt
+#else
 	brasl	%r14,__libc_start_main
+#endif
 
 	/* Crash if __libc_start_main returns.	*/
 	.word	0
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/memchr.S libc-20030708/sysdeps/s390/s390-64/memchr.S
--- glibc-2.3.2/sysdeps/s390/s390-64/memchr.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/memchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Search a character in a block of memory.  64 bit S/390 version.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
    This file is part of the GNU C Library.
 
@@ -38,3 +38,4 @@
 	slgr  %r2,%r2
 1:	br    %r14
 END(memchr)
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/memcpy.S libc-20030708/sysdeps/s390/s390-64/memcpy.S
--- glibc-2.3.2/sysdeps/s390/s390-64/memcpy.S	2001-08-03 08:39:44.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* memcpy - copy a block from source to destination.  64 bit S/390 version.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
@@ -55,4 +55,4 @@
 	lgr     %r2,%r1             # return destination address
 	br	%r14
 END(memcpy)
-	
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/memset.S libc-20030708/sysdeps/s390/s390-64/memset.S
--- glibc-2.3.2/sysdeps/s390/s390-64/memset.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Set a block of memory to some byte value.  64 bit S/390 version.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
    This file is part of the GNU C Library.
 
@@ -41,3 +41,4 @@
 .L1:
 	br	%r14
 END(memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/strcmp.S libc-20030708/sysdeps/s390/s390-64/strcmp.S
--- glibc-2.3.2/sysdeps/s390/s390-64/strcmp.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/strcmp.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,6 +1,6 @@
 /* strcmp - compare two string.  64 bit S/390 version.
    This file is part of the GNU C Library.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -39,3 +39,4 @@
 2:	lghi  %r2,-1
 	br    %r14
 END(strcmp)
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/strcpy.S libc-20030708/sysdeps/s390/s390-64/strcpy.S
--- glibc-2.3.2/sysdeps/s390/s390-64/strcpy.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/strcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* strcpy - copy a string from source to destination.  64 bit S/390 version.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
    This file is part of the GNU C Library.
 
@@ -33,3 +33,4 @@
 	jo    0b
 	br    %r14
 END(strcpy)
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/strncpy.S libc-20030708/sysdeps/s390/s390-64/strncpy.S
--- glibc-2.3.2/sysdeps/s390/s390-64/strncpy.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/strncpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,6 +1,6 @@
 /* strncpy - copy at most n characters from a string from source to
    destination.  64 bit S/390 version
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
    This file is part of the GNU C Library.
 
@@ -88,3 +88,4 @@
 .Lexit: lg    %r2,48(%r15)	    # return dst pointer
 	br    %r14
 END(strncpy)
+libc_hidden_builtin_def (strncpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/s390/s390-64/sysdep.h libc-20030708/sysdeps/s390/s390-64/sysdep.h
--- glibc-2.3.2/sysdeps/s390/s390-64/sysdep.h	2003-01-14 10:04:15.000000000 +0900
+++ libc-20030708/sysdeps/s390/s390-64/sysdep.h	2003-03-07 19:06:55.000000000 +0900
@@ -66,7 +66,7 @@
 #else
 #define CALL_MCOUNT \
   lgr 0,14 ; larl 1,0f ; brasl 14,_mcount ; lgr 14,0 ; \
-  .data ; .align 4 ; 0: .long 0 ; .text ; 
+  .data ; .align 4 ; 0: .long 0 ; .text ;
 #endif
 #else
 #define CALL_MCOUNT		/* Do nothing.  */
@@ -104,8 +104,7 @@
 
 /* Local label name for asm code. */
 #ifndef L
-#define L(name)		name
+#define L(name)		.L##name
 #endif
 
 #endif	/* __ASSEMBLER__ */
-
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sh/bits/setjmp.h libc-20030708/sysdeps/sh/bits/setjmp.h
--- glibc-2.3.2/sysdeps/sh/bits/setjmp.h	2002-11-06 09:40:03.000000000 +0900
+++ libc-20030708/sysdeps/sh/bits/setjmp.h	2003-04-15 23:55:49.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,8 +17,10 @@
    02111-1307 USA.  */
 
 /* Define the machine-dependent type `jmp_buf'.  SH version. */
+#ifndef _BITS_SETJMP_H
+#define _BITS_SETJMP_H  1
 
-#ifndef _SETJMP_H
+#if !defined _SETJMP_H && !defined _PTHREAD_H
 # error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
 #endif
 
@@ -43,10 +45,12 @@
 #endif
 
 #if defined __USE_MISC || defined _ASM
-#define JB_SIZE		(4 * 15)
+# define JB_SIZE		(4 * 15)
 #endif
 
 /* Test if longjmp to JMPBUF would unwind the frame
    containing a local variable at ADDRESS.  */
 #define _JMPBUF_UNWINDS(jmpbuf, address) \
   ((void *) (address) < &(jmpbuf)[0].__regs[7])
+
+#endif  /* bits/setjmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sh/memcpy.S libc-20030708/sysdeps/sh/memcpy.S
--- glibc-2.3.2/sysdeps/sh/memcpy.S	2003-01-03 18:53:33.000000000 +0900
+++ libc-20030708/sysdeps/sh/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Kazumoto Kojima <kkojima@rr.iij4u.or.jp>
    Optimized by Toshiyasu Morita <toshiyasu.morita@hsa.hitachi.com>
@@ -197,3 +197,4 @@
 	rts
 	mov	r3,r0		/* Return destination.  */
 END(memcpy)
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sh/memset.S libc-20030708/sysdeps/sh/memset.S
--- glibc-2.3.2/sysdeps/sh/memset.S	2003-01-03 18:53:33.000000000 +0900
+++ libc-20030708/sysdeps/sh/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Kazumoto Kojima <kkojima@rr.iij4u.or.jp>
    Optimized by Toshiyasu Morita <toshiyasu.morita@hsa.hitachi.com>
@@ -85,3 +85,4 @@
 	rts
 	mov	r7,r0
 END(memset)
+libc_hidden_builtin_def (memset)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sh/sh4/fpu/libm-test-ulps libc-20030708/sysdeps/sh/sh4/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/sh/sh4/fpu/libm-test-ulps	2001-04-22 13:53:11.000000000 +0900
+++ libc-20030708/sysdeps/sh/sh4/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -145,7 +145,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.7 + 1.2 i) == 1.3848657645312111080 - 0.97242170335830028619 i":
@@ -156,10 +156,10 @@
 idouble: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.7 + 1.2 i) == 0.4548202223691477654 + 0.7070296600921537682 i":
@@ -198,7 +198,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -291,7 +291,7 @@
 ifloat: 1
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.7 + 1.2 i) == 0.27487868678117583582 + 1.1698665727426565139 i":
@@ -318,7 +318,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Real part of: ctan (0.7 + 1.2 i) == 0.1720734197630349001 + 0.9544807059989405538 i":
@@ -331,7 +331,7 @@
 ifloat: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -520,12 +520,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -615,7 +615,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sh/strlen.S libc-20030708/sysdeps/sh/strlen.S
--- glibc-2.3.2/sysdeps/sh/strlen.S	2001-07-08 04:21:28.000000000 +0900
+++ libc-20030708/sysdeps/sh/strlen.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Kazumoto Kojima <kkojima@rr.iij4u.or.jp>
 
@@ -82,3 +82,4 @@
 	rts
 	mov	r2, r0
 END(strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/atomicity.h libc-20030708/sysdeps/sparc/sparc32/atomicity.h
--- glibc-2.3.2/sysdeps/sparc/sparc32/atomicity.h	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/atomicity.h	2003-04-01 21:01:04.000000000 +0900
@@ -1,98 +0,0 @@
-/* Low-level functions for atomic operations.  Sparc32 version.
-   Copyright (C) 1999 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-static int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  static unsigned char lock;
-  int result, tmp;
-
-  __asm__ __volatile__("1:	ldstub	[%1], %0\n\t"
-		       "	cmp	%0, 0\n\t"
-		       "	bne	1b\n\t"
-		       "	 nop"
-		       : "=&r" (tmp)
-		       : "r" (&lock)
-		       : "memory");
-  result = *mem;
-  *mem += val;
-  __asm__ __volatile__("stb	%%g0, [%0]"
-		       : /* no outputs */
-		       : "r" (&lock)
-		       : "memory");
-  return result;
-}
-
-static void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  static unsigned char lock;
-  int tmp;
-
-  __asm__ __volatile__("1:	ldstub	[%1], %0\n\t"
-		       "	cmp	%0, 0\n\t"
-		       "	bne	1b\n\t"
-		       "	 nop"
-		       : "=&r" (tmp)
-		       : "r" (&lock)
-		       : "memory");
-  *mem += val;
-  __asm__ __volatile__("stb	%%g0, [%0]"
-		       : /* no outputs */
-		       : "r" (&lock)
-		       : "memory");
-}
-
-static int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  static unsigned char lock;
-  int ret, tmp;
-
-  __asm__ __volatile__("1:	ldstub	[%1], %0\n\t"
-		       "	cmp	%0, 0\n\t"
-		       "	bne	1b\n\t"
-		       "	 nop"
-		       : "=&r" (tmp)
-		       : "r" (&lock)
-		       : "memory");
-  if (*p != oldval)
-    ret = 0;
-  else
-    {
-      *p = newval;
-      ret = 1;
-    }
-  __asm__ __volatile__("stb	%%g0, [%0]"
-		       : /* no outputs */
-		       : "r" (&lock)
-		       : "memory");
-
-  return ret;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/bits/atomic.h libc-20030708/sysdeps/sparc/sparc32/bits/atomic.h
--- glibc-2.3.2/sysdeps/sparc/sparc32/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/bits/atomic.h	2003-03-31 08:36:39.000000000 +0900
@@ -0,0 +1,75 @@
+/* Atomic operations.  sparc32 version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Jakub Jelinek <jakub@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _BITS_ATOMIC_H
+#define _BITS_ATOMIC_H	1
+
+/* We have no compare and swap, just test and set.
+   The following implementation contends on one single global lock
+   per library and assumes no variable will be accessed using atomic.h
+   macros from two different libraries.  */
+
+volatile unsigned char __sparc32_atomic_lock
+  __attribute__ ((nocommon, section (".gnu.linkonce.b.__sparc32_atomic_lock"),
+		  visibility ("hidden")));
+
+#define __sparc32_atomic_do_lock() \
+  do								      \
+    {								      \
+      unsigned int __old_lock;					      \
+      do							      \
+	__asm ("ldstub %1, %0"					      \
+	       : "=r" (__old_lock), "=m" (__sparc32_atomic_lock)      \
+	       : "m" (__sparc32_atomic_lock));			      \
+      while (__old_lock);					      \
+    }								      \
+  while (0)
+
+#define __sparc32_atomic_do_unlock() \
+  do __sparc32_atomic_lock = 0; while (0)
+
+/* The only basic operation needed is compare and exchange.  */
+#define atomic_compare_and_exchange_val_acq(mem, newval, oldval) \
+  ({ __typeof (mem) __acev_memp = (mem);			      \
+     __typeof (*mem) __acev_ret;				      \
+     __typeof (*mem) __acev_newval = (newval);			      \
+								      \
+     __sparc32_atomic_do_lock ();				      \
+     __acev_ret = *__acev_memp;					      \
+     if (__acev_ret == (oldval))				      \
+       *__acev_memp = __acev_newval;				      \
+     __sparc32_atomic_do_unlock ();				      \
+     __acev_ret; })
+
+#define atomic_compare_and_exchange_bool_acq(mem, newval, oldval) \
+  ({ __typeof (mem) __aceb_memp = (mem);			      \
+     int __aceb_ret;						      \
+     __typeof (*mem) __aceb_newval = (newval);			      \
+								      \
+     __sparc32_atomic_do_lock ();				      \
+     __aceb_ret = 0;						      \
+     if (*__aceb_memp == (oldval))				      \
+       *__aceb_memp = __aceb_newval;				      \
+     else							      \
+       __aceb_ret = 1;						      \
+     __sparc32_atomic_do_unlock ();				      \
+     __aceb_ret; })
+
+#endif	/* bits/atomic.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/fpu/libm-test-ulps libc-20030708/sysdeps/sparc/sparc32/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/sparc/sparc32/fpu/libm-test-ulps	2002-09-18 01:46:01.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/fpu/libm-test-ulps	2003-03-23 09:52:09.000000000 +0900
@@ -94,7 +94,7 @@
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
@@ -107,10 +107,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
 Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
@@ -145,7 +145,7 @@
 Test "Imaginary part of: clog10 (-0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -239,7 +239,7 @@
 ifloat: 2
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
@@ -258,7 +258,7 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
@@ -266,7 +266,7 @@
 idouble: 1
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -453,12 +453,12 @@
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -513,7 +513,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/memchr.S libc-20030708/sysdeps/sparc/sparc32/memchr.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/memchr.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/memchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -144,3 +144,4 @@
 #if !__BOUNDED_POINTERS__
 weak_alias (__memchr, __ubp_memchr)
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/memcpy.S libc-20030708/sysdeps/sparc/sparc32/memcpy.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/memcpy.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -966,3 +966,5 @@
 110:	retl
 	 sub		%o7, %g6, %o5
 END(memcpy)
+libc_hidden_builtin_def (memcpy)
+libc_hidden_builtin_def (memmove)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/memset.S libc-20030708/sysdeps/sparc/sparc32/memset.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/memset.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,6 +1,6 @@
 /* Set a block of memory to some byte value.
    For SPARC v7.
-   Copyright (C) 1996, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David S. Miller <davem@caip.rutgers.edu> and
                   Jakub Jelinek <jj@ultra.linux.cz>.
@@ -150,5 +150,6 @@
 0:	retl
 	 nop
 END(memset)
+libc_hidden_builtin_def (memset)
 
 weak_alias(__bzero, bzero)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/sparcv9/atomicity.h libc-20030708/sysdeps/sparc/sparc32/sparcv9/atomicity.h
--- glibc-2.3.2/sysdeps/sparc/sparc32/sparcv9/atomicity.h	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/sparcv9/atomicity.h	2003-04-01 21:01:04.000000000 +0900
@@ -1,82 +0,0 @@
-/* Low-level functions for atomic operations.  Sparc32+v9 version.
-   Copyright (C) 1999 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-static inline int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  uint32_t tmp1, tmp2;
-
-  __asm__ __volatile__("1:	lduw	[%2], %0\n\t"
-		       "	add	%0, %3, %1\n\t"
-		       "	cas	[%2], %0, %1\n\t"
-		       "	sub	%0, %1, %0\n\t"
-		       "	brnz,pn	%0, 1b\n\t"
-		       "	 nop"
-		       : "=&r" (tmp1), "=&r" (tmp2)
-		       : "r" (mem), "r" (val)
-		       : "memory");
-  return tmp2;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  uint32_t tmp1, tmp2;
-
-  __asm__ __volatile__("1:	lduw	[%2], %0\n\t"
-		       "	add	%0, %3, %1\n\t"
-		       "	cas	[%2], %0, %1\n\t"
-		       "	sub	%0, %1, %0\n\t"
-		       "	brnz,pn	%0, 1b\n\t"
-		       "	 nop"
-		       : "=&r" (tmp1), "=&r" (tmp2)
-		       : "r" (mem), "r" (val)
-		       : "memory");
-}
-
-static inline int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  register long int tmp, tmp2;
-
-  __asm__ __volatile__("1:	lduw	[%4], %0\n\t"
-		       "	mov	%2, %1\n\t"
-		       "	cmp	%0, %3\n\t"
-		       "	bne,a,pn %%xcc, 2f\n\t"
-		       "	 mov	0, %0\n\t"
-		       "	cas	[%4], %0, %1\n\t"
-		       "	sub	%0, %1, %0\n\t"
-		       "	brnz,pn	%0, 1b\n\t"
-		       "	 mov	1, %0\n\t"
-		       "2:"
-		       : "=&r" (tmp), "=&r" (tmp2)
-		       : "r" (newval), "r" (oldval), "r" (p)
-		       : "memory");
-  return tmp;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/sparcv9/bits/atomic.h libc-20030708/sysdeps/sparc/sparc32/sparcv9/bits/atomic.h
--- glibc-2.3.2/sysdeps/sparc/sparc32/sparcv9/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/sparcv9/bits/atomic.h	2003-05-12 01:30:12.000000000 +0900
@@ -0,0 +1,88 @@
+/* Atomic operations.  sparcv9 version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Jakub Jelinek <jakub@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+({									      \
+  __typeof (*(mem)) __acev_tmp;						      \
+  __typeof (mem) __acev_mem = (mem);					      \
+  __asm __volatile ("cas [%4], %2, %0"					      \
+		    : "=r" (__acev_tmp), "=m" (*__acev_mem)		      \
+		    : "r" (oldval), "m" (*__acev_mem), "r" (__acev_mem),      \
+		      "0" (newval));					      \
+  __acev_tmp; })
+
+/* This can be implemented if needed.  */
+#define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define atomic_exchange_acq(mem, newvalue) \
+  ({ __typeof (*(mem)) __oldval;					      \
+     __typeof (mem) __memp = (mem);					      \
+     __typeof (*(mem)) __value = (newvalue);				      \
+									      \
+     if (sizeof (*(mem)) == 4)						      \
+       __asm ("swap %0, %1"						      \
+	      : "=m" (*__memp), "=r" (__oldval)				      \
+	      : "m" (*__memp), "1" (__value));				      \
+     else								      \
+       abort ();							      \
+     __oldval; })
+
+#define atomic_full_barrier() \
+  __asm __volatile ("membar #LoadLoad | #LoadStore"			      \
+			  " | #StoreLoad | #StoreStore" : : : "memory")
+#define atomic_read_barrier() \
+  __asm __volatile ("membar #LoadLoad | #LoadStore" : : : "memory")
+#define atomic_write_barrier() \
+  __asm __volatile ("membar #StoreLoad | #StoreStore" : : : "memory")
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/strcat.S libc-20030708/sysdeps/sparc/sparc32/strcat.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/strcat.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/strcat.S	2003-05-02 00:11:52.000000000 +0900
@@ -346,3 +346,4 @@
 	retl
 	 mov		%g2, %o0
 END(strcat)
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/strchr.S libc-20030708/sysdeps/sparc/sparc32/strchr.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/strchr.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/strchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -280,3 +280,5 @@
 
 weak_alias(strchr, index)
 weak_alias(strrchr, rindex)
+libc_hidden_builtin_def (strchr)
+libc_hidden_builtin_def (strrchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/strcmp.S libc-20030708/sysdeps/sparc/sparc32/strcmp.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/strcmp.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/strcmp.S	2003-05-02 00:11:52.000000000 +0900
@@ -255,3 +255,4 @@
 	jmpl		%i7 + 8, %g0
 	 restore	%g4, %g0, %o0
 END(strcmp)
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/strcpy.S libc-20030708/sysdeps/sparc/sparc32/strcpy.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/strcpy.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/strcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -272,3 +272,4 @@
 	retl
 	 mov		%g2, %o0
 END(strcpy)
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc32/strlen.S libc-20030708/sysdeps/sparc/sparc32/strlen.S
--- glibc-2.3.2/sysdeps/sparc/sparc32/strlen.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc32/strlen.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,6 +1,6 @@
 /* Determine the length of a string.
    For SPARC v7.
-   Copyright (C) 1996, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jj@ultra.linux.cz>.
 
@@ -101,3 +101,4 @@
 13:	retl
 	 sub		%o4, %o1, %o0
 END(strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/atomicity.h libc-20030708/sysdeps/sparc/sparc64/atomicity.h
--- glibc-2.3.2/sysdeps/sparc/sparc64/atomicity.h	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/atomicity.h	2003-04-01 21:01:04.000000000 +0900
@@ -1,82 +0,0 @@
-/* Low-level functions for atomic operations.  Sparc64 version.
-   Copyright (C) 1999 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-static inline int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  uint32_t tmp1, tmp2;
-
-  __asm__ __volatile__("1:	lduw	[%2], %0\n\t"
-		       "	add	%0, %3, %1\n\t"
-		       "	cas	[%2], %0, %1\n\t"
-		       "	sub	%0, %1, %0\n\t"
-		       "	brnz,pn	%0, 1b\n\t"
-		       "	 nop"
-		       : "=&r" (tmp1), "=&r" (tmp2)
-		       : "r" (mem), "r" (val)
-		       : "memory");
-  return tmp2;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  uint32_t tmp1, tmp2;
-
-  __asm__ __volatile__("1:	lduw	[%2], %0\n\t"
-		       "	add	%0, %3, %1\n\t"
-		       "	cas	[%2], %0, %1\n\t"
-		       "	sub	%0, %1, %0\n\t"
-		       "	brnz,pn	%0, 1b\n\t"
-		       "	 nop"
-		       : "=&r" (tmp1), "=&r" (tmp2)
-		       : "r" (mem), "r" (val)
-		       : "memory");
-}
-
-static inline int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  register long int tmp, tmp2;
-
-  __asm__ __volatile__("1:	ldx	[%4], %0\n\t"
-		       "	mov	%2, %1\n\t"
-		       "	cmp	%0, %3\n\t"
-		       "	bne,a,pn %%xcc, 2f\n\t"
-		       "	 mov	0, %0\n\t"
-		       "	casx	[%4], %0, %1\n\t"
-		       "	sub	%0, %1, %0\n\t"
-		       "	brnz,pn	%0, 1b\n\t"
-		       "	 mov	1, %0\n\t"
-		       "2:"
-		       : "=&r" (tmp), "=&r" (tmp2)
-		       : "r" (newval), "r" (oldval), "r" (p)
-		       : "memory");
-  return tmp;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/bits/atomic.h libc-20030708/sysdeps/sparc/sparc64/bits/atomic.h
--- glibc-2.3.2/sysdeps/sparc/sparc64/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/bits/atomic.h	2003-05-12 01:30:12.000000000 +0900
@@ -0,0 +1,103 @@
+/* Atomic operations.  sparc64 version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Jakub Jelinek <jakub@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+({									      \
+  __typeof (*(mem)) __acev_tmp;						      \
+  __typeof (mem) __acev_mem = (mem);					      \
+  __asm __volatile ("cas [%4], %2, %0"					      \
+		    : "=r" (__acev_tmp), "=m" (*__acev_mem)		      \
+		    : "r" (oldval), "m" (*__acev_mem), "r" (__acev_mem),      \
+		      "0" (newval));					      \
+  __acev_tmp; })
+
+#define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+({									      \
+  __typeof (*(mem)) __acev_tmp;						      \
+  __typeof (mem) __acev_mem = (mem);					      \
+  __asm __volatile ("casx [%4], %2, %0"					      \
+		    : "=r" (__acev_tmp), "=m" (*__acev_mem)		      \
+		    : "r" ((long) (oldval)), "m" (*__acev_mem),		      \
+		      "r" (__acev_mem), "0" ((long) (newval)));		      \
+  __acev_tmp; })
+
+#define atomic_exchange_acq(mem, newvalue) \
+  ({ __typeof (*(mem)) __oldval, __val;					      \
+     __typeof (mem) __memp = (mem);					      \
+     __typeof (*(mem)) __value = (newvalue);				      \
+									      \
+     if (sizeof (*(mem)) == 4)						      \
+       __asm ("swap %0, %1"						      \
+	      : "=m" (*__memp), "=r" (__oldval)				      \
+	      : "m" (*__memp), "1" (__value));				      \
+     else								      \
+       {								      \
+	 __val = *__memp;						      \
+	 do								      \
+	   {								      \
+	     __oldval = __val;						      \
+	     __val = atomic_compare_and_exchange_val_acq (__memp, __value,    \
+							  __oldval);	      \
+	   }								      \
+         while (__builtin_expect (__val != __oldval, 0));		      \
+       }								      \
+     __oldval; })
+
+#define atomic_full_barrier() \
+  __asm __volatile ("membar #LoadLoad | #LoadStore"			      \
+			  " | #StoreLoad | #StoreStore" : : : "memory")
+#define atomic_read_barrier() \
+  __asm __volatile ("membar #LoadLoad | #LoadStore" : : : "memory")
+#define atomic_write_barrier() \
+  __asm __volatile ("membar #StoreLoad | #StoreStore" : : : "memory")
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/fpu/libm-test-ulps libc-20030708/sysdeps/sparc/sparc64/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/sparc/sparc64/fpu/libm-test-ulps	2001-10-01 08:31:32.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -1,85 +1,31 @@
-
 # Begin of automatic generation
 
-# acos
-Test "acos (0.7) == 0.79539883018414355549096833892476432":
-ldouble:  1
-ildouble:  1
-
-# asin
-Test "asin (-0.5) == -pi/6":
-float: 2
-ifloat: 2
-Test "asin (0.5) == pi/6":
-float: 2
-ifloat: 2
-Test "asin (0.7) == 0.77539749661075306374035335271498708":
-double: 1
-float: 2
-idouble: 1
-ifloat: 2
-
-# atan
-Test "atan (0.7) == 0.61072596438920861654375887649023613":
-ildouble: 1
-ldouble: 1
-
-# atanh
-Test "atanh (0.7) == 0.8673005276940531944":
-double: 1
-idouble: 1
-
 # atan2
-Test "atan2 (0.4, 0.0003) == 1.5700463269355215717704032607580829":
+Test "atan2 (-0.75, -1.0) == -2.49809154479650885165983415456218025":
+float: 3
+ifloat: 3
 ildouble: 1
 ldouble: 1
-Test "atan2 (0.7, 1) == 0.61072596438920861654375887649023613":
+Test "atan2 (0.75, -1.0) == 2.49809154479650885165983415456218025":
+float: 3
+ifloat: 3
 ildouble: 1
 ldouble: 1
-Test "atan2 (-0.7, 1.0) == -0.61072596438920861654375887649023613":
+Test "atan2 (1.390625, 0.9296875) == 0.981498387184244311516296577615519772":
+float: 1
+ifloat: 1
 ildouble: 1
 ldouble: 1
-Test "atan2 (0.7, -1.0) == 2.530866689200584621918884506789267":
-float:  3
-ifloat:  3
-Test "atan2 (-0.7, -1.0) == -2.530866689200584621918884506789267":
-float:  3
-ifloat:  3
-Test "atan2 (1.4, -0.93) == 2.1571487668237843754887415992772736":
-float:  4
-ifloat:  4
 
-# cabs
-Test "cabs (-0.7 + 12.4 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (-0.7 - 12.4 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (-12.4 + 0.7 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (-12.4 - 0.7 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (0.7 + 1.2 i) == 1.3892443989449804508432547041028554":
-double: 1
-idouble: 1
-Test "cabs (0.7 + 12.4 i) == 12.419742348374220601176836866763271":
+# atanh
+Test "atanh (0.75) == 0.972955074527656652552676371721589865":
 float: 1
 ifloat: 1
 
 # cacos
-Test "Real part of: cacos (0.7 + 1.2 i) == 1.1351827477151551088992008271819053 - 1.0927647857577371459105272080819308 i":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "Imaginary part of: cacos (0.7 + 1.2 i) == 1.1351827477151551088992008271819053 - 1.0927647857577371459105272080819308 i":
-float: 1
-ifloat: 1
-ildouble: 3
-ldouble: 3
+Test "Imaginary part of: cacos (0.75 + 1.25 i) == 1.11752014915610270578240049553777969 - 1.13239363160530819522266333696834467 i":
+ildouble: 1
+ldouble: 1
 
 # cacosh
 Test "Real part of: cacosh (-2 - 3 i) == -1.9833870299165354323470769028940395 + 2.1414491111159960199416055713254211 i":
@@ -96,25 +42,16 @@
 ifloat: 3
 ildouble: 1
 ldouble: 1
-Test "Real part of: cacosh (0.7 + 1.2 i) == 1.0927647857577371459105272080819308 + 1.1351827477151551088992008271819053 i":
+
+# casin
+Test "Real part of: casin (0.75 + 1.25 i) == 0.453276177638793913448921196101971749 + 1.13239363160530819522266333696834467 i":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-
-# casin
-Test "Real part of: casin (0.7 + 1.2 i) == 0.4356135790797415103321208644578462 + 1.0927647857577371459105272080819308 i":
-double: 3
-float: 2
-idouble: 3
-ifloat: 2
+Test "Imaginary part of: casin (0.75 + 1.25 i) == 0.453276177638793913448921196101971749 + 1.13239363160530819522266333696834467 i":
 ildouble: 1
 ldouble: 1
-Test "Imaginary part of: casin (0.7 + 1.2 i) == 0.4356135790797415103321208644578462 + 1.0927647857577371459105272080819308 i":
-float: 1
-ifloat: 1
-ildouble: 3
-ldouble: 3
 
 # casinh
 Test "Real part of: casinh (-2 - 3 i) == -1.9686379257930962917886650952454982 - 0.96465850440760279204541105949953237 i":
@@ -131,13 +68,15 @@
 ifloat: 6
 ildouble: 2
 ldouble: 2
-Test "Real part of: casinh (0.7 + 1.2 i) == 0.97865459559367387689317593222160964 + 0.91135418953156011567903546856170941 i":
-double: 1
-idouble: 1
+Test "Real part of: casinh (0.75 + 1.25 i) == 1.03171853444778027336364058631006594 + 0.911738290968487636358489564316731207 i":
+float: 1
+ifloat: 1
 ildouble: 1
 ldouble: 1
-Test "Imaginary part of: casinh (0.7 + 1.2 i) == 0.97865459559367387689317593222160964 + 0.91135418953156011567903546856170941 i":
+Test "Imaginary part of: casinh (0.75 + 1.25 i) == 1.03171853444778027336364058631006594 + 0.911738290968487636358489564316731207 i":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
 ildouble: 1
 ldouble: 1
@@ -151,12 +90,10 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "Real part of: catan (0.7 + 1.2 i) == 1.0785743834118921877443707996386368 + 0.57705737765343067644394541889341712 i":
+Test "Real part of: catan (0.75 + 1.25 i) == 1.10714871779409050301706546017853704 + 0.549306144334054845697622618461262852 i":
 float: 4
 ifloat: 4
-Test "Imaginary part of: catan (0.7 + 1.2 i) == 1.0785743834118921877443707996386368 + 0.57705737765343067644394541889341712 i":
-double: 1
-idouble: 1
+Test "Imaginary part of: catan (0.75 + 1.25 i) == 1.10714871779409050301706546017853704 + 0.549306144334054845697622618461262852 i":
 ildouble: 1
 ldouble: 1
 
@@ -167,49 +104,59 @@
 Test "Imaginary part of: catanh (-2 - 3 i) == -0.14694666622552975204743278515471595 - 1.3389725222944935611241935759091443 i":
 float: 4
 ifloat: 4
-Test "Real part of: catanh (0.7 + 1.2 i) == 0.2600749516525135959200648705635915 + 0.97024030779509898497385130162655963 i":
-float: 1
-ifloat: 1
-Test "Imaginary part of: catanh (0.7 + 1.2 i) == 0.2600749516525135959200648705635915 + 0.97024030779509898497385130162655963 i":
+Test "Real part of: catanh (0.75 + 1.25 i) == 0.261492138795671927078652057366532140 + 0.996825126463918666098902241310446708 i":
 double: 1
-float: 6
 idouble: 1
+ildouble: 1
+ldouble: 1
+Test "Imaginary part of: catanh (0.75 + 1.25 i) == 0.261492138795671927078652057366532140 + 0.996825126463918666098902241310446708 i":
+float: 6
 ifloat: 6
+ildouble: 1
+ldouble: 1
 
 # cbrt
+Test "cbrt (-0.001) == -0.1":
+ildouble: 1
+ldouble: 1
 Test "cbrt (-27.0) == -3.0":
 double: 1
 idouble: 1
-Test "cbrt (0.970299) == 0.99":
+Test "cbrt (0.75) == 0.908560296416069829445605878163630251":
+double: 1
+idouble: 1
+Test "cbrt (0.9921875) == 0.997389022060725270579075195353955217":
 double: 1
 idouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
-Test "Real part of: ccos (0.7 + 1.2 i) == 1.3848657645312111080 - 0.97242170335830028619 i":
-double: 1
-idouble: 1
-Test "Imaginary part of: ccos (0.7 + 1.2 i) == 1.3848657645312111080 - 0.97242170335830028619 i":
+Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
 double: 1
+float: 1
 idouble: 1
+ifloat: 1
+Test "Imaginary part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
+float: 1
+ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Real part of: ccosh (0.7 + 1.2 i) == 0.4548202223691477654 + 0.7070296600921537682 i":
+Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (0.7 + 1.2 i) == 0.4548202223691477654 + 0.7070296600921537682 i":
-double: 1
-idouble: 1
+Test "Imaginary part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
+float: 1
+ifloat: 1
 
 # cexp
 Test "Real part of: cexp (-2.0 - 3.0 i) == -0.13398091492954261346140525546115575 - 0.019098516261135196432576240858800925 i":
@@ -220,23 +167,22 @@
 ifloat: 1
 ildouble: 1
 ldouble: 1
-Test "Real part of: cexp (0.7 + 1.2 i) == 0.72969890915032360123451688642930727 + 1.8768962328348102821139467908203072 i":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "Imaginary part of: cexp (0.7 + 1.2 i) == 0.72969890915032360123451688642930727 + 1.8768962328348102821139467908203072 i":
+Test "Real part of: cexp (0.75 + 1.25 i) == 0.667537446429131586942201977015932112 + 2.00900045494094876258347228145863909 i":
 float: 1
 ifloat: 1
+Test "Imaginary part of: cexp (0.75 + 1.25 i) == 0.667537446429131586942201977015932112 + 2.00900045494094876258347228145863909 i":
 ildouble: 1
 ldouble: 1
 
 # clog
 Test "Imaginary part of: clog (-2 - 3 i) == 1.2824746787307683680267437207826593 - 2.1587989303424641704769327722648368 i":
-double: 1
 float: 3
-idouble: 1
 ifloat: 3
+Test "Real part of: clog (0.75 + 1.25 i) == 0.376885901188190075998919126749298416 + 1.03037682652431246378774332703115153 i":
+float: 1
+ifloat: 1
+ildouble: 1
+ldouble: 1
 
 # clog10
 Test "Imaginary part of: clog10 (-0 + inf i) == inf + pi/2*log10(e) i":
@@ -249,7 +195,7 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -297,14 +243,12 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "Real part of: clog10 (0.7 + 1.2 i) == 0.1427786545038868803 + 0.4528483579352493248 i":
-double: 1
+Test "Real part of: clog10 (0.75 + 1.25 i) == 0.163679467193165171449476605077428975 + 0.447486970040493067069984724340855636 i":
 float: 1
-idouble: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (0.7 + 1.2 i) == 0.1427786545038868803 + 0.4528483579352493248 i":
-double: 1
-idouble: 1
+Test "Imaginary part of: clog10 (0.75 + 1.25 i) == 0.163679467193165171449476605077428975 + 0.447486970040493067069984724340855636 i":
+ildouble: 1
+ldouble: 1
 Test "Imaginary part of: clog10 (3 + inf i) == inf + pi/2*log10(e) i":
 double: 1
 float: 1
@@ -327,16 +271,11 @@
 ifloat: 1
 
 # cos
-Test "cos (0.7) == 0.76484218728448842625585999019186495":
+Test "cos (M_PI_6l * 2.0) == 0.5":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "cos (M_PI_6l * 2.0) == 0.5":
-double: 1
-float: 0.5
-idouble: 1
-ifloat: 0.5
 ildouble: 1
 ldouble: 1
 Test "cos (M_PI_6l * 4.0) == -0.5":
@@ -347,14 +286,40 @@
 ildouble: 1
 ldouble: 1
 Test "cos (pi/2) == 0":
-double: 0.2758
-float: 0.3667
-idouble: 0.2758
-ifloat: 0.3667
-ildouble: 0.2252
-ldouble: 0.2252
+double: 1
+float: 1
+idouble: 1
+ifloat: 1
+ildouble: 1
+ldouble: 1
 
 # cpow
+Test "Real part of: cpow (0.75 + 1.25 i, 0.0 + 1.0 i) == 0.331825439177608832276067945276730566 + 0.131338600281188544930936345230903032 i":
+float: 1
+ifloat: 1
+Test "Imaginary part of: cpow (0.75 + 1.25 i, 0.0 + 1.0 i) == 0.331825439177608832276067945276730566 + 0.131338600281188544930936345230903032 i":
+float: 1
+ifloat: 1
+Test "Real part of: cpow (0.75 + 1.25 i, 0.75 + 1.25 i) == 0.117506293914473555420279832210420483 + 0.346552747708338676483025352060418001 i":
+double: 1
+float: 4
+idouble: 1
+ifloat: 4
+ildouble: 4
+ldouble: 4
+Test "Real part of: cpow (0.75 + 1.25 i, 1.0 + 0.0 i) == 0.75 + 1.25 i":
+ildouble: 2
+ldouble: 2
+Test "Imaginary part of: cpow (0.75 + 1.25 i, 1.0 + 0.0 i) == 0.75 + 1.25 i":
+ildouble: 1
+ldouble: 1
+Test "Real part of: cpow (0.75 + 1.25 i, 1.0 + 1.0 i) == 0.0846958290317209430433805274189191353 + 0.513285749182902449043287190519090481 i":
+double: 2
+float: 3
+idouble: 2
+ifloat: 3
+ildouble: 1
+ldouble: 1
 Test "Real part of: cpow (2 + 0 i, 10 + 0 i) == 1024.0 + 0.0 i":
 ildouble: 2
 ldouble: 2
@@ -369,26 +334,26 @@
 float: 2
 ifloat: 2
 Test "Imaginary part of: cpow (e + 0 i, 0 + 2 * M_PIl i) == 1.0 + 0.0 i":
-double: 1.1031
-float: 1.4668
-idouble: 1.1031
-ifloat: 1.4668
-ildouble: 0.9006
-ldouble: 0.9006
+double: 2
+float: 2
+idouble: 2
+ifloat: 2
+ildouble: 1
+ldouble: 1
 
 # csin
-Test "Imaginary part of: csin (0.7 + 1.2 i) == 1.1664563419657581376 + 1.1544997246948547371 i":
-float: 1
-ifloat: 1
+Test "Real part of: csin (0.75 + 1.25 i) == 1.28722291002649188575873510790565441 + 1.17210635989270256101081285116138863 i":
+ildouble: 1
+ldouble: 1
 
 # csinh
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
-Test "Real part of: csinh (0.7 + 1.2 i) == 0.27487868678117583582 + 1.1698665727426565139 i":
+Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: csinh (0.7 + 1.2 i) == 0.27487868678117583582 + 1.1698665727426565139 i":
+Test "Imaginary part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
 float: 1
 ifloat: 1
 
@@ -403,32 +368,22 @@
 ifloat: 1
 ildouble: 1
 ldouble: 1
-Test "Real part of: csqrt (0.7 + 1.2 i) == 1.022067610030026450706487883081139 + 0.58704531296356521154977678719838035 i":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "Imaginary part of: csqrt (0.7 + 1.2 i) == 1.022067610030026450706487883081139 + 0.58704531296356521154977678719838035 i":
-float: 1
-ifloat: 1
+Test "Imaginary part of: csqrt (0.75 + 1.25 i) == 1.05065169626078392338656675760808326 + 0.594868882070379067881984030639932657 i":
 ildouble: 1
 ldouble: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
-Test "Real part of: ctan (0.7 + 1.2 i) == 0.1720734197630349001 + 0.9544807059989405538 i":
-float: 1
-ifloat: 1
-Test "Imaginary part of: ctan (0.7 + 1.2 i) == 0.1720734197630349001 + 0.9544807059989405538 i":
+Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
+ildouble: 2
+ldouble: 2
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 double: 1
 float: 2
 idouble: 1
@@ -436,34 +391,25 @@
 Test "Imaginary part of: ctanh (0 + pi/4 i) == 0.0 + 1.0 i":
 float: 1
 ifloat: 1
-Test "Real part of: ctanh (0.7 + 1.2 i) == 1.3472197399061191630 + 0.4778641038326365540 i":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "Imaginary part of: ctanh (0.7 + 1.2 i) == 1.3472197399061191630 + 0.4778641038326365540 i":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
+Test "Real part of: ctanh (0.75 + 1.25 i) == 1.37260757053378320258048606571226857 + 0.385795952609750664177596760720790220 i":
+double: 1
+idouble: 1
+
+# erf
+Test "erf (1.25) == 0.922900128256458230136523481197281140":
+double: 1
+idouble: 1
 
 # erfc
-Test "erfc (0.7) == 0.32219880616258152702":
+Test "erfc (2.0) == 0.00467773498104726583793074363274707139":
 double: 1
 idouble: 1
-Test "erfc (1.2) == 0.089686021770364619762":
-double: 2
-float: 2
-idouble: 2
-ifloat: 2
-Test "erfc (2.0) == 0.0046777349810472658379":
+Test "erfc (27.0) == 0.523704892378925568501606768284954709e-318":
+ildouble: 1
+ldouble: 1
+Test "erfc (4.125) == 0.542340079956506600531223408575531062e-8":
 double: 1
 idouble: 1
-Test "erfc (4.1) == 0.67000276540848983727e-8":
-double: 24
-float: 12
-idouble: 24
-ifloat: 12
 
 # exp10
 Test "exp10 (-1) == 0.1":
@@ -471,11 +417,11 @@
 float: 1
 idouble: 2
 ifloat: 1
-Test "exp10 (0.7) == 5.0118723362727228500155418688494574":
+Test "exp10 (0.75) == 5.62341325190349080394951039776481231":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
-ildouble: 1
-ldouble: 1
 Test "exp10 (3) == 1000":
 double: 6
 float: 2
@@ -485,44 +431,21 @@
 ldouble: 1
 
 # expm1
+Test "expm1 (0.75) == 1.11700001661267466854536981983709561":
+double: 1
+idouble: 1
 Test "expm1 (1) == M_El - 1.0":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-ildouble:  1
-ldouble:  1
-
+ildouble: 1
+ldouble: 1
 
-# fmod
-Test "fmod (-6.5, -2.3) == -1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-ildouble: 2
-ldouble: 2
-Test "fmod (-6.5, 2.3) == -1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-ildouble: 2
-ldouble: 2
-Test "fmod (6.5, -2.3) == 1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-ildouble: 2
-ldouble: 2
-Test "fmod (6.5, 2.3) == 1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-ildouble: 2
-ldouble: 2
+# gamma
+Test "gamma (-0.5) == log(2*sqrt(pi))":
+ildouble: 1
+ldouble: 1
 
 # hypot
 Test "hypot (-0.7, -12.4) == 12.419742348374220601176836866763271":
@@ -540,9 +463,6 @@
 Test "hypot (0.7, -12.4) == 12.419742348374220601176836866763271":
 float: 1
 ifloat: 1
-Test "hypot (0.7, 1.2) == 1.3892443989449804508432547041028554":
-double: 1
-idouble: 1
 Test "hypot (0.7, 12.4) == 12.419742348374220601176836866763271":
 float: 1
 ifloat: 1
@@ -554,161 +474,213 @@
 ifloat: 1
 
 # j0
-Test "j0 (10.0) == -0.24593576445134833520":
+Test "j0 (-4.0) == -3.9714980986384737228659076845169804197562E-1":
+double: 1
+float: 1
+idouble: 1
+ifloat: 1
+Test "j0 (0.75) == 0.864242275166648623555731103820923211":
+float: 1
+ifloat: 1
+Test "j0 (10.0) == -0.245935764451348335197760862485328754":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "j0 (2.0) == 0.22389077914123566805":
+ildouble: 2
+ldouble: 2
+Test "j0 (2.0) == 0.223890779141235668051827454649948626":
 float: 2
 ifloat: 2
-Test "j0 (4.0) == -3.9714980986384737228659076845169804197562E-1"
+ildouble: 2
+ldouble: 2
+Test "j0 (4.0) == -3.9714980986384737228659076845169804197562E-1":
 double: 1
-idouble: 1
 float: 1
-ifloat: 1
-Test "j0 (-4.0) == -3.9714980986384737228659076845169804197562E-1"
-double: 1
 idouble: 1
-float: 1
 ifloat: 1
-Test "j0 (8.0) == 0.17165080713755390609":
+Test "j0 (8.0) == 0.171650807137553906090869407851972001":
 float: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
 
 # j1
-Test "j1 (10.0) == 0.043472746168861436670":
+Test "j1 (-1.0) == -0.440050585744933515959682203718914913":
+ildouble: 1
+ldouble: 1
+Test "j1 (0.75) == 0.349243602174862192523281016426251335":
+ildouble: 1
+ldouble: 1
+Test "j1 (1.0) == 0.440050585744933515959682203718914913":
+ildouble: 1
+ldouble: 1
+Test "j1 (10.0) == 0.0434727461688614366697487680258592883":
 float: 2
 ifloat: 2
-Test "j1 (2.0) == 0.57672480775687338720":
+ildouble: 2
+ldouble: 2
+Test "j1 (2.0) == 0.576724807756873387202448242269137087":
 double: 1
 idouble: 1
-Test "j1 (8.0) == 0.23463634685391462438":
+Test "j1 (8.0) == 0.234636346853914624381276651590454612":
 double: 1
 idouble: 1
+ildouble: 4
+ldouble: 4
 
 # jn
-Test "jn (0, 10.0) == -0.24593576445134833520":
-double: 2
+Test "jn (0, -4.0) == -3.9714980986384737228659076845169804197562E-1":
+double: 1
 float: 1
-idouble: 2
+idouble: 1
 ifloat: 1
-Test "jn (0, 2.0) == 0.22389077914123566805":
-float: 2
-ifloat: 2
-Test "jn (0, 8.0) == 0.17165080713755390609":
+Test "jn (0, 0.75) == 0.864242275166648623555731103820923211":
+float: 1
+ifloat: 1
+Test "jn (0, 10.0) == -0.245935764451348335197760862485328754":
+double: 2
 float: 1
+idouble: 2
 ifloat: 1
-Test "jn (1, 10.0) == 0.043472746168861436670":
+ildouble: 2
+ldouble: 2
+Test "jn (0, 2.0) == 0.223890779141235668051827454649948626":
 float: 2
 ifloat: 2
-Test "jn (1, 2.0) == 0.57672480775687338720":
-double: 1
-idouble: 1
-Test "jn (1, 8.0) == 0.23463634685391462438":
+ildouble: 2
+ldouble: 2
+Test "jn (0, 4.0) == -3.9714980986384737228659076845169804197562E-1":
 double: 1
+float: 1
 idouble: 1
-Test "jn (10, 0.1) == 0.26905328954342155795e-19":
-double: 6
-float: 4
-idouble: 6
-ifloat: 4
-Test "jn (10, 0.7) == 0.75175911502153953928e-11":
-double: 3
+ifloat: 1
+Test "jn (0, 8.0) == 0.171650807137553906090869407851972001":
 float: 1
-idouble: 3
 ifloat: 1
-Test "jn (10, 10.0) == 0.20748610663335885770":
+ildouble: 1
+ldouble: 1
+Test "jn (1, -1.0) == -0.440050585744933515959682203718914913":
+ildouble: 1
+ldouble: 1
+Test "jn (1, 0.75) == 0.349243602174862192523281016426251335":
+ildouble: 1
+ldouble: 1
+Test "jn (1, 1.0) == 0.440050585744933515959682203718914913":
+ildouble: 1
+ldouble: 1
+Test "jn (1, 10.0) == 0.0434727461688614366697487680258592883":
+float: 2
+ifloat: 2
+ildouble: 2
+ldouble: 2
+Test "jn (1, 2.0) == 0.576724807756873387202448242269137087":
+double: 1
+idouble: 1
+Test "jn (1, 8.0) == 0.234636346853914624381276651590454612":
+double: 1
+idouble: 1
+ildouble: 4
+ldouble: 4
+Test "jn (10, -1.0) == 0.263061512368745320699785368779050294e-9":
+ildouble: 1
+ldouble: 1
+Test "jn (10, 0.125) == 0.250543369809369890173993791865771547e-18":
+double: 1
+float: 1
+idouble: 1
+ifloat: 1
+ildouble: 1
+ldouble: 1
+Test "jn (10, 0.75) == 0.149621713117596814698712483621682835e-10":
+double: 1
+float: 1
+idouble: 1
+ifloat: 1
+ildouble: 1
+ldouble: 1
+Test "jn (10, 1.0) == 0.263061512368745320699785368779050294e-9":
+ildouble: 1
+ldouble: 1
+Test "jn (10, 10.0) == 0.207486106633358857697278723518753428":
 double: 4
 float: 3
 idouble: 4
 ifloat: 3
-Test "jn (10, 2.0) == 0.25153862827167367096e-6":
+ildouble: 2
+ldouble: 2
+Test "jn (10, 2.0) == 0.251538628271673670963516093751820639e-6":
 float: 4
 ifloat: 4
-Test "jn (3, 0.1) == 0.000020820315754756261429":
+Test "jn (3, 0.125) == 0.406503832554912875023029337653442868e-4":
 double: 1
+float: 1
 idouble: 1
-Test "jn (3, 0.7) == 0.0069296548267508408077":
+ifloat: 1
+Test "jn (3, 0.75) == 0.848438342327410884392755236884386804e-2":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
-Test "jn (3, 10.0) == 0.058379379305186812343":
+Test "jn (3, 10.0) == 0.0583793793051868123429354784103409563":
 double: 3
 float: 1
 idouble: 3
 ifloat: 1
-Test "jn (3, 2.0) == 0.12894324947440205110":
+ildouble: 2
+ldouble: 2
+Test "jn (3, 2.0) == 0.128943249474402051098793332969239835":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
 
 # lgamma
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (-0.5) == log(2*sqrt(pi))":
+ildouble: 1
+ldouble: 1
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
 
-# log
-Test "log (0.7) == -0.35667494393873237891263871124118447":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-ildouble: 1
-ldouble: 1
-
 # log10
-Test "log10 (0.7) == -0.15490195998574316929":
+Test "log10 (0.75) == -0.124938736608299953132449886193870744":
 double: 1
-float: 1
+float: 2
 idouble: 1
-ifloat: 1
+ifloat: 2
 Test "log10 (e) == log10(e)":
 float: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
 
 # log1p
-Test "log1p (-0.3) == -0.35667494393873237891263871124118447":
-double: 1
+Test "log1p (-0.25) == -0.287682072451780927439219005993827432":
 float: 1
-idouble: 1
 ifloat: 1
-ildouble:  1
-ldouble:  1
+Test "log1p (M_El - 1.0) == 1":
+ildouble: 1
+ldouble: 1
 
 # log2
-Test "log2 (0.7) == -0.51457317282975824043":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
-# remquo
-Test "remquo (-1.625, 1.0, &x) sets x to -2":
-ildouble: 4
-ldouble: 4
-Test "remquo (1.625, -1.0, &x) sets x to -2":
-ildouble: 4
-ldouble: 4
+Test "log2 (0.75) == -.415037499278843818546261056052183492":
+ildouble: 1
+ldouble: 1
 
 # sincos
-Test "sincos (0.7, &sin_res, &cos_res) puts 0.76484218728448842625585999019186495 in cos_res":
+Test "sincos (M_PI_6l*2.0, &sin_res, &cos_res) puts 0.5 in cos_res":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "sincos (M_PI_6l*2.0, &sin_res, &cos_res) puts 0.5 in cos_res":
-double: 1
-float: 0.5
-idouble: 1
-ifloat: 0.5
 ildouble: 1
 ldouble: 1
 Test "sincos (M_PI_6l*2.0, &sin_res, &cos_res) puts 0.86602540378443864676372317075293616 in sin_res":
@@ -719,22 +691,15 @@
 ildouble: 1
 ldouble: 1
 Test "sincos (pi/2, &sin_res, &cos_res) puts 0 in cos_res":
-double: 0.2758
-float: 0.3667
-idouble: 0.2758
-ifloat: 0.3667
-ildouble: 0.2252
-ldouble: 0.2252
-Test "sincos (pi/6, &sin_res, &cos_res) puts 0.86602540378443864676372317075293616 in cos_res":
-float: 1
-ifloat: 1
-
-# sinh
-Test "sinh (0.7) == 0.75858370183953350346":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
+Test "sincos (pi/6, &sin_res, &cos_res) puts 0.86602540378443864676372317075293616 in cos_res":
+float: 1
+ifloat: 1
 
 # sqrt
 Test "sqrt (2) == M_SQRT2l":
@@ -742,31 +707,23 @@
 ldouble: 1
 
 # tan
-Test "tan (0.7) == 0.84228838046307944812813500221293775":
-ildouble: 1
-ldouble: 1
 Test "tan (pi/4) == 1":
-double: 0.5
-idouble: 0.5
-
-# tanh
-Test "tanh (0.7) == 0.60436777711716349631":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "tanh (-0.7) == -0.60436777711716349631":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
-Test "tanh (1.0) == 0.7615941559557648881194582826047935904":
-ldouble:  1
-ildouble:  1
+
+# tanh
+Test "tanh (-0.75) == -0.635148952387287319214434357312496495":
+ildouble: 1
+ldouble: 1
 Test "tanh (-1.0) == -0.7615941559557648881194582826047935904":
-ldouble:  1
-ildouble:  1
-Function: "tanh":
+ildouble: 1
+ldouble: 1
+Test "tanh (0.75) == 0.635148952387287319214434357312496495":
+ildouble: 1
+ldouble: 1
+Test "tanh (1.0) == 0.7615941559557648881194582826047935904":
+ildouble: 1
+ldouble: 1
 
 # tgamma
 Test "tgamma (-0.5) == -2 sqrt (pi)":
@@ -774,198 +731,193 @@
 float: 1
 idouble: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
+Test "tgamma (4) == 6":
+ildouble: 1
+ldouble: 1
 
 # y0
-Test "y0 (0.7) == -0.19066492933739506743":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "y0 (1.0) == 0.088256964215676957983":
+Test "y0 (1.0) == 0.0882569642156769579829267660235151628":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "y0 (1.5) == 0.38244892379775884396":
+Test "y0 (1.5) == 0.382448923797758843955068554978089862":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "y0 (10.0) == 0.055671167283599391424":
+Test "y0 (10.0) == 0.0556711672835993914244598774101900481":
 float: 1
 ifloat: 1
-Test "y0 (8.0) == 0.22352148938756622053":
+ildouble: 3
+ldouble: 3
+Test "y0 (8.0) == 0.223521489387566220527323400498620359":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
+ildouble: 3
+ldouble: 3
 
 # y1
-Test "y1 (0.1) == -6.4589510947020269877":
+Test "y1 (0.125) == -5.19993611253477499595928744876579921":
 double: 1
 idouble: 1
-Test "y1 (0.7) == -1.1032498719076333697":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "y1 (1.5) == -0.41230862697391129595":
+Test "y1 (0.75) == -1.03759455076928541973767132140642198":
+ildouble: 1
+ldouble: 1
+Test "y1 (1.5) == -0.412308626973911295952829820633445323":
 float: 1
 ifloat: 1
-Test "y1 (10.0) == 0.24901542420695388392":
+ildouble: 1
+ldouble: 1
+Test "y1 (10.0) == 0.249015424206953883923283474663222803":
 double: 3
 float: 1
 idouble: 3
 ifloat: 1
-Test "y1 (2.0) == -0.10703243154093754689":
+Test "y1 (2.0) == -0.107032431540937546888370772277476637":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "y1 (8.0) == -0.15806046173124749426":
+ildouble: 1
+ldouble: 1
+Test "y1 (8.0) == -0.158060461731247494255555266187483550":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
+ildouble: 1
+ldouble: 1
 
 # yn
-Test "yn (0, 0.7) == -0.19066492933739506743":
+Test "yn (0, 1.0) == 0.0882569642156769579829267660235151628":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "yn (0, 1.0) == 0.088256964215676957983":
+Test "yn (0, 1.5) == 0.382448923797758843955068554978089862":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "yn (0, 1.5) == 0.38244892379775884396":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "yn (0, 10.0) == 0.055671167283599391424":
+Test "yn (0, 10.0) == 0.0556711672835993914244598774101900481":
 float: 1
 ifloat: 1
-Test "yn (0, 8.0) == 0.22352148938756622053":
+ildouble: 3
+ldouble: 3
+Test "yn (0, 8.0) == 0.223521489387566220527323400498620359":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (1, 0.1) == -6.4589510947020269877":
-double: 1
-idouble: 1
-Test "yn (1, 0.7) == -1.1032498719076333697":
+ildouble: 3
+ldouble: 3
+Test "yn (1, 0.125) == -5.19993611253477499595928744876579921":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
-Test "yn (1, 1.5) == -0.41230862697391129595":
+Test "yn (1, 0.75) == -1.03759455076928541973767132140642198":
+ildouble: 1
+ldouble: 1
+Test "yn (1, 1.5) == -0.412308626973911295952829820633445323":
 float: 1
 ifloat: 1
-Test "yn (1, 10.0) == 0.24901542420695388392":
+ildouble: 1
+ldouble: 1
+Test "yn (1, 10.0) == 0.249015424206953883923283474663222803":
 double: 3
 float: 1
 idouble: 3
 ifloat: 1
-Test "yn (1, 2.0) == -0.10703243154093754689":
+Test "yn (1, 2.0) == -0.107032431540937546888370772277476637":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (1, 8.0) == -0.15806046173124749426":
+ildouble: 1
+ldouble: 1
+Test "yn (1, 8.0) == -0.158060461731247494255555266187483550":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
-Test "yn (10, 0.1) == -0.11831335132045197885e19":
-double: 2
-float: 2
-idouble: 2
-ifloat: 2
-Test "yn (10, 0.7) == -0.42447194260703866924e10":
-double: 3
-idouble: 3
-Test "yn (10, 1.0) == -0.12161801427868918929e9":
+ildouble: 1
+ldouble: 1
+Test "yn (10, 0.125) == -127057845771019398.252538486899753195":
 double: 1
 idouble: 1
-Test "yn (10, 10.0) == -0.35981415218340272205":
+ildouble: 2
+ldouble: 2
+Test "yn (10, 0.75) == -2133501638.90573424452445412893839236":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (10, 2.0) == -129184.54220803928264":
-double: 2
-idouble: 2
-Test "yn (3, 0.1) == -5099.3323786129048894":
+ildouble: 5
+ldouble: 5
+Test "yn (10, 1.0) == -121618014.278689189288130426667971145":
+double: 1
+idouble: 1
+ildouble: 1
+ldouble: 1
+Test "yn (10, 10.0) == -0.359814152183402722051986577343560609":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (3, 0.7) == -15.819479052819633505":
-double: 3
+ildouble: 2
+ldouble: 2
+Test "yn (10, 2.0) == -129184.542208039282635913145923304214":
+double: 2
+idouble: 2
+ildouble: 2
+ldouble: 2
+Test "yn (3, 0.125) == -2612.69757350066712600220955744091741":
+double: 1
+idouble: 1
+Test "yn (3, 0.75) == -12.9877176234475433186319774484809207":
+double: 1
 float: 1
-idouble: 3
+idouble: 1
 ifloat: 1
-Test "yn (3, 10.0) == -0.25136265718383732978":
+ildouble: 2
+ldouble: 2
+Test "yn (3, 10.0) == -0.251362657183837329779204747654240998":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (3, 2.0) == -1.1277837768404277861":
+ildouble: 1
+ldouble: 1
+Test "yn (3, 2.0) == -1.12778377684042778608158395773179238":
 double: 1
 idouble: 1
 
 # Maximal error of functions:
-Function: "acos":
-ldouble:  1
-ildouble:  1
-
-Function: "asin":
-double: 1
-float: 2
-idouble: 1
-ifloat: 2
-
-Function: "atan":
-ildouble: 1
-ldouble: 1
-
 Function: "atan2":
+float: 3
+ifloat: 3
 ildouble: 1
 ldouble: 1
-float:  4
-ifloat:  4
 
 Function: "atanh":
-double: 1
-idouble: 1
-
-Function: "cabs":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
-Function: Real part of "cacos":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Imaginary part of "cacos":
-float: 1
-ifloat: 1
-ildouble: 3
-ldouble: 3
+ildouble: 1
+ldouble: 1
 
 Function: Real part of "cacosh":
 double: 1
@@ -984,18 +936,14 @@
 ldouble: 1
 
 Function: Real part of "casin":
-double: 3
-float: 2
-idouble: 3
-ifloat: 2
-ildouble: 1
-ldouble: 1
-
-Function: Imaginary part of "casin":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
-ildouble: 3
-ldouble: 3
+
+Function: Imaginary part of "casin":
+ildouble: 1
+ldouble: 1
 
 Function: Real part of "casinh":
 double: 5
@@ -1027,28 +975,30 @@
 
 Function: Real part of "catanh":
 double: 4
-float: 1
 idouble: 4
-ifloat: 1
+ildouble: 1
+ldouble: 1
 
 Function: Imaginary part of "catanh":
-double: 1
 float: 6
-idouble: 1
 ifloat: 6
+ildouble: 1
+ldouble: 1
 
 Function: "cbrt":
 double: 1
 idouble: 1
+ildouble: 1
+ldouble: 1
 
 Function: Real part of "ccos":
 double: 1
+float: 1
 idouble: 1
+ifloat: 1
 
 Function: Imaginary part of "ccos":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Real part of "ccosh":
@@ -1058,15 +1008,11 @@
 ifloat: 1
 
 Function: Imaginary part of "ccosh":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Real part of "cexp":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 ildouble: 1
 ldouble: 1
@@ -1077,16 +1023,18 @@
 ildouble: 1
 ldouble: 1
 
+Function: Real part of "clog":
+float: 1
+ifloat: 1
+ildouble: 1
+ldouble: 1
+
 Function: Imaginary part of "clog":
-double: 1
 float: 3
-idouble: 1
 ifloat: 3
 
 Function: Real part of "clog10":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Imaginary part of "clog10":
@@ -1094,6 +1042,7 @@
 float: 5
 idouble: 1
 ifloat: 5
+ldouble: 1
 
 Function: "cos":
 double: 2
@@ -1104,24 +1053,24 @@
 ldouble: 1
 
 Function: Real part of "cpow":
-double: 1
+double: 2
 float: 4
-idouble: 1
+idouble: 2
 ifloat: 4
-ildouble: 3
-ldouble: 3
+ildouble: 1
+ldouble: 1
 
 Function: Imaginary part of "cpow":
-double: 1.1031
+double: 2
 float: 2
-idouble: 1.1031
+idouble: 2
 ifloat: 2
-ildouble: 0.9006
-ldouble: 0.9006
+ildouble: 1
+ldouble: 1
 
-Function: Imaginary part of "csin":
-float: 1
-ifloat: 1
+Function: Real part of "csin":
+ildouble: 1
+ldouble: 1
 
 Function: Real part of "csinh":
 float: 1
@@ -1134,48 +1083,44 @@
 ifloat: 1
 
 Function: Real part of "csqrt":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 ildouble: 1
 ldouble: 1
 
 Function: Imaginary part of "csqrt":
-float: 1
-ifloat: 1
 ildouble: 1
 ldouble: 1
 
 Function: Real part of "ctan":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
 
 Function: Imaginary part of "ctan":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
+ildouble: 2
+ldouble: 2
 
 Function: Real part of "ctanh":
-double: 2
+double: 1
 float: 2
-idouble: 2
+idouble: 1
 ifloat: 2
 
 Function: Imaginary part of "ctanh":
-double: 2
 float: 1
-idouble: 2
 ifloat: 1
 
+Function: "erf":
+double: 1
+idouble: 1
+
 Function: "erfc":
-double: 24
-float: 12
-idouble: 24
-ifloat: 12
+double: 1
+idouble: 1
+ildouble: 1
+ldouble: 1
 
 Function: "exp10":
 double: 6
@@ -1190,19 +1135,15 @@
 float: 1
 idouble: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
 
-Function: "fmod":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-ildouble: 2
-ldouble: 2
+Function: "gamma":
+ildouble: 1
+ldouble: 1
 
 Function: "hypot":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: "j0":
@@ -1210,52 +1151,50 @@
 float: 2
 idouble: 2
 ifloat: 2
+ildouble: 2
+ldouble: 2
 
 Function: "j1":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
+ildouble: 4
+ldouble: 4
 
 Function: "jn":
-double: 6
+double: 4
 float: 4
-idouble: 6
+idouble: 4
 ifloat: 4
+ildouble: 4
+ldouble: 4
 
 Function: "lgamma":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
-
-Function: "log":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
 ildouble: 1
 ldouble: 1
 
 Function: "log10":
 double: 1
-float: 1
+float: 2
 idouble: 1
-ifloat: 1
+ifloat: 2
+ildouble: 1
+ldouble: 1
 
 Function: "log1p":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
-ildouble:  1
-ldouble:  1
+ildouble: 1
+ldouble: 1
 
 Function: "log2":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
+ildouble: 1
+ldouble: 1
 
 Function: "sincos":
 double: 1
@@ -1265,50 +1204,48 @@
 ildouble: 1
 ldouble: 1
 
-Function: "sinh":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
 Function: "sqrt":
 ildouble: 1
 ldouble: 1
 
 Function: "tan":
-double: 0.5
-idouble: 0.5
-ildouble: 1
-ldouble: 1
-
-Function: "tanh":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
+
+Function: "tanh":
+ildouble: 1
+ldouble: 1
 
 Function: "tgamma":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
+ildouble: 1
+ldouble: 1
 
 Function: "y0":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
+ildouble: 3
+ldouble: 3
 
 Function: "y1":
 double: 3
 float: 2
 idouble: 3
 ifloat: 2
+ildouble: 1
+ldouble: 1
 
 Function: "yn":
 double: 3
 float: 2
 idouble: 3
 ifloat: 2
+ildouble: 5
+ldouble: 5
 
 # end of automatic generation
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/memchr.S libc-20030708/sysdeps/sparc/sparc64/memchr.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/memchr.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/memchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,7 +1,7 @@
 /* memchr (str, ch, n) -- Return pointer to first occurrence of CH in STR less
    than N.
    For SPARC v9.
-   Copyright (C) 1998,1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jan Vondrak <jvon4518@ss1000.ms.mff.cuni.cz> and
                   Jakub Jelinek <jj@ultra.linux.cz>.
@@ -260,3 +260,4 @@
 #if !__BOUNDED_POINTERS__
 weak_alias (__memchr, __ubp_memchr)
 #endif
+libc_hidden_builtin_def (memchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/memcpy.S libc-20030708/sysdeps/sparc/sparc64/memcpy.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/memcpy.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -917,3 +917,5 @@
 weak_alias(memcpy, __align_cpy_1)
 weak_alias(memcpy, __align_cpy_2)
 #endif
+libc_hidden_builtin_def (memcpy)
+libc_hidden_builtin_def (memmove)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/memset.S libc-20030708/sysdeps/sparc/sparc64/memset.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/memset.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/memset.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,6 +1,6 @@
 /* Set a block of memory to some byte value.
    For UltraSPARC.
-   Copyright (C) 1996, 97, 98, 99 Free Software Foundation, Inc.
+   Copyright (C) 1996, 97, 98, 99, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David S. Miller (davem@caip.rutgers.edu) and
                   Jakub Jelinek (jj@ultra.linux.cz).
@@ -178,6 +178,7 @@
 	ba,pt		%xcc, 18b
 	 ldd		[%o0], %f0
 END(memset)
+libc_hidden_builtin_def (memset)
 
 #define ZERO_BLOCKS(base, offset, source)		\
 	stx		source, [base - offset - 0x38];	\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/sparcv9b/memcpy.S libc-20030708/sysdeps/sparc/sparc64/sparcv9b/memcpy.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/sparcv9b/memcpy.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/sparcv9b/memcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -711,3 +711,5 @@
 weak_alias(memcpy, __align_cpy_8)
 weak_alias(memcpy, __align_cpy_16)
 #endif
+libc_hidden_builtin_def (memcpy)
+libc_hidden_builtin_def (memmove)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strcat.S libc-20030708/sysdeps/sparc/sparc64/strcat.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strcat.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strcat.S	2003-05-02 00:11:52.000000000 +0900
@@ -337,3 +337,4 @@
 	retl						/* CTI+IEU1	Group		*/
 	 mov		%g6, %o0			/* IEU0				*/
 END(strcat)
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strchr.S libc-20030708/sysdeps/sparc/sparc64/strchr.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strchr.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strchr.S	2003-05-02 00:11:52.000000000 +0900
@@ -479,3 +479,5 @@
 
 weak_alias (strchr, index)
 weak_alias (strrchr, rindex)
+libc_hidden_builtin_def (strchr)
+libc_hidden_builtin_def (strrchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strcmp.S libc-20030708/sysdeps/sparc/sparc64/strcmp.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strcmp.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strcmp.S	2003-05-02 00:11:52.000000000 +0900
@@ -277,3 +277,4 @@
 	ba,pt		%xcc, 11b				/* CTI		Group		*/
 	 ldxa		[%o1 + %o0] ASI_PNF, %g6		/* Load				*/
 END(strcmp)
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strcpy.S libc-20030708/sysdeps/sparc/sparc64/strcpy.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strcpy.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strcpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -242,3 +242,4 @@
 	retl						/* CTI+IEU1	Group		*/
 	 mov		%g6, %o0			/* IEU0				*/
 END(strcpy)
+libc_hidden_builtin_def (strcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strcspn.S libc-20030708/sysdeps/sparc/sparc64/strcspn.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strcspn.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strcspn.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,7 +1,7 @@
 /* strcspn (str, ss) -- Return the length of the initial segment of STR
                         which contains no characters from SS.
    For SPARC v9.
-   Copyright (C) 1999 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jj@ultra.linux.cz>
 
@@ -210,3 +210,4 @@
 	retl						/* CTI+IEU1	Group		*/
 	 sub		%o0, %g4, %o0			/* IEU0				*/
 END(strcspn)
+libc_hidden_builtin_def (strcspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strlen.S libc-20030708/sysdeps/sparc/sparc64/strlen.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strlen.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strlen.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* Determine the length of a string.  For SPARC v9.
-   Copyright (C) 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jan Vondrak <jvon4518@ss1000.ms.mff.cuni.cz> and
                   Jakub Jelinek <jj@ultra.linux.cz>.
@@ -171,3 +171,4 @@
 	retl						/* CTI+IEU1	Group		*/
 	 sub		%o0, %o1, %o0			/* IEU0				*/
 END(strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strncmp.S libc-20030708/sysdeps/sparc/sparc64/strncmp.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strncmp.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strncmp.S	2003-05-02 00:11:52.000000000 +0900
@@ -361,3 +361,4 @@
 	ba,pt		%xcc, 13b			/* CTI				*/
 	 add		%o1, 8, %o1			/* IEU0				*/
 END(strncmp)
+libc_hidden_builtin_def (strncmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strncpy.S libc-20030708/sysdeps/sparc/sparc64/strncpy.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strncpy.S	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strncpy.S	2003-05-02 00:11:52.000000000 +0900
@@ -394,3 +394,4 @@
 	ba,pt		%xcc, 3b			/* CTI				*/
 	 sllx		%o4, 56, %g3			/* IEU0		Group		*/
 END(strncpy)
+libc_hidden_builtin_def (strncpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strpbrk.S libc-20030708/sysdeps/sparc/sparc64/strpbrk.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strpbrk.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strpbrk.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,7 +1,7 @@
 /* strpbrk (s, accept) -- Find the first occurrence in S of any character in
 			  ACCEPT.
    For SPARC v9.
-   Copyright (C) 1999 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jj@ultra.linux.cz>
 
@@ -228,3 +228,4 @@
 
 	 movrz		%g1, 0, %o0			/* Single	Group		*/
 END(strpbrk)
+libc_hidden_builtin_def (strpbrk)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/sparc/sparc64/strspn.S libc-20030708/sysdeps/sparc/sparc64/strspn.S
--- glibc-2.3.2/sysdeps/sparc/sparc64/strspn.S	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/sparc/sparc64/strspn.S	2003-05-02 00:11:52.000000000 +0900
@@ -1,7 +1,7 @@
 /* strspn (str, ss) -- Return the length of the maximum initial segment
 		       of S which contains only characters in ACCEPT.
    For SPARC v9.
-   Copyright (C) 1999 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jakub Jelinek <jj@ultra.linux.cz>
 
@@ -210,3 +210,4 @@
 	retl						/* CTI+IEU1	Group		*/
 	 sub		%o0, %g4, %o0			/* IEU0				*/
 END(strspn)
+libc_hidden_builtin_def (strspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/Makefile libc-20030708/sysdeps/unix/Makefile
--- glibc-2.3.2/sysdeps/unix/Makefile	2003-01-16 09:47:25.000000000 +0900
+++ libc-20030708/sysdeps/unix/Makefile	2003-05-02 14:47:17.000000000 +0900
@@ -1,4 +1,5 @@
-# Copyright (C) 1991,92,93,94,95,96,97,98,99 Free Software Foundation, Inc.
+# Copyright (C) 1991,1992,1993,1994,1995,1996,1997,1998,1999,2003
+#	Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -281,11 +282,49 @@
 
 ifeq (misc,$(subdir))
 sysdep_routines += $(unix-extra-syscalls)
+
+ifdef unix-stub-syscalls
+# The system call entry points in this list are supposed to be additional
+# functions not overriding any other sysdeps/.../call.c implementation, but
+# their system call numbers are unavailable in the kernel headers we're
+# using.  Instead of a system call stub, these get a function that fails
+# with ENOSYS.  We just generate a single module defining one function and
+# making all these entry point names aliases for it.
+sysdep_routines += stub-syscalls
+$(objpfx)stub-syscalls.c: $(common-objpfx)sysd-syscalls \
+			  $(..)sysdeps/unix/Makefile
+	$(make-target-directory)
+	(echo '#include <errno.h>'; \
+	 echo 'long int _no_syscall (void)'; \
+	 echo '{ __set_errno (ENOSYS); return -1L; }'; \
+	 for call in $(unix-stub-syscalls); do \
+	   case $$call in \
+	   *@@*) ver=$${call##*@}; call=$${call%%*@}; \
+		 echo "strong_alias (_no_syscall, $${call}_$${ver})"; \
+		 echo "default_symbol_version \
+		         ($${call}_$${ver}, $$call, $$ver);" ;; \
+	   *@@*) ver=$${call##*@}; call=$${call%%*@}; \
+		 echo "strong_alias (_no_syscall, $${call}_$${ver})"; \
+		 echo "symbol_version ($${call}_$${ver}, $$call, $$ver);" ;; \
+	   *) echo "weak_alias (_no_syscall, $$call)"; \
+	      echo "stub_warning ($$call)"; \
+	      echo "weak_alias (_no_syscall, __GI_$$call)" ;; \
+	   esac; \
+	 echo '#include <stub-tag.h>'; \
+	 done) > $@T
+	mv -f $@T $@
+generated += stub-syscalls.c
+endif
 endif
 
 export sysdirs
 export asm_CPP := $(COMPILE.S) -E -x assembler-with-cpp
 
+# This is the end of the pipeline for compiling the syscall stubs.
+# The stdin in assembler with cpp using sysdep.h macros.
+# Be sure to disable debugging info since it would all just say "<stdin>".
+compile-syscall = $(filter-out -g%,$(COMPILE.S)) -x assembler-with-cpp -o $@ -
+
 ifndef avoid-generated
 $(common-objpfx)sysd-syscalls: $(..)sysdeps/unix/make-syscalls.sh \
 			       $(wildcard $(+sysdep_dirs:%=%/syscalls.list))
@@ -300,10 +339,10 @@
 # The syscall objects depend on s-proto.d or s-proto-cancel.d, which
 # are generated to specify dependencies generated syscalls have on
 # headers.
-ifdef subdir
-ifndef no_deps
 # These deps use file names relative to a subdir, so don't
 # include them in the parent directory.
+ifneq (,$(filter $(unix-syscalls),$(routines) $(sysdep_routines) $(aux)))
+ifndef no_deps
 -include $(common-objpfx)s-proto.d
 -include $(common-objpfx)s-proto-bp.d
 -include $(common-objpfx)s-proto-cancel.d
@@ -312,8 +351,7 @@
 
 $(common-objpfx)s-%.d: $(..)sysdeps/unix/s-%.S \
 		       $(wildcard $(+sysdep_dirs:%=%/syscalls.list))
-# Don't try to use compat.h in the db2 subdir
-	$(subst -include ./compat.h,,$(+make-deps))
+	$(+make-deps)
 
 common-generated += s-proto.d s-proto-bp.d s-proto-cancel.d
 postclean-generated += sysd-syscalls
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/alpha/sysdep.h libc-20030708/sysdeps/unix/alpha/sysdep.h
--- glibc-2.3.2/sysdeps/unix/alpha/sysdep.h	2003-01-27 06:07:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/alpha/sysdep.h	2003-07-08 22:58:14.000000000 +0900
@@ -119,6 +119,21 @@
 	END(sym)
 #endif
 
+#define PSEUDO_NOERRNO(name, syscall_name, args)	\
+	.globl name;					\
+	.align 4;					\
+	.ent name,0;					\
+__LABEL(name)						\
+	PSEUDO_PROLOGUE;				\
+	PSEUDO_PREPARE_ARGS				\
+	lda	v0, SYS_ify(syscall_name);		\
+	call_pal PAL_callsys;
+
+#undef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(sym)  END(sym)
+
+#define ret_NOERRNO ret
+
 #define r0	v0
 #define r1	a4
 
@@ -137,7 +152,7 @@
 ({						\
 	long _sc_ret, _sc_err;			\
 	inline_syscall##nr(name, args);		\
-	if (_sc_err)				\
+	if (__builtin_expect (_sc_err, 0))	\
 	  {					\
 	    __set_errno (_sc_ret);		\
 	    _sc_ret = -1L;			\
@@ -167,8 +182,8 @@
 /* If TLS is in use, we have a conflict between the PAL_rduniq primitive,
    as modeled within GCC, and explicit use of the R0 register.  If we use
    the register via the asm, the scheduler may place the PAL_rduniq insn
-   before we've copied the data from R0 into _sc_ret.  If this happens 
-   we'll get a reload abort, since R0 is live at the same time it is 
+   before we've copied the data from R0 into _sc_ret.  If this happens
+   we'll get a reload abort, since R0 is live at the same time it is
    needed for the PAL_rduniq.
 
    Solve this by using the "v" constraint instead of an asm for the syscall
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/clock_gettime.c libc-20030708/sysdeps/unix/clock_gettime.c
--- glibc-2.3.2/sysdeps/unix/clock_gettime.c	2002-02-01 08:39:56.000000000 +0900
+++ libc-20030708/sysdeps/unix/clock_gettime.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +32,8 @@
 
 
 /* This function is defined in the thread library.  */
-extern int __pthread_clock_gettime (hp_timing_t freq, struct timespec *tp)
+extern int __pthread_clock_gettime (clockid_t clock_id, hp_timing_t freq,
+				    struct timespec *tp)
      __attribute__ ((__weak__));
 #endif
 
@@ -41,21 +42,42 @@
 int
 clock_gettime (clockid_t clock_id, struct timespec *tp)
 {
-  struct timeval tv;
   int retval = -1;
 
   switch (clock_id)
     {
+#define HANDLE_REALTIME \
+      do {								      \
+        struct timeval tv;						      \
+	retval = gettimeofday (&tv, NULL);				      \
+	if (retval == 0)						      \
+	  /* Convert into `timespec'.  */				      \
+	  TIMEVAL_TO_TIMESPEC (&tv, tp);				      \
+      } while (0)
+
+#ifdef SYSDEP_GETTIME
+      SYSDEP_GETTIME;
+#endif
+
+#ifndef HANDLED_REALTIME
     case CLOCK_REALTIME:
-      retval = gettimeofday (&tv, NULL);
-      if (retval == 0)
-	/* Convert into `timespec'.  */
-	TIMEVAL_TO_TIMESPEC (&tv, tp);
+      HANDLE_REALTIME;
       break;
+#endif
 
+    default:
 #if HP_TIMING_AVAIL
+      if ((clock_id & ((1 << CLOCK_IDFIELD_SIZE) - 1))
+	  != CLOCK_THREAD_CPUTIME_ID)
+#endif
+	{
+	  __set_errno (EINVAL);
+	  break;
+	}
+
+#if HP_TIMING_AVAIL
+      /* FALLTHROUGH.  */
     case CLOCK_PROCESS_CPUTIME_ID:
-    case CLOCK_THREAD_CPUTIME_ID:
       {
 	hp_timing_t tsc;
 
@@ -71,10 +93,10 @@
 	      break;
 	  }
 
-	if (clock_id == CLOCK_THREAD_CPUTIME_ID
+	if (clock_id != CLOCK_PROCESS_CPUTIME_ID
 	    && __pthread_clock_gettime != NULL)
 	  {
-	    retval = __pthread_clock_gettime (freq, tp);
+	    retval = __pthread_clock_gettime (clock_id, freq, tp);
 	    break;
 	  }
 
@@ -95,10 +117,6 @@
       }
     break;
 #endif
-
-    default:
-      __set_errno (EINVAL);
-      break;
     }
 
   return retval;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/clock_nanosleep.c libc-20030708/sysdeps/unix/clock_nanosleep.c
--- glibc-2.3.2/sysdeps/unix/clock_nanosleep.c	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/unix/clock_nanosleep.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* High-resolution sleep with the specified clock.
-   Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,14 +21,19 @@
 #include <errno.h>
 #include <time.h>
 #include <hp-timing.h>
-
+#include <sysdep-cancel.h>
 
 #if HP_TIMING_AVAIL
-# define CLOCK_P(clock) \
-  (clock) != CLOCK_PROCESS_CPUTIME_ID					      \
-  && (clock) != CLOCK_THREAD_CPUTIME_ID
+# define CPUCLOCK_P(clock) \
+  ((clock) == CLOCK_PROCESS_CPUTIME_ID					      \
+   || ((clock) & ((1 << CLOCK_IDFIELD_SIZE) - 1)) == CLOCK_THREAD_CPUTIME_ID)
 #else
-# define CLOCK_P(clock) 0
+# define CPUCLOCK_P(clock) 0
+#endif
+
+#ifndef INVALID_CLOCK_P
+# define INVALID_CLOCK_P(cl) \
+  ((cl) < CLOCK_REALTIME || (cl) > CLOCK_THREAD_CPUTIME_ID)
 #endif
 
 
@@ -44,6 +49,16 @@
       || __builtin_expect (req->tv_nsec, 0) >= 1000000000)
     return EINVAL;
 
+  if (CPUCLOCK_P (clock_id))
+    return ENOTSUP;
+
+  if (INVALID_CLOCK_P (clock_id))
+    return EINVAL;
+
+#ifdef SYSDEP_NANOSLEEP
+  SYSDEP_NANOSLEEP;
+#endif
+
   /* If we got an absolute time, remap it.  */
   if (flags == TIMER_ABSTIME)
     {
@@ -76,11 +91,8 @@
   else if (__builtin_expect (flags, 0) != 0)
     return EINVAL;
   else if (clock_id != CLOCK_REALTIME)
-    {
-      /* Make sure the clock ID is correct.  */
-      if (__builtin_expect (! CLOCK_P (clock_id), 0))
-	return EINVAL;
-    }
+    /* Not supported.  */
+    return ENOTSUP;
 
   return __builtin_expect (nanosleep (req, rem), 0) ? errno : 0;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/clock_settime.c libc-20030708/sysdeps/unix/clock_settime.c
--- glibc-2.3.2/sysdeps/unix/clock_settime.c	2002-02-01 08:40:41.000000000 +0900
+++ libc-20030708/sysdeps/unix/clock_settime.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,7 +31,7 @@
 
 
 /* This function is defined in the thread library.  */
-extern void __pthread_clock_settime (hp_timing_t offset)
+extern void __pthread_clock_settime (clockid_t clock_id, hp_timing_t offset)
      __attribute__ ((__weak__));
 #endif
 
@@ -40,7 +40,6 @@
 int
 clock_settime (clockid_t clock_id, const struct timespec *tp)
 {
-  struct timeval tv;
   int retval;
 
   /* Make sure the time cvalue is OK.  */
@@ -52,15 +51,38 @@
 
   switch (clock_id)
     {
-    case CLOCK_REALTIME:
-      TIMESPEC_TO_TIMEVAL (&tv, tp);
+#define HANDLE_REALTIME \
+      do {								      \
+	struct timeval tv;						      \
+	TIMESPEC_TO_TIMEVAL (&tv, tp);					      \
+									      \
+	retval = settimeofday (&tv, NULL);				      \
+      } while (0)
+
+#ifdef SYSDEP_GETTIME
+      SYSDEP_GETTIME;
+#endif
 
-      retval = settimeofday (&tv, NULL);
+#ifndef HANDLED_REALTIME
+    case CLOCK_REALTIME:
+      HANDLE_REALTIME;
       break;
+#endif
 
+    default:
 #if HP_TIMING_AVAIL
+      if ((clock_id & ((1 << CLOCK_IDFIELD_SIZE) - 1))
+	  != CLOCK_THREAD_CPUTIME_ID)
+#endif
+	{
+	  __set_errno (EINVAL);
+	  retval = -1;
+	  break;
+	}
+
+#if HP_TIMING_AVAIL
+      /* FALLTHROUGH.  */
     case CLOCK_PROCESS_CPUTIME_ID:
-    case CLOCK_THREAD_CPUTIME_ID:
       {
 	hp_timing_t tsc;
 	hp_timing_t usertime;
@@ -87,21 +109,16 @@
 	usertime = tp->tv_sec * freq + (tp->tv_nsec * freq) / 1000000000ull;
 
 	/* Determine the offset and use it as the new base value.  */
-	if (clock_id != CLOCK_THREAD_CPUTIME_ID
+	if (clock_id == CLOCK_PROCESS_CPUTIME_ID
 	    || __pthread_clock_settime == NULL)
 	  GL(dl_cpuclock_offset) = tsc - usertime;
 	else
-	  __pthread_clock_settime (tsc - usertime);
+	  __pthread_clock_settime (clock_id, tsc - usertime);
 
 	retval = 0;
       }
       break;
 #endif
-
-    default:
-      __set_errno (EINVAL);
-      retval = -1;
-      break;
     }
 
   return retval;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/make-syscalls.sh libc-20030708/sysdeps/unix/make-syscalls.sh
--- glibc-2.3.2/sysdeps/unix/make-syscalls.sh	2003-01-16 09:47:25.000000000 +0900
+++ libc-20030708/sysdeps/unix/make-syscalls.sh	2003-07-08 22:58:14.000000000 +0900
@@ -84,8 +84,10 @@
   esac
 
   cancellable=
+  noerrno=
   case $args in
   C*) cancellable=-cancel; args=`echo $args | sed 's/C:\?//'`;;
+  E*) noerrno=_NOERRNO; args=`echo $args | sed 's/E:\?//'`;;
   esac
 
   # Derive the number of arguments from the argument signature
@@ -109,6 +111,16 @@
   echo "#### CALL=$file NUMBER=$callnum ARGS=$args SOURCE=$srcfile"
 
  case x$srcfile"$callnum" in
+ x--)
+  # Undefined callnum for an extra syscall.
+  if [ x$caller != x- ]; then
+    if [ x$noerrno != x ]; then
+      echo >&2 "$0: no number for $fileno, no-error syscall ($strong $weak)"
+      exit 2
+    fi
+    echo "unix-stub-syscalls += $strong $weak"
+  fi
+  ;;
  x*-) ;; ### Do nothing for undefined callnum
  x-*)
   echo "ifeq (,\$(filter $file,\$(unix-syscalls)))"
@@ -149,9 +161,9 @@
   echo "\
 	\$(make-target-directory)
 	(echo '#include <sysdep$cancellable.h>'; \\
-	 echo 'PSEUDO ($strong, $syscall, $nargs)'; \\
-	 echo '	ret'; \\
-	 echo 'PSEUDO_END($strong)'; \\
+	 echo 'PSEUDO$noerrno ($strong, $syscall, $nargs)'; \\
+	 echo '	ret$noerrno'; \\
+	 echo 'PSEUDO_END$noerrno($strong)'; \\
 	 echo 'libc_hidden_def ($strong)'; \\"
   ;;
   esac
@@ -190,6 +202,11 @@
 	fi
 	echo "	 echo 'symbol_version($source, $base, $ver)'; \\"
 	;;
+      !*)
+	name=`echo $name | sed 's/.//'`
+	echo "	 echo 'strong_alias ($strong, $name)'; \\"
+	echo "	 echo 'libc_hidden_def ($name)'; \\"
+	;;
       *)
 	echo "	 echo 'weak_alias ($strong, $name)'; \\"
 	echo "	 echo 'libc_hidden_weak ($name)'; \\"
@@ -198,7 +215,7 @@
   done
 
   # And finally, pipe this all into the compiler.
-  echo '	) | $(COMPILE.S) -x assembler-with-cpp -o $@ -'
+  echo '	) | $(compile-syscall)'
 
   case $weak in
   *@*)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/mips/brk.S libc-20030708/sysdeps/unix/mips/brk.S
--- glibc-2.3.2/sysdeps/unix/mips/brk.S	2003-01-12 16:54:14.000000000 +0900
+++ libc-20030708/sysdeps/unix/mips/brk.S	2003-03-18 00:47:12.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1992, 1995, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1992, 1995, 1997, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Brendan Kehoe (brendan@zen.org).
 
@@ -18,6 +18,7 @@
    02111-1307 USA.  */
 
 #include <sysdep.h>
+#include <sys/asm.h>
 
 #ifndef SYS_brk
 #define SYS_brk 17
@@ -37,9 +38,9 @@
 	.set	reorder
 	/* Handle the query case.  */
 	bnez a0, 1f
-	move a0,v0
+	move a0, v0
 1:	/* Update __curbrk and exit cleanly.  */
-	sw a0, __curbrk
+	PTR_S a0, __curbrk
 	move v0, zero
 	jr ra
 PSEUDO_END(__brk)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/mips/mips32/sysdep.h libc-20030708/sysdeps/unix/mips/mips32/sysdep.h
--- glibc-2.3.2/sysdeps/unix/mips/mips32/sysdep.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/mips/mips32/sysdep.h	2003-03-29 17:15:28.000000000 +0900
@@ -0,0 +1,52 @@
+/* Copyright (C) 1992, 1995, 1997, 1999, 2000, 2002, 2003
+   Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Brendan Kehoe (brendan@zen.org).
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdeps/unix/mips/sysdep.h>
+
+/* Note that while it's better structurally, going back to call __syscall_error
+   can make things confusing if you're debugging---it looks like it's jumping
+   backwards into the previous fn.  */
+#ifdef __PIC__
+#define PSEUDO(name, syscall_name, args) \
+  .align 2;								      \
+  99: la t9,__syscall_error;						      \
+  jr t9;								      \
+  ENTRY(name)								      \
+  .set noreorder;							      \
+  .cpload t9;								      \
+  li v0, SYS_ify(syscall_name);						      \
+  syscall;								      \
+  .set reorder;								      \
+  bne a3, zero, 99b;							      \
+L(syse1):
+#else
+#define PSEUDO(name, syscall_name, args) \
+  .set noreorder;							      \
+  .align 2;								      \
+  99: j __syscall_error;						      \
+  nop;									      \
+  ENTRY(name)								      \
+  .set noreorder;							      \
+  li v0, SYS_ify(syscall_name);						      \
+  syscall;								      \
+  .set reorder;								      \
+  bne a3, zero, 99b;							      \
+L(syse1):
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/mips/mips64/n32/sysdep.h libc-20030708/sysdeps/unix/mips/mips64/n32/sysdep.h
--- glibc-2.3.2/sysdeps/unix/mips/mips64/n32/sysdep.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/mips/mips64/n32/sysdep.h	2003-04-01 21:01:05.000000000 +0900
@@ -0,0 +1,57 @@
+/* Copyright (C) 1992, 1995, 1997, 1999, 2000, 2002, 2003
+	Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Alexandre Oliva <aoliva@redhat.com>.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdeps/unix/mips/sysdep.h>
+
+#ifdef __ASSEMBLER__
+
+/* Note that while it's better structurally, going back to call __syscall_error
+   can make things confusing if you're debugging---it looks like it's jumping
+   backwards into the previous fn.  */
+#ifdef __PIC__
+#define PSEUDO(name, syscall_name, args) \
+  .align 2;								      \
+  99:;									      \
+  .set noat;								      \
+  .cpsetup t9, $1, name;						      \
+  .set at;								      \
+  la t9,__syscall_error;						      \
+  .cpreturn;								      \
+  jr t9;								      \
+  ENTRY(name)								      \
+  li v0, SYS_ify(syscall_name);						      \
+  syscall;								      \
+  bne a3, zero, 99b;							      \
+L(syse1):
+#else
+#define PSEUDO(name, syscall_name, args) \
+  .set noreorder;							      \
+  .align 2;								      \
+  99: j __syscall_error;						      \
+  ENTRY(name)								      \
+  .set noreorder;							      \
+  li v0, SYS_ify(syscall_name);						      \
+  syscall;								      \
+  .set reorder;								      \
+  bne a3, zero, 99b;							      \
+L(syse1):
+#endif
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/mips/mips64/n64/sysdep.h libc-20030708/sysdeps/unix/mips/mips64/n64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/mips/mips64/n64/sysdep.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/mips/mips64/n64/sysdep.h	2003-04-01 21:01:05.000000000 +0900
@@ -0,0 +1,57 @@
+/* Copyright (C) 1992, 1995, 1997, 1999, 2000, 2002, 2003
+	Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Alexandre Oliva <aoliva@redhat.com>.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdeps/unix/mips/sysdep.h>
+
+#ifdef __ASSEMBLER__
+
+/* Note that while it's better structurally, going back to call __syscall_error
+   can make things confusing if you're debugging---it looks like it's jumping
+   backwards into the previous fn.  */
+#ifdef __PIC__
+#define PSEUDO(name, syscall_name, args) \
+  .align 2;								      \
+  99:;									      \
+  .set noat;								      \
+  .cpsetup t9, $1, name;						      \
+  .set at;								      \
+  dla t9,__syscall_error;						      \
+  .cpreturn;								      \
+  jr t9;								      \
+  ENTRY(name)								      \
+  li v0, SYS_ify(syscall_name);						      \
+  syscall;								      \
+  bne a3, zero, 99b;							      \
+L(syse1):
+#else
+#define PSEUDO(name, syscall_name, args) \
+  .set noreorder;							      \
+  .align 2;								      \
+  99: j __syscall_error;						      \
+  ENTRY(name)								      \
+  .set noreorder;							      \
+  li v0, SYS_ify(syscall_name);						      \
+  syscall;								      \
+  .set reorder;								      \
+  bne a3, zero, 99b;							      \
+L(syse1):
+#endif
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/mips/sysdep.S libc-20030708/sysdeps/unix/mips/sysdep.S
--- glibc-2.3.2/sysdeps/unix/mips/sysdep.S	2003-01-28 03:55:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/mips/sysdep.S	2003-04-15 23:55:50.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1992,93,94,97,98,99,2000 Free Software Foundation, Inc.
+/* Copyright (C) 1992, 1993, 1994, 1997, 1998, 1999, 2000, 2002, 2003 
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Brendan Kehoe (brendan@zen.org).
 
@@ -20,47 +21,52 @@
 #include <sysdep.h>
 #define _ERRNO_H
 #include <bits/errno.h>
+#include <sys/asm.h>
 
 #ifdef _LIBC_REENTRANT
 
+LOCALSZ= 3
+FRAMESZ= (((NARGSAVE+LOCALSZ)*SZREG)+ALSZ)&ALMASK
+RAOFF= FRAMESZ-(1*SZREG)
+GPOFF= FRAMESZ-(2*SZREG)
+V0OFF= FRAMESZ-(3*SZREG)
+	
 ENTRY(__syscall_error)
 #ifdef __PIC__
-	.set noreorder
-	.set	noat
-	move	AT, ra
-	bltzal	zero, 0f
-	nop
-0:	.cpload	ra
-	move	ra, AT
-	.set	at
-	.set	reorder
+	.set noat
+	SETUP_GPX (AT)
+	.set at
 #endif
-	subu	sp, 32
+	PTR_SUBU sp, FRAMESZ
+	.set noat
+	SETUP_GPX64(GPOFF,AT)
+	.set at
 #ifdef __PIC__
-	.cprestore 16
+	SAVE_GP(GPOFF)
 #endif
-	sw	v0, 20(sp)
-	sw	ra, 24(sp)
+	REG_S	v0, V0OFF(sp)
+	REG_S	ra, RAOFF(sp)
 
 #if defined (EWOULDBLOCK_sys) && EWOULDBLOCK_sys != EAGAIN
 	/* We translate the system's EWOULDBLOCK error into EAGAIN.
 	   The GNU C library always defines EWOULDBLOCK==EAGAIN.
 	   EWOULDBLOCK_sys is the original number.  */
-	bne	v0, EWOULDBLOCK_sys, skip
+	bne	v0, EWOULDBLOCK_sys, L(skip)
 	nop
 	li	v0, EAGAIN
-skip:
+L(skip):
 #endif
 	/* Find our per-thread errno address  */
 	jal	__errno_location
 
 	/* Store the error value.  */
-	lw	t0, 20(sp)
+	REG_L	t0, V0OFF(sp)
 	sw	t0, 0(v0)
 
 	/* And just kick back a -1.  */
-	lw	ra, 24(sp)
-	addiu	sp, 32
+	REG_L	ra, RAOFF(sp)
+	RESTORE_GP64
+	PTR_ADDU sp, FRAMESZ
 	li	v0, -1
 	j	ra
 	END(__syscall_error)
@@ -70,29 +76,25 @@
 
 ENTRY(__syscall_error)
 #ifdef __PIC__
-	.set	noreorder
-	.set	noat
-	move	AT, ra
-	bltzal	zero, 0f
-	nop
-0:	.cpload	ra
-	move	ra, AT
-	.set	at
-	.set	reorder
+	SETUP_GPX (AT)
 #endif
+	SETUP_GPX64 (t9, AT)
+	
 #if defined (EWOULDBLOCK_sys) && EWOULDBLOCK_sys != EAGAIN
 	/* We translate the system's EWOULDBLOCK error into EAGAIN.
 	   The GNU C library always defines EWOULDBLOCK==EAGAIN.
 	   EWOULDBLOCK_sys is the original number.  */
-	bne v0, EWOULDBLOCK_sys, skip
+	bne v0, EWOULDBLOCK_sys, L(skip)
 	li v0, EAGAIN
-skip:
+L(skip):
 #endif
 	/* Store it in errno... */
 	sw v0, errno
 
 	/* And just kick back a -1.  */
 	li v0, -1
+
+	RESTORE_GP64
 	j ra
 	END(__syscall_error)
 #endif  /* _LIBC_REENTRANT  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/mips/sysdep.h libc-20030708/sysdeps/unix/mips/sysdep.h
--- glibc-2.3.2/sysdeps/unix/mips/sysdep.h	2002-11-07 03:22:28.000000000 +0900
+++ libc-20030708/sysdeps/unix/mips/sysdep.h	2003-04-01 21:01:05.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1992,95,97,99,2000 Free Software Foundation, Inc.
+/* Copyright (C) 1992, 1995, 1997, 1999, 2000, 2002, 2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Brendan Kehoe (brendan@zen.org).
 
@@ -29,48 +30,36 @@
   .ent name,0;								      \
   name##:
 
-/* Note that while it's better structurally, going back to call __syscall_error
-   can make things confusing if you're debugging---it looks like it's jumping
-   backwards into the previous fn.  */
-#ifdef __PIC__
- #define PSEUDO(name, syscall_name, args) \
-  .align 2;								      \
-  99: la t9,__syscall_error;						      \
-  jr t9;								      \
-  ENTRY(name)								      \
-  .set noreorder;							      \
-  .cpload t9;								      \
-  li v0, SYS_ify(syscall_name);						      \
-  syscall;								      \
-  .set reorder;								      \
-  bne a3, zero, 99b;							      \
-syse1:
-#else
-#define PSEUDO(name, syscall_name, args) \
-  .set noreorder;							      \
-  .align 2;								      \
-  99: j __syscall_error;						      \
-  nop;									      \
-  ENTRY(name)								      \
-  .set noreorder;							      \
-  li v0, SYS_ify(syscall_name);						      \
-  syscall;								      \
-  .set reorder;								      \
-  bne a3, zero, 99b;							      \
-syse1:
-#endif
-
-#undef PSEUDO_END
-#define PSEUDO_END(sym) .end sym
+#undef END
+#define	END(function)                                   \
+		.end	function;		        \
+		.size	function,.-function
 
 #define ret	j ra ; nop
 
-#undef END
-#define END(sym)        .end sym
+#define PSEUDO_END(sym) .end sym; .size sym,.-sym
+
+#define PSEUDO_NOERRNO(name, syscall_name, args)	\
+  .align 2;						\
+  ENTRY(name)						\
+  .set noreorder;					\
+  li v0, SYS_ify(syscall_name);				\
+  syscall
+
+#undef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(sym) .end sym; .size sym,.-sym
+
+#define ret_NOERRNO ret
 
 #define r0	v0
 #define r1	v1
 /* The mips move insn is d,s.  */
 #define MOVE(x,y)	move y , x
 
+#if _MIPS_SIM == _MIPS_SIM_ABI32 || _MIPS_SIM == _MIPS_SIM_ABIO64
+# define L(label) $L ## label
+#else
+# define L(label) .L ## label
+#endif
+
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/mips/wait.S libc-20030708/sysdeps/unix/mips/wait.S
--- glibc-2.3.2/sysdeps/unix/mips/wait.S	2001-07-08 04:21:30.000000000 +0900
+++ libc-20030708/sysdeps/unix/mips/wait.S	2003-03-14 12:59:37.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1992, 1994, 1995, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1992, 1994, 1995, 1997, 2002, 2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Brendan Kehoe (brendan@zen.org).
 
@@ -28,18 +29,18 @@
 
 	li v0, SYS_wait
 	syscall
-	beqz a3, noerror
+	beqz a3, L(noerror)
 	nop
 	j __syscall_error
 	nop
 
-noerror:
+L(noerror):
 	/* If the arg is not NULL, store v1 there.  */
-	beqz a0, noarg
+	beqz a0, L(noarg)
 	nop
 	sw v1, 0(a0)
 	nop
-noarg:
+L(noarg):
 	ret
 	.end __wait
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sparc/sysdep.h libc-20030708/sysdeps/unix/sparc/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sparc/sysdep.h	2001-07-08 04:21:30.000000000 +0900
+++ libc-20030708/sysdeps/unix/sparc/sysdep.h	2003-03-25 19:49:27.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1994, 1995, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1993, 1994, 1995, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -52,7 +52,14 @@
   jmp %g1 + %lo(syscall_error);	nop;		\
 1:
 
+#define	PSEUDO_NOERRNO(name, syscall_name, args) \
+  .global syscall_error;			\
+  ENTRY (name)					\
+  mov SYS_ify(syscall_name), %g1;		\
+  ta 0
+
 #define	ret		retl; nop
+#define	ret_NOERRNO	retl; nop
 #define	r0		%o0
 #define	r1		%o1
 #define	MOVE(x,y)	mov x, y
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/syscalls.list libc-20030708/sysdeps/unix/syscalls.list
--- glibc-2.3.2/sysdeps/unix/syscalls.list	2003-01-31 12:39:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/syscalls.list	2003-03-25 19:49:27.000000000 +0900
@@ -14,13 +14,13 @@
 fstatfs		-	fstatfs		i:ip	__fstatfs	fstatfs
 fsync		-	fsync		Ci:i	__libc_fsync	fsync
 getdomain	-	getdomainname	i:si	getdomainname
-getgid		-	getgid		i:	__getgid	getgid
+getgid		-	getgid		Ei:	__getgid	getgid
 getgroups	-	getgroups	i:ip	__getgroups	getgroups
 getitimer	-	getitimer	i:ip	__getitimer	getitimer
-getpid		-	getpid		i:	__getpid	getpid
+getpid		-	getpid		Ei:	__getpid	getpid
 getpriority	-	getpriority	i:ii	getpriority
 getrlimit	-	getrlimit	i:ip	__getrlimit	getrlimit
-getuid		-	getuid		i:	__getuid	getuid
+getuid		-	getuid		Ei:	__getuid	getuid
 ioctl		-	ioctl		i:iiI	__ioctl		ioctl
 kill		-	kill		i:ii	__kill		kill
 link		-	link		i:ss	__link		link
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysdep.h libc-20030708/sysdeps/unix/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysdep.h	2001-07-08 04:21:29.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysdep.h	2003-03-28 21:28:18.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 92, 93, 96, 98 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 92, 93, 96, 98, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -47,6 +47,9 @@
 #ifndef PSEUDO_END
 #define PSEUDO_END(sym)
 #endif
+#ifndef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(sym)	PSEUDO_END(sym)
+#endif
 
 /* Wrappers around system calls should normally inline the system call code.
    But sometimes it is not possible or implemented and we use this code.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/Dist libc-20030708/sysdeps/unix/sysv/linux/Dist
--- glibc-2.3.2/sysdeps/unix/sysv/linux/Dist	2003-02-21 15:30:10.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/Dist	2003-06-12 08:54:05.000000000 +0900
@@ -3,6 +3,7 @@
 dl-brk.c
 dl-sbrk.c
 exit-thread.S
+fatal-prepare.h
 getdirentries.c
 getdirentries64.c
 ipc_priv.h
@@ -39,7 +40,6 @@
 neteconet/ec.h
 netinet/if_fddi.h
 netinet/if_tr.h
-netinet/igmp.h
 netpacket/packet.h
 netipx/ipx.h
 netrom/netrom.h
@@ -78,6 +78,7 @@
 sys/user.h
 sys/vt.h
 xstatconv.c
+xstatconv.h
 getdents64.c
 umount.S
 umount2.S
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/Makefile libc-20030708/sysdeps/unix/sysv/linux/Makefile
--- glibc-2.3.2/sysdeps/unix/sysv/linux/Makefile	2002-12-17 08:36:52.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/Makefile	2003-06-12 08:54:05.000000000 +0900
@@ -2,12 +2,13 @@
 sysdep_routines += errno-loc
 endif
 
-ifeq ($(subdir),db2)
-CPPFLAGS += -DHAVE_LLSEEK=1
+ifeq ($(subdir),assert)
+CFLAGS-assert.c += -DFATAL_PREPARE_INCLUDE='<fatal-prepare.h>'
+CFLAGS-assert-perr.c += -DFATAL_PREPARE_INCLUDE='<fatal-prepare.h>'
 endif
 
 ifeq ($(subdir),malloc)
-CFLAGS-malloc.c = -DMORECORE_CLEARS=2
+CFLAGS-malloc.c += -DMORECORE_CLEARS=2
 endif
 
 ifeq ($(subdir),misc)
@@ -28,7 +29,7 @@
 # For bi-arch platforms, the CPU/Makefile defines {32,64}bit-predefine and
 # we generate a file that uses <bits/wordsize.h>.
 $(objpfx)syscall-%.h $(objpfx)syscall-%.d: ../sysdeps/unix/sysv/linux/sys/syscall.h
-	rm -f $(@:.h=.d)-t
+	$(make-target-directory)
 	{ \
 	 echo '/* Generated at libc build time from kernel syscall list.  */';\
 	 echo ''; \
@@ -36,14 +37,14 @@
 	 echo '# error "Never use <bits/syscall.h> directly; include <sys/syscall.h> instead."'; \
 	 echo '#endif'; \
 	 echo ''; \
-	 SUNPRO_DEPENDENCIES='$(@:.h=.d)-t $@' \
-	 $(CC) -E -x c $(sysincludes) $< $(addprefix -U,$(64bit-predefine)) \
-	   $(addprefix -D,$(32bit-predefine)) -D_LIBC -dM | \
+	 $(CC) -E -MD -MP -MF $(@:.h=.d)-t1 -MT '$(@:.d=.h) $(@:.h=.d)' \
+	       -x c $(sysincludes) $< $(addprefix -U,$(64bit-predefine)) \
+	       $(addprefix -D,$(32bit-predefine)) -D_LIBC -dM | \
 	 sed -n 's@^#define __NR_\([^ ]*\) .*$$@#define SYS_\1 __NR_\1@p' | \
 	 LC_ALL=C sort > $(@:.d=.h).new32; \
-	 SUNPRO_DEPENDENCIES='$(@:.h=.d)-t $@' \
-	 $(CC) -E -x c $(sysincludes) $< $(addprefix -U,$(64bit-predefine)) \
-	   $(addprefix -D,$(64bit-predefine)) -D_LIBC -dM | \
+	 $(CC) -E -MD -MP -MF $(@:.h=.d)-t2 -MT '$(@:.d=.h) $(@:.h=.d)' \
+	       -x c $(sysincludes) $< $(addprefix -U,$(32bit-predefine)) \
+	       $(addprefix -D,$(64bit-predefine)) -D_LIBC -dM | \
 	 sed -n 's@^#define __NR_\([^ ]*\) .*$$@#define SYS_\1 __NR_\1@p' | \
 	 LC_ALL=C sort > $(@:.d=.h).new64; \
 	 if cmp -s $(@:.d=.h).new32 $(@:.d=.h).new64; then \
@@ -61,12 +62,13 @@
 	 rm -f $(@:.d=.h).new32 $(@:.d=.h).new64; \
 	} > $(@:.d=.h).new
 	mv -f $(@:.d=.h).new $(@:.d=.h)
-	sed < $(@:.h=.d)-t > $(@:.h=.d)-t2 \
-	    -e 's,$(subst .,\.,$@),$(patsubst $(objpfx)%,$$(objpfx)%,\
-					      $(@:.d=.h) $(@:.h=.d)),'
-	rm -f $(@:.h=.d)-t
-	mv -f $(@:.h=.d)-t2 $(@:.h=.d)
-
+ifneq (,$(objpfx))
+	sed $(sed-remove-objpfx) $(@:.h=.d)-t1 $(@:.h=.d)-t2 > $(@:.h=.d)-t3
+else
+	cat $(@:.h=.d)-t1 $(@:.h=.d)-t2 > $(@:.h=.d)-t3
+endif
+	rm -f $(@:.h=.d)-t1 $(@:.h=.d)-t2
+	mv -f $(@:.h=.d)-t3 $(@:.h=.d)
 
 $(inst_includedir)/bits/syscall.h: $(objpfx)syscall-list.h $(+force)
 	$(make-target-directory)
@@ -114,7 +116,7 @@
 endif
 
 ifeq ($(subdir),inet)
-sysdep_headers += netinet/if_fddi.h netinet/if_tr.h netinet/igmp.h \
+sysdep_headers += netinet/if_fddi.h netinet/if_tr.h \
 		  netipx/ipx.h netash/ash.h netax25/ax25.h netatalk/at.h \
 		  netrom/netrom.h netpacket/packet.h netrose/rose.h \
 		  neteconet/ec.h
@@ -131,6 +133,10 @@
 CFLAGS-ypclnt.c = -DUSE_BINDINGDIR=1
 endif
 
+ifeq ($(subdir),io)
+sysdep_routines += xstatconv
+endif
+
 ifeq ($(subdir),elf)
 sysdep-rtld-routines += dl-brk dl-sbrk
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/Makefile libc-20030708/sysdeps/unix/sysv/linux/alpha/Makefile
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/Makefile	2002-03-29 08:41:51.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/Makefile	2003-07-08 22:58:14.000000000 +0900
@@ -6,12 +6,12 @@
 sysdep_headers += alpha/ptrace.h alpha/regdef.h sys/io.h
 
 sysdep_routines += ieee_get_fp_control ieee_set_fp_control \
-		   ioperm osf_sigprocmask llseek adjtimex
+		   ioperm llseek
 
 # Support old timeval32 entry points
 sysdep_routines += osf_select osf_gettimeofday osf_settimeofday \
 		   osf_getitimer osf_setitimer osf_utimes \
-		   osf_getrusage osf_wait4 old_adjtimex
+		   osf_getrusage osf_wait4
 
 # Support old ipc control
 sysdep_routines += oldmsgctl oldsemctl oldshmctl
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/adjtime.c libc-20030708/sysdeps/unix/sysv/linux/alpha/adjtime.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/adjtime.c	2003-01-08 08:51:31.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/adjtime.c	2003-07-08 22:58:14.000000000 +0900
@@ -17,7 +17,11 @@
    02111-1307 USA.  */
 
 #include <shlib-compat.h>
+#include <sysdep.h>
+#include <sys/time.h>
+#include "kernel-features.h"
 
+#if !defined __ASSUME_TIMEVAL64 || SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)
 struct timeval32
 {
     int tv_sec, tv_usec;
@@ -55,7 +59,7 @@
 #define TIMEVAL		timeval32
 #define TIMEX		timex32
 #define ADJTIME		__adjtime_tv32
-#define ADJTIMEX(x)	__adjtimex_tv32 (x)
+#define ADJTIMEX(x)	INLINE_SYSCALL (old_adjtimex, 1, x)
 #if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)
 #define LINKAGE
 #else
@@ -63,13 +67,18 @@
 #endif
 
 LINKAGE int ADJTIME (const struct TIMEVAL *itv, struct TIMEVAL *otv);
-extern int ADJTIMEX (struct TIMEX *);
 
 #include <sysdeps/unix/sysv/linux/adjtime.c>
 
 #if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)
+int __adjtimex_tv32 (struct timex32 *tx) { return ADJTIMEX (tx); }
+strong_alias (__adjtimex_tv32, __adjtimex_tv32_1);
+strong_alias (__adjtimex_tv32, __adjtimex_tv32_2);
+compat_symbol (libc, __adjtimex_tv32_1, __adjtimex, GLIBC_2_0);
+compat_symbol (libc, __adjtimex_tv32_2, adjtimex, GLIBC_2_0);
 compat_symbol (libc, __adjtime_tv32, adjtime, GLIBC_2_0);
 #endif
+#endif /* !__ASSUME_TIMEVAL64 || SHLIB_COMPAT */
 
 #undef TIMEVAL
 #define TIMEVAL		timeval
@@ -78,34 +87,38 @@
 #undef ADJTIME
 #define ADJTIME		__adjtime_tv64
 #undef ADJTIMEX
-#define ADJTIMEX(x)	__syscall_adjtimex_tv64 (x)
+#define ADJTIMEX(x)	INLINE_SYSCALL (adjtimex, 1, x)
 #undef LINKAGE
 #define LINKAGE		static
 
 LINKAGE int ADJTIME (const struct TIMEVAL *itv, struct TIMEVAL *otv);
-extern int ADJTIMEX (struct TIMEX *);
 
 #include <sysdeps/unix/sysv/linux/adjtime.c>
-static int missing_adjtimex = 0;
+#include <stdbool.h>
+
+#if !defined __ASSUME_TIMEVAL64
+static bool missing_adjtimex;
 
 int
 __adjtime (itv, otv)
      const struct timeval *itv;
      struct timeval *otv;
 {
+  struct timeval32 itv32, otv32;
   int ret;
 
-  if (!missing_adjtimex)
+  switch (missing_adjtimex)
     {
+    case false:
       ret = __adjtime_tv64 (itv, otv);
       if (ret && errno == ENOSYS)
 	missing_adjtimex = 1;
-    }
+      else
+	break;
 
-  if (missing_adjtimex)
-    {
-      struct timeval32 itv32, otv32;
+      /* FALLTHRU */
 
+    default:
       itv32.tv_sec = itv->tv_sec;
       itv32.tv_usec = itv->tv_usec;
       ret = __adjtime_tv32 (&itv32, &otv32);
@@ -114,31 +127,38 @@
 	  otv->tv_sec = otv32.tv_sec;
 	  otv->tv_usec = otv32.tv_usec;
 	}
+      break;
     }
 
   return ret;
 }
+#else
+strong_alias (__adjtime_tv64, __adjtime);
+#endif
 
 versioned_symbol (libc, __adjtime, adjtime, GLIBC_2_1);
 
-extern int __syscall_adjtimex_tv64 (struct timex *tx);
-
 int
 __adjtimex_tv64 (struct timex *tx)
 {
+#if defined __ASSUME_TIMEVAL64
+  return ADJTIMEX (tx);
+#else
+  struct timex32 tx32;
   int ret;
 
-  if (!missing_adjtimex)
-   {
-     ret = __syscall_adjtimex_tv64 (tx);
-     if (ret && errno == ENOSYS)
+  switch (missing_adjtimex)
+    {
+    case false:
+      ret = ADJTIMEX (tx);
+      if (ret && errno == ENOSYS)
 	missing_adjtimex = 1;
-   }
+      else
+	break;
 
-  if (missing_adjtimex)
-    {
-      struct timex32 tx32;
+      /* FALLTHRU */
 
+    default:
       tx32.modes = tx->modes;
       tx32.offset = tx->offset;
       tx32.freq = tx->freq;
@@ -184,9 +204,11 @@
 	  tx->errcnt = tx32.errcnt;
 	  tx->stbcnt = tx32.stbcnt;
 	}
+      break;
     }
 
   return ret;
+#endif
 }
 
 strong_alias (__adjtimex_tv64, __adjtimex_internal);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/fcntl.h libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/fcntl.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/fcntl.h	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/fcntl.h	2003-04-28 23:53:26.000000000 +0900
@@ -168,6 +168,6 @@
 # define POSIX_FADV_RANDOM	1 /* Expect random page references.  */
 # define POSIX_FADV_SEQUENTIAL	2 /* Expect sequential page references.  */
 # define POSIX_FADV_WILLNEED	3 /* Will need these pages.  */
-# define POSIX_FADV_DONTNEED	6 /* Don't need these pages.  */
-# define POSIX_FADV_NOREUSE	7 /* Data will be accessed once.  */
+# define POSIX_FADV_DONTNEED	4 /* Don't need these pages.  */
+# define POSIX_FADV_NOREUSE	5 /* Data will be accessed once.  */
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/mman.h	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/mman.h	2003-03-03 18:20:08.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/Alpha version.
-   Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -60,11 +60,13 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	  0x1000	/* Stack-like segment.  */
-# define MAP_DENYWRITE	  0x2000	/* ETXTBSY */
-# define MAP_EXECUTABLE	  0x4000	/* Mark it as an executable.  */
-# define MAP_LOCKED	  0x8000	/* Lock the mapping.  */
+# define MAP_GROWSDOWN	  0x01000	/* Stack-like segment.  */
+# define MAP_DENYWRITE	  0x02000	/* ETXTBSY */
+# define MAP_EXECUTABLE	  0x04000	/* Mark it as an executable.  */
+# define MAP_LOCKED	  0x08000	/* Lock the mapping.  */
 # define MAP_NORESERVE	  0x10000	/* Don't check for reservations.  */
+# define MAP_POPULATE	  0x20000	/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	  0x40000	/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/siginfo.h libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/siginfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/siginfo.h	2002-12-05 09:21:41.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/siginfo.h	2003-04-28 23:53:26.000000000 +0900
@@ -1,5 +1,5 @@
 /* siginfo_t, sigevent and constants.  Linux/Alpha version.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,8 +22,6 @@
 # error "Never include this file directly.  Use <signal.h> instead"
 #endif
 
-#include <bits/wordsize.h>
-
 #if (!defined __have_sigval_t \
      && (defined _SIGNAL_H || defined __need_siginfo_t \
 	 || defined __need_sigevent_t))
@@ -42,11 +40,7 @@
 # define __have_siginfo_t	1
 
 # define __SI_MAX_SIZE     128
-# if __WORDSIZE == 64
-#  define __SI_PAD_SIZE     ((__SI_MAX_SIZE / sizeof (int)) - 4)
-# else
-#  define __SI_PAD_SIZE     ((__SI_MAX_SIZE / sizeof (int)) - 3)
-# endif
+# define __SI_PAD_SIZE     ((__SI_MAX_SIZE / sizeof (int)) - 4)
 
 typedef struct siginfo
   {
@@ -69,8 +63,9 @@
 	/* POSIX.1b timers.  */
 	struct
 	  {
-	    unsigned int _timer1;
-	    unsigned int _timer2;
+	    int si_tid;		/* Timer ID.  */
+	    int si_overrun;	/* Overrun count.  */
+	    sigval_t si_sigval;	/* Signal value.  */
 	  } _timer;
 
 	/* POSIX.1b signals.  */
@@ -110,8 +105,8 @@
 /* X/Open requires some more fields with fixed names.  */
 # define si_pid		_sifields._kill.si_pid
 # define si_uid		_sifields._kill.si_uid
-# define si_timer1	_sifields._timer._timer1
-# define si_timer2	_sifields._timer._timer2
+# define si_timerid	_sifields._timer.si_tid
+# define si_overrun	_sifields._timer.si_overrun
 # define si_status	_sifields._sigchld.si_status
 # define si_utime	_sifields._sigchld.si_utime
 # define si_stime	_sifields._sigchld.si_stime
@@ -127,8 +122,10 @@
    signals.  */
 enum
 {
-  SI_ASYNCNL = -6,		/* Sent by asynch name lookup completion.  */
+  SI_ASYNCNL = -60,		/* Sent by asynch name lookup completion.  */
 # define SI_ASYNCNL	SI_ASYNCNL
+  SI_TKILL = -6,		/* Sent by tkill.  */
+# define SI_TKILL	SI_TKILL
   SI_SIGIO,			/* Sent by queued SIGIO. */
 # define SI_SIGIO	SI_SIGIO
   SI_ASYNCIO,			/* Sent by AIO completion.  */
@@ -261,14 +258,7 @@
 
 /* Structure to transport application-defined values with signals.  */
 # define __SIGEV_MAX_SIZE	64
-# if __WORDSIZE == 64
-#  define __SIGEV_PAD_SIZE	((__SIGEV_MAX_SIZE / sizeof (int)) - 4)
-# else
-#  define __SIGEV_PAD_SIZE	((__SIGEV_MAX_SIZE / sizeof (int)) - 3)
-# endif
-
-/* Forward declaration of the `pthread_attr_t' type.  */
-struct __pthread_attr_s;
+# define __SIGEV_PAD_SIZE	((__SIGEV_MAX_SIZE / sizeof (int)) - 4)
 
 typedef struct sigevent
   {
@@ -280,6 +270,10 @@
       {
 	int _pad[__SIGEV_PAD_SIZE];
 
+	/* When SIGEV_SIGNAL and SIGEV_THREAD_ID set, LWP ID of the
+	   thread to receive the signal.  */
+	__pid_t _tid;
+
 	struct
 	  {
 	    void (*_function) (sigval_t);	/* Function to start.  */
@@ -299,8 +293,11 @@
 # define SIGEV_SIGNAL	SIGEV_SIGNAL
   SIGEV_NONE,			/* Other notification: meaningless.  */
 # define SIGEV_NONE	SIGEV_NONE
-  SIGEV_THREAD			/* Deliver via thread creation.  */
+  SIGEV_THREAD,			/* Deliver via thread creation.  */
 # define SIGEV_THREAD	SIGEV_THREAD
+
+  SIGEV_THREAD_ID = 4		/* Send signal to specific thread.  */
+#define SIGEV_THREAD_ID	SIGEV_THREAD_ID
 };
 
 #endif	/* have _SIGNAL_H.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/signum.h libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/signum.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/signum.h	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/signum.h	2003-04-01 21:01:06.000000000 +0900
@@ -1,5 +1,5 @@
 /* Signal number definitions.  Linux/Alpha version.
-   Copyright (C) 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -69,7 +69,7 @@
 #define SIGPWR	SIGINFO
 #define SIGIOT	SIGABRT
 
-#define	_NSIG		64	/* Biggest signal number + 1.  */
+#define	_NSIG		65	/* Biggest signal number + 1.  */
 
 #define SIGRTMIN	(__libc_current_sigrtmin ())
 #define SIGRTMAX	(__libc_current_sigrtmax ())
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/statfs.h libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/statfs.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/statfs.h	2002-10-24 08:48:55.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/statfs.h	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,7 +41,8 @@
 #endif
     __fsid_t f_fsid;
     int f_namelen;
-    int f_spare[6];
+    int f_frsize;
+    int f_spare[5];
   };
 
 #ifdef __USE_LARGEFILE64
@@ -56,7 +57,8 @@
     __fsfilcnt64_t f_ffree;
     __fsid_t f_fsid;
     int f_namelen;
-    int f_spare[6];
+    int f_frsize;
+    int f_spare[5];
   };
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h	2002-10-24 08:48:49.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/bits/typesizes.h	2003-03-28 21:28:20.000000000 +0900
@@ -1,5 +1,5 @@
 /* bits/typesizes.h -- underlying types for *_t.  Linux/Alpha version.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -54,7 +54,7 @@
 #define __SWBLK_T_TYPE		__SLONGWORD_TYPE
 #define __KEY_T_TYPE		__S32_TYPE
 #define __CLOCKID_T_TYPE	__S32_TYPE
-#define __TIMER_T_TYPE		__S32_TYPE
+#define __TIMER_T_TYPE		void *
 #define __BLKSIZE_T_TYPE	__U32_TYPE
 #define __FSID_T_TYPE		struct { int __val[2]; }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/clone.S libc-20030708/sysdeps/unix/sysv/linux/alpha/clone.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/clone.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/clone.S	2003-07-08 22:58:14.000000000 +0900
@@ -24,9 +24,13 @@
 #define _ERRNO_H	1
 #include <bits/errno.h>
 
-/* int clone(int (*fn)(void *arg), void *child_stack, int flags, void *arg,
-		       pid_t *tid, void *tls);
- */
+/* int clone(int (*fn)(void *arg), void *child_stack, int flags,
+	     void *arg, pid_t *ptid, void *tls, pid_t *ctid);
+
+   Note that everything past ARG is technically optional, based
+   on FLAGS, and that CTID is arg 7, and thus is on the stack.
+   However, since a load from top-of-stack better be legal always,
+   we don't bother checking FLAGS.  */
 
         .text
 ENTRY(__clone)
@@ -51,11 +55,13 @@
 	stq	a0,0(a1)
 	stq	a3,8(a1)
 
-	/* Shift the flags, tid and tls arguments into place; the
+	/* The syscall is of the form clone(flags, usp, ptid, ctid, tls).
+	   Shift the flags, ptid, ctid, tls arguments into place; the
 	   child_stack argument is already correct.  */
 	mov	a2,a0
 	mov	a4,a2
-	mov	a5,a3
+	ldq	a3,0(sp)
+	mov	a5,a4
 
 	/* Do the system call.  */
 	ldiq	v0,__NR_clone
@@ -83,8 +89,7 @@
 
 	.ent thread_start
 thread_start:
-	.frame fp,0,zero,0
-	mov	zero,fp
+	.frame	zero,0,zero,0
 	.prologue 0
 
 	/* Load up the arguments.  */
@@ -98,7 +103,11 @@
 
 	/* Call _exit rather than doing it inline for breakpoint purposes.  */
 	mov	v0,a0
-	jsr	ra,_exit
+#ifdef PIC
+	bsr	ra, HIDDEN_JUMPTARGET(_exit)	!samegp
+#else
+	jsr	ra, HIDDEN_JUMPTARGET(_exit)
+#endif
 
 	/* Die horribly.  */
 	halt
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/getitimer.S libc-20030708/sysdeps/unix/sysv/linux/alpha/getitimer.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/getitimer.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/getitimer.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,7 +19,21 @@
 #include <sysdep.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
 
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define GETITIMER	__getitimer_tv64
+#else
+#define GETITIMER	getitimer
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(GETITIMER, getitimer, 2)
+	ret
+PSEUDO_END(GETITIMER)
+#else
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
    that POSIX requires tv_sec to be time_t.
@@ -30,14 +44,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define GETITIMER	__getitimer_tv64
-#else
-#define GETITIMER	getitimer
-#endif
-
 LEAF(GETITIMER, 16)
 	ldgp	gp, 0(pv)
 	subq	sp, 16, sp
@@ -100,6 +106,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(GETITIMER)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 default_symbol_version (__getitimer_tv64, getitimer, GLIBC_2.1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/getrusage.S libc-20030708/sysdeps/unix/sysv/linux/alpha/getrusage.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/getrusage.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/getrusage.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,7 +19,21 @@
 #include <sysdep.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
 
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define GETRUSAGE	__getrusage_tv64
+#else
+#define GETRUSAGE	__getrusage
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(GETRUSAGE, getrusage, 2)
+	ret
+PSEUDO_END(GETRUSAGE)
+#else
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
    that POSIX requires tv_sec to be time_t.
@@ -30,14 +44,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define GETRUSAGE	__getrusage_tv64
-#else
-#define GETRUSAGE	__getrusage
-#endif
-
 LEAF(GETRUSAGE, 16)
 	ldgp	gp, 0(pv)
 	subq	sp, 16, sp
@@ -132,6 +138,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(GETRUSAGE)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 strong_alias(__getrusage_tv64, ____getrusage_tv64)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/gettimeofday.S libc-20030708/sysdeps/unix/sysv/linux/alpha/gettimeofday.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/gettimeofday.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/gettimeofday.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,6 +19,21 @@
 #include <sysdep.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
+
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define GETTIMEOFDAY	__gettimeofday_tv64
+#else
+#define GETTIMEOFDAY	__gettimeofday
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(GETTIMEOFDAY, gettimeofday, 2)
+	ret
+PSEUDO_END(GETTIMEOFDAY)
+#else
 
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
@@ -30,14 +45,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define GETTIMEOFDAY	__gettimeofday_tv64
-#else
-#define GETTIMEOFDAY	__gettimeofday
-#endif
-
 LEAF(GETTIMEOFDAY, 16)
 	ldgp	gp, 0(pv)
 	subq	sp, 16, sp
@@ -86,7 +93,7 @@
 	ldl	t0, 0(a0)
 	ldl	t1, 4(a0)
 	stq	t0, 0(a0)
-	stq	t1, 0(a0)
+	stq	t1, 8(a0)
 
 2:	addq	sp, 16, sp
 	ret
@@ -97,6 +104,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(GETTIMEOFDAY)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 default_symbol_version (__gettimeofday_tv64, __gettimeofday, GLIBC_2.1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S libc-20030708/sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/ieee_get_fp_control.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1995, 1996 Free Software Foundation, Inc.
+/* Copyright (C) 1993, 1995, 1996, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Mosberger <davidm@azstarnet.com>, 1995.
 
@@ -32,9 +32,13 @@
 	jsr	AT, (AT), _mcount
 	.set at
 	.prologue 1
-#else
+#elif defined PIC
 	lda	sp, -16(sp)
 	.prologue 0
+#else
+	ldgp	gp, 0(pv)
+	lda	sp, -16(sp)
+	.prologue 1
 #endif
 
 	mov	sp, a1
@@ -48,13 +52,10 @@
 	ret
 
 $error:
-#ifndef PROF
-	br	gp, 1f
-1:	ldgp	gp, 0(gp)
-#endif
 	lda	sp, 16(sp)
 	SYSCALL_ERROR_HANDLER
 
 	END(__ieee_get_fp_control)
 
+libc_hidden_def(__ieee_get_fp_control)
 weak_alias (__ieee_get_fp_control, ieee_get_fp_control)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S libc-20030708/sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/ieee_set_fp_control.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1995, 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1993, 1995, 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Mosberger <davidm@azstarnet.com>, 1995.
 
@@ -30,9 +30,13 @@
 	jsr	AT, (AT), _mcount
 	.set at
 	.prologue 1
-#else
+#elif defined PIC
 	lda	sp, -16(sp)
 	.prologue 0
+#else
+	ldgp	gp, 0(pv)
+	lda	sp, -16(sp)
+	.prologue 1
 #endif
 
 	stq	a0, 0(sp)
@@ -47,13 +51,10 @@
 	ret
 
 $error:
-#ifndef PROF
-	br	gp, 1f
-1:	ldgp	gp, 0(gp)
-#endif
 	lda	sp, 16(sp)
 	SYSCALL_ERROR_HANDLER
 
 	END(__ieee_set_fp_control)
 
+libc_hidden_def(__ieee_set_fp_control)
 weak_alias (__ieee_set_fp_control, ieee_set_fp_control)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ipc_priv.h libc-20030708/sysdeps/unix/sysv/linux/alpha/ipc_priv.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ipc_priv.h	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/ipc_priv.h	2003-05-10 13:38:07.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995-1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1995-1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,6 +44,7 @@
 #define IPCOP_semop	 1
 #define IPCOP_semget	 2
 #define IPCOP_semctl	 3
+#define IPCOP_semtimedop 4
 #define IPCOP_msgsnd	11
 #define IPCOP_msgrcv	12
 #define IPCOP_msgget	13
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/rt_sigaction.S libc-20030708/sysdeps/unix/sysv/linux/alpha/rt_sigaction.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/rt_sigaction.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/rt_sigaction.S	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson <rth@cygnus.com>, 1998
 
@@ -28,55 +28,92 @@
 
 #ifdef __NR_rt_sigaction
 	.text
+
 ENTRY(__syscall_rt_sigaction)
 	.frame	sp,0,ra,0
-#ifdef PROF
 	ldgp	gp,0(pv)
+#ifdef PROF
 	.set noat
 	lda	AT, _mcount
 	jsr	AT, (AT), _mcount
 	.set at
 #endif
-	/* Indicate non-standard use of our PV.  */
-	.prologue 2
+	.prologue 1
 
 	beq	a1, 0f
-	ldl	t0, 8(a1)				# sa_flags
-	lda	a4, sigreturn-__syscall_rt_sigaction(pv)
-	lda	t1, rt_sigreturn-__syscall_rt_sigaction(pv)
-	and	t0, 0x00000040, t0			# SA_SIGINFO
+	ldl	t0, 8(a1)			# sa_flags
+	ldah	a4, sigreturn(gp)		!gprelhigh
+	ldah	t1, rt_sigreturn(gp)		!gprelhigh
+	lda	a4, sigreturn(a4)		!gprellow
+	lda	t1, rt_sigreturn(a4)		!gprellow
+	and	t0, 0x00000040, t0		# SA_SIGINFO
 	cmovne	t0, t1, a4
-0:	ldi	v0,__NR_rt_sigaction
+0:	ldi	v0, __NR_rt_sigaction
 	callsys
-	bne	a3,1f
+	bne	a3, SYSCALL_ERROR_LABEL
 	ret
 
-1:
-#ifndef PROF
-	br	gp,2f
-2:	ldgp	gp,0(gp)
-#endif
-	SYSCALL_ERROR_HANDLER
+PSEUDO_END(__syscall_rt_sigaction)
 
-END(__syscall_rt_sigaction)
+/* To enable unwinding through the signal frame without special hackery
+   elsewhere, describe the entire struct sigcontext with unwind info.
+   Note that we begin the unwind info one instruction before the start
+   of the function; the unwinder will subtract one from the return address
+   attempting to find the call instruction that led us here, since we
+   didn't get here via a normal call.  */
+
+	.macro SIGCONTEXT_REGS_I base, from=0
+	cfi_offset (\from, \base + (4 + \from) * 8)
+	.if	30-\from
+	SIGCONTEXT_REGS_I \base, "(\from+1)"
+	.endif
+	.endm
+
+	.macro SIGCONTEXT_REGS_F base, from=32
+	cfi_offset (\from, \base + (4 + 1 + \from) * 8)
+	.if	62-\from
+	SIGCONTEXT_REGS_F \base, "(\from+1)"
+	.endif
+	.endm
+
+	.macro SIGCONTEXT_REGS base
+	SIGCONTEXT_REGS_I \base
+	SIGCONTEXT_REGS_F \base
+	cfi_offset (63, \base + (4 + 32 + 1 + 32) * 8)
+	cfi_offset (64, \base + 2 * 8)
+	.endm
 
-	.align	5
-	.ent	sigreturn
+	.align	4
+	nop
+	nop
+	nop
+
+	cfi_startproc
+	cfi_return_column (64)
+	SIGCONTEXT_REGS -648
+	cfi_def_cfa_offset (648)
+	nop
 sigreturn:
-	.prologue 0
-	mov	sp,a0
-	ldi	v0,__NR_sigreturn
+	mov	sp, a0
+	ldi	v0, __NR_sigreturn
 	callsys
-	.end	sigreturn
-
-	.align	4
-	.ent	rt_sigreturn
+	cfi_endproc
+	.size	sigreturn, .-sigreturn
+	.type	sigreturn, @function
+
+	cfi_startproc
+	cfi_return_column (64)
+	SIGCONTEXT_REGS -648
+	cfi_def_cfa_offset (176 + 648)
+	nop
 rt_sigreturn:
-	.prologue 0
 	mov	sp,a0
 	ldi	v0,__NR_rt_sigreturn
 	callsys
-	.end	rt_sigreturn
+	cfi_endproc
+	.size	rt_sigreturn, .-rt_sigreturn
+	.type	rt_sigreturn, @function
+
 #else
 ENTRY(__syscall_rt_sigaction)
 	ldgp $29,0($27)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/select.S libc-20030708/sysdeps/unix/sysv/linux/alpha/select.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/select.S	2003-01-07 09:45:23.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/select.S	2003-07-08 22:58:14.000000000 +0900
@@ -19,7 +19,21 @@
 #include <sysdep-cancel.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
 
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define SELECT	__select_tv64
+#else
+#define SELECT	__select
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(SELECT, select, 5)
+	ret
+PSEUDO_END(SELECT)
+#else
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
    that POSIX requires tv_sec to be time_t.
@@ -30,14 +44,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define SELECT	__select_tv64
-#else
-#define SELECT	__select
-#endif
-
 LEAF(SELECT, 64)
 	ldgp	gp, 0(pv)
 	subq	sp, 64, sp
@@ -210,6 +216,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(SELECT)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 default_symbol_version (__select_tv64, __select, GLIBC_2.1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/setfpucw.c libc-20030708/sysdeps/unix/sysv/linux/alpha/setfpucw.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/setfpucw.c	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/setfpucw.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Set FP exception mask and rounding mode.
-   Copyright (C) 1996, 1997, 1998 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -20,9 +20,11 @@
 #include <fpu_control.h>
 #include <asm/fpu.h>
 
-
 extern void		__ieee_set_fp_control (unsigned long);
+libc_hidden_proto(__ieee_set_fp_control)
+
 extern unsigned long	__ieee_get_fp_control (void);
+libc_hidden_proto(__ieee_get_fp_control)
 
 static inline unsigned long
 rdfpcr (void)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/setitimer.S libc-20030708/sysdeps/unix/sysv/linux/alpha/setitimer.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/setitimer.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/setitimer.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,7 +19,21 @@
 #include <sysdep.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
 
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define SETITIMER	__setitimer_tv64
+#else
+#define SETITIMER	__setitimer
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(SETITIMER, setitimer, 3)
+	ret
+PSEUDO_END(SETITIMER)
+#else
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
    that POSIX requires tv_sec to be time_t.
@@ -30,14 +44,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define SETITIMER	__setitimer_tv64
-#else
-#define SETITIMER	__setitimer
-#endif
-
 LEAF(SETITIMER, 48)
 	ldgp	gp, 0(pv)
 	subq	sp, 48, sp
@@ -116,6 +122,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(SETITIMER)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 default_symbol_version (__setitimer_tv64, __setitimer, GLIBC_2.1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/settimeofday.S libc-20030708/sysdeps/unix/sysv/linux/alpha/settimeofday.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/settimeofday.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/settimeofday.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,7 +19,21 @@
 #include <sysdep.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
 
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define SETTIMEOFDAY	__settimeofday_tv64
+#else
+#define SETTIMEOFDAY	__settimeofday
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(SETTIMEOFDAY, settimeofday, 2)
+	ret
+PSEUDO_END(SETTIMEOFDAY)
+#else
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
    that POSIX requires tv_sec to be time_t.
@@ -30,14 +44,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define SETTIMEOFDAY	__settimeofday_tv64
-#else
-#define SETTIMEOFDAY	__settimeofday
-#endif
-
 LEAF(SETTIMEOFDAY, 16)
 	ldgp	gp, 0(pv)
 	subq	sp, 16, sp
@@ -97,6 +103,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(SETTIMEOFDAY)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 default_symbol_version (__settimeofday_tv64, __settimeofday, GLIBC_2.1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/sigaction.c libc-20030708/sysdeps/unix/sysv/linux/alpha/sigaction.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/sigaction.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/sigaction.c	2003-06-21 01:24:36.000000000 +0900
@@ -0,0 +1,33 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+/*
+ * In order to get the hidden arguments for rt_sigaction set up
+ * properly, we need to call the assembly version.  Detect this in the
+ * INLINE_SYSCALL macro, and fail to expand inline in that case.
+ */
+
+#undef INLINE_SYSCALL
+#define INLINE_SYSCALL(name, nr, args...)       \
+        (__NR_##name == __NR_rt_sigaction       \
+         ? __syscall_rt_sigaction(args)         \
+         : INLINE_SYSCALL1(name, nr, args))
+
+#include <sysdeps/unix/sysv/linux/sigaction.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/sigprocmask.c libc-20030708/sysdeps/unix/sysv/linux/alpha/sigprocmask.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/sigprocmask.c	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/sigprocmask.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993, 1995, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1993, 1995, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Mosberger (davidm@azstarnet.com).
 
@@ -17,14 +17,13 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <errno.h>
 #include <sysdep.h>
 #include <signal.h>
 
 /* When there is kernel support for more than 64 signals, we'll have to
    switch to a new system call convention here.  */
 
-extern unsigned long __osf_sigprocmask (int how, unsigned long newmask);
-
 int
 __sigprocmask (int how, const sigset_t *set, sigset_t *oset)
 {
@@ -32,15 +31,14 @@
   long result;
 
   if (set)
-    {
-      setval = set->__val[0];
-    }
+    setval = set->__val[0];
   else
     {
       setval = 0;
       how = SIG_BLOCK;	/* ensure blocked mask doesn't get changed */
     }
-  result = __osf_sigprocmask (how, setval);
+
+  result = INLINE_SYSCALL (osf_sigprocmask, 2, how, setval);
   if (result == -1)
     /* If there are ever more than 63 signals, we need to recode this
        in assembler since we wouldn't be able to distinguish a mask of
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/syscalls.list libc-20030708/sysdeps/unix/sysv/linux/alpha/syscalls.list
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/syscalls.list	2003-02-06 06:41:03.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/syscalls.list	2003-07-08 22:58:14.000000000 +0900
@@ -1,69 +1,66 @@
 # File name	Caller	Syscall name	# args	Strong name	Weak names
 
-oldmsgctl	EXTRA	msgctl		3	__old_msgctl	msgctl@GLIBC_2.0
-msgget		-	msgget		2	__msgget	msgget
-msgrcv		-	msgrcv		C:5	__msgrcv	msgrcv
-msgsnd		-	msgsnd		C:4	__msgsnd	msgsnd
-shmat		-	osf_shmat	3	__shmat		shmat
-oldshmctl	EXTRA	shmctl		3	__old_shmctl	shmctl@GLIBC_2.0
-shmdt		-	shmdt		1	__shmdt		shmdt
-shmget		-	shmget		3	__shmget	shmget
-semop		-	semop		3	__semop		semop
-semget		-	semget		3	__semget	semget
-oldsemctl	EXTRA	semctl		4	__old_semctl	semctl@GLIBC_2.0
+oldmsgctl	EXTRA	msgctl		i:iip	__old_msgctl	msgctl@GLIBC_2.0
+msgget		-	msgget		i:ii	__msgget	msgget
+msgrcv		-	msgrcv		Ci:ibnii __msgrcv	msgrcv
+msgsnd		-	msgsnd		Ci:ibni	__msgsnd	msgsnd
+shmat		-	osf_shmat	i:ipi	__shmat		shmat
+oldshmctl	EXTRA	shmctl		i:iip	__old_shmctl	shmctl@GLIBC_2.0
+shmdt		-	shmdt		i:s	__shmdt		shmdt
+shmget		-	shmget		i:iii	__shmget	shmget
+semop		-	semop		i:ipi	__semop		semop
+semtimedop	-	semtimedop	i:ipip	semtimedop
+semget		-	semget		i:iii	__semget	semget
+oldsemctl	EXTRA	semctl		i:iiii	__old_semctl	semctl@GLIBC_2.0
 
-osf_sigprocmask	-	osf_sigprocmask	2	__osf_sigprocmask
 sigstack	-	sigstack	2	sigstack
 vfork		-	vfork		0	__vfork		vfork
 
-getpeername	-	getpeername	3	__getpeername	getpeername
-getpriority	-	getpriority	2	__getpriority	getpriority
-mmap		-	mmap		6	__mmap		mmap __mmap64 mmap64
-llseek		EXTRA	lseek		C:3	__libc_lseek64	__llseek llseek __lseek64 lseek64
+getpeername	-	getpeername	i:ipp	__getpeername	getpeername
+getpriority	-	getpriority	i:ii	__getpriority	getpriority
+mmap		-	mmap		b:aniiii __mmap		mmap __mmap64 mmap64
+llseek		EXTRA	lseek		C:3	__libc_lseek	__lseek lseek __libc_lseek64 __llseek llseek __lseek64 lseek64
+lseek		llseek	-
 posix_fadvise64	-	fadvise64	4	posix_fadvise64	posix_fadvise
-pread		-	pread		C:4	__libc_pread	__libc_pread64 __pread pread __pread64 pread64
-pwrite		-	pwrite		C:4	__libc_pwrite	__libc_pwrite64 __pwrite pwrite __pwrite64 pwrite64
-fstatfs		-	fstatfs		2	__fstatfs	fstatfs __fstatfs64 fstatfs64
-statfs		-	statfs		2	__statfs	statfs statfs64
+pread		-	pread64		C:4	__libc_pread	__libc_pread64 __pread pread __pread64 pread64
+pwrite		-	pwrite64		C:4	__libc_pwrite	__libc_pwrite64 __pwrite pwrite __pwrite64 pwrite64
+fstatfs		-	fstatfs		i:ip	__fstatfs	fstatfs __fstatfs64 fstatfs64
+statfs		-	statfs		i:sp	__statfs	statfs statfs64
 getrlimit	-	getrlimit	2	__getrlimit	getrlimit getrlimit64
 setrlimit	-	setrlimit	2	__setrlimit	setrlimit64 setrlimit
 ftruncate	-	ftruncate	2	__ftruncate	ftruncate __ftruncate64 ftruncate64
 truncate	-	truncate	2	truncate	truncate64
 readahead	-	readahead	3	__readahead	readahead
 sendfile	-	sendfile	i:iipi	sendfile	sendfile64
-
-# these are actually common with the x86:
-sys_ustat	ustat	ustat		2	__syscall_ustat
-sys_mknod	xmknod	mknod		3	__syscall_mknod
+open		-	open		Ci:siv	__libc_open	__open open !__libc_open64 __open64 open64
+open64		open	-
 
 # proper socket implementations:
-accept		-	accept		C:3	__libc_accept	__accept accept
-bind		-	bind		3	__bind		bind
-connect		-	connect		C:3	__libc_connect	__connect_internal __connect connect
-getpeername	-	getpeername	3	__getpeername	getpeername
-getsockname	-	getsockname	3	__getsockname	getsockname
-getsockopt	-	getsockopt	5	__getsockopt	getsockopt
-listen		-	listen		2	__listen	listen
-recv		-	recv		C:4	__libc_recv	__recv recv
-recvfrom	-	recvfrom	C:6	__libc_recvfrom	__recvfrom recvfrom
-recvmsg		-	recvmsg		C:3	__libc_recvmsg	__recvmsg recvmsg
+accept		-	accept		Ci:iBN	__libc_accept	__accept accept
+bind		-	bind		i:ipi	__bind		bind
+connect		-	connect		Ci:ipi	__libc_connect	__connect_internal __connect connect
+getpeername	-	getpeername	i:ipp	__getpeername	getpeername
+getsockname	-	getsockname	i:ipp	__getsockname	getsockname
+getsockopt	-	getsockopt	i:iiiBN	__getsockopt	getsockopt
+listen		-	listen		i:ii	__listen	listen
+recv		-	recv		Ci:ibni	__libc_recv	__recv recv
+recvfrom	-	recvfrom	Ci:ibniBN	__libc_recvfrom	__recvfrom recvfrom
+recvmsg		-	recvmsg		Ci:ipi	__libc_recvmsg	__recvmsg recvmsg
+send		-	send		Ci:ibni	__libc_send	__send send
+sendmsg		-	sendmsg		Ci:ipi	__libc_sendmsg	__sendmsg sendmsg
+sendto		-	sendto		Ci:ibnibn	__libc_sendto	__sendto sendto
+setsockopt	-	setsockopt	i:iiibn	__setsockopt	setsockopt
+shutdown	-	shutdown	i:ii	__shutdown	shutdown
+socket		-	socket		i:iii	__socket	socket
+socketpair	-	socketpair	i:iiif	__socketpair	socketpair
+
 ptrace		-	ptrace		4	__ptrace	ptrace
-send		-	send		C:4	__libc_send	__send send
-sendmsg		-	sendmsg		C:3	__libc_sendmsg	__sendmsg sendmsg
-sendto		-	sendto		C:6	__libc_sendto	__sendto sendto
-setsockopt	-	setsockopt	5	__setsockopt	setsockopt
-shutdown	-	shutdown	2	__shutdown	shutdown
-socket		-	socket		3	__socket	socket
-socketpair	-	socketpair	4	__socketpair	socketpair
 
 # access pci space protected from machine checks:
 pciconfig_read	EXTRA	pciconfig_read	5	pciconfig_read
 pciconfig_write	EXTRA	pciconfig_write	5	pciconfig_write
 pciconfig_iobase EXTRA	pciconfig_iobase 3	__pciconfig_iobase pciconfig_iobase
 
-# Wrapper for adjtimex.
-adjtimex       -       syscall_adjtimex 1      __syscall_adjtimex syscall_adjtimex
-
 # support old timeval32 entry points
 osf_select	-	osf_select	C:5	__select_tv32  __select@GLIBC_2.0 select@GLIBC_2.0
 osf_gettimeofday -	osf_gettimeofday 2	__gettimeofday_tv32  __gettimeofday@GLIBC_2.0 gettimeofday@GLIBC_2.0
@@ -73,7 +70,3 @@
 osf_utimes	-	osf_utimes	2	__utimes_tv32  utimes@GLIBC_2.0
 osf_getrusage	-	osf_getrusage	2	__getrusage_tv32  getrusage@GLIBC_2.0
 osf_wait4	-	osf_wait4	2	__wait4_tv32  wait4@GLIBC_2.0
-old_adjtimex	-	old_adjtimex	1	__adjtimex_tv32  __adjtimex@GLIBC_2.0 adjtimex@GLIBC_2.0
-
-# and one for timeval64 entry points
-adjtimex	adjtime	adjtimex	1	__syscall_adjtimex_tv64
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/alpha/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/sysdep.h	2003-01-27 06:07:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/sysdep.h	2003-07-08 22:58:14.000000000 +0900
@@ -60,17 +60,25 @@
 #define __NR_osf_getsysinfo	256
 #define __NR_osf_setsysinfo	257
 
+/* Help old kernel headers where particular syscalls are not available.  */
+#ifndef __NR_semtimedop
+# define __NR_semtimedop	423
+#endif
+
 /*
  * In order to get the hidden arguments for rt_sigaction set up
- * properly, we need to call the assembly version.  Detect this in the
- * INLINE_SYSCALL macro, and fail to expand inline in that case.
+ * properly, we need to call the assembly version.  This shouldn't
+ * happen except for inside sigaction.c, where we handle this
+ * specially.  Catch other uses and error.
  */
 
 #undef INLINE_SYSCALL
-#define INLINE_SYSCALL(name, nr, args...)	\
-	(__NR_##name == __NR_rt_sigaction	\
-	 ? __syscall_##name(args)		\
-	 : INLINE_SYSCALL1(name, nr, args))
+#define INLINE_SYSCALL(name, nr, args...)				\
+({									\
+	extern char ChEcK[__NR_##name == __NR_rt_sigaction ? -1 : 1]	\
+	  __attribute__((unused));					\
+	INLINE_SYSCALL1(name, nr, args);				\
+})
 
 #undef INTERNAL_SYSCALL
 #define INTERNAL_SYSCALL(name, err_out, nr, args...)			\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ustat.c libc-20030708/sysdeps/unix/sysv/linux/alpha/ustat.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/ustat.c	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/ustat.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -17,11 +17,10 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <errno.h>
 #include <sys/ustat.h>
 #include <sys/sysmacros.h>
-
-
-extern int __syscall_ustat (unsigned int dev, struct ustat *ubuf);
+#include <sysdep.h>
 
 int
 ustat (dev_t dev, struct ustat *ubuf)
@@ -31,5 +30,5 @@
   /* We must convert the value to dev_t type used by the kernel.  */
   k_dev = ((major (dev) & 0xff) << 8) | (minor (dev) & 0xff);
 
-  return __syscall_ustat (k_dev, ubuf);
+  return INLINE_SYSCALL (ustat, 2, k_dev, ubuf);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/utimes.S libc-20030708/sysdeps/unix/sysv/linux/alpha/utimes.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/utimes.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/utimes.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,7 +19,21 @@
 #include <sysdep.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
 
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define UTIMES	__utimes_tv64
+#else
+#define UTIMES	__utimes
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(UTIMES, utimes, 2)
+	ret
+PSEUDO_END(UTIMES)
+#else
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
    that POSIX requires tv_sec to be time_t.
@@ -30,14 +44,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define UTIMES	__utimes_tv64
-#else
-#define UTIMES	__utimes
-#endif
-
 LEAF(UTIMES, 16)
 	ldgp	gp, 0(pv)
 	subq	sp, 16, sp
@@ -102,6 +108,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(UTIMES)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 default_symbol_version (__utimes_tv64, __utimes, GLIBC_2.1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/wait4.S libc-20030708/sysdeps/unix/sysv/linux/alpha/wait4.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/wait4.S	2002-11-09 04:35:15.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/wait4.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,7 +19,21 @@
 #include <sysdep.h>
 #define _ERRNO_H        1
 #include <bits/errno.h>
+#include "kernel-features.h"
 
+.text
+
+#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
+#define WAIT4	__wait4_tv64
+#else
+#define WAIT4	__wait4
+#endif
+
+#if defined __ASSUME_TIMEVAL64
+PSEUDO(WAIT4, wait4, 4)
+	ret
+PSEUDO_END(WAIT4)
+#else
 /* The problem here is that initially we made struct timeval compatible with
    OSF/1, using int32.  But we defined time_t with uint64, and later found
    that POSIX requires tv_sec to be time_t.
@@ -30,14 +44,6 @@
    functions which have RT equivalents.  */
 .comm __libc_missing_axp_tv64, 4
 
-.text
-
-#if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
-#define WAIT4	__wait4_tv64
-#else
-#define WAIT4	__wait4
-#endif
-
 LEAF(WAIT4, 32)
 	ldgp	gp, 0(pv)
 	subq	sp, 32, sp
@@ -135,6 +141,7 @@
 	SYSCALL_ERROR_HANDLER
 
 END(WAIT4)
+#endif /* __ASSUME_TIMEVAL64 */
 
 #if defined HAVE_ELF && defined PIC && defined DO_VERSIONING
 default_symbol_version (__wait4_tv64, __wait4, GLIBC_2.1)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/xmknod.c libc-20030708/sysdeps/unix/sysv/linux/alpha/xmknod.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/xmknod.c	2002-08-04 17:23:07.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/xmknod.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,6 @@
 /* xmknod call using old-style Unix mknod system call.
-   Copyright (C) 1991,1993,1995,1996,1997,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1993,1995,1996,1997,2002,2003
+   Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,8 +22,7 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <sys/sysmacros.h>
-
-extern int __syscall_mknod (const char *, unsigned int, unsigned int);
+#include <sysdep.h>
 
 /* Create a device file named PATH, with permission and special bits MODE
    and device number DEV (which can be constructed from major and minor
@@ -41,7 +41,7 @@
   /* We must convert the value to dev_t type used by the kernel.  */
   k_dev = ((major (*dev) & 0xff) << 8) | (minor (*dev) & 0xff);
 
-  return __syscall_mknod (path, mode, k_dev);
+  return INLINE_SYSCALL (mknod, 3, path, mode, k_dev);
 }
 
 weak_alias (__xmknod, _xmknod)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/xstatconv.c libc-20030708/sysdeps/unix/sysv/linux/alpha/xstatconv.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/alpha/xstatconv.c	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/alpha/xstatconv.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Convert between the kernel's `struct stat' format, and libc's.
-   Copyright (C) 1997 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,11 +17,15 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <errno.h>
 #include <string.h>
+#include <sys/stat.h>
+#include <kernel_stat.h>
+#include <xstatconv.h>
 
 
-static inline int
-xstat_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
+int
+__xstat_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
 {
   switch (vers)
     {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/arm/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/arm/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/arm/bits/mman.h	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/arm/bits/mman.h	2003-03-03 18:57:38.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/ARM version.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -52,11 +52,13 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	0x0100		/* Stack-like segment.  */
-# define MAP_DENYWRITE	0x0800		/* ETXTBSY */
-# define MAP_EXECUTABLE	0x1000		/* Mark it as an executable.  */
-# define MAP_LOCKED	0x2000		/* Lock the mapping.  */
-# define MAP_NORESERVE	0x4000		/* Don't check for reservations.  */
+# define MAP_GROWSDOWN	0x00100		/* Stack-like segment.  */
+# define MAP_DENYWRITE	0x00800		/* ETXTBSY */
+# define MAP_EXECUTABLE	0x01000		/* Mark it as an executable.  */
+# define MAP_LOCKED	0x02000		/* Lock the mapping.  */
+# define MAP_NORESERVE	0x04000		/* Don't check for reservations.  */
+# define MAP_POPULATE	0x08000		/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	0x10000		/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/arm/mmap64.S libc-20030708/sysdeps/unix/sysv/linux/arm/mmap64.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/arm/mmap64.S	2001-07-08 04:21:33.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/arm/mmap64.S	2003-03-28 21:28:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,6 +21,8 @@
 #define	EINVAL		22
 #define	ENOSYS		38
 
+#include "kernel-features.h"
+
 	/* The mmap2 system call takes six arguments, all in registers.  */
 	.text
 ENTRY (__mmap64)
@@ -39,6 +41,10 @@
 	swi	SYS_ify (mmap2)
 	cmn	r0, $4096
 	LOADREGS(ccfd, sp!, {r4, r5, pc})
+# ifdef __ASSUME_MMAP2_SYSCALL
+	ldmfd	sp!, {r4, r5, lr}
+	b	PLTJMP(syscall_error)
+# else
 	cmn	r0, $ENOSYS
 	ldmnefd	sp!, {r4, r5, lr}
 	bne	PLTJMP(syscall_error)
@@ -49,6 +55,7 @@
 	teq	r5, $0
 	ldmeqfd	sp!, {r4, r5, lr}
 	beq	PLTJMP(__mmap)
+# endif
 .Linval:
 	mov	r0, $-EINVAL
 	ldmfd	sp!, {r4, r5, lr}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/arm/sigaction.c libc-20030708/sysdeps/unix/sysv/linux/arm/sigaction.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/arm/sigaction.c	2003-01-03 08:26:04.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/arm/sigaction.c	2003-03-28 21:28:20.000000000 +0900
@@ -22,6 +22,7 @@
 
 #include <sysdep.h>
 #include <sys/syscall.h>
+#include <kernel-features.h>
 
 /* The difference here is that the sigaction structure used in the
    kernel is not the same as we use in the libc.  Therefore we must
@@ -60,15 +61,21 @@
      const struct sigaction *act;
      struct sigaction *oact;
 {
+#ifndef __ASSUME_REALTIME_SIGNALS
   struct old_kernel_sigaction k_sigact, k_osigact;
+#endif
   int result;
 
 #ifdef __NR_rt_sigaction
   /* First try the RT signals.  */
+# ifndef __ASSUME_REALTIME_SIGNALS
   if (!__libc_missing_rt_sigs)
+# endif
     {
       struct kernel_sigaction kact, koact;
+# ifndef __ASSUME_REALTIME_SIGNALS
       int saved_errno = errno;
+# endif
 
       if (act)
 	{
@@ -99,7 +106,9 @@
 			       act ? __ptrvalue (&kact) : NULL,
 			       oact ? __ptrvalue (&koact) : NULL, _NSIG / 8);
 
+# ifndef __ASSUME_REALTIME_SIGNALS
       if (result >= 0 || errno != ENOSYS)
+# endif
 	{
 	  if (oact && result >= 0)
 	    {
@@ -113,17 +122,20 @@
 	  return result;
 	}
 
+# ifndef __ASSUME_REALTIME_SIGNALS
       __set_errno (saved_errno);
       __libc_missing_rt_sigs = 1;
+# endif
     }
 #endif
 
+#ifndef __ASSUME_REALTIME_SIGNALS
   if (act)
     {
       k_sigact.k_sa_handler = act->sa_handler;
       k_sigact.sa_mask = act->sa_mask.__val[0];
       k_sigact.sa_flags = act->sa_flags;
-#ifdef HAVE_SA_RESTORER
+# ifdef HAVE_SA_RESTORER
       /* See the comments above for why we test SA_ONSTACK.  */
       if (k_sigact.sa_flags & (SA_RESTORER | SA_ONSTACK))
 	k_sigact.sa_restorer = act->sa_restorer;
@@ -132,7 +144,7 @@
 	  k_sigact.sa_restorer = choose_restorer (k_sigact.sa_flags);
 	  k_sigact.sa_flags |= SA_RESTORER;
 	}
-#endif
+# endif
     }
   result = INLINE_SYSCALL (sigaction, 3, sig,
 			   act ? __ptrvalue (&k_sigact) : NULL,
@@ -142,11 +154,12 @@
       oact->sa_handler = k_osigact.k_sa_handler;
       oact->sa_mask.__val[0] = k_osigact.sa_mask;
       oact->sa_flags = k_osigact.sa_flags;
-#ifdef HAVE_SA_RESTORER
+# ifdef HAVE_SA_RESTORER
       oact->sa_restorer = k_osigact.sa_restorer;
-#endif
+# endif
     }
   return result;
+#endif
 }
 libc_hidden_def (__libc_sigaction)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/arm/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/arm/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/arm/sysdep.h	2003-02-21 05:22:10.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/arm/sysdep.h	2003-03-28 21:28:20.000000000 +0900
@@ -64,6 +64,22 @@
   SYSCALL_ERROR_HANDLER							      \
   END (name)
 
+#undef	PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args)			      \
+  .text;								      \
+  ENTRY (name);								      \
+    DO_CALL (syscall_name, args);
+
+#define PSEUDO_RET_NOERRNO						      \
+    RETINSTR(mov, pc, lr);
+
+#undef ret_NOERRNO
+#define ret_NOERRNO PSEUDO_RET_NOERRNO
+
+#undef	PSEUDO_END_NOERRNO
+#define	PSEUDO_END_NOERRNO(name)					      \
+  END (name)
+
 #if NOT_IN_libc
 # define SYSCALL_ERROR __local_syscall_error
 # define SYSCALL_ERROR_HANDLER					\
@@ -158,7 +174,7 @@
        asm volatile ("swi	%1	@ syscall " #name	\
 		     : "=r" (_a1)				\
 		     : "i" (SYS_ify(name)) ASM_ARGS_##nr	\
-		     : "a1", "memory");				\
+		     : "memory");				\
        _sys_result = _a1;					\
      }								\
      (int) _sys_result; })
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/arm/vfork.S libc-20030708/sysdeps/unix/sysv/linux/arm/vfork.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/arm/vfork.S	2003-01-01 04:13:28.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/arm/vfork.S	2003-03-28 21:28:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Philip Blundell <philb@gnu.org>.
 
@@ -20,6 +20,7 @@
 #include <sysdep.h>
 #define _ERRNO_H	1
 #include <bits/errno.h>
+#include <kernel-features.h>
 
 /* Clone the calling process, but without copying the whole address space.
    The calling process is suspended until the new process exits or is
@@ -33,17 +34,23 @@
 	cmn	a1, #4096
 	RETINSTR(movcc, pc, lr)
 
+# ifdef __ASSUME_VFORK_SYSCALL
+	b	PLTJMP(C_SYMBOL_NAME(__syscall_error))
+# else
 	/* Check if vfork syscall is known at all.  */
 	ldr	a2, =-ENOSYS
 	teq	a1, a2
 	bne	PLTJMP(C_SYMBOL_NAME(__syscall_error))
+# endif
 #endif
 
+#ifndef __ASSUME_VFORK_SYSCALL
 	/* If we don't have vfork, fork is close enough.  */
 	swi	__NR_fork
 	cmn	a1, #4096
 	RETINSTR(movcc, pc, lr)
     	b	PLTJMP(C_SYMBOL_NAME(__syscall_error))
+#endif
 
 PSEUDO_END (__vfork)
 libc_hidden_def (__vfork)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/bits/in.h libc-20030708/sysdeps/unix/sysv/linux/bits/in.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/bits/in.h	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/bits/in.h	2003-06-12 08:54:05.000000000 +0900
@@ -115,6 +115,11 @@
 #define IPV6_MTU_DISCOVER	23
 #define IPV6_MTU		24
 #define IPV6_RECVERR		25
+#define IPV6_V6ONLY		26
+#define IPV6_JOIN_ANYCAST	27
+#define IPV6_LEAVE_ANYCAST	28
+#define IPV6_IPSEC_POLICY	34
+#define IPV6_XFRM_POLICY	35
 
 #define SCM_SRCRT		IPV6_RXSRCRT
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/bits/posix_opt.h libc-20030708/sysdeps/unix/sysv/linux/bits/posix_opt.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/bits/posix_opt.h	2002-11-29 10:32:18.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/bits/posix_opt.h	2003-03-03 13:52:01.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define POSIX options for Linux.
-   Copyright (C) 1996, 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1999,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -90,4 +90,7 @@
 /* The `spawn' function family is supported.  */
 #define _POSIX_SPAWN	200112L
 
+/* The monotonic clock might be available.  */
+#define _POSIX_MONOTONIC_CLOCK	0
+
 #endif /* bits/posix_opt.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/bits/sched.h libc-20030708/sysdeps/unix/sysv/linux/bits/sched.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/bits/sched.h	2002-11-22 09:08:21.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/bits/sched.h	2003-06-12 08:54:05.000000000 +0900
@@ -1,6 +1,6 @@
 /* Definitions of constants and data structure for POSIX 1003.1b-1993
    scheduling interface.
-   Copyright (C) 1996,1997,1998,1999,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-1999,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -37,7 +37,6 @@
 # define CLONE_FS      0x00000200 /* Set if fs info shared between processes.  */
 # define CLONE_FILES   0x00000400 /* Set if open files shared between processes.  */
 # define CLONE_SIGHAND 0x00000800 /* Set if signal handlers shared.  */
-# define CLONE_PID     0x00001000 /* Set if pid shared.  */
 # define CLONE_PTRACE  0x00002000 /* Set if tracing continues on the child.  */
 # define CLONE_VFORK   0x00004000 /* Set if the parent wants the child to
 				     wake it up on mm_release.  */
@@ -86,3 +85,39 @@
   };
 # undef __need_schedparam
 #endif
+
+
+#if defined _SCHED_H && !defined __cpu_set_t_defined
+# define __cpu_set_t_defined
+/* Size definition for CPU sets.  */
+# define __CPU_SETSIZE	1024
+# define __NCPUBITS	(8 * sizeof (__cpu_mask))
+
+/* Type for array elements in 'cpu_set'.  */
+typedef unsigned long int __cpu_mask;
+
+/* Basic access functions.  */
+# define __CPUELT(cpu)	((cpu) / __NCPUBITS)
+# define __CPUMASK(cpu)	((__cpu_mask) 1 << ((cpu) % __NCPUBITS))
+
+/* Data structure to describe CPU mask.  */
+typedef struct
+{
+  __cpu_mask __bits[__CPU_SETSIZE / __NCPUBITS];
+} cpu_set_t;
+
+/* Access functions for CPU masks.  */
+# define __CPU_ZERO(cpusetp) \
+  do {									      \
+    unsigned int __i;							      \
+    cpu_set *__arr = (cpusetp);						      \
+    for (__i = 0; __i < sizeof (cpu_set) / sizeof (__cpu_mask); ++__i)	      \
+      __arr->__bits[__i] = 0;						      \
+  } while (0)
+# define __CPU_SET(cpu, cpusetp) \
+  ((cpusetp)->__bits[__CPUELT (cpu)] |= __CPUMASK (cpu))
+# define __CPU_CLR(cpu, cpusetp) \
+  ((cpusetp)->__bits[__CPUELT (cpu)] &= ~__CPUMASK (cpu))
+# define __CPU_ISSET(cpu, cpusetp) \
+  (((cpusetp)->__bits[__CPUELT (cpu)] & __CPUMASK (cpu)) != 0)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/bits/siginfo.h libc-20030708/sysdeps/unix/sysv/linux/bits/siginfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/bits/siginfo.h	2002-12-05 09:09:55.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/bits/siginfo.h	2003-04-28 23:53:26.000000000 +0900
@@ -1,5 +1,5 @@
 /* siginfo_t, sigevent and constants.  Linux version.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -69,8 +69,9 @@
 	/* POSIX.1b timers.  */
 	struct
 	  {
-	    unsigned int _timer1;
-	    unsigned int _timer2;
+	    int si_tid;		/* Timer ID.  */
+	    int si_overrun;	/* Overrun count.  */
+	    sigval_t si_sigval;	/* Signal value.  */
 	  } _timer;
 
 	/* POSIX.1b signals.  */
@@ -110,8 +111,8 @@
 /* X/Open requires some more fields with fixed names.  */
 # define si_pid		_sifields._kill.si_pid
 # define si_uid		_sifields._kill.si_uid
-# define si_timer1	_sifields._timer._timer1
-# define si_timer2	_sifields._timer._timer2
+# define si_timerid	_sifields._timer.si_tid
+# define si_overrun	_sifields._timer.si_overrun
 # define si_status	_sifields._sigchld.si_status
 # define si_utime	_sifields._sigchld.si_utime
 # define si_stime	_sifields._sigchld.si_stime
@@ -127,8 +128,10 @@
    signals.  */
 enum
 {
-  SI_ASYNCNL = -6,		/* Sent by asynch name lookup completion.  */
+  SI_ASYNCNL = -60,		/* Sent by asynch name lookup completion.  */
 # define SI_ASYNCNL	SI_ASYNCNL
+  SI_TKILL = -6,		/* Sent by tkill.  */
+# define SI_TKILL	SI_TKILL
   SI_SIGIO,			/* Sent by queued SIGIO. */
 # define SI_SIGIO	SI_SIGIO
   SI_ASYNCIO,			/* Sent by AIO completion.  */
@@ -267,9 +270,6 @@
 #  define __SIGEV_PAD_SIZE	((__SIGEV_MAX_SIZE / sizeof (int)) - 3)
 # endif
 
-/* Forward declaration of the `pthread_attr_t' type.  */
-struct __pthread_attr_s;
-
 typedef struct sigevent
   {
     sigval_t sigev_value;
@@ -280,6 +280,10 @@
       {
 	int _pad[__SIGEV_PAD_SIZE];
 
+	/* When SIGEV_SIGNAL and SIGEV_THREAD_ID set, LWP ID of the
+	   thread to receive the signal.  */
+	__pid_t _tid;
+
 	struct
 	  {
 	    void (*_function) (sigval_t);	/* Function to start.  */
@@ -299,8 +303,11 @@
 # define SIGEV_SIGNAL	SIGEV_SIGNAL
   SIGEV_NONE,			/* Other notification: meaningless.  */
 # define SIGEV_NONE	SIGEV_NONE
-  SIGEV_THREAD			/* Deliver via thread creation.  */
+  SIGEV_THREAD,			/* Deliver via thread creation.  */
 # define SIGEV_THREAD	SIGEV_THREAD
+
+  SIGEV_THREAD_ID = 4		/* Send signal to specific thread.  */
+#define SIGEV_THREAD_ID	SIGEV_THREAD_ID
 };
 
 #endif	/* have _SIGNAL_H.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/bits/signum.h libc-20030708/sysdeps/unix/sysv/linux/bits/signum.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/bits/signum.h	2003-02-22 09:01:06.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/bits/signum.h	2003-04-01 21:01:06.000000000 +0900
@@ -66,7 +66,7 @@
 #define SIGSYS		31	/* Bad system call.  */
 #define SIGUNUSED	31
 
-#define	_NSIG		64	/* Biggest signal number + 1
+#define	_NSIG		65	/* Biggest signal number + 1
 				   (including real-time signals).  */
 
 #define SIGRTMIN        (__libc_current_sigrtmin ())
@@ -75,6 +75,6 @@
 /* These are the hard limits of the kernel.  These values should not be
    used directly at user level.  */
 #define __SIGRTMIN	32
-#define __SIGRTMAX	_NSIG
+#define __SIGRTMAX	(_NSIG - 1)
 
 #endif	/* <signal.h> included.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/bits/stat.h	2002-12-31 09:00:47.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/bits/stat.h	2003-07-08 22:58:14.000000000 +0900
@@ -131,6 +131,8 @@
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
 #define _STATBUF_ST_RDEV
+/* Nanosecond resolution time values are supported.  */
+#define _STATBUF_ST_NSEC
 
 /* Encoding of the file mode.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/bits/statfs.h libc-20030708/sysdeps/unix/sysv/linux/bits/statfs.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/bits/statfs.h	2002-10-25 17:02:40.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/bits/statfs.h	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,7 +41,8 @@
 #endif
     __fsid_t f_fsid;
     __SWORD_TYPE f_namelen;
-    __SWORD_TYPE f_spare[6];
+    __SWORD_TYPE f_frsize;
+    __SWORD_TYPE f_spare[5];
   };
 
 #ifdef __USE_LARGEFILE64
@@ -56,7 +57,8 @@
     __fsfilcnt64_t f_ffree;
     __fsid_t f_fsid;
     __SWORD_TYPE f_namelen;
-    __SWORD_TYPE f_spare[6];
+    __SWORD_TYPE f_frsize;
+    __SWORD_TYPE f_spare[5];
   };
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/check_pf.c libc-20030708/sysdeps/unix/sysv/linux/check_pf.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/check_pf.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/check_pf.c	2003-07-08 22:58:14.000000000 +0900
@@ -0,0 +1,193 @@
+/* Determine protocol families for which interfaces exist.  Linux version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <ifaddrs.h>
+#include <netdb.h>
+#include <string.h>
+#include <time.h>
+#include <unistd.h>
+#include <sys/socket.h>
+
+#include <asm/types.h>
+#include <linux/netlink.h>
+#include <linux/rtnetlink.h>
+
+#include "kernel-features.h"
+
+
+static int
+make_request (int fd, pid_t pid, bool *seen_ipv4, bool *seen_ipv6)
+{
+  struct
+  {
+    struct nlmsghdr nlh;
+    struct rtgenmsg g;
+  } req;
+  struct sockaddr_nl nladdr;
+
+  req.nlh.nlmsg_len = sizeof (req);
+  req.nlh.nlmsg_type = RTM_GETADDR;
+  req.nlh.nlmsg_flags = NLM_F_ROOT | NLM_F_MATCH | NLM_F_REQUEST;
+  req.nlh.nlmsg_pid = 0;
+  req.nlh.nlmsg_seq = time (NULL);
+  req.g.rtgen_family = AF_UNSPEC;
+
+  memset (&nladdr, '\0', sizeof (nladdr));
+  nladdr.nl_family = AF_NETLINK;
+
+  if (TEMP_FAILURE_RETRY (__sendto (fd, (void *) &req, sizeof (req), 0,
+				    (struct sockaddr *) &nladdr,
+				    sizeof (nladdr))) < 0)
+    return -1;
+
+  *seen_ipv4 = false;
+  *seen_ipv6 = false;
+
+  bool done = false;
+  char buf[4096];
+  struct iovec iov = { buf, sizeof (buf) };
+
+  do
+    {
+      struct msghdr msg =
+	{
+	  (void *) &nladdr, sizeof (nladdr),
+	  &iov, 1,
+	  NULL, 0,
+	  0
+	};
+
+      ssize_t read_len = TEMP_FAILURE_RETRY (__recvmsg (fd, &msg, 0));
+      if (read_len < 0)
+	return -1;
+
+      if (msg.msg_flags & MSG_TRUNC)
+	return -1;
+
+      struct nlmsghdr *nlmh;
+      for (nlmh = (struct nlmsghdr *) buf;
+	   NLMSG_OK (nlmh, (size_t) read_len);
+	   nlmh = (struct nlmsghdr *) NLMSG_NEXT (nlmh, read_len))
+	{
+	  if ((pid_t) nlmh->nlmsg_pid != pid
+	      || nlmh->nlmsg_seq != req.nlh.nlmsg_seq)
+	    continue;
+
+	  if (nlmh->nlmsg_type == RTM_NEWADDR)
+	    {
+	      struct ifaddrmsg *ifam = (struct ifaddrmsg *) NLMSG_DATA (nlmh);
+
+	      switch (ifam->ifa_family)
+		{
+		case AF_INET:
+		  *seen_ipv4 = true;
+		  break;
+		case AF_INET6:
+		  *seen_ipv6 = true;
+		  break;
+		default:
+		  /* Ignore.  */
+		  break;
+		}
+	    }
+	  else if (nlmh->nlmsg_type == NLMSG_DONE)
+	    /* We found the end, leave the loop.  */
+	    done = true;
+	  else ;
+	}
+    }
+  while (! done);
+
+  __close (fd);
+
+  return 0;
+}
+
+
+/* We don't know if we have NETLINK support compiled in in our
+   Kernel.  */
+#if __ASSUME_NETLINK_SUPPORT == 0
+/* Define in ifaddrs.h.  */
+extern int __no_netlink_support attribute_hidden;
+#else
+# define __no_netlink_support 0
+#endif
+
+
+void
+attribute_hidden
+__check_pf (bool *seen_ipv4, bool *seen_ipv6)
+{
+  if (! __no_netlink_support)
+    {
+      int fd = __socket (PF_NETLINK, SOCK_RAW, NETLINK_ROUTE);
+
+      struct sockaddr_nl nladdr;
+      memset (&nladdr, '\0', sizeof (nladdr));
+      nladdr.nl_family = AF_NETLINK;
+
+      socklen_t addr_len = sizeof (nladdr);
+
+      if (fd >= 0
+	  && __bind (fd, (struct sockaddr *) &nladdr, sizeof (nladdr)) == 0
+	  && __getsockname (fd, (struct sockaddr *) &nladdr, &addr_len) == 0
+	  && make_request (fd, nladdr.nl_pid, seen_ipv4, seen_ipv6) == 0)
+	/* It worked.  */
+	return;
+
+      if (fd >= 0)
+	__close (fd);
+
+#if __ASSUME_NETLINK_SUPPORT == 0
+      /* Remember that there is no netlink support.  */
+      __no_netlink_support = 1;
+#else
+      /* We cannot determine what interfaces are available.  Be
+	 pessimistic.  */
+      *seen_ipv4 = true;
+      *seen_ipv6 = true;
+#endif
+    }
+
+#if __ASSUME_NETLINK_SUPPORT == 0
+  /* No netlink.  Get the interface list via getifaddrs.  */
+  struct ifaddrs *ifa = NULL;
+  if (getifaddrs (&ifa) != 0)
+    {
+      /* We cannot determine what interfaces are available.  Be
+	 pessimistic.  */
+      *seen_ipv4 = true;
+      *seen_ipv6 = true;
+      return;
+    }
+
+  *seen_ipv4 = false;
+  *seen_ipv6 = false;
+
+  struct ifaddrs *runp;
+  for (runp = ifa; runp != NULL; runp = runp->ifa_next)
+    if (runp->ifa_addr->sa_family == PF_INET)
+      *seen_ipv4 = true;
+    else if (runp->ifa_addr->sa_family == PF_INET6)
+      *seen_ipv6 = true;
+
+  (void) freeifaddrs (ifa);
+#endif
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/clock_getres.c libc-20030708/sysdeps/unix/sysv/linux/clock_getres.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/clock_getres.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/clock_getres.c	2003-03-03 13:48:47.000000000 +0900
@@ -0,0 +1,76 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#include "kernel-features.h"
+
+
+#ifdef __ASSUME_POSIX_TIMERS
+/* This means the REALTIME and MONOTONIC clock are definitely
+   supported in the kernel.  */
+# define SYSDEP_GETRES \
+  case CLOCK_REALTIME:							      \
+  case CLOCK_MONOTONIC:							      \
+    retval = INLINE_SYSCALL (clock_getres, 2, clock_id, res);		      \
+    break
+#elif defined __NR_clock_getres
+/* Is the syscall known to exist?  */
+extern int __libc_missing_posix_timers attribute_hidden;
+
+/* The REALTIME and MONOTONIC clock might be available.  Try the
+   syscall first.  */
+# define SYSDEP_GETRES \
+  case CLOCK_REALTIME:							      \
+  case CLOCK_MONOTONIC:							      \
+    {									      \
+      int e = EINVAL;							      \
+									      \
+      if (!__libc_missing_posix_timers)					      \
+	{								      \
+	  INTERNAL_SYSCALL_DECL (err);					      \
+	  int r = INTERNAL_SYSCALL (clock_getres, err, 2, clock_id, res);     \
+	  if (!INTERNAL_SYSCALL_ERROR_P (r, err))			      \
+	    {								      \
+	      retval = 0;						      \
+	      break;							      \
+	    }								      \
+									      \
+	  e = INTERNAL_SYSCALL_ERRNO (r, err);				      \
+	  if (e == ENOSYS)						      \
+	    {								      \
+	      __libc_missing_posix_timers = 1;				      \
+	      e = EINVAL;						      \
+	    }								      \
+	}								      \
+									      \
+      /* Fallback code.  */						      \
+      if (e == EINVAL && clock_id == CLOCK_REALTIME)			      \
+	HANDLE_REALTIME;						      \
+      else								      \
+	__set_errno (e);						      \
+    }									      \
+    break
+#endif
+
+#ifdef __NR_clock_getres
+/* We handled the REALTIME clock here.  */
+# define HANDLED_REALTIME	1
+#endif
+
+#include <sysdeps/posix/clock_getres.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/clock_gettime.c libc-20030708/sysdeps/unix/sysv/linux/clock_gettime.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/clock_gettime.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/clock_gettime.c	2003-03-03 13:49:06.000000000 +0900
@@ -0,0 +1,76 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#include "kernel-features.h"
+
+
+#ifdef __ASSUME_POSIX_TIMERS
+/* This means the REALTIME and MONOTONIC clock are definitely
+   supported in the kernel.  */
+# define SYSDEP_GETTIME \
+  case CLOCK_REALTIME:							      \
+  case CLOCK_MONOTONIC:							      \
+    retval = INLINE_SYSCALL (clock_gettime, 2, clock_id, tp);		      \
+    break
+#elif defined __NR_clock_gettime
+/* Is the syscall known to exist?  */
+int __libc_missing_posix_timers attribute_hidden;
+
+/* The REALTIME and MONOTONIC clock might be available.  Try the
+   syscall first.  */
+# define SYSDEP_GETTIME \
+  case CLOCK_REALTIME:							      \
+  case CLOCK_MONOTONIC:							      \
+    {									      \
+      int e = EINVAL;							      \
+									      \
+      if (!__libc_missing_posix_timers)					      \
+	{								      \
+	  INTERNAL_SYSCALL_DECL (err);					      \
+	  int r = INTERNAL_SYSCALL (clock_gettime, err, 2, clock_id, tp);     \
+	  if (!INTERNAL_SYSCALL_ERROR_P (r, err))			      \
+	    {								      \
+	      retval = 0;						      \
+	      break;							      \
+	    }								      \
+									      \
+	  e = INTERNAL_SYSCALL_ERRNO (r, err);				      \
+	  if (e == ENOSYS)						      \
+	    {								      \
+	      __libc_missing_posix_timers = 1;				      \
+	      e = EINVAL;						      \
+	    }								      \
+	}								      \
+									      \
+      /* Fallback code.  */						      \
+      if (e == EINVAL && clock_id == CLOCK_REALTIME)			      \
+	HANDLE_REALTIME;						      \
+      else								      \
+	__set_errno (e);						      \
+    }									      \
+    break
+#endif
+
+#ifdef __NR_clock_gettime
+/* We handled the REALTIME clock here.  */
+# define HANDLED_REALTIME	1
+#endif
+
+#include <sysdeps/unix/clock_gettime.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/clock_nanosleep.c libc-20030708/sysdeps/unix/sysv/linux/clock_nanosleep.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/clock_nanosleep.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/clock_nanosleep.c	2003-07-08 22:58:14.000000000 +0900
@@ -0,0 +1,81 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <time.h>
+
+#include <sysdep-cancel.h>
+#include "kernel-features.h"
+
+
+#ifdef __ASSUME_POSIX_TIMERS
+/* We can simply use the syscall.  The CPU clocks are not supported
+   with this function.  */
+int
+clock_nanosleep (clockid_t clock_id, int flags, const struct timespec *req,
+		 struct timespec *rem)
+{
+  INTERNAL_SYSCALL_DECL (err);
+  int r;
+
+  if (SINGLE_THREAD_P)
+    r = INTERNAL_SYSCALL (clock_nanosleep, err, 4, clock_id, flags, req, rem);
+  else
+    {
+      int oldstate = LIBC_CANCEL_ASYNC ();
+
+      r = INTERNAL_SYSCALL (clock_nanosleep, err, 4, clock_id, flags, req,
+			    rem);
+
+      LIBC_CANCEL_RESET (oldstate);
+    }
+
+  return (INTERNAL_SYSCALL_ERROR_P (r, err)
+	  ? INTERNAL_SYSCALL_ERRNO (r, err) : 0);
+}
+
+#else
+# ifdef __NR_clock_nanosleep
+/* Is the syscall known to exist?  */
+extern int __libc_missing_posix_timers attribute_hidden;
+
+/* The REALTIME and MONOTONIC clock might be available.  Try the
+   syscall first.  */
+#  define SYSDEP_NANOSLEEP \
+  if (!__libc_missing_posix_timers)					      \
+    {									      \
+      INTERNAL_SYSCALL_DECL (err);					      \
+									      \
+      int oldstate = LIBC_CANCEL_ASYNC ();				      \
+									      \
+      int r = INTERNAL_SYSCALL (clock_nanosleep, err, 4, clock_id, flags,     \
+				req, rem);				      \
+									      \
+      LIBC_CANCEL_RESET (oldstate);					      \
+									      \
+      if (!INTERNAL_SYSCALL_ERROR_P (r, err))				      \
+	return 0;							      \
+									      \
+      if (INTERNAL_SYSCALL_ERRNO (r, err) != ENOSYS)			      \
+	return INTERNAL_SYSCALL_ERRNO (r, err);				      \
+									      \
+      __libc_missing_posix_timers = 1;					      \
+    }
+# endif
+
+# include <sysdeps/unix/clock_nanosleep.c>
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/clock_settime.c libc-20030708/sysdeps/unix/sysv/linux/clock_settime.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/clock_settime.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/clock_settime.c	2003-03-03 13:49:24.000000000 +0900
@@ -0,0 +1,73 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#include "kernel-features.h"
+
+
+#ifdef __ASSUME_POSIX_TIMERS
+/* This means the REALTIME clock is definitely supported in the
+   kernel.  */
+# define SYSDEP_SETTIME \
+  case CLOCK_REALTIME:							      \
+    retval = INLINE_SYSCALL (clock_settime, 2, clock_id, tp);		      \
+    break
+#elif defined __NR_clock_settime
+/* Is the syscall known to exist?  */
+extern int __libc_missing_posix_timers attribute_hidden;
+
+/* The REALTIME clock might be available.  Try the syscall first.  */
+# define SYSDEP_SETTIME \
+  case CLOCK_REALTIME:							      \
+    {									      \
+      int e = EINVAL;							      \
+									      \
+      if (!__libc_missing_posix_timers)					      \
+	{								      \
+	  INTERNAL_SYSCALL_DECL (err);					      \
+	  int r = INTERNAL_SYSCALL (clock_settime, err, 2, clock_id, tp);     \
+	  if (!INTERNAL_SYSCALL_ERROR_P (r, err))			      \
+	    {								      \
+	      retval = 0;						      \
+	      break;							      \
+	    }								      \
+									      \
+	  e = INTERNAL_SYSCALL_ERRNO (r, err);				      \
+	  if (e == ENOSYS)						      \
+	    {								      \
+	      __libc_missing_posix_timers = 1;				      \
+	      e = EINVAL;						      \
+	    }								      \
+	}								      \
+									      \
+      /* Fallback code.  */						      \
+      if (e == EINVAL && clock_id == CLOCK_REALTIME)			      \
+	HANDLE_REALTIME;						      \
+      else								      \
+	__set_errno (e);						      \
+    }									      \
+    break
+#endif
+
+#ifdef __NR_clock_settime
+/* We handled the REALTIME clock here.  */
+# define HANDLED_REALTIME	1
+#endif
+
+#include <sysdeps/unix/clock_settime.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/configure libc-20030708/sysdeps/unix/sysv/linux/configure
--- glibc-2.3.2/sysdeps/unix/sysv/linux/configure	2003-02-26 10:07:12.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/configure	2003-03-23 11:10:04.000000000 +0900
@@ -44,7 +44,11 @@
 else
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <linux/version.h>
 #if !defined LINUX_VERSION_CODE || LINUX_VERSION_CODE <  (2 *65536+ 0 *256+ 10) /* 2.0.10 */
 eat flaming death
@@ -165,7 +169,11 @@
   abinum=`echo "$minimum_kernel.0.0.0" | sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\).*/\1,\2,\3/'`;
   cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
-#include "confdefs.h"
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
 #include <linux/version.h>
 #if LINUX_VERSION_CODE < $decnum
 eat flaming death
@@ -216,7 +224,8 @@
 /usr | /usr/)
   # 64-bit libraries on bi-arch platforms go in /lib64 instead of /lib
   case $machine in
-  sparc/sparc64 | x86_64 | powerpc/powerpc64 | s390/s390-64 )
+  sparc/sparc64 | x86_64 | powerpc/powerpc64 | s390/s390-64 | \
+  mips/mips64/n64/* )
     libc_cv_slibdir="/lib64"
     if test "$libdir" = '${exec_prefix}/lib'; then
       libdir='${exec_prefix}/lib64';
@@ -224,6 +233,14 @@
       libc_cv_localedir='${exec_prefix}/lib/locale'
     fi
     ;;
+  mips/mips64/n32/* )
+    libc_cv_slibdir="/lib32"
+    if test "$libdir" = '${exec_prefix}/lib'; then
+      libdir='${exec_prefix}/lib32';
+      # Locale data can be shared between 32bit and 64bit libraries
+      libc_cv_localedir='${exec_prefix}/lib/locale'
+    fi
+    ;;
   *)
     libc_cv_slibdir="/lib"
     ;;
@@ -303,6 +320,9 @@
   ia64*)
     ldd_rewrite_script=../sysdeps/unix/sysv/linux/ia64/ldd-rewrite.sed
     ;;
+  mips/*64*)
+    ldd_rewrite_script=../sysdeps/unix/sysv/linux/mips/mips64/ldd-rewrite.sed
+    ;;
   s390*)
     ldd_rewrite_script=../sysdeps/unix/sysv/linux/s390/ldd-rewrite.sed
     ;;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/configure.in libc-20030708/sysdeps/unix/sysv/linux/configure.in
--- glibc-2.3.2/sysdeps/unix/sysv/linux/configure.in	2003-02-02 05:22:36.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/configure.in	2003-03-23 11:10:04.000000000 +0900
@@ -157,7 +157,8 @@
 /usr | /usr/)
   # 64-bit libraries on bi-arch platforms go in /lib64 instead of /lib
   case $machine in
-  sparc/sparc64 | x86_64 | powerpc/powerpc64 | s390/s390-64 )
+  sparc/sparc64 | x86_64 | powerpc/powerpc64 | s390/s390-64 | \
+  mips/mips64/n64/* )
     libc_cv_slibdir="/lib64"
     if test "$libdir" = '${exec_prefix}/lib'; then
       libdir='${exec_prefix}/lib64';
@@ -165,6 +166,14 @@
       libc_cv_localedir='${exec_prefix}/lib/locale'
     fi
     ;;
+  mips/mips64/n32/* )
+    libc_cv_slibdir="/lib32"
+    if test "$libdir" = '${exec_prefix}/lib'; then
+      libdir='${exec_prefix}/lib32';
+      # Locale data can be shared between 32bit and 64bit libraries
+      libc_cv_localedir='${exec_prefix}/lib/locale'
+    fi
+    ;;
   *)
     libc_cv_slibdir="/lib"
     ;;
@@ -244,6 +253,9 @@
   ia64*)
     ldd_rewrite_script=../sysdeps/unix/sysv/linux/ia64/ldd-rewrite.sed
     ;;
+  mips/*64*)
+    ldd_rewrite_script=../sysdeps/unix/sysv/linux/mips/mips64/ldd-rewrite.sed
+    ;;
   s390*)
     ldd_rewrite_script=../sysdeps/unix/sysv/linux/s390/ldd-rewrite.sed
     ;;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/cris/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/cris/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/cris/sysdep.h	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/cris/sysdep.h	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Assembler macros for CRIS.
-   Copyright (C) 1999, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -106,6 +106,18 @@
   PLTJUMP (syscall_error)				@ \
   END (name)
 
+#define	PSEUDO_NOERRNO(name, syscall_name, args) \
+  ENTRY	(name)						@ \
+  DOARGS_##args						@ \
+  movu.w SYS_ify (syscall_name),$r9			@ \
+  break	13						@ \
+  UNDOARGS_return_##args
+
+#define ret_NOERRNO
+
+#define	PSEUDO_END_NOERRNO(name) \
+  END (name)
+
 #define DOARGS_0
 #define DOARGS_1
 #define DOARGS_2
@@ -158,7 +170,7 @@
 	 __set_errno (- __sys_res);		\
 	 __sys_res = (unsigned long) -1;	\
        }					\
-     __sys_res;					\
+     (long int) __sys_res;			\
    })
 
 #define LOAD_ARGS_c_0()
@@ -197,7 +209,7 @@
 #define LOAD_ARGS_c_5(r10, r11, r12, r13, mof) \
 	LOAD_ARGS_c_4(r10, r11, r12, r13)
 #define LOAD_ARGS_asm_5(r10, r11, r12, r13, mof) \
-	LOAD_ARGS_asm_4 (r10, r11, r12, r13) "move %5,$mof\n\t"
+	LOAD_ARGS_asm_4 (r10, r11, r12, r13) "move %6,$mof\n\t"
 #define ASM_CLOBBER_5 ASM_CLOBBER_4
 #define ASM_ARGS_5(r10, r11, r12, r13, mof) \
 	ASM_ARGS_4 (r10, r11, r12, r13), "g" (mof)
@@ -206,7 +218,7 @@
 	LOAD_ARGS_c_5(r10, r11, r12, r13, mof)
 #define LOAD_ARGS_asm_6(r10, r11, r12, r13, mof, srp)		\
 	LOAD_ARGS_asm_5(r10, r11, r12, r13, mof)		\
-	"move %6,$srp\n\t"
+	"move %7,$srp\n\t"
 #define ASM_CLOBBER_6 ASM_CLOBBER_5, "srp"
 #define ASM_ARGS_6(r10, r11, r12, r13, mof, srp) \
 	ASM_ARGS_5 (r10, r11, r12, r13, mof), "g" (srp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/fatal-prepare.h libc-20030708/sysdeps/unix/sysv/linux/fatal-prepare.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/fatal-prepare.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/fatal-prepare.h	2003-04-20 01:53:22.000000000 +0900
@@ -0,0 +1,39 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <pthread.h>
+
+/* We have to completely disable cancellation.  assert() must not be a
+   cancellation point but the implementation uses write() etc.  */
+#ifdef SHARED
+# include <pthread-functions.h>
+# define FATAL_PREPARE \
+  {									      \
+    int (*fp) (int, int *);						      \
+    fp = __libc_pthread_functions.ptr_pthread_setcancelstate;		      \
+    if (fp != NULL)							      \
+      fp (PTHREAD_CANCEL_DISABLE, NULL);				      \
+  }
+#else
+# pragma weak pthread_setcancelstate
+# define FATAL_PREPARE \
+  {									      \
+    if (pthread_setcancelstate != NULL)					      \
+      pthread_setcancelstate (PTHREAD_CANCEL_DISABLE, NULL);		      \
+  }
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/fpathconf.c libc-20030708/sysdeps/unix/sysv/linux/fpathconf.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/fpathconf.c	2002-10-23 15:21:19.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/fpathconf.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Get file-specific information about descriptor FD.  Linux version.
-   Copyright (C) 1991,95,96,98,99,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995,1996,1998-2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -37,9 +37,14 @@
   switch (name)
     {
     case _PC_LINK_MAX:
-      return statfs_link_max (__fstatfs (fd, &fsbuf), &fsbuf);
+      return __statfs_link_max (__fstatfs (fd, &fsbuf), &fsbuf);
+
     case _PC_FILESIZEBITS:
-      return statfs_filesize_max (__fstatfs (fd, &fsbuf), &fsbuf);
+      return __statfs_filesize_max (__fstatfs (fd, &fsbuf), &fsbuf);
+
+    case _PC_2_SYMLINKS:
+      return __statfs_symlinks (__fstatfs (fd, &fsbuf), &fsbuf);
+
     default:
       return posix_fpathconf (fd, name);
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/fstatfs64.c libc-20030708/sysdeps/unix/sysv/linux/fstatfs64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/fstatfs64.c	2001-07-08 04:21:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/fstatfs64.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Return information about the filesystem on which FD resides.
-   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1998,1999,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,11 +21,34 @@
 #include <string.h>
 #include <sys/statfs.h>
 #include <stddef.h>
+#include <sysdep.h>
+
+/* Defined in statfs64.c.  */
+extern int __no_statfs64 attribute_hidden;
 
 /* Return information about the filesystem on which FD resides.  */
 int
 __fstatfs64 (int fd, struct statfs64 *buf)
 {
+#ifdef __NR_fstatfs64
+# if __ASSUME_STATFS64 == 0
+  if (! __no_statfs64)
+# endif
+    {
+      int result = INLINE_SYSCALL (fstatfs64, 3, fd, sizeof (*buf), buf);
+
+# if __ASSUME_STATFS64 == 0
+      if (result == 0 || errno != ENOSYS)
+# endif
+	return result;
+
+# if __ASSUME_STATFS64 == 0
+      __no_statfs64 = 1;
+# endif
+    }
+#endif
+
+#if __ASSUME_STATFS64 == 0
   struct statfs buf32;
 
   if (__fstatfs (fd, &buf32) < 0)
@@ -40,8 +63,10 @@
   buf->f_ffree = buf32.f_ffree;
   buf->f_fsid = buf32.f_fsid;
   buf->f_namelen = buf32.f_namelen;
+  buf->f_frsize = buf32.f_frsize;
   memcpy (buf->f_spare, buf32.f_spare, sizeof (buf32.f_spare));
 
   return 0;
+#endif
 }
 weak_alias (__fstatfs64, fstatfs64)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/fxstat.c libc-20030708/sysdeps/unix/sysv/linux/fxstat.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/fxstat.c	2002-10-02 17:53:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/fxstat.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* fxstat using old-style Unix fstat system call.
-   Copyright (C) 1991,1995-1998,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995-1998,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,9 +31,7 @@
 #include <sys/syscall.h>
 #include <bp-checks.h>
 
-#include <xstatconv.c>
-
-extern int __syscall_fstat (int, struct kernel_stat *__unbounded);
+#include <xstatconv.h>
 
 /* Get information about the file FD in BUF.  */
 int
@@ -51,7 +49,7 @@
 
   result = INLINE_SYSCALL (fstat, 2, fd, __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat_conv (vers, &kbuf, buf);
+    result = __xstat_conv (vers, &kbuf, buf);
 
   return result;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/fxstat64.c libc-20030708/sysdeps/unix/sysv/linux/fxstat64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/fxstat64.c	2002-10-12 03:58:50.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/fxstat64.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* fxstat64 using old-style Unix fstat system call.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -29,7 +29,7 @@
 #include "kernel-features.h"
 
 #if __ASSUME_STAT64_SYSCALL == 0
-# include <xstatconv.c>
+# include <xstatconv.h>
 #endif
 
 extern int __syscall_fstat (int, struct kernel_stat *__unbounded);
@@ -78,7 +78,7 @@
 # endif
   result = INLINE_SYSCALL (fstat, 2, fd, __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat64_conv (vers, &kbuf, buf);
+    result = __xstat64_conv (vers, &kbuf, buf);
 
   return result;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/gethostid.c libc-20030708/sysdeps/unix/sysv/linux/gethostid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/gethostid.c	2002-09-24 14:12:26.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/gethostid.c	2003-04-28 23:53:24.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995,1996,1998,1999,2000,2001 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1998-2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,6 +21,7 @@
 #include <fcntl.h>
 #include <unistd.h>
 #include <netdb.h>
+#include <not-cancel.h>
 
 #define HOSTIDFILE "/etc/hostid"
 #define OLD_HOSTIDFILE "/etc/hostid"
@@ -41,13 +42,13 @@
     }
 
   /* Open file for writing.  Everybody is allowed to read this file.  */
-  fd = __open64 (HOSTIDFILE, O_CREAT|O_WRONLY|O_TRUNC, 0644);
+  fd = open_not_cancel (HOSTIDFILE, O_CREAT|O_WRONLY|O_TRUNC, 0644);
   if (fd < 0)
     return -1;
 
-  written = __write (fd, &id, sizeof (id));
+  written = write_not_cancel (fd, &id, sizeof (id));
 
-  __close (fd);
+  close_not_cancel_no_status (fd);
 
   return written != sizeof (id) ? -1 : 0;
 }
@@ -71,14 +72,14 @@
   int fd;
 
   /* First try to get the ID from a former invocation of sethostid.  */
-  fd = __open64 (HOSTIDFILE, O_RDONLY);
+  fd = open_not_cancel (HOSTIDFILE, O_RDONLY|O_LARGEFILE, 0);
   if (fd < 0)
-    fd = __open64 (OLD_HOSTIDFILE, O_RDONLY);
+    fd = open_not_cancel (OLD_HOSTIDFILE, O_RDONLY|O_LARGEFILE, 0);
   if (fd >= 0)
     {
-      ssize_t n = __read (fd, &id, sizeof (id));
+      ssize_t n = read_not_cancel (fd, &id, sizeof (id));
 
-      __close (fd);
+      close_not_cancel_no_status (fd);
 
       if (n == sizeof (id))
 	return id;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/getsysstats.c libc-20030708/sysdeps/unix/sysv/linux/getsysstats.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/getsysstats.c	2002-11-02 11:16:02.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/getsysstats.c	2003-04-15 23:55:50.000000000 +0900
@@ -1,5 +1,5 @@
 /* Determine various system internal values, Linux version.
-   Copyright (C) 1996-2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1996-2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -31,7 +31,7 @@
 #include <unistd.h>
 #include <sys/sysinfo.h>
 
-#include <atomicity.h>
+#include <atomic.h>
 
 
 /* The default value for the /proc filesystem mount point.  */
@@ -85,8 +85,7 @@
 
   /* Now store the copied value.  But do it atomically.  */
   assert (sizeof (long int) == sizeof (void *__unbounded));
-  if (compare_and_swap ((long int *) &mount_proc, (long int) 0,
-			(long int) copy_result) == 0)
+  if (atomic_compare_and_exchange_bool_acq (&mount_proc, copy_result, NULL))
     /* Replacing the value failed.  This means another thread was
        faster and we don't need the copy anymore.  */
     free (copy_result);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/hppa/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/hppa/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/hppa/bits/mman.h	2000-10-15 12:12:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/hppa/bits/mman.h	2003-03-03 18:53:18.000000000 +0900
@@ -1,4 +1,21 @@
-/* Definitions for POSIX memory map interface.  Insert rest of disclaimer here */
+/* Definitions for POSIX memory map interface.  Linux/HPPA version.
+   Copyright (C) 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
 
 #ifndef _SYS_MMAN_H
 # error "Never use <bits/mman.h> directly; include <sys/mman.h> instead."
@@ -22,6 +39,8 @@
 #define MAP_LOCKED	0x2000		/* pages are locked */
 #define MAP_NORESERVE	0x4000		/* don't check for reservations */
 #define MAP_GROWSDOWN	0x8000		/* stack-like segment */
+#define MAP_POPULATE	0x10000		/* populate (prefault) pagetables */
+#define MAP_NONBLOCK	0x20000		/* do not block on IO */
 
 #define MS_SYNC		1		/* synchronous memory sync */
 #define MS_ASYNC	2		/* sync memory asynchronously */
@@ -58,4 +77,3 @@
 #ifdef __USE_GNU
 # define MREMAP_MAYMOVE 1
 #endif
-
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/hppa/bits/signum.h libc-20030708/sysdeps/unix/sysv/linux/hppa/bits/signum.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/hppa/bits/signum.h	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/hppa/bits/signum.h	2003-04-01 21:01:06.000000000 +0900
@@ -1,5 +1,5 @@
 /* Signal number definitions.  Linux/HPPA version.
-   Copyright (C) 1995, 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1995,1996,1997,1998,1999,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -68,7 +68,7 @@
 #define	SIGXFSZ		34	/* File size limit exceeded (4.2 BSD).  */
 #define	SIGSTKFLT	36	/* Stack fault.  */
 
-#define	_NSIG		64	/* Biggest signal number + 1
+#define	_NSIG		65	/* Biggest signal number + 1
 				   (including real-time signals).  */
 
 #define SIGRTMIN        (__libc_current_sigrtmin ())
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/hppa/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/hppa/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/hppa/sysdep.h	2002-08-27 06:16:19.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/hppa/sysdep.h	2003-03-25 19:49:28.000000000 +0900
@@ -1,5 +1,5 @@
 /* Assembler macros for PA-RISC.
-   Copyright (C) 1999,2001,02 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper, <drepper@cygnus.com>, August 1999.
    Linux/PA-RISC changes by Philipp Rumpf, <prumpf@tux.org>, March 2000.
@@ -84,6 +84,10 @@
 	bv 0(2)					ASM_LINE_SEP	\
 	nop
 
+#define ret_NOERRNO \
+	bv 0(2)					ASM_LINE_SEP	\
+	nop
+
 #undef	END
 #define END(name)						\
 1:	.size	C_SYMBOL_NAME(name),1b-C_SYMBOL_NAME(name)
@@ -115,6 +119,15 @@
 #define	PSEUDO_END(name)						      \
   END (name)
 
+#define	PSEUDO_NOERRNO(name, syscall_name, args)			      \
+  ENTRY (name)								      \
+  DO_CALL(syscall_name, args)					ASM_LINE_SEP  \
+  nop
+
+#undef	PSEUDO_END_NOERRNO
+#define	PSEUDO_END_NOERRNO(name)					      \
+  END (name)
+
 #define JUMPTARGET(name)	name
 #define SYSCALL_PIC_SETUP	/* Nothing.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/i386/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/bits/mman.h	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/bits/mman.h	2003-03-03 18:15:57.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/i386 version.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -52,11 +52,13 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	0x0100		/* Stack-like segment.  */
-# define MAP_DENYWRITE	0x0800		/* ETXTBSY */
-# define MAP_EXECUTABLE	0x1000		/* Mark it as an executable.  */
-# define MAP_LOCKED	0x2000		/* Lock the mapping.  */
-# define MAP_NORESERVE	0x4000		/* Don't check for reservations.  */
+# define MAP_GROWSDOWN	0x00100		/* Stack-like segment.  */
+# define MAP_DENYWRITE	0x00800		/* ETXTBSY */
+# define MAP_EXECUTABLE	0x01000		/* Mark it as an executable.  */
+# define MAP_LOCKED	0x02000		/* Lock the mapping.  */
+# define MAP_NORESERVE	0x04000		/* Don't check for reservations.  */
+# define MAP_POPULATE	0x08000		/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	0x10000		/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/bp-thunks.h libc-20030708/sysdeps/unix/sysv/linux/i386/bp-thunks.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/bp-thunks.h	2003-01-16 07:10:10.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/bp-thunks.h	2003-05-02 14:47:17.000000000 +0900
@@ -1,3 +1,4 @@
-#include <sysdeps/generic/bp-thunks.h>
-
-#include <sys/vm86.h>
+#ifndef __ASSEMBLER__
+# include <sysdeps/generic/bp-thunks.h>
+# include <sys/vm86.h>
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/chown.c libc-20030708/sysdeps/unix/sysv/linux/i386/chown.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/chown.c	2002-08-03 06:46:59.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/chown.c	2003-03-28 21:28:20.000000000 +0900
@@ -148,20 +148,15 @@
 #endif
 
 #if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_1)
-strong_alias (__chown_is_lchown, _chown_is_lchown)
-compat_symbol (libc, __chown_is_lchown, __chown, GLIBC_2_0);
-compat_symbol (libc, _chown_is_lchown, chown, GLIBC_2_0);
+compat_symbol (libc, __chown_is_lchown, chown, GLIBC_2_0);
 #endif
 
 #ifdef __NR_lchown
-strong_alias (__real_chown, _real_chown)
-versioned_symbol (libc, __real_chown, __chown, GLIBC_2_1);
-versioned_symbol (libc, _real_chown, chown, GLIBC_2_1);
-libc_hidden_ver (__real_chown, __chown)
+versioned_symbol (libc, __real_chown, chown, GLIBC_2_1);
+strong_alias (__real_chown, __chown)
 #else
 strong_alias (__chown_is_lchown, __chown_is_lchown21)
-strong_alias (__chown_is_lchown, _chown_is_lchown21)
-versioned_symbol (libc, __chown_is_lchown21, __chown, GLIBC_2_1);
-versioned_symbol (libc, _chown_is_lchown21, chown, GLIBC_2_1);
-libc_hidden_ver (__chown_is_lchown, __chown)
+versioned_symbol (libc, __chown_is_lchown21, chown, GLIBC_2_1);
+strong_alias (__chown_is_lchown, __chown)
 #endif
+libc_hidden_def (__chown)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/clone.S libc-20030708/sysdeps/unix/sysv/linux/i386/clone.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/clone.S	2002-11-22 08:59:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/clone.S	2003-03-11 18:30:18.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997,98,99,2000,02 Free Software Foundation, Inc.
+/* Copyright (C) 1996,1997,98,99,2000,02,03 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson (rth@tamu.edu)
 
@@ -28,7 +28,7 @@
 #include <bp-asm.h>
 
 /* int clone(int (*fn)(void *arg), void *child_stack, int flags, void *arg,
-	     pid_t *tid, struct user_desc *tls); */
+	     pid_t *ptid, struct user_desc *tls, pid_t *ctid); */
 
 #define PARMS	LINKAGE		/* no space for saved regs */
 #define FUNC	PARMS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/dl-procinfo.h libc-20030708/sysdeps/unix/sysv/linux/i386/dl-procinfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/dl-procinfo.h	2002-09-24 09:00:49.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/dl-procinfo.h	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Linux/i386 version of processor capability information handling macros.
-   Copyright (C) 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -97,7 +97,7 @@
 };
 
 static inline int
-__attribute__ ((unused))
+__attribute__ ((unused, always_inline))
 _dl_string_hwcap (const char *str)
 {
   int i;
@@ -112,7 +112,7 @@
 
 
 static inline int
-__attribute__ ((unused))
+__attribute__ ((unused, always_inline))
 _dl_string_platform (const char *str)
 {
   int i;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/fxstat.c libc-20030708/sysdeps/unix/sysv/linux/i386/fxstat.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/fxstat.c	2002-08-13 23:29:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/fxstat.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* fxstat using old-style Unix fstat system call.
-   Copyright (C) 1991,95,96,97,98,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995-1998,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +32,7 @@
 
 #include "kernel-features.h"
 
-#include <xstatconv.c>
+#include <xstatconv.h>
 
 extern int __syscall_fstat (int, struct kernel_stat *__unbounded);
 
@@ -62,7 +62,7 @@
 
     result = INLINE_SYSCALL (fstat64, 2, fd, __ptrvalue (&buf64));
     if (result == 0)
-      result = xstat32_conv (vers, &buf64, buf);
+      result = __xstat32_conv (vers, &buf64, buf);
     return result;
   }
 #else
@@ -77,7 +77,7 @@
       result = INLINE_SYSCALL (fstat64, 2, fd, __ptrvalue (&buf64));
 
       if (result == 0)
-	result = xstat32_conv (vers, &buf64, buf);
+	result = __xstat32_conv (vers, &buf64, buf);
 
       if (result != -1 || errno != ENOSYS)
 	return result;
@@ -88,7 +88,7 @@
 
   result = INLINE_SYSCALL (fstat, 2, fd, __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat_conv (vers, &kbuf, buf);
+    result = __xstat_conv (vers, &kbuf, buf);
 
   return result;
 #endif  /* __ASSUME_STAT64_SYSCALL  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/getcontext.S libc-20030708/sysdeps/unix/sysv/linux/i386/getcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/getcontext.S	2002-12-20 12:56:27.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/getcontext.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Save current context.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@redhat.com>, 2001.
 
@@ -56,6 +56,10 @@
 	movl	%ecx, oFPREGS(%eax)
 	/* Save the floating-point context.  */
 	fnstenv	(%ecx)
+	/* And load it right back since the processor changes the mask.
+	   Intel thought this opcode to be used in interrupt handlers which
+	   would block all exceptions.  */
+	fldenv	(%ecx)
 
 	/* Save the current signal mask.  */
 	pushl	%ebx
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/getgroups.c libc-20030708/sysdeps/unix/sysv/linux/i386/getgroups.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/getgroups.c	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/getgroups.c	2003-03-28 21:28:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -36,7 +36,7 @@
 # if __ASSUME_32BITUIDS == 0
 /* This variable is shared with all files that need to check for 32bit
    uids.  */
-extern int __libc_missing_32bit_uids;
+extern int __libc_missing_32bit_uids attribute_hidden;
 # endif
 #endif /* __NR_getgroups32 */
 
@@ -64,7 +64,7 @@
 	  int saved_errno = errno;
 
 	  result = INLINE_SYSCALL (getgroups32, 2, n, CHECK_N (groups, n));
-	  if (result == 0 || errno != ENOSYS)
+	  if (result != -1 || errno != ENOSYS)
 	    return result;
 
 	  __set_errno (saved_errno);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/lxstat.c libc-20030708/sysdeps/unix/sysv/linux/i386/lxstat.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/lxstat.c	2002-08-13 23:29:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/lxstat.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* lxstat using old-style Unix lstat system call.
-   Copyright (C) 1991,95,96,97,98,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,95,96,97,98,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +32,7 @@
 
 #include "kernel-features.h"
 
-#include <xstatconv.c>
+#include <xstatconv.h>
 
 extern int __syscall_lstat (const char *__unbounded,
 			    struct kernel_stat *__unbounded);
@@ -65,7 +65,7 @@
 
     result = INLINE_SYSCALL (lstat64, 2, CHECK_STRING (name), __ptrvalue (&buf64));
     if (result == 0)
-      result = xstat32_conv (vers, &buf64, buf);
+      result = __xstat32_conv (vers, &buf64, buf);
     return result;
   }
 #else
@@ -79,7 +79,7 @@
       result = INLINE_SYSCALL (lstat64, 2, CHECK_STRING (name), __ptrvalue (&buf64));
 
       if (result == 0)
-	result = xstat32_conv (vers, &buf64, buf);
+	result = __xstat32_conv (vers, &buf64, buf);
 
       if (result != -1 || errno != ENOSYS)
 	return result;
@@ -90,7 +90,7 @@
 
   result = INLINE_SYSCALL (lstat, 2, CHECK_STRING (name), __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat_conv (vers, &kbuf, buf);
+    result = __xstat_conv (vers, &kbuf, buf);
 
   return result;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/semtimedop.S libc-20030708/sysdeps/unix/sysv/linux/i386/semtimedop.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/semtimedop.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/semtimedop.S	2003-04-03 08:46:19.000000000 +0900
@@ -0,0 +1,63 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#define SYSOP_semtimedop 4
+
+#define SVRSP	12		/* saved register space */
+#define PARMS	LINKAGE+SVRSP	/* space for 3 saved regs */
+#define SEMID	PARMS
+#define SOPS	SEMID+4
+#define NSOPS	SOPS+PTR_SIZE
+#define TIMEOUT	NSOPS+4
+
+	.text
+ENTRY (BP_SYM (semtimedop))
+
+	pushl	%ebp
+	pushl	%ebx
+	pushl	%edi
+
+	movl	$SYSOP_semtimedop, %ebx
+	movl	SEMID(%esp), %ecx
+	movl	NSOPS(%esp), %edx
+	movl	SOPS(%esp), %edi
+	movl	TIMEOUT(%esp), %ebp
+	movl	$__NR_ipc, %eax
+
+	ENTER_KERNEL
+
+	/* Restore registers.  */
+	popl	%edi
+	popl	%ebx
+	popl	%ebp
+
+	/* If 0 > %eax > -4096 there was an error.  */
+	cmpl $-4096, %eax
+	ja SYSCALL_ERROR_LABEL
+
+	/* Successful; return the syscall's value.  */
+L(pseudo_end):
+	ret
+
+#ifdef PIC
+	.align	4
+#endif
+PSEUDO_END (BP_SYM (semtimedop))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setcontext.S libc-20030708/sysdeps/unix/sysv/linux/i386/setcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setcontext.S	2002-12-20 12:56:48.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/setcontext.S	2003-04-15 23:55:50.000000000 +0900
@@ -1,5 +1,5 @@
 /* Install given context.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@redhat.com>, 2001.
 
@@ -53,39 +53,26 @@
 	movl	oFS(%eax), %ecx
 	movw	%cx, %fs
 
+	/* Fetch the address to return to.  */
+	movl	oEIP(%eax), %ecx
+
 	/* Load the new stack pointer.  */
-	movl	oESP(%eax), %ecx
-	/* Make room for 8 registers and the return address.  We will load
-	   the values from the stack.  */
-	subl	$36, %ecx
-
-	/* Move the values of all the 32-bit registers (except ESP) on
-	   the stack.  This happens in the form the 'popa' instruction
-	   expects it.  Before this block put the address of the code
-	   to execute.  */
-	movl	oEDI(%eax), %ebx
-	movl	oESI(%eax), %edx
-	movl	oEBP(%eax), %esi
-	movl	oEBX(%eax), %edi
-	movl	%ebx, (%ecx)
-	movl	%edx, 4(%ecx)
-	movl	%esi, 8(%ecx)
-	movl	%edi, 16(%ecx)
-	movl	oEDX(%eax), %ebx
-	movl	oECX(%eax), %edx
-	movl	oEAX(%eax), %esi
-	movl	oEIP(%eax), %edi
-	movl	%ebx, 20(%ecx)
-	movl	%edx, 24(%ecx)
-	movl	%esi, 28(%ecx)
-	movl	%edi, 32(%ecx)
-
-	/* Set the new stack address.  The stack points now to the block
-	   we put the register content in.  */
-	movl	%ecx, %esp
-	/* Restore the register content.  */
-	popa
-	/* The following 'ret' will pop the addres of the code and jump
+	movl	oESP(%eax), %esp
+
+	/* Push the return address on the new stack so we can return there.  */
+	pushl	%ecx
+
+	/* Load the values of all the 32-bit registers (except ESP).
+	   Since we are loading from EAX, it must be last.  */
+	movl	oEDI(%eax), %edi
+	movl	oESI(%eax), %esi
+	movl	oEBP(%eax), %ebp
+	movl	oEBX(%eax), %ebx
+	movl	oEDX(%eax), %edx
+	movl	oECX(%eax), %ecx
+	movl	oEAX(%eax), %eax
+
+	/* The following 'ret' will pop the address of the code and jump
 	   to it.  */
 
 L(pseudo_end):
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setegid.c libc-20030708/sysdeps/unix/sysv/linux/i386/setegid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setegid.c	2002-08-13 23:29:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/setegid.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 96, 97, 98, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1995-1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -16,13 +16,41 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <errno.h>
 #include <unistd.h>
 #include <sys/types.h>
 
+#include <sysdep.h>
+#include "kernel-features.h"
+
+
+#ifdef __NR_setresgid
+extern int __setresgid (uid_t rgid, uid_t egid, uid_t sgid);
+#endif
+
 int
 setegid (gid)
      gid_t gid;
 {
-  return __setregid (-1, gid);
+#if __ASSUME_32BITUIDS > 0
+  return INLINE_SYSCALL (setresgid32, 3, -1, gid, -1);
+#else
+  int result;
+  /* First try the syscall.  */
+# ifdef __NR_setresgid
+  result = __setresgid (-1, gid, -1);
+#  if __ASSUME_SETRESGID_SYSCALL > 0
+  if (0)
+#  else
+  if (result == -1 && errno == ENOSYS)
+#  endif
+    /* No system call available.  Use emulation.  This may not work
+       since `setregid' also sets the saved user ID when GID is not
+       equal to the real user ID, making it impossible to switch back.  */
+# endif
+    result = __setregid (-1, gid);
+
+  return result;
+#endif
 }
 libc_hidden_def (setegid)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/seteuid.c libc-20030708/sysdeps/unix/sysv/linux/i386/seteuid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/seteuid.c	2002-08-13 23:29:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/seteuid.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,10 +17,12 @@
    02111-1307 USA.  */
 
 #include <errno.h>
-#include <sys/syscall.h>
 #include <sys/types.h>
 #include <unistd.h>
 
+#include <sysdep.h>
+#include "kernel-features.h"
+
 
 #ifdef __NR_setresuid
 extern int __setresuid (uid_t ruid, uid_t euid, uid_t suid);
@@ -29,21 +31,25 @@
 int
 seteuid (uid_t uid)
 {
+#if __ASSUME_32BITUIDS > 0
+  return INLINE_SYSCALL (setresuid32, 3, -1, uid, -1);
+#else
   int result;
   /* First try the syscall.  */
-#ifdef __NR_setresuid
+# ifdef __NR_setresuid
   result = __setresuid (-1, uid, -1);
-#if __ASSUME_SETRESUID_SYSCALL > 0
+#  if __ASSUME_SETRESUID_SYSCALL > 0
   if (0)
-#else
+#  else
   if (result == -1 && errno == ENOSYS)
-#endif
+#  endif
     /* No system call available.  Use emulation.  This may not work
        since `setreuid' also sets the saved user ID when UID is not
        equal to the real user ID, making it impossible to switch back.  */
-#endif
+# endif
     result = __setreuid (-1, uid);
 
   return result;
+#endif
 }
 libc_hidden_def (seteuid)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setfsgid.c libc-20030708/sysdeps/unix/sysv/linux/i386/setfsgid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setfsgid.c	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/setfsgid.c	2003-03-28 21:28:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -35,27 +35,28 @@
 #  if __ASSUME_32BITUIDS == 0
 /* This variable is shared with all files that need to check for 32bit
    uids.  */
-extern int __libc_missing_32bit_uids;
+extern int __libc_missing_32bit_uids attribute_hidden;
 #  endif
 # endif /* __NR_setfsgid32 */
 
 int
 setfsgid (gid_t gid)
 {
+  INTERNAL_SYSCALL_DECL (err);
 # if __ASSUME_32BITUIDS > 0
-  return INLINE_SYSCALL (setfsgid32, 1, gid);
+  /* No error checking. */
+  return INTERNAL_SYSCALL (setfsgid32, err, 1, gid);
 # else
 #  ifdef __NR_setfsgid32
   if (__libc_missing_32bit_uids <= 0)
     {
       int result;
-      int saved_errno = errno;
 
-      result = INLINE_SYSCALL (setfsgid32, 1, gid);
-      if (result == 0 || errno != ENOSYS)
+      result = INTERNAL_SYSCALL (setfsgid32, err, 1, gid);
+      if (! INTERNAL_SYSCALL_ERROR_P (result, err)
+	  || INTERNAL_SYSCALL_ERRNO (result, err) != ENOSYS)
 	return result;
 
-      __set_errno (saved_errno);
       __libc_missing_32bit_uids = 1;
     }
 #  endif /* __NR_setfsgid32 */
@@ -65,7 +66,8 @@
       return -1;
     }
 
-  return INLINE_SYSCALL (setfsgid, 1, gid);
+  /* No error checking. */
+  return INTERNAL_SYSCALL (setfsgid, err, 1, gid);
 # endif
 }
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setfsuid.c libc-20030708/sysdeps/unix/sysv/linux/i386/setfsuid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setfsuid.c	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/setfsuid.c	2003-03-28 21:28:20.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -35,27 +35,28 @@
 #  if __ASSUME_32BITUIDS == 0
 /* This variable is shared with all files that need to check for 32bit
    uids.  */
-extern int __libc_missing_32bit_uids;
+extern int __libc_missing_32bit_uids attribute_hidden;
 #  endif
 # endif /* __NR_setfsuid32 */
 
 int
 setfsuid (uid_t uid)
 {
+  INTERNAL_SYSCALL_DECL (err);
 # if  __ASSUME_32BITUIDS > 0
-  return INLINE_SYSCALL (setfsuid32, 1, uid);
-# else  
+  /* No error checking. */
+  return INTERNAL_SYSCALL (setfsuid32, err, 1, uid);
+# else
 #  ifdef __NR_setfsuid32
   if (__libc_missing_32bit_uids <= 0)
     {
       int result;
-      int saved_errno = errno;
 
-      result = INLINE_SYSCALL (setfsuid32, 1, uid);
-      if (result == 0 || errno != ENOSYS)
+      result = INTERNAL_SYSCALL (setfsuid32, err, 1, uid);
+      if (! INTERNAL_SYSCALL_ERROR_P (result, err)
+	  || INTERNAL_SYSCALL_ERRNO (result, err) != ENOSYS)
 	return result;
 
-      __set_errno (saved_errno);
       __libc_missing_32bit_uids = 1;
     }
 #  endif /* __NR_setfsuid32 */
@@ -66,7 +67,8 @@
       return -1;
     }
 
-  return INLINE_SYSCALL (setfsuid, 1, uid);
+  /* No error checking. */
+  return INTERNAL_SYSCALL (setfsuid, err, 1, uid);
 # endif
 }
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setregid.c libc-20030708/sysdeps/unix/sysv/linux/i386/setregid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setregid.c	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/setregid.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setreuid.c libc-20030708/sysdeps/unix/sysv/linux/i386/setreuid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/setreuid.c	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/setreuid.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/sigaction.c libc-20030708/sysdeps/unix/sysv/linux/i386/sigaction.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/sigaction.c	2003-01-09 11:54:57.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/sigaction.c	2003-04-15 23:55:50.000000000 +0900
@@ -88,10 +88,15 @@
 	{
 	  kact.k_sa_handler = act->sa_handler;
 	  memcpy (&kact.sa_mask, &act->sa_mask, sizeof (sigset_t));
+
+# if __ASSUME_VSYSCALL == 0
 	  kact.sa_flags = act->sa_flags | SA_RESTORER;
 
 	  kact.sa_restorer = ((act->sa_flags & SA_SIGINFO)
 			      ? &restore_rt : &restore);
+# else
+	  kact.sa_flags = act->sa_flags;
+# endif
 	}
 
       /* XXX The size argument hopefully will have to be changed to the
@@ -157,6 +162,7 @@
 weak_alias (__libc_sigaction, sigaction)
 #endif
 
+#if __ASSUME_VSYSCALL == 0
 /* NOTE: Please think twice before making any changes to the bits of
    code below.  GDB needs some intimate knowledge about it to
    recognize them as signal trampolines, and make backtraces through
@@ -165,8 +171,8 @@
    If you ever feel the need to make any changes, please notify the
    appropriate GDB maintainer.  */
 
-#define RESTORE(name, syscall) RESTORE2 (name, syscall)
-#define RESTORE2(name, syscall) \
+# define RESTORE(name, syscall) RESTORE2 (name, syscall)
+# define RESTORE2(name, syscall) \
 asm						\
   (						\
    ".text\n"					\
@@ -176,10 +182,10 @@
    "	int  $0x80"				\
    );
 
-#ifdef __NR_rt_sigaction
+# ifdef __NR_rt_sigaction
 /* The return code for realtime-signals.  */
 RESTORE (restore_rt, __NR_rt_sigreturn)
-#endif
+# endif
 
 /* For the boring old signals.  */
 # undef RESTORE2
@@ -195,3 +201,4 @@
    );
 
 RESTORE (restore, __NR_sigreturn)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/socket.S libc-20030708/sysdeps/unix/sysv/linux/i386/socket.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/socket.S	2002-12-18 20:37:37.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/socket.S	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1996, 1997, 1998, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,1998,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,6 +41,7 @@
 #endif
 
 .globl __socket
+	cfi_startproc
 ENTRY (__socket)
 #if defined NEED_CANCELLATION && defined CENABLE
 	SINGLE_THREAD_P
@@ -49,6 +50,7 @@
 
 	/* Save registers.  */
 	movl %ebx, %edx
+	cfi_register (3, 2)
 
 	movl $SYS_ify(socketcall), %eax	/* System call number in %eax.  */
 
@@ -61,6 +63,7 @@
 
 	/* Restore registers.  */
 	movl %edx, %ebx
+	cfi_restore (3)
 
 	/* %eax is < 0 if there was an error.  */
 	cmpl $-125, %eax
@@ -74,13 +77,16 @@
 #if defined NEED_CANCELLATION && defined CENABLE
 	/* We need one more register.  */
 1:	pushl %esi
+	cfi_adjust_cfa_offset(4)
 
 	/* Enable asynchronous cancellation.  */
 	CENABLE
 	movl %eax, %esi
+	cfi_offset(6, -8)		/* %esi */
 
 	/* Save registers.  */
 	movl %ebx, %edx
+	cfi_register (3, 2)
 
 	movl $SYS_ify(socketcall), %eax	/* System call number in %eax.  */
 
@@ -93,6 +99,7 @@
 
 	/* Restore registers.  */
 	movl %edx, %ebx
+	cfi_restore (3)
 
 	/* Restore the cancellation.  */
 	xchgl %esi, %eax
@@ -101,6 +108,8 @@
 	/* Restore registers.  */
 	movl %esi, %eax
 	popl %esi
+	cfi_restore (6)
+	cfi_adjust_cfa_offset(-4)
 
 	/* %eax is < 0 if there was an error.  */
 	cmpl $-125, %eax
@@ -109,6 +118,7 @@
 	/* Successful; return the syscall's value.  */
 	ret
 #endif
+	cfi_endproc
 PSEUDO_END (__socket)
 
 #ifndef NO_WEAK_ALIAS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/swapcontext.S libc-20030708/sysdeps/unix/sysv/linux/i386/swapcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/swapcontext.S	2002-12-20 12:57:24.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/swapcontext.S	2003-04-15 23:55:50.000000000 +0900
@@ -1,5 +1,5 @@
 /* Save current context and install the given one.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@redhat.com>, 2001.
 
@@ -78,43 +78,31 @@
 	movl	oFPREGS(%eax), %ecx
 	fldenv	(%ecx)
 
-	/* Restore the FS segment registers.  */
+	/* Restore the FS segment register.  We don't touch the GS register
+	   since it is used for threads.  */
 	movl	oFS(%eax), %edx
 	movw	%dx, %fs
 
+	/* Fetch the address to return to.  */
+	movl	oEIP(%eax), %ecx
+
 	/* Load the new stack pointer.  */
-	movl	oESP(%eax), %ecx
-	/* Make room for 8 registers and the return address.  We will load
-	   the values from the stack.  */
-	subl	$36, %ecx
-
-	/* Move the values of all the 32-bit registers (except ESP) on
-	   the stack.  This happens in the form the 'popa' instruction
-	   expects it.  Before this block put the address of the code
-	   to execute.  */
-	movl	oEDI(%eax), %ebx
-	movl	oESI(%eax), %edx
-	movl	oEBP(%eax), %esi
-	movl	oEBX(%eax), %edi
-	movl	%ebx, (%ecx)
-	movl	%edx, 4(%ecx)
-	movl	%esi, 8(%ecx)
-	movl	%edi, 16(%ecx)
-	movl	oEDX(%eax), %ebx
-	movl	oECX(%eax), %edx
-	movl	oEAX(%eax), %esi
-	movl	oEIP(%eax), %edi
-	movl	%ebx, 20(%ecx)
-	movl	%edx, 24(%ecx)
-	movl	%esi, 28(%ecx)
-	movl	%edi, 32(%ecx)
-
-	/* Set the new stack address.  The stack points now to the block
-	   we put the register content in.  */
-	movl	%ecx, %esp
-	/* Restore the register content.  */
-	popa
-	/* The following 'ret' will pop the addres of the code and jump
+	movl	oESP(%eax), %esp
+
+	/* Push the return address on the new stack so we can return there.  */
+	pushl	%ecx
+
+	/* Load the values of all the 32-bit registers (except ESP).
+	   Since we are loading from EAX, it must be last.  */
+	movl	oEDI(%eax), %edi
+	movl	oESI(%eax), %esi
+	movl	oEBP(%eax), %ebp
+	movl	oEBX(%eax), %ebx
+	movl	oEDX(%eax), %edx
+	movl	oECX(%eax), %ecx
+	movl	oEAX(%eax), %eax
+
+	/* The following 'ret' will pop the address of the code and jump
 	   to it.  */
 
 L(pseudo_end):
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/i386/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/sysdep.h	2003-01-09 11:54:57.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/sysdep.h	2003-07-08 22:58:14.000000000 +0900
@@ -78,6 +78,18 @@
   SYSCALL_ERROR_HANDLER							      \
   END (name)
 
+#undef	PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args)			      \
+  .text;								      \
+  ENTRY (name)								      \
+    DO_CALL (syscall_name, args)
+
+#undef	PSEUDO_END_NOERRNO
+#define	PSEUDO_END_NOERRNO(name)					      \
+  END (name)
+
+#define ret_NOERRNO ret
+
 #ifndef PIC
 # define SYSCALL_ERROR_HANDLER	/* Nothing here; code in sysdep.S is used.  */
 #else
@@ -152,7 +164,7 @@
 # else
 /* Store (- %eax) into errno through the GOT.  */
 #  define SYSCALL_ERROR_HANDLER						      \
-0:SETUP_PIC_REG(cx);						      \
+0:SETUP_PIC_REG(cx);							      \
   addl $_GLOBAL_OFFSET_TABLE_, %ecx;					      \
   xorl %edx, %edx;							      \
   subl %eax, %edx;							      \
@@ -235,12 +247,12 @@
 #define _DOARGS_0(n)	/* No arguments to frob.  */
 #define	_POPARGS_0	/* No arguments to pop.  */
 
-#define PUSHARGS_1	movl %ebx, %edx; PUSHARGS_0
+#define PUSHARGS_1	movl %ebx, %edx; L(SAVEBX1): PUSHARGS_0
 #define	DOARGS_1	_DOARGS_1 (4)
-#define	POPARGS_1	POPARGS_0; movl %edx, %ebx
-#define	_PUSHARGS_1	pushl %ebx; _PUSHARGS_0
+#define	POPARGS_1	POPARGS_0; movl %edx, %ebx; L(RESTBX1):
+#define	_PUSHARGS_1	pushl %ebx; L(PUSHBX1): _PUSHARGS_0
 #define _DOARGS_1(n)	movl n(%esp), %ebx; _DOARGS_0(n-4)
-#define	_POPARGS_1	_POPARGS_0; popl %ebx
+#define	_POPARGS_1	_POPARGS_0; popl %ebx; L(POPBX1):
 
 #define PUSHARGS_2	PUSHARGS_1
 #define	DOARGS_2	_DOARGS_2 (8)
@@ -259,16 +271,16 @@
 #define PUSHARGS_4	_PUSHARGS_4
 #define DOARGS_4	_DOARGS_4 (24)
 #define POPARGS_4	_POPARGS_4
-#define _PUSHARGS_4	pushl %esi; _PUSHARGS_3
+#define _PUSHARGS_4	pushl %esi; L(PUSHSI1): _PUSHARGS_3
 #define _DOARGS_4(n)	movl n(%esp), %esi; _DOARGS_3 (n-4)
-#define _POPARGS_4	_POPARGS_3; popl %esi
+#define _POPARGS_4	_POPARGS_3; popl %esi; L(POPSI1):
 
 #define PUSHARGS_5	_PUSHARGS_5
 #define DOARGS_5	_DOARGS_5 (32)
 #define POPARGS_5	_POPARGS_5
-#define _PUSHARGS_5	pushl %edi; _PUSHARGS_4
+#define _PUSHARGS_5	pushl %edi; L(PUSHDI1): _PUSHARGS_4
 #define _DOARGS_5(n)	movl n(%esp), %edi; _DOARGS_4 (n-4)
-#define _POPARGS_5	_POPARGS_4; popl %edi
+#define _POPARGS_5	_POPARGS_4; popl %edi; L(POPDI1):
 
 #else	/* !__ASSEMBLER__ */
 
@@ -285,7 +297,7 @@
      ".macro bpushl name reg\n\t"
      ".if 1 - \\name\n\t"
      ".if 2 - \\name\n\t"
-     "pushl %ebx\n\t"
+     "error\n\t"
      ".else\n\t"
      "xchgl \\reg, %ebx\n\t"
      ".endif\n\t"
@@ -294,18 +306,11 @@
      ".macro bpopl name reg\n\t"
      ".if 1 - \\name\n\t"
      ".if 2 - \\name\n\t"
-     "popl %ebx\n\t"
+     "error\n\t"
      ".else\n\t"
      "xchgl \\reg, %ebx\n\t"
      ".endif\n\t"
      ".endif\n\t"
-     ".endm\n\t"
-     ".macro bmovl name reg\n\t"
-     ".if 1 - \\name\n\t"
-     ".if 2 - \\name\n\t"
-     "movl \\reg, %ebx\n\t"
-     ".endif\n\t"
-     ".endif\n\t"
      ".endm\n\t");
 
 /* Define a macro which expands inline into the wrapper code for a system
@@ -330,7 +335,8 @@
 # ifdef SHARED
 #  define INTERNAL_SYSCALL(name, err, nr, args...) \
   ({									      \
-    unsigned int resultvar;						      \
+    register unsigned int resultvar;					      \
+    EXTRAVAR_##nr							      \
     asm volatile (							      \
     LOADARGS_##nr							      \
     "movl %1, %%eax\n\t"						      \
@@ -343,7 +349,8 @@
 # else
 #  define INTERNAL_SYSCALL(name, err, nr, args...) \
   ({									      \
-    unsigned int resultvar;						      \
+    register unsigned int resultvar;					      \
+    EXTRAVAR_##nr							      \
     asm volatile (							      \
     LOADARGS_##nr							      \
     "movl %1, %%eax\n\t"						      \
@@ -356,11 +363,12 @@
 #else
 # define INTERNAL_SYSCALL(name, err, nr, args...) \
   ({									      \
-    unsigned int resultvar;						      \
+    register unsigned int resultvar;					      \
+    EXTRAVAR_##nr							      \
     asm volatile (							      \
     LOADARGS_##nr							      \
     "movl %1, %%eax\n\t"						      \
-    "int $0x80\n\t"						      \
+    "int $0x80\n\t"							      \
     RESTOREARGS_##nr							      \
     : "=a" (resultvar)							      \
     : "i" (__NR_##name) ASMFMT_##nr(args) : "memory", "cc");		      \
@@ -378,44 +386,92 @@
 #define INTERNAL_SYSCALL_ERRNO(val, err)	(-(val))
 
 #define LOADARGS_0
-#if defined I386_USE_SYSENTER && defined SHARED
-# define LOADARGS_1 \
-    "bpushl .L__X'%k3, %k3\n\t"						      \
-    "bmovl .L__X'%k3, %k3\n\t"
+#ifdef __PIC__
+# if defined I386_USE_SYSENTER
+#  define LOADARGS_1 \
+    "bpushl .L__X'%k3, %k3\n\t"
+#  define LOADARGS_5 \
+    "movl %%ebx, %4\n\t"						      \
+    "movl %3, %%ebx\n\t"
+# else
+#  define LOADARGS_1 \
+    "bpushl .L__X'%k2, %k2\n\t"
+#  define LOADARGS_5 \
+    "movl %%ebx, %3\n\t"						      \
+    "movl %2, %%ebx\n\t"
+# endif
+# define LOADARGS_2	LOADARGS_1
+# define LOADARGS_3 \
+    "xchgl %%ebx, %%edi\n\t"
+# define LOADARGS_4	LOADARGS_3
 #else
-# define LOADARGS_1 \
-    "bpushl .L__X'%k2, %k2\n\t"						      \
-    "bmovl .L__X'%k2, %k2\n\t"
+# define LOADARGS_1
+# define LOADARGS_2
+# define LOADARGS_3
+# define LOADARGS_4
+# define LOADARGS_5
 #endif
-#define LOADARGS_2	LOADARGS_1
-#define LOADARGS_3	LOADARGS_1
-#define LOADARGS_4	LOADARGS_1
-#define LOADARGS_5	LOADARGS_1
 
 #define RESTOREARGS_0
-#if defined I386_USE_SYSENTER && defined SHARED
-# define RESTOREARGS_1 \
+#ifdef __PIC__
+# if defined I386_USE_SYSENTER && defined SHARED
+#  define RESTOREARGS_1 \
     "bpopl .L__X'%k3, %k3\n\t"
-#else
-# define RESTOREARGS_1 \
+#  define RESTOREARGS_5 \
+    "movl %4, %%ebx"
+# else
+#  define RESTOREARGS_1 \
     "bpopl .L__X'%k2, %k2\n\t"
+#  define RESTOREARGS_5 \
+    "movl %3, %%ebx"
+# endif
+# define RESTOREARGS_2	RESTOREARGS_1
+# define RESTOREARGS_3 \
+    "xchgl %%edi, %%ebx\n\t"
+# define RESTOREARGS_4	RESTOREARGS_3
+#else
+# define RESTOREARGS_1
+# define RESTOREARGS_2
+# define RESTOREARGS_3
+# define RESTOREARGS_4
+# define RESTOREARGS_5
 #endif
-#define RESTOREARGS_2	RESTOREARGS_1
-#define RESTOREARGS_3	RESTOREARGS_1
-#define RESTOREARGS_4	RESTOREARGS_1
-#define RESTOREARGS_5	RESTOREARGS_1
 
 #define ASMFMT_0()
-#define ASMFMT_1(arg1) \
-	, "acdSD" (arg1)
-#define ASMFMT_2(arg1, arg2) \
-	, "adSD" (arg1), "c" (arg2)
-#define ASMFMT_3(arg1, arg2, arg3) \
-	, "aSD" (arg1), "c" (arg2), "d" (arg3)
-#define ASMFMT_4(arg1, arg2, arg3, arg4) \
-	, "aD" (arg1), "c" (arg2), "d" (arg3), "S" (arg4)
-#define ASMFMT_5(arg1, arg2, arg3, arg4, arg5) \
-	, "a" (arg1), "c" (arg2), "d" (arg3), "S" (arg4), "D" (arg5)
+#ifdef __PIC__
+# define ASMFMT_1(arg1) \
+	, "cd" (arg1)
+# define ASMFMT_2(arg1, arg2) \
+	, "d" (arg1), "c" (arg2)
+# define ASMFMT_3(arg1, arg2, arg3) \
+	, "D" (arg1), "c" (arg2), "d" (arg3)
+# define ASMFMT_4(arg1, arg2, arg3, arg4) \
+	, "D" (arg1), "c" (arg2), "d" (arg3), "S" (arg4)
+# define ASMFMT_5(arg1, arg2, arg3, arg4, arg5) \
+	, "0" (arg1), "m" (_xv), "c" (arg2), "d" (arg3), "S" (arg4), "D" (arg5)
+#else
+# define ASMFMT_1(arg1) \
+	, "b" (arg1)
+# define ASMFMT_2(arg1, arg2) \
+	, "b" (arg1), "c" (arg2)
+# define ASMFMT_3(arg1, arg2, arg3) \
+	, "b" (arg1), "c" (arg2), "d" (arg3)
+# define ASMFMT_4(arg1, arg2, arg3, arg4) \
+	, "b" (arg1), "c" (arg2), "d" (arg3), "S" (arg4)
+# define ASMFMT_5(arg1, arg2, arg3, arg4, arg5) \
+	, "b" (arg1), "c" (arg2), "d" (arg3), "S" (arg4), "D" (arg5)
+#endif
+
+#define EXTRAVAR_0
+#define EXTRAVAR_1
+#define EXTRAVAR_2
+#define EXTRAVAR_3
+#define EXTRAVAR_4
+#ifdef __PIC__
+# define EXTRAVAR_5 int _xv;
+#else
+# define EXTRAVAR_5
+#endif
 
 #endif	/* __ASSEMBLER__ */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/system.c libc-20030708/sysdeps/unix/sysv/linux/i386/system.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/system.c	2003-01-28 15:24:41.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/system.c	1970-01-01 09:00:00.000000000 +0900
@@ -1,73 +0,0 @@
-/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sched.h>
-#include <signal.h>
-#include <sysdep.h>
-#include <unistd.h>
-#include <sys/wait.h>
-#include <bits/libc-lock.h>
-#include <kernel-features.h>
-
-/* We have to and actually can handle cancelable system().  The big
-   problem: we have to kill the child process if necessary.  To do
-   this a cleanup handler has to be registered and is has to be able
-   to find the PID of the child.  The main problem is to reliable have
-   the PID when needed.  It is not necessary for the parent thread to
-   return.  It might still be in the kernel when the cancellation
-   request comes.  Therefore we have to use the clone() calls ability
-   to have the kernel write the PID into the user-level variable.  */
-#ifdef __ASSUME_CLONE_THREAD_FLAGS
-# define FORK() \
-  INLINE_SYSCALL (clone, 3, CLONE_PARENT_SETTID | SIGCHLD, 0, &pid)
-#endif
-
-static void cancel_handler (void *arg);
-
-#define CLEANUP_HANDLER \
-  __libc_cleanup_region_start (1, cancel_handler, &pid)
-
-#define CLEANUP_RESET \
-  __libc_cleanup_region_end (0)
-
-
-/* Linux has waitpid(), so override the generic unix version.  */
-#include <sysdeps/posix/system.c>
-
-
-/* The cancellation handler.  */
-static void
-cancel_handler (void *arg)
-{
-  pid_t child = *(pid_t *) arg;
-
-  INTERNAL_SYSCALL_DECL (err);
-  INTERNAL_SYSCALL (kill, err, 2, child, SIGKILL);
-
-  TEMP_FAILURE_RETRY (__waitpid (child, NULL, 0));
-
-  DO_LOCK ();
-
-  if (SUB_REF () == 0)
-    {
-      (void) __sigaction (SIGQUIT, &quit, (struct sigaction *) NULL);
-      (void) __sigaction (SIGINT, &intr, (struct sigaction *) NULL);
-    }
-
-  DO_UNLOCK ();
-}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/i386/xstat.c libc-20030708/sysdeps/unix/sysv/linux/i386/xstat.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/i386/xstat.c	2002-08-13 23:29:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/i386/xstat.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* xstat using old-style Unix stat system call.
-   Copyright (C) 1991,95,96,97,98,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,95,96,97,98,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +32,7 @@
 
 #include "kernel-features.h"
 
-#include <xstatconv.c>
+#include <xstatconv.h>
 
 extern int __syscall_stat (const char *__unbounded,
 			   struct kernel_stat *__unbounded);
@@ -65,7 +65,7 @@
 
     result = INLINE_SYSCALL (stat64, 2, CHECK_STRING (name), __ptrvalue (&buf64));
     if (result == 0)
-      result = xstat32_conv (vers, &buf64, buf);
+      result = __xstat32_conv (vers, &buf64, buf);
     return result;
   }
 #else
@@ -79,7 +79,7 @@
       result = INLINE_SYSCALL (stat64, 2, CHECK_STRING (name), __ptrvalue (&buf64));
 
       if (result == 0)
-	result = xstat32_conv (vers, &buf64, buf);
+	result = __xstat32_conv (vers, &buf64, buf);
 
       if (result != -1 || errno != ENOSYS)
 	return result;
@@ -89,7 +89,7 @@
 # endif
   result = INLINE_SYSCALL (stat, 2, CHECK_STRING (name), __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat_conv (vers, &kbuf, buf);
+    result = __xstat_conv (vers, &kbuf, buf);
 
   return result;
 #endif  /* __ASSUME_STAT64_SYSCALL  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/Makefile libc-20030708/sysdeps/unix/sysv/linux/ia64/Makefile
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/Makefile	2002-08-25 09:35:53.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/Makefile	2003-06-12 08:54:05.000000000 +0900
@@ -4,6 +4,7 @@
 
 ifeq ($(subdir),stdlib)
 sysdep_routines += __start_context
+gen-as-const-headers += sigcontext-offsets.sym
 endif
 
 ifeq ($(subdir),misc)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/fcntl.h libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/fcntl.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/fcntl.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/fcntl.h	2003-04-28 23:53:26.000000000 +0900
@@ -169,6 +169,6 @@
 # define POSIX_FADV_RANDOM	1 /* Expect random page references.  */
 # define POSIX_FADV_SEQUENTIAL	2 /* Expect sequential page references.	 */
 # define POSIX_FADV_WILLNEED	3 /* Will need these pages.  */
-# define POSIX_FADV_DONTNEED	6 /* Don't need these pages.  */
-# define POSIX_FADV_NOREUSE	7 /* Data will be accessed once.  */
+# define POSIX_FADV_DONTNEED	4 /* Don't need these pages.  */
+# define POSIX_FADV_NOREUSE	5 /* Data will be accessed once.  */
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/mman.h	2002-07-18 08:38:55.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/mman.h	2003-03-03 18:56:24.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/ia64 version.
-   Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -52,12 +52,14 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	  0x0100	/* Stack-like segment.  */
-# define MAP_GROWSUP	  0x0200	/* Register stack-like segment */
-# define MAP_DENYWRITE	  0x0800	/* ETXTBSY */
-# define MAP_EXECUTABLE	  0x1000	/* Mark it as an executable.  */
-# define MAP_LOCKED	  0x2000	/* Lock the mapping.  */
-# define MAP_NORESERVE	  0x4000	/* Don't check for reservations.  */
+# define MAP_GROWSDOWN	  0x00100	/* Stack-like segment.  */
+# define MAP_GROWSUP	  0x00200	/* Register stack-like segment */
+# define MAP_DENYWRITE	  0x00800	/* ETXTBSY */
+# define MAP_EXECUTABLE	  0x01000	/* Mark it as an executable.  */
+# define MAP_LOCKED	  0x02000	/* Lock the mapping.  */
+# define MAP_NORESERVE	  0x04000	/* Don't check for reservations.  */
+# define MAP_POPULATE	  0x08000	/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	  0x10000	/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/setjmp.h libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/setjmp.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/setjmp.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/setjmp.h	2003-04-15 23:55:50.000000000 +0900
@@ -1,5 +1,5 @@
 /* Define the machine-dependent type `jmp_buf'.  Linux/IA-64 version.
-   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Mosberger-Tang <davidm@hpl.hp.com>.
 
@@ -18,7 +18,10 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#ifndef _SETJMP_H
+#ifndef _BITS_SETJMP_H
+#define _BITS_SETJMP_H  1
+
+#if !defined _SETJMP_H && !defined _PTHREAD_H
 # error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
 #endif
 
@@ -33,3 +36,5 @@
    variable at ADDRESS.  */
 #define _JMPBUF_UNWINDS(_jmpbuf, _address)		\
      ((void *)(_address) < (void *)(((long *)_jmpbuf)[0]))
+
+#endif  /* bits/setjmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/sigaction.h libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/sigaction.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/sigaction.h	2001-09-25 09:46:59.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/sigaction.h	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for Linux/ia64 sigaction.
-   Copyright (C) 1996, 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -49,6 +49,7 @@
 
 /* Bits in `sa_flags'.  */
 #define SA_NOCLDSTOP  0x00000001 /* Don't send SIGCHLD when children stop.  */
+#define SA_NOCLDWAIT  0x00000002 /* Don't create zombie on child death.  */
 #define SA_SIGINFO    0x00000004
 #if defined __USE_UNIX98 || defined __USE_MISC
 # define SA_ONSTACK   0x08000000 /* Use signal stack by using `sa_restorer'. */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/siginfo.h libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/siginfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/siginfo.h	2002-12-05 09:21:53.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/siginfo.h	2003-04-28 23:53:26.000000000 +0900
@@ -1,5 +1,5 @@
 /* siginfo_t, sigevent and constants.  Linux/ia64 version.
-   Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Mosberger-Tang <davidm@hpl.hp.com>.
 
@@ -65,8 +65,9 @@
 	/* POSIX.1b timers.  */
 	struct
 	  {
-	    unsigned int _timer1;
-	    unsigned int _timer2;
+	    int si_tid;		/* Timer ID.  */
+	    int si_overrun;	/* Overrun count.  */
+	    sigval_t si_sigval;	/* Signal value.  */
 	  } _timer;
 
 	/* POSIX.1b signals.  */
@@ -109,6 +110,8 @@
 /* X/Open requires some more fields with fixed names.  */
 # define si_pid		_sifields._kill.si_pid
 # define si_uid		_sifields._kill.si_uid
+# define si_timerid	_sifields._timer.si_tid
+# define si_overrun	_sifields._timer.si_overrun
 # define si_status	_sifields._sigchld.si_status
 # define si_utime	_sifields._sigchld.si_utime
 # define si_stime	_sifields._sigchld.si_stime
@@ -128,8 +131,10 @@
    signals.  */
 enum
 {
-  SI_ASYNCNL = -6,		/* Sent by asynch name lookup completion.  */
+  SI_ASYNCNL = -60,		/* Sent by asynch name lookup completion.  */
 # define SI_ASYNCNL	SI_ASYNCNL
+  SI_TKILL = -6,		/* Sent by tkill.  */
+# define SI_TKILL	SI_TKILL
   SI_SIGIO,			/* Sent by queued SIGIO. */
 # define SI_SIGIO	SI_SIGIO
   SI_ASYNCIO,			/* Sent by AIO completion.  */
@@ -294,9 +299,6 @@
 # define __SIGEV_MAX_SIZE	64
 # define __SIGEV_PAD_SIZE	((__SIGEV_MAX_SIZE / sizeof (int)) - 4)
 
-/* Forward declaration of the `pthread_attr_t' type.  */
-struct __pthread_attr_s;
-
 typedef struct sigevent
   {
     sigval_t sigev_value;
@@ -326,8 +328,11 @@
 # define SIGEV_SIGNAL	SIGEV_SIGNAL
   SIGEV_NONE,			/* Other notification: meaningless.  */
 # define SIGEV_NONE	SIGEV_NONE
-  SIGEV_THREAD			/* Deliver via thread creation.  */
+  SIGEV_THREAD,			/* Deliver via thread creation.  */
 # define SIGEV_THREAD	SIGEV_THREAD
+
+  SIGEV_THREAD_ID = 4		/* Send signal to specific thread.  */
+#define SIGEV_THREAD_ID	SIGEV_THREAD_ID
 };
 
 #endif	/* have _SIGNAL_H.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/bits/stat.h	2003-01-01 05:08:57.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/bits/stat.h	2003-07-08 22:58:14.000000000 +0900
@@ -108,6 +108,8 @@
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
 #define _STATBUF_ST_RDEV
+/* Nanosecond resolution time values are supported.  */
+#define _STATBUF_ST_NSEC
 
 /* Encoding of the file mode.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/brk.S libc-20030708/sysdeps/unix/sysv/linux/ia64/brk.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/brk.S	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/brk.S	2003-03-03 16:11:46.000000000 +0900
@@ -1,5 +1,5 @@
 /* brk system call for Linux/ia64
-   Copyright (C) 1999, 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1999,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Written by Stephane Eranian <eranian@hpl.hp.com> and
 	      Jes Sorensen, <Jes.Sorensen@cern.ch>, April 1999.
@@ -25,6 +25,8 @@
 #include <asm/errno.h>
 
 	.global __curbrk
+	.type __curbrk,@object
+	.size __curbrk,8
 	.data
 	.align	8
 __curbrk:
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/clone2.S libc-20030708/sysdeps/unix/sysv/linux/ia64/clone2.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/clone2.S	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/clone2.S	2003-03-13 13:36:59.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,10 +22,11 @@
 
 
 /* int  __clone2(int (*fn) (void *arg), void *child_stack_base, 	*/
-/* 	         size_t child_stack_size, int flags, void *arg) */
+/* 	         size_t child_stack_size, int flags, void *arg,		*/
+/*	         pid_t *parent_tid, void *tls, pid_t *child_tid)	*/
 
 ENTRY(__clone2)
-	alloc r2=ar.pfs,5,2,3,0
+	alloc r2=ar.pfs,8,2,6,0
 	cmp.eq p6,p0=0,in0
 	mov r8=EINVAL
 (p6)	br.cond.spnt.few __syscall_error
@@ -41,6 +42,9 @@
 	mov out0=in3		/* Flags are first syscall argument.	*/
 	mov out1=in1		/* Stack address.			*/
 	mov out2=in2		/* Stack size.				*/
+	mov out3=in5		/* Parent TID Pointer			*/
+	mov out4=in7		/* Child TID Pointer			*/
+ 	mov out5=in6		/* TLS pointer				*/
         DO_CALL (SYS_ify (clone2))
         cmp.eq p6,p0=-1,r10
 	;;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/fork.S libc-20030708/sysdeps/unix/sysv/linux/ia64/fork.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/fork.S	2003-01-01 04:13:28.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/fork.S	2003-04-01 21:01:06.000000000 +0900
@@ -32,7 +32,6 @@
 	;;
 	DO_CALL (SYS_ify (clone))
 	cmp.eq p6,p0=-1,r10
-	;;
 (p6)	br.cond.spnt.few __syscall_error
 	ret
 PSEUDO_END(__libc_fork)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/getcontext.S libc-20030708/sysdeps/unix/sysv/linux/ia64/getcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/getcontext.S	2002-10-09 18:57:31.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/getcontext.S	2003-03-28 21:28:20.000000000 +0900
@@ -34,6 +34,7 @@
   other than the PRESERVED state.  */
 
 ENTRY(__getcontext)
+	.prologue
 	alloc r16 = ar.pfs, 1, 0, 3, 0
 
 	// sigprocmask (SIG_BLOCK, NULL, &sc->sc_mask):
@@ -53,7 +54,9 @@
 	add r2 = SC_GR+1*8, r32
 	;;
 	mov.m rBSP = ar.bsp
+	.save ar.unat, rUNAT
 	mov.m rUNAT = ar.unat
+	.body
 	add r3 = SC_GR+4*8, r32
 	;;
 
@@ -65,8 +68,8 @@
 .mem.offset 8,0; st8.spill [r3] = r6, 48
 	and rTMP = ~0x3, rRSC
 	;;
-	st8.spill [r2] = r7, (SC_FR+2*16-(SC_GR+7*8))
-	st8.spill [r3] = sp, (SC_FR+3*16-(SC_GR+12*8))
+.mem.offset 0,0; st8.spill [r2] = r7, (SC_FR+2*16-(SC_GR+7*8))
+.mem.offset 8,0; st8.spill [r3] = sp, (SC_FR+3*16-(SC_GR+12*8))
 	;;
 	mov.m ar.rsc = rTMP 		// put RSE into enforced lazy mode
 	mov.m rNAT = ar.unat
@@ -119,8 +122,8 @@
 	stf.spill [r3] = f31, 32
 	mov rB1 = b1
 	;;
+	mov ar.unat = rUNAT	// we're done spilling integer regs; restore caller's UNaT
 	add r2 = SC_NAT, r32
-	nop 0
 	add r3 = SC_BSP, r32
 	;;
 	st8 [r2] = rNAT, (SC_RNAT-SC_NAT)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/kernel_stat.h libc-20030708/sysdeps/unix/sysv/linux/ia64/kernel_stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/kernel_stat.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/kernel_stat.h	2003-06-13 01:15:15.000000000 +0900
@@ -0,0 +1,21 @@
+/* Definition of `struct stat' used in the kernel.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define STAT_IS_KERNEL_STAT 1
+#define XSTAT_IS_XSTAT64 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/setcontext.S libc-20030708/sysdeps/unix/sysv/linux/ia64/setcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/setcontext.S	2001-07-08 04:21:34.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/setcontext.S	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001 Free Software Foundation, Inc.
+/* Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
      Contributed by David Mosberger-Tang <davidm@hpl.hp.com>.
 
@@ -32,7 +32,7 @@
   other than the PRESERVED state.  */
 
 ENTRY(__setcontext)
-	alloc r16 = ar.pfs, 1, 0, 3, 0
+	alloc r16 = ar.pfs, 1, 0, 4, 0
 
 	// sigprocmask (SIG_SETMASK, &sc->sc_mask, NULL):
 
@@ -42,6 +42,7 @@
 	mov out0 = SIG_SETMASK
 	add out1 = r2, in0
 	mov out2 = 0
+	mov out3 = 8	// sizeof kernel sigset_t
 
 	invala
 	break __BREAK_SYSCALL
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/setjmp.S libc-20030708/sysdeps/unix/sysv/linux/ia64/setjmp.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/setjmp.S	2003-01-01 04:13:28.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/setjmp.S	2003-05-21 23:20:38.000000000 +0900
@@ -86,22 +86,23 @@
 
 ENTRY(__sigsetjmp)
 	.prologue ASM_UNW_PRLG_RP|ASM_UNW_PRLG_PFS, ASM_UNW_PRLG_GRSAVE(2)
-	alloc loc1=ar.pfs,2,2,2,0
-	mov r16=ar.unat
+	alloc loc1=ar.pfs,2,3,2,0
+	.save ar.unat, loc2
+	mov loc2=ar.unat
 	;;
 	mov r17=ar.fpsr
 	mov r2=in0
 	add r3=8,in0
 	;;
-	st8.spill.nta [r2]=sp,16	// r12 (sp)
-	st8.spill.nta [r3]=gp,16	// r1 (gp)
+.mem.offset 8,0;	st8.spill.nta [r2]=sp,16	// r12 (sp)
+.mem.offset 0,0;	st8.spill.nta [r3]=gp,16	// r1 (gp)
 	;;
-	st8.nta [r2]=r16,16		// save caller's unat
+	st8.nta [r2]=loc2,16		// save caller's unat
 	st8.nta [r3]=r17,16		// save fpsr
 	add r8=0xa0,in0
 	;;
-	st8.spill.nta [r2]=r4,16	// r4
-	st8.spill.nta [r3]=r5,16	// r5
+.mem.offset 8,0;	st8.spill.nta [r2]=r4,16	// r4
+.mem.offset 0,0;	st8.spill.nta [r3]=r5,16	// r5
 	add r9=0xb0,in0
 	;;
 	stf.spill.nta [r8]=f2,32
@@ -143,8 +144,8 @@
 	stf.spill.nta [r8]=f30
 	stf.spill.nta [r9]=f31
 
-	st8.spill.nta [r2]=r6,16	// r6
-	st8.spill.nta [r3]=r7,16	// r7
+.mem.offset 8,0;	st8.spill.nta [r2]=r6,16	// r6
+.mem.offset 0,0;	st8.spill.nta [r3]=r7,16	// r7
 	;;
 	mov r23=ar.bsp
 	mov r25=ar.unat
@@ -170,9 +171,10 @@
 	st8.nta [r3]=in0		// &__jmp_buf
 	br.call.dpnt.few rp=__sigjmp_save
 .ret0:					// force a new bundle ::q
-	mov r8=0
+	mov.m ar.unat=loc2		// restore caller's unat
 	mov rp=loc0
 	mov ar.pfs=loc1
+	mov r8=0
 	ret
 END(__sigsetjmp)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/sigcontext-offsets.sym libc-20030708/sysdeps/unix/sysv/linux/ia64/sigcontext-offsets.sym
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/sigcontext-offsets.sym	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/sigcontext-offsets.sym	2003-06-03 04:56:22.000000000 +0900
@@ -0,0 +1,16 @@
+#include <stddef.h>
+#include <sys/ucontext.h>
+
+--
+SC_NAT		offsetof (struct sigcontext, sc_nat)
+SC_BSP		offsetof (struct sigcontext, sc_ar_bsp)
+SC_RNAT		offsetof (struct sigcontext, sc_ar_rnat)
+SC_UNAT		offsetof (struct sigcontext, sc_ar_unat)
+SC_FPSR		offsetof (struct sigcontext, sc_ar_fpsr)
+SC_PFS		offsetof (struct sigcontext, sc_ar_pfs)
+SC_LC		offsetof (struct sigcontext, sc_ar_lc)
+SC_PR		offsetof (struct sigcontext, sc_pr)
+SC_BR		offsetof (struct sigcontext, sc_br)
+SC_GR		offsetof (struct sigcontext, sc_gr)
+SC_FR		offsetof (struct sigcontext, sc_fr)
+SC_MASK		offsetof (struct sigcontext, sc_mask)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/syscalls.list libc-20030708/sysdeps/unix/sysv/linux/ia64/syscalls.list
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/syscalls.list	2003-02-06 06:40:50.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/syscalls.list	2003-04-15 23:55:50.000000000 +0900
@@ -30,6 +30,7 @@
 shmdt		-	shmdt		i:s	__shmdt		shmdt
 shmget		-	shmget		i:iii	__shmget	shmget
 semop		-	semop		i:ipi	__semop		semop
+semtimedop	-	semtimedop	i:ipip	semtimedop
 semget		-	semget		i:iii	__semget	semget
 semctl		-	semctl		i:iiii	__semctl	semctl
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/ia64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/sysdep.h	2003-01-09 11:54:57.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/sysdep.h	2003-05-10 13:38:07.000000000 +0900
@@ -45,6 +45,12 @@
 # define __NR_pwrite __NR_pwrite64
 #endif
 
+/* This is to help the old kernel headers where __NR_semtimedop is not
+   available.  */
+#ifndef __NR_semtimedop
+# define __NR_semtimedop 1247
+#endif
+
 #ifdef __ASSEMBLER__
 
 #undef CALL_MCOUNT
@@ -96,15 +102,27 @@
 #undef PSEUDO_END
 #define PSEUDO_END(name)	.endp C_SYMBOL_NAME(name);
 
+#undef PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args)	\
+  ENTRY(name)						\
+    DO_CALL (SYS_ify(syscall_name));
+
+#undef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(name)	.endp C_SYMBOL_NAME(name);
+
 #undef END
 #define END(name)						\
 	.size	C_SYMBOL_NAME(name), . - C_SYMBOL_NAME(name) ;	\
 	.endp	C_SYMBOL_NAME(name)
 
 #define ret			br.ret.sptk.few b0
+#define ret_NOERRNO		ret
 
 #else /* not __ASSEMBLER__ */
 
+#define BREAK_INSN_1(num) "break " #num ";;\n\t"
+#define BREAK_INSN(num) BREAK_INSN_1(num)
+
 /* On IA-64 we have stacked registers for passing arguments.  The
    "out" registers end up being the called function's "in"
    registers.
@@ -121,10 +139,10 @@
     register long _r15 asm ("r15") = __NR_##name;		\
     long _retval;						\
     LOAD_ARGS_##nr (args);					\
-    __asm __volatile ("break %3;;\n\t"				\
+    __asm __volatile (BREAK_INSN (__BREAK_SYSCALL)		\
                       : "=r" (_r8), "=r" (_r10), "=r" (_r15)	\
-                      : "i" (__BREAK_SYSCALL), "2" (_r15)	\
-			ASM_ARGS_##nr				\
+			ASM_OUTARGS_##nr			\
+                      : "2" (_r15) ASM_ARGS_##nr		\
                       : "memory" ASM_CLOBBERS_##nr);		\
     _retval = _r8;						\
     if (_r10 == -1)						\
@@ -145,10 +163,10 @@
     register long _r15 asm ("r15") = __NR_##name;		\
     long _retval;						\
     LOAD_ARGS_##nr (args);					\
-    __asm __volatile ("break %3;;\n\t"				\
+    __asm __volatile (BREAK_INSN (__BREAK_SYSCALL)		\
                       : "=r" (_r8), "=r" (_r10), "=r" (_r15)	\
-                      : "i" (__BREAK_SYSCALL), "2" (_r15)	\
-			ASM_ARGS_##nr				\
+			ASM_OUTARGS_##nr			\
+                      : "2" (_r15) ASM_ARGS_##nr		\
                       : "memory" ASM_CLOBBERS_##nr);		\
     _retval = _r8;						\
     err = _r10;							\
@@ -176,20 +194,33 @@
 #define LOAD_ARGS_5(out0, out1, out2, out3, out4)	\
   register long _out4 asm ("out4") = (long) (out4);	\
   LOAD_ARGS_4 (out0, out1, out2, out3)
+#define LOAD_ARGS_6(out0, out1, out2, out3, out4, out5)	\
+  register long _out5 asm ("out5") = (long) (out5);	\
+  LOAD_ARGS_5 (out0, out1, out2, out3, out4)
+
+#define ASM_OUTARGS_0
+#define ASM_OUTARGS_1	ASM_OUTARGS_0, "=r" (_out0)
+#define ASM_OUTARGS_2	ASM_OUTARGS_1, "=r" (_out1)
+#define ASM_OUTARGS_3	ASM_OUTARGS_2, "=r" (_out2)
+#define ASM_OUTARGS_4	ASM_OUTARGS_3, "=r" (_out3)
+#define ASM_OUTARGS_5	ASM_OUTARGS_4, "=r" (_out4)
+#define ASM_OUTARGS_6	ASM_OUTARGS_5, "=r" (_out5)
 
 #define ASM_ARGS_0
-#define ASM_ARGS_1      ASM_ARGS_0, "r" (_out0)
-#define ASM_ARGS_2      ASM_ARGS_1, "r" (_out1)
-#define ASM_ARGS_3      ASM_ARGS_2, "r" (_out2)
-#define ASM_ARGS_4      ASM_ARGS_3, "r" (_out3)
-#define ASM_ARGS_5      ASM_ARGS_4, "r" (_out4)
+#define ASM_ARGS_1	ASM_ARGS_0, "3" (_out0)
+#define ASM_ARGS_2	ASM_ARGS_1, "4" (_out1)
+#define ASM_ARGS_3	ASM_ARGS_2, "5" (_out2)
+#define ASM_ARGS_4	ASM_ARGS_3, "6" (_out3)
+#define ASM_ARGS_5	ASM_ARGS_4, "7" (_out4)
+#define ASM_ARGS_6	ASM_ARGS_5, "8" (_out5)
 
 #define ASM_CLOBBERS_0	ASM_CLOBBERS_1, "out0"
 #define ASM_CLOBBERS_1	ASM_CLOBBERS_2, "out1"
 #define ASM_CLOBBERS_2	ASM_CLOBBERS_3, "out2"
 #define ASM_CLOBBERS_3	ASM_CLOBBERS_4, "out3"
 #define ASM_CLOBBERS_4	ASM_CLOBBERS_5, "out4"
-#define ASM_CLOBBERS_5	, "out5", "out6", "out7",			\
+#define ASM_CLOBBERS_5	ASM_CLOBBERS_6, "out5"
+#define ASM_CLOBBERS_6	, "out6", "out7",				\
   /* Non-stacked integer registers, minus r8, r10, r15.  */		\
   "r2", "r3", "r9", "r11", "r12", "r13", "r14", "r16", "r17", "r18",	\
   "r19", "r20", "r21", "r22", "r23", "r24", "r25", "r26", "r27",	\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/system.c libc-20030708/sysdeps/unix/sysv/linux/ia64/system.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/system.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/system.c	2003-03-16 08:47:44.000000000 +0900
@@ -0,0 +1,35 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <kernel-features.h>
+
+/* We have to and actually can handle cancelable system().  The big
+   problem: we have to kill the child process if necessary.  To do
+   this a cleanup handler has to be registered and is has to be able
+   to find the PID of the child.  The main problem is to reliable have
+   the PID when needed.  It is not necessary for the parent thread to
+   return.  It might still be in the kernel when the cancellation
+   request comes.  Therefore we have to use the clone() calls ability
+   to have the kernel write the PID into the user-level variable.  */
+#ifdef __ASSUME_CLONE_THREAD_FLAGS
+# define FORK() \
+  INLINE_SYSCALL (clone2, 6, CLONE_PARENT_SETTID | SIGCHLD, NULL, 0, \
+		  &pid, NULL, NULL)
+#endif
+
+#include "../system.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/ucontext_i.h libc-20030708/sysdeps/unix/sysv/linux/ia64/ucontext_i.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/ucontext_i.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/ucontext_i.h	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001 Free Software Foundation, Inc.
+/* Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
      Contributed by David Mosberger-Tang <davidm@hpl.hp.com>.
 
@@ -24,19 +24,7 @@
 #define SIG_UNBLOCK	1
 #define SIG_SETMASK	2
 
-#define SC_NAT	0x008
-#define SC_BSP	0x048
-#define SC_RNAT	0x050
-#define SC_UNAT	0x060
-#define SC_FPSR	0x068
-#define SC_PFS	0x070
-#define SC_LC	0x078
-#define SC_PR	0x080
-#define SC_BR	0x088
-#define SC_GR	0x0c8
-#define SC_FR	0x1d0
-#define SC_MASK	0x9d0
-
+#include <sigcontext-offsets.h>
 
 #define rTMP	r16
 #define rPOS	r16
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/umount.c libc-20030708/sysdeps/unix/sysv/linux/ia64/umount.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ia64/umount.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ia64/umount.c	2003-05-15 09:26:00.000000000 +0900
@@ -0,0 +1,31 @@
+/* umount system call for Linux/ia64.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/mount.h>
+#include <errno.h>
+
+#include <sysdep.h>
+#include <bp-checks.h>
+
+/* Unmount a filesystem.  */
+int
+umount (const char *special_file)
+{
+  return INLINE_SYSCALL (umount, 2, CHECK_STRING (special_file), 0);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ifaddrs.c libc-20030708/sysdeps/unix/sysv/linux/ifaddrs.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ifaddrs.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ifaddrs.c	2003-06-12 08:54:05.000000000 +0900
@@ -0,0 +1,810 @@
+/* getifaddrs -- get names and addresses of all network interfaces
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <assert.h>
+#include <errno.h>
+#include <ifaddrs.h>
+#include <net/if.h>
+#include <netinet/in.h>
+#include <netpacket/packet.h>
+#include <stdbool.h>
+#include <stdlib.h>
+#include <string.h>
+#include <sys/ioctl.h>
+#include <sys/socket.h>
+#include <sysdep.h>
+#include <time.h>
+#include <unistd.h>
+
+#include <asm/types.h>
+#include <linux/netlink.h>
+#include <linux/rtnetlink.h>
+
+#include "kernel-features.h"
+
+/* We don't know if we have NETLINK support compiled in in our
+   Kernel, so include the old implementation as fallback.  */
+#if __ASSUME_NETLINK_SUPPORT == 0
+int __no_netlink_support attribute_hidden;
+
+# define getifaddrs fallback_getifaddrs
+# include "sysdeps/gnu/ifaddrs.c"
+# undef getifaddrs
+
+#else
+
+# define __no_netlink_support 0
+
+#endif
+
+
+struct netlink_res
+{
+  struct netlink_res *next;
+  struct nlmsghdr *nlh;
+  size_t size;			/* Size of response.  */
+  uint32_t seq;			/* sequential number we used.  */
+};
+
+
+struct netlink_handle
+{
+  int fd;			/* Netlink file descriptor.  */
+  pid_t pid;			/* Process ID.  */
+  uint32_t seq;			/* The sequence number we use currently.  */
+  struct netlink_res *nlm_list;	/* Pointer to list of responses.  */
+  struct netlink_res *end_ptr;	/* For faster append of new entries.  */
+};
+
+
+/* struct to hold the data for one ifaddrs entry, so we can allocate
+   everything at once.  */
+struct ifaddrs_storage
+{
+  struct ifaddrs ifa;
+  union
+  {
+    /* Save space for the biggest of the four used sockaddr types and
+       avoid a lot of casts.  */
+    struct sockaddr sa;
+    struct sockaddr_ll sl;
+    struct sockaddr_in s4;
+    struct sockaddr_in6 s6;
+  } addr, netmask, broadaddr;
+  char name[IF_NAMESIZE + 1];
+};
+
+
+static void
+free_netlink_handle (struct netlink_handle *h)
+{
+  struct netlink_res *ptr;
+  int saved_errno = errno;
+
+  ptr = h->nlm_list;
+  while (ptr != NULL)
+    {
+      struct netlink_res *tmpptr;
+
+      tmpptr = ptr->next;
+      free (ptr);
+      ptr = tmpptr;
+    }
+
+  errno = saved_errno;
+}
+
+
+static int
+netlink_sendreq (struct netlink_handle *h, int type)
+{
+  struct
+  {
+    struct nlmsghdr nlh;
+    struct rtgenmsg g;
+  } req;
+  struct sockaddr_nl nladdr;
+
+  if (h->seq == 0)
+    h->seq = time (NULL);
+
+  req.nlh.nlmsg_len = sizeof (req);
+  req.nlh.nlmsg_type = type;
+  req.nlh.nlmsg_flags = NLM_F_ROOT | NLM_F_MATCH | NLM_F_REQUEST;
+  req.nlh.nlmsg_pid = 0;
+  req.nlh.nlmsg_seq = h->seq;
+  req.g.rtgen_family = AF_UNSPEC;
+
+  memset (&nladdr, '\0', sizeof (nladdr));
+  nladdr.nl_family = AF_NETLINK;
+
+  return TEMP_FAILURE_RETRY (__sendto (h->fd, (void *) &req, sizeof (req), 0,
+				       (struct sockaddr *) &nladdr,
+				       sizeof (nladdr)));
+}
+
+
+static int
+netlink_receive (struct netlink_handle *h)
+{
+  struct netlink_res *nlm_next;
+  char buf[4096];
+  struct iovec iov = { buf, sizeof (buf) };
+  struct sockaddr_nl nladdr;
+  struct nlmsghdr *nlmh;
+  int read_len;
+  bool done = false;
+
+  while (! done)
+    {
+      struct msghdr msg =
+	{
+	  (void *) &nladdr, sizeof (nladdr),
+	  &iov, 1,
+	  NULL, 0,
+	  0
+	};
+
+      read_len = TEMP_FAILURE_RETRY (__recvmsg (h->fd, &msg, 0));
+      if (read_len < 0)
+	return -1;
+
+      if (msg.msg_flags & MSG_TRUNC)
+	return -1;
+
+      nlm_next = (struct netlink_res *) malloc (sizeof (struct netlink_res)
+						+ read_len);
+      if (nlm_next == NULL)
+	return -1;
+      nlm_next->next = NULL;
+      nlm_next->nlh = memcpy (nlm_next + 1, buf, read_len);
+      nlm_next->size = read_len;
+      nlm_next->seq = h->seq;
+      if (h->nlm_list == NULL)
+	h->nlm_list = nlm_next;
+      else
+	h->end_ptr->next = nlm_next;
+      h->end_ptr = nlm_next;
+
+      for (nlmh = (struct nlmsghdr *) buf;
+	   NLMSG_OK (nlmh, (size_t) read_len);
+	   nlmh = (struct nlmsghdr *) NLMSG_NEXT (nlmh, read_len))
+	{
+	  if ((pid_t) nlmh->nlmsg_pid != h->pid || nlmh->nlmsg_seq != h->seq)
+	    continue;
+
+	  if (nlmh->nlmsg_type == NLMSG_DONE)
+	    {
+	      /* We found the end, leave the loop.  */
+	      done = true;
+	      break;
+	    }
+	  if (nlmh->nlmsg_type == NLMSG_ERROR)
+	    {
+	      struct nlmsgerr *nlerr = (struct nlmsgerr *) NLMSG_DATA (nlmh);
+	      if (nlmh->nlmsg_len < NLMSG_LENGTH (sizeof (struct nlmsgerr)))
+		errno = EIO;
+	      else
+		errno = -nlerr->error;
+	      return -1;
+	    }
+	}
+    }
+  return 0;
+}
+
+
+static void
+netlink_close (struct netlink_handle *h)
+{
+  /* Don't modify errno.  */
+  INTERNAL_SYSCALL_DECL (err);
+  (void) INTERNAL_SYSCALL (close, err, 1, h->fd);
+}
+
+
+/* Open a NETLINK socket.  */
+static int
+netlink_open (struct netlink_handle *h)
+{
+  struct sockaddr_nl nladdr;
+
+  h->fd = __socket (PF_NETLINK, SOCK_RAW, NETLINK_ROUTE);
+  if (h->fd < 0)
+    return -1;
+
+  memset (&nladdr, '\0', sizeof (nladdr));
+  nladdr.nl_family = AF_NETLINK;
+  if (__bind (h->fd, (struct sockaddr *) &nladdr, sizeof (nladdr)) < 0)
+    {
+    close_and_out:
+      netlink_close (h);
+      return -1;
+    }
+  /* Determine the ID the kernel assigned for this netlink connection.
+     It is not necessarily the PID if there is more than one socket
+     open.  */
+  socklen_t addr_len = sizeof (nladdr);
+  if (__getsockname (h->fd, (struct sockaddr *) &nladdr, &addr_len) < 0)
+    goto close_and_out;
+  h->pid = nladdr.nl_pid;
+  return 0;
+}
+
+
+/* We know the number of RTM_NEWLINK entries, so we reserve the first
+   # of entries for this type. All RTM_NEWADDR entries have an index
+   pointer to the RTM_NEWLINK entry.  To find the entry, create
+   a table to map kernel index entries to our index numbers.
+   Since we get at first all RTM_NEWLINK entries, it can never happen
+   that a RTM_NEWADDR index is not known to this map.  */
+static int
+internal_function
+map_newlink (int index, struct ifaddrs_storage *ifas, int *map, int max)
+{
+  int i;
+
+  for (i = 0; i < max; i++)
+    {
+      if (map[i] == -1)
+	{
+	  map[i] = index;
+	  if (i > 0)
+	    ifas[i - 1].ifa.ifa_next = &ifas[i].ifa;
+	  return i;
+	}
+      else if (map[i] == index)
+	return i;
+    }
+  /* This should never be reached. If this will be reached, we have
+     a very big problem.  */
+  abort ();
+}
+
+
+/* Create a linked list of `struct ifaddrs' structures, one for each
+   network interface on the host machine.  If successful, store the
+   list in *IFAP and return 0.  On errors, return -1 and set `errno'.  */
+int
+getifaddrs (struct ifaddrs **ifap)
+{
+  struct netlink_handle nh = { 0, 0, 0, NULL, NULL };
+  struct netlink_res *nlp;
+  struct ifaddrs_storage *ifas;
+  unsigned int i, newlink, newaddr, newaddr_idx;
+  int *map_newlink_data;
+  size_t ifa_data_size = 0;  /* Size to allocate for all ifa_data.  */
+  char *ifa_data_ptr;        /* Pointer to the unused part of memory for
+				ifa_data.  */
+  int result = 0;
+
+  if (ifap)
+    *ifap = NULL;
+
+  if (! __no_netlink_support && netlink_open (&nh) < 0)
+    {
+#if __ASSUME_NETLINK_SUPPORT == 0
+       __no_netlink_support = 1;
+#else
+       return -1;
+#endif
+    }
+
+#if __ASSUME_NETLINK_SUPPORT == 0
+  if (__no_netlink_support)
+    return fallback_getifaddrs (ifap);
+#endif
+
+  /* Tell the kernel that we wish to get a list of all
+     active interfaces.  */
+  if (netlink_sendreq (&nh, RTM_GETLINK) < 0)
+    {
+      result = -1;
+      goto exit_close;
+    }
+  /* Collect all data for every interface.  */
+  if (netlink_receive (&nh) < 0)
+    {
+      result = -1;
+      goto exit_free;
+    }
+
+
+  /* Now ask the kernel for all addresses which are assigned
+     to an interface.  Since we store the addresses after the
+     interfaces in the list, we will later always find the
+     interface before the corresponding addresses.  */
+  ++nh.seq;
+  if (netlink_sendreq (&nh, RTM_GETADDR) < 0
+      /* Collect all data for every interface.  */
+      || netlink_receive (&nh) < 0)
+    {
+      result = -1;
+      goto exit_free;
+    }
+
+  /* Count all RTM_NEWLINK and RTM_NEWADDR entries to allocate
+     enough memory.  */
+  newlink = newaddr = 0;
+  for (nlp = nh.nlm_list; nlp; nlp = nlp->next)
+    {
+      struct nlmsghdr *nlh;
+      size_t size = nlp->size;
+
+      if (nlp->nlh == NULL)
+	continue;
+
+      /* Walk through all entries we got from the kernel and look, which
+         message type they contain.  */
+      for (nlh = nlp->nlh; NLMSG_OK (nlh, size); nlh = NLMSG_NEXT (nlh, size))
+	{
+	  /* check if the message is what we want */
+	  if ((pid_t) nlh->nlmsg_pid != nh.pid || nlh->nlmsg_seq != nlp->seq)
+	    continue;
+
+	  if (nlh->nlmsg_type == NLMSG_DONE)
+	    break;		/* ok */
+
+	  if (nlh->nlmsg_type == RTM_NEWLINK)
+	    {
+	      /* A RTM_NEWLINK message can have IFLA_STATS data. We need to
+		 know the size before creating the list to allocate enough
+		 memory.  */
+	      struct ifinfomsg *ifim = (struct ifinfomsg *) NLMSG_DATA (nlh);
+	      struct rtattr *rta = IFLA_RTA (ifim);
+	      size_t rtasize = IFLA_PAYLOAD (nlh);
+
+	      while (RTA_OK (rta, rtasize))
+		{
+		  size_t rta_payload = RTA_PAYLOAD (rta);
+
+		  if (rta->rta_type == IFLA_STATS)
+		    {
+		      ifa_data_size += rta_payload;
+		      break;
+		    }
+		  else
+		    rta = RTA_NEXT (rta, rtasize);
+		}
+	      ++newlink;
+	    }
+	  else if (nlh->nlmsg_type == RTM_NEWADDR)
+	    ++newaddr;
+	}
+    }
+
+  /* Return if no interface is up.  */
+  if ((newlink + newaddr) == 0)
+    goto exit_free;
+
+  /* Allocate memory for all entries we have and initialize next
+     pointer.  */
+  ifas = (struct ifaddrs_storage *) calloc (1,
+					    (newlink + newaddr)
+					    * sizeof (struct ifaddrs_storage)
+					    + ifa_data_size);
+  if (ifas == NULL)
+    {
+      result = -1;
+      goto exit_free;
+    }
+
+  /* Table for mapping kernel index to entry in our list.  */
+  map_newlink_data = alloca (newlink * sizeof (int));
+  memset (map_newlink_data, '\xff', newlink * sizeof (int));
+
+  ifa_data_ptr = (char *) &ifas[newlink + newaddr];
+  newaddr_idx = 0;		/* Counter for newaddr index.  */
+
+  /* Walk through the list of data we got from the kernel.  */
+  for (nlp = nh.nlm_list; nlp; nlp = nlp->next)
+    {
+      struct nlmsghdr *nlh;
+      size_t size = nlp->size;
+
+      if (nlp->nlh == NULL)
+	continue;
+
+      /* Walk through one message and look at the type: If it is our
+	 message, we need RTM_NEWLINK/RTM_NEWADDR and stop if we reach
+	 the end or we find the end marker (in this case we ignore the
+	 following data.  */
+      for (nlh = nlp->nlh; NLMSG_OK (nlh, size); nlh = NLMSG_NEXT (nlh, size))
+	{
+	  int ifa_index = 0;
+
+	  /* Check if the message is the one we want */
+	  if ((pid_t) nlh->nlmsg_pid != nh.pid || nlh->nlmsg_seq != nlp->seq)
+	    continue;
+
+	  if (nlh->nlmsg_type == NLMSG_DONE)
+	    break;		/* ok */
+
+	  if (nlh->nlmsg_type == RTM_NEWLINK)
+	    {
+	      /* We found a new interface. Now extract everything from the
+		 interface data we got and need.  */
+	      struct ifinfomsg *ifim = (struct ifinfomsg *) NLMSG_DATA (nlh);
+	      struct rtattr *rta = IFLA_RTA (ifim);
+	      size_t rtasize = IFLA_PAYLOAD (nlh);
+
+	      /* Interfaces are stored in the first "newlink" entries
+		 of our list, starting in the order as we got from the
+		 kernel.  */
+              ifa_index = map_newlink (ifim->ifi_index - 1, ifas,
+				       map_newlink_data, newlink);
+	      ifas[ifa_index].ifa.ifa_flags = ifim->ifi_flags;
+
+	      while (RTA_OK (rta, rtasize))
+		{
+		  char *rta_data = RTA_DATA (rta);
+		  size_t rta_payload = RTA_PAYLOAD (rta);
+
+		  switch (rta->rta_type)
+		    {
+		    case IFLA_ADDRESS:
+		      if (rta_payload <= sizeof (ifas[ifa_index].addr))
+			{
+			  ifas[ifa_index].addr.sl.sll_family = AF_PACKET;
+			  memcpy (ifas[ifa_index].addr.sl.sll_addr,
+				  (char *) rta_data, rta_payload);
+			  ifas[ifa_index].addr.sl.sll_halen = rta_payload;
+			  ifas[ifa_index].addr.sl.sll_ifindex
+			    = ifim->ifi_index;
+			  ifas[ifa_index].addr.sl.sll_hatype = ifim->ifi_type;
+
+			  ifas[ifa_index].ifa.ifa_addr
+			    = &ifas[ifa_index].addr.sa;
+			}
+		      break;
+
+		    case IFLA_BROADCAST:
+		      if (rta_payload <= sizeof (ifas[ifa_index].broadaddr))
+			{
+			  ifas[ifa_index].broadaddr.sl.sll_family = AF_PACKET;
+			  memcpy (ifas[ifa_index].broadaddr.sl.sll_addr,
+				  (char *) rta_data, rta_payload);
+			  ifas[ifa_index].broadaddr.sl.sll_halen = rta_payload;
+			  ifas[ifa_index].broadaddr.sl.sll_ifindex
+			    = ifim->ifi_index;
+			  ifas[ifa_index].broadaddr.sl.sll_hatype
+			    = ifim->ifi_type;
+
+			  ifas[ifa_index].ifa.ifa_broadaddr
+			    = &ifas[ifa_index].broadaddr.sa;
+			}
+		      break;
+
+		    case IFLA_IFNAME:	/* Name of Interface */
+		      if ((rta_payload + 1) <= sizeof (ifas[ifa_index].name))
+			{
+			  ifas[ifa_index].ifa.ifa_name = ifas[ifa_index].name;
+			  *(char *) __mempcpy (ifas[ifa_index].name, rta_data,
+					       rta_payload) = '\0';
+			}
+		      break;
+
+		    case IFLA_STATS:	/* Statistics of Interface */
+		      ifas[ifa_index].ifa.ifa_data = ifa_data_ptr;
+		      ifa_data_ptr += rta_payload;
+		      memcpy (ifas[ifa_index].ifa.ifa_data, rta_data,
+			      rta_payload);
+		      break;
+
+		    case IFLA_UNSPEC:
+		      break;
+		    case IFLA_MTU:
+		      break;
+		    case IFLA_LINK:
+		      break;
+		    case IFLA_QDISC:
+		      break;
+		    default:
+		      break;
+		    }
+
+		  rta = RTA_NEXT (rta, rtasize);
+		}
+	    }
+	  else if (nlh->nlmsg_type == RTM_NEWADDR)
+	    {
+	      struct ifaddrmsg *ifam = (struct ifaddrmsg *) NLMSG_DATA (nlh);
+	      struct rtattr *rta = IFA_RTA (ifam);
+	      size_t rtasize = IFA_PAYLOAD (nlh);
+
+	      /* New Addresses are stored in the order we got them from
+		 the kernel after the interfaces. Theoretically it is possible
+		 that we have holes in the interface part of the list,
+		 but we always have already the interface for this address.  */
+	      ifa_index = newlink + newaddr_idx;
+	      ifas[ifa_index].ifa.ifa_flags
+		= ifas[map_newlink (ifam->ifa_index - 1, ifas,
+				    map_newlink_data, newlink)].ifa.ifa_flags;
+	      if (ifa_index > 0)
+		ifas[ifa_index - 1].ifa.ifa_next = &ifas[ifa_index].ifa;
+	      ++newaddr_idx;
+
+	      while (RTA_OK (rta, rtasize))
+		{
+		  char *rta_data = RTA_DATA (rta);
+		  size_t rta_payload = RTA_PAYLOAD (rta);
+
+		  switch (rta->rta_type)
+		    {
+		    case IFA_ADDRESS:
+		      {
+			struct sockaddr *sa;
+
+			if (ifas[ifa_index].ifa.ifa_addr != NULL)
+			  {
+			    /* In a point-to-poing network IFA_ADDRESS
+			       contains the destination address, local
+			       address is supplied in IFA_LOCAL attribute.
+			       destination address and broadcast address
+			       are stored in an union, so it doesn't matter
+			       which name we use.  */
+			    ifas[ifa_index].ifa.ifa_broadaddr
+			      = &ifas[ifa_index].broadaddr.sa;
+			    sa = &ifas[ifa_index].broadaddr.sa;
+			  }
+			else
+			  {
+			    ifas[ifa_index].ifa.ifa_addr
+			      = &ifas[ifa_index].addr.sa;
+			    sa = &ifas[ifa_index].addr.sa;
+			  }
+
+			sa->sa_family = ifam->ifa_family;
+
+			switch (ifam->ifa_family)
+			  {
+			  case AF_INET:
+			    /* Size must match that of an address for IPv4.  */
+			    if (rta_payload == 4)
+			      memcpy (&((struct sockaddr_in *) sa)->sin_addr,
+				      rta_data, rta_payload);
+			    break;
+
+			  case AF_INET6:
+			    /* Size must match that of an address for IPv6.  */
+			    if (rta_payload == 16)
+			      {
+				memcpy (&((struct sockaddr_in6 *) sa)->sin6_addr,
+					rta_data, rta_payload);
+				if (IN6_IS_ADDR_LINKLOCAL (rta_data)
+				    || IN6_IS_ADDR_MC_LINKLOCAL (rta_data))
+				  ((struct sockaddr_in6 *) sa)->sin6_scope_id
+				    = ifam->ifa_scope;
+			      }
+			    break;
+
+			  default:
+			    if (rta_payload <= sizeof (ifas[ifa_index].addr))
+			      memcpy (sa->sa_data, rta_data, rta_payload);
+			    break;
+			  }
+		      }
+		      break;
+
+		    case IFA_LOCAL:
+		      if (ifas[ifa_index].ifa.ifa_addr != NULL)
+			{
+			  /* If ifa_addr is set and we get IFA_LOCAL,
+			     assume we have a point-to-point network.
+			     Move address to correct field.  */
+			  ifas[ifa_index].broadaddr = ifas[ifa_index].addr;
+			  ifas[ifa_index].ifa.ifa_broadaddr
+			    = &ifas[ifa_index].broadaddr.sa;
+			  memset (&ifas[ifa_index].addr, '\0',
+				  sizeof (ifas[ifa_index].addr));
+			}
+
+		      ifas[ifa_index].ifa.ifa_addr = &ifas[ifa_index].addr.sa;
+		      ifas[ifa_index].ifa.ifa_addr->sa_family
+			= ifam->ifa_family;
+
+		      switch (ifam->ifa_family)
+			{
+			case AF_INET:
+			  /* Size must match that of an address for IPv4.  */
+			  if (rta_payload == 4)
+			    memcpy (&ifas[ifa_index].addr.s4.sin_addr,
+				  rta_data, rta_payload);
+			  break;
+
+			case AF_INET6:
+			  /* Size must match that of an address for IPv6.  */
+			  if (rta_payload == 16)
+			    {
+			      memcpy (&ifas[ifa_index].addr.s6.sin6_addr,
+				      rta_data, rta_payload);
+			      if (IN6_IS_ADDR_LINKLOCAL (rta_data) ||
+				  IN6_IS_ADDR_MC_LINKLOCAL (rta_data))
+				ifas[ifa_index].addr.s6.sin6_scope_id =
+				  ifam->ifa_scope;
+			    }
+			  break;
+
+			default:
+			  if (rta_payload <= sizeof (ifas[ifa_index].addr))
+			    memcpy (ifas[ifa_index].addr.sa.sa_data,
+				    rta_data, rta_payload);
+			  break;
+			}
+		      break;
+
+		    case IFA_BROADCAST:
+		      /* We get IFA_BROADCAST, so IFA_LOCAL was too much.  */
+		      if (ifas[ifa_index].ifa.ifa_broadaddr != NULL)
+			memset (&ifas[ifa_index].broadaddr, '\0',
+				sizeof (ifas[ifa_index].broadaddr));
+
+		      ifas[ifa_index].ifa.ifa_broadaddr
+			= &ifas[ifa_index].broadaddr.sa;
+		      ifas[ifa_index].ifa.ifa_broadaddr->sa_family
+			= ifam->ifa_family;
+
+		      switch (ifam->ifa_family)
+			{
+			case AF_INET:
+			  /* Size must match that of an address for IPv4.  */
+			  if (rta_payload == 4)
+			    memcpy (&ifas[ifa_index].broadaddr.s4.sin_addr,
+				    rta_data, rta_payload);
+			  break;
+
+			case AF_INET6:
+			  /* Size must match that of an address for IPv6.  */
+			  if (rta_payload == 16)
+			    {
+			      memcpy (&ifas[ifa_index].broadaddr.s6.sin6_addr,
+				      rta_data, rta_payload);
+			      if (IN6_IS_ADDR_LINKLOCAL (rta_data)
+				  || IN6_IS_ADDR_MC_LINKLOCAL (rta_data))
+				ifas[ifa_index].broadaddr.s6.sin6_scope_id
+				  = ifam->ifa_scope;
+			    }
+			  break;
+
+			default:
+			  if (rta_payload <= sizeof (ifas[ifa_index].addr))
+			    memcpy (&ifas[ifa_index].broadaddr.sa.sa_data,
+				    rta_data, rta_payload);
+			  break;
+			}
+		      break;
+
+		    case IFA_LABEL:
+		      if (rta_payload + 1 <= sizeof (ifas[ifa_index].name))
+			{
+			  ifas[ifa_index].ifa.ifa_name = ifas[ifa_index].name;
+			  *(char *) __mempcpy (ifas[ifa_index].name, rta_data,
+					       rta_payload) = '\0';
+			}
+		      else
+			abort ();
+		      break;
+
+		    case IFA_UNSPEC:
+		      break;
+		    case IFA_CACHEINFO:
+		      break;
+		    default:
+		      break;
+		    }
+
+		  rta = RTA_NEXT (rta, rtasize);
+		}
+
+	      /* If we didn't get the interface name with the
+		 address, use the name from the interface entry.  */
+	      if (ifas[ifa_index].ifa.ifa_name == NULL)
+		ifas[ifa_index].ifa.ifa_name
+		  = ifas[map_newlink (ifam->ifa_index - 1, ifas,
+				      map_newlink_data, newlink)].ifa.ifa_name;
+
+	      /* Calculate the netmask.  */
+	      if (ifas[ifa_index].ifa.ifa_addr
+		  && ifas[ifa_index].ifa.ifa_addr->sa_family != AF_UNSPEC
+		  && ifas[ifa_index].ifa.ifa_addr->sa_family != AF_PACKET)
+		{
+		  uint32_t max_prefixlen = 0;
+		  char *cp = NULL;
+
+		  ifas[ifa_index].ifa.ifa_netmask
+		    = &ifas[ifa_index].netmask.sa;
+
+		  switch (ifas[ifa_index].ifa.ifa_addr->sa_family)
+		    {
+		    case AF_INET:
+		      cp = (char *) &ifas[ifa_index].netmask.s4.sin_addr;
+		      max_prefixlen = 32;
+		      break;
+
+		    case AF_INET6:
+		      cp = (char *) &ifas[ifa_index].netmask.s6.sin6_addr;
+		      max_prefixlen = 128;
+		      break;
+		    }
+
+		  ifas[ifa_index].ifa.ifa_netmask->sa_family
+		    = ifas[ifa_index].ifa.ifa_addr->sa_family;
+
+		  if (cp != NULL)
+		    {
+		      char c;
+		      unsigned int preflen;
+
+		      if ((max_prefixlen > 0) &&
+			  (ifam->ifa_prefixlen > max_prefixlen))
+			preflen = max_prefixlen;
+		      else
+			preflen = ifam->ifa_prefixlen;
+
+		      for (i = 0; i < (preflen / 8); i++)
+			*cp++ = 0xff;
+		      c = 0xff;
+		      c <<= (8 - (preflen % 8));
+		      *cp = c;
+		    }
+		}
+	    }
+	}
+    }
+
+  assert (ifa_data_ptr <= (char *) &ifas[newlink + newaddr] + ifa_data_size);
+
+  if (newaddr_idx > 0)
+    {
+      for (i = 0; i < newlink; ++i)
+	if (map_newlink_data[i] == -1)
+	  {
+	    /* We have fewer links then we anticipated.  Adjust the
+	       forward pointer to the first address entry.  */
+	    ifas[i - 1].ifa.ifa_next = &ifas[newlink].ifa;
+	  }
+
+      if (i == 0 && newlink > 0)
+	/* No valid link, but we allocated memory.  We have to
+	   populate the first entry.  */
+	memmove (ifas, &ifas[newlink], sizeof (struct ifaddrs_storage));
+    }
+
+  if (ifap != NULL)
+    *ifap = &ifas[0].ifa;
+
+ exit_free:
+  free_netlink_handle (&nh);
+
+ exit_close:
+  netlink_close (&nh);
+
+  return result;
+}
+libc_hidden_def (getifaddrs)
+
+
+#if __ASSUME_NETLINK_SUPPORT != 0
+void
+freeifaddrs (struct ifaddrs *ifa)
+{
+  free (ifa);
+}
+libc_hidden_def (freeifaddrs)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ifreq.c libc-20030708/sysdeps/unix/sysv/linux/ifreq.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ifreq.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ifreq.c	2003-07-08 22:58:14.000000000 +0900
@@ -0,0 +1,100 @@
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Andreas Jaeger <aj@suse.de>.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include "ifreq.h"
+
+/* Variable to signal whether SIOCGIFCONF is not available.  */
+#if __ASSUME_SIOCGIFNAME == 0 || 1
+static int old_siocgifconf;
+#else
+# define old_siocgifconf 0
+#endif
+
+
+void
+__ifreq (struct ifreq **ifreqs, int *num_ifs, int sockfd)
+{
+  int fd = sockfd;
+  struct ifconf ifc;
+  int rq_len;
+  int nifs;
+# define RQ_IFS	4
+
+  if (fd < 0)
+    fd = __opensock ();
+  if (fd < 0)
+    {
+      *num_ifs = 0;
+      *ifreqs = NULL;
+      return;
+    }
+
+  ifc.ifc_buf = NULL;
+
+  /* We may be able to get the needed buffer size directly, rather than
+     guessing.  */
+  if (! old_siocgifconf)
+    {
+      ifc.ifc_buf = NULL;
+      ifc.ifc_len = 0;
+      if (__ioctl (fd, SIOCGIFCONF, &ifc) < 0 || ifc.ifc_len == 0)
+	{
+# if __ASSUME_SIOCGIFNAME == 0
+	  old_siocgifconf = 1;
+# endif
+	  rq_len = RQ_IFS * sizeof (struct ifreq);
+	}
+      else
+	rq_len = ifc.ifc_len;
+    }
+  else
+    rq_len = RQ_IFS * sizeof (struct ifreq);
+
+  /* Read all the interfaces out of the kernel.  */
+  while (1)
+    {
+      ifc.ifc_len = rq_len;
+      ifc.ifc_buf = realloc (ifc.ifc_buf, ifc.ifc_len);
+      if (ifc.ifc_buf == NULL || __ioctl (fd, SIOCGIFCONF, &ifc) < 0)
+	{
+	  if (ifc.ifc_buf)
+	    free (ifc.ifc_buf);
+
+	  if (fd != sockfd)
+	    __close (fd);
+
+	  *num_ifs = 0;
+	  *ifreqs = NULL;
+	  return;
+	}
+
+      if (!old_siocgifconf || ifc.ifc_len < rq_len)
+	break;
+
+      rq_len *= 2;
+    }
+
+  nifs = ifc.ifc_len / sizeof (struct ifreq);
+
+  if (fd != sockfd)
+    __close (fd);
+
+  *num_ifs = nifs;
+  *ifreqs = realloc (ifc.ifc_buf, nifs * sizeof (struct ifreq));
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ifreq.h libc-20030708/sysdeps/unix/sysv/linux/ifreq.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ifreq.h	2002-09-21 09:28:21.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ifreq.h	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>.
 
@@ -25,85 +25,8 @@
 #include <sys/ioctl.h>
 #include "kernel-features.h"
 
-/* Variable to signal whether SIOCGIFCONF is not available.  */
-#if __ASSUME_SIOCGIFNAME == 0 || 1
-static int old_siocgifconf;
-#else
-# define old_siocgifconf 0
-#endif
 
-
-static inline void
-__ifreq (struct ifreq **ifreqs, int *num_ifs, int sockfd)
-{
-  int fd = sockfd;
-  struct ifconf ifc;
-  int rq_len;
-  int nifs;
-# define RQ_IFS	4
-
-  if (fd < 0)
-    fd = __opensock ();
-  if (fd < 0)
-    {
-      *num_ifs = 0;
-      *ifreqs = NULL;
-      return;
-    }
-
-  ifc.ifc_buf = NULL;
-
-  /* We may be able to get the needed buffer size directly, rather than
-     guessing.  */
-  if (! old_siocgifconf)
-    {
-      ifc.ifc_buf = NULL;
-      ifc.ifc_len = 0;
-      if (__ioctl (fd, SIOCGIFCONF, &ifc) < 0 || ifc.ifc_len == 0)
-	{
-# if __ASSUME_SIOCGIFNAME == 0
-	  old_siocgifconf = 1;
-# endif
-	  rq_len = RQ_IFS * sizeof (struct ifreq);
-	}
-      else
-	rq_len = ifc.ifc_len;
-    }
-  else
-    rq_len = RQ_IFS * sizeof (struct ifreq);
-
-  /* Read all the interfaces out of the kernel.  */
-  while (1)
-    {
-      ifc.ifc_len = rq_len;
-      ifc.ifc_buf = realloc (ifc.ifc_buf, ifc.ifc_len);
-      if (ifc.ifc_buf == NULL || __ioctl (fd, SIOCGIFCONF, &ifc) < 0)
-	{
-	  if (ifc.ifc_buf)
-	    free (ifc.ifc_buf);
-
-	  if (fd != sockfd)
-	    __close (fd);
-
-	  *num_ifs = 0;
-	  *ifreqs = NULL;
-	  return;
-	}
-
-      if (!old_siocgifconf || ifc.ifc_len < rq_len)
-	break;
-
-      rq_len *= 2;
-    }
-
-  nifs = ifc.ifc_len / sizeof (struct ifreq);
-
-  if (fd != sockfd)
-    __close (fd);
-
-  *num_ifs = nifs;
-  *ifreqs = realloc (ifc.ifc_buf, nifs * sizeof (struct ifreq));
-}
+extern void __ifreq (struct ifreq **ifreqs, int *num_ifs, int sockfd);
 
 static inline struct ifreq *
 __if_nextreq (struct ifreq *ifr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/internal_statvfs.c libc-20030708/sysdeps/unix/sysv/linux/internal_statvfs.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/internal_statvfs.c	2002-09-21 14:36:38.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/internal_statvfs.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998,1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -19,8 +19,9 @@
 
   /* Now fill in the fields we have information for.  */
   buf->f_bsize = fsbuf.f_bsize;
-  /* Linux does not support f_frsize, so set it to the full block size.  */
-  buf->f_frsize = fsbuf.f_bsize;
+  /* Linux has the f_frsize size only in later version of the kernel.
+     If the value is not filled in use f_bsize.  */
+  buf->f_frsize = fsbuf.f_frsize ?: fsbuf.f_bsize;
   buf->f_blocks = fsbuf.f_blocks;
   buf->f_bfree = fsbuf.f_bfree;
   buf->f_bavail = fsbuf.f_bavail;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ipc_priv.h libc-20030708/sysdeps/unix/sysv/linux/ipc_priv.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ipc_priv.h	2001-07-08 04:21:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ipc_priv.h	2003-04-15 23:55:50.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995-1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1995-1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,6 +44,7 @@
 #define IPCOP_semop	 1
 #define IPCOP_semget	 2
 #define IPCOP_semctl	 3
+#define IPCOP_semtimedop 4
 #define IPCOP_msgsnd	11
 #define IPCOP_msgrcv	12
 #define IPCOP_msgget	13
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/kernel-features.h libc-20030708/sysdeps/unix/sysv/linux/kernel-features.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/kernel-features.h	2003-02-21 07:11:52.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/kernel-features.h	2003-07-08 22:58:14.000000000 +0900
@@ -1,6 +1,6 @@
 /* Set flags signalling availability of kernel features based on given
    kernel version number.
-   Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -127,16 +127,25 @@
 # define __ASSUME_SETRESUID_SYSCALL	1
 #endif
 
+#if __LINUX_KERNEL_VERSION >= 131879
+# define __ASSUME_SETRESGID_SYSCALL	1
+#endif
+
 /* Linux 2.3.39 introduced IPC64.  Except for powerpc.  */
 #if __LINUX_KERNEL_VERSION >= 131879 && !defined __powerpc__
 # define __ASSUME_IPC64		1
 #endif
 
-/* mips platforms had IPC64 all along.  */
+/* MIPS platforms had IPC64 all along.  */
 #if defined __mips__
 # define __ASSUME_IPC64		1
 #endif
 
+/* We can use the LDTs for threading with Linux 2.3.99 and newer.  */
+#if __LINUX_KERNEL_VERSION >= 131939
+# define __ASSUME_LDT_WORKS		1
+#endif
+
 /* Linux 2.4.0 on PPC introduced a correct IPC64. But PowerPC64 does not
    support a separate 64-bit sys call, already 64-bit */
 #if __LINUX_KERNEL_VERSION >= 132096 && defined __powerpc__ \
@@ -144,15 +153,18 @@
 # define __ASSUME_IPC64			1
 #endif
 
-/* We can use the LDTs for threading with Linux 2.3.99 and newer.  */
-#if __LINUX_KERNEL_VERSION >= 131939
-# define __ASSUME_LDT_WORKS		1
+/* SH kernels got stat64, mmap2, and truncate64 during 2.4.0-test.  */
+#if __LINUX_KERNEL_VERSION >= 132096 && defined __sh__
+# define __ASSUME_TRUNCATE64_SYSCALL	1
+# define __ASSUME_MMAP2_SYSCALL		1
+# define __ASSUME_STAT64_SYSCALL	1
 #endif
 
 /* The changed st_ino field appeared in 2.4.0-test6.  But we cannot
    distinguish this version from other 2.4.0 releases.  Therefore play
-   save and assume it available is for 2.4.1 and up.  */
-#if __LINUX_KERNEL_VERSION >= 132097
+   save and assume it available is for 2.4.1 and up.  However, SH is lame,
+   and still does not have a 64-bit inode field.  */
+#if __LINUX_KERNEL_VERSION >= 132097 && !defined __alpha__ && !defined __sh__
 # define __ASSUME_ST_INO_64_BIT		1
 #endif
 
@@ -163,6 +175,12 @@
 # define __ASSUME_FCNTL64		1
 #endif
 
+/* The AT_CLKTCK auxiliary vector entry was introduction in the 2.4.0
+   series.  */
+#if __LINUX_KERNEL_VERSION >= 132097
+# define __ASSUME_AT_CLKTCK		1
+#endif
+
 /* Arm got fcntl64 in 2.4.4, PowerPC and SH have it also in 2.4.4 (I
    don't know when it got introduced).  But PowerPC64 does not support
    separate FCNTL64 call, FCNTL is already 64-bit */
@@ -229,8 +247,8 @@
 # define __ASSUME_SET_THREAD_AREA_SYSCALL	1
 #endif
 
-/* The vfork syscall on x86 was definitely available in 2.4.  */
-#if __LINUX_KERNEL_VERSION >= 132097 && defined __i386__
+/* The vfork syscall on x86 and arm was definitely available in 2.4.  */
+#if __LINUX_KERNEL_VERSION >= 132097 && (defined __i386__ || defined __arm__)
 # define __ASSUME_VFORK_SYSCALL		1
 #endif
 
@@ -248,6 +266,15 @@
 # define __ASSUME_GETDENTS64_SYSCALL	1
 #endif
 
+/* Alpha switched to a 64-bit timeval sometime before 2.2.0.  */
+#if __LINUX_KERNEL_VERSION >= 131584 && defined __alpha__
+# define __ASSUME_TIMEVAL64		1
+#endif
+
+#if defined __mips__ && defined _ABIN32 && _MIPS_SIM == _ABIN32
+# define __ASSUME_FCNTL64		1
+#endif
+
 /* The late 2.5 kernels saw a lot of new CLONE_* flags.  Summarize
    their availability with one define.  The changes were made first
    for i386 and the have to be done separately for the other archs.
@@ -264,3 +291,57 @@
 # define __ASSUME_FCNTL64		1
 # define __ASSUME_VFORK_SYSCALL		1
 #endif
+
+/* Beginning with 2.5.63 support for realtime and monotonic clocks and
+   timers based on them is available.  */
+#if __LINUX_KERNEL_VERSION >= 132415
+# define __ASSUME_POSIX_TIMERS		1
+#endif
+
+/* The late 2.5 kernels saw a lot of new CLONE_* flags.  Summarize
+   their availability with one define.  The changes were made first
+   for i386 and the have to be done separately for the other archs.
+   For ia64, s390*, PPC we pick 2.5.64 as the first version with support.  */
+#if __LINUX_KERNEL_VERSION >= 132416 \
+    && (defined __ia64__ || defined __s390__ || defined __powerpc__)
+# define __ASSUME_CLONE_THREAD_FLAGS	1
+#endif
+
+/* With kernel 2.4.17 we always have netlink support.  */
+#if __LINUX_KERNEL_VERSION >= (132096+17)
+# define __ASSUME_NETLINK_SUPPORT	1
+#endif
+
+/* For x86, support for the sysenter instruction was available in
+   2.5.53.  But the unwind information was added only in 2.5.69.  */
+#if __LINUX_KERNEL_VERSION >= 132421 && defined __i386__
+# define __ASSUME_VSYSCALL	1
+#endif
+
+/* The requeue futex functionality was introduced in 2.5.70.  */
+#if __LINUX_KERNEL_VERSION >= 132422
+# define __ASSUME_FUTEX_REQUEUE	1
+#endif
+
+/* The statfs64 syscalls are available in 2.5.74.  */
+#if __LINUX_KERNEL_VERSION >= 132426
+# define __ASSUME_STATFS64	1
+#endif
+
+/* Starting with at least 2.5.74 the kernel passes the setuid-like exec
+   flag unconditionally up to the child.  */
+#if __LINUX_KERNEL_VERSION >= 132426
+# define __ASSUME_AT_SECURE	1
+#endif
+
+/* Starting with the 2.5.75 kernel the kernel fills in the correct value
+   in the si_pid field passed as part of the siginfo_t struct to signal
+   handlers.  */
+#if __LINUX_KERNEL_VERSION >= 132427
+# define __ASSUME_CORRECT_SI_PID	1
+#endif
+
+/* The tgkill syscall was instroduced for i386 in 2.5.75.  */
+#if __LINUX_KERNEL_VERSION >= 132427 && defined __i386__
+# define __ASSUME_TGKILL	1
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/ldsodefs.h libc-20030708/sysdeps/unix/sysv/linux/ldsodefs.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/ldsodefs.h	2002-07-21 02:30:48.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/ldsodefs.h	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Run-time dynamic linker data structures for loaded ELF shared objects.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,6 +41,12 @@
 # define HAVE_AUX_XID
 #endif
 
+/* We can assume that the kernel always provides the AT_SECURE value
+   in the auxiliary vector from 2.5.74 or so on.  */
+#if __ASSUME_AT_SECURE
+# define HAVE_AUX_SECURE
+#endif
+
 /* Starting with one of the 2.4.0 pre-releases the Linux kernel passes
    up the page size information.  */
 #if __ASSUME_AT_PAGESIZE
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/libc_fatal.c libc-20030708/sysdeps/unix/sysv/linux/libc_fatal.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/libc_fatal.c	2002-12-15 19:49:50.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/libc_fatal.c	2003-04-28 23:53:24.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1993,1994,1995,1997,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1993-1995,1997,2000,2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -37,13 +37,15 @@
 
   while (len > 0)
     {
-      ssize_t count = INLINE_SYSCALL (write, 3, STDERR_FILENO, message, len);
-      if (count > 0)
+      INTERNAL_SYSCALL_DECL (err);
+      ssize_t count = INTERNAL_SYSCALL (write, err, 3, STDERR_FILENO,
+					message, len);
+      if (! INTERNAL_SYSCALL_ERROR_P (count, err))
 	{
 	  message += count;
 	  len -= count;
 	}
-      else if (count < 0 && errno != EINTR)
+      else if (INTERNAL_SYSCALL_ERRNO (count, err) != EINTR)
 	break;
     }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/linux_fsinfo.h libc-20030708/sysdeps/unix/sysv/linux/linux_fsinfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/linux_fsinfo.h	2002-10-23 15:21:19.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/linux_fsinfo.h	2003-03-14 15:25:31.000000000 +0900
@@ -1,5 +1,5 @@
 /* Constants from kernel header for various FSes.
-   Copyright (C) 1998, 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998,1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -40,6 +40,9 @@
 /* Constants that identify the `coherent' filesystem.  */
 #define COH_SUPER_MAGIC		0x012ff7b7
 
+/* Constant that identifies the `ramfs' filesystem.  */
+#define CRAMFS_MAGIC		0x28cd3d45
+
 /* Constant that identifies the `devfs' filesystem.  */
 #define DEVFS_SUPER_MAGIC	0x1373
 
@@ -48,6 +51,7 @@
 
 /* Constant that identifies the `efs' filesystem.  */
 #define EFS_SUPER_MAGIC		0x414A53
+#define EFS_MAGIC		0x072959
 
 /* Constant that identifies the `ext2' and `ext3' filesystems.  */
 #define EXT2_SUPER_MAGIC	0xef53
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/lxstat.c libc-20030708/sysdeps/unix/sysv/linux/lxstat.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/lxstat.c	2002-10-02 17:53:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/lxstat.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* lxstat using old-style Unix lstat system call.
-   Copyright (C) 1991,1995-1998,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995-1998,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -30,10 +30,7 @@
 #include <sys/syscall.h>
 #include <bp-checks.h>
 
-#include <xstatconv.c>
-
-extern int __syscall_lstat (const char *__unbounded,
-			    struct kernel_stat *__unbounded);
+#include <xstatconv.h>
 
 /* Get information about the file NAME in BUF.  */
 int
@@ -52,7 +49,7 @@
 
   result = INLINE_SYSCALL (lstat, 2, CHECK_STRING (name), __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat_conv (vers, &kbuf, buf);
+    result = __xstat_conv (vers, &kbuf, buf);
 
   return result;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/lxstat64.c libc-20030708/sysdeps/unix/sysv/linux/lxstat64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/lxstat64.c	2002-10-12 03:58:50.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/lxstat64.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* lxstat64 using old-style Unix lstat system call.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -29,7 +29,7 @@
 #include "kernel-features.h"
 
 #if __ASSUME_STAT64_SYSCALL == 0
-# include <xstatconv.c>
+# include <xstatconv.h>
 #endif
 
 extern int __syscall_lstat (const char *__unbounded,
@@ -79,7 +79,7 @@
 # endif
   result = INLINE_SYSCALL (lstat, 2, CHECK_STRING (name), __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat64_conv (vers, &kbuf, buf);
+    result = __xstat64_conv (vers, &kbuf, buf);
 
   return result;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/m68k/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/bits/mman.h	2003-02-21 05:33:25.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/m68k/bits/mman.h	2003-03-03 18:58:55.000000000 +0900
@@ -52,11 +52,13 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	0x0100		/* Stack-like segment.  */
-# define MAP_DENYWRITE	0x0800		/* ETXTBSY */
-# define MAP_EXECUTABLE	0x1000		/* Mark it as an executable.  */
-# define MAP_LOCKED	0x2000		/* Lock the mapping.  */
-# define MAP_NORESERVE	0x4000		/* Don't check for reservations.  */
+# define MAP_GROWSDOWN	0x00100		/* Stack-like segment.  */
+# define MAP_DENYWRITE	0x00800		/* ETXTBSY */
+# define MAP_EXECUTABLE	0x01000		/* Mark it as an executable.  */
+# define MAP_LOCKED	0x02000		/* Lock the mapping.  */
+# define MAP_NORESERVE	0x04000		/* Don't check for reservations.  */
+# define MAP_POPULATE	0x08000		/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	0x10000		/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/m68k/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/bits/stat.h	2003-01-05 19:46:50.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/m68k/bits/stat.h	2003-07-08 22:58:14.000000000 +0900
@@ -132,6 +132,8 @@
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
 #define _STATBUF_ST_RDEV
+/* Nanosecond resolution time values are supported.  */
+#define _STATBUF_ST_NSEC
 
 /* Encoding of the file mode.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/semtimedop.S libc-20030708/sysdeps/unix/sysv/linux/m68k/semtimedop.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/semtimedop.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/m68k/semtimedop.S	2003-04-28 02:08:00.000000000 +0900
@@ -0,0 +1,60 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Andreas Schwab <schwab@suse.de>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#define SYSOP_semtimedop 4
+
+#define SVRSP	8		/* saved register space */
+#define PARMS	4+SVRSP		/* space for 3 saved regs */
+#define SEMID	PARMS
+#define SOPS	SEMID+4
+#define NSOPS	SOPS+4
+#define TIMEOUT	NSOPS+4
+
+	.text
+ENTRY (semtimedop)
+
+	/* Save registers.  */
+	move.l	%d2, %a1
+	move.l	%d3, -(%sp)
+	move.l	%d5, -(%sp)
+
+	move.l	#SYSOP_semtimedop, %d1
+	move.l	SEMID(%sp), %d2
+	move.l	NSOPS(%sp), %d3
+	move.l	SOPS(%sp), %d5
+	move.l	TIMEOUT(%sp), %a0
+	move.l	#SYS_ify (ipc), %d0
+
+	trap	#0
+
+	/* Restore registers.  */
+	move.l	(%sp)+, %d5
+	move.l	(%sp)+, %d3
+	move.l	%a1, %d2
+
+	/* Check for error.  */
+	tst.l	%d0
+	jmi	SYSCALL_ERROR_LABEL
+
+	/* Successful; return the syscall's value.  */
+	ret
+
+PSEUDO_END (semtimedop)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/m68k/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/m68k/sysdep.h	2003-01-09 11:54:57.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/m68k/sysdep.h	2003-03-28 21:28:21.000000000 +0900
@@ -68,6 +68,18 @@
   SYSCALL_ERROR_HANDLER;						      \
   END (name)
 
+#undef PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args)			      \
+  .text;								      \
+  ENTRY (name)								      \
+    DO_CALL (syscall_name, args)
+
+#undef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(name)					      \
+  END (name)
+
+#define ret_NOERRNO ret
+
 #ifdef PIC
 # if RTLD_PRIVATE_ERRNO
 #  define SYSCALL_ERROR_HANDLER						      \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/Makefile libc-20030708/sysdeps/unix/sysv/linux/mips/Makefile
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/Makefile	2002-03-29 08:41:51.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/Makefile	2003-07-08 22:58:14.000000000 +0900
@@ -8,4 +8,46 @@
 sysdep_routines += cachectl cacheflush sysmips _test_and_set
 
 sysdep_headers += sys/cachectl.h sys/sysmips.h sys/tas.h
+
+no_syscall_list_h = 1
+
+# Generate the list of SYS_* macros for the system calls (__NR_* macros).
+# We generate not only SYS_<syscall>, pointing at SYS_<abi>_<syscall> if
+# it exists, but also define SYS_<abi>_<syscall> for all ABIs.
+$(objpfx)syscall-%.h $(objpfx)syscall-%.d: ../sysdeps/unix/sysv/linux/mips/sys/syscall.h
+	$(make-target-directory)
+	{ \
+	 echo '/* Generated at libc build time from kernel syscall list.  */';\
+	 echo ''; \
+	 echo '#ifndef _SYSCALL_H'; \
+	 echo '# error "Never use <bits/syscall.h> directly; include <sys/syscall.h> instead."'; \
+	 echo '#endif'; \
+	 echo ''; \
+	 rm -f $(@:.d=.h).newt; \
+	 $(CC) -E -MD -MP -MF $(@:.h=.d)-t -MT '$(@:.d=.h) $(@:.h=.d)' \
+	       -x c -I $(common-objdir) $(sysincludes) $< -D_LIBC -dM | \
+	 sed -n 's@^#define __NR_\([^ ]*\) .*$$@#define SYS_\1 __NR_\1@p' \
+	     > $(@:.d=.h).newt; \
+	 if grep SYS_O32_ $(@:.d=.h).newt > /dev/null; then \
+	   echo '#if defined _ABI64 && _MIPS_SIM == _ABI64'; \
+	   sed -n 's/^\(#define SYS_\)N64_/\1/p' < $(@:.d=.h).newt; \
+	   echo '#elif defined _ABIN32 && _MIPS_SIM == _ABIN32'; \
+	   sed -n 's/^\(#define SYS_\)N32_/\1/p' < $(@:.d=.h).newt; \
+	   echo '#else'; \
+	   sed -n 's/^\(#define SYS_\)O32_/\1/p' < $(@:.d=.h).newt; \
+	   echo '#endif'; \
+	   sed -n '/^#define SYS_\([ON]32\|N64\)_/p' < $(@:.d=.h).newt; \
+	 else \
+	   cat $(@:.d=.h).newt; \
+	 fi; \
+	 rm $(@:.d=.h).newt; \
+	} > $(@:.d=.h).new
+	mv -f $(@:.d=.h).new $(@:.d=.h)
+ifneq (,$(objpfx))
+	sed $(sed-remove-objpfx) $(@:.h=.d)-t > $(@:.h=.d)-t2
+	rm -f $(@:.h=.d)-t
+	mv -f $(@:.h=.d)-t2 $(@:.h=.d)
+else
+	mv -f $(@:.h=.d)-t $(@:.h=.d)
+endif
 endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/fcntl.h libc-20030708/sysdeps/unix/sysv/linux/mips/bits/fcntl.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/fcntl.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/bits/fcntl.h	2003-04-15 23:55:50.000000000 +0900
@@ -1,5 +1,6 @@
 /* O_*, F_*, FD_* bit values for Linux.
-   Copyright (C) 1995, 1996, 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1995, 1996, 1997, 1998, 2000, 2002, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -142,14 +143,20 @@
 #ifndef __USE_FILE_OFFSET64
     __off_t l_start;	/* Offset where the lock begins.  */
     __off_t l_len;	/* Size of the locked area; zero means until EOF.  */
-    long int l_sysid;	/* XXX */
+#if ! (defined _ABI64 && _MIPS_SIM == _ABI64)
+    /* The 64-bit flock structure, used by the n64 ABI, and for 64-bit
+       fcntls in o32 and n32, never has this field.  */
+    long int l_sysid;
+#endif
 #else
     __off64_t l_start;	/* Offset where the lock begins.  */
     __off64_t l_len;	/* Size of the locked area; zero means until EOF.  */
 #endif
     __pid_t l_pid;	/* Process holding the lock.  */
-#ifndef __USE_FILE_OFFSET64
-    long int pad[4];	/* XXX */
+#if ! defined __USE_FILE_OFFSET64 && ! (defined _ABI64 && _MIPS_SIM == _ABI64)
+    /* The 64-bit flock structure, used by the n64 ABI, and for 64-bit
+       flock in o32 and n32, never has this field.  */
+    long int pad[4];
 #endif
 } flock_t;
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/mips/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/mman.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/bits/mman.h	2003-03-07 18:46:33.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/MIPS version.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -59,6 +59,8 @@
 # define MAP_DENYWRITE	0x2000		/* ETXTBSY */
 # define MAP_EXECUTABLE	0x4000		/* mark it as an executable */
 # define MAP_LOCKED	0x8000		/* pages are locked */
+# define MAP_POPULATE   0x10000         /* populate (prefault) pagetables */
+# define MAP_NONBLOCK   0x20000         /* do not block on IO */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/sigaction.h libc-20030708/sysdeps/unix/sysv/linux/mips/bits/sigaction.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/sigaction.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/bits/sigaction.h	2003-03-28 21:28:21.000000000 +0900
@@ -1,5 +1,6 @@
 /* The proper definitions for Linux/MIPS's sigaction.
-   Copyright (C) 1993,94,95,97,98,99,2000 Free Software Foundation, Inc.
+   Copyright (C) 1993, 1994, 1995, 1997, 1998, 1999, 2000, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -49,7 +50,7 @@
     /* Restore handler.  */
     void (*sa_restorer) (void);
 
-#if _MIPS_ISA == _MIPS_ISA_MIPS1 || _MIPS_ISA == _MIPS_ISA_MIPS2
+#if _MIPS_SZPTR < 64
     int sa_resv[1];
 #endif
   };
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h libc-20030708/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h	2003-04-13 20:36:32.000000000 +0900
@@ -0,0 +1,103 @@
+/* Copyright (C) 1996, 1997, 1998, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#if !defined _SIGNAL_H && !defined _SYS_UCONTEXT_H
+# error "Never use <bits/sigcontext.h> directly; include <signal.h> instead."
+#endif
+
+#ifndef sigcontext_struct
+/* Kernel headers before 2.1.1 define a struct sigcontext_struct, but
+   we need sigcontext.  */
+# define sigcontext_struct sigcontext
+
+/* # include <asm/sigcontext.h> */
+/* Instead of including the kernel header, that will vary depending on
+   whether the 32- or the 64-bit kernel is installed, we paste the
+   contents here.  In case you're wondering about the different
+   licenses, the fact that the file is pasted, instead of included,
+   doesn't really make any difference for the program that includes
+   this header.  */
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+/*
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License.  See the file "COPYING" in the main directory of this archive
+ * for more details.
+ *
+ * Copyright (C) 1996, 1997, 2000 by Ralf Baechle
+ */
+#ifndef _ASM_SIGCONTEXT_H
+#define _ASM_SIGCONTEXT_H
+
+/*
+ * Keep this struct definition in sync with the sigcontext fragment
+ * in arch/mips/tools/offset.c
+ */
+struct sigcontext {
+	unsigned int       sc_regmask;		/* Unused */
+	unsigned int       sc_status;
+	unsigned long long sc_pc;
+	unsigned long long sc_regs[32];
+	unsigned long long sc_fpregs[32];
+	unsigned int       sc_ownedfp;		/* Unused */
+	unsigned int       sc_fpc_csr;
+	unsigned int       sc_fpc_eir;		/* Unused */
+	unsigned int       sc_used_math;
+	unsigned int       sc_ssflags;		/* Unused */
+	unsigned long long sc_mdhi;
+	unsigned long long sc_mdlo;
+
+	unsigned int       sc_cause;		/* Unused */
+	unsigned int       sc_badvaddr;		/* Unused */
+
+	unsigned long      sc_sigset[4];	/* kernel's sigset_t */
+};
+
+#endif /* _ASM_SIGCONTEXT_H */
+#else /* _MIPS_SIM != _MIPS_SIM_ABI32 */
+/*
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License.  See the file "COPYING" in the main directory of this archive
+ * for more details.
+ *
+ * Copyright (C) 1996, 1997, 1999 by Ralf Baechle
+ * Copyright (C) 1999 Silicon Graphics, Inc.
+ */
+#ifndef _ASM_SIGCONTEXT_H
+#define _ASM_SIGCONTEXT_H
+
+/*
+ * Keep this struct definition in sync with the sigcontext fragment
+ * in arch/mips/tools/offset.c
+ */
+struct sigcontext {
+	unsigned long long sc_regs[32];
+	unsigned long long sc_fpregs[32];
+	unsigned long long sc_mdhi;
+	unsigned long long sc_mdlo;
+	unsigned long long sc_pc;
+	unsigned int       sc_status;
+	unsigned int       sc_fpc_csr;
+	unsigned int       sc_fpc_eir;
+	unsigned int       sc_used_math;
+	unsigned int       sc_cause;
+	unsigned int       sc_badvaddr;
+};
+
+#endif /* _ASM_SIGCONTEXT_H */
+#endif /* _MIPS_SIM != _MIPS_SIM_ABI32 */
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/siginfo.h libc-20030708/sysdeps/unix/sysv/linux/mips/bits/siginfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/siginfo.h	2002-12-05 09:22:19.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/bits/siginfo.h	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* siginfo_t, sigevent and constants.  Linux/MIPS version.
-   Copyright (C) 1997, 1998, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -119,8 +119,10 @@
    signals.  */
 enum
 {
-  SI_ASYNCNL = -6,		/* Sent by asynch name lookup completion.  */
+  SI_ASYNCNL = -60,		/* Sent by asynch name lookup completion.  */
 # define SI_ASYNCNL	SI_ASYNCNL
+  SI_TKILL = -6,		/* Sent by tkill. */
+# define SI_TKILL	SI_TKILL
   SI_SIGIO,			/* Sent by queued SIGIO. */
 # define SI_SIGIO	SI_SIGIO
   SI_MESGQ,			/* Sent by real time mesq state change.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/mips/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/bits/stat.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/bits/stat.h	2003-04-15 23:55:50.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1992,95,96,97,98,99,2000,2001 Free Software Foundation, Inc.
+/* Copyright (C) 1992, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,6 +34,7 @@
 #define _MKNOD_VER		_MKNOD_VER_LINUX /* The bits defined below.  */
 
 
+#if _MIPS_SIM == _MIPS_SIM_ABI32
 /* Structure describing file characteristics.  */
 struct stat
   {
@@ -106,6 +108,71 @@
     long int st_pad4[14];
   };
 #endif
+#else
+struct stat
+  {
+    __dev_t st_dev;
+    int	st_pad1[3];		/* Reserved for st_dev expansion  */
+#ifndef __USE_FILE_OFFSET64
+    __ino_t st_ino;
+#else
+    __ino64_t st_ino;
+#endif
+    __mode_t st_mode;
+    __nlink_t st_nlink;
+    __uid_t st_uid;
+    __gid_t st_gid;
+    __dev_t st_rdev;
+#if !defined __USE_FILE_OFFSET64
+    unsigned int st_pad2[2];	/* Reserved for st_rdev expansion  */
+    __off_t st_size;
+    int st_pad3;
+#else
+    unsigned int st_pad2[3];	/* Reserved for st_rdev expansion  */
+    __off64_t st_size;
+#endif
+    __time_t st_atime;
+    int __reserved0;
+    __time_t st_mtime;
+    int __reserved1;
+    __time_t st_ctime;
+    int __reserved2;
+    __blksize_t st_blksize;
+    unsigned int st_pad4;
+#ifndef __USE_FILE_OFFSET64
+    __blkcnt_t st_blocks;
+#else
+    __blkcnt64_t st_blocks;
+#endif
+    int st_pad5[14];
+  };
+
+#ifdef __USE_LARGEFILE64
+struct stat64
+  {
+    __dev_t st_dev;
+    unsigned int st_pad1[3];	/* Reserved for st_dev expansion  */
+    __ino64_t st_ino;
+    __mode_t st_mode;
+    __nlink_t st_nlink;
+    __uid_t st_uid;
+    __gid_t st_gid;
+    __dev_t st_rdev;
+    unsigned int st_pad2[3];	/* Reserved for st_rdev expansion  */
+    __off64_t st_size;
+    __time_t st_atime;
+    int __reserved0;
+    __time_t st_mtime;
+    int __reserved1;
+    __time_t st_ctime;
+    int __reserved2;
+    __blksize_t st_blksize;
+    unsigned int st_pad3;
+    __blkcnt64_t st_blocks;
+    int st_pad4[14];
+};
+#endif
+#endif
 
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/clone.S libc-20030708/sysdeps/unix/sysv/linux/mips/clone.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/clone.S	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/clone.S	2003-04-01 21:01:07.000000000 +0900
@@ -1,6 +1,6 @@
-/* Copyright (C) 1996, 1997, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
-   Contributed by Ralf Baechle <ralf@gnu.ai.mit.edu>, 1996.
+   Contributed by Ralf Baechle <ralf@linux-mips.org>, 1996.
 
    The GNU C Library is free software; you can redistribute it and/or
    modify it under the terms of the GNU Lesser General Public
@@ -21,7 +21,6 @@
    and invokes a function in the right context after its all over.  */
 
 #include <sys/asm.h>
-#include <asm/unistd.h>
 #include <sysdep.h>
 #define _ERRNO_H	1
 #include <bits/errno.h>
@@ -29,15 +28,17 @@
 /* int clone(int (*fn)(void *arg), void *child_stack, int flags, void *arg) */
 
 	.text
+LOCALSZ= 1
+FRAMESZ= (((NARGSAVE+LOCALSZ)*SZREG)+ALSZ)&ALMASK
+GPOFF= FRAMESZ-(1*SZREG)
 NESTED(__clone,4*SZREG,sp)
 #ifdef __PIC__
-	.set		noreorder
-	.cpload		$25
-	.set		reorder
-	subu		sp,32
-	.cprestore	16
-#else
-	subu		sp,32
+	SETUP_GP
+#endif
+	PTR_SUBU sp, FRAMESZ
+	SETUP_GP64 (GPOFF, __clone)
+#ifdef __PIC__
+	SAVE_GP (GPOFF)
 #endif
 #ifdef PROF
 	.set		noat
@@ -49,12 +50,12 @@
 
 	/* Sanity check arguments.  */
 	li		v0,EINVAL
-	beqz		a0,error	/* No NULL function pointers.  */
-	beqz		a1,error	/* No NULL stack pointers.  */
+	beqz		a0,L(error)	/* No NULL function pointers.  */
+	beqz		a1,L(error)	/* No NULL stack pointers.  */
 
-	subu		a1,32		/* Reserve argument save space.  */
-	sw		a0,0(a1)	/* Save function pointer.  */
-	sw		a3,4(a1)	/* Save argument pointer.  */
+	PTR_SUBU	a1,32		/* Reserve argument save space.  */
+	PTR_S		a0,0(a1)	/* Save function pointer.  */
+	PTR_S		a3,PTRSIZE(a1)	/* Save argument pointer.  */
 
 
 	/* Do the system call */
@@ -62,20 +63,24 @@
 	li		v0,__NR_clone
 	syscall
 
-	bnez		a3,error
-	beqz		v0,__thread_start
+	bnez		a3,L(error)
+	beqz		v0,L(thread_start)
 
 	/* Successful return from the parent */
-	addiu		sp,32
+	RESTORE_GP64
+	PTR_ADDU	sp, FRAMESZ
 	ret
 
 	/* Something bad happened -- no child created */
-error:
-	addiu		sp,32
+L(error):
 #ifdef __PIC__
-	la		t9,__syscall_error
+	PTR_LA		t9,__syscall_error
+	RESTORE_GP64
+	PTR_ADDU	sp, FRAMESZ
 	jr		t9
 #else
+	RESTORE_GP64
+	PTR_ADDU	sp, FRAMESZ
 	j		__syscall_error
 #endif
 	END(__clone)
@@ -85,20 +90,21 @@
    debug info.  */
 
 ENTRY(__thread_start)
+L(thread_start):
 	/* cp is already loaded.  */
-	.cprestore	16
+	SAVE_GP (GPOFF)
 	/* The stackframe has been created on entry of clone().  */
 	/* Restore the arg for user's function.  */
-	lw		t9,0(sp)	/* Function pointer.  */
-	lw		a0,4(sp)	/* Argument pointer.  */
+	PTR_L		t9,0(sp)	/* Function pointer.  */
+	PTR_L		a0,PTRSIZE(sp)	/* Argument pointer.  */
 
 	/* Call the user's function.  */
-	jalr		t9
+	jal		t9
 
 	/* Call _exit rather than doing it inline for breakpoint purposes.  */
 	move		a0,v0
 #ifdef __PIC__
-	la		t9,_exit
+	PTR_LA		t9,_exit
 	jalr		t9
 #else
 	jal		_exit
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/configure libc-20030708/sysdeps/unix/sysv/linux/mips/configure
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/configure	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/configure	2003-03-28 21:28:21.000000000 +0900
@@ -0,0 +1,75 @@
+# This file is generated from configure.in by Autoconf.  DO NOT EDIT!
+ # Local configure fragment for sysdeps/unix/sysv/linux/mips.
+
+case $machine in
+mips*64*)
+  rm -f asm-unistd.h
+  asm_unistd_h=$sysheaders/asm/unistd.h
+  if test ! -f $asm_unistd_h; then
+    # Try to find asm/unistd.h in compiler header search path.
+    try_asm_unistd_h=`echo '#include <asm/unistd.h>' | $CPP - |
+			sed -n '/^# 1 "\(\/[^"]*\)".*/{s,,\1,p;q;}'`
+    if test -n "$try_asm_unistd_h" &&
+       test -f "$try_asm_unistd_h"; then
+      asm_unistd_h=$try_asm_unistd_h
+    fi
+  fi
+  if test ! -f "$asm_unistd_h"; then
+    { echo "$as_me:$LINENO: WARNING: *** asm/unistd.h not found, it will not be pre-processed" >&5
+echo "$as_me: WARNING: *** asm/unistd.h not found, it will not be pre-processed" >&2;}
+    echo '#include <asm/unistd.h>' > asm-unistd.h
+  else
+    # The point of this preprocessing is to turn __NR_<syscall> into
+    # __NR_N64_<syscall>, as well as to define __NR_<syscall> to
+    # __NR_<abi>_<syscall>, if __NR_<abi>_<syscall> is defined
+    # and <abi> is the compiler-enabled ABI.
+    cat "$asm_unistd_h" |
+    sed -e 's,__NR_,__NR_N64_,g' \
+        -e 's,__NR_N64_##,__NR_##,g' \
+	-e 's,__NR_N64_O32_,__NR_O32_,g' \
+	-e 's,__NR_N64_N32_,__NR_N32_,g' \
+	-e 's,__NR_N64_N64_,__NR_N64_,g' \
+    | awk > asm-unistd.h '
+/^#define __NR.*unused/ { print; next; }
+/^#define __NR_N64__exit __NR_N64_exit/ {
+	print "#define __NR__exit __NR_exit";
+	print "#define __NR_O32__exit __NR_O32_exit";
+	print "#define __NR_N32__exit __NR_N32_exit";
+	print; next;
+}
+/^#define __NR_O32_/ {
+	name = $2;
+	sub (/_O32_/, "_", name);
+	print;
+	print "#if _MIPS_SIM == _MIPS_SIM_ABI32";
+	print "# define " name " " $2;
+	print "#endif";
+	next;
+}
+/^#define __NR_N32_/ {
+	name = $2;
+	sub (/_N32_/, "_", name);
+	print;
+	print "#if defined _ABIN32 && _MIPS_SIM == _ABIN32";
+	print "# define " name " " $2;
+	print "#endif";
+	next;
+}
+/^#define __NR_N64_/ {
+	name = $2;
+	sub (/_N64_/, "_", name);
+	print;
+	print "#if defined _ABI64 && _MIPS_SIM == _ABI64";
+	print "# define " name " " $2;
+	print "#endif";
+	next;
+}
+{
+	print;
+}'
+  fi ;;
+mips*)
+  rm -f asm-unistd.h
+  echo '#include <asm/unistd.h>' > asm-unistd.h
+  ;;
+esac
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/configure.in libc-20030708/sysdeps/unix/sysv/linux/mips/configure.in
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/configure.in	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/configure.in	2003-03-18 00:50:05.000000000 +0900
@@ -0,0 +1,75 @@
+sinclude(./aclocal.m4)dnl Autoconf lossage
+GLIBC_PROVIDES dnl See aclocal.m4 in the top level source directory.
+# Local configure fragment for sysdeps/unix/sysv/linux/mips.
+
+case $machine in
+mips*64*)
+  rm -f asm-unistd.h
+  asm_unistd_h=$sysheaders/asm/unistd.h
+  if test ! -f $asm_unistd_h; then
+    # Try to find asm/unistd.h in compiler header search path.
+    try_asm_unistd_h=`echo '#include <asm/unistd.h>' | $CPP - |
+			sed -n '/^# 1 "\(\/[^"]*\)".*/{s,,\1,p;q;}'`
+    if test -n "$try_asm_unistd_h" &&
+       test -f "$try_asm_unistd_h"; then
+      asm_unistd_h=$try_asm_unistd_h
+    fi
+  fi
+  if test ! -f "$asm_unistd_h"; then
+    AC_MSG_WARN([*** asm/unistd.h not found, it will not be pre-processed])
+    echo '#include <asm/unistd.h>' > asm-unistd.h
+  else
+    # The point of this preprocessing is to turn __NR_<syscall> into
+    # __NR_N64_<syscall>, as well as to define __NR_<syscall> to
+    # __NR_<abi>_<syscall>, if __NR_<abi>_<syscall> is defined
+    # and <abi> is the compiler-enabled ABI.
+    cat "$asm_unistd_h" |
+    sed -e 's,__NR_,__NR_N64_,g' \
+        -e 's,__NR_N64_##,__NR_##,g' \
+	-e 's,__NR_N64_O32_,__NR_O32_,g' \
+	-e 's,__NR_N64_N32_,__NR_N32_,g' \
+	-e 's,__NR_N64_N64_,__NR_N64_,g' \
+    | awk > asm-unistd.h '
+/^#define __NR.*unused/ { print; next; }
+/^#define __NR_N64__exit __NR_N64_exit/ {
+	print "#define __NR__exit __NR_exit";
+	print "#define __NR_O32__exit __NR_O32_exit";
+	print "#define __NR_N32__exit __NR_N32_exit";
+	print; next;
+}
+/^#define __NR_O32_/ {
+	name = $2;
+	sub (/_O32_/, "_", name);
+	print;
+	print "#if _MIPS_SIM == _MIPS_SIM_ABI32";
+	print "# define " name " " $2;
+	print "#endif";
+	next;
+}
+/^#define __NR_N32_/ {
+	name = $2;
+	sub (/_N32_/, "_", name);
+	print;
+	print "#if defined _ABIN32 && _MIPS_SIM == _ABIN32";
+	print "# define " name " " $2;
+	print "#endif";
+	next;
+}
+/^#define __NR_N64_/ {
+	name = $2;
+	sub (/_N64_/, "_", name);
+	print;
+	print "#if defined _ABI64 && _MIPS_SIM == _ABI64";
+	print "# define " name " " $2;
+	print "#endif";
+	next;
+}
+{
+	print;
+}'
+  fi ;;
+mips*)
+  rm -f asm-unistd.h
+  echo '#include <asm/unistd.h>' > asm-unistd.h
+  ;;
+esac
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/dl-cache.h libc-20030708/sysdeps/unix/sysv/linux/mips/dl-cache.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/dl-cache.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/dl-cache.h	2003-06-25 17:03:24.000000000 +0900
@@ -0,0 +1,43 @@
+/* Support for reading /etc/ld.so.cache files written by Linux ldconfig.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define add_system_dir(dir) \
+  do								\
+    {								\
+      size_t len = strlen (dir);				\
+      char path[len + 3];					\
+      memcpy (path, dir, len + 1);				\
+      if (len >= 6						\
+	  && (! memcmp (path + len - 6, "/lib64", 6)		\
+	      || ! memcmp (path + len - 6, "/lib32", 6)))	\
+	{							\
+	  len -= 2;						\
+	  path[len] = '\0';					\
+	}							\
+      add_dir (path);						\
+      if (len >= 4 && ! memcmp (path + len - 4, "/lib", 4))	\
+	{							\
+	  memcpy (path + len, "32", 3);				\
+	  add_dir (path);					\
+	  memcpy (path + len, "64", 3);				\
+	  add_dir (path);					\
+	}							\
+    } while (0)
+
+#include_next <dl-cache.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/kernel_sigaction.h libc-20030708/sysdeps/unix/sysv/linux/mips/kernel_sigaction.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/kernel_sigaction.h	2000-12-15 15:05:44.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/kernel_sigaction.h	2003-03-28 21:28:21.000000000 +0900
@@ -12,7 +12,7 @@
 
 	/* Abi says here follows reserved int[2] */
 	void		(*sa_restorer)(void);
-#if (_MIPS_ISA == _MIPS_ISA_MIPS1) || (_MIPS_ISA == _MIPS_ISA_MIPS2)
+#if (_MIPS_SZPTR < 64)
 	/*
 	 * For 32 bit code we have to pad struct sigaction to get
 	 * constant size for the ABI
@@ -23,7 +23,7 @@
 
 
 #define _KERNEL_NSIG	       128
-#define _KERNEL_NSIG_BPW       32
+#define _KERNEL_NSIG_BPW       _MIPS_SZLONG
 #define _KERNEL_NSIG_WORDS     (_KERNEL_NSIG / _KERNEL_NSIG_BPW)
 
 typedef struct {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/kernel_stat.h libc-20030708/sysdeps/unix/sysv/linux/mips/kernel_stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/kernel_stat.h	2000-11-20 17:45:43.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/kernel_stat.h	2003-04-15 23:55:50.000000000 +0900
@@ -1,4 +1,31 @@
-/* Definition of `struct stat' used in the kernel..  */
+/* As tempting as it is to define XSTAT_IS_XSTAT64 for n64, the
+   userland data structures are not identical, because of different
+   padding.  */
+/* Definition of `struct stat' used in the kernel.  */
+#if _MIPS_SIM != _MIPS_SIM_ABI32
+struct kernel_stat
+  {
+    unsigned int st_dev;
+    unsigned int __pad1[3];
+    unsigned long long st_ino;
+    unsigned int st_mode;
+    unsigned int st_nlink;
+    int st_uid;
+    int st_gid;
+    unsigned int st_rdev;
+    unsigned int __pad2[3];
+    long long st_size;
+    unsigned int st_atime;
+    unsigned int __unused1;
+    unsigned int st_mtime;
+    unsigned int __unused2;
+    unsigned int st_ctime;
+    unsigned int __unused3;
+    unsigned int st_blksize;
+    unsigned int __pad3;
+    unsigned long long st_blocks;
+  };
+#else
 struct kernel_stat
   {
     unsigned long int st_dev;
@@ -26,3 +53,4 @@
     unsigned int st_flags;
     unsigned int st_gen;
   };
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips32/kern64/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/mips/mips32/kern64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips32/kern64/sysdep.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips32/kern64/sysdep.h	2003-03-29 17:15:29.000000000 +0900
@@ -0,0 +1,36 @@
+/* Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _LINUX_MIPS_MIPS32_KERN64_SYSDEP_H
+#define _LINUX_MIPS_MIPS32_KERN64_SYSDEP_H 1
+
+/* There is some commonality.  */
+#include <sysdeps/unix/sysv/linux/mips/mips32/sysdep.h>
+
+/* For Linux we can use the system call table in the header file
+	/usr/include/asm/unistd.h
+   of the kernel.  But these symbols do not follow the SYS_* syntax
+   so we have to redefine the `SYS_ify' macro here.  */
+#undef SYS_ify
+#ifdef __STDC__
+# define SYS_ify(syscall_name)	__NR_O32_##syscall_name
+#else
+# define SYS_ify(syscall_name)	__NR_O32_/**/syscall_name
+#endif
+
+#endif /* linux/mips/mips32/kern64/sysdep.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips32/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/mips/mips32/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips32/sysdep.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips32/sysdep.h	2003-03-29 17:15:29.000000000 +0900
@@ -0,0 +1,282 @@
+/* Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _LINUX_MIPS_MIPS32_SYSDEP_H
+#define _LINUX_MIPS_MIPS32_SYSDEP_H 1
+
+/* There is some commonality.  */
+#include <sysdeps/unix/mips/mips32/sysdep.h>
+
+/* For Linux we can use the system call table in the header file
+	/usr/include/asm/unistd.h
+   of the kernel.  But these symbols do not follow the SYS_* syntax
+   so we have to redefine the `SYS_ify' macro here.  */
+#undef SYS_ify
+#ifdef __STDC__
+# define SYS_ify(syscall_name)	__NR_##syscall_name
+#else
+# define SYS_ify(syscall_name)	__NR_/**/syscall_name
+#endif
+
+#ifdef __ASSEMBLER__
+
+/* We don't want the label for the error handler to be visible in the symbol
+   table when we define it here.  */
+#ifdef __PIC__
+# define SYSCALL_ERROR_LABEL 99b
+#endif
+
+#else   /* ! __ASSEMBLER__ */
+
+/* Define a macro which expands into the inline wrapper code for a system
+   call.  */
+#undef INLINE_SYSCALL
+#define INLINE_SYSCALL(name, nr, args...)                               \
+  ({ INTERNAL_SYSCALL_DECL(err);					\
+     long result_var = INTERNAL_SYSCALL (name, err, nr, args);      	\
+     if ( INTERNAL_SYSCALL_ERROR_P (result_var, err) )  		\
+       {                                                                \
+         __set_errno (INTERNAL_SYSCALL_ERRNO (result_var, err));      	\
+         result_var = -1L;                               		\
+       }                                                                \
+     result_var; })
+
+#undef INTERNAL_SYSCALL_DECL
+#define INTERNAL_SYSCALL_DECL(err) long err
+
+#undef INTERNAL_SYSCALL_ERROR_P
+#define INTERNAL_SYSCALL_ERROR_P(val, err)   ((long) (err))
+
+#undef INTERNAL_SYSCALL_ERRNO
+#define INTERNAL_SYSCALL_ERRNO(val, err)     (val)
+
+#undef INTERNAL_SYSCALL
+#define INTERNAL_SYSCALL(name, err, nr, args...) internal_syscall##nr(name, err, args)
+
+#define internal_syscall0(name, err, dummy...) 				\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %2\t\t\t# " #name "\n\t"				\
+	"syscall\n\t" 							\
+	".set reorder" 							\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "i" (SYS_ify(name))						\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall1(name, err, arg1) 				\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %3\t\t\t# " #name "\n\t"				\
+	"syscall\n\t" 							\
+	".set reorder" 							\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "i" (SYS_ify(name)) 				\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall2(name, err, arg1, arg2) 			\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %4\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "i" (SYS_ify(name))			\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall3(name, err, arg1, arg2, arg3) 			\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall4(name, err, arg1, arg2, arg3, arg4) 		\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall5(name, err, arg1, arg2, arg3, arg4, arg5) 	\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"lw\t$2, %6\n\t" 						\
+	"subu\t$29, 32\n\t" 						\
+	"sw\t$2, 16($29)\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	"addiu\t$29, 32\n\t" 						\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "m" ((long)arg5) 						\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall6(name, err, arg1, arg2, arg3, arg4, arg5, arg6)\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"lw\t$2, %6\n\t" 						\
+	"lw\t$8, %7\n\t" 						\
+	"subu\t$29, 32\n\t" 						\
+	"sw\t$2, 16($29)\n\t" 						\
+	"sw\t$8, 20($29)\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	"addiu\t$29, 32\n\t" 						\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "m" ((long)arg5), "m" ((long)arg6)				\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall7(name, err, arg1, arg2, arg3, arg4, arg5, arg6, arg7)\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"lw\t$2, %6\n\t" 						\
+	"lw\t$8, %7\n\t" 						\
+	"lw\t$9, %8\n\t" 						\
+	"subu\t$29, 32\n\t" 						\
+	"sw\t$2, 16($29)\n\t" 						\
+	"sw\t$8, 20($29)\n\t" 						\
+	"sw\t$9, 24($29)\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	"addiu\t$29, 32\n\t" 						\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "m" ((long)arg5), "m" ((long)arg6), "m" ((long)arg7)		\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define __SYSCALL_CLOBBERS "$1", "$3", "$8", "$9", "$10", "$11", "$12", "$13", "$14", "$15", "$24", "$25"
+
+#endif /* __ASSEMBLER__ */
+
+#endif /* linux/mips/mips32/sysdep.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/Dist libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/Dist
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/Dist	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/Dist	2003-03-18 00:57:19.000000000 +0900
@@ -0,0 +1 @@
+ldd-rewrite.sed
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/ldconfig.h libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/ldconfig.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/ldconfig.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/ldconfig.h	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1,26 @@
+/* Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdeps/generic/ldconfig.h>
+
+#define SYSDEP_KNOWN_INTERPRETER_NAMES \
+  { "/lib32/ld.so.1", FLAG_ELF_LIBC6 }, \
+  { "/lib64/ld.so.1", FLAG_ELF_LIBC6 },
+#define SYSDEP_KNOWN_LIBRARY_NAMES \
+  { "libc.so.6", FLAG_ELF_LIBC6 },	\
+  { "libm.so.6", FLAG_ELF_LIBC6 },
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/ldd-rewrite.sed libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/ldd-rewrite.sed
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/ldd-rewrite.sed	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/ldd-rewrite.sed	2003-03-18 00:57:19.000000000 +0900
@@ -0,0 +1 @@
+s_^\(RTLDLIST=\)\(.*lib\)\(\|32\|64\)\(/[^/]*\.so\.[0-9.]*\)[ 	]*$_\1"\232\4 \264\4 \2\4"_
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/llseek.c libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/llseek.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/llseek.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/llseek.c	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1 @@
+/* lseek() is 64-bit capable already.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n32/ftruncate64.c libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n32/ftruncate64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n32/ftruncate64.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n32/ftruncate64.c	2003-04-06 04:57:35.000000000 +0900
@@ -0,0 +1,28 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/types.h>
+
+#include <sysdep.h>
+
+extern int ftruncate (int fd, off64_t length);
+
+int __ftruncate64 (int fd, off64_t length) {
+  return ftruncate (fd, length);
+}
+weak_alias (__ftruncate64, ftruncate64)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n32/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n32/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n32/sysdep.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n32/sysdep.h	2003-06-12 08:54:05.000000000 +0900
@@ -0,0 +1,263 @@
+/* Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _LINUX_MIPS_SYSDEP_H
+#define _LINUX_MIPS_SYSDEP_H 1
+
+/* There is some commonality.  */
+#include <sysdeps/unix/mips/mips64/n32/sysdep.h>
+
+/* For Linux we can use the system call table in the header file
+	/usr/include/asm/unistd.h
+   of the kernel.  But these symbols do not follow the SYS_* syntax
+   so we have to redefine the `SYS_ify' macro here.  */
+#undef SYS_ify
+#ifdef __STDC__
+# define SYS_ify(syscall_name)	__NR_N32_##syscall_name
+#else
+# define SYS_ify(syscall_name)	__NR_N32_/**/syscall_name
+#endif
+
+
+#ifndef __ASSEMBLER__
+#if 0 /* untested */
+/* Define a macro which expands into the inline wrapper code for a system
+   call.  */
+#undef INLINE_SYSCALL
+#define INLINE_SYSCALL(name, nr, args...)                               \
+  ({ INTERNAL_SYSCALL_DECL(err);					\
+     long result_var = INTERNAL_SYSCALL (name, err, nr, args);      	\
+     if ( INTERNAL_SYSCALL_ERROR_P (result_var, err) )  		\
+       {                                                                \
+         __set_errno (INTERNAL_SYSCALL_ERRNO (result_var, err));      	\
+         result_var = -1L;                               		\
+       }                                                                \
+     result_var; })
+
+#undef INTERNAL_SYSCALL_DECL
+#define INTERNAL_SYSCALL_DECL(err) long err
+
+#undef INTERNAL_SYSCALL_ERROR_P
+#define INTERNAL_SYSCALL_ERROR_P(val, err)   ((long) (err))
+
+#undef INTERNAL_SYSCALL_ERRNO
+#define INTERNAL_SYSCALL_ERRNO(val, err)     (val)
+
+#undef INTERNAL_SYSCALL
+#define INTERNAL_SYSCALL(name, err, nr, args...) internal_syscall##nr(name, err, args)
+
+#define internal_syscall0(name, err, dummy...) 				\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %2\t\t\t# " #name "\n\t"				\
+	"syscall\n\t" 							\
+	".set reorder" 							\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "i" (SYS_ify(name))						\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall1(name, err, arg1) 				\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long long __v0 asm("$2"); 				\
+	register long long __a0 asm("$4") = (long long) arg1; 		\
+	register long long __a3 asm("$7"); 				\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %3\t\t\t# " #name "\n\t"				\
+	"syscall\n\t" 							\
+	".set reorder" 							\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "i" (SYS_ify(name)) 				\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall2(name, err, arg1, arg2) 			\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long long __v0 asm("$2"); 				\
+	register long long __a0 asm("$4") = (long long) arg1; 		\
+	register long long __a1 asm("$5") = (long long) arg2; 		\
+	register long long __a3 asm("$7"); 				\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %4\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "i" (SYS_ify(name))			\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall3(name, err, arg1, arg2, arg3) 			\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long long __v0 asm("$2"); 				\
+	register long long __a0 asm("$4") = (long long) arg1; 		\
+	register long long __a1 asm("$5") = (long long) arg2; 		\
+	register long long __a2 asm("$6") = (long long) arg3; 		\
+	register long long __a3 asm("$7"); 				\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall4(name, err, arg1, arg2, arg3, arg4) 		\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long long __v0 asm("$2"); 				\
+	register long long __a0 asm("$4") = (long long) arg1; 		\
+	register long long __a1 asm("$5") = (long long) arg2; 		\
+	register long long __a2 asm("$6") = (long long) arg3; 		\
+	register long long __a3 asm("$7") = (long long) arg4; 		\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall5(name, err, arg1, arg2, arg3, arg4, arg5) 	\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long long __v0 asm("$2"); 				\
+	register long long __a0 asm("$4") = (long long) arg1; 		\
+	register long long __a1 asm("$5") = (long long) arg2; 		\
+	register long long __a2 asm("$6") = (long long) arg3; 		\
+	register long long __a3 asm("$7") = (long long) arg4; 		\
+	register long long __a4 asm("$8") = (long long) arg5; 		\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "r" (__a4) 							\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall6(name, err, arg1, arg2, arg3, arg4, arg5, arg6)\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long long __v0 asm("$2"); 				\
+	register long long __a0 asm("$4") = (long long) arg1; 		\
+	register long long __a1 asm("$5") = (long long) arg2; 		\
+	register long long __a2 asm("$6") = (long long) arg3; 		\
+	register long long __a3 asm("$7") = (long long) arg4; 		\
+	register long long __a4 asm("$8") = (long long) arg5; 		\
+	register long long __a5 asm("$9") = (long long) arg6; 		\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "r" (__a4), "r" (__a5)					\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall7(name, err, arg1, arg2, arg3, arg4, arg5, arg6, arg7)\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long long __v0 asm("$2"); 				\
+	register long long __a0 asm("$4") = (long long) arg1; 		\
+	register long long __a1 asm("$5") = (long long) arg2; 		\
+	register long long __a2 asm("$6") = (long long) arg3; 		\
+	register long long __a3 asm("$7") = (long long) arg4; 		\
+	register long long __a4 asm("$8") = (long long) arg5; 		\
+	register long long __a5 asm("$9") = (long long) arg6; 		\
+	register long long __a6 asm("$10") = (long long) arg7; 		\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "r" (__a4), "r" (__a5), "r" (__a6)				\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define __SYSCALL_CLOBBERS "$1", "$3", "$11", "$12", "$13", "$14", "$15", "$24", "$25"
+#endif /* untested */
+#endif /* __ASSEMBLER__ */
+
+#endif /* linux/mips/sysdep.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n32/truncate64.c libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n32/truncate64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n32/truncate64.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n32/truncate64.c	2003-04-06 04:57:35.000000000 +0900
@@ -0,0 +1,30 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/types.h>
+
+#include <sysdep.h>
+#include <bp-checks.h>
+
+extern int truncate (const char *__unbounded path, int dummy,
+		     off64_t length);
+
+int truncate64 (const char *__unbounded path, int dummy,
+		off64_t length) {
+  return truncate (path, dummy, length);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n64/glob64.c libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n64/glob64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n64/glob64.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n64/glob64.c	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1 @@
+/* glob64 is in glob.c */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n64/ioctl.S	2003-03-20 16:54:56.000000000 +0900
@@ -0,0 +1,42 @@
+/* Copyright 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#include <sys/asm.h>
+
+/* Sign-extend the ioctl number, since the kernel wants it as a
+   sign-extended 32-bit value, but our prototype is that of a long.  */
+
+	.text
+ENTRY (__ioctl)
+	li v0, __NR_ioctl
+	sll a1,a1,0
+	syscall			/* Do the system call.  */
+	bne a3, zero, L(error)
+	ret
+
+L(error):
+	.cpsetup t9, a0, __ioctl
+	PTR_LA t9,__syscall_error
+	.cprestore
+	jr t9
+
+PSEUDO_END (__ioctl)
+
+weak_alias (__ioctl, ioctl)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n64/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/n64/sysdep.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/n64/sysdep.h	2003-06-12 08:54:05.000000000 +0900
@@ -0,0 +1,263 @@
+/* Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _LINUX_MIPS_SYSDEP_H
+#define _LINUX_MIPS_SYSDEP_H 1
+
+/* There is some commonality.  */
+#include <sysdeps/unix/mips/mips64/n64/sysdep.h>
+
+/* For Linux we can use the system call table in the header file
+	/usr/include/asm/unistd.h
+   of the kernel.  But these symbols do not follow the SYS_* syntax
+   so we have to redefine the `SYS_ify' macro here.  */
+#undef SYS_ify
+#ifdef __STDC__
+# define SYS_ify(syscall_name)	__NR_N64_##syscall_name
+#else
+# define SYS_ify(syscall_name)	__NR_N64_/**/syscall_name
+#endif
+
+
+#ifndef __ASSEMBLER__
+#if 0 /* untested */
+/* Define a macro which expands into the inline wrapper code for a system
+   call.  */
+#undef INLINE_SYSCALL
+#define INLINE_SYSCALL(name, nr, args...)                               \
+  ({ INTERNAL_SYSCALL_DECL(err);					\
+     long result_var = INTERNAL_SYSCALL (name, err, nr, args);      	\
+     if ( INTERNAL_SYSCALL_ERROR_P (result_var, err) )  		\
+       {                                                                \
+         __set_errno (INTERNAL_SYSCALL_ERRNO (result_var, err));      	\
+         result_var = -1L;                               		\
+       }                                                                \
+     result_var; })
+
+#undef INTERNAL_SYSCALL_DECL
+#define INTERNAL_SYSCALL_DECL(err) long err
+
+#undef INTERNAL_SYSCALL_ERROR_P
+#define INTERNAL_SYSCALL_ERROR_P(val, err)   ((long) (err))
+
+#undef INTERNAL_SYSCALL_ERRNO
+#define INTERNAL_SYSCALL_ERRNO(val, err)     (val)
+
+#undef INTERNAL_SYSCALL
+#define INTERNAL_SYSCALL(name, err, nr, args...) internal_syscall##nr(name, err, args)
+
+#define internal_syscall0(name, err, dummy...) 				\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %2\t\t\t# " #name "\n\t"				\
+	"syscall\n\t" 							\
+	".set reorder" 							\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "i" (SYS_ify(name))						\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall1(name, err, arg1) 				\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %3\t\t\t# " #name "\n\t"				\
+	"syscall\n\t" 							\
+	".set reorder" 							\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "i" (SYS_ify(name)) 				\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall2(name, err, arg1, arg2) 			\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %4\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "i" (SYS_ify(name))			\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall3(name, err, arg1, arg2, arg3) 			\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7"); 					\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "=r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall4(name, err, arg1, arg2, arg3, arg4) 		\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall5(name, err, arg1, arg2, arg3, arg4, arg5) 	\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	register long __a4 asm("$8") = (long) arg5; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "r" (__a4) 							\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall6(name, err, arg1, arg2, arg3, arg4, arg5, arg6)\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	register long __a4 asm("$8") = (long) arg5; 			\
+	register long __a5 asm("$9") = (long) arg6; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "r" (__a4), "r" (__a5)					\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define internal_syscall7(name, err, arg1, arg2, arg3, arg4, arg5, arg6, arg7)\
+({ 									\
+	long _sys_result;						\
+									\
+	{								\
+	register long __v0 asm("$2"); 					\
+	register long __a0 asm("$4") = (long) arg1; 			\
+	register long __a1 asm("$5") = (long) arg2; 			\
+	register long __a2 asm("$6") = (long) arg3; 			\
+	register long __a3 asm("$7") = (long) arg4; 			\
+	register long __a4 asm("$8") = (long) arg5; 			\
+	register long __a5 asm("$9") = (long) arg6; 			\
+	register long __a6 asm("$10") = (long) arg7; 			\
+	__asm__ volatile ( 						\
+	".set\tnoreorder\n\t" 						\
+	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
+	"syscall\n\t" 							\
+	".set\treorder" 						\
+	: "=r" (__v0), "+r" (__a3) 					\
+	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
+	  "r" (__a4), "r" (__a5), "r" (__a6)				\
+	: __SYSCALL_CLOBBERS); 						\
+	err = __a3;							\
+	_sys_result = __v0;						\
+	}								\
+	_sys_result;							\
+})
+
+#define __SYSCALL_CLOBBERS "$1", "$3", "$11", "$12", "$13", "$14", "$15", "$24", "$25"
+#endif /* untested */
+#endif /* __ASSEMBLER__ */
+
+#endif /* linux/mips/sysdep.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/recv.c libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/recv.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/recv.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/recv.c	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1 @@
+#include <sysdeps/unix/sysv/linux/x86_64/recv.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/send.c libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/send.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/send.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/send.c	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1 @@
+#include <sysdeps/unix/sysv/linux/x86_64/send.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/syscall.S libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/syscall.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/syscall.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/syscall.S	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1,53 @@
+/* Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#include <sys/asm.h>
+
+/* Please consult the file sysdeps/unix/sysv/linux/x86-64/sysdep.h for
+   more information about the value -4095 used below.  */
+
+/* Usage: long syscall (syscall_number, arg1, arg2, arg3, arg4, arg5)
+   We need to do some arg shifting, the syscall_number will be in
+   rax.  */
+
+
+	.text
+ENTRY (syscall)
+	move v0, a0		/* Syscall number -> v0 */
+	move a0, a1		/* shift arg1 - arg7.  */
+	move a1, a2
+	move a2, a3
+	move a3, a4
+	move a4, a5
+	move a5, a6
+	move a6, a7
+
+	syscall			/* Do the system call.  */
+	bne a3, zero, L(error)
+
+	ret
+
+L(error):
+	.cpsetup t9, a0, syscall
+	PTR_LA t9,__syscall_error
+	.cprestore
+	jr t9
+
+PSEUDO_END (syscall)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/syscalls.list libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/syscalls.list
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/syscalls.list	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/syscalls.list	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1,20 @@
+# File name	Caller	Syscall name	Args	Strong name	Weak names
+
+lseek		-	lseek		i:iii	__libc_lseek	__lseek lseek __llseek llseek __libc_lseek64 __lseek64 lseek64
+
+# proper socket implementations:
+recvfrom	-	recvfrom	i:ibniBN __libc_recvfrom __recvfrom recvfrom __syscall_recvfrom
+sendto		-	sendto		i:ibnibn __libc_sendto	__sendto sendto __syscall_sendto
+
+# semaphore and shm system calls
+msgctl		-	msgctl		i:iip	__msgctl	msgctl
+msgget		-	msgget		i:ii	__msgget	msgget
+msgrcv		-	msgrcv		i:ibnii	__msgrcv	msgrcv
+msgsnd		-	msgsnd		i:ibni	__msgsnd	msgsnd
+shmat		-	shmat		i:ipi	__shmat		shmat
+shmctl		-	shmctl		i:iip	__shmctl	shmctl
+shmdt		-	shmdt		i:s	__shmdt		shmdt
+shmget		-	shmget		i:iii	__shmget	shmget
+semop		-	semop		i:ipi	__semop		semop
+semget		-	semget		i:iii	__semget	semget
+semctl		-	semctl		i:iiii	__semctl	semctl
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/umount.c libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/umount.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/mips64/umount.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/mips64/umount.c	2003-03-18 01:20:44.000000000 +0900
@@ -0,0 +1 @@
+#include <sysdeps/unix/sysv/linux/hppa/umount.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pread.c libc-20030708/sysdeps/unix/sysv/linux/mips/pread.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pread.c	2003-01-28 03:55:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/pread.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -42,7 +42,13 @@
 				off_t offset) internal_function;
 # endif
 extern ssize_t __syscall_pread (int fd, void *__unbounded buf, size_t count,
-				int dummy, off_t offset_hi, off_t offset_lo);
+				int dummy,
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+				off_t offset
+#else
+				off_t offset_hi, off_t offset_lo
+#endif
+				);
 
 
 
@@ -59,8 +65,13 @@
     {
      /* First try the syscall.  */
      assert (sizeof (offset) == 4);
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+     result = INLINE_SYSCALL (pread, 5, fd, CHECK_N (buf, count), count, 0,
+			      offset);
+#else
      result = INLINE_SYSCALL (pread, 6, fd, CHECK_N (buf, count), count, 0,
 			      __LONG_LONG_PAIR (offset >> 31, offset));
+#endif
 # if __ASSUME_PREAD_SYSCALL == 0
      if (result == -1 && errno == ENOSYS)
      /* No system call available.  Use the emulation.  */
@@ -73,8 +84,13 @@
 
   /* First try the syscall.  */
   assert (sizeof (offset) == 4);
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+  result = INLINE_SYSCALL (pread, 5, fd, CHECK_N (buf, count), count, 0,
+			   offset);
+#else
   result = INLINE_SYSCALL (pread, 6, fd, CHECK_N (buf, count), count, 0,
 			   __LONG_LONG_PAIR (offset >> 31, offset));
+#endif
 # if __ASSUME_PREAD_SYSCALL == 0
   if (result == -1 && errno == ENOSYS)
     /* No system call available.  Use the emulation.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pread64.c libc-20030708/sysdeps/unix/sysv/linux/mips/pread64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pread64.c	2003-01-28 03:55:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/pread64.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -42,7 +42,13 @@
 # endif
 
 extern ssize_t __syscall_pread (int fd, void *__unbounded buf, size_t count,
-				int dummy, off_t offset_hi, off_t offset_lo);
+				int dummy,
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+				off_t offset
+#else
+				off_t offset_hi, off_t offset_lo
+#endif
+				);
 
 
 
@@ -59,9 +65,14 @@
   if (SINGLE_THREAD_P)
     {
      /* First try the syscall.  */
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+      result = INLINE_SYSCALL (pread, 5, fd, CHECK_N (buf, count), count, 0,
+			       offset);
+#else
      result = INLINE_SYSCALL (pread, 6, fd, CHECK_N (buf, count), count, 0,
 			      __LONG_LONG_PAIR ((off_t) (offset >> 32),
 			      (off_t) (offset & 0xffffffff)));
+#endif
 # if __ASSUME_PREAD_SYSCALL == 0
      if (result == -1 && errno == ENOSYS)
      /* No system call available.  Use the emulation.  */
@@ -73,9 +84,14 @@
   int oldtype = LIBC_CANCEL_ASYNC ();
 
   /* First try the syscall.  */
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+  result = INLINE_SYSCALL (pread, 5, fd, CHECK_N (buf, count), count, 0,
+			   offset);
+#else
   result = INLINE_SYSCALL (pread, 6, fd, CHECK_N (buf, count), count, 0,
 			   __LONG_LONG_PAIR ((off_t) (offset >> 32),
 					     (off_t) (offset & 0xffffffff)));
+#endif
 # if __ASSUME_PREAD_SYSCALL == 0
   if (result == -1 && errno == ENOSYS)
     /* No system call available.  Use the emulation.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/profil-counter.h libc-20030708/sysdeps/unix/sysv/linux/mips/profil-counter.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/profil-counter.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/profil-counter.h	2003-04-13 20:36:32.000000000 +0900
@@ -0,0 +1,2 @@
+/* We can use the ix86 version.  */
+#include <sysdeps/unix/sysv/linux/i386/profil-counter.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/ptrace.c libc-20030708/sysdeps/unix/sysv/linux/mips/ptrace.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/ptrace.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/ptrace.c	2003-03-18 00:48:52.000000000 +0900
@@ -0,0 +1,112 @@
+/* Copyright (C) 1995, 1996, 1997, 1998, 2000, 2002, 2003
+	Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <sys/types.h>
+#include <sys/ptrace.h>
+#include <sys/user.h>
+#include <stdarg.h>
+
+#include <sysdep.h>
+#include <sys/syscall.h>
+#include <bp-checks.h>
+
+#if defined _ABIN32 && _MIPS_SIM == _ABIN32
+__extension__ typedef long long int reg_type;
+#else
+typedef long int reg_type;
+#endif
+
+extern reg_type __syscall_ptrace (int, pid_t, void *__unbounded,
+				  reg_type __unbounded);
+
+reg_type
+ptrace (enum __ptrace_request request, ...)
+{
+  reg_type res, ret;
+  va_list ap;
+  pid_t pid;
+  void *addr;
+  reg_type data;
+
+  va_start (ap, request);
+  pid = va_arg (ap, pid_t);
+  addr = va_arg (ap, void *);
+  data = va_arg (ap, reg_type);
+  va_end (ap);
+
+  if (request > 0 && request < 4)
+    data = &ret;
+
+#if __BOUNDED_POINTERS__
+  switch (request)
+    {
+    case PTRACE_PEEKTEXT:
+    case PTRACE_PEEKDATA:
+    case PTRACE_PEEKUSER:
+    case PTRACE_POKETEXT:
+    case PTRACE_POKEDATA:
+    case PTRACE_POKEUSER:
+      (void) CHECK_1 ((int *) addr);
+      (void) CHECK_1 ((int *) data);
+      break;
+
+    case PTRACE_GETREGS:
+    case PTRACE_SETREGS:
+      /* We don't know the size of data, so the best we can do is ensure
+	 that `data' is valid for at least one word.  */
+      (void) CHECK_1 ((int *) data);
+      break;
+
+    case PTRACE_GETFPREGS:
+    case PTRACE_SETFPREGS:
+      /* We don't know the size of data, so the best we can do is ensure
+	 that `data' is valid for at least one word.  */
+      (void) CHECK_1 ((int *) data);
+      break;
+
+    case PTRACE_GETFPXREGS:
+    case PTRACE_SETFPXREGS:
+      /* We don't know the size of data, so the best we can do is ensure
+	 that `data' is valid for at least one word.  */
+      (void) CHECK_1 ((int *) data);
+      break;
+
+    case PTRACE_TRACEME:
+    case PTRACE_CONT:
+    case PTRACE_KILL:
+    case PTRACE_SINGLESTEP:
+    case PTRACE_ATTACH:
+    case PTRACE_DETACH:
+    case PTRACE_SYSCALL:
+      /* Neither `data' nor `addr' needs any checks.  */
+      break;
+    };
+#endif
+
+  res = INLINE_SYSCALL (ptrace, 4, request, pid,
+			__ptrvalue (addr), __ptrvalue (data));
+  if (res >= 0 && request > 0 && request < 4)
+    {
+      __set_errno (0);
+      return ret;
+    }
+
+  return res;
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pwrite.c libc-20030708/sysdeps/unix/sysv/linux/mips/pwrite.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pwrite.c	2003-01-28 03:55:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/pwrite.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -38,7 +38,13 @@
 #if defined __NR_pwrite || __ASSUME_PWRITE_SYSCALL > 0
 
 extern ssize_t __syscall_pwrite (int fd, const void *__unbounded buf, size_t count,
-				 int dummy, off_t offset_hi, off_t offset_lo);
+				 int dummy,
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+				 off_t offset
+#else
+				 off_t offset_hi, off_t offset_lo
+#endif
+				 );
 
 # if __ASSUME_PWRITE_SYSCALL == 0
 static ssize_t __emulate_pwrite (int fd, const void *buf, size_t count,
@@ -58,8 +64,13 @@
     {
       /* First try the syscall.  */
      assert (sizeof (offset) == 4);
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+     result = INLINE_SYSCALL (pwrite, 5, fd, CHECK_N (buf, count), count, 0,
+			      offset);
+#else
      result = INLINE_SYSCALL (pwrite, 6, fd, CHECK_N (buf, count), count, 0,
-			   __LONG_LONG_PAIR (offset >> 31, offset));
+			      __LONG_LONG_PAIR (offset >> 31, offset));
+#endif
 # if __ASSUME_PWRITE_SYSCALL == 0
      if (result == -1 && errno == ENOSYS)
        /* No system call available.  Use the emulation.  */
@@ -73,8 +84,13 @@
 
   /* First try the syscall.  */
   assert (sizeof (offset) == 4);
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+  result = INLINE_SYSCALL (pwrite, 5, fd, CHECK_N (buf, count), count, 0,
+			   offset);
+#else
   result = INLINE_SYSCALL (pwrite, 6, fd, CHECK_N (buf, count), count, 0,
-		   __LONG_LONG_PAIR (offset >> 31, offset));
+			   __LONG_LONG_PAIR (offset >> 31, offset));
+#endif
 # if __ASSUME_PWRITE_SYSCALL == 0
   if (result == -1 && errno == ENOSYS)
     /* No system call available.  Use the emulation.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pwrite64.c libc-20030708/sysdeps/unix/sysv/linux/mips/pwrite64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/pwrite64.c	2003-01-28 03:55:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/pwrite64.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ralf Baechle <ralf@gnu.org>, 1998.
 
@@ -37,7 +37,13 @@
 #if defined __NR_pwrite || __ASSUME_PWRITE_SYSCALL > 0
 
 extern ssize_t __syscall_pwrite (int fd, const void *__unbounded buf, size_t count,
-				 int dummy, off_t offset_hi, off_t offset_lo);
+				 int dummy,
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+				 off_t offset
+#else
+				 off_t offset_hi, off_t offset_lo
+#endif
+				 );
 
 # if __ASSUME_PWRITE_SYSCALL == 0
 static ssize_t __emulate_pwrite64 (int fd, const void *buf, size_t count,
@@ -56,9 +62,14 @@
   if (SINGLE_THREAD_P)
     {
      /* First try the syscall.  */
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+      result = INLINE_SYSCALL (pwrite, 5, fd, CHECK_N (buf, count), count, 0,
+			       offset);
+#else
      result = INLINE_SYSCALL (pwrite, 6, fd, CHECK_N (buf, count), count, 0,
 			      __LONG_LONG_PAIR ((off_t) (offset >> 32),
 			     (off_t) (offset & 0xffffffff)));
+#endif
 # if __ASSUME_PWRITE_SYSCALL == 0
      if (result == -1 && errno == ENOSYS)
      /* No system call available.  Use the emulation.  */
@@ -71,9 +82,14 @@
   int oldtype = LIBC_CANCEL_ASYNC ();
 
   /* First try the syscall.  */
+#if defined _ABI64 && _MIPS_SIM == _ABI64
+  result = INLINE_SYSCALL (pwrite, 5, fd, CHECK_N (buf, count), count, 0,
+			   offset);
+#else
   result = INLINE_SYSCALL (pwrite, 6, fd, CHECK_N (buf, count), count, 0,
 			   __LONG_LONG_PAIR ((off_t) (offset >> 32),
 					     (off_t) (offset & 0xffffffff)));
+#endif
 # if __ASSUME_PWRITE_SYSCALL == 0
   if (result == -1 && errno == ENOSYS)
     /* No system call available.  Use the emulation.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/readelflib.c libc-20030708/sysdeps/unix/sysv/linux/mips/readelflib.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/readelflib.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/readelflib.c	2003-03-14 16:52:05.000000000 +0900
@@ -0,0 +1,71 @@
+/* Copyright (C) 1999, 2001, 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Alexandre Oliva <aoliva@redhat.com>
+   Based on work ../x86_64/readelflib.c,
+   contributed by Andreas Jaeger <aj@suse.de>, 1999 and
+		  Jakub Jelinek <jakub@redhat.com>, 1999.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+
+int process_elf32_file (const char *file_name, const char *lib, int *flag,
+			unsigned int *osversion, char **soname,
+			void *file_contents, size_t file_length);
+int process_elf64_file (const char *file_name, const char *lib, int *flag,
+			unsigned int *osversion, char **soname,
+			void *file_contents, size_t file_length);
+
+/* Returns 0 if everything is ok, != 0 in case of error.  */
+int
+process_elf_file (const char *file_name, const char *lib, int *flag,
+		  unsigned int *osversion, char **soname, void *file_contents,
+		  size_t file_length)
+{
+  ElfW(Ehdr) *elf_header = (ElfW(Ehdr) *) file_contents;
+  int ret;
+
+  if (elf_header->e_ident [EI_CLASS] == ELFCLASS32)
+    {
+      ret = process_elf32_file (file_name, lib, flag, osversion, soname,
+				file_contents, file_length);
+
+      /* n32 libraries are always libc.so.6+.  */
+      if (ret && (elf_header->e_flags & EF_MIPS_ABI2) != 0)
+	*flag = FLAG_MIPS64_LIBN32|FLAG_ELF_LIBC6;
+    }
+  else
+    {
+      ret = process_elf64_file (file_name, lib, flag, osversion, soname,
+				file_contents, file_length);
+      /* n64 libraries are always libc.so.6+.  */
+      if (!ret)
+	*flag = FLAG_MIPS64_LIBN64|FLAG_ELF_LIBC6;
+    }
+
+  return ret;
+}
+
+#undef __ELF_NATIVE_CLASS
+#undef process_elf_file
+#define process_elf_file process_elf32_file
+#define __ELF_NATIVE_CLASS 32
+#include "sysdeps/generic/readelflib.c"
+
+#undef __ELF_NATIVE_CLASS
+#undef process_elf_file
+#define process_elf_file process_elf64_file
+#define __ELF_NATIVE_CLASS 64
+#include "sysdeps/generic/readelflib.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sigaction.c libc-20030708/sysdeps/unix/sysv/linux/mips/sigaction.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sigaction.c	2003-01-03 08:26:04.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sigaction.c	2003-03-14 16:49:05.000000000 +0900
@@ -41,6 +41,15 @@
 extern int __syscall_rt_sigaction (int, const struct kernel_sigaction *__unbounded,
 				   struct kernel_sigaction *__unbounded, size_t);
 
+#if _MIPS_SIM != _MIPS_SIM_ABI32
+
+# ifdef __NR_rt_sigreturn
+static void restore_rt (void) asm ("__restore_rt");
+# endif
+# ifdef __NR_sigreturn
+static void restore (void) asm ("__restore");
+# endif
+#endif
 
 /* If ACT is not NULL, change the action for SIG to *ACT.
    If OACT is not NULL, put the old action for SIG in *OACT.  */
@@ -74,7 +83,11 @@
 	  memcpy (&kact.sa_mask, &act->sa_mask, sizeof (kernel_sigset_t));
 	  kact.sa_flags = act->sa_flags;
 # ifdef HAVE_SA_RESTORER
+#  if _MIPS_SIM == _MIPS_SIM_ABI32
 	  kact.sa_restorer = act->sa_restorer;
+#  else
+	  kact.sa_restorer = &restore_rt;
+#  endif
 # endif
 	}
 
@@ -128,7 +141,11 @@
       oact->sa_mask.__val[0] = k_osigact.sa_mask;
       oact->sa_flags = k_osigact.sa_flags;
 # ifdef HAVE_SA_RESTORER
+#  if _MIPS_SIM == _MIPS_SIM_ABI32
       oact->sa_restorer = k_osigact.sa_restorer;
+#  else
+      oact->sa_restorer = &restore;
+#  endif
 # endif
     }
   return result;
@@ -141,3 +158,31 @@
 libc_hidden_weak (__sigaction)
 weak_alias (__libc_sigaction, sigaction)
 #endif
+
+/* NOTE: Please think twice before making any changes to the bits of
+   code below.  GDB needs some intimate knowledge about it to
+   recognize them as signal trampolines, and make backtraces through
+   signal handlers work right.  Important are both the names
+   (__restore_rt) and the exact instruction sequence.
+   If you ever feel the need to make any changes, please notify the
+   appropriate GDB maintainer.  */
+
+#define RESTORE(name, syscall) RESTORE2 (name, syscall)
+#define RESTORE2(name, syscall) \
+asm						\
+  (						\
+   ".align 4\n"					\
+   "__" #name ":\n"				\
+   "	li $2, " #syscall "\n"			\
+   "	syscall\n"				\
+   );
+
+/* The return code for realtime-signals.  */
+#if _MIPS_SIM != _MIPS_SIM_ABI32
+# ifdef __NR_rt_sigreturn
+RESTORE (restore_rt, __NR_rt_sigreturn)
+# endif
+# ifdef __NR_sigreturn
+RESTORE (restore, __NR_sigreturn)
+# endif
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h libc-20030708/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h	2003-04-15 23:55:50.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 2000.
 
@@ -18,6 +18,8 @@
    02111-1307 USA.  */
 
 
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+
 #define SIGCONTEXT unsigned long _code, struct sigcontext *
 #define SIGCONTEXT_EXTRA_ARGS _code,
 #define GET_PC(ctx)	((void *) ctx->sc_pc)
@@ -25,3 +27,15 @@
 #define GET_STACK(ctx)	((void *) ctx->sc_regs[29])
 #define CALL_SIGHANDLER(handler, signo, ctx) \
   (handler)((signo), SIGCONTEXT_EXTRA_ARGS (ctx))
+
+#else
+
+#define SIGCONTEXT unsigned long _code, ucontext_t *
+#define SIGCONTEXT_EXTRA_ARGS _code,
+#define GET_PC(ctx)	((void *) ctx->uc_mcontext.pc)
+#define GET_FRAME(ctx)	((void *) ctx->uc_mcontext.gregs[30])
+#define GET_STACK(ctx)	((void *) ctx->uc_mcontext.gregs[29])
+#define CALL_SIGHANDLER(handler, signo, ctx) \
+  (handler)((signo), SIGCONTEXT_EXTRA_ARGS (ctx))
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/procfs.h libc-20030708/sysdeps/unix/sysv/linux/mips/sys/procfs.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/procfs.h	2002-02-09 10:19:07.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sys/procfs.h	2003-03-18 00:47:13.000000000 +0900
@@ -1,4 +1,5 @@
-/* Copyright (C) 1996, 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 1999, 2000, 2002, 2003
+	Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,7 +33,11 @@
 #define ELF_NGREG	45
 #define ELF_NFPREG	33
 
+#if defined _ABIN32 && _MIPS_SIM == _ABIN32
+__extension__ typedef unsigned long long elf_greg_t;
+#else
 typedef unsigned long elf_greg_t;
+#endif
 typedef elf_greg_t elf_gregset_t[ELF_NGREG];
 
 typedef double elf_fpreg_t;
@@ -59,8 +64,13 @@
   {
     struct elf_siginfo pr_info;		/* Info associated with signal.  */
     short int pr_cursig;		/* Current signal.  */
+#if defined _ABIN32 && _MIPS_SIM == _ABIN32
+    __extension__ unsigned long long int pr_sigpend;
+    __extension__ unsigned long long int pr_sighold;
+#else
     unsigned long int pr_sigpend;	/* Set of pending signals.  */
     unsigned long int pr_sighold;	/* Set of held signals.  */
+#endif
     __pid_t pr_pid;
     __pid_t pr_ppid;
     __pid_t pr_pgrp;
@@ -82,7 +92,11 @@
     char pr_sname;			/* Char for pr_state.  */
     char pr_zomb;			/* Zombie.  */
     char pr_nice;			/* Nice val.  */
+#if defined _ABIN32 && _MIPS_SIM == _ABIN32
+    __extension__ unsigned long long int pr_flag;
+#else
     unsigned long int pr_flag;		/* Flags.  */
+#endif
     long pr_uid;
     long pr_gid;
     int pr_pid, pr_ppid, pr_pgrp, pr_sid;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/ptrace.h libc-20030708/sysdeps/unix/sysv/linux/mips/sys/ptrace.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/ptrace.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sys/ptrace.h	2003-03-18 00:48:52.000000000 +0900
@@ -0,0 +1,135 @@
+/* `ptrace' debugger support interface.  Linux version.
+   Copyright (C) 1996, 1997, 1998, 1999, 2000, 2002, 2003
+	Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _SYS_PTRACE_H
+#define _SYS_PTRACE_H	1
+
+#include <features.h>
+
+__BEGIN_DECLS
+
+/* Type of the REQUEST argument to `ptrace.'  */
+enum __ptrace_request
+{
+  /* Indicate that the process making this request should be traced.
+     All signals received by this process can be intercepted by its
+     parent, and its parent can use the other `ptrace' requests.  */
+  PTRACE_TRACEME = 0,
+#define PT_TRACE_ME PTRACE_TRACEME
+
+  /* Return the word in the process's text space at address ADDR.  */
+  PTRACE_PEEKTEXT = 1,
+#define PT_READ_I PTRACE_PEEKTEXT
+
+  /* Return the word in the process's data space at address ADDR.  */
+  PTRACE_PEEKDATA = 2,
+#define PT_READ_D PTRACE_PEEKDATA
+
+  /* Return the word in the process's user area at offset ADDR.  */
+  PTRACE_PEEKUSER = 3,
+#define PT_READ_U PTRACE_PEEKUSER
+
+  /* Write the word DATA into the process's text space at address ADDR.  */
+  PTRACE_POKETEXT = 4,
+#define PT_WRITE_I PTRACE_POKETEXT
+
+  /* Write the word DATA into the process's data space at address ADDR.  */
+  PTRACE_POKEDATA = 5,
+#define PT_WRITE_D PTRACE_POKEDATA
+
+  /* Write the word DATA into the process's user area at offset ADDR.  */
+  PTRACE_POKEUSER = 6,
+#define PT_WRITE_U PTRACE_POKEUSER
+
+  /* Continue the process.  */
+  PTRACE_CONT = 7,
+#define PT_CONTINUE PTRACE_CONT
+
+  /* Kill the process.  */
+  PTRACE_KILL = 8,
+#define PT_KILL PTRACE_KILL
+
+  /* Single step the process.
+     This is not supported on all machines.  */
+  PTRACE_SINGLESTEP = 9,
+#define PT_STEP PTRACE_SINGLESTEP
+
+  /* Get all general purpose registers used by a processes.
+     This is not supported on all machines.  */
+   PTRACE_GETREGS = 12,
+#define PT_GETREGS PTRACE_GETREGS
+
+  /* Set all general purpose registers used by a processes.
+     This is not supported on all machines.  */
+   PTRACE_SETREGS = 13,
+#define PT_SETREGS PTRACE_SETREGS
+
+  /* Get all floating point registers used by a processes.
+     This is not supported on all machines.  */
+   PTRACE_GETFPREGS = 14,
+#define PT_GETFPREGS PTRACE_GETFPREGS
+
+  /* Set all floating point registers used by a processes.
+     This is not supported on all machines.  */
+   PTRACE_SETFPREGS = 15,
+#define PT_SETFPREGS PTRACE_SETFPREGS
+
+  /* Attach to a process that is already running. */
+  PTRACE_ATTACH = 16,
+#define PT_ATTACH PTRACE_ATTACH
+
+  /* Detach from a process attached to with PTRACE_ATTACH.  */
+  PTRACE_DETACH = 17,
+#define PT_DETACH PTRACE_DETACH
+
+  /* Get all extended floating point registers used by a processes.
+     This is not supported on all machines.  */
+   PTRACE_GETFPXREGS = 18,
+#define PT_GETFPXREGS PTRACE_GETFPXREGS
+
+  /* Set all extended floating point registers used by a processes.
+     This is not supported on all machines.  */
+   PTRACE_SETFPXREGS = 19,
+#define PT_SETFPXREGS PTRACE_SETFPXREGS
+
+  /* Continue and stop at the next (return from) syscall.  */
+  PTRACE_SYSCALL = 24
+#define PT_SYSCALL PTRACE_SYSCALL
+};
+
+/* Perform process tracing functions.  REQUEST is one of the values
+   above, and determines the action to be taken.
+   For all requests except PTRACE_TRACEME, PID specifies the process to be
+   traced.
+
+   PID and the other arguments described above for the various requests should
+   appear (those that are used for the particular request) as:
+     pid_t PID, void *ADDR, int DATA, void *ADDR2
+   after REQUEST.  */
+#if defined _ABIN32 && _MIPS_SIM == _ABIN32
+__extension__ extern long long int ptrace
+  (enum __ptrace_request __request, ...) __THROW;
+#else
+extern long int ptrace (enum __ptrace_request __request, ...) __THROW;
+#endif
+
+__END_DECLS
+
+#endif /* _SYS_PTRACE_H */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/syscall.h libc-20030708/sysdeps/unix/sysv/linux/mips/sys/syscall.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/syscall.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sys/syscall.h	2003-03-18 00:50:05.000000000 +0900
@@ -0,0 +1,42 @@
+/* Copyright (C) 1995, 1996, 1997, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _SYSCALL_H
+#define _SYSCALL_H	1
+
+/* This file should list the numbers of the system the system knows.
+   But instead of duplicating this we use the information available
+   from the kernel sources.  */
+#ifdef _LIBC
+/* Since the kernel doesn't define macro names in a way usable for
+   glibc, we preprocess this header, and use it during the glibc build
+   process.  */
+# include <asm-unistd.h>
+#else
+# include <asm/unistd.h>
+#endif
+
+#ifndef _LIBC
+/* The Linux kernel header file defines macros `__NR_<name>', but some
+   programs expect the traditional form `SYS_<name>'.  So in building libc
+   we scan the kernel's list and produce <bits/syscall.h> with macros for
+   all the `SYS_' names.  */
+# include <bits/syscall.h>
+#endif
+
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/tas.h libc-20030708/sysdeps/unix/sysv/linux/mips/sys/tas.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/tas.h	2002-07-16 09:52:17.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sys/tas.h	2003-03-14 16:03:36.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Maciej W. Rozycki <macro@ds2.pg.gda.pl>, 2000.
 
@@ -41,7 +41,9 @@
     ("/* Inline test and set */\n"
      "1:\n\t"
      ".set	push\n\t"
+#if _MIPS_SIM == _MIPS_SIM_ABI32
      ".set	mips2\n\t"
+#endif
      "ll	%0,%3\n\t"
      "move	%1,%4\n\t"
      "beq	%0,%4,2f\n\t"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/ucontext.h libc-20030708/sysdeps/unix/sysv/linux/mips/sys/ucontext.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/ucontext.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sys/ucontext.h	2003-05-02 00:11:52.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -29,43 +29,72 @@
 #include <bits/sigcontext.h>
 
 
-/* Type for general register.  */
-typedef unsigned long int greg_t;
+/* Type for general register.  Even in o32 we assume 64-bit registers,
+   like the kernel.  */
+__extension__ typedef unsigned long long int greg_t;
 
 /* Number of general registers.  */
-#define NGREG	37
-#define NFPREG	33
+#define NGREG	32
+#define NFPREG	32
 
 /* Container for all general registers.  */
-/* gregset_t must be an array.  The below declared array corresponds to:
-typedef struct gregset {
-	greg_t	g_regs[32];
-	greg_t	g_hi;
-	greg_t	g_lo;
-	greg_t	g_pad[3];
-} gregset_t;  */
 typedef greg_t gregset_t[NGREG];
 
 /* Container for all FPU registers.  */
 typedef struct fpregset {
 	union {
-		double	fp_dregs[32];
+		double	fp_dregs[NFPREG];
 		struct {
 			float		_fp_fregs;
 			unsigned int	_fp_pad;
-		} fp_fregs[32];
+		} fp_fregs[NFPREG];
 	} fp_r;
-	unsigned int	fp_csr;
-	unsigned int	fp_pad;
 } fpregset_t;
 
 
 /* Context to describe whole processor state.  */
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+/* Earlier versions of glibc for mips had an entirely different
+   definition of mcontext_t, that didn't even resemble the
+   corresponding kernel data structure.  Since all legitimate uses of
+   ucontext_t in glibc mustn't have accessed anything beyond
+   uc_mcontext and, even then, taking a pointer to it, casting it to
+   sigcontext_t, and accessing it as such, which is what it has always
+   been, this can still be rectified.  Fortunately, makecontext,
+   [gs]etcontext et all have never been implemented.  */
 typedef struct
   {
+    unsigned int regmask;
+    unsigned int status;
+    greg_t pc;
     gregset_t gregs;
     fpregset_t fpregs;
+    unsigned int fp_owned;
+    unsigned int fpc_csr;
+    unsigned int fpc_eir;
+    unsigned int used_math;
+    unsigned int ssflags;
+    greg_t mdhi;
+    greg_t mdlo;
+    unsigned int cause;
+    unsigned int badvaddr;
   } mcontext_t;
+#else
+typedef struct
+  {
+    gregset_t gregs;
+    fpregset_t fpregs;
+    greg_t mdhi;
+    greg_t mdlo;
+    greg_t pc;
+    unsigned int status;
+    unsigned int fpc_csr;
+    unsigned int fpc_eir;
+    unsigned int used_math;
+    unsigned int cause;
+    unsigned int badvaddr;
+  } mcontext_t;
+#endif
 
 /* Userlevel context.  */
 typedef struct ucontext
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/user.h libc-20030708/sysdeps/unix/sysv/linux/mips/sys/user.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sys/user.h	2002-02-09 01:21:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sys/user.h	2003-04-15 23:55:50.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -23,7 +23,154 @@
    too much into it.  Don't use it for anything other than GDB unless
    you know what you are doing.  */
 
-#include <asm/reg.h>
+/* #include <asm/reg.h> */
+/* Instead of including the kernel header, that will vary depending on
+   whether the 32- or the 64-bit kernel is installed, we paste its
+   contents here.  Note that the fact that the file is inline here,
+   instead of included separately, doesn't change in any way the
+   licensing status of a program that includes user.h.  Since this is
+   for gdb alone, and gdb is GPLed, no surprises here.  */
+#if _MIPS_SIM == _MIPS_SIM_ABI32
+/*
+ * Various register offset definitions for debuggers, core file
+ * examiners and whatnot.
+ *
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License.  See the file "COPYING" in the main directory of this archive
+ * for more details.
+ *
+ * Copyright (C) 1995, 1999 by Ralf Baechle
+ */
+#ifndef __ASM_MIPS_REG_H
+#define __ASM_MIPS_REG_H
+
+/*
+ * This defines/structures correspond to the register layout on stack -
+ * if the order here is changed, it needs to be updated in
+ * include/asm-mips/stackframe.h
+ */
+#define EF_REG0			6
+#define EF_REG1			7
+#define EF_REG2			8
+#define EF_REG3			9
+#define EF_REG4			10
+#define EF_REG5			11
+#define EF_REG6			12
+#define EF_REG7			13
+#define EF_REG8			14
+#define EF_REG9			15
+#define EF_REG10		16
+#define EF_REG11		17
+#define EF_REG12		18
+#define EF_REG13		19
+#define EF_REG14		20
+#define EF_REG15		21
+#define EF_REG16		22
+#define EF_REG17		23
+#define EF_REG18		24
+#define EF_REG19		25
+#define EF_REG20		26
+#define EF_REG21		27
+#define EF_REG22		28
+#define EF_REG23		29
+#define EF_REG24		30
+#define EF_REG25		31
+/*
+ * k0/k1 unsaved
+ */
+#define EF_REG28		34
+#define EF_REG29		35
+#define EF_REG30		36
+#define EF_REG31		37
+
+/*
+ * Saved special registers
+ */
+#define EF_LO			38
+#define EF_HI			39
+
+#define EF_CP0_EPC		40
+#define EF_CP0_BADVADDR		41
+#define EF_CP0_STATUS		42
+#define EF_CP0_CAUSE		43
+
+#define EF_SIZE			180	/* size in bytes */
+
+#endif /* __ASM_MIPS_REG_H */
+
+#else /* _MIPS_SIM != _MIPS_SIM_ABI32 */
+
+/*
+ * Various register offset definitions for debuggers, core file
+ * examiners and whatnot.
+ *
+ * This file is subject to the terms and conditions of the GNU General Public
+ * License.  See the file "COPYING" in the main directory of this archive
+ * for more details.
+ *
+ * Copyright (C) 1995, 1999 Ralf Baechle
+ * Copyright (C) 1995, 1999 Silicon Graphics
+ */
+#ifndef _ASM_REG_H
+#define _ASM_REG_H
+
+/*
+ * This defines/structures correspond to the register layout on stack -
+ * if the order here is changed, it needs to be updated in
+ * include/asm-mips/stackframe.h
+ */
+#define EF_REG0			 0
+#define EF_REG1			 1
+#define EF_REG2			 2
+#define EF_REG3			 3
+#define EF_REG4			 4
+#define EF_REG5			 5
+#define EF_REG6			 6
+#define EF_REG7			 7
+#define EF_REG8			 8
+#define EF_REG9			 9
+#define EF_REG10		10
+#define EF_REG11		11
+#define EF_REG12		12
+#define EF_REG13		13
+#define EF_REG14		14
+#define EF_REG15		15
+#define EF_REG16		16
+#define EF_REG17		17
+#define EF_REG18		18
+#define EF_REG19		19
+#define EF_REG20		20
+#define EF_REG21		21
+#define EF_REG22		22
+#define EF_REG23		23
+#define EF_REG24		24
+#define EF_REG25		25
+/*
+ * k0/k1 unsaved
+ */
+#define EF_REG28		28
+#define EF_REG29		29
+#define EF_REG30		30
+#define EF_REG31		31
+
+/*
+ * Saved special registers
+ */
+#define EF_LO			32
+#define EF_HI			33
+
+#define EF_CP0_EPC		34
+#define EF_CP0_BADVADDR		35
+#define EF_CP0_STATUS		36
+#define EF_CP0_CAUSE		37
+
+#define EF_SIZE			304	/* size in bytes */
+
+#endif /* _ASM_REG_H */
+
+#endif /* _MIPS_SIM != _MIPS_SIM_ABI32 */
+
+#if _MIPS_SIM == _MIPS_SIM_ABI32
 
 struct user
 {
@@ -40,6 +187,24 @@
   char		u_comm[32];		/* user command name */
 };
 
+#else
+
+struct user {
+  __extension__ unsigned long	regs[EF_SIZE/8+64]; /* integer and fp regs */
+  __extension__ unsigned long	u_tsize;	/* text size (pages) */
+  __extension__ unsigned long	u_dsize;	/* data size (pages) */
+  __extension__ unsigned long	u_ssize;	/* stack size (pages) */
+  __extension__ unsigned long long start_code;	/* text starting address */
+  __extension__ unsigned long long start_data;	/* data starting address */
+  __extension__ unsigned long long start_stack;	/* stack starting address */
+  __extension__ long long	signal;		/* signal causing core dump */
+  __extension__ unsigned long long u_ar0;	/* help gdb find registers */
+  __extension__ unsigned long long magic;	/* identifies a core file */
+  char		u_comm[32];		/* user command name */
+};
+
+#endif
+
 #define PAGE_SHIFT		12
 #define PAGE_SIZE		(1UL << PAGE_SHIFT)
 #define PAGE_MASK		(~(PAGE_SIZE-1))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/syscalls.list libc-20030708/sysdeps/unix/sysv/linux/mips/syscalls.list
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/syscalls.list	2003-01-31 12:39:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/syscalls.list	2003-03-07 18:46:27.000000000 +0900
@@ -32,14 +32,6 @@
 socket		-	socket		i:iii	__socket	socket
 socketpair	-	socketpair	i:iiif	__socketpair	socketpair
 
-#
-# These are defined locally because the caller is also defined in this dir.
-#
-s_llseek	llseek	_llseek		i:iiipi	__syscall__llseek
-s_sigaction	sigaction sigaction	i:ipp	__syscall_sigaction
-s_ustat		ustat	ustat		i:ip	__syscall_ustat
-sys_mknod	xmknod	mknod		i:sii	__syscall_mknod
-
 # System calls with wrappers.
 rt_sigaction	-	rt_sigaction	i:ippi	__syscall_rt_sigaction
 rt_sigpending	-	rt_sigpending	i:pi	__syscall_rt_sigpending
@@ -47,35 +39,3 @@
 rt_sigqueueinfo	-	rt_sigqueueinfo	i:iip	__syscall_rt_sigqueueinfo
 rt_sigsuspend	-	rt_sigsuspend	i:pi	__syscall_rt_sigsuspend
 rt_sigtimedwait	-	rt_sigtimedwait	i:pppi	__syscall_rt_sigtimedwait
-s_execve	EXTRA	execve		i:spp	__syscall_execve
-s_exit		_exit	exit		i:i	__syscall_exit
-s_fcntl		fcntl	fcntl		i:iiF	__syscall_fcntl
-s_fcntl64	fcntl64	fcntl64		i:iiF	__syscall_fcntl64
-s_fstat64	fxstat64 fstat64	i:ip	__syscall_fstat64
-s_ftruncate64	ftruncate64 ftruncate64	i:iiii	__syscall_ftruncate64
-s_getcwd	getcwd	getcwd		i:pi	__syscall_getcwd
-s_getdents	getdents getdents	i:ipi	__syscall_getdents
-s_getdents64	getdents getdents64	i:ipi	__syscall_getdents64
-s_getpriority	getpriority getpriority	i:ii	__syscall_getpriority
-s_ipc		msgget	ipc		i:iiiip	__syscall_ipc
-s_lstat64	lxstat64 lstat64	i:sp	__syscall_lstat64
-s_mmap2		mmap64	mmap2		b:aniiii __syscall_mmap2
-s_poll		poll	poll		i:pii	__syscall_poll
-s_pread64	pread64	pread		i:ibniii __syscall_pread
-s_ptrace	ptrace	ptrace		i:iipp	__syscall_ptrace
-s_pwrite64	pwrite64 pwrite		i:ibniii __syscall_pwrite
-s_readahead	EXTRA	readahead	i:iiii	__syscall_readahead
-s_reboot	reboot	reboot		i:iii	__syscall_reboot
-s_setrlimit	setrlimit setrlimit	i:ip	__syscall_setrlimit
-s_sigpending	sigpending sigpending	i:p	__syscall_sigpending
-s_sigprocmask	sigprocmask sigprocmask	i:ipp	__syscall_sigprocmask
-s_stat64	xstat64  stat64		i:sp	__syscall_stat64
-s_truncate64	truncate64 truncate64	i:siii	__syscall_truncate64
-
-# Todo: we can pass 6 args in registers, no need for the wrapper
-sys_sysctl	sysctl	_sysctl		i:p	__syscall__sysctl
-sys_fstat	fxstat	fstat		i:ip	__syscall_fstat
-sys_lstat	lxstat	lstat		i:sp	__syscall_lstat
-sys_readv	readv	readv		i:ipi	__syscall_readv
-sys_stat	xstat	stat		i:sp	__syscall_stat
-sys_writev	writev	writev		i:ipi	__syscall_writev
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/mips/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/sysdep.h	2003-01-28 03:55:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/sysdep.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,282 +0,0 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _LINUX_MIPS_SYSDEP_H
-#define _LINUX_MIPS_SYSDEP_H 1
-
-/* There is some commonality.  */
-#include <sysdeps/unix/mips/sysdep.h>
-
-/* For Linux we can use the system call table in the header file
-	/usr/include/asm/unistd.h
-   of the kernel.  But these symbols do not follow the SYS_* syntax
-   so we have to redefine the `SYS_ify' macro here.  */
-#undef SYS_ify
-#ifdef __STDC__
-# define SYS_ify(syscall_name)	__NR_##syscall_name
-#else
-# define SYS_ify(syscall_name)	__NR_/**/syscall_name
-#endif
-
-#ifdef __ASSEMBLER__
-
-/* We don't want the label for the error handler to be visible in the symbol
-   table when we define it here.  */
-#ifdef __PIC__
-# define SYSCALL_ERROR_LABEL 99b
-#endif
-
-#else   /* ! __ASSEMBLER__ */
-
-/* Define a macro which expands into the inline wrapper code for a system
-   call.  */
-#undef INLINE_SYSCALL
-#define INLINE_SYSCALL(name, nr, args...)                               \
-  ({ INTERNAL_SYSCALL_DECL(err);					\
-     long result_var = INTERNAL_SYSCALL (name, err, nr, args);      	\
-     if ( INTERNAL_SYSCALL_ERROR_P (result_var, err) )  		\
-       {                                                                \
-         __set_errno (INTERNAL_SYSCALL_ERRNO (result_var, err));      	\
-         result_var = -1L;                               		\
-       }                                                                \
-     result_var; })
-
-#undef INTERNAL_SYSCALL_DECL
-#define INTERNAL_SYSCALL_DECL(err) long err
-
-#undef INTERNAL_SYSCALL_ERROR_P
-#define INTERNAL_SYSCALL_ERROR_P(val, err)   ((long) (err))
-
-#undef INTERNAL_SYSCALL_ERRNO
-#define INTERNAL_SYSCALL_ERRNO(val, err)     (val)
-
-#undef INTERNAL_SYSCALL
-#define INTERNAL_SYSCALL(name, err, nr, args...) internal_syscall##nr(name, err, args)
-
-#define internal_syscall0(name, err, dummy...) 				\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a3 asm("$7"); 					\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"li\t$2, %2\t\t\t# " #name "\n\t"				\
-	"syscall\n\t" 							\
-	".set reorder" 							\
-	: "=r" (__v0), "=r" (__a3) 					\
-	: "i" (SYS_ify(name))						\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define internal_syscall1(name, err, arg1) 				\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a0 asm("$4") = (long) arg1; 			\
-	register long __a3 asm("$7"); 					\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"li\t$2, %3\t\t\t# " #name "\n\t"				\
-	"syscall\n\t" 							\
-	".set reorder" 							\
-	: "=r" (__v0), "=r" (__a3) 					\
-	: "r" (__a0), "i" (SYS_ify(name)) 				\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define internal_syscall2(name, err, arg1, arg2) 			\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a0 asm("$4") = (long) arg1; 			\
-	register long __a1 asm("$5") = (long) arg2; 			\
-	register long __a3 asm("$7"); 					\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"li\t$2, %4\t\t\t# " #name "\n\t" 				\
-	"syscall\n\t" 							\
-	".set\treorder" 						\
-	: "=r" (__v0), "=r" (__a3) 					\
-	: "r" (__a0), "r" (__a1), "i" (SYS_ify(name))			\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define internal_syscall3(name, err, arg1, arg2, arg3) 			\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a0 asm("$4") = (long) arg1; 			\
-	register long __a1 asm("$5") = (long) arg2; 			\
-	register long __a2 asm("$6") = (long) arg3; 			\
-	register long __a3 asm("$7"); 					\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
-	"syscall\n\t" 							\
-	".set\treorder" 						\
-	: "=r" (__v0), "=r" (__a3) 					\
-	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define internal_syscall4(name, err, arg1, arg2, arg3, arg4) 		\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a0 asm("$4") = (long) arg1; 			\
-	register long __a1 asm("$5") = (long) arg2; 			\
-	register long __a2 asm("$6") = (long) arg3; 			\
-	register long __a3 asm("$7") = (long) arg4; 			\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
-	"syscall\n\t" 							\
-	".set\treorder" 						\
-	: "=r" (__v0), "+r" (__a3) 					\
-	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)) 	\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define internal_syscall5(name, err, arg1, arg2, arg3, arg4, arg5) 	\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a0 asm("$4") = (long) arg1; 			\
-	register long __a1 asm("$5") = (long) arg2; 			\
-	register long __a2 asm("$6") = (long) arg3; 			\
-	register long __a3 asm("$7") = (long) arg4; 			\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"lw\t$2, %6\n\t" 						\
-	"subu\t$29, 32\n\t" 						\
-	"sw\t$2, 16($29)\n\t" 						\
-	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
-	"syscall\n\t" 							\
-	"addiu\t$29, 32\n\t" 						\
-	".set\treorder" 						\
-	: "=r" (__v0), "+r" (__a3) 					\
-	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
-	  "m" ((long)arg5) 						\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define internal_syscall6(name, err, arg1, arg2, arg3, arg4, arg5, arg6)\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a0 asm("$4") = (long) arg1; 			\
-	register long __a1 asm("$5") = (long) arg2; 			\
-	register long __a2 asm("$6") = (long) arg3; 			\
-	register long __a3 asm("$7") = (long) arg4; 			\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"lw\t$2, %6\n\t" 						\
-	"lw\t$8, %7\n\t" 						\
-	"subu\t$29, 32\n\t" 						\
-	"sw\t$2, 16($29)\n\t" 						\
-	"sw\t$8, 20($29)\n\t" 						\
-	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
-	"syscall\n\t" 							\
-	"addiu\t$29, 32\n\t" 						\
-	".set\treorder" 						\
-	: "=r" (__v0), "+r" (__a3) 					\
-	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
-	  "m" ((long)arg5), "m" ((long)arg6)				\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define internal_syscall7(name, err, arg1, arg2, arg3, arg4, arg5, arg6, arg7)\
-({ 									\
-	long _sys_result;						\
-									\
-	{								\
-	register long __v0 asm("$2"); 					\
-	register long __a0 asm("$4") = (long) arg1; 			\
-	register long __a1 asm("$5") = (long) arg2; 			\
-	register long __a2 asm("$6") = (long) arg3; 			\
-	register long __a3 asm("$7") = (long) arg4; 			\
-	__asm__ volatile ( 						\
-	".set\tnoreorder\n\t" 						\
-	"lw\t$2, %6\n\t" 						\
-	"lw\t$8, %7\n\t" 						\
-	"lw\t$9, %8\n\t" 						\
-	"subu\t$29, 32\n\t" 						\
-	"sw\t$2, 16($29)\n\t" 						\
-	"sw\t$8, 20($29)\n\t" 						\
-	"sw\t$9, 24($29)\n\t" 						\
-	"li\t$2, %5\t\t\t# " #name "\n\t" 				\
-	"syscall\n\t" 							\
-	"addiu\t$29, 32\n\t" 						\
-	".set\treorder" 						\
-	: "=r" (__v0), "+r" (__a3) 					\
-	: "r" (__a0), "r" (__a1), "r" (__a2), "i" (SYS_ify(name)), 	\
-	  "m" ((long)arg5), "m" ((long)arg6), "m" ((long)arg7)		\
-	: __SYSCALL_CLOBBERS); 						\
-	err = __a3;							\
-	_sys_result = __v0;						\
-	}								\
-	_sys_result;							\
-})
-
-#define __SYSCALL_CLOBBERS "$1", "$3", "$8", "$9", "$10", "$11", "$12", "$13", "$14", "$15", "$24", "$25"
-
-#endif /* __ASSEMBLER__ */
-
-#endif /* linux/mips/sysdep.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/mips/xstatconv.c libc-20030708/sysdeps/unix/sysv/linux/mips/xstatconv.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/mips/xstatconv.c	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/mips/xstatconv.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Convert between the kernel's `struct stat' format, and libc's.
-   Copyright (C) 1991,1995,1996,1997,1998,2000 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995,1996,1997,1998,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,11 +17,22 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <errno.h>
+#include <sys/stat.h>
+#include <kernel_stat.h>
+
+#ifdef STAT_IS_KERNEL_STAT
+
+/* Dummy.  */
+struct kernel_stat;
+
+#else
+
 #include <string.h>
 
 
-static inline int
-xstat_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
+int
+__xstat_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
 {
   switch (vers)
     {
@@ -70,8 +81,8 @@
   return 0;
 }
 
-static inline int
-xstat64_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
+int
+__xstat64_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
 {
 #ifdef XSTAT_IS_XSTAT64
   return xstat_conv (vers, kbuf, ubuf);
@@ -118,3 +129,5 @@
   return 0;
 #endif
 }
+
+#endif /* ! STAT_IS_KERNEL_STAT */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/net/if_arp.h libc-20030708/sysdeps/unix/sysv/linux/net/if_arp.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/net/if_arp.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/net/if_arp.h	2003-07-08 22:58:15.000000000 +0900
@@ -83,6 +83,9 @@
 #define	ARPHRD_DLCI	15		/* Frame Relay DLCI.  */
 #define	ARPHRD_ATM	19		/* ATM.  */
 #define	ARPHRD_METRICOM	23		/* Metricom STRIP (new IANA id).  */
+#define ARPHRD_IEEE1394	24		/* IEEE 1394 IPv4 - RFC 2734.  */
+#define ARPHRD_EUI64		27		/* EUI-64.  */
+#define ARPHRD_INFINIBAND	32		/* InfiniBand.  */
 
 /* Dummy types for non ARP hardware */
 #define ARPHRD_SLIP	256
@@ -120,7 +123,7 @@
 #define ARPHRD_FCPP	784		/* Point to point fibrechanel.  */
 #define ARPHRD_FCAL	785		/* Fibrechanel arbitrated loop.  */
 #define ARPHRD_FCPL	786		/* Fibrechanel public loop.  */
-#define ARPHRD_FCPFABRIC 787		/* Fibrechanel fabric.  */
+#define ARPHRD_FCFABRIC 787		/* Fibrechanel fabric.  */
 #define ARPHRD_IEEE802_TR 800		/* Magic type ident for TR.  */
 #define ARPHRD_IEEE80211 801		/* IEEE 802.11.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/netinet/igmp.h libc-20030708/sysdeps/unix/sysv/linux/netinet/igmp.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/netinet/igmp.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/netinet/igmp.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,89 +0,0 @@
-/* Copyright (C) 1997, 1999 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _NETINET_IGMP_H
-#define	_NETINET_IGMP_H 1
-
-#include <sys/cdefs.h>
-#include <sys/types.h>
-
-#include <asm/types.h>
-#include <linux/igmp.h>
-
-#ifdef __USE_BSD
-
-#include <netinet/in.h>
-
-__BEGIN_DECLS
-
-/*
- * Copyright (c) 1988 Stephen Deering.
- * Copyright (c) 1992, 1993
- *	The Regents of the University of California.  All rights reserved.
- *
- * This code is derived from software contributed to Berkeley by
- * Stephen Deering of Stanford University.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- * 1. Redistributions of source code must retain the above copyright
- *    notice, this list of conditions and the following disclaimer.
- * 2. Redistributions in binary form must reproduce the above copyright
- *    notice, this list of conditions and the following disclaimer in the
- *    documentation and/or other materials provided with the distribution.
- * 4. Neither the name of the University nor the names of its contributors
- *    may be used to endorse or promote products derived from this software
- *    without specific prior written permission.
- *
- * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
- * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
- * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
- * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
- * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
- * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
- * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
- * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
- * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
- * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- *
- *	@(#)igmp.h	8.1 (Berkeley) 6/10/93
- *	$FreeBSD$
- */
-
-struct igmp {
-  u_int8_t igmp_type;             /* IGMP type */
-  u_int8_t igmp_code;             /* routing code */
-  u_int16_t igmp_cksum;           /* checksum */
-  struct in_addr igmp_group;      /* group address */
-};
-
-/*
- * Message types, including version number.
- */
-#define IGMP_MEMBERSHIP_QUERY   	0x11	/* membership query         */
-#define IGMP_V1_MEMBERSHIP_REPORT	0x12	/* Ver. 1 membership report */
-#define IGMP_V2_MEMBERSHIP_REPORT	0x16	/* Ver. 2 membership report */
-#define IGMP_V2_LEAVE_GROUP		0x17	/* Leave-group message	    */
-
-__END_DECLS
-
-#endif
-
-#endif	/* netinet/igmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/not-cancel.h libc-20030708/sysdeps/unix/sysv/linux/not-cancel.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/not-cancel.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/not-cancel.h	2003-04-23 10:54:03.000000000 +0900
@@ -0,0 +1,53 @@
+/* Uncancelable versions of cancelable interfaces.  Linux version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+/* Uncancelable open.  */
+#ifdef INLINE_SYSCALL
+# define open_not_cancel(name, flags, mode) \
+   INLINE_SYSCALL (open, 3, (const char *) (name), (flags), (mode))
+#endif
+
+/* Uncancelable close.  */
+#ifdef INLINE_SYSCALL
+# define close_not_cancel_no_status(fd) \
+  (void) ({ INTERNAL_SYSCALL_DECL (err);				      \
+	    INTERNAL_SYSCALL (close, err, 1, (fd)); })
+#endif
+
+/* Uncancelable read.  */
+#ifdef INLINE_SYSCALL
+# define read_not_cancel(fd, buf, n) \
+  INLINE_SYSCALL (read, 3, (fd), (buf), (n))
+#endif
+
+/* Uncancelable write.  */
+#ifdef INLINE_SYSCALL
+# define write_not_cancel(fd, buf, n) \
+  INLINE_SYSCALL (write, 3, (fd), (buf), (n))
+#endif
+
+/* Uncancelable writev.  */
+#ifdef INLINE_SYSCALL
+# define writev_not_cancel_no_status(fd, iov, n) \
+  (void) ({ INTERNAL_SYSCALL_DECL (err);				      \
+	    INTERNAL_SYSCALL (writev, err, 3, (fd), (iov), (n)); })
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/pathconf.c libc-20030708/sysdeps/unix/sysv/linux/pathconf.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/pathconf.c	2002-10-23 15:21:19.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/pathconf.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Get file-specific information about a file.  Linux version.
-   Copyright (C) 1991,95,96,98,99,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995,1996,1998-2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,7 +17,10 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <unistd.h>
+#include <errno.h>
 #include "pathconf.h"
+#include "linux_fsinfo.h"
 
 static long int posix_pathconf (const char *file, int name);
 
@@ -35,10 +38,143 @@
   switch (name)
     {
     case _PC_LINK_MAX:
-      return statfs_link_max (__statfs (file, &fsbuf), &fsbuf);
+      return __statfs_link_max (__statfs (file, &fsbuf), &fsbuf);
+
     case _PC_FILESIZEBITS:
-      return statfs_filesize_max (__statfs (file, &fsbuf), &fsbuf);
+      return __statfs_filesize_max (__statfs (file, &fsbuf), &fsbuf);
+
+    case _PC_2_SYMLINKS:
+      return __statfs_symlinks (__statfs (file, &fsbuf), &fsbuf);
+
     default:
       return posix_pathconf (file, name);
     }
 }
+
+
+/* Used like: return statfs_link_max (__statfs (name, &buf), &buf); */
+long int
+__statfs_link_max (int result, const struct statfs *fsbuf)
+{
+  if (result < 0)
+    {
+      if (errno == ENOSYS)
+	/* Not possible, return the default value.  */
+	return LINUX_LINK_MAX;
+
+      /* Some error occured.  */
+      return -1;
+    }
+
+  switch (fsbuf->f_type)
+    {
+    case EXT2_SUPER_MAGIC:
+      return EXT2_LINK_MAX;
+
+    case MINIX_SUPER_MAGIC:
+    case MINIX_SUPER_MAGIC2:
+      return MINIX_LINK_MAX;
+
+    case MINIX2_SUPER_MAGIC:
+    case MINIX2_SUPER_MAGIC2:
+      return MINIX2_LINK_MAX;
+
+    case XENIX_SUPER_MAGIC:
+      return XENIX_LINK_MAX;
+
+    case SYSV4_SUPER_MAGIC:
+    case SYSV2_SUPER_MAGIC:
+      return SYSV_LINK_MAX;
+
+    case COH_SUPER_MAGIC:
+      return COH_LINK_MAX;
+
+    case UFS_MAGIC:
+    case UFS_CIGAM:
+      return UFS_LINK_MAX;
+
+    case REISERFS_SUPER_MAGIC:
+      return REISERFS_LINK_MAX;
+
+    case XFS_SUPER_MAGIC:
+      return XFS_LINK_MAX;
+
+    default:
+      return LINUX_LINK_MAX;
+    }
+}
+
+
+/* Used like: return statfs_filesize_max (__statfs (name, &buf), &buf); */
+long int
+__statfs_filesize_max (int result, const struct statfs *fsbuf)
+{
+  if (result < 0)
+    {
+      if (errno == ENOSYS)
+	/* Not possible, return the default value.  */
+	return 32;
+
+      /* Some error occured.  */
+      return -1;
+    }
+
+  switch (fsbuf->f_type)
+    {
+    case EXT2_SUPER_MAGIC:
+    case UFS_MAGIC:
+    case UFS_CIGAM:
+    case REISERFS_SUPER_MAGIC:
+    case XFS_SUPER_MAGIC:
+    case SMB_SUPER_MAGIC:
+    case NTFS_SUPER_MAGIC:
+    case UDF_SUPER_MAGIC:
+    case JFS_SUPER_MAGIC:
+      return 64;
+
+    case MSDOS_SUPER_MAGIC:
+    case JFFS_SUPER_MAGIC:
+    case JFFS2_SUPER_MAGIC:
+    case NCP_SUPER_MAGIC:
+    case ROMFS_SUPER_MAGIC:
+      return 32;
+
+    default:
+      return 32;
+    }
+}
+
+
+/* Used like: return statfs_link_max (__statfs (name, &buf), &buf); */
+long int
+__statfs_symlinks (int result, const struct statfs *fsbuf)
+{
+  if (result < 0)
+    {
+      if (errno == ENOSYS)
+	/* Not possible, return the default value.  */
+	return 1;
+
+      /* Some error occured.  */
+      return -1;
+    }
+
+  switch (fsbuf->f_type)
+    {
+    case ADFS_SUPER_MAGIC:
+    case BFS_MAGIC:
+    case CRAMFS_MAGIC:
+    case DEVPTS_SUPER_MAGIC:
+    case EFS_SUPER_MAGIC:
+    case EFS_MAGIC:
+    case MSDOS_SUPER_MAGIC:
+    case NTFS_SUPER_MAGIC:
+    case QNX4_SUPER_MAGIC:
+    case ROMFS_SUPER_MAGIC:
+      /* No symlink support.  */
+      return 0;
+
+    default:
+      return 1;
+    }
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/pathconf.h libc-20030708/sysdeps/unix/sysv/linux/pathconf.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/pathconf.h	2002-10-23 15:21:19.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/pathconf.h	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Common parts of Linux implementation of pathconf and fpathconf.
-   Copyright (C) 1991,95,96,98,99,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995,1996,1998-2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,100 +17,18 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#include <unistd.h>
 #include <errno.h>
+#include <unistd.h>
 #include <sys/statfs.h>
-#include "linux_fsinfo.h"
+
 
 /* Used like: return statfs_link_max (__statfs (name, &buf), &buf); */
+extern long int __statfs_link_max (int result, const struct statfs *fsbuf);
 
-static inline long int
-statfs_link_max (int result, const struct statfs *fsbuf)
-{
-  if (result < 0)
-    {
-      if (errno == ENOSYS)
-	/* Not possible, return the default value.  */
-	return LINUX_LINK_MAX;
-
-      /* Some error occured.  */
-      return -1;
-    }
-
-  switch (fsbuf->f_type)
-    {
-    case EXT2_SUPER_MAGIC:
-      return EXT2_LINK_MAX;
-
-    case MINIX_SUPER_MAGIC:
-    case MINIX_SUPER_MAGIC2:
-      return MINIX_LINK_MAX;
-
-    case MINIX2_SUPER_MAGIC:
-    case MINIX2_SUPER_MAGIC2:
-      return MINIX2_LINK_MAX;
-
-    case XENIX_SUPER_MAGIC:
-      return XENIX_LINK_MAX;
-
-    case SYSV4_SUPER_MAGIC:
-    case SYSV2_SUPER_MAGIC:
-      return SYSV_LINK_MAX;
-
-    case COH_SUPER_MAGIC:
-      return COH_LINK_MAX;
-
-    case UFS_MAGIC:
-    case UFS_CIGAM:
-      return UFS_LINK_MAX;
-
-    case REISERFS_SUPER_MAGIC:
-      return REISERFS_LINK_MAX;
-
-    case XFS_SUPER_MAGIC:
-      return XFS_LINK_MAX;
-
-    default:
-      return LINUX_LINK_MAX;
-    }
-}
 
 /* Used like: return statfs_filesize_max (__statfs (name, &buf), &buf); */
+extern long int __statfs_filesize_max (int result, const struct statfs *fsbuf);
 
-static inline long int
-statfs_filesize_max (int result, const struct statfs *fsbuf)
-{
-  if (result < 0)
-    {
-      if (errno == ENOSYS)
-	/* Not possible, return the default value.  */
-	return 32;
-
-      /* Some error occured.  */
-      return -1;
-    }
-
-  switch (fsbuf->f_type)
-    {
-    case EXT2_SUPER_MAGIC:
-    case UFS_MAGIC:
-    case UFS_CIGAM:
-    case REISERFS_SUPER_MAGIC:
-    case XFS_SUPER_MAGIC:
-    case SMB_SUPER_MAGIC:
-    case NTFS_SUPER_MAGIC:
-    case UDF_SUPER_MAGIC:
-    case JFS_SUPER_MAGIC:
-      return 64;
-
-    case MSDOS_SUPER_MAGIC:
-    case JFFS_SUPER_MAGIC:
-    case JFFS2_SUPER_MAGIC:
-    case NCP_SUPER_MAGIC:
-    case ROMFS_SUPER_MAGIC:
-      return 32;
-
-    default:
-      return 32;
-    }
-}
+
+/* Used like: return statfs_link_max (__statfs (name, &buf), &buf); */
+extern long int __statfs_symlinks (int result, const struct statfs *fsbuf);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/bits/fcntl.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/bits/fcntl.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/bits/fcntl.h	2003-03-01 09:07:36.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/bits/fcntl.h	2003-03-02 07:31:54.000000000 +0900
@@ -45,7 +45,6 @@
 # define O_DIRECT	0400000	/* Direct disk access.	*/
 # define O_DIRECTORY	 040000	/* Must be a directory.	 */
 # define O_NOFOLLOW	0100000	/* Do not follow links.	 */
-# define O_DIRECT	0400000 /* Direct disk access.  */
 #endif
 
 #ifdef __USE_LARGEFILE64
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/bits/mman.h	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/bits/mman.h	2003-03-03 19:00:51.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/PowerPC version.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -52,11 +52,13 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	0x0100		/* Stack-like segment.  */
-# define MAP_DENYWRITE	0x0800		/* ETXTBSY */
-# define MAP_EXECUTABLE	0x1000		/* Mark it as an executable.  */
-# define MAP_LOCKED	0x0080		/* Lock the mapping.  */
-# define MAP_NORESERVE	0x0040		/* Don't check for reservations.  */
+# define MAP_GROWSDOWN	0x00100		/* Stack-like segment.  */
+# define MAP_DENYWRITE	0x00800		/* ETXTBSY */
+# define MAP_EXECUTABLE	0x01000		/* Mark it as an executable.  */
+# define MAP_LOCKED	0x00080		/* Lock the mapping.  */
+# define MAP_NORESERVE	0x00040		/* Don't check for reservations.  */
+# define MAP_POPULATE	0x08000		/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	0x10000		/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/bits/stat.h	2003-01-12 17:09:45.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/bits/stat.h	2003-07-08 22:58:15.000000000 +0900
@@ -235,6 +235,8 @@
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
 #define _STATBUF_ST_RDEV
+/* Nanosecond resolution time values are supported.  */
+#define _STATBUF_ST_NSEC
 
 /* Encoding of the file mode.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/chown.c libc-20030708/sysdeps/unix/sysv/linux/powerpc/chown.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/chown.c	2002-11-05 17:13:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/chown.c	2003-03-16 10:03:52.000000000 +0900
@@ -1,5 +1,5 @@
 /* chown() compatibility.
-   Copyright (C) 1998, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -42,7 +42,7 @@
    char link[PATH_MAX+2];
    char path[2*PATH_MAX+4];
    int loopct;
-   int filelen;
+   size_t filelen;
    static int libc_old_chown = 0 /* -1=old linux, 1=new linux, 0=unknown */;
 
    if (libc_old_chown == 1)
@@ -82,7 +82,7 @@
       ENAMETOOLONG before this, usually.  */
    for (loopct = 0; loopct < 128; loopct++)
    {
-     int linklen;
+     size_t linklen;
 
      if (err >= PATH_MAX+1)
        {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/dl-cache.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/dl-cache.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/dl-cache.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/dl-cache.h	2003-06-25 17:03:30.000000000 +0900
@@ -0,0 +1 @@
+#include <sysdeps/unix/sysv/linux/sparc/dl-cache.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/dl-sysdep.c libc-20030708/sysdeps/unix/sysv/linux/powerpc/dl-sysdep.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/dl-sysdep.c	2002-08-24 04:47:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/dl-sysdep.c	2003-03-16 09:40:44.000000000 +0900
@@ -1,5 +1,5 @@
 /* Operating system support for run-time dynamic linker.  Linux/PPC version.
-   Copyright (C) 1997, 1998, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -25,27 +25,18 @@
 extern int __cache_line_size;
 weak_extern (__cache_line_size)
 
-#define DL_PLATFORM_INIT __aux_init_cache(_dl_auxv)
-
 /* Scan the Aux Vector for the "Data Cache Block Size" entry.  If found
    verify that the static extern __cache_line_size is defined by checking
-   for not NULL.  If it is defined then assign the cache block size 
+   for not NULL.  If it is defined then assign the cache block size
    value to __cache_line_size.  */
-static inline void
-__aux_init_cache (ElfW(auxv_t) *av)
-{
-  for (; av->a_type != AT_NULL; ++av)
-    switch (av->a_type)
-      {
-        case AT_DCACHEBSIZE:
-          {
-            int *cls = & __cache_line_size;
-            if (cls != NULL)
-              *cls = av->a_un.a_val;
-          }
-        break;
-      }
-}
+#define DL_PLATFORM_AUXV						      \
+      case AT_DCACHEBSIZE:						      \
+	{								      \
+	  int *cls = & __cache_line_size;				      \
+	  if (cls != NULL)						      \
+	    *cls = av->a_un.a_val;					      \
+	}								      \
+      break;
 
 #ifndef __ASSUME_STD_AUXV
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S	2002-08-04 11:20:06.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S	2003-03-10 17:52:31.000000000 +0900
@@ -28,7 +28,8 @@
    all the freaky stuff we have to do to make the call useful.  */
 
 /* int [r3] clone(int (*fn)(void *arg) [r3], void *child_stack [r4],
-   		  int flags [r5], void *arg [r6]); */
+   		  int flags [r5], void *arg [r6], void *parent_tid [r7],
+		  void *tls [r8], void *child_tid [r9]); */
 
 ENTRY (BP_SYM (__clone))
 	/* GKM FIXME: add bounds checks, where sensible.  */
@@ -59,6 +60,11 @@
 	   argument is the stack pointer, already in r4.)  */
 	mr	r3,r5
 
+	/* Move the parent_tid, child_tid and tls arguments. */
+	mr	r5,r7
+	mr	r6,r8
+	mr	r7,r9
+
 	/* Do the call.  */
 	DO_CALL(SYS_ify(clone))
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/getcontext.S libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/getcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/getcontext.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/getcontext.S	2003-06-18 12:36:23.000000000 +0900
@@ -0,0 +1,126 @@
+/* Save current context.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#define __ASSEMBLY__
+#include <asm/ptrace.h>
+#include "ucontext_i.h"
+
+ENTRY(__getcontext)
+	stw	r0,_UC_GREGS+(PT_R0*4)(r3)
+	stw	r1,_UC_GREGS+(PT_R1*4)(r3)
+	mflr	r0
+	stwu	r1,-16(r1)
+	stw	r0,20(r1)
+	stw	r0,_UC_GREGS+(PT_LNK*4)(r3)
+	stw	r0,_UC_GREGS+(PT_NIP*4)(r3)
+	stw	r2,_UC_GREGS+(PT_R2*4)(r3)
+	stw	r4,_UC_GREGS+(PT_R4*4)(r3)
+	stw	r5,_UC_GREGS+(PT_R5*4)(r3)
+	stw	r6,_UC_GREGS+(PT_R6*4)(r3)
+	stw	r7,_UC_GREGS+(PT_R7*4)(r3)
+	stw	r8,_UC_GREGS+(PT_R8*4)(r3)
+	stw	r9,_UC_GREGS+(PT_R9*4)(r3)
+	stw	r10,_UC_GREGS+(PT_R10*4)(r3)
+	stw	r11,_UC_GREGS+(PT_R11*4)(r3)
+	stw	r12,_UC_GREGS+(PT_R12*4)(r3)
+	stw	r13,_UC_GREGS+(PT_R13*4)(r3)
+	stw	r14,_UC_GREGS+(PT_R14*4)(r3)
+	stw	r15,_UC_GREGS+(PT_R15*4)(r3)
+	stw	r16,_UC_GREGS+(PT_R16*4)(r3)
+	stw	r17,_UC_GREGS+(PT_R17*4)(r3)
+	stw	r18,_UC_GREGS+(PT_R18*4)(r3)
+	stw	r19,_UC_GREGS+(PT_R19*4)(r3)
+	stw	r20,_UC_GREGS+(PT_R20*4)(r3)
+	stw	r21,_UC_GREGS+(PT_R21*4)(r3)
+	stw	r22,_UC_GREGS+(PT_R22*4)(r3)
+	stw	r23,_UC_GREGS+(PT_R23*4)(r3)
+	stw	r24,_UC_GREGS+(PT_R24*4)(r3)
+	stw	r25,_UC_GREGS+(PT_R25*4)(r3)
+	stw	r26,_UC_GREGS+(PT_R26*4)(r3)
+	stw	r27,_UC_GREGS+(PT_R27*4)(r3)
+	stw	r28,_UC_GREGS+(PT_R28*4)(r3)
+	stw	r29,_UC_GREGS+(PT_R29*4)(r3)
+	stw	r30,_UC_GREGS+(PT_R30*4)(r3)
+	stw	r31,_UC_GREGS+(PT_R31*4)(r3)
+	mfctr	r0
+	stw	r0,_UC_GREGS+(PT_CTR*4)(r3)
+	mfxer	r0
+	stw	r0,_UC_GREGS+(PT_XER*4)(r3)
+	mfcr	r0
+	stw	r0,_UC_GREGS+(PT_CCR*4)(r3)
+
+	/* Set the return value of getcontext to "success".  R3 is the only 
+	   register whose value is not preserved in the saved context.  */
+	li	r0,0
+	stw	r0,_UC_GREGS+(PT_R3*4)(r3)
+
+	/* Zero fill fields that can't be set in user state. */
+	stw	r0,_UC_GREGS+(PT_MSR*4)(r3)
+	stw	r0,_UC_GREGS+(PT_MQ*4)(r3)
+
+	/* Save the floating-point registers */
+	stfd	fp0,_UC_FREGS+(0*8)(r3)
+	stfd	fp1,_UC_FREGS+(1*8)(r3)
+	stfd	fp2,_UC_FREGS+(2*8)(r3)
+	stfd	fp3,_UC_FREGS+(3*8)(r3)
+	stfd	fp4,_UC_FREGS+(4*8)(r3)
+	stfd	fp5,_UC_FREGS+(5*8)(r3)
+	stfd	fp6,_UC_FREGS+(6*8)(r3)
+	stfd	fp7,_UC_FREGS+(7*8)(r3)
+	stfd	fp8,_UC_FREGS+(8*8)(r3)
+	stfd	fp9,_UC_FREGS+(9*8)(r3)
+	stfd	fp10,_UC_FREGS+(10*8)(r3)
+	stfd	fp11,_UC_FREGS+(11*8)(r3)
+	stfd	fp12,_UC_FREGS+(12*8)(r3)
+	stfd	fp13,_UC_FREGS+(13*8)(r3)
+	stfd	fp14,_UC_FREGS+(14*8)(r3)
+	stfd	fp15,_UC_FREGS+(15*8)(r3)
+	stfd	fp16,_UC_FREGS+(16*8)(r3)
+	stfd	fp17,_UC_FREGS+(17*8)(r3)
+	stfd	fp18,_UC_FREGS+(18*8)(r3)
+	stfd	fp19,_UC_FREGS+(19*8)(r3)
+	stfd	fp20,_UC_FREGS+(20*8)(r3)
+	stfd	fp21,_UC_FREGS+(21*8)(r3)
+	stfd	fp22,_UC_FREGS+(22*8)(r3)
+	stfd	fp23,_UC_FREGS+(23*8)(r3)
+	stfd	fp24,_UC_FREGS+(24*8)(r3)
+	stfd	fp25,_UC_FREGS+(25*8)(r3)
+	stfd	fp26,_UC_FREGS+(26*8)(r3)
+	stfd	fp27,_UC_FREGS+(27*8)(r3)
+	stfd	fp28,_UC_FREGS+(28*8)(r3)
+	stfd	fp29,_UC_FREGS+(29*8)(r3)
+	mffs	fp0
+	stfd	fp30,_UC_FREGS+(30*8)(r3)
+	stfd	fp31,_UC_FREGS+(31*8)(r3)
+	stfd	fp0,_UC_FREGS+(32*8)(r3)
+
+	addi	r5,r3,_UC_SIGMASK
+	li	r4,0
+	li	r3,SIG_BLOCK
+	bl	JUMPTARGET(sigprocmask)
+
+	lwz	r0,20(r1)
+	addi	r1,r1,16
+	mtlr	r0
+	blr
+PSEUDO_END(__getcontext)
+
+weak_alias(__getcontext, getcontext)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/makecontext.S libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/makecontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/makecontext.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/makecontext.S	2003-06-18 12:36:38.000000000 +0900
@@ -0,0 +1,105 @@
+/* Set up a context to call a function.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#define __ASSEMBLY__
+#include <asm/ptrace.h>
+#include "ucontext_i.h"
+
+ENTRY(__makecontext)
+	/* Set up the first 7 args to the function in its registers */
+	stw	r6,_UC_GREGS+(PT_R3*4)(r3)
+	stw	r7,_UC_GREGS+(PT_R4*4)(r3)
+	stw	r8,_UC_GREGS+(PT_R5*4)(r3)
+	stw	r9,_UC_GREGS+(PT_R6*4)(r3)
+	stw	r10,_UC_GREGS+(PT_R7*4)(r3)
+	lwz	r8,8(r1)
+	lwz	r9,12(r1)
+	stw	r8,_UC_GREGS+(PT_R8*4)(r3)
+	stw	r9,_UC_GREGS+(PT_R9*4)(r3)
+
+	/* Set the NIP to the start of the function */
+	stw	r4,_UC_GREGS+(PT_NIP*4)(r3)
+
+	/* Set the function's r31 to ucp->uc_link for the exitcode below. */
+	lwz	r7,_UC_LINK(r3)
+	stw	r7,_UC_GREGS+(PT_R31*4)(r3)
+
+	/* Set the function's LR to point to the exitcode below. */
+#ifdef PIC
+	mflr	r0
+	bl	1f
+1:	mflr	r6
+	addi	r6,r6,L(exitcode)-1b
+	mtlr	r0
+#else
+	lis	r6,L(exitcode)@ha
+	addi	r6,r6,L(exitcode)@l
+#endif
+	stw	r6,_UC_GREGS+(PT_LNK*4)(r3)
+
+	/*
+	 * Set up the stack frame for the function.
+	 * If we have more than 5 args to the function (8 args to makecontext),
+	 * there will be some arguments on the stack which have to end up
+	 * in registers.  If there are more than 8 args to the function,
+	 * we have to copy (argc - 8) args from our stack to the functions'
+	 * stack (and allow space for them in the frame).
+	 */
+	lwz	r4,_UC_STACK_SP(r3)
+	lwz	r8,_UC_STACK_SIZE(r3)
+	add	r4,r4,r8
+	rlwinm	r4,r4,0,0,27	/* round down to 16-byte boundary */
+	addi	r7,r4,-16	/* stack frame for fn's caller */
+	cmpwi	r5,8
+	blt	2f		/* less than 8 args is easy */
+	lwz	r10,16(r1)
+	stw	r10,_UC_GREGS+(PT_R10*4)(r3)
+	beq	2f		/* if exactly 8 args */
+	subi	r9,r5,3
+	subi	r5,r5,8
+	rlwinm	r9,r9,2,0,27
+	subf	r7,r9,r4
+	mtctr	r5		/* copy the 9th and following args */
+	addi	r6,r1,16
+	addi	r8,r7,4
+3:	lwzu	r10,4(r6)
+	stwu	r10,4(r8)
+	bdnz	3b
+2:	stw	r7,_UC_GREGS+(PT_R1*4)(r3)
+	li	r6,0
+	stw	r6,0(r7)
+
+	blr
+
+/*
+ * If the function returns, it comes here.  We put ucp->uc_link in
+ * r31, which is a callee-saved register.  We have to continue with
+ * the context that r31 points to, or exit if it is 0.
+ */
+L(exitcode):
+	mr.	r3,r31
+	beq	4f
+	bl	JUMPTARGET(__setcontext)
+4:	bl	HIDDEN_JUMPTARGET(exit)
+	b	4b
+
+END(__makecontext)
+weak_alias(__makecontext, makecontext)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/setcontext.S libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/setcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/setcontext.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/setcontext.S	2003-06-18 12:36:57.000000000 +0900
@@ -0,0 +1,149 @@
+/* Jump to a new context.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#define __ASSEMBLY__
+#include <asm/ptrace.h>
+#include "ucontext_i.h"
+
+ENTRY(__setcontext)
+	mflr	r0
+	stwu	r1,-16(r1)
+	stw	r0,20(r1)
+	stw	r31,12(r1)
+	mr	r31,r3
+
+	/*
+	 * If this ucontext refers to the point where we were interrupted
+	 * by a signal, we have to use the rt_sigreturn system call to
+	 * return to the context so we get both LR and CTR restored.
+	 *
+	 * Otherwise, the context we are restoring is either just after
+	 * a procedure call (getcontext/swapcontext) or at the beginning
+	 * of a procedure call (makecontext), so we don't need to restore
+	 * r0, xer, ctr.  We don't restore r2 since it will be used as
+	 * the TLS pointer.
+	 */
+	lwz	r0,_UC_GREGS+(PT_MSR*4)(r31)
+	cmpwi	r0,0
+	bne	L(do_sigret)
+
+	/* Restore the signal mask */
+	li	r5,0
+	addi	r4,r3,_UC_SIGMASK
+	li	r3,SIG_SETMASK
+	bl	JUMPTARGET(sigprocmask)
+	cmpwi	r3,0
+	bne	L(error_exit)
+
+	/* Restore the floating-point registers */
+	lfd	fp31,_UC_FREGS+(32*8)(r31)
+	lfd	fp0,_UC_FREGS+(0*8)(r31)
+	mtfsf	0xff,fp31
+	lfd	fp1,_UC_FREGS+(1*8)(r31)
+	lfd	fp2,_UC_FREGS+(2*8)(r31)
+	lfd	fp3,_UC_FREGS+(3*8)(r31)
+	lfd	fp4,_UC_FREGS+(4*8)(r31)
+	lfd	fp5,_UC_FREGS+(5*8)(r31)
+	lfd	fp6,_UC_FREGS+(6*8)(r31)
+	lfd	fp7,_UC_FREGS+(7*8)(r31)
+	lfd	fp8,_UC_FREGS+(8*8)(r31)
+	lfd	fp9,_UC_FREGS+(9*8)(r31)
+	lfd	fp10,_UC_FREGS+(10*8)(r31)
+	lfd	fp11,_UC_FREGS+(11*8)(r31)
+	lfd	fp12,_UC_FREGS+(12*8)(r31)
+	lfd	fp13,_UC_FREGS+(13*8)(r31)
+	lfd	fp14,_UC_FREGS+(14*8)(r31)
+	lfd	fp15,_UC_FREGS+(15*8)(r31)
+	lfd	fp16,_UC_FREGS+(16*8)(r31)
+	lfd	fp17,_UC_FREGS+(17*8)(r31)
+	lfd	fp18,_UC_FREGS+(18*8)(r31)
+	lfd	fp19,_UC_FREGS+(19*8)(r31)
+	lfd	fp20,_UC_FREGS+(20*8)(r31)
+	lfd	fp21,_UC_FREGS+(21*8)(r31)
+	lfd	fp22,_UC_FREGS+(22*8)(r31)
+	lfd	fp23,_UC_FREGS+(23*8)(r31)
+	lfd	fp24,_UC_FREGS+(24*8)(r31)
+	lfd	fp25,_UC_FREGS+(25*8)(r31)
+	lfd	fp26,_UC_FREGS+(26*8)(r31)
+	lfd	fp27,_UC_FREGS+(27*8)(r31)
+	lfd	fp28,_UC_FREGS+(28*8)(r31)
+	lfd	fp29,_UC_FREGS+(29*8)(r31)
+	lfd	fp30,_UC_FREGS+(30*8)(r31)
+	lfd	fp31,_UC_FREGS+(31*8)(r31)
+
+	/* Restore LR and CCR, and set CTR to the NIP value */
+	lwz	r3,_UC_GREGS+(PT_LNK*4)(r31)
+	lwz	r4,_UC_GREGS+(PT_NIP*4)(r31)
+	lwz	r5,_UC_GREGS+(PT_CCR*4)(r31)
+	mtlr	r3
+	mtctr	r4
+	mtcr	r5
+
+	/* Restore the general registers */
+	lwz	r1,_UC_GREGS+(PT_R1*4)(r31)
+	lwz	r3,_UC_GREGS+(PT_R3*4)(r31)
+	lwz	r4,_UC_GREGS+(PT_R4*4)(r31)
+	lwz	r5,_UC_GREGS+(PT_R5*4)(r31)
+	lwz	r6,_UC_GREGS+(PT_R6*4)(r31)
+	lwz	r7,_UC_GREGS+(PT_R7*4)(r31)
+	lwz	r8,_UC_GREGS+(PT_R8*4)(r31)
+	lwz	r9,_UC_GREGS+(PT_R9*4)(r31)
+	lwz	r10,_UC_GREGS+(PT_R10*4)(r31)
+	lwz	r11,_UC_GREGS+(PT_R11*4)(r31)
+	lwz	r12,_UC_GREGS+(PT_R12*4)(r31)
+	lwz	r13,_UC_GREGS+(PT_R13*4)(r31)
+	lwz	r14,_UC_GREGS+(PT_R14*4)(r31)
+	lwz	r15,_UC_GREGS+(PT_R15*4)(r31)
+	lwz	r16,_UC_GREGS+(PT_R16*4)(r31)
+	lwz	r17,_UC_GREGS+(PT_R17*4)(r31)
+	lwz	r18,_UC_GREGS+(PT_R18*4)(r31)
+	lwz	r19,_UC_GREGS+(PT_R19*4)(r31)
+	lwz	r20,_UC_GREGS+(PT_R20*4)(r31)
+	lwz	r21,_UC_GREGS+(PT_R21*4)(r31)
+	lwz	r22,_UC_GREGS+(PT_R22*4)(r31)
+	lwz	r23,_UC_GREGS+(PT_R23*4)(r31)
+	lwz	r24,_UC_GREGS+(PT_R24*4)(r31)
+	lwz	r25,_UC_GREGS+(PT_R25*4)(r31)
+	lwz	r26,_UC_GREGS+(PT_R26*4)(r31)
+	lwz	r27,_UC_GREGS+(PT_R27*4)(r31)
+	lwz	r28,_UC_GREGS+(PT_R28*4)(r31)
+	lwz	r29,_UC_GREGS+(PT_R29*4)(r31)
+	lwz	r30,_UC_GREGS+(PT_R30*4)(r31)
+	lwz	r31,_UC_GREGS+(PT_R31*4)(r31)
+
+	bctr
+
+L(error_exit):
+	lwz	r31,12(r1)
+	lwz	r0,20(r1)
+	addi	r1,r1,16
+	mtlr	r0
+	blr
+	
+L(do_sigret):
+	addi	r1,r3,-0xd0
+	li	r0,SYS_ify(rt_sigreturn)
+	sc
+	/* NOTREACHED */
+
+PSEUDO_END(__setcontext)
+
+weak_alias(__setcontext, setcontext)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/swapcontext.S libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/swapcontext.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/swapcontext.S	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/swapcontext.S	2003-06-18 12:37:19.000000000 +0900
@@ -0,0 +1,233 @@
+/* Save current context and jump to a new context.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+#define __ASSEMBLY__
+#include <asm/ptrace.h>
+#include "ucontext_i.h"
+
+ENTRY(__swapcontext)
+	/* Save the current context */
+	stw	r0,_UC_GREGS+(PT_R0*4)(r3)
+	stw	r1,_UC_GREGS+(PT_R1*4)(r3)
+	mflr	r0
+	stwu	r1,-16(r1)
+	stw	r0,20(r1)
+	stw	r31,12(r1)
+	stw	r31,_UC_GREGS+(PT_R31*4)(r3)
+	mr	r31,r4			/* new context pointer */
+	stw	r0,_UC_GREGS+(PT_LNK*4)(r3)
+	stw	r0,_UC_GREGS+(PT_NIP*4)(r3)
+	stw	r2,_UC_GREGS+(PT_R2*4)(r3)
+	stw	r4,_UC_GREGS+(PT_R4*4)(r3)
+	stw	r5,_UC_GREGS+(PT_R5*4)(r3)
+	stw	r6,_UC_GREGS+(PT_R6*4)(r3)
+	stw	r7,_UC_GREGS+(PT_R7*4)(r3)
+	stw	r8,_UC_GREGS+(PT_R8*4)(r3)
+	stw	r9,_UC_GREGS+(PT_R9*4)(r3)
+	stw	r10,_UC_GREGS+(PT_R10*4)(r3)
+	stw	r11,_UC_GREGS+(PT_R11*4)(r3)
+	stw	r12,_UC_GREGS+(PT_R12*4)(r3)
+	stw	r13,_UC_GREGS+(PT_R13*4)(r3)
+	stw	r14,_UC_GREGS+(PT_R14*4)(r3)
+	stw	r15,_UC_GREGS+(PT_R15*4)(r3)
+	stw	r16,_UC_GREGS+(PT_R16*4)(r3)
+	stw	r17,_UC_GREGS+(PT_R17*4)(r3)
+	stw	r18,_UC_GREGS+(PT_R18*4)(r3)
+	stw	r19,_UC_GREGS+(PT_R19*4)(r3)
+	stw	r20,_UC_GREGS+(PT_R20*4)(r3)
+	stw	r21,_UC_GREGS+(PT_R21*4)(r3)
+	stw	r22,_UC_GREGS+(PT_R22*4)(r3)
+	stw	r23,_UC_GREGS+(PT_R23*4)(r3)
+	stw	r24,_UC_GREGS+(PT_R24*4)(r3)
+	stw	r25,_UC_GREGS+(PT_R25*4)(r3)
+	stw	r26,_UC_GREGS+(PT_R26*4)(r3)
+	stw	r27,_UC_GREGS+(PT_R27*4)(r3)
+	stw	r28,_UC_GREGS+(PT_R28*4)(r3)
+	stw	r29,_UC_GREGS+(PT_R29*4)(r3)
+	stw	r30,_UC_GREGS+(PT_R30*4)(r3)
+	mfctr	r0
+	stw	r0,_UC_GREGS+(PT_CTR*4)(r3)
+	mfxer	r0
+	stw	r0,_UC_GREGS+(PT_XER*4)(r3)
+	mfcr	r0
+	stw	r0,_UC_GREGS+(PT_CCR*4)(r3)
+
+	/* Set the return value of swapcontext to "success".  R3 is the only 
+	   register whose value is not preserved in the saved context.  */
+	li	r0,0
+	stw	r0,_UC_GREGS+(PT_R3*4)(r3)
+
+	/* Zero fill fields that can't be set in user state. */
+	stw	r0,_UC_GREGS+(PT_MSR*4)(r3)
+	stw	r0,_UC_GREGS+(PT_MQ*4)(r3)
+
+	/* Save the floating-point registers */
+	stfd	fp0,_UC_FREGS+(0*8)(r3)
+	stfd	fp1,_UC_FREGS+(1*8)(r3)
+	stfd	fp2,_UC_FREGS+(2*8)(r3)
+	stfd	fp3,_UC_FREGS+(3*8)(r3)
+	stfd	fp4,_UC_FREGS+(4*8)(r3)
+	stfd	fp5,_UC_FREGS+(5*8)(r3)
+	stfd	fp6,_UC_FREGS+(6*8)(r3)
+	stfd	fp7,_UC_FREGS+(7*8)(r3)
+	stfd	fp8,_UC_FREGS+(8*8)(r3)
+	stfd	fp9,_UC_FREGS+(9*8)(r3)
+	stfd	fp10,_UC_FREGS+(10*8)(r3)
+	stfd	fp11,_UC_FREGS+(11*8)(r3)
+	stfd	fp12,_UC_FREGS+(12*8)(r3)
+	stfd	fp13,_UC_FREGS+(13*8)(r3)
+	stfd	fp14,_UC_FREGS+(14*8)(r3)
+	stfd	fp15,_UC_FREGS+(15*8)(r3)
+	stfd	fp16,_UC_FREGS+(16*8)(r3)
+	stfd	fp17,_UC_FREGS+(17*8)(r3)
+	stfd	fp18,_UC_FREGS+(18*8)(r3)
+	stfd	fp19,_UC_FREGS+(19*8)(r3)
+	stfd	fp20,_UC_FREGS+(20*8)(r3)
+	stfd	fp21,_UC_FREGS+(21*8)(r3)
+	stfd	fp22,_UC_FREGS+(22*8)(r3)
+	stfd	fp23,_UC_FREGS+(23*8)(r3)
+	stfd	fp24,_UC_FREGS+(24*8)(r3)
+	stfd	fp25,_UC_FREGS+(25*8)(r3)
+	stfd	fp26,_UC_FREGS+(26*8)(r3)
+	stfd	fp27,_UC_FREGS+(27*8)(r3)
+	stfd	fp28,_UC_FREGS+(28*8)(r3)
+	stfd	fp29,_UC_FREGS+(29*8)(r3)
+	mffs	fp0
+	stfd	fp30,_UC_FREGS+(30*8)(r3)
+	stfd	fp31,_UC_FREGS+(31*8)(r3)
+	stfd	fp0,_UC_FREGS+(32*8)(r3)
+
+	addi	r5,r3,_UC_SIGMASK
+	addi	r4,r4,_UC_SIGMASK
+	li	r3,SIG_SETMASK
+	bl	JUMPTARGET(sigprocmask)
+	cmpwi	r3,0
+	bne	L(error_exit)
+
+	/*
+	 * If the new ucontext refers to the point where we were interrupted
+	 * by a signal, we have to use the rt_sigreturn system call to
+	 * return to the context so we get both LR and CTR restored.
+	 *
+	 * Otherwise, the context we are restoring is either just after
+	 * a procedure call (getcontext/swapcontext) or at the beginning
+	 * of a procedure call (makecontext), so we don't need to restore
+	 * r0, xer, ctr.  We don't restore r2 since it will be used as
+	 * the TLS pointer.
+	 */
+	lwz	r0,_UC_GREGS+(PT_MSR*4)(r31)
+	cmpwi	r0,0
+	bne	L(do_sigret)
+
+	/* Restore the floating-point registers */
+	lfd	fp31,_UC_FREGS+(32*8)(r31)
+	lfd	fp0,_UC_FREGS+(0*8)(r31)
+	mtfsf	0xff,fp31
+	lfd	fp1,_UC_FREGS+(1*8)(r31)
+	lfd	fp2,_UC_FREGS+(2*8)(r31)
+	lfd	fp3,_UC_FREGS+(3*8)(r31)
+	lfd	fp4,_UC_FREGS+(4*8)(r31)
+	lfd	fp5,_UC_FREGS+(5*8)(r31)
+	lfd	fp6,_UC_FREGS+(6*8)(r31)
+	lfd	fp7,_UC_FREGS+(7*8)(r31)
+	lfd	fp8,_UC_FREGS+(8*8)(r31)
+	lfd	fp9,_UC_FREGS+(9*8)(r31)
+	lfd	fp10,_UC_FREGS+(10*8)(r31)
+	lfd	fp11,_UC_FREGS+(11*8)(r31)
+	lfd	fp12,_UC_FREGS+(12*8)(r31)
+	lfd	fp13,_UC_FREGS+(13*8)(r31)
+	lfd	fp14,_UC_FREGS+(14*8)(r31)
+	lfd	fp15,_UC_FREGS+(15*8)(r31)
+	lfd	fp16,_UC_FREGS+(16*8)(r31)
+	lfd	fp17,_UC_FREGS+(17*8)(r31)
+	lfd	fp18,_UC_FREGS+(18*8)(r31)
+	lfd	fp19,_UC_FREGS+(19*8)(r31)
+	lfd	fp20,_UC_FREGS+(20*8)(r31)
+	lfd	fp21,_UC_FREGS+(21*8)(r31)
+	lfd	fp22,_UC_FREGS+(22*8)(r31)
+	lfd	fp23,_UC_FREGS+(23*8)(r31)
+	lfd	fp24,_UC_FREGS+(24*8)(r31)
+	lfd	fp25,_UC_FREGS+(25*8)(r31)
+	lfd	fp26,_UC_FREGS+(26*8)(r31)
+	lfd	fp27,_UC_FREGS+(27*8)(r31)
+	lfd	fp28,_UC_FREGS+(28*8)(r31)
+	lfd	fp29,_UC_FREGS+(29*8)(r31)
+	lfd	fp30,_UC_FREGS+(30*8)(r31)
+	lfd	fp31,_UC_FREGS+(31*8)(r31)
+
+	/* Restore LR and CCR, and set CTR to the NIP value */
+	lwz	r3,_UC_GREGS+(PT_LNK*4)(r31)
+	lwz	r4,_UC_GREGS+(PT_NIP*4)(r31)
+	lwz	r5,_UC_GREGS+(PT_CCR*4)(r31)
+	mtlr	r3
+	mtctr	r4
+	mtcr	r5
+
+	/* Restore the general registers */
+	lwz	r1,_UC_GREGS+(PT_R1*4)(r31)
+	lwz	r3,_UC_GREGS+(PT_R3*4)(r31)
+	lwz	r4,_UC_GREGS+(PT_R4*4)(r31)
+	lwz	r5,_UC_GREGS+(PT_R5*4)(r31)
+	lwz	r6,_UC_GREGS+(PT_R6*4)(r31)
+	lwz	r7,_UC_GREGS+(PT_R7*4)(r31)
+	lwz	r8,_UC_GREGS+(PT_R8*4)(r31)
+	lwz	r9,_UC_GREGS+(PT_R9*4)(r31)
+	lwz	r10,_UC_GREGS+(PT_R10*4)(r31)
+	lwz	r11,_UC_GREGS+(PT_R11*4)(r31)
+	lwz	r12,_UC_GREGS+(PT_R12*4)(r31)
+	lwz	r13,_UC_GREGS+(PT_R13*4)(r31)
+	lwz	r14,_UC_GREGS+(PT_R14*4)(r31)
+	lwz	r15,_UC_GREGS+(PT_R15*4)(r31)
+	lwz	r16,_UC_GREGS+(PT_R16*4)(r31)
+	lwz	r17,_UC_GREGS+(PT_R17*4)(r31)
+	lwz	r18,_UC_GREGS+(PT_R18*4)(r31)
+	lwz	r19,_UC_GREGS+(PT_R19*4)(r31)
+	lwz	r20,_UC_GREGS+(PT_R20*4)(r31)
+	lwz	r21,_UC_GREGS+(PT_R21*4)(r31)
+	lwz	r22,_UC_GREGS+(PT_R22*4)(r31)
+	lwz	r23,_UC_GREGS+(PT_R23*4)(r31)
+	lwz	r24,_UC_GREGS+(PT_R24*4)(r31)
+	lwz	r25,_UC_GREGS+(PT_R25*4)(r31)
+	lwz	r26,_UC_GREGS+(PT_R26*4)(r31)
+	lwz	r27,_UC_GREGS+(PT_R27*4)(r31)
+	lwz	r28,_UC_GREGS+(PT_R28*4)(r31)
+	lwz	r29,_UC_GREGS+(PT_R29*4)(r31)
+	lwz	r30,_UC_GREGS+(PT_R30*4)(r31)
+	lwz	r31,_UC_GREGS+(PT_R31*4)(r31)
+
+	bctr
+
+L(error_exit):
+	lwz	r31,12(r1)
+	lwz	r0,20(r1)
+	addi	r1,r1,16
+	mtlr	r0
+	blr
+
+L(do_sigret):
+	addi	r1,r31,-0xd0
+	li	r0,SYS_ify(rt_sigreturn)
+	sc
+	/* NOTREACHED */
+
+PSEUDO_END(__swapcontext)
+
+weak_alias(__swapcontext, swapcontext)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h	2003-01-13 04:30:41.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h	2003-06-12 08:54:05.000000000 +0900
@@ -117,32 +117,38 @@
 # define LOADARGS_1(name, arg1) \
 	LOADARGS_0(name, 0); \
 	extern void __illegally_sized_syscall_##name##_arg1 (void); \
-	if (sizeof (arg1) > 4) __illegally_sized_syscall_##name##_arg1 (); \
+	if (__builtin_classify_type (arg1) != 5 && sizeof (arg1) > 4) \
+	  __illegally_sized_syscall_##name##_arg1 (); \
 	r3 = (long) (arg1)
 # define LOADARGS_2(name, arg1, arg2) \
 	LOADARGS_1(name, arg1); \
 	extern void __illegally_sized_syscall_##name##_arg2 (void); \
-	if (sizeof (arg2) > 4) __illegally_sized_syscall_##name##_arg2 (); \
+	if (__builtin_classify_type (arg2) != 5 && sizeof (arg2) > 4) \
+	  __illegally_sized_syscall_##name##_arg2 (); \
 	r4 = (long) (arg2)
 # define LOADARGS_3(name, arg1, arg2, arg3) \
 	LOADARGS_2(name, arg1, arg2); \
 	extern void __illegally_sized_syscall_##name##_arg3 (void); \
-	if (sizeof (arg3) > 4) __illegally_sized_syscall_##name##_arg3 (); \
+	if (__builtin_classify_type (arg3) != 5 && sizeof (arg3) > 4) \
+	  __illegally_sized_syscall_##name##_arg3 (); \
 	r5 = (long) (arg3)
 # define LOADARGS_4(name, arg1, arg2, arg3, arg4) \
 	LOADARGS_3(name, arg1, arg2, arg3); \
 	extern void __illegally_sized_syscall_##name##_arg4 (void); \
-	if (sizeof (arg4) > 4) __illegally_sized_syscall_##name##_arg4 (); \
+	if (__builtin_classify_type (arg4) != 5 && sizeof (arg4) > 4) \
+	  __illegally_sized_syscall_##name##_arg4 (); \
 	r6 = (long) (arg4)
 # define LOADARGS_5(name, arg1, arg2, arg3, arg4, arg5) \
 	LOADARGS_4(name, arg1, arg2, arg3, arg4); \
 	extern void __illegally_sized_syscall_##name##_arg5 (void); \
-	if (sizeof (arg5) > 4) __illegally_sized_syscall_##name##_arg5 (); \
+	if (__builtin_classify_type (arg5) != 5 && sizeof (arg5) > 4) \
+	  __illegally_sized_syscall_##name##_arg5 (); \
 	r7 = (long) (arg5)
 # define LOADARGS_6(name, arg1, arg2, arg3, arg4, arg5, arg6) \
 	LOADARGS_5(name, arg1, arg2, arg3, arg4, arg5); \
 	extern void __illegally_sized_syscall_##name##_arg6 (void); \
-	if (sizeof (arg6) > 4) __illegally_sized_syscall_##name##_arg6 (); \
+	if (__builtin_classify_type (arg6) != 5 && sizeof (arg6) > 4) \
+	  __illegally_sized_syscall_##name##_arg6 (); \
 	r8 = (long) (arg6)
 
 # define ASM_INPUT_0 "0" (r0)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/ucontext_i.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/ucontext_i.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc32/ucontext_i.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc32/ucontext_i.h	2003-06-18 12:37:33.000000000 +0900
@@ -0,0 +1,30 @@
+/* Offsets and other constants needed in the *context() function
+   implementation.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define SIG_BLOCK	0
+#define SIG_SETMASK	2
+
+#define _UC_LINK	4
+#define _UC_STACK_SP	8
+#define _UC_STACK_SIZE	16
+#define _UC_SIGMASK	64
+#define _UC_GREGS	192
+#define _UC_FREGS	384
+#define _UC_VREGS	656
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/brk.S libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/brk.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/brk.S	2002-09-18 08:50:03.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/brk.S	2003-07-08 22:58:15.000000000 +0900
@@ -24,6 +24,9 @@
 #include <bp-asm.h>
 
 	.comm	__curbrk,8,8
+	.section	".toc","aw"
+.LC__curbrk:
+	.tc __curbrk[TC],__curbrk
 	.section ".text"
 ENTRY (BP_SYM (__brk))
 	DISCARD_BOUNDS (r3)	/* the bounds are meaningless, so toss 'em.  */
@@ -32,7 +35,7 @@
 	std	r3,48(r1)
 	DO_CALL(SYS_ify(brk))
 	ld     r6,48(r1)
-	ld	r5,__curbrk@got(r2)
+	ld	r5,.LC__curbrk@toc(r2)
 	std     r3,0(r5)
 	cmpld   r6,r3
 	addi    r1,r1,64
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/clone.S libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/clone.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/clone.S	2002-09-18 08:50:03.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/clone.S	2003-03-11 06:04:29.000000000 +0900
@@ -28,7 +28,8 @@
    all the freaky stuff we have to do to make the call useful.  */
 
 /* int [r3] clone(int (*fn)(void *arg) [r3], void *child_stack [r4],
-   		  int flags [r5], void *arg [r6]); */
+                  int flags [r5], void *arg [r6], void *parent_tid [r7],
+                  void *tls [r8], void *child_tid [r9]); */
 
 ENTRY (BP_SYM (__clone))
 	/* GKM FIXME: add bounds checks, where sensible.  */
@@ -37,8 +38,8 @@
 
 	/* Check for child_stack == NULL || fn == NULL.  */
 	cmpdi	cr0,r4,0
-	ld	r7,0(r3)
-	cmpdi	cr1,r7,0
+	ld	r0,0(r3)
+	cmpdi	cr1,r0,0
 	cror	cr0*4+eq,cr1*4+eq,cr0*4+eq
 	beq-	cr0,L(badargs)
 
@@ -61,6 +62,10 @@
 	/* 'flags' argument is first parameter to clone syscall. (The other
 	   argument is the stack pointer, already in r4.)  */
 	mr	r3,r5
+  /* Move the parent_tid, child_tid and tls arguments. */
+	mr	r5,r7
+	mr	r6,r8
+	mr	r7,r9
 
 	/* Do the call.  */
 	DO_CALL(SYS_ify(clone))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c	2003-02-04 06:13:55.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/fe_nomask.c	2003-04-15 23:55:50.000000000 +0900
@@ -27,9 +27,15 @@
 const fenv_t *
 __fe_nomask_env (void)
 {
-#ifdef __ASSUME_NEW_PRCTL_SYSCALL
+#if defined PR_SET_FPEXC && defined PR_FP_EXC_PRECISE
+  int result;
   INTERNAL_SYSCALL_DECL (err);
-  INTERNAL_SYSCALL (prctl, err, 2, PR_SET_FPEXC, PR_FP_EXC_PRECISE);
+  result = INTERNAL_SYSCALL (prctl, err, 2, PR_SET_FPEXC, PR_FP_EXC_PRECISE);
+# ifndef __ASSUME_NEW_PRCTL_SYSCALL
+  if (INTERNAL_SYSCALL_ERROR_P (result, err)
+      && INTERNAL_SYSCALL_ERRNO (result, err) == EINVAL)
+    __set_errno (ENOSYS);
+# endif
 #else  
   __set_errno (ENOSYS);
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h	2003-01-29 12:15:53.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/powerpc64/sysdep.h	2003-06-12 08:54:05.000000000 +0900
@@ -130,32 +130,38 @@
 #define LOADARGS_1(name, arg1) \
 	LOADARGS_0(name, 0); \
 	extern void __illegally_sized_syscall_##name##_arg1 (void); \
-	if (sizeof (arg1) > 8) __illegally_sized_syscall_##name##_arg1 (); \
+	if (__builtin_classify_type (arg1) != 5 && sizeof (arg1) > 8) \
+	  __illegally_sized_syscall_##name##_arg1 (); \
 	r3 = (long) (arg1)
 #define LOADARGS_2(name, arg1, arg2) \
 	LOADARGS_1(name, arg1); \
 	extern void __illegally_sized_syscall_##name##_arg2 (void); \
-	if (sizeof (arg2) > 8) __illegally_sized_syscall_##name##_arg2 (); \
+	if (__builtin_classify_type (arg2) != 5 && sizeof (arg2) > 8) \
+	  __illegally_sized_syscall_##name##_arg2 (); \
 	r4 = (long) (arg2)
 #define LOADARGS_3(name, arg1, arg2, arg3) \
 	LOADARGS_2(name, arg1, arg2); \
 	extern void __illegally_sized_syscall_##name##_arg3 (void); \
-	if (sizeof (arg3) > 8) __illegally_sized_syscall_##name##_arg3 (); \
+	if (__builtin_classify_type (arg3) != 5 && sizeof (arg3) > 8) \
+	  __illegally_sized_syscall_##name##_arg3 (); \
 	r5 = (long) (arg3)
 #define LOADARGS_4(name, arg1, arg2, arg3, arg4) \
 	LOADARGS_3(name, arg1, arg2, arg3); \
 	extern void __illegally_sized_syscall_##name##_arg4 (void); \
-	if (sizeof (arg4) > 8) __illegally_sized_syscall_##name##_arg4 (); \
+	if (__builtin_classify_type (arg4) != 5 && sizeof (arg4) > 8) \
+	  __illegally_sized_syscall_##name##_arg4 (); \
 	r6 = (long) (arg4)
 #define LOADARGS_5(name, arg1, arg2, arg3, arg4, arg5) \
 	LOADARGS_4(name, arg1, arg2, arg3, arg4); \
 	extern void __illegally_sized_syscall_##name##_arg5 (void); \
-	if (sizeof (arg5) > 8) __illegally_sized_syscall_##name##_arg5 (); \
+	if (__builtin_classify_type (arg5) != 5 && sizeof (arg5) > 8) \
+	  __illegally_sized_syscall_##name##_arg5 (); \
 	r7 = (long) (arg5)
 #define LOADARGS_6(name, arg1, arg2, arg3, arg4, arg5, arg6) \
 	LOADARGS_5(name, arg1, arg2, arg3, arg4, arg5); \
 	extern void __illegally_sized_syscall_##name##_arg6 (void); \
-	if (sizeof (arg6) > 8) __illegally_sized_syscall_##name##_arg6 (); \
+	if (__builtin_classify_type (arg6) != 5 && sizeof (arg6) > 8) \
+	  __illegally_sized_syscall_##name##_arg6 (); \
 	r8 = (long) (arg6)
 
 #define ASM_INPUT_0 "0" (r0)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/sys/ucontext.h libc-20030708/sysdeps/unix/sysv/linux/powerpc/sys/ucontext.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/powerpc/sys/ucontext.h	2003-01-17 09:56:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/powerpc/sys/ucontext.h	2003-07-08 22:58:15.000000000 +0900
@@ -26,9 +26,47 @@
    included in <signal.h>.  */
 #include <bits/sigcontext.h>
 
-/* A machine context is exactly a sigcontext.  */
+#if __WORDSIZE == 32
+
+/* Number of general registers.  */
+#define NGREG	48
+
+/* Container for all general registers.  */
+typedef unsigned long gregset_t[NGREG];
+
+/* Container for floating-point registers and status */
+typedef struct _libc_fpstate
+{
+	double fpregs[32];
+	double fpscr;
+	unsigned int _pad[2];
+} fpregset_t;
+
+/* Container for Altivec/VMX registers and status.
+   Needs to be aligned on a 16-byte boundary. */
+typedef struct _libc_vrstate
+{
+	unsigned int vrregs[32][4];
+	unsigned int vscr;
+	unsigned int vrsave;
+	unsigned int _pad[2];
+} vrregset_t;
+
+/* Context to describe whole processor state.  */
+typedef struct
+{
+	gregset_t gregs;
+	fpregset_t fpregs;
+	vrregset_t vrregs __attribute__((__aligned__(16)));
+} mcontext_t;
+
+#else
+
+/* For 64-bit, a machine context is exactly a sigcontext.  */
 typedef struct sigcontext mcontext_t;
 
+#endif
+
 /* Userlevel context.  */
 typedef struct ucontext
   {
@@ -36,12 +74,14 @@
     struct ucontext *uc_link;
     stack_t uc_stack;
 #if __WORDSIZE == 32
-    mcontext_t uc_mcontext;
-    __sigset_t uc_sigmask;
-#else
+    /* These fields are for backwards compatibility. */
+    int uc_pad[7];
+    mcontext_t *uc_regs;
+    unsigned int uc_oldsigmask[2];
+    int uc_pad2;
+#endif
     sigset_t    uc_sigmask;
     mcontext_t  uc_mcontext;  /* last for extensibility */
-#endif
   } ucontext_t;
 
 #endif /* sys/ucontext.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/prof-freq.c libc-20030708/sysdeps/unix/sysv/linux/prof-freq.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/prof-freq.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/prof-freq.c	2003-07-04 02:32:19.000000000 +0900
@@ -0,0 +1,51 @@
+/* Determine realtime clock frequency.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/time.h>
+#include <libc-internal.h>
+#include "kernel-features.h"
+#include <ldsodefs.h>
+
+
+int
+__profile_frequency (void)
+{
+#ifdef __ASSUME_AT_CLKTCK
+  return GL(dl_clktck);
+#else
+  if (GL(dl_clktck) != 0)
+    return GL(dl_clktck);
+
+  struct itimerval tim;
+
+  tim.it_interval.tv_sec = 0;
+  tim.it_interval.tv_usec = 1;
+  tim.it_value.tv_sec = 0;
+  tim.it_value.tv_usec = 0;
+
+  __setitimer (ITIMER_REAL, &tim, 0);
+  __setitimer (ITIMER_REAL, 0, &tim);
+
+  if (tim.it_interval.tv_usec < 2)
+    return 0;
+
+  return 1000000 / tim.it_interval.tv_usec;
+#endif
+}
+libc_hidden_def (__profile_frequency)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/s390/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/mman.h	2002-07-12 06:39:44.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/bits/mman.h	2003-03-03 19:02:34.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/s390 version.
-   Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -52,12 +52,14 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	0x0100		/* Stack-like segment.  */
-# define MAP_GROWSUP	0x0200		/* Register stack-like segment */
-# define MAP_DENYWRITE	0x0800		/* ETXTBSY */
-# define MAP_EXECUTABLE	0x1000		/* Mark it as an executable.  */
-# define MAP_LOCKED	0x2000		/* Lock the mapping.  */
-# define MAP_NORESERVE	0x4000		/* Don't check for reservations.  */
+# define MAP_GROWSDOWN	0x00100		/* Stack-like segment.  */
+# define MAP_GROWSUP	0x00200		/* Register stack-like segment */
+# define MAP_DENYWRITE	0x00800		/* ETXTBSY */
+# define MAP_EXECUTABLE	0x01000		/* Mark it as an executable.  */
+# define MAP_LOCKED	0x02000		/* Lock the mapping.  */
+# define MAP_NORESERVE	0x04000		/* Don't check for reservations.  */
+# define MAP_POPULATE	0x08000		/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	0x10000		/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/siginfo.h libc-20030708/sysdeps/unix/sysv/linux/s390/bits/siginfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/siginfo.h	2002-12-05 09:23:11.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/bits/siginfo.h	2003-04-28 23:53:26.000000000 +0900
@@ -1,5 +1,5 @@
 /* siginfo_t, sigevent and constants.  S/390 version.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -69,8 +69,9 @@
 	/* POSIX.1b timers.  */
 	struct
 	  {
-	    unsigned int _timer1;
-	    unsigned int _timer2;
+	    int si_tid;		/* Timer ID.  */
+	    int si_overrun;	/* Overrun count.  */
+	    sigval_t si_sigval;	/* Signal value.  */
 	  } _timer;
 
 	/* POSIX.1b signals.  */
@@ -111,8 +112,8 @@
 /* X/Open requires some more fields with fixed names.  */
 # define si_pid		_sifields._kill.si_pid
 # define si_uid		_sifields._kill.si_uid
-# define si_timer1	_sifields._timer._timer1
-# define si_timer2	_sifields._timer._timer2
+# define si_timerid	_sifields._timer.si_tid
+# define si_overrun	_sifields._timer.si_overrun
 # define si_status	_sifields._sigchld.si_status
 # define si_utime	_sifields._sigchld.si_utime
 # define si_stime	_sifields._sigchld.si_stime
@@ -129,8 +130,10 @@
    signals.  */
 enum
 {
-  SI_ASYNCNL = -6,		/* Sent by asynch name lookup completion.  */
+  SI_ASYNCNL = -60,		/* Sent by asynch name lookup completion.  */
 # define SI_ASYNCNL	SI_ASYNCNL
+  SI_TKILL = -6,		/* Sent by tkill.  */
+# define SI_TKILL	SI_TKILL
   SI_SIGIO,			/* Sent by queued SIGIO. */
 # define SI_SIGIO	SI_SIGIO
   SI_ASYNCIO,			/* Sent by AIO completion.  */
@@ -269,9 +272,6 @@
 #  define __SIGEV_PAD_SIZE	((__SIGEV_MAX_SIZE / sizeof (int)) - 3)
 # endif
 
-/* Forward declaration of the `pthread_attr_t' type.  */
-struct __pthread_attr_s;
-
 typedef struct sigevent
   {
     sigval_t sigev_value;
@@ -301,8 +301,11 @@
 # define SIGEV_SIGNAL	SIGEV_SIGNAL
   SIGEV_NONE,			/* Other notification: meaningless.  */
 # define SIGEV_NONE	SIGEV_NONE
-  SIGEV_THREAD			/* Deliver via thread creation.	 */
+  SIGEV_THREAD,			/* Deliver via thread creation.	 */
 # define SIGEV_THREAD	SIGEV_THREAD
+
+  SIGEV_THREAD_ID = 4		/* Send signal to specific thread.  */
+#define SIGEV_THREAD_ID	SIGEV_THREAD_ID
 };
 
 #endif	/* have _SIGNAL_H.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/s390/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/stat.h	2003-01-01 05:08:58.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/bits/stat.h	2003-07-08 22:58:15.000000000 +0900
@@ -224,6 +224,8 @@
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
 #define _STATBUF_ST_RDEV
+/* Nanosecond resolution time values are supported.  */
+#define _STATBUF_ST_NSEC
 
 /* Encoding of the file mode.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/statfs.h libc-20030708/sysdeps/unix/sysv/linux/s390/bits/statfs.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/bits/statfs.h	2002-10-24 08:48:54.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/bits/statfs.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,7 +41,8 @@
 #endif
     __fsid_t f_fsid;
     int f_namelen;
-    int f_spare[6];
+    int f_frsize;
+    int f_spare[5];
   };
 
 #ifdef __USE_LARGEFILE64
@@ -56,7 +57,8 @@
     __fsfilcnt64_t f_ffree;
     __fsid_t f_fsid;
     int f_namelen;
-    int f_spare[6];
+    int f_frsize;
+    int f_spare[5];
   };
 #endif
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/dl-cache.h libc-20030708/sysdeps/unix/sysv/linux/s390/dl-cache.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/dl-cache.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/dl-cache.h	2003-06-25 17:03:17.000000000 +0900
@@ -0,0 +1 @@
+#include <sysdeps/unix/sysv/linux/sparc/dl-cache.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-32/syscall.S libc-20030708/sysdeps/unix/sysv/linux/s390/s390-32/syscall.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-32/syscall.S	2001-07-08 04:21:35.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/s390-32/syscall.S	2003-03-04 03:17:44.000000000 +0900
@@ -37,15 +37,19 @@
 	lr     %r4,%r5             /* third parameter  */
 	lr     %r5,%r6             /* fourth parameter */
 	l      %r6,192(%r15)       /* fifth parameter  */
-	basr   %r7,0
-.L0:    ex     %r1,.L1-.L0(%r7)    /* lsb of R1 is subsituted as SVC number */
 
-	l       %r15,0(0,%r15)     /* load back chain */
-	lm      %r6,15,24(%r15)    /* load registers */
+	basr   %r7,0
+0:	cl     %r1,4f-0b(%r7)      /* svc number < 256? */
+	jl     2f
+1:	svc    0
+	j      3f
+2:	ex     %r1,1b-0b(%r7)      /* lsb of R1 is subsituted as SVC number */
+3:	l      %r15,0(%r15)        /* load back chain */
+	lm     %r6,15,24(%r15)     /* load registers */
 
 	lhi    %r0,-4095
 	clr    %r2,%r0             /* check R2 for error */
 	jnl    SYSCALL_ERROR_LABEL
 	br     %r14                /* return to caller */
-.L1:    .word  0x0A00              /* opcode for SVC 0 */
+4:	.long  256
 PSEUDO_END (syscall)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h	2003-01-28 19:20:09.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/s390-32/sysdep.h	2003-03-28 21:28:21.000000000 +0900
@@ -59,6 +59,16 @@
   SYSCALL_ERROR_HANDLER;						      \
   END (name)
 
+#undef PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args)			      \
+  .text;                                                                      \
+  ENTRY (name)							              \
+    DO_CALL (syscall_name, args)
+
+#undef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(name)					      \
+  END (name)
+
 #ifndef PIC
 # define SYSCALL_ERROR_LABEL 0f
 # define SYSCALL_ERROR_HANDLER \
@@ -133,11 +143,19 @@
  */
 
 #define DO_CALL(syscall, args)						      \
-    svc     SYS_ify (syscall)
+  .if SYS_ify (syscall) < 256;						      \
+    svc SYS_ify (syscall);						      \
+  .else;								      \
+    lhi %r1,SYS_ify (syscall);						      \
+    svc 0;								      \
+  .endif
 
 #define ret                                                                   \
     br      14
 
+#define ret_NOERRNO							      \
+    br      14
+
 #endif /* __ASSEMBLER__ */
 
 #undef INLINE_SYSCALL
@@ -154,8 +172,8 @@
 #undef INTERNAL_SYSCALL_DECL
 #define INTERNAL_SYSCALL_DECL(err) do { } while (0)
 
-#undef INTERNAL_SYSCALL
-#define INTERNAL_SYSCALL(name, err, nr, args...)			      \
+#undef INTERNAL_SYSCALL_DIRECT
+#define INTERNAL_SYSCALL_DIRECT(name, err, nr, args...)			      \
   ({									      \
     DECLARGS_##nr(args)							      \
     register int _ret asm("2");						      \
@@ -166,6 +184,25 @@
     : "memory" );							      \
     _ret; })
 
+#undef INTERNAL_SYSCALL_SVC0
+#define INTERNAL_SYSCALL_SVC0(name, err, nr, args...)			      \
+  ({									      \
+    DECLARGS_##nr(args)							      \
+    register unsigned long _nr asm("1") = (unsigned long)(__NR_##name);	      \
+    register int _ret asm("2");						      \
+    asm volatile (							      \
+    "svc    0\n\t"							      \
+    : "=d" (_ret)							      \
+    : "d" (_nr), "i" (__NR_##name) ASMFMT_##nr				      \
+    : "memory" );							      \
+    _ret; })
+
+#undef INTERNAL_SYSCALL
+#define INTERNAL_SYSCALL(name, err, nr, args...)			      \
+  (((__NR_##name) < 256) ?						      \
+    INTERNAL_SYSCALL_DIRECT(name, err, nr, args) :			      \
+    INTERNAL_SYSCALL_SVC0(name, err,nr, args))
+
 #undef INTERNAL_SYSCALL_ERROR_P
 #define INTERNAL_SYSCALL_ERROR_P(val, err)				      \
   ((unsigned int) (val) >= 0xfffff001u)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/kernel_stat.h libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/kernel_stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/kernel_stat.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/kernel_stat.h	2003-06-13 01:15:15.000000000 +0900
@@ -0,0 +1,21 @@
+/* Definition of `struct stat' used in the kernel.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define STAT_IS_KERNEL_STAT 1
+#define XSTAT_IS_XSTAT64 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/syscall.S libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/syscall.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/syscall.S	2003-01-28 19:20:09.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/syscall.S	2003-03-04 03:17:44.000000000 +0900
@@ -37,16 +37,20 @@
 	lgr    %r4,%r5		   /* Third parameter.	*/
 	lgr    %r5,%r6		   /* Fourth parameter.	 */
 	lg     %r6,320(%r15)	   /* Fifth parameter.	*/
-	basr   %r7,0
-.L0:	ex     %r1,.L1-.L0(%r7)	   /* Lsb of R1 is subsituted as SVC number.  */
 
-	lg	%r15,0(%r15)	   /* Load back chain.	*/
+	basr   %r7,0
+0:	clg    %r1,4f-0b(%r7)      /* svc number < 256? */
+	jl     2f
+1:	svc    0
+	j      3f
+2:	ex     %r1,1b-0b(%r7)      /* lsb of R1 is subsituted as SVC number */
+3:	lg     %r15,0(%r15)        /* load back chain */
 	lmg	%r6,15,48(%r15)	   /* Load registers.  */
 
 	lghi   %r0,-4095
 	clgr   %r2,%r0		   /* Check R2 for error.  */
 	jgnl   SYSCALL_ERROR_LABEL
 	br     %r14		   /* Return to caller.	 */
-.L1:	.word  0x0A00		   /* Opcode for SVC 0.	 */
+4:	.quad  256
 PSEUDO_END (syscall)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list	2003-02-06 06:42:21.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/syscalls.list	2003-03-11 04:21:15.000000000 +0900
@@ -2,8 +2,8 @@
 
 llseek		EXTRA	lseek		C:3	__libc_lseek	__lseek lseek __libc_lseek64 __llseek llseek __lseek64 lseek64
 lseek		llseek	-
-pread		-	pread		C:4	__libc_pread	__libc_pread64 __pread pread __pread64 pread64
-pwrite		-	pwrite		C:4	__libc_pwrite	__libc_pwrite64 __pwrite pwrite __pwrite64 pwrite64
+pread		-	pread64		C:4	__libc_pread	__libc_pread64 __pread pread __pread64 pread64
+pwrite		-	pwrite64	C:4	__libc_pwrite	__libc_pwrite64 __pwrite pwrite __pwrite64 pwrite64
 fstatfs		-	fstatfs		i:ip	__fstatfs	fstatfs fstatfs64 __fstatfs64
 statfs		-	statfs		i:sp	__statfs	statfs statfs64
 getpeername	-	getpeername	i:ipp	__getpeername	getpeername
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h	2003-01-28 19:20:09.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/s390-64/sysdep.h	2003-05-10 13:38:07.000000000 +0900
@@ -1,5 +1,5 @@
 /* Assembler macros for 64 bit S/390.
-   Copyright (C) 2001,02 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    Contributed by Martin Schwidefsky (schwidefsky@de.ibm.com).
    This file is part of the GNU C Library.
 
@@ -31,6 +31,18 @@
 /* In newer 2.1 kernels __NR_syscall is missing so we define it here.  */
 #define __NR_syscall 0
 
+/*
+ * Newer kernel versions redefined __NR_pread and __NR_pwrite to
+ * __NR_pread64 and __NR_pwrite64. We use the new names but have
+ * to define them on our own for compiling against older kernels.
+ */
+#ifndef __NR_pread64
+# define __NR_pread64 __NR_pread
+#endif
+#ifndef __NR_pwrite64
+# define __NR_pwrite64 __NR_pwrite
+#endif
+
 #undef SYS_ify
 #define SYS_ify(syscall_name)	__NR_##syscall_name
 
@@ -60,6 +72,17 @@
   SYSCALL_ERROR_HANDLER;						      \
   END (name)
 
+#undef PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args)			      \
+  .text;								      \
+  ENTRY (name)								      \
+    DO_CALL (syscall_name, args)
+
+#undef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(name)					      \
+  SYSCALL_ERROR_HANDLER;						      \
+  END (name)
+
 #ifndef PIC
 # define SYSCALL_ERROR_LABEL syscall_error
 # define SYSCALL_ERROR_HANDLER
@@ -122,32 +145,40 @@
  */
 
 #define DO_CALL(syscall, args)						      \
-    svc	    SYS_ify (syscall)
+  .if SYS_ify (syscall) < 256;						      \
+    svc SYS_ify (syscall);						      \
+  .else;								      \
+    lghi %r1,SYS_ify (syscall);						      \
+    svc 0;								      \
+  .endif
 
 #define ret								      \
     br	    14
 
+#define ret_NOERRNO							      \
+    br	    14
+
 #endif /* __ASSEMBLER__ */
 
 #undef INLINE_SYSCALL
 #define INLINE_SYSCALL(name, nr, args...)				      \
   ({									      \
-    unsigned int _ret = INTERNAL_SYSCALL (name, , nr, args);		      \
+    long _ret = INTERNAL_SYSCALL (name, , nr, args);			      \
     if (__builtin_expect (INTERNAL_SYSCALL_ERROR_P (_ret, ), 0))	      \
      {									      \
        __set_errno (INTERNAL_SYSCALL_ERRNO (_ret, ));			      \
        _ret = -1;							      \
      }									      \
-    (int) _ret; })
+    _ret; })
 
 #undef INTERNAL_SYSCALL_DECL
 #define INTERNAL_SYSCALL_DECL(err) do { } while (0)
 
-#undef INTERNAL_SYSCALL
-#define INTERNAL_SYSCALL(name, err, nr, args...)			      \
+#undef INTERNAL_SYSCALL_DIRECT
+#define INTERNAL_SYSCALL_DIRECT(name, err, nr, args...)			      \
   ({									      \
     DECLARGS_##nr(args)							      \
-    register int _ret asm("2");						      \
+    register long _ret asm("2");					      \
     asm volatile (							      \
     "svc    %b1\n\t"							      \
     : "=d" (_ret)							      \
@@ -155,9 +186,28 @@
     : "memory" );							      \
     _ret; })
 
+#undef INTERNAL_SYSCALL_SVC0
+#define INTERNAL_SYSCALL_SVC0(name, err, nr, args...)			      \
+  ({									      \
+    DECLARGS_##nr(args)							      \
+    register unsigned long _nr asm("1") = (unsigned long)(__NR_##name);	      \
+    register long _ret asm("2");					      \
+    asm volatile (							      \
+    "svc    0\n\t"							      \
+    : "=d" (_ret)							      \
+    : "d" (_nr), "i" (__NR_##name) ASMFMT_##nr				      \
+    : "memory" );							      \
+    _ret; })
+
+#undef INTERNAL_SYSCALL
+#define INTERNAL_SYSCALL(name, err, nr, args...)			      \
+  (((__NR_##name) < 256) ?						      \
+    INTERNAL_SYSCALL_DIRECT(name, err, nr, args) :			      \
+    INTERNAL_SYSCALL_SVC0(name, err,nr, args))
+
 #undef INTERNAL_SYSCALL_ERROR_P
 #define INTERNAL_SYSCALL_ERROR_P(val, err)				      \
-  ((unsigned int) (val) >= 0xfffff001u)
+  ((unsigned long) (val) >= -4095UL)
 
 #undef INTERNAL_SYSCALL_ERRNO
 #define INTERNAL_SYSCALL_ERRNO(val, err)	(-(val))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/semtimedop.c libc-20030708/sysdeps/unix/sysv/linux/s390/semtimedop.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/semtimedop.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/semtimedop.c	2003-07-08 22:58:15.000000000 +0900
@@ -0,0 +1,38 @@
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Martin Schwidefsky <schwidefsky@de.ibm.com>, 2003.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <sys/sem.h>
+#include <ipc_priv.h>
+
+#include <sysdep.h>
+#include <sys/syscall.h>
+
+/* Perform user-defined atomical operation of array of semaphores.  */
+
+int
+semtimedop (semid, sops, nsops, timeout)
+     int semid;
+     struct sembuf *sops;
+     size_t nsops;
+     const struct timespec *timeout;
+{
+  return INLINE_SYSCALL (ipc, 5, IPCOP_semtimedop,
+			 semid, (int) nsops, timeout, sops);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/s390/system.c libc-20030708/sysdeps/unix/sysv/linux/s390/system.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/s390/system.c	2003-02-05 03:35:28.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/s390/system.c	2003-05-22 04:19:07.000000000 +0900
@@ -1 +1,34 @@
-#include <sysdeps/unix/sysv/linux/i386/system.c>
+/* Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <kernel-features.h>
+
+/* We have to and actually can handle cancelable system().  The big
+   problem: we have to kill the child process if necessary.  To do
+   this a cleanup handler has to be registered and is has to be able
+   to find the PID of the child.  The main problem is to reliable have
+   the PID when needed.  It is not necessary for the parent thread to
+   return.  It might still be in the kernel when the cancellation
+   request comes.  Therefore we have to use the clone() calls ability
+   to have the kernel write the PID into the user-level variable.  */
+#ifdef __ASSUME_CLONE_THREAD_FLAGS
+# define FORK() \
+  INLINE_SYSCALL (clone, 3, 0, CLONE_PARENT_SETTID | SIGCHLD, &pid)
+#endif
+
+#include "../system.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sched_getaffinity.c libc-20030708/sysdeps/unix/sysv/linux/sched_getaffinity.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sched_getaffinity.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sched_getaffinity.c	2003-05-10 14:35:19.000000000 +0900
@@ -0,0 +1,45 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <sched.h>
+#include <string.h>
+#include <sysdep.h>
+#include <sys/types.h>
+
+
+#ifdef __NR_sched_getaffinity
+int
+sched_getaffinity (pid, cpuset)
+     pid_t pid;
+     cpu_set_t *cpuset;
+{
+  int res = INLINE_SYSCALL (sched_getaffinity, 3, pid, sizeof (cpu_set_t),
+			    cpuset);
+  if (res != -1)
+    {
+      /* Clean the rest of the memory the kernel didn't do.  */
+      memset ((char *) cpuset + res, '\0', sizeof (cpu_set_t) - res);
+
+      res = 0;
+    }
+  return res;
+}
+#else
+# include <sysdeps/generic/sched_getaffinity.c>
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sched_setaffinity.c libc-20030708/sysdeps/unix/sysv/linux/sched_setaffinity.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sched_setaffinity.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sched_setaffinity.c	2003-05-10 14:35:31.000000000 +0900
@@ -0,0 +1,37 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <sched.h>
+#include <string.h>
+#include <sysdep.h>
+#include <sys/types.h>
+
+
+#ifdef __NR_sched_setaffinity
+int
+sched_setaffinity (pid, cpuset)
+     pid_t pid;
+     const cpu_set_t *cpuset;
+{
+  return INLINE_SYSCALL (sched_setaffinity, 3, pid, sizeof (cpu_set_t),
+			 cpuset);
+}
+#else
+# include <sysdeps/generic/sched_setaffinity.c>
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/semtimedop.c libc-20030708/sysdeps/unix/sysv/linux/semtimedop.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/semtimedop.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/semtimedop.c	2003-05-02 06:39:55.000000000 +0900
@@ -0,0 +1,40 @@
+/* Copyright (C) 1995, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@cygnus.com>, August 1995.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <sys/sem.h>
+#include <ipc_priv.h>
+
+#include <sysdep.h>
+#include <sys/syscall.h>
+#include <bp-checks.h>
+
+/* Perform user-defined atomical operation of array of semaphores.  */
+
+int
+semtimedop (semid, sops, nsops, timeout)
+     int semid;
+     struct sembuf *sops;
+     size_t nsops;
+     const struct timespec *timeout;
+{
+  return INLINE_SYSCALL (ipc, 6, IPCOP_semtimedop,
+			 semid, (int) nsops, 0, CHECK_N (sops, nsops),
+			 timeout);
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/setegid.c libc-20030708/sysdeps/unix/sysv/linux/setegid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/setegid.c	2002-08-13 23:29:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/setegid.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,7 +21,10 @@
 #include <sys/types.h>
 #include <unistd.h>
 
-#ifdef __NR_setresgid
+#include <sysdep.h>
+#include "kernel-features.h"
+
+#if defined __NR_setresgid || __ASSUME_SETRESGID_SYSCALL > 0
 
 extern int __setresgid (gid_t rgid, gid_t egid, gid_t sgid);
 
@@ -36,15 +39,21 @@
       return -1;
     }
 
+# if __ASSUME_32BITUIDS > 0 && defined __NR_setresgid32
+  return INLINE_SYSCALL (setresgid32, 3, -1, gid, -1);
+# else
   /* First try the syscall.  */
   result = __setresgid (-1, gid, -1);
+#  if __ASSUME_SETRESGID_SYSCALL == 0
   if (result == -1 && errno == ENOSYS)
     /* No system call available.  Use emulation.  This may not work
        since `setregid' also sets the saved group ID when GID is not
        equal to the real group ID, making it impossible to switch back. */
     result = __setregid (-1, gid);
+#  endif
 
   return result;
+# endif
 }
 libc_hidden_def (setegid)
 #else
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/seteuid.c libc-20030708/sysdeps/unix/sysv/linux/seteuid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/seteuid.c	2002-08-13 23:29:42.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/seteuid.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 1999, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 1999, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,6 +21,7 @@
 #include <sys/types.h>
 #include <unistd.h>
 
+#include <sysdep.h>
 #include "kernel-features.h"
 
 #if defined __NR_setresuid || __ASSUME_SETRESUID_SYSCALL > 0
@@ -38,6 +39,9 @@
       return -1;
     }
 
+# if __ASSUME_32BITUIDS > 0 && defined __NR_setresuid32
+  return INLINE_SYSCALL (setresuid32, 3, -1, uid, -1);
+# else
   /* First try the syscall.  */
   result = __setresuid (-1, uid, -1);
 # if __ASSUME_SETRESUID_SYSCALL == 0
@@ -49,6 +53,7 @@
 # endif
 
   return result;
+# endif
 }
 libc_hidden_def (seteuid)
 #else
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sh/bits/atomic.h libc-20030708/sysdeps/unix/sysv/linux/sh/bits/atomic.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sh/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sh/bits/atomic.h	2003-05-10 13:38:07.000000000 +0900
@@ -0,0 +1,419 @@
+/* Atomic operations used inside libc.  Linux/SH version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+/* SH kernel has implemented a gUSA ("g" User Space Atomicity) support
+   for the user space atomicity. The atomicity macros use this scheme.
+
+  Reference:
+    Niibe Yutaka, "gUSA: Simple and Efficient User Space Atomicity
+    Emulation with Little Kernel Modification", Linux Conference 2002,
+    Japan. http://lc.linux.or.jp/lc2002/papers/niibe0919h.pdf (in
+    Japanese).
+
+    B.N. Bershad, D. Redell, and J. Ellis, "Fast Mutual Exclusion for
+    Uniprocessors",  Proceedings of the Fifth Architectural Support for
+    Programming Languages and Operating Systems (ASPLOS), pp. 223-233,
+    October 1992. http://www.cs.washington.edu/homes/bershad/Papers/Rcs.ps
+
+  SuperH ABI:
+      r15:    -(size of atomic instruction sequence) < 0
+      r0:     end point
+      r1:     saved stack pointer
+*/
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  ({ __typeof (*(mem)) __result; \
+     __asm __volatile ("\
+	.align 2\n\
+	mova 1f,r0\n\
+	nop\n\
+	mov r15,r1\n\
+	mov #-8,r15\n\
+     0: mov.b @%1,%0\n\
+	cmp/eq %0,%3\n\
+	bf 1f\n\
+	mov.b %2,@%1\n\
+     1: mov r1,r15"\
+	: "=&r" (__result) : "r" (mem), "r" (newval), "r" (oldval) \
+	: "r0", "r1", "t", "memory"); \
+     __result; })
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  ({ __typeof (*(mem)) __result; \
+     __asm __volatile ("\
+	.align 2\n\
+	mova 1f,r0\n\
+	nop\n\
+	mov r15,r1\n\
+	mov #-8,r15\n\
+     0: mov.w @%1,%0\n\
+	cmp/eq %0,%3\n\
+	bf 1f\n\
+	mov.w %2,@%1\n\
+     1: mov r1,r15"\
+	: "=&r" (__result) : "r" (mem), "r" (newval), "r" (oldval) \
+	: "r0", "r1", "t", "memory"); \
+     __result; })
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+  ({ __typeof (*(mem)) __result; \
+     __asm __volatile ("\
+	.align 2\n\
+	mova 1f,r0\n\
+	nop\n\
+	mov r15,r1\n\
+	mov #-8,r15\n\
+     0: mov.l @%1,%0\n\
+	cmp/eq %0,%3\n\
+	bf 1f\n\
+	mov.l %2,@%1\n\
+     1: mov r1,r15"\
+	: "=&r" (__result) : "r" (mem), "r" (newval), "r" (oldval) \
+	: "r0", "r1", "t", "memory"); \
+     __result; })
+
+/* XXX We do not really need 64-bit compare-and-exchange.  At least
+   not in the moment.  Using it would mean causing portability
+   problems since not many other 32-bit architectures have support for
+   such an operation.  So don't define any code for now.  */
+
+# define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  (abort (), (__typeof (*mem)) 0)
+
+#define atomic_exchange_and_add(mem, value) \
+  ({ __typeof (*(mem)) __result, __tmp, __value = (value); \
+     if (sizeof (*(mem)) == 1) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.b @%2,%0\n\
+	  add %0,%1\n\
+	  mov.b %1,@%2\n\
+       1: mov r1,r15"\
+	: "=&r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "memory"); \
+     else if (sizeof (*(mem)) == 2) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.w @%2,%0\n\
+	  add %0,%1\n\
+	  mov.w %1,@%2\n\
+       1: mov r1,r15"\
+	: "=&r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "memory"); \
+     else if (sizeof (*(mem)) == 4) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.l @%2,%0\n\
+	  add %0,%1\n\
+	  mov.l %1,@%2\n\
+       1: mov r1,r15"\
+	: "=&r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "memory"); \
+     else \
+       { \
+	 __typeof (mem) memp = (mem); \
+	 do \
+	   __result = *memp; \
+	 while (__arch_compare_and_exchange_val_64_acq \
+		 (memp,	__result + __value, __result) == __result); \
+	 (void) __value; \
+       } \
+     __result; })
+
+#define atomic_add(mem, value) \
+  (void) ({ __typeof (*(mem)) __tmp, __value = (value); \
+	    if (sizeof (*(mem)) == 1) \
+	      __asm __volatile ("\
+		.align 2\n\
+		mova 1f,r0\n\
+		mov r15,r1\n\
+		mov #-6,r15\n\
+	     0: mov.b @%1,r2\n\
+		add r2,%0\n\
+		mov.b %0,@%1\n\
+	     1: mov r1,r15"\
+		: "=&r" (__tmp) : "r" (mem), "0" (__value) \
+		: "r0", "r1", "r2", "memory"); \
+	    else if (sizeof (*(mem)) == 2) \
+	      __asm __volatile ("\
+		.align 2\n\
+		mova 1f,r0\n\
+		mov r15,r1\n\
+		mov #-6,r15\n\
+	     0: mov.w @%1,r2\n\
+		add r2,%0\n\
+		mov.w %0,@%1\n\
+	     1: mov r1,r15"\
+		: "=&r" (__tmp) : "r" (mem), "0" (__value) \
+		: "r0", "r1", "r2", "memory"); \
+	    else if (sizeof (*(mem)) == 4) \
+	      __asm __volatile ("\
+		.align 2\n\
+		mova 1f,r0\n\
+		mov r15,r1\n\
+		mov #-6,r15\n\
+	     0: mov.l @%1,r2\n\
+		add r2,%0\n\
+		mov.l %0,@%1\n\
+	     1: mov r1,r15"\
+		: "=&r" (__tmp) : "r" (mem), "0" (__value) \
+		: "r0", "r1", "r2", "memory"); \
+	    else \
+	      { \
+		__typeof (*(mem)) oldval; \
+		__typeof (mem) memp = (mem); \
+		do \
+		  oldval = *memp; \
+		while (__arch_compare_and_exchange_val_64_acq \
+			(memp, oldval + __value, oldval) == oldval); \
+		(void) __value; \
+	      } \
+	    })
+
+#define atomic_add_negative(mem, value) \
+  ({ unsigned char __result; \
+     __typeof (*(mem)) __tmp, __value = (value); \
+     if (sizeof (*(mem)) == 1) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.b @%2,r2\n\
+	  add r2,%1\n\
+	  mov.b %1,@%2\n\
+       1: mov r1,r15\n\
+	  shal %1\n\
+	  movt %0"\
+	: "=r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "r2", "t", "memory"); \
+     else if (sizeof (*(mem)) == 2) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.w @%2,r2\n\
+	  add r2,%1\n\
+	  mov.w %1,@%2\n\
+       1: mov r1,r15\n\
+	  shal %1\n\
+	  movt %0"\
+	: "=r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "r2", "t", "memory"); \
+     else if (sizeof (*(mem)) == 4) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.l @%2,r2\n\
+	  add r2,%1\n\
+	  mov.l %1,@%2\n\
+       1: mov r1,r15\n\
+	  shal %1\n\
+	  movt %0"\
+	: "=r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "r2", "t", "memory"); \
+     else \
+       abort (); \
+     __result; })
+
+#define atomic_add_zero(mem, value) \
+  ({ unsigned char __result; \
+     __typeof (*(mem)) __tmp, __value = (value); \
+     if (sizeof (*(mem)) == 1) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.b @%2,r2\n\
+	  add r2,%1\n\
+	  mov.b %1,@%2\n\
+       1: mov r1,r15\n\
+	  tst %1,%1\n\
+	  movt %0"\
+	: "=r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "r2", "t", "memory"); \
+     else if (sizeof (*(mem)) == 2) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.w @%2,r2\n\
+	  add r2,%1\n\
+	  mov.w %1,@%2\n\
+       1: mov r1,r15\n\
+	  tst %1,%1\n\
+	  movt %0"\
+	: "=r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "r2", "t", "memory"); \
+     else if (sizeof (*(mem)) == 4) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  mov r15,r1\n\
+	  mov #-6,r15\n\
+       0: mov.l @%2,r2\n\
+	  add r2,%1\n\
+	  mov.l %1,@%2\n\
+       1: mov r1,r15\n\
+	  tst %1,%1\n\
+	  movt %0"\
+	: "=r" (__result), "=&r" (__tmp) : "r" (mem), "1" (__value) \
+	: "r0", "r1", "r2", "t", "memory"); \
+     else \
+       abort (); \
+     __result; })
+
+#define atomic_increment_and_test(mem) atomic_add_zero((mem), 1)
+#define atomic_decrement_and_test(mem) atomic_add_zero((mem), -1)
+
+#define atomic_bit_set(mem, bit) \
+  (void) ({ unsigned int __mask = 1 << (bit); \
+	    if (sizeof (*(mem)) == 1) \
+	      __asm __volatile ("\
+		.align 2\n\
+		mova 1f,r0\n\
+		mov r15,r1\n\
+		mov #-6,r15\n\
+	     0: mov.b @%0,r2\n\
+		or %1,r2\n\
+		mov.b r2,@%0\n\
+	     1: mov r1,r15"\
+		: : "r" (mem), "r" (__mask) \
+		: "r0", "r1", "r2", "memory"); \
+	    else if (sizeof (*(mem)) == 2) \
+	      __asm __volatile ("\
+		.align 2\n\
+		mova 1f,r0\n\
+		mov r15,r1\n\
+		mov #-6,r15\n\
+	     0: mov.w @%0,r2\n\
+		or %1,r2\n\
+		mov.w r2,@%0\n\
+	     1: mov r1,r15"\
+		: : "r" (mem), "r" (__mask) \
+		: "r0", "r1", "r2", "memory"); \
+	    else if (sizeof (*(mem)) == 4) \
+	      __asm __volatile ("\
+		.align 2\n\
+		mova 1f,r0\n\
+		mov r15,r1\n\
+		mov #-6,r15\n\
+	     0: mov.l @%0,r2\n\
+		or %1,r2\n\
+		mov.l r2,@%0\n\
+	     1: mov r1,r15"\
+		: : "r" (mem), "r" (__mask) \
+		: "r0", "r1", "r2", "memory"); \
+	    else \
+	      abort (); \
+	    })
+
+#define atomic_bit_test_set(mem, bit) \
+  ({ unsigned int __mask = 1 << (bit); \
+     unsigned int __result = __mask; \
+     if (sizeof (*(mem)) == 1) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  nop\n\
+	  mov r15,r1\n\
+	  mov #-8,r15\n\
+       0: mov.b @%2,r2\n\
+	  or r2,%1\n\
+	  and r2,%0\n\
+	  mov.b %1,@%2\n\
+       1: mov r1,r15"\
+	: "=&r" (__result), "=&r" (__mask) \
+	: "r" (mem), "0" (__result), "1" (__mask) \
+	: "r0", "r1", "r2", "memory"); \
+     else if (sizeof (*(mem)) == 2) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  nop\n\
+	  mov r15,r1\n\
+	  mov #-8,r15\n\
+       0: mov.w @%2,r2\n\
+	  or r2,%1\n\
+	  and r2,%0\n\
+	  mov.w %1,@%2\n\
+       1: mov r1,r15"\
+	: "=&r" (__result), "=&r" (__mask) \
+	: "r" (mem), "0" (__result), "1" (__mask) \
+	: "r0", "r1", "r2", "memory"); \
+     else if (sizeof (*(mem)) == 4) \
+       __asm __volatile ("\
+	  .align 2\n\
+	  mova 1f,r0\n\
+	  nop\n\
+	  mov r15,r1\n\
+	  mov #-8,r15\n\
+       0: mov.l @%2,r2\n\
+	  or r2,%1\n\
+	  and r2,%0\n\
+	  mov.l %1,@%2\n\
+       1: mov r1,r15"\
+	: "=&r" (__result), "=&r" (__mask) \
+	: "r" (mem), "0" (__result), "1" (__mask) \
+	: "r0", "r1", "r2", "memory"); \
+     else \
+       abort (); \
+     __result; })
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sh/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/sh/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sh/sysdep.h	2003-02-08 11:29:54.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sh/sysdep.h	2003-03-25 19:49:29.000000000 +0900
@@ -65,6 +65,18 @@
 #define	PSEUDO_END(name) \
   END (name)
 
+#undef	PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args) \
+ .text; \
+ ENTRY (name); \
+    DO_CALL (syscall_name, args)
+
+#undef	PSEUDO_END_NOERRNO
+#define	PSEUDO_END_NOERRNO(name) \
+  END (name)
+
+#define ret_NOERRNO ret
+
 #ifndef PIC
 # define SYSCALL_ERROR_HANDLER	\
 	mov.l 0f,r1; \
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/siglist.h libc-20030708/sysdeps/unix/sysv/linux/siglist.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/siglist.h	2002-11-02 11:16:02.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/siglist.h	2003-04-01 21:01:06.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997, 1998, 1999, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996,1997,1998,1999,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,3 +21,5 @@
 #include_next <siglist.h>	/* Get the canonical list.  */
 
 #define	OLD_SIGLIST_SIZE	32 /* For GLIBC_2.0 binary compatibility.  */
+
+#define OLD2_SIGLIST_SIZE	64 /* For GLIBC_2.1 binary compatibility.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sigprocmask.c libc-20030708/sysdeps/unix/sysv/linux/sigprocmask.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sigprocmask.c	2001-07-08 04:21:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sigprocmask.c	2003-04-28 23:53:25.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1997,1998,1999,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -44,6 +44,19 @@
      const sigset_t *set;
      sigset_t *oset;
 {
+#ifdef SIGCANCEL
+  sigset_t local_newmask;
+
+  /* The only thing we have to make sure here is that SIGCANCEL is not
+     blocked.  */
+  if (set != NULL && __builtin_expect (__sigismember (set, SIGCANCEL), 0))
+    {
+      local_newmask = *set;
+      __sigdelset (&local_newmask, SIGCANCEL);
+      set = &local_newmask;
+    }
+#endif
+
 #if __ASSUME_REALTIME_SIGNALS > 0
   return INLINE_SYSCALL (rt_sigprocmask, 4, how, CHECK_SIGSET_NULL_OK (set),
 			 CHECK_SIGSET_NULL_OK (oset), _NSIG / 8);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sigtimedwait.c libc-20030708/sysdeps/unix/sysv/linux/sigtimedwait.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sigtimedwait.c	2002-12-15 18:11:58.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sigtimedwait.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -28,6 +28,38 @@
 				      const struct timespec *__unbounded, size_t);
 
 
+static int
+do_sigtimedwait (const sigset_t *set, siginfo_t *info,
+		 const struct timespec *timeout)
+{
+#ifdef SIGCANCEL
+  sigset_t tmpset;
+  if (set != NULL && __sigismember (set, SIGCANCEL))
+    {
+      /* Create a temporary mask without the bit for SIGCANCEL set.  */
+      // We are not copying more than we have to.
+      memcpy (&tmpset, set, _NSIG / 8);
+      __sigdelset (&tmpset, SIGCANCEL);
+      set = &tmpset;
+    }
+#endif
+
+    /* XXX The size argument hopefully will have to be changed to the
+       real size of the user-level sigset_t.  */
+  int result = INLINE_SYSCALL (rt_sigtimedwait, 4, CHECK_SIGSET (set),
+			       CHECK_1 (info), timeout, _NSIG / 8);
+
+  /* The kernel generates a SI_TKILL code in si_code in case tkill is
+     used.  tkill is transparently used in raise().  Since having
+     SI_TKILL as a code is useful in general we fold the results
+     here.  */
+  if (result != -1 && info != NULL && info->si_code == SI_TKILL)
+    info->si_code = SI_USER;
+
+  return result;
+}
+
+
 /* Return any pending signal or wait for one for the given time.  */
 int
 __sigtimedwait (set, info, timeout)
@@ -36,17 +68,13 @@
      const struct timespec *timeout;
 {
   if (SINGLE_THREAD_P)
-    /* XXX The size argument hopefully will have to be changed to the
-       real size of the user-level sigset_t.  */
-    return INLINE_SYSCALL (rt_sigtimedwait, 4, CHECK_SIGSET (set),
-			   CHECK_1 (info), timeout, _NSIG / 8);
+    return do_sigtimedwait (set, info, timeout);
 
   int oldtype = LIBC_CANCEL_ASYNC ();
 
   /* XXX The size argument hopefully will have to be changed to the
      real size of the user-level sigset_t.  */
-  int result = INLINE_SYSCALL (rt_sigtimedwait, 4, CHECK_SIGSET (set),
-			       CHECK_1 (info), timeout, _NSIG / 8);
+  int result = do_sigtimedwait (set, info, timeout);
 
   LIBC_CANCEL_RESET (oldtype);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sigwait.c libc-20030708/sysdeps/unix/sysv/linux/sigwait.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sigwait.c	2003-01-09 11:54:57.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sigwait.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -36,6 +36,18 @@
 {
   int ret;
 
+#ifdef SIGCANCEL
+  sigset_t tmpset;
+  if (set != NULL && __sigismember (set, SIGCANCEL))
+    {
+      /* Create a temporary mask without the bit for SIGCANCEL set.  */
+      // We are not copying more than we have to.
+      memcpy (&tmpset, set, _NSIG / 8);
+      __sigdelset (&tmpset, SIGCANCEL);
+      set = &tmpset;
+    }
+#endif
+
   /* XXX The size argument hopefully will have to be changed to the
      real size of the user-level sigset_t.  */
 #ifdef INTERNAL_SYSCALL
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sigwaitinfo.c libc-20030708/sysdeps/unix/sysv/linux/sigwaitinfo.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sigwaitinfo.c	2002-12-15 18:26:36.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sigwaitinfo.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1997, 1998, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -30,6 +30,37 @@
 				      const struct timespec *__unbounded, size_t);
 
 
+static int
+do_sigwaitinfo (const sigset_t *set, siginfo_t *info)
+{
+#ifdef SIGCANCEL
+  sigset_t tmpset;
+  if (set != NULL && __sigismember (set, SIGCANCEL))
+    {
+      /* Create a temporary mask without the bit for SIGCANCEL set.  */
+      // We are not copying more than we have to.
+      memcpy (&tmpset, set, _NSIG / 8);
+      __sigdelset (&tmpset, SIGCANCEL);
+      set = &tmpset;
+    }
+#endif
+
+  /* XXX The size argument hopefully will have to be changed to the
+     real size of the user-level sigset_t.  */
+  int result = INLINE_SYSCALL (rt_sigtimedwait, 4, CHECK_SIGSET (set),
+			       CHECK_1 (info), NULL, _NSIG / 8);
+
+  /* The kernel generates a SI_TKILL code in si_code in case tkill is
+     used.  tkill is transparently used in raise().  Since having
+     SI_TKILL as a code is useful in general we fold the results
+     here.  */
+  if (result != -1 && info != NULL && info->si_code == SI_TKILL)
+    info->si_code = SI_USER;
+
+  return result;
+}
+
+
 /* Return any pending signal or wait for one for the given time.  */
 int
 __sigwaitinfo (set, info)
@@ -37,17 +68,13 @@
      siginfo_t *info;
 {
   if (SINGLE_THREAD_P)
-    /* XXX The size argument hopefully will have to be changed to the
-       real size of the user-level sigset_t.  */
-    return INLINE_SYSCALL (rt_sigtimedwait, 4, CHECK_SIGSET (set),
-			   CHECK_1 (info), NULL, _NSIG / 8);
+    return do_sigwaitinfo (set, info);
 
   int oldtype = LIBC_CANCEL_ASYNC ();
 
   /* XXX The size argument hopefully will have to be changed to the
      real size of the user-level sigset_t.  */
-  int result = INLINE_SYSCALL (rt_sigtimedwait, 4, CHECK_SIGSET (set),
-			       CHECK_1 (info), NULL, _NSIG / 8);
+  int result = do_sigwaitinfo (set, info);
 
   LIBC_CANCEL_RESET (oldtype);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sleep.c libc-20030708/sysdeps/unix/sysv/linux/sleep.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sleep.c	2002-12-16 13:26:37.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sleep.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Implementation of the POSIX sleep function using nanosleep.
-   Copyright (C) 1996, 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1998, 1999, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -22,27 +22,60 @@
 #include <time.h>
 #include <signal.h>
 #include <unistd.h>
+#include <sys/param.h>
+
+
+#if 0
+static void
+cl (void *arg)
+{
+  (void) __sigprocmask (SIG_SETMASK, arg, (sigset_t *) NULL);
+}
+#endif
+
 
 /* We are going to use the `nanosleep' syscall of the kernel.  But the
-   kernel does not implement the sstupid SysV SIGCHLD vs. SIG_IGN
+   kernel does not implement the stupid SysV SIGCHLD vs. SIG_IGN
    behaviour for this syscall.  Therefore we have to emulate it here.  */
 unsigned int
 __sleep (unsigned int seconds)
 {
-  struct timespec ts = { .tv_sec = (long int) seconds, .tv_nsec = 0 };
+  const unsigned int max = ((unsigned long int) (~((time_t) 0))) >> 1;
+  struct timespec ts;
   sigset_t set, oset;
   unsigned int result;
 
   /* This is not necessary but some buggy programs depend on this.  */
-  if (seconds == 0)
-    return 0;
+  if (__builtin_expect (seconds == 0, 0))
+    {
+#ifdef CANCELLATION_P
+      CANCELLATION_P (THREAD_SELF);
+#endif
+      return 0;
+    }
+
+  ts.tv_sec = 0;
+  ts.tv_nsec = 0;
+ again:
+  if (sizeof (ts.tv_sec) <= sizeof (seconds))
+    {
+      /* Since SECONDS is unsigned assigning the value to .tv_sec can
+	 overflow it.  In this case we have to wait in steps.  */
+      ts.tv_sec += MIN (seconds, max);
+      seconds -= (unsigned int) ts.tv_sec;
+    }
+  else
+    {
+      ts.tv_sec = (time_t) seconds;
+      seconds = 0;
+    }
 
   /* Linux will wake up the system call, nanosleep, when SIGCHLD
      arrives even if SIGCHLD is ignored.  We have to deal with it
      in libc.  We block SIGCHLD first.  */
-  if (__sigemptyset (&set) < 0
-      || __sigaddset (&set, SIGCHLD) < 0
-      || __sigprocmask (SIG_BLOCK, &set, &oset))
+  __sigemptyset (&set);
+  __sigaddset (&set, SIGCHLD);
+  if (__sigprocmask (SIG_BLOCK, &set, &oset))
     return -1;
 
   /* If SIGCHLD is already blocked, we don't have to do anything.  */
@@ -51,8 +84,8 @@
       int saved_errno;
       struct sigaction oact;
 
-      if (__sigemptyset (&set) < 0 || __sigaddset (&set, SIGCHLD) < 0)
-	return -1;
+      __sigemptyset (&set);
+      __sigaddset (&set, SIGCHLD);
 
       /* We get the signal handler for SIGCHLD.  */
       if (__sigaction (SIGCHLD, (struct sigaction *) NULL, &oact) < 0)
@@ -64,29 +97,50 @@
 	  return -1;
 	}
 
+      /* Note the sleep() is a cancellation point.  But since we call
+	 nanosleep() which itself is a cancellation point we do not
+	 have to do anything here.  */
       if (oact.sa_handler == SIG_IGN)
 	{
+	  //__libc_cleanup_push (cl, &oset);
+
 	  /* We should leave SIGCHLD blocked.  */
-	  result = __nanosleep (&ts, &ts);
+	  while (1)
+	    {
+	      result = __nanosleep (&ts, &ts);
+
+	      if (result != 0 || seconds == 0)
+		break;
+
+	      if (sizeof (ts.tv_sec) <= sizeof (seconds))
+		{
+		  ts.tv_sec = MIN (seconds, max);
+		  seconds -= (unsigned int) ts.tv_nsec;
+		}
+	    }
+
+	  //__libc_cleanup_pop (0);
 
 	  saved_errno = errno;
 	  /* Restore the original signal mask.  */
 	  (void) __sigprocmask (SIG_SETMASK, &oset, (sigset_t *) NULL);
 	  __set_errno (saved_errno);
+
+	  goto out;
 	}
-      else
-	{
-	  /* We should unblock SIGCHLD.  Restore the original signal mask.  */
-	  (void) __sigprocmask (SIG_SETMASK, &oset, (sigset_t *) NULL);
-	  result = __nanosleep (&ts, &ts);
-	}
+
+      /* We should unblock SIGCHLD.  Restore the original signal mask.  */
+      (void) __sigprocmask (SIG_SETMASK, &oset, (sigset_t *) NULL);
     }
-  else
-    result = __nanosleep (&ts, &ts);
 
+  result = __nanosleep (&ts, &ts);
+  if (result == 0 && seconds != 0)
+    goto again;
+
+ out:
   if (result != 0)
     /* Round remaining time.  */
-    result = (unsigned int) ts.tv_sec + (ts.tv_nsec >= 500000000L);
+    result = seconds + (unsigned int) ts.tv_sec + (ts.tv_nsec >= 500000000L);
 
   return result;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/siginfo.h libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/siginfo.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/siginfo.h	2002-12-05 09:22:51.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/siginfo.h	2003-04-28 23:53:26.000000000 +0900
@@ -1,5 +1,5 @@
 /* siginfo_t, sigevent and constants.  Linux/SPARC version.
-   Copyright (C) 1997,1998,1999,2000,2001,2002 Free Software Foundation, Inc.
+   Copyright (C) 1997-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -69,8 +69,9 @@
 	/* POSIX.1b timers.  */
 	struct
 	  {
-	    unsigned int _timer1;
-	    unsigned int _timer2;
+	    int si_tid;		/* Timer ID.  */
+	    int si_overrun;	/* Overrun count.  */
+	    sigval_t si_sigval;	/* Signal value.  */
 	  } _timer;
 
 	/* POSIX.1b signals.  */
@@ -111,8 +112,8 @@
 /* X/Open requires some more fields with fixed names.  */
 # define si_pid		_sifields._kill.si_pid
 # define si_uid		_sifields._kill.si_uid
-# define si_timer1	_sifields._timer._timer1
-# define si_timer2	_sifields._timer._timer2
+# define si_timerid	_sifields._timer.si_tid
+# define si_overrun	_sifields._timer.si_overrun
 # define si_status	_sifields._sigchld.si_status
 # define si_utime	_sifields._sigchld.si_utime
 # define si_stime	_sifields._sigchld.si_stime
@@ -129,8 +130,10 @@
    signals.  */
 enum
 {
-  SI_ASYNCNL = -6,		/* Sent by asynch name lookup completion.  */
+  SI_ASYNCNL = -60,		/* Sent by asynch name lookup completion.  */
 # define SI_ASYNCNL	SI_ASYNCNL
+  SI_TKILL = -6,		/* Sent by tkill.  */
+# define SI_TKILL	SI_TKILL
   SI_SIGIO,			/* Sent by queued SIGIO. */
 # define SI_SIGIO	SI_SIGIO
   SI_ASYNCIO,			/* Sent by AIO completion.  */
@@ -276,9 +279,6 @@
 #  define __SIGEV_PAD_SIZE	((__SIGEV_MAX_SIZE / sizeof (int)) - 3)
 # endif
 
-/* Forward declaration of the `pthread_attr_t' type.  */
-struct __pthread_attr_s;
-
 typedef struct sigevent
   {
     sigval_t sigev_value;
@@ -308,8 +308,11 @@
 # define SIGEV_SIGNAL	SIGEV_SIGNAL
   SIGEV_NONE,			/* Other notification: meaningless.  */
 # define SIGEV_NONE	SIGEV_NONE
-  SIGEV_THREAD			/* Deliver via thread creation.  */
+  SIGEV_THREAD,			/* Deliver via thread creation.  */
 # define SIGEV_THREAD	SIGEV_THREAD
+
+  SIGEV_THREAD_ID = 4		/* Send signal to specific thread.  */
+#define SIGEV_THREAD_ID	SIGEV_THREAD_ID
 };
 
 #endif	/* have _SIGNAL_H.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/signum.h libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/signum.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/signum.h	2001-07-08 04:21:36.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/signum.h	2003-04-01 21:01:07.000000000 +0900
@@ -1,5 +1,5 @@
 /* Signal number definitions.  Linux/SPARC version.
-   Copyright (C) 1996, 1997, 1998 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1998, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -70,7 +70,7 @@
 #define SIGUSR1		30
 #define SIGUSR2		31
 
-#define	_NSIG		64	/* Biggest signal number + 1
+#define	_NSIG		65	/* Biggest signal number + 1
 				   (including real-time signals).  */
 
 #define SIGRTMIN        (__libc_current_sigrtmin ())
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/stat.h	2003-01-01 05:08:58.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/stat.h	2003-07-08 22:58:15.000000000 +0900
@@ -150,6 +150,8 @@
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
 #define _STATBUF_ST_RDEV
+/* Nanosecond resolution time values are supported.  */
+#define _STATBUF_ST_NSEC
 
 /* Encoding of the file mode.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h	2002-10-24 08:48:46.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/bits/typesizes.h	2003-03-28 21:28:21.000000000 +0900
@@ -1,5 +1,5 @@
 /* bits/typesizes.h -- underlying types for *_t.  Linux/SPARC version.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -54,7 +54,7 @@
 #define __SWBLK_T_TYPE		__SLONGWORD_TYPE
 #define __KEY_T_TYPE		__S32_TYPE
 #define __CLOCKID_T_TYPE	__S32_TYPE
-#define __TIMER_T_TYPE		__S32_TYPE
+#define __TIMER_T_TYPE		void *
 #define __BLKSIZE_T_TYPE	__SLONGWORD_TYPE
 #define __FSID_T_TYPE		struct { int __val[2]; }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/dl-cache.h libc-20030708/sysdeps/unix/sysv/linux/sparc/dl-cache.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/dl-cache.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/dl-cache.h	2003-06-25 17:03:35.000000000 +0900
@@ -0,0 +1,39 @@
+/* Support for reading /etc/ld.so.cache files written by Linux ldconfig.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define add_system_dir(dir) \
+  do								\
+    {								\
+      size_t len = strlen (dir);				\
+      char path[len + 3];					\
+      memcpy (path, dir, len + 1);				\
+      if (len >= 6 && ! memcmp (path + len - 6, "/lib64", 6))	\
+	{							\
+	  len -= 2;						\
+	  path[len] = '\0';					\
+	}							\
+      add_dir (path);						\
+      if (len >= 4 && ! memcmp (path + len - 4, "/lib", 4))	\
+	{							\
+	  memcpy (path + len, "64", 3);				\
+	  add_dir (path);					\
+	}							\
+    } while (0)
+
+#include <sysdeps/generic/dl-cache.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc32/setegid.c libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc32/setegid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc32/setegid.c	2002-08-13 23:29:44.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc32/setegid.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1998, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -38,11 +38,13 @@
 
   /* First try the syscall.  */
   result = __setresgid (-1, gid, -1);
+# if __ASSUME_SETRESGID_SYSCALL == 0
   if (result == -1 && errno == ENOSYS)
     /* No system call available.  Use emulation.  This may not work
        since `setregid' also sets the saved group ID when GID is not
        equal to the real group ID, making it impossible to switch back. */
     result = __setregid (-1, gid);
+# endif
 
   return result;
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc32/sysdep.h	2003-03-25 19:49:29.000000000 +0900
@@ -35,6 +35,7 @@
 
 /* Linux/SPARC uses a different trap number */
 #undef PSEUDO
+#undef PSEUDO_NOERRNO
 #undef ENTRY
 #undef END
 #undef LOC
@@ -108,6 +109,12 @@
 	 nop;							\
 	SYSCALL_ERROR_HANDLER
 
+#define PSEUDO_NOERRNO(name, syscall_name, args)		\
+	.text;							\
+	ENTRY(name);						\
+	LOADSYSCALL(syscall_name);				\
+	ta 0x10
+
 #else  /* __ASSEMBLER__ */
 
 #define __SYSCALL_STRING						\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc64/pause.c libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc64/pause.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc64/pause.c	1999-06-02 20:10:10.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc64/pause.c	2003-03-15 08:37:01.000000000 +0900
@@ -1 +1 @@
-#include <sysdeps/unix/common/pause.c>
+#include <sysdeps/posix/pause.c>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc64/sigsuspend.c libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc64/sigsuspend.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc64/sigsuspend.c	2002-12-11 05:31:58.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc64/sigsuspend.c	2003-04-15 23:55:51.000000000 +0900
@@ -1,41 +1 @@
-/* Copyright (C) 1996,1997,1998,1999,2000,2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <errno.h>
-#include <signal.h>
-#include <unistd.h>
-
-#include <sysdep.h>
-#include <sys/syscall.h>
-#include <bp-checks.h>
-
-extern int __syscall_rt_sigsuspend (const sigset_t *__unbounded, size_t);
-
-/* Change the set of blocked signals to SET,
-   wait until a signal arrives, and restore the set of blocked signals.  */
-int
-__sigsuspend (set)
-     const sigset_t *set;
-{
-  /* XXX The size argument hopefully will have to be changed to the
-     real size of the user-level sigset_t.  */
-  return INLINE_SYSCALL (rt_sigsuspend, 2, CHECK_SIGSET (set), _NSIG / 8);
-}
-libc_hidden_def (__sigsuspend)
-weak_alias (__sigsuspend, sigsuspend)
-strong_alias (__sigsuspend, __libc_sigsuspend)
+#include "../../ia64/sigsuspend.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h	2003-01-28 05:47:54.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sparc/sparc64/sysdep.h	2003-04-15 23:55:51.000000000 +0900
@@ -35,6 +35,7 @@
 
 /* Linux/SPARC uses a different trap number */
 #undef PSEUDO
+#undef PSEUDO_NOERRNO
 #undef ENTRY
 
 #define ENTRY(name)							\
@@ -101,16 +102,27 @@
 	 nop;								\
 	SYSCALL_ERROR_HANDLER
 
+#define PSEUDO_NOERRNO(name, syscall_name, args)			\
+	.text;								\
+	ENTRY(name);							\
+	LOADSYSCALL(syscall_name);					\
+	ta	0x6d
+
 #undef PSEUDO_END
 #define PSEUDO_END(name)						\
 	.size name,.-name
 
+#undef PSEUDO_END_NOERRNO
+#define PSEUDO_END_NOERRNO(name)					\
+	.size name,.-name
+
 #undef END
 #define END(name)							\
 	.size name,.-name
 
 /* Careful here!  This "ret" define can interfere; use jmpl if unsure.  */
-#define ret             retl; nop
+#define ret		retl; nop
+#define ret_NOERRNO	retl; nop
 #define r0              %o0
 #define r1              %o1
 #define MOVE(x,y)       mov x, y
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/statfs64.c libc-20030708/sysdeps/unix/sysv/linux/statfs64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/statfs64.c	2001-07-08 04:21:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/statfs64.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Return information about the filesystem on which FILE resides.
-   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1998,1999,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -21,11 +21,33 @@
 #include <string.h>
 #include <sys/statfs.h>
 #include <stddef.h>
+#include <sysdep.h>
+
+int __no_statfs64 attribute_hidden;
 
 /* Return information about the filesystem on which FILE resides.  */
 int
 __statfs64 (const char *file, struct statfs64 *buf)
 {
+#ifdef __NR_statfs64
+# if __ASSUME_STATFS64 == 0
+  if (! __no_statfs64)
+# endif
+    {
+      int result = INLINE_SYSCALL (statfs64, 3, file, sizeof (*buf), buf);
+
+# if __ASSUME_STATFS64 == 0
+      if (result == 0 || errno != ENOSYS)
+# endif
+	return result;
+
+# if __ASSUME_STATFS64 == 0
+      __no_statfs64 = 1;
+# endif
+    }
+#endif
+
+#if __ASSUME_STATFS64 == 0
   struct statfs buf32;
 
   if (__statfs (file, &buf32) < 0)
@@ -40,8 +62,10 @@
   buf->f_ffree = buf32.f_ffree;
   buf->f_fsid = buf32.f_fsid;
   buf->f_namelen = buf32.f_namelen;
+  buf->f_frsize = buf32.f_frsize;
   memcpy (buf->f_spare, buf32.f_spare, sizeof (buf32.f_spare));
 
   return 0;
+#endif
 }
 weak_alias (__statfs64, statfs64)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sys/epoll.h libc-20030708/sysdeps/unix/sysv/linux/sys/epoll.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sys/epoll.h	2002-12-17 08:24:21.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sys/epoll.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,6 +19,7 @@
 #ifndef	_SYS_EPOLL_H
 #define	_SYS_EPOLL_H	1
 
+#include <stdint.h>
 #include <sys/types.h>
 
 
@@ -42,8 +43,10 @@
 #define EPOLLMSG EPOLLMSG
     EPOLLERR = 0x008,
 #define EPOLLERR EPOLLERR
-    EPOLLHUP = 0x010
+    EPOLLHUP = 0x010,
 #define EPOLLHUP EPOLLHUP
+    EPOLLET = (1 << 31)
+#define EPOLLET EPOLLET
   };
 
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sys/param.h libc-20030708/sysdeps/unix/sysv/linux/sys/param.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sys/param.h	2001-07-08 04:21:39.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sys/param.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1996, 1997, 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,2000,2001,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -49,10 +49,16 @@
 
 /* Macros for counting and rounding.  */
 #ifndef howmany
-# define howmany(x, y)	(((x)+((y)-1))/(y))
+# define howmany(x, y)	(((x) + ((y) - 1)) / (y))
 #endif
-#define	roundup(x, y)	((((x)+((y)-1))/(y))*(y))
-#define powerof2(x)	((((x)-1)&(x))==0)
+#ifdef __GNUC__
+# define roundup(x, y)	(__builtin_constant_p (y) && powerof2 (y)	      \
+			 ? (((x) + (y) - 1) & ~((y) - 1))		      \
+			 : ((((x) + ((y) - 1)) / (y)) * (y)))
+#else
+# define roundup(x, y)	((((x) + ((y) - 1)) / (y)) * (y))
+#endif
+#define powerof2(x)	((((x) - 1) & (x)) == 0)
 
 /* Macros for min/max.  */
 #define	MIN(a,b) (((a)<(b))?(a):(b))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/syscalls.list libc-20030708/sysdeps/unix/sysv/linux/syscalls.list
--- glibc-2.3.2/sysdeps/unix/sysv/linux/syscalls.list	2003-02-06 06:04:09.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/syscalls.list	2003-03-28 21:28:20.000000000 +0900
@@ -14,12 +14,12 @@
 flock		-	flock		i:ii	__flock		flock
 fork		-	fork		i:	__libc_fork	__fork fork
 get_kernel_syms	EXTRA	get_kernel_syms	i:p	get_kernel_syms
-getegid		-	getegid		i:	__getegid	getegid
-geteuid		-	geteuid		i:	__geteuid	geteuid
+getegid		-	getegid		Ei:	__getegid	getegid
+geteuid		-	geteuid		Ei:	__geteuid	geteuid
 getpgid		-	getpgid		i:i	__getpgid	getpgid
-getpgrp		-	getpgrp		i:	getpgrp
+getpgrp		-	getpgrp		Ei:	getpgrp
 getpmsg		-	getpmsg		i:ipppp	getpmsg
-getppid		-	getppid		i:	__getppid	getppid
+getppid		-	getppid		Ei:	__getppid	getppid
 getresuid	-	getresuid	i:ppp	getresuid
 getresgid	-	getresgid	i:ppp	getresgid
 getsid		-	getsid		i:i	getsid
@@ -43,11 +43,12 @@
 personality	init-first personality	i:i	__personality	personality
 pipe		-	pipe		i:f	__pipe		pipe
 pivot_root	EXTRA	pivot_root	i:ss	pivot_root
-posix_fadvise64	-	fadvise64	i:iiiii	posix_advise64
+posix_fadvise64	-	fadvise64	i:iiiii	posix_fadvise64
 prctl		EXTRA	prctl		i:iiiii	__prctl		prctl
 putpmsg		-	putpmsg		i:ippii	putpmsg
 query_module	EXTRA	query_module	i:sipip	query_module
 quotactl	EXTRA	quotactl	i:isip	quotactl
+remap_file_pages -	remap_file_pages i:piiii	__remap_file_pages remap_file_pages
 sched_getaffinity -	sched_getaffinity	i:iip	sched_getaffinity
 sched_getp	-	sched_getparam	i:ip	__sched_getparam	sched_getparam
 sched_gets	-	sched_getscheduler	i:i	__sched_getscheduler	sched_getscheduler
@@ -76,15 +77,15 @@
 chown		-	chown		i:sii	__libc_chown	__chown chown
 fcntl		-	fcntl		Ci:iiF	__libc_fcntl	__fcntl fcntl
 
-setxattr	EXTRA	setxattr	i:sspii	setxattr
-lsetxattr	EXTRA	lsetxattr	i:sspii	lsetxattr
-fsetxattr	EXTRA	fsetxattr	i:ispii	fsetxattr
-getxattr	EXTRA	getxattr	i:sspi	getxattr
-lgetxattr	EXTRA	lgetxattr	i:sspi	lgetxattr
-fgetxattr	EXTRA	fgetxattr	i:ispi	fgetxattr
-listxattr	EXTRA	listxattr	i:ssi	listxattr
-llistxattr	EXTRA	llistxattr	i:ssi	llistxattr
-flistxattr	EXTRA	flistxattr	i:isi	flistxattr
-removexattr	EXTRA	removexattr	i:ss	removexattr
-lremovexattr	EXTRA	lremovexattr	i:ss	lremovexattr
-fremovexattr	EXTRA	fremovexattr	i:is	fremovexattr
+setxattr	-	setxattr	i:sspii	setxattr
+lsetxattr	-	lsetxattr	i:sspii	lsetxattr
+fsetxattr	-	fsetxattr	i:ispii	fsetxattr
+getxattr	-	getxattr	i:sspi	getxattr
+lgetxattr	-	lgetxattr	i:sspi	lgetxattr
+fgetxattr	-	fgetxattr	i:ispi	fgetxattr
+listxattr	-	listxattr	i:ssi	listxattr
+llistxattr	-	llistxattr	i:ssi	llistxattr
+flistxattr	-	flistxattr	i:isi	flistxattr
+removexattr	-	removexattr	i:ss	removexattr
+lremovexattr	-	lremovexattr	i:ss	lremovexattr
+fremovexattr	-	fremovexattr	i:is	fremovexattr
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/sysconf.c libc-20030708/sysdeps/unix/sysv/linux/sysconf.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/sysconf.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/sysconf.c	2003-03-28 21:28:20.000000000 +0900
@@ -0,0 +1,52 @@
+/* Get file-specific information about a file.  Linux version.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <time.h>
+#include <unistd.h>
+
+static long int posix_sysconf (int name);
+
+/* Define this first, so it can be inlined.  */
+#define __sysconf static posix_sysconf
+#include <sysdeps/posix/sysconf.c>
+
+
+/* Get the value of the system variable NAME.  */
+long int
+__sysconf (int name)
+{
+  switch (name)
+    {
+#ifdef __NR_clock_getres
+    case _SC_MONOTONIC_CLOCK:
+      /* Check using the clock_getres system call.  */
+      {
+	struct timespec ts;
+	INTERNAL_SYSCALL_DECL (err);
+	int r;
+	r = INTERNAL_SYSCALL (clock_getres, err, 2, CLOCK_MONOTONIC, &ts);
+	return INTERNAL_SYSCALL_ERROR_P (r, err) ? -1 : 1;
+      }
+#endif
+
+    default:
+      return posix_sysconf (name);
+    }
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/system.c libc-20030708/sysdeps/unix/sysv/linux/system.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/system.c	1996-09-13 03:29:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/system.c	2003-04-28 23:53:26.000000000 +0900
@@ -1,2 +1,77 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sched.h>
+#include <signal.h>
+#include <sysdep.h>
+#include <unistd.h>
+#include <sys/wait.h>
+#include <bits/libc-lock.h>
+#include <kernel-features.h>
+
+/* We have to and actually can handle cancelable system().  The big
+   problem: we have to kill the child process if necessary.  To do
+   this a cleanup handler has to be registered and is has to be able
+   to find the PID of the child.  The main problem is to reliable have
+   the PID when needed.  It is not necessary for the parent thread to
+   return.  It might still be in the kernel when the cancellation
+   request comes.  Therefore we have to use the clone() calls ability
+   to have the kernel write the PID into the user-level variable.  */
+#if defined __ASSUME_CLONE_THREAD_FLAGS && !defined FORK
+# define FORK() \
+  INLINE_SYSCALL (clone, 3, CLONE_PARENT_SETTID | SIGCHLD, 0, &pid)
+#endif
+
+#ifdef _LIBC_REENTRANT
+static void cancel_handler (void *arg);
+
+# define CLEANUP_HANDLER \
+  __libc_cleanup_region_start (1, cancel_handler, &pid)
+
+# define CLEANUP_RESET \
+  __libc_cleanup_region_end (0)
+#endif
+
+
 /* Linux has waitpid(), so override the generic unix version.  */
 #include <sysdeps/posix/system.c>
+
+
+#ifdef _LIBC_REENTRANT
+/* The cancellation handler.  */
+static void
+cancel_handler (void *arg)
+{
+  pid_t child = *(pid_t *) arg;
+
+  INTERNAL_SYSCALL_DECL (err);
+  INTERNAL_SYSCALL (kill, err, 2, child, SIGKILL);
+
+  TEMP_FAILURE_RETRY (__waitpid (child, NULL, 0));
+
+  DO_LOCK ();
+
+  if (SUB_REF () == 0)
+    {
+      (void) __sigaction (SIGQUIT, &quit, (struct sigaction *) NULL);
+      (void) __sigaction (SIGINT, &intr, (struct sigaction *) NULL);
+    }
+
+  DO_UNLOCK ();
+}
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/usleep.c libc-20030708/sysdeps/unix/sysv/linux/usleep.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/usleep.c	2002-12-16 13:26:37.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/usleep.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Implementation of the BSD usleep function using nanosleep.
-   Copyright (C) 1996, 1997, 1999, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 1999, 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -27,5 +27,8 @@
   struct timespec ts = { .tv_sec = (long int) (useconds / 1000000),
 			 .tv_nsec = (long int) (useconds % 1000000) * 1000ul };
 
+  /* Note the usleep() is a cancellation point.  But since we call
+     nanosleep() which itself is a cancellation point we do not have
+     to do anything here.  */
   return __nanosleep (&ts, NULL);
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/wait.c libc-20030708/sysdeps/unix/sysv/linux/wait.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/wait.c	2002-12-16 09:57:48.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/wait.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1995, 1996, 1997, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991,1995,1996,1997,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -24,7 +24,7 @@
 
 /* Wait for a child to die.  When one does, put its status in *STAT_LOC
    and return its process ID.  For errors, return (pid_t) -1.  */
-__pid_t
+pid_t
 __libc_wait (__WAIT_STATUS_DEFN stat_loc)
 {
   if (SINGLE_THREAD_P)
@@ -33,8 +33,8 @@
 
   int oldtype = LIBC_CANCEL_ASYNC ();
 
-  int result = INLINE_SYSCALL (wait4, 4, WAIT_ANY, stat_loc, 0,
-			       (struct rusage *) NULL);
+  pid_t result = INLINE_SYSCALL (wait4, 4, WAIT_ANY, stat_loc, 0,
+				 (struct rusage *) NULL);
 
   LIBC_CANCEL_RESET (oldtype);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/waitpid.c libc-20030708/sysdeps/unix/sysv/linux/waitpid.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/waitpid.c	2002-12-16 09:57:48.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/waitpid.c	2003-05-21 23:20:38.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,92,95,96,97,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991,92,95,96,97,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -25,11 +25,21 @@
 __libc_waitpid (__pid_t pid, int *stat_loc, int options)
 {
   if (SINGLE_THREAD_P)
-    return INLINE_SYSCALL (wait4, 4, pid, stat_loc, options, NULL);
+    {
+#ifdef __NR_waitpid
+      return INLINE_SYSCALL (waitpid, 3, pid, stat_loc, options);
+#else
+      return INLINE_SYSCALL (wait4, 4, pid, stat_loc, options, NULL);
+#endif
+    }
 
   int oldtype = LIBC_CANCEL_ASYNC ();
 
+#ifdef __NR_waitpid
+  int result = INLINE_SYSCALL (waitpid, 3, pid, stat_loc, options);
+#else
   int result = INLINE_SYSCALL (wait4, 4, pid, stat_loc, options, NULL);
+#endif
 
   LIBC_CANCEL_RESET (oldtype);
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/bits/mman.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/bits/mman.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/bits/mman.h	2001-09-19 19:30:39.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/bits/mman.h	2003-03-03 19:03:36.000000000 +0900
@@ -1,5 +1,5 @@
 /* Definitions for POSIX memory map interface.  Linux/x86_64 version.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -53,11 +53,13 @@
 
 /* These are Linux-specific.  */
 #ifdef __USE_MISC
-# define MAP_GROWSDOWN	0x0100		/* Stack-like segment.  */
-# define MAP_DENYWRITE	0x0800		/* ETXTBSY */
-# define MAP_EXECUTABLE	0x1000		/* Mark it as an executable.  */
-# define MAP_LOCKED	0x2000		/* Lock the mapping.  */
-# define MAP_NORESERVE	0x4000		/* Don't check for reservations.  */
+# define MAP_GROWSDOWN	0x00100		/* Stack-like segment.  */
+# define MAP_DENYWRITE	0x00800		/* ETXTBSY */
+# define MAP_EXECUTABLE	0x01000		/* Mark it as an executable.  */
+# define MAP_LOCKED	0x02000		/* Lock the mapping.  */
+# define MAP_NORESERVE	0x04000		/* Don't check for reservations.  */
+# define MAP_POPULATE	0x08000		/* Populate (prefault) pagetables.  */
+# define MAP_NONBLOCK	0x10000		/* Do not block on IO.  */
 #endif
 
 /* Flags to `msync'.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/bits/stat.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/bits/stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/bits/stat.h	2003-01-01 05:08:59.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/bits/stat.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,8 +22,6 @@
 
 /* Versions of the `struct stat' data structure.  */
 #define _STAT_VER_KERNEL	0
-#define _STAT_VER_LINUX		1
-#define _STAT_VER		_STAT_VER_LINUX
 
 #if __WORDSIZE == 32
 # define _STAT_VER_SVR4		2
@@ -34,10 +32,14 @@
 # define _MKNOD_VER_SVR4	2
 # define _MKNOD_VER		_MKNOD_VER_LINUX /* The bits defined below.  */
 #else
+# define _STAT_VER_LINUX	1
+
 /* x86-64 versions of the `xmknod' interface.  */
 # define _MKNOD_VER_LINUX	0
 #endif
 
+#define _STAT_VER		_STAT_VER_LINUX
+
 struct stat
   {
     __dev_t st_dev;		/* Device.  */
@@ -169,6 +171,8 @@
 /* Tell code we have these members.  */
 #define	_STATBUF_ST_BLKSIZE
 #define _STATBUF_ST_RDEV
+/* Nanosecond resolution time values are supported.  */
+#define _STATBUF_ST_NSEC
 
 /* Encoding of the file mode.  */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/clone.S libc-20030708/sysdeps/unix/sysv/linux/x86_64/clone.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/clone.S	2002-08-04 11:20:07.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/clone.S	2003-03-05 04:45:35.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001,02 Free Software Foundation, Inc.
+/* Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,16 +31,22 @@
    the kernel entry is:
    int clone (long flags, void *child_stack).
 
-   The parameters are passed in register from userland:
+   The parameters are passed in register and on the stack from userland:
    rdi: fn
    rsi: child_stack
    rdx:	flags
    rcx: arg
+   r8d:	TID field in parent
+   r9d: thread pointer
+%esp+8:	TID field in child
 
    The kernel expects:
    rax: system call number
    rdi: flags
-   rsi: child_stack  */
+   rsi: child_stack
+   rdx: TID field in parent
+   r10: TID field in child
+   r8:	thread pointer  */
 
 
         .text
@@ -57,11 +63,14 @@
 	movq	%rcx,8(%rsi)
 
 	/* Save the function pointer.  It will be popped off in the
-	child in the ebx frobbing below.  */
+	   child in the ebx frobbing below.  */
 	movq	%rdi,0(%rsi)
 
 	/* Do the system call.  */
 	movq	%rdx, %rdi
+	movq	%r8, %rdx
+	movq	%r9, %r8
+	movq	8(%rsp), %r10
 	movq	$SYS_ify(clone),%rax
 	syscall
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/dl-cache.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/dl-cache.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/dl-cache.h	2002-04-22 20:51:40.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/dl-cache.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,5 +1,5 @@
 /* Support for reading /etc/ld.so.cache files written by Linux ldconfig.
-   Copyright (C) 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -22,4 +22,4 @@
 #define _dl_cache_check_flags(flags)			\
   ((flags) == _DL_CACHE_DEFAULT_ID)
 
-#include_next <dl-cache.h>
+#include <sysdeps/unix/sysv/linux/sparc/dl-cache.h>
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/get_clockfreq.c libc-20030708/sysdeps/unix/sysv/linux/x86_64/get_clockfreq.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/get_clockfreq.c	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/get_clockfreq.c	2003-05-09 16:52:47.000000000 +0900
@@ -0,0 +1 @@
+#include "../i386/get_clockfreq.c"
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/gettimeofday.S libc-20030708/sysdeps/unix/sysv/linux/x86_64/gettimeofday.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/gettimeofday.S	2002-04-14 17:58:48.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/gettimeofday.S	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -27,6 +27,7 @@
 ENTRY (__gettimeofday)
 	/* Align stack.  */
 	sub	$0x8, %rsp
+	cfi_adjust_cfa_offset(8)
 	movq	$VSYSCALL_ADDR_vgettimeofday, %rax
 	callq	*%rax
 	/* Check error return.  */
@@ -35,6 +36,7 @@
 
 L(pseudo_end):
 	add	$0x8, %rsp
+	cfi_adjust_cfa_offset(-8)
 	ret
 PSEUDO_END(__gettimeofday)
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/kernel_stat.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/kernel_stat.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/kernel_stat.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/kernel_stat.h	2003-06-13 01:15:48.000000000 +0900
@@ -0,0 +1,21 @@
+/* Definition of `struct stat' used in the kernel.
+   Copyright (C) 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define STAT_IS_KERNEL_STAT 1
+#define XSTAT_IS_XSTAT64 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/register-dump.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/register-dump.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/register-dump.h	2002-03-29 08:41:52.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/register-dump.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,5 +1,5 @@
 /* Dump registers.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -65,7 +65,7 @@
 }
 
 static void
-register_dump (int fd, struct sigcontext *ctx)
+register_dump (int fd, struct ucontext *ctx)
 {
   char regs[25][16];
   char fpregs[30][8];
@@ -84,33 +84,33 @@
   ++nr
 
   /* Generate strings of register contents.  */
-  hexvalue (ctx->rax, regs[0], 16);
-  hexvalue (ctx->rbx, regs[1], 16);
-  hexvalue (ctx->rcx, regs[2], 16);
-  hexvalue (ctx->rdx, regs[3], 16);
-  hexvalue (ctx->rsi, regs[4], 16);
-  hexvalue (ctx->rdi, regs[5], 16);
-  hexvalue (ctx->rbp, regs[6], 16);
-  hexvalue (ctx->r8, regs[7], 16);
-  hexvalue (ctx->r9, regs[8], 16);
-  hexvalue (ctx->r10, regs[9], 16);
-  hexvalue (ctx->r11, regs[10], 16);
-  hexvalue (ctx->r12, regs[11], 16);
-  hexvalue (ctx->r13, regs[12], 16);
-  hexvalue (ctx->r14, regs[13], 16);
-  hexvalue (ctx->r15, regs[14], 16);
-  hexvalue (ctx->rsp, regs[15], 16);
-  hexvalue (ctx->rip, regs[16], 16);
-
-  hexvalue (ctx->eflags, regs[17], 8);
-  hexvalue (ctx->cs, regs[18], 4);
-  hexvalue (ctx->fs, regs[19], 4);
-  hexvalue (ctx->gs, regs[20], 4);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RAX], regs[0], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RBX], regs[1], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RCX], regs[2], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RDX], regs[3], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RSI], regs[4], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RDI], regs[5], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RBP], regs[6], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R8], regs[7], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R9], regs[8], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R10], regs[9], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R11], regs[10], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R12], regs[11], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R13], regs[12], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R14], regs[13], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_R15], regs[14], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RSP], regs[15], 16);
+  hexvalue (ctx->uc_mcontext.gregs[REG_RIP], regs[16], 16);
+
+  hexvalue (ctx->uc_mcontext.gregs[REG_EFL], regs[17], 8);
+  hexvalue (ctx->uc_mcontext.gregs[REG_CSGSFS] & 0xffff, regs[18], 4);
+  hexvalue ((ctx->uc_mcontext.gregs[REG_CSGSFS] >> 16) & 0xffff, regs[19], 4);
+  hexvalue ((ctx->uc_mcontext.gregs[REG_CSGSFS] >> 32) & 0xffff, regs[20], 4);
   /* hexvalue (ctx->ss, regs[23], 4); */
-  hexvalue (ctx->trapno, regs[21], 8);
-  hexvalue (ctx->err, regs[22], 8);
-  hexvalue (ctx->oldmask, regs[23], 8);
-  hexvalue (ctx->cr2, regs[24], 8);
+  hexvalue (ctx->uc_mcontext.gregs[REG_TRAPNO], regs[21], 8);
+  hexvalue (ctx->uc_mcontext.gregs[REG_ERR], regs[22], 8);
+  hexvalue (ctx->uc_mcontext.gregs[REG_OLDMASK], regs[23], 8);
+  hexvalue (ctx->uc_mcontext.gregs[REG_CR2], regs[24], 8);
 
   /* Generate the output.  */
   ADD_STRING ("Register dump:\n\n RAX: ");
@@ -168,15 +168,15 @@
   ADD_STRING ("   CR2: ");
   ADD_MEM (regs[24], 8);
 
-  if (ctx->fpstate != NULL)
+  if (ctx->uc_mcontext.fpregs != NULL)
     {
 
       /* Generate output for the FPU control/status registers.  */
-      hexvalue (ctx->fpstate->cwd, fpregs[0], 8);
-      hexvalue (ctx->fpstate->swd, fpregs[1], 8);
-      hexvalue (ctx->fpstate->ftw, fpregs[2], 8);
-      hexvalue (ctx->fpstate->rip, fpregs[3], 8);
-      hexvalue (ctx->fpstate->rdp, fpregs[4], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->cwd, fpregs[0], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->swd, fpregs[1], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->ftw, fpregs[2], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->rip, fpregs[3], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->rdp, fpregs[4], 8);
 
       ADD_STRING ("\n\n FPUCW: ");
       ADD_MEM (fpregs[0], 8);
@@ -190,54 +190,71 @@
       ADD_MEM (fpregs[4], 8);
 
       /* Now the real FPU registers.  */
-      hexvalue (ctx->fpstate->_st[0].exponent, fpregs[5], 8);
-      hexvalue (ctx->fpstate->_st[0].significand[3] << 16
-		| ctx->fpstate->_st[0].significand[2], fpregs[6], 8);
-      hexvalue (ctx->fpstate->_st[0].significand[1] << 16
-		| ctx->fpstate->_st[0].significand[0], fpregs[7], 8);
-      hexvalue (ctx->fpstate->_st[1].exponent, fpregs[8], 8);
-      hexvalue (ctx->fpstate->_st[1].significand[3] << 16
-		| ctx->fpstate->_st[1].significand[2], fpregs[9], 8);
-      hexvalue (ctx->fpstate->_st[1].significand[1] << 16
-		| ctx->fpstate->_st[1].significand[0], fpregs[10], 8);
-      hexvalue (ctx->fpstate->_st[2].exponent, fpregs[11], 8);
-      hexvalue (ctx->fpstate->_st[2].significand[3] << 16
-		| ctx->fpstate->_st[2].significand[2], fpregs[12], 8);
-      hexvalue (ctx->fpstate->_st[2].significand[1] << 16
-		| ctx->fpstate->_st[2].significand[0], fpregs[13], 8);
-      hexvalue (ctx->fpstate->_st[3].exponent, fpregs[14], 8);
-      hexvalue (ctx->fpstate->_st[3].significand[3] << 16
-		| ctx->fpstate->_st[3].significand[2], fpregs[15], 8);
-      hexvalue (ctx->fpstate->_st[3].significand[1] << 16
-		| ctx->fpstate->_st[3].significand[0], fpregs[16], 8);
-      hexvalue (ctx->fpstate->_st[4].exponent, fpregs[17], 8);
-      hexvalue (ctx->fpstate->_st[4].significand[3] << 16
-		| ctx->fpstate->_st[4].significand[2], fpregs[18], 8);
-      hexvalue (ctx->fpstate->_st[4].significand[1] << 16
-		| ctx->fpstate->_st[4].significand[0], fpregs[19], 8);
-      hexvalue (ctx->fpstate->_st[5].exponent, fpregs[20], 8);
-      hexvalue (ctx->fpstate->_st[5].significand[3] << 16
-		| ctx->fpstate->_st[5].significand[2], fpregs[21], 8);
-      hexvalue (ctx->fpstate->_st[5].significand[1] << 16
-		| ctx->fpstate->_st[5].significand[0], fpregs[22], 8);
-      hexvalue (ctx->fpstate->_st[6].exponent, fpregs[23], 8);
-      hexvalue (ctx->fpstate->_st[6].significand[3] << 16
-		| ctx->fpstate->_st[6].significand[2], fpregs[24], 8);
-      hexvalue (ctx->fpstate->_st[6].significand[1] << 16
-		| ctx->fpstate->_st[6].significand[0], fpregs[25], 8);
-      hexvalue (ctx->fpstate->_st[7].exponent, fpregs[26], 8);
-      hexvalue (ctx->fpstate->_st[7].significand[3] << 16
-		| ctx->fpstate->_st[7].significand[2], fpregs[27], 8);
-      hexvalue (ctx->fpstate->_st[7].significand[1] << 16
-		| ctx->fpstate->_st[7].significand[0], fpregs[28], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[0].exponent, fpregs[5], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[0].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[0].significand[2], fpregs[6],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[0].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[0].significand[0], fpregs[7],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[1].exponent, fpregs[8], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[1].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[1].significand[2], fpregs[9],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[1].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[1].significand[0], fpregs[10],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[2].exponent, fpregs[11], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[2].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[2].significand[2], fpregs[12],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[2].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[2].significand[0], fpregs[13],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[3].exponent, fpregs[14], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[3].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[3].significand[2], fpregs[15],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[3].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[3].significand[0], fpregs[16],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[4].exponent, fpregs[17], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[4].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[4].significand[2], fpregs[18],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[4].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[4].significand[0], fpregs[19],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[5].exponent, fpregs[20], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[5].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[5].significand[2], fpregs[21],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[5].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[5].significand[0], fpregs[22],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[6].exponent, fpregs[23], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[6].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[6].significand[2], fpregs[24],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[6].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[6].significand[0], fpregs[25],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[7].exponent, fpregs[26], 8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[7].significand[3] << 16
+		| ctx->uc_mcontext.fpregs->_st[7].significand[2], fpregs[27],
+		8);
+      hexvalue (ctx->uc_mcontext.fpregs->_st[7].significand[1] << 16
+		| ctx->uc_mcontext.fpregs->_st[7].significand[0], fpregs[28],
+		8);
 
-      hexvalue (ctx->fpstate->mxcsr, fpregs[29], 4);
+      hexvalue (ctx->uc_mcontext.fpregs->mxcsr, fpregs[29], 4);
 
       for (i = 0; i < 16; i++)
-	hexvalue (ctx->fpstate->_xmm[i].element[3] << 24
-		  | ctx->fpstate->_xmm[i].element[2] << 16
-		  | ctx->fpstate->_xmm[i].element[1] << 8
-		  | ctx->fpstate->_xmm[i].element[0], xmmregs[i], 32);
+	hexvalue (ctx->uc_mcontext.fpregs->_xmm[i].element[3] << 24
+		  | ctx->uc_mcontext.fpregs->_xmm[i].element[2] << 16
+		  | ctx->uc_mcontext.fpregs->_xmm[i].element[1] << 8
+		  | ctx->uc_mcontext.fpregs->_xmm[i].element[0], xmmregs[i],
+		  32);
 
 
       ADD_STRING ("\n\n ST(0) ");
@@ -284,25 +301,25 @@
       ADD_STRING ("\n mxcsr: ");
       ADD_MEM (fpregs[29], 4);
 
-      ADD_STRING ("\n XMM0: ");
+      ADD_STRING ("\n XMM0:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING (" XMM1: ");
+      ADD_STRING (" XMM1:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING ("\n XMM2: ");
+      ADD_STRING ("\n XMM2:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING (" XMM3: ");
+      ADD_STRING (" XMM3:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING ("\n XMM4: ");
+      ADD_STRING ("\n XMM4:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING (" XMM5: ");
+      ADD_STRING (" XMM5:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING ("\n XMM6: ");
+      ADD_STRING ("\n XMM6:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING (" XMM7: ");
+      ADD_STRING (" XMM7:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING ("\n XMM8: ");
+      ADD_STRING ("\n XMM8:  ");
       ADD_MEM (xmmregs[0], 32);
-      ADD_STRING (" XMM9: ");
+      ADD_STRING (" XMM9:  ");
       ADD_MEM (xmmregs[0], 32);
       ADD_STRING ("\n XMM10: ");
       ADD_MEM (xmmregs[0], 32);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sigaction.c libc-20030708/sysdeps/unix/sysv/linux/x86_64/sigaction.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sigaction.c	2003-01-03 08:26:05.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/sigaction.c	2003-06-12 08:54:05.000000000 +0900
@@ -97,14 +97,15 @@
    appropriate GDB maintainer.  */
 
 #define RESTORE(name, syscall) RESTORE2 (name, syscall)
-#define RESTORE2(name, syscall) \
+# define RESTORE2(name, syscall) \
 asm						\
   (						\
    ".align 16\n"				\
+   CFI_STARTPROC "\n"				\
    "__" #name ":\n"				\
    "	movq $" #syscall ", %rax\n"		\
    "	syscall\n"				\
+   CFI_ENDPROC "\n"				\
    );
-
 /* The return code for realtime-signals.  */
 RESTORE (restore_rt, __NR_rt_sigreturn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sys/debugreg.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/sys/debugreg.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sys/debugreg.h	2001-11-21 21:21:56.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/sys/debugreg.h	2003-05-02 00:11:53.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001 Free Software Foundation, Inc.
+/* Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -18,6 +18,7 @@
 
 #ifndef _SYS_DEBUGREG_H
 #define _SYS_DEBUGREG_H	1
+#include <bits/wordsize.h>
 
 /* Indicate the register numbers for a number of the specific
    debug registers.  Registers 0-3 contain the addresses we wish to trap on */
@@ -73,7 +74,14 @@
 
 /* The second byte to the control register has a few special
    things.  */
-#define DR_CONTROL_RESERVED (0xFC00) /* Reserved */
+
+
+
+#if __WORDSIZE == 64
+# define DR_CONTROL_RESERVED (0xFFFFFFFF0000FC00UL) /* Reserved */
+#else
+# define DR_CONTROL_RESERVED (0x00FC00U) /* Reserved */
+#endif
 #define DR_LOCAL_SLOWDOWN   (0x100)  /* Local slow the pipeline */
 #define DR_GLOBAL_SLOWDOWN  (0x200)  /* Global slow the pipeline */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sys/epoll.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/sys/epoll.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sys/epoll.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/sys/epoll.h	2003-07-02 16:12:11.000000000 +0900
@@ -0,0 +1,105 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef	_SYS_EPOLL_H
+#define	_SYS_EPOLL_H	1
+
+#include <stdint.h>
+#include <sys/types.h>
+
+
+enum EPOLL_EVENTS
+  {
+    EPOLLIN = 0x001,
+#define EPOLLIN EPOLLIN
+    EPOLLPRI = 0x002,
+#define EPOLLPRI EPOLLPRI
+    EPOLLOUT = 0x004,
+#define EPOLLOUT EPOLLOUT
+    EPOLLRDNORM = 0x040,
+#define EPOLLRDNORM EPOLLRDNORM
+    EPOLLRDBAND = 0x080,
+#define EPOLLRDBAND EPOLLRDBAND
+    EPOLLWRNORM = 0x100,
+#define EPOLLWRNORM EPOLLWRNORM
+    EPOLLWRBAND = 0x200,
+#define EPOLLWRBAND EPOLLWRBAND
+    EPOLLMSG = 0x400,
+#define EPOLLMSG EPOLLMSG
+    EPOLLERR = 0x008,
+#define EPOLLERR EPOLLERR
+    EPOLLHUP = 0x010,
+#define EPOLLHUP EPOLLHUP
+    EPOLLET = (1 << 31)
+#define EPOLLET EPOLLET
+  };
+
+
+/* Valid opcodes ( "op" parameter ) to issue to epoll_ctl().  */
+#define EPOLL_CTL_ADD 1	/* Add a file decriptor to the interface.  */
+#define EPOLL_CTL_DEL 2	/* Remove a file decriptor from the interface.  */
+#define EPOLL_CTL_MOD 3	/* Change file decriptor epoll_event structure.  */
+
+
+typedef union epoll_data
+{
+  void *ptr;
+  int fd;
+  uint32_t u32;
+  uint64_t u64;
+} epoll_data_t;
+
+struct epoll_event
+{
+  uint32_t events;	/* Epoll events */
+  epoll_data_t data;	/* User data variable */
+} __attribute__ ((__packed__));
+
+
+__BEGIN_DECLS
+
+/* Creates an epoll instance.  Returns an fd for the new instance.
+   The "size" parameter is a hint specifying the number of file
+   descriptors to be associated with the new instance.  The fd
+   returned by epoll_create() should be closed with close().  */
+extern int epoll_create (int __size) __THROW;
+
+
+/* Manipulate an epoll instance "epfd". Returns 0 in case of success,
+   -1 in case of error ( the "errno" variable will contain the
+   specific error code ) The "op" parameter is one of the EPOLL_CTL_*
+   constants defined above. The "fd" parameter is the target of the
+   operation. The "event" parameter describes which events the caller
+   is interested in and any associated user data.  */
+extern int epoll_ctl (int __epfd, int __op, int __fd,
+		      struct epoll_event *__event) __THROW;
+
+
+/* Wait for events on an epoll instance "epfd". Returns the number of
+   triggered events returned in "events" buffer. Or -1 in case of
+   error with the "errno" variable set to the specific error code. The
+   "events" parameter is a buffer that will contain triggered
+   events. The "maxevents" is the maximum number of events to be
+   returned ( usually size of "events" ). The "timeout" parameter
+   specifies the maximum wait time in milliseconds (-1 == infinite).  */
+extern int epoll_wait (int __epfd, struct epoll_event *__events,
+		       int __maxevents, int __timeout) __THROW;
+
+__END_DECLS
+
+#endif /* sys/epoll.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/syscall.S libc-20030708/sysdeps/unix/sysv/linux/x86_64/syscall.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/syscall.S	2001-09-19 19:31:54.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/syscall.S	2003-05-21 23:20:38.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001 Free Software Foundation, Inc.
+/* Copyright (C) 2001, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -28,7 +28,6 @@
 
 	.text
 ENTRY (syscall)
-
 	movq %rdi, %rax		/* Syscall number -> rax.  */
 	movq %rsi, %rdi		/* shift arg1 - arg5.  */
 	movq %rdx, %rsi
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/syscalls.list libc-20030708/sysdeps/unix/sysv/linux/x86_64/syscalls.list
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/syscalls.list	2003-01-31 12:39:32.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/syscalls.list	2003-04-15 23:55:51.000000000 +0900
@@ -25,6 +25,7 @@
 shmdt		-	shmdt		i:s	__shmdt		shmdt
 shmget		-	shmget		i:iii	__shmget	shmget
 semop		-	semop		i:ipi	__semop		semop
+semtimedop	-	semtimedop	i:ipip	semtimedop
 semget		-	semget		i:iii	__semget	semget
 semctl		-	semctl		i:iiii	__semctl	semctl
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sysdep.h libc-20030708/sysdeps/unix/sysv/linux/x86_64/sysdep.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/sysdep.h	2003-01-09 11:54:57.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/sysdep.h	2003-06-12 08:54:05.000000000 +0900
@@ -46,6 +46,13 @@
 # define __NR_pwrite __NR_pwrite64
 #endif
 
+/* This is to help the old kernel headers where __NR_semtimedop is not
+   available.  */
+#ifndef __NR_semtimedop
+# define __NR_semtimedop 220
+#endif
+
+
 #ifdef __ASSEMBLER__
 
 /* Linux uses a negative return value to indicate syscall errors,
@@ -81,6 +88,18 @@
   SYSCALL_ERROR_HANDLER							      \
   END (name)
 
+#undef	PSEUDO_NOERRNO
+#define	PSEUDO_NOERRNO(name, syscall_name, args) \
+  .text;								      \
+  ENTRY (name)								      \
+    DO_CALL (syscall_name, args)
+
+#undef	PSEUDO_END_NOERRNO
+#define	PSEUDO_END_NOERRNO(name) \
+  END (name)
+
+#define ret_NOERRNO ret
+
 #ifndef PIC
 #define SYSCALL_ERROR_HANDLER	/* Nothing here; code in sysdep.S is used.  */
 #elif RTLD_PRIVATE_ERRNO
@@ -113,11 +132,13 @@
 0:						\
   xorq %rdx, %rdx;				\
   subq %rax, %rdx;				\
-  pushq %rdx					\
+  pushq %rdx;					\
+  cfi_adjust_cfa_offset(8);			\
   PUSH_ERRNO_LOCATION_RETURN;			\
   call BP_SYM (__errno_location)@PLT;		\
   POP_ERRNO_LOCATION_RETURN;			\
   popq %rdx;					\
+  cfi_adjust_cfa_offset(-8);			\
   movl %edx, (%rax);				\
   orq $-1, %rax;				\
   jmp L(pseudo_end);
@@ -134,37 +155,42 @@
   jmp L(pseudo_end);
 #endif	/* PIC */
 
-/* Linux/x86-64 takes system call arguments in registers:
+/* The Linux/x86-64 kernel expects the system call parameters in
+   registers according to the following table:
 
-    Register setup:
-    system call number	rax
+    syscall number	rax
     arg 1		rdi
     arg 2		rsi
     arg 3		rdx
-    arg 4		rcx
+    arg 4		r10
     arg 5		r8
     arg 6		r9
 
+    The Linux kernel uses and destroys internally these registers:
     return address from
     syscall		rcx
     additionally clobered: r12-r15,rbx,rbp
     eflags from syscall	r11
 
-    The compiler is going to form a call by coming here, through PSEUDO, with arguments:
+    Normal function call, including calls to the system call stub
+    functions in the libc, get the first six parameters passed in
+    registers and the seventh parameter and later on the stack.  The
+    register use is as follows:
+
+     system call number	in the DO_CALL macro
+     arg 1		rdi
+     arg 2		rsi
+     arg 3		rdx
+     arg 4		rcx
+     arg 5		r8
+     arg 6		r9
+
+    We have to take care that the stack is aligned to 16 bytes.  When
+    called the stack is not aligned since the return address has just
+    been pushed.
 
-	syscall number	in the DO_CALL macro
-	arg 1		rdi
-	arg 2		rsi
-	arg 3		rdx
-	arg 4		r10
-	arg 5		r8
-	arg 6		r9
-
-     We have to take care that the stack is alignedto 16 bytes.	 When
-     called the stack is not aligned since the return address has just
-     been pushed.
 
-     Syscalls of more than 6 arguments are not supported.  */
+    Syscalls of more than 6 arguments are not supported.  */
 
 #undef	DO_CALL
 #define DO_CALL(syscall_name, args)		\
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/time.S libc-20030708/sysdeps/unix/sysv/linux/x86_64/time.S
--- glibc-2.3.2/sysdeps/unix/sysv/linux/x86_64/time.S	2002-08-04 01:57:52.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/x86_64/time.S	2003-06-12 08:54:05.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001,02 Free Software Foundation, Inc.
+/* Copyright (C) 2001,02, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -30,6 +30,8 @@
 ENTRY (time)
 	/* Align stack.  */
 	sub	$0x8, %rsp
+	cfi_adjust_cfa_offset(8)
+	
 	movq	$VSYSCALL_ADDR_vtime, %rax
 	callq	*%rax
 	/* Check error return.  */
@@ -38,6 +40,7 @@
 
 L(pseudo_end):
 	add	$0x8, %rsp
+	cfi_adjust_cfa_offset(-8)
 	ret
 PSEUDO_END(time)
 libc_hidden_def (time)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/xstat.c libc-20030708/sysdeps/unix/sysv/linux/xstat.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/xstat.c	2002-10-02 17:53:20.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/xstat.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,6 +1,5 @@
 /* xstat using old-style Unix stat system call.
-   Copyright (C) 1991, 1995, 1996, 1997, 1998, 2000, 2002
-   Free Software Foundation, Inc.
+   Copyright (C) 1991,1995-1998,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -31,10 +30,7 @@
 #include <sys/syscall.h>
 #include <bp-checks.h>
 
-#include <xstatconv.c>
-
-extern int __syscall_stat (const char *__unbounded,
-			   struct kernel_stat *__unbounded);
+#include <xstatconv.h>
 
 /* Get information about the file NAME in BUF.  */
 int
@@ -54,7 +50,7 @@
   result = INLINE_SYSCALL (stat, 2, CHECK_STRING (name),
 			   __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat_conv (vers, &kbuf, buf);
+    result = __xstat_conv (vers, &kbuf, buf);
 
   return result;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/xstat64.c libc-20030708/sysdeps/unix/sysv/linux/xstat64.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/xstat64.c	2002-10-12 03:58:50.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/xstat64.c	2003-06-12 08:54:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* xstat64 using old-style Unix stat system call.
-   Copyright (C) 1991,95,96,97,98,99,2000,01,02 Free Software Foundation, Inc.
+   Copyright (C) 1991, 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -29,7 +29,7 @@
 #include "kernel-features.h"
 
 #if __ASSUME_STAT64_SYSCALL == 0
-# include <xstatconv.c>
+# include <xstatconv.h>
 #endif
 
 extern int __syscall_stat (const char *__unbounded,
@@ -82,7 +82,7 @@
 
   result = INLINE_SYSCALL (stat, 2, CHECK_STRING (name), __ptrvalue (&kbuf));
   if (result == 0)
-    result = xstat64_conv (vers, &kbuf, buf);
+    result = __xstat64_conv (vers, &kbuf, buf);
 
   return result;
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/xstatconv.c libc-20030708/sysdeps/unix/sysv/linux/xstatconv.c
--- glibc-2.3.2/sysdeps/unix/sysv/linux/xstatconv.c	2003-01-02 19:38:52.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/xstatconv.c	2003-07-08 22:58:14.000000000 +0900
@@ -1,5 +1,5 @@
 /* Convert between the kernel's `struct stat' format, and libc's.
-   Copyright (C) 1991,1995,1996,1997,2000,2002 Free Software Foundation, Inc.
+   Copyright (C) 1991,1995-1997,2000,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,6 +17,10 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <errno.h>
+#include <sys/stat.h>
+#include <kernel_stat.h>
+
 #ifdef STAT_IS_KERNEL_STAT
 
 /* Dummy.  */
@@ -27,8 +31,9 @@
 #include <string.h>
 
 
-static inline int
-xstat_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
+#if !defined __ASSUME_STAT64_SYSCALL || defined XSTAT_IS_XSTAT64
+int
+__xstat_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
 {
   switch (vers)
     {
@@ -97,12 +102,13 @@
 
   return 0;
 }
+#endif
 
-static inline int
-xstat64_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
+int
+__xstat64_conv (int vers, struct kernel_stat *kbuf, void *ubuf)
 {
 #ifdef XSTAT_IS_XSTAT64
-  return xstat_conv (vers, kbuf, ubuf);
+  return __xstat_conv (vers, kbuf, ubuf);
 #else
   switch (vers)
     {
@@ -172,8 +178,8 @@
 #endif
 }
 
-static inline int
-xstat32_conv (int vers, struct stat64 *kbuf, struct stat *buf)
+int
+__xstat32_conv (int vers, struct stat64 *kbuf, struct stat *buf)
 {
   switch (vers)
     {
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/unix/sysv/linux/xstatconv.h libc-20030708/sysdeps/unix/sysv/linux/xstatconv.h
--- glibc-2.3.2/sysdeps/unix/sysv/linux/xstatconv.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/unix/sysv/linux/xstatconv.h	2003-07-08 22:58:14.000000000 +0900
@@ -0,0 +1,26 @@
+/* Convert between the kernel's `struct stat' format, and libc's.
+   Copyright (C) 1991,1995-1997,2000,2002,2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include "kernel-features.h"
+
+#ifndef STAT_IS_KERNEL_STAT
+extern int __xstat_conv (int vers, struct kernel_stat *kbuf, void *ubuf);
+extern int __xstat64_conv (int vers, struct kernel_stat *kbuf, void *ubuf);
+#endif
+extern int __xstat32_conv (int vers, struct stat64 *kbuf, struct stat *buf);
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/wordsize-32/Versions libc-20030708/sysdeps/wordsize-32/Versions
--- glibc-2.3.2/sysdeps/wordsize-32/Versions	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/wordsize-32/Versions	2003-03-03 18:45:12.000000000 +0900
@@ -0,0 +1,7 @@
+libc {
+  GLIBC_2.3 {
+    # These were erroneously omitted for 64-bit platforms in 2.3
+    # and so we don't put them in locale/Versions.
+    strtoll_l; strtoull_l;
+  }
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/wordsize-64/Versions libc-20030708/sysdeps/wordsize-64/Versions
--- glibc-2.3.2/sysdeps/wordsize-64/Versions	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/wordsize-64/Versions	2003-03-03 18:45:12.000000000 +0900
@@ -0,0 +1,6 @@
+libc {
+  GLIBC_2.3.3 {
+    # These were erroneously omitted for 64-bit platforms in 2.3.
+    strtoll_l; strtoull_l;
+  }
+}
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/wordsize-64/strtol_l.c libc-20030708/sysdeps/wordsize-64/strtol_l.c
--- glibc-2.3.2/sysdeps/wordsize-64/strtol_l.c	2002-08-05 09:30:03.000000000 +0900
+++ libc-20030708/sysdeps/wordsize-64/strtol_l.c	2003-03-03 18:45:12.000000000 +0900
@@ -1,11 +1,14 @@
 /* We have to irritate the compiler a bit.  */
 #define ____strtoll_l_internal ____strtoll_l_internal_XXX
 #define __strtoll_l __strtoll_l_XXX
+#define strtoll_l strtoll_l_XXX
 
 #include <sysdeps/generic/strtol_l.c>
 
 #undef ____strtoll_l_internal
 #undef __strtoll_l
+#undef strtoll_l
 strong_alias (____strtol_l_internal, ____strtoll_l_internal)
 libc_hidden_ver (____strtol_l_internal, ____strtoll_l_internal)
 weak_alias (__strtol_l, __strtoll_l)
+weak_alias (__strtol_l, strtoll_l)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/wordsize-64/strtoul_l.c libc-20030708/sysdeps/wordsize-64/strtoul_l.c
--- glibc-2.3.2/sysdeps/wordsize-64/strtoul_l.c	2002-08-05 09:30:03.000000000 +0900
+++ libc-20030708/sysdeps/wordsize-64/strtoul_l.c	2003-03-03 18:45:12.000000000 +0900
@@ -1,11 +1,14 @@
 /* We have to irritate the compiler a bit.  */
 #define ____strtoull_l_internal ____strtoull_l_internal_XXX
 #define __strtoull_l __strtoull_l_XXX
+#define strtoull_l strtoull_l_XXX
 
 #include <sysdeps/generic/strtoul_l.c>
 
 #undef ____strtoull_l_internal
 #undef __strtoull_l
+#undef strtoull_l
 strong_alias (____strtoul_l_internal, ____strtoull_l_internal)
 libc_hidden_ver (____strtoul_l_internal, ____strtoull_l_internal)
 weak_alias (__strtoul_l, __strtoull_l)
+weak_alias (__strtoul_l, strtoull_l)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/atomicity.h libc-20030708/sysdeps/x86_64/atomicity.h
--- glibc-2.3.2/sysdeps/x86_64/atomicity.h	2001-09-19 19:12:07.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/atomicity.h	1970-01-01 09:00:00.000000000 +0900
@@ -1,57 +0,0 @@
-/* Low-level functions for atomic operations.  x86-64 version.
-   Copyright (C) 1997, 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-
-static inline uint32_t
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, uint32_t val)
-{
-  register uint32_t result;
-  __asm__ __volatile__ ("lock; xaddl %0,%1"
-			: "=r" (result), "=m" (*mem) : "0" (val), "1" (*mem));
-  return result;
-}
-
-static inline void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  __asm__ __volatile__ ("lock; addl %1,%0"
-			: "=m" (*mem) : "er" (val), "0" (*mem));
-}
-
-static inline char
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  char ret;
-  long int readval;
-
-  __asm__ __volatile__ ("lock; cmpxchgq %3, %1; sete %0"
-                        : "=q" (ret), "=m" (*p), "=a" (readval)
-                        : "r" (newval), "1" (*p), "a" (oldval));
-  return ret;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/bits/atomic.h libc-20030708/sysdeps/x86_64/bits/atomic.h
--- glibc-2.3.2/sysdeps/x86_64/bits/atomic.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/bits/atomic.h	2003-05-12 01:30:14.000000000 +0900
@@ -0,0 +1,321 @@
+/* Copyright (C) 2002, 2003 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@redhat.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+
+typedef int8_t atomic8_t;
+typedef uint8_t uatomic8_t;
+typedef int_fast8_t atomic_fast8_t;
+typedef uint_fast8_t uatomic_fast8_t;
+
+typedef int16_t atomic16_t;
+typedef uint16_t uatomic16_t;
+typedef int_fast16_t atomic_fast16_t;
+typedef uint_fast16_t uatomic_fast16_t;
+
+typedef int32_t atomic32_t;
+typedef uint32_t uatomic32_t;
+typedef int_fast32_t atomic_fast32_t;
+typedef uint_fast32_t uatomic_fast32_t;
+
+typedef int64_t atomic64_t;
+typedef uint64_t uatomic64_t;
+typedef int_fast64_t atomic_fast64_t;
+typedef uint_fast64_t uatomic_fast64_t;
+
+typedef intptr_t atomicptr_t;
+typedef uintptr_t uatomicptr_t;
+typedef intmax_t atomic_max_t;
+typedef uintmax_t uatomic_max_t;
+
+
+#ifndef LOCK_PREFIX
+# ifdef UP
+#  define LOCK_PREFIX	/* nothing */
+# else
+#  define LOCK_PREFIX "lock;"
+# endif
+#endif
+
+
+#define __arch_compare_and_exchange_val_8_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchgb %b2, %1"			      \
+		       : "=a" (ret), "=m" (*mem)			      \
+		       : "q" (newval), "m" (*mem), "0" (oldval));	      \
+     ret; })
+
+#define __arch_compare_and_exchange_val_16_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchgw %w2, %1"			      \
+		       : "=a" (ret), "=m" (*mem)			      \
+		       : "r" (newval), "m" (*mem), "0" (oldval));	      \
+     ret; })
+
+#define __arch_compare_and_exchange_val_32_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchgl %2, %1"			      \
+		       : "=a" (ret), "=m" (*mem)			      \
+		       : "r" (newval), "m" (*mem), "0" (oldval));	      \
+     ret; })
+
+#define __arch_compare_and_exchange_val_64_acq(mem, newval, oldval) \
+  ({ __typeof (*mem) ret;						      \
+     __asm __volatile (LOCK_PREFIX "cmpxchgq %q2, %1"			      \
+		       : "=a" (ret), "=m" (*mem)			      \
+		       : "r" ((long) (newval)), "m" (*mem),		      \
+			 "0" ((long) (oldval)));			      \
+     ret; })
+
+
+/* Note that we need no lock prefix.  */
+#define atomic_exchange_acq(mem, newvalue) \
+  ({ __typeof (*mem) result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile ("xchgb %b0, %1"				      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (newvalue), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile ("xchgw %w0, %1"				      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (newvalue), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile ("xchgl %0, %1"					      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (newvalue), "m" (*mem));			      \
+     else								      \
+       __asm __volatile ("xchgq %q0, %1"				      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" ((long) (newvalue)), "m" (*mem));	      \
+     result; })
+
+
+#define atomic_exchange_and_add(mem, value) \
+  ({ __typeof (*mem) result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "xaddb %b0, %1"			      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "xaddw %w0, %1"			      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "xaddl %0, %1"			      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" (value), "m" (*mem));			      \
+     else								      \
+       __asm __volatile (LOCK_PREFIX "xaddq %q0, %1"			      \
+			 : "=r" (result), "=m" (*mem)			      \
+			 : "0" ((long) (value)), "m" (*mem));		      \
+     result; })
+
+
+#define atomic_add(mem, value) \
+  (void) ({ if (__builtin_constant_p (value) && (value) == 1)		      \
+	      atomic_increment (mem);					      \
+	    else if (__builtin_constant_p (value) && (value) == 1)	      \
+	      atomic_decrement (mem);					      \
+	    else if (sizeof (*mem) == 1)				      \
+	      __asm __volatile (LOCK_PREFIX "addb %b1, %0"		      \
+				: "=m" (*mem)				      \
+				: "ir" (value), "m" (*mem));		      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "addw %w1, %0"		      \
+				: "=m" (*mem)				      \
+				: "ir" (value), "m" (*mem));		      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "addl %1, %0"		      \
+				: "=m" (*mem)				      \
+				: "ir" (value), "m" (*mem));		      \
+	    else							      \
+	      __asm __volatile (LOCK_PREFIX "addq %q1, %0"		      \
+				: "=m" (*mem)				      \
+				: "ir" ((long) (value)), "m" (*mem));	      \
+	    })
+
+
+#define atomic_add_negative(mem, value) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "addb %b2, %0; sets %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "addw %w2, %0; sets %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "addl %2, %0; sets %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else								      \
+       __asm __volatile (LOCK_PREFIX "addq %q2, %0; sets %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" ((long) (value)), "m" (*mem));		      \
+     __result; })
+
+
+#define atomic_add_zero(mem, value) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "addb %b2, %0; setz %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "addw %w2, %0; setz %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "addl %2, %0; setz %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" (value), "m" (*mem));			      \
+     else								      \
+       __asm __volatile (LOCK_PREFIX "addq %q2, %0; setz %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "ir" ((long) (value)), "m" (*mem));		      \
+     __result; })
+
+
+#define atomic_increment(mem) \
+  (void) ({ if (sizeof (*mem) == 1)					      \
+	      __asm __volatile (LOCK_PREFIX "incb %b0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "incw %w0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "incl %0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else							      \
+	      __asm __volatile (LOCK_PREFIX "incq %q0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    })
+
+
+#define atomic_increment_and_test(mem) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "incb %b0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "incw %w0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "incl %0; sete %1"			      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else								      \
+       __asm __volatile (LOCK_PREFIX "incq %q0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     __result; })
+
+
+#define atomic_decrement(mem) \
+  (void) ({ if (sizeof (*mem) == 1)					      \
+	      __asm __volatile (LOCK_PREFIX "decb %b0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "decw %w0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "decl %0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    else							      \
+	      __asm __volatile (LOCK_PREFIX "decq %q0"			      \
+				: "=m" (*mem)				      \
+				: "m" (*mem));				      \
+	    })
+
+
+#define atomic_decrement_and_test(mem) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "decb %b0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "decw %w0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "decl %0; sete %1"			      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     else								      \
+       __asm __volatile (LOCK_PREFIX "decq %q0; sete %1"		      \
+			 : "=m" (*mem), "=qm" (__result)		      \
+			 : "m" (*mem));					      \
+     __result; })
+
+
+#define atomic_bit_set(mem, bit) \
+  (void) ({ if (sizeof (*mem) == 1)					      \
+	      __asm __volatile (LOCK_PREFIX "orb %b2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "ir" (1L << (bit)));	      \
+	    else if (sizeof (*mem) == 2)				      \
+	      __asm __volatile (LOCK_PREFIX "orw %w2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "ir" (1L << (bit)));	      \
+	    else if (sizeof (*mem) == 4)				      \
+	      __asm __volatile (LOCK_PREFIX "orl %2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "ir" (1L << (bit)));	      \
+	    else if (__builtin_constant_p (bit) && (bit) < 32)		      \
+	      __asm __volatile (LOCK_PREFIX "orq %2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "i" (1L << (bit)));	      \
+	    else							      \
+	      __asm __volatile (LOCK_PREFIX "orq %q2, %0"		      \
+				: "=m" (*mem)				      \
+				: "m" (*mem), "r" (1UL << (bit)));	      \
+	    })
+
+
+#define atomic_bit_test_set(mem, bit) \
+  ({ unsigned char __result;						      \
+     if (sizeof (*mem) == 1)						      \
+       __asm __volatile (LOCK_PREFIX "btsb %3, %1; setc %0"		      \
+			 : "=q" (__result), "=m" (*mem)			      \
+			 : "m" (*mem), "ir" (bit));			      \
+     else if (sizeof (*mem) == 2)					      \
+       __asm __volatile (LOCK_PREFIX "btsw %3, %1; setc %0"		      \
+			 : "=q" (__result), "=m" (*mem)			      \
+			 : "m" (*mem), "ir" (bit));			      \
+     else if (sizeof (*mem) == 4)					      \
+       __asm __volatile (LOCK_PREFIX "btsl %3, %1; setc %0"		      \
+			 : "=q" (__result), "=m" (*mem)			      \
+			 : "m" (*mem), "ir" (bit));			      \
+     else							      	      \
+       __asm __volatile (LOCK_PREFIX "btsq %3, %1; setc %0"		      \
+			 : "=q" (__result), "=m" (*mem)			      \
+			 : "m" (*mem), "ir" (bit));			      \
+     __result; })
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/bits/setjmp.h libc-20030708/sysdeps/x86_64/bits/setjmp.h
--- glibc-2.3.2/sysdeps/x86_64/bits/setjmp.h	2002-03-12 06:08:08.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/bits/setjmp.h	2003-04-15 23:55:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -17,8 +17,10 @@
    02111-1307 USA.  */
 
 /* Define the machine-dependent type `jmp_buf'.  x86-64 version.  */
+#ifndef _BITS_SETJMP_H
+#define _BITS_SETJMP_H  1
 
-#ifndef _SETJMP_H
+#if !defined _SETJMP_H && !defined _PTHREAD_H
 # error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
 #endif
 
@@ -72,3 +74,5 @@
   ((void *) (address) < (void *) (jmpbuf)[JB_SP])
 # endif
 #endif
+
+#endif  /* bits/setjmp.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/dl-machine.h libc-20030708/sysdeps/x86_64/dl-machine.h
--- glibc-2.3.2/sysdeps/x86_64/dl-machine.h	2003-02-22 04:24:27.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/dl-machine.h	2003-07-08 22:58:15.000000000 +0900
@@ -24,6 +24,7 @@
 #define ELF_MACHINE_NAME "x86_64"
 
 #include <sys/param.h>
+#include <sysdep.h>
 
 /* Return nonzero iff ELF header is compatible with the running host.  */
 static inline int __attribute__ ((unused))
@@ -80,7 +81,7 @@
 /* Set up the loaded object described by L so its unrelocated PLT
    entries will jump to the on-demand fixup code in dl-runtime.c.  */
 
-static inline int __attribute__ ((unused))
+static inline int __attribute__ ((unused, always_inline))
 elf_machine_runtime_setup (struct link_map *l, int lazy, int profile)
 {
   Elf64_Addr *got;
@@ -136,14 +137,17 @@
 	.globl _dl_runtime_resolve\n\
 	.type _dl_runtime_resolve, @function\n\
 	.align 16\n\
+	" CFI_STARTPROC "\n\
 _dl_runtime_resolve:\n\
-	pushq %rax		# Preserve registers otherwise clobbered.\n\
-	pushq %rcx\n\
-	pushq %rdx\n\
-	pushq %rsi\n\
-	pushq %rdi\n\
-	pushq %r8\n\
-	pushq %r9\n\
+	subq $56,%rsp\n\
+	" CFI_ADJUST_CFA_OFFSET(72)" # Incorporate PLT\n\
+	movq %rax,(%rsp)	# Preserve registers otherwise clobbered.\n\
+	movq %rcx,8(%rsp)\n\
+	movq %rdx,16(%rsp)\n\
+	movq %rsi,24(%rsp)\n\
+	movq %rdi,32(%rsp)\n\
+	movq %r8,40(%rsp)\n\
+	movq %r9,48(%rsp)\n\
 	movq 64(%rsp), %rsi	# Copy args pushed by PLT in register.\n\
 	movq %rsi,%r11		# Multiply by 24\n\
 	addq %r11,%rsi\n\
@@ -152,28 +156,33 @@
 	movq 56(%rsp), %rdi	# %rdi: link_map, %rsi: reloc_offset\n\
 	call fixup		# Call resolver.\n\
 	movq %rax, %r11		# Save return value\n\
-	popq %r9		# Get register content back.\n\
-	popq %r8\n\
-	popq %rdi\n\
-	popq %rsi\n\
-	popq %rdx\n\
-	popq %rcx\n\
-	popq %rax\n\
-	addq $16,%rsp		# Adjust stack\n\
+	movq 48(%rsp),%r9	# Get register content back.\n\
+	movq 40(%rsp),%r8\n\
+	movq 32(%rsp),%rdi\n\
+	movq 24(%rsp),%rsi\n\
+	movq 16(%rsp),%rdx\n\
+	movq 8(%rsp),%rcx\n\
+	movq (%rsp),%rax\n\
+	addq $72,%rsp		# Adjust stack(PLT did 2 pushes)\n\
+	" CFI_ADJUST_CFA_OFFSET(-72)" \n\
 	jmp *%r11		# Jump to function address.\n\
+	" CFI_ENDPROC "\n\
 	.size _dl_runtime_resolve, .-_dl_runtime_resolve\n\
 \n\
 	.globl _dl_runtime_profile\n\
 	.type _dl_runtime_profile, @function\n\
 	.align 16\n\
+	" CFI_STARTPROC "\n\
 _dl_runtime_profile:\n\
-	pushq %rax		# Preserve registers otherwise clobbered.\n\
-	pushq %rcx\n\
-	pushq %rdx\n\
-	pushq %rsi\n\
-	pushq %rdi\n\
-	pushq %r8\n\
-	pushq %r9\n\
+	subq $56,%rsp\n\
+	" CFI_ADJUST_CFA_OFFSET(72)" # Incorporate PLT\n\
+	movq %rax,(%rsp)	# Preserve registers otherwise clobbered.\n\
+	movq %rcx,8(%rsp)\n\
+	movq %rdx,16(%rsp)\n\
+	movq %rsi,24(%rsp)\n\
+	movq %rdi,32(%rsp)\n\
+	movq %r8,40(%rsp)\n\
+	movq %r9,48(%rsp)\n\
 	movq 72(%rsp), %rdx	# Load return address if needed\n\
 	movq 64(%rsp), %rsi	# Copy args pushed by PLT in register.\n\
 	movq %rsi,%r11		# Multiply by 24\n\
@@ -183,15 +192,17 @@
 	movq 56(%rsp), %rdi	# %rdi: link_map, %rsi: reloc_offset\n\
 	call profile_fixup	# Call resolver.\n\
 	movq %rax, %r11		# Save return value\n\
-	popq %r9		# Get register content back.\n\
-	popq %r8\n\
-	popq %rdi\n\
-	popq %rsi\n\
-	popq %rdx\n\
-	popq %rcx\n\
-	popq %rax\n\
-	addq $16,%rsp		# Adjust stack\n\
+	movq 48(%rsp),%r9	# Get register content back.\n\
+	movq 40(%rsp),%r8\n\
+	movq 32(%rsp),%rdi\n\
+	movq 24(%rsp),%rsi\n\
+	movq 16(%rsp),%rdx\n\
+	movq 8(%rsp),%rcx\n\
+	movq (%rsp),%rax\n\
+	addq $72,%rsp		# Adjust stack\n\
+	" CFI_ADJUST_CFA_OFFSET(-72)"\n\
 	jmp *%r11		# Jump to function address.\n\
+	" CFI_ENDPROC "\n\
 	.size _dl_runtime_profile, .-_dl_runtime_profile\n\
 	.previous\n\
 ");
@@ -203,15 +214,18 @@
 	.type _dl_runtime_resolve, @function\n\
 	.type _dl_runtime_profile, @function\n\
 	.align 16\n\
+	" CFI_STARTPROC "\n\
 _dl_runtime_resolve:\n\
 _dl_runtime_profile:\n\
-	pushq %rax		# Preserve registers otherwise clobbered.\n\
-	pushq %rcx\n\
-	pushq %rdx\n\
-	pushq %rsi\n\
-	pushq %rdi\n\
-	pushq %r8\n\
-	pushq %r9\n\
+	subq $56,%rsp\n\
+	" CFI_ADJUST_CFA_OFFSET(72)" # Incorporate PLT\n\
+	movq %rax,(%rsp)	# Preserve registers otherwise clobbered.\n\
+	movq %rcx,8(%rsp)\n\
+	movq %rdx,16(%rsp)\n\
+	movq %rsi,24(%rsp)\n\
+	movq %rdi,32(%rsp)\n\
+	movq %r8,40(%rsp)\n\
+	movq %r9,48(%rsp)\n\
 	movq 64(%rsp), %rsi	# Copy args pushed by PLT in register.\n\
 	movq %rsi,%r11		# Multiply by 24\n\
 	addq %r11,%rsi\n\
@@ -220,15 +234,17 @@
 	movq 56(%rsp), %rdi	# %rdi: link_map, %rsi: reloc_offset\n\
 	call fixup		# Call resolver.\n\
 	movq %rax, %r11		# Save return value\n\
-	popq %r9		# Get register content back.\n\
-	popq %r8\n\
-	popq %rdi\n\
-	popq %rsi\n\
-	popq %rdx\n\
-	popq %rcx\n\
-	popq %rax\n\
-	addq $16,%rsp		# Adjust stack\n\
+	movq 48(%rsp),%r9	# Get register content back.\n\
+	movq 40(%rsp),%r8\n\
+	movq 32(%rsp),%rdi\n\
+	movq 24(%rsp),%rsi\n\
+	movq 16(%rsp),%rdx\n\
+	movq 8(%rsp),%rcx\n\
+	movq (%rsp),%rax\n\
+	addq $72,%rsp		# Adjust stack\n\
+	" CFI_ADJUST_CFA_OFFSET(-72)"\n\
 	jmp *%r11		# Jump to function address.\n\
+	" CFI_ENDPROC "\n\
 	.size _dl_runtime_resolve, .-_dl_runtime_resolve\n\
 	.size _dl_runtime_profile, .-_dl_runtime_profile\n\
 	.previous\n\
@@ -400,7 +416,7 @@
 	  *reloc_addr = value + reloc->r_addend;
 	  break;
 
-#ifdef USE_TLS
+#if defined USE_TLS && !defined RESOLVE_CONFLICT_FIND_MAP
 	case R_X86_64_DTPMOD64:
 # ifdef RTLD_BOOTSTRAP
 	  /* During startup the dynamic linker is always the module
@@ -459,6 +475,8 @@
 				strtab + refsym->st_name);
 	    }
 	  break;
+# ifndef RESOLVE_CONFLICT_FIND_MAP
+	  /* Not needed for dl-conflict.c.  */
 	case R_X86_64_PC32:
 	  *(unsigned int *) reloc_addr = value + reloc->r_addend
 	    - (Elf64_Addr) reloc_addr;
@@ -495,6 +513,7 @@
 	  memcpy (reloc_addr, (void *) value, MIN (sym->st_size,
 						   refsym->st_size));
 	  break;
+# endif
 	default:
 	  _dl_reloc_bad_type (map, r_type, 0);
 	  break;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/elf/start.S libc-20030708/sysdeps/x86_64/elf/start.S
--- glibc-2.3.2/sysdeps/x86_64/elf/start.S	2002-12-10 12:41:56.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/elf/start.S	2003-06-12 08:54:06.000000000 +0900
@@ -1,5 +1,5 @@
 /* Startup code compliant to the ELF x86-64 ABI.
-   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 2001.
 
@@ -74,6 +74,17 @@
 	   which grow downwards).  */
 	pushq %rsp
 
+#ifdef SHARED
+	/* Pass address of our own entry points to .fini and .init.  */
+	movq __libc_csu_fini@GOTPCREL(%rip), %r8
+	movq __libc_csu_init@GOTPCREL(%rip), %rcx
+
+	movq BP_SYM (main)@GOTPCREL(%rip), %rdi
+
+	/* Call the user's main function, and exit with its value.
+	   But let the libc call main.	  */
+	call BP_SYM (__libc_start_main)@PLT
+#else
 	/* Pass address of our own entry points to .fini and .init.  */
 	movq $__libc_csu_fini, %r8
 	movq $__libc_csu_init, %rcx
@@ -83,6 +94,7 @@
 	/* Call the user's main function, and exit with its value.
 	   But let the libc call main.	  */
 	call BP_SYM (__libc_start_main)
+#endif
 
 	hlt			/* Crash if somehow `exit' does return.	 */
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/fpu/libm-test-ulps libc-20030708/sysdeps/x86_64/fpu/libm-test-ulps
--- glibc-2.3.2/sysdeps/x86_64/fpu/libm-test-ulps	2002-12-07 07:25:36.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/fpu/libm-test-ulps	2003-03-23 09:52:10.000000000 +0900
@@ -145,7 +145,7 @@
 ldouble: 1
 
 # ccos
-Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
+Test "Imaginary part of: ccos (-2 - 3 i) == -4.18962569096880723013255501961597373 - 9.10922789375533659797919726277886212 i":
 float: 1
 ifloat: 1
 ildouble: 1
@@ -164,10 +164,10 @@
 ifloat: 1
 
 # ccosh
-Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Real part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
+Test "Imaginary part of: ccosh (-2 - 3 i) == -3.72454550491532256547397070325597253 + 0.511822569987384608834463849801875634 i":
 double: 1
 float: 1
 idouble: 1
@@ -215,7 +215,7 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (-2 - 3 i) == 0.5569716761534183846 - 0.9375544629863747085 i":
+Test "Imaginary part of: clog10 (-2 - 3 i) == 0.556971676153418384603252578971164214 - 0.937554462986374708541507952140189646 i":
 double: 1
 float: 5
 idouble: 1
@@ -373,10 +373,10 @@
 ifloat: 1
 
 # csinh
-Test "Real part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Real part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
-Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
+Test "Imaginary part of: csinh (-2 - 3 i) == 3.59056458998577995201256544779481679 - 0.530921086248519805267040090660676560 i":
 double: 1
 idouble: 1
 ildouble: 2
@@ -399,12 +399,12 @@
 ifloat: 1
 
 # ctan
-Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Real part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 double: 1
 idouble: 1
 ildouble: 439
 ldouble: 439
-Test "Imaginary part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
+Test "Imaginary part of: ctan (-2 - 3 i) == 0.376402564150424829275122113032269084e-2 - 1.00323862735360980144635859782192726 i":
 float: 1
 ifloat: 1
 ildouble: 2
@@ -421,14 +421,14 @@
 ldouble: 3
 
 # ctanh
-Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Real part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 float: 2
 ifloat: 2
 ildouble: 5
 ldouble: 5
 double: 1
 idouble: 1
-Test "Imaginary part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
+Test "Imaginary part of: ctanh (-2 - 3 i) == -0.965385879022133124278480269394560686 + 0.988437503832249372031403430350121098e-2 i":
 ildouble: 25
 ldouble: 25
 Test "Imaginary part of: ctanh (0 + pi/4 i) == 0.0 + 1.0 i":
@@ -677,12 +677,12 @@
 Test "lgamma (-0.5) == log(2*sqrt(pi))":
 ildouble: 1
 ldouble: 1
-Test "lgamma (0.7) == 0.26086724653166651439":
+Test "lgamma (0.7) == 0.260867246531666514385732417016759578":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "lgamma (1.2) == -0.853740900033158497197e-1":
+Test "lgamma (1.2) == -0.853740900033158497197028392998854470e-1":
 double: 1
 float: 2
 idouble: 1
@@ -749,7 +749,7 @@
 Test "tgamma (0.5) == sqrt (pi)":
 float: 1
 ifloat: 1
-Test "tgamma (0.7) == 1.29805533264755778568":
+Test "tgamma (0.7) == 1.29805533264755778568117117915281162":
 double: 1
 float: 1
 idouble: 1
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/fpu_control.h libc-20030708/sysdeps/x86_64/fpu_control.h
--- glibc-2.3.2/sysdeps/x86_64/fpu_control.h	1970-01-01 09:00:00.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/fpu_control.h	2003-05-05 22:25:31.000000000 +0900
@@ -0,0 +1,101 @@
+/* FPU control word bits.  x86-64 version.
+   Copyright (C) 1993,1995,1996,1997,1998,2000,2001,2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Olaf Flebbe.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _FPU_CONTROL_H
+#define _FPU_CONTROL_H	1
+
+/* Note that this file sets on x86-64 only the x87 FPU, it does not
+   touch the SSE unit.  */
+
+/* Here is the dirty part. Set up your 387 through the control word
+ * (cw) register.
+ *
+ *     15-13    12  11-10  9-8     7-6     5    4    3    2    1    0
+ * | reserved | IC | RC  | PC | reserved | PM | UM | OM | ZM | DM | IM
+ *
+ * IM: Invalid operation mask
+ * DM: Denormalized operand mask
+ * ZM: Zero-divide mask
+ * OM: Overflow mask
+ * UM: Underflow mask
+ * PM: Precision (inexact result) mask
+ *
+ * Mask bit is 1 means no interrupt.
+ *
+ * PC: Precision control
+ * 11 - round to extended precision
+ * 10 - round to double precision
+ * 00 - round to single precision
+ *
+ * RC: Rounding control
+ * 00 - rounding to nearest
+ * 01 - rounding down (toward - infinity)
+ * 10 - rounding up (toward + infinity)
+ * 11 - rounding toward zero
+ *
+ * IC: Infinity control
+ * That is for 8087 and 80287 only.
+ *
+ * The hardware default is 0x037f which we use.
+ */
+
+#include <features.h>
+
+/* masking of interrupts */
+#define _FPU_MASK_IM  0x01
+#define _FPU_MASK_DM  0x02
+#define _FPU_MASK_ZM  0x04
+#define _FPU_MASK_OM  0x08
+#define _FPU_MASK_UM  0x10
+#define _FPU_MASK_PM  0x20
+
+/* precision control */
+#define _FPU_EXTENDED 0x300	/* libm requires double extended precision.  */
+#define _FPU_DOUBLE   0x200
+#define _FPU_SINGLE   0x0
+
+/* rounding control */
+#define _FPU_RC_NEAREST 0x0    /* RECOMMENDED */
+#define _FPU_RC_DOWN    0x400
+#define _FPU_RC_UP      0x800
+#define _FPU_RC_ZERO    0xC00
+
+#define _FPU_RESERVED 0xF0C0  /* Reserved bits in cw */
+
+
+/* The fdlibm code requires strict IEEE double precision arithmetic,
+   and no interrupts for exceptions, rounding to nearest.  */
+
+#define _FPU_DEFAULT  0x037f
+
+/* IEEE:  same as above.  */
+#define _FPU_IEEE     0x037f
+
+/* Type of the control word.  */
+typedef unsigned int fpu_control_t __attribute__ ((__mode__ (__HI__)));
+
+/* Macros for accessing the hardware control word.  */
+#define _FPU_GETCW(cw) __asm__ ("fnstcw %0" : "=m" (*&cw))
+#define _FPU_SETCW(cw) __asm__ ("fldcw %0" : : "m" (*&cw))
+
+/* Default control word set at startup.  */
+extern fpu_control_t __fpu_control;
+
+#endif	/* fpu_control.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/memcpy.S libc-20030708/sysdeps/x86_64/memcpy.S
--- glibc-2.3.2/sysdeps/x86_64/memcpy.S	2002-09-01 02:33:34.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/memcpy.S	2003-05-02 00:11:53.000000000 +0900
@@ -1,5 +1,5 @@
 /* Highly optimized version for x86-64.
-   Copyright (C) 1997, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Based on i586 version contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -90,3 +90,4 @@
 	ret
 
 END (BP_SYM (memcpy))
+libc_hidden_builtin_def (memcpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/memset.S libc-20030708/sysdeps/x86_64/memset.S
--- glibc-2.3.2/sysdeps/x86_64/memset.S	2002-09-01 02:42:25.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/memset.S	2003-05-02 00:11:53.000000000 +0900
@@ -1,6 +1,6 @@
 /* memset/bzero -- set memory area to CH/0
    Optimized version for x86-64.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>.
 
@@ -129,3 +129,6 @@
 	jmp	4b
 
 END (memset)
+#if !BZERO_P
+libc_hidden_builtin_def (memset)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strcat.S libc-20030708/sysdeps/x86_64/strcat.S
--- glibc-2.3.2/sysdeps/x86_64/strcat.S	2002-11-14 06:42:12.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strcat.S	2003-05-02 00:11:53.000000000 +0900
@@ -257,3 +257,4 @@
 	movq	%rdi, %rax	/* Source is return value.  */
 	retq
 END (BP_SYM (strcat))
+libc_hidden_builtin_def (strcat)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strchr.S libc-20030708/sysdeps/x86_64/strchr.S
--- glibc-2.3.2/sysdeps/x86_64/strchr.S	2002-11-14 06:42:12.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strchr.S	2003-05-02 00:11:53.000000000 +0900
@@ -288,3 +288,4 @@
 END (BP_SYM (strchr))
 
 weak_alias (BP_SYM (strchr), BP_SYM (index))
+libc_hidden_builtin_def (strchr)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strcmp.S libc-20030708/sysdeps/x86_64/strcmp.S
--- glibc-2.3.2/sysdeps/x86_64/strcmp.S	2002-09-01 02:41:24.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strcmp.S	2003-05-02 00:11:53.000000000 +0900
@@ -1,5 +1,5 @@
 /* Highly optimized version for x86-64.
-   Copyright (C) 1999, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1999, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Based on i686 version contributed by Ulrich Drepper
    <drepper@cygnus.com>, 1999.
@@ -42,3 +42,4 @@
 	cmovbl	%ecx, %eax
 	ret
 END (BP_SYM (strcmp))
+libc_hidden_builtin_def (strcmp)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strcpy.S libc-20030708/sysdeps/x86_64/strcpy.S
--- glibc-2.3.2/sysdeps/x86_64/strcpy.S	2002-09-01 02:41:24.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strcpy.S	2003-05-02 00:11:53.000000000 +0900
@@ -154,3 +154,6 @@
 #endif
 	retq
 END (BP_SYM (STRCPY))
+#ifndef USE_AS_STPCPY
+libc_hidden_builtin_def (strcpy)
+#endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strcspn.S libc-20030708/sysdeps/x86_64/strcspn.S
--- glibc-2.3.2/sysdeps/x86_64/strcspn.S	2002-09-01 02:41:24.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strcspn.S	2003-05-02 00:11:53.000000000 +0900
@@ -1,7 +1,7 @@
 /* strcspn (str, ss) -- Return the length of the initial segment of STR
 			which contains no characters from SS.
    For AMD x86-64.
-   Copyright (C) 1994, 1995, 1996, 1997, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1994-1997, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>.
    Bug fixes by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>.
@@ -121,3 +121,4 @@
 #endif
 	ret
 END (strcspn)
+libc_hidden_builtin_def (strcspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strlen.S libc-20030708/sysdeps/x86_64/strlen.S
--- glibc-2.3.2/sysdeps/x86_64/strlen.S	2002-09-01 02:41:24.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strlen.S	2003-05-02 00:11:53.000000000 +0900
@@ -1,5 +1,5 @@
 /* strlen(str) -- determine the length of the string STR.
-   Copyright (C) 2002 Free Software Foundation, Inc.
+   Copyright (C) 2002, 2003 Free Software Foundation, Inc.
    Based on i486 version contributed by Ulrich Drepper <drepper@redhat.com>.
    This file is part of the GNU C Library.
 
@@ -136,3 +136,4 @@
 	subq %rdi, %rax		/* compute difference to string start */
 	ret
 END (strlen)
+libc_hidden_builtin_def (strlen)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strspn.S libc-20030708/sysdeps/x86_64/strspn.S
--- glibc-2.3.2/sysdeps/x86_64/strspn.S	2002-09-01 02:41:24.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strspn.S	2003-05-02 00:11:53.000000000 +0900
@@ -1,7 +1,7 @@
 /* strspn (str, ss) -- Return the length of the initial segment of STR
 			which contains only characters from SS.
    For AMD x86-64.
-   Copyright (C) 1994, 1995, 1996, 1997, 2000, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1994-1997, 2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>.
    Bug fixes by Alan Modra <Alan@SPRI.Levels.UniSA.Edu.Au>.
@@ -111,3 +111,4 @@
 				   non-valid character */
 	ret
 END (strspn)
+libc_hidden_builtin_def (strspn)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/strtok.S libc-20030708/sysdeps/x86_64/strtok.S
--- glibc-2.3.2/sysdeps/x86_64/strtok.S	2002-09-01 02:33:34.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/strtok.S	2003-06-12 08:54:06.000000000 +0900
@@ -1,6 +1,6 @@
 /* strtok (str, delim) -- Return next DELIM separated token from STR.
    For AMD x86-64.
-   Copyright (C) 1998, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Based on i686 version contributed by Ulrich Drepper
    <drepper@cygnus.com>, 1998.
@@ -68,6 +68,7 @@
 	   table.  */
 	movq %rdi, %r8			/* Save value.  */
 	subq $256, %rsp			/* Make space for 256 bytes.  */
+	cfi_adjust_cfa_offset(256)
 	movq $32,  %rcx			/* 32*8 bytes = 256 bytes.  */
 	movq %rsp, %rdi
 	xorq %rax, %rax			/* We store 0s.  */
@@ -199,6 +200,7 @@
 L(epilogue):
 	/* Remove the stopset table.  */
 	addq $256, %rsp
+	cfi_adjust_cfa_offset(-256)
 	retq
 
 L(returnNULL):
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysdeps/x86_64/sysdep.h libc-20030708/sysdeps/x86_64/sysdep.h
--- glibc-2.3.2/sysdeps/x86_64/sysdep.h	2003-01-10 04:43:34.000000000 +0900
+++ libc-20030708/sysdeps/x86_64/sysdep.h	2003-05-21 23:20:38.000000000 +0900
@@ -50,18 +50,26 @@
   ASM_TYPE_DIRECTIVE (C_SYMBOL_NAME(name),@function)			      \
   .align ALIGNARG(4);							      \
   C_LABEL(name)								      \
+  cfi_startproc;							      \
   CALL_MCOUNT
 
 #undef	END
 #define END(name)							      \
-  ASM_SIZE_DIRECTIVE(name)						      \
+  cfi_endproc;								      \
+  ASM_SIZE_DIRECTIVE(name)
 
 /* If compiled for profiling, call `mcount' at the start of each function.  */
 #ifdef	PROF
 /* The mcount code relies on a normal frame pointer being on the stack
    to locate our caller, so push one just for its benefit.  */
-#define CALL_MCOUNT \
-  pushq %rbp; movq %rsp, %rbp; call JUMPTARGET(mcount); popq %rbp;
+#define CALL_MCOUNT                                                          \
+  pushq %rbp;                                                                \
+  cfi_adjust_cfa_offset(8);                                                  \
+  movq %rsp, %rbp;                                                           \
+  cfi_def_cfa_register(%rbp);                                                \
+  call JUMPTARGET(mcount);                                                   \
+  popq %rbp;                                                                 \
+  cfi_def_cfa(rsp,8);
 #else
 #define CALL_MCOUNT		/* Do nothing.  */
 #endif
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysvipc/Makefile libc-20030708/sysvipc/Makefile
--- glibc-2.3.2/sysvipc/Makefile	2002-10-25 17:02:45.000000000 +0900
+++ libc-20030708/sysvipc/Makefile	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1995, 1996, 1997, 2002 Free Software Foundation, Inc.
+# Copyright (C) 1995, 1996, 1997, 2002, 2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -26,7 +26,10 @@
 
 routines := ftok \
 	    msgsnd msgrcv msgget msgctl \
-	    semop semget semctl \
+	    semop semget semctl semtimedop \
 	    shmat shmdt shmget shmctl
 
 include ../Rules
+
+CFLAGS-msgrcv.c = -fexceptions -fasynchronous-unwind-tables
+CFLAGS-msgsnd.c = -fexceptions -fasynchronous-unwind-tables
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysvipc/Versions libc-20030708/sysvipc/Versions
--- glibc-2.3.2/sysvipc/Versions	2002-12-19 07:49:52.000000000 +0900
+++ libc-20030708/sysvipc/Versions	2003-04-15 23:55:51.000000000 +0900
@@ -9,6 +9,10 @@
     # s*
     semctl; semget; semop; shmat; shmctl; shmdt; shmget;
   }
+  GLIBC_2.3.3 {
+    # Non-standard function.
+    semtimedop;
+  }
   GLIBC_PRIVATE {
     # Cancellation point entries.
     __libc_msgrcv; __libc_msgsnd;
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysvipc/sys/msg.h libc-20030708/sysvipc/sys/msg.h
--- glibc-2.3.2/sysvipc/sys/msg.h	2001-07-08 04:21:39.000000000 +0900
+++ libc-20030708/sysvipc/sys/msg.h	2003-04-28 23:53:27.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995, 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1995,1996,1997,1999,2000,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -62,13 +62,19 @@
 /* Get messages queue.  */
 extern int msgget (key_t __key, int __msgflg) __THROW;
 
-/* Receive message from message queue.  */
+/* Receive message from message queue.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int msgrcv (int __msqid, void *__msgp, size_t __msgsz,
-		   long int __msgtyp, int __msgflg) __THROW;
+		   long int __msgtyp, int __msgflg);
+
+/* Send message to message queue.
 
-/* Send message to message queue.  */
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int msgsnd (int __msqid, __const void *__msgp, size_t __msgsz,
-		   int __msgflg) __THROW;
+		   int __msgflg);
 
 __END_DECLS
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/sysvipc/sys/sem.h libc-20030708/sysvipc/sys/sem.h
--- glibc-2.3.2/sysvipc/sys/sem.h	2001-07-08 04:21:39.000000000 +0900
+++ libc-20030708/sysvipc/sys/sem.h	2003-04-15 23:55:51.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995-1999, 2000 Free Software Foundation, Inc.
+/* Copyright (C) 1995-1999, 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -30,6 +30,11 @@
 /* Get system dependent definition of `struct semid_ds' and more.  */
 #include <bits/sem.h>
 
+#ifdef __USE_GNU
+# define __need_timespec
+# include <time.h>
+#endif
+
 /* The following System V style IPC functions implement a semaphore
    handling.  The definition is found in XPG2.  */
 
@@ -53,6 +58,12 @@
 /* Operate on semaphore.  */
 extern int semop (int __semid, struct sembuf *__sops, size_t __nsops) __THROW;
 
+#ifdef __USE_GNU
+/* Operate on semaphore with timeout.  */
+extern int semtimedop (int __semid, struct sembuf *__sops, size_t __nsops,
+		       __const struct timespec *__timeout) __THROW;
+#endif
+
 __END_DECLS
 
 #endif /* sys/sem.h */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/termios/Makefile libc-20030708/termios/Makefile
--- glibc-2.3.2/termios/Makefile	2001-07-08 04:21:39.000000000 +0900
+++ libc-20030708/termios/Makefile	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-# Copyright (C) 1991, 1992, 1993, 1995, 1997 Free Software Foundation, Inc.
+# Copyright (C) 1991,1992,1993,1995,1997,2003 Free Software Foundation, Inc.
 # This file is part of the GNU C Library.
 
 # The GNU C Library is free software; you can redistribute it and/or
@@ -28,3 +28,5 @@
 		   tcdrain tcflow tcflush tcsendbrk cfmakeraw tcgetsid
 
 include ../Rules
+
+CFLAGS-tcdrain.c = -fexceptions -fasynchronous-unwind-tables
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/termios/termios.h libc-20030708/termios/termios.h
--- glibc-2.3.2/termios/termios.h	2001-07-08 04:21:39.000000000 +0900
+++ libc-20030708/termios/termios.h	2003-04-28 23:53:27.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991,92,93,94,96,97,98,99 Free Software Foundation, Inc.
+/* Copyright (C) 1991,92,93,94,96,97,98,99, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -80,8 +80,11 @@
 /* Send zero bits on FD.  */
 extern int tcsendbreak (int __fd, int __duration) __THROW;
 
-/* Wait for pending output to be written on FD.  */
-extern int tcdrain (int __fd) __THROW;
+/* Wait for pending output to be written on FD.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
+extern int tcdrain (int __fd);
 
 /* Flush pending data on FD.
    Values for QUEUE_SELECTOR (TC{I,O,IO}FLUSH) are in <bits/termios.h>.  */
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/test-skeleton.c libc-20030708/test-skeleton.c
--- glibc-2.3.2/test-skeleton.c	2002-12-19 20:15:16.000000000 +0900
+++ libc-20030708/test-skeleton.c	2003-07-08 22:58:05.000000000 +0900
@@ -1,5 +1,5 @@
 /* Skeleton for test programs.
-   Copyright (C) 1998, 2000, 2001, 2002 Free Software Foundation, Inc.
+   Copyright (C) 1998, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1998.
 
@@ -18,6 +18,7 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
+#include <errno.h>
 #include <getopt.h>
 #include <search.h>
 #include <signal.h>
@@ -28,6 +29,7 @@
 #include <sys/resource.h>
 #include <sys/wait.h>
 #include <sys/param.h>
+#include <time.h>
 
 /* The test function is normally called `do_test' and it is called
    with argc and argv as the arguments.  We nevertheless provide the
@@ -138,7 +140,20 @@
   kill (pid, SIGKILL);
 
   /* Wait for it to terminate.  */
-  killed = waitpid (pid, &status, WNOHANG|WUNTRACED);
+  int i;
+  for (i = 0; i < 5; ++i)
+    {
+      killed = waitpid (pid, &status, WNOHANG|WUNTRACED);
+      if (killed != 0)
+	break;
+
+      /* Delay, give the system time to process the kill.  If the
+	 nanosleep() call return prematurely, all the better.  We
+	 won't restart it since this probably means the child process
+	 finally died.  */
+      struct timespec ts = { .tv_sec = 0, .tv_nsec = 100000000 };
+      nanosleep (&ts, NULL);
+    }
   if (killed != 0 && killed != pid)
     {
       perror ("Failed to killed test process");
@@ -155,7 +170,7 @@
     exit (0);
 #endif
 
-  if (WIFSIGNALED (status) && WTERMSIG (status) == SIGKILL)
+  if (killed == 0 || (WIFSIGNALED (status) && WTERMSIG (status) == SIGKILL))
     fputs ("Timed out: killed the child process\n", stderr);
   else if (WIFSTOPPED (status))
     fprintf (stderr, "Timed out: the child process was %s\n",
@@ -184,7 +199,7 @@
   setbuf (stdout, NULL);
 #endif
 
-  while ((opt = getopt_long (argc, argv, "", options, NULL)) != -1)
+  while ((opt = getopt_long (argc, argv, "+", options, NULL)) != -1)
     switch (opt)
       {
       case '?':
@@ -290,11 +305,11 @@
   /* Default timeout is two seconds.  */
 # define TIMEOUT 2
 #endif
-  alarm (TIMEOUT);
   signal (SIGALRM, timeout_handler);
+  alarm (TIMEOUT);
 
   /* Wait for the regular termination.  */
-  termpid = waitpid (pid, &status, 0);
+  termpid = TEMP_FAILURE_RETRY (waitpid (pid, &status, 0));
   if (termpid == -1)
     {
       printf ("Waiting for test program failed: %m\n");
@@ -332,5 +347,16 @@
     }
 
   /* Simply exit with the return value of the test.  */
+#ifndef EXPECTED_STATUS
   return WEXITSTATUS (status);
+#else
+  if (WEXITSTATUS (status) != EXPECTED_STATUS)
+    {
+      fprintf (stderr, "Expected status %d, got %d\n",
+	       EXPECTED_STATUS, WEXITSTATUS (status));
+      exit (1);
+    }
+
+  return 0;
+#endif
 }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/time/strftime.c libc-20030708/time/strftime.c
--- glibc-2.3.2/time/strftime.c	2003-01-20 03:35:06.000000000 +0900
+++ libc-20030708/time/strftime.c	2003-07-08 22:58:15.000000000 +0900
@@ -977,8 +977,8 @@
 	     jump to one of these two labels.  */
 
 	do_number_spacepad:
-	  /* Force `_' flag unless overwritten by `0' flag.  */
-	  if (pad != L_('0'))
+	  /* Force `_' flag unless overwritten by `0' or '-' flag.  */
+	  if (pad != L_('0') && pad != L_('-'))
 	    pad = L_('_');
 
 	do_number:
@@ -1144,13 +1144,17 @@
 	  goto subformat;
 
 	case L_('r'):
-#ifdef _NL_CURRENT
+#if !defined _NL_CURRENT && HAVE_STRFTIME
+	  goto underlying_strftime;
+#else
+# ifdef _NL_CURRENT
 	  if (*(subfmt = (const CHAR_T *) _NL_CURRENT (LC_TIME,
 						       NLW(T_FMT_AMPM)))
 	      == L_('\0'))
-#endif
+# endif
 	    subfmt = L_("%I:%M:%S %p");
 	  goto subformat;
+#endif
 
 	case L_('S'):
 	  if (modifier == L_('E'))
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/time/time.h libc-20030708/time/time.h
--- glibc-2.3.2/time/time.h	2002-12-31 08:53:58.000000000 +0900
+++ libc-20030708/time/time.h	2003-04-28 23:53:27.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991-1999, 2000, 2001, 2002 Free Software Foundation, Inc.
+/* Copyright (C) 1991-1999,2000,2001,2002,2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -317,9 +317,12 @@
 
 
 # ifdef __USE_POSIX199309
-/* Pause execution for a number of nanoseconds.  */
+/* Pause execution for a number of nanoseconds.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int nanosleep (__const struct timespec *__requested_time,
-		      struct timespec *__remaining) __THROW;
+		      struct timespec *__remaining);
 
 
 /* Get resolution of clock CLOCK_ID.  */
@@ -333,10 +336,13 @@
      __THROW;
 
 #  ifdef __USE_XOPEN2K
-/* High-resolution sleep with the specified clock.  */
+/* High-resolution sleep with the specified clock.
+
+   This function is a cancellation point and therefore not marked with
+   __THROW.  */
 extern int clock_nanosleep (clockid_t __clock_id, int __flags,
 			    __const struct timespec *__req,
-			    struct timespec *__rem) __THROW;
+			    struct timespec *__rem);
 
 /* Return clock ID for CPU-time clock.  */
 extern int clock_getcpuclockid (pid_t __pid, clockid_t *__clock_id) __THROW;
@@ -382,8 +388,11 @@
 /* Parse the given string as a date specification and return a value
    representing the value.  The templates from the file identified by
    the environment variable DATEMSK are used.  In case of an error
-   `getdate_err' is set.  */
-extern struct tm *getdate (__const char *__string) __THROW;
+   `getdate_err' is set.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern struct tm *getdate (__const char *__string);
 # endif
 
 # ifdef __USE_GNU
@@ -391,9 +400,14 @@
    and the static buffer to return the result in, we provide a thread-safe
    variant.  The functionality is the same.  The result is returned in
    the buffer pointed to by RESBUFP and in case of an error the return
-   value is != 0 with the same values as given above for `getdate_err'.  */
+   value is != 0 with the same values as given above for `getdate_err'.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int getdate_r (__const char *__restrict __string,
-		      struct tm *__restrict __resbufp) __THROW;
+		      struct tm *__restrict __resbufp);
 # endif
 
 __END_DECLS
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/time/tst-strftime.c libc-20030708/time/tst-strftime.c
--- glibc-2.3.2/time/tst-strftime.c	2003-01-19 14:30:27.000000000 +0900
+++ libc-20030708/time/tst-strftime.c	2003-05-21 23:20:38.000000000 +0900
@@ -1,5 +1,6 @@
 #include <stdio.h>
 #include <stdlib.h>
+#include <string.h>
 #include <time.h>
 
 
@@ -67,6 +68,42 @@
       free (buf);
     }
 
+  struct tm ttm =
+    {
+      /* Initialize the fields which are needed in the tests.  */
+      .tm_mday = 1,
+      .tm_hour = 2
+    };
+  const struct
+  {
+    const char *fmt;
+    const char *exp;
+    size_t n;
+  } ftests[] =
+    {
+      { "%-e", "1", 1 },
+      { "%-k", "2", 1 },
+      { "%-l", "2", 1 },
+    };
+#define nftests (sizeof (ftests) / sizeof (ftests[0]))
+  for (cnt = 0; cnt < nftests; ++cnt)
+    {
+      char buf[100];
+      size_t r = strftime (buf, sizeof (buf), ftests[cnt].fmt, &ttm);
+      if (r != ftests[cnt].n)
+	{
+	  printf ("strftime(\"%s\") returned %zu not %zu\n",
+		  ftests[cnt].fmt, r, ftests[cnt].n);
+	  result = 1;
+	}
+      if (strcmp (buf, ftests[cnt].exp) != 0)
+	{
+	  printf ("strftime(\"%s\") produced \"%s\" not \"%s\"\n",
+		  ftests[cnt].fmt, buf, ftests[cnt].exp);
+	  result = 1;
+	}
+    }
+
   return result;
 }
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/time/tzfile.c libc-20030708/time/tzfile.c
--- glibc-2.3.2/time/tzfile.c	2003-02-02 05:46:36.000000000 +0900
+++ libc-20030708/time/tzfile.c	2003-06-12 08:54:06.000000000 +0900
@@ -64,6 +64,7 @@
 
 /* Decode the four bytes at PTR as a signed integer in network byte order.  */
 static inline int
+__attribute ((always_inline))
 decode (const void *ptr)
 {
   if ((BYTE_ORDER == BIG_ENDIAN) && sizeof (int) == 4)
@@ -154,7 +155,8 @@
   /* No threads reading this stream.  */
   __fsetlocking (f, FSETLOCKING_BYCALLER);
 
-  if (fread_unlocked ((void *) &tzhead, sizeof (tzhead), 1, f) != 1)
+  if (__builtin_expect (fread_unlocked ((void *) &tzhead, sizeof (tzhead),
+					1, f) != 1, 0))
     goto lose;
 
   num_transitions = (size_t) decode (tzhead.tzh_timecnt);
@@ -193,23 +195,24 @@
 
   if (sizeof (time_t) == 4)
     {
-      if (fread_unlocked (transitions, 1, (4 + 1) * num_transitions, f)
-	  != (4 + 1) * num_transitions)
+      if (__builtin_expect (fread_unlocked (transitions, 1,
+					    (4 + 1) * num_transitions, f)
+			    != (4 + 1) * num_transitions, 0))
 	goto lose;
     }
   else
     {
-      if (fread_unlocked (transitions, 4, num_transitions, f)
-	  != num_transitions
-	  || fread_unlocked (type_idxs, 1, num_transitions, f)
-	  != num_transitions)
+      if (__builtin_expect (fread_unlocked (transitions, 4, num_transitions, f)
+			    != num_transitions, 0)
+	  || __builtin_expect (fread_unlocked (type_idxs, 1, num_transitions,
+					       f) != num_transitions, 0))
 	goto lose;
     }
 
   /* Check for bogus indices in the data file, so we can hereafter
      safely use type_idxs[T] as indices into `types' and never crash.  */
   for (i = 0; i < num_transitions; ++i)
-    if (type_idxs[i] >= num_types)
+    if (__builtin_expect (type_idxs[i] >= num_types, 0))
       goto lose;
 
   if (BYTE_ORDER != BIG_ENDIAN || sizeof (time_t) != 4)
@@ -227,29 +230,33 @@
     {
       unsigned char x[4];
       int c;
-      if (fread_unlocked (x, 1, sizeof (x), f) != sizeof (x))
+      if (__builtin_expect (fread_unlocked (x, 1, sizeof (x), f) != sizeof (x),
+			    0))
 	goto lose;
       c = getc_unlocked (f);
-      if ((unsigned int) c > 1u)
+      if (__builtin_expect ((unsigned int) c > 1u, 0))
 	goto lose;
       types[i].isdst = c;
       c = getc_unlocked (f);
-      if ((size_t) c > chars) /* Bogus index in data file.  */
+      if (__builtin_expect ((size_t) c > chars, 0))
+	/* Bogus index in data file.  */
 	goto lose;
       types[i].idx = c;
       types[i].offset = (long int) decode (x);
     }
 
-  if (fread_unlocked (zone_names, 1, chars, f) != chars)
+  if (__builtin_expect (fread_unlocked (zone_names, 1, chars, f) != chars, 0))
     goto lose;
 
   for (i = 0; i < num_leaps; ++i)
     {
       unsigned char x[4];
-      if (fread_unlocked (x, 1, sizeof (x), f) != sizeof (x))
+      if (__builtin_expect (fread_unlocked (x, 1, sizeof (x), f) != sizeof (x),
+			    0))
 	goto lose;
       leaps[i].transition = (time_t) decode (x);
-      if (fread_unlocked (x, 1, sizeof (x), f) != sizeof (x))
+      if (__builtin_expect (fread_unlocked (x, 1, sizeof (x), f) != sizeof (x),
+			    0))
 	goto lose;
       leaps[i].change = (long int) decode (x);
     }
@@ -257,7 +264,7 @@
   for (i = 0; i < num_isstd; ++i)
     {
       int c = getc_unlocked (f);
-      if (c == EOF)
+      if (__builtin_expect (c == EOF, 0))
 	goto lose;
       types[i].isstd = c != 0;
     }
@@ -267,7 +274,7 @@
   for (i = 0; i < num_isgmt; ++i)
     {
       int c = getc_unlocked (f);
-      if (c == EOF)
+      if (__builtin_expect (c == EOF, 0))
 	goto lose;
       types[i].isgmt = c != 0;
     }
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/antarctica libc-20030708/timezone/antarctica
--- glibc-2.3.2/timezone/antarctica	2001-06-10 05:29:18.000000000 +0900
+++ libc-20030708/timezone/antarctica	2003-03-25 19:49:29.000000000 +0900
@@ -1,4 +1,4 @@
-# @(#)antarctica	7.22
+# @(#)antarctica	7.23
 
 # From Paul Eggert (1999-11-15):
 # To keep things manageable, we list only locations occupied year-round; see
@@ -255,6 +255,13 @@
 #	Halley is on a moving ice shelf and is periodically relocated
 #	so that it is never more than 10km from its nominal location.
 # Rothera, Adelaide Island, -6734-6808, since 1976-12-01
+#
+# From Paul Eggert (2002-10-22)
+# <http://webexhibits.org/daylightsaving/g.html> says Rothera is -03 all year.
+#
+# Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
+Zone Antarctica/Rothera	0	-	zzz	1976 Dec  1
+			-3:00	-	ROTT	# Rothera time
 
 # Uruguay - year round base
 # Artigas, King George Island, -621104-0585107
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/asia libc-20030708/timezone/asia
--- glibc-2.3.2/timezone/asia	2002-10-16 01:59:28.000000000 +0900
+++ libc-20030708/timezone/asia	2003-03-25 19:49:29.000000000 +0900
@@ -1,4 +1,4 @@
-# @(#)asia	7.68
+# @(#)asia	7.71
 
 # This data is by no means authoritative; if you think you know better,
 # go ahead and edit the file (and please send any changes to
@@ -29,22 +29,23 @@
 # I invented the abbreviations marked `*' in the following table;
 # the rest are from earlier versions of this file, or from other sources.
 # Corrections are welcome!
-#		std dst
-#		LMT	Local Mean Time
-#	2:00	EET EEST Eastern European Time
-#	2:00	IST IDT	Israel
-#	3:00	AST ADT	Arabia*
-#	4:00	GST	Gulf*
-#	5:30	IST	India
-#	7:00	ICT	Indochina*
-#	7:00	WIT	west Indonesia
-#	8:00	CIT	central Indonesia
-#	8:00	CST	China
-#	9:00	CJT	Central Japanese Time (1896/1937)*
-#	9:00	EIT	east Indonesia
-#	9:00	JST	Japan
-#	9:00	KST	Korea
-#	9:30	CST	(Australian) Central Standard Time
+#	     std  dst
+#	     LMT	Local Mean Time
+#	2:00 EET  EEST	Eastern European Time
+#	2:00 IST  IDT	Israel
+#	3:00 AST  ADT	Arabia*
+#	3:30 IRST IRDT	Iran
+#	4:00 GST	Gulf*
+#	5:30 IST	India
+#	7:00 ICT	Indochina*
+#	7:00 WIT	west Indonesia
+#	8:00 CIT	central Indonesia
+#	8:00 CST	China
+#	9:00 CJT	Central Japanese Time (1896/1937)*
+#	9:00 EIT	east Indonesia
+#	9:00 JST	Japan
+#	9:00 KST	Korea
+#	9:30 CST	(Australian) Central Standard Time
 #
 # See the `europe' file for Russia and Turkey in Asia.
 
@@ -430,89 +431,97 @@
 			9:00	-	EIT
 
 # Iran
-# From Paul Eggert (2000-06-12), following up a suggestion by Rich Wales:
-# Ahmea Alavi in
-# <a href="http://www.persia.org/Iran_Lib/Calendar/taghveem.txt">
-# TAGHVEEM (1993-07-12)
-# </a>
-# writes ``Daylight saving time in Iran starts from the first day
-# of Farvardin and ends the first day of Mehr.''  This disagrees with the SSIM:
-#
-#		   DST start	   DST end
-#	year	SSIM	Alavi	SSIM	Alavi
-#	1991	05-03!=	03-21	09-20!=	09-23
-#	1992	03-22!=	03-21	09-23	09-23
-#	1993	03-21	03-21	09-23	09-23
-#	1994	03-21	03-21	09-22!= 09-23
-#	1995	03-21	03-21	09-22!= 09-23
-#	1996	03-21!=	03-20	09-22   09-22
-#	1997	03-22!=	03-21	09-22!= 09-23
-#	1998	03-21	03-21	09-21!= 09-23
-#	1999	03-22!=	03-21	09-22!= 09-23
-#	2000	03-21!=	03-20	09-21!= 09-22
-#	2001	03-19!=	03-21	09-19!= 09-23
-#	2002	03-18!=	03-21	09-18!= 09-23
-#
-# Go with Alavi starting with 1992.
-# I used Ed Reingold's cal-persia in GNU Emacs 19.34 to compute Persian dates.
+
+# From Roozbeh Pournader (2003-03-15):
+# This is an English translation of what I just found (originally in Persian).
+# The Gregorian dates in brackets are mine:
+#
+#	Official Newspaper No. 13548-1370/6/25 [1991-09-16]
+#	No. 16760/T233 H				1370/6/10 [1991-09-01]
+#
+#	The Rule About Change of the Official Time of the Country
+#
+#	The Board of Ministers, in the meeting dated 1370/5/23 [1991-08-14],
+#	based on the suggestion number 2221/D dated 1370/4/22 [1991-07-13]
+#	of the Country's Organization for Official and Employment Affairs,
+#	and referring to the law for equating the working hours of workers
+#	and officers in the whole country dated 1359/4/23 [1980-07-14], and
+#	for synchronizing the official times of the country, agreed that:
+#
+#	The official time of the country will should move forward one hour
+#	at the 24[:00] hours of the first day of Farvardin and should return
+#	to its previous state at the 24[:00] hours of the 30th day of
+#	Shahrivar.
+#
+#	First Deputy to the President - Hassan Habibi
+#
+# From personal experience, that agrees with what has been followed
+# for at least the last 5 years.  Before that, for a few years, the
+# date used was the first Thursday night of Farvardin and the last
+# Thursday night of Shahrivar, but I can't give exact dates....
+# I have also changed the abbreviations to what is considered correct
+# here in Iran, IRST for regular time and IRDT for daylight saving time.
+
+# From Paul Eggert (2003-03-15)
+# Go with Shanks before September 1991, and with Pournader thereafter.
+# I used Ed Reingold's cal-persia in GNU Emacs 21.2 to check Persian dates.
 # The Persian calendar is based on the sun, and dates after around 2050
 # are approximate; stop after 2037 when 32-bit time_t's overflow.
 #
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
-Rule	Iran	1978	1980	-	Mar	21	0:00	1:00	S
-Rule	Iran	1978	only	-	Oct	21	0:00	0	-
-Rule	Iran	1979	only	-	Sep	19	0:00	0	-
-Rule	Iran	1980	only	-	Sep	23	0:00	0	-
-Rule	Iran	1991	only	-	May	 3	0:00s	1:00	S
-Rule	Iran	1991	only	-	Sep	20	0:00s	0	-
-Rule	Iran	1992	1995	-	Mar	21	0:00	1:00	S
-Rule	Iran	1992	1995	-	Sep	23	0:00	0	-
-Rule	Iran	1996	only	-	Mar	20	0:00	1:00	S
-Rule	Iran	1996	only	-	Sep	22	0:00	0	-
-Rule	Iran	1997	1999	-	Mar	21	0:00	1:00	S
-Rule	Iran	1997	1999	-	Sep	23	0:00	0	-
-Rule	Iran	2000	only	-	Mar	20	0:00	1:00	S
-Rule	Iran	2000	only	-	Sep	22	0:00	0	-
-Rule	Iran	2001	2003	-	Mar	21	0:00	1:00	S
-Rule	Iran	2001	2003	-	Sep	23	0:00	0	-
-Rule	Iran	2004	only	-	Mar	20	0:00	1:00	S
-Rule	Iran	2004	only	-	Sep	22	0:00	0	-
-Rule	Iran	2005	2007	-	Mar	21	0:00	1:00	S
-Rule	Iran	2005	2007	-	Sep	23	0:00	0	-
-Rule	Iran	2008	only	-	Mar	20	0:00	1:00	S
-Rule	Iran	2008	only	-	Sep	22	0:00	0	-
-Rule	Iran	2009	2011	-	Mar	21	0:00	1:00	S
-Rule	Iran	2009	2011	-	Sep	23	0:00	0	-
-Rule	Iran	2012	only	-	Mar	20	0:00	1:00	S
-Rule	Iran	2012	only	-	Sep	22	0:00	0	-
-Rule	Iran	2013	2015	-	Mar	21	0:00	1:00	S
-Rule	Iran	2013	2015	-	Sep	23	0:00	0	-
-Rule	Iran	2016	only	-	Mar	20	0:00	1:00	S
-Rule	Iran	2016	only	-	Sep	22	0:00	0	-
-Rule	Iran	2017	2019	-	Mar	21	0:00	1:00	S
-Rule	Iran	2017	2019	-	Sep	23	0:00	0	-
-Rule	Iran	2020	only	-	Mar	20	0:00	1:00	S
-Rule	Iran	2020	only	-	Sep	22	0:00	0	-
-Rule	Iran	2021	2023	-	Mar	21	0:00	1:00	S
-Rule	Iran	2021	2023	-	Sep	23	0:00	0	-
-Rule	Iran	2024	2025	-	Mar	20	0:00	1:00	S
-Rule	Iran	2024	2025	-	Sep	22	0:00	0	-
-Rule	Iran	2026	2027	-	Mar	21	0:00	1:00	S
-Rule	Iran	2026	2027	-	Sep	23	0:00	0	-
-Rule	Iran	2028	2029	-	Mar	20	0:00	1:00	S
-Rule	Iran	2028	2029	-	Sep	22	0:00	0	-
-Rule	Iran	2030	2031	-	Mar	21	0:00	1:00	S
-Rule	Iran	2030	2031	-	Sep	23	0:00	0	-
-Rule	Iran	2032	2033	-	Mar	20	0:00	1:00	S
-Rule	Iran	2032	2033	-	Sep	22	0:00	0	-
-Rule	Iran	2034	2035	-	Mar	21	0:00	1:00	S
-Rule	Iran	2034	2035	-	Sep	23	0:00	0	-
-Rule	Iran	2036	2037	-	Mar	20	0:00	1:00	S
-Rule	Iran	2036	2037	-	Sep	22	0:00	0	-
+Rule	Iran	1978	1980	-	Mar	21	0:00	1:00	D
+Rule	Iran	1978	only	-	Oct	21	0:00	0	S
+Rule	Iran	1979	only	-	Sep	19	0:00	0	S
+Rule	Iran	1980	only	-	Sep	23	0:00	0	S
+Rule	Iran	1991	only	-	May	 3	0:00	1:00	D
+Rule	Iran	1992	1995	-	Mar	22	0:00	1:00	D
+Rule	Iran	1991	1995	-	Sep	22	0:00	0	S
+Rule	Iran	1996	only	-	Mar	21	0:00	1:00	D
+Rule	Iran	1996	only	-	Sep	21	0:00	0	S
+Rule	Iran	1997	1999	-	Mar	22	0:00	1:00	D
+Rule	Iran	1997	1999	-	Sep	22	0:00	0	S
+Rule	Iran	2000	only	-	Mar	21	0:00	1:00	D
+Rule	Iran	2000	only	-	Sep	21	0:00	0	S
+Rule	Iran	2001	2003	-	Mar	22	0:00	1:00	D
+Rule	Iran	2001	2003	-	Sep	22	0:00	0	S
+Rule	Iran	2004	only	-	Mar	21	0:00	1:00	D
+Rule	Iran	2004	only	-	Sep	21	0:00	0	S
+Rule	Iran	2005	2007	-	Mar	22	0:00	1:00	D
+Rule	Iran	2005	2007	-	Sep	22	0:00	0	S
+Rule	Iran	2008	only	-	Mar	21	0:00	1:00	D
+Rule	Iran	2008	only	-	Sep	21	0:00	0	S
+Rule	Iran	2009	2011	-	Mar	22	0:00	1:00	D
+Rule	Iran	2009	2011	-	Sep	22	0:00	0	S
+Rule	Iran	2012	only	-	Mar	21	0:00	1:00	D
+Rule	Iran	2012	only	-	Sep	21	0:00	0	S
+Rule	Iran	2013	2015	-	Mar	22	0:00	1:00	D
+Rule	Iran	2013	2015	-	Sep	22	0:00	0	S
+Rule	Iran	2016	only	-	Mar	21	0:00	1:00	D
+Rule	Iran	2016	only	-	Sep	21	0:00	0	S
+Rule	Iran	2017	2019	-	Mar	22	0:00	1:00	D
+Rule	Iran	2017	2019	-	Sep	22	0:00	0	S
+Rule	Iran	2020	only	-	Mar	21	0:00	1:00	D
+Rule	Iran	2020	only	-	Sep	21	0:00	0	S
+Rule	Iran	2021	2023	-	Mar	22	0:00	1:00	D
+Rule	Iran	2021	2023	-	Sep	22	0:00	0	S
+Rule	Iran	2024	2025	-	Mar	21	0:00	1:00	D
+Rule	Iran	2024	2025	-	Sep	21	0:00	0	S
+Rule	Iran	2026	2027	-	Mar	22	0:00	1:00	D
+Rule	Iran	2026	2027	-	Sep	22	0:00	0	S
+Rule	Iran	2028	2029	-	Mar	21	0:00	1:00	D
+Rule	Iran	2028	2029	-	Sep	21	0:00	0	S
+Rule	Iran	2030	2031	-	Mar	22	0:00	1:00	D
+Rule	Iran	2030	2031	-	Sep	22	0:00	0	S
+Rule	Iran	2032	2033	-	Mar	21	0:00	1:00	D
+Rule	Iran	2032	2033	-	Sep	21	0:00	0	S
+Rule	Iran	2034	2035	-	Mar	22	0:00	1:00	D
+Rule	Iran	2034	2035	-	Sep	22	0:00	0	S
+Rule	Iran	2036	2037	-	Mar	21	0:00	1:00	D
+Rule	Iran	2036	2037	-	Sep	21	0:00	0	S
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
 Zone	Asia/Tehran	3:25:44	-	LMT	1916
 			3:25:44	-	TMT	1946	# Tehran Mean Time
-			3:30	-	IRT	1977 Nov
+			3:30	-	IRST	1977 Nov
 			4:00	Iran	IR%sT	1979
 			3:30	Iran	IR%sT
 
@@ -748,7 +757,7 @@
 # bill have until July 24 to pass.
 #
 # (2002-07-25):
-# Thanks go to Yitschak Goldberg from E&M for bringing this (Hebrew) article 
+# Thanks go to Yitschak Goldberg from E&M for bringing this (Hebrew) article
 # to my attention:
 #
 #	http://www.ynet.co.il/articles/0,7340,L-2019315,00.html
@@ -878,7 +887,7 @@
 # - Kazakhstan did not observe DST in 1991.
 # - Qyzylorda switched from +5:00 to +6:00 on 1992-01-19 02:00.
 # - Oral switched from +5:00 to +4:00 in spring 1989.
-# 
+#
 #
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
 #
@@ -1154,9 +1163,26 @@
 # and Sunday of April" phrase, if taken literally, means that the
 # transition takes place at 00:00 on the first Sunday on or after 04-02.
 
+# From Paul Eggert (2003-02-09):
+# DAWN <http://www.dawn.com/2002/10/06/top13.htm> reported on 2002-10-05
+# that 2002 DST ended that day at midnight.  Go with McDow for now.
+
+# From Steffen Thorsen (2003-03-14):
+# According to http://www.dawn.com/2003/03/07/top15.htm
+# there will be no DST in Pakistan this year:
+#
+# ISLAMABAD, March 6: Information and Media Development Minister Sheikh
+# Rashid Ahmed on Thursday said the cabinet had reversed a previous
+# decision to advance clocks by one hour in summer and put them back by
+# one hour in winter with the aim of saving light hours and energy.
+#
+# The minister told a news conference that the experiment had rather
+# shown 8 per cent higher consumption of electricity.
+
+
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
-Rule Pakistan	2002	max	-	Apr	Sun>=2	0:00	1:00	S
-Rule Pakistan	2002	max	-	Oct	15	0:00	0	-
+Rule Pakistan	2002	only	-	Apr	Sun>=2	0:01	1:00	S
+Rule Pakistan	2002	only	-	Oct	Sun>=2	0:01	0	-
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
 Zone	Asia/Karachi	4:28:12 -	LMT	1907
 			5:30	-	IST	1942 Sep
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/australasia libc-20030708/timezone/australasia
--- glibc-2.3.2/timezone/australasia	2002-10-16 01:59:28.000000000 +0900
+++ libc-20030708/timezone/australasia	2003-03-25 19:49:29.000000000 +0900
@@ -1,4 +1,4 @@
-# @(#)australasia	7.67
+# @(#)australasia	7.68
 # This file also includes Pacific islands.
 
 # Notes are at the end of this file
@@ -297,6 +297,17 @@
 ###############################################################################
 
 # New Zealand
+#
+# From Paul Eggert (2002-10-23):
+# The Department of Internal Affairs (DIA) maintains a brief history;
+# see tz-link.htm for the full reference.
+#
+# Shanks gives 1868 for the introduction of standard time; go with the
+# DIA's more-precise 1868-11-02.  The DIA says that clocks were
+# advanced by half an hour in 1941; go with Shanks's more-precise
+# 1940-09-29 02:00.  The DIA says that starting in 1933 DST began the
+# first Sunday in September; go with Shanks's last Sunday starting in
+# 1934.
 
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
 # Shanks gives 1927 Nov 6 - 1928 Mar 4, 1928 Oct 14 - 1929 Mar 17,
@@ -311,17 +322,17 @@
 # didn't change until 1945 Apr 30; go with Shanks.
 Rule	NZ	1934	1940	-	Apr	lastSun	2:00	0	S
 Rule	NZ	1934	1939	-	Sep	lastSun	2:00	0:30	HD
-Rule	NZ	1974	only	-	Nov	 3	2:00s	1:00	D
+Rule	NZ	1974	only	-	Nov	Sun>=1	2:00s	1:00	D
+Rule	NZ	1975	only	-	Feb	lastSun	2:00s	0	S
 Rule	NZ	1975	1988	-	Oct	lastSun	2:00s	1:00	D
-Rule	NZ	1989	only	-	Oct	 8	2:00s	1:00	D
-Rule	NZ	1990	max	-	Oct	Sun>=1	2:00s	1:00	D
-Rule	NZ	1975	only	-	Feb	23	2:00s	0	S
 Rule	NZ	1976	1989	-	Mar	Sun>=1	2:00s	0	S
+Rule	NZ	1989	only	-	Oct	Sun>=8	2:00s	1:00	D
+Rule	NZ	1990	max	-	Oct	Sun>=1	2:00s	1:00	D
 Rule	NZ	1990	max	-	Mar	Sun>=15	2:00s	0	S
 Rule	Chatham	1990	max	-	Oct	Sun>=1	2:45s	1:00	D
 Rule	Chatham	1991	max	-	Mar	Sun>=15	2:45s	0	S
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
-Zone Pacific/Auckland	11:39:04 -	LMT	1868
+Zone Pacific/Auckland	11:39:04 -	LMT	1868 Nov  2
 			11:30	NZ	NZ%sT	1940 Sep 29 2:00
 			12:00	NZ	NZ%sT
 Zone Pacific/Chatham	12:45	Chatham	CHA%sT
@@ -399,8 +410,8 @@
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
 Rule	Tonga	1999	only	-	Oct	 7	2:00s	1:00	S
 Rule	Tonga	2000	only	-	Mar	19	2:00s	0	-
-Rule	Tonga	2000	max	-	Nov	Sun>=1	2:00	1:00	S
-Rule	Tonga	2001	max	-	Jan	lastSun	2:00	0	-
+Rule	Tonga	2000	2001	-	Nov	Sun>=1	2:00	1:00	S
+Rule	Tonga	2001	2002	-	Jan	lastSun	2:00	0	-
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
 Zone Pacific/Tongatapu	12:19:20 -	LMT	1901
 			12:20	-	TOT	1941 # Tonga Time
@@ -739,21 +750,21 @@
 # The chosen rules the union of the 1971/1972 change and the 1989-1992 changes.
 
 # From Rives McDow (2002-04-09):
-# The most interesting region I have found consists of three towns on the 
-# southern coast of Australia, population 10 at last report, along with 
-# 50,000 sheep, about 100 kilometers long and 40 kilometers into the 
-# continent.  The primary town is Madura, with the other towns being 
-# Mundrabilla and Eucla.  According to the sheriff of Madura, the 
-# residents got tired of having to change the time so often, as they are 
-# located in a strip overlapping the border of South Australia and Western 
-# Australia.  South Australia observes daylight saving time; Western 
-# Australia does not.  The two states are one and a half hours apart.  The 
-# residents decided to forget about this nonsense of changing the clock so 
-# much and set the local time 20 hours and 45 minutes from the 
-# international date line, or right in the middle of the time of South 
-# Australia and Western Australia.  As it only affects about 10 people and 
-# tourists staying at the Madura Motel, it has never really made as big an 
-# impact as Broken Hill.  However, as tourist visiting there or anyone 
+# The most interesting region I have found consists of three towns on the
+# southern coast of Australia, population 10 at last report, along with
+# 50,000 sheep, about 100 kilometers long and 40 kilometers into the
+# continent.  The primary town is Madura, with the other towns being
+# Mundrabilla and Eucla.  According to the sheriff of Madura, the
+# residents got tired of having to change the time so often, as they are
+# located in a strip overlapping the border of South Australia and Western
+# Australia.  South Australia observes daylight saving time; Western
+# Australia does not.  The two states are one and a half hours apart.  The
+# residents decided to forget about this nonsense of changing the clock so
+# much and set the local time 20 hours and 45 minutes from the
+# international date line, or right in the middle of the time of South
+# Australia and Western Australia.  As it only affects about 10 people and
+# tourists staying at the Madura Motel, it has never really made as big an
+# impact as Broken Hill.  However, as tourist visiting there or anyone
 # calling the local sheriff will attest, they do keep time in this way.
 #
 # From Paul Eggert (2002-04-09):
@@ -1263,6 +1274,8 @@
 # of January the standard time in the Kingdom shall be moved backward by one
 # hour to 1:00am.
 
+# From Pulu 'Anau (2002-11-05):
+# The law was for 3 years, supposedly to get renewed.  It wasn't.
 
 ###############################################################################
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/europe libc-20030708/timezone/europe
--- glibc-2.3.2/timezone/europe	2002-04-06 12:40:00.000000000 +0900
+++ libc-20030708/timezone/europe	2003-03-25 19:49:29.000000000 +0900
@@ -1,4 +1,4 @@
-# @(#)europe	7.82
+# @(#)europe	7.83
 
 # This data is by no means authoritative; if you think you know better,
 # go ahead and edit the file (and please send any changes to
@@ -33,20 +33,20 @@
 # I invented the abbreviations marked `*' in the following table;
 # the rest are from earlier versions of this file, or from other sources.
 # Corrections are welcome!
-#		std dst
-#		LMT	Local Mean Time
-#	-4:00	AST	Atlantic
-#	-3:00	WGT WGST Western Greenland*
-#	-1:00	EGT EGST Eastern Greenland*
-#	 0:00	GMT BST Greenwich, British Summer
-#	 0:00	GMT IST Greenwich, Irish Summer
-#	 0:00	WET WEST Western Europe
-#	 0:19:32 AMT NST Amsterdam, Netherlands Summer (1835-1937)*
-#	 0:20	NET NEST Netherlands (1937-1940)*
-#	 1:00	CET CEST Central Europe
-#	 1:00:14 SET	 Swedish (1879-1899)*
-#	 2:00	EET EEST Eastern Europe
-#	 3:00	MSK MSD	Moscow
+#                   std dst  2dst
+#                   LMT           Local Mean Time
+#       -4:00       AST ADT       Atlantic
+#       -3:00       WGT WGST      Western Greenland*
+#       -1:00       EGT EGST      Eastern Greenland*
+#        0:00       GMT BST  BDST Greenwich, British Summer
+#        0:00       GMT IST       Greenwich, Irish Summer
+#        0:00       WET WEST WEMT Western Europe
+#        0:19:32.13 AMT NST       Amsterdam, Netherlands Summer (1835-1937)*
+#        0:20       NET NEST      Netherlands (1937-1940)*
+#        1:00       CET CEST CEMT Central Europe
+#        1:00:14    SET           Swedish (1879-1899)*
+#        2:00       EET EEST      Eastern Europe
+#        3:00       MSK MSD       Moscow
 #
 # A reliable and entertaining source about time zones, especially in Britain,
 # Derek Howse, Greenwich time and longitude, Philip Wilson Publishers (1997).
@@ -558,20 +558,30 @@
 			1:00	EU	CE%sT
 
 # Austria
+
+# From Paul Eggert (2003-02-28): Shanks gives 1918-06-16 and
+# 1945-11-18, but the Austrian Federal Office of Metrology and
+# Surveying (BEV) gives 1918-09-16 and for Vienna gives the "alleged"
+# date of 1945-04-12 with no time.  For the 1980-04-06 transition
+# Shanks gives 02:00, the BEV 00:00.  Go with the BEV, and guess 02:00
+# for 1945-04-12.
+
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
 Rule	Austria	1920	only	-	Apr	 5	2:00s	1:00	S
 Rule	Austria	1920	only	-	Sep	13	2:00s	0	-
-Rule	Austria	1945	only	-	Apr	 2	2:00s	1:00	S
-Rule	Austria	1945	only	-	Nov	18	2:00s	0	-
 Rule	Austria	1946	only	-	Apr	14	2:00s	1:00	S
 Rule	Austria	1946	1948	-	Oct	Sun>=1	2:00s	0	-
 Rule	Austria	1947	only	-	Apr	 6	2:00s	1:00	S
 Rule	Austria	1948	only	-	Apr	18	2:00s	1:00	S
+Rule	Austria	1980	only	-	Apr	 6	0:00	1:00	S
+Rule	Austria	1980	only	-	Sep	28	0:00	0	-
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
 Zone	Europe/Vienna	1:05:20 -	LMT	1893 Apr
-			1:00	C-Eur	CE%sT	1918 Jun 16 3:00
-			1:00	Austria	CE%sT	1940 Apr  1 2:00
-			1:00	C-Eur	CE%sT	1945 Apr  2 2:00
+			1:00	C-Eur	CE%sT	1920
+			1:00	Austria	CE%sT	1940 Apr  1 2:00s
+			1:00	C-Eur	CE%sT	1945 Apr  2 2:00s
+			1:00	1:00	CEST	1945 Apr 12 2:00s
+			1:00	-	CET	1946
 			1:00	Austria	CE%sT	1981
 			1:00	EU	CE%sT
 
@@ -654,7 +664,7 @@
 			1:00	EU	CE%sT
 
 # Bosnia and Herzegovina
-# see Yugoslavia
+# see Serbia and Montenegro
 
 # Bulgaria
 #
@@ -681,7 +691,7 @@
 			2:00	EU	EE%sT
 
 # Croatia
-# see Yugosloavia
+# see Serbia and Montenegro
 
 # Czech Republic
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
@@ -750,7 +760,7 @@
 # introduced.
 
 # From Rives McDow (2001-11-01):
-# 
+#
 # I correspond regularly with the Dansk Polarcenter, and wrote them at
 # the time to clarify the situation in Thule.  Unfortunately, I have
 # not heard back from them regarding my recent letter.  [But I have
@@ -991,25 +1001,29 @@
 # From Markus Kuhn <Markus.Kuhn@cl.cam.ac.uk> (1998-09-29):
 # The German time zone web site by the Physikalisch-Technische
 # Bundesanstalt contains DST information back to 1916.
-#
-#	<a href="http://www.ptb.de/english/org/4/43/432/lega.htm">
-#	Realisation of Legal Time in Germany
-#	</a>
+# [See tz-link.htm for the URL.]
+
+# From Joerg Schilling (2002-10-23):
+# In 1945, Berlin was switched to Moscow Summer time (GMT+4) by <a
+# href="http://www.dhm.de/lemo/html/biografien/BersarinNikolai/">
+# General [Nikolai] Bersarin</a>.
+
+# From Paul Eggert (2003-03-08):
+# <a href="http://www.parlament-berlin.de/pds-fraktion.nsf/727459127c8b66ee8525662300459099/defc77cb784f180ac1256c2b0030274b/$FILE/bersarint.pdf">
+# says that Bersarin issued an order to use Moscow time on May 20.
+# However, Moscow did not observe daylight saving in 1945, so
+# this was equivalent to CEMT (GMT+3), not GMT+4.
+
 
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
 Rule	Germany	1945	only	-	Apr	 2	2:00s	1:00	S
-# Shanks says 05-24 2:00 to 09-24 3:00 for DDST; go with the PTB, who quotes
-# the Archiv fuer publizist. Arbeit (Munzinger-Archiv) 652 (Zeitsystem)
-# (1961-11-25), which gives dates only.  Guess 3:00 transition times.
-Rule	Germany	1945	only	-	May	31	3:00	2:00	M # Midsummer
-Rule	Germany	1945	only	-	Sep	23	3:00	1:00	S
+Rule	Germany	1945	only	-	May	24	2:00	2:00	M # Midsummer
+Rule	Germany	1945	only	-	Sep	24	3:00	1:00	S
 Rule	Germany	1945	only	-	Nov	18	2:00s	0	-
 Rule	Germany	1946	only	-	Apr	14	2:00s	1:00	S
 Rule	Germany	1946	only	-	Oct	 7	2:00s	0	-
 Rule	Germany	1947	1949	-	Oct	Sun>=1	2:00s	0	-
 Rule	Germany	1947	only	-	Apr	 6	2:00s	1:00	S
-# The PTB gives 3:00 CET and 3:00 CEST for the midsummer transition times;
-# go with Shanks.
 Rule	Germany	1947	only	-	May	11	2:00s	2:00	M
 Rule	Germany	1947	only	-	Jun	29	3:00	1:00	S
 Rule	Germany	1948	only	-	Apr	18	2:00s	1:00	S
@@ -1341,6 +1355,15 @@
 # Fact File, Lithuanian State Department of Tourism
 # </a> (2000-03-27): Local time is GMT+2 hours ..., no daylight saving.
 
+# From a user via Klaus Marten (2003-02-07):
+# As a candidate for membership of the European Union, Lithuania will
+# observe Summer Time in 2003, changing its clocks at the times laid
+# down in EU Directive 2000/84 of 19.I.01 (i.e. at the same times as its
+# neighbour Latvia). The text of the Lithuanian government Order of
+# 7.XI.02 to this effect can be found at
+# http://www.lrvk.lt/nut/11/n1749.htm
+
+
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
 Zone	Europe/Vilnius	1:41:16	-	LMT	1880
 			1:24:00	-	WMT	1917	    # Warsaw Mean Time
@@ -1355,7 +1378,8 @@
 			2:00	C-Eur	EE%sT	1998
 			2:00	-	EET	1998 Mar 29 1:00u
 			1:00	EU	CE%sT	1999 Oct 31 1:00u
-			2:00	-	EET
+			2:00	-	EET	2003 Jan  1
+			2:00	EU	EE%sT
 
 # Luxembourg
 # Whitman disagrees with most of these dates in minor ways; go with Shanks.
@@ -1393,7 +1417,7 @@
 			1:00	EU	CE%sT
 
 # Macedonia
-# see Yugoslavia
+# see Serbia and Montenegro
 
 # Malta
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
@@ -1979,11 +2003,27 @@
 			11:00	Russia	ANA%sT	1992 Jan 19 2:00s
 			12:00	Russia	ANA%sT
 
+# Serbia and Montenegro
+# Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
+Zone	Europe/Belgrade	1:22:00	-	LMT	1884
+			1:00	-	CET	1941 Apr 18 23:00
+			1:00	C-Eur	CE%sT	1945 May  8  2:00s
+			1:00	1:00	CEST	1945 Sep 16  2:00s
+# Metod Kozelj <metod.kozelj@rzs-hm.si> reports that the legal date of
+# transition to EU rules was 1982-11-27, for all of Yugoslavia at the time.
+# Shanks doesn't give as much detail, so go with Kozelj.
+			1:00	-	CET	1982 Nov 27
+			1:00	EU	CE%sT
+Link Europe/Belgrade Europe/Ljubljana	# Slovenia
+Link Europe/Belgrade Europe/Sarajevo	# Bosnia and Herzegovina
+Link Europe/Belgrade Europe/Skopje	# Macedonia
+Link Europe/Belgrade Europe/Zagreb	# Croatia
+
 # Slovakia
 Link Europe/Prague Europe/Bratislava
 
 # Slovenia
-# see Yugoslavia
+# see Serbia and Montenegro
 
 # Spain
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
@@ -2191,6 +2231,15 @@
 Link	Europe/Istanbul	Asia/Istanbul	# Istanbul is in both continents.
 
 # Ukraine
+#
+# From Igor Karpov, who works for the Ukranian Ministry of Justice,
+# via Garrett Wollman (2003-01-27):
+# BTW, I've found the official document on this matter. It's goverment
+# regulations number 509, May 13, 1996. In my poor translation it says:
+# "Time in Ukraine is set to second timezone (Kiev time). Each last Sunday
+# of March at 3am the time is changing to 4am and each last Sunday of
+# October the time at 4am is changing to 3am"
+
 # Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
 # Most of Ukraine since 1970 has been like Kiev.
 Zone Europe/Kiev	2:02:04 -	LMT	1880
@@ -2249,22 +2298,6 @@
 			3:00	-	MSK	1997 Mar lastSun 1:00u
 			2:00	EU	EE%sT
 
-# Yugoslavia
-# Zone	NAME		GMTOFF	RULES	FORMAT	[UNTIL]
-Zone	Europe/Belgrade	1:22:00	-	LMT	1884
-			1:00	-	CET	1941 Apr 18 23:00
-			1:00	C-Eur	CE%sT	1945 May  8  2:00s
-			1:00	1:00	CEST	1945 Sep 16  2:00s
-# Metod Kozelj <metod.kozelj@rzs-hm.si> reports that the legal date of
-# transition to EU rules was 1982-11-27, for all of Yugoslavia at the time.
-# Shanks doesn't give as much detail, so go with Kozelj.
-			1:00	-	CET	1982 Nov 27
-			1:00	EU	CE%sT
-Link Europe/Belgrade Europe/Ljubljana	# Slovenia
-Link Europe/Belgrade Europe/Sarajevo	# Bosnia and Herzegovina
-Link Europe/Belgrade Europe/Skopje	# Macedonia
-Link Europe/Belgrade Europe/Zagreb	# Croatia
-
 ###############################################################################
 
 # One source shows that Bulgaria, Cyprus, Finland, and Greece observe DST from
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/iso3166.tab libc-20030708/timezone/iso3166.tab
--- glibc-2.3.2/timezone/iso3166.tab	2002-10-16 02:12:42.000000000 +0900
+++ libc-20030708/timezone/iso3166.tab	2003-03-25 19:49:29.000000000 +0900
@@ -2,11 +2,11 @@
 #
 # @(#)iso3166.tab	1.9
 #
-# From Paul Eggert <eggert@twinsun.com> (2002-05-28):
+# From Paul Eggert <eggert@twinsun.com> (2003-02-04):
 #
 # This file contains a table with the following columns:
 # 1.  ISO 3166-1 alpha-2 country code, current as of
-#     ISO 3166-1 Newsletter No. V-5 (2002-05-20).  See:
+#     ISO 3166-1 Newsletter No. V-7 (2003-01-14).  See:
 #     <a href="http://www.iso.org/iso/en/prods-services/iso3166ma/index.html">
 #     ISO 3166 Maintenance agency (ISO 3166/MA)
 #     </a>.
@@ -256,7 +256,7 @@
 WS	Samoa (Western)
 YE	Yemen
 YT	Mayotte
-YU	Yugoslavia
+YU	Serbia and Montenegro
 ZA	South Africa
 ZM	Zambia
 ZW	Zimbabwe
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/northamerica libc-20030708/timezone/northamerica
--- glibc-2.3.2/timezone/northamerica	2002-04-06 12:40:00.000000000 +0900
+++ libc-20030708/timezone/northamerica	2003-03-25 19:49:29.000000000 +0900
@@ -1,4 +1,4 @@
-# @(#)northamerica	7.61
+# @(#)northamerica	7.62
 # also includes Central America and the Caribbean
 
 # This data is by no means authoritative; if you think you know better,
@@ -88,6 +88,23 @@
 # of surrender, all of whom interrupting the bells of Big Ben in
 # London which were to precede Mr. Attlee's speech.
 
+# From Paul Eggert (2003-02-09): It was Robert St John, not Bob Trout.  From
+# Myrna Oliver's obituary of St John on page B16 of today's Los Angeles Times:
+#
+# ... a war-weary U.S. clung to radios, awaiting word of Japan's surrender.
+# Any announcement from Asia would reach St. John's New York newsroom on a
+# wire service teletype machine, which had prescribed signals for major news.
+# Associated Press, for example, would ring five bells before spewing out
+# typed copy of an important story, and 10 bells for news "of transcendental
+# importance."
+#
+# On Aug. 14, stalling while talking steadily into the NBC networks' open
+# microphone, St. John heard five bells and waited only to hear a sixth bell,
+# before announcing confidently: "Ladies and gentlemen, World War II is over.
+# The Japanese have agreed to our surrender terms."
+#
+# He had scored a 20-second scoop on other broadcasters.
+
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
 Rule	US	1918	1919	-	Mar	lastSun	2:00	1:00	D
 Rule	US	1918	1919	-	Oct	lastSun	2:00	0	S
@@ -189,10 +206,11 @@
 # US eastern time, represented by New York
 
 # Connecticut, Delaware, District of Columbia, most of Florida,
-# Georgia, far southeastern Indiana, eastern Kentucky, Maine,
-# Maryland, Massachusetts, New Hampshire, New Jersey, New York, North
-# Carolina, Ohio, Pennsylvania, Rhode Island, South Carolina, eastern
-# Tennessee, Vermont, Virginia, West Virginia
+# Georgia, southeast Indiana (Clark, Dearborn, Floyd, Harrison, and
+# Ohio counties), eastern Kentucky, Maine, Maryland, Massachusetts,
+# New Hampshire, New Jersey, New York, North Carolina, Ohio,
+# Pennsylvania, Rhode Island, South Carolina, eastern Tennessee,
+# Vermont, Virginia, West Virginia
 
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER
 Rule	NYC	1920	only	-	Mar	lastSun	2:00	1:00	D
@@ -211,10 +229,11 @@
 # US central time, represented by Chicago
 
 # Alabama, Arkansas, Florida panhandle, Illinois, western Indiana
-# corners, Iowa, most of Kansas, western Kentucky, Louisiana,
-# Minnesota, Mississippi, Missouri, eastern Nebraska, eastern North
-# Dakota, Oklahoma, eastern South Dakota, western Tennessee, most of
-# Texas, Wisconsin
+# (Gibson, Jasper, Lake, LaPorte, Newton, Porter, Posey, Spencer,
+# Vanderburgh, and Warrick counties), Iowa, most of Kansas, western
+# Kentucky, Louisiana, Minnesota, Mississippi, Missouri, eastern
+# Nebraska, eastern North Dakota, Oklahoma, eastern South Dakota,
+# western Tennessee, most of Texas, Wisconsin
 
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER
 Rule	Chicago	1920	only	-	Jun	13	2:00	1:00	D
@@ -357,12 +376,32 @@
 # Now we turn to US areas that have diverged from the consensus since 1970.
 
 # Arizona mostly uses MST.
+
+# From Paul Eggert (2002-10-20):
+#
+# The information in the rest of this paragraph is derived from the
+# <a href="http://www.dlapr.lib.az.us/links/daylight.htm">
+# Daylight Saving Time web page (2002-01-23)</a> maintained by the
+# Arizona State Library, Archives and Public Records.
+# Between 1944-01-01 and 1944-04-01 the State of Arizona used standard
+# time, but by federal law railroads, airlines, bus lines, military
+# personnel, and some engaged in interstate commerce continued to
+# observe war (i.e., daylight saving) time.  The 1944-03-17 Phoenix
+# Gazette says that was the date the law changed, and that 04-01 was
+# the date the state's clocks would change.  In 1945 the State of
+# Arizona used standard time all year, again with exceptions only as
+# mandated by federal law.  Arizona observed DST in 1967, but Arizona
+# Laws 1968, ch. 183 (effective 1968-03-21) repealed DST.
+#
+# Shanks says the 1944 experiment came to an end on 1944-03-17.
+# Go with the Arizona State Library instead.
+
 Zone America/Phoenix	-7:28:18 -	LMT	1883 Nov 18 12:00
 			-7:00	US	M%sT	1944 Jan  1 00:01
-			-7:00	-	MST	1944 Mar 17 00:01
+			-7:00	-	MST	1944 Apr  1 00:01
 			-7:00	US	M%sT	1944 Oct  1 00:01
 			-7:00	-	MST	1967
-			-7:00	US	M%sT	1968
+			-7:00	US	M%sT	1968 Mar 21
 			-7:00	-	MST
 # From Arthur David Olson (1988-02-13):
 # A writer from the Inter Tribal Council of Arizona, Inc.,
@@ -522,7 +561,7 @@
 # <a href="http://frwebgate.access.gpo.gov/cgi-bin/getdoc.cgi?dbname=2000_register&docid=fr17au00-22">
 # Federal Register 65, 160 (2000-08-17), page 50154-50158.
 # </a>
-# 
+#
 Zone America/Kentucky/Monticello -5:39:24 - LMT	1883 Nov 18 12:00
 			-6:00	US	C%sT	1946
 			-6:00	-	CST	1968
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/southamerica libc-20030708/timezone/southamerica
--- glibc-2.3.2/timezone/southamerica	2002-10-16 02:03:12.000000000 +0900
+++ libc-20030708/timezone/southamerica	2003-03-25 19:49:29.000000000 +0900
@@ -1,4 +1,4 @@
-# @(#)southamerica	7.45
+# @(#)southamerica	7.46
 
 # This data is by no means authoritative; if you think you know better,
 # go ahead and edit the file (and please send any changes to
@@ -584,6 +584,10 @@
 # Go with this article in preference to Shanks's 1969 date for modern DST.
 # Assume this rule has been used since DST was introduced in the islands.
 
+# From Paul Eggert (2002-10-24):
+# <http://www.shoa.cl/shoa/faqhoraoficial.htm> gives many details that
+# disagree with the following table, but we haven't had time to compare them.
+
 # Rule	NAME	FROM	TO	TYPE	IN	ON	AT	SAVE	LETTER/S
 Rule	Chile	1918	only	-	Sep	 1	0:00	1:00	S
 Rule	Chile	1919	only	-	Jul	 2	0:00	0	-
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/timezone/zone.tab libc-20030708/timezone/zone.tab
--- glibc-2.3.2/timezone/zone.tab	2002-10-16 02:00:59.000000000 +0900
+++ libc-20030708/timezone/zone.tab	2003-03-25 19:49:29.000000000 +0900
@@ -1,4 +1,4 @@
-# @(#)zone.tab	1.27
+# @(#)zone.tab	1.28
 #
 # TZ zone descriptions
 #
@@ -33,6 +33,7 @@
 AO	-0848+01314	Africa/Luanda
 AQ	-7750+16636	Antarctica/McMurdo	McMurdo Station, Ross Island
 AQ	-9000+00000	Antarctica/South_Pole	Amundsen-Scott Station, South Pole
+AQ	-6734-06808	Antarctica/Rothera	Rothera Station, Adelaide Island
 AQ	-6448-06406	Antarctica/Palmer	Palmer Station, Anvers Island
 AQ	-6736+06253	Antarctica/Mawson	Mawson Station, Holme Bay
 AQ	-6835+07758	Antarctica/Davis	Davis Station, Vestfold Hills
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/tls.make.c libc-20030708/tls.make.c
--- glibc-2.3.2/tls.make.c	2002-11-15 12:36:55.000000000 +0900
+++ libc-20030708/tls.make.c	2003-03-28 21:28:14.000000000 +0900
@@ -2,6 +2,12 @@
 
 #include <tls.h>
 
+#if USE_TLS
+@@@ use-tls = yes @@@
+#else
+@@@ use-tls = no @@@
+#endif
+
 #if USE___THREAD
 @@@ use-thread = yes @@@
 #else
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/wcsmbs/wchar.h libc-20030708/wcsmbs/wchar.h
--- glibc-2.3.2/wcsmbs/wchar.h	2002-08-28 16:56:15.000000000 +0900
+++ libc-20030708/wcsmbs/wchar.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1995-99,2000,01,02 Free Software Foundation, Inc.
+/* Copyright (C) 1995-2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -59,8 +59,13 @@
 # define _WINT_T
 typedef unsigned int wint_t;
 #else
-# ifdef __USE_GNU
-__USING_NAMESPACE_STD(wint_t)
+/* Work around problems with the <stddef.h> file which doesn't put
+   wint_t in the std namespace.  */
+# if defined __cplusplus && defined _GLIBCPP_USE_NAMESPACES \
+     && defined __WINT_TYPE__
+__BEGIN_NAMESPACE_STD
+typedef __WINT_TYPE__ wint_t;
+__END_NAMESPACE_STD
 # endif
 #endif
 
@@ -577,27 +582,39 @@
 extern int fwide (__FILE *__fp, int __mode) __THROW;
 
 
-/* Write formatted output to STREAM.  */
+/* Write formatted output to STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int fwprintf (__FILE *__restrict __stream,
 		     __const wchar_t *__restrict __format, ...)
-     __THROW /* __attribute__ ((__format__ (__wprintf__, 2, 3))) */;
-/* Write formatted output to stdout.  */
+     /* __attribute__ ((__format__ (__wprintf__, 2, 3))) */;
+/* Write formatted output to stdout.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int wprintf (__const wchar_t *__restrict __format, ...)
-     __THROW /* __attribute__ ((__format__ (__wprintf__, 1, 2))) */;
+     /* __attribute__ ((__format__ (__wprintf__, 1, 2))) */;
 /* Write formatted output of at most N characters to S.  */
 extern int swprintf (wchar_t *__restrict __s, size_t __n,
 		     __const wchar_t *__restrict __format, ...)
      __THROW /* __attribute__ ((__format__ (__wprintf__, 3, 4))) */;
 
-/* Write formatted output to S from argument list ARG.  */
+/* Write formatted output to S from argument list ARG.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int vfwprintf (__FILE *__restrict __s,
 		      __const wchar_t *__restrict __format,
 		      __gnuc_va_list __arg)
-     __THROW /* __attribute__ ((__format__ (__wprintf__, 2, 0))) */;
-/* Write formatted output to stdout from argument list ARG.  */
+     /* __attribute__ ((__format__ (__wprintf__, 2, 0))) */;
+/* Write formatted output to stdout from argument list ARG.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int vwprintf (__const wchar_t *__restrict __format,
 		     __gnuc_va_list __arg)
-     __THROW /* __attribute__ ((__format__ (__wprintf__, 1, 0))) */;
+     /* __attribute__ ((__format__ (__wprintf__, 1, 0))) */;
 /* Write formatted output of at most N character to S from argument
    list ARG.  */
 extern int vswprintf (wchar_t *__restrict __s, size_t __n,
@@ -606,13 +623,19 @@
      __THROW /* __attribute__ ((__format__ (__wprintf__, 3, 0))) */;
 
 
-/* Read formatted input from STREAM.  */
+/* Read formatted input from STREAM.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int fwscanf (__FILE *__restrict __stream,
 		    __const wchar_t *__restrict __format, ...)
-     __THROW /* __attribute__ ((__format__ (__wscanf__, 2, 3))) */;
-/* Read formatted input from stdin.  */
+     /* __attribute__ ((__format__ (__wscanf__, 2, 3))) */;
+/* Read formatted input from stdin.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int wscanf (__const wchar_t *__restrict __format, ...)
-     __THROW /* __attribute__ ((__format__ (__wscanf__, 1, 2))) */;
+     /* __attribute__ ((__format__ (__wscanf__, 1, 2))) */;
 /* Read formatted input from S.  */
 extern int swscanf (__const wchar_t *__restrict __s,
 		    __const wchar_t *__restrict __format, ...)
@@ -624,15 +647,21 @@
 #ifdef __USE_ISOC99
 __BEGIN_NAMESPACE_C99
 
-/* Read formatted input from S into argument list ARG.  */
+/* Read formatted input from S into argument list ARG.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int vfwscanf (__FILE *__restrict __s,
 		     __const wchar_t *__restrict __format,
 		     __gnuc_va_list __arg)
-     __THROW /* __attribute__ ((__format__ (__wscanf__, 2, 0))) */;
-/* Read formatted input from stdin into argument list ARG.  */
+     /* __attribute__ ((__format__ (__wscanf__, 2, 0))) */;
+/* Read formatted input from stdin into argument list ARG.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
 extern int vwscanf (__const wchar_t *__restrict __format,
 		    __gnuc_va_list __arg)
-     __THROW /* __attribute__ ((__format__ (__wscanf__, 1, 0))) */;
+     /* __attribute__ ((__format__ (__wscanf__, 1, 0))) */;
 /* Read formatted input from S into argument list ARG.  */
 extern int vswscanf (__const wchar_t *__restrict __s,
 		     __const wchar_t *__restrict __format,
@@ -644,62 +673,113 @@
 
 
 __BEGIN_NAMESPACE_C99
-/* Read a character from STREAM.  */
-extern wint_t fgetwc (__FILE *__stream) __THROW;
-extern wint_t getwc (__FILE *__stream) __THROW;
+/* Read a character from STREAM.
+
+   These functions are possible cancellation points and therefore not
+   marked with __THROW.  */
+extern wint_t fgetwc (__FILE *__stream);
+extern wint_t getwc (__FILE *__stream);
+
+/* Read a character from stdin.
+
+   This function is a possible cancellation point and therefore not
+   marked with __THROW.  */
+extern wint_t getwchar (void);
+
 
-/* Read a character from stdin.  */
-extern wint_t getwchar (void) __THROW;
+/* Write a character to STREAM.
 
+   These functions are possible cancellation points and therefore not
+   marked with __THROW.  */
+extern wint_t fputwc (wchar_t __wc, __FILE *__stream);
+extern wint_t putwc (wchar_t __wc, __FILE *__stream);
 
-/* Write a character to STREAM.  */
-extern wint_t fputwc (wchar_t __wc, __FILE *__stream) __THROW;
-extern wint_t putwc (wchar_t __wc, __FILE *__stream) __THROW;
+/* Write a character to stdout.
 
-/* Write a character to stdout.  */
-extern wint_t putwchar (wchar_t __wc) __THROW;
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern wint_t putwchar (wchar_t __wc);
 
 
 /* Get a newline-terminated wide character string of finite length
-   from STREAM.  */
+   from STREAM.
+
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
 extern wchar_t *fgetws (wchar_t *__restrict __ws, int __n,
-			__FILE *__restrict __stream) __THROW;
+			__FILE *__restrict __stream);
+
+/* Write a string to STREAM.
 
-/* Write a string to STREAM.  */
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
 extern int fputws (__const wchar_t *__restrict __ws,
-		   __FILE *__restrict __stream) __THROW;
+		   __FILE *__restrict __stream);
+
 
+/* Push a character back onto the input buffer of STREAM.
 
-/* Push a character back onto the input buffer of STREAM.  */
-extern wint_t ungetwc (wint_t __wc, __FILE *__stream) __THROW;
+   This function is a possible cancellation points and therefore not
+   marked with __THROW.  */
+extern wint_t ungetwc (wint_t __wc, __FILE *__stream);
 __END_NAMESPACE_C99
 
 
 #ifdef __USE_GNU
 /* These are defined to be equivalent to the `char' functions defined
-   in POSIX.1:1996.  */
-extern wint_t getwc_unlocked (__FILE *__stream) __THROW;
-extern wint_t getwchar_unlocked (void) __THROW;
+   in POSIX.1:1996.
 
-/* This is the wide character version of a GNU extension.  */
-extern wint_t fgetwc_unlocked (__FILE *__stream) __THROW;
-
-/* Faster version when locking is not necessary.  */
-extern wint_t fputwc_unlocked (wchar_t __wc, __FILE *__stream) __THROW;
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
+extern wint_t getwc_unlocked (__FILE *__stream);
+extern wint_t getwchar_unlocked (void);
+
+/* This is the wide character version of a GNU extension.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern wint_t fgetwc_unlocked (__FILE *__stream);
+
+/* Faster version when locking is not necessary.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
+extern wint_t fputwc_unlocked (wchar_t __wc, __FILE *__stream);
 
 /* These are defined to be equivalent to the `char' functions defined
-   in POSIX.1:1996.  */
-extern wint_t putwc_unlocked (wchar_t __wc, __FILE *__stream) __THROW;
-extern wint_t putwchar_unlocked (wchar_t __wc) __THROW;
-
+   in POSIX.1:1996.
 
-/* This function does the same as `fgetws' but does not lock the stream.  */
+   These functions are not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation they are cancellation points and
+   therefore not marked with __THROW.  */
+extern wint_t putwc_unlocked (wchar_t __wc, __FILE *__stream);
+extern wint_t putwchar_unlocked (wchar_t __wc);
+
+
+/* This function does the same as `fgetws' but does not lock the stream.
+
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern wchar_t *fgetws_unlocked (wchar_t *__restrict __ws, int __n,
-				 __FILE *__restrict __stream) __THROW;
+				 __FILE *__restrict __stream);
+
+/* This function does the same as `fputws' but does not lock the stream.
 
-/* This function does the same as `fputws' but does not lock the stream.  */
+   This function is not part of POSIX and therefore no official
+   cancellation point.  But due to similarity with an POSIX interface
+   or due to the implementation it is a cancellation point and
+   therefore not marked with __THROW.  */
 extern int fputws_unlocked (__const wchar_t *__restrict __ws,
-			    __FILE *__restrict __stream) __THROW;
+			    __FILE *__restrict __stream);
 #endif
 
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/wcsmbs/wcpncpy.c libc-20030708/wcsmbs/wcpncpy.c
--- glibc-2.3.2/wcsmbs/wcpncpy.c	2001-07-08 04:21:39.000000000 +0900
+++ libc-20030708/wcsmbs/wcpncpy.c	2003-06-12 08:54:06.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1996, 1997, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>, 1995.
 
@@ -58,9 +58,7 @@
 	  if (--n4 == 0)
 	    goto last_chars;
 	}
-      n = n - (dest - s) - 1;
-      if (n == 0)
-	return dest;
+      n -= dest - s;
       goto zero_fill;
     }
 
@@ -69,21 +67,22 @@
   if (n == 0)
     return dest;
 
-  do
+  for (;;)
     {
       c = *src++;
-      *++dest = c;
-      if (--n == 0)
+      --n;
+      *dest++ = c;
+      if (c == L'\0')
+	break;
+      if (n == 0)
 	return dest;
     }
-  while (c != L'\0');
 
  zero_fill:
-  do
-    *++dest = L'\0';
-  while (--n > 0);
+  while (n-- > 0)
+    dest[n] = L'\0';
 
-  return dest;
+  return dest - 1;
 }
 
 weak_alias (__wcpncpy, wcpncpy)
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/wcsmbs/wcsnrtombs.c libc-20030708/wcsmbs/wcsnrtombs.c
--- glibc-2.3.2/wcsmbs/wcsnrtombs.c	2002-09-03 04:45:55.000000000 +0900
+++ libc-20030708/wcsmbs/wcsnrtombs.c	2003-06-12 08:54:06.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.org>, 1996.
 
@@ -72,7 +72,7 @@
   if (dst == NULL)
     {
       unsigned char buf[256];		/* Just an arbitrary value.  */
-      const wchar_t *inbuf = *src;
+      const unsigned char *inbuf = (const unsigned char *) *src;
       size_t dummy;
 
       result = 0;
@@ -83,7 +83,7 @@
 	  data.__outbuf = buf;
 
 	  status = DL_CALL_FCT (tomb->__fct,
-				(tomb, &data, (const unsigned char **) &inbuf,
+				(tomb, &data, &inbuf,
 				 (const unsigned char *) srcend, NULL,
 				 &dummy, 0, 1));
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/wcsmbs/wcsrtombs.c libc-20030708/wcsmbs/wcsrtombs.c
--- glibc-2.3.2/wcsmbs/wcsrtombs.c	2002-09-03 04:45:55.000000000 +0900
+++ libc-20030708/wcsmbs/wcsrtombs.c	2003-06-12 08:54:06.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.org>, 1996.
 
@@ -66,7 +66,7 @@
       mbstate_t temp_state;
       unsigned char buf[256];		/* Just an arbitrary value.  */
       const wchar_t *srcend = *src + __wcslen (*src) + 1;
-      const wchar_t *inbuf = *src;
+      const unsigned char *inbuf = (const unsigned char *) *src;
       size_t dummy;
 
       temp_state = *data.__statep;
@@ -80,7 +80,7 @@
 	  data.__outbuf = buf;
 
 	  status = DL_CALL_FCT (tomb->__fct,
-				(tomb, &data, (const unsigned char **) &inbuf,
+				(tomb, &data, &inbuf,
 				 (const unsigned char *) srcend, NULL,
 				 &dummy, 0, 1));
 
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/wcsmbs/wctob.c libc-20030708/wcsmbs/wctob.c
--- glibc-2.3.2/wcsmbs/wctob.c	2002-09-03 04:45:55.000000000 +0900
+++ libc-20030708/wcsmbs/wctob.c	2003-06-12 08:54:06.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 1996,1997,1998,1999,2000,2002 Free Software Foundation, Inc.
+/* Copyright (C) 1996-2000, 2002, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@gnu.ai.mit.edu>, 1996.
 
@@ -58,11 +58,10 @@
   /* Create the input string.  */
   inbuf[0] = c;
 
+  const unsigned char *argptr = (const unsigned char *) inptr;
   status = DL_CALL_FCT (fcts->tomb->__fct,
-			(fcts->tomb, &data,
-			 (const unsigned char **) &inptr,
-			 (const unsigned char *) &inbuf[1],
-			 NULL, &dummy, 0, 1));
+			(fcts->tomb, &data, &argptr,
+			 argptr + sizeof (inbuf[0]), NULL, &dummy, 0, 1));
 
   /* The conversion failed or the output is too long.  */
   if ((status != __GCONV_OK && status != __GCONV_FULL_OUTPUT
diff -urN -x CVS -x .cvsignore -x '*texi' -x '*manual*' glibc-2.3.2/wctype/wchar-lookup.h libc-20030708/wctype/wchar-lookup.h
--- glibc-2.3.2/wctype/wchar-lookup.h	2001-07-08 04:21:39.000000000 +0900
+++ libc-20030708/wctype/wchar-lookup.h	2003-07-08 22:58:15.000000000 +0900
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2003 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Bruno Haible <haible@clisp.cons.org>, 2000.
 
@@ -49,6 +49,7 @@
 */
 
 static __inline int
+__attribute ((always_inline))
 wctype_table_lookup (const char *table, uint32_t wc)
 {
   uint32_t shift1 = ((const uint32_t *) table)[0];
@@ -80,6 +81,7 @@
    unit is a single byte, and no 5 bits are used as a word index.  */
 
 static __inline int
+__attribute ((always_inline))
 wcwidth_table_lookup (const char *table, uint32_t wc)
 {
   uint32_t shift1 = ((const uint32_t *) table)[0];
@@ -113,6 +115,7 @@
    bits are used as a word index.  */
 
 static __inline uint32_t
+__attribute ((always_inline))
 wctrans_table_lookup (const char *table, uint32_t wc)
 {
   uint32_t shift1 = ((const uint32_t *) table)[0];
