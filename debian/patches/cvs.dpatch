#! /bin/sh -e

# All lines beginning with `# DP:' are a description of the patch.
# DP: Description: CVS Update
# DP: Author: Jeff Bailey
# DP: Upstream status: CVS
# DP: Status Details:
# DP: Date: September 14th

if [ $# -ne 2 ]; then
    echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
    exit 1
fi
case "$1" in
    -patch) patch -d "$2" -f --no-backup-if-mismatch -p1 < $0;;
    -unpatch) patch -d "$2" -f --no-backup-if-mismatch -R -p1 < $0;;
    *)
	echo >&2 "`basename $0`: script expects -patch|-unpatch as argument"
	exit 1
esac
exit 0

# append the patch here and adjust the -p? flag in the patch calls.
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/ChangeLog ../glibc-2.3/ChangeLog
--- glibc-2.2.93/ChangeLog	Mon Sep  2 23:11:58 2002
+++ ../glibc-2.3/ChangeLog	Sat Sep 14 09:40:45 2002
@@ -1,3 +1,557 @@
+2002-09-12  Jakub Jelinek  <jakub@redhat.com>
+
+	* sysdeps/i386/dl-machine.h (elf_machine_rel)
+	(case R_386_TLS_DTPMOD32): Don't use addend.
+	[case R_386_TLS_TPOFF32]: Remove redundant SYM_MAP != NULL check.
+	(elf_machine_rela): Add support for TLS relocs.
+
+2002-09-14  Roland McGrath  <roland@redhat.com>
+
+	* Makefile (manual/%): Add this pattern target to the iconvdata/% rule.
+
+2002-07-29  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* stdlib/longlong.h [_ARCH_PPC && W_TYPE_SIZE!=32]: Add powerpc64
+	specific asm macros for multiple percision integer math.
+
+2002-06-04  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/generic/ldconfig.h (FLAG_POWERPC_LIB64) New macro.
+	* elf/cache.c (print_entry): Add case for FLAG_POWERPC_LIB64.
+	Remove per-machine conditionals for FLAG_* cases.
+	* sysdeps/unix/sysv/linux/powerpc/ldconfig.h: New file.
+	* sysdeps/unix/sysv/linux/powerpc/readelflib.c: New file.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc64/dl-cache.h: New file.
+
+2002-09-10  Alan Modra <amodra@bigpond.net.au>
+
+	* csu/gmon-start.c [!TEXT_START]: Define TEXT_START if not already
+	defined in entry.h.
+	(__gmon_start__) [!ENTRY_POINT_DECL]: Use TEXT_START macro to obtain
+	lowest address for profiling in  __monstartup call.
+	* sysdeps/powerpc/powerpc64/elf/entry.h: New file.
+
+2002-09-14  Roland McGrath  <roland@redhat.com>
+
+	* sysdeps/unix/sysv/linux/pread.c: __NR_pread64 may be defined
+	instead of __NR_pread.
+	* sysdeps/unix/sysv/linux/pread64.c: Likewise.
+	* sysdeps/unix/sysv/linux/pwrite.c: __NR_pwrite64 may be defined
+	instead of __NR_pwrite.
+	* sysdeps/unix/sysv/linux/pwrite64.c: Likewise.
+
+2002-09-13  Roland McGrath  <roland@redhat.com>
+
+	* manual/libc.texinfo: @ifinfo -> @ifnottex around copyright notice.
+
+2002-09-13  Andreas Jaeger  <aj@suse.de>
+
+	* sysdeps/unix/sysv/linux/mips/syscalls.list: Add readahead
+	syscall.  Patch by Guido Guenther <agx@sigxcpu.org>.
+
+2002-09-12  Ulrich Drepper  <drepper@redhat.com>
+
+	* elf/elf.h: Correct DT_LOOS and DT_HIOS values.
+
+2002-09-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/powerpc/fpu/s_isnan.c: #undef __isnanf and isnanf after
+	reading the headers.
+
+2002-09-12  Roland McGrath  <roland@redhat.com>
+
+	* elf/rtld.c (_dl_start_final): Move _begin, _end decls outside the fn.
+	(_dl_start) [DONT_USE_BOOTSTRAP_MAP]: Use &_begin instead of l_addr to
+	find the ELF header.
+
+	* elf/rtld.c (dl_main) [USE_TLS]: Adjust l_tls_initimage of main
+	executable if needed, in case it's actually a shared object.
+
+2002-09-11  Roland McGrath  <roland@redhat.com>
+
+	* elf/dl-load.c (_dl_map_object_from_fd): Use l_addr instead of
+	l_map_start to adjust l_tls_initimage.
+
+	* nss/getnssent_r.c (__nss_getent_r): Use EAGAIN instead of errno
+	when using h_errno and it's not set to NETDB_INTERNAL.
+	* nss/getXXbyYY_r.c [NEED_H_ERRNO]: Likewise.
+
+	* Makefile ($(common-objpfx)testrun.sh): New target.
+	(others): Depend on it.
+	(postclean-generated): Append it.
+
+	* nss/bug-erange.c: New file.
+	* nss/Makefile (tests): Add it.
+
+	* nss/getXXbyYY_r.c (INTERNAL (REENTRANT_NAME)): Return errno
+	instead of always EAGAIN when status is NSS_STATUS_TRYAGAIN.
+
+	* sysdeps/generic/dl-environ.c (unsetenv): Redo last fix without
+	strncmp, keeps the code smaller for a non-performance-critical case.
+
+	* sysdeps/generic/dl-environ.c (unsetenv): Rewritten using strncmp,
+	no longer wrongly matches arbitrary prefixes of NAME.
+	Reported by Jakub Jelinek <jakub@redhat.com>.
+
+2002-09-11  Jakub Jelinek  <jakub@redhat.com>
+
+	* posix/bug-regex11.c (tests): New array.
+	(main): Rewritten to run more different tests.
+
+2002-09-10  Roland McGrath  <roland@redhat.com>
+
+	* nscd/Makefile (CPPFLAGS-nscd, CPPFLAGS-nscd_conf, CPPFLAGS-dbg_log)
+	(CPPFLAGS-connections, CPPFLAGS-hstcache): Variables removed.
+	Instead, catch all of $(nscd-modules) via cppflags-iterator.mk.
+
+	* sysdeps/powerpc/fpu/s_isnan.c: Do macro hackery on __GI___isnanf as
+	well so we don't get it declared by include/math.h's hidden_proto.
+	Then do hidden_proto for __isnanf locally so hidden_def works right.
+
+	* posix/bug-regex5.c (main): Use `union locale_data_value' rather than
+	a cast to turn nl_langinfo return value into an integer.
+
+2002-09-10  Isamu Hasegawa  <isamu@yamato.ibm.com>
+
+	* posix/regexec.c (build_trtable): Fix the destination of
+	newline to prevent wrong states from overwriting.
+	Append break statements to optimization.
+
+2002-09-10  Isamu Hasegawa  <isamu@yamato.ibm.com>
+
+	* posix/regcomp.c: Wrap #include wchar.h and wctype.h in #if.
+	(build_range_exp): Add castings to strlen invocations.
+	(build_collating_symbol): Restore the type of characters from "char"
+	to "unsigned char", and supplement castings.
+	(build_collating_symbol): Likewise.
+	(build_equiv_class): Likewise.
+	(build_charclass): Likewise.
+	(seek_collating_symbol_entry): Likewise.
+	(parse_bracket_exp): Likewise.
+	(build_word_op): Supplement a casting.
+	* posix/regex_internal.c: Wrap #include wchar.h and wctype.h in #if.
+	(re_string_allocate): Fix castings.
+	(re_string_construct): Likewise.
+	(re_string_construct_common): Likewise.
+	(re_string_realloc_buffers): Likewise.
+	(build_wcs_buffer): Likewise.
+	(build_wcs_upper_buffer): Likewise.
+	(re_string_skip_chars): Likewise.
+	(re_string_reconstruct): Likewise.
+	* posix/regex_internal.h: Restore the type of characters in
+	re_string_t and bracket_elem_t from "char" to "unsigned char".
+	(re_string_elem_size_at): Fix castings.
+	* posix/regexec.c: Wrap #include wchar.h and wctype.h in #if.
+	(transit_state_bkref_loop): Restore the type of characters from
+	"char" to "unsigned char", and append a cast to "char*" pointer in
+	array subscript.
+	(check_node_accept_bytes): Likewise.
+	(find_collation_sequence_value): Likewise.
+
+2002-09-10  Hartvig Ekner  <hartvige@mips.com>
+
+	* sysdeps/mips/memcpy.S: New file.
+	* sysdeps/mips/memset.S: New file.
+	* sysdeps/mips/fpu/e_sqrt.c:  New file.
+	* sysdeps/mips/fpu/e_sqrtf.c: New file.
+
+	* fpu/fclrexcpt.c: Cleaned up the FPU exception stuff - was not
+	functional before. Also removed all SHLIB_COMPAT stuff.
+	* fpu/fegetenv.c: Likewise.
+	* fpu/fesetenv.c:: Likewise.
+	* fpu/feupdateenv.c: Likewise.
+	* fpu/fgetexcptflg.c: Likewise.
+	* fpu/fraiseexcpt.c: Likewise.
+
+	* sysdeps/mips/fpu/fsetexcptflg.c: New file.
+
+2002-09-09  Jakub Jelinek  <jakub@redhat.com>
+
+	* include/math.h (__finite_internal, __finitef_internal,
+	__finitel_internal, __isinf_internal, __isnan_internal): Remove.
+	(isfinite): Remove.
+	(__finite, __isinf, __isnan, __finitef, __isinff, __isnanf, __finitel,
+	__isinfl, __isnanl): Add hidden_proto.
+	(__fpclassify, __fpclassifyf, __fpclassifyl, __expm1l): Add
+	libm_hidden_proto.
+	* math/Makefile (libm-calls): Add s_isinf and s_isnan.
+	* stdio-common/printf_fp.c (__printf_fp): Remove INTUSE from
+	__is{inf,nan} calls.
+	* stdio-common/printf_size.c (printf_size): Likewise.
+	* sysdeps/generic/printf_fphex.c (__printf_fphex): Likewise.
+	* sysdeps/generic/s_ldexp.c (__ldexp): Likewise.
+	* sysdeps/generic/s_ldexpf.c (__ldexpf): Likewise.
+	* sysdeps/generic/s_ldexpl.c (__ldexpl): Likewise.
+	* sysdeps/generic/s_expm1l.c (__expm1l): Add libm_hidden_def.
+	* sysdeps/i386/fpu/s_finite.S (__finite_internal): Remove alias.
+	(__finite): Add hidden_def.
+	* sysdeps/i386/fpu/s_finitef.S (__finitef_internal): Remove alias.
+	(__finitef): Add hidden_def.
+	* sysdeps/i386/fpu/s_finitel.S (__finitel_internal): Remove alias.
+	(__finitel): Add hidden_def.
+	* sysdeps/i386/fpu/s_isinfl.c (__isinfl): Remove INTDEF.  Add
+	hidden_def.
+	* sysdeps/i386/fpu/s_isnanl.c (__isnanl): Likewise.
+	* sysdeps/i386/fpu/s_fpclassifyl.c (__fpclassifyl): Add
+	libm_hidden_def.
+	* sysdeps/i386/fpu/s_expm1l.S (__expm1l): Likewise.
+	* sysdeps/ieee754/dbl-64/s_finite.c (__finite): Remove INTDEF.  Add
+	hidden_def.
+	* sysdeps/ieee754/dbl-64/s_isinf.c (__isinf): Likewise.
+	(__isinfl): Remove INTDEF.
+	* sysdeps/ieee754/dbl-64/s_isnan.c (__isnan): Remove INTDEF.  Add
+	hidden_def.
+	(__isnanl): Remove INTDEF.
+	* sysdeps/ieee754/dbl-64/s_fpclassify.c (__fpclassify): Add
+	libm_hidden_def.
+	* sysdeps/ieee754/dbl-64/e_lgamma_r.c (sin_pi): Use __sin and __cos
+	instead of sin and cos.
+	* sysdeps/ieee754/flt-32/s_finitef.c (__finitef): Remove INTDEF.
+	Add hidden_def.
+	* sysdeps/ieee754/flt-32/s_isinff.c (__isinff): Likewise.
+	* sysdeps/ieee754/flt-32/s_isnanf.c (__isnanf): Likewise.
+	* sysdeps/ieee754/flt-32/s_fpclassifyf.c (__fpclassifyf): Add
+	libm_hidden_def.
+	* sysdeps/ieee754/ldbl-128/s_finitel.c (__finitel): Remove INTDEF.
+	Add hidden_def.
+	* sysdeps/ieee754/ldbl-128/s_isinfl.c (__isinfl): Likewise.
+	* sysdeps/ieee754/ldbl-128/s_isnanl.c (__isnanl): Likewise.
+	* sysdeps/ieee754/ldbl-128/s_fpclassifyl.c (__fpclassifyl): Add
+	libm_hidden_def.
+	* sysdeps/ieee754/ldbl-128/s_expm1l.c (__expm1l): Add
+	libm_hidden_def.
+	* sysdeps/ieee754/ldbl-96/s_finitel.c (__finitel): Remove INTDEF.
+	Add hidden_def.
+	* sysdeps/ieee754/ldbl-96/s_isinfl.c (__isinfl): Likewise.
+	* sysdeps/ieee754/ldbl-96/s_isnanl.c (__isnanl): Likewise.
+	* sysdeps/ieee754/ldbl-96/s_fpclassifyl.c (__fpclassifyl): Add
+	libm_hidden_def.
+	* sysdeps/ia64/fpu/s_finite.S (__finite_internal, __finitef_internal,
+	__finitel_internal): Remove aliases.
+	(__finite, __finitef, __finitel): Add hidden_def.
+	* sysdeps/ia64/fpu/s_isnan.S (__isnan_internal, __isnanf_internal,
+	__isnanl_internal): Remove aliases.
+	(__isnan, __isnanf, __isnanl): Add hidden_def.
+	* sysdeps/ia64/fpu/s_isinf.S (__isinf_internal, __isinff_internal,
+	__isinfl_internal): Remove aliases.
+	(__isinf, __isinff, __isinfl): Add hidden_def.
+	* sysdeps/ia64/fpu/s_fpclassify.S (__fpclassify, __fpclassifyf,
+	__fpclassifyl): Add libm_hidden_def.
+	* sysdeps/ia64/fpu/s_expm1l.S (__expm1l): Likewise.
+	* sysdeps/m68k/s_isinfl.c (__isinfl): Remove INTDEF.  Add hidden_def.
+	* sysdeps/m68k/fpu/s_isinf.c (INTDEFX): Remove.
+	(hidden_defx): Define and use.
+	* sysdeps/m68k/fpu/s_fpclassifyl.c (__fpclassifyl): Add
+	libm_hidden_def.
+	* sysdeps/m68k/fpu/s_expm1l.c (__expm1l): Likewise.
+	* sysdeps/m68k/s_isnanl.c (__isnanl): Add hidden_def.
+	* sysdeps/powerpc/fpu/s_isnan.c (__isnan, __isnanf, __isnanl):
+	Remove INTDEF.
+	(__isnan, __isnanf): Add hidden_def.
+	* sysdeps/x86_64/fpu/s_finitel.S (__finitel_internal): Remove alias.
+	(__finitel): Add libm_hidden_def.
+	* sysdeps/x86_64/fpu/s_expm1l.S (__expm1l): Likewise.
+
+	* include/fenv.h (feraiseexcept, fesetenv): Add libm_hidden_proto.
+	* sysdeps/alpha/fpu/fesetenv.c (fesetenv): Add libm_hidden_ver.
+	* sysdeps/alpha/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/arm/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/arm/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/generic/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/generic/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/i386/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/i386/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/m68k/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/m68k/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/mips/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/mips/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/powerpc/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/powerpc/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/sparc/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/sparc/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/hppa/fpu/fesetenv.c (fesetenv): Add libm_hidden_def.
+	* sysdeps/hppa/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/ia64/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/ia64/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/sh/sh4/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/sh/sh4/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/s390/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/s390/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+	* sysdeps/x86_64/fpu/fesetenv.c (fesetenv): Likewise.
+	* sysdeps/x86_64/fpu/fraiseexcpt.c (feraiseexcept): Likewise.
+
+2002-09-09  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* elf/elf.h: Add powerpc64 specific elf relocation and dynamic types.
+
+2002-09-09  Jakub Jelinek  <jakub@redhat.com>
+
+	* elf/dl-error.c (_dl_signal_cerror): Don't print anything if only
+	LD_DEBUG=statistics or LD_TRACE_PRELINKING.
+
+2002-09-09  Ulrich Drepper  <drepper@redhat.com>
+
+	* string/stratcliff.c: Some more strncpy tests.
+	Patch by Daniel Jacobowitz <drow@mvista.com>.
+
+2002-09-08  Roland McGrath  <roland@redhat.com>
+
+	* resolv/resolv.h: Include <sys/types.h> for u_long even in
+	the [__need_res_state] case.
+	Reported by Bruno Haible <bruno@clisp.org>.
+
+2002-09-04  Bruno Haible  <bruno@clisp.org>
+
+	* sysdeps/generic/bits/ustat.h: Comment fix.
+	* io/sys/sendfile.h: Comment fix.
+	* sysdeps/posix/pread.c: Comment fix.
+	* sysdeps/posix/pread64.c: Comment fix.
+	* sysdeps/posix/pwrite.c: Comment fix.
+	* sysdeps/posix/pwrite64.c: Comment fix.
+
+2002-09-06  Roland McGrath  <roland@redhat.com>
+
+	* posix/sys/utsname.h (_UTSNAME_SYSNAME_LENGTH): New macro, defined
+	to _UTSNAME_LENGTH if not already defined by <bits/utsname.h>.
+	(_UTSNAME_RELEASE_LENGTH, _UTSNAME_VERSION_LENGTH): Likewise.
+	(_UTSNAME_MACHINE_LENGTH): Likewise.
+	(struct utsname): Use new macros instead of _UTSNAME_LENGTH.
+
+2002-09-06  Ulrich Drepper  <drepper@redhat.com>
+
+	* sysdeps/unix/sysv/linux/shm_open.c (where_is_shmfs): Correct
+	test for filesystem type name of mount points.
+
+	* include/errno.h: Use errno definition with __thread for now only
+	in libc and ld.so.
+
+	* test-skeleton.c (main): Improve error message for unexpected
+	signal case.
+
+2002-09-05  Roland McGrath  <roland@redhat.com>
+
+	* ctype/ctype-info.c: Renamed __ctype_old_* symbols to __ctype_*.
+	* locale/lc-ctype.c (_nl_postload_ctype): Likewise.
+
+2002-09-05  Jakub Jelinek  <jakub@redhat.com>
+
+	* wcsmbs/wcsmbsload.c (__wcsmbs_load_conv): Unlock and return in
+	case of failure.
+
+2002-09-04  Bruno Haible  <bruno@clisp.org>
+
+	* sysdeps/unix/sysv/linux/sigset-cvt-mask.h (sigset_set_old_mask,
+	sigset_get_old_mask): Turn into inline functions.
+	* sysdeps/unix/sysv/aix/sigset-cvt-mask.h (sigset_set_old_mask,
+	sigset_get_old_mask): Likewise.
+	* sysdeps/unix/sysv/sysv4/sigset-cvt-mask.h (sigset_set_old_mask,
+	sigset_get_old_mask): Likewise.
+	* sysdeps/generic/sigset-cvt-mask.h (sigset_set_old_mask): Declutter
+	syntax.
+
+	* elf/readlib.c (process_file): Conditionalize check for QMAGIC.
+
+	* sysdeps/generic/_strerror.c (_sys_errlist, _sys_nerr): Remove
+	default definitions.
+	(__strerror_r): Use _sys_errlist_internal instead of _sys_errlist,
+	_sys_nerr_internal instead of _sys_nerr.
+
+	* nscd/connections.c (handle_request): Declare CALLER inside #if.
+
+2002-07-29  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/__longjmp.S: Moved to...
+	* sysdeps/powerpc/powerpc32/__longjmp.S: ...here.
+	* sysdeps/powerpc/add_n.S: Moved to...
+	* sysdeps/powerpc/powerpc32/add_n.S: ...here.
+	* sysdeps/powerpc/addmul_1.S: Moved to...
+	* sysdeps/powerpc/powerpc32/addmul_1.S: ...here.
+	* sysdeps/powerpc/atomicity.h: Moved to...
+	* sysdeps/powerpc/powerpc32/atomicity.h: ...here.
+	* sysdeps/powerpc/backtrace.c: Moved to...
+	* sysdeps/powerpc/powerpc32/backtrace.c: ...here.
+	* sysdeps/powerpc/bp-asm.h: Moved to...
+	* sysdeps/powerpc/powerpc32/bp-asm.h: ...here.
+	* sysdeps/powerpc/bsd-_setjmp.S: Moved to...
+	* sysdeps/powerpc/powerpc32/bsd-_setjmp.S: ...here.
+	* sysdeps/powerpc/bsd-setjmp.S: Moved to...
+	* sysdeps/powerpc/powerpc32/bsd-setjmp.S: ...here.
+	* sysdeps/powerpc/dl-machine.c: Moved to...
+	* sysdeps/powerpc/powerpc32/dl-machine.c: ...here.
+	* sysdeps/powerpc/dl-machine.h: Moved to...
+	* sysdeps/powerpc/powerpc32/dl-machine.h: ...here.
+	* sysdeps/powerpc/dl-start.S: Moved to...
+	* sysdeps/powerpc/powerpc32/dl-start.S: ...here.
+	* sysdeps/powerpc/gprrest0.S: Moved to...
+	* sysdeps/powerpc/powerpc32/gprrest0.S: ...here.
+	* sysdeps/powerpc/gprrest1.S: Moved to...
+	* sysdeps/powerpc/powerpc32/gprrest1.S: ...here.
+	* sysdeps/powerpc/gprsave0.S: Moved to...
+	* sysdeps/powerpc/powerpc32/gprsave0.S: ...here.
+	* sysdeps/powerpc/gprsave1.S: Moved to...
+	* sysdeps/powerpc/powerpc32/gprsave1.S: ...here.
+	* sysdeps/powerpc/lshift.S: Moved to...
+	* sysdeps/powerpc/powerpc32/lshift.S: ...here.
+	* sysdeps/powerpc/memset.S: Moved to...
+	* sysdeps/powerpc/powerpc32/memset.S: ...here.
+	* sysdeps/powerpc/mul_1.S: Moved to...
+	* sysdeps/powerpc/powerpc32/mul_1.S: ...here.
+	* sysdeps/powerpc/ppc-mcount.S: Moved to...
+	* sysdeps/powerpc/powerpc32/ppc-mcount.S: ...here.
+	* sysdeps/powerpc/register-dump.h: Moved to...
+	* sysdeps/powerpc/powerpc32/register-dump.h: ...here.
+	* sysdeps/powerpc/rshift.S: Moved to...
+	* sysdeps/powerpc/powerpc32/rshift.S: ...here.
+	* sysdeps/powerpc/setjmp.S: Moved to...
+	* sysdeps/powerpc/powerpc32/setjmp.S: ...here.
+	* sysdeps/powerpc/stpcpy.S: Moved to...
+	* sysdeps/powerpc/powerpc32/stpcpy.S: ...here.
+	* sysdeps/powerpc/strchr.S: Moved to...
+	* sysdeps/powerpc/powerpc32/strchr.S: ...here.
+	* sysdeps/powerpc/strcmp.S: Moved to...
+	* sysdeps/powerpc/powerpc32/strcmp.S: ...here.
+	* sysdeps/powerpc/strcpy.S: Moved to...
+	* sysdeps/powerpc/powerpc32/strcpy.S: ...here.
+	* sysdeps/powerpc/strlen.S: Moved to...
+	* sysdeps/powerpc/powerpc32/strlen.S: ...here.
+	* sysdeps/powerpc/sub_n.S: Moved to...
+	* sysdeps/powerpc/powerpc32/sub_n.S: ...here.
+	* sysdeps/powerpc/submul_1.S: Moved to...
+	* sysdeps/powerpc/powerpc32/submul_1.S: ...here.
+	* sysdeps/powerpc/elf/bzero.S: Moved to...
+	* sysdeps/powerpc/powerpc32/elf/bzero.S: ...here.
+	* sysdeps/powerpc/elf/start.S: Moved to...
+	* sysdeps/powerpc/powerpc32/elf/start.S: ...here.
+	* sysdeps/powerpc/fpu/__longjmp.S: Moved to...
+	* sysdeps/powerpc/powerpc32/fpu/__longjmp.S: ...here.
+	* sysdeps/powerpc/fpu/fprrest.S: Moved to...
+	* sysdeps/powerpc/powerpc32/fpu/fprrest.S: ...here.
+	* sysdeps/powerpc/fpu/fprsave.S: Moved to...
+	* sysdeps/powerpc/powerpc32/fpu/fprsave.S: ...here.
+	* sysdeps/powerpc/fpu/setjmp.S: Moved to...
+	* sysdeps/powerpc/powerpc32/fpu/setjmp.S: ...here.
+	* sysdeps/powerpc/fpu/s_copysign.S: Moved to...
+	* sysdeps/powerpc/powerpc32/fpu/s_copysign.S: ...here.
+	* sysdeps/powerpc/fpu/s_copysignf.S: Moved to...
+	* sysdeps/powerpc/powerpc32/fpu/s_copysignf.S: ...here.
+	* sysdeps/unix/sysv/linux/powerpc/brk.S: Moved to...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/brk.S: ...here.
+	* sysdeps/unix/sysv/linux/powerpc/clone.S: Moved to...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S: ...here.
+	* sysdeps/unix/sysv/linux/powerpc/glob64.c: Moved to...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/glob64.c: ...here.
+	* sysdeps/unix/sysv/linux/powerpc/kernel_stat.h: Moved to...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/kernel_stat.h: ...here.
+	* sysdeps/unix/sysv/linux/powerpc/socket.S: Moved to...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/socket.S: ...here.
+	* sysdeps/unix/sysv/linux/powerpc/sysdep.h: Moved to...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h: ...here.
+	* sysdeps/unix/sysv/linux/powerpc/syscalls.list: Moved to...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list: ...here.
+	Support PowerPC64.  Separate powerpc into powerpc/powerpc32 and
+	powerpc/powerpc64.
+
+2002-07-29  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* FAQ.in: Add powerpc64 to supported targets list. Also state the
+	minimum gcc version is 3.2
+	* README: Add powerpc64 to supported targets list.
+	* configure.in: Change machine=powerpc to machine=powerpc/powerpc32.
+	Add powerpc64 and machine=powerpc/powerpc64.
+	(HAVE_ASM_GLOBAL_DOT_NAME): Define if linux*powerpc/powerpc64*.
+	* shlib-versions: Set DEFAULT version to 2.2.5 for powerpc64.
+	* sysdeps/powerpc/Dist: Remove dl-machine.c, dl-start.S, ppc-mcount.S,
+	gprsave1.S, gprsave0.S, gprrest1.S, and gprrest0.S.
+	* sysdeps/powerpc/powerpc32/Dist: New file.
+	* sysdeps/powerpc/Implies: Remove wordsize-32 and powerpc/soft-fp.
+	* sysdeps/powerpc/powerpc32/Implies: New file.
+	* sysdeps/powerpc/Makefile(cflags): Remove powerpc32 specific cflags.
+	($(with-fp) = no): Move test to powerpc32/Makefile.
+	($(subdir) = misc): Move to powerpc32/Makefile.
+	($(build-shared) = yes): Move to powerpc32/Makefile.
+	($(subdir) = csu): Move to powerpc32/Makefile.
+	(sysdep-rtld-routines): Remove dl-start.  Moved these bits to ...
+	* sysdeps/powerpc/powerpc32/Makefile: New file.
+	* sysdeps/powerpc/Versions: Remove libgcc functions.
+	* sysdeps/powerpc/powerpc32/Versions: New file.
+	* sysdeps/powerpc/fpu/Makefile: Remove fprsave and fprrest.
+	* sysdeps/powerpc/powerpc32/fpu/Makefile: New file.
+	* sysdeps/unix/sysv/linux/configure.in (powerpc*):
+	Set arch_minimum_kernel=2.4.19 for powerpc/powerpc64. Also set
+	libc_cv_gcc_unwind_find_fde=yes only if !powerpc/powerpc64.
+	($machine): Add powerpc/powerpc64 to if ... | for
+	libc_cv_slibdir=/libc64.
+	(powerpc*): Set ldd_rewrite_script.
+	* sysdeps/unix/sysv/linux/powerpc/ldd-rewrite.sed: New file.
+	* sysdeps/unix/sysv/linux/powerpc/Dist: Remove clone.S.
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/Dist: New file.
+	Add clone.S.
+	* sysdeps/unix/sysv/linux/powerpc/Makefile: Remove oldgetrlimit64.
+	* sysdeps/unix/sysv/linux/powerpc/Versions: Remove GLIBC_2.0
+	functions.  Remove GLIBC_2.2 functions except getrlimit and
+	setrlimit.  Moved them to ...
+	* sysdeps/unix/sysv/linux/powerpc/powerpc32/Versions: New file.
+
+2002-09-04  Ulrich Drepper  <drepper@redhat.com>
+
+	* libio/tst-atime.c: Include <errno.h>.
+	(do_test): Only perform fstatvfs check if ST_NOATIME is defined.
+
+2002-09-03  Isamu Hasegawa  <isamu@yamato.ibm.com>
+
+	* posix/regcomp.c (regcomp): Append "__restrict" modifier to avoid
+	warnings of some compilers.
+	(build_collating_symbol): Change the type of characters from
+	"unsigned char"	to "char", and append a cast to "char*" pointer in
+	array subscript.
+	(build_collating_symbol): Likewise.
+	(build_equiv_class): Likewise.
+	(build_charclass): Likewise.
+	(re_compile_pattern): Remove incorrect cast.
+	(re_compile_fastmap_iter): Change the type of characters from
+	"unsigned char"	to "char", and append a cast to "char*" pointer
+	in array subscript.
+	(parse_bracket_exp): Likewise.
+	* posix/regex_internal.c (re_string_construct_common): Likewise.
+	(re_string_allocate): Likewise.
+	(re_string_construct): Likewise.
+	(re_string_realloc_buffers): Likewise.
+	(build_wcs_buffer): Likewise.
+	(re_string_reconstruct): Likewise.
+	* posix/regex_internal.h: Change the type of characters in
+	re_string_t and bracket_elem_t from "unsigned char" to "char".
+	* posix/regexec.c (regexec): Append "__restrict" modifier to avoid
+	warnings of some compilers.
+	(transit_state_bkref_loop): Change the type of characters from
+	"unsigned char"	to "char", and append a cast to "char*" pointer in
+	array subscript.
+	(check_node_accept_bytes): Likewise.
+	(find_collation_sequence_value): Likewise.
+
+2002-09-04  Roland McGrath  <roland@redhat.com>
+
+	* resolv/nss_dns/dns-network.c (MAXPACKET): Increase minimum value
+	from 1024 to 65536, to avoid buffer overrun.
+
+2002-09-03  Gerhard Tonn  <ton@de.ibm.com>
+
+	* sysdeps/s390/s390/fpu/libm-test-ulps: Regenerate.
+
+2002-09-04  Ulrich Drepper  <drepper@redhat.com>
+
+	* libio/tst-atime.c (do_test): Make sure noatime flag isn't set
+	for filesystem.
+
+2002-09-04  Jakub Jelinek  <jakub@redhat.com>
+
+	* posix/bug-regex11.c: New test.
+	* posix/Makefile (tests): Add bug-regex11.
+
+2002-09-03  Jakub Jelinek  <jakub@redhat.com>
+
+	* locale/tst-C_locale.c (run_test): Pass LC_ALL_MASK not LC_ALL to
+	newlocale.
+
 2002-09-02  Roland McGrath  <roland@redhat.com>
 
 	* sysdeps/powerpc/elf/libc-start.c [! SHARED]: Call
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/FAQ.in ../glibc-2.3/FAQ.in
--- glibc-2.2.93/FAQ.in	Thu May 30 18:40:46 2002
+++ ../glibc-2.3/FAQ.in	Thu Sep  5 19:27:47 2002
@@ -30,6 +30,7 @@
 	m68k-*-linux-gnu	Linux-2.x on Motorola 680x0
 	alpha*-*-linux-gnu	Linux-2.x on DEC Alpha
 	powerpc-*-linux-gnu     Linux and MkLinux on PowerPC systems
+	powerpc64-*-linux-gnu	Linux-2.4+ on 64-bit PowerPC systems
 	sparc-*-linux-gnu	Linux-2.x on SPARC
 	sparc64-*-linux-gnu	Linux-2.x on UltraSPARC
 	arm-*-none		ARM standalone systems
@@ -379,6 +380,11 @@
 
 For details check also my page <http://www.suse.de/~aj/glibc-mips.html>.
 
+??powerpc64	Which compiler should I use for powerpc64?
+
+{SM} You want to use at least gcc 3.2 (together with the right versions
+of all the other tools, of course).
+
 ? Installation and configuration issues
 
 ??	Can I replace the libc on my Linux system with GNU libc?
@@ -1668,6 +1674,7 @@
 {CG} Cristian Gafton, <gafton@redhat.com>
 {AO} Alexandre Oliva, <aoliva@redhat.com>
 {BH} Bruno Haible, <haible@clisp.cons.org>
+{SM} Steven Munroe, <sjmunroe@us.ibm.com>
 
 Local Variables:
  mode:outline
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/Makefile ../glibc-2.3/Makefile
--- glibc-2.2.93/Makefile	Wed Aug 28 04:07:22 2002
+++ ../glibc-2.3/Makefile	Sat Sep 14 09:40:45 2002
@@ -130,6 +130,21 @@
 # Build the shared object from the PIC object library.
 lib: $(common-objpfx)libc.so
 endif
+
+
+# This is a handy script for running any dynamically linked program against
+# the current libc build for testing.
+$(common-objpfx)testrun.sh: $(common-objpfx)config.make \
+			    $(..)Makeconfig $(..)Makefile
+	(echo '#!/bin/sh'; \
+	 echo "GCONV_PATH='$(common-objpfx)iconvdata' \\"; \
+	 echo 'exec $(run-program-prefix) $${1+"$$@"}'; \
+	) > $@T
+	chmod a+x $@T
+	mv -f $@T $@
+postclean-generated += testrun.sh
+
+others: $(common-objpfx)testrun.sh
 
 # Makerules creates a file `stubs' in each subdirectory, which
 # contains `#define __stub_FUNCTION' for each function defined in that
@@ -297,7 +312,7 @@
 rpm/%: subdir_distinfo
 	$(MAKE) $(PARALLELMFLAGS) -C $(@D) $(@F)
 
-iconvdata/% localedata/% po/%:
+iconvdata/% localedata/% po/% manual/%:
 	$(MAKE) $(PARALLELMFLAGS) -C $(@D) $(@F)
 
 # This is a special goal for people making binary distributions.  Normally
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/PROJECTS ../glibc-2.3/PROJECTS
--- glibc-2.2.93/PROJECTS	Wed Nov 14 03:48:09 2001
+++ ../glibc-2.3/PROJECTS	Thu Sep  5 19:27:47 2002
@@ -1,6 +1,6 @@
 Open jobs for finishing GNU libc:
 ---------------------------------
-Status: February 2001
+Status: September 2002
 
 If you have time and talent to take over any of the jobs below please
 contact <bug-glibc@gnu.org>.
@@ -52,15 +52,6 @@
      work.
 
 
-[10] Extend regex and/or rx to work with wide characters and complete
-     implementation of character class and collation class handling.
-
-     It is planned to do a complete rewrite.
-
-***  We have now multibyte character support.  But a rewrite is still
-     necessary.
-
-
 [11] Write access function for netmasks, bootparams, and automount
      databases for nss_files and nss_db module.
      The functions should be embedded in the nss scheme.  This is not
@@ -82,18 +73,6 @@
      comments can be improved.
 
 
-[16] The libio stream file functions should be extended in a way to use
-     mmap to map the file and use it as the buffer to user sees.  For
-     read-only streams this should be rather easy and it avoids all read()
-     calls.
-
-     A more sophisticated solution would use mmap also for writing.  The
-     standards do not demand that the file on the disk is always in the
-     correct form so it would be possible to enlarge it always according
-     to the page size and install the correct length only for fclose() and
-     fflush() calls.
-
-
 [18] Based on the sprof program we need tools to analyze the output.  The
      result should be a link map which specifies in which order the .o
      files are placed in the shared object.  This should help to improve
@@ -116,7 +95,7 @@
 
 [21] The nscd program and the stubs in the libc should be changed so
      that each program uses only one socket connect.  Take a look at
-	http://www.cygnus.com/~drepper/nscd.html
+	http://people.redhat.com/drepper/nscd.html
 
      An alternative approach is to use an mmap()ed file.  The idea is
      the following:
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/README-alpha ../glibc-2.3/README-alpha
--- glibc-2.2.93/README-alpha	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/README-alpha	Thu May 13 06:22:39 1999
@@ -0,0 +1,287 @@
+			 GNU libc SNAPSHOT SYSTEM
+			    (general info)
+			   Updated 1997-9-26
+
+WHAT ARE GNU libc SNAPSHOTS
+---------------------------
+
+Snapshots are an "image" of the main glibc development tree, captured at a
+particular random instant in time.  When you use the snapshots, you should be
+able to maintain a local copy of libc that is no more than one day older than
+the official source tree used by the libc maintainers.
+
+The primary purpose of providing snapshots is to widen the group of motivated
+developers that would like to help test, debug, and enhance glibc, by providing
+you with access to the "latest and greatest" source.  This has several
+advantages, and several disadvantages.
+
+    First the advantages:
+
+    o	Once we have a large base of motivated testers using the snapshots,
+	this should provide good coverage across all currently supported
+	glibc hosts and targets.  If a new bug is introduced in glibc due to
+	fixing another bug or ongoing development, it should become
+	obvious much more quickly and get fixed before the next general
+	net release.  This should help to reduce the chances of glibc being
+	released to the general public with a major bug that went unnoticed
+	during the release cycle testing because they are machine dependent.
+	We hope to greatly improve glibc's stability and reliability by
+	involving more people and more execution environments in the
+	prerelease testing.
+
+    o	With access to the latest source, any diffs that you send to fix
+	bugs or add new features should be much easier for the glibc team
+	to merge into the official source base (after suitable review
+	of course).  This encourages us to merge your changes quicker,
+	while they are still "fresh".
+
+    o	Once your diffs are merged, you can obtain a new copy of glibc
+	containing your changes almost immediately.  Thus you do not
+	have to maintain local copies of your changes for any longer
+	than it takes to get them merged into the official source base.
+	This encourages you to send in changes quicker.
+
+    And the disadvantages:
+
+    o	The snapshot you get will be largely untested and of unknown quality.
+	It may fail to configure or compile.  It may have serious bugs.
+	You should always keep a copy of the last known working version
+	before updating to the current snapshot, or at least be able to
+	regenerate a working version if the latest snapshot is unusable
+	in your environment for some reason.
+
+	If a production version of glibc has a bug and a snapshot has the fix,
+	and you care about stability, you should put only the fix for that
+	particular problem into your production version.  Of course, if you
+	are eager to test glibc, you can use the snapshot versions in your
+	daily work, but users who have not been consulted about whether they
+	feel like testing glibc should generally have something which is at
+	least as bug free as the last released version.
+
+    o	Providing timely response to your questions, bug reports, and
+	submitted patches will require the glibc development team to allocate
+	time from an already thin time budget.  Please try to help us make
+	this time as productive as possible.  See the section below about
+	how to submit changes.
+
+
+WHO SHOULD TRY THE SNAPSHOTS
+----------------------------
+
+Remember, these are snapshots not tested versions.  So if you use
+these versions you should be able to
+
+    o	make sure your system stays usable
+
+    o	locate and hopefully fix problems
+
+    o	to port glibc to a new target yourself
+
+You should not use the snapshots if
+
+    o	your system is needed in a production environment which needs
+	stability
+
+    o	you expect us to fix your problems since you somehow depend on them.
+	You must be willing to fix the problems yourself, we don't want to
+	see "I have problems, fix this" messages.
+
+
+HOW TO GET THE SNAPSHOTS
+------------------------
+
+At the moment we provide a full snapshot weekly (every sunday), so
+that users getting a snapshot for the first time, or updating after
+a long period of not updating, can get the latest version in a single
+operation.  Along with the full snapshot, we will provide incremental
+diffs on a nearly daily basis (whenever code changes).  Each daily
+diff will be relative to the source tree after applying all previous
+daily diffs.  The daily diffs are for people who have relatively low
+bandwidth ftp or uucp connections.
+
+The files will be available via anonymous ftp from alpha.gnu.org, in
+directory /gnu/libc and on linux.kernel.org in /pub/software/libs/glibc.  The
+directories should look something like:
+
+	libc-970921.tar.gz
+	libc-970917-970922.diff.gz
+	libc-970922-970925.diff.gz
+	.
+	.
+	.
+
+Please note that the snapshots on alpha.gnu.org and on
+linux.kernel.org are not always in sync. Patches to some files might
+appear a day a diff earlier or later on alpha than on kernel.
+Use always alpha or always kernel but don't mix them.
+
+There are sometimes additionally test releases of the add-ons available in
+these directories.  If a new version of an add-on is available it is normally
+required for the corresponding snapshot so always pay attention for these.
+
+Note that we provide GNU gzip compressed files only.  You can ftp gzip
+from ftp.gnu.org in directory pub/gnu.
+
+In some cases the dates for diffs and snapshots do not match like in the
+example above.  The full release is for 970921 but the patch is for
+970917-970922.  This only means that nothing changed between 970917 and 970922
+and that you have to use this patch on top of the 970921 snapshot since the
+patch is made on 970922.
+
+Also, as the gcc developers did with their gcc snapshot system, even though we
+will make the snapshots available on a publically accessible ftp area, we ask
+that recipients not widely publicise their availability.  The motivation for
+this request is not to hoard them, but to avoid the situation where the
+general glibc user base naively attempts to use the snapshots, has trouble with
+them, complains publically, and the reputation of glibc declines because of a
+perception of instability or lack of quality control.
+
+
+GLIBC TEST SUITE
+----------------
+
+A test suite is distributed as an integral part of the snapshots.  A simple
+"make check" in your build directory is sufficient to run the tests.  glibc
+should pass all tests and if any fails, please report it.  A failure might not
+originate from a bug in glibc but also from bugs in the tools, e.g. with gcc
+2.7.2.x the math tests fail some of the tests because of compiler bugs.
+
+Note that the test suite is still in its infancy.  The tests themselves only
+cover a small portion of libc features, and where tests do exist for a feature
+they are not exhaustive.  New tests are welcome.
+
+
+GETTING HELP, GLIBC DISCUSSIONS, etc
+------------------------------------
+
+People who want to help with glibc and who test out snapshots
+regularly should get on the libc-alpha@sourceware.cygnus.com mailing
+list by sending an email to libc-alpha-subscribe@sourceware.cygnus.com.
+This list is meant (as the name suggests) for the discussion of test
+releases and also reports for them.  People who are on this list are
+welcome to post questions of general interest.
+
+People who are not only willing to test the snapshots but instead
+really want to help developing glibc should contact
+libc-hacker-subscribe@sourceware.cygnus.com.org to be put on the developers
+mailing list.  This list is really only meant for developers.  No
+questions about installation problems or other simple topics are
+wanted nor will they be answered.
+
+Do *not* send any questions about the snapshots or patches specific to the
+snapshots to bug-glibc@gnu.org.  Nobody there will have any idea what
+you are talking about and it will just cause confusion.
+
+
+BUG REPORTS
+-----------
+
+Send bug reports directly to Ulrich Drepper <drepper@gnu.org>.  Please
+do *not* use the glibcbug script for reporting bugs in the snapshots.
+glibcbug should only be used for problems with the official released versions.
+We don't like bug reports in the bug database because otherwise the impression
+of instability or lack of quality control of glibc as a whole might manifest
+in people's mind.
+
+Note that since no testing is done on the snapshots, and snapshots may even be
+made when glibc is in an inconsistent state, it may not be unusual for an
+occasional snapshot to have a very obvious bug, such as failure to compile on
+*any* machine.  It is likely that such bugs will be fixed by the next
+snapshot, so it really isn't necessary to report them unless they persist for
+a couple of days.
+
+Missing files should always be reported, since they usually mean there is a
+problem with the snapshot-generating process and we won't know about them
+unless someone tells us.
+
+Bugs which are non-obvious, such as failure to compile on only a specific
+machine, a new machine dependent or obscure bug (particularly one not detected
+by the testsuite), etc should be reported when you discover them, or have a
+suggested patch to fix them.
+
+
+FORMAT FOR PATCHES
+------------------
+
+If you have a fix for a bug, or an enhancement to submit, send your patch to
+Ulrich Drepper <drepper@gnu.org>.  Here are some simple guidelines for
+submitting patches:
+
+    o	Use "unified diffs" for patches.  A typical command for generating
+	context diffs is "diff -ru glibc-old glibc-patched".
+
+    o	Use the "minimalist approach" for patches.  That is, each patch
+	should address only one particular bug, new feature, etc.  Do not
+	save up many unrelated changes and submit them all in one big
+	patch, since in general, the larger the patch the more difficult
+	it is for us to decide if the patch is either correct or
+	desirable.  And if we find something about the patch that needs
+	to be corrected before it can be installed, we would have to reject
+	the entire patch, which might contain changes which otherwise would
+	be accepted if submitted separately.
+
+    o	Submit a sample ChangeLog entry with your patch.  See the existing
+	glibc ChangeLog for examples of what a ChangeLog entry should look
+	like.  The emacs command ^X4A will create a ChangeLog entry header
+	for you.
+
+
+BUILDING SNAPSHOTS
+------------------
+
+The `best' way to build glibc is to use an extra directory, e.g.:
+tar xzf libc-970921.tar.gz
+mkdir build-glibc
+cd build-glibc
+../libc-970921/configure ...
+
+In this way you can easily clean up (since `make clean' doesn't work at
+the moment) and rebuild glibc.
+
+
+NECESSARY TOOLS
+---------------
+
+For the recommended versions of gcc, binutils, make, texinfo, gettext,
+autoconf and other tools which might be especially needed when using patches,
+please read the file INSTALL.
+
+
+HOW CAN YOU HELP
+----------------
+
+It helps already a lot if you just install glibc on your system and try to
+solve any problems.  You might want to look at the file `PROJECTS' and help
+with one of those projects, fix some bugs (see `BUGS' or the bug database),
+port to an unsupported platform, ...
+
+
+FURTHER DOCUMENTATION
+---------------------
+
+A lot of questions are answered in the FAQ.  The files `INSTALL', `README' and
+`NOTES' contain the most important documentation.  Furthermore glibc has its
+own 700+ pages info documentation, ...
+
+
+
+And finally a word of caution: The libc is one of the most fundamental parts
+of your system - and these snapshots are untested and come without any
+guarantee or warranty.  You might be lucky and everything works or you might
+crash your system.  If you install a glibc snapshot as primary library, you
+should have a backup somewhere.
+
+On many systems it is also a problem to replace the libc while the system is
+running.  In the worst case on broken OSes some systems crash.  On better
+systems you can move the old libc aside but removing it will cause problems
+since there are still processes using this libc image and so you might have to
+check the filesystem to get rid of the libc data.  One good alternative (which
+is also safer) is to use a chroot'ed environment.
+
+Thanks for your help and support.
+
+Thanks to Fred Fish from Cygnus for the original version of this text
+(for GDB).
+
+
+Ulrich Drepper
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/README.template ../glibc-2.3/README.template
--- glibc-2.2.93/README.template	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/README.template	Thu Sep  5 19:27:47 2002
@@ -0,0 +1,86 @@
+This directory contains the version VERSION release of the GNU C Library.
+Many bugs have been fixed since the last release.
+Some bugs surely remain.
+
+As of this release, the GNU C library is known to run on the following
+configurations:
+
+		*-*-gnu			GNU Hurd
+		i[3456]86-*-linux-gnu	Linux-2.x on Intel
+		m68k-*-linux-gnu	Linux-2.x on Motorola 680x0
+		alpha*-*-linux-gnu	Linux-2.x on DEC Alpha
+		powerpc-*-linux-gnu     Linux and MkLinux on PowerPC systems
+		powerpc64-*-linux-gnu	Linux-2.4+ on 64-bit PowerPC systems
+		sparc-*-linux-gnu	Linux-2.x on SPARC
+		sparc64-*-linux-gnu	Linux-2.x on UltraSPARC 64-bit
+		arm-*-none		ARM standalone systems
+		arm-*-linux		Linux-2.x on ARM
+		arm-*-linuxaout		Linux-2.x on ARM using a.out binaries
+		mips*-*-linux-gnu	Linux-2.x on MIPS
+		ia64-*-linux-gnu	Linux-2.x on ia64
+		s390-*-linux-gnu	Linux-2.x on IBM S/390
+		s390x-*-linux-gnu	Linux-2.x on IBM S/390 64-bit
+		sh-*-linux-gnu		Linux-2.x on Super Hitachi
+		cris-*-linux-gnu	Linux-2.4+ on CRIS
+
+Former releases of this library (version 1.09.1 and perhaps earlier
+versions) used to run on the following configurations:
+
+		alpha-dec-osf1
+		i[3456]86-*-bsd4.3
+		i[3456]86-*-isc2.2
+		i[3456]86-*-isc3
+		i[3456]86-*-sco3.2
+		i[3456]86-*-sco3.2v4
+		i[3456]86-*-sysv
+		i[3456]86-*-sysv4
+		i[3456]86-force_cpu386-none
+		i[3456]86-sequent-bsd
+		i960-nindy960-none
+		m68k-hp-bsd4.3
+		m68k-mvme135-none
+		m68k-mvme136-none
+		m68k-sony-newsos3
+		m68k-sony-newsos4
+		m68k-sun-sunos4
+		mips-dec-ultrix4
+		mips-sgi-irix4
+		sparc-sun-solaris2
+		sparc-sun-sunos4
+
+Since no one has volunteered to test and fix the above configurations,
+these are not supported at the moment.  It's expected that these don't
+work anymore.  Porting the library is not hard.  If you are interested
+in doing a port, please contact the glibc maintainers by sending
+electronic mail to <bug-glibc@gnu.org>.
+
+There are some add-ons which can be used together with GNU libc.  They
+are designed in a way to ease the installation by integrating them in
+the libc source tree.  Simply get the add-ons you need and use the
+--enable-add-ons option of the `configure' script to tell where the
+add-ons are found.  Please read the FAQ file for more details.
+
+See the file INSTALL to find out how to configure, build, install, and port
+the GNU C library.  You might also consider reading the WWW pages for the
+GNU libc at http://www.gnu.org/software/libc/libc.html.
+
+The GNU C Library is completely documented by the Texinfo manual found
+in the `manual/' subdirectory.  The manual is still being updated and
+contains some known errors and omissions; we regret that we do not
+have the resources to work on the manual as much as we would like.
+Please send comments on the manual to <bug-glibc-manual@gnu.org>, and
+not to the library bug-reporting address.
+
+The file NOTES contains a description of the feature-test macros used
+in the GNU C library, explaining how you can tell the library what
+facilities you want it to make available.
+
+We prefer to get bug reports sent using the `glibcbug' shell script which
+is installed together with the rest of the GNU libc to <bugs@gnu.org>.
+Simply run this shell script and fill in the information.  Nevertheless
+you can still send bug reports to <bug-glibc@gnu.org> as normal electronic
+mails.
+
+The GNU C Library is free software.  See the file COPYING.LIB for copying
+conditions, and LICENSES for notices about a few contributions that require
+these additional notices to be distributed.
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/configure ../glibc-2.3/configure
--- glibc-2.2.93/configure	Wed Aug 28 07:33:11 2002
+++ ../glibc-2.3/configure	Thu Sep  5 19:27:47 2002
@@ -1024,6 +1024,8 @@
 m88k)		base_machine=m88k machine=m88k/m88100 ;;
 mips64*)	base_machine=mips64 machine=mips/mips64/$machine ;;
 mips*)		base_machine=mips machine=mips/$machine ;;
+powerpc)	base_machine=powerpc machine=powerpc/powerpc32 ;;
+powerpc64)	base_machine=powerpc machine=powerpc/powerpc64 ;;
 s390)           base_machine=s390 machine=s390/s390-32 ;;
 s390x)          base_machine=s390 machine=s390/s390-64 ;;
 sh3*)		base_machine=sh machine=sh/sh3 ;;
@@ -1056,7 +1058,7 @@
 # This can take a while to compute.
 sysdep_dir=$srcdir/sysdeps
 echo $ac_n "checking sysdep dirs""... $ac_c" 1>&6
-echo "configure:1060: checking sysdep dirs" >&5
+echo "configure:1062: checking sysdep dirs" >&5
 # Make sco3.2v4 become sco3.2.4 and sunos4.1.1_U1 become sunos4.1.1.U1.
 os="`echo $os | sed 's/\([0-9A-Z]\)[v_]\([0-9A-Z]\)/\1.\2/g'`"
 
@@ -1279,7 +1281,7 @@
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
 # ./install, which can be erroneously created by make from ./install.sh.
 echo $ac_n "checking for a BSD compatible install""... $ac_c" 1>&6
-echo "configure:1283: checking for a BSD compatible install" >&5
+echo "configure:1285: checking for a BSD compatible install" >&5
 if test -z "$INSTALL"; then
 if eval "test \"`echo '$''{'ac_cv_path_install'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -1336,7 +1338,7 @@
   INSTALL='\$(..)./scripts/install-sh -c'
 fi
 echo $ac_n "checking whether ln -s works""... $ac_c" 1>&6
-echo "configure:1340: checking whether ln -s works" >&5
+echo "configure:1342: checking whether ln -s works" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_LN_S'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1365,7 +1367,7 @@
 # Extract the first word of "pwd", so it can be a program name with args.
 set dummy pwd; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1369: checking for $ac_word" >&5
+echo "configure:1371: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_PWD_P'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1404,7 +1406,7 @@
 
 # These programs are version sensitive.
 echo $ac_n "checking build system type""... $ac_c" 1>&6
-echo "configure:1408: checking build system type" >&5
+echo "configure:1410: checking build system type" >&5
 
 build_alias=$build
 case "$build_alias" in
@@ -1432,7 +1434,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1436: checking for $ac_word" >&5
+echo "configure:1438: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1466,7 +1468,7 @@
 else
   # Found it, now check the version.
   echo $ac_n "checking version of $CC""... $ac_c" 1>&6
-echo "configure:1470: checking version of $CC" >&5
+echo "configure:1472: checking version of $CC" >&5
   ac_prog_version=`$CC -v 2>&1 | sed -n 's/^.*version \([egcygnustpi-]*[0-9.]*\).*$/\1/p'`
   case $ac_prog_version in
     '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
@@ -1486,7 +1488,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1490: checking for $ac_word" >&5
+echo "configure:1492: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MAKE'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1520,7 +1522,7 @@
 else
   # Found it, now check the version.
   echo $ac_n "checking version of $MAKE""... $ac_c" 1>&6
-echo "configure:1524: checking version of $MAKE" >&5
+echo "configure:1526: checking version of $MAKE" >&5
   ac_prog_version=`$MAKE --version 2>&1 | sed -n 's/^.*GNU Make[^0-9]*\([0-9][0-9.]*\).*$/\1/p'`
   case $ac_prog_version in
     '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
@@ -1549,7 +1551,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1553: checking for $ac_word" >&5
+echo "configure:1555: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MSGFMT'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1583,7 +1585,7 @@
 else
   # Found it, now check the version.
   echo $ac_n "checking version of $MSGFMT""... $ac_c" 1>&6
-echo "configure:1587: checking version of $MSGFMT" >&5
+echo "configure:1589: checking version of $MSGFMT" >&5
   ac_prog_version=`$MSGFMT --version 2>&1 | sed -n 's/^.*GNU gettext.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
   case $ac_prog_version in
     '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
@@ -1603,7 +1605,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1607: checking for $ac_word" >&5
+echo "configure:1609: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MAKEINFO'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1637,7 +1639,7 @@
 else
   # Found it, now check the version.
   echo $ac_n "checking version of $MAKEINFO""... $ac_c" 1>&6
-echo "configure:1641: checking version of $MAKEINFO" >&5
+echo "configure:1643: checking version of $MAKEINFO" >&5
   ac_prog_version=`$MAKEINFO --version 2>&1 | sed -n 's/^.*GNU texinfo.* \([0-9][0-9.]*\).*$/\1/p'`
   case $ac_prog_version in
     '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
@@ -1657,7 +1659,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1661: checking for $ac_word" >&5
+echo "configure:1663: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_SED'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1691,7 +1693,7 @@
 else
   # Found it, now check the version.
   echo $ac_n "checking version of $SED""... $ac_c" 1>&6
-echo "configure:1695: checking version of $SED" >&5
+echo "configure:1697: checking version of $SED" >&5
   ac_prog_version=`$SED --version 2>&1 | sed -n 's/^.*GNU sed version \([0-9]*\.[0-9.]*\).*$/\1/p'`
   case $ac_prog_version in
     '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
@@ -1709,7 +1711,7 @@
 
 
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works""... $ac_c" 1>&6
-echo "configure:1713: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
+echo "configure:1715: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_cc_works'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1723,12 +1725,12 @@
 
 cat > conftest.$ac_ext << EOF
 
-#line 1727 "configure"
+#line 1729 "configure"
 #include "confdefs.h"
 
 main(){return(0);}
 EOF
-if { (eval echo configure:1732: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:1734: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   ac_cv_prog_cc_works=yes
   # If we can't run a trivial program, we are probably using a cross compiler.
   if (./conftest; exit) 2>/dev/null; then
@@ -1759,7 +1761,7 @@
  cross_linkable=yes
 fi
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
-echo "configure:1763: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
+echo "configure:1765: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_cc_cross'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1771,7 +1773,7 @@
 cross_compiling=$ac_cv_prog_cc_cross
 
 echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
-echo "configure:1775: checking whether we are using GNU C" >&5
+echo "configure:1777: checking whether we are using GNU C" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1780,7 +1782,7 @@
   yes;
 #endif
 EOF
-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1784: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1786: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
   ac_cv_prog_gcc=yes
 else
   ac_cv_prog_gcc=no
@@ -1793,7 +1795,7 @@
 fi
 
 echo $ac_n "checking build system type""... $ac_c" 1>&6
-echo "configure:1797: checking build system type" >&5
+echo "configure:1799: checking build system type" >&5
 
 build_alias=$build
 case "$build_alias" in
@@ -1816,7 +1818,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1820: checking for $ac_word" >&5
+echo "configure:1822: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_BUILD_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1848,7 +1850,7 @@
 fi
 
 echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
-echo "configure:1852: checking how to run the C preprocessor" >&5
+echo "configure:1854: checking how to run the C preprocessor" >&5
 # On Suns, sometimes $CPP names a directory.
 if test -n "$CPP" && test -d "$CPP"; then
   CPP=
@@ -1863,13 +1865,13 @@
   # On the NeXT, cc -E runs the code through the compiler's parser,
   # not just through cpp.
   cat > conftest.$ac_ext <<EOF
-#line 1867 "configure"
+#line 1869 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1873: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1875: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -1880,13 +1882,13 @@
   rm -rf conftest*
   CPP="${CC-cc} -E -traditional-cpp"
   cat > conftest.$ac_ext <<EOF
-#line 1884 "configure"
+#line 1886 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1890: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1892: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -1897,13 +1899,13 @@
   rm -rf conftest*
   CPP="${CC-cc} -nologo -E"
   cat > conftest.$ac_ext <<EOF
-#line 1901 "configure"
+#line 1903 "configure"
 #include "confdefs.h"
 #include <assert.h>
 Syntax Error
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:1907: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:1909: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -1946,7 +1948,7 @@
 # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
 set dummy ${ac_tool_prefix}ranlib; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1950: checking for $ac_word" >&5
+echo "configure:1952: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1978,7 +1980,7 @@
   # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1982: checking for $ac_word" >&5
+echo "configure:1984: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2015,7 +2017,7 @@
 
 # Determine whether we are using GNU binutils.
 echo $ac_n "checking whether $AS is GNU as""... $ac_c" 1>&6
-echo "configure:2019: checking whether $AS is GNU as" >&5
+echo "configure:2021: checking whether $AS is GNU as" >&5
 if eval "test \"`echo '$''{'libc_cv_prog_as_gnu'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2034,7 +2036,7 @@
 gnu_as=$libc_cv_prog_as_gnu
 
 echo $ac_n "checking whether $LD is GNU ld""... $ac_c" 1>&6
-echo "configure:2038: checking whether $LD is GNU ld" >&5
+echo "configure:2040: checking whether $LD is GNU ld" >&5
 if eval "test \"`echo '$''{'libc_cv_prog_ld_gnu'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2054,7 +2056,7 @@
 # Extract the first word of "${ac_tool_prefix}mig", so it can be a program name with args.
 set dummy ${ac_tool_prefix}mig; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2058: checking for $ac_word" >&5
+echo "configure:2060: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MIG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2086,7 +2088,7 @@
   # Extract the first word of "mig", so it can be a program name with args.
 set dummy mig; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2090: checking for $ac_word" >&5
+echo "configure:2092: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MIG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2146,7 +2148,7 @@
 
 # check if ranlib is necessary
 echo $ac_n "checking whether ranlib is necessary""... $ac_c" 1>&6
-echo "configure:2150: checking whether ranlib is necessary" >&5
+echo "configure:2152: checking whether ranlib is necessary" >&5
 if eval "test \"`echo '$''{'libc_cv_ranlib_necessary'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2180,7 +2182,7 @@
 # - two terminals occur directly after each other
 # - the path contains an element with a dot in it
 echo $ac_n "checking LD_LIBRARY_PATH variable""... $ac_c" 1>&6
-echo "configure:2184: checking LD_LIBRARY_PATH variable" >&5
+echo "configure:2186: checking LD_LIBRARY_PATH variable" >&5
 case ${LD_LIBRARY_PATH} in
   [:\;]* | *[:\;] | *[:\;][:\;]* |  *[:\;]. | .[:\;]*| . | *[:\;].[:\;]* )
     ld_library_path_setting="contains current directory"
@@ -2198,7 +2200,7 @@
 fi
 
 echo $ac_n "checking whether GCC supports -static-libgcc""... $ac_c" 1>&6
-echo "configure:2202: checking whether GCC supports -static-libgcc" >&5
+echo "configure:2204: checking whether GCC supports -static-libgcc" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc_static_libgcc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2215,7 +2217,7 @@
 # Extract the first word of "bash", so it can be a program name with args.
 set dummy bash; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2219: checking for $ac_word" >&5
+echo "configure:2221: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_BASH'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2261,7 +2263,7 @@
   # Extract the first word of "ksh", so it can be a program name with args.
 set dummy ksh; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2265: checking for $ac_word" >&5
+echo "configure:2267: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_KSH'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2311,7 +2313,7 @@
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2315: checking for $ac_word" >&5
+echo "configure:2317: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_AWK'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2343,7 +2345,7 @@
 # Extract the first word of "perl", so it can be a program name with args.
 set dummy perl; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2347: checking for $ac_word" >&5
+echo "configure:2349: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_PERL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2383,7 +2385,7 @@
 # Extract the first word of "install-info", so it can be a program name with args.
 set dummy install-info; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2387: checking for $ac_word" >&5
+echo "configure:2389: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_INSTALL_INFO'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2418,7 +2420,7 @@
 
 if test "$INSTALL_INFO" != "no"; then
 echo $ac_n "checking for old Debian install-info""... $ac_c" 1>&6
-echo "configure:2422: checking for old Debian install-info" >&5
+echo "configure:2424: checking for old Debian install-info" >&5
 if eval "test \"`echo '$''{'libc_cv_old_debian_install_info'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2453,7 +2455,7 @@
 # Extract the first word of "bison", so it can be a program name with args.
 set dummy bison; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2457: checking for $ac_word" >&5
+echo "configure:2459: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_BISON'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2488,7 +2490,7 @@
 
 
 echo $ac_n "checking for signed size_t type""... $ac_c" 1>&6
-echo "configure:2492: checking for signed size_t type" >&5
+echo "configure:2494: checking for signed size_t type" >&5
 if eval "test \"`echo '$''{'libc_cv_signed_size_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2512,12 +2514,12 @@
 fi
 
 echo $ac_n "checking for libc-friendly stddef.h""... $ac_c" 1>&6
-echo "configure:2516: checking for libc-friendly stddef.h" >&5
+echo "configure:2518: checking for libc-friendly stddef.h" >&5
 if eval "test \"`echo '$''{'libc_cv_friendly_stddef'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 2521 "configure"
+#line 2523 "configure"
 #include "confdefs.h"
 #define __need_size_t
 #define __need_wchar_t
@@ -2532,7 +2534,7 @@
 if (&size == NULL || &wchar == NULL) abort ();
 ; return 0; }
 EOF
-if { (eval echo configure:2536: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2538: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   libc_cv_friendly_stddef=yes
 else
@@ -2551,7 +2553,7 @@
 fi
 
 echo $ac_n "checking whether we need to use -P to assemble .S files""... $ac_c" 1>&6
-echo "configure:2555: checking whether we need to use -P to assemble .S files" >&5
+echo "configure:2557: checking whether we need to use -P to assemble .S files" >&5
 if eval "test \"`echo '$''{'libc_cv_need_minus_P'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2574,7 +2576,7 @@
 fi
 
 echo $ac_n "checking whether .text pseudo-op must be used""... $ac_c" 1>&6
-echo "configure:2578: checking whether .text pseudo-op must be used" >&5
+echo "configure:2580: checking whether .text pseudo-op must be used" >&5
 if eval "test \"`echo '$''{'libc_cv_dot_text'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2595,7 +2597,7 @@
 fi
 
 echo $ac_n "checking for assembler global-symbol directive""... $ac_c" 1>&6
-echo "configure:2599: checking for assembler global-symbol directive" >&5
+echo "configure:2601: checking for assembler global-symbol directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_global_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2625,7 +2627,7 @@
 fi
 
 echo $ac_n "checking for .set assembler directive""... $ac_c" 1>&6
-echo "configure:2629: checking for .set assembler directive" >&5
+echo "configure:2631: checking for .set assembler directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_set_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2659,7 +2661,7 @@
 fi
 
 echo $ac_n "checking for assembler .type directive prefix""... $ac_c" 1>&6
-echo "configure:2663: checking for assembler .type directive prefix" >&5
+echo "configure:2665: checking for assembler .type directive prefix" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_type_prefix'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2690,8 +2692,9 @@
 fi
 
 # The Aix ld uses global .symbol_names instead of symbol_names.
-case "$os" in
-aix4.3*)
+# Unfortunately also used in the PPC64 ELF ABI.
+case "${os}${machine}" in
+aix4.3* | linux*powerpc/powerpc64*)
   cat >> confdefs.h <<\EOF
 #define HAVE_ASM_GLOBAL_DOT_NAME 1
 EOF
@@ -2699,7 +2702,7 @@
 esac
 
 echo $ac_n "checking for .symver assembler directive""... $ac_c" 1>&6
-echo "configure:2703: checking for .symver assembler directive" >&5
+echo "configure:2706: checking for .symver assembler directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_symver_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2718,7 +2721,7 @@
 
 echo "$ac_t""$libc_cv_asm_symver_directive" 1>&6
 echo $ac_n "checking for ld --version-script""... $ac_c" 1>&6
-echo "configure:2722: checking for ld --version-script" >&5
+echo "configure:2725: checking for ld --version-script" >&5
 if eval "test \"`echo '$''{'libc_cv_ld_version_script_option'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2741,7 +2744,7 @@
     if { ac_try='${CC-cc} $CFLAGS -shared -o conftest.so conftest.o
 					-nostartfiles -nostdlib
 					-Wl,--version-script,conftest.map
-		       1>&5'; { (eval echo configure:2745: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; };
+		       1>&5'; { (eval echo configure:2748: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; };
     then
       libc_cv_ld_version_script_option=yes
     else
@@ -2780,7 +2783,7 @@
 fi
 if test $elf = yes; then
   echo $ac_n "checking for .previous assembler directive""... $ac_c" 1>&6
-echo "configure:2784: checking for .previous assembler directive" >&5
+echo "configure:2787: checking for .previous assembler directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_previous_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2788,7 +2791,7 @@
 .section foo_section
 .previous
 EOF
-  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:2792: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:2795: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
     libc_cv_asm_previous_directive=yes
   else
     libc_cv_asm_previous_directive=no
@@ -2804,7 +2807,7 @@
 
   else
     echo $ac_n "checking for .popsection assembler directive""... $ac_c" 1>&6
-echo "configure:2808: checking for .popsection assembler directive" >&5
+echo "configure:2811: checking for .popsection assembler directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_popsection_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2812,7 +2815,7 @@
 .pushsection foo_section
 .popsection
 EOF
-    if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:2816: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+    if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:2819: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
       libc_cv_asm_popsection_directive=yes
     else
       libc_cv_asm_popsection_directive=no
@@ -2829,7 +2832,7 @@
     fi
   fi
   echo $ac_n "checking for .protected and .hidden assembler directive""... $ac_c" 1>&6
-echo "configure:2833: checking for .protected and .hidden assembler directive" >&5
+echo "configure:2836: checking for .protected and .hidden assembler directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_protected_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2839,7 +2842,7 @@
 .hidden bar
 bar:
 EOF
-  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:2843: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:2846: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
     libc_cv_asm_protected_directive=yes
   else
     libc_cv_asm_protected_directive=no
@@ -2860,7 +2863,7 @@
 
   if test $libc_cv_asm_protected_directive = yes; then
     echo $ac_n "checking whether __attribute__((visibility())) is supported""... $ac_c" 1>&6
-echo "configure:2864: checking whether __attribute__((visibility())) is supported" >&5
+echo "configure:2867: checking whether __attribute__((visibility())) is supported" >&5
 if eval "test \"`echo '$''{'libc_cv_visibility_attribute'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2891,7 +2894,7 @@
 
   if test $libc_cv_visibility_attribute = yes; then
     echo $ac_n "checking for broken __attribute__((visibility()))""... $ac_c" 1>&6
-echo "configure:2895: checking for broken __attribute__((visibility()))" >&5
+echo "configure:2898: checking for broken __attribute__((visibility()))" >&5
 if eval "test \"`echo '$''{'libc_cv_broken_visibility_attribute'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2920,7 +2923,7 @@
   fi
 
   echo $ac_n "checking for broken __attribute__((alias()))""... $ac_c" 1>&6
-echo "configure:2924: checking for broken __attribute__((alias()))" >&5
+echo "configure:2927: checking for broken __attribute__((alias()))" >&5
 if eval "test \"`echo '$''{'libc_cv_broken_alias_attribute'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2953,7 +2956,7 @@
 
   if test $libc_cv_visibility_attribute = yes -a $gnu_ld = yes; then
     echo $ac_n "checking whether to put _rtld_local into .sdata section""... $ac_c" 1>&6
-echo "configure:2957: checking whether to put _rtld_local into .sdata section" >&5
+echo "configure:2960: checking whether to put _rtld_local into .sdata section" >&5
 if eval "test \"`echo '$''{'libc_cv_have_sdata_section'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2977,7 +2980,7 @@
   fi
 
   echo $ac_n "checking for .preinit_array/.init_array/.fini_array support""... $ac_c" 1>&6
-echo "configure:2981: checking for .preinit_array/.init_array/.fini_array support" >&5
+echo "configure:2984: checking for .preinit_array/.init_array/.fini_array support" >&5
 if eval "test \"`echo '$''{'libc_cv_initfinit_array'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2988,7 +2991,7 @@
 int (*fp) (void) __attribute__ ((section (".init_array"))) = foo;
 EOF
   if { ac_try='${CC-cc} -o conftest conftest.c
-		     -static -nostartfiles -nostdlib 1>&5'; { (eval echo configure:2992: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
+		     -static -nostartfiles -nostdlib 1>&5'; { (eval echo configure:2995: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
   then
     if readelf -S conftest | fgrep INIT_ARRAY > /dev/null; then
       libc_cv_initfinit_array=yes
@@ -3011,7 +3014,7 @@
   fi
 
   echo $ac_n "checking for -z nodelete option""... $ac_c" 1>&6
-echo "configure:3015: checking for -z nodelete option" >&5
+echo "configure:3018: checking for -z nodelete option" >&5
 if eval "test \"`echo '$''{'libc_cv_z_nodelete'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3020,7 +3023,7 @@
 EOF
   if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
 		     -nostartfiles -nostdlib
-		     -Wl,--enable-new-dtags,-z,nodelete 1>&5'; { (eval echo configure:3024: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
+		     -Wl,--enable-new-dtags,-z,nodelete 1>&5'; { (eval echo configure:3027: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
   then
     libc_cv_z_nodelete=yes
   else
@@ -3033,7 +3036,7 @@
   
 
   echo $ac_n "checking for -z nodlopen option""... $ac_c" 1>&6
-echo "configure:3037: checking for -z nodlopen option" >&5
+echo "configure:3040: checking for -z nodlopen option" >&5
 if eval "test \"`echo '$''{'libc_cv_z_nodlopen'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3042,7 +3045,7 @@
 EOF
   if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
 			-nostartfiles -nostdlib
-			-Wl,--enable-new-dtags,-z,nodlopen 1>&5'; { (eval echo configure:3046: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
+			-Wl,--enable-new-dtags,-z,nodlopen 1>&5'; { (eval echo configure:3049: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
   then
     libc_cv_z_nodlopen=yes
   else
@@ -3055,7 +3058,7 @@
   
 
   echo $ac_n "checking for -z initfirst option""... $ac_c" 1>&6
-echo "configure:3059: checking for -z initfirst option" >&5
+echo "configure:3062: checking for -z initfirst option" >&5
 if eval "test \"`echo '$''{'libc_cv_z_initfirst'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3064,7 +3067,7 @@
 EOF
   if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
 			-nostartfiles -nostdlib
-			-Wl,--enable-new-dtags,-z,initfirst 1>&5'; { (eval echo configure:3068: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
+			-Wl,--enable-new-dtags,-z,initfirst 1>&5'; { (eval echo configure:3071: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
   then
     libc_cv_z_initfirst=yes
   else
@@ -3077,14 +3080,14 @@
   
 
   echo $ac_n "checking for -Bgroup option""... $ac_c" 1>&6
-echo "configure:3081: checking for -Bgroup option" >&5
+echo "configure:3084: checking for -Bgroup option" >&5
 if eval "test \"`echo '$''{'libc_cv_Bgroup'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
     cat > conftest.c <<EOF
 int _start (void) { return 42; }
 EOF
-  if { ac_try='${CC-cc} -shared -o conftest.so conftest.c -Wl,-Bgroup -nostdlib 1>&5'; { (eval echo configure:3088: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
+  if { ac_try='${CC-cc} -shared -o conftest.so conftest.c -Wl,-Bgroup -nostdlib 1>&5'; { (eval echo configure:3091: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
   then
     libc_cv_Bgroup=yes
   else
@@ -3097,7 +3100,7 @@
   
 
   echo $ac_n "checking for -z combreloc""... $ac_c" 1>&6
-echo "configure:3101: checking for -z combreloc" >&5
+echo "configure:3104: checking for -z combreloc" >&5
 if eval "test \"`echo '$''{'libc_cv_z_combreloc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3108,7 +3111,7 @@
 EOF
   if { ac_try='${CC-cc} -shared -o conftest.so conftest.c
 			-nostdlib -nostartfiles
-			-Wl,-z,combreloc 1>&5'; { (eval echo configure:3112: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
+			-Wl,-z,combreloc 1>&5'; { (eval echo configure:3115: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }
   then
     if readelf -S conftest.so | grep '\.rel\(a\|\)\.dyn' > /dev/null; then
       libc_cv_z_combreloc=yes
@@ -3133,12 +3136,12 @@
 
 if test $elf != yes; then
   echo $ac_n "checking for .init and .fini sections""... $ac_c" 1>&6
-echo "configure:3137: checking for .init and .fini sections" >&5
+echo "configure:3140: checking for .init and .fini sections" >&5
 if eval "test \"`echo '$''{'libc_cv_have_initfini'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3142 "configure"
+#line 3145 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -3147,7 +3150,7 @@
 				    asm ("${libc_cv_dot_text}");
 ; return 0; }
 EOF
-if { (eval echo configure:3151: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3154: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   libc_cv_have_initfini=yes
 else
@@ -3170,7 +3173,7 @@
 
 if test $elf = yes -a $gnu_ld = yes; then
   echo $ac_n "checking whether cc puts quotes around section names""... $ac_c" 1>&6
-echo "configure:3174: checking whether cc puts quotes around section names" >&5
+echo "configure:3177: checking whether cc puts quotes around section names" >&5
 if eval "test \"`echo '$''{'libc_cv_have_section_quotes'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3207,19 +3210,19 @@
 else
   if test $ac_cv_prog_cc_works = yes; then
     echo $ac_n "checking for _ prefix on C symbol names""... $ac_c" 1>&6
-echo "configure:3211: checking for _ prefix on C symbol names" >&5
+echo "configure:3214: checking for _ prefix on C symbol names" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_underscores'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3216 "configure"
+#line 3219 "configure"
 #include "confdefs.h"
 asm ("_glibc_foobar:");
 int main() {
 glibc_foobar ();
 ; return 0; }
 EOF
-if { (eval echo configure:3223: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3226: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   libc_cv_asm_underscores=yes
 else
@@ -3234,17 +3237,17 @@
 echo "$ac_t""$libc_cv_asm_underscores" 1>&6
   else
     echo $ac_n "checking for _ prefix on C symbol names""... $ac_c" 1>&6
-echo "configure:3238: checking for _ prefix on C symbol names" >&5
+echo "configure:3241: checking for _ prefix on C symbol names" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_underscores'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3243 "configure"
+#line 3246 "configure"
 #include "confdefs.h"
 void underscore_test(void) {
 return; }
 EOF
-if { (eval echo configure:3248: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3251: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   if grep _underscore_test conftest* >/dev/null; then
     rm -f conftest*
     libc_cv_asm_underscores=yes
@@ -3276,7 +3279,7 @@
 fi
 
 echo $ac_n "checking for assembler .weak directive""... $ac_c" 1>&6
-echo "configure:3280: checking for assembler .weak directive" >&5
+echo "configure:3283: checking for assembler .weak directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_weak_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3299,7 +3302,7 @@
 
 if test $libc_cv_asm_weak_directive = no; then
   echo $ac_n "checking for assembler .weakext directive""... $ac_c" 1>&6
-echo "configure:3303: checking for assembler .weakext directive" >&5
+echo "configure:3306: checking for assembler .weakext directive" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_weakext_directive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3346,14 +3349,14 @@
     ;;
   hppa*linux*)
   echo $ac_n "checking for assembler line separator""... $ac_c" 1>&6
-echo "configure:3350: checking for assembler line separator" >&5
+echo "configure:3353: checking for assembler line separator" >&5
 if eval "test \"`echo '$''{'libc_cv_asm_line_sep'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
     cat > conftest.s <<EOF
  nop ; is_old_puffin
 EOF
-  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:3357: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+  if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'; { (eval echo configure:3360: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
     libc_cv_asm_line_sep='!'
   else
     if test -z "$enable_hacker_mode"; then
@@ -3375,7 +3378,7 @@
 esac
 
 echo $ac_n "checking for ld --no-whole-archive""... $ac_c" 1>&6
-echo "configure:3379: checking for ld --no-whole-archive" >&5
+echo "configure:3382: checking for ld --no-whole-archive" >&5
 if eval "test \"`echo '$''{'libc_cv_ld_no_whole_archive'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3386,7 +3389,7 @@
 EOF
 if { ac_try='${CC-cc} $CFLAGS
 			    -nostdlib -nostartfiles -Wl,--no-whole-archive
-			    -o conftest conftest.c 1>&5'; { (eval echo configure:3390: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+			    -o conftest conftest.c 1>&5'; { (eval echo configure:3393: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
   libc_cv_ld_no_whole_archive=yes
 else
   libc_cv_ld_no_whole_archive=no
@@ -3400,7 +3403,7 @@
 fi
 
 echo $ac_n "checking for gcc -fexceptions""... $ac_c" 1>&6
-echo "configure:3404: checking for gcc -fexceptions" >&5
+echo "configure:3407: checking for gcc -fexceptions" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc_exceptions'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3411,7 +3414,7 @@
 EOF
 if { ac_try='${CC-cc} $CFLAGS
 			    -nostdlib -nostartfiles -fexceptions
-			    -o conftest conftest.c 1>&5'; { (eval echo configure:3415: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+			    -o conftest conftest.c 1>&5'; { (eval echo configure:3418: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
   libc_cv_gcc_exceptions=yes
 else
   libc_cv_gcc_exceptions=no
@@ -3426,14 +3429,14 @@
 
 if test "$base_machine" = alpha ; then
 echo $ac_n "checking for function ..ng prefix""... $ac_c" 1>&6
-echo "configure:3430: checking for function ..ng prefix" >&5
+echo "configure:3433: checking for function ..ng prefix" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc_alpha_ng_prefix'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.c <<\EOF
 foo () { }
 EOF
-if { ac_try='${CC-cc} -S conftest.c -o - | fgrep "\$foo..ng" > /dev/null'; { (eval echo configure:3437: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; };
+if { ac_try='${CC-cc} -S conftest.c -o - | fgrep "\$foo..ng" > /dev/null'; { (eval echo configure:3440: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; };
 then
   libc_cv_gcc_alpha_ng_prefix=yes
 else
@@ -3460,19 +3463,19 @@
 # Check for a bug present in at least versions 2.8.x of GCC
 # and versions 1.0.x of EGCS.
 echo $ac_n "checking whether clobbering cr0 causes problems""... $ac_c" 1>&6
-echo "configure:3464: checking whether clobbering cr0 causes problems" >&5
+echo "configure:3467: checking whether clobbering cr0 causes problems" >&5
 if eval "test \"`echo '$''{'libc_cv_c_asmcr0_bug'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3469 "configure"
+#line 3472 "configure"
 #include "confdefs.h"
 int tester(int x) { asm ("" : : : "cc"); return x & 123; }
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3476: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3479: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   libc_cv_c_asmcr0_bug='no'
 else
@@ -3494,12 +3497,12 @@
 fi
 
 echo $ac_n "checking for DWARF2 unwind info support""... $ac_c" 1>&6
-echo "configure:3498: checking for DWARF2 unwind info support" >&5
+echo "configure:3501: checking for DWARF2 unwind info support" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc_dwarf2_unwind_info'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.c <<EOF
-#line 3503 "configure"
+#line 3506 "configure"
 static char *__EH_FRAME_BEGIN__;
 _start ()
 {
@@ -3526,14 +3529,14 @@
 EOF
 if { ac_try='${CC-cc} $CFLAGS -DCHECK__register_frame_info
 			    -nostdlib -nostartfiles
-			    -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3530: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+			    -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3533: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
   libc_cv_gcc_dwarf2_unwind_info=static
 else
   libc_cv_gcc_dwarf2_unwind_info=no
 fi
 if { ac_try='${CC-cc} $CFLAGS -DCHECK__register_frame_info
                             -nostdlib -nostartfiles
-                            -o conftest conftest.c -lgcc -lgcc_eh >&5'; { (eval echo configure:3537: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+                            -o conftest conftest.c -lgcc -lgcc_eh >&5'; { (eval echo configure:3540: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
   if ${CC-cc} $CFLAGS -DCHECK__register_frame_info -nostdlib -nostartfiles \
      -o conftest conftest.c -lgcc -lgcc_eh -v 2>&1 >/dev/null \
      | grep -q -- --eh-frame-hdr; then
@@ -3547,7 +3550,7 @@
 if test $libc_cv_gcc_dwarf2_unwind_info = no; then
   if { ac_try='${CC-cc} $CFLAGS -DCHECK__register_frame
 			      -nostdlib -nostartfiles
-			      -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3551: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+			      -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3554: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
     libc_cv_gcc_dwarf2_unwind_info=yes
   else
     libc_cv_gcc_dwarf2_unwind_info=no
@@ -3577,12 +3580,12 @@
 esac
 
 echo $ac_n "checking for __builtin_expect""... $ac_c" 1>&6
-echo "configure:3581: checking for __builtin_expect" >&5
+echo "configure:3584: checking for __builtin_expect" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc_builtin_expect'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.c <<EOF
-#line 3586 "configure"
+#line 3589 "configure"
 int foo (int a)
 {
   a = __builtin_expect (a, 10);
@@ -3590,7 +3593,7 @@
 }
 EOF
 if { ac_try='${CC-cc} $CFLAGS -nostdlib -nostartfiles
-			    -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3594: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+			    -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3597: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
   libc_cv_gcc_builtin_expect=yes
 else
   libc_cv_gcc_builtin_expect=no
@@ -3607,7 +3610,7 @@
 fi
 
 echo $ac_n "checking for __builtin_memset""... $ac_c" 1>&6
-echo "configure:3611: checking for __builtin_memset" >&5
+echo "configure:3614: checking for __builtin_memset" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc_builtin_memset'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3617,7 +3620,7 @@
   __builtin_memset (x, 0, 1000);
 }
 EOF
-if { ac_try='${CC-cc} -O3 -S conftest.c -o - | fgrep "memset" > /dev/null'; { (eval echo configure:3621: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; };
+if { ac_try='${CC-cc} -O3 -S conftest.c -o - | fgrep "memset" > /dev/null'; { (eval echo configure:3624: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; };
 then
   libc_cv_gcc_builtin_memset=no
 else
@@ -3635,12 +3638,12 @@
 fi
 
 echo $ac_n "checking for local label subtraction""... $ac_c" 1>&6
-echo "configure:3639: checking for local label subtraction" >&5
+echo "configure:3642: checking for local label subtraction" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc_subtract_local_labels'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.c <<EOF
-#line 3644 "configure"
+#line 3647 "configure"
 int foo (int a)
 {
   static const int ar[] = { &&l1 - &&l1, &&l2 - &&l1 };
@@ -3653,7 +3656,7 @@
 }
 EOF
 if { ac_try='${CC-cc} $CFLAGS -nostdlib -nostartfiles
-			    -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3657: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+			    -o conftest conftest.c -lgcc >&5'; { (eval echo configure:3660: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
   libc_cv_gcc_subtract_local_labels=yes
 else
   libc_cv_gcc_subtract_local_labels=no
@@ -3670,14 +3673,14 @@
 fi
 
 echo $ac_n "checking for __thread""... $ac_c" 1>&6
-echo "configure:3674: checking for __thread" >&5
+echo "configure:3677: checking for __thread" >&5
 if eval "test \"`echo '$''{'libc_cv_gcc___thread'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.c <<EOF
 __thread int a = 42;
 EOF
-if { ac_try='${CC-cc} $CFLAGS -c conftest.c >&5'; { (eval echo configure:3681: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+if { ac_try='${CC-cc} $CFLAGS -c conftest.c >&5'; { (eval echo configure:3684: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
   libc_cv_gcc___thread=yes
 else
   libc_cv_gcc___thread=no
@@ -3695,7 +3698,7 @@
 
 
 echo $ac_n "checking for libgd""... $ac_c" 1>&6
-echo "configure:3699: checking for libgd" >&5
+echo "configure:3702: checking for libgd" >&5
 if test "$with_gd" != "no"; then
   old_CFLAGS="$CFLAGS"
   CFLAGS="$CFLAGS $libgd_include"
@@ -3704,14 +3707,14 @@
   old_LIBS="$LIBS"
   LIBS="$LIBS -lgd -lpng -lz -lm"
   cat > conftest.$ac_ext <<EOF
-#line 3708 "configure"
+#line 3711 "configure"
 #include "confdefs.h"
 #include <gd.h>
 int main() {
 gdImagePng (0, 0)
 ; return 0; }
 EOF
-if { (eval echo configure:3715: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3718: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBGD=yes
 else
@@ -3731,7 +3734,7 @@
 
 
 echo $ac_n "checking size of long double""... $ac_c" 1>&6
-echo "configure:3735: checking size of long double" >&5
+echo "configure:3738: checking size of long double" >&5
 if eval "test \"`echo '$''{'ac_cv_sizeof_long_double'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3739,7 +3742,7 @@
   ac_cv_sizeof_long_double=0
 else
   cat > conftest.$ac_ext <<EOF
-#line 3743 "configure"
+#line 3746 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main()
@@ -3750,7 +3753,7 @@
   return(0);
 }
 EOF
-if { (eval echo configure:3754: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:3757: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sizeof_long_double=`cat conftestval`
 else
@@ -3828,7 +3831,7 @@
   fi
 
   echo $ac_n "checking OS release for uname""... $ac_c" 1>&6
-echo "configure:3832: checking OS release for uname" >&5
+echo "configure:3835: checking OS release for uname" >&5
 if eval "test \"`echo '$''{'libc_cv_uname_release'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3850,7 +3853,7 @@
   uname_release="$libc_cv_uname_release"
 
   echo $ac_n "checking OS version for uname""... $ac_c" 1>&6
-echo "configure:3854: checking OS version for uname" >&5
+echo "configure:3857: checking OS version for uname" >&5
 if eval "test \"`echo '$''{'libc_cv_uname_version'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3879,7 +3882,7 @@
 # Test for old glibc 2.0.x headers so that they can be removed properly
 # Search only in includedir.
 echo $ac_n "checking for old glibc 2.0.x headers""... $ac_c" 1>&6
-echo "configure:3883: checking for old glibc 2.0.x headers" >&5
+echo "configure:3886: checking for old glibc 2.0.x headers" >&5
 if eval test -f "${includedir}/elfclass.h" -a -f "${includedir}/fcntlbits.h"
 then
   old_glibc_headers=yes
@@ -3940,7 +3943,7 @@
 fi
 
 echo $ac_n "checking whether -fPIC is default""... $ac_c" 1>&6
-echo "configure:3944: checking whether -fPIC is default" >&5
+echo "configure:3947: checking whether -fPIC is default" >&5
 if eval "test \"`echo '$''{'pic_default'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/configure.in ../glibc-2.3/configure.in
--- glibc-2.2.93/configure.in	Wed Aug 28 07:31:04 2002
+++ ../glibc-2.3/configure.in	Thu Sep  5 19:27:47 2002
@@ -313,6 +313,8 @@
 m88k)		base_machine=m88k machine=m88k/m88100 ;;
 mips64*)	base_machine=mips64 machine=mips/mips64/$machine ;;
 mips*)		base_machine=mips machine=mips/$machine ;;
+powerpc)	base_machine=powerpc machine=powerpc/powerpc32 ;;
+powerpc64)	base_machine=powerpc machine=powerpc/powerpc64 ;;
 s390)           base_machine=s390 machine=s390/s390-32 ;;
 s390x)          base_machine=s390 machine=s390/s390-64 ;;
 sh3*)		base_machine=sh machine=sh/sh3 ;;
@@ -895,8 +897,9 @@
 fi
 
 # The Aix ld uses global .symbol_names instead of symbol_names.
-case "$os" in
-aix4.3*)
+# Unfortunately also used in the PPC64 ELF ABI.
+case "${os}${machine}" in
+aix4.3* | linux*powerpc/powerpc64*)
   AC_DEFINE(HAVE_ASM_GLOBAL_DOT_NAME)
 esac
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/csu/gmon-start.c ../glibc-2.3/csu/gmon-start.c
--- glibc-2.2.93/csu/gmon-start.c	Wed Feb 13 04:16:36 2002
+++ ../glibc-2.3/csu/gmon-start.c	Sat Sep 14 09:40:46 2002
@@ -35,6 +35,14 @@
 #endif
 extern void etext;
 
+#ifndef TEXT_START
+#ifdef ENTRY_POINT_DECL
+#define TEXT_START ENTRY_POINT
+#else
+#define TEXT_START &ENTRY_POINT
+#endif
+#endif
+
 #ifndef HAVE_INITFINI
 /* This function gets called at startup by the normal constructor
    mechanism.  We link this file together with start.o to produce gcrt1.o,
@@ -66,7 +74,7 @@
 #ifdef ENTRY_POINT_DECL
   __monstartup ((u_long) ENTRY_POINT, (u_long) &etext);
 #else
-  __monstartup ((u_long) &ENTRY_POINT, (u_long) &etext);
+  __monstartup ((u_long) TEXT_START, (u_long) &etext);
 #endif
 
   /* Call _mcleanup before exiting; it will write out gmon.out from the
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/ctype/ctype-info.c ../glibc-2.3/ctype/ctype-info.c
--- glibc-2.2.93/ctype/ctype-info.c	Mon Sep  2 14:48:00 2002
+++ ../glibc-2.3/ctype/ctype-info.c	Thu Sep  5 19:27:47 2002
@@ -48,18 +48,18 @@
 
 #define b(t,x,o) (((const t *) _nl_C_LC_CTYPE_##x) + o)
 
-const unsigned short int *__ctype_old_b = b (unsigned short int, class, 128);
-const __uint32_t *__ctype32_old_b = b (__uint32_t, class32, 0);
-const __int32_t *__ctype_old_tolower = b (__int32_t, tolower, 128);
-const __int32_t *__ctype_old_toupper = b (__int32_t, toupper, 128);
-const __uint32_t *__ctype32_old_tolower = b (__uint32_t, tolower, 128);
-const __uint32_t *__ctype32_old_toupper = b (__uint32_t, toupper, 128);
+const unsigned short int *__ctype_b = b (unsigned short int, class, 128);
+const __uint32_t *__ctype32_b = b (__uint32_t, class32, 0);
+const __int32_t *__ctype_tolower = b (__int32_t, tolower, 128);
+const __int32_t *__ctype_toupper = b (__int32_t, toupper, 128);
+const __uint32_t *__ctype32_tolower = b (__uint32_t, tolower, 128);
+const __uint32_t *__ctype32_toupper = b (__uint32_t, toupper, 128);
 
-compat_symbol (libc, __ctype_old_b, __ctype_b, GLIBC_2_0);
-compat_symbol (libc, __ctype_old_tolower, __ctype_tolower, GLIBC_2_0);
-compat_symbol (libc, __ctype_old_toupper, __ctype_toupper, GLIBC_2_0);
-compat_symbol (libc, __ctype32_old_b, __ctype32_b, GLIBC_2_0);
-compat_symbol (libc, __ctype32_old_tolower, __ctype32_tolower, GLIBC_2_2);
-compat_symbol (libc, __ctype32_old_toupper, __ctype32_toupper, GLIBC_2_2);
+compat_symbol (libc, __ctype_b, __ctype_b, GLIBC_2_0);
+compat_symbol (libc, __ctype_tolower, __ctype_tolower, GLIBC_2_0);
+compat_symbol (libc, __ctype_toupper, __ctype_toupper, GLIBC_2_0);
+compat_symbol (libc, __ctype32_b, __ctype32_b, GLIBC_2_0);
+compat_symbol (libc, __ctype32_tolower, __ctype32_tolower, GLIBC_2_2);
+compat_symbol (libc, __ctype32_toupper, __ctype32_toupper, GLIBC_2_2);
 
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/diff.txt ../glibc-2.3/diff.txt
--- glibc-2.2.93/diff.txt	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/diff.txt	Tue Sep  3 08:41:46 2002
@@ -0,0 +1,72 @@
+? diff.txt
+? output.txt
+Index: include/sys/stat.h
+===================================================================
+RCS file: /cvs/glibc/libc/include/sys/stat.h,v
+retrieving revision 1.13
+diff -u -p -r1.13 stat.h
+--- include/sys/stat.h	13 Aug 2002 00:23:12 -0000	1.13
++++ include/sys/stat.h	3 Sep 2002 12:41:22 -0000
+@@ -13,11 +13,9 @@ extern int __mknod (__const char *__path
+ 		    __mode_t __mode, __dev_t __dev);
+ #if !defined NOT_IN_libc || defined IS_IN_rtld
+ hidden_proto (__fxstat)
+-hidden_proto (__fxstat64)
+ hidden_proto (__lxstat)
+ hidden_proto (__lxstat64)
+ hidden_proto (__xstat)
+-hidden_proto (__xstat64)
+ #endif
+ extern __inline__ int __stat (__const char *__path, struct stat *__statbuf)
+ {
+Index: sysdeps/mach/hurd/dl-sysdep.c
+===================================================================
+RCS file: /cvs/glibc/libc/sysdeps/mach/hurd/dl-sysdep.c,v
+retrieving revision 1.72
+diff -u -p -r1.72 dl-sysdep.c
+--- sysdeps/mach/hurd/dl-sysdep.c	30 Aug 2002 01:31:00 -0000	1.72
++++ sysdeps/mach/hurd/dl-sysdep.c	3 Sep 2002 12:41:37 -0000
+@@ -513,7 +513,6 @@ __fxstat64 (int vers, int fd, struct sta
+ 
+   return 0;
+ }
+-libc_hidden_def (__fxstat64)
+ 
+ int weak_function
+ __xstat64 (int vers, const char *file, struct stat64 *buf)
+@@ -531,7 +530,6 @@ __xstat64 (int vers, const char *file, s
+ 
+   return 0;
+ }
+-libc_hidden_def (__xstat64)
+ 
+ /* This function is called by the dynamic linker (rtld.c) to check
+    whether debugging malloc is allowed even for SUID binaries.  This
+Index: sysdeps/mach/hurd/fxstat64.c
+===================================================================
+RCS file: /cvs/glibc/libc/sysdeps/mach/hurd/fxstat64.c,v
+retrieving revision 1.5
+diff -u -p -r1.5 fxstat64.c
+--- sysdeps/mach/hurd/fxstat64.c	13 Aug 2002 00:23:10 -0000	1.5
++++ sysdeps/mach/hurd/fxstat64.c	3 Sep 2002 12:41:37 -0000
+@@ -38,6 +38,5 @@ __fxstat64 (int vers, int fd, struct sta
+ 
+   return 0;
+ }
+-hidden_def (__fxstat64)
+ 
+ #endif
+Index: sysdeps/mach/hurd/xstat64.c
+===================================================================
+RCS file: /cvs/glibc/libc/sysdeps/mach/hurd/xstat64.c,v
+retrieving revision 1.4
+diff -u -p -r1.4 xstat64.c
+--- sysdeps/mach/hurd/xstat64.c	13 Aug 2002 00:23:10 -0000	1.4
++++ sysdeps/mach/hurd/xstat64.c	3 Sep 2002 12:41:38 -0000
+@@ -42,6 +42,5 @@ __xstat64 (int vers, const char *file, s
+     return __hurd_fail (err);
+   return 0;
+ }
+-hidden_def (__xstat64)
+ 
+ #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/elf/cache.c ../glibc-2.3/elf/cache.c
--- glibc-2.2.93/elf/cache.c	Mon Apr  8 14:43:35 2002
+++ ../glibc-2.3/elf/cache.c	Sat Sep 14 09:40:46 2002
@@ -71,24 +71,21 @@
     }
   switch (flag & FLAG_REQUIRED_MASK)
     {
-#ifdef __sparc__
     case FLAG_SPARC_LIB64:
       fputs (",64bit", stdout);
-#endif
-#if defined __ia64__ || defined __i386__
+      break;
     case FLAG_IA64_LIB64:
       fputs (",IA-64", stdout);
       break;
-#endif
-#if defined __x86_64__ || defined __i386__
     case FLAG_X8664_LIB64:
       fputs (",x86-64", stdout);
       break;
-#endif
-#if defined __s390__ || defined __s390x__
     case FLAG_S390_LIB64:
       fputs(",64bit", stdout);
-#endif
+      break;
+    case FLAG_POWERPC_LIB64:
+      fputs(",64bit", stdout);
+      break;
     case 0:
       break;
     default:
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/elf/dl-error.c ../glibc-2.3/elf/dl-error.c
--- glibc-2.2.93/elf/dl-error.c	Sun Jun 30 04:55:44 2002
+++ ../glibc-2.3/elf/dl-error.c	Sat Sep 14 09:40:46 2002
@@ -119,7 +119,8 @@
 _dl_signal_cerror (int errcode, const char *objname, const char *occation,
 		   const char *errstring)
 {
-  if (__builtin_expect (GL(dl_debug_mask), 0))
+  if (__builtin_expect (GL(dl_debug_mask)
+			& ~(DL_DEBUG_STATISTICS|DL_DEBUG_PRELINK), 0))
     INTUSE(_dl_debug_printf) ("%s: error: %s: %s (%s)\n", objname, occation,
 			      errstring, receiver ? "continued" : "fatal");
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/elf/dl-load.c ../glibc-2.3/elf/dl-load.c
--- glibc-2.2.93/elf/dl-load.c	Sun Aug 25 16:50:15 2002
+++ ../glibc-2.3/elf/dl-load.c	Sat Sep 14 09:40:46 2002
@@ -1131,7 +1131,7 @@
 #ifdef USE_TLS
     /* Adjust the address of the TLS initialization image.  */
     if (l->l_tls_initimage != NULL)
-      l->l_tls_initimage = (char *) l->l_tls_initimage + l->l_map_start;
+      l->l_tls_initimage = (char *) l->l_tls_initimage + l->l_addr;
 #endif
 
   /* We are done mapping in the file.  We no longer need the descriptor.  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/elf/elf.h ../glibc-2.3/elf/elf.h
--- glibc-2.2.93/elf/elf.h	Thu May 30 18:16:24 2002
+++ ../glibc-2.3/elf/elf.h	Sat Sep 14 09:40:46 2002
@@ -656,8 +656,8 @@
 #define DT_PREINIT_ARRAY 32		/* Array with addresses of preinit fct*/
 #define DT_PREINIT_ARRAYSZ 33		/* size in bytes of DT_PREINIT_ARRAY */
 #define	DT_NUM		34		/* Number used */
-#define DT_LOOS		0x60000000	/* Start of OS-specific */
-#define DT_HIOS		0x6fffffff	/* End of OS-specific */
+#define DT_LOOS		0x6000000d	/* Start of OS-specific */
+#define DT_HIOS		0x6ffff000	/* End of OS-specific */
 #define DT_LOPROC	0x70000000	/* Start of processor-specific */
 #define DT_HIPROC	0x7fffffff	/* End of processor-specific */
 #define	DT_PROCNUM	DT_MIPS_NUM	/* Most used by any processor */
@@ -1871,6 +1871,78 @@
 /* Keep this the last entry.  */
 #define R_PPC_NUM		37
 
+/* PowerPC64 relocations defined by the ABIs */
+#define R_PPC64_NONE    R_PPC_NONE
+#define R_PPC64_ADDR32  R_PPC_ADDR32  /* 32bit absolute address.  */
+#define R_PPC64_ADDR24  R_PPC_ADDR24  /* 26bit address, word aligned.  */
+#define R_PPC64_ADDR16  R_PPC_ADDR16  /* 16bit absolute address. */
+#define R_PPC64_ADDR16_LO R_PPC_ADDR16_LO /* lower 16bits of abs. address.  */
+#define R_PPC64_ADDR16_HI R_PPC_ADDR16_HI /* high 16bits of abs. address. */
+#define R_PPC64_ADDR16_HA R_PPC_ADDR16_HA /* adjusted high 16bits.  */
+#define R_PPC64_ADDR14 R_PPC_ADDR14   /* 16bit address, word aligned.  */
+#define R_PPC64_ADDR14_BRTAKEN  R_PPC_ADDR14_BRTAKEN
+#define R_PPC64_ADDR14_BRNTAKEN R_PPC_ADDR14_BRNTAKEN
+#define R_PPC64_REL24   R_PPC_REL24 /* PC relative 26 bit, word aligned.  */
+#define R_PPC64_REL14   R_PPC_REL14 /* PC relative 16 bit. */
+#define R_PPC64_REL14_BRTAKEN   R_PPC_REL14_BRTAKEN
+#define R_PPC64_REL14_BRNTAKEN  R_PPC_REL14_BRNTAKEN
+#define R_PPC64_GOT16     R_PPC_GOT16
+#define R_PPC64_GOT16_LO  R_PPC_GOT16_LO
+#define R_PPC64_GOT16_HI  R_PPC_GOT16_HI
+#define R_PPC64_GOT16_HA  R_PPC_GOT16_HA
+
+#define R_PPC64_COPY      R_PPC_COPY
+#define R_PPC64_GLOB_DAT  R_PPC_GLOB_DAT
+#define R_PPC64_JMP_SLOT  R_PPC_JMP_SLOT
+#define R_PPC64_RELATIVE  R_PPC_RELATIVE
+
+#define R_PPC64_UADDR32   R_PPC_UADDR32
+#define R_PPC64_UADDR16   R_PPC_UADDR16
+#define R_PPC64_REL32     R_PPC_REL32
+#define R_PPC64_PLT32     R_PPC_PLT32
+#define R_PPC64_PLTREL32  R_PPC_PLTREL32
+#define R_PPC64_PLT16_LO  R_PPC_PLT16_LO
+#define R_PPC64_PLT16_HI  R_PPC_PLT16_HI
+#define R_PPC64_PLT16_HA  R_PPC_PLT16_HA
+
+#define R_PPC64_SECTOFF     R_PPC_SECTOFF
+#define R_PPC64_SECTOFF_LO  R_PPC_SECTOFF_LO
+#define R_PPC64_SECTOFF_HI  R_PPC_SECTOFF_HI
+#define R_PPC64_SECTOFF_HA  R_PPC_SECTOFF_HA
+#define R_PPC64_ADDR30          37  /* word30 (S + A - P) >> 2.  */
+#define R_PPC64_ADDR64          38  /* doubleword64 S + A.  */
+#define R_PPC64_ADDR16_HIGHER   39  /* half16 #higher(S + A).  */
+#define R_PPC64_ADDR16_HIGHERA  40  /* half16 #highera(S + A).  */
+#define R_PPC64_ADDR16_HIGHEST  41  /* half16 #highest(S + A).  */
+#define R_PPC64_ADDR16_HIGHESTA 42  /* half16 #highesta(S + A). */
+#define R_PPC64_UADDR64     43  /* doubleword64 S + A.  */
+#define R_PPC64_REL64       44  /* doubleword64 S + A - P.  */
+#define R_PPC64_PLT64       45  /* doubleword64 L + A.  */
+#define R_PPC64_PLTREL64    46  /* doubleword64 L + A - P.  */
+#define R_PPC64_TOC16       47  /* half16* S + A - .TOC.  */
+#define R_PPC64_TOC16_LO    48  /* half16 #lo(S + A - .TOC.).  */
+#define R_PPC64_TOC16_HI    49  /* half16 #hi(S + A - .TOC.).  */
+#define R_PPC64_TOC16_HA    50  /* half16 #ha(S + A - .TOC.).  */
+#define R_PPC64_TOC         51  /* doubleword64 .TOC. */
+#define R_PPC64_PLTGOT16    52  /* half16* M + A.  */
+#define R_PPC64_PLTGOT16_LO 53  /* half16 #lo(M + A).  */
+#define R_PPC64_PLTGOT16_HI 54  /* half16 #hi(M + A).  */
+#define R_PPC64_PLTGOT16_HA 55  /* half16 #ha(M + A).  */
+
+#define R_PPC64_ADDR16_DS      56 /* half16ds* (S + A) >> 2.  */
+#define R_PPC64_ADDR16_LO_DS   57 /* half16ds  #lo(S + A) >> 2.  */
+#define R_PPC64_GOT16_DS       58 /* half16ds* (G + A) >> 2.  */
+#define R_PPC64_GOT16_LO_DS    59 /* half16ds  #lo(G + A) >> 2.  */
+#define R_PPC64_PLT16_LO_DS    60 /* half16ds  #lo(L + A) >> 2.  */
+#define R_PPC64_SECTOFF_DS     61 /* half16ds* (R + A) >> 2.  */
+#define R_PPC64_SECTOFF_LO_DS  62 /* half16ds  #lo(R + A) >> 2.  */
+#define R_PPC64_TOC16_DS       63 /* half16ds* (S + A - .TOC.) >> 2.  */
+#define R_PPC64_TOC16_LO_DS    64 /* half16ds  #lo(S + A - .TOC.) >> 2.  */
+#define R_PPC64_PLTGOT16_DS    65 /* half16ds* (M + A) >> 2.  */
+#define R_PPC64_PLTGOT16_LO_DS 66 /* half16ds  #lo(M + A) >> 2.  */
+/* Keep this the last entry.  */
+#define R_PPC64_NUM		67
+
 /* The remaining relocs are from the Embedded ELF ABI, and are not
    in the SVR4 ELF ABI.  */
 #define R_PPC_EMB_NADDR32	101
@@ -1902,6 +1974,9 @@
    that may still be in object files.  */
 #define R_PPC_TOC16		255
 
+/* PowerPC64 specific values for the Dyn d_tag field.  */
+#define DT_PPC64_GLINK  (DT_LOPROC + 0)
+#define DT_PPC64_NUM    1
 
 /* ARM specific declarations */
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/elf/readlib.c ../glibc-2.3/elf/readlib.c
--- glibc-2.2.93/elf/readlib.c	Sun Aug 25 00:11:23 2002
+++ ../glibc-2.3/elf/readlib.c	Thu Sep  5 19:27:47 2002
@@ -123,7 +123,10 @@
   /* First check if this is an aout file.  */
   aout_header = (struct exec *) file_contents;
   if (N_MAGIC (*aout_header) == ZMAGIC
-      || N_MAGIC (*aout_header) == QMAGIC)
+#ifdef QMAGIC			/* Linuxism.  */
+      || N_MAGIC (*aout_header) == QMAGIC
+#endif
+      )
     {
       /* Aout files don't have a soname, just return the name
          including the major number.  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/elf/rtld.c ../glibc-2.3/elf/rtld.c
--- glibc-2.2.93/elf/rtld.c	Mon Sep  2 17:08:11 2002
+++ ../glibc-2.3/elf/rtld.c	Sat Sep 14 09:40:46 2002
@@ -150,6 +150,11 @@
 				   struct link_map *bootstrap_map_p);
 #endif
 
+/* These defined magically in the linker script.  */
+extern char _begin[] attribute_hidden;
+extern char _end[] attribute_hidden;
+
+
 #ifdef RTLD_START
 RTLD_START
 #else
@@ -180,8 +185,6 @@
 #endif
 {
   ElfW(Addr) start_addr;
-  extern char _begin[] attribute_hidden;
-  extern char _end[] attribute_hidden;
 
   if (HP_TIMING_AVAIL)
     {
@@ -313,9 +316,17 @@
   bootstrap_map.l_tls_modid = 0;
 # endif
 
-  /* Get the dynamic linkers program header.  */
+  /* Get the dynamic linker's own program header.  First we need the ELF
+     file header.  The `_begin' symbol created by the linker script points
+     to it.  When we have something like GOTOFF relocs, we can use a plain
+     reference to find the runtime address.  Without that, we have to rely
+     on the `l_addr' value, which is not the value we want when prelinked.  */
+#ifdef DONT_USE_BOOTSTRAP_MAP
+  ehdr = (ElfW(Ehdr) *) &_begin;
+#else
   ehdr = (ElfW(Ehdr) *) bootstrap_map.l_addr;
-  phdr = (ElfW(Phdr) *) (bootstrap_map.l_addr + ehdr->e_phoff);
+#endif
+  phdr = (ElfW(Phdr) *) ((ElfW(Addr)) ehdr + ehdr->e_phoff);
   for (cnt = 0; cnt < ehdr->e_phnum; ++cnt)
     if (phdr[cnt].p_type == PT_TLS)
       {
@@ -832,6 +843,13 @@
 	break;
 #endif
       }
+#ifdef USE_TLS
+    /* Adjust the address of the TLS initialization image in case
+       the executable is actually an ET_DYN object.  */
+    if (GL(dl_loaded)->l_tls_initimage != NULL)
+      GL(dl_loaded)->l_tls_initimage
+	= (char *) GL(dl_loaded)->l_tls_initimage + GL(dl_loaded)->l_addr;
+#endif
   if (! GL(dl_loaded)->l_map_end)
     GL(dl_loaded)->l_map_end = ~0;
   if (! GL(dl_rtld_map).l_libname && GL(dl_rtld_map).l_name)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/iconvdata/testdata/IBM1160.~1~ ../glibc-2.3/iconvdata/testdata/IBM1160.~1~
--- glibc-2.2.93/iconvdata/testdata/IBM1160.~1~	Thu Sep 20 01:06:15 2001
+++ ../glibc-2.3/iconvdata/testdata/IBM1160.~1~	Wed Dec 31 19:00:00 1969
@@ -1,14 +0,0 @@
-  ! " # $ % & ' ( ) * + , - . / 0 
-1 2 3 4 5 6 7 8 9 : ; < = > ? @ A 
-B C D E F G H I J K L M N O P Q R 
-S T U V W X Y Z [ \ ] ^ _ ` a b c 
-d e f g h i j k l m n o p q r s t 
-u v w x y z { | } ~        
-                 
-                 
-                 
-                 
-                 
-                 
-                 
-   
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/include/errno.h ../glibc-2.3/include/errno.h
--- glibc-2.2.93/include/errno.h	Fri Aug  2 15:58:11 2002
+++ ../glibc-2.3/include/errno.h	Sat Sep 14 09:40:47 2002
@@ -6,7 +6,7 @@
 
 # include <tls.h>		/* Defines USE_TLS.  */
 
-# if USE_TLS && HAVE___THREAD
+# if USE_TLS && HAVE___THREAD && (!defined NOT_IN_libc || defined IS_IN_rtld)
 #  undef  errno
 #  define errno errno		/* For #ifndef errno tests.  */
 extern __thread int errno;
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/include/fenv.h ../glibc-2.3/include/fenv.h
--- glibc-2.2.93/include/fenv.h	Wed Dec 27 16:29:10 2000
+++ ../glibc-2.3/include/fenv.h	Sat Sep 14 09:40:47 2002
@@ -11,4 +11,7 @@
 extern int __fesetenv (__const fenv_t *__envp);
 extern int __feupdateenv (__const fenv_t *__envp);
 
+libm_hidden_proto (feraiseexcept)
+libm_hidden_proto (fesetenv)
+
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/include/math.h ../glibc-2.3/include/math.h
--- glibc-2.2.93/include/math.h	Wed Apr 24 16:55:36 2002
+++ ../glibc-2.3/include/math.h	Sat Sep 14 09:40:47 2002
@@ -5,40 +5,27 @@
 /* Now define the internal interfaces.  */
 extern int __matherr (struct exception *__exc);
 
-extern int __finite_internal (double __value)
-     __attribute__ ((__const__)) attribute_hidden;
-extern int __finitef_internal (float __value)
-     __attribute__ ((__const__)) attribute_hidden;
+# if !defined NOT_IN_libc || defined IS_IN_libm
+hidden_proto (__finite)
+hidden_proto (__isinf)
+hidden_proto (__isnan)
+hidden_proto (__finitef)
+hidden_proto (__isinff)
+hidden_proto (__isnanf)
 
-extern int __isinf_internal (double __value)
-     __attribute__ ((__const__)) attribute_hidden;
-extern int __isnan_internal (double __value)
-     __attribute__ ((__const__)) attribute_hidden;
-
-#ifndef __NO_LONG_DOUBLE_MATH
-extern int __finitel_internal (long double __value)
-     __attribute__ ((__const__)) attribute_hidden;
+#  ifndef __NO_LONG_DOUBLE_MATH
+hidden_proto (__finitel)
+hidden_proto (__isinfl)
+hidden_proto (__isnanl)
+#  endif
+# endif
 
-extern int __isinfl_internal (long double __value)
-     __attribute__ ((__const__)) attribute_hidden;
-extern int __isnanl_internal (long double __value)
-     __attribute__ ((__const__)) attribute_hidden;
-#endif
+libm_hidden_proto (__fpclassify)
+libm_hidden_proto (__fpclassifyf)
 
-#if !defined NOT_IN_libc || defined IS_IN_libm
-# undef isfinite
-# ifdef __NO_LONG_DOUBLE_MATH
-#  define isfinite(x) \
-     (sizeof (x) == sizeof (float)					      \
-      ? INTUSE(__finitef) (x) : INTUSE(__finite) (x))
-# else
-#  define isfinite(x) \
-     (sizeof (x) == sizeof (float)					      \
-      ? INTUSE(__finitef) (x)						      \
-      : sizeof (x) == sizeof (double)					      \
-      ? INTUSE(__finite) (x) : INTUSE(__finitel) (x))
+# ifndef __NO_LONG_DOUBLE_MATH
+libm_hidden_proto (__fpclassifyl)
+libm_hidden_proto (__expm1l)
 # endif
-#endif
-
 
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/include/sys/stat.h ../glibc-2.3/include/sys/stat.h
--- glibc-2.2.93/include/sys/stat.h	Tue Aug 13 10:29:35 2002
+++ ../glibc-2.3/include/sys/stat.h	Mon Sep  2 16:17:38 2002
@@ -13,11 +13,9 @@
 		    __mode_t __mode, __dev_t __dev);
 #if !defined NOT_IN_libc || defined IS_IN_rtld
 hidden_proto (__fxstat)
-hidden_proto (__fxstat64)
 hidden_proto (__lxstat)
 hidden_proto (__lxstat64)
 hidden_proto (__xstat)
-hidden_proto (__xstat64)
 #endif
 extern __inline__ int __stat (__const char *__path, struct stat *__statbuf)
 {
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/io/sys/sendfile.h ../glibc-2.3/io/sys/sendfile.h
--- glibc-2.2.93/io/sys/sendfile.h	Wed Jun  5 04:56:16 2002
+++ ../glibc-2.3/io/sys/sendfile.h	Sat Sep 14 09:40:47 2002
@@ -25,8 +25,11 @@
 
 __BEGIN_DECLS
 
-/* Send COUNT bytes from file associated with IN_FD starting at OFFSET to
-   descriptor OUT_FD.  */
+/* Send up to COUNT bytes from file associated with IN_FD starting at
+   *OFFSET to descriptor OUT_FD.  Set *OFFSET to the IN_FD's file position
+   following the read bytes.  If OFFSET is a null pointer, use the normal
+   file position instead.  Return the number of written bytes, or -1 in
+   case of error.  */
 #ifndef __USE_FILE_OFFSET64
 extern ssize_t sendfile (int __out_fd, int __in_fd, off_t *__offset,
 			 size_t __count) __THROW;
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/libio/tst-atime.c ../glibc-2.3/libio/tst-atime.c
--- glibc-2.2.93/libio/tst-atime.c	Tue Jun 25 15:13:29 2002
+++ ../glibc-2.3/libio/tst-atime.c	Thu Sep  5 19:27:48 2002
@@ -1,9 +1,11 @@
+#include <errno.h>
 #include <fcntl.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <unistd.h>
 #include <sys/stat.h>
+#include <sys/statvfs.h>
 
 
 static int do_test (void);
@@ -21,6 +23,8 @@
   int ch;
   struct stat st1;
   struct stat st2;
+  struct statvfs sv;
+  int e;
 
   buf = (char *) malloc (strlen (test_dir) + sizeof "/tst-atime.XXXXXX");
   if (buf == NULL)
@@ -36,6 +40,26 @@
       printf ("cannot open temporary file: %m\n");
       return 1;
     }
+
+#ifdef ST_NOATIME
+  /* Make sure the filesystem doesn't have the noatime option set.  If
+     statvfs is not available just continue.  */
+  e = fstatvfs (fd, &sv);
+  if (e != ENOSYS)
+    {
+      if (e != 0)
+	{
+	  printf ("cannot statvfs '%s': %m\n", buf);
+	  return 1;
+	}
+
+      if ((sv.f_flag & ST_NOATIME) != 0)
+	{
+	  puts ("Bah!  The filesystem is mounted with noatime");
+	  return 0;
+	}
+    }
+#endif
 
   /* Make sure it gets removed.  */
   add_temp_file (buf);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/ChangeLog ../glibc-2.3/linuxthreads/ChangeLog
--- glibc-2.2.93/linuxthreads/ChangeLog	Mon Sep  2 23:11:50 2002
+++ ../glibc-2.3/linuxthreads/ChangeLog	Sat Sep 14 09:40:47 2002
@@ -1,3 +1,36 @@
+2002-09-11  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* sysdeps/powerpc/powerpc64/pt-machine.h: New file.
+
+2002-09-04  Bruno Haible  <bruno@clisp.org>
+
+	* pthread.c: Include <sys/time.h>.
+	(is_smp_system): Move to sysdeps/unix/sysv/linux/smp.h.
+	* sysdeps/unix/sysv/linux/smp.h: New file, extracted from pthread.c.
+	* Makefile (distribute): Add smp.h to the list.
+
+2002-09-04  Bruno Haible  <bruno@clisp.org>
+
+        * sysdeps/alpha/pt-machine.h: Choose different include file location
+        on non-Linux platforms.
+
+	* wrapsyscall.c (PROMOTE_INTEGRAL_TYPE): New macro.
+	(open, open64): Change va_arg argument type to the integral type to
+	which mode_t promotes.
+
+	* sysdeps/pthread/tst-timer.c (main): Don't assume anything about
+	the structure of 'struct sigevent'.
+
+	* errno.c (__errno_location, __h_errno_location, __res_state):
+	Use prototype function definitions.
+
+2002-07-29  Steven Munroe  <sjmunroe@us.ibm.com>
+
+	* shlib-versions: Set libpthread version to 2.3 for powerpc64.
+	* sysdeps/powerpc/pt-machine.h: moved to...
+	* sysdeps/powerpc/powerpc32/pt-machine.h: ...here
+	* sysdeps/powerpc/powerpc64/pt-machine.h: New file.
+
 2002-09-02  Roland McGrath  <roland@redhat.com>
 
 	* sysdeps/powerpc/Makefile (CFLAGS-pt-initfini.s): New variable.
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/Makefile ../glibc-2.3/linuxthreads/Makefile
--- glibc-2.2.93/linuxthreads/Makefile	Sat Aug 31 04:46:58 2002
+++ ../glibc-2.3/linuxthreads/Makefile	Sat Sep 14 09:40:47 2002
@@ -25,7 +25,7 @@
 				    Banner)
 
 headers := pthread.h semaphore.h
-distribute := internals.h queue.h restart.h spinlock.h tst-signal.sh
+distribute := internals.h queue.h restart.h spinlock.h smp.h tst-signal.sh
 
 routines := weaks no-tsd
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/errno.c ../glibc-2.3/linuxthreads/errno.c
--- glibc-2.2.93/linuxthreads/errno.c	Fri Aug  2 01:00:53 2002
+++ ../glibc-2.3/linuxthreads/errno.c	Thu Sep  5 19:27:48 2002
@@ -23,20 +23,23 @@
 
 #if !USE_TLS || !HAVE___THREAD
 /* The definition in libc is sufficient if we use TLS.  */
-int * __errno_location()
+int *
+__errno_location (void)
 {
   pthread_descr self = thread_self();
   return THREAD_GETMEM (self, p_errnop);
 }
 
-int * __h_errno_location()
+int *
+__h_errno_location (void)
 {
   pthread_descr self = thread_self();
   return THREAD_GETMEM (self, p_h_errnop);
 }
 
 /* Return thread specific resolver state.  */
-struct __res_state * __res_state()
+struct __res_state *
+__res_state (void)
 {
   pthread_descr self = thread_self();
   return THREAD_GETMEM (self, p_resp);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/pthread.c ../glibc-2.3/linuxthreads/pthread.c
--- glibc-2.2.93/linuxthreads/pthread.c	Fri Aug 30 20:30:58 2002
+++ ../glibc-2.3/linuxthreads/pthread.c	Sat Sep 14 09:40:47 2002
@@ -24,12 +24,13 @@
 #include <fcntl.h>
 #include <sys/wait.h>
 #include <sys/resource.h>
-#include <sys/sysctl.h>
+#include <sys/time.h>
 #include <shlib-compat.h>
 #include "pthread.h"
 #include "internals.h"
 #include "spinlock.h"
 #include "restart.h"
+#include "smp.h"
 #include <ldsodefs.h>
 #include <tls.h>
 #include <locale.h>		/* for __uselocale */
@@ -358,38 +359,6 @@
 
   return high ? current_rtmin++ : current_rtmax--;
 #endif
-}
-
-/* The function we use to get the kernel revision.  */
-extern int __sysctl (int *name, int nlen, void *oldval, size_t *oldlenp,
-		     void *newval, size_t newlen);
-
-/* Test whether the machine has more than one processor.  This is not the
-   best test but good enough.  More complicated tests would require `malloc'
-   which is not available at that time.  */
-static int
-is_smp_system (void)
-{
-  static const int sysctl_args[] = { CTL_KERN, KERN_VERSION };
-  char buf[512];
-  size_t reslen = sizeof (buf);
-
-  /* Try reading the number using `sysctl' first.  */
-  if (__sysctl ((int *) sysctl_args,
-		sizeof (sysctl_args) / sizeof (sysctl_args[0]),
-		buf, &reslen, NULL, 0) < 0)
-    {
-      /* This was not successful.  Now try reading the /proc filesystem.  */
-      int fd = __open ("/proc/sys/kernel/version", O_RDONLY);
-      if (__builtin_expect (fd, 0) == -1
-	  || (reslen = __read (fd, buf, sizeof (buf))) <= 0)
-	/* This also didn't work.  We give up and say it's a UP machine.  */
-	buf[0] = '\0';
-
-      __close (fd);
-    }
-
-  return strstr (buf, "SMP") != NULL;
 }
 
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/shlib-versions ../glibc-2.3/linuxthreads/shlib-versions
--- glibc-2.2.93/linuxthreads/shlib-versions	Mon Sep 24 21:13:41 2001
+++ ../glibc-2.3/linuxthreads/shlib-versions	Thu Sep  5 19:27:48 2002
@@ -7,4 +7,5 @@
 s390x-.*-linux.*	libpthread=0		GLIBC_2.2
 cris-.*-linux.*		libpthread=0		GLIBC_2.2
 x86_64-.*-linux.*	libpthread=0		GLIBC_2.2.5
+powerpc64-.*-linux.*	libpthread=0		GLIBC_2.3
 .*-.*-linux.*		libpthread=0
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/sysdeps/alpha/pt-machine.h ../glibc-2.3/linuxthreads/sysdeps/alpha/pt-machine.h
--- glibc-2.2.93/linuxthreads/sysdeps/alpha/pt-machine.h	Tue Aug 27 00:52:35 2002
+++ ../glibc-2.3/linuxthreads/sysdeps/alpha/pt-machine.h	Sat Sep 14 09:40:47 2002
@@ -26,7 +26,11 @@
 # define PT_EI extern inline
 #endif
 
-#include <asm/pal.h>
+#ifdef __linux__
+# include <asm/pal.h>
+#else
+# include <machine/pal.h>
+#endif
 
 extern long int testandset (int *spinlock);
 extern int __compare_and_swap (long int *p, long int oldval, long int newval);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/sysdeps/powerpc/powerpc32/pt-machine.h ../glibc-2.3/linuxthreads/sysdeps/powerpc/powerpc32/pt-machine.h
--- glibc-2.2.93/linuxthreads/sysdeps/powerpc/powerpc32/pt-machine.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/linuxthreads/sysdeps/powerpc/powerpc32/pt-machine.h	Thu Sep  5 03:23:35 2002
@@ -0,0 +1,93 @@
+/* Machine-dependent pthreads configuration and inline functions.
+   powerpc version.
+   Copyright (C) 1996, 1997, 1998, 2000, 2001, 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public License as
+   published by the Free Software Foundation; either version 2.1 of the
+   License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; see the file COPYING.LIB.  If
+   not, write to the Free Software Foundation, Inc.,
+   59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
+
+/* These routines are from Appendix G of the 'PowerPC 601 RISC Microprocessor
+   User's Manual', by IBM and Motorola.  */
+
+#ifndef _PT_MACHINE_H
+#define _PT_MACHINE_H   1
+
+#ifndef PT_EI
+# define PT_EI extern inline
+#endif
+
+extern long int testandset (int *spinlock);
+extern int __compare_and_swap (long int *p, long int oldval, long int newval);
+
+/* For multiprocessor systems, we want to ensure all memory accesses
+   are completed before we reset a lock.  On other systems, we still
+   need to make sure that the compiler has flushed everything to memory.  */
+#define MEMORY_BARRIER() __asm__ __volatile__ ("sync" : : : "memory")
+
+/* Get some notion of the current stack.  Need not be exactly the top
+   of the stack, just something somewhere in the current frame.  */
+#define CURRENT_STACK_FRAME  stack_pointer
+register char * stack_pointer __asm__ ("r1");
+
+/* Compare-and-swap for semaphores. */
+/* note that test-and-set(x) is the same as !compare-and-swap(x, 0, 1) */
+
+#define HAS_COMPARE_AND_SWAP_WITH_RELEASE_SEMANTICS
+#define IMPLEMENT_TAS_WITH_CAS
+
+PT_EI int
+__compare_and_swap (long int *p, long int oldval, long int newval)
+{
+  int ret;
+
+  __asm__ __volatile__ (
+	   "0:    lwarx %0,0,%1 ;"
+	   "      xor. %0,%3,%0;"
+	   "      bne 1f;"
+	   "      stwcx. %2,0,%1;"
+	   "      bne- 0b;"
+	   "1:    "
+	: "=&r"(ret)
+	: "r"(p), "r"(newval), "r"(oldval)
+	: "cr0", "memory");
+  /* This version of __compare_and_swap is to be used when acquiring
+     a lock, so we don't need to worry about whether other memory
+     operations have completed, but we do need to be sure that any loads
+     after this point really occur after we have acquired the lock.  */
+  __asm__ __volatile__ ("isync" : : : "memory");
+  return ret == 0;
+}
+
+PT_EI int
+__compare_and_swap_with_release_semantics (long int *p,
+					   long int oldval, long int newval)
+{
+  int ret;
+
+  MEMORY_BARRIER ();
+  __asm__ __volatile__ (
+	   "0:    lwarx %0,0,%1 ;"
+	   "      xor. %0,%3,%0;"
+	   "      bne 1f;"
+	   "      stwcx. %2,0,%1;"
+	   "      bne- 0b;"
+	   "1:    "
+	: "=&r"(ret)
+	: "r"(p), "r"(newval), "r"(oldval)
+	: "cr0", "memory");
+  return ret == 0;
+}
+
+#endif /* pt-machine.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h ../glibc-2.3/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h
--- glibc-2.2.93/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/linuxthreads/sysdeps/powerpc/powerpc64/pt-machine.h	Sat Sep 14 04:55:04 2002
@@ -0,0 +1,129 @@
+/* Machine-dependent pthreads configuration and inline functions.
+   powerpc version.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Library General Public License as
+   published by the Free Software Foundation; either version 2 of the
+   License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Library General Public License for more details.
+
+   You should have received a copy of the GNU Library General Public
+   License along with the GNU C Library; see the file COPYING.LIB.  If
+   not, write to the Free Software Foundation, Inc.,
+   59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
+
+/* These routines are from Appendix G of the 'PowerPC 601 RISC Microprocessor
+   User's Manual', by IBM and Motorola.  */
+
+#ifndef _PT_MACHINE_H
+#define _PT_MACHINE_H   1
+
+#ifndef PT_EI
+# define PT_EI extern inline
+#endif
+
+extern long int testandset (int *spinlock);
+extern int __compare_and_swap (long int *p, long int oldval, long int newval);
+
+/* For multiprocessor systems, we want to ensure all memory accesses
+   are completed before we reset a lock.  On other systems, we still
+   need to make sure that the compiler has flushed everything to memory.  */
+#define MEMORY_BARRIER() __asm__ __volatile__ ("sync" : : : "memory")
+
+/* We want the OS to assign stack addresses.  */
+#define FLOATING_STACKS 1
+
+/* Maximum size of the stack if the rlimit is unlimited.  */
+#define ARCH_STACK_MAX_SIZE     16*1024*1024
+
+/* Get some notion of the current stack.  Need not be exactly the top
+   of the stack, just something somewhere in the current frame.  */
+#define CURRENT_STACK_FRAME  stack_pointer
+register char * stack_pointer __asm__ ("r1");
+
+/* Register r13 (tp) is reserved by the ABI as "thread pointer". */
+struct _pthread_descr_struct;
+register struct _pthread_descr_struct *__thread_self __asm__("r13");
+
+/* Return the thread descriptor for the current thread.  */
+#define THREAD_SELF  __thread_self
+
+/* Initialize the thread-unique value.  */
+#define INIT_THREAD_SELF(descr, nr)  (__thread_self = (descr))
+
+/* Compare-and-swap for semaphores. */
+/* note that test-and-set(x) is the same as !compare-and-swap(x, 0, 1) */
+
+#define HAS_COMPARE_AND_SWAP
+#define HAS_COMPARE_AND_SWAP_WITH_RELEASE_SEMANTICS
+
+PT_EI int
+__compare_and_swap (long int *p, long int oldval, long int newval)
+{
+  long int ret;
+
+  __asm__ __volatile__ (
+	   "0:    ldarx %0,0,%1 ;"
+	   "      xor. %0,%3,%0;"
+	   "      bne 1f;"
+	   "      stdcx. %2,0,%1;"
+	   "      bne- 0b;"
+	   "1:    "
+	: "=&r"(ret)
+	: "r"(p), "r"(newval), "r"(oldval)
+	: "cr0", "memory");
+  /* This version of __compare_and_swap is to be used when acquiring
+     a lock, so we don't need to worry about whether other memory
+     operations have completed, but we do need to be sure that any loads
+     after this point really occur after we have acquired the lock.  */
+  __asm__ __volatile__ ("isync" : : : "memory");
+  return (int)(ret == 0);
+}
+
+PT_EI int
+__compare_and_swap_with_release_semantics (long int *p,
+					   long int oldval, long int newval)
+{
+  long int ret;
+
+  MEMORY_BARRIER ();
+  __asm__ __volatile__ (
+	   "0:    ldarx %0,0,%1 ;"
+	   "      xor. %0,%3,%0;"
+	   "      bne 1f;"
+	   "      stdcx. %2,0,%1;"
+	   "      bne- 0b;"
+	   "1:    "
+	: "=&r"(ret)
+	: "r"(p), "r"(newval), "r"(oldval)
+	: "cr0", "memory");
+  return (int)(ret == 0);
+}
+
+PT_EI long int
+testandset (int *p)
+{
+  long int ret, val = 1;
+
+  MEMORY_BARRIER ();
+  __asm__ __volatile__ (
+	   "0:    lwarx %0,0,%1 ;"
+	   "      cmpwi  0,%0,0;"
+	   "      bne 1f;"
+	   "      stwcx. %2,0,%1;"
+	   "      bne- 0b;"
+	   "1:    "
+	: "=&r"(ret)
+	: "r"(p), "r" (val)
+	: "cr0", "memory");
+  MEMORY_BARRIER ();
+  return ret != 0;
+}
+
+#endif /* pt-machine.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/sysdeps/powerpc/pt-machine.h ../glibc-2.3/linuxthreads/sysdeps/powerpc/pt-machine.h
--- glibc-2.2.93/linuxthreads/sysdeps/powerpc/pt-machine.h	Tue Aug 27 00:52:36 2002
+++ ../glibc-2.3/linuxthreads/sysdeps/powerpc/pt-machine.h	Wed Dec 31 19:00:00 1969
@@ -1,93 +0,0 @@
-/* Machine-dependent pthreads configuration and inline functions.
-   powerpc version.
-   Copyright (C) 1996, 1997, 1998, 2000, 2001, 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public License as
-   published by the Free Software Foundation; either version 2.1 of the
-   License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; see the file COPYING.LIB.  If
-   not, write to the Free Software Foundation, Inc.,
-   59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
-
-/* These routines are from Appendix G of the 'PowerPC 601 RISC Microprocessor
-   User's Manual', by IBM and Motorola.  */
-
-#ifndef _PT_MACHINE_H
-#define _PT_MACHINE_H   1
-
-#ifndef PT_EI
-# define PT_EI extern inline
-#endif
-
-extern long int testandset (int *spinlock);
-extern int __compare_and_swap (long int *p, long int oldval, long int newval);
-
-/* For multiprocessor systems, we want to ensure all memory accesses
-   are completed before we reset a lock.  On other systems, we still
-   need to make sure that the compiler has flushed everything to memory.  */
-#define MEMORY_BARRIER() __asm__ __volatile__ ("sync" : : : "memory")
-
-/* Get some notion of the current stack.  Need not be exactly the top
-   of the stack, just something somewhere in the current frame.  */
-#define CURRENT_STACK_FRAME  stack_pointer
-register char * stack_pointer __asm__ ("r1");
-
-/* Compare-and-swap for semaphores. */
-/* note that test-and-set(x) is the same as !compare-and-swap(x, 0, 1) */
-
-#define HAS_COMPARE_AND_SWAP_WITH_RELEASE_SEMANTICS
-#define IMPLEMENT_TAS_WITH_CAS
-
-PT_EI int
-__compare_and_swap (long int *p, long int oldval, long int newval)
-{
-  int ret;
-
-  __asm__ __volatile__ (
-	   "0:    lwarx %0,0,%1 ;"
-	   "      xor. %0,%3,%0;"
-	   "      bne 1f;"
-	   "      stwcx. %2,0,%1;"
-	   "      bne- 0b;"
-	   "1:    "
-	: "=&r"(ret)
-	: "r"(p), "r"(newval), "r"(oldval)
-	: "cr0", "memory");
-  /* This version of __compare_and_swap is to be used when acquiring
-     a lock, so we don't need to worry about whether other memory
-     operations have completed, but we do need to be sure that any loads
-     after this point really occur after we have acquired the lock.  */
-  __asm__ __volatile__ ("isync" : : : "memory");
-  return ret == 0;
-}
-
-PT_EI int
-__compare_and_swap_with_release_semantics (long int *p,
-					   long int oldval, long int newval)
-{
-  int ret;
-
-  MEMORY_BARRIER ();
-  __asm__ __volatile__ (
-	   "0:    lwarx %0,0,%1 ;"
-	   "      xor. %0,%3,%0;"
-	   "      bne 1f;"
-	   "      stwcx. %2,0,%1;"
-	   "      bne- 0b;"
-	   "1:    "
-	: "=&r"(ret)
-	: "r"(p), "r"(newval), "r"(oldval)
-	: "cr0", "memory");
-  return ret == 0;
-}
-
-#endif /* pt-machine.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/sysdeps/pthread/tst-timer.c ../glibc-2.3/linuxthreads/sysdeps/pthread/tst-timer.c
--- glibc-2.2.93/linuxthreads/sysdeps/pthread/tst-timer.c	Tue Aug 27 00:52:36 2002
+++ ../glibc-2.3/linuxthreads/sysdeps/pthread/tst-timer.c	Thu Sep  5 19:27:49 2002
@@ -1,5 +1,5 @@
 /* Tests for POSIX timer implementation.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Kaz Kylheku <kaz@ashi.footprints.net>.
 
@@ -66,23 +66,16 @@
     .sigev_notify = SIGEV_SIGNAL,
     .sigev_signo = ZSIGALRM
   };
-  struct sigevent sigev2 =
-  {
-    .sigev_notify = SIGEV_THREAD,
-    ._sigev_un =
-    {
-      ._sigev_thread =
-      {
-	._function = notify_func
-      }
-    }
-  };
+  struct sigevent sigev2;
   struct itimerspec itimer1 = { { 0, 200000000 }, { 0, 200000000 } };
   struct itimerspec itimer2 = { { 0, 100000000 }, { 0, 500000000 } };
   struct itimerspec itimer3 = { { 0, 150000000 }, { 0, 300000000 } };
   struct itimerspec old;
 
   retval = clock_gettime (CLOCK_REALTIME, &ts);
+
+  sigev2.sigev_notify = SIGEV_THREAD;
+  sigev2.sigev_notify_function = notify_func;
 
   setvbuf (stdout, 0, _IOLBF, 0);
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/sysdeps/unix/sysv/linux/smp.h ../glibc-2.3/linuxthreads/sysdeps/unix/sysv/linux/smp.h
--- glibc-2.2.93/linuxthreads/sysdeps/unix/sysv/linux/smp.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/linuxthreads/sysdeps/unix/sysv/linux/smp.h	Sun Sep  8 16:37:11 2002
@@ -0,0 +1,48 @@
+/* Determine whether the host has multiple processors.  Linux version.
+   Copyright (C) 1996, 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Library General Public License as
+   published by the Free Software Foundation; either version 2 of the
+   License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Library General Public License for more details.
+
+   You should have received a copy of the GNU Library General Public
+   License along with the GNU C Library; see the file COPYING.LIB.  If not,
+   write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+   Boston, MA 02111-1307, USA.  */
+
+#include <sys/sysctl.h>
+
+/* Test whether the machine has more than one processor.  This is not the
+   best test but good enough.  More complicated tests would require `malloc'
+   which is not available at that time.  */
+static inline int
+is_smp_system (void)
+{
+  static const int sysctl_args[] = { CTL_KERN, KERN_VERSION };
+  char buf[512];
+  size_t reslen = sizeof (buf);
+
+  /* Try reading the number using `sysctl' first.  */
+  if (__sysctl ((int *) sysctl_args,
+		sizeof (sysctl_args) / sizeof (sysctl_args[0]),
+		buf, &reslen, NULL, 0) < 0)
+    {
+      /* This was not successful.  Now try reading the /proc filesystem.  */
+      int fd = __open ("/proc/sys/kernel/version", O_RDONLY);
+      if (__builtin_expect (fd, 0) == -1
+	  || (reslen = __read (fd, buf, sizeof (buf))) <= 0)
+	/* This also didn't work.  We give up and say it's a UP machine.  */
+	buf[0] = '\0';
+
+      __close (fd);
+    }
+
+  return strstr (buf, "SMP") != NULL;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/linuxthreads/wrapsyscall.c ../glibc-2.3/linuxthreads/wrapsyscall.c
--- glibc-2.2.93/linuxthreads/wrapsyscall.c	Tue Aug 27 00:52:35 2002
+++ ../glibc-2.3/linuxthreads/wrapsyscall.c	Thu Sep  5 19:27:48 2002
@@ -1,5 +1,5 @@
 /* Wrapper arpund system calls to provide cancelation points.
-   Copyright (C) 1996,1997,1998,1999,2000,2001 Free Software Foundation, Inc.
+   Copyright (C) 1996-1999,2000-2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -69,6 +69,8 @@
   return result;							      \
 }
 
+#define PROMOTE_INTEGRAL_TYPE(type) __typeof__ ((type) 0 + 0)
+
 
 /* close(2).  */
 CANCELABLE_SYSCALL (int, close, (int fd), (fd))
@@ -110,13 +112,17 @@
 
 /* open(2).  */
 CANCELABLE_SYSCALL_VA (int, open, (const char *pathname, int flags, ...),
-		       (pathname, flags, va_arg (ap, mode_t)), flags)
+		       (pathname, flags,
+			va_arg (ap, PROMOTE_INTEGRAL_TYPE (mode_t))),
+		       flags)
 strong_alias (open, __open)
 
 
 /* open64(3).  */
 CANCELABLE_SYSCALL_VA (int, open64, (const char *pathname, int flags, ...),
-		       (pathname, flags, va_arg (ap, mode_t)), flags)
+		       (pathname, flags,
+			va_arg (ap, PROMOTE_INTEGRAL_TYPE (mode_t))),
+		       flags)
 strong_alias (open64, __open64)
 
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/locale/lc-ctype.c ../glibc-2.3/locale/lc-ctype.c
--- glibc-2.2.93/locale/lc-ctype.c	Mon Sep  2 14:48:04 2002
+++ ../glibc-2.3/locale/lc-ctype.c	Thu Sep  5 19:27:49 2002
@@ -54,19 +54,22 @@
 
 #include <shlib-compat.h>
 #if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_3)
-  extern __const unsigned short int *__ctype_old_b; /* Characteristics.  */
-  extern __const __int32_t *__ctype_old_tolower; /* Case conversions.  */
-  extern __const __int32_t *__ctype_old_toupper; /* Case conversions.  */
+  /* We must use the exported names to access these so we are sure to
+     be accessing the main executable's copy if it has COPY relocs.  */
 
-  extern const uint32_t *__ctype32_old_b;
-  extern const uint32_t *__ctype32_old_toupper;
-  extern const uint32_t *__ctype32_old_tolower;
+  extern __const unsigned short int *__ctype_b; /* Characteristics.  */
+  extern __const __int32_t *__ctype_tolower; /* Case conversions.  */
+  extern __const __int32_t *__ctype_toupper; /* Case conversions.  */
 
-  __ctype_old_b = current (uint16_t, CLASS, 128);
-  __ctype_old_toupper = current (uint32_t, TOUPPER, 128);
-  __ctype_old_tolower = current (uint32_t, TOLOWER, 128);
-  __ctype32_old_b = current (uint32_t, CLASS32, 0);
-  __ctype32_old_toupper = current (uint32_t, TOUPPER32, 0);
-  __ctype32_old_tolower = current (uint32_t, TOLOWER32, 0);
+  extern const uint32_t *__ctype32_b;
+  extern const uint32_t *__ctype32_toupper;
+  extern const uint32_t *__ctype32_tolower;
+
+  __ctype_b = current (uint16_t, CLASS, 128);
+  __ctype_toupper = current (uint32_t, TOUPPER, 128);
+  __ctype_tolower = current (uint32_t, TOLOWER, 128);
+  __ctype32_b = current (uint32_t, CLASS32, 0);
+  __ctype32_toupper = current (uint32_t, TOUPPER32, 0);
+  __ctype32_tolower = current (uint32_t, TOLOWER32, 0);
 #endif
 }
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/locale/tst-C-locale.c ../glibc-2.3/locale/tst-C-locale.c
--- glibc-2.2.93/locale/tst-C-locale.c	Wed Aug 28 07:42:20 2002
+++ ../glibc-2.3/locale/tst-C-locale.c	Wed Sep  4 00:32:34 2002
@@ -223,7 +223,7 @@
   STRTEST (NOSTR, "");
 
   /* Test the new locale mechanisms.  */
-  loc = newlocale (LC_ALL, locname, NULL);
+  loc = newlocale (LC_ALL_MASK, locname, NULL);
   if (loc == NULL)
     {
       printf ("cannot create locale object for locale %s\n", locname);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/localedata/ChangeLog ../glibc-2.3/localedata/ChangeLog
--- glibc-2.2.93/localedata/ChangeLog	Sun Sep  1 14:02:00 2002
+++ ../glibc-2.3/localedata/ChangeLog	Sat Sep 14 09:40:49 2002
@@ -1,3 +1,8 @@
+2002-09-10  Ulrich Drepper  <drepper@redhat.com>
+
+	* localedata/locales/bg_BG: Update LC_IDENTIFICATION info.
+	Patch by Yanko Kaneti <yaneti@declera.com>.
+
 2002-09-01  Roland McGrath  <roland@redhat.com>
 
 	* tst-ctype.c (main): Use nl_langinfo instead of __ctype_b global.
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/localedata/locales/bg_BG ../glibc-2.3/localedata/locales/bg_BG
--- glibc-2.2.93/localedata/locales/bg_BG	Wed Dec  5 17:30:46 2001
+++ ../glibc-2.3/localedata/locales/bg_BG	Sat Sep 14 09:40:49 2002
@@ -21,10 +21,10 @@
 email      "delyant@yahoo.com"
 tel        ""
 fax        ""
-language   "bg"
-territory  "BG"
-revision   "2.0"
-date       "2001-11-16"
+language   "Bulgarian"
+territory  "Bulgaria"
+revision   "2.0.1"
+date       "2002-09-10"
 
 category  "bg_BG:2000";LC_IDENTIFICATION
 category  "bg_BG:2000";LC_CTYPE
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/math/Makefile ../glibc-2.3/math/Makefile
--- glibc-2.2.93/math/Makefile	Tue Jul 16 19:38:27 2002
+++ ../glibc-2.3/math/Makefile	Sat Sep 14 09:40:49 2002
@@ -57,7 +57,8 @@
 	     conj cimag creal cabs carg s_cexp s_csinh s_ccosh s_clog	\
 	     s_catan s_casin s_ccos s_csin s_ctan s_ctanh s_cacos	\
 	     s_casinh s_cacosh s_catanh s_csqrt s_cpow s_cproj s_clog10 \
-	     s_fma s_lrint s_llrint s_lround s_llround e_exp10 w_log2
+	     s_fma s_lrint s_llrint s_lround s_llround e_exp10 w_log2	\
+	     s_isinf s_isnan
 dbl-only-routines := branred doasin dosincos halfulp mpa mpatan2	\
 		     mpatan mpexp mplog mpsqrt mptan sincos32 slowexp	\
 		     slowpow
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nscd/Makefile ../glibc-2.3/nscd/Makefile
--- glibc-2.2.93/nscd/Makefile	Sun Aug  4 15:32:42 2002
+++ ../glibc-2.3/nscd/Makefile	Sat Sep 14 09:40:50 2002
@@ -53,11 +53,10 @@
 
 include ../Rules
 
-CPPFLAGS-nscd = -DNOT_IN_libc
-CPPFLAGS-nscd_conf = -DNOT_IN_libc
-CPPFLAGS-dbg_log = -DNOT_IN_libc
-CPPFLAGS-connections = -DNOT_IN_libc
-CPPFLAGS-hstcache = -DNOT_IN_libc
+# This makes sure -DNOT_IN_libc is passed for all these modules.
+cpp-srcs-left := $(nscd-modules:=.c)
+lib := nscd
+include $(patsubst %,$(..)cppflags-iterator.mk,$(cpp-srcs-left))
 
 $(objpfx)nscd: $(nscd-modules:%=$(objpfx)%.o)
 $(objpfx)nscd_nischeck: $(objpfx)nscd_nischeck.o
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nscd/connections.c ../glibc-2.3/nscd/connections.c
--- glibc-2.2.93/nscd/connections.c	Thu Jan 17 20:59:56 2002
+++ ../glibc-2.3/nscd/connections.c	Thu Sep  5 19:27:51 2002
@@ -391,12 +391,12 @@
 	}
       else
 	{
-	  struct ucred caller;
-	  socklen_t optlen = sizeof (caller);
-
 	  /* Some systems have no SO_PEERCRED implementation.  They don't
 	     care about security so we don't as well.  */
 #ifdef SO_PEERCRED
+	  struct ucred caller;
+	  socklen_t optlen = sizeof (caller);
+
 	  if (getsockopt (fd, SOL_SOCKET, SO_PEERCRED, &caller, &optlen) < 0)
 	    {
 	      char buf[256];
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/Makefile ../glibc-2.3/nss/Makefile
--- glibc-2.2.93/nss/Makefile	Sat Jul  7 15:21:07 2001
+++ ../glibc-2.3/nss/Makefile	Sat Sep 14 09:40:50 2002
@@ -39,7 +39,7 @@
 others                  := getent
 install-bin             := getent
 
-tests			= test-netdb
+tests			= test-netdb bug-erange
 
 include ../Makeconfig
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/bug-erange.c ../glibc-2.3/nss/bug-erange.c
--- glibc-2.2.93/nss/bug-erange.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/bug-erange.c	Wed Sep 11 21:44:18 2002
@@ -0,0 +1,44 @@
+/* Test case for gethostbyname_r bug when buffer expansion required.  */
+
+#include <netdb.h>
+#include <arpa/inet.h>
+#include <errno.h>
+#include <string.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+int
+main (void)
+{
+  const char *host = "www.gnu.org";
+
+  /* This code approximates the example code in the library manual.  */
+
+  struct hostent hostbuf, *hp;
+  size_t hstbuflen;
+  char *tmphstbuf;
+  int res;
+  int herr;
+
+  hstbuflen = 16;		/* Make it way small to ensure ERANGE.  */
+  /* Allocate buffer, remember to free it to avoid memory leakage.  */
+  tmphstbuf = malloc (hstbuflen);
+
+  while ((res = gethostbyname_r (host, &hostbuf, tmphstbuf, hstbuflen,
+                                 &hp, &herr)) == ERANGE)
+    {
+      /* Enlarge the buffer.  */
+      hstbuflen *= 2;
+      tmphstbuf = realloc (tmphstbuf, hstbuflen);
+    }
+
+  if (res != 0 || hp == NULL)
+    {
+      printf ("gethostbyname_r failed: %s (errno: %m)\n", strerror (res));
+      return 1;
+    }
+
+  printf ("Got: %s %s\n", hp->h_name,
+	  inet_ntoa (*(struct in_addr *) hp->h_addr));
+  return 0;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/db-Makefile ../glibc-2.3/nss/db-Makefile
--- glibc-2.2.93/nss/db-Makefile	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/db-Makefile	Fri Jul  6 00:55:37 2001
@@ -0,0 +1,139 @@
+# Makefile to (re-)generate db versions of system database files.
+# Copyright (C) 1996, 1997, 1998 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+# Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+#
+
+# The GNU C Library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+
+# The GNU C Library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; if not, write to the Free
+# Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+# 02111-1307 USA.
+
+DATABASES = $(wildcard /etc/passwd /etc/group /etc/ethers /etc/protocols \
+		       /etc/rpc /etc/services /etc/shadow /etc/netgroup)
+
+VAR_DB = /var/db
+
+AWK = awk
+MAKEDB = makedb --quiet
+
+all: $(patsubst %,$(VAR_DB)/%.db,$(notdir $(DATABASES)))
+
+
+$(VAR_DB)/passwd.db: /etc/passwd
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS=":"; OFS=":"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$3; print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/group.db: /etc/group
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS=":"; OFS=":"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$3; print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/ethers.db: /etc/ethers
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$2; print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/protocols.db: /etc/protocols
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$2; print; \
+			   for (i = 3; i <= NF && !($$i ~ /^#/); ++i) \
+			     { printf ".%s ", $$i; print } }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/rpc.db: /etc/rpc
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print; \
+			   printf "=%s ", $$2; print; \
+			   for (i = 3; i <= NF && !($$i ~ /^#/); ++i) \
+			     { printf ".%s ", $$i; print } }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/services.db: /etc/services
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS="[ \t/]+"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s/%s ", $$1, $$3; print; \
+			   printf ".%s/ ", $$1; print; \
+			   printf "=%s/%s ", $$2, $$3; print; \
+			   printf "=%s/ ", $$2; print; \
+			   for (i = 4; i <= NF && !($$i ~ /^#/); ++i) \
+			     { printf ".%s/%s ", $$i, $$3; print; \
+			       printf ".%s/ ", $$i; print } }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
+
+$(VAR_DB)/shadow.db: /etc/shadow
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { FS=":"; OFS=":"; cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { printf ".%s ", $$1; print }' $^ | \
+	(umask 077 && $(MAKEDB) -o $@ -)
+	@echo "done."
+	@if chgrp shadow $@ 2>/dev/null; then \
+	  chmod g+r $@; \
+	else \
+	  chown 0 $@; chgrp 0 $@; chmod 600 $@; \
+	  echo; \
+	  echo "Warning: The shadow password database $@"; \
+	  echo "has been set to be readable only by root.  You may want"; \
+	  echo "to make it readable by the \`shadow' group depending"; \
+	  echo "on your configuration."; \
+	  echo; \
+	fi
+
+$(VAR_DB)/netgroup.db: /etc/netgroup
+	@echo -n "$(patsubst %.db,%,$(@F))... "
+	@$(AWK) 'BEGIN { cnt=0 } \
+		 /^[ \t]*$$/ { next } \
+		 /^[ \t]*#/ { next } \
+		 { printf "0%u ", cnt++; print } \
+		 /^[^#]/ { end=sub(/\\/, " "); \
+			   gsub(/[ \t]+/, " "); \
+			   if(end == 1) printf "%s", $$0; else print }' $^ | \
+	$(MAKEDB) -o $@ -
+	@echo "done."
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/getXXbyYY_r.c ../glibc-2.3/nss/getXXbyYY_r.c
--- glibc-2.2.93/nss/getXXbyYY_r.c	Tue Aug 27 04:24:49 2002
+++ ../glibc-2.3/nss/getXXbyYY_r.c	Sat Sep 14 09:40:50 2002
@@ -242,8 +242,13 @@
 #ifdef POSTPROCESS
   POSTPROCESS;
 #endif
-  return (status == NSS_STATUS_SUCCESS
-	  ? 0 : (status == NSS_STATUS_TRYAGAIN ? EAGAIN : ENOENT));
+  return (status == NSS_STATUS_SUCCESS ? 0
+	  : status != NSS_STATUS_TRYAGAIN ? ENOENT
+#ifdef NEED_H_ERRNO
+	  /* These functions only set errno if h_errno is NETDB_INTERNAL.  */
+	  : *h_errnop != NETDB_INTERNAL ? EAGAIN
+#endif
+	  : errno);
 }
 
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/getnssent_r.c ../glibc-2.3/nss/getnssent_r.c
--- glibc-2.2.93/nss/getnssent_r.c	Fri Aug 30 20:30:59 2002
+++ ../glibc-2.3/nss/getnssent_r.c	Sat Sep 14 09:40:50 2002
@@ -197,6 +197,9 @@
     }
 
   *result = status == NSS_STATUS_SUCCESS ? resbuf : NULL;
-  return (status == NSS_STATUS_SUCCESS
-	  ? 0 : status == NSS_STATUS_TRYAGAIN ? errno : ENOENT);
+  return (status == NSS_STATUS_SUCCESS ? 0
+	  : status != NSS_STATUS_TRYAGAIN ? ENOENT
+	  /* h_errno functions only set errno if h_errno is NETDB_INTERNAL.  */
+	  : (h_errnop == NULL || *h_errnop == NETDB_INTERNAL) ? errno
+	  : EAGAIN);
 }
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/makedb.c ../glibc-2.3/nss/makedb.c
--- glibc-2.2.93/nss/makedb.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/makedb.c	Fri Jul  6 00:55:37 2001
@@ -0,0 +1,389 @@
+/* Create simple DB database from textual input.
+   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <argp.h>
+#include <ctype.h>
+#include <dlfcn.h>
+#include <errno.h>
+#include <error.h>
+#include <fcntl.h>
+#include <libintl.h>
+#include <locale.h>
+#include <stdio.h>
+#include <stdint.h>
+#include <stdlib.h>
+#include <string.h>
+#include <sys/stat.h>
+#include "nss_db/dummy-db.h"
+
+/* Get libc version number.  */
+#include "../version.h"
+
+#define PACKAGE _libc_intl_domainname
+
+/* If non-zero convert key to lower case.  */
+static int to_lowercase;
+
+/* If non-zero print content of input file, one entry per line.  */
+static int do_undo;
+
+/* If non-zero do not print informational messages.  */
+static int be_quiet;
+
+/* Name of output file.  */
+static const char *output_name;
+
+/* Name and version of program.  */
+static void print_version (FILE *stream, struct argp_state *state);
+void (*argp_program_version_hook) (FILE *, struct argp_state *) = print_version;
+
+/* Definitions of arguments for argp functions.  */
+static const struct argp_option options[] =
+{
+  { "fold-case", 'f', NULL, 0, N_("Convert key to lower case") },
+  { "output", 'o', N_("NAME"), 0, N_("Write output to file NAME") },
+  { "quiet", 'q', NULL, 0,
+    N_("Do not print messages while building database") },
+  { "undo", 'u', NULL, 0,
+    N_("Print content of database file, one entry a line") },
+  { NULL, 0, NULL, 0, NULL }
+};
+
+/* Short description of program.  */
+static const char doc[] = N_("Create simple DB database from textual input.");
+
+/* Strings for arguments in help texts.  */
+static const char args_doc[] = N_("\
+INPUT-FILE OUTPUT-FILE\n-o OUTPUT-FILE INPUT-FILE\n-u INPUT-FILE");
+
+/* Prototype for option handler.  */
+static error_t parse_opt (int key, char *arg, struct argp_state *state);
+
+/* Function to print some extra text in the help message.  */
+static char *more_help (int key, const char *text, void *input);
+
+/* Data structure to communicate with argp functions.  */
+static struct argp argp =
+{
+  options, parse_opt, args_doc, doc, NULL, more_help
+};
+
+
+/* Prototypes for local functions.  */
+static int process_input (FILE *input, const char *inname, NSS_DB *output,
+			  int to_lowercase, int be_quiet);
+static int print_database (NSS_DB *db);
+
+
+int
+main (int argc, char *argv[])
+{
+  const char *input_name;
+  FILE *input_file;
+  NSS_DB *db_file;
+  int status;
+  int remaining;
+  int mode = 0666;
+
+  /* Set locale via LC_ALL.  */
+  setlocale (LC_ALL, "");
+
+  /* Set the text message domain.  */
+  textdomain (_libc_intl_domainname);
+
+  /* Initialize local variables.  */
+  input_name = NULL;
+
+  /* Parse and process arguments.  */
+  argp_parse (&argp, argc, argv, 0, &remaining, NULL);
+
+  /* Determine file names.  */
+  if (do_undo || output_name != NULL)
+    {
+      if (remaining + 1 != argc)
+	{
+	wrong_arguments:
+	  error (0, 0, gettext ("wrong number of arguments"));
+	  argp_help (&argp, stdout, ARGP_HELP_SEE,
+		     program_invocation_short_name);
+	  exit (1);
+	}
+      input_name = argv[remaining];
+    }
+  else
+    {
+      if (remaining + 2 != argc)
+	goto wrong_arguments;
+
+      input_name = argv[remaining++];
+      output_name = argv[remaining];
+    }
+
+  /* First load the shared object to initialize version dependend
+     variables.  */
+  if (load_db () != NSS_STATUS_SUCCESS)
+    error (EXIT_FAILURE, 0, gettext ("No usable database library found."));
+
+  /* Special handling if we are asked to print the database.  */
+  if (do_undo)
+    {
+      dbopen (input_name, db_rdonly, 0666, &db_file);
+      if (db_file == NULL)
+	error (EXIT_FAILURE, 0, gettext ("cannot open database file `%s': %s"),
+	       input_name,
+	       (errno == EINVAL ? gettext ("incorrectly formatted file")
+		: strerror (errno)));
+
+      status = print_database (db_file);
+
+      db_file->close (db_file->db, 0);
+
+      return status;
+    }
+
+  /* Open input file.  */
+  if (strcmp (input_name, "-") == 0 || strcmp (input_name, "/dev/stdin") == 0)
+    input_file = stdin;
+  else
+    {
+      struct stat st;
+
+      input_file = fopen (input_name, "r");
+      if (input_file == NULL)
+	error (EXIT_FAILURE, errno, gettext ("cannot open input file `%s'"),
+	       input_name);
+
+      /* Get the access rights from the source file.  The output file should
+	 have the same.  */
+      if (fstat (fileno (input_file), &st) >= 0)
+	mode = st.st_mode & ACCESSPERMS;
+    }
+
+  /* Open output file.  This must not be standard output so we don't
+     handle "-" and "/dev/stdout" special.  */
+  dbopen (output_name, DB_CREATE | db_truncate, mode, &db_file);
+  if (db_file == NULL)
+    error (EXIT_FAILURE, errno, gettext ("cannot open output file `%s'"),
+	   output_name);
+
+  /* Start the real work.  */
+  status = process_input (input_file, input_name, db_file, to_lowercase,
+			  be_quiet);
+
+  /* Close files.  */
+  if (input_file != stdin)
+    fclose (input_file);
+  db_file->close (db_file->db, 0);
+
+  return status;
+}
+
+
+/* Handle program arguments.  */
+static error_t
+parse_opt (int key, char *arg, struct argp_state *state)
+{
+  switch (key)
+    {
+    case 'f':
+      to_lowercase = 1;
+      break;
+    case 'o':
+      output_name = arg;
+      break;
+    case 'q':
+      be_quiet = 1;
+      break;
+    case 'u':
+      do_undo = 1;
+      break;
+    default:
+      return ARGP_ERR_UNKNOWN;
+    }
+  return 0;
+}
+
+
+static char *
+more_help (int key, const char *text, void *input)
+{
+  switch (key)
+    {
+    case ARGP_KEY_HELP_EXTRA:
+      /* We print some extra information.  */
+      return strdup (gettext ("\
+Report bugs using the `glibcbug' script to <bugs@gnu.org>.\n"));
+    default:
+      break;
+    }
+  return (char *) text;
+}
+
+/* Print the version information.  */
+static void
+print_version (FILE *stream, struct argp_state *state)
+{
+  fprintf (stream, "makedb (GNU %s) %s\n", PACKAGE, VERSION);
+  fprintf (stream, gettext ("\
+Copyright (C) %s Free Software Foundation, Inc.\n\
+This is free software; see the source for copying conditions.  There is NO\n\
+warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\
+"), "2000");
+  fprintf (stream, gettext ("Written by %s.\n"), "Ulrich Drepper");
+}
+
+
+static int
+process_input (input, inname, output, to_lowercase, be_quiet)
+     FILE *input;
+     const char *inname;
+     NSS_DB *output;
+     int to_lowercase;
+     int be_quiet;
+{
+  char *line;
+  size_t linelen;
+  int status;
+  size_t linenr;
+
+  line = NULL;
+  linelen = 0;
+  status = EXIT_SUCCESS;
+  linenr = 0;
+
+  while (!feof (input))
+    {
+      DBT key;
+      DBT val;
+      char *cp;
+      int n;
+
+      n = getline (&line, &linelen, input);
+      if (n < 0)
+	/* This means end of file or some bug.  */
+	break;
+      if (n == 0)
+	/* Short read.  Probably interrupted system call. */
+	continue;
+
+      ++linenr;
+
+      if (line[n - 1] == '\n')
+	/* Remove trailing newline.  */
+	line[--n] = '\0';
+
+      cp = line;
+      while (isspace (*cp))
+	++cp;
+
+      if (*cp == '#')
+	/* First non-space character in line '#': it's a comment.  */
+	continue;
+
+      key.data = cp;
+      while (*cp != '\0' && !isspace (*cp))
+	{
+	  if (to_lowercase)
+	    *cp = tolower (*cp);
+	  ++cp;
+	}
+
+      if (key.data == cp)
+	/* It's an empty line.  */
+	continue;
+
+      key.size = cp - (char *) key.data;
+      key.flags = 0;
+
+      while (isspace (*cp))
+	++cp;
+
+      val.data = cp;
+      val.size = (&line[n] - cp) + 1;
+      val.flags = 0;
+
+      /* Store the value.  */
+      status = output->put (output->db, NULL, &key, &val, db_nooverwrite);
+      if (status != 0)
+	{
+	  if (status == db_keyexist)
+	    {
+	      if (!be_quiet)
+		error_at_line (0, 0, inname, linenr,
+			       gettext ("duplicate key"));
+	      /* This is no real error.  Just give a warning.  */
+	      status = 0;
+	      continue;
+	    }
+	  else
+	    error (0, status, gettext ("while writing database file"));
+
+	  status = EXIT_FAILURE;
+
+	  clearerr (input);
+	  break;
+	}
+    }
+
+  if (ferror (input))
+    {
+      error (0, 0, gettext ("problems while reading `%s'"), inname);
+      status = EXIT_FAILURE;
+    }
+
+  return status;
+}
+
+
+static int
+print_database (db)
+     NSS_DB *db;
+{
+  DBT key;
+  DBT val;
+  NSS_DBC *cursor;
+  int status;
+
+  status = db->cursor (db->db, NULL, &cursor);
+  if (status != 0)
+    {
+      error (0, status, gettext ("while reading database"));
+      return EXIT_FAILURE;
+    }
+
+  key.flags = 0;
+  val.flags = 0;
+  status = cursor->c_get (cursor->cursor, &key, &val, db_first);
+  while (status == 0)
+    {
+      printf ("%.*s %s\n", (int) key.size, (char *) key.data,
+	      (char *) val.data);
+
+      status = cursor->c_get (cursor->cursor, &key, &val, db_next);
+    }
+
+  if (status != db_notfound)
+    {
+      error (0, status, gettext ("while reading database"));
+      return EXIT_FAILURE;
+    }
+
+  return EXIT_SUCCESS;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/nss_db/db-XXX.c ../glibc-2.3/nss/nss_db/db-XXX.c
--- glibc-2.2.93/nss/nss_db/db-XXX.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/nss_db/db-XXX.c	Fri Jul  6 00:55:38 2001
@@ -0,0 +1,261 @@
+/* Common code for DB-based databases in nss_db module.
+   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <dlfcn.h>
+#include <fcntl.h>
+#include <bits/libc-lock.h>
+#include "nsswitch.h"
+#include "nss_db.h"
+
+/* These symbols are defined by the including source file:
+
+   ENTNAME -- database name of the structure and functions (hostent, pwent).
+   STRUCTURE -- struct name, define only if not ENTNAME (passwd, group).
+   DATABASE -- database file name, ("hosts", "passwd")
+
+   NEED_H_ERRNO - defined iff an arg `int *herrnop' is used.
+*/
+
+#define ENTNAME_r	CONCAT(ENTNAME,_r)
+
+#include <paths.h>
+#define	DBFILE		_PATH_VARDB DATABASE ".db"
+
+#ifdef NEED_H_ERRNO
+#define H_ERRNO_PROTO	, int *herrnop
+#define H_ERRNO_ARG	, herrnop
+#define H_ERRNO_SET(val) (*herrnop = (val))
+#else
+#define H_ERRNO_PROTO
+#define H_ERRNO_ARG
+#define H_ERRNO_SET(val) ((void) 0)
+#endif
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Maintenance of the shared handle open on the database.  */
+
+static NSS_DB *db;
+static int keep_db;
+static int entidx;
+
+
+/* Open the database.  */
+enum nss_status
+CONCAT(_nss_db_set,ENTNAME) (int stayopen)
+{
+  enum nss_status status;
+
+  __libc_lock_lock (lock);
+
+  status = internal_setent (DBFILE, &db);
+
+  /* Remember STAYOPEN flag.  */
+  if (db != NULL)
+    keep_db |= stayopen;
+  /* Reset the sequential index.  */
+  entidx = 0;
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
+
+
+/* Close it again.  */
+enum nss_status
+CONCAT(_nss_db_end,ENTNAME) (void)
+{
+  __libc_lock_lock (lock);
+
+  internal_endent (&db);
+
+  /* Reset STAYOPEN flag.  */
+  keep_db = 0;
+
+  __libc_lock_unlock (lock);
+
+  return NSS_STATUS_SUCCESS;
+}
+
+/* Do a database lookup for KEY.  */
+static enum nss_status
+lookup (DBT *key, struct STRUCTURE *result,
+	void *buffer, size_t buflen, int *errnop H_ERRNO_PROTO EXTRA_ARGS_DECL)
+{
+  char *p;
+  enum nss_status status;
+  int err;
+  DBT value;
+
+  /* Open the database.  */
+  if (db == NULL)
+    {
+      status = internal_setent (DBFILE, &db);
+      if (status != NSS_STATUS_SUCCESS)
+	{
+	  *errnop = errno;
+	  H_ERRNO_SET (NETDB_INTERNAL);
+	  return status;
+	}
+    }
+
+  /* Succeed iff it matches a value that parses correctly.  */
+  value.flags = 0;
+  err = DL_CALL_FCT (db->get, (db->db, NULL, key, &value, 0));
+  if (err != 0)
+    {
+      if (err == db_notfound)
+	{
+	  H_ERRNO_SET (HOST_NOT_FOUND);
+	  status = NSS_STATUS_NOTFOUND;
+	}
+      else
+	{
+	  *errnop = err;
+	  H_ERRNO_SET (NETDB_INTERNAL);
+	  status = NSS_STATUS_UNAVAIL;
+	}
+    }
+  else if (buflen < value.size)
+    {
+      /* No room to copy the data to.  */
+      *errnop = ERANGE;
+      H_ERRNO_SET (NETDB_INTERNAL);
+      status = NSS_STATUS_TRYAGAIN;
+    }
+  else
+    {
+      /* Copy the result to a safe place.  */
+      p = (char *) memcpy (buffer, value.data, value.size);
+
+      /* Skip leading blanks.  */
+      while (isspace (*p))
+	++p;
+
+      err = parse_line (p, result, buffer, buflen, errnop EXTRA_ARGS);
+
+      if (err == 0)
+	{
+	  /* If the key begins with '0' we are trying to get the next
+	     entry.  We want to ignore unparsable lines in this case.  */
+	  if (((char *) key->data)[0] == '0')
+	    {
+	      /* Super magical return value.  We need to tell our caller
+		 that it should continue looping.  This value cannot
+		 happen in other cases.  */
+	      status = NSS_STATUS_RETURN;
+	    }
+	  else
+	    {
+	      H_ERRNO_SET (HOST_NOT_FOUND);
+	      status = NSS_STATUS_NOTFOUND;
+	    }
+	}
+      else if (err < 0)
+	{
+	  H_ERRNO_SET (NETDB_INTERNAL);
+	  status = NSS_STATUS_TRYAGAIN;
+	}
+      else
+	status = NSS_STATUS_SUCCESS;
+    }
+
+  if (! keep_db)
+    internal_endent (&db);
+
+  return status;
+}
+
+
+/* Macro for defining lookup functions for this DB-based database.
+
+   NAME is the name of the lookup; e.g. `pwnam'.
+
+   KEYPATTERN gives `printf' args to construct a key string;
+   e.g. `(".%s", name)'.
+
+   KEYSIZE gives the allocation size of a buffer to construct it in;
+   e.g. `1 + strlen (name)'.
+
+   PROTO describes the arguments for the lookup key;
+   e.g. `const char *name'.
+
+   BREAK_IF_MATCH is ignored, but used by ../nss_files/files-XXX.c.  */
+
+#define DB_LOOKUP(name, keysize, keypattern, break_if_match, proto...)	      \
+enum nss_status								      \
+_nss_db_get##name##_r (proto,						      \
+		       struct STRUCTURE *result,			      \
+		       char *buffer, size_t buflen, int *errnop H_ERRNO_PROTO)\
+{									      \
+  DBT key;								      \
+  enum nss_status status;						      \
+  const size_t size = (keysize) + 1;					      \
+  key.data = __alloca (size);						      \
+  key.size = KEYPRINTF keypattern;					      \
+  key.flags = 0;							      \
+  __libc_lock_lock (lock);						      \
+  status = lookup (&key, result, buffer, buflen, errnop H_ERRNO_ARG	      \
+		   EXTRA_ARGS_VALUE);					      \
+  __libc_lock_unlock (lock);						      \
+  return status;							      \
+}
+
+#define KEYPRINTF(pattern, args...) snprintf (key.data, size, pattern ,##args)
+
+
+
+
+/* Return the next entry from the database file, doing locking.  */
+enum nss_status
+CONCAT(_nss_db_get,ENTNAME_r) (struct STRUCTURE *result, char *buffer,
+			       size_t buflen, int *errnop H_ERRNO_PROTO)
+{
+  /* Return next entry in host file.  */
+  enum nss_status status;
+  char buf[20];
+  DBT key;
+
+  __libc_lock_lock (lock);
+
+  /* Loop until we find a valid entry or hit EOF.  See above for the
+     special meaning of the status value.  */
+  do
+    {
+      key.size = snprintf (key.data = buf, sizeof buf, "0%u", entidx++);
+      key.flags = 0;
+      status = lookup (&key, result, buffer, buflen, errnop H_ERRNO_ARG
+		       EXTRA_ARGS_VALUE);
+      if (status == NSS_STATUS_TRYAGAIN
+#ifdef NEED_H_ERRNO
+	  && *herrnop == NETDB_INTERNAL
+#endif
+	  && *errnop == ERANGE)
+	/* Give the user a chance to get the same entry with a larger
+	   buffer.  */
+	--entidx;
+    }
+  while (status == NSS_STATUS_RETURN);
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/nss_db/db-alias.c ../glibc-2.3/nss/nss_db/db-alias.c
--- glibc-2.2.93/nss/nss_db/db-alias.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/nss_db/db-alias.c	Fri Jul  6 00:55:38 2001
@@ -0,0 +1,215 @@
+/* Mail alias file parser in nss_db module.
+   Copyright (C) 1996, 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <aliases.h>
+#include <alloca.h>
+#include <ctype.h>
+#include <dlfcn.h>
+#include <errno.h>
+#include <bits/libc-lock.h>
+#include <paths.h>
+#include <string.h>
+
+#include "nsswitch.h"
+#include "nss_db.h"
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Maintenance of the shared handle open on the database.  */
+
+static NSS_DB *db;
+static int keep_db;
+static unsigned int entidx;	/* Index for `getaliasent_r'. */
+
+
+/* Open database.  */
+enum nss_status
+_nss_db_setaliasent (int stayopen)
+{
+  enum nss_status status;
+
+  __libc_lock_lock (lock);
+
+  status = internal_setent (_PATH_VARDB "aliases.db", &db);
+
+  /* Remember STAYOPEN flag.  */
+  if (db != NULL)
+    keep_db |= stayopen;
+
+  /* Reset the sequential index.  */
+  entidx = 0;
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
+
+
+/* Close it again.  */
+enum nss_status
+_nss_db_endaliasent (void)
+{
+  __libc_lock_lock (lock);
+
+  internal_endent (&db);
+
+  /* Reset STAYOPEN flag.  */
+  keep_db = 0;
+
+  __libc_lock_unlock (lock);
+
+  return NSS_STATUS_SUCCESS;
+}
+
+/* We provide the parse function here.  The parser in libnss_files
+   cannot be used.  The generation of the db file already resolved all
+   :include: statements so we simply have to parse the list and store
+   the result.  */
+static enum nss_status
+lookup (DBT *key, struct aliasent *result, char *buffer,
+	size_t buflen, int *errnop)
+{
+  enum nss_status status;
+  DBT value;
+
+  /* Open the database.  */
+  if (db == NULL)
+    {
+      status = internal_setent (_PATH_VARDB "aliases.db", &db);
+      if (status != NSS_STATUS_SUCCESS)
+	{
+	  *errnop = errno;
+	  return status;
+	}
+    }
+
+  value.flags = 0;
+  if (DL_CALL_FCT (db->get, (db->db, NULL, key, &value, 0)) == 0)
+    {
+      const char *src = value.data;
+      char *cp;
+      size_t cnt;
+
+      result->alias_members_len = 0;
+
+      /* We now have to fill the BUFFER with all the information. */
+      if (buflen < key->size + 1)
+	{
+	no_more_room:
+	  *errnop = ERANGE;
+	  return NSS_STATUS_TRYAGAIN;
+	}
+
+      buffer = stpncpy (buffer, key->data, key->size) + 1;
+      buflen -= key->size + 1;
+
+      while (*src != '\0')
+	{
+	  const char *end, *upto;
+	  while (isspace (*src))
+	    ++src;
+
+	  end = strchr (src, ',');
+	  if (end == NULL)
+	    end = strchr (src, '\0');
+	  for (upto = end; upto > src && isspace (upto[-1]); --upto);
+
+	  if (upto != src)
+	    {
+	      if ((upto - src) + __alignof__ (char *) > buflen)
+		goto no_more_room;
+	      buffer = stpncpy (buffer, src, upto - src) + 1;
+	      buflen -= (upto - src) + __alignof (char *);
+	      ++result->alias_members_len;
+	    }
+	  src = end + (*end != '\0');
+	}
+
+      /* Now prepare the return.  Provide string pointers for the
+	 currently selected aliases.  */
+
+      /* Adjust the pointer so it is aligned for storing pointers.  */
+      buffer += __alignof__ (char *) - 1;
+      buffer -= ((buffer - (char *) 0) % __alignof__ (char *));
+      result->alias_members = (char **) buffer;
+
+      /* Compute addresses of alias entry strings.  */
+      cp = result->alias_name;
+      for (cnt = 0; cnt < result->alias_members_len; ++cnt)
+	{
+	  cp = strchr (cp, '\0') + 1;
+	  result->alias_members[cnt] = cp;
+	}
+
+      status = (result->alias_members_len == 0
+		? NSS_STATUS_RETURN : NSS_STATUS_SUCCESS);
+    }
+  else
+    status = NSS_STATUS_NOTFOUND;
+
+  if (! keep_db)
+    internal_endent (&db);
+
+  return status;
+}
+
+enum nss_status
+_nss_db_getaliasent_r (struct aliasent *result, char *buffer, size_t buflen,
+		       int *errnop)
+{
+  /* Return next entry in alias file.  */
+  enum nss_status status;
+  char buf[20];
+  DBT key;
+
+  __libc_lock_lock (lock);
+  key.size = snprintf (key.data = buf, sizeof buf, "0%u", entidx++);
+  key.flags = 0;
+  status = lookup (&key, result, buffer, buflen, errnop);
+  if (status == NSS_STATUS_TRYAGAIN && *errnop == ERANGE)
+    /* Give the user a chance to get the same entry with a larger buffer.  */
+    --entidx;
+  __libc_lock_unlock (lock);
+
+  return status;
+}
+
+
+enum nss_status
+_nss_db_getaliasbyname_r (const char *name, struct aliasent *result,
+			  char *buffer, size_t buflen, int *errnop)
+{
+  DBT key;
+  enum nss_status status;
+
+  key.size = 1 + strlen (name);
+
+  key.data = __alloca (key.size);
+  ((char *) key.data)[0] = '.';
+  memcpy (&((char *) key.data)[1], name, key.size - 1);
+  key.flags = 0;
+
+  __libc_lock_lock (lock);
+  status = lookup (&key, result, buffer, buflen, errnop);
+  __libc_lock_unlock (lock);
+
+  return status;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/nss_db/db-netgrp.c ../glibc-2.3/nss/nss_db/db-netgrp.c
--- glibc-2.2.93/nss/nss_db/db-netgrp.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/nss_db/db-netgrp.c	Fri Jul  6 00:55:38 2001
@@ -0,0 +1,103 @@
+/* Netgroup file parser in nss_db modules.
+   Copyright (C) 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <dlfcn.h>
+#include <errno.h>
+#include <fcntl.h>
+#include <netgroup.h>
+#include <string.h>
+#include <bits/libc-lock.h>
+#include <paths.h>
+
+#include "nsswitch.h"
+#include "nss_db.h"
+
+
+#define DBFILE		_PATH_VARDB "netgroup.db"
+
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Maintenance of the shared handle open on the database.  */
+static NSS_DB *db;
+static char *entry;
+static char *cursor;
+
+enum nss_status
+_nss_db_setnetgrent (const char *group)
+{
+  enum nss_status status;
+
+  __libc_lock_lock (lock);
+
+  status = internal_setent (DBFILE, &db);
+
+  if (status == NSS_STATUS_SUCCESS)
+    {
+      DBT key = { data: (void *) group, size: strlen (group), flags: 0 };
+      DBT value;
+
+      value.flags = 0;
+      if (DL_CALL_FCT (db->get, (db->db, NULL, &key, &value, 0)) != 0)
+	status = NSS_STATUS_NOTFOUND;
+      else
+	cursor = entry = value.data;
+    }
+
+  __libc_lock_unlock (lock);
+
+  return status;
+
+}
+
+
+enum nss_status
+_nss_db_endnetgrent (void)
+{
+  __libc_lock_lock (lock);
+
+  internal_endent (&db);
+
+  __libc_lock_unlock (lock);
+
+  return NSS_STATUS_SUCCESS;
+}
+
+
+extern enum nss_status _nss_netgroup_parseline (char **cursor,
+						struct __netgrent *result,
+						char *buffer, size_t buflen,
+						int *errnop);
+
+enum nss_status
+_nss_db_getnetgrent_r (struct __netgrent *result, char *buffer, size_t buflen,
+		       int *errnop)
+{
+  int status;
+
+  __libc_lock_lock (lock);
+
+  status = _nss_netgroup_parseline (&cursor, result, buffer, buflen, errnop);
+
+  __libc_lock_unlock (lock);
+
+  return status;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/nss_db/db-open.c ../glibc-2.3/nss/nss_db/db-open.c
--- glibc-2.2.93/nss/nss_db/db-open.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/nss_db/db-open.c	Fri Jul  6 00:55:38 2001
@@ -0,0 +1,389 @@
+/* Common database routines for nss_db.
+   Copyright (C) 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <errno.h>
+#include <fcntl.h>
+#include <dlfcn.h>
+#include <stdlib.h>
+#include <string.h>
+#include <bits/libc-lock.h>
+
+#include "dummy-db.h"
+#include "nss_db.h"
+
+/* This file contains the functions used to open and close the databases
+   read by the rest of libnss_db.  Not all of them are thread safe;
+   make sure the caller does the appropriate locking.
+
+   We dynamically load the database library, so that it does not have
+   to be present when glibc is compiled.  Once loaded, the database
+   library is never never unloaded again until the libnss_db module is
+   unloaded (from the free_mem routine in nsswitch.c) -- we catch the
+   unload by providing a shlib destructor.  (XXX Does that actually
+   work?)  */
+
+/* Handle for the shared Berkeley DB library.  If non-null, the
+   database library is completely loaded and ready to be used by
+   multithreaded code.  */
+static void *libdb_handle;
+
+/* The version of the Berkeley DB library we are using.  */
+enum {
+  nodb,
+  db24,
+  db27,
+  db30
+} libdb_version;
+
+/* Pointer to the db_open function.  For use with DB 2.x.  */
+static int (*libdb_db_open) (const char *, int,
+			     uint32_t, int, void *, void *, void **);
+
+/* Pointer to the db_create function.  For use with DB 3.x.  */
+static int (*libdb_db_create) (void *, void *, uint32_t);
+
+/* Constants which vary from version to version are actually variables
+   here.  */
+int db_first;
+int db_next;
+int db_nooverwrite;
+int db_truncate;
+int db_rdonly;
+/* Variables which keep track of the error values.  */
+int db_keyexist;
+int db_notfound;
+
+/* Locks the static variables in this file.  */
+__libc_lock_define_initialized (static, lock)
+
+/* Dynamically load the database library.  Return zero if successful,
+   non-zero if no suitable version of the library could be loaded.
+   Must be called with the above lock held if it might run in a
+   multithreaded context.
+
+   We try currently:
+   - libdb.so.3: the name used by glibc 2.1
+   - libdb-3.0.so: the name used by db-3.0.x
+   and maybe others in the future.  */
+
+enum nss_status
+load_db (void)
+{
+  static const char *libnames[] = { "libdb.so.3", "libdb-3.0.so" };
+  int x;
+
+  for (x = 0; x < sizeof (libnames) / sizeof (libnames[0]); ++x)
+    {
+      libdb_handle = dlopen (libnames[x], RTLD_LAZY);
+      if (libdb_handle == NULL)
+	continue;
+
+      /* DB 3.0 has db_create instead of db_open.  */
+      libdb_db_create = dlsym (libdb_handle, "db_create");
+
+      if (libdb_db_create == NULL)
+	/* DB 2.x uses db_open.  */
+	libdb_db_open = dlsym (libdb_handle, "db_open");
+
+      if (libdb_db_open != NULL || libdb_db_create != NULL)
+	{
+	  /* Alright, we got a library.  Now find out which version it is.  */
+	  const char *(*db_version) (int *, int *, int *);
+
+	  db_version = dlsym (libdb_handle, "db_version");
+	  if (db_version != NULL)
+	    {
+	      /* Call the function and get the information.  */
+	      int major, minor, subminor;
+
+	      DL_CALL_FCT (db_version, (&major, &minor, &subminor));
+	      switch (major)
+		{
+		case 2:
+		  /* Sanity check: Do we have db_open?  */
+		  if (libdb_db_open != NULL)
+		    {
+		      if (minor < 6 || (minor == 6 && subminor < 4))
+			{
+			  libdb_version = db24;
+			  db_first = DB24_FIRST;
+			  db_next = DB24_NEXT;
+			  db_nooverwrite = DB24_NOOVERWRITE;
+			  db_truncate = DB24_TRUNCATE;
+			}
+		      else
+			{
+			  libdb_version = db27;
+			  db_first = DB27_FIRST;
+			  db_next = DB27_NEXT;
+			  db_nooverwrite = DB27_NOOVERWRITE;
+			  db_truncate = DB27_TRUNCATE;
+			}
+		      db_keyexist = DB2x_KEYEXIST;
+		      db_notfound = DB2x_NOTFOUND;
+		      db_rdonly = DB2x_RDONLY;
+		    }
+		  break;
+
+		case 3:
+		  /* Sanity check: Do we have db_create?  */
+		  if (libdb_db_create != NULL)
+		    {
+		      libdb_version = db30;
+		      db_first = DB30_FIRST;
+		      db_next = DB30_NEXT;
+		      db_keyexist = DB30_KEYEXIST;
+		      db_notfound = DB30_NOTFOUND;
+		      db_rdonly = DB30_RDONLY;
+		    }
+		  break;
+
+		default:
+		  break;
+		}
+	    }
+
+	  if (libdb_version != nodb)
+	    return NSS_STATUS_SUCCESS;
+
+	  /* Clear variables.  */
+	  libdb_db_open = NULL;
+	  libdb_db_create = NULL;
+	}
+
+      dlclose (libdb_handle);
+    }
+
+  (void) dlerror ();
+  return NSS_STATUS_UNAVAIL;
+}
+
+/* Set the `FD_CLOEXEC' flag of FD.  Return 0 on success, or -1 on
+   error with `errno' set. */
+static int
+set_cloexec_flag (int fd)
+{
+  int oldflags = fcntl (fd, F_GETFD, 0);
+
+  if (oldflags < 0)
+    return oldflags;
+
+  oldflags |= FD_CLOEXEC;
+
+  return fcntl (fd, F_SETFD, oldflags);
+}
+
+/* Make sure we don't use the library anymore once we are shutting down.  */
+static void __attribute__ ((destructor))
+unload_db (void)
+{
+  if (libdb_handle != NULL)
+    {
+      libdb_db_open = NULL;
+      libdb_db_create = NULL;
+      libdb_version = nodb;
+      dlclose (libdb_handle);
+    }
+}
+
+/* Open the database stored in FILE.  If succesful, store the database
+   handle in *DBP and return NSS_STATUS_SUCCESS.  On failure, return
+   the appropriate lookup status.  */
+enum nss_status
+internal_setent (const char *file, NSS_DB **dbp)
+{
+  enum nss_status status = NSS_STATUS_SUCCESS;
+
+  if (*dbp == NULL)
+    {
+      if (libdb_db_open == NULL && libdb_db_create == NULL)
+	{
+	  __libc_lock_lock (lock);
+
+	  if (libdb_db_open == NULL && libdb_db_create == NULL)
+	    status = load_db ();
+
+	  __libc_lock_unlock (lock);
+	}
+
+      if (status == NSS_STATUS_SUCCESS)
+	status = dbopen (file, db_rdonly, 0, dbp);
+    }
+
+  return status;
+}
+
+
+/* Close the database *DBP.  */
+void
+internal_endent (NSS_DB **dbp)
+{
+  NSS_DB *db = *dbp;
+
+  if (db != NULL)
+    {
+      DL_CALL_FCT (db->close, (db->db, 0));
+      *dbp = NULL;
+    }
+}
+
+/* Allocate a cursor for database DB and transaction TXN.  On success,
+   store the cursor in *DBCP and return zero.  Otherwise return an
+   error value.  */
+int
+db_cursor (void *db, void *txn, NSS_DBC **dbcp)
+{
+  NSS_DBC *dbc;
+  int ret;
+
+  dbc = (NSS_DBC *) malloc (sizeof (NSS_DBC));
+  if (dbc == NULL)
+    return ENOMEM;
+
+  switch (libdb_version)
+    {
+    case db24:
+      ret = ((struct db24 *) db)->cursor (db, txn, &dbc->cursor);
+
+      if (ret == 0)
+	dbc->c_get = ((struct dbc24 *) dbc->cursor)->c_get;
+      break;
+
+    case db27:
+      ret = ((struct db27 *) db)->cursor (db, txn, &dbc->cursor, 0);
+
+      if (ret == 0)
+	dbc->c_get = ((struct dbc27 *) dbc->cursor)->c_get;
+      break;
+
+    case db30:
+      ret = ((struct db30 *) db)->cursor (db, txn, &dbc->cursor, 0);
+
+      if (ret == 0)
+	dbc->c_get = ((struct dbc30 *) dbc->cursor)->c_get;
+      break;
+
+    default:
+      abort ();
+    }
+
+  if (ret != 0)
+    {
+      free (dbc);
+      return ret;
+    }
+
+  *dbcp = dbc;
+
+  return 0;
+}
+
+
+/* Open the database in FNAME, for access specified by FLAGS.  If
+   opening the database causes the file FNAME to be created, it is
+   created with MODE.  If succesful, store the database handle in *DBP
+   and return NSS_STATUS_SUCCESS.  On failure, return the appropriate
+   lookup status.  */
+int
+dbopen (const char *fname, int oper, int mode, NSS_DB **dbp)
+{
+  int err;
+  int fd;
+  NSS_DB *db;
+
+  /* Construct the object we pass up.  */
+  db = (NSS_DB *) calloc (1, sizeof (NSS_DB));
+  if (db == NULL)
+    return NSS_STATUS_UNAVAIL;
+
+  /* Initialize the object.  */
+  db->cursor = db_cursor;
+
+  /* Actually open the database.  */
+  switch (libdb_version)
+    {
+    case db24:
+    case db27:
+      err = DL_CALL_FCT (libdb_db_open,
+			 (fname, DB_BTREE, oper, mode, NULL, NULL, &db->db));
+      if (err != 0)
+	goto fail;
+
+      if (libdb_version)
+	{
+	  db->close = ((struct db24 *) db->db)->close;
+	  db->fd = ((struct db24 *) db->db)->fd;
+	  db->get = ((struct db24 *) db->db)->get;
+	  db->put = ((struct db24 *) db->db)->put;
+	}
+      else
+	{
+	  db->close = ((struct db27 *) db->db)->close;
+	  db->fd = ((struct db27 *) db->db)->fd;
+	  db->get = ((struct db27 *) db->db)->get;
+	  db->put = ((struct db27 *) db->db)->put;
+	}
+      break;
+
+    case db30:
+      err = DL_CALL_FCT (libdb_db_create, (db->db, NULL, 0));
+      if (err != 0)
+	goto fail;
+
+      db->close = ((struct db30 *) db->db)->close;
+      db->fd = ((struct db30 *) db->db)->fd;
+      db->get = ((struct db30 *) db->db)->get;
+      db->put = ((struct db30 *) db->db)->put;
+
+      err = ((struct db30 *) db->db)->open (db->db, fname, NULL, DB_BTREE,
+					    oper, mode);
+      if (err != 0)
+	goto fail;
+      break;
+
+    default:
+      abort ();
+    }
+
+  /* We have to make sure the file is `closed on exec'.  */
+  err = DL_CALL_FCT (db->fd, (db->db, &fd));
+  if (err != 0)
+    goto fail;
+  if (set_cloexec_flag (fd) < 0)
+    goto fail;
+
+  *dbp = db;
+
+  return NSS_STATUS_UNAVAIL;
+
+ fail:
+  /* Something went wrong.  Close the database if necessary.  */
+  if (db)
+    {
+      if (db->db && db->close)
+	DL_CALL_FCT (db->close, (db->db, 0));
+      free (db);
+    }
+
+  /* Make sure `errno' is set.  */
+  if (err)
+    __set_errno (err);
+
+  return err == EAGAIN ? NSS_STATUS_TRYAGAIN : NSS_STATUS_UNAVAIL;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/nss_db/dummy-db.h ../glibc-2.3/nss/nss_db/dummy-db.h
--- glibc-2.2.93/nss/nss_db/dummy-db.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/nss_db/dummy-db.h	Fri Jul  6 00:55:38 2001
@@ -0,0 +1,333 @@
+/* Constants and structures from the various Berkeley DB releases.
+   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <stdint.h>
+
+#include "nss_db.h"
+
+/* This file contains dummy definitions for various constants and
+   structures from the Berkeley release.  We only provide those
+   definitions that are actually needed.  In case of the structures,
+   we're only interested in the function pointers, since that's the
+   interface to the database.  Unfortunately the structures have been
+   changed several times.  */
+
+/* The value for the btree database type has not been changed (yet?).  */
+#define DB_BTREE	(1)
+
+/* Permission flags for all 2.x releases.  */
+#define DB2x_RDONLY	0x010000
+
+/* The error values for all 2.x releases.  */
+#define DB2x_KEYEXIST	( -3)
+#define DB2x_NOTFOUND	( -7)
+
+/* For all 2.x releases up to 2.6.3 we can use the same definitions.
+   We'll refer to them as 2.4 since that's the version distributed
+   with glibc 2.1.  */
+
+/* Access methods from version 2.4.  */
+#define DB24_FIRST		0x000020
+#define DB24_NEXT		0x000800
+#define DB24_NOOVERWRITE	0x001000
+
+/* Permission flags from version 2.4.  */
+#define DB24_TRUNCATE	0x080000
+
+/* The DB structure from version 2.4.  */
+struct db24
+{
+  void	*mutexp;
+  enum { dummy24 } type;
+  void *dbenv;
+  void *mp_dbenv;
+  void *master;
+  void *internal;
+  void *mp;
+  void *mpf;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } curs_queue;
+  struct {
+    void *lh_first;
+  } handleq;
+  struct {
+    void *le_next;
+    void **le_prev;
+  } links;
+  uint32_t log_fileid;
+  void *txn;
+  uint32_t locker;
+  struct db24_dbt {
+    void *data;
+    uint32_t size;
+    uint32_t ulen;
+    uint32_t dlen;
+    uint32_t doff;
+    uint32_t flags;
+  } lock_dbt;
+  struct{
+    uint32_t pgno;
+    uint8_t fileid[20];
+  } lock;
+  size_t pgsize;
+  void *db_malloc;
+  /* Functions. */
+  int (*close) (void *, uint32_t);
+  int (*cursor) (void *, void *, void **);
+  int (*del) (void *, void *, DBT *, uint32_t);
+  int (*fd) (void *, int *);
+  int (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*put) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*stat) (void *, void *, void *(*)(size_t), uint32_t);
+  int (*sync) (void *, uint32_t);
+  uint32_t flags;
+};
+
+/* The DBC structure for the 2.4 release.  */
+struct dbc24
+{
+  void *dbp;
+  void *txn;
+  struct
+  {
+    void *tqe_next;
+    void **tqe_prev;
+  } links;
+  void *internal;
+  void *c_close;
+  void *c_del;
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+  void *c_put;
+};
+
+/* The 2.7 release is slighty different.  */
+
+/* Access methods from version 2.7.  */
+#define DB27_FIRST		7
+#define DB27_NEXT		15
+#define DB27_NOOVERWRITE	17
+
+/* Permission flags from version 2.7.  */
+#define DB27_TRUNCATE	0x020000
+
+/* The DB structure from version 2.7.  */
+struct db27
+{
+  void	*mutexp;
+  enum { dummy27 } type;
+  int byteswapped;
+  int saved_open_fd;
+  void *dbenv;
+  void *mp_dbenv;
+  void *internal;
+  void *mp;
+  void *mpf;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } free_queue;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } active_queue;
+  uint8_t fileid[20];
+  uint32_t log_fileid;
+  size_t pgsize;
+  void *db_malloc;
+  void *dup_compare;
+  void *h_hash;
+  /* Functions. */
+  int (*am_close) (void *);
+  int (*close) (void *, uint32_t);
+  int (*cursor) (void *, void *, void **, uint32_t);
+  int (*del) (void *, void *, DBT *, uint32_t);
+  int (*fd) (void *, int *);
+  int (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*join) (void *, void **, uint32_t, void **);
+  int (*put) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*stat) (void *, void *, void *(*)(size_t), uint32_t);
+  int (*sync) (void *, uint32_t);
+  uint32_t flags;
+};
+
+/* The DBC structure for version 2.7.  */
+struct dbc27
+{
+  void *dbp;
+  void *txn;
+  struct
+  {
+    void *tqe_next;
+    void **tqe_prev;
+  } links;
+  uint32_t lid;
+  uint32_t locker;
+  DBT lock_dbt;
+  struct{
+    uint32_t pgno;
+    uint8_t fileid[20];
+  } lock;
+  size_t mylock;
+  DBT rkey;
+  DBT rdata;
+  void *c_am_close;
+  void *c_am_destroy;
+  void *c_close;
+  void *c_del;
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+  void *c_put;
+  void *internal;
+  uint32_t flags;
+};
+
+/* Version 3.0 is mostly incompatible with 2.x.  */
+
+/* Access methods from version 3.0.  */
+#define DB30_FIRST		9
+#define DB30_NEXT		17
+#define DB30_NOOVERWRITE	20
+
+/* Error values from version 3.0.  */
+#define DB30_KEYEXIST	(-30997)
+#define DB30_NOTFOUND	(-30994)
+
+/* Permission flags from version 3.0.  */
+#define DB30_RDONLY	0x000010
+#define DB30_TRUNCATE	0x020000
+
+/* The DB structure from version 3.0.  */
+struct db30
+{
+  size_t pgsize;
+  void (*db_feedback) (void *, int, int);
+  void *(*db_malloc) (size_t);
+  void *(*db_realloc) (void *, size_t);
+  int (*dup_compare) (const DBT *, const DBT *);
+  void *dbenv;
+  enum { dummy30 } type;
+  void *mpf;
+  void	*mutexp;
+  u_int8_t fileid[20];
+  int32_t log_fileid;
+  void *open_txn;
+  void *saved_open_fhp;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } free_queue;
+  struct
+  {
+    void *tqh_first;
+    void **tqh_last;
+  } active_queue;
+  void	*bt_internal;
+  void	*cj_internal;
+  void	*h_internal;
+  void	*q_internal;
+  void	*xa_internal;
+  /* Functions.  */
+  int  (*close) (void *, uint32_t);
+  int  (*cursor) (void *, void *, void **, uint32_t);
+  int  (*del) (void *, void *, DBT *, uint32_t);
+  void (*err) (void *, int, const char *, ...);
+  void (*errx) (void *, const char *, ...);
+  int  (*fd) (void *, int *);
+  int  (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int  (*get_byteswapped) (void *);
+  int (*get_type) (void *);
+  int  (*join) (void *, void **, void **, uint32_t);
+  int  (*open) (void *,	const char *, const char *, int, uint32_t, int);
+  int  (*put) (void *, void *, DBT *, DBT *, uint32_t);
+  int  (*remove) (void *, const char *, const char *, uint32_t);
+  int  (*set_cachesize) (void *, uint32_t, uint32_t, int);
+  int  (*set_dup_compare) (void *, int (*)(const DBT *, const DBT *));
+  void (*set_errcall) (void *, void (*)(const char *, char *));
+  void (*set_errfile) (void *, void *);
+  void (*set_errpfx) (void *, const char *);
+  void (*set_feedback) (void *, void (*)(void *, int, int));
+  int  (*set_flags) (void *, uint32_t);
+  int  (*set_lorder) (void *, int);
+  int  (*set_malloc) (void *, void *(*)(size_t));
+  int  (*set_pagesize) (void *, uint32_t);
+  void (*set_paniccall) (void *, void (*)(void *, int));
+  int  (*set_realloc) (void *, void *(*)(void *, size_t));
+  int  (*stat) (void *, void *, void *(*)(size_t), uint32_t);
+  int  (*sync) (void *, uint32_t);
+  int  (*upgrade) (void *, const char *, uint32_t);
+
+  int  (*set_bt_compare) (void *, int (*)(const DBT *, const DBT *));
+  int  (*set_bt_maxkey) (void *, uint32_t);
+  int  (*set_bt_minkey) (void *, uint32_t);
+  int  (*set_bt_prefix) (void *, size_t (*)(const DBT *, const DBT *));
+
+  int  (*set_h_ffactor) (void *, uint32_t);
+  int  (*set_h_hash) (void *, uint32_t (*)(const void *, uint32_t));
+  int  (*set_h_nelem) (void *, uint32_t);
+
+  int  (*set_re_delim) (void *, int);
+  int  (*set_re_len) (void *, uint32_t);
+  int  (*set_re_pad) (void *, int);
+  int  (*set_re_source) (void *, const char *);
+
+  uint32_t am_ok;
+  uint32_t flags;
+};
+
+/* The DBC structure from version 3.0.  */
+struct dbc30
+{
+  void *dbp;
+  void *txn;
+  struct
+  {
+    void *tqe_next;
+    void **tqe_prev;
+  } links;
+  uint32_t lid;			/* Default process' locker id. */
+  uint32_t locker;		/* Locker for this operation. */
+  DBT lock_dbt;		/* DBT referencing lock. */
+  struct
+  {
+    uint32_t pgno;
+    uint8_t fileid[20];
+  } lock;
+  struct
+  {
+    size_t off;
+    uint32_t ndx;
+    uint32_t gen;
+  } mylock;
+  DBT rkey;
+  DBT rdata;
+  int (*c_close) (void *);
+  int (*c_del) (void *, uint32_t);
+  int (*c_dup) (void *, void **, uint32_t);
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+  int (*c_put) (void *, DBT *, DBT *, uint32_t);
+  int (*c_am_close) (void *);
+  int (*c_am_destroy) (void *);
+  void *internal;
+  uint32_t flags;
+};
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/nss/nss_db/nss_db.h ../glibc-2.3/nss/nss_db/nss_db.h
--- glibc-2.2.93/nss/nss_db/nss_db.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/nss/nss_db/nss_db.h	Fri Jul  6 00:55:38 2001
@@ -0,0 +1,94 @@
+/* Common database open/close routines for nss_db.
+   Copyright (C) 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _NSS_DB_H
+#define _NSS_DB_H	1
+
+#include <nss.h>
+#include <stdint.h>
+
+/* Variables which keep track of the error values.  */
+extern int db_keyexist;
+extern int db_notfound;
+
+/* This flag is the same for all versions of the Berkeley DB library.  */
+#define DB_CREATE	0x000001
+
+/* But constants which vary from version to version are actually
+   variables here.  */
+extern int db_first;
+extern int db_next;
+extern int db_nooverwrite;
+extern int db_truncate;
+extern int db_rdonly;
+
+/* The `DBT' type is the same in all versions we support.  */
+typedef struct
+{
+  void *data;
+  uint32_t size;
+  uint32_t ulen;
+  uint32_t dlen;
+  uint32_t doff;
+  uint32_t flags;
+} DBT;
+
+/* But the cursor object is very different from version to version.  */
+typedef struct
+{
+  void *cursor;
+  int (*c_get) (void *, DBT *, DBT *, uint32_t);
+} NSS_DBC;
+
+/* We need a helper function for it.  */
+extern int db_cursor (void *db, void *txn, NSS_DBC **dbcp);
+
+/* This is the wrapper we put around the `DB' structures to provide a
+   uniform interface to the higher-level functions.  */
+typedef struct
+{
+  void *db;
+  int (*close) (void *, uint32_t);
+  int (*cursor) (void *, void *, NSS_DBC **);
+  int (*fd) (void *, int *);
+  int (*get) (void *, void *, DBT *, DBT *, uint32_t);
+  int (*put) (void *, void *, DBT *, DBT *, uint32_t);
+} NSS_DB;
+
+/* Open the database stored in FILE.  If succesful, store the database
+   handle in *DBP and return NSS_STATUS_SUCCESS.  On failure, return
+   the appropriate lookup status.  */
+extern enum nss_status internal_setent (const char *file, NSS_DB **dbp);
+
+/* Close the database *DBP.  */
+extern void internal_endent (NSS_DB **dbp);
+
+/* Dynamically load the Berkeley DB library.  Return zero if
+   successful, non-zero if no suitable version of the library could be
+   loaded.  */
+extern enum nss_status load_db (void);
+
+/* Open the database in FNAME, for access specified by FLAGS.  If
+   opening the database causes the file FNAME to be created, it is
+   created with MODE.  If succesful, store the database handle in *DBP
+   and return NSS_STATUS_SUCCESS.  On failure, return the appropriate
+   lookup status.  */
+extern int dbopen (const char *fname, int oper, int mode, NSS_DB **dbp);
+
+#endif	/* nss_db.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/output.txt ../glibc-2.3/output.txt
--- glibc-2.2.93/output.txt	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/output.txt	Mon Sep  2 16:54:46 2002
@@ -0,0 +1,5 @@
+? output.txt
+P elf/rtld.c
+M include/sys/stat.h
+M sysdeps/mach/hurd/dl-sysdep.c
+P sysdeps/powerpc/fpu/libm-test-ulps
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/Makefile ../glibc-2.3/posix/Makefile
--- glibc-2.2.93/posix/Makefile	Mon Aug 26 18:36:04 2002
+++ ../glibc-2.3/posix/Makefile	Thu Sep  5 19:27:51 2002
@@ -72,7 +72,7 @@
 		   tst-truncate64 tst-fork tst-fnmatch tst-regexloc tst-dir \
 		   tst-chmod bug-regex1 bug-regex2 bug-regex3 bug-regex4 \
 		   tst-gnuglob tst-regex bug-regex5 bug-regex6 bug-regex7 \
-		   bug-regex8 bug-regex9 bug-regex10
+		   bug-regex8 bug-regex9 bug-regex10 bug-regex11
 ifeq (yes,$(build-shared))
 test-srcs	:= globtest
 tests           += wordexp-test tst-exec tst-spawn
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/bug-regex11.c ../glibc-2.3/posix/bug-regex11.c
--- glibc-2.2.93/posix/bug-regex11.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/bug-regex11.c	Sat Sep 14 09:40:50 2002
@@ -0,0 +1,88 @@
+/* Regular expression tests.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Jakub Jelinek <jakub@redhat.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/types.h>
+#include <mcheck.h>
+#include <regex.h>
+#include <stdio.h>
+#include <stdlib.h>
+
+struct
+{
+  const char *pattern;
+  const char *string;
+  int nmatch;
+  regmatch_t rm[4];
+} tests[] = {
+  /* Test for newline handling in regex.  */
+  { "[^~]*~", "\nx~y", 2, { { 0, 3 }, { -1, -1 } } },
+  /* Other tests.  */
+  { ".*|\\([KIO]\\)\\([^|]*\\).*|?[KIO]", "10~.~|P|K0|I10|O16|?KSb", 3,
+    { { 0, 21 }, { 15, 16 }, { 16, 18 } } },
+  { ".*|\\([KIO]\\)\\([^|]*\\).*|?\\1", "10~.~|P|K0|I10|O16|?KSb", 3,
+    { { 0, 21 }, { 8, 9 }, { 9, 10 } } }
+};
+
+int
+main (void)
+{
+  regex_t re;
+  regmatch_t rm[4];
+  int n, i, ret = 0;
+
+  mtrace ();
+
+  for (i = 0; i < sizeof (tests) / sizeof (tests[0]); ++i)
+    {
+      n = regcomp (&re, tests[i].pattern, 0);
+      if (n != 0)
+	{
+	  char buf[500];
+	  regerror (n, &re, buf, sizeof (buf));
+	  printf ("regcomp %d failed: %s\n", i, buf);
+	  ret = 1;
+	  continue;
+	}
+
+      if (regexec (&re, tests[i].string, tests[i].nmatch, rm, 0))
+	{
+	  printf ("regexec %d failed\n", i);
+	  ret = 1;
+	  regfree (&re);
+	  continue;
+	}
+
+      for (n = 0; n < tests[i].nmatch; ++n)
+	if (rm[n].rm_so != tests[i].rm[n].rm_so
+              || rm[n].rm_eo != tests[i].rm[n].rm_eo)
+	  {
+	    if (tests[i].rm[n].rm_so == -1 && tests[i].rm[n].rm_eo == -1)
+	      break;
+	    printf ("regexec match failure rm[%d] %d..%d\n",
+		    n, rm[n].rm_so, rm[n].rm_eo);
+	    ret = 1;
+	    break;
+	  }
+
+      regfree (&re);
+    }
+
+  return 0;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/bug-regex5.c ../glibc-2.3/posix/bug-regex5.c
--- glibc-2.2.93/posix/bug-regex5.c	Tue Mar 12 05:20:08 2002
+++ ../glibc-2.3/posix/bug-regex5.c	Sat Sep 14 09:40:50 2002
@@ -11,6 +11,7 @@
   const unsigned char *extra;
   uint32_t nrules;
   char *ca;
+  union locale_data_value u;
 
   ca = setlocale (LC_ALL, "da_DK.ISO-8859-1");
   if (ca == NULL)
@@ -27,7 +28,8 @@
       return 1;
     }
 
-  table_size = (size_t) nl_langinfo (_NL_COLLATE_SYMB_HASH_SIZEMB);
+  u.string = nl_langinfo (_NL_COLLATE_SYMB_HASH_SIZEMB);
+  table_size = u.word;
   symb_table = (const int32_t *) nl_langinfo (_NL_COLLATE_SYMB_TABLEMB);
   extra = (const unsigned char *) nl_langinfo (_NL_COLLATE_SYMB_EXTRAMB);
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/ChangeLog ../glibc-2.3/posix/glob/ChangeLog
--- glibc-2.2.93/posix/glob/ChangeLog	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/ChangeLog	Thu Jul 25 20:34:28 1996
@@ -0,0 +1,23 @@
+Sat Jul 20 21:55:31 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	Win32 hacks from <Rob_Tulloh@tivoli.com>.
+	* posix/glob.c [WIN32]: Don't include <pwd.h>; don't use d_ino;
+	use void * for my_realloc; include <malloc.h> for alloca.
+	(glob) [WIN32]: Use "c:/users/default" for ~ if no HOME variable.
+	* posix/fnmatch.h [WIN32]: Use prototypes even if [!__STDC__].
+	* posix/glob.h: Likewise.
+
+Fri Jul 19 16:56:41 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	* posix/glob.h [!_AMIGA && !VMS]: Check this instead of just [!_AMIGA]
+	for `struct stat;' forward decl.
+
+Sat Jun 22 10:44:09 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	* posix/glob.c: Include <alloca.h> only [HAVE_ALLOCA_H], not [sparc].
+
+Fri Jun 21 00:27:51 1996  Roland McGrath  <roland@delasyd.gnu.ai.mit.edu>
+
+	* posix/fnmatch.c (fnmatch): Fix \*[*?]+ case to increment name ptr
+ 	only for ?s, not for *s.  Fix from Chet Ramey.
+
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/Makefile.ami ../glibc-2.3/posix/glob/Makefile.ami
--- glibc-2.2.93/posix/glob/Makefile.ami	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/Makefile.ami	Mon Aug 26 18:40:48 2002
@@ -0,0 +1,69 @@
+# Makefile for standalone distribution of libglob.a (fnmatch, glob).
+
+# Copyright (C) 1991, 92, 93, 94, 95, 97 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+
+# This library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public License
+# as published by the Free Software Foundation; either version 2.1 of
+# the License, or (at your option) any later version.
+
+# This library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.	See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; see the file COPYING.LIB.  If not,
+# write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+# Boston, MA 02111-1307, USA.
+
+# Ultrix 2.2 make doesn't expand the value of VPATH.
+VPATH = /glob/
+# This must repeat the value, because configure will remove `VPATH = .'.
+srcdir = /glob/
+
+CC = sc
+RM = delete
+CPPFLAGS =
+CFLAGS =
+
+# Information determined by configure.
+DEFS = Define HAVE_HEADER_STDC Define HAVE_UNISTD_H Define HAVE_STRING_H \
+	Define HAVE_DIRENT_H
+
+# How to invoke ar.
+AR = join
+ARFLAGS = as
+
+# How to invoke ranlib.
+RANLIB = ;
+
+.PHONY: all
+all: glob.lib
+
+glob.lib : glob.o fnmatch.o
+	$(AR) $(ARFLAGS) $@ glob.o fnmatch.o
+	$(RANLIB) $@
+
+# For some reason, Unix make wants the dependencies on the source files.
+# Otherwise it refuses to use an implicit rule!
+# And, get this: it doesn't work to use $(srcdir)foo.c!!
+glob.o: $(srcdir)glob.h $(srcdir)fnmatch.h glob.c
+fnmatch.o: $(srcdir)fnmatch.h fnmatch.c
+
+OUTPUT_OPTION =
+.c.o:
+	$(CC) IDir "" \
+	      $(DEFS) $(CPPFLAGS) $(CFLAGS) $< $(OUTPUT_OPTION)
+
+.PHONY: clean realclean glob-clean glob-realclean distclean
+clean glob-clean:
+	-$(RM) glob.lib "#?.o" core
+distclean glob-realclean: clean
+	-$(RM) TAGS tags Makefile config.status config.h config.log
+realcean: distclean
+
+# For inside the C library.
+glob.tar glob.tar.Z:
+	$(MAKE) -C .. $@
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/Makefile.in ../glibc-2.3/posix/glob/Makefile.in
--- glibc-2.2.93/posix/glob/Makefile.in	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/Makefile.in	Mon Aug 26 18:39:49 2002
@@ -0,0 +1,66 @@
+# Makefile for standalone distribution of libglob.a (fnmatch, glob).
+
+# Copyright (C) 1991, 92, 93, 94, 95 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+
+# This library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public License
+# as published by the Free Software Foundation; either version 2.1 of
+# the License, or (at your option) any later version.
+
+# This library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with this library; see the file COPYING.LIB.  If
+# not, write to the Free Software Foundation, Inc., 59 Temple Place, 
+# Suite 330, Boston, MA 02111 USA.
+
+# Ultrix 2.2 make doesn't expand the value of VPATH.
+VPATH = @srcdir@
+# This must repeat the value, because configure will remove `VPATH = .'.
+srcdir = @srcdir@
+
+CC = @CC@
+CPPFLAGS = @CPPFLAGS@
+CFLAGS = @CFLAGS@
+
+# Information determined by configure.
+DEFS = @DEFS@
+
+# How to invoke ar.
+AR = @AR@
+ARFLAGS = rv
+
+# How to invoke ranlib.
+RANLIB = @RANLIB@
+
+.PHONY: all
+all: libglob.a
+
+libglob.a: glob.o fnmatch.o
+	$(AR) $(ARFLAGS) $@ glob.o fnmatch.o
+	$(RANLIB) $@
+
+# For some reason, Unix make wants the dependencies on the source files.
+# Otherwise it refuses to use an implicit rule!
+# And, get this: it doesn't work to use $(srcdir)/foo.c!!
+glob.o: $(srcdir)/glob.h $(srcdir)/fnmatch.h glob.c
+fnmatch.o: $(srcdir)/fnmatch.h fnmatch.c
+
+.c.o:
+	$(CC) -I. -I$(srcdir) -c \
+	      $(DEFS) $(CPPFLAGS) $(CFLAGS) $< $(OUTPUT_OPTION)
+
+.PHONY: clean realclean glob-clean glob-realclean distclean
+clean glob-clean:
+	-rm -f libglob.a *.o core
+distclean glob-realclean: clean
+	-rm -f TAGS tags Makefile config.status config.h config.log
+realcean: distclean
+
+# For inside the C library.
+glob.tar glob.tar.Z:
+	$(MAKE) -C .. $@
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/SCOPTIONS ../glibc-2.3/posix/glob/SCOPTIONS
--- glibc-2.2.93/posix/glob/SCOPTIONS	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/SCOPTIONS	Thu May  9 13:54:36 1996
@@ -0,0 +1,13 @@
+ERRORREXX
+OPTIMIZE
+NOVERSION
+OPTIMIZERTIME
+OPTIMIZERALIAS
+DEFINE INCLUDEDIR="include:"
+DEFINE LIBDIR="lib:"
+DEFINE NO_ALLOCA
+DEFINE NO_FLOAT
+DEFINE NO_ARCHIVES
+IGNORE=161
+IGNORE=100
+STARTUP=cres
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/SMakefile ../glibc-2.3/posix/glob/SMakefile
--- glibc-2.2.93/posix/glob/SMakefile	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/SMakefile	Fri Jul  6 00:55:38 2001
@@ -0,0 +1,68 @@
+# Makefile for standalone distribution of libglob.a (fnmatch, glob).
+# Copyright (C) 1991, 92, 93, 94, 95, 97 Free Software Foundation, Inc.
+# This file is part of the GNU C Library.
+
+# The GNU C Library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+
+# The GNU C Library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+
+# You should have received a copy of the GNU Lesser General Public
+# License along with the GNU C Library; if not, write to the Free
+# Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+# 02111-1307 USA.
+
+# Ultrix 2.2 make doesn't expand the value of VPATH.
+VPATH = /glob/
+# This must repeat the value, because configure will remove `VPATH = .'.
+srcdir = /glob/
+
+CC = sc
+CPPFLAGS =
+CFLAGS =
+MAKE = smake
+RM = delete
+
+# Information determined by configure.
+DEFS = Define HAVE_HEADER_STDC Define HAVE_UNISTD_H Define HAVE_STRING_H \
+	Define HAVE_DIRENT_H
+
+# How to invoke ar.
+AR = join
+ARFLAGS = as
+
+# How to invoke ranlib.
+RANLIB = ;
+
+.PHONY: all
+all: glob.lib
+
+glob.lib : glob.o fnmatch.o
+	$(AR) $(ARFLAGS) $@ glob.o fnmatch.o
+	$(RANLIB) $@
+
+# For some reason, Unix make wants the dependencies on the source files.
+# Otherwise it refuses to use an implicit rule!
+# And, get this: it doesn't work to use $(srcdir)foo.c!!
+glob.o: $(srcdir)glob.h $(srcdir)fnmatch.h glob.c
+fnmatch.o: $(srcdir)fnmatch.h fnmatch.c
+
+.c.o:
+	$(CC) IDir "" \
+	      $(DEFS) $(CPPFLAGS) $(CFLAGS) $< $(OUTPUT_OPTION)
+
+.PHONY: clean realclean glob-clean glob-realclean distclean
+clean glob-clean:
+	-$(RM) -f glob.lib *.o core
+distclean glob-realclean: clean
+	-$(RM) -f TAGS tags Makefile config.status config.h config.log
+realcean: distclean
+
+# For inside the C library.
+glob.tar glob.tar.Z:
+	$(MAKE) -C .. $@
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/configure ../glibc-2.3/posix/glob/configure
--- glibc-2.2.93/posix/glob/configure	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/configure	Fri Mar  1 12:19:22 1996
@@ -0,0 +1,1664 @@
+#! /bin/sh
+
+# Guess values for system-dependent variables and create Makefiles.
+# Generated automatically using autoconf version 2.7 
+# Copyright (C) 1992, 1993, 1994 Free Software Foundation, Inc.
+#
+# This configure script is free software; the Free Software Foundation
+# gives unlimited permission to copy, distribute and modify it.
+
+# Defaults:
+ac_help=
+ac_default_prefix=/usr/local
+# Any additions from configure.in:
+
+# Initialize some variables set by options.
+# The variables have the same names as the options, with
+# dashes changed to underlines.
+build=NONE
+cache_file=./config.cache
+exec_prefix=NONE
+host=NONE
+no_create=
+nonopt=NONE
+no_recursion=
+prefix=NONE
+program_prefix=NONE
+program_suffix=NONE
+program_transform_name=s,x,x,
+silent=
+site=
+srcdir=
+target=NONE
+verbose=
+x_includes=NONE
+x_libraries=NONE
+bindir='${exec_prefix}/bin'
+sbindir='${exec_prefix}/sbin'
+libexecdir='${exec_prefix}/libexec'
+datadir='${prefix}/share'
+sysconfdir='${prefix}/etc'
+sharedstatedir='${prefix}/com'
+localstatedir='${prefix}/var'
+libdir='${exec_prefix}/lib'
+includedir='${prefix}/include'
+oldincludedir='/usr/include'
+infodir='${prefix}/info'
+mandir='${prefix}/man'
+
+# Initialize some other variables.
+subdirs=
+MFLAGS= MAKEFLAGS=
+
+ac_prev=
+for ac_option
+do
+
+  # If the previous option needs an argument, assign it.
+  if test -n "$ac_prev"; then
+    eval "$ac_prev=\$ac_option"
+    ac_prev=
+    continue
+  fi
+
+  case "$ac_option" in
+  -*=*) ac_optarg=`echo "$ac_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
+  *) ac_optarg= ;;
+  esac
+
+  # Accept the important Cygnus configure options, so we can diagnose typos.
+
+  case "$ac_option" in
+
+  -bindir | --bindir | --bindi | --bind | --bin | --bi)
+    ac_prev=bindir ;;
+  -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
+    bindir="$ac_optarg" ;;
+
+  -build | --build | --buil | --bui | --bu)
+    ac_prev=build ;;
+  -build=* | --build=* | --buil=* | --bui=* | --bu=*)
+    build="$ac_optarg" ;;
+
+  -cache-file | --cache-file | --cache-fil | --cache-fi \
+  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
+    ac_prev=cache_file ;;
+  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
+  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
+    cache_file="$ac_optarg" ;;
+
+  -datadir | --datadir | --datadi | --datad | --data | --dat | --da)
+    ac_prev=datadir ;;
+  -datadir=* | --datadir=* | --datadi=* | --datad=* | --data=* | --dat=* \
+  | --da=*)
+    datadir="$ac_optarg" ;;
+
+  -disable-* | --disable-*)
+    ac_feature=`echo $ac_option|sed -e 's/-*disable-//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_feature| sed 's/[-a-zA-Z0-9_]//g'`"; then
+      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
+    fi
+    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
+    eval "enable_${ac_feature}=no" ;;
+
+  -enable-* | --enable-*)
+    ac_feature=`echo $ac_option|sed -e 's/-*enable-//' -e 's/=.*//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_feature| sed 's/[-_a-zA-Z0-9]//g'`"; then
+      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
+    fi
+    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
+    case "$ac_option" in
+      *=*) ;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "enable_${ac_feature}='$ac_optarg'" ;;
+
+  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
+  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
+  | --exec | --exe | --ex)
+    ac_prev=exec_prefix ;;
+  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
+  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
+  | --exec=* | --exe=* | --ex=*)
+    exec_prefix="$ac_optarg" ;;
+
+  -gas | --gas | --ga | --g)
+    # Obsolete; use --with-gas.
+    with_gas=yes ;;
+
+  -help | --help | --hel | --he)
+    # Omit some internal or obsolete options to make the list less imposing.
+    # This message is too long to be a string in the A/UX 3.1 sh.
+    cat << EOF
+Usage: configure [options] [host]
+Options: [defaults in brackets after descriptions]
+Configuration:
+  --cache-file=FILE       cache test results in FILE
+  --help                  print this message
+  --no-create             do not create output files
+  --quiet, --silent       do not print \`checking...' messages
+  --version               print the version of autoconf that created configure
+Directory and file names:
+  --prefix=PREFIX         install architecture-independent files in PREFIX
+                          [$ac_default_prefix]
+  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
+                          [same as prefix]
+  --bindir=DIR            user executables in DIR [EPREFIX/bin]
+  --sbindir=DIR           system admin executables in DIR [EPREFIX/sbin]
+  --libexecdir=DIR        program executables in DIR [EPREFIX/libexec]
+  --datadir=DIR           read-only architecture-independent data in DIR
+                          [PREFIX/share]
+  --sysconfdir=DIR        read-only single-machine data in DIR [PREFIX/etc]
+  --sharedstatedir=DIR    modifiable architecture-independent data in DIR
+                          [PREFIX/com]
+  --localstatedir=DIR     modifiable single-machine data in DIR [PREFIX/var]
+  --libdir=DIR            object code libraries in DIR [EPREFIX/lib]
+  --includedir=DIR        C header files in DIR [PREFIX/include]
+  --oldincludedir=DIR     C header files for non-gcc in DIR [/usr/include]
+  --infodir=DIR           info documentation in DIR [PREFIX/info]
+  --mandir=DIR            man documentation in DIR [PREFIX/man]
+  --srcdir=DIR            find the sources in DIR [configure dir or ..]
+  --program-prefix=PREFIX prepend PREFIX to installed program names
+  --program-suffix=SUFFIX append SUFFIX to installed program names
+  --program-transform-name=PROGRAM
+                          run sed PROGRAM on installed program names
+EOF
+    cat << EOF
+Host type:
+  --build=BUILD           configure for building on BUILD [BUILD=HOST]
+  --host=HOST             configure for HOST [guessed]
+  --target=TARGET         configure for TARGET [TARGET=HOST]
+Features and packages:
+  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
+  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
+  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
+  --x-includes=DIR        X include files are in DIR
+  --x-libraries=DIR       X library files are in DIR
+EOF
+    if test -n "$ac_help"; then
+      echo "--enable and --with options recognized:$ac_help"
+    fi
+    exit 0 ;;
+
+  -host | --host | --hos | --ho)
+    ac_prev=host ;;
+  -host=* | --host=* | --hos=* | --ho=*)
+    host="$ac_optarg" ;;
+
+  -includedir | --includedir | --includedi | --included | --include \
+  | --includ | --inclu | --incl | --inc)
+    ac_prev=includedir ;;
+  -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
+  | --includ=* | --inclu=* | --incl=* | --inc=*)
+    includedir="$ac_optarg" ;;
+
+  -infodir | --infodir | --infodi | --infod | --info | --inf)
+    ac_prev=infodir ;;
+  -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
+    infodir="$ac_optarg" ;;
+
+  -libdir | --libdir | --libdi | --libd)
+    ac_prev=libdir ;;
+  -libdir=* | --libdir=* | --libdi=* | --libd=*)
+    libdir="$ac_optarg" ;;
+
+  -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
+  | --libexe | --libex | --libe)
+    ac_prev=libexecdir ;;
+  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
+  | --libexe=* | --libex=* | --libe=*)
+    libexecdir="$ac_optarg" ;;
+
+  -localstatedir | --localstatedir | --localstatedi | --localstated \
+  | --localstate | --localstat | --localsta | --localst \
+  | --locals | --local | --loca | --loc | --lo)
+    ac_prev=localstatedir ;;
+  -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
+  | --localstate=* | --localstat=* | --localsta=* | --localst=* \
+  | --locals=* | --local=* | --loca=* | --loc=* | --lo=*)
+    localstatedir="$ac_optarg" ;;
+
+  -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
+    ac_prev=mandir ;;
+  -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
+    mandir="$ac_optarg" ;;
+
+  -nfp | --nfp | --nf)
+    # Obsolete; use --without-fp.
+    with_fp=no ;;
+
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c)
+    no_create=yes ;;
+
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
+    no_recursion=yes ;;
+
+  -oldincludedir | --oldincludedir | --oldincludedi | --oldincluded \
+  | --oldinclude | --oldinclud | --oldinclu | --oldincl | --oldinc \
+  | --oldin | --oldi | --old | --ol | --o)
+    ac_prev=oldincludedir ;;
+  -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
+  | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
+  | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
+    oldincludedir="$ac_optarg" ;;
+
+  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
+    ac_prev=prefix ;;
+  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
+    prefix="$ac_optarg" ;;
+
+  -program-prefix | --program-prefix | --program-prefi | --program-pref \
+  | --program-pre | --program-pr | --program-p)
+    ac_prev=program_prefix ;;
+  -program-prefix=* | --program-prefix=* | --program-prefi=* \
+  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
+    program_prefix="$ac_optarg" ;;
+
+  -program-suffix | --program-suffix | --program-suffi | --program-suff \
+  | --program-suf | --program-su | --program-s)
+    ac_prev=program_suffix ;;
+  -program-suffix=* | --program-suffix=* | --program-suffi=* \
+  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
+    program_suffix="$ac_optarg" ;;
+
+  -program-transform-name | --program-transform-name \
+  | --program-transform-nam | --program-transform-na \
+  | --program-transform-n | --program-transform- \
+  | --program-transform | --program-transfor \
+  | --program-transfo | --program-transf \
+  | --program-trans | --program-tran \
+  | --progr-tra | --program-tr | --program-t)
+    ac_prev=program_transform_name ;;
+  -program-transform-name=* | --program-transform-name=* \
+  | --program-transform-nam=* | --program-transform-na=* \
+  | --program-transform-n=* | --program-transform-=* \
+  | --program-transform=* | --program-transfor=* \
+  | --program-transfo=* | --program-transf=* \
+  | --program-trans=* | --program-tran=* \
+  | --progr-tra=* | --program-tr=* | --program-t=*)
+    program_transform_name="$ac_optarg" ;;
+
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil)
+    silent=yes ;;
+
+  -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
+    ac_prev=sbindir ;;
+  -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
+  | --sbi=* | --sb=*)
+    sbindir="$ac_optarg" ;;
+
+  -sharedstatedir | --sharedstatedir | --sharedstatedi \
+  | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
+  | --sharedst | --shareds | --shared | --share | --shar \
+  | --sha | --sh)
+    ac_prev=sharedstatedir ;;
+  -sharedstatedir=* | --sharedstatedir=* | --sharedstatedi=* \
+  | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
+  | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
+  | --sha=* | --sh=*)
+    sharedstatedir="$ac_optarg" ;;
+
+  -site | --site | --sit)
+    ac_prev=site ;;
+  -site=* | --site=* | --sit=*)
+    site="$ac_optarg" ;;
+
+  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
+    ac_prev=srcdir ;;
+  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
+    srcdir="$ac_optarg" ;;
+
+  -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
+  | --syscon | --sysco | --sysc | --sys | --sy)
+    ac_prev=sysconfdir ;;
+  -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
+  | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
+    sysconfdir="$ac_optarg" ;;
+
+  -target | --target | --targe | --targ | --tar | --ta | --t)
+    ac_prev=target ;;
+  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
+    target="$ac_optarg" ;;
+
+  -v | -verbose | --verbose | --verbos | --verbo | --verb)
+    verbose=yes ;;
+
+  -version | --version | --versio | --versi | --vers)
+    echo "configure generated by autoconf version 2.7"
+    exit 0 ;;
+
+  -with-* | --with-*)
+    ac_package=`echo $ac_option|sed -e 's/-*with-//' -e 's/=.*//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_package| sed 's/[-_a-zA-Z0-9]//g'`"; then
+      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
+    fi
+    ac_package=`echo $ac_package| sed 's/-/_/g'`
+    case "$ac_option" in
+      *=*) ;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "with_${ac_package}='$ac_optarg'" ;;
+
+  -without-* | --without-*)
+    ac_package=`echo $ac_option|sed -e 's/-*without-//'`
+    # Reject names that are not valid shell variable names.
+    if test -n "`echo $ac_package| sed 's/[-a-zA-Z0-9_]//g'`"; then
+      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
+    fi
+    ac_package=`echo $ac_package| sed 's/-/_/g'`
+    eval "with_${ac_package}=no" ;;
+
+  --x)
+    # Obsolete; use --with-x.
+    with_x=yes ;;
+
+  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
+  | --x-incl | --x-inc | --x-in | --x-i)
+    ac_prev=x_includes ;;
+  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
+  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
+    x_includes="$ac_optarg" ;;
+
+  -x-libraries | --x-libraries | --x-librarie | --x-librari \
+  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
+    ac_prev=x_libraries ;;
+  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
+  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
+    x_libraries="$ac_optarg" ;;
+
+  -*) { echo "configure: error: $ac_option: invalid option; use --help to show usage" 1>&2; exit 1; }
+    ;;
+
+  *)
+    if test -n "`echo $ac_option| sed 's/[-a-z0-9.]//g'`"; then
+      echo "configure: warning: $ac_option: invalid host type" 1>&2
+    fi
+    if test "x$nonopt" != xNONE; then
+      { echo "configure: error: can only configure for one host and one target at a time" 1>&2; exit 1; }
+    fi
+    nonopt="$ac_option"
+    ;;
+
+  esac
+done
+
+if test -n "$ac_prev"; then
+  { echo "configure: error: missing argument to --`echo $ac_prev | sed 's/_/-/g'`" 1>&2; exit 1; }
+fi
+
+trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
+
+# File descriptor usage:
+# 0 standard input
+# 1 file creation
+# 2 errors and warnings
+# 3 some systems may open it to /dev/tty
+# 4 used on the Kubota Titan
+# 6 checking for... messages and results
+# 5 compiler messages saved in config.log
+if test "$silent" = yes; then
+  exec 6>/dev/null
+else
+  exec 6>&1
+fi
+exec 5>./config.log
+
+echo "\
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+" 1>&5
+
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Also quote any args containing shell metacharacters.
+ac_configure_args=
+for ac_arg
+do
+  case "$ac_arg" in
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c) ;;
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r) ;;
+  *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?]*)
+  ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+  *) ac_configure_args="$ac_configure_args $ac_arg" ;;
+  esac
+done
+
+# NLS nuisances.
+# Only set LANG and LC_ALL to C if already set.
+# These must not be set unconditionally because not all systems understand
+# e.g. LANG=C (notably SCO).
+if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
+if test "${LANG+set}"   = set; then LANG=C;   export LANG;   fi
+
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -rf conftest* confdefs.h
+# AIX cpp loses on an empty file, so make sure it contains at least a newline.
+echo > confdefs.h
+
+# A filename unique to this package, relative to the directory that
+# configure is in, which we can look for to find out if srcdir is correct.
+ac_unique_file=fnmatch.c
+
+# Find the source files, if location was not specified.
+if test -z "$srcdir"; then
+  ac_srcdir_defaulted=yes
+  # Try the directory containing this script, then its parent.
+  ac_prog=$0
+  ac_confdir=`echo $ac_prog|sed 's%/[^/][^/]*$%%'`
+  test "x$ac_confdir" = "x$ac_prog" && ac_confdir=.
+  srcdir=$ac_confdir
+  if test ! -r $srcdir/$ac_unique_file; then
+    srcdir=..
+  fi
+else
+  ac_srcdir_defaulted=no
+fi
+if test ! -r $srcdir/$ac_unique_file; then
+  if test "$ac_srcdir_defaulted" = yes; then
+    { echo "configure: error: can not find sources in $ac_confdir or .." 1>&2; exit 1; }
+  else
+    { echo "configure: error: can not find sources in $srcdir" 1>&2; exit 1; }
+  fi
+fi
+srcdir=`echo "${srcdir}" | sed 's%\([^/]\)/*$%\1%'`
+
+# Prefer explicitly selected file to automatically selected ones.
+if test -z "$CONFIG_SITE"; then
+  if test "x$prefix" != xNONE; then
+    CONFIG_SITE="$prefix/share/config.site $prefix/etc/config.site"
+  else
+    CONFIG_SITE="$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site"
+  fi
+fi
+for ac_site_file in $CONFIG_SITE; do
+  if test -r "$ac_site_file"; then
+    echo "loading site script $ac_site_file"
+    . "$ac_site_file"
+  fi
+done
+
+if test -r "$cache_file"; then
+  echo "loading cache $cache_file"
+  . $cache_file
+else
+  echo "creating cache $cache_file"
+  > $cache_file
+fi
+
+ac_ext=c
+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
+ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
+
+if (echo "testing\c"; echo 1,2,3) | grep c >/dev/null; then
+  # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.
+  if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then
+    ac_n= ac_c='
+' ac_t='	'
+  else
+    ac_n=-n ac_c= ac_t=
+  fi
+else
+  ac_n= ac_c='\c' ac_t=
+fi
+
+					# Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_CC="gcc"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  ac_prog_rejected=no
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      if test "$ac_dir/$ac_word" = "/usr/ucb/cc"; then
+        ac_prog_rejected=yes
+	continue
+      fi
+      ac_cv_prog_CC="cc"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# -gt 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    set dummy "$ac_dir/$ac_word" "$@"
+    shift
+    ac_cv_prog_CC="$@"
+  fi
+fi
+fi
+fi
+CC="$ac_cv_prog_CC"
+if test -n "$CC"; then
+  echo "$ac_t""$CC" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+  test -z "$CC" && { echo "configure: error: no acceptable cc found in \$PATH" 1>&2; exit 1; }
+fi
+
+echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.c <<EOF
+#ifdef __GNUC__
+  yes;
+#endif
+EOF
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:601: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+  ac_cv_prog_gcc=yes
+else
+  ac_cv_prog_gcc=no
+fi
+fi
+
+echo "$ac_t""$ac_cv_prog_gcc" 1>&6
+if test $ac_cv_prog_gcc = yes; then
+  GCC=yes
+  if test "${CFLAGS+set}" != set; then
+    echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_gcc_g'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  echo 'void f(){}' > conftest.c
+if test -z "`${CC-cc} -g -c conftest.c 2>&1`"; then
+  ac_cv_prog_gcc_g=yes
+else
+  ac_cv_prog_gcc_g=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_prog_gcc_g" 1>&6
+    if test $ac_cv_prog_gcc_g = yes; then
+      CFLAGS="-g -O"
+    else
+      CFLAGS="-O"
+    fi
+  fi
+else
+  GCC=
+  test "${CFLAGS+set}" = set || CFLAGS="-g"
+fi
+
+# Extract the first word of "ar", so it can be a program name with args.
+set dummy ar; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_AR'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$AR"; then
+  ac_cv_prog_AR="$AR" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_AR="ar"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_prog_AR" && ac_cv_prog_AR="ar"
+fi
+fi
+AR="$ac_cv_prog_AR"
+if test -n "$AR"; then
+  echo "$ac_t""$AR" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+# Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS="${IFS}:"
+  for ac_dir in $PATH; do
+    test -z "$ac_dir" && ac_dir=.
+    if test -f $ac_dir/$ac_word; then
+      ac_cv_prog_RANLIB="ranlib"
+      break
+    fi
+  done
+  IFS="$ac_save_ifs"
+  test -z "$ac_cv_prog_RANLIB" && ac_cv_prog_RANLIB=":"
+fi
+fi
+RANLIB="$ac_cv_prog_RANLIB"
+if test -n "$RANLIB"; then
+  echo "$ac_t""$RANLIB" 1>&6
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+echo $ac_n "checking how to run the C preprocessor""... $ac_c" 1>&6
+# On Suns, sometimes $CPP names a directory.
+if test -n "$CPP" && test -d "$CPP"; then
+  CPP=
+fi
+if test -z "$CPP"; then
+if eval "test \"`echo '$''{'ac_cv_prog_CPP'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+    # This must be in double quotes, not single quotes, because CPP may get
+  # substituted into the Makefile and "${CC-cc}" will confuse make.
+  CPP="${CC-cc} -E"
+  # On the NeXT, cc -E runs the code through the compiler's parser,
+  # not just through cpp.
+  cat > conftest.$ac_ext <<EOF
+#line 709 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:715: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  CPP="${CC-cc} -E -traditional-cpp"
+  cat > conftest.$ac_ext <<EOF
+#line 724 "configure"
+#include "confdefs.h"
+#include <assert.h>
+Syntax Error
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:730: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  :
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  CPP=/lib/cpp
+fi
+rm -f conftest*
+fi
+rm -f conftest*
+  ac_cv_prog_CPP="$CPP"
+fi
+  CPP="$ac_cv_prog_CPP"
+else
+  ac_cv_prog_CPP="$CPP"
+fi
+echo "$ac_t""$CPP" 1>&6
+			echo $ac_n "checking for AIX""... $ac_c" 1>&6
+cat > conftest.$ac_ext <<EOF
+#line 751 "configure"
+#include "confdefs.h"
+#ifdef _AIX
+  yes
+#endif
+
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "yes" >/dev/null 2>&1; then
+  rm -rf conftest*
+  echo "$ac_t""yes" 1>&6; cat >> confdefs.h <<\EOF
+#define _ALL_SOURCE 1
+EOF
+
+else
+  rm -rf conftest*
+  echo "$ac_t""no" 1>&6
+fi
+rm -f conftest*
+
+
+ac_safe=`echo "minix/config.h" | tr './\055' '___'`
+echo $ac_n "checking for minix/config.h""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 778 "configure"
+#include "confdefs.h"
+#include <minix/config.h>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:783: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
+fi
+rm -f conftest*
+fi
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  MINIX=yes
+else
+  echo "$ac_t""no" 1>&6
+MINIX=
+fi
+
+if test "$MINIX" = yes; then
+  cat >> confdefs.h <<\EOF
+#define _POSIX_SOURCE 1
+EOF
+
+  cat >> confdefs.h <<\EOF
+#define _POSIX_1_SOURCE 2
+EOF
+
+  cat >> confdefs.h <<\EOF
+#define _MINIX 1
+EOF
+
+fi
+
+echo $ac_n "checking for POSIXized ISC""... $ac_c" 1>&6
+if test -d /etc/conf/kconfig.d &&
+  grep _POSIX_VERSION /usr/include/sys/unistd.h >/dev/null 2>&1
+then
+  echo "$ac_t""yes" 1>&6
+  ISC=yes # If later tests want to check for ISC.
+  cat >> confdefs.h <<\EOF
+#define _POSIX_SOURCE 1
+EOF
+
+  if test "$GCC" = yes; then
+    CC="$CC -posix"
+  else
+    CC="$CC -Xp"
+  fi
+else
+  echo "$ac_t""no" 1>&6
+  ISC=
+fi
+
+echo $ac_n "checking for working const""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 843 "configure"
+#include "confdefs.h"
+
+int main() { return 0; }
+int t() {
+
+/* Ultrix mips cc rejects this.  */
+typedef int charset[2]; const charset x;
+/* SunOS 4.1.1 cc rejects this.  */
+char const *const *ccp;
+char **p;
+/* NEC SVR4.0.2 mips cc rejects this.  */
+struct point {int x, y;};
+static struct point const zero = {0,0};
+/* AIX XL C 1.02.0.0 rejects this.
+   It does not let you subtract one const X* pointer from another in an arm
+   of an if-expression whose if-part is not a constant expression */
+const char *g = "string";
+ccp = &g + (g ? g-g : 0);
+/* HPUX 7.0 cc rejects these. */
+++ccp;
+p = (char**) ccp;
+ccp = (char const *const *) p;
+{ /* SCO 3.2v4 cc rejects this.  */
+  char *t;
+  char const *s = 0 ? (char *) 0 : (char const *) 0;
+
+  *t++ = 0;
+}
+{ /* Someone thinks the Sun supposedly-ANSI compiler will reject this.  */
+  int x[] = {25, 17};
+  const int *foo = &x[0];
+  ++foo;
+}
+{ /* Sun SC1.0 ANSI compiler rejects this -- but not the above. */
+  typedef const int *iptr;
+  iptr p = 0;
+  ++p;
+}
+{ /* AIX XL C 1.02.0.0 rejects this saying
+     "k.c", line 2.27: 1506-025 (S) Operand must be a modifiable lvalue. */
+  struct s { int j; const int *ap[3]; };
+  struct s *b; b->j = 5;
+}
+{ /* ULTRIX-32 V3.1 (Rev 9) vcc rejects this */
+  const int foo = 10;
+}
+
+; return 0; }
+EOF
+if { (eval echo configure:893: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_c_const=yes
+else
+  rm -rf conftest*
+  ac_cv_c_const=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_c_const" 1>&6
+if test $ac_cv_c_const = no; then
+  cat >> confdefs.h <<\EOF
+#define const 
+EOF
+
+fi
+
+# If we cannot run a trivial program, we must be cross compiling.
+echo $ac_n "checking whether cross-compiling""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_c_cross'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_c_cross=yes
+else
+cat > conftest.$ac_ext <<EOF
+#line 921 "configure"
+#include "confdefs.h"
+main(){return(0);}
+EOF
+{ (eval echo configure:925: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_c_cross=no
+else
+  ac_cv_c_cross=yes
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_c_cross" 1>&6
+cross_compiling=$ac_cv_c_cross
+
+echo $ac_n "checking for ANSI C header files""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_stdc'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 943 "configure"
+#include "confdefs.h"
+#include <stdlib.h>
+#include <stdarg.h>
+#include <string.h>
+#include <float.h>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:951: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  ac_cv_header_stdc=yes
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+if test $ac_cv_header_stdc = yes; then
+  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.
+cat > conftest.$ac_ext <<EOF
+#line 966 "configure"
+#include "confdefs.h"
+#include <string.h>
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "memchr" >/dev/null 2>&1; then
+  :
+else
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.
+cat > conftest.$ac_ext <<EOF
+#line 984 "configure"
+#include "confdefs.h"
+#include <stdlib.h>
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "free" >/dev/null 2>&1; then
+  :
+else
+  rm -rf conftest*
+  ac_cv_header_stdc=no
+fi
+rm -f conftest*
+
+fi
+
+if test $ac_cv_header_stdc = yes; then
+  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.
+if test "$cross_compiling" = yes; then
+  :
+else
+cat > conftest.$ac_ext <<EOF
+#line 1005 "configure"
+#include "confdefs.h"
+#include <ctype.h>
+#define ISLOWER(c) ('a' <= (c) && (c) <= 'z')
+#define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))
+#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))
+int main () { int i; for (i = 0; i < 256; i++)
+if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);
+exit (0); }
+
+EOF
+{ (eval echo configure:1016: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  :
+else
+  ac_cv_header_stdc=no
+fi
+fi
+rm -fr conftest*
+fi
+fi
+
+echo "$ac_t""$ac_cv_header_stdc" 1>&6
+if test $ac_cv_header_stdc = yes; then
+  cat >> confdefs.h <<\EOF
+#define STDC_HEADERS 1
+EOF
+
+fi
+
+for ac_hdr in memory.h unistd.h string.h
+do
+ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1043 "configure"
+#include "confdefs.h"
+#include <$ac_hdr>
+EOF
+ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
+{ (eval echo configure:1048: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+ac_err=`grep -v '^ *+' conftest.out`
+if test -z "$ac_err"; then
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=yes"
+else
+  echo "$ac_err" >&5
+  rm -rf conftest*
+  eval "ac_cv_header_$ac_safe=no"
+fi
+rm -f conftest*
+fi
+if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdefghijklmnopqrstuvwxyz./\055' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ___'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
+EOF
+ 
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+
+ac_header_dirent=no
+for ac_hdr in dirent.h sys/ndir.h sys/dir.h ndir.h
+do
+ac_safe=`echo "$ac_hdr" | tr './\055' '___'`
+echo $ac_n "checking for $ac_hdr that defines DIR""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_dirent_$ac_safe'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1081 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <$ac_hdr>
+int main() { return 0; }
+int t() {
+DIR *dirp = 0;
+; return 0; }
+EOF
+if { (eval echo configure:1090: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_header_dirent_$ac_safe=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_header_dirent_$ac_safe=no"
+fi
+rm -f conftest*
+
+fi
+if eval "test \"`echo '$ac_cv_header_dirent_'$ac_safe`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+    ac_tr_hdr=HAVE_`echo $ac_hdr | tr 'abcdedfghijklmnopqrstuvwxyz./\055' 'ABCDEDFGHIJKLMNOPQRSTUVWXYZ___'`
+  cat >> confdefs.h <<EOF
+#define $ac_tr_hdr 1
+EOF
+ ac_header_dirent=$ac_hdr; break
+else
+  echo "$ac_t""no" 1>&6
+fi
+done
+# Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
+if test $ac_header_dirent = dirent.h; then
+echo $ac_n "checking for -ldir""... $ac_c" 1>&6
+ac_lib_var=`echo dir | tr '.-/+' '___p'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-ldir  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 1121 "configure"
+#include "confdefs.h"
+
+int main() { return 0; }
+int t() {
+opendir()
+; return 0; }
+EOF
+if { (eval echo configure:1129: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  LIBS="$LIBS -ldir"
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+else
+echo $ac_n "checking for -lx""... $ac_c" 1>&6
+ac_lib_var=`echo x | tr '.-/+' '___p'`
+if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  ac_save_LIBS="$LIBS"
+LIBS="-lx  $LIBS"
+cat > conftest.$ac_ext <<EOF
+#line 1156 "configure"
+#include "confdefs.h"
+
+int main() { return 0; }
+int t() {
+opendir()
+; return 0; }
+EOF
+if { (eval echo configure:1164: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_lib_$ac_lib_var=no"
+fi
+rm -f conftest*
+LIBS="$ac_save_LIBS"
+
+fi
+if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  LIBS="$LIBS -lx"
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+fi
+
+echo $ac_n "checking whether closedir returns void""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_closedir_void'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_func_closedir_void=yes
+else
+cat > conftest.$ac_ext <<EOF
+#line 1192 "configure"
+#include "confdefs.h"
+#include <sys/types.h>
+#include <$ac_header_dirent>
+int closedir(); main() { exit(closedir(opendir(".")) != 0); }
+EOF
+{ (eval echo configure:1198: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_func_closedir_void=no
+else
+  ac_cv_func_closedir_void=yes
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_func_closedir_void" 1>&6
+if test $ac_cv_func_closedir_void = yes; then
+  cat >> confdefs.h <<\EOF
+#define CLOSEDIR_VOID 1
+EOF
+
+fi
+
+# The Ultrix 4.2 mips builtin alloca declared by alloca.h only works
+# for constant arguments.  Useless!
+echo $ac_n "checking for working alloca.h""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_header_alloca_h'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1223 "configure"
+#include "confdefs.h"
+#include <alloca.h>
+int main() { return 0; }
+int t() {
+char *p = alloca(2 * sizeof(int));
+; return 0; }
+EOF
+if { (eval echo configure:1231: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_header_alloca_h=yes
+else
+  rm -rf conftest*
+  ac_cv_header_alloca_h=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_header_alloca_h" 1>&6
+if test $ac_cv_header_alloca_h = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_ALLOCA_H 1
+EOF
+
+fi
+
+echo $ac_n "checking for alloca""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_alloca'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1255 "configure"
+#include "confdefs.h"
+
+#ifdef __GNUC__
+# define alloca __builtin_alloca
+#else
+# if HAVE_ALLOCA_H
+#  include <alloca.h>
+# else
+#  ifdef _AIX
+ #pragma alloca
+#  else
+#   ifndef alloca /* predefined by HP cc +Olibcalls */
+char *alloca ();
+#   endif
+#  endif
+# endif
+#endif
+
+int main() { return 0; }
+int t() {
+char *p = (char *) alloca(1);
+; return 0; }
+EOF
+if { (eval echo configure:1279: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  ac_cv_func_alloca=yes
+else
+  rm -rf conftest*
+  ac_cv_func_alloca=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_func_alloca" 1>&6
+if test $ac_cv_func_alloca = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_ALLOCA 1
+EOF
+
+fi
+
+if test $ac_cv_func_alloca = no; then
+  # The SVR3 libPW and SVR4 libucb both contain incompatible functions
+  # that cause trouble.  Some versions do not even contain alloca or
+  # contain a buggy version.  If you still want to use their alloca,
+  # use ar to extract alloca.o from them instead of compiling alloca.c.
+  ALLOCA=alloca.o
+  cat >> confdefs.h <<\EOF
+#define C_ALLOCA 1
+EOF
+
+
+echo $ac_n "checking whether alloca needs Cray hooks""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_os_cray'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1314 "configure"
+#include "confdefs.h"
+#if defined(CRAY) && ! defined(CRAY2)
+webecray
+#else
+wenotbecray
+#endif
+
+EOF
+if (eval "$ac_cpp conftest.$ac_ext") 2>&5 |
+  egrep "webecray" >/dev/null 2>&1; then
+  rm -rf conftest*
+  ac_cv_os_cray=yes
+else
+  rm -rf conftest*
+  ac_cv_os_cray=no
+fi
+rm -f conftest*
+
+fi
+
+echo "$ac_t""$ac_cv_os_cray" 1>&6
+if test $ac_cv_os_cray = yes; then
+for ac_func in _getb67 GETB67 getb67; do
+  echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  cat > conftest.$ac_ext <<EOF
+#line 1343 "configure"
+#include "confdefs.h"
+/* System header to define __stub macros and hopefully few prototypes,
+    which can conflict with char $ac_func(); below.  */
+#include <assert.h>
+/* Override any gcc2 internal prototype to avoid an error.  */
+char $ac_func();
+
+int main() { return 0; }
+int t() {
+
+/* The GNU C library defines this for functions which it implements
+    to always fail with ENOSYS.  Some functions are actually named
+    something starting with __ and the normal name is an alias.  */
+#if defined (__stub_$ac_func) || defined (__stub___$ac_func)
+choke me
+#else
+$ac_func();
+#endif
+
+; return 0; }
+EOF
+if { (eval echo configure:1365: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }; then
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=yes"
+else
+  rm -rf conftest*
+  eval "ac_cv_func_$ac_func=no"
+fi
+rm -f conftest*
+
+fi
+if eval "test \"`echo '$ac_cv_func_'$ac_func`\" = yes"; then
+  echo "$ac_t""yes" 1>&6
+  cat >> confdefs.h <<EOF
+#define CRAY_STACKSEG_END $ac_func
+EOF
+
+  break
+else
+  echo "$ac_t""no" 1>&6
+fi
+
+done
+fi
+
+echo $ac_n "checking stack direction for C alloca""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_c_stack_direction'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_c_stack_direction=0
+else
+cat > conftest.$ac_ext <<EOF
+#line 1397 "configure"
+#include "confdefs.h"
+find_stack_direction ()
+{
+  static char *addr = 0;
+  auto char dummy;
+  if (addr == 0)
+    {
+      addr = &dummy;
+      return find_stack_direction ();
+    }
+  else
+    return (&dummy > addr) ? 1 : -1;
+}
+main ()
+{
+  exit (find_stack_direction() < 0);
+}
+EOF
+{ (eval echo configure:1416: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_c_stack_direction=1
+else
+  ac_cv_c_stack_direction=-1
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_c_stack_direction" 1>&6
+cat >> confdefs.h <<EOF
+#define STACK_DIRECTION $ac_cv_c_stack_direction
+EOF
+
+fi
+
+echo $ac_n "checking for strcoll""... $ac_c" 1>&6
+if eval "test \"`echo '$''{'ac_cv_func_strcoll'+set}'`\" = set"; then
+  echo $ac_n "(cached) $ac_c" 1>&6
+else
+  if test "$cross_compiling" = yes; then
+  ac_cv_func_strcoll=no
+else
+cat > conftest.$ac_ext <<EOF
+#line 1441 "configure"
+#include "confdefs.h"
+#include <string.h>
+main ()
+{
+  exit (strcoll ("abc", "def") >= 0 ||
+	strcoll ("ABC", "DEF") >= 0 ||
+	strcoll ("123", "456") >= 0);
+}
+EOF
+{ (eval echo configure:1451: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; }
+if test -s conftest && (./conftest; exit) 2>/dev/null; then
+  ac_cv_func_strcoll=yes
+else
+  ac_cv_func_strcoll=no
+fi
+fi
+rm -fr conftest*
+fi
+
+echo "$ac_t""$ac_cv_func_strcoll" 1>&6
+if test $ac_cv_func_strcoll = yes; then
+  cat >> confdefs.h <<\EOF
+#define HAVE_STRCOLL 1
+EOF
+
+fi
+
+trap '' 1 2 15
+cat > confcache <<\EOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs.  It is not useful on other systems.
+# If it contains results you don't want to keep, you may remove or edit it.
+#
+# By default, configure uses ./config.cache as the cache file,
+# creating it if it does not exist already.  You can give configure
+# the --cache-file=FILE option to use a different cache file; that is
+# what configure does when it calls configure scripts in
+# subdirectories, so they share the cache.
+# Giving --cache-file=/dev/null disables caching, for debugging configure.
+# config.status only pays attention to the cache file if you give it the
+# --recheck option to rerun configure.
+#
+EOF
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+(set) 2>&1 |
+  sed -n "s/^\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\)=\(.*\)/\1=\${\1='\2'}/p" \
+  >> confcache
+if cmp -s $cache_file confcache; then
+  :
+else
+  if test -w $cache_file; then
+    echo "updating cache $cache_file"
+    cat confcache > $cache_file
+  else
+    echo "not updating unwritable cache $cache_file"
+  fi
+fi
+rm -f confcache
+
+trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
+
+test "x$prefix" = xNONE && prefix=$ac_default_prefix
+# Let make expand exec_prefix.
+test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
+
+# Any assignment to VPATH causes Sun make to only execute
+# the first set of double-colon rules, so remove it if not needed.
+# If there is a colon in the path, we need to keep it.
+if test "x$srcdir" = x.; then
+  ac_vpsub='/^[ 	]*VPATH[ 	]*=[^:]*$/d'
+fi
+
+trap 'rm -f $CONFIG_STATUS conftest*; exit 1' 1 2 15
+
+# Transform confdefs.h into DEFS.
+# Protect against shell expansion while executing Makefile rules.
+# Protect against Makefile macro expansion.
+cat > conftest.defs <<\EOF
+s%#define \([A-Za-z_][A-Za-z0-9_]*\) *\(.*\)%-D\1=\2%g
+s%[ 	`~#$^&*(){}\\|;'"<>?]%\\&%g
+s%\[%\\&%g
+s%\]%\\&%g
+s%\$%$$%g
+EOF
+DEFS=`sed -f conftest.defs confdefs.h | tr '\012' ' '`
+rm -f conftest.defs
+
+
+# Without the "./", some shells look in PATH for config.status.
+: ${CONFIG_STATUS=./config.status}
+
+echo creating $CONFIG_STATUS
+rm -f $CONFIG_STATUS
+cat > $CONFIG_STATUS <<EOF
+#! /bin/sh
+# Generated automatically by configure.
+# Run this file to recreate the current configuration.
+# This directory was configured as follows,
+# on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
+#
+# $0 $ac_configure_args
+#
+# Compiler output produced by configure, useful for debugging
+# configure, is in ./config.log if it exists.
+
+ac_cs_usage="Usage: $CONFIG_STATUS [--recheck] [--version] [--help]"
+for ac_option
+do
+  case "\$ac_option" in
+  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
+    echo "running \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion"
+    exec \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;
+  -version | --version | --versio | --versi | --vers | --ver | --ve | --v)
+    echo "$CONFIG_STATUS generated by autoconf version 2.7"
+    exit 0 ;;
+  -help | --help | --hel | --he | --h)
+    echo "\$ac_cs_usage"; exit 0 ;;
+  *) echo "\$ac_cs_usage"; exit 1 ;;
+  esac
+done
+
+ac_given_srcdir=$srcdir
+
+trap 'rm -fr `echo "Makefile" | sed "s/:[^ ]*//g"` conftest*; exit 1' 1 2 15
+EOF
+cat >> $CONFIG_STATUS <<EOF
+
+# Protect against being on the right side of a sed subst in config.status.
+sed 's/%@/@@/; s/@%/@@/; s/%g\$/@g/; /@g\$/s/[\\\\&%]/\\\\&/g;
+ s/@@/%@/; s/@@/@%/; s/@g\$/%g/' > conftest.subs <<\\CEOF
+$ac_vpsub
+$extrasub
+s%@CFLAGS@%$CFLAGS%g
+s%@CPPFLAGS@%$CPPFLAGS%g
+s%@CXXFLAGS@%$CXXFLAGS%g
+s%@DEFS@%$DEFS%g
+s%@LDFLAGS@%$LDFLAGS%g
+s%@LIBS@%$LIBS%g
+s%@exec_prefix@%$exec_prefix%g
+s%@prefix@%$prefix%g
+s%@program_transform_name@%$program_transform_name%g
+s%@bindir@%$bindir%g
+s%@sbindir@%$sbindir%g
+s%@libexecdir@%$libexecdir%g
+s%@datadir@%$datadir%g
+s%@sysconfdir@%$sysconfdir%g
+s%@sharedstatedir@%$sharedstatedir%g
+s%@localstatedir@%$localstatedir%g
+s%@libdir@%$libdir%g
+s%@includedir@%$includedir%g
+s%@oldincludedir@%$oldincludedir%g
+s%@infodir@%$infodir%g
+s%@mandir@%$mandir%g
+s%@CC@%$CC%g
+s%@AR@%$AR%g
+s%@RANLIB@%$RANLIB%g
+s%@CPP@%$CPP%g
+s%@ALLOCA@%$ALLOCA%g
+
+CEOF
+EOF
+cat >> $CONFIG_STATUS <<EOF
+
+CONFIG_FILES=\${CONFIG_FILES-"Makefile"}
+EOF
+cat >> $CONFIG_STATUS <<\EOF
+for ac_file in .. $CONFIG_FILES; do if test "x$ac_file" != x..; then
+  # Support "outfile[:infile]", defaulting infile="outfile.in".
+  case "$ac_file" in
+  *:*) ac_file_in=`echo "$ac_file"|sed 's%.*:%%'`
+       ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
+  *) ac_file_in="${ac_file}.in" ;;
+  esac
+
+  # Adjust relative srcdir, etc. for subdirectories.
+
+  # Remove last slash and all that follows it.  Not all systems have dirname.
+  ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
+  if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
+    # The file is in a subdirectory.
+    test ! -d "$ac_dir" && mkdir "$ac_dir"
+    ac_dir_suffix="/`echo $ac_dir|sed 's%^\./%%'`"
+    # A "../" for each directory in $ac_dir_suffix.
+    ac_dots=`echo $ac_dir_suffix|sed 's%/[^/]*%../%g'`
+  else
+    ac_dir_suffix= ac_dots=
+  fi
+
+  case "$ac_given_srcdir" in
+  .)  srcdir=.
+      if test -z "$ac_dots"; then top_srcdir=.
+      else top_srcdir=`echo $ac_dots|sed 's%/$%%'`; fi ;;
+  /*) srcdir="$ac_given_srcdir$ac_dir_suffix"; top_srcdir="$ac_given_srcdir" ;;
+  *) # Relative path.
+    srcdir="$ac_dots$ac_given_srcdir$ac_dir_suffix"
+    top_srcdir="$ac_dots$ac_given_srcdir" ;;
+  esac
+
+  echo creating "$ac_file"
+  rm -f "$ac_file"
+  configure_input="Generated automatically from `echo $ac_file_in|sed 's%.*/%%'` by configure."
+  case "$ac_file" in
+  *Makefile*) ac_comsub="1i\\
+# $configure_input" ;;
+  *) ac_comsub= ;;
+  esac
+  sed -e "$ac_comsub
+s%@configure_input@%$configure_input%g
+s%@srcdir@%$srcdir%g
+s%@top_srcdir@%$top_srcdir%g
+" -f conftest.subs $ac_given_srcdir/$ac_file_in > $ac_file
+fi; done
+rm -f conftest.subs
+
+
+
+exit 0
+EOF
+chmod +x $CONFIG_STATUS
+rm -fr confdefs* $ac_clean_files
+test "$no_create" = yes || ${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS || exit 1
+
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/configure.bat ../glibc-2.3/posix/glob/configure.bat
--- glibc-2.2.93/posix/glob/configure.bat	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/configure.bat	Wed Mar  8 20:19:41 1995
@@ -0,0 +1,26 @@
+@echo off
+echo Configuring glob for GO32
+rem This batch file assumes a unix-type "sed" program
+
+echo # Makefile generated by "configure.bat"> Makefile
+
+if exist config.sed del config.sed
+
+echo "s/@srcdir@/./					">> config.sed
+echo "s/@CC@/gcc/					">> config.sed
+echo "s/@CFLAGS@/-O2 -g/				">> config.sed
+echo "s/@CPPFLAGS@/-DHAVE_CONFIG_H -I../		">> config.sed
+echo "s/@AR@/ar/					">> config.sed
+echo "s/@RANLIB@/ranlib/				">> config.sed
+echo "s/@LDFLAGS@//					">> config.sed
+echo "s/@DEFS@//					">> config.sed
+echo "s/@ALLOCA@//					">> config.sed
+echo "s/@LIBS@//					">> config.sed
+echo "s/@LIBOBJS@//					">> config.sed
+echo "s/^Makefile *:/_Makefile:/			">> config.sed
+echo "s/^config.h *:/_config.h:/			">> config.sed
+
+sed -e "s/^\"//" -e "s/\"$//" -e "s/[ 	]*$//" config.sed > config2.sed
+sed -f config2.sed Makefile.in >> Makefile
+del config.sed
+del config2.sed
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/glob/configure.in ../glibc-2.3/posix/glob/configure.in
--- glibc-2.2.93/posix/glob/configure.in	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/posix/glob/configure.in	Wed Feb 22 21:30:35 1995
@@ -0,0 +1,19 @@
+dnl Process this file with autoconf to produce a configure script.
+AC_INIT(fnmatch.c)		dnl A distinctive file to look for in srcdir.
+AC_PREREQ(2.1)			dnl Minimum Autoconf version required.
+AC_PROG_CC
+AC_CHECK_PROG(AR, ar, ar, ar)
+AC_PROG_RANLIB
+AC_PROG_CPP			dnl Later checks need this.
+dnl These two want to come early.
+AC_AIX
+AC_MINIX
+AC_ISC_POSIX
+AC_CONST
+AC_HEADER_STDC
+AC_CHECK_HEADERS(memory.h unistd.h string.h)
+AC_HEADER_DIRENT
+AC_FUNC_CLOSEDIR_VOID
+AC_FUNC_ALLOCA
+AC_FUNC_STRCOLL
+AC_OUTPUT(Makefile)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/regcomp.c ../glibc-2.3/posix/regcomp.c
--- glibc-2.2.93/posix/regcomp.c	Mon Aug 12 15:17:21 2002
+++ ../glibc-2.3/posix/regcomp.c	Sat Sep 14 09:40:50 2002
@@ -25,8 +25,13 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <wchar.h>
-#include <wctype.h>
+
+#if defined HAVE_WCHAR_H || defined _LIBC
+# include <wchar.h>
+#endif /* HAVE_WCHAR_H || _LIBC */
+#if defined HAVE_WCTYPE_H || defined _LIBC
+# include <wctype.h>
+#endif /* HAVE_WCTYPE_H || _LIBC */
 
 /* In case that the system doesn't have isblank().  */
 #if !defined _LIBC && !defined HAVE_ISBLANK && !defined isblank
@@ -130,13 +135,13 @@
 static reg_errcode_t build_collating_symbol (re_bitset_ptr_t sbcset,
                                              re_charset_t *mbcset,
                                              int *coll_sym_alloc,
-                                             unsigned char *name);
+                                             const unsigned char *name);
 # else /* not RE_ENABLE_I18N */
 static reg_errcode_t build_range_exp (re_bitset_ptr_t sbcset,
                                       bracket_elem_t *start_elem,
                                       bracket_elem_t *end_elem);
 static reg_errcode_t build_collating_symbol (re_bitset_ptr_t sbcset,
-                                             unsigned char *name);
+                                             const unsigned char *name);
 # endif /* not RE_ENABLE_I18N */
 #endif /* not _LIBC */
 #ifdef RE_ENABLE_I18N
@@ -271,8 +276,7 @@
   /* Match anchors at newline.  */
   bufp->newline_anchor = 1;
 
-  ret = re_compile_internal (bufp, (const unsigned char *) pattern, length,
-                             re_syntax_options);
+  ret = re_compile_internal (bufp, pattern, length, re_syntax_options);
 
   if (!ret)
     return NULL;
@@ -397,9 +401,9 @@
             }
           for (i = 0; i < cset->nmbchars; ++i)
             {
-              unsigned char buf[256];
+              char buf[256];
               wctomb (buf, cset->mbchars[i]);
-              fastmap[buf[0]] = 1;
+              fastmap[*(unsigned char *) buf] = 1;
             }
         }
 #endif /* RE_ENABLE_I18N */
@@ -455,8 +459,8 @@
 
 int
 regcomp (preg, pattern, cflags)
-    regex_t *preg;
-    const char *pattern;
+    regex_t *__restrict preg;
+    const char *__restrict pattern;
     int cflags;
 {
   reg_errcode_t ret;
@@ -2291,9 +2295,10 @@
 
   /* We can handle no multi character collating elements without libc
      support.  */
-  if (BE ((start_elem->type == COLL_SYM && strlen (start_elem->opr.name) > 1)
-          || (end_elem->type == COLL_SYM && strlen (end_elem->opr.name) > 1),
-          0))
+  if (BE ((start_elem->type == COLL_SYM
+           && strlen ((char *) start_elem->opr.name) > 1)
+          || (end_elem->type == COLL_SYM
+              && strlen ((char *) end_elem->opr.name) > 1), 0))
     return REG_ECOLLATE;
 
 # ifdef RE_ENABLE_I18N
@@ -2389,9 +2394,10 @@
 build_collating_symbol (sbcset, name)
 # endif /* not RE_ENABLE_I18N */
      re_bitset_ptr_t sbcset;
-     unsigned char *name;
+     const unsigned char *name;
 {
-  if (BE (strlen (name) != 1, 0))
+  size_t name_len = strlen ((const char *) name);
+  if (BE (name_len != 1, 0))
     return REG_ECOLLATE;
   else
     {
@@ -2413,7 +2419,8 @@
      reg_errcode_t *err;
 {
 #ifdef _LIBC
-  const unsigned char *collseqmb, *collseqwc;
+  const unsigned char *collseqmb;
+  const char *collseqwc;
   uint32_t nrules;
   int32_t table_size;
   const int32_t *symb_table;
@@ -2425,10 +2432,10 @@
 
   static inline int32_t
   seek_collating_symbol_entry (name, name_len)
-         unsigned char *name;
+         const unsigned char *name;
          size_t name_len;
     {
-      int32_t hash = elem_hash (name, name_len);
+      int32_t hash = elem_hash ((const char *) name, name_len);
       int32_t elem = hash % table_size;
       int32_t second = hash % (table_size - 2);
       while (symb_table[2 * elem] != 0)
@@ -2478,11 +2485,12 @@
         }
       else if (br_elem->type == COLL_SYM)
         {
+          size_t sym_name_len = strlen ((char *) br_elem->opr.name);
           if (nrules != 0)
             {
               int32_t elem, idx;
               elem = seek_collating_symbol_entry (br_elem->opr.name,
-                                                  strlen (br_elem->opr.name));
+                                                  sym_name_len);
               if (symb_table[2 * elem] != 0)
                 {
                   /* We found the entry.  */
@@ -2501,15 +2509,14 @@
                   /* Return the collation sequence value.  */
                   return *(unsigned int *) (extra + idx);
                 }
-              else if (symb_table[2 * elem] == 0 &&
-                       strlen (br_elem->opr.name) == 1)
+              else if (symb_table[2 * elem] == 0 && sym_name_len == 1)
                 {
                   /* No valid character.  Match it as a single byte
                      character.  */
                   return collseqmb[br_elem->opr.name[0]];
                 }
             }
-          else if (strlen (br_elem->opr.name) == 1)
+          else if (sym_name_len == 1)
             return collseqmb[br_elem->opr.name[0]];
         }
       return UINT_MAX;
@@ -2617,12 +2624,13 @@
   build_collating_symbol (sbcset, name)
 # endif /* not RE_ENABLE_I18N */
          re_bitset_ptr_t sbcset;
-         unsigned char *name;
+         const unsigned char *name;
     {
       int32_t elem, idx;
+      size_t name_len = strlen ((const char *) name);
       if (nrules != 0)
         {
-          elem = seek_collating_symbol_entry (name, strlen (name));
+          elem = seek_collating_symbol_entry (name, name_len);
           if (symb_table[2 * elem] != 0)
             {
               /* We found the entry.  */
@@ -2630,7 +2638,7 @@
               /* Skip the name of collating element name.  */
               idx += 1 + extra[idx];
             }
-          else if (symb_table[2 * elem] == 0 && strlen (name) == 1)
+          else if (symb_table[2 * elem] == 0 && name_len == 1)
             {
               /* No valid character, treat it as a normal
                  character.  */
@@ -2661,7 +2669,7 @@
         }
       else
         {
-          if (BE (strlen (name) != 1, 0))
+          if (BE (name_len != 1, 0))
             return REG_ECOLLATE;
           else
             {
@@ -2684,7 +2692,8 @@
   bin_tree_t *work_tree;
   int token_len, new_idx;
 #ifdef _LIBC
-  collseqmb = _NL_CURRENT (LC_COLLATE, _NL_COLLATE_COLLSEQMB);
+  collseqmb = (const unsigned char *)
+    _NL_CURRENT (LC_COLLATE, _NL_COLLATE_COLLSEQMB);
   nrules = _NL_CURRENT_WORD (LC_COLLATE, _NL_COLLATE_NRULES);
   if (nrules)
     {
@@ -3048,12 +3057,12 @@
       indirect = (const int32_t *) _NL_CURRENT (LC_COLLATE,
                                                 _NL_COLLATE_INDIRECTMB);
       idx1 = findidx (&cp);
-      if (BE (idx1 == 0 || cp < name + strlen (name), 0))
+      if (BE (idx1 == 0 || cp < name + strlen ((const char *) name), 0))
         /* This isn't a valid character.  */
         return REG_ECOLLATE;
 
       /* Build single byte matcing table for this equivalence class.  */
-      char_buf[1] = '\0';
+      char_buf[1] = (unsigned char) '\0';
       len = weights[idx1];
       for (ch = 0; ch < SBC_MAX; ++ch)
         {
@@ -3094,9 +3103,9 @@
   else
 #endif /* _LIBC && RE_ENABLE_I18N */
     {
-      if (BE (strlen (name) != 1, 0))
+      if (BE (strlen ((const char *) name) != 1, 0))
         return REG_ECOLLATE;
-      bitset_set (sbcset, name[0]);
+      bitset_set (sbcset, *name);
     }
   return REG_NOERROR;
 }
@@ -3120,7 +3129,7 @@
      reg_syntax_t syntax;
 {
   int i;
-  const unsigned char *name = class_name;
+  const char *name = (const char *) class_name;
 
   /* In case of REG_ICASE "upper" and "lower" match the both of
      upper and lower cases.  */
@@ -3237,7 +3246,7 @@
 #ifdef RE_ENABLE_I18N
                          mbcset, &alloc,
 #endif /* RE_ENABLE_I18N */
-                         "alpha", 0);
+                         (const unsigned char *) "alpha", 0);
 
   if (BE (ret != REG_NOERROR, 0))
     {
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/regex_internal.c ../glibc-2.3/posix/regex_internal.c
--- glibc-2.2.93/posix/regex_internal.c	Sat Jul 27 04:06:22 2002
+++ ../glibc-2.3/posix/regex_internal.c	Sat Sep 14 09:40:50 2002
@@ -24,8 +24,13 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <wchar.h>
-#include <wctype.h>
+
+#if defined HAVE_WCHAR_H || defined _LIBC
+# include <wchar.h>
+#endif /* HAVE_WCHAR_H || _LIBC */
+#if defined HAVE_WCTYPE_H || defined _LIBC
+# include <wctype.h>
+#endif /* HAVE_WCTYPE_H || _LIBC */
 
 #ifdef _LIBC
 # ifndef _RE_DEFINE_LOCALE_FUNCTIONS
@@ -57,8 +62,8 @@
 #include "regex.h"
 #include "regex_internal.h"
 
-static void re_string_construct_common (const unsigned char *str,
-                                        int len, re_string_t *pstr,
+static void re_string_construct_common (const char *str, int len,
+                                        re_string_t *pstr,
                                         RE_TRANSLATE_TYPE trans, int icase);
 #ifdef RE_ENABLE_I18N
 static int re_string_skip_chars (re_string_t *pstr, int new_raw_idx);
@@ -86,7 +91,7 @@
 static reg_errcode_t
 re_string_allocate (pstr, str, len, init_len, trans, icase)
      re_string_t *pstr;
-     const unsigned char *str;
+     const char *str;
      int len, init_len, icase;
      RE_TRANSLATE_TYPE trans;
 {
@@ -100,7 +105,7 @@
     return ret;
 
   pstr->mbs_case = (MBS_CASE_ALLOCATED (pstr) ? pstr->mbs_case
-                    : (unsigned char *)str);
+                    : (unsigned char *) str);
   pstr->mbs = MBS_ALLOCATED (pstr) ? pstr->mbs : pstr->mbs_case;
   pstr->valid_len = (MBS_CASE_ALLOCATED (pstr) || MBS_ALLOCATED (pstr)
                      || MB_CUR_MAX > 1) ? pstr->valid_len : len;
@@ -112,7 +117,7 @@
 static reg_errcode_t
 re_string_construct (pstr, str, len, trans, icase)
      re_string_t *pstr;
-     const unsigned char *str;
+     const char *str;
      int len, icase;
      RE_TRANSLATE_TYPE trans;
 {
@@ -129,7 +134,7 @@
         return ret;
     }
   pstr->mbs_case = (MBS_CASE_ALLOCATED (pstr) ? pstr->mbs_case
-                    : (unsigned char *)str);
+                    : (unsigned char *) str);
   pstr->mbs = MBS_ALLOCATED (pstr) ? pstr->mbs : pstr->mbs_case;
 
   if (icase)
@@ -197,14 +202,14 @@
 
 static void
 re_string_construct_common (str, len, pstr, trans, icase)
-     const unsigned char *str;
+     const char *str;
      int len;
      re_string_t *pstr;
      RE_TRANSLATE_TYPE trans;
      int icase;
 {
   memset (pstr, '\0', sizeof (re_string_t));
-  pstr->raw_mbs = str;
+  pstr->raw_mbs = (const unsigned char *) str;
   pstr->len = len;
   pstr->trans = trans;
   pstr->icase = icase ? 1 : 0;
@@ -237,8 +242,8 @@
       wchar_t wc;
       remain_len = end_idx - byte_idx;
       prev_st = pstr->cur_state;
-      mbclen = mbrtowc (&wc, pstr->raw_mbs + pstr->raw_mbs_idx + byte_idx,
-                        remain_len, &pstr->cur_state);
+      mbclen = mbrtowc (&wc, ((const char *) pstr->raw_mbs + pstr->raw_mbs_idx
+                              + byte_idx), remain_len, &pstr->cur_state);
       if (BE (mbclen == (size_t) -2, 0))
         {
           /* The buffer doesn't have enough space, finish to build.  */
@@ -256,7 +261,7 @@
       /* Apply the translateion if we need.  */
       if (pstr->trans != NULL && mbclen == 1)
         {
-          int ch =  pstr->trans[pstr->raw_mbs[pstr->raw_mbs_idx + byte_idx]];
+          int ch = pstr->trans[pstr->raw_mbs[pstr->raw_mbs_idx + byte_idx]];
           pstr->mbs_case[byte_idx] = ch;
         }
       /* Write wide character and padding.  */
@@ -285,8 +290,8 @@
       wchar_t wc;
       remain_len = end_idx - byte_idx;
       prev_st = pstr->cur_state;
-      mbclen = mbrtowc (&wc, pstr->raw_mbs + pstr->raw_mbs_idx + byte_idx,
-                        remain_len, &pstr->cur_state);
+      mbclen = mbrtowc (&wc, ((const char *) pstr->raw_mbs + pstr->raw_mbs_idx
+                              + byte_idx), remain_len, &pstr->cur_state);
       if (BE (mbclen == (size_t) -2, 0))
         {
           /* The buffer doesn't have enough space, finish to build.  */
@@ -311,7 +316,7 @@
       else /* mbclen > 1 */
         {
           if (iswlower (wc))
-            wcrtomb (pstr->mbs + byte_idx, towupper (wc), &prev_st);
+            wcrtomb ((char *) pstr->mbs + byte_idx, towupper (wc), &prev_st);
           else
             memcpy (pstr->mbs + byte_idx,
                     pstr->raw_mbs + pstr->raw_mbs_idx + byte_idx, mbclen);
@@ -341,7 +346,7 @@
     {
       int remain_len = pstr->len - rawbuf_idx;
       prev_st = pstr->cur_state;
-      mbclen = mbrlen (pstr->raw_mbs + rawbuf_idx, remain_len,
+      mbclen = mbrlen ((const char *) pstr->raw_mbs + rawbuf_idx, remain_len,
                        &pstr->cur_state);
       if (BE (mbclen == (size_t) -2 || mbclen == (size_t) -1 || mbclen == 0, 0))
         {
@@ -421,9 +426,9 @@
       pstr->tip_context = ((eflags & REG_NOTBOL) ? CONTEXT_BEGBUF
                            : CONTEXT_NEWLINE | CONTEXT_BEGBUF);
       if (!MBS_CASE_ALLOCATED (pstr))
-        pstr->mbs_case = (unsigned char *)pstr->raw_mbs;
+        pstr->mbs_case = (unsigned char *) pstr->raw_mbs;
       if (!MBS_ALLOCATED (pstr) && !MBS_CASE_ALLOCATED (pstr))
-        pstr->mbs = (unsigned char *)pstr->raw_mbs;
+        pstr->mbs = (unsigned char *) pstr->raw_mbs;
       offset = idx;
     }
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/regex_internal.h ../glibc-2.3/posix/regex_internal.h
--- glibc-2.2.93/posix/regex_internal.h	Sat Jul 27 04:06:22 2002
+++ ../glibc-2.3/posix/regex_internal.h	Sat Sep 14 09:40:50 2002
@@ -275,13 +275,12 @@
 #define MBS_CASE_ALLOCATED(pstr) (pstr->trans != NULL)
 
 
-static reg_errcode_t re_string_allocate (re_string_t *pstr,
-                                         const unsigned char *str, int len,
-                                         int init_len,
+static reg_errcode_t re_string_allocate (re_string_t *pstr, const char *str,
+                                         int len, int init_len,
                                          RE_TRANSLATE_TYPE trans, int icase);
-static reg_errcode_t re_string_construct (re_string_t *pstr,
-					  const unsigned char *str, int len,
-                                          RE_TRANSLATE_TYPE trans, int icase);
+static reg_errcode_t re_string_construct (re_string_t *pstr, const char *str,
+                                          int len, RE_TRANSLATE_TYPE trans,
+                                          int icase);
 static reg_errcode_t re_string_reconstruct (re_string_t *pstr, int idx,
                                             int eflags, int newline);
 static reg_errcode_t re_string_realloc_buffers (re_string_t *pstr,
@@ -581,8 +580,7 @@
      int idx;
 {
 #ifdef _LIBC
-  const unsigned char *p;
-  const char *extra;
+  const unsigned char *p, *extra;
   const int32_t *table, *indirect;
   int32_t tmp;
 # include <locale/weight.h>
@@ -591,12 +589,13 @@
   if (nrules != 0)
     {
       table = (const int32_t *) _NL_CURRENT (LC_COLLATE, _NL_COLLATE_TABLEMB);
-      extra = (const char *) _NL_CURRENT (LC_COLLATE, _NL_COLLATE_EXTRAMB);
+      extra = (const unsigned char *)
+        _NL_CURRENT (LC_COLLATE, _NL_COLLATE_EXTRAMB);
       indirect = (const int32_t *) _NL_CURRENT (LC_COLLATE,
 						_NL_COLLATE_INDIRECTMB);
       p = pstr->mbs + idx;
       tmp = findidx (&p);
-      return p - (const unsigned char *) pstr->mbs - idx;
+      return p - pstr->mbs - idx;
     }
   else
 #endif /* _LIBC */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/regexec.c ../glibc-2.3/posix/regexec.c
--- glibc-2.2.93/posix/regexec.c	Mon Aug 26 18:39:02 2002
+++ ../glibc-2.3/posix/regexec.c	Sat Sep 14 09:40:50 2002
@@ -23,8 +23,13 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <wchar.h>
-#include <wctype.h>
+
+#if defined HAVE_WCHAR_H || defined _LIBC
+# include <wchar.h>
+#endif /* HAVE_WCHAR_H || _LIBC */
+#if defined HAVE_WCTYPE_H || defined _LIBC
+# include <wctype.h>
+#endif /* HAVE_WCTYPE_H || _LIBC */
 
 #ifdef _LIBC
 # ifndef _RE_DEFINE_LOCALE_FUNCTIONS
@@ -153,8 +158,8 @@
 
 int
 regexec (preg, string, nmatch, pmatch, eflags)
-    const regex_t *preg;
-    const char *string;
+    const regex_t *__restrict preg;
+    const char *__restrict string;
     size_t nmatch;
     regmatch_t pmatch[];
     int eflags;
@@ -1621,7 +1626,7 @@
 
   for (i = 0; i < nodes->nelem; ++i)
     {
-      unsigned char *buf;
+      char *buf;
       int dest_str_idx, subexp_idx, prev_nelem, subexp_len;
       int node_idx = nodes->elems[i];
       unsigned int context;
@@ -1674,7 +1679,7 @@
           if (BE (err != REG_NOERROR, 0))
             return err;
         }
-      buf = re_string_get_buffer (mctx->input);
+      buf = (char *) re_string_get_buffer (mctx->input);
       if (strncmp (buf + cur_regs[subexp_idx].rm_so, buf + cur_str_idx,
                    subexp_len) != 0)
         continue;
@@ -1855,27 +1860,51 @@
     }
 
   /* Update the transition table.  */
+  /* For all characters ch...:  */
   for (i = 0, ch = 0; i < BITSET_UINTS; ++i)
     for (j = 0; j < UINT_BITS; ++j, ++ch)
       if ((acceptable[i] >> j) & 1)
         {
+          /* The current state accepts the character ch.  */
           if (IS_WORD_CHAR (ch))
             {
               for (k = 0; k < ndests; ++k)
                 if ((dests_ch[k][i] >> j) & 1)
-                  trtable[ch] = dest_states_word[k];
+                  {
+                    /* k-th destination accepts the word character ch.  */
+                    trtable[ch] = dest_states_word[k];
+                    /* There must be only one destination which accepts
+                       character ch.  See group_nodes_into_DFAstates.  */
+                    break;
+                  }
             }
           else /* not WORD_CHAR */
             {
               for (k = 0; k < ndests; ++k)
                 if ((dests_ch[k][i] >> j) & 1)
-                  trtable[ch] = dest_states[k];
+                  {
+                    /* k-th destination accepts the non-word character ch.  */
+                    trtable[ch] = dest_states[k];
+                    /* There must be only one destination which accepts
+                       character ch.  See group_nodes_into_DFAstates.  */
+                    break;
+                  }
             }
         }
   /* new line */
-  for (k = 0; k < ndests; ++k)
-    if (bitset_contain (acceptable, NEWLINE_CHAR))
-      trtable[NEWLINE_CHAR] = dest_states_nl[k];
+  if (bitset_contain (acceptable, NEWLINE_CHAR))
+    {
+      /* The current state accepts newline character.  */
+      for (k = 0; k < ndests; ++k)
+        if (bitset_contain (dests_ch[k], NEWLINE_CHAR))
+          {
+            /* k-th destination accepts newline character.  */
+            trtable[NEWLINE_CHAR] = dest_states_nl[k];
+            /* There must be only one destination which accepts
+               newline.  See group_nodes_into_DFAstates.  */
+            break;
+          }
+    }
 
   re_free (dest_states_nl);
   re_free (dest_states_word);
@@ -2098,7 +2127,8 @@
         {
           unsigned int in_collseq = 0;
           const int32_t *table, *indirect;
-          const unsigned char *weights, *extra, *collseqwc;
+          const unsigned char *weights, *extra;
+          const char *collseqwc;
           int32_t idx;
           /* This #include defines a local function!  */
 #  include <locale/weight.h>
@@ -2183,7 +2213,12 @@
 # endif /* _LIBC */
         {
           /* match with range expression?  */
-          wchar_t cmp_buf[6] = {L'\0', L'\0', wc, L'\0', L'\0', L'\0'};
+#if __GNUC__ >= 2
+          wchar_t cmp_buf[] = {L'\0', L'\0', wc, L'\0', L'\0', L'\0'};
+#else
+          wchar_t cmp_buf[] = {L'\0', L'\0', L'\0', L'\0', L'\0', L'\0'};
+          cmp_buf[2] = wc;
+#endif
           for (i = 0; i < cset->nranges; ++i)
             {
               cmp_buf[0] = cset->range_starts[i];
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/posix/sys/utsname.h ../glibc-2.3/posix/sys/utsname.h
--- glibc-2.2.93/posix/sys/utsname.h	Sat Jul  7 15:21:17 2001
+++ ../glibc-2.3/posix/sys/utsname.h	Sat Sep 14 09:40:50 2002
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 92, 94, 96, 97, 99 Free Software Foundation, Inc.
+/* Copyright (C) 1991,92,94,96,97,99,2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -29,26 +29,38 @@
 
 #include <bits/utsname.h>
 
+#ifndef _UTSNAME_SYSNAME_LENGTH
+# define _UTSNAME_SYSNAME_LENGTH _UTSNAME_LENGTH
+#endif
 #ifndef _UTSNAME_NODENAME_LENGTH
 # define _UTSNAME_NODENAME_LENGTH _UTSNAME_LENGTH
 #endif
+#ifndef _UTSNAME_RELEASE_LENGTH
+# define _UTSNAME_RELEASE_LENGTH _UTSNAME_LENGTH
+#endif
+#ifndef _UTSNAME_VERSION_LENGTH
+# define _UTSNAME_VERSION_LENGTH _UTSNAME_LENGTH
+#endif
+#ifndef _UTSNAME_MACHINE_LENGTH
+# define _UTSNAME_MACHINE_LENGTH _UTSNAME_LENGTH
+#endif
 
 /* Structure describing the system and machine.  */
 struct utsname
   {
     /* Name of the implementation of the operating system.  */
-    char sysname[_UTSNAME_LENGTH];
+    char sysname[_UTSNAME_SYSNAME_LENGTH];
 
     /* Name of this node on the network.  */
     char nodename[_UTSNAME_NODENAME_LENGTH];
 
     /* Current release level of this implementation.  */
-    char release[_UTSNAME_LENGTH];
+    char release[_UTSNAME_RELEASE_LENGTH];
     /* Current version level of this release.  */
-    char version[_UTSNAME_LENGTH];
+    char version[_UTSNAME_VERSION_LENGTH];
 
     /* Name of the hardware type the system is running on.  */
-    char machine[_UTSNAME_LENGTH];
+    char machine[_UTSNAME_MACHINE_LENGTH];
 
 #if _UTSNAME_DOMAIN_LENGTH - 0
     /* Name of the domain of this node on the network.  */
@@ -61,6 +73,7 @@
   };
 
 #ifdef __USE_SVID
+/* Note that SVID assumes all members have the same size.  */
 # define SYS_NMLN  _UTSNAME_LENGTH
 #endif
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/resolv/nss_dns/dns-network.c ../glibc-2.3/resolv/nss_dns/dns-network.c
--- glibc-2.2.93/resolv/nss_dns/dns-network.c	Mon Aug 26 02:01:42 2002
+++ ../glibc-2.3/resolv/nss_dns/dns-network.c	Thu Sep  5 19:27:51 2002
@@ -70,10 +70,10 @@
 #define MAX_NR_ALIASES	48
 
 
-#if PACKETSZ > 1024
-#define MAXPACKET       PACKETSZ
+#if PACKETSZ > 65536
+# define MAXPACKET	PACKETSZ
 #else
-#define MAXPACKET       1024
+# define MAXPACKET	65536
 #endif
 
 
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/resolv/resolv.h ../glibc-2.3/resolv/resolv.h
--- glibc-2.2.93/resolv/resolv.h	Fri Aug  2 01:00:55 2002
+++ ../glibc-2.3/resolv/resolv.h	Sat Sep 14 09:40:50 2002
@@ -50,21 +50,20 @@
  */
 
 #ifndef _RESOLV_H_
+
+/* These headers are needed for types used in the `struct res_state'
+   declaration.  */
+#include <sys/types.h>
+#include <netinet/in.h>
+
 #ifndef __need_res_state
 # define _RESOLV_H_
 
 # include <sys/param.h>
-# if (!defined(BSD)) || (BSD < 199306)
-#  include <sys/bitypes.h>
-# else
-#  include <sys/types.h>
-# endif
 # include <sys/cdefs.h>
 # include <stdio.h>
 # include <arpa/nameser.h>
 #endif
-
-#include <netinet/in.h>
 
 #ifndef __res_state_defined
 # define __res_state_defined
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/shlib-versions ../glibc-2.3/shlib-versions
--- glibc-2.2.93/shlib-versions	Wed Jun 12 16:57:14 2002
+++ ../glibc-2.3/shlib-versions	Thu Sep  5 19:27:47 2002
@@ -24,6 +24,7 @@
 s390x-.*-linux.*        DEFAULT			GLIBC_2.2
 cris-.*-linux.*		DEFAULT			GLIBC_2.2
 x86_64-.*-linux.*       DEFAULT			GLIBC_2.2.5
+powerpc64-.*-linux.*	DEFAULT			GLIBC_2.3
 .*-.*-gnu-gnu.*		DEFAULT			GLIBC_2.2.6
 
 # Configuration		Library=version		Earliest symbol set (optional)
@@ -69,6 +70,7 @@
 mips.*-.*-linux.*	ld=ld.so.1		GLIBC_2.0 GLIBC_2.2
 hppa.*-.*-.*		ld=ld.so.1		GLIBC_2.2
 s390x-.*-linux.*	ld=ld64.so.1		GLIBC_2.2
+powerpc64.*-.*-linux.*	ld=ld64.so.1		GLIBC_2.3
 cris-.*-linux.*		ld=ld.so.1		GLIBC_2.2
 x86_64-.*-linux.*	ld=ld-linux-x86-64.so.2	GLIBC_2.2.5
 # We use the ELF ABI standard name for the default.
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/stdio-common/printf_fp.c ../glibc-2.3/stdio-common/printf_fp.c
--- glibc-2.2.93/stdio-common/printf_fp.c	Fri Aug  2 17:46:58 2002
+++ ../glibc-2.3/stdio-common/printf_fp.c	Sat Sep 14 09:40:51 2002
@@ -318,7 +318,7 @@
       fpnum.ldbl = *(const long double *) args[0];
 
       /* Check for special values: not a number or infinity.  */
-      if (INTUSE(__isnanl) (fpnum.ldbl))
+      if (__isnanl (fpnum.ldbl))
 	{
 	  if (isupper (info->spec))
 	    {
@@ -332,7 +332,7 @@
 	      }
 	  is_neg = 0;
 	}
-      else if (INTUSE(__isinfl) (fpnum.ldbl))
+      else if (__isinfl (fpnum.ldbl))
 	{
 	  if (isupper (info->spec))
 	    {
@@ -362,7 +362,7 @@
       fpnum.dbl = *(const double *) args[0];
 
       /* Check for special values: not a number or infinity.  */
-      if (INTUSE(__isnan) (fpnum.dbl))
+      if (__isnan (fpnum.dbl))
 	{
 	  if (isupper (info->spec))
 	    {
@@ -376,7 +376,7 @@
 	    }
 	  is_neg = 0;
 	}
-      else if (INTUSE(__isinf) (fpnum.dbl))
+      else if (__isinf (fpnum.dbl))
 	{
 	  if (isupper (info->spec))
 	    {
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/stdio-common/printf_size.c ../glibc-2.3/stdio-common/printf_size.c
--- glibc-2.2.93/stdio-common/printf_size.c	Sun Apr 14 05:55:28 2002
+++ ../glibc-2.3/stdio-common/printf_size.c	Sat Sep 14 09:40:51 2002
@@ -136,13 +136,13 @@
       fpnum.ldbl.d = *(const long double *) args[0];
 
       /* Check for special values: not a number or infinity.  */
-      if (INTUSE(__isnanl) (fpnum.ldbl.d))
+      if (__isnanl (fpnum.ldbl.d))
 	{
 	  special = "nan";
 	  wspecial = L"nan";
 	  negative = 0;
 	}
-      else if (INTUSE(__isinfl) (fpnum.ldbl.d))
+      else if (__isinfl (fpnum.ldbl.d))
 	{
 	  special = "inf";
 	  wspecial = L"inf";
@@ -162,13 +162,13 @@
       fpnum.dbl.d = *(const double *) args[0];
 
       /* Check for special values: not a number or infinity.  */
-      if (INTUSE(__isnan) (fpnum.dbl.d))
+      if (__isnan (fpnum.dbl.d))
 	{
 	  special = "nan";
 	  wspecial = L"nan";
 	  negative = 0;
 	}
-      else if (INTUSE(__isinf) (fpnum.dbl.d))
+      else if (__isinf (fpnum.dbl.d))
 	{
 	  special = "inf";
 	  wspecial = L"inf";
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/stdlib/longlong.h ../glibc-2.3/stdlib/longlong.h
--- glibc-2.2.93/stdlib/longlong.h	Sat Jul  7 15:21:18 2001
+++ ../glibc-2.3/stdlib/longlong.h	Sat Sep 14 09:40:51 2002
@@ -759,7 +759,8 @@
   } while (0)
 #endif /* __ns32000__ */
 
-#if (defined (_ARCH_PPC) || defined (_IBMR2)) && W_TYPE_SIZE == 32
+#if (defined (_ARCH_PPC) || defined (_IBMR2)) 
+#if W_TYPE_SIZE == 32
 #define add_ssaaaa(sh, sl, ah, al, bh, bl) \
   do {									\
     if (__builtin_constant_p (bh) && (bh) == 0)				\
@@ -877,6 +878,102 @@
 	   : "r" ((SItype) (nh)), "1" ((SItype) (nl)), "r" ((SItype) (d)))
 #define UDIV_TIME 100
 #endif
+#else /* W_TYPE_SIZE != 32.  */
+/* Must be powerpc64.  */
+#define add_ssaaaa(sh, sl, ah, al, bh, bl) \
+  do {									\
+    if (__builtin_constant_p (bh) && (bh) == 0)				\
+      __asm__ ("{a%I4|add%I4c} %1,%3,%4\n\t{aze|addze} %0,%2"		\
+	     : "=r" ((UDItype) (sh)),					\
+	       "=&r" ((UDItype) (sl))					\
+	     : "%r" ((UDItype) (ah)),					\
+	       "%r" ((UDItype) (al)),					\
+	       "rI" ((UDItype) (bl)));					\
+    else if (__builtin_constant_p (bh) && (bh) ==~(UDItype) 0)		\
+      __asm__ ("{a%I4|add%I4c} %1,%3,%4\n\t{ame|addme} %0,%2"		\
+	     : "=r" ((UDItype) (sh)),					\
+	       "=&r" ((UDItype) (sl))					\
+	     : "%r" ((UDItype) (ah)),					\
+	       "%r" ((UDItype) (al)),					\
+	       "rI" ((UDItype) (bl)));					\
+    else								\
+      __asm__ ("{a%I5|add%I5c} %1,%4,%5\n\t{ae|adde} %0,%2,%3"		\
+	     : "=r" ((UDItype) (sh)),					\
+	       "=&r" ((UDItype) (sl))					\
+	     : "%r" ((UDItype) (ah)),					\
+	       "r" ((UDItype) (bh)),					\
+	       "%r" ((UDItype) (al)),					\
+	       "rI" ((UDItype) (bl)));					\
+  } while (0)
+#define sub_ddmmss(sh, sl, ah, al, bh, bl) \
+  do {									\
+    if (__builtin_constant_p (ah) && (ah) == 0)				\
+      __asm__ ("{sf%I3|subf%I3c} %1,%4,%3\n\t{sfze|subfze} %0,%2"	\
+	       : "=r" ((UDItype) (sh)),					\
+		 "=&r" ((UDItype) (sl))					\
+	       : "r" ((UDItype) (bh)),					\
+		 "rI" ((UDItype) (al)),					\
+		 "r" ((UDItype) (bl)));					\
+    else if (__builtin_constant_p (ah) && (ah) ==~(UDItype) 0)		\
+      __asm__ ("{sf%I3|subf%I3c} %1,%4,%3\n\t{sfme|subfme} %0,%2"	\
+	       : "=r" ((UDItype) (sh)),					\
+		 "=&r" ((UDItype) (sl))					\
+	       : "r" ((UDItype) (bh)),					\
+		 "rI" ((UDItype) (al)),					\
+		 "r" ((UDItype) (bl)));					\
+    else if (__builtin_constant_p (bh) && (bh) == 0)			\
+      __asm__ ("{sf%I3|subf%I3c} %1,%4,%3\n\t{ame|addme} %0,%2"		\
+	       : "=r" ((UDItype) (sh)),					\
+		 "=&r" ((UDItype) (sl))					\
+	       : "r" ((UDItype) (ah)),					\
+		 "rI" ((UDItype) (al)),					\
+		 "r" ((UDItype) (bl)));					\
+    else if (__builtin_constant_p (bh) && (bh) ==~(UDItype) 0)		\
+      __asm__ ("{sf%I3|subf%I3c} %1,%4,%3\n\t{aze|addze} %0,%2"		\
+	       : "=r" ((UDItype) (sh)),					\
+		 "=&r" ((UDItype) (sl))					\
+	       : "r" ((UDItype) (ah)),					\
+		 "rI" ((UDItype) (al)),					\
+		 "r" ((UDItype) (bl)));					\
+    else								\
+      __asm__ ("{sf%I4|subf%I4c} %1,%5,%4\n\t{sfe|subfe} %0,%3,%2"	\
+	       : "=r" ((UDItype) (sh)),					\
+		 "=&r" ((UDItype) (sl))					\
+	       : "r" ((UDItype) (ah)),					\
+		 "r" ((UDItype) (bh)),					\
+		 "rI" ((UDItype) (al)),					\
+		 "r" ((UDItype) (bl)));					\
+  } while (0)
+
+#define count_leading_zeros(count, x) \
+  __asm__ ("{cntlz|cntlzd} %0,%1"					\
+	   : "=r" (count)					\
+	   : "r" ((UDItype) (x)))
+#define COUNT_LEADING_ZEROS_0 64
+
+#define umul_ppmm(ph, pl, m0, m1) \
+  do {									\
+    UDItype __m0 = (m0), __m1 = (m1);					\
+    __asm__ ("mulhdu %0,%1,%2"						\
+	     : "=r" ((UDItype) ph)					\
+	     : "%r" (__m0),						\
+	       "r" (__m1));						\
+    (pl) = __m0 * __m1;							\
+  } while (0)
+#define UMUL_TIME 16
+
+#define smul_ppmm(ph, pl, m0, m1) \
+  do {									\
+    DItype __m0 = (m0), __m1 = (m1);					\
+    __asm__ ("mulhd %0,%1,%2"						\
+	     : "=r" ((DItype) ph)					\
+	     : "%r" (__m0),						\
+	       "r" (__m1));						\
+    (pl) = __m0 * __m1;							\
+  } while (0)
+#define SMUL_TIME 16
+#define UDIV_TIME 72
+#endif /* W_TYPE_SIZE == 32 */
 #endif /* Power architecture variants.  */
 
 #if defined (__pyr__) && W_TYPE_SIZE == 32
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/string/stratcliff.c ../glibc-2.3/string/stratcliff.c
--- glibc-2.2.93/string/stratcliff.c	Wed Aug 22 20:08:10 2001
+++ ../glibc-2.3/string/stratcliff.c	Sat Sep 14 09:40:51 2002
@@ -1,5 +1,5 @@
 /* Test for string function add boundaries of usable memory.
-   Copyright (C) 1996, 1997, 1999, 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1996,1997,1999,2000,2001,2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
 
@@ -192,7 +192,25 @@
 	    }
         }
 
-      /* strncpy test */
+      /* strncpy tests */
+      adr[size-1] = 'T';
+      for (outer = size - 1; outer >= MAX (0, size - 128); --outer)
+	{
+	  size_t len;
+
+	  for (len = 0; len < size - outer; ++len)
+	    {
+	      if (strncpy (dest, &adr[outer], len) != dest
+		  || memcmp (dest, &adr[outer], len) != 0)
+		{
+		  printf ("outer strncpy flunked for outer = %d, len = %Zd\n",
+			  outer, len);
+		  result = 1;
+		}
+	    }
+        }
+      adr[size-1] = '\0';
+
       for (outer = size - 1; outer >= MAX (0, size - 128); --outer)
         {
           for (inner = MAX (outer, size - 64); inner < size; ++inner)
@@ -210,6 +228,16 @@
 			  && strlen (dest) != (inner - outer)))
 		    {
 		      printf ("strncpy flunked for outer = %d, inner = %d, len = %Zd\n",
+			      outer, inner, len);
+		      result = 1;
+		    }
+		  if (strncpy (dest + 1, &adr[outer], len) != dest + 1
+		      || memcmp (dest + 1, &adr[outer],
+				 MIN (inner - outer, len)) != 0
+		      || (inner - outer < len
+			  && strlen (dest + 1) != (inner - outer)))
+		    {
+		      printf ("strncpy+1 flunked for outer = %d, inner = %d, len = %Zd\n",
 			      outer, inner, len);
 		      result = 1;
 		    }
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/alpha/fpu/fesetenv.c ../glibc-2.3/sysdeps/alpha/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/alpha/fpu/fesetenv.c	Sat Jul  7 15:21:19 2001
+++ ../glibc-2.3/sysdeps/alpha/fpu/fesetenv.c	Sat Sep 14 09:40:51 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson <rth@tamu.edu>, 1997
 
@@ -53,4 +53,5 @@
 compat_symbol (libm, __old_fesetenv, fesetenv, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__fesetenv, fesetenv)
 versioned_symbol (libm, __fesetenv, fesetenv, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/alpha/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/alpha/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/alpha/fpu/fraiseexcpt.c	Sat Jul  7 15:21:19 2001
+++ ../glibc-2.3/sysdeps/alpha/fpu/fraiseexcpt.c	Sat Sep 14 09:40:51 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997,98,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,98,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Richard Henderson <rth@tamu.edu>, 1997.
 
@@ -44,4 +44,5 @@
 compat_symbol (libm, __old_feraiseexcept, feraiseexcept, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__feraiseexcept, feraiseexcept)
 versioned_symbol (libm, __feraiseexcept, feraiseexcept, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/arm/fpu/fesetenv.c ../glibc-2.3/sysdeps/arm/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/arm/fpu/fesetenv.c	Sat Jul  7 15:21:19 2001
+++ ../glibc-2.3/sysdeps/arm/fpu/fesetenv.c	Sat Sep 14 09:40:51 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997,98,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,98,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -41,4 +41,5 @@
 compat_symbol (libm, __old_fesetenv, fesetenv, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__fesetenv, fesetenv)
 versioned_symbol (libm, __fesetenv, fesetenv, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/arm/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/arm/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/arm/fpu/fraiseexcpt.c	Sat Jul  7 15:21:19 2001
+++ ../glibc-2.3/sysdeps/arm/fpu/fraiseexcpt.c	Sat Sep 14 09:40:51 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997,98,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,98,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -40,4 +40,5 @@
 compat_symbol (libm, __old_feraiseexcept, feraiseexcept, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__feraiseexcept, feraiseexcept)
 versioned_symbol (libm, __feraiseexcept, feraiseexcept, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/_strerror.c ../glibc-2.3/sysdeps/generic/_strerror.c
--- glibc-2.2.93/sysdeps/generic/_strerror.c	Sat Aug  3 16:31:26 2002
+++ ../glibc-2.3/sysdeps/generic/_strerror.c	Thu Sep  5 19:27:52 2002
@@ -22,11 +22,6 @@
 #include <sys/param.h>
 #include <stdio-common/_itoa.h>
 
-#ifndef HAVE_GNU_LD
-# define _sys_errlist sys_errlist
-# define _sys_nerr sys_nerr
-#endif
-
 /* It is critical here that we always use the `dcgettext' function for
    the message translation.  Since <libintl.h> only defines the macro
    `dgettext' to use `dcgettext' for optimizing programs this is not
@@ -40,8 +35,8 @@
 char *
 __strerror_r (int errnum, char *buf, size_t buflen)
 {
-  if (errnum < 0 || errnum >= INTUSE(_sys_nerr)
-      || INTUSE(_sys_errlist)[errnum] == NULL)
+  if (errnum < 0 || errnum >= _sys_nerr_internal
+      || _sys_errlist_internal[errnum] == NULL)
     {
       /* Buffer we use to print the number in.  For a maximum size for
 	 `int' of 8 bytes we never need more than 20 digits.  */
@@ -66,7 +61,7 @@
       return buf;
     }
 
-  return (char *) _(INTUSE(_sys_errlist)[errnum]);
+  return (char *) _(_sys_errlist_internal[errnum]);
 }
 weak_alias (__strerror_r, strerror_r)
 libc_hidden_def (__strerror_r)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/bits/ustat.h ../glibc-2.3/sysdeps/generic/bits/ustat.h
--- glibc-2.2.93/sysdeps/generic/bits/ustat.h	Wed Jul 10 03:24:32 2002
+++ ../glibc-2.3/sysdeps/generic/bits/ustat.h	Sat Sep 14 09:40:51 2002
@@ -24,8 +24,8 @@
 
 struct ustat
   {
-    __daddr_t f_tfree;
-    __ino_t f_tinode;
+    __daddr_t f_tfree;		/* Number of free blocks.  */
+    __ino_t f_tinode;		/* Number of free inodes.  */
     char f_fname[6];
     char f_fpack[6];
   };
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/dl-environ.c ../glibc-2.3/sysdeps/generic/dl-environ.c
--- glibc-2.2.93/sysdeps/generic/dl-environ.c	Thu Mar 14 23:58:47 2002
+++ ../glibc-2.3/sysdeps/generic/dl-environ.c	Sat Sep 14 09:40:51 2002
@@ -67,7 +67,7 @@
       while ((*ep)[cnt] == name[cnt] && name[cnt] != '\0')
 	++cnt;
 
-      if ((*ep)[cnt] == '=')
+      if (name[cnt] == '\0' && (*ep)[cnt] == '=')
 	{
 	  /* Found it.  Remove this pointer by moving later ones to
 	     the front.  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/fesetenv.c ../glibc-2.3/sysdeps/generic/fesetenv.c
--- glibc-2.2.93/sysdeps/generic/fesetenv.c	Sat Jul  7 15:21:20 2001
+++ ../glibc-2.3/sysdeps/generic/fesetenv.c	Sat Sep 14 09:40:51 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -31,6 +31,7 @@
 strong_alias (__fesetenv, __old_fesetenv)
 compat_symbol (libm, __old_fesetenv, fesetenv, GLIBC_2_1);
 #endif
+libm_hidden_ver (__fesetenv, fesetenv)
 versioned_symbol (libm, __fesetenv, fesetenv, GLIBC_2_2);
 
 stub_warning (fesetenv)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/fraiseexcpt.c ../glibc-2.3/sysdeps/generic/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/generic/fraiseexcpt.c	Sat Jul  7 15:21:20 2001
+++ ../glibc-2.3/sysdeps/generic/fraiseexcpt.c	Sat Sep 14 09:40:51 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -31,6 +31,7 @@
 strong_alias (__feraiseexcept, __old_feraiseexcept)
 compat_symbol (libm, __old_feraiseexcept, feraiseexcept, GLIBC_2_1);
 #endif
+libm_hidden_ver (__feraiseexcept, feraiseexcept)
 versioned_symbol (libm, __feraiseexcept, feraiseexcept, GLIBC_2_2);
 
 stub_warning (feraiseexcept)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/ldconfig.h ../glibc-2.3/sysdeps/generic/ldconfig.h
--- glibc-2.2.93/sysdeps/generic/ldconfig.h	Sat Jul  7 15:21:21 2001
+++ ../glibc-2.3/sysdeps/generic/ldconfig.h	Sat Sep 14 09:40:51 2002
@@ -31,6 +31,7 @@
 #define FLAG_IA64_LIB64		0x0200
 #define FLAG_X8664_LIB64	0x0300
 #define FLAG_S390_LIB64		0x0400
+#define FLAG_POWERPC_LIB64	0x0500
 
 /* Declared in cache.c.  */
 extern void print_cache (const char *cache_name);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/printf_fphex.c ../glibc-2.3/sysdeps/generic/printf_fphex.c
--- glibc-2.2.93/sysdeps/generic/printf_fphex.c	Sun Apr 14 05:56:28 2002
+++ ../glibc-2.3/sysdeps/generic/printf_fphex.c	Sat Sep 14 09:40:51 2002
@@ -170,7 +170,7 @@
       fpnum.ldbl.d = *(const long double *) args[0];
 
       /* Check for special values: not a number or infinity.  */
-      if (INTUSE(__isnanl) (fpnum.ldbl.d))
+      if (__isnanl (fpnum.ldbl.d))
 	{
 	  if (isupper (info->spec))
 	    {
@@ -186,7 +186,7 @@
 	}
       else
 	{
-	  if (INTUSE(__isinfl) (fpnum.ldbl.d))
+	  if (__isinfl (fpnum.ldbl.d))
 	    {
 	      if (isupper (info->spec))
 		{
@@ -209,7 +209,7 @@
       fpnum.dbl.d = *(const double *) args[0];
 
       /* Check for special values: not a number or infinity.  */
-      if (INTUSE(__isnan) (fpnum.dbl.d))
+      if (__isnan (fpnum.dbl.d))
 	{
 	  if (isupper (info->spec))
 	    {
@@ -225,7 +225,7 @@
 	}
       else
 	{
-	  if (INTUSE(__isinf) (fpnum.dbl.d))
+	  if (__isinf (fpnum.dbl.d))
 	    {
 	      if (isupper (info->spec))
 		{
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/s_expm1l.c ../glibc-2.3/sysdeps/generic/s_expm1l.c
--- glibc-2.2.93/sysdeps/generic/s_expm1l.c	Sun Oct 12 23:52:31 1997
+++ ../glibc-2.3/sysdeps/generic/s_expm1l.c	Sat Sep 14 09:40:51 2002
@@ -9,6 +9,7 @@
   __set_errno (ENOSYS);
   return 0.0;
 }
+libm_hidden_def (__expm1l)
 weak_alias (__expm1l, expm1l)
 
 stub_warning (expm1l)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/s_ldexp.c ../glibc-2.3/sysdeps/generic/s_ldexp.c
--- glibc-2.2.93/sysdeps/generic/s_ldexp.c	Tue Apr  9 03:37:14 2002
+++ ../glibc-2.3/sysdeps/generic/s_ldexp.c	Sat Sep 14 09:40:51 2002
@@ -25,9 +25,9 @@
 	double value; int exp;
 #endif
 {
-	if(!INTUSE(__finite)(value)||value==0.0) return value;
+	if(!__finite(value)||value==0.0) return value;
 	value = __scalbn(value,exp);
-	if(!INTUSE(__finite)(value)||value==0.0) __set_errno (ERANGE);
+	if(!__finite(value)||value==0.0) __set_errno (ERANGE);
 	return value;
 }
 weak_alias (__ldexp, ldexp)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/s_ldexpf.c ../glibc-2.3/sysdeps/generic/s_ldexpf.c
--- glibc-2.2.93/sysdeps/generic/s_ldexpf.c	Tue Apr  9 03:35:56 2002
+++ ../glibc-2.3/sysdeps/generic/s_ldexpf.c	Sat Sep 14 09:40:51 2002
@@ -28,9 +28,9 @@
 	float value; int exp;
 #endif
 {
-	if(!INTUSE(__finitef)(value)||value==(float)0.0) return value;
+	if(!__finitef(value)||value==(float)0.0) return value;
 	value = __scalbnf(value,exp);
-	if(!INTUSE(__finitef)(value)||value==(float)0.0) __set_errno (ERANGE);
+	if(!__finitef(value)||value==(float)0.0) __set_errno (ERANGE);
 	return value;
 }
 INTDEF(__ldexpf)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/s_ldexpl.c ../glibc-2.3/sysdeps/generic/s_ldexpl.c
--- glibc-2.2.93/sysdeps/generic/s_ldexpl.c	Tue Apr  9 03:37:33 2002
+++ ../glibc-2.3/sysdeps/generic/s_ldexpl.c	Sat Sep 14 09:40:51 2002
@@ -29,9 +29,9 @@
 	long double value; int exp;
 #endif
 {
-	if(!INTUSE(__finitel)(value)||value==0.0) return value;
+	if(!__finitel(value)||value==0.0) return value;
 	value = __scalbnl(value,exp);
-	if(!INTUSE(__finitel)(value)||value==0.0) __set_errno (ERANGE);
+	if(!__finitel(value)||value==0.0) __set_errno (ERANGE);
 	return value;
 }
 weak_alias (__ldexpl, ldexpl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/generic/sigset-cvt-mask.h ../glibc-2.3/sysdeps/generic/sigset-cvt-mask.h
--- glibc-2.2.93/sysdeps/generic/sigset-cvt-mask.h	Tue Aug 27 00:52:37 2002
+++ ../glibc-2.3/sysdeps/generic/sigset-cvt-mask.h	Thu Sep  5 19:27:52 2002
@@ -27,7 +27,7 @@
 sigset_set_old_mask (sigset_t *set, int mask)
 {
   if (sizeof (__sigset_t) == sizeof (unsigned int))
-    *set = (unsigned int) (mask);
+    *set = (unsigned int) mask;
   else
     {
       register unsigned int __sig;
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/hppa/fpu/fesetenv.c ../glibc-2.3/sysdeps/hppa/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/hppa/fpu/fesetenv.c	Sat Jul  7 15:21:23 2001
+++ ../glibc-2.3/sysdeps/hppa/fpu/fesetenv.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Huggins-Daines <dhd@debian.org>, 2000
    Based on the m68k version by
@@ -68,3 +68,4 @@
   /* Success.  */
   return 0;
 }
+libm_hidden_def (fesetenv)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/hppa/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/hppa/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/hppa/fpu/fraiseexcpt.c	Sat Jul  7 15:21:23 2001
+++ ../glibc-2.3/sysdeps/hppa/fpu/fraiseexcpt.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by David Huggins-Daines <dhd@debian.org>
 
@@ -88,3 +88,4 @@
   /* Success.  */
   return 0;
 }
+libm_hidden_def (feraiseexcept)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/dl-machine.h ../glibc-2.3/sysdeps/i386/dl-machine.h
--- glibc-2.2.93/sysdeps/i386/dl-machine.h	Fri Aug 30 01:20:40 2002
+++ ../glibc-2.3/sysdeps/i386/dl-machine.h	Sat Sep 14 09:40:52 2002
@@ -410,8 +410,6 @@
 	  *reloc_addr = value;
 	  break;
 
-	  /* XXX Remove TLS relocations which are not needed.  */
-
 #ifdef USE_TLS
 	case R_386_TLS_DTPMOD32:
 # ifdef RTLD_BOOTSTRAP
@@ -432,7 +430,7 @@
 	  /* During relocation all TLS symbols are defined and used.
 	     Therefore the offset is already correct.  */
 	  if (sym != NULL)
-	    *reloc_addr += sym->st_value;
+	    *reloc_addr = sym->st_value;
 # endif
 	  break;
 	case R_386_TLS_TPOFF32:
@@ -444,7 +442,7 @@
 	     It is a positive value which will be subtracted from the
 	     thread pointer.  To get the variable position in the TLS
 	     block we subtract the offset from that of the TLS block.  */
-	  if (sym_map != NULL && sym != NULL)
+	  if (sym != NULL)
 	    *reloc_addr += sym_map->l_tls_offset - sym->st_value;
 # endif
 	  break;
@@ -516,7 +514,44 @@
 	case R_386_PC32:
 	  *reloc_addr = (value + reloc->r_addend - (Elf32_Addr) reloc_addr);
 	  break;
-	  /* XXX Do we have to handle the TLS relocation here?  */
+
+#ifdef USE_TLS
+	case R_386_TLS_DTPMOD32:
+# ifdef RTLD_BOOTSTRAP
+	  /* During startup the dynamic linker is always the module
+	     with index 1.
+	     XXX If this relocation is necessary move before RESOLVE
+	     call.  */
+	  *reloc_addr = 1;
+# else
+	  /* Get the information from the link map returned by the
+	     resolv function.  */
+	  if (sym_map != NULL)
+	    *reloc_addr = sym_map->l_tls_modid;
+# endif
+	  break;
+	case R_386_TLS_DTPOFF32:
+# ifndef RTLD_BOOTSTRAP
+	  /* During relocation all TLS symbols are defined and used.
+	     Therefore the offset is already correct.  */
+	  *reloc_addr = (sym == NULL ? 0 : sym->st_value) + reloc->r_addend;
+# endif
+	  break;
+	case R_386_TLS_TPOFF32:
+	  /* The offset is positive, backward from the thread pointer.  */
+# ifdef RTLD_BOOTSTRAP
+	  *reloc_addr = map->l_tls_offset - sym->st_value + reloc->r_addend;
+# else
+	  /* We know the offset of object the symbol is contained in.
+	     It is a positive value which will be subtracted from the
+	     thread pointer.  To get the variable position in the TLS
+	     block we subtract the offset from that of the TLS block.  */
+	  *reloc_addr
+	    = (sym == NULL ? 0 : sym_map->l_tls_offset - sym->st_value)
+	      + reloc->r_addend;
+# endif
+	  break;
+#endif	/* use TLS */
 	default:
 	  /* We add these checks in the version to relocate ld.so only
 	     if we are still debugging.  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/fesetenv.c ../glibc-2.3/sysdeps/i386/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/i386/fpu/fesetenv.c	Sat Jul  7 15:21:23 2001
+++ ../glibc-2.3/sysdeps/i386/fpu/fesetenv.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997,98,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,98,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -84,4 +84,5 @@
 compat_symbol (libm, BP_SYM (__old_fesetenv), BP_SYM (fesetenv), GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__fesetenv, fesetenv)
 versioned_symbol (libm, BP_SYM (__fesetenv), BP_SYM (fesetenv), GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/i386/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/i386/fpu/fraiseexcpt.c	Sat Jul  7 15:21:23 2001
+++ ../glibc-2.3/sysdeps/i386/fpu/fraiseexcpt.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -120,4 +120,5 @@
 compat_symbol (libm, __old_feraiseexcept, feraiseexcept, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__feraiseexcept, feraiseexcept)
 versioned_symbol (libm, __feraiseexcept, feraiseexcept, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/s_expm1l.S ../glibc-2.3/sysdeps/i386/fpu/s_expm1l.S
--- glibc-2.2.93/sysdeps/i386/fpu/s_expm1l.S	Sat Jul  7 15:21:23 2001
+++ ../glibc-2.3/sysdeps/i386/fpu/s_expm1l.S	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* ix87 specific implementation of exp(x)-1.
-   Copyright (C) 1996, 1997 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
    Based on code by John C. Bowman <bowman@ipp-garching.mpg.de>.
@@ -85,4 +85,5 @@
 	fldl	MO(minus1)	// Set result to -1.0.
 3:	ret
 END(__expm1l)
+libm_hidden_def (__expm1l)
 weak_alias (__expm1l, expm1l)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/s_finite.S ../glibc-2.3/sysdeps/i386/fpu/s_finite.S
--- glibc-2.2.93/sysdeps/i386/fpu/s_finite.S	Tue Apr  9 04:15:23 2002
+++ ../glibc-2.3/sysdeps/i386/fpu/s_finite.S	Sat Sep 14 09:40:52 2002
@@ -12,5 +12,6 @@
 	shrl	$31, %eax
 	ret
 END (__finite)
-strong_alias(__finite, __finite_internal)
 weak_alias (__finite, finite)
+hidden_def (__finite)
+
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/s_finitef.S ../glibc-2.3/sysdeps/i386/fpu/s_finitef.S
--- glibc-2.2.93/sysdeps/i386/fpu/s_finitef.S	Tue Apr  9 04:15:34 2002
+++ ../glibc-2.3/sysdeps/i386/fpu/s_finitef.S	Sat Sep 14 09:40:52 2002
@@ -12,5 +12,5 @@
 	shrl    $31,%eax
 	ret
 END (__finitef)
-strong_alias(__finitef, __finitef_internal)
 weak_alias (__finitef, finitef)
+hidden_def (__finitef)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/s_finitel.S ../glibc-2.3/sysdeps/i386/fpu/s_finitel.S
--- glibc-2.2.93/sysdeps/i386/fpu/s_finitel.S	Tue Apr  9 04:15:43 2002
+++ ../glibc-2.3/sysdeps/i386/fpu/s_finitel.S	Sat Sep 14 09:40:52 2002
@@ -11,5 +11,5 @@
 	shrl	$31, %eax
 	ret
 END (__finitel)
-strong_alias(__finitel, __finitel_internal)
 weak_alias (__finitel, finitel)
+hidden_def (__finitel)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/s_fpclassifyl.c ../glibc-2.3/sysdeps/i386/fpu/s_fpclassifyl.c
--- glibc-2.2.93/sysdeps/i386/fpu/s_fpclassifyl.c	Sat Jul  7 15:21:23 2001
+++ ../glibc-2.3/sysdeps/i386/fpu/s_fpclassifyl.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Return classification value corresponding to argument.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -40,3 +40,4 @@
 
   return retval;
 }
+libm_hidden_def (__fpclassifyl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/s_isinfl.c ../glibc-2.3/sysdeps/i386/fpu/s_isinfl.c
--- glibc-2.2.93/sysdeps/i386/fpu/s_isinfl.c	Sun Apr 14 05:29:21 2002
+++ ../glibc-2.3/sysdeps/i386/fpu/s_isinfl.c	Sat Sep 14 09:40:52 2002
@@ -33,5 +33,5 @@
 	se &= 0x8000;
 	return ~(lx >> 31) & (1 - (se >> 14));
 }
-INTDEF(__isinfl)
+hidden_def (__isinfl)
 weak_alias (__isinfl, isinfl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/i386/fpu/s_isnanl.c ../glibc-2.3/sysdeps/i386/fpu/s_isnanl.c
--- glibc-2.2.93/sysdeps/i386/fpu/s_isnanl.c	Sun Apr 14 05:35:22 2002
+++ ../glibc-2.3/sysdeps/i386/fpu/s_isnanl.c	Sat Sep 14 09:40:52 2002
@@ -44,5 +44,5 @@
 	se = 0xfffe - se;
 	return (int)((u_int32_t)(se))>>16;
 }
-INTDEF(__isnanl)
+hidden_def (__isnanl)
 weak_alias (__isnanl, isnanl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ia64/fpu/fesetenv.c ../glibc-2.3/sysdeps/ia64/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/ia64/fpu/fesetenv.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/ia64/fpu/fesetenv.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jes Sorensen <Jes.Sorensen@cern.ch>, 2000
 
@@ -39,3 +39,4 @@
 
   return 0;
 }
+libm_hidden_def (fesetenv)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ia64/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/ia64/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/ia64/fpu/fraiseexcpt.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/ia64/fpu/fraiseexcpt.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997, 1998, 2000, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2000, 2001, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Jes Sorensen <Jes.Sorensen@cern.ch>, 2000.
 
@@ -77,3 +77,4 @@
   /* Success.  */
   return 0;
 }
+libm_hidden_def (feraiseexcept)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ia64/fpu/s_expm1l.S ../glibc-2.3/sysdeps/ia64/fpu/s_expm1l.S
--- glibc-2.2.93/sysdeps/ia64/fpu/s_expm1l.S	Wed Jul 10 03:24:35 2002
+++ ../glibc-2.3/sysdeps/ia64/fpu/s_expm1l.S	Sat Sep 14 09:40:52 2002
@@ -565,6 +565,10 @@
 .endp expm1l
 ASM_SIZE_DIRECTIVE(expm1l)
 
+#ifdef _LIBC
+libm_hidden_def (__expm1l)
+#endif
+
 .section .text
 .proc expl#
 .global expl#
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ia64/fpu/s_finite.S ../glibc-2.3/sysdeps/ia64/fpu/s_finite.S
--- glibc-2.2.93/sysdeps/ia64/fpu/s_finite.S	Fri Apr 26 19:35:16 2002
+++ ../glibc-2.3/sysdeps/ia64/fpu/s_finite.S	Sat Sep 14 09:40:52 2002
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,12 +33,13 @@
 }	
 END (__finite)
 
-strong_alias (__finite, __finite_internal)
 strong_alias (__finite, __finitef)
-strong_alias (__finitef, __finitef_internal)
 strong_alias (__finite, __finitel)
-strong_alias (__finitel, __finitel_internal)
 
 weak_alias (__finite, finite)
 weak_alias (__finitef, finitef)
 weak_alias (__finitel, finitel)
+
+hidden_def (__finite)
+hidden_def (__finitef)
+hidden_def (__finitel)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ia64/fpu/s_fpclassify.S ../glibc-2.3/sysdeps/ia64/fpu/s_fpclassify.S
--- glibc-2.2.93/sysdeps/ia64/fpu/s_fpclassify.S	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/ia64/fpu/s_fpclassify.S	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Return classification value corresponding to argument.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -57,3 +57,6 @@
 
 strong_alias (__fpclassify, __fpclassifyf)
 strong_alias (__fpclassify, __fpclassifyl)
+libm_hidden_def (__fpclassify)
+libm_hidden_def (__fpclassifyf)
+libm_hidden_def (__fpclassifyl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ia64/fpu/s_isinf.S ../glibc-2.3/sysdeps/ia64/fpu/s_isinf.S
--- glibc-2.2.93/sysdeps/ia64/fpu/s_isinf.S	Fri Apr 26 16:23:56 2002
+++ ../glibc-2.3/sysdeps/ia64/fpu/s_isinf.S	Sat Sep 14 09:40:52 2002
@@ -46,12 +46,13 @@
 }
 END (__isinf)
 
-strong_alias (__isinf, __isinf_internal)
 strong_alias (__isinf, __isinff)
-strong_alias (__isinff, __isinff_internal)
 strong_alias (__isinf, __isinfl)
-strong_alias (__isinfl, __isinfl_internal)
 
 weak_alias (__isinf, isinf)
 weak_alias (__isinff, isinff)
 weak_alias (__isinfl, isinfl)
+
+hidden_def (__isinf)
+hidden_def (__isinff)
+hidden_def (__isinfl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ia64/fpu/s_isnan.S ../glibc-2.3/sysdeps/ia64/fpu/s_isnan.S
--- glibc-2.2.93/sysdeps/ia64/fpu/s_isnan.S	Sun Apr 14 05:37:22 2002
+++ ../glibc-2.3/sysdeps/ia64/fpu/s_isnan.S	Sat Sep 14 09:40:52 2002
@@ -39,12 +39,13 @@
 }
 END (__isnan)
 
-strong_alias (__isnan, __isnan_internal)
 strong_alias (__isnan, __isnanf)
-strong_alias (__isnanf, __isnanf_internal)
 strong_alias (__isnan, __isnanl)
-strong_alias (__isnanl, __isnanl_internal)
 
 weak_alias (__isnan, isnan)
 weak_alias (__isnanf, isnanf)
 weak_alias (__isnanl, isnanl)
+
+hidden_def (__isnan)
+hidden_def (__isnanf)
+hidden_def (__isnanl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/dbl-64/e_lgamma_r.c ../glibc-2.3/sysdeps/ieee754/dbl-64/e_lgamma_r.c
--- glibc-2.2.93/sysdeps/ieee754/dbl-64/e_lgamma_r.c	Mon Mar 12 13:36:17 2001
+++ ../glibc-2.3/sysdeps/ieee754/dbl-64/e_lgamma_r.c	Sat Sep 14 09:40:52 2002
@@ -175,7 +175,7 @@
 	GET_HIGH_WORD(ix,x);
 	ix &= 0x7fffffff;
 
-	if(ix<0x3fd00000) return sin(pi*x);
+	if(ix<0x3fd00000) return __sin(pi*x);
 	y = -x;		/* x is assume negative */
 
     /*
@@ -199,14 +199,14 @@
             }
         }
 	switch (n) {
-	    case 0:   y =  sin(pi*y); break;
+	    case 0:   y =  __sin(pi*y); break;
 	    case 1:
-	    case 2:   y =  cos(pi*(0.5-y)); break;
+	    case 2:   y =  __cos(pi*(0.5-y)); break;
 	    case 3:
-	    case 4:   y =  sin(pi*(one-y)); break;
+	    case 4:   y =  __sin(pi*(one-y)); break;
 	    case 5:
-	    case 6:   y = -cos(pi*(y-1.5)); break;
-	    default:  y =  sin(pi*(y-2.0)); break;
+	    case 6:   y = -__cos(pi*(y-1.5)); break;
+	    default:  y =  __sin(pi*(y-2.0)); break;
 	    }
 	return -y;
 }
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/dbl-64/s_finite.c ../glibc-2.3/sysdeps/ieee754/dbl-64/s_finite.c
--- glibc-2.2.93/sysdeps/ieee754/dbl-64/s_finite.c	Tue Apr  9 04:13:37 2002
+++ ../glibc-2.3/sysdeps/ieee754/dbl-64/s_finite.c	Sat Sep 14 09:40:52 2002
@@ -22,8 +22,6 @@
 #include "math.h"
 #include "math_private.h"
 
-#undef __finite
-
 #ifdef __STDC__
 	int __finite(double x)
 #else
@@ -35,7 +33,7 @@
 	GET_HIGH_WORD(hx,x);
 	return (int)((u_int32_t)((hx&0x7fffffff)-0x7ff00000)>>31);
 }
-INTDEF(__finite)
+hidden_def (__finite)
 weak_alias (__finite, finite)
 #ifdef NO_LONG_DOUBLE
 strong_alias (__finite, __finitel)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/dbl-64/s_fpclassify.c ../glibc-2.3/sysdeps/ieee754/dbl-64/s_fpclassify.c
--- glibc-2.2.93/sysdeps/ieee754/dbl-64/s_fpclassify.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/ieee754/dbl-64/s_fpclassify.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Return classification value corresponding to argument.
-   Copyright (C) 1997 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -41,3 +41,4 @@
 
   return retval;
 }
+libm_hidden_def (__fpclassify)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/dbl-64/s_isinf.c ../glibc-2.3/sysdeps/ieee754/dbl-64/s_isinf.c
--- glibc-2.2.93/sysdeps/ieee754/dbl-64/s_isinf.c	Sun Apr 14 05:29:57 2002
+++ ../glibc-2.3/sysdeps/ieee754/dbl-64/s_isinf.c	Sat Sep 14 09:40:52 2002
@@ -25,10 +25,9 @@
 	lx |= -lx;
 	return ~(lx >> 31) & (hx >> 30);
 }
-INTDEF(__isinf)
+hidden_def (__isinf)
 weak_alias (__isinf, isinf)
 #ifdef NO_LONG_DOUBLE
 strong_alias (__isinf, __isinfl)
-INTDEF(__isinfl)
 weak_alias (__isinf, isinfl)
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/dbl-64/s_isnan.c ../glibc-2.3/sysdeps/ieee754/dbl-64/s_isnan.c
--- glibc-2.2.93/sysdeps/ieee754/dbl-64/s_isnan.c	Sun Apr 14 05:36:05 2002
+++ ../glibc-2.3/sysdeps/ieee754/dbl-64/s_isnan.c	Sat Sep 14 09:40:52 2002
@@ -36,10 +36,9 @@
 	hx = 0x7ff00000 - hx;
 	return (int)(((u_int32_t)hx)>>31);
 }
-INTDEF(__isnan)
+hidden_def (__isnan)
 weak_alias (__isnan, isnan)
 #ifdef NO_LONG_DOUBLE
 strong_alias (__isnan, __isnanl)
-INTDEF(__isnanl)
 weak_alias (__isnan, isnanl)
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/flt-32/s_finitef.c ../glibc-2.3/sysdeps/ieee754/flt-32/s_finitef.c
--- glibc-2.2.93/sysdeps/ieee754/flt-32/s_finitef.c	Tue Apr  9 04:13:39 2002
+++ ../glibc-2.3/sysdeps/ieee754/flt-32/s_finitef.c	Sat Sep 14 09:40:52 2002
@@ -25,8 +25,6 @@
 #include "math.h"
 #include "math_private.h"
 
-#undef __finitef
-
 #ifdef __STDC__
 	int __finitef(float x)
 #else
@@ -38,5 +36,5 @@
 	GET_FLOAT_WORD(ix,x);
 	return (int)((u_int32_t)((ix&0x7fffffff)-0x7f800000)>>31);
 }
-INTDEF(__finitef)
+hidden_def (__finitef)
 weak_alias (__finitef, finitef)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/flt-32/s_fpclassifyf.c ../glibc-2.3/sysdeps/ieee754/flt-32/s_fpclassifyf.c
--- glibc-2.2.93/sysdeps/ieee754/flt-32/s_fpclassifyf.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/ieee754/flt-32/s_fpclassifyf.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Return classification value corresponding to argument.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -40,3 +40,4 @@
 
   return retval;
 }
+libm_hidden_def (__fpclassifyf)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/flt-32/s_isinff.c ../glibc-2.3/sysdeps/ieee754/flt-32/s_isinff.c
--- glibc-2.2.93/sysdeps/ieee754/flt-32/s_isinff.c	Sun Apr 14 05:29:31 2002
+++ ../glibc-2.3/sysdeps/ieee754/flt-32/s_isinff.c	Sat Sep 14 09:40:52 2002
@@ -25,5 +25,5 @@
 	t |= -t;
 	return ~(t >> 31) & (ix >> 30);
 }
-INTDEF(__isinff)
+hidden_def (__isinff)
 weak_alias (__isinff, isinff)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/flt-32/s_isnanf.c ../glibc-2.3/sysdeps/ieee754/flt-32/s_isnanf.c
--- glibc-2.2.93/sysdeps/ieee754/flt-32/s_isnanf.c	Sun Apr 14 05:35:47 2002
+++ ../glibc-2.3/sysdeps/ieee754/flt-32/s_isnanf.c	Sat Sep 14 09:40:52 2002
@@ -38,5 +38,5 @@
 	ix = 0x7f800000 - ix;
 	return (int)(((u_int32_t)(ix))>>31);
 }
-INTDEF(__isnanf)
+hidden_def (__isnanf)
 weak_alias (__isnanf, isnanf)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_expm1l.c ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_expm1l.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_expm1l.c	Tue Aug 27 00:52:38 2002
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_expm1l.c	Sat Sep 14 09:40:52 2002
@@ -157,5 +157,5 @@
   x = px * qx + (px - 1.0);
   return x;
 }
-
+libm_hidden_def (__expm1l)
 weak_alias (__expm1l, expm1l)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_finitel.c ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_finitel.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_finitel.c	Tue Apr  9 04:14:02 2002
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_finitel.c	Sat Sep 14 09:40:52 2002
@@ -25,8 +25,6 @@
 #include "math.h"
 #include "math_private.h"
 
-#undef __finitel
-
 #ifdef __STDC__
 	int __finitel(long double x)
 #else
@@ -39,5 +37,5 @@
 	return (int)((u_int64_t)((hx&0x7fffffffffffffffLL)
 				 -0x7fff000000000000LL)>>63);
 }
-INTDEF(__finitel)
+hidden_def (__finitel)
 weak_alias (__finitel, finitel)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_fpclassifyl.c ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_fpclassifyl.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_fpclassifyl.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_fpclassifyl.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Return classification value corresponding to argument.
-   Copyright (C) 1997, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997 and
    		  Jakub Jelinek <jj@ultra.linux.cz>, 1999.
@@ -42,3 +42,4 @@
 
   return retval;
 }
+libm_hidden_def (__fpclassifyl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_isinfl.c ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_isinfl.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_isinfl.c	Sun Apr 14 05:30:26 2002
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_isinfl.c	Sat Sep 14 09:40:52 2002
@@ -25,5 +25,5 @@
 	lx |= -lx;
 	return ~(lx >> 63) & (hx >> 62);
 }
-INTDEF(__isinfl)
+hidden_def (__isinfl)
 weak_alias (__isinfl, isinfl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_isnanl.c ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_isnanl.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-128/s_isnanl.c	Sun Apr 14 05:36:27 2002
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-128/s_isnanl.c	Sat Sep 14 09:40:52 2002
@@ -39,5 +39,5 @@
 	hx = 0x7fff000000000000LL - hx;
 	return (int)((u_int64_t)hx>>63);
 }
-INTDEF(__isnanl)
+hidden_def (__isnanl)
 weak_alias (__isnanl, isnanl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_finitel.c ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_finitel.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_finitel.c	Tue Apr  9 04:13:50 2002
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_finitel.c	Sat Sep 14 09:40:52 2002
@@ -26,8 +26,6 @@
 #include "math.h"
 #include "math_private.h"
 
-#undef __finitel
-
 #ifdef __STDC__
 	int __finitel(long double x)
 #else
@@ -39,5 +37,5 @@
 	GET_LDOUBLE_EXP(exp,x);
 	return (int)((u_int32_t)((exp&0x7fff)-0x7fff)>>31);
 }
-INTDEF(__finitel)
+hidden_def (__finitel)
 weak_alias (__finitel, finitel)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_fpclassifyl.c ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_fpclassifyl.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_fpclassifyl.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_fpclassifyl.c	Sat Sep 14 09:40:52 2002
@@ -1,5 +1,5 @@
 /* Return classification value corresponding to argument.
-   Copyright (C) 1997 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
    Fixed by Andreas Schwab <schwab@issan.informatik.uni-dortmund.de>.
@@ -42,3 +42,4 @@
 
   return retval;
 }
+libm_hidden_def (__fpclassifyl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_isinfl.c ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_isinfl.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_isinfl.c	Sun Apr 14 05:30:16 2002
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_isinfl.c	Sat Sep 14 09:40:52 2002
@@ -26,5 +26,5 @@
 	se &= 0x8000;
 	return ~(lx >> 31) & (1 - (se >> 14));
 }
-INTDEF(__isinfl)
+hidden_def (__isinfl)
 weak_alias (__isinfl, isinfl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_isnanl.c ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_isnanl.c
--- glibc-2.2.93/sysdeps/ieee754/ldbl-96/s_isnanl.c	Tue Jul 13 23:43:53 1999
+++ ../glibc-2.3/sysdeps/ieee754/ldbl-96/s_isnanl.c	Sat Sep 14 09:40:52 2002
@@ -41,4 +41,5 @@
 	se = 0xfffe - se;
 	return (int)(((u_int32_t)(se))>>31);
 }
+hidden_def (__isnanl)
 weak_alias (__isnanl, isnanl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/m68k/fpu/fesetenv.c ../glibc-2.3/sysdeps/m68k/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/m68k/fpu/fesetenv.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/m68k/fpu/fesetenv.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Schwab <schwab@issan.informatik.uni-dortmund.de>
 
@@ -56,4 +56,5 @@
 compat_symbol (libm, __old_fesetenv, fesetenv, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__fesetenv, fesetenv)
 versioned_symbol (libm, __fesetenv, fesetenv, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/m68k/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/m68k/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/m68k/fpu/fraiseexcpt.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/m68k/fpu/fraiseexcpt.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Schwab <schwab@issan.informatik.uni-dortmund.de>
 
@@ -79,4 +79,5 @@
 compat_symbol (libm, __old_feraiseexcept, feraiseexcept, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__feraiseexcept, feraiseexcept)
 versioned_symbol (libm, __feraiseexcept, feraiseexcept, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/m68k/fpu/s_expm1l.c ../glibc-2.3/sysdeps/m68k/fpu/s_expm1l.c
--- glibc-2.2.93/sysdeps/m68k/fpu/s_expm1l.c	Thu Jun  6 01:22:24 1996
+++ ../glibc-2.3/sysdeps/m68k/fpu/s_expm1l.c	Sat Sep 14 09:40:53 2002
@@ -1,2 +1,3 @@
 #define FUNC expm1l
 #include <s_atanl.c>
+libm_hidden_def (__expm1l)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/m68k/fpu/s_fpclassifyl.c ../glibc-2.3/sysdeps/m68k/fpu/s_fpclassifyl.c
--- glibc-2.2.93/sysdeps/m68k/fpu/s_fpclassifyl.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/m68k/fpu/s_fpclassifyl.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Return classification value corresponding to argument.  m68k version.
-   Copyright (C) 1997,2001 Free Software Foundation, Inc.
+   Copyright (C) 1997, 2001, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
    Fixed for m68k by Andreas Schwab <schwab@suse.de>.
@@ -41,3 +41,4 @@
 
   return retval;
 }
+libm_hidden_def (__fpclassifyl)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/m68k/fpu/s_isinf.c ../glibc-2.3/sysdeps/m68k/fpu/s_isinf.c
--- glibc-2.2.93/sysdeps/m68k/fpu/s_isinf.c	Tue Jun 18 17:14:00 2002
+++ ../glibc-2.3/sysdeps/m68k/fpu/s_isinf.c	Sat Sep 14 09:40:53 2002
@@ -34,7 +34,7 @@
   return __m81_u(__CONCATX(__,FUNC))(x);
 }
 
-#define INTDEFX(a) INTDEF(a)
-INTDEFX(__CONCATX(__,FUNC))
+#define hidden_defx(a) hidden_def(a)
+hidden_defx(__CONCATX(__,FUNC))
 #define weak_aliasx(a,b) weak_alias(a,b)
 weak_aliasx (__CONCATX(__,FUNC), FUNC)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/m68k/s_isinfl.c ../glibc-2.3/sysdeps/m68k/s_isinfl.c
--- glibc-2.2.93/sysdeps/m68k/s_isinfl.c	Sun Apr 14 05:33:07 2002
+++ ../glibc-2.3/sysdeps/m68k/s_isinfl.c	Sat Sep 14 09:40:53 2002
@@ -19,10 +19,6 @@
 #include <math.h>
 #include "ieee754.h"
 
-#undef __isinfl
-#undef isinfl
-
-
 /* Return 0 if VALUE is finite or NaN, +1 if it
    is +Infinity, -1 if it is -Infinity.  */
 int
@@ -42,5 +38,5 @@
   return 0;
 }
 
-INTDEF(__isinfl)
+hidden_def (__isinfl)
 weak_alias (__isinfl, isinfl);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/m68k/s_isnanl.c ../glibc-2.3/sysdeps/m68k/s_isnanl.c
--- glibc-2.2.93/sysdeps/m68k/s_isnanl.c	Sat Jul  7 15:21:24 2001
+++ ../glibc-2.3/sysdeps/m68k/s_isnanl.c	Sat Sep 14 09:40:53 2002
@@ -1,4 +1,4 @@
-/* Copyright (C) 1991, 1992, 1995, 1997 Free Software Foundation, Inc.
+/* Copyright (C) 1991, 1992, 1995, 1997, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -19,10 +19,6 @@
 #include <math.h>
 #include "ieee754.h"
 
-#undef __isnanl
-#undef isnanl
-
-
 /* Return nonzero if VALUE is not a number.  */
 int
 __isnanl (long double value)
@@ -38,4 +34,5 @@
 	  ((u.ieee.mantissa0 & 0x7fffffff) != 0 || u.ieee.mantissa1 != 0));
 }
 
+hidden_def (__isnanl)
 weak_alias (__isnanl, isnanl);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mach/hurd/.#dl-sysdep.c.1.72 ../glibc-2.3/sysdeps/mach/hurd/.#dl-sysdep.c.1.72
--- glibc-2.2.93/sysdeps/mach/hurd/.#dl-sysdep.c.1.72	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/mach/hurd/.#dl-sysdep.c.1.72	Mon Sep  2 16:19:20 2002
@@ -0,0 +1,628 @@
+/* Operating system support for run-time dynamic linker.  Hurd version.
+   Copyright (C) 1995,96,97,98,99,2000,01,02 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <hurd.h>
+#include <link.h>
+#include <unistd.h>
+#include <fcntl.h>
+#include <stdlib.h>
+#include <sys/mman.h>
+#include <ldsodefs.h>
+#include <sys/wait.h>
+#include <assert.h>
+#include <sysdep.h>
+#include <mach/mig_support.h>
+#include "hurdstartup.h"
+#include <hurd/lookup.h>
+#include <hurd/auth.h>
+#include <hurd/term.h>
+#include <stdarg.h>
+#include <ctype.h>
+#include <sys/stat.h>
+#include <sys/uio.h>
+
+#include <entry.h>
+#include <dl-machine.h>
+#include <dl-procinfo.h>
+
+extern void __mach_init (void);
+
+extern int _dl_argc;
+extern char **_dl_argv;
+extern char **_environ;
+
+int __libc_enable_secure = 0;
+INTVARDEF(__libc_enable_secure)
+int __libc_multiple_libcs = 0;	/* Defining this here avoids the inclusion
+				   of init-first.  */
+/* This variable containts the lowest stack address ever used.  */
+void *__libc_stack_end;
+
+#if HP_TIMING_AVAIL
+hp_timing_t _dl_cpuclock_offset;
+#endif
+
+
+struct hurd_startup_data *_dl_hurd_data;
+
+/* This is used only within ld.so, via dl-minimal.c's __errno_location.  */
+#undef errno
+int errno attribute_hidden;
+
+/* Defining these variables here avoids the inclusion of hurdsig.c.  */
+unsigned long int __hurd_sigthread_stack_base;
+unsigned long int __hurd_sigthread_stack_end;
+unsigned long int *__hurd_sigthread_variables;
+
+/* Defining these variables here avoids the inclusion of init-first.c.
+   We need to provide temporary storage for the per-thread variables
+   of the main user thread here, since it is used for storing the
+   `errno' variable.  Note that this information is lost once we
+   relocate the dynamic linker.  */
+static unsigned long int threadvars[_HURD_THREADVAR_MAX];
+unsigned long int __hurd_threadvar_stack_offset
+  = (unsigned long int) &threadvars;
+unsigned long int __hurd_threadvar_stack_mask;
+
+#define FMH defined(__i386__)
+#if ! FMH
+# define fmh()		((void)0)
+# define unfmh()	((void)0)
+#else
+/* XXX loser kludge for vm_map kernel bug */
+#undef	ELF_MACHINE_USER_ADDRESS_MASK
+#define ELF_MACHINE_USER_ADDRESS_MASK	0
+static vm_address_t fmha;
+static vm_size_t fmhs;
+static void unfmh(void){
+__vm_deallocate(__mach_task_self(),fmha,fmhs);}
+static void fmh(void) {
+    error_t err;int x;mach_port_t p;
+    vm_address_t a=0x08000000U,max=VM_MAX_ADDRESS;
+    while (!(err=__vm_region(__mach_task_self(),&a,&fmhs,&x,&x,&x,&x,&p,&x))){
+      __mach_port_deallocate(__mach_task_self(),p);
+      if (a+fmhs>=0x80000000U){
+	max=a; break;}
+      fmha=a+=fmhs;}
+    if (err) assert(err==KERN_NO_SPACE);
+    if (!fmha)fmhs=0;else{
+    fmhs=max-fmha;
+    err = __vm_map (__mach_task_self (),
+		    &fmha, fmhs, 0, 0, MACH_PORT_NULL, 0, 1,
+		    VM_PROT_NONE, VM_PROT_NONE, VM_INHERIT_COPY);
+    assert_perror(err);}
+  }
+/* XXX loser kludge for vm_map kernel bug */
+#endif
+
+
+ElfW(Addr)
+_dl_sysdep_start (void **start_argptr,
+		  void (*dl_main) (const ElfW(Phdr) *phdr, ElfW(Word) phent,
+				   ElfW(Addr) *user_entry))
+{
+  void go (intptr_t *argdata)
+    {
+      extern unsigned int _dl_skip_args; /* rtld.c */
+      char **p;
+
+      /* Cache the information in various global variables.  */
+      _dl_argc = *argdata;
+      _dl_argv = 1 + (char **) argdata;
+      _environ = &_dl_argv[_dl_argc + 1];
+      for (p = _environ; *p++;); /* Skip environ pointers and terminator.  */
+
+      if ((void *) p == _dl_argv[0])
+	{
+	  static struct hurd_startup_data nodata;
+	  _dl_hurd_data = &nodata;
+	  nodata.user_entry = (vm_address_t) ENTRY_POINT;
+	}
+      else
+	_dl_hurd_data = (void *) p;
+
+      INTUSE(__libc_enable_secure) = _dl_hurd_data->flags & EXEC_SECURE;
+
+      if (_dl_hurd_data->flags & EXEC_STACK_ARGS &&
+	  _dl_hurd_data->user_entry == 0)
+	_dl_hurd_data->user_entry = (vm_address_t) ENTRY_POINT;
+
+unfmh();			/* XXX */
+
+#if 0				/* XXX make this work for real someday... */
+      if (_dl_hurd_data->user_entry == (vm_address_t) ENTRY_POINT)
+	/* We were invoked as a command, not as the program interpreter.
+	   The generic ld.so code supports this: it will parse the args
+	   as "ld.so PROGRAM [ARGS...]".  For booting the Hurd, we
+	   support an additional special syntax:
+	     ld.so [-LIBS...] PROGRAM [ARGS...]
+	   Each LIBS word consists of "FILENAME=MEMOBJ";
+	   for example "-/lib/libc.so=123" says that the contents of
+	   /lib/libc.so are found in a memory object whose port name
+	   in our task is 123.  */
+	while (_dl_argc > 2 && _dl_argv[1][0] == '-' && _dl_argv[1][1] != '-')
+	  {
+	    char *lastslash, *memobjname, *p;
+	    struct link_map *l;
+	    mach_port_t memobj;
+	    error_t err;
+
+	    ++_dl_skip_args;
+	    --_dl_argc;
+	    p = _dl_argv++[1] + 1;
+
+	    memobjname = strchr (p, '=');
+	    if (! memobjname)
+	      _dl_sysdep_fatal ("Bogus library spec: ", p, "\n", NULL);
+	    *memobjname++ = '\0';
+	    memobj = 0;
+	    while (*memobjname != '\0')
+	      memobj = (memobj * 10) + (*memobjname++ - '0');
+
+	    /* Add a user reference on the memory object port, so we will
+	       still have one after _dl_map_object_from_fd calls our
+	       `close'.  */
+	    err = __mach_port_mod_refs (__mach_task_self (), memobj,
+					MACH_PORT_RIGHT_SEND, +1);
+	    assert_perror (err);
+
+	    lastslash = strrchr (p, '/');
+	    l = _dl_map_object_from_fd (lastslash ? lastslash + 1 : p,
+					memobj, strdup (p), 0);
+
+	    /* Squirrel away the memory object port where it
+	       can be retrieved by the program later.  */
+	    l->l_info[DT_NULL] = (void *) memobj;
+	  }
+#endif
+
+      /* Call elf/rtld.c's main program.  It will set everything
+	 up and leave us to transfer control to USER_ENTRY.  */
+      (*dl_main) ((const ElfW(Phdr) *) _dl_hurd_data->phdr,
+		  _dl_hurd_data->phdrsz / sizeof (ElfW(Phdr)),
+		  &_dl_hurd_data->user_entry);
+
+      /* The call above might screw a few things up.
+
+	 First of all, if _dl_skip_args is nonzero, we are ignoring
+	 the first few arguments.  However, if we have no Hurd startup
+	 data, it is the magical convention that ARGV[0] == P.  The
+	 startup code in init-first.c will get confused if this is not
+	 the case, so we must rearrange things to make it so.  We'll
+	 overwrite the origional ARGV[0] at P with ARGV[_dl_skip_args].
+
+	 Secondly, if we need to be secure, it removes some dangerous
+	 environment variables.  If we have no Hurd startup date this
+	 changes P (since that's the location after the terminating
+	 NULL in the list of environment variables).  We do the same
+	 thing as in the first case but make sure we recalculate P.
+	 If we do have Hurd startup data, we have to move the data
+	 such that it starts just after the terminating NULL in the
+	 environment list.
+
+	 We use memmove, since the locations might overlap.  */
+      if (INTUSE(__libc_enable_secure) || _dl_skip_args)
+	{
+	  char **newp;
+
+	  for (newp = _environ; *newp++;);
+
+	  if (_dl_argv[-_dl_skip_args] == (char *) p)
+	    {
+	      if ((char *) newp != _dl_argv[0])
+		{
+		  assert ((char *) newp < _dl_argv[0]);
+		  _dl_argv[0] = memmove ((char *) newp, _dl_argv[0],
+					 strlen (_dl_argv[0]) + 1);
+		}
+	    }
+	  else
+	    {
+	      if ((void *) newp != _dl_hurd_data)
+		memmove (newp, _dl_hurd_data, sizeof (*_dl_hurd_data));
+	    }
+	}
+
+      {
+	extern void _dl_start_user (void);
+	/* Unwind the stack to ARGDATA and simulate a return from _dl_start
+	   to the RTLD_START code which will run the user's entry point.  */
+	RETURN_TO (argdata, &_dl_start_user, _dl_hurd_data->user_entry);
+      }
+    }
+
+  /* Set up so we can do RPCs.  */
+  __mach_init ();
+
+  /* Initialize frequently used global variable.  */
+  GL(dl_pagesize) = __getpagesize ();
+
+#if HP_TIMING_AVAIL
+  HP_TIMING_NOW (_dl_cpuclock_offset);
+#endif
+
+fmh();				/* XXX */
+
+  /* See hurd/hurdstartup.c; this deals with getting information
+     from the exec server and slicing up the arguments.
+     Then it will call `go', above.  */
+  _hurd_startup (start_argptr, &go);
+
+  LOSE;
+  abort ();
+}
+
+void
+internal_function
+_dl_sysdep_start_cleanup (void)
+{
+  /* Deallocate the reply port and task port rights acquired by
+     __mach_init.  We are done with them now, and the user will
+     reacquire them for himself when he wants them.  */
+  __mig_dealloc_reply_port (MACH_PORT_NULL);
+  __mach_port_deallocate (__mach_task_self (), __mach_task_self_);
+}
+
+/* Minimal open/close/mmap implementation sufficient for initial loading of
+   shared libraries.  These are weak definitions so that when the
+   dynamic linker re-relocates itself to be user-visible (for -ldl),
+   it will get the user's definition (i.e. usually libc's).  */
+
+/* Open FILE_NAME and return a Hurd I/O for it in *PORT, or return an
+   error.  If STAT is non-zero, stat the file into that stat buffer.  */
+static error_t
+open_file (const char *file_name, int flags,
+	   mach_port_t *port, struct stat64 *stat)
+{
+  enum retry_type doretry;
+  char retryname[1024];		/* XXX string_t LOSES! */
+  file_t startdir;
+  error_t err;
+
+  error_t use_init_port (int which, error_t (*operate) (file_t))
+    {
+      return (which < _dl_hurd_data->portarraysize
+	      ? ((*operate) (_dl_hurd_data->portarray[which]))
+	      : EGRATUITOUS);
+    }
+  file_t get_dtable_port (int fd)
+    {
+      if ((unsigned int) fd < _dl_hurd_data->dtablesize
+	  && _dl_hurd_data->dtable[fd] != MACH_PORT_NULL)
+	{
+	  __mach_port_mod_refs (__mach_task_self (), _dl_hurd_data->dtable[fd],
+				MACH_PORT_RIGHT_SEND, +1);
+	  return _dl_hurd_data->dtable[fd];
+	}
+      errno = EBADF;
+      return MACH_PORT_NULL;
+    }
+
+  assert (!(flags & ~O_READ));
+
+  startdir = _dl_hurd_data->portarray[file_name[0] == '/' ?
+				      INIT_PORT_CRDIR : INIT_PORT_CWDIR];
+
+  while (file_name[0] == '/')
+    file_name++;
+
+  err = __dir_lookup (startdir, (char *)file_name, O_RDONLY, 0,
+		      &doretry, retryname, port);
+
+  if (!err)
+    err = __hurd_file_name_lookup_retry (use_init_port, get_dtable_port,
+					 __dir_lookup, doretry, retryname,
+					 O_RDONLY, 0, port);
+  if (!err && stat)
+    {
+      err = __io_stat (*port, stat);
+      if (err)
+	__mach_port_deallocate (__mach_task_self (), *port);
+    }
+
+  return err;
+}
+
+int weak_function
+__open (const char *file_name, int mode, ...)
+{
+  mach_port_t port;
+  error_t err = open_file (file_name, mode, &port, 0);
+  if (err)
+    return __hurd_fail (err);
+  else
+    return (int)port;
+}
+
+int weak_function
+__close (int fd)
+{
+  if (fd != (int) MACH_PORT_NULL)
+    __mach_port_deallocate (__mach_task_self (), (mach_port_t) fd);
+  return 0;
+}
+
+__ssize_t weak_function
+__libc_read (int fd, void *buf, size_t nbytes)
+{
+  error_t err;
+  char *data;
+  mach_msg_type_number_t nread;
+
+  data = buf;
+  err = __io_read ((mach_port_t) fd, &data, &nread, -1, nbytes);
+  if (err)
+    return __hurd_fail (err);
+
+  if (data != buf)
+    {
+      memcpy (buf, data, nread);
+      __vm_deallocate (__mach_task_self (), (vm_address_t) data, nread);
+    }
+
+  return nread;
+}
+libc_hidden_weak (__libc_read)
+
+__ssize_t weak_function
+__libc_write (int fd, const void *buf, size_t nbytes)
+{
+  error_t err;
+  mach_msg_type_number_t nwrote;
+
+  assert (fd < _hurd_init_dtablesize);
+
+  err = __io_write (_hurd_init_dtable[fd], buf, nbytes, -1, &nwrote);
+  if (err)
+    return __hurd_fail (err);
+
+  return nwrote;
+}
+libc_hidden_weak (__libc_write)
+
+/* This is only used for printing messages (see dl-misc.c).  */
+__ssize_t weak_function
+__writev (int fd, const struct iovec *iov, int niov)
+{
+  int i;
+  size_t total = 0;
+  for (i = 0; i < niov; ++i)
+    total += iov[i].iov_len;
+
+  assert (fd < _hurd_init_dtablesize);
+
+  if (total != 0)
+    {
+      char buf[total], *bufp = buf;
+      error_t err;
+      mach_msg_type_number_t nwrote;
+
+      for (i = 0; i < niov; ++i)
+	bufp = (memcpy (bufp, iov[i].iov_base, iov[i].iov_len)
+		+ iov[i].iov_len);
+
+      err = __io_write (_hurd_init_dtable[fd], buf, total, -1, &nwrote);
+      if (err)
+	return __hurd_fail (err);
+
+      return nwrote;
+    }
+  return 0;
+}
+
+
+off64_t weak_function
+__libc_lseek64 (int fd, off64_t offset, int whence)
+{
+  error_t err;
+
+  err = __io_seek ((mach_port_t) fd, offset, whence, &offset);
+  if (err)
+    return __hurd_fail (err);
+
+  return offset;
+}
+
+__ptr_t weak_function
+__mmap (__ptr_t addr, size_t len, int prot, int flags, int fd, off_t offset)
+{
+  error_t err;
+  vm_prot_t vmprot;
+  vm_address_t mapaddr;
+  mach_port_t memobj_rd, memobj_wr;
+
+  vmprot = VM_PROT_NONE;
+  if (prot & PROT_READ)
+    vmprot |= VM_PROT_READ;
+  if (prot & PROT_WRITE)
+    vmprot |= VM_PROT_WRITE;
+  if (prot & PROT_EXEC)
+    vmprot |= VM_PROT_EXECUTE;
+
+  if (flags & MAP_ANON)
+    memobj_rd = MACH_PORT_NULL;
+  else
+    {
+      assert (!(flags & MAP_SHARED));
+      err = __io_map ((mach_port_t) fd, &memobj_rd, &memobj_wr);
+      if (err)
+	return __hurd_fail (err), MAP_FAILED;
+      __mach_port_deallocate (__mach_task_self (), memobj_wr);
+    }
+
+  mapaddr = (vm_address_t) addr;
+  err = __vm_map (__mach_task_self (),
+		  &mapaddr, (vm_size_t) len, ELF_MACHINE_USER_ADDRESS_MASK,
+		  !(flags & MAP_FIXED),
+		  memobj_rd,
+		  (vm_offset_t) offset,
+		  flags & (MAP_COPY|MAP_PRIVATE),
+		  vmprot, VM_PROT_ALL,
+		  (flags & MAP_SHARED) ? VM_INHERIT_SHARE : VM_INHERIT_COPY);
+  if (err == KERN_NO_SPACE && (flags & MAP_FIXED))
+    {
+      /* XXX this is not atomic as it is in unix! */
+      /* The region is already allocated; deallocate it first.  */
+      err = __vm_deallocate (__mach_task_self (), mapaddr, len);
+      if (! err)
+	err = __vm_map (__mach_task_self (),
+			&mapaddr, (vm_size_t) len,
+			ELF_MACHINE_USER_ADDRESS_MASK,
+			!(flags & MAP_FIXED),
+			memobj_rd, (vm_offset_t) offset,
+			flags & (MAP_COPY|MAP_PRIVATE),
+			vmprot, VM_PROT_ALL,
+			(flags & MAP_SHARED)
+			? VM_INHERIT_SHARE : VM_INHERIT_COPY);
+    }
+
+  if ((flags & MAP_ANON) == 0)
+    __mach_port_deallocate (__mach_task_self (), memobj_rd);
+
+  if (err)
+    return __hurd_fail (err), MAP_FAILED;
+  return (__ptr_t) mapaddr;
+}
+
+/* This function is called by the dynamic linker (rtld.c) to check
+   whether debugging malloc is allowed even for SUID binaries.  This
+   stub will always fail, which means that malloc-debugging is always
+   disabled for SUID binaries.  */
+int weak_function
+__access (const char *file, int type)
+{
+  errno = ENOSYS;
+  return -1;
+}
+
+pid_t weak_function
+__getpid ()
+{
+  pid_t pid, ppid;
+  int orphaned;
+
+  if (__proc_getpids (_dl_hurd_data->portarray[INIT_PORT_PROC],
+		      &pid, &ppid, &orphaned))
+    return -1;
+
+  return pid;
+}
+
+/* This is called only in some strange cases trying to guess a value
+   for $ORIGIN for the executable.  The dynamic linker copes with
+   getcwd failing (dl-object.c), and it's too much hassle to include
+   the functionality here.  (We could, it just requires duplicating or
+   reusing getcwd.c's code but using our special lookup function as in
+   `open', above.)  */
+char *
+weak_function
+__getcwd (char *buf, size_t size)
+{
+  errno = ENOSYS;
+  return NULL;
+}
+
+void weak_function
+_exit (int status)
+{
+  __proc_mark_exit (_dl_hurd_data->portarray[INIT_PORT_PROC],
+		    W_EXITCODE (status, 0), 0);
+  while (__task_terminate (__mach_task_self ()))
+    __mach_task_self_ = (__mach_task_self) ();
+}
+
+/* Try to get a machine dependent instruction which will make the
+   program crash.  This is used in case everything else fails.  */
+#include <abort-instr.h>
+#ifndef ABORT_INSTRUCTION
+/* No such instruction is available.  */
+# define ABORT_INSTRUCTION
+#endif
+
+void weak_function
+abort (void)
+{
+  /* Try to abort using the system specific command.  */
+  ABORT_INSTRUCTION;
+
+  /* If the abort instruction failed, exit.  */
+  _exit (127);
+
+  /* If even this fails, make sure we never return.  */
+  while (1)
+    /* Try for ever and ever.  */
+    ABORT_INSTRUCTION;
+}
+
+/* We need this alias to satisfy references from libc_pic.a objects
+   that were affected by the libc_hidden_proto declaration for abort.  */
+strong_alias (abort, __GI_abort)
+
+/* This function is called by interruptible RPC stubs.  For initial
+   dynamic linking, just use the normal mach_msg.  Since this defn is
+   weak, the real defn in libc.so will override it if we are linked into
+   the user program (-ldl).  */
+
+error_t weak_function
+_hurd_intr_rpc_mach_msg (mach_msg_header_t *msg,
+			 mach_msg_option_t option,
+			 mach_msg_size_t send_size,
+			 mach_msg_size_t rcv_size,
+			 mach_port_t rcv_name,
+			 mach_msg_timeout_t timeout,
+			 mach_port_t notify)
+{
+  return __mach_msg (msg, option, send_size, rcv_size, rcv_name,
+		     timeout, notify);
+}
+
+
+void
+internal_function
+_dl_show_auxv (void)
+{
+  /* There is nothing to print.  Hurd has no auxiliary vector.  */
+}
+
+
+/* Return an array of useful/necessary hardware capability names.  */
+const struct r_strlenpair *
+internal_function
+_dl_important_hwcaps (const char *platform, size_t platform_len, size_t *sz,
+		      size_t *max_capstrlen)
+{
+  struct r_strlenpair *result;
+
+  /* Return an empty array.  Hurd has no hardware capabilities.  */
+  result = (struct r_strlenpair *) malloc (sizeof (*result));
+  if (result == NULL)
+    _dl_signal_error (ENOMEM, NULL, NULL, "cannot create capability list");
+
+  result[0].str = (char *) result;	/* Does not really matter.  */
+  result[0].len = 0;
+
+  *sz = 1;
+  return result;
+}
+
+void weak_function
+_dl_init_first (int argc, ...)
+{
+  /* This no-op definition only gets used if libc is not linked in.  */
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mach/hurd/dl-sysdep.c ../glibc-2.3/sysdeps/mach/hurd/dl-sysdep.c
--- glibc-2.2.93/sysdeps/mach/hurd/dl-sysdep.c	Fri Aug 30 01:20:42 2002
+++ ../glibc-2.3/sysdeps/mach/hurd/dl-sysdep.c	Mon Sep  2 16:48:38 2002
@@ -513,7 +513,6 @@
 
   return 0;
 }
-libc_hidden_def (__fxstat64)
 
 int weak_function
 __xstat64 (int vers, const char *file, struct stat64 *buf)
@@ -531,7 +530,6 @@
 
   return 0;
 }
-libc_hidden_def (__xstat64)
 
 /* This function is called by the dynamic linker (rtld.c) to check
    whether debugging malloc is allowed even for SUID binaries.  This
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mach/hurd/fxstat64.c ../glibc-2.3/sysdeps/mach/hurd/fxstat64.c
--- glibc-2.2.93/sysdeps/mach/hurd/fxstat64.c	Tue Aug 13 10:29:38 2002
+++ ../glibc-2.3/sysdeps/mach/hurd/fxstat64.c	Tue Sep  3 08:05:29 2002
@@ -38,6 +38,5 @@
 
   return 0;
 }
-hidden_def (__fxstat64)
 
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mach/hurd/xstat64.c ../glibc-2.3/sysdeps/mach/hurd/xstat64.c
--- glibc-2.2.93/sysdeps/mach/hurd/xstat64.c	Tue Aug 13 10:29:38 2002
+++ ../glibc-2.3/sysdeps/mach/hurd/xstat64.c	Tue Sep  3 08:05:14 2002
@@ -42,6 +42,5 @@
     return __hurd_fail (err);
   return 0;
 }
-hidden_def (__xstat64)
 
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/e_sqrt.c ../glibc-2.3/sysdeps/mips/fpu/e_sqrt.c
--- glibc-2.2.93/sysdeps/mips/fpu/e_sqrt.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/mips/fpu/e_sqrt.c	Tue Sep 10 07:23:00 2002
@@ -0,0 +1,38 @@
+/* Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+
+#include <sgidefs.h>
+
+
+#if (_MIPS_ISA >= _MIPS_ISA_MIPS2)
+
+double
+__ieee754_sqrt (double x)
+{
+  double z;
+  __asm__ ("sqrt.d %0,%1" : "=f" (z) : "f" (x));
+  return z;
+}
+
+#else
+
+#include <sysdeps/ieee754/dbl-64/e_sqrt.c>
+
+#endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/e_sqrtf.c ../glibc-2.3/sysdeps/mips/fpu/e_sqrtf.c
--- glibc-2.2.93/sysdeps/mips/fpu/e_sqrtf.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/mips/fpu/e_sqrtf.c	Tue Sep 10 07:23:00 2002
@@ -0,0 +1,39 @@
+/* Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+
+#include <sgidefs.h>
+
+
+#if (_MIPS_ISA >= _MIPS_ISA_MIPS2)
+
+float
+__ieee754_sqrtf (float x)
+{
+  float z;
+  __asm__ ("sqrt.s %0,%1" : "=f" (z) : "f" (x));
+  return z;
+}
+
+#else
+
+#include <sysdeps/ieee754/flt-32/e_sqrtf.c>
+
+#endif
+
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/fclrexcpt.c ../glibc-2.3/sysdeps/mips/fpu/fclrexcpt.c
--- glibc-2.2.93/sysdeps/mips/fpu/fclrexcpt.c	Mon Mar 18 17:19:35 2002
+++ ../glibc-2.3/sysdeps/mips/fpu/fclrexcpt.c	Sat Sep 14 09:40:53 2002
@@ -21,10 +21,9 @@
 #include <fenv.h>
 #include <fenv_libc.h>
 #include <fpu_control.h>
-#include <shlib-compat.h>
 
 int
-__feclearexcept (int excepts)
+feclearexcept (int excepts)
 {
   int cw;
 
@@ -35,8 +34,8 @@
   _FPU_GETCW (cw);
 
   /* Clear exception flag bits and cause bits. If the cause bit is not
-     cleared, the next CTC instruction (just below) will re-generate
-     the exception.  */
+     cleared, the next CTC instruction (just below) will re-generate the
+     exception.  */
 
   cw &= ~(excepts | (excepts << CAUSE_SHIFT));
 
@@ -46,9 +45,3 @@
   /* Success.  */
   return 0;
 }
-
-#if SHLIB_COMPAT (libm, GLIBC_2_1, GLIBC_2_2)
-strong_alias (__feclearexcept, __old_feclearexcept)
-compat_symbol (libm, __old_feclearexcept, feclearexcept, GLIBC_2_1);
-#endif
-versioned_symbol (libm, __feclearexcept, feclearexcept, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/fegetenv.c ../glibc-2.3/sysdeps/mips/fpu/fegetenv.c
--- glibc-2.2.93/sysdeps/mips/fpu/fegetenv.c	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/mips/fpu/fegetenv.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Store current floating-point environment.
-   Copyright (C) 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 1998.
 
@@ -20,18 +20,12 @@
 
 #include <fenv.h>
 #include <fpu_control.h>
-#include <shlib-compat.h>
 
 int
-__fegetenv (fenv_t *envp)
+fegetenv (fenv_t *envp)
 {
   _FPU_GETCW (*envp);
 
   /* Success.  */
   return 0;
 }
-#if SHLIB_COMPAT (libm, GLIBC_2_1, GLIBC_2_2)
-strong_alias (__fegetenv, __old_fegetenv)
-compat_symbol (libm, __old_fegetenv, fegetenv, GLIBC_2_1);
-#endif
-versioned_symbol (libm, __fegetenv, fegetenv, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/fesetenv.c ../glibc-2.3/sysdeps/mips/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/mips/fpu/fesetenv.c	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/mips/fpu/fesetenv.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 1998.
 
@@ -20,10 +20,9 @@
 
 #include <fenv.h>
 #include <fpu_control.h>
-#include <shlib-compat.h>
 
 int
-__fesetenv (const fenv_t *envp)
+fesetenv (const fenv_t *envp)
 {
   fpu_control_t cw;
 
@@ -40,9 +39,3 @@
   /* Success.  */
   return 0;
 }
-
-#if SHLIB_COMPAT (libm, GLIBC_2_1, GLIBC_2_2)
-strong_alias (__fesetenv, __old_fesetenv)
-compat_symbol (libm, __old_fesetenv, fesetenv, GLIBC_2_1);
-#endif
-versioned_symbol (libm, __fesetenv, fesetenv, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/feupdateenv.c ../glibc-2.3/sysdeps/mips/fpu/feupdateenv.c
--- glibc-2.2.93/sysdeps/mips/fpu/feupdateenv.c	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/mips/fpu/feupdateenv.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment and raise exceptions.
-   Copyright (C) 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Andreas Jaeger <aj@suse.de>, 1998.
 
@@ -20,10 +20,9 @@
 
 #include <fenv.h>
 #include <fpu_control.h>
-#include <shlib-compat.h>
 
 int
-__feupdateenv (const fenv_t *envp)
+feupdateenv (const fenv_t *envp)
 {
   int temp;
 
@@ -42,8 +41,3 @@
   /* Success.  */
   return 0;
 }
-#if SHLIB_COMPAT (libm, GLIBC_2_1, GLIBC_2_2)
-strong_alias (__feupdateenv, __old_feupdateenv)
-compat_symbol (libm, __old_feupdateenv, feupdateenv, GLIBC_2_1);
-#endif
-versioned_symbol (libm, __feupdateenv, feupdateenv, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/fgetexcptflg.c ../glibc-2.3/sysdeps/mips/fpu/fgetexcptflg.c
--- glibc-2.2.93/sysdeps/mips/fpu/fgetexcptflg.c	Mon Mar 18 17:19:35 2002
+++ ../glibc-2.3/sysdeps/mips/fpu/fgetexcptflg.c	Sat Sep 14 09:40:53 2002
@@ -20,27 +20,21 @@
 
 #include <fenv.h>
 #include <fpu_control.h>
-#include <shlib-compat.h>
 
 int
-__fegetexceptflag (fexcept_t *flagp, int excepts)
+fegetexceptflag (fexcept_t *flagp, int excepts)
 {
   fexcept_t temp;
 
   /* Get the current exceptions.  */
   _FPU_GETCW (temp);
 
-  /* It is important that the CAUSE bits are not saved here.  If they
-     were, a call to fesetexceptflag() would generate an
-     exception.  */
+  /* We only save the relevant bits here. In particular, care has to be 
+     taken with the CAUSE bits, as an inadvertent restore later on could
+     generate unexpected exceptions.  */
 
   *flagp = temp & excepts & FE_ALL_EXCEPT;
 
   /* Success.  */
   return 0;
 }
-#if SHLIB_COMPAT (libm, GLIBC_2_1, GLIBC_2_2)
-strong_alias (__fegetexceptflag, __old_fegetexceptflag)
-compat_symbol (libm, __old_fegetexceptflag, fegetexceptflag, GLIBC_2_1);
-#endif
-versioned_symbol (libm, __fegetexceptflag, fegetexceptflag, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/mips/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/mips/fpu/fraiseexcpt.c	Mon Mar 18 17:19:35 2002
+++ ../glibc-2.3/sysdeps/mips/fpu/fraiseexcpt.c	Sat Sep 14 09:40:53 2002
@@ -21,19 +21,18 @@
 #include <fenv.h>
 #include <fenv_libc.h>
 #include <fpu_control.h>
-#include <shlib-compat.h>
 
 int
-__feraiseexcept (int excepts)
+feraiseexcept (int excepts)
 {
   fpu_control_t cw;
 
   /* Get current state.  */
   _FPU_GETCW (cw);
 
-  /* Set flag bits (which are accumulative), and *also* set the cause
-     bits.  The setting of the cause bits is what actually causes the
-     hardware to generate the exception, if the corresponding enable
+  /* Set flag bits (which are accumulative), and *also* set the 
+     cause bits. The setting of the cause bits is what actually causes
+     the hardware to generate the exception, if the corresponding enable
      bit is set as well.  */
 
   excepts &= FE_ALL_EXCEPT;
@@ -44,9 +43,3 @@
 
   return 0;
 }
-
-#if SHLIB_COMPAT (libm, GLIBC_2_1, GLIBC_2_2)
-strong_alias (__feraiseexcept, __old_feraiseexcept)
-compat_symbol (libm, __old_feraiseexcept, feraiseexcept, GLIBC_2_1);
-#endif
-versioned_symbol (libm, __feraiseexcept, feraiseexcept, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/fpu/fsetexcptflg.c ../glibc-2.3/sysdeps/mips/fpu/fsetexcptflg.c
--- glibc-2.2.93/sysdeps/mips/fpu/fsetexcptflg.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/mips/fpu/fsetexcptflg.c	Tue Sep 10 07:23:00 2002
@@ -0,0 +1,43 @@
+/* Set floating-point environment exception handling.
+   Copyright (C) 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <fenv.h>
+#include <fpu_control.h>
+
+int
+fesetexceptflag (const fexcept_t *flagp, int excepts)
+{
+  fexcept_t temp;
+
+  /* Get the current exceptions.  */
+  _FPU_GETCW (temp);
+
+  /* Make sure the flags we want restored are legal.  */
+  excepts &= FE_ALL_EXCEPT;
+
+  /* Now clear the bits called for, and copy them in from flagp. Note that
+     we ignore all non-flag bits from *flagp, so they don't matter.  */
+  temp = (temp & ~excepts) | (*flagp & excepts);
+
+  _FPU_SETCW (temp);
+
+  /* Success.  */
+  return 0;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/memcpy.S ../glibc-2.3/sysdeps/mips/memcpy.S
--- glibc-2.2.93/sysdeps/mips/memcpy.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/mips/memcpy.S	Tue Sep 10 07:22:59 2002
@@ -0,0 +1,130 @@
+/* Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <endian.h>
+
+
+/* void *memcpy(void *s1, const void *s2, size_t n);
+
+   This routine could be optimized further for MIPS64, but this is left
+   as an exercise for the future. When it is done, the file should be kept
+   as a sisterfile to this one, and placed in the sysdeps/mips/mips64 
+   directory.  */
+
+#if __BYTE_ORDER == __BIG_ENDIAN
+#  define LWHI	lwl		/* high part is left in big-endian	*/
+#  define SWHI	swl		/* high part is left in big-endian	*/
+#  define LWLO	lwr		/* low part is right in big-endian	*/
+#  define SWLO	swr		/* low part is right in big-endian	*/
+#else
+#  define LWHI	lwr		/* high part is right in little-endian	*/
+#  define SWHI	swr		/* high part is right in little-endian	*/
+#  define LWLO	lwl		/* low part is left in little-endian	*/
+#  define SWLO	swl		/* low part is left in little-endian	*/
+#endif
+
+ENTRY (memcpy)
+	.set	noreorder
+
+	slti	t0, a2, 8		# Less than 8?
+	bne	t0, zero, $last8
+	move	v0, a0			# Setup exit value before too late
+
+	xor	t0, a1, a0		# Find a0/a1 displacement
+	andi	t0, 0x3
+	bne	t0, zero, $shift	# Go handle the unaligned case
+	subu	t1, zero, a1
+	andi	t1, 0x3			# a0/a1 are aligned, but are we
+	beq	t1, zero, $chk8w	#  starting in the middle of a word?
+	subu	a2, t1
+	LWHI	t0, 0(a1)		# Yes we are... take care of that
+	addu	a1, t1
+	SWHI	t0, 0(a0)
+	addu	a0, t1
+
+$chk8w:	andi	t0, a2, 0x1f		# 32 or more bytes left?
+	beq	t0, a2, $chk1w
+	subu	a3, a2, t0		# Yes
+	addu	a3, a1			# a3 = end address of loop
+	move	a2, t0			# a2 = what will be left after loop
+$lop8w:	lw	t0,  0(a1)		# Loop taking 8 words at a time
+	lw	t1,  4(a1)
+	lw	t2,  8(a1)
+	lw	t3, 12(a1)
+	lw	t4, 16(a1)
+	lw	t5, 20(a1)
+	lw	t6, 24(a1)
+	lw	t7, 28(a1)
+	addiu	a0, 32
+	addiu	a1, 32
+	sw	t0, -32(a0)
+	sw	t1, -28(a0)
+	sw	t2, -24(a0)
+	sw	t3, -20(a0)
+	sw	t4, -16(a0)
+	sw	t5, -12(a0)
+	sw	t6,  -8(a0)
+	bne	a1, a3, $lop8w
+	sw	t7,  -4(a0)
+
+$chk1w:	andi	t0, a2, 0x3		# 4 or more bytes left?
+	beq	t0, a2, $last8
+	subu	a3, a2, t0		# Yes, handle them one word at a time
+	addu	a3, a1			# a3 again end address
+	move	a2, t0
+$lop1w:	lw	t0, 0(a1)
+	addiu	a0, 4
+	addiu	a1, 4
+	bne	a1, a3, $lop1w
+	sw	t0, -4(a0)
+
+$last8:	blez	a2, $lst8e		# Handle last 8 bytes, one at a time
+	addu	a3, a2, a1
+$lst8l:	lb	t0, 0(a1)
+	addiu	a0, 1
+	addiu	a1, 1
+	bne	a1, a3, $lst8l
+	sb	t0, -1(a0)
+$lst8e:	jr	ra			# Bye, bye
+	nop
+
+$shift:	subu	a3, zero, a0		# Src and Dest unaligned 
+	andi	a3, 0x3			#  (unoptimized case...)
+	beq	a3, zero, $shft1
+	subu	a2, a3			# a2 = bytes left
+	LWHI	t0, 0(a1)		# Take care of first odd part
+	LWLO	t0, 3(a1)
+	addu	a1, a3
+	SWHI	t0, 0(a0)
+	addu	a0, a3
+$shft1:	andi	t0, a2, 0x3
+	subu	a3, a2, t0
+	addu	a3, a1
+$shfth:	LWHI	t1, 0(a1)		# Limp through, word by word
+	LWLO	t1, 3(a1)
+	addiu	a0, 4
+	addiu	a1, 4
+	bne	a1, a3, $shfth
+	sw	t1, -4(a0)
+	b	$last8			# Handle anything which may be left
+	move	a2, t0
+
+	.set	reorder
+END (memcpy)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/mips/memset.S ../glibc-2.3/sysdeps/mips/memset.S
--- glibc-2.2.93/sysdeps/mips/memset.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/mips/memset.S	Tue Sep 10 07:22:59 2002
@@ -0,0 +1,83 @@
+/* Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+   Contributed by Hartvig Ekner <hartvige@mips.com>, 2002.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <endian.h>
+
+
+/* void *memset(void *s, int c, size_t n).
+
+   This routine could be optimized further for MIPS64, but this is left
+   as an exercise for the future. When it is done, the file should be kept
+   as a sisterfile to this one, and placed in the sysdeps/mips/mips64 
+   directory.  */
+
+#if __BYTE_ORDER == __BIG_ENDIAN
+# define SWHI	swl		/* high part is left in big-endian	*/
+#else
+# define SWHI	swr		/* high part is right in little-endian	*/
+#endif
+
+ENTRY (memset)
+	.set	noreorder
+
+	slti	t1, a2, 8		# Less than 8?
+	bne	t1, zero, $last8
+	move	v0, a0			# Setup exit value before too late
+
+	beq	a1, zero, $ueven	# If zero pattern, no need to extend
+	andi	a1, 0xff		# Avoid problems with bogus arguments
+	sll	t0, a1, 8
+	or	a1, t0
+	sll	t0, a1, 16
+	or	a1, t0			# a1 is now pattern in full word
+
+$ueven:	subu	t0, zero, a0		# Unaligned address?
+	andi	t0, 0x3
+	beq	t0, zero, $chkw
+	subu	a2, t0
+	SWHI	a1, 0(a0)		# Yes, handle first unaligned part
+	addu	a0, t0			# Now both a0 and a2 are updated
+
+$chkw:	andi	t0, a2, 0x7		# Enough left for one loop iteration?
+	beq	t0, a2, $chkl
+	subu	a3, a2, t0
+	addu	a3, a0			# a3 is last loop address +1
+	move	a2, t0			# a2 is now # of bytes left after loop
+$loopw:	addiu	a0, 8			# Handle 2 words pr. iteration
+	sw	a1, -8(a0)
+	bne	a0, a3, $loopw
+	sw	a1, -4(a0)
+
+$chkl:	andi	t0, a2, 0x4		# Check if there is at least a full
+	beq	t0, zero, $last8	#  word remaining after the loop
+	subu	a2, t0
+	sw	a1, 0(a0)		# Yes...
+	addiu	a0, 4
+
+$last8:	blez	a2, $exit		# Handle last 8 bytes (if cnt>0)
+	addu	a3, a2, a0		# a3 is last address +1
+$lst8l:	addiu	a0, 1
+	bne	a0, a3, $lst8l
+	sb	a1, -1(a0)
+$exit:	j	ra			# Bye, bye
+	nop
+
+	.set	reorder
+END (memset)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/posix/pread.c ../glibc-2.3/sysdeps/posix/pread.c
--- glibc-2.2.93/sysdeps/posix/pread.c	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/posix/pread.c	Sat Sep 14 09:40:53 2002
@@ -1,6 +1,6 @@
 /* Read block from given position in file without changing file pointer.
    POSIX version.
-   Copyright (C) 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -21,6 +21,8 @@
 
 #include <errno.h>
 #include <unistd.h>
+
+/* Note: This implementation of pread is not multithread-safe.  */
 
 ssize_t
 __libc_pread (int fd, void *buf, size_t nbyte, off_t offset)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/posix/pread64.c ../glibc-2.3/sysdeps/posix/pread64.c
--- glibc-2.2.93/sysdeps/posix/pread64.c	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/posix/pread64.c	Sat Sep 14 09:40:53 2002
@@ -1,6 +1,6 @@
 /* Read block from given position in file without changing file pointer.
    POSIX version.
-   Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -21,6 +21,8 @@
 
 #include <errno.h>
 #include <unistd.h>
+
+/* Note: This implementation of pread64 is not multithread-safe.  */
 
 ssize_t
 __libc_pread64 (int fd, void *buf, size_t nbyte, off64_t offset)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/posix/pwrite.c ../glibc-2.3/sysdeps/posix/pwrite.c
--- glibc-2.2.93/sysdeps/posix/pwrite.c	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/posix/pwrite.c	Sat Sep 14 09:40:53 2002
@@ -1,6 +1,6 @@
 /* Write block to given position in file without changing file pointer.
    POSIX version.
-   Copyright (C) 1997, 1998, 1999 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1997.
 
@@ -21,6 +21,8 @@
 
 #include <errno.h>
 #include <unistd.h>
+
+/* Note: This implementation of pwrite is not multithread-safe.  */
 
 ssize_t
 __libc_pwrite (int fd, const void *buf, size_t nbyte, off_t offset)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/posix/pwrite64.c ../glibc-2.3/sysdeps/posix/pwrite64.c
--- glibc-2.2.93/sysdeps/posix/pwrite64.c	Fri Aug  2 17:46:59 2002
+++ ../glibc-2.3/sysdeps/posix/pwrite64.c	Sat Sep 14 09:40:53 2002
@@ -22,6 +22,8 @@
 #include <errno.h>
 #include <unistd.h>
 
+/* Note: This implementation of pwrite64 is not multithread-safe.  */
+
 ssize_t
 __libc_pwrite64 (int fd, const void *buf, size_t nbyte, off64_t offset)
 {
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/Dist ../glibc-2.3/sysdeps/powerpc/Dist
--- glibc-2.2.93/sysdeps/powerpc/Dist	Wed Aug 28 04:29:38 2002
+++ ../glibc-2.3/sysdeps/powerpc/Dist	Wed Dec 31 19:00:00 1969
@@ -1,10 +0,0 @@
-divdi3.c
-dl-machine.c
-dl-start.S
-libgcc-compat.S
-ppc-mcount.S
-gprsave1.S
-gprsave0.S
-gprrest1.S
-gprrest0.S
-bp-asm.h
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/Implies ../glibc-2.3/sysdeps/powerpc/Implies
--- glibc-2.2.93/sysdeps/powerpc/Implies	Tue Sep  5 13:03:17 2000
+++ ../glibc-2.3/sysdeps/powerpc/Implies	Thu Sep  5 19:27:54 2002
@@ -1,4 +1,2 @@
-wordsize-32
 ieee754/flt-32
 ieee754/dbl-64
-powerpc/soft-fp
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/Makefile ../glibc-2.3/sysdeps/powerpc/Makefile
--- glibc-2.2.93/sysdeps/powerpc/Makefile	Mon Sep  2 23:10:26 2002
+++ ../glibc-2.3/sysdeps/powerpc/Makefile	Thu Sep  5 19:27:54 2002
@@ -1,51 +1,11 @@
 # We always want to use the new mnemonic syntax even if we are on a RS6000
 # machine.
-+cflags += -mnew-mnemonics -Wa,-mppc -mpowerpc
-asm-CPPFLAGS += -Wa,-mppc
-
-ifeq ($(with-fp),no)
-+cflags += -msoft-float
-sysdep-LDFLAGS += -msoft-float
-endif
++cflags += -mnew-mnemonics
 
 ifeq ($(subdir),gmon)
 sysdep_routines += ppc-mcount
 endif
 
-ifeq ($(subdir),misc)
-sysdep_routines += gprsave0 gprrest0 gprsave1 gprrest1
-endif
-
-# On PPC, -fpic works until the GOT contains 2^15 bytes, and possibly
-# more depending on how clever the linker is.  Each GOT entry takes 4 bytes,
-# so that's at least 8192 entries.  Since libc only uses about 2000 entries,
-# we want to use -fpic, because this generates fewer relocs.
-ifeq (yes,$(build-shared))
-pic-ccflag = -fpic
-endif
-
-ifeq ($(subdir),csu)
-ifneq ($(elf),no)
-# The initfini generation code doesn't work in the presence of -fPIC, so
-# we use -fpic instead which is much better.
-CFLAGS-initfini.s = -g0 -fpic -O1
-
-# There is no benefit to using sdata for these objects, and the user
-# of the library should be able to control what goes into sdata.
-CFLAGS-init.o = -G0
-CFLAGS-gmon-start.o = -G0
-endif
-ifeq (yes,$(build-shared))
-# Compatibility
-ifeq (yes,$(have-protected))
-CPPFLAGS-divdi3.c = -DHAVE_DOT_HIDDEN
-CPPFLAGS-libgcc-compat.S = -DHAVE_DOT_HIDDEN
-endif
-sysdep_routines += divdi3 libgcc-compat
-shared-only-routines += divdi3 libgcc-compat
-endif
-endif
-
 ifeq ($(subdir),string)
 CFLAGS-memcmp.c += -Wno-uninitialized
 endif
@@ -55,5 +15,5 @@
 sysdep-dl-routines += dl-machine
 sysdep_routines += dl-machine
 # extra shared linker files to link only into dl-allobjs.so
-sysdep-rtld-routines += dl-machine dl-start
+sysdep-rtld-routines += dl-machine
 endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/Versions ../glibc-2.3/sysdeps/powerpc/Versions
--- glibc-2.2.93/sysdeps/powerpc/Versions	Tue Aug 20 21:48:59 2002
+++ ../glibc-2.3/sysdeps/powerpc/Versions	Thu Sep  5 19:27:54 2002
@@ -1,38 +1,6 @@
-libc {
-  GLIBC_2.0 {
-    # Functions from libgcc.
-    __divdi3; __moddi3; __udivdi3; __umoddi3;
-    __cmpdi2; __ucmpdi2;
-    __ashldi3; __ashrdi3; __lshrdi3;
-    __fixdfdi; __fixunsdfdi;
-    __fixsfdi; __fixunssfdi;
-    __floatdidf; __floatdisf;
-  }
-}
-
 libm {
   GLIBC_2.1 {
     # symbols used in macros from sysdeps/powerpc/bits/fenv.h
     __fe_dfl_env; __fe_enabled_env; __fe_nonieee_env; __fe_nomask_env;
-  }
-  GLIBC_2.2 {
-    # Special functions to save and restore registers used by the
-    # runtime libraries.
-    _restgpr0_13; _restgpr0_14; _restgpr0_15; _restgpr0_16; _restgpr0_17;
-    _restgpr0_18; _restgpr0_19; _restgpr0_20; _restgpr0_21; _restgpr0_22;
-    _restgpr0_22; _restgpr0_23; _restgpr0_24; _restgpr0_25; _restgpr0_26;
-    _restgpr0_27; _restgpr0_28; _restgpr0_29; _restgpr0_30; _restgpr0_31;
-    _savegpr0_13; _savegpr0_14; _savegpr0_15; _savegpr0_16; _savegpr0_17;
-    _savegpr0_18; _savegpr0_19; _savegpr0_20; _savegpr0_21; _savegpr0_22;
-    _savegpr0_22; _savegpr0_23; _savegpr0_24; _savegpr0_25; _savegpr0_26;
-    _savegpr0_27; _savegpr0_28; _savegpr0_29; _savegpr0_30; _savegpr0_31;
-    _restgpr1_13; _restgpr1_14; _restgpr1_15; _restgpr1_16; _restgpr1_17;
-    _restgpr1_18; _restgpr1_19; _restgpr1_20; _restgpr1_21; _restgpr1_22;
-    _restgpr1_22; _restgpr1_23; _restgpr1_24; _restgpr1_25; _restgpr1_26;
-    _restgpr1_27; _restgpr1_28; _restgpr1_29; _restgpr1_30; _restgpr1_31;
-    _savegpr1_13; _savegpr1_14; _savegpr1_15; _savegpr1_16; _savegpr1_17;
-    _savegpr1_18; _savegpr1_19; _savegpr1_20; _savegpr1_21; _savegpr1_22;
-    _savegpr1_22; _savegpr1_23; _savegpr1_24; _savegpr1_25; _savegpr1_26;
-    _savegpr1_27; _savegpr1_28; _savegpr1_29; _savegpr1_30; _savegpr1_31;
   }
 }
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/__longjmp.S ../glibc-2.3/sysdeps/powerpc/__longjmp.S
--- glibc-2.2.93/sysdeps/powerpc/__longjmp.S	Thu Dec  6 02:53:55 2001
+++ ../glibc-2.3/sysdeps/powerpc/__longjmp.S	Wed Dec 31 19:00:00 1969
@@ -1,56 +0,0 @@
-/* longjmp for PowerPC.
-   Copyright (C) 1995, 1996, 1997, 1999, 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#define _ASM
-#define _SETJMP_H
-#include <bits/setjmp.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-ENTRY (BP_SYM (__longjmp))
-	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
-
-	lwz r1,(JB_GPR1*4)(r3)
-	lwz r2,(JB_GPR2*4)(r3)
-	lwz r0,(JB_LR*4)(r3)
-	lwz r14,((JB_GPRS+0)*4)(r3)
-	lwz r15,((JB_GPRS+1)*4)(r3)
-	lwz r16,((JB_GPRS+2)*4)(r3)
-	lwz r17,((JB_GPRS+3)*4)(r3)
-	lwz r18,((JB_GPRS+4)*4)(r3)
-	lwz r19,((JB_GPRS+5)*4)(r3)
-	lwz r20,((JB_GPRS+6)*4)(r3)
-	mtlr r0
-	lwz r21,((JB_GPRS+7)*4)(r3)
-	lwz r22,((JB_GPRS+8)*4)(r3)
-	lwz r0,(JB_CR*4)(r3)
-	lwz r23,((JB_GPRS+9)*4)(r3)
-	lwz r24,((JB_GPRS+10)*4)(r3)
-	lwz r25,((JB_GPRS+11)*4)(r3)
-	mtcrf 0xFF,r0
-	lwz r26,((JB_GPRS+12)*4)(r3)
-	lwz r27,((JB_GPRS+13)*4)(r3)
-	lwz r28,((JB_GPRS+14)*4)(r3)
-	lwz r29,((JB_GPRS+15)*4)(r3)
-	lwz r30,((JB_GPRS+16)*4)(r3)
-	lwz r31,((JB_GPRS+17)*4)(r3)
-	mr r3,r4
-	blr
-END (BP_SYM (__longjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/add_n.S ../glibc-2.3/sysdeps/powerpc/add_n.S
--- glibc-2.2.93/sysdeps/powerpc/add_n.S	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/powerpc/add_n.S	Wed Dec 31 19:00:00 1969
@@ -1,77 +0,0 @@
-/* Add two limb vectors of equal, non-zero length for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* mp_limb_t mpn_add_n (mp_ptr res_ptr, mp_srcptr s1_ptr, mp_srcptr s2_ptr,
-                        mp_size_t size)
-   Calculate s1+s2 and put result in res_ptr; return carry, 0 or 1.  */
-
-/* Note on optimisation: This code is optimal for the 601.  Almost every other
-   possible 2-unrolled inner loop will not be.  Also, watch out for the
-   alignment...  */
-
-EALIGN (BP_SYM (__mpn_add_n), 3, 0)
-
-#if __BOUNDED_POINTERS__
-	slwi r10,r6,2		/* convert limbs to bytes */
-	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r5, r8, r9, r10)
-#endif
-/* Set up for loop below.  */
-	mtcrf 0x01,r6
-	srwi. r7,r6,1
-	li    r10,0
-	mtctr r7
-	bt    31,L(2)
-
-/* Clear the carry.  */
-	addic r0,r0,0
-/* Adjust pointers for loop.  */
-	addi  r3,r3,-4
-	addi  r4,r4,-4
-	addi  r5,r5,-4
-	b     L(0)
-
-L(2):	lwz  r7,0(r5)
-	lwz  r6,0(r4)
-	addc r6,r6,r7
-	stw  r6,0(r3)
-        beq  L(1)
-
-/* The loop.  */
-
-/* Align start of loop to an odd word boundary to guarantee that the
-   last two words can be fetched in one access (for 601).  */
-L(0):	lwz  r9,4(r4)
-	lwz  r8,4(r5)
-	lwzu r6,8(r4)
-	lwzu r7,8(r5)
-	adde r8,r9,r8
-	stw  r8,4(r3)
-	adde r6,r6,r7
-	stwu r6,8(r3)
-	bdnz L(0)
-/* Return the carry.  */
-L(1):	addze r3,r10
-	blr
-END (BP_SYM (__mpn_add_n))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/addmul_1.S ../glibc-2.3/sysdeps/powerpc/addmul_1.S
--- glibc-2.2.93/sysdeps/powerpc/addmul_1.S	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/powerpc/addmul_1.S	Wed Dec 31 19:00:00 1969
@@ -1,56 +0,0 @@
-/* Multiply a limb vector by a single limb, for PowerPC.
-   Copyright (C) 1993-1995, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* mp_limb_t mpn_addmul_1 (mp_ptr res_ptr, mp_srcptr s1_ptr,
-                           mp_size_t s1_size, mp_limb_t s2_limb)
-   Calculate res+s1*s2 and put result back in res; return carry.  */
-ENTRY (BP_SYM (__mpn_addmul_1))
-#if __BOUNDED_POINTERS__
-	slwi r10,r5,2		/* convert limbs to bytes */
-	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
-#endif
-	mtctr	r5
-
-	lwz	r0,0(r4)
-	mullw	r7,r0,r6
-	mulhwu	r10,r0,r6
-	lwz     r9,0(r3)
-	addc	r8,r7,r9
-	addi	r3,r3,-4		/* adjust res_ptr */
-	bdz	L(1)
-
-L(0):	lwzu	r0,4(r4)
-	stwu	r8,4(r3)
-	mullw	r8,r0,r6
-	adde	r7,r8,r10
-	mulhwu	r10,r0,r6
-	lwz     r9,4(r3)
-	addze   r10,r10
-	addc    r8,r7,r9
-	bdnz	L(0)
-
-L(1):	stw	r8,4(r3)
-	addze	r3,r10
-	blr
-END (BP_SYM (__mpn_addmul_1))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/atomicity.h ../glibc-2.3/sysdeps/powerpc/atomicity.h
--- glibc-2.2.93/sysdeps/powerpc/atomicity.h	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/powerpc/atomicity.h	Wed Dec 31 19:00:00 1969
@@ -1,104 +0,0 @@
-/* Low-level functions for atomic operations.  PowerPC version.
-   Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _ATOMICITY_H
-#define _ATOMICITY_H	1
-
-#include <inttypes.h>
-
-#if BROKEN_PPC_ASM_CR0
-# define __ATOMICITY_INLINE /* nothing */
-#else
-# define __ATOMICITY_INLINE inline
-#endif
-
-static __ATOMICITY_INLINE int
-__attribute__ ((unused))
-exchange_and_add (volatile uint32_t *mem, int val)
-{
-  int tmp, result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%2	\n\
-	add%I3	%1,%0,%3	\n\
-	stwcx.	%1,0,%2	\n\
-	bne-	0b	\n\
-" : "=&b"(result), "=&r"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-  return result;
-}
-
-static __ATOMICITY_INLINE void
-__attribute__ ((unused))
-atomic_add (volatile uint32_t *mem, int val)
-{
-  int tmp;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	add%I2	%0,%0,%2	\n\
-	stwcx.	%0,0,%1	\n\
-	bne-	0b	\n\
-" : "=&b"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
-}
-
-static __ATOMICITY_INLINE int
-__attribute__ ((unused))
-compare_and_swap (volatile long int *p, long int oldval, long int newval)
-{
-  int result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	sub%I2c.	%0,%0,%2	\n\
-	cntlzw	%0,%0	\n\
-	bne-	1f	\n\
-	stwcx.	%3,0,%1	\n\
-	bne-	0b	\n\
-1:	\n\
-" : "=&b"(result) : "r"(p), "Ir"(oldval), "r"(newval) : "cr0", "memory");
-  return result >> 5;
-}
-
-static __ATOMICITY_INLINE long int
-__attribute__ ((unused))
-always_swap (volatile long int *p, long int newval)
-{
-  long int result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	stwcx.	%2,0,%1	\n\
-	bne-	0b	\n\
-" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
-  return result;
-}
-
-static __ATOMICITY_INLINE int
-__attribute__ ((unused))
-test_and_set (volatile long int *p, long int newval)
-{
-  int result;
-  __asm__ ("\n\
-0:	lwarx	%0,0,%1	\n\
-	cmpwi	%0,0	\n\
-	bne-	1f	\n\
-	stwcx.	%2,0,%1	\n\
-	bne-	0b	\n\
-1:	\n\
-" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
-  return result;
-}
-
-#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/backtrace.c ../glibc-2.3/sysdeps/powerpc/backtrace.c
--- glibc-2.2.93/sysdeps/powerpc/backtrace.c	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/powerpc/backtrace.c	Wed Dec 31 19:00:00 1969
@@ -1,66 +0,0 @@
-/* Return backtrace of current program state.
-   Copyright (C) 1998, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <execinfo.h>
-#include <stddef.h>
-#include <bp-checks.h>
-
-/* This is the stack layout we see with every stack frame.
-   Note that every routine is required by the ABI to lay out the stack
-   like this.
-
-            +----------------+        +-----------------+
-    %r1  -> | %r1 last frame--------> | %r1 last frame--->...  --> NULL
-            |                |        |                 |
-            | (unused)       |        | return address  |
-            +----------------+        +-----------------+
-*/
-struct layout
-{
-  struct layout *__unbounded next;
-  void *__unbounded return_address;
-};
-
-int
-__backtrace (void **array, int size)
-{
-  struct layout *current;
-  int count;
-
-  /* Force gcc to spill LR.  */
-  asm volatile ("" : "=l"(current));
-
-  /* Get the address on top-of-stack.  */
-  asm volatile ("lwz %0,0(1)" : "=r"(current));
-  current = BOUNDED_1 (current);
-
-  for (				count = 0;
-       current != NULL && 	count < size;
-       current = BOUNDED_1 (current->next), count++)
-    array[count] = current->return_address;
-
-  /* It's possible the second-last stack frame can't return
-     (that is, it's __libc_start_main), in which case
-     the CRT startup code will have set its LR to 'NULL'.  */
-  if (count > 0 && array[count-1] == NULL)
-    count--;
-
-  return count;
-}
-weak_alias (__backtrace, backtrace)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/bp-asm.h ../glibc-2.3/sysdeps/powerpc/bp-asm.h
--- glibc-2.2.93/sysdeps/powerpc/bp-asm.h	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/powerpc/bp-asm.h	Wed Dec 31 19:00:00 1969
@@ -1,114 +0,0 @@
-/* Bounded-pointer definitions for PowerPC assembler.
-   Copyright (C) 2000 Free Software Foundation, Inc.
-   Contributed by Greg McGary <greg@mcgary.org>
-   This file is part of the GNU C Library.  Its master source is NOT part of
-   the C library, however.  The master source lives in the GNU MP Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#if __BOUNDED_POINTERS__
-
-/* Byte offsets of BP components.  */
-# define oVALUE	0
-# define oLOW	4
-# define oHIGH	8
-
-/* Don't check bounds, just convert the BP register to its simple
-   pointer value.  */
-
-# define DISCARD_BOUNDS(rBP)			\
-	lwz	rBP, oVALUE(rBP)
-
-/* Check low bound, with the side effect that the BP register is converted
-   its simple pointer value.  Move the high bound into a register for
-   later use.  */
-
-# define CHECK_BOUNDS_LOW(rBP, rLOW, rHIGH)	\
-	lwz	rHIGH, oHIGH(rBP);		\
-	lwz	rLOW, oLOW(rBP);		\
-	lwz	rBP, oVALUE(rBP);		\
-	twllt	rBP, rLOW
-
-/* Check the high bound, which is in a register, using the given
-   conditional trap instruction.  */
-
-# define CHECK_BOUNDS_HIGH(rVALUE, rHIGH, TWLcc) \
-	TWLcc	rVALUE, rHIGH
-
-/* Check the high bound, which is stored at the return-value's high
-   bound slot, using the given conditional trap instruction.  */
-
-# define CHECK_BOUNDS_HIGH_RTN(rVALUE, rHIGH, TWLcc)	\
-	lwz	rHIGH, oHIGH(rRTN);			\
-	TWLcc	rVALUE, rHIGH
-
-/* Check both bounds, with the side effect that the BP register is
-   converted to its simple pointer value.  */
-
-# define CHECK_BOUNDS_BOTH(rBP, rLOW, rHIGH)	\
-	CHECK_BOUNDS_LOW(rBP, rLOW, rHIGH);	\
-	twlge	rBP, rHIGH
-
-/* Check bounds on a memory region of given length, with the side
-   effect that the BP register is converted to its simple pointer
-   value.  */
-
-# define CHECK_BOUNDS_BOTH_WIDE(rBP, rLOW, rHIGH, rLENGTH)	\
-	CHECK_BOUNDS_LOW (rBP, rLOW, rHIGH);			\
-	sub	rHIGH, rHIGH, rLENGTH;				\
-	twlgt	rBP, rHIGH
-
-# define CHECK_BOUNDS_BOTH_WIDE_LIT(rBP, rLOW, rHIGH, LENGTH)	\
-	CHECK_BOUNDS_LOW (rBP, rLOW, rHIGH);			\
-	subi	rHIGH, rHIGH, LENGTH;				\
-	twlgt	rBP, rHIGH
-
-/* Store a pointer value register into the return-value's pointer
-   value slot.  */
-
-# define STORE_RETURN_VALUE(rVALUE)		\
-	stw	rVALUE, oVALUE(rRTN)
-
-/* Store a low and high bounds into the return-value's pointer bounds
-   slots.  */
-
-# define STORE_RETURN_BOUNDS(rLOW, rHIGH)	\
-	stw	rLOW, oLOW(rRTN);		\
-	stw	rHIGH, oHIGH(rRTN)
-
-/* Stuff zero value/low/high into the BP addressed by rRTN.  */
-
-# define RETURN_NULL_BOUNDED_POINTER		\
-	li	r4, 0;				\
-	STORE_RETURN_VALUE (r4);		\
-	STORE_RETURN_BOUNDS (r4, r4)
-
-#else
-
-# define DISCARD_BOUNDS(rBP)
-# define CHECK_BOUNDS_LOW(rBP, rLOW, rHIGH)
-# define CHECK_BOUNDS_HIGH(rVALUE, rHIGH, TWLcc)
-# define CHECK_BOUNDS_HIGH_RTN(rVALUE, rHIGH, TWLcc)
-# define CHECK_BOUNDS_BOTH(rBP, rLOW, rHIGH)
-# define CHECK_BOUNDS_BOTH_WIDE(rBP, rLOW, rHIGH, rLENGTH)
-# define CHECK_BOUNDS_BOTH_WIDE_LIT(rBP, rLOW, rHIGH, LENGTH)
-# define STORE_RETURN_VALUE(rVALUE)
-# define STORE_RETURN_BOUNDS(rLOW, rHIGH)
-
-# define RETURN_NULL_BOUNDED_POINTER li rRTN, 0
-
-#endif
-
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/bsd-_setjmp.S ../glibc-2.3/sysdeps/powerpc/bsd-_setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/bsd-_setjmp.S	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/powerpc/bsd-_setjmp.S	Wed Dec 31 19:00:00 1969
@@ -1,30 +0,0 @@
-/* BSD `_setjmp' entry point to `sigsetjmp (..., 0)'.  PowerPC version.
-   Copyright (C) 1994, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/* This just does a tail-call to `__sigsetjmp (ARG, 0)'.
-   We cannot do it in C because it must be a tail-call, so frame-unwinding
-   in setjmp doesn't clobber the state restored by longjmp.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-
-ENTRY (BP_SYM (_setjmp))
-	li r4,0			/* Set second argument to 0.  */
-	b JUMPTARGET(BP_SYM (__sigsetjmp))
-END (BP_SYM (_setjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/bsd-setjmp.S ../glibc-2.3/sysdeps/powerpc/bsd-setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/bsd-setjmp.S	Sat Jul  7 15:21:27 2001
+++ ../glibc-2.3/sysdeps/powerpc/bsd-setjmp.S	Wed Dec 31 19:00:00 1969
@@ -1,32 +0,0 @@
-/* BSD `setjmp' entry point to `sigsetjmp (..., 1)'.  PowerPC version.
-   Copyright (C) 1994, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/* This just does a tail-call to `__sigsetjmp (ARG, 1)'.
-   We cannot do it in C because it must be a tail-call, so frame-unwinding
-   in setjmp doesn't clobber the state restored by longjmp.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-
-ENTRY (BP_SYM (__setjmp))
-	li r4,1			/* Set second argument to 1.  */
-	b JUMPTARGET (BP_SYM (__sigsetjmp))
-END (BP_SYM (__setjmp))
-
-strong_alias (__setjmp, setjmp)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/divdi3.c ../glibc-2.3/sysdeps/powerpc/divdi3.c
--- glibc-2.2.93/sysdeps/powerpc/divdi3.c	Tue Aug 20 17:26:56 2002
+++ ../glibc-2.3/sysdeps/powerpc/divdi3.c	Wed Dec 31 19:00:00 1969
@@ -1,43 +0,0 @@
-/* 64-bit multiplication and division libgcc routines for 32-bit PowerPC
-   Copyright (C) 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#define _DIVDI3_C
-#include <sysdeps/wordsize-32/divdi3.c>
-
-INTDEF (__udivdi3);
-INTDEF (__moddi3);
-INTDEF (__umoddi3);
-
-#ifdef HAVE_DOT_HIDDEN
-asm (".hidden __divdi3");
-asm (".hidden __udivdi3");
-asm (".hidden __moddi3");
-asm (".hidden __umoddi3");
-#endif
-
-#include <shlib-compat.h>
-
-#if SHLIB_COMPAT(libc, GLIBC_2_0, GLIBC_2_2_6)
-
-symbol_version (INTUSE (__divdi3), __divdi3, GLIBC_2.0);
-symbol_version (INTUSE (__udivdi3), __udivdi3, GLIBC_2.0);
-symbol_version (INTUSE (__moddi3), __moddi3, GLIBC_2.0);
-symbol_version (INTUSE (__umoddi3), __umoddi3, GLIBC_2.0);
-
-#endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/dl-machine.c ../glibc-2.3/sysdeps/powerpc/dl-machine.c
--- glibc-2.2.93/sysdeps/powerpc/dl-machine.c	Fri Mar  1 03:43:18 2002
+++ ../glibc-2.3/sysdeps/powerpc/dl-machine.c	Wed Dec 31 19:00:00 1969
@@ -1,538 +0,0 @@
-/* Machine-dependent ELF dynamic relocation functions.  PowerPC version.
-   Copyright (C) 1995-2001, 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <unistd.h>
-#include <string.h>
-#include <sys/param.h>
-#include <link.h>
-#include <ldsodefs.h>
-#include <elf/dynamic-link.h>
-#include <dl-machine.h>
-#include <stdio-common/_itoa.h>
-
-/* Because ld.so is now versioned, these functions can be in their own file;
-   no relocations need to be done to call them.
-   Of course, if ld.so is not versioned...  */
-#if !(DO_VERSIONING - 0)
-#error This will not work with versioning turned off, sorry.
-#endif
-
-
-/* Stuff for the PLT.  */
-#define PLT_INITIAL_ENTRY_WORDS 18
-#define PLT_LONGBRANCH_ENTRY_WORDS 0
-#define PLT_TRAMPOLINE_ENTRY_WORDS 6
-#define PLT_DOUBLE_SIZE (1<<13)
-#define PLT_ENTRY_START_WORDS(entry_number) \
-  (PLT_INITIAL_ENTRY_WORDS + (entry_number)*2				\
-   + ((entry_number) > PLT_DOUBLE_SIZE					\
-      ? ((entry_number) - PLT_DOUBLE_SIZE)*2				\
-      : 0))
-#define PLT_DATA_START_WORDS(num_entries) PLT_ENTRY_START_WORDS(num_entries)
-
-/* Macros to build PowerPC opcode words.  */
-#define OPCODE_ADDI(rd,ra,simm) \
-  (0x38000000 | (rd) << 21 | (ra) << 16 | ((simm) & 0xffff))
-#define OPCODE_ADDIS(rd,ra,simm) \
-  (0x3c000000 | (rd) << 21 | (ra) << 16 | ((simm) & 0xffff))
-#define OPCODE_ADD(rd,ra,rb) \
-  (0x7c000214 | (rd) << 21 | (ra) << 16 | (rb) << 11)
-#define OPCODE_B(target) (0x48000000 | ((target) & 0x03fffffc))
-#define OPCODE_BA(target) (0x48000002 | ((target) & 0x03fffffc))
-#define OPCODE_BCTR() 0x4e800420
-#define OPCODE_LWZ(rd,d,ra) \
-  (0x80000000 | (rd) << 21 | (ra) << 16 | ((d) & 0xffff))
-#define OPCODE_LWZU(rd,d,ra) \
-  (0x84000000 | (rd) << 21 | (ra) << 16 | ((d) & 0xffff))
-#define OPCODE_MTCTR(rd) (0x7C0903A6 | (rd) << 21)
-#define OPCODE_RLWINM(ra,rs,sh,mb,me) \
-  (0x54000000 | (rs) << 21 | (ra) << 16 | (sh) << 11 | (mb) << 6 | (me) << 1)
-
-#define OPCODE_LI(rd,simm)    OPCODE_ADDI(rd,0,simm)
-#define OPCODE_ADDIS_HI(rd,ra,value) \
-  OPCODE_ADDIS(rd,ra,((value) + 0x8000) >> 16)
-#define OPCODE_LIS_HI(rd,value) OPCODE_ADDIS_HI(rd,0,value)
-#define OPCODE_SLWI(ra,rs,sh) OPCODE_RLWINM(ra,rs,sh,0,31-sh)
-
-
-#define PPC_DCBST(where) asm volatile ("dcbst 0,%0" : : "r"(where) : "memory")
-#define PPC_SYNC asm volatile ("sync" : : : "memory")
-#define PPC_ISYNC asm volatile ("sync; isync" : : : "memory")
-#define PPC_ICBI(where) asm volatile ("icbi 0,%0" : : "r"(where) : "memory")
-#define PPC_DIE asm volatile ("tweq 0,0")
-
-/* Use this when you've modified some code, but it won't be in the
-   instruction fetch queue (or when it doesn't matter if it is). */
-#define MODIFIED_CODE_NOQUEUE(where) \
-     do { PPC_DCBST(where); PPC_SYNC; PPC_ICBI(where); } while (0)
-/* Use this when it might be in the instruction queue. */
-#define MODIFIED_CODE(where) \
-     do { PPC_DCBST(where); PPC_SYNC; PPC_ICBI(where); PPC_ISYNC; } while (0)
-
-
-/* The idea here is that to conform to the ABI, we are supposed to try
-   to load dynamic objects between 0x10000 (we actually use 0x40000 as
-   the lower bound, to increase the chance of a memory reference from
-   a null pointer giving a segfault) and the program's load address;
-   this may allow us to use a branch instruction in the PLT rather
-   than a computed jump.  The address is only used as a preference for
-   mmap, so if we get it wrong the worst that happens is that it gets
-   mapped somewhere else.  */
-
-ElfW(Addr)
-__elf_preferred_address(struct link_map *loader, size_t maplength,
-			ElfW(Addr) mapstartpref)
-{
-  ElfW(Addr) low, high;
-  struct link_map *l;
-
-  /* If the object has a preference, load it there!  */
-  if (mapstartpref != 0)
-    return mapstartpref;
-
-  /* Otherwise, quickly look for a suitable gap between 0x3FFFF and
-     0x70000000.  0x3FFFF is so that references off NULL pointers will
-     cause a segfault, 0x70000000 is just paranoia (it should always
-     be superceded by the program's load address).  */
-  low =  0x0003FFFF;
-  high = 0x70000000;
-  for (l = GL(dl_loaded); l; l = l->l_next)
-    {
-      ElfW(Addr) mapstart, mapend;
-      mapstart = l->l_map_start & ~(GL(dl_pagesize) - 1);
-      mapend = l->l_map_end | (GL(dl_pagesize) - 1);
-      assert (mapend > mapstart);
-
-      /* Prefer gaps below the main executable, note that l ==
-	 _dl_loaded does not work for static binaries loading
-	 e.g. libnss_*.so.  */
-      if ((mapend >= high || l->l_type == lt_executable)
-	  && high >= mapstart)
-	high = mapstart;
-      else if (mapend >= low && low >= mapstart)
-	low = mapend;
-      else if (high >= mapend && mapstart >= low)
-	{
-	  if (high - mapend >= mapstart - low)
-	    low = mapend;
-	  else
-	    high = mapstart;
-	}
-    }
-
-  high -= 0x10000; /* Allow some room between objects.  */
-  maplength = (maplength | (GL(dl_pagesize) - 1)) + 1;
-  if (high <= low || high - low < maplength )
-    return 0;
-  return high - maplength;  /* Both high and maplength are page-aligned.  */
-}
-
-/* Set up the loaded object described by L so its unrelocated PLT
-   entries will jump to the on-demand fixup code in dl-runtime.c.
-   Also install a small trampoline to be used by entries that have
-   been relocated to an address too far away for a single branch.  */
-
-/* There are many kinds of PLT entries:
-
-   (1)	A direct jump to the actual routine, either a relative or
-	absolute branch.  These are set up in __elf_machine_fixup_plt.
-
-   (2)	Short lazy entries.  These cover the first 8192 slots in
-        the PLT, and look like (where 'index' goes from 0 to 8191):
-
-	li %r11, index*4
-	b  &plt[PLT_TRAMPOLINE_ENTRY_WORDS+1]
-
-   (3)	Short indirect jumps.  These replace (2) when a direct jump
-	wouldn't reach.  They look the same except that the branch
-	is 'b &plt[PLT_LONGBRANCH_ENTRY_WORDS]'.
-
-   (4)  Long lazy entries.  These cover the slots when a short entry
-	won't fit ('index*4' overflows its field), and look like:
-
-	lis %r11, %hi(index*4 + &plt[PLT_DATA_START_WORDS])
-	lwzu %r12, %r11, %lo(index*4 + &plt[PLT_DATA_START_WORDS])
-	b  &plt[PLT_TRAMPOLINE_ENTRY_WORDS]
-	bctr
-
-   (5)	Long indirect jumps.  These replace (4) when a direct jump
-	wouldn't reach.  They look like:
-
-	lis %r11, %hi(index*4 + &plt[PLT_DATA_START_WORDS])
-	lwz %r12, %r11, %lo(index*4 + &plt[PLT_DATA_START_WORDS])
-	mtctr %r12
-	bctr
-
-   (6) Long direct jumps.  These are used when thread-safety is not
-       required.  They look like:
-
-       lis %r12, %hi(finaladdr)
-       addi %r12, %r12, %lo(finaladdr)
-       mtctr %r12
-       bctr
-
-
-   The lazy entries, (2) and (4), are set up here in
-   __elf_machine_runtime_setup.  (1), (3), and (5) are set up in
-   __elf_machine_fixup_plt.  (1), (3), and (6) can also be constructed
-   in __process_machine_rela.
-
-   The reason for the somewhat strange construction of the long
-   entries, (4) and (5), is that we need to ensure thread-safety.  For
-   (1) and (3), this is obvious because only one instruction is
-   changed and the PPC architecture guarantees that aligned stores are
-   atomic.  For (5), this is more tricky.  When changing (4) to (5),
-   the `b' instruction is first changed to to `mtctr'; this is safe
-   and is why the `lwzu' instruction is not just a simple `addi'.
-   Once this is done, and is visible to all processors, the `lwzu' can
-   safely be changed to a `lwz'.  */
-int
-__elf_machine_runtime_setup (struct link_map *map, int lazy, int profile)
-{
-  if (map->l_info[DT_JMPREL])
-    {
-      Elf32_Word i;
-      Elf32_Word *plt = (Elf32_Word *) D_PTR (map, l_info[DT_PLTGOT]);
-      Elf32_Word num_plt_entries = (map->l_info[DT_PLTRELSZ]->d_un.d_val
-				    / sizeof (Elf32_Rela));
-      Elf32_Word rel_offset_words = PLT_DATA_START_WORDS (num_plt_entries);
-      Elf32_Word data_words = (Elf32_Word) (plt + rel_offset_words);
-      Elf32_Word size_modified;
-
-      extern void _dl_runtime_resolve (void);
-      extern void _dl_prof_resolve (void);
-
-      /* Convert the index in r11 into an actual address, and get the
-	 word at that address.  */
-      plt[PLT_LONGBRANCH_ENTRY_WORDS] = OPCODE_ADDIS_HI (11, 11, data_words);
-      plt[PLT_LONGBRANCH_ENTRY_WORDS + 1] = OPCODE_LWZ (11, data_words, 11);
-
-      /* Call the procedure at that address.  */
-      plt[PLT_LONGBRANCH_ENTRY_WORDS + 2] = OPCODE_MTCTR (11);
-      plt[PLT_LONGBRANCH_ENTRY_WORDS + 3] = OPCODE_BCTR ();
-
-      if (lazy)
-	{
-	  Elf32_Word *tramp = plt + PLT_TRAMPOLINE_ENTRY_WORDS;
-	  Elf32_Word dlrr = (Elf32_Word)(profile
-					 ? _dl_prof_resolve
-					 : _dl_runtime_resolve);
-	  Elf32_Word offset;
-
-	  if (profile && _dl_name_match_p (GL(dl_profile), map))
-	    /* This is the object we are looking for.  Say that we really
-	       want profiling and the timers are started.  */
-	    GL(dl_profile_map) = map;
-
-	  /* For the long entries, subtract off data_words.  */
-	  tramp[0] = OPCODE_ADDIS_HI (11, 11, -data_words);
-	  tramp[1] = OPCODE_ADDI (11, 11, -data_words);
-
-	  /* Multiply index of entry by 3 (in r11).  */
-	  tramp[2] = OPCODE_SLWI (12, 11, 1);
-	  tramp[3] = OPCODE_ADD (11, 12, 11);
-	  if (dlrr <= 0x01fffffc || dlrr >= 0xfe000000)
-	    {
-	      /* Load address of link map in r12.  */
-	      tramp[4] = OPCODE_LI (12, (Elf32_Word) map);
-	      tramp[5] = OPCODE_ADDIS_HI (12, 12, (Elf32_Word) map);
-
-	      /* Call _dl_runtime_resolve.  */
-	      tramp[6] = OPCODE_BA (dlrr);
-	    }
-	  else
-	    {
-	      /* Get address of _dl_runtime_resolve in CTR.  */
-	      tramp[4] = OPCODE_LI (12, dlrr);
-	      tramp[5] = OPCODE_ADDIS_HI (12, 12, dlrr);
-	      tramp[6] = OPCODE_MTCTR (12);
-
-	      /* Load address of link map in r12.  */
-	      tramp[7] = OPCODE_LI (12, (Elf32_Word) map);
-	      tramp[8] = OPCODE_ADDIS_HI (12, 12, (Elf32_Word) map);
-
-	      /* Call _dl_runtime_resolve.  */
-	      tramp[9] = OPCODE_BCTR ();
-	    }
-
-	  /* Set up the lazy PLT entries.  */
-	  offset = PLT_INITIAL_ENTRY_WORDS;
-	  i = 0;
-	  while (i < num_plt_entries && i < PLT_DOUBLE_SIZE)
-	    {
-	      plt[offset  ] = OPCODE_LI (11, i * 4);
-	      plt[offset+1] = OPCODE_B ((PLT_TRAMPOLINE_ENTRY_WORDS + 2
-					 - (offset+1))
-					* 4);
-	      i++;
-	      offset += 2;
-	    }
-	  while (i < num_plt_entries)
-	    {
-	      plt[offset  ] = OPCODE_LIS_HI (11, i * 4 + data_words);
-	      plt[offset+1] = OPCODE_LWZU (12, i * 4 + data_words, 11);
-	      plt[offset+2] = OPCODE_B ((PLT_TRAMPOLINE_ENTRY_WORDS
-					 - (offset+2))
-					* 4);
-	      plt[offset+3] = OPCODE_BCTR ();
-	      i++;
-	      offset += 4;
-	    }
-	}
-
-      /* Now, we've modified code.  We need to write the changes from
-	 the data cache to a second-level unified cache, then make
-	 sure that stale data in the instruction cache is removed.
-	 (In a multiprocessor system, the effect is more complex.)
-	 Most of the PLT shouldn't be in the instruction cache, but
-	 there may be a little overlap at the start and the end.
-
-	 Assumes that dcbst and icbi apply to lines of 16 bytes or
-	 more.  Current known line sizes are 16, 32, and 128 bytes.  */
-
-      size_modified = lazy ? rel_offset_words : 6;
-      for (i = 0; i < size_modified; i += 4)
-	PPC_DCBST (plt + i);
-      PPC_DCBST (plt + size_modified - 1);
-      PPC_SYNC;
-      PPC_ICBI (plt);
-      PPC_ICBI (plt + size_modified - 1);
-      PPC_ISYNC;
-    }
-
-  return lazy;
-}
-
-Elf32_Addr
-__elf_machine_fixup_plt(struct link_map *map, const Elf32_Rela *reloc,
-			Elf32_Addr *reloc_addr, Elf32_Addr finaladdr)
-{
-  Elf32_Sword delta = finaladdr - (Elf32_Word) reloc_addr;
-  if (delta << 6 >> 6 == delta)
-    *reloc_addr = OPCODE_B (delta);
-  else if (finaladdr <= 0x01fffffc || finaladdr >= 0xfe000000)
-    *reloc_addr = OPCODE_BA (finaladdr);
-  else
-    {
-      Elf32_Word *plt, *data_words;
-      Elf32_Word index, offset, num_plt_entries;
-
-      num_plt_entries = (map->l_info[DT_PLTRELSZ]->d_un.d_val
-			 / sizeof(Elf32_Rela));
-      plt = (Elf32_Word *) D_PTR (map, l_info[DT_PLTGOT]);
-      offset = reloc_addr - plt;
-      index = (offset - PLT_INITIAL_ENTRY_WORDS)/2;
-      data_words = plt + PLT_DATA_START_WORDS (num_plt_entries);
-
-      reloc_addr += 1;
-
-      if (index < PLT_DOUBLE_SIZE)
-	{
-	  data_words[index] = finaladdr;
-	  PPC_SYNC;
-	  *reloc_addr = OPCODE_B ((PLT_LONGBRANCH_ENTRY_WORDS - (offset+1))
-				  * 4);
-	}
-      else
-	{
-	  index -= (index - PLT_DOUBLE_SIZE)/2;
-
-	  data_words[index] = finaladdr;
-	  PPC_SYNC;
-
-	  reloc_addr[1] = OPCODE_MTCTR (12);
-	  MODIFIED_CODE_NOQUEUE (reloc_addr + 1);
-	  PPC_SYNC;
-
-	  reloc_addr[0] = OPCODE_LWZ (12,
-				      (Elf32_Word) (data_words + index), 11);
-	}
-    }
-  MODIFIED_CODE (reloc_addr);
-  return finaladdr;
-}
-
-static void
-dl_reloc_overflow (struct link_map *map,
-		   const char *name,
-		   Elf32_Addr *const reloc_addr,
-		   const Elf32_Sym *sym,
-		   const Elf32_Sym *refsym)
-{
-  char buffer[128];
-  char *t;
-  const Elf32_Sym *errsym = sym ?: refsym;
-  t = stpcpy (buffer, name);
-  t = stpcpy (t, " relocation at 0x00000000");
-  _itoa_word ((unsigned) reloc_addr, t, 16, 0);
-  if (errsym)
-    {
-      const char *strtab;
-
-      strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
-      t = stpcpy (t, " for symbol `");
-      t = stpcpy (t, strtab + errsym->st_name);
-      t = stpcpy (t, "'");
-    }
-  t = stpcpy (t, " out of range");
-  _dl_signal_error (0, map->l_name, NULL, buffer);
-}
-
-void
-__process_machine_rela (struct link_map *map,
-			const Elf32_Rela *reloc,
-			const Elf32_Sym *sym,
-			const Elf32_Sym *refsym,
-			Elf32_Addr *const reloc_addr,
-			Elf32_Addr const finaladdr,
-			int rinfo)
-{
-  switch (rinfo)
-    {
-    case R_PPC_NONE:
-      return;
-
-    case R_PPC_ADDR32:
-    case R_PPC_UADDR32:
-    case R_PPC_GLOB_DAT:
-    case R_PPC_RELATIVE:
-      *reloc_addr = finaladdr;
-      return;
-
-    case R_PPC_ADDR24:
-      if (finaladdr > 0x01fffffc && finaladdr < 0xfe000000)
-	dl_reloc_overflow (map,  "R_PPC_ADDR24", reloc_addr, sym, refsym);
-      *reloc_addr = (*reloc_addr & 0xfc000003) | (finaladdr & 0x3fffffc);
-      break;
-
-    case R_PPC_ADDR16:
-    case R_PPC_UADDR16:
-      if (finaladdr > 0x7fff && finaladdr < 0x8000)
-	dl_reloc_overflow (map,  "R_PPC_ADDR16", reloc_addr, sym, refsym);
-      *(Elf32_Half*) reloc_addr = finaladdr;
-      break;
-
-    case R_PPC_ADDR16_LO:
-      *(Elf32_Half*) reloc_addr = finaladdr;
-      break;
-
-    case R_PPC_ADDR16_HI:
-      *(Elf32_Half*) reloc_addr = finaladdr >> 16;
-      break;
-
-    case R_PPC_ADDR16_HA:
-      *(Elf32_Half*) reloc_addr = (finaladdr + 0x8000) >> 16;
-      break;
-
-    case R_PPC_ADDR14:
-    case R_PPC_ADDR14_BRTAKEN:
-    case R_PPC_ADDR14_BRNTAKEN:
-      if (finaladdr > 0x7fff && finaladdr < 0x8000)
-	dl_reloc_overflow (map,  "R_PPC_ADDR14", reloc_addr, sym, refsym);
-      *reloc_addr = (*reloc_addr & 0xffff0003) | (finaladdr & 0xfffc);
-      if (rinfo != R_PPC_ADDR14)
-	*reloc_addr = ((*reloc_addr & 0xffdfffff)
-		       | ((rinfo == R_PPC_ADDR14_BRTAKEN)
-			  ^ (finaladdr >> 31)) << 21);
-      break;
-
-    case R_PPC_REL24:
-      {
-	Elf32_Sword delta = finaladdr - (Elf32_Word) reloc_addr;
-	if (delta << 6 >> 6 != delta)
-	  dl_reloc_overflow (map,  "R_PPC_REL24", reloc_addr, sym, refsym);
-	*reloc_addr = (*reloc_addr & 0xfc000003) | (delta & 0x3fffffc);
-      }
-      break;
-
-    case R_PPC_COPY:
-      if (sym == NULL)
-	/* This can happen in trace mode when an object could not be
-	   found.  */
-	return;
-      if (sym->st_size > refsym->st_size
-	  || (GL(dl_verbose) && sym->st_size < refsym->st_size))
-	{
-	  const char *strtab;
-
-	  strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
-	  _dl_error_printf ("\
-%s: Symbol `%s' has different size in shared object, onsider re-linking\n",
-			    rtld_progname ?: "<program name unknown>",
-			    strtab + refsym->st_name);
-	}
-      memcpy (reloc_addr, (char *) finaladdr, MIN (sym->st_size,
-						   refsym->st_size));
-      return;
-
-    case R_PPC_REL32:
-      *reloc_addr = finaladdr - (Elf32_Word) reloc_addr;
-      return;
-
-    case R_PPC_JMP_SLOT:
-      /* It used to be that elf_machine_fixup_plt was used here,
-	 but that doesn't work when ld.so relocates itself
-	 for the second time.  On the bright side, there's
-         no need to worry about thread-safety here.  */
-      {
-	Elf32_Sword delta = finaladdr - (Elf32_Word) reloc_addr;
-	if (delta << 6 >> 6 == delta)
-	  *reloc_addr = OPCODE_B (delta);
-	else if (finaladdr <= 0x01fffffc || finaladdr >= 0xfe000000)
-	  *reloc_addr = OPCODE_BA (finaladdr);
-	else
-	  {
-	    Elf32_Word *plt, *data_words;
-	    Elf32_Word index, offset, num_plt_entries;
-
-	    plt = (Elf32_Word *) D_PTR (map, l_info[DT_PLTGOT]);
-	    offset = reloc_addr - plt;
-
-	    if (offset < PLT_DOUBLE_SIZE*2 + PLT_INITIAL_ENTRY_WORDS)
-	      {
-		index = (offset - PLT_INITIAL_ENTRY_WORDS)/2;
-		num_plt_entries = (map->l_info[DT_PLTRELSZ]->d_un.d_val
-				   / sizeof(Elf32_Rela));
-		data_words = plt + PLT_DATA_START_WORDS (num_plt_entries);
-		data_words[index] = finaladdr;
-		reloc_addr[0] = OPCODE_LI (11, index * 4);
-		reloc_addr[1] = OPCODE_B ((PLT_LONGBRANCH_ENTRY_WORDS
-					   - (offset+1))
-					  * 4);
-		MODIFIED_CODE_NOQUEUE (reloc_addr + 1);
-	      }
-	    else
-	      {
-		reloc_addr[0] = OPCODE_LIS_HI (12, finaladdr);
-		reloc_addr[1] = OPCODE_ADDI (12, 12, finaladdr);
-		reloc_addr[2] = OPCODE_MTCTR (12);
-		reloc_addr[3] = OPCODE_BCTR ();
-		MODIFIED_CODE_NOQUEUE (reloc_addr + 3);
-	      }
-	  }
-      }
-      break;
-
-    default:
-      _dl_reloc_bad_type (map, rinfo, 0);
-      return;
-    }
-
-  MODIFIED_CODE_NOQUEUE (reloc_addr);
-}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/dl-machine.h ../glibc-2.3/sysdeps/powerpc/dl-machine.h
--- glibc-2.2.93/sysdeps/powerpc/dl-machine.h	Tue Feb 19 02:34:52 2002
+++ ../glibc-2.3/sysdeps/powerpc/dl-machine.h	Wed Dec 31 19:00:00 1969
@@ -1,418 +0,0 @@
-/* Machine-dependent ELF dynamic relocation inline functions.  PowerPC version.
-   Copyright (C) 1995-2000,01,02 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef dl_machine_h
-#define dl_machine_h
-
-#define ELF_MACHINE_NAME "powerpc"
-
-#include <assert.h>
-
-/* Return nonzero iff ELF header is compatible with the running host.  */
-static inline int
-elf_machine_matches_host (const Elf32_Ehdr *ehdr)
-{
-  return ehdr->e_machine == EM_PPC;
-}
-
-
-/* Return the link-time address of _DYNAMIC, stored as
-   the first value in the GOT. */
-static inline Elf32_Addr
-elf_machine_dynamic (void)
-{
-  Elf32_Addr *got;
-  asm (" bl _GLOBAL_OFFSET_TABLE_-4@local"
-       : "=l"(got));
-  return *got;
-}
-
-/* Return the run-time load address of the shared object.  */
-static inline Elf32_Addr
-elf_machine_load_address (void)
-{
-  unsigned int *got;
-  unsigned int *branchaddr;
-
-  /* This is much harder than you'd expect.  Possibly I'm missing something.
-     The 'obvious' way:
-
-       Apparently, "bcl 20,31,$+4" is what should be used to load LR
-       with the address of the next instruction.
-       I think this is so that machines that do bl/blr pairing don't
-       get confused.
-
-     asm ("bcl 20,31,0f ;"
-	  "0: mflr 0 ;"
-	  "lis %0,0b@ha;"
-	  "addi %0,%0,0b@l;"
-	  "subf %0,%0,0"
-	  : "=b" (addr) : : "r0", "lr");
-
-     doesn't work, because the linker doesn't have to (and in fact doesn't)
-     update the @ha and @l references; the loader (which runs after this
-     code) will do that.
-
-     Instead, we use the following trick:
-
-     The linker puts the _link-time_ address of _DYNAMIC at the first
-     word in the GOT. We could branch to that address, if we wanted,
-     by using an @local reloc; the linker works this out, so it's safe
-     to use now. We can't, of course, actually branch there, because
-     we'd cause an illegal instruction exception; so we need to compute
-     the address ourselves. That gives us the following code: */
-
-  /* Get address of the 'b _DYNAMIC@local'...  */
-  asm ("bl 0f ;"
-       "b _DYNAMIC@local;"
-       "0:"
-       : "=l"(branchaddr));
-
-  /* ... and the address of the GOT.  */
-  asm (" bl _GLOBAL_OFFSET_TABLE_-4@local"
-       : "=l"(got));
-
-  /* So now work out the difference between where the branch actually points,
-     and the offset of that location in memory from the start of the file.  */
-  return ((Elf32_Addr)branchaddr - *got
-	  + ((int)(*branchaddr << 6 & 0xffffff00) >> 6));
-}
-
-#define ELF_MACHINE_BEFORE_RTLD_RELOC(dynamic_info) /* nothing */
-
-/* The PLT uses Elf32_Rela relocs.  */
-#define elf_machine_relplt elf_machine_rela
-
-/* This code is used in dl-runtime.c to call the `fixup' function
-   and then redirect to the address it returns.  It is called
-   from code built in the PLT by elf_machine_runtime_setup.  */
-#if !defined PROF
-#define ELF_MACHINE_RUNTIME_TRAMPOLINE asm ("\n\
-	.section \".text\"	\n\
-	.align 2	\n\
-	.globl _dl_runtime_resolve	\n\
-	.type _dl_runtime_resolve,@function	\n\
-_dl_runtime_resolve:	\n\
- # We need to save the registers used to pass parameters, and register 0,\n\
- # which is used by _mcount; the registers are saved in a stack frame.\n\
-	stwu 1,-64(1)	\n\
-	stw 0,12(1)	\n\
-	stw 3,16(1)	\n\
-	stw 4,20(1)	\n\
- # The code that calls this has put parameters for `fixup' in r12 and r11.\n\
-	mr 3,12	\n\
-	stw 5,24(1)	\n\
-	mr 4,11	\n\
-	stw 6,28(1)	\n\
-	mflr 0	\n\
- # We also need to save some of the condition register fields.\n\
-	stw 7,32(1)	\n\
-	stw 0,48(1)	\n\
-	stw 8,36(1)	\n\
-	mfcr 0	\n\
-	stw 9,40(1)	\n\
-	stw 10,44(1)	\n\
-	stw 0,8(1)	\n\
-	bl fixup@local	\n\
- # 'fixup' returns the address we want to branch to.\n\
-	mtctr 3	\n\
- # Put the registers back...\n\
-	lwz 0,48(1)	\n\
-	lwz 10,44(1)	\n\
-	lwz 9,40(1)	\n\
-	mtlr 0	\n\
-	lwz 8,36(1)	\n\
-	lwz 0,8(1)	\n\
-	lwz 7,32(1)	\n\
-	lwz 6,28(1)	\n\
-	mtcrf 0xFF,0	\n\
-	lwz 5,24(1)	\n\
-	lwz 4,20(1)	\n\
-	lwz 3,16(1)	\n\
-	lwz 0,12(1)	\n\
- # ...unwind the stack frame, and jump to the PLT entry we updated.\n\
-	addi 1,1,64	\n\
-	bctr	\n\
-	.size	 _dl_runtime_resolve,.-_dl_runtime_resolve	\n\
-	\n\
-	.align 2	\n\
-	.globl _dl_prof_resolve	\n\
-	.type _dl_prof_resolve,@function	\n\
-_dl_prof_resolve:	\n\
- # We need to save the registers used to pass parameters, and register 0,\n\
- # which is used by _mcount; the registers are saved in a stack frame.\n\
-	stwu 1,-64(1)	\n\
-        stw 0,12(1)	\n\
-	stw 3,16(1)	\n\
-	stw 4,20(1)	\n\
- # The code that calls this has put parameters for `fixup' in r12 and r11.\n\
-	mr 3,12	\n\
-	stw 5,24(1)	\n\
-	mr 4,11	\n\
-	stw 6,28(1)	\n\
-	mflr 5	\n\
- # We also need to save some of the condition register fields.\n\
-	stw 7,32(1)	\n\
-	stw 5,48(1)	\n\
-	stw 8,36(1)	\n\
-	mfcr 0	\n\
-	stw 9,40(1)	\n\
-	stw 10,44(1)	\n\
-	stw 0,8(1)	\n\
-	bl profile_fixup@local	\n\
- # 'fixup' returns the address we want to branch to.\n\
-	mtctr 3	\n\
- # Put the registers back...\n\
-	lwz 0,48(1)	\n\
-	lwz 10,44(1)	\n\
-	lwz 9,40(1)	\n\
-	mtlr 0	\n\
-	lwz 8,36(1)	\n\
-	lwz 0,8(1)	\n\
-	lwz 7,32(1)	\n\
-	lwz 6,28(1)	\n\
-	mtcrf 0xFF,0	\n\
-	lwz 5,24(1)	\n\
-	lwz 4,20(1)	\n\
-	lwz 3,16(1)	\n\
-        lwz 0,12(1)	\n\
- # ...unwind the stack frame, and jump to the PLT entry we updated.\n\
-	addi 1,1,64	\n\
-	bctr	\n\
-	.size	 _dl_prof_resolve,.-_dl_prof_resolve	\n\
- # Undo '.section text'.\n\
-	.previous	\n\
-");
-#else
-# define ELF_MACHINE_RUNTIME_TRAMPOLINE asm ("\n\
-	.section \".text\"	\n\
-	.align 2	\n\
-	.globl _dl_runtime_resolve	\n\
-	.globl _dl_prof_resolve	\n\
-	.type _dl_runtime_resolve,@function	\n\
-	.type _dl_prof_resolve,@function	\n\
-_dl_runtime_resolve:	\n\
-_dl_prof_resolve:	\n\
- # We need to save the registers used to pass parameters, and register 0,\n\
- # which is used by _mcount; the registers are saved in a stack frame.\n\
-	stwu 1,-64(1)	\n\
-	stw 0,12(1)	\n\
-	stw 3,16(1)	\n\
-	stw 4,20(1)	\n\
- # The code that calls this has put parameters for `fixup' in r12 and r11.\n\
-	mr 3,12	\n\
-	stw 5,24(1)	\n\
-	mr 4,11	\n\
-	stw 6,28(1)	\n\
-	mflr 0	\n\
- # We also need to save some of the condition register fields.\n\
-	stw 7,32(1)	\n\
-	stw 0,48(1)	\n\
-	stw 8,36(1)	\n\
-	mfcr 0	\n\
-	stw 9,40(1)	\n\
-	stw 10,44(1)	\n\
-	stw 0,8(1)	\n\
-	bl fixup@local	\n\
- # 'fixup' returns the address we want to branch to.\n\
-	mtctr 3	\n\
- # Put the registers back...\n\
-	lwz 0,48(1)	\n\
-	lwz 10,44(1)	\n\
-	lwz 9,40(1)	\n\
-	mtlr 0	\n\
-	lwz 8,36(1)	\n\
-	lwz 0,8(1)	\n\
-	lwz 7,32(1)	\n\
-	lwz 6,28(1)	\n\
-	mtcrf 0xFF,0	\n\
-	lwz 5,24(1)	\n\
-	lwz 4,20(1)	\n\
-	lwz 3,16(1)	\n\
-	lwz 0,12(1)	\n\
- # ...unwind the stack frame, and jump to the PLT entry we updated.\n\
-	addi 1,1,64	\n\
-	bctr	\n\
-	.size	 _dl_runtime_resolve,.-_dl_runtime_resolve	\n\
-");
-#endif
-
-/* Mask identifying addresses reserved for the user program,
-   where the dynamic linker should not map anything.  */
-#define ELF_MACHINE_USER_ADDRESS_MASK	0xf0000000UL
-
-/* The actual _start code is in dl-start.S.  Use a really
-   ugly bit of assembler to let dl-start.o see _dl_start.  */
-#define RTLD_START asm (".globl _dl_start");
-
-/* Decide where a relocatable object should be loaded.  */
-extern ElfW(Addr)
-__elf_preferred_address(struct link_map *loader, size_t maplength,
-			ElfW(Addr) mapstartpref);
-#define ELF_PREFERRED_ADDRESS(loader, maplength, mapstartpref) \
-  __elf_preferred_address (loader, maplength, mapstartpref)
-
-/* ELF_RTYPE_CLASS_PLT iff TYPE describes relocation of a PLT entry, so
-   PLT entries should not be allowed to define the value.
-   ELF_RTYPE_CLASS_NOCOPY iff TYPE should not be allowed to resolve to one
-   of the main executable's symbols, as for a COPY reloc.  */
-/* We never want to use a PLT entry as the destination of a
-   reloc, when what is being relocated is a branch. This is
-   partly for efficiency, but mostly so we avoid loops.  */
-#define elf_machine_type_class(type) \
-  ((((type) == R_PPC_JMP_SLOT				\
-    || (type) == R_PPC_REL24				\
-    || (type) == R_PPC_ADDR24) * ELF_RTYPE_CLASS_PLT)	\
-   | (((type) == R_PPC_COPY) * ELF_RTYPE_CLASS_COPY))
-
-/* A reloc type used for ld.so cmdline arg lookups to reject PLT entries.  */
-#define ELF_MACHINE_JMP_SLOT	R_PPC_JMP_SLOT
-
-/* The PowerPC never uses REL relocations.  */
-#define ELF_MACHINE_NO_REL 1
-
-/* Set up the loaded object described by L so its unrelocated PLT
-   entries will jump to the on-demand fixup code in dl-runtime.c.
-   Also install a small trampoline to be used by entries that have
-   been relocated to an address too far away for a single branch.  */
-extern int __elf_machine_runtime_setup (struct link_map *map,
-					int lazy, int profile);
-#define elf_machine_runtime_setup __elf_machine_runtime_setup
-
-static inline void
-elf_machine_lazy_rel (struct link_map *map,
-		      Elf32_Addr l_addr, const Elf32_Rela *reloc)
-{
-  /* elf_machine_runtime_setup handles this. */
-}
-
-/* Change the PLT entry whose reloc is 'reloc' to call the actual routine.  */
-extern Elf32_Addr __elf_machine_fixup_plt (struct link_map *map,
-					   const Elf32_Rela *reloc,
-					   Elf32_Addr *reloc_addr,
-					   Elf32_Addr finaladdr);
-
-static inline Elf32_Addr
-elf_machine_fixup_plt (struct link_map *map, lookup_t t,
-		       const Elf32_Rela *reloc,
-		       Elf32_Addr *reloc_addr, Elf64_Addr finaladdr)
-{
-  return __elf_machine_fixup_plt (map, reloc, reloc_addr, finaladdr);
-}
-
-/* Return the final value of a plt relocation.  */
-static inline Elf32_Addr
-elf_machine_plt_value (struct link_map *map, const Elf32_Rela *reloc,
-		       Elf32_Addr value)
-{
-  return value + reloc->r_addend;
-}
-
-#endif /* dl_machine_h */
-
-#ifdef RESOLVE
-
-/* Do the actual processing of a reloc, once its target address
-   has been determined.  */
-extern void __process_machine_rela (struct link_map *map,
-				    const Elf32_Rela *reloc,
-				    const Elf32_Sym *sym,
-				    const Elf32_Sym *refsym,
-				    Elf32_Addr *const reloc_addr,
-				    Elf32_Addr finaladdr,
-				    int rinfo);
-
-/* Perform the relocation specified by RELOC and SYM (which is fully resolved).
-   LOADADDR is the load address of the object; INFO is an array indexed
-   by DT_* of the .dynamic section info.  */
-
-inline void
-elf_machine_rela (struct link_map *map, const Elf32_Rela *reloc,
-		  const Elf32_Sym *sym, const struct r_found_version *version,
-		  Elf32_Addr *const reloc_addr)
-{
-  const Elf32_Sym *const refsym = sym;
-  Elf32_Word finaladdr;
-  const int rinfo = ELF32_R_TYPE (reloc->r_info);
-
-#ifndef RESOLVE_CONFLICT_FIND_MAP
-  if (__builtin_expect (rinfo == R_PPC_NONE, 0))
-    return;
-
-  /* The condition on the next two lines is a hack around a bug in Solaris
-     tools on Sparc.  It's not clear whether it should really be here at all,
-     but if not the binutils need to be changed.  */
-  if (rinfo == R_PPC_RELATIVE
-      || (sym->st_shndx != SHN_UNDEF
-	  && ELF32_ST_BIND (sym->st_info) == STB_LOCAL))
-    {
-      /* Has already been relocated.  */
-      Elf32_Word loadbase = map->l_addr;
-      finaladdr = loadbase + reloc->r_addend;
-    }
-  else
-    {
-      Elf32_Word loadbase
-	= (Elf32_Word) (char *) (RESOLVE (&sym, version,
-					  ELF32_R_TYPE(reloc->r_info)));
-      if (sym == NULL)
-	{
-	  /* Weak symbol that wasn't actually defined anywhere.  */
-	  assert (loadbase == 0);
-	  finaladdr = reloc->r_addend;
-	}
-      else
-	finaladdr = (loadbase + (Elf32_Word) (char *) sym->st_value
-		     + reloc->r_addend);
-    }
-#else
-  finaladdr = reloc->r_addend;
-  if (rinfo == R_PPC_JMP_SLOT)
-    RESOLVE_CONFLICT_FIND_MAP (map, reloc_addr);
-#endif
-
-  /* A small amount of code is duplicated here for speed.  In libc,
-     more than 90% of the relocs are R_PPC_RELATIVE; in the X11 shared
-     libraries, 60% are R_PPC_RELATIVE, 24% are R_PPC_GLOB_DAT or
-     R_PPC_ADDR32, and 16% are R_PPC_JMP_SLOT (which this routine
-     wouldn't usually handle).  As an bonus, doing this here allows
-     the switch statement in __process_machine_rela to work.  */
-  if (rinfo == R_PPC_RELATIVE
-      || rinfo == R_PPC_GLOB_DAT
-      || rinfo == R_PPC_ADDR32)
-    {
-      *reloc_addr = finaladdr;
-    }
-  else
-    __process_machine_rela (map, reloc, sym, refsym,
-			    reloc_addr, finaladdr, rinfo);
-}
-
-static inline void
-elf_machine_rela_relative (Elf32_Addr l_addr, const Elf32_Rela *reloc,
-			   Elf32_Addr *const reloc_addr)
-{
-  *reloc_addr = l_addr + reloc->r_addend;
-}
-
-/* The SVR4 ABI specifies that the JMPREL relocs must be inside the
-   DT_RELA table.  */
-#define ELF_MACHINE_PLTREL_OVERLAP 1
-
-#endif /* RESOLVE */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/dl-start.S ../glibc-2.3/sysdeps/powerpc/dl-start.S
--- glibc-2.2.93/sysdeps/powerpc/dl-start.S	Sat Feb  2 19:14:54 2002
+++ ../glibc-2.3/sysdeps/powerpc/dl-start.S	Wed Dec 31 19:00:00 1969
@@ -1,105 +0,0 @@
-/* Machine-dependent ELF startup code.  PowerPC version.
-   Copyright (C) 1995-2000, 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-
-/* Initial entry point code for the dynamic linker.
-   The C function `_dl_start' is the real entry point;
-   its return value is the user program's entry point.	*/
-ENTRY(_start)
-/* We start with the following on the stack, from top:
-   argc (4 bytes);
-   arguments for program (terminated by NULL);
-   environment variables (terminated by NULL);
-   arguments for the program loader. */
-
-/* Call _dl_start with one parameter pointing at argc */
-	mr	r3,r1
-/* (we have to frob the stack pointer a bit to allow room for
-   _dl_start to save the link register).  */
-	li	r4,0
-	addi	r1,r1,-16
-	stw	r4,0(r1)
-	bl	_dl_start@local
-
-	/* FALLTHRU */
-ENTRY(_dl_start_user)
-/* Now, we do our main work of calling initialisation procedures.
-   The ELF ABI doesn't say anything about parameters for these,
-   so we just pass argc, argv, and the environment.
-   Changing these is strongly discouraged (not least because argc is
-   passed by value!).  */
-
-/*  Put our GOT pointer in r31, */
-	bl	_GLOBAL_OFFSET_TABLE_-4@local
-	mflr	r31
-/*  the address of _start in r30, */
-	mr	r30,r3
-/*  &_dl_argc in 29, &_dl_argv in 27, and _dl_loaded in 28.  */
-	lwz	r28,_rtld_global@got(r31)
-	lwz	r29,_dl_argc@got(r31)
-	lwz	r27,_dl_argv@got(r31)
-
-/* Call _dl_init (_dl_loaded, _dl_argc, _dl_argv, _dl_argv+_dl_argc+1). */
-	lwz	r3,0(r28)
-	lwz	r4,0(r29)
-	lwz	r5,0(r27)
-	slwi	r6,r4,2
-	add	r6,r5,r6
-	addi	r6,r6,4
-	bl	_dl_init_internal@local
-
-/* Now, to conform to the ELF ABI, we have to: */
-/* Pass argc (actually _dl_argc) in r3; */
-	lwz	r3,0(r29)
-/* pass argv (actually _dl_argv) in r4; */
-	lwz	r4,0(r27)
-/* pass envp (actually _dl_argv+_dl_argc+1) in r5; */
-	slwi	r5,r3,2
-	add	r6,r4,r5
-	addi	r5,r6,4
-/* pass the auxilary vector in r6. This is passed to us just after _envp.  */
-2:	lwzu	r0,4(r6)
-	cmpwi	r0,0
-	bne	2b
-	addi	r6,r6,4
-/* Pass a termination function pointer (in this case _dl_fini) in r7.  */
-	lwz	r7,_dl_fini@got(r31)
-/* Now, call the start function in r30... */
-	mtctr	r30
-	lwz	r26,_dl_starting_up@got(r31)
-/* Pass the stack pointer in r1 (so far so good), pointing to a NULL value.
-   (This lets our startup code distinguish between a program linked statically,
-   which linux will call with argc on top of the stack which will hopefully
-   never be zero, and a dynamically linked program which will always have
-   a NULL on the top of the stack).
-   Take the opportunity to clear LR, so anyone who accidentally returns
-   from _start gets SEGV.  Also clear the next few words of the stack.  */
-
-	li	r31,0
-	stw	r31,0(r1)
-	mtlr	r31
-	stw	r31,4(r1)
-	stw	r31,8(r1)
-	stw	r31,12(r1)
-/* Clear _dl_starting_up.  */
-	stw	r31,0(r26)
-/* Go do it!  */
-	bctr
-END(_start)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/elf/bzero.S ../glibc-2.3/sysdeps/powerpc/elf/bzero.S
--- glibc-2.2.93/sysdeps/powerpc/elf/bzero.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/elf/bzero.S	Wed Dec 31 19:00:00 1969
@@ -1,37 +0,0 @@
-/* Optimized bzero `implementation' for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-
-ENTRY (BP_SYM (__bzero))
-
-#if __BOUNDED_POINTERS__
-	mr	r6,r4
-	li	r5,0
-	mr	r4,r3
-	/* Tell memset that we don't want a return value.  */
-	li	r3,0
-#else
-	mr	r5,r4
-	li	r4,0
-#endif
-	b	BP_SYM (memset)@local
-END (BP_SYM (__bzero))
-weak_alias (BP_SYM (__bzero), BP_SYM (bzero))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/elf/start.S ../glibc-2.3/sysdeps/powerpc/elf/start.S
--- glibc-2.2.93/sysdeps/powerpc/elf/start.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/elf/start.S	Wed Dec 31 19:00:00 1969
@@ -1,57 +0,0 @@
-/* Startup code for programs linked with GNU libc.
-   Copyright (C) 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include "bp-sym.h"
-
- /* These are the various addresses we require.  */
-	.section ".rodata"
-	.align	2
-	weak_extern(_init)
-	weak_extern(_fini)
-L(start_addresses):
-	.long	_SDA_BASE_
-	.long	JUMPTARGET(BP_SYM (main))
-	.long 	JUMPTARGET(_init)
-	.long 	JUMPTARGET(_fini)
-	ASM_SIZE_DIRECTIVE(L(start_addresses))
-
-	.section ".text"
-ENTRY(_start)
- /* Save the stack pointer, in case we're statically linked under Linux.  */
-	mr	r9,r1
- /* Set up an initial stack frame, and clear the LR.  */
-	clrrwi	r1,r1,4
-	li	r0,0
-	stwu	r1,-16(r1)
-	mtlr	r0
-	stw	r0,0(r1)
- /* Set r13 to point at the 'small data area', and put the address of
-    start_addresses in r8...  */
-	lis	r8,L(start_addresses)@ha
-	lwzu	r13,L(start_addresses)@l(r8)
- /* and continue in libc-start, in glibc.  */
-	b	JUMPTARGET(BP_SYM (__libc_start_main))
-END(_start)
-
-/* Define a symbol for the first piece of initialized data.  */
-	.section ".data"
-	.globl	__data_start
-__data_start:
-weak_alias (__data_start, data_start)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/Makefile ../glibc-2.3/sysdeps/powerpc/fpu/Makefile
--- glibc-2.2.93/sysdeps/powerpc/fpu/Makefile	Thu Dec  6 18:57:30 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/Makefile	Thu Sep  5 19:27:54 2002
@@ -1,6 +1,3 @@
 ifeq ($(subdir),math)
 libm-support += fenv_const fe_nomask t_sqrt
 endif
-ifeq ($(subdir),misc)
-sysdep_routines += fprsave fprrest
-endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/__longjmp.S ../glibc-2.3/sysdeps/powerpc/fpu/__longjmp.S
--- glibc-2.2.93/sysdeps/powerpc/fpu/__longjmp.S	Wed Dec  5 19:12:11 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/__longjmp.S	Wed Dec 31 19:00:00 1969
@@ -1,74 +0,0 @@
-/* longjmp for PowerPC.
-   Copyright (C) 1995, 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#define _ASM
-#define _SETJMP_H
-#include <bits/setjmp.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-ENTRY (BP_SYM (__longjmp))
-	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
-
-	lwz r1,(JB_GPR1*4)(r3)
-	lwz r2,(JB_GPR2*4)(r3)
-	lwz r0,(JB_LR*4)(r3)
-	lwz r14,((JB_GPRS+0)*4)(r3)
-	lfd fp14,((JB_FPRS+0*2)*4)(r3)
-	lwz r15,((JB_GPRS+1)*4)(r3)
-	lfd fp15,((JB_FPRS+1*2)*4)(r3)
-	lwz r16,((JB_GPRS+2)*4)(r3)
-	lfd fp16,((JB_FPRS+2*2)*4)(r3)
-	lwz r17,((JB_GPRS+3)*4)(r3)
-	lfd fp17,((JB_FPRS+3*2)*4)(r3)
-	lwz r18,((JB_GPRS+4)*4)(r3)
-	lfd fp18,((JB_FPRS+4*2)*4)(r3)
-	lwz r19,((JB_GPRS+5)*4)(r3)
-	lfd fp19,((JB_FPRS+5*2)*4)(r3)
-	lwz r20,((JB_GPRS+6)*4)(r3)
-	lfd fp20,((JB_FPRS+6*2)*4)(r3)
-	mtlr r0
-	lwz r21,((JB_GPRS+7)*4)(r3)
-	lfd fp21,((JB_FPRS+7*2)*4)(r3)
-	lwz r22,((JB_GPRS+8)*4)(r3)
-	lfd fp22,((JB_FPRS+8*2)*4)(r3)
-	lwz r0,(JB_CR*4)(r3)
-	lwz r23,((JB_GPRS+9)*4)(r3)
-	lfd fp23,((JB_FPRS+9*2)*4)(r3)
-	lwz r24,((JB_GPRS+10)*4)(r3)
-	lfd fp24,((JB_FPRS+10*2)*4)(r3)
-	lwz r25,((JB_GPRS+11)*4)(r3)
-	lfd fp25,((JB_FPRS+11*2)*4)(r3)
-	mtcrf 0xFF,r0
-	lwz r26,((JB_GPRS+12)*4)(r3)
-	lfd fp26,((JB_FPRS+12*2)*4)(r3)
-	lwz r27,((JB_GPRS+13)*4)(r3)
-	lfd fp27,((JB_FPRS+13*2)*4)(r3)
-	lwz r28,((JB_GPRS+14)*4)(r3)
-	lfd fp28,((JB_FPRS+14*2)*4)(r3)
-	lwz r29,((JB_GPRS+15)*4)(r3)
-	lfd fp29,((JB_FPRS+15*2)*4)(r3)
-	lwz r30,((JB_GPRS+16)*4)(r3)
-	lfd fp30,((JB_FPRS+16*2)*4)(r3)
-	lwz r31,((JB_GPRS+17)*4)(r3)
-	lfd fp31,((JB_FPRS+17*2)*4)(r3)
-	mr r3,r4
-	blr
-END (BP_SYM (__longjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/fesetenv.c ../glibc-2.3/sysdeps/powerpc/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/powerpc/fpu/fesetenv.c	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/fesetenv.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -35,4 +35,5 @@
 compat_symbol (libm, BP_SYM (__old_fesetenv), BP_SYM (fesetenv), GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__fesetenv, fesetenv)
 versioned_symbol (libm, BP_SYM (__fesetenv), BP_SYM (fesetenv), GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/fprrest.S ../glibc-2.3/sysdeps/powerpc/fpu/fprrest.S
--- glibc-2.2.93/sysdeps/powerpc/fpu/fprrest.S	Thu Dec  6 18:41:33 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/fprrest.S	Wed Dec 31 19:00:00 1969
@@ -1,94 +0,0 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/*
-    Floating Point Registers (FPRs) restore routine
-*/
-
-#include <sysdep.h>
-
-ENTRY(_restfpr_all)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf14)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_14)
-C_TEXT(_restf14):
-C_TEXT(_restfpr_14):	lfd	fp14,-144(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf15)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_15)
-C_TEXT(_restf15):
-C_TEXT(_restfpr_15):	lfd	fp15,-136(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf16)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_16)
-C_TEXT(_restf16):
-C_TEXT(_restfpr_16):	lfd	fp16,-128(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf17)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_17)
-C_TEXT(_restf17):
-C_TEXT(_restfpr_17):	lfd	fp17,-120(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf18)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_18)
-C_TEXT(_restf18):
-C_TEXT(_restfpr_18):	lfd	fp18,-112(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf19)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_19)
-C_TEXT(_restf19):
-C_TEXT(_restfpr_19):	lfd	fp19,-104(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf20)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_20)
-C_TEXT(_restf20):
-C_TEXT(_restfpr_20):	lfd	fp20,-96(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf21)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_21)
-C_TEXT(_restf21):
-C_TEXT(_restfpr_21):	lfd	fp21,-88(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf22)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_22)
-C_TEXT(_restf22):
-C_TEXT(_restfpr_22):	lfd	fp22,-80(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf23)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_23)
-C_TEXT(_restf23):
-C_TEXT(_restfpr_23):	lfd	fp23,-72(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf24)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_24)
-C_TEXT(_restf24):
-C_TEXT(_restfpr_24):	lfd	fp24,-64(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf25)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_25)
-C_TEXT(_restf25):
-C_TEXT(_restfpr_25):	lfd	fp25,-56(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf26)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_26)
-C_TEXT(_restf26):
-C_TEXT(_restfpr_26):	lfd	fp26,-48(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf27)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_27)
-C_TEXT(_restf27):
-C_TEXT(_restfpr_27):	lfd	fp27,-40(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf28)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_28)
-C_TEXT(_restf28):
-C_TEXT(_restfpr_28):	lfd	fp28,-32(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf29)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_29)
-C_TEXT(_restf29):
-C_TEXT(_restfpr_29):	lwz	r0,8(r1)	#get return address from frame
-			lfd	fp29,-24(r1)    #restore f29
-			mtlr	r0		#move return address to LR
-			lfd	fp30,-16(r1)	#restore f30
-			lfd	fp31,-8(r1)	#restore f31
-			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/fprsave.S ../glibc-2.3/sysdeps/powerpc/fpu/fprsave.S
--- glibc-2.2.93/sysdeps/powerpc/fpu/fprsave.S	Thu Dec  6 18:41:33 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/fprsave.S	Wed Dec 31 19:00:00 1969
@@ -1,93 +0,0 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/*
-    Floating Point Registers (FPRs) save routine
-*/
-
-#include <sysdep.h>
-
-ENTRY(_savefpr_all)
-                ASM_GLOBAL_DIRECTIVE C_TEXT(_savef14)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_14)
-C_TEXT(_savef14):
-C_TEXT(_savefpr_14):	stfd	fp14,-144(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef15)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_15)
-C_TEXT(_savef15):
-C_TEXT(_savefpr_15):	stfd	fp15,-136(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef16)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_16)
-C_TEXT(_savef16):
-C_TEXT(_savefpr_16):	stfd	fp16,-128(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef17)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_17)
-C_TEXT(_savef17):
-C_TEXT(_savefpr_17):	stfd	fp17,-120(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef18)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_18)
-C_TEXT(_savef18):
-C_TEXT(_savefpr_18):	stfd	fp18,-112(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef19)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_19)
-C_TEXT(_savef19):
-C_TEXT(_savefpr_19):	stfd	fp19,-104(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef20)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_20)
-C_TEXT(_savef20):
-C_TEXT(_savefpr_20):	stfd	fp20,-96(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef21)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_21)
-C_TEXT(_savef21):
-C_TEXT(_savefpr_21):	stfd	fp21,-88(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef22)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_22)
-C_TEXT(_savef22):
-C_TEXT(_savefpr_22):	stfd	fp22,-80(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef23)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_23)
-C_TEXT(_savef23):
-C_TEXT(_savefpr_23):	stfd	fp23,-72(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef24)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_24)
-C_TEXT(_savef24):
-C_TEXT(_savefpr_24):	stfd	fp24,-64(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef25)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_25)
-C_TEXT(_savef25):
-C_TEXT(_savefpr_25):	stfd	fp25,-56(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef26)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_26)
-C_TEXT(_savef26):
-C_TEXT(_savefpr_26):	stfd	fp26,-48(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef27)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_27)
-C_TEXT(_savef27):
-C_TEXT(_savefpr_27):	stfd	fp27,-40(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef28)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_28)
-C_TEXT(_savef28):
-C_TEXT(_savefpr_28):	stfd	fp28,-32(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef29)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_29)
-C_TEXT(_savef29):
-C_TEXT(_savefpr_29):	stfd	fp29,-24(r1)	#save f29
-			stfd	fp30,-16(r1)	#save f30
-			stfd	fp31,-8(r1)	#save f31
-			stw	r0,8(r1)	#save LR in callers frame
-			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/powerpc/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/powerpc/fpu/fraiseexcpt.c	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/fraiseexcpt.c	Sat Sep 14 09:40:53 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997,99,2000,01 Free Software Foundation, Inc.
+   Copyright (C) 1997,99,2000,01,02 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -62,4 +62,5 @@
 compat_symbol (libm, BP_SYM (__old_feraiseexcept), BP_SYM (feraiseexcept), GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__feraiseexcept, feraiseexcept)
 versioned_symbol (libm, BP_SYM (__feraiseexcept), BP_SYM (feraiseexcept), GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/s_copysign.S ../glibc-2.3/sysdeps/powerpc/fpu/s_copysign.S
--- glibc-2.2.93/sysdeps/powerpc/fpu/s_copysign.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/s_copysign.S	Wed Dec 31 19:00:00 1969
@@ -1,50 +0,0 @@
-/* Copy a sign bit between floating-point values.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/* This has been coded in assembler because GCC makes such a mess of it
-   when it's coded in C.  */
-
-#include <sysdep.h>
-
-ENTRY(__copysign)
-/* double [f1] copysign (double [f1] x, double [f2] y);
-   copysign(x,y) returns a value with the magnitude of x and
-   with the sign bit of y.  */
-	stwu	r1,-16(r1)
-	stfd	fp2,8(r1)
-	lwz	r3,8(r1)
-	cmpwi   r3,0
-	addi    r1,r1,16
-	blt     L(0)
-	fabs    fp1,fp1
-	blr
-L(0):	fnabs   fp1,fp1
-	blr
-	END (__copysign)
-
-weak_alias(__copysign,copysign)
-
-/* It turns out that it's safe to use this code even for single-precision.  */
-weak_alias(__copysign,copysignf)
-strong_alias(__copysign,__copysignf)
-
-#ifdef NO_LONG_DOUBLE
-weak_alias(__copysign,copysignl)
-strong_alias(__copysign,__copysignl)
-#endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/s_copysignf.S ../glibc-2.3/sysdeps/powerpc/fpu/s_copysignf.S
--- glibc-2.2.93/sysdeps/powerpc/fpu/s_copysignf.S	Thu Aug 28 20:50:36 1997
+++ ../glibc-2.3/sysdeps/powerpc/fpu/s_copysignf.S	Wed Dec 31 19:00:00 1969
@@ -1 +0,0 @@
-/* __copysignf is in s_copysign.S  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/s_isnan.c ../glibc-2.3/sysdeps/powerpc/fpu/s_isnan.c
--- glibc-2.2.93/sysdeps/powerpc/fpu/s_isnan.c	Sun Apr 14 05:38:24 2002
+++ ../glibc-2.3/sysdeps/powerpc/fpu/s_isnan.c	Sat Sep 14 09:40:53 2002
@@ -20,10 +20,21 @@
 /* Ugly kludge to avoid declarations.  */
 #define __isnanf __Xisnanf
 #define isnanf Xisnanf
+#define __GI___isnanf __GI___Xisnanf
 
 #include "math.h"
 #include <fenv_libc.h>
 
+#undef __isnanf
+#undef isnanf
+#undef __GI___isnanf
+
+
+/* The hidden_proto in include/math.h was obscured by the macro hackery.  */
+__typeof (__isnan) __isnanf;
+hidden_proto (__isnanf)
+
+
 int
 __isnan (x)
      double x;
@@ -36,19 +47,17 @@
   fesetenv_register (savedstate);
   return result;
 }
-INTDEF(__isnan)
+hidden_def (__isnan)
 weak_alias (__isnan, isnan)
 
+
 /* It turns out that the 'double' version will also always work for
    single-precision.  */
-#undef __isnanf
-#undef isnanf
 strong_alias (__isnan, __isnanf)
-INTDEF(__isnanf)
+hidden_def (__isnanf)
 weak_alias (__isnanf, isnanf)
 
 #ifdef NO_LONG_DOUBLE
 strong_alias (__isnan, __isnanl)
-INTDEF(__isnanl)
 weak_alias (__isnan, isnanl)
 #endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/fpu/setjmp.S ../glibc-2.3/sysdeps/powerpc/fpu/setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/fpu/setjmp.S	Wed Dec  5 19:12:11 2001
+++ ../glibc-2.3/sysdeps/powerpc/fpu/setjmp.S	Wed Dec 31 19:00:00 1969
@@ -1,73 +0,0 @@
-/* setjmp for PowerPC.
-   Copyright (C) 1995, 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#define _ASM
-#define _SETJMP_H
-#include <bits/setjmp.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-ENTRY (BP_SYM (__sigsetjmp))
-	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
-
-	stw  r1,(JB_GPR1*4)(3)
-	mflr r0
-	stw  r2,(JB_GPR2*4)(3)
-	stw  r14,((JB_GPRS+0)*4)(3)
-	stfd fp14,((JB_FPRS+0*2)*4)(3)
-	stw  r0,(JB_LR*4)(3)
-	stw  r15,((JB_GPRS+1)*4)(3)
-	stfd fp15,((JB_FPRS+1*2)*4)(3)
-	mfcr r0
-	stw  r16,((JB_GPRS+2)*4)(3)
-	stfd fp16,((JB_FPRS+2*2)*4)(3)
-	stw  r0,(JB_CR*4)(3)
-	stw  r17,((JB_GPRS+3)*4)(3)
-	stfd fp17,((JB_FPRS+3*2)*4)(3)
-	stw  r18,((JB_GPRS+4)*4)(3)
-	stfd fp18,((JB_FPRS+4*2)*4)(3)
-	stw  r19,((JB_GPRS+5)*4)(3)
-	stfd fp19,((JB_FPRS+5*2)*4)(3)
-	stw  r20,((JB_GPRS+6)*4)(3)
-	stfd fp20,((JB_FPRS+6*2)*4)(3)
-	stw  r21,((JB_GPRS+7)*4)(3)
-	stfd fp21,((JB_FPRS+7*2)*4)(3)
-	stw  r22,((JB_GPRS+8)*4)(3)
-	stfd fp22,((JB_FPRS+8*2)*4)(3)
-	stw  r23,((JB_GPRS+9)*4)(3)
-	stfd fp23,((JB_FPRS+9*2)*4)(3)
-	stw  r24,((JB_GPRS+10)*4)(3)
-	stfd fp24,((JB_FPRS+10*2)*4)(3)
-	stw  r25,((JB_GPRS+11)*4)(3)
-	stfd fp25,((JB_FPRS+11*2)*4)(3)
-	stw  r26,((JB_GPRS+12)*4)(3)
-	stfd fp26,((JB_FPRS+12*2)*4)(3)
-	stw  r27,((JB_GPRS+13)*4)(3)
-	stfd fp27,((JB_FPRS+13*2)*4)(3)
-	stw  r28,((JB_GPRS+14)*4)(3)
-	stfd fp28,((JB_FPRS+14*2)*4)(3)
-	stw  r29,((JB_GPRS+15)*4)(3)
-	stfd fp29,((JB_FPRS+15*2)*4)(3)
-	stw  r30,((JB_GPRS+16)*4)(3)
-	stfd fp30,((JB_FPRS+16*2)*4)(3)
-	stw  r31,((JB_GPRS+17)*4)(3)
-	stfd fp31,((JB_FPRS+17*2)*4)(3)
-	b JUMPTARGET (BP_SYM (__sigjmp_save))
-END (BP_SYM (__sigsetjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/gprrest0.S ../glibc-2.3/sysdeps/powerpc/gprrest0.S
--- glibc-2.2.93/sysdeps/powerpc/gprrest0.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/gprrest0.S	Wed Dec 31 19:00:00 1969
@@ -1,69 +0,0 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/*
-    General Purpose Register (GPR) restore routine
-    when Floating Point Registers (FPRs) are not saved
-
-    Note: This restore routine must not be called when GPR30 or
-    GPR31, or both, are the only registers beings saved. In these
-    cases, the saving and restoring must be done inline.
-*/
-
-#include <sysdep.h>
-
-ENTRY(_restgpr0_all)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_13)
-C_TEXT(_restgpr0_13):	lwz	r13,-76(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_14)
-C_TEXT(_restgpr0_14):	lwz	r14,-72(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_15)
-C_TEXT(_restgpr0_15):	lwz	r15,-68(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_16)
-C_TEXT(_restgpr0_16):	lwz	r16,-64(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_17)
-C_TEXT(_restgpr0_17):	lwz	r17,-60(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_18)
-C_TEXT(_restgpr0_18):	lwz	r18,-56(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_19)
-C_TEXT(_restgpr0_19):	lwz	r19,-52(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_20)
-C_TEXT(_restgpr0_20):	lwz	r20,-48(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_21)
-C_TEXT(_restgpr0_21):	lwz	r21,-44(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_22)
-C_TEXT(_restgpr0_22):	lwz	r22,-40(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_23)
-C_TEXT(_restgpr0_23):	lwz	r23,-36(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_24)
-C_TEXT(_restgpr0_24):	lwz	r24,-32(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_25)
-C_TEXT(_restgpr0_25):	lwz	r25,-28(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_26)
-C_TEXT(_restgpr0_26):	lwz	r26,-24(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_27)
-C_TEXT(_restgpr0_27):	lwz	r27,-20(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_28)
-C_TEXT(_restgpr0_28):	lwz	r28,-16(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_29)
-C_TEXT(_restgpr0_29):	lwz	r0,8(r1)	#get return address from frame
-			lwz	r29,-12(r1)	#restore r29
-			mtlr	r0		#move return address to LR
-			lwz	r30,-8(r1)	#restore r30
-			lwz	r31,-4(r1)	#restore r31
-			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/gprrest1.S ../glibc-2.3/sysdeps/powerpc/gprrest1.S
--- glibc-2.2.93/sysdeps/powerpc/gprrest1.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/gprrest1.S	Wed Dec 31 19:00:00 1969
@@ -1,63 +0,0 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/*
-    General Purpose Register (GPR) restore routine
-    when Floating Point Registers (FPRs) are saved
-*/
-
-#include <sysdep.h>
-
-ENTRY(_restgpr1_all)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_13)
-C_TEXT(_restgpr1_13):	lwz	r13,-76(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_14)
-C_TEXT(_restgpr1_14):	lwz	r14,-72(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_15)
-C_TEXT(_restgpr1_15):	lwz	r15,-68(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_16)
-C_TEXT(_restgpr1_16):	lwz	r16,-64(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_17)
-C_TEXT(_restgpr1_17):	lwz	r17,-60(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_18)
-C_TEXT(_restgpr1_18):	lwz	r18,-56(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_19)
-C_TEXT(_restgpr1_19):	lwz	r19,-52(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_20)
-C_TEXT(_restgpr1_20):	lwz	r20,-48(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_21)
-C_TEXT(_restgpr1_21):	lwz	r21,-44(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_22)
-C_TEXT(_restgpr1_22):	lwz	r22,-40(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_23)
-C_TEXT(_restgpr1_23):	lwz	r23,-36(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_24)
-C_TEXT(_restgpr1_24):	lwz	r24,-32(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_25)
-C_TEXT(_restgpr1_25):	lwz	r25,-28(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_26)
-C_TEXT(_restgpr1_26):	lwz	r26,-24(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_27)
-C_TEXT(_restgpr1_27):	lwz	r27,-20(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_28)
-C_TEXT(_restgpr1_28):	lwz	r28,-16(r12)
-		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_29)
-C_TEXT(_restgpr1_29):	lwz	r29,-12(r12)	#restore r29
-			lwz	r30,-8(r12)	#restore r30
-			lwz	r31,-4(r12)	#restore r31
-			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/gprsave0.S ../glibc-2.3/sysdeps/powerpc/gprsave0.S
--- glibc-2.2.93/sysdeps/powerpc/gprsave0.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/gprsave0.S	Wed Dec 31 19:00:00 1969
@@ -1,68 +0,0 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/*
-    General Purpose Register (GPR) save routine
-    when Floating Point Registers (FPRs) are not saved
-
-    Note: This save routine must not be called when GPR30 or
-    GPR31, or both, are the only registers beings saved. In these
-    cases, the saving and restoring must be done inline.
-*/
-
-#include <sysdep.h>
-
-ENTRY(_savegpr0_all)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_13)
-C_TEXT(_savegpr0_13):	stw	r13,-76(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_14)
-C_TEXT(_savegpr0_14):	stw	r14,-72(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_15)
-C_TEXT(_savegpr0_15):	stw	r15,-68(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_16)
-C_TEXT(_savegpr0_16):	stw	r16,-64(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_17)
-C_TEXT(_savegpr0_17):	stw	r17,-60(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_18)
-C_TEXT(_savegpr0_18):	stw	r18,-56(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_19)
-C_TEXT(_savegpr0_19):	stw	r19,-52(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_20)
-C_TEXT(_savegpr0_20):	stw	r20,-48(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_21)
-C_TEXT(_savegpr0_21):	stw	r21,-44(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_22)
-C_TEXT(_savegpr0_22):	stw	r22,-40(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_23)
-C_TEXT(_savegpr0_23):	stw	r23,-36(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_24)
-C_TEXT(_savegpr0_24):	stw	r24,-32(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_25)
-C_TEXT(_savegpr0_25):	stw	r25,-28(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_26)
-C_TEXT(_savegpr0_26):	stw	r26,-24(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_27)
-C_TEXT(_savegpr0_27):	stw	r27,-20(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_28)
-C_TEXT(_savegpr0_28):	stw	r28,-16(r1)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_29)
-C_TEXT(_savegpr0_29):	stw	r29,-12(r1) #save r29
-			stw	r30,-8(r1)  #save r30
-			stw	r31,-4(r1)  #save r31
-			stw	r0,8(r1)    #save LR in callers frame
-			blr		    #return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/gprsave1.S ../glibc-2.3/sysdeps/powerpc/gprsave1.S
--- glibc-2.2.93/sysdeps/powerpc/gprsave1.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/gprsave1.S	Wed Dec 31 19:00:00 1969
@@ -1,63 +0,0 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/*
-    General Purpose Register (GPR) save routine
-    when Floating Point Registers (FPRs) are saved
-*/
-
-#include <sysdep.h>
-
-ENTRY(_savegpr1_all)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_13)
-C_TEXT(_savegpr1_13):	stw	r13,-76(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_14)
-C_TEXT(_savegpr1_14):	stw	r14,-72(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_15)
-C_TEXT(_savegpr1_15):	stw	r15,-68(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_16)
-C_TEXT(_savegpr1_16):	stw	r16,-64(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_17)
-C_TEXT(_savegpr1_17):	stw	r17,-60(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_18)
-C_TEXT(_savegpr1_18):	stw	r18,-56(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_19)
-C_TEXT(_savegpr1_19):	stw	r19,-52(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_20)
-C_TEXT(_savegpr1_20):	stw	r20,-48(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_21)
-C_TEXT(_savegpr1_21):	stw	r21,-44(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_22)
-C_TEXT(_savegpr1_22):	stw	r22,-40(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_23)
-C_TEXT(_savegpr1_23):	stw	r23,-36(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_24)
-C_TEXT(_savegpr1_24):	stw	r24,-32(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_25)
-C_TEXT(_savegpr1_25):	stw	r25,-28(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_26)
-C_TEXT(_savegpr1_26):	stw	r26,-24(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_27)
-C_TEXT(_savegpr1_27):	stw	r27,-20(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_28)
-C_TEXT(_savegpr1_28):	stw	r28,-16(r12)
-		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_29)
-C_TEXT(_savegpr1_29):	stw	r29,-12(r12)	#save r29
-			stw	r30,-8(r12)	#save r30
-			stw	r31,-4(r12)	#save r31
-			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/libgcc-compat.S ../glibc-2.3/sysdeps/powerpc/libgcc-compat.S
--- glibc-2.2.93/sysdeps/powerpc/libgcc-compat.S	Tue Aug 20 17:26:56 2002
+++ ../glibc-2.3/sysdeps/powerpc/libgcc-compat.S	Wed Dec 31 19:00:00 1969
@@ -1,144 +0,0 @@
-/* pre-.hidden libgcc compatibility
-   Copyright (C) 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-	.file	"libgcc-compat.S"
-
-#include <shlib-compat.h>
-
-#if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_2_6)
-
-#define __ashldi3_v_glibc20	INTUSE (__ashldi3)
-#define __ashrdi3_v_glibc20	INTUSE (__ashrdi3)
-#define __lshrdi3_v_glibc20	INTUSE (__lshrdi3)
-#define __cmpdi2_v_glibc20	INTUSE (__cmpdi2)
-#define __ucmpdi2_v_glibc20	INTUSE (__ucmpdi2)
-#define __fixdfdi_v_glibc20	INTUSE (__fixdfdi)
-#define __fixsfdi_v_glibc20	INTUSE (__fixsfdi)
-#define __fixunsdfdi_v_glibc20	INTUSE (__fixunsdfdi)
-#define __fixunssfdi_v_glibc20	INTUSE (__fixunssfdi)
-#define __floatdidf_v_glibc20	INTUSE (__floatdidf)
-#define __floatdisf_v_glibc20	INTUSE (__floatdisf)
-
-	.symver __ashldi3_v_glibc20,__ashldi3@GLIBC_2.0
-	.symver __ashrdi3_v_glibc20,__ashrdi3@GLIBC_2.0
-	.symver __lshrdi3_v_glibc20,__lshrdi3@GLIBC_2.0
-	.symver __cmpdi2_v_glibc20,__cmpdi2@GLIBC_2.0
-	.symver __ucmpdi2_v_glibc20,__ucmpdi2@GLIBC_2.0
-	.symver __fixdfdi_v_glibc20,__fixdfdi@GLIBC_2.0
-	.symver __fixunsdfdi_v_glibc20,__fixunsdfdi@GLIBC_2.0
-	.symver __fixsfdi_v_glibc20,__fixsfdi@GLIBC_2.0
-	.symver __fixunssfdi_v_glibc20,__fixunssfdi@GLIBC_2.0
-	.symver __floatdidf_v_glibc20,__floatdidf@GLIBC_2.0
-	.symver __floatdisf_v_glibc20,__floatdisf@GLIBC_2.0
-
-#ifdef HAVE_DOT_HIDDEN
-	.hidden __ashldi3
-	.hidden __ashrdi3
-	.hidden __lshrdi3
-	.hidden __cmpdi2
-	.hidden __ucmpdi2
-	.hidden __fixdfdi
-	.hidden __fixsfdi
-	.hidden __fixunsdfdi
-	.hidden __fixunssfdi
-	.hidden __floatdidf
-	.hidden __floatdisf
-#endif
-
-	.section	".text"
-
-	.align 2
-	.globl __ashldi3_v_glibc20
-	.type	__ashldi3_v_glibc20,@function
-__ashldi3_v_glibc20:
-	b __ashldi3@local
-.Lfe5:
-	.size	__ashldi3_v_glibc20,.Lfe5-__ashldi3_v_glibc20
-	.align 2
-	.globl __ashrdi3_v_glibc20
-	.type	__ashrdi3_v_glibc20,@function
-__ashrdi3_v_glibc20:
-	b __ashrdi3@local
-.Lfe6:
-	.size	__ashrdi3_v_glibc20,.Lfe6-__ashrdi3_v_glibc20
-	.align 2
-	.globl __lshrdi3_v_glibc20
-	.type	__lshrdi3_v_glibc20,@function
-__lshrdi3_v_glibc20:
-	b __lshrdi3@local
-.Lfe7:
-	.size	__lshrdi3_v_glibc20,.Lfe7-__lshrdi3_v_glibc20
-	.align 2
-	.globl __cmpdi2_v_glibc20
-	.type	__cmpdi2_v_glibc20,@function
-__cmpdi2_v_glibc20:
-	b __cmpdi2@local
-.Lfe8:
-	.size	__cmpdi2_v_glibc20,.Lfe8-__cmpdi2_v_glibc20
-	.align 2
-	.globl __ucmpdi2_v_glibc20
-	.type	__ucmpdi2_v_glibc20,@function
-__ucmpdi2_v_glibc20:
-	b __ucmpdi2@local
-.Lfe9:
-	.size	__ucmpdi2_v_glibc20,.Lfe9-__ucmpdi2_v_glibc20
-	.align 2
-	.globl __fixdfdi_v_glibc20
-	.type	__fixdfdi_v_glibc20,@function
-__fixdfdi_v_glibc20:
-	b __fixdfdi@local
-.Lfe10:
-	.size	__fixdfdi_v_glibc20,.Lfe10-__fixdfdi_v_glibc20
-	.align 2
-	.globl __fixunsdfdi_v_glibc20
-	.type	__fixunsdfdi_v_glibc20,@function
-__fixunsdfdi_v_glibc20:
-	b __fixunsdfdi@local
-.Lfe11:
-	.size	__fixunsdfdi_v_glibc20,.Lfe11-__fixunsdfdi_v_glibc20
-	.align 2
-	.globl __fixsfdi_v_glibc20
-	.type	__fixsfdi_v_glibc20,@function
-__fixsfdi_v_glibc20:
-	b __fixsfdi@local
-.Lfe12:
-	.size	__fixsfdi_v_glibc20,.Lfe12-__fixsfdi_v_glibc20
-	.align 2
-	.globl __fixunssfdi_v_glibc20
-	.type	__fixunssfdi_v_glibc20,@function
-__fixunssfdi_v_glibc20:
-	b __fixunssfdi@local
-.Lfe13:
-	.size	__fixunssfdi_v_glibc20,.Lfe13-__fixunssfdi_v_glibc20
-	.align 2
-	.globl __floatdidf_v_glibc20
-	.type	__floatdidf_v_glibc20,@function
-__floatdidf_v_glibc20:
-	b __floatdidf@local
-.Lfe14:
-	.size	__floatdidf_v_glibc20,.Lfe14-__floatdidf_v_glibc20
-	.align 2
-	.globl __floatdisf_v_glibc20
-	.type	__floatdisf_v_glibc20,@function
-__floatdisf_v_glibc20:
-	b __floatdisf@local
-.Lfe15:
-	.size	__floatdisf_v_glibc20,.Lfe15-__floatdisf_v_glibc20
-
-#endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/lshift.S ../glibc-2.3/sysdeps/powerpc/lshift.S
--- glibc-2.2.93/sysdeps/powerpc/lshift.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/lshift.S	Wed Dec 31 19:00:00 1969
@@ -1,131 +0,0 @@
-/* Shift a limb left, low level routine.
-   Copyright (C) 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* mp_limb_t mpn_lshift (mp_ptr wp, mp_srcptr up, mp_size_t usize,
-  			 unsigned int cnt)  */
-
-EALIGN (BP_SYM (__mpn_lshift), 3, 0)
-
-#if __BOUNDED_POINTERS__
-	slwi r10,r5,2		/* convert limbs to bytes */
-	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
-#endif
-	mtctr	r5		# copy size into CTR
-	cmplwi	cr0,r5,16	# is size < 16
-	slwi	r0,r5,2
-	add	r7,r3,r0	# make r7 point at end of res
-	add	r4,r4,r0	# make r4 point at end of s1
-	lwzu	r11,-4(r4)	# load first s1 limb
-	subfic	r8,r6,32
-	srw	r3,r11,r8	# compute function return value
-	bge	cr0,L(big)	# branch if size >= 16
-
-	bdz	L(end1)
-
-L(0):	lwzu	r10,-4(r4)
-	slw	r9,r11,r6
-	srw	r12,r10,r8
-	or	r9,r9,r12
-	stwu	r9,-4(r7)
-	bdz	L(end2)
-	lwzu	r11,-4(r4)
-	slw	r9,r10,r6
-	srw	r12,r11,r8
-	or	r9,r9,r12
-	stwu	r9,-4(r7)
-	bdnz	L(0)
-
-L(end1):slw	r0,r11,r6
-	stw	r0,-4(r7)
-	blr
-
-
-/* Guaranteed not to succeed.  */
-L(boom): tweq    r0,r0
-
-/* We imitate a case statement, by using (yuk!) fixed-length code chunks,
-   of size 4*12 bytes.  We have to do this (or something) to make this PIC.  */
-L(big):	mflr    r9
-	bltl-   cr0,L(boom)	# Never taken, only used to set LR.
-	slwi    r10,r6,4
-	mflr    r12
-	add     r10,r12,r10
-	slwi	r8,r6,5
-	add     r10,r8,r10
-	mtctr   r10
-	addi	r5,r5,-1
-	mtlr    r9
-	bctr
-
-L(end2):slw	r0,r10,r6
-	stw	r0,-4(r7)
-	blr
-
-#define DO_LSHIFT(n) \
-	mtctr	r5;							\
-L(n):	lwzu	r10,-4(r4);						\
-	slwi	r9,r11,n;						\
-	inslwi	r9,r10,n,32-n;					\
-	stwu	r9,-4(r7);						\
-	bdz-	L(end2);						\
-	lwzu	r11,-4(r4);						\
-	slwi	r9,r10,n;						\
-	inslwi	r9,r11,n,32-n;					\
-	stwu	r9,-4(r7);						\
-	bdnz	L(n);							\
-	b	L(end1)
-
-	DO_LSHIFT(1)
-	DO_LSHIFT(2)
-	DO_LSHIFT(3)
-	DO_LSHIFT(4)
-	DO_LSHIFT(5)
-	DO_LSHIFT(6)
-	DO_LSHIFT(7)
-	DO_LSHIFT(8)
-	DO_LSHIFT(9)
-	DO_LSHIFT(10)
-	DO_LSHIFT(11)
-	DO_LSHIFT(12)
-	DO_LSHIFT(13)
-	DO_LSHIFT(14)
-	DO_LSHIFT(15)
-	DO_LSHIFT(16)
-	DO_LSHIFT(17)
-	DO_LSHIFT(18)
-	DO_LSHIFT(19)
-	DO_LSHIFT(20)
-	DO_LSHIFT(21)
-	DO_LSHIFT(22)
-	DO_LSHIFT(23)
-	DO_LSHIFT(24)
-	DO_LSHIFT(25)
-	DO_LSHIFT(26)
-	DO_LSHIFT(27)
-	DO_LSHIFT(28)
-	DO_LSHIFT(29)
-	DO_LSHIFT(30)
-	DO_LSHIFT(31)
-
-END (BP_SYM (__mpn_lshift))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/memset.S ../glibc-2.3/sysdeps/powerpc/memset.S
--- glibc-2.2.93/sysdeps/powerpc/memset.S	Fri Aug 23 15:46:49 2002
+++ ../glibc-2.3/sysdeps/powerpc/memset.S	Wed Dec 31 19:00:00 1969
@@ -1,338 +0,0 @@
-/* Optimized memset implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* Define a global static that can hold the cache line size.  The 
-   assumption is that startup code will access the "aux vector" to
-   to obtain the value set by the kernel and store it into this 
-   variable.  */
-   
-	.globl __cache_line_size
-	.section	".data","aw"
-	.align 2
-	.type	 __cache_line_size,@object
-	.size	 __cache_line_size,4
-__cache_line_size:
-	.long 0
-	.section	".text"
-/* __ptr_t [r3] memset (__ptr_t s [r3], int c [r4], size_t n [r5]));
-   Returns 's'.
-
-   The memset is done in four sizes: byte (8 bits), word (32 bits),
-   32-byte blocks (256 bits) and __cache_line_size (128, 256, 1024 bits).
-   There is a special case for setting whole cache lines to 0, which 
-   takes advantage of the dcbz instruction.  */
-
-EALIGN (BP_SYM (memset), 5, 1)
-
-#define rTMP	r0
-#define rRTN	r3	/* initial value of 1st argument */
-#if __BOUNDED_POINTERS__
-# define rMEMP0	r4	/* original value of 1st arg */
-# define rCHR	r5	/* char to set in each byte */
-# define rLEN	r6	/* length of region to set */
-# define rMEMP	r10	/* address at which we are storing */
-#else
-# define rMEMP0	r3	/* original value of 1st arg */
-# define rCHR	r4	/* char to set in each byte */
-# define rLEN	r5	/* length of region to set */
-# define rMEMP	r6	/* address at which we are storing */
-#endif
-#define rALIGN	r7	/* number of bytes we are setting now (when aligning) */
-#define rMEMP2	r8
-
-#define rPOS32	r7	/* constant +32 for clearing with dcbz */
-#define rNEG64	r8	/* constant -64 for clearing with dcbz */
-#define rNEG32	r9	/* constant -32 for clearing with dcbz */
-
-#define rGOT	r9	/* Address of the Global Offset Table.  */
-#define rCLS	r8	/* Cache line size obtained from static.  */
-#define rCLM	r9	/* Cache line size mask to check for cache alignment.  */
-
-#if __BOUNDED_POINTERS__
-	cmplwi	cr1, rRTN, 0
-	CHECK_BOUNDS_BOTH_WIDE (rMEMP0, rTMP, rTMP2, rLEN)
-	beq	cr1, L(b0)
-	STORE_RETURN_VALUE (rMEMP0)
-	STORE_RETURN_BOUNDS (rTMP, rTMP2)
-L(b0):
-#endif
-
-/* take care of case for size <= 4  */
-	cmplwi	cr1, rLEN, 4
-	andi.	rALIGN, rMEMP0, 3
-	mr	rMEMP, rMEMP0
-	ble-	cr1, L(small)
-/* align to word boundary  */
-	cmplwi	cr5, rLEN, 31
-	rlwimi	rCHR, rCHR, 8, 16, 23
-	beq+	L(aligned)	/* 8th instruction from .align */
-	mtcrf	0x01, rMEMP0
-	subfic	rALIGN, rALIGN, 4
-	add	rMEMP, rMEMP, rALIGN
-	sub	rLEN, rLEN, rALIGN
-	bf+	31, L(g0)
-	stb	rCHR, 0(rMEMP0)
-	bt	30, L(aligned)
-L(g0):	sth	rCHR, -2(rMEMP)	/* 16th instruction from .align */
-/* take care of case for size < 31 */
-L(aligned):
-	mtcrf	0x01, rLEN
-	rlwimi	rCHR, rCHR, 16, 0, 15
-	ble	cr5, L(medium)
-/* align to cache line boundary...  */
-	andi.	rALIGN, rMEMP, 0x1C
-	subfic	rALIGN, rALIGN, 0x20
-	beq	L(caligned)
-	mtcrf	0x01, rALIGN
-	add	rMEMP, rMEMP, rALIGN
-	sub	rLEN, rLEN, rALIGN
-	cmplwi	cr1, rALIGN, 0x10
-	mr	rMEMP2, rMEMP
-	bf	28, L(a1)
-	stw	rCHR, -4(rMEMP2)
-	stwu	rCHR, -8(rMEMP2)
-L(a1):	blt	cr1, L(a2)
-	stw	rCHR, -4(rMEMP2) /* 32nd instruction from .align */
-	stw	rCHR, -8(rMEMP2)
-	stw	rCHR, -12(rMEMP2)
-	stwu	rCHR, -16(rMEMP2)
-L(a2):	bf	29, L(caligned)
-	stw	rCHR, -4(rMEMP2)
-/* now aligned to a cache line.  */
-L(caligned):
-	cmplwi	cr1, rCHR, 0
-	clrrwi.	rALIGN, rLEN, 5
-	mtcrf	0x01, rLEN	/* 40th instruction from .align */
-	
-/* Check if we can use the special case for clearing memory using dcbz.
-   This requires that we know the correct cache line size for this    
-   processor.  Getting the __cache_line_size may require establishing GOT
-   addressability, so branch out of line to set this up.  */
-	beq	cr1, L(checklinesize) 
-	
-/* Store blocks of 32-bytes (256-bits) starting on a 32-byte boundary. 
-   Can't assume that rCHR is zero or that the cache line size is either
-   32-bytes or even known.  */
-L(nondcbz):
-	srwi	rTMP, rALIGN, 5
-	mtctr	rTMP
-	beq	L(medium)	/* we may not actually get to do a full line */
-	clrlwi.	rLEN, rLEN, 27
-	add	rMEMP, rMEMP, rALIGN
-	li	rNEG64, -0x40
-	bdz	L(cloopdone)	/* 48th instruction from .align */
-
-/* We can't use dcbz here as we don't know the cache line size.  We can
-   use "data cache block touch for store", which is safe.  */
-L(c3):	dcbtst rNEG64, rMEMP
-	stw	rCHR, -4(rMEMP)
-	stw	rCHR, -8(rMEMP)
-	stw	rCHR, -12(rMEMP)
-	stw	rCHR, -16(rMEMP)
-	nop			/* let 601 fetch last 4 instructions of loop */
-	stw	rCHR, -20(rMEMP)
-	stw	rCHR, -24(rMEMP) /* 56th instruction from .align */
-	nop			/* let 601 fetch first 8 instructions of loop */
-	stw	rCHR, -28(rMEMP)
-	stwu	rCHR, -32(rMEMP)
-	bdnz	L(c3)
-L(cloopdone):
-	stw	rCHR, -4(rMEMP)
-	stw	rCHR, -8(rMEMP)
-	stw	rCHR, -12(rMEMP)
-	stw	rCHR, -16(rMEMP) /* 64th instruction from .align */
-	stw	rCHR, -20(rMEMP)
-	cmplwi	cr1, rLEN, 16
-	stw	rCHR, -24(rMEMP)
-	stw	rCHR, -28(rMEMP)
-	stwu	rCHR, -32(rMEMP)
-	beqlr
-	add	rMEMP, rMEMP, rALIGN
-	b	L(medium_tail2)	/* 72nd instruction from .align */
-
-	.align 5
-	nop
-/* Clear cache lines of memory in 128-byte chunks.  
-   This code is optimized for processors with 32-byte cache lines.
-   It is further optimized for the 601 processor, which requires
-   some care in how the code is aligned in the i-cache.  */
-L(zloopstart):
-	clrlwi	rLEN, rLEN, 27
-	mtcrf	0x02, rALIGN
-	srwi.	rTMP, rALIGN, 7
-	mtctr	rTMP
-	li	rPOS32, 0x20
-	li	rNEG64, -0x40
-	cmplwi	cr1, rLEN, 16	/* 8 */
-	bf	26, L(z0)
-	dcbz	0, rMEMP
-	addi	rMEMP, rMEMP, 0x20
-L(z0):	li	rNEG32, -0x20
-	bf	25, L(z1)
-	dcbz	0, rMEMP
-	dcbz	rPOS32, rMEMP
-	addi	rMEMP, rMEMP, 0x40 /* 16 */
-L(z1):	cmplwi	cr5, rLEN, 0
-	beq	L(medium)
-L(zloop):
-	dcbz	0, rMEMP
-	dcbz	rPOS32, rMEMP
-	addi	rMEMP, rMEMP, 0x80
-	dcbz	rNEG64, rMEMP
-	dcbz	rNEG32, rMEMP
-	bdnz	L(zloop)
-	beqlr	cr5
-	b	L(medium_tail2)
-
-	.align 5
-L(small):
-/* Memset of 4 bytes or less.  */
-	cmplwi	cr5, rLEN, 1
-	cmplwi	cr1, rLEN, 3
-	bltlr	cr5
-	stb	rCHR, 0(rMEMP)
-	beqlr	cr5
-	nop
-	stb	rCHR, 1(rMEMP)
-	bltlr	cr1
-	stb	rCHR, 2(rMEMP)
-	beqlr	cr1
-	nop
-	stb	rCHR, 3(rMEMP)
-	blr
-
-/* Memset of 0-31 bytes.  */
-	.align 5
-L(medium):
-	cmplwi	cr1, rLEN, 16
-L(medium_tail2):
-	add	rMEMP, rMEMP, rLEN
-L(medium_tail):
-	bt-	31, L(medium_31t)
-	bt-	30, L(medium_30t)
-L(medium_30f):
-	bt-	29, L(medium_29t)
-L(medium_29f):
-	bge-	cr1, L(medium_27t)
-	bflr-	28
-	stw	rCHR, -4(rMEMP)	/* 8th instruction from .align */
-	stw	rCHR, -8(rMEMP)
-	blr
-
-L(medium_31t):
-	stbu	rCHR, -1(rMEMP)
-	bf-	30, L(medium_30f)
-L(medium_30t):
-	sthu	rCHR, -2(rMEMP)
-	bf-	29, L(medium_29f)
-L(medium_29t):
-	stwu	rCHR, -4(rMEMP)
-	blt-	cr1, L(medium_27f) /* 16th instruction from .align */
-L(medium_27t):
-	stw	rCHR, -4(rMEMP)
-	stw	rCHR, -8(rMEMP)
-	stw	rCHR, -12(rMEMP)
-	stwu	rCHR, -16(rMEMP)
-L(medium_27f):
-	bflr-	28
-L(medium_28t):
-	stw	rCHR, -4(rMEMP)
-	stw	rCHR, -8(rMEMP)
-	blr
-	
-L(checklinesize):
-#ifdef SHARED
-	mflr rTMP
-/* If the remaining length is less the 32 bytes then don't bother getting
-	 the cache line size.  */
-	beq	L(medium)	
-/* Establishes GOT addressability so we can load __cache_line_size 
-   from static. This value was set from the aux vector during startup.  */
-	bl   _GLOBAL_OFFSET_TABLE_@local-4
-	mflr rGOT
-	lwz	 rGOT,__cache_line_size@got(rGOT)
-	lwz	 rCLS,0(rGOT)
-	mtlr rTMP
-#else 
-/* Load __cache_line_size from static. This value was set from the 
-   aux vector during startup.  */
-	lis	 rCLS,__cache_line_size@ha
-/* If the remaining length is less the 32 bytes then don't bother getting
-	 the cache line size.  */
-	beq	L(medium)
-	lwz  rCLS,__cache_line_size@l(rCLS)
-#endif
-	
-/*If the cache line size was not set then goto to L(nondcbz), which is
-	safe for any cache line size.  */	
-	cmplwi cr1,rCLS,0
-	beq	cr1,L(nondcbz)
-	
-/* If the cache line size is 32 bytes then goto to L(zloopstart),
-	 which is coded specificly for 32-byte lines (and 601).  */	
-	cmplwi cr1,rCLS,32
-	beq	cr1,L(zloopstart)
-	
-/* Now we know the cache line size and it is not 32-bytes.  However 
-	 we may not yet be aligned to the cache line and may have a partial 
-	 line to fill.  Touch it 1st to fetch the cache line.  */	
-	dcbtst 0,rMEMP	
-	
-	addi rCLM,rCLS,-1
-L(getCacheAligned):
-	cmplwi cr1,rLEN,32
-	and. rTMP,rCLM,rMEMP
-	blt	 cr1,L(handletail32)
-	beq	 L(cacheAligned)
-/* We are not aligned to start of a cache line yet.  Store 32-byte
-   of data and test again.  */
-	addi rMEMP,rMEMP,32
-	addi rLEN,rLEN,-32
-	stw	 rCHR,-32(rMEMP)
-	stw	 rCHR,-28(rMEMP)
-	stw	 rCHR,-24(rMEMP)
-	stw	 rCHR,-20(rMEMP)
-	stw	 rCHR,-16(rMEMP)
-	stw	 rCHR,-12(rMEMP)
-	stw	 rCHR,-8(rMEMP)
-	stw	 rCHR,-4(rMEMP)
-	b	 L(getCacheAligned)
-	
-/* Now we are aligned to the cache line and can use dcbz.  */	
-L(cacheAligned):
-	cmplw cr1,rLEN,rCLS
-	blt	 cr1,L(handletail32)
-	dcbz 0,rMEMP
-	subf rLEN,rCLS,rLEN
-	add	 rMEMP,rMEMP,rCLS
-	b	 L(cacheAligned)
-
-/* We are here because; the cache line size was set, it was not 
-   32-bytes, and the remainder (rLEN) is now less than the actual cache 
-   line size.  Set up the preconditions for L(nondcbz) and go there to 
-   store the remaining bytes.  */			
-L(handletail32):
-	clrrwi.	rALIGN, rLEN, 5
-	b		L(nondcbz)
-		
-END (BP_SYM (memset))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/mul_1.S ../glibc-2.3/sysdeps/powerpc/mul_1.S
--- glibc-2.2.93/sysdeps/powerpc/mul_1.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/mul_1.S	Wed Dec 31 19:00:00 1969
@@ -1,53 +0,0 @@
-/* Multiply a limb vector by a limb, for PowerPC.
-   Copyright (C) 1993-1995, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* mp_limb_t mpn_mul_1 (mp_ptr res_ptr, mp_srcptr s1_ptr,
-                        mp_size_t s1_size, mp_limb_t s2_limb)
-   Calculate s1*s2 and put result in res_ptr; return carry.  */
-
-ENTRY (BP_SYM (__mpn_mul_1))
-#if __BOUNDED_POINTERS__
-	slwi r10,r5,2		/* convert limbs to bytes */
-	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
-#endif
-	mtctr	r5
-
-	lwz	r0,0(r4)
-	mullw	r7,r0,r6
-	mulhwu	r10,r0,r6
-	addi	r3,r3,-4		# adjust res_ptr
-	addic	r5,r5,0			# clear cy with dummy insn
-	bdz	L(1)
-
-L(0):	lwzu	r0,4(r4)
-	stwu	r7,4(r3)
-	mullw	r8,r0,r6
-	adde	r7,r8,r10
-	mulhwu	r10,r0,r6
-	bdnz	L(0)
-
-L(1):	stw	r7,4(r3)
-	addze	r3,r10
-	blr
-END (BP_SYM (__mpn_mul_1))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/Dist ../glibc-2.3/sysdeps/powerpc/powerpc32/Dist
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/Dist	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/Dist	Thu Sep  5 05:35:02 2002
@@ -0,0 +1,10 @@
+divdi3.c
+dl-machine.c
+dl-start.S
+libgcc-compat.S
+ppc-mcount.S
+gprsave1.S
+gprsave0.S
+gprrest1.S
+gprrest0.S
+bp-asm.h
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/Implies ../glibc-2.3/sysdeps/powerpc/powerpc32/Implies
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/Implies	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/Implies	Thu Sep  5 05:36:29 2002
@@ -0,0 +1,2 @@
+wordsize-32
+powerpc/soft-fp
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/Makefile ../glibc-2.3/sysdeps/powerpc/powerpc32/Makefile
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/Makefile	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/Makefile	Thu Sep  5 05:49:38 2002
@@ -0,0 +1,48 @@
+# Powerpc32 specific build options.
+
++cflags += -Wa,-mppc -mpowerpc
+asm-CPPFLAGS += -Wa,-mppc
+
+ifeq ($(with-fp),no)
++cflags += -msoft-float
+sysdep-LDFLAGS += -msoft-float
+endif
+
+ifeq ($(subdir),misc)
+sysdep_routines += gprsave0 gprrest0 gprsave1 gprrest1
+endif
+
+# On PPC, -fpic works until the GOT contains 215 bytes, and possibly
+# more depending on how clever the linker is.  Each GOT entry takes 4 bytes,
+# so that's at least 8192 entries.  Since libc only uses about 2000 entries,
+# we want to use -fpic, because this generates fewer relocs.
+ifeq (yes,$(build-shared))
+pic-ccflag = -fpic
+endif
+
+ifeq ($(subdir),csu)
+ifneq ($(elf),no)
+# The initfini generation code doesn't work in the presence of -fPIC, so
+# we use -fpic instead which is much better.
+CFLAGS-initfini.s = -g0 -fpic -O1
+
+# There is no benefit to using sdata for these objects, and the user
+# of the library should be able to control what goes into sdata.
+CFLAGS-init.o = -G0
+CFLAGS-gmon-start.o = -G0
+endif
+ifeq (yes,$(build-shared))
+# Compatibility
+ifeq (yes,$(have-protected))
+CPPFLAGS-divdi3.c = -DHAVE_DOT_HIDDEN
+CPPFLAGS-libgcc-compat.S = -DHAVE_DOT_HIDDEN
+endif
+sysdep_routines += divdi3 libgcc-compat
+shared-only-routines += divdi3 libgcc-compat
+endif
+endif
+
+ifeq ($(subdir),elf)
+# extra shared linker files to link only into dl-allobjs.so
+sysdep-rtld-routines += dl-start
+endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/Versions ../glibc-2.3/sysdeps/powerpc/powerpc32/Versions
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/Versions	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/Versions	Thu Sep  5 05:54:38 2002
@@ -0,0 +1,34 @@
+libc {
+  GLIBC_2.0 {
+    # Functions from libgcc.
+    __divdi3; __moddi3; __udivdi3; __umoddi3;
+    __cmpdi2; __ucmpdi2;
+    __ashldi3; __ashrdi3; __lshrdi3;
+    __fixdfdi; __fixunsdfdi;
+    __fixsfdi; __fixunssfdi;
+    __floatdidf; __floatdisf;
+  }
+}
+
+libm {
+  GLIBC_2.2 {
+    # Special functions to save and restore registers used by the
+    # runtime libraries.
+    _restgpr0_13; _restgpr0_14; _restgpr0_15; _restgpr0_16; _restgpr0_17;
+    _restgpr0_18; _restgpr0_19; _restgpr0_20; _restgpr0_21; _restgpr0_22;
+    _restgpr0_22; _restgpr0_23; _restgpr0_24; _restgpr0_25; _restgpr0_26;
+    _restgpr0_27; _restgpr0_28; _restgpr0_29; _restgpr0_30; _restgpr0_31;
+    _savegpr0_13; _savegpr0_14; _savegpr0_15; _savegpr0_16; _savegpr0_17;
+    _savegpr0_18; _savegpr0_19; _savegpr0_20; _savegpr0_21; _savegpr0_22;
+    _savegpr0_22; _savegpr0_23; _savegpr0_24; _savegpr0_25; _savegpr0_26;
+    _savegpr0_27; _savegpr0_28; _savegpr0_29; _savegpr0_30; _savegpr0_31;
+    _restgpr1_13; _restgpr1_14; _restgpr1_15; _restgpr1_16; _restgpr1_17;
+    _restgpr1_18; _restgpr1_19; _restgpr1_20; _restgpr1_21; _restgpr1_22;
+    _restgpr1_22; _restgpr1_23; _restgpr1_24; _restgpr1_25; _restgpr1_26;
+    _restgpr1_27; _restgpr1_28; _restgpr1_29; _restgpr1_30; _restgpr1_31;
+    _savegpr1_13; _savegpr1_14; _savegpr1_15; _savegpr1_16; _savegpr1_17;
+    _savegpr1_18; _savegpr1_19; _savegpr1_20; _savegpr1_21; _savegpr1_22;
+    _savegpr1_22; _savegpr1_23; _savegpr1_24; _savegpr1_25; _savegpr1_26;
+    _savegpr1_27; _savegpr1_28; _savegpr1_29; _savegpr1_30; _savegpr1_31;
+  }
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/__longjmp.S ../glibc-2.3/sysdeps/powerpc/powerpc32/__longjmp.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/__longjmp.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/__longjmp.S	Thu Sep  5 04:22:20 2002
@@ -0,0 +1,56 @@
+/* longjmp for PowerPC.
+   Copyright (C) 1995, 1996, 1997, 1999, 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#define _ASM
+#define _SETJMP_H
+#include <bits/setjmp.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+ENTRY (BP_SYM (__longjmp))
+	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
+
+	lwz r1,(JB_GPR1*4)(r3)
+	lwz r2,(JB_GPR2*4)(r3)
+	lwz r0,(JB_LR*4)(r3)
+	lwz r14,((JB_GPRS+0)*4)(r3)
+	lwz r15,((JB_GPRS+1)*4)(r3)
+	lwz r16,((JB_GPRS+2)*4)(r3)
+	lwz r17,((JB_GPRS+3)*4)(r3)
+	lwz r18,((JB_GPRS+4)*4)(r3)
+	lwz r19,((JB_GPRS+5)*4)(r3)
+	lwz r20,((JB_GPRS+6)*4)(r3)
+	mtlr r0
+	lwz r21,((JB_GPRS+7)*4)(r3)
+	lwz r22,((JB_GPRS+8)*4)(r3)
+	lwz r0,(JB_CR*4)(r3)
+	lwz r23,((JB_GPRS+9)*4)(r3)
+	lwz r24,((JB_GPRS+10)*4)(r3)
+	lwz r25,((JB_GPRS+11)*4)(r3)
+	mtcrf 0xFF,r0
+	lwz r26,((JB_GPRS+12)*4)(r3)
+	lwz r27,((JB_GPRS+13)*4)(r3)
+	lwz r28,((JB_GPRS+14)*4)(r3)
+	lwz r29,((JB_GPRS+15)*4)(r3)
+	lwz r30,((JB_GPRS+16)*4)(r3)
+	lwz r31,((JB_GPRS+17)*4)(r3)
+	mr r3,r4
+	blr
+END (BP_SYM (__longjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/add_n.S ../glibc-2.3/sysdeps/powerpc/powerpc32/add_n.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/add_n.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/add_n.S	Thu Sep  5 04:30:31 2002
@@ -0,0 +1,77 @@
+/* Add two limb vectors of equal, non-zero length for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* mp_limb_t mpn_add_n (mp_ptr res_ptr, mp_srcptr s1_ptr, mp_srcptr s2_ptr,
+                        mp_size_t size)
+   Calculate s1+s2 and put result in res_ptr; return carry, 0 or 1.  */
+
+/* Note on optimisation: This code is optimal for the 601.  Almost every other
+   possible 2-unrolled inner loop will not be.  Also, watch out for the
+   alignment...  */
+
+EALIGN (BP_SYM (__mpn_add_n), 3, 0)
+
+#if __BOUNDED_POINTERS__
+	slwi r10,r6,2		/* convert limbs to bytes */
+	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r5, r8, r9, r10)
+#endif
+/* Set up for loop below.  */
+	mtcrf 0x01,r6
+	srwi. r7,r6,1
+	li    r10,0
+	mtctr r7
+	bt    31,L(2)
+
+/* Clear the carry.  */
+	addic r0,r0,0
+/* Adjust pointers for loop.  */
+	addi  r3,r3,-4
+	addi  r4,r4,-4
+	addi  r5,r5,-4
+	b     L(0)
+
+L(2):	lwz  r7,0(r5)
+	lwz  r6,0(r4)
+	addc r6,r6,r7
+	stw  r6,0(r3)
+        beq  L(1)
+
+/* The loop.  */
+
+/* Align start of loop to an odd word boundary to guarantee that the
+   last two words can be fetched in one access (for 601).  */
+L(0):	lwz  r9,4(r4)
+	lwz  r8,4(r5)
+	lwzu r6,8(r4)
+	lwzu r7,8(r5)
+	adde r8,r9,r8
+	stw  r8,4(r3)
+	adde r6,r6,r7
+	stwu r6,8(r3)
+	bdnz L(0)
+/* Return the carry.  */
+L(1):	addze r3,r10
+	blr
+END (BP_SYM (__mpn_add_n))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/addmul_1.S ../glibc-2.3/sysdeps/powerpc/powerpc32/addmul_1.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/addmul_1.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/addmul_1.S	Thu Sep  5 04:30:45 2002
@@ -0,0 +1,56 @@
+/* Multiply a limb vector by a single limb, for PowerPC.
+   Copyright (C) 1993-1995, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* mp_limb_t mpn_addmul_1 (mp_ptr res_ptr, mp_srcptr s1_ptr,
+                           mp_size_t s1_size, mp_limb_t s2_limb)
+   Calculate res+s1*s2 and put result back in res; return carry.  */
+ENTRY (BP_SYM (__mpn_addmul_1))
+#if __BOUNDED_POINTERS__
+	slwi r10,r5,2		/* convert limbs to bytes */
+	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
+#endif
+	mtctr	r5
+
+	lwz	r0,0(r4)
+	mullw	r7,r0,r6
+	mulhwu	r10,r0,r6
+	lwz     r9,0(r3)
+	addc	r8,r7,r9
+	addi	r3,r3,-4		/* adjust res_ptr */
+	bdz	L(1)
+
+L(0):	lwzu	r0,4(r4)
+	stwu	r8,4(r3)
+	mullw	r8,r0,r6
+	adde	r7,r8,r10
+	mulhwu	r10,r0,r6
+	lwz     r9,4(r3)
+	addze   r10,r10
+	addc    r8,r7,r9
+	bdnz	L(0)
+
+L(1):	stw	r8,4(r3)
+	addze	r3,r10
+	blr
+END (BP_SYM (__mpn_addmul_1))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/atomicity.h ../glibc-2.3/sysdeps/powerpc/powerpc32/atomicity.h
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/atomicity.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/atomicity.h	Thu Sep  5 04:22:39 2002
@@ -0,0 +1,104 @@
+/* Low-level functions for atomic operations.  PowerPC version.
+   Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _ATOMICITY_H
+#define _ATOMICITY_H	1
+
+#include <inttypes.h>
+
+#if BROKEN_PPC_ASM_CR0
+# define __ATOMICITY_INLINE /* nothing */
+#else
+# define __ATOMICITY_INLINE inline
+#endif
+
+static __ATOMICITY_INLINE int
+__attribute__ ((unused))
+exchange_and_add (volatile uint32_t *mem, int val)
+{
+  int tmp, result;
+  __asm__ ("\n\
+0:	lwarx	%0,0,%2	\n\
+	add%I3	%1,%0,%3	\n\
+	stwcx.	%1,0,%2	\n\
+	bne-	0b	\n\
+" : "=&b"(result), "=&r"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
+  return result;
+}
+
+static __ATOMICITY_INLINE void
+__attribute__ ((unused))
+atomic_add (volatile uint32_t *mem, int val)
+{
+  int tmp;
+  __asm__ ("\n\
+0:	lwarx	%0,0,%1	\n\
+	add%I2	%0,%0,%2	\n\
+	stwcx.	%0,0,%1	\n\
+	bne-	0b	\n\
+" : "=&b"(tmp) : "r" (mem), "Ir"(val) : "cr0", "memory");
+}
+
+static __ATOMICITY_INLINE int
+__attribute__ ((unused))
+compare_and_swap (volatile long int *p, long int oldval, long int newval)
+{
+  int result;
+  __asm__ ("\n\
+0:	lwarx	%0,0,%1	\n\
+	sub%I2c.	%0,%0,%2	\n\
+	cntlzw	%0,%0	\n\
+	bne-	1f	\n\
+	stwcx.	%3,0,%1	\n\
+	bne-	0b	\n\
+1:	\n\
+" : "=&b"(result) : "r"(p), "Ir"(oldval), "r"(newval) : "cr0", "memory");
+  return result >> 5;
+}
+
+static __ATOMICITY_INLINE long int
+__attribute__ ((unused))
+always_swap (volatile long int *p, long int newval)
+{
+  long int result;
+  __asm__ ("\n\
+0:	lwarx	%0,0,%1	\n\
+	stwcx.	%2,0,%1	\n\
+	bne-	0b	\n\
+" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
+  return result;
+}
+
+static __ATOMICITY_INLINE int
+__attribute__ ((unused))
+test_and_set (volatile long int *p, long int newval)
+{
+  int result;
+  __asm__ ("\n\
+0:	lwarx	%0,0,%1	\n\
+	cmpwi	%0,0	\n\
+	bne-	1f	\n\
+	stwcx.	%2,0,%1	\n\
+	bne-	0b	\n\
+1:	\n\
+" : "=&r"(result) : "r"(p), "r"(newval) : "cr0", "memory");
+  return result;
+}
+
+#endif /* atomicity.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/backtrace.c ../glibc-2.3/sysdeps/powerpc/powerpc32/backtrace.c
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/backtrace.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/backtrace.c	Thu Sep  5 04:22:53 2002
@@ -0,0 +1,66 @@
+/* Return backtrace of current program state.
+   Copyright (C) 1998, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <execinfo.h>
+#include <stddef.h>
+#include <bp-checks.h>
+
+/* This is the stack layout we see with every stack frame.
+   Note that every routine is required by the ABI to lay out the stack
+   like this.
+
+            +----------------+        +-----------------+
+    %r1  -> | %r1 last frame--------> | %r1 last frame--->...  --> NULL
+            |                |        |                 |
+            | (unused)       |        | return address  |
+            +----------------+        +-----------------+
+*/
+struct layout
+{
+  struct layout *__unbounded next;
+  void *__unbounded return_address;
+};
+
+int
+__backtrace (void **array, int size)
+{
+  struct layout *current;
+  int count;
+
+  /* Force gcc to spill LR.  */
+  asm volatile ("" : "=l"(current));
+
+  /* Get the address on top-of-stack.  */
+  asm volatile ("lwz %0,0(1)" : "=r"(current));
+  current = BOUNDED_1 (current);
+
+  for (				count = 0;
+       current != NULL && 	count < size;
+       current = BOUNDED_1 (current->next), count++)
+    array[count] = current->return_address;
+
+  /* It's possible the second-last stack frame can't return
+     (that is, it's __libc_start_main), in which case
+     the CRT startup code will have set its LR to 'NULL'.  */
+  if (count > 0 && array[count-1] == NULL)
+    count--;
+
+  return count;
+}
+weak_alias (__backtrace, backtrace)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/bp-asm.h ../glibc-2.3/sysdeps/powerpc/powerpc32/bp-asm.h
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/bp-asm.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/bp-asm.h	Thu Sep  5 04:23:10 2002
@@ -0,0 +1,114 @@
+/* Bounded-pointer definitions for PowerPC assembler.
+   Copyright (C) 2000 Free Software Foundation, Inc.
+   Contributed by Greg McGary <greg@mcgary.org>
+   This file is part of the GNU C Library.  Its master source is NOT part of
+   the C library, however.  The master source lives in the GNU MP Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#if __BOUNDED_POINTERS__
+
+/* Byte offsets of BP components.  */
+# define oVALUE	0
+# define oLOW	4
+# define oHIGH	8
+
+/* Don't check bounds, just convert the BP register to its simple
+   pointer value.  */
+
+# define DISCARD_BOUNDS(rBP)			\
+	lwz	rBP, oVALUE(rBP)
+
+/* Check low bound, with the side effect that the BP register is converted
+   its simple pointer value.  Move the high bound into a register for
+   later use.  */
+
+# define CHECK_BOUNDS_LOW(rBP, rLOW, rHIGH)	\
+	lwz	rHIGH, oHIGH(rBP);		\
+	lwz	rLOW, oLOW(rBP);		\
+	lwz	rBP, oVALUE(rBP);		\
+	twllt	rBP, rLOW
+
+/* Check the high bound, which is in a register, using the given
+   conditional trap instruction.  */
+
+# define CHECK_BOUNDS_HIGH(rVALUE, rHIGH, TWLcc) \
+	TWLcc	rVALUE, rHIGH
+
+/* Check the high bound, which is stored at the return-value's high
+   bound slot, using the given conditional trap instruction.  */
+
+# define CHECK_BOUNDS_HIGH_RTN(rVALUE, rHIGH, TWLcc)	\
+	lwz	rHIGH, oHIGH(rRTN);			\
+	TWLcc	rVALUE, rHIGH
+
+/* Check both bounds, with the side effect that the BP register is
+   converted to its simple pointer value.  */
+
+# define CHECK_BOUNDS_BOTH(rBP, rLOW, rHIGH)	\
+	CHECK_BOUNDS_LOW(rBP, rLOW, rHIGH);	\
+	twlge	rBP, rHIGH
+
+/* Check bounds on a memory region of given length, with the side
+   effect that the BP register is converted to its simple pointer
+   value.  */
+
+# define CHECK_BOUNDS_BOTH_WIDE(rBP, rLOW, rHIGH, rLENGTH)	\
+	CHECK_BOUNDS_LOW (rBP, rLOW, rHIGH);			\
+	sub	rHIGH, rHIGH, rLENGTH;				\
+	twlgt	rBP, rHIGH
+
+# define CHECK_BOUNDS_BOTH_WIDE_LIT(rBP, rLOW, rHIGH, LENGTH)	\
+	CHECK_BOUNDS_LOW (rBP, rLOW, rHIGH);			\
+	subi	rHIGH, rHIGH, LENGTH;				\
+	twlgt	rBP, rHIGH
+
+/* Store a pointer value register into the return-value's pointer
+   value slot.  */
+
+# define STORE_RETURN_VALUE(rVALUE)		\
+	stw	rVALUE, oVALUE(rRTN)
+
+/* Store a low and high bounds into the return-value's pointer bounds
+   slots.  */
+
+# define STORE_RETURN_BOUNDS(rLOW, rHIGH)	\
+	stw	rLOW, oLOW(rRTN);		\
+	stw	rHIGH, oHIGH(rRTN)
+
+/* Stuff zero value/low/high into the BP addressed by rRTN.  */
+
+# define RETURN_NULL_BOUNDED_POINTER		\
+	li	r4, 0;				\
+	STORE_RETURN_VALUE (r4);		\
+	STORE_RETURN_BOUNDS (r4, r4)
+
+#else
+
+# define DISCARD_BOUNDS(rBP)
+# define CHECK_BOUNDS_LOW(rBP, rLOW, rHIGH)
+# define CHECK_BOUNDS_HIGH(rVALUE, rHIGH, TWLcc)
+# define CHECK_BOUNDS_HIGH_RTN(rVALUE, rHIGH, TWLcc)
+# define CHECK_BOUNDS_BOTH(rBP, rLOW, rHIGH)
+# define CHECK_BOUNDS_BOTH_WIDE(rBP, rLOW, rHIGH, rLENGTH)
+# define CHECK_BOUNDS_BOTH_WIDE_LIT(rBP, rLOW, rHIGH, LENGTH)
+# define STORE_RETURN_VALUE(rVALUE)
+# define STORE_RETURN_BOUNDS(rLOW, rHIGH)
+
+# define RETURN_NULL_BOUNDED_POINTER li rRTN, 0
+
+#endif
+
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/bsd-_setjmp.S ../glibc-2.3/sysdeps/powerpc/powerpc32/bsd-_setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/bsd-_setjmp.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/bsd-_setjmp.S	Thu Sep  5 04:23:54 2002
@@ -0,0 +1,30 @@
+/* BSD `_setjmp' entry point to `sigsetjmp (..., 0)'.  PowerPC version.
+   Copyright (C) 1994, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/* This just does a tail-call to `__sigsetjmp (ARG, 0)'.
+   We cannot do it in C because it must be a tail-call, so frame-unwinding
+   in setjmp doesn't clobber the state restored by longjmp.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+
+ENTRY (BP_SYM (_setjmp))
+	li r4,0			/* Set second argument to 0.  */
+	b JUMPTARGET(BP_SYM (__sigsetjmp))
+END (BP_SYM (_setjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/bsd-setjmp.S ../glibc-2.3/sysdeps/powerpc/powerpc32/bsd-setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/bsd-setjmp.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/bsd-setjmp.S	Thu Sep  5 04:23:27 2002
@@ -0,0 +1,32 @@
+/* BSD `setjmp' entry point to `sigsetjmp (..., 1)'.  PowerPC version.
+   Copyright (C) 1994, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/* This just does a tail-call to `__sigsetjmp (ARG, 1)'.
+   We cannot do it in C because it must be a tail-call, so frame-unwinding
+   in setjmp doesn't clobber the state restored by longjmp.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+
+ENTRY (BP_SYM (__setjmp))
+	li r4,1			/* Set second argument to 1.  */
+	b JUMPTARGET (BP_SYM (__sigsetjmp))
+END (BP_SYM (__setjmp))
+
+strong_alias (__setjmp, setjmp)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/divdi3.c ../glibc-2.3/sysdeps/powerpc/powerpc32/divdi3.c
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/divdi3.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/divdi3.c	Thu Sep  5 04:31:00 2002
@@ -0,0 +1,43 @@
+/* 64-bit multiplication and division libgcc routines for 32-bit PowerPC
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define _DIVDI3_C
+#include <sysdeps/wordsize-32/divdi3.c>
+
+INTDEF (__udivdi3);
+INTDEF (__moddi3);
+INTDEF (__umoddi3);
+
+#ifdef HAVE_DOT_HIDDEN
+asm (".hidden __divdi3");
+asm (".hidden __udivdi3");
+asm (".hidden __moddi3");
+asm (".hidden __umoddi3");
+#endif
+
+#include <shlib-compat.h>
+
+#if SHLIB_COMPAT(libc, GLIBC_2_0, GLIBC_2_2_6)
+
+symbol_version (INTUSE (__divdi3), __divdi3, GLIBC_2.0);
+symbol_version (INTUSE (__udivdi3), __udivdi3, GLIBC_2.0);
+symbol_version (INTUSE (__moddi3), __moddi3, GLIBC_2.0);
+symbol_version (INTUSE (__umoddi3), __umoddi3, GLIBC_2.0);
+
+#endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/dl-machine.c ../glibc-2.3/sysdeps/powerpc/powerpc32/dl-machine.c
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/dl-machine.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/dl-machine.c	Thu Sep  5 04:24:12 2002
@@ -0,0 +1,538 @@
+/* Machine-dependent ELF dynamic relocation functions.  PowerPC version.
+   Copyright (C) 1995-2001, 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <unistd.h>
+#include <string.h>
+#include <sys/param.h>
+#include <link.h>
+#include <ldsodefs.h>
+#include <elf/dynamic-link.h>
+#include <dl-machine.h>
+#include <stdio-common/_itoa.h>
+
+/* Because ld.so is now versioned, these functions can be in their own file;
+   no relocations need to be done to call them.
+   Of course, if ld.so is not versioned...  */
+#if !(DO_VERSIONING - 0)
+#error This will not work with versioning turned off, sorry.
+#endif
+
+
+/* Stuff for the PLT.  */
+#define PLT_INITIAL_ENTRY_WORDS 18
+#define PLT_LONGBRANCH_ENTRY_WORDS 0
+#define PLT_TRAMPOLINE_ENTRY_WORDS 6
+#define PLT_DOUBLE_SIZE (1<<13)
+#define PLT_ENTRY_START_WORDS(entry_number) \
+  (PLT_INITIAL_ENTRY_WORDS + (entry_number)*2				\
+   + ((entry_number) > PLT_DOUBLE_SIZE					\
+      ? ((entry_number) - PLT_DOUBLE_SIZE)*2				\
+      : 0))
+#define PLT_DATA_START_WORDS(num_entries) PLT_ENTRY_START_WORDS(num_entries)
+
+/* Macros to build PowerPC opcode words.  */
+#define OPCODE_ADDI(rd,ra,simm) \
+  (0x38000000 | (rd) << 21 | (ra) << 16 | ((simm) & 0xffff))
+#define OPCODE_ADDIS(rd,ra,simm) \
+  (0x3c000000 | (rd) << 21 | (ra) << 16 | ((simm) & 0xffff))
+#define OPCODE_ADD(rd,ra,rb) \
+  (0x7c000214 | (rd) << 21 | (ra) << 16 | (rb) << 11)
+#define OPCODE_B(target) (0x48000000 | ((target) & 0x03fffffc))
+#define OPCODE_BA(target) (0x48000002 | ((target) & 0x03fffffc))
+#define OPCODE_BCTR() 0x4e800420
+#define OPCODE_LWZ(rd,d,ra) \
+  (0x80000000 | (rd) << 21 | (ra) << 16 | ((d) & 0xffff))
+#define OPCODE_LWZU(rd,d,ra) \
+  (0x84000000 | (rd) << 21 | (ra) << 16 | ((d) & 0xffff))
+#define OPCODE_MTCTR(rd) (0x7C0903A6 | (rd) << 21)
+#define OPCODE_RLWINM(ra,rs,sh,mb,me) \
+  (0x54000000 | (rs) << 21 | (ra) << 16 | (sh) << 11 | (mb) << 6 | (me) << 1)
+
+#define OPCODE_LI(rd,simm)    OPCODE_ADDI(rd,0,simm)
+#define OPCODE_ADDIS_HI(rd,ra,value) \
+  OPCODE_ADDIS(rd,ra,((value) + 0x8000) >> 16)
+#define OPCODE_LIS_HI(rd,value) OPCODE_ADDIS_HI(rd,0,value)
+#define OPCODE_SLWI(ra,rs,sh) OPCODE_RLWINM(ra,rs,sh,0,31-sh)
+
+
+#define PPC_DCBST(where) asm volatile ("dcbst 0,%0" : : "r"(where) : "memory")
+#define PPC_SYNC asm volatile ("sync" : : : "memory")
+#define PPC_ISYNC asm volatile ("sync; isync" : : : "memory")
+#define PPC_ICBI(where) asm volatile ("icbi 0,%0" : : "r"(where) : "memory")
+#define PPC_DIE asm volatile ("tweq 0,0")
+
+/* Use this when you've modified some code, but it won't be in the
+   instruction fetch queue (or when it doesn't matter if it is). */
+#define MODIFIED_CODE_NOQUEUE(where) \
+     do { PPC_DCBST(where); PPC_SYNC; PPC_ICBI(where); } while (0)
+/* Use this when it might be in the instruction queue. */
+#define MODIFIED_CODE(where) \
+     do { PPC_DCBST(where); PPC_SYNC; PPC_ICBI(where); PPC_ISYNC; } while (0)
+
+
+/* The idea here is that to conform to the ABI, we are supposed to try
+   to load dynamic objects between 0x10000 (we actually use 0x40000 as
+   the lower bound, to increase the chance of a memory reference from
+   a null pointer giving a segfault) and the program's load address;
+   this may allow us to use a branch instruction in the PLT rather
+   than a computed jump.  The address is only used as a preference for
+   mmap, so if we get it wrong the worst that happens is that it gets
+   mapped somewhere else.  */
+
+ElfW(Addr)
+__elf_preferred_address(struct link_map *loader, size_t maplength,
+			ElfW(Addr) mapstartpref)
+{
+  ElfW(Addr) low, high;
+  struct link_map *l;
+
+  /* If the object has a preference, load it there!  */
+  if (mapstartpref != 0)
+    return mapstartpref;
+
+  /* Otherwise, quickly look for a suitable gap between 0x3FFFF and
+     0x70000000.  0x3FFFF is so that references off NULL pointers will
+     cause a segfault, 0x70000000 is just paranoia (it should always
+     be superceded by the program's load address).  */
+  low =  0x0003FFFF;
+  high = 0x70000000;
+  for (l = GL(dl_loaded); l; l = l->l_next)
+    {
+      ElfW(Addr) mapstart, mapend;
+      mapstart = l->l_map_start & ~(GL(dl_pagesize) - 1);
+      mapend = l->l_map_end | (GL(dl_pagesize) - 1);
+      assert (mapend > mapstart);
+
+      /* Prefer gaps below the main executable, note that l ==
+	 _dl_loaded does not work for static binaries loading
+	 e.g. libnss_*.so.  */
+      if ((mapend >= high || l->l_type == lt_executable)
+	  && high >= mapstart)
+	high = mapstart;
+      else if (mapend >= low && low >= mapstart)
+	low = mapend;
+      else if (high >= mapend && mapstart >= low)
+	{
+	  if (high - mapend >= mapstart - low)
+	    low = mapend;
+	  else
+	    high = mapstart;
+	}
+    }
+
+  high -= 0x10000; /* Allow some room between objects.  */
+  maplength = (maplength | (GL(dl_pagesize) - 1)) + 1;
+  if (high <= low || high - low < maplength )
+    return 0;
+  return high - maplength;  /* Both high and maplength are page-aligned.  */
+}
+
+/* Set up the loaded object described by L so its unrelocated PLT
+   entries will jump to the on-demand fixup code in dl-runtime.c.
+   Also install a small trampoline to be used by entries that have
+   been relocated to an address too far away for a single branch.  */
+
+/* There are many kinds of PLT entries:
+
+   (1)	A direct jump to the actual routine, either a relative or
+	absolute branch.  These are set up in __elf_machine_fixup_plt.
+
+   (2)	Short lazy entries.  These cover the first 8192 slots in
+        the PLT, and look like (where 'index' goes from 0 to 8191):
+
+	li %r11, index*4
+	b  &plt[PLT_TRAMPOLINE_ENTRY_WORDS+1]
+
+   (3)	Short indirect jumps.  These replace (2) when a direct jump
+	wouldn't reach.  They look the same except that the branch
+	is 'b &plt[PLT_LONGBRANCH_ENTRY_WORDS]'.
+
+   (4)  Long lazy entries.  These cover the slots when a short entry
+	won't fit ('index*4' overflows its field), and look like:
+
+	lis %r11, %hi(index*4 + &plt[PLT_DATA_START_WORDS])
+	lwzu %r12, %r11, %lo(index*4 + &plt[PLT_DATA_START_WORDS])
+	b  &plt[PLT_TRAMPOLINE_ENTRY_WORDS]
+	bctr
+
+   (5)	Long indirect jumps.  These replace (4) when a direct jump
+	wouldn't reach.  They look like:
+
+	lis %r11, %hi(index*4 + &plt[PLT_DATA_START_WORDS])
+	lwz %r12, %r11, %lo(index*4 + &plt[PLT_DATA_START_WORDS])
+	mtctr %r12
+	bctr
+
+   (6) Long direct jumps.  These are used when thread-safety is not
+       required.  They look like:
+
+       lis %r12, %hi(finaladdr)
+       addi %r12, %r12, %lo(finaladdr)
+       mtctr %r12
+       bctr
+
+
+   The lazy entries, (2) and (4), are set up here in
+   __elf_machine_runtime_setup.  (1), (3), and (5) are set up in
+   __elf_machine_fixup_plt.  (1), (3), and (6) can also be constructed
+   in __process_machine_rela.
+
+   The reason for the somewhat strange construction of the long
+   entries, (4) and (5), is that we need to ensure thread-safety.  For
+   (1) and (3), this is obvious because only one instruction is
+   changed and the PPC architecture guarantees that aligned stores are
+   atomic.  For (5), this is more tricky.  When changing (4) to (5),
+   the `b' instruction is first changed to to `mtctr'; this is safe
+   and is why the `lwzu' instruction is not just a simple `addi'.
+   Once this is done, and is visible to all processors, the `lwzu' can
+   safely be changed to a `lwz'.  */
+int
+__elf_machine_runtime_setup (struct link_map *map, int lazy, int profile)
+{
+  if (map->l_info[DT_JMPREL])
+    {
+      Elf32_Word i;
+      Elf32_Word *plt = (Elf32_Word *) D_PTR (map, l_info[DT_PLTGOT]);
+      Elf32_Word num_plt_entries = (map->l_info[DT_PLTRELSZ]->d_un.d_val
+				    / sizeof (Elf32_Rela));
+      Elf32_Word rel_offset_words = PLT_DATA_START_WORDS (num_plt_entries);
+      Elf32_Word data_words = (Elf32_Word) (plt + rel_offset_words);
+      Elf32_Word size_modified;
+
+      extern void _dl_runtime_resolve (void);
+      extern void _dl_prof_resolve (void);
+
+      /* Convert the index in r11 into an actual address, and get the
+	 word at that address.  */
+      plt[PLT_LONGBRANCH_ENTRY_WORDS] = OPCODE_ADDIS_HI (11, 11, data_words);
+      plt[PLT_LONGBRANCH_ENTRY_WORDS + 1] = OPCODE_LWZ (11, data_words, 11);
+
+      /* Call the procedure at that address.  */
+      plt[PLT_LONGBRANCH_ENTRY_WORDS + 2] = OPCODE_MTCTR (11);
+      plt[PLT_LONGBRANCH_ENTRY_WORDS + 3] = OPCODE_BCTR ();
+
+      if (lazy)
+	{
+	  Elf32_Word *tramp = plt + PLT_TRAMPOLINE_ENTRY_WORDS;
+	  Elf32_Word dlrr = (Elf32_Word)(profile
+					 ? _dl_prof_resolve
+					 : _dl_runtime_resolve);
+	  Elf32_Word offset;
+
+	  if (profile && _dl_name_match_p (GL(dl_profile), map))
+	    /* This is the object we are looking for.  Say that we really
+	       want profiling and the timers are started.  */
+	    GL(dl_profile_map) = map;
+
+	  /* For the long entries, subtract off data_words.  */
+	  tramp[0] = OPCODE_ADDIS_HI (11, 11, -data_words);
+	  tramp[1] = OPCODE_ADDI (11, 11, -data_words);
+
+	  /* Multiply index of entry by 3 (in r11).  */
+	  tramp[2] = OPCODE_SLWI (12, 11, 1);
+	  tramp[3] = OPCODE_ADD (11, 12, 11);
+	  if (dlrr <= 0x01fffffc || dlrr >= 0xfe000000)
+	    {
+	      /* Load address of link map in r12.  */
+	      tramp[4] = OPCODE_LI (12, (Elf32_Word) map);
+	      tramp[5] = OPCODE_ADDIS_HI (12, 12, (Elf32_Word) map);
+
+	      /* Call _dl_runtime_resolve.  */
+	      tramp[6] = OPCODE_BA (dlrr);
+	    }
+	  else
+	    {
+	      /* Get address of _dl_runtime_resolve in CTR.  */
+	      tramp[4] = OPCODE_LI (12, dlrr);
+	      tramp[5] = OPCODE_ADDIS_HI (12, 12, dlrr);
+	      tramp[6] = OPCODE_MTCTR (12);
+
+	      /* Load address of link map in r12.  */
+	      tramp[7] = OPCODE_LI (12, (Elf32_Word) map);
+	      tramp[8] = OPCODE_ADDIS_HI (12, 12, (Elf32_Word) map);
+
+	      /* Call _dl_runtime_resolve.  */
+	      tramp[9] = OPCODE_BCTR ();
+	    }
+
+	  /* Set up the lazy PLT entries.  */
+	  offset = PLT_INITIAL_ENTRY_WORDS;
+	  i = 0;
+	  while (i < num_plt_entries && i < PLT_DOUBLE_SIZE)
+	    {
+	      plt[offset  ] = OPCODE_LI (11, i * 4);
+	      plt[offset+1] = OPCODE_B ((PLT_TRAMPOLINE_ENTRY_WORDS + 2
+					 - (offset+1))
+					* 4);
+	      i++;
+	      offset += 2;
+	    }
+	  while (i < num_plt_entries)
+	    {
+	      plt[offset  ] = OPCODE_LIS_HI (11, i * 4 + data_words);
+	      plt[offset+1] = OPCODE_LWZU (12, i * 4 + data_words, 11);
+	      plt[offset+2] = OPCODE_B ((PLT_TRAMPOLINE_ENTRY_WORDS
+					 - (offset+2))
+					* 4);
+	      plt[offset+3] = OPCODE_BCTR ();
+	      i++;
+	      offset += 4;
+	    }
+	}
+
+      /* Now, we've modified code.  We need to write the changes from
+	 the data cache to a second-level unified cache, then make
+	 sure that stale data in the instruction cache is removed.
+	 (In a multiprocessor system, the effect is more complex.)
+	 Most of the PLT shouldn't be in the instruction cache, but
+	 there may be a little overlap at the start and the end.
+
+	 Assumes that dcbst and icbi apply to lines of 16 bytes or
+	 more.  Current known line sizes are 16, 32, and 128 bytes.  */
+
+      size_modified = lazy ? rel_offset_words : 6;
+      for (i = 0; i < size_modified; i += 4)
+	PPC_DCBST (plt + i);
+      PPC_DCBST (plt + size_modified - 1);
+      PPC_SYNC;
+      PPC_ICBI (plt);
+      PPC_ICBI (plt + size_modified - 1);
+      PPC_ISYNC;
+    }
+
+  return lazy;
+}
+
+Elf32_Addr
+__elf_machine_fixup_plt(struct link_map *map, const Elf32_Rela *reloc,
+			Elf32_Addr *reloc_addr, Elf32_Addr finaladdr)
+{
+  Elf32_Sword delta = finaladdr - (Elf32_Word) reloc_addr;
+  if (delta << 6 >> 6 == delta)
+    *reloc_addr = OPCODE_B (delta);
+  else if (finaladdr <= 0x01fffffc || finaladdr >= 0xfe000000)
+    *reloc_addr = OPCODE_BA (finaladdr);
+  else
+    {
+      Elf32_Word *plt, *data_words;
+      Elf32_Word index, offset, num_plt_entries;
+
+      num_plt_entries = (map->l_info[DT_PLTRELSZ]->d_un.d_val
+			 / sizeof(Elf32_Rela));
+      plt = (Elf32_Word *) D_PTR (map, l_info[DT_PLTGOT]);
+      offset = reloc_addr - plt;
+      index = (offset - PLT_INITIAL_ENTRY_WORDS)/2;
+      data_words = plt + PLT_DATA_START_WORDS (num_plt_entries);
+
+      reloc_addr += 1;
+
+      if (index < PLT_DOUBLE_SIZE)
+	{
+	  data_words[index] = finaladdr;
+	  PPC_SYNC;
+	  *reloc_addr = OPCODE_B ((PLT_LONGBRANCH_ENTRY_WORDS - (offset+1))
+				  * 4);
+	}
+      else
+	{
+	  index -= (index - PLT_DOUBLE_SIZE)/2;
+
+	  data_words[index] = finaladdr;
+	  PPC_SYNC;
+
+	  reloc_addr[1] = OPCODE_MTCTR (12);
+	  MODIFIED_CODE_NOQUEUE (reloc_addr + 1);
+	  PPC_SYNC;
+
+	  reloc_addr[0] = OPCODE_LWZ (12,
+				      (Elf32_Word) (data_words + index), 11);
+	}
+    }
+  MODIFIED_CODE (reloc_addr);
+  return finaladdr;
+}
+
+static void
+dl_reloc_overflow (struct link_map *map,
+		   const char *name,
+		   Elf32_Addr *const reloc_addr,
+		   const Elf32_Sym *sym,
+		   const Elf32_Sym *refsym)
+{
+  char buffer[128];
+  char *t;
+  const Elf32_Sym *errsym = sym ?: refsym;
+  t = stpcpy (buffer, name);
+  t = stpcpy (t, " relocation at 0x00000000");
+  _itoa_word ((unsigned) reloc_addr, t, 16, 0);
+  if (errsym)
+    {
+      const char *strtab;
+
+      strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
+      t = stpcpy (t, " for symbol `");
+      t = stpcpy (t, strtab + errsym->st_name);
+      t = stpcpy (t, "'");
+    }
+  t = stpcpy (t, " out of range");
+  _dl_signal_error (0, map->l_name, NULL, buffer);
+}
+
+void
+__process_machine_rela (struct link_map *map,
+			const Elf32_Rela *reloc,
+			const Elf32_Sym *sym,
+			const Elf32_Sym *refsym,
+			Elf32_Addr *const reloc_addr,
+			Elf32_Addr const finaladdr,
+			int rinfo)
+{
+  switch (rinfo)
+    {
+    case R_PPC_NONE:
+      return;
+
+    case R_PPC_ADDR32:
+    case R_PPC_UADDR32:
+    case R_PPC_GLOB_DAT:
+    case R_PPC_RELATIVE:
+      *reloc_addr = finaladdr;
+      return;
+
+    case R_PPC_ADDR24:
+      if (finaladdr > 0x01fffffc && finaladdr < 0xfe000000)
+	dl_reloc_overflow (map,  "R_PPC_ADDR24", reloc_addr, sym, refsym);
+      *reloc_addr = (*reloc_addr & 0xfc000003) | (finaladdr & 0x3fffffc);
+      break;
+
+    case R_PPC_ADDR16:
+    case R_PPC_UADDR16:
+      if (finaladdr > 0x7fff && finaladdr < 0x8000)
+	dl_reloc_overflow (map,  "R_PPC_ADDR16", reloc_addr, sym, refsym);
+      *(Elf32_Half*) reloc_addr = finaladdr;
+      break;
+
+    case R_PPC_ADDR16_LO:
+      *(Elf32_Half*) reloc_addr = finaladdr;
+      break;
+
+    case R_PPC_ADDR16_HI:
+      *(Elf32_Half*) reloc_addr = finaladdr >> 16;
+      break;
+
+    case R_PPC_ADDR16_HA:
+      *(Elf32_Half*) reloc_addr = (finaladdr + 0x8000) >> 16;
+      break;
+
+    case R_PPC_ADDR14:
+    case R_PPC_ADDR14_BRTAKEN:
+    case R_PPC_ADDR14_BRNTAKEN:
+      if (finaladdr > 0x7fff && finaladdr < 0x8000)
+	dl_reloc_overflow (map,  "R_PPC_ADDR14", reloc_addr, sym, refsym);
+      *reloc_addr = (*reloc_addr & 0xffff0003) | (finaladdr & 0xfffc);
+      if (rinfo != R_PPC_ADDR14)
+	*reloc_addr = ((*reloc_addr & 0xffdfffff)
+		       | ((rinfo == R_PPC_ADDR14_BRTAKEN)
+			  ^ (finaladdr >> 31)) << 21);
+      break;
+
+    case R_PPC_REL24:
+      {
+	Elf32_Sword delta = finaladdr - (Elf32_Word) reloc_addr;
+	if (delta << 6 >> 6 != delta)
+	  dl_reloc_overflow (map,  "R_PPC_REL24", reloc_addr, sym, refsym);
+	*reloc_addr = (*reloc_addr & 0xfc000003) | (delta & 0x3fffffc);
+      }
+      break;
+
+    case R_PPC_COPY:
+      if (sym == NULL)
+	/* This can happen in trace mode when an object could not be
+	   found.  */
+	return;
+      if (sym->st_size > refsym->st_size
+	  || (GL(dl_verbose) && sym->st_size < refsym->st_size))
+	{
+	  const char *strtab;
+
+	  strtab = (const void *) D_PTR (map, l_info[DT_STRTAB]);
+	  _dl_error_printf ("\
+%s: Symbol `%s' has different size in shared object, onsider re-linking\n",
+			    rtld_progname ?: "<program name unknown>",
+			    strtab + refsym->st_name);
+	}
+      memcpy (reloc_addr, (char *) finaladdr, MIN (sym->st_size,
+						   refsym->st_size));
+      return;
+
+    case R_PPC_REL32:
+      *reloc_addr = finaladdr - (Elf32_Word) reloc_addr;
+      return;
+
+    case R_PPC_JMP_SLOT:
+      /* It used to be that elf_machine_fixup_plt was used here,
+	 but that doesn't work when ld.so relocates itself
+	 for the second time.  On the bright side, there's
+         no need to worry about thread-safety here.  */
+      {
+	Elf32_Sword delta = finaladdr - (Elf32_Word) reloc_addr;
+	if (delta << 6 >> 6 == delta)
+	  *reloc_addr = OPCODE_B (delta);
+	else if (finaladdr <= 0x01fffffc || finaladdr >= 0xfe000000)
+	  *reloc_addr = OPCODE_BA (finaladdr);
+	else
+	  {
+	    Elf32_Word *plt, *data_words;
+	    Elf32_Word index, offset, num_plt_entries;
+
+	    plt = (Elf32_Word *) D_PTR (map, l_info[DT_PLTGOT]);
+	    offset = reloc_addr - plt;
+
+	    if (offset < PLT_DOUBLE_SIZE*2 + PLT_INITIAL_ENTRY_WORDS)
+	      {
+		index = (offset - PLT_INITIAL_ENTRY_WORDS)/2;
+		num_plt_entries = (map->l_info[DT_PLTRELSZ]->d_un.d_val
+				   / sizeof(Elf32_Rela));
+		data_words = plt + PLT_DATA_START_WORDS (num_plt_entries);
+		data_words[index] = finaladdr;
+		reloc_addr[0] = OPCODE_LI (11, index * 4);
+		reloc_addr[1] = OPCODE_B ((PLT_LONGBRANCH_ENTRY_WORDS
+					   - (offset+1))
+					  * 4);
+		MODIFIED_CODE_NOQUEUE (reloc_addr + 1);
+	      }
+	    else
+	      {
+		reloc_addr[0] = OPCODE_LIS_HI (12, finaladdr);
+		reloc_addr[1] = OPCODE_ADDI (12, 12, finaladdr);
+		reloc_addr[2] = OPCODE_MTCTR (12);
+		reloc_addr[3] = OPCODE_BCTR ();
+		MODIFIED_CODE_NOQUEUE (reloc_addr + 3);
+	      }
+	  }
+      }
+      break;
+
+    default:
+      _dl_reloc_bad_type (map, rinfo, 0);
+      return;
+    }
+
+  MODIFIED_CODE_NOQUEUE (reloc_addr);
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/dl-machine.h ../glibc-2.3/sysdeps/powerpc/powerpc32/dl-machine.h
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/dl-machine.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/dl-machine.h	Thu Sep  5 04:24:49 2002
@@ -0,0 +1,418 @@
+/* Machine-dependent ELF dynamic relocation inline functions.  PowerPC version.
+   Copyright (C) 1995-2000,01,02 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef dl_machine_h
+#define dl_machine_h
+
+#define ELF_MACHINE_NAME "powerpc"
+
+#include <assert.h>
+
+/* Return nonzero iff ELF header is compatible with the running host.  */
+static inline int
+elf_machine_matches_host (const Elf32_Ehdr *ehdr)
+{
+  return ehdr->e_machine == EM_PPC;
+}
+
+
+/* Return the link-time address of _DYNAMIC, stored as
+   the first value in the GOT. */
+static inline Elf32_Addr
+elf_machine_dynamic (void)
+{
+  Elf32_Addr *got;
+  asm (" bl _GLOBAL_OFFSET_TABLE_-4@local"
+       : "=l"(got));
+  return *got;
+}
+
+/* Return the run-time load address of the shared object.  */
+static inline Elf32_Addr
+elf_machine_load_address (void)
+{
+  unsigned int *got;
+  unsigned int *branchaddr;
+
+  /* This is much harder than you'd expect.  Possibly I'm missing something.
+     The 'obvious' way:
+
+       Apparently, "bcl 20,31,$+4" is what should be used to load LR
+       with the address of the next instruction.
+       I think this is so that machines that do bl/blr pairing don't
+       get confused.
+
+     asm ("bcl 20,31,0f ;"
+	  "0: mflr 0 ;"
+	  "lis %0,0b@ha;"
+	  "addi %0,%0,0b@l;"
+	  "subf %0,%0,0"
+	  : "=b" (addr) : : "r0", "lr");
+
+     doesn't work, because the linker doesn't have to (and in fact doesn't)
+     update the @ha and @l references; the loader (which runs after this
+     code) will do that.
+
+     Instead, we use the following trick:
+
+     The linker puts the _link-time_ address of _DYNAMIC at the first
+     word in the GOT. We could branch to that address, if we wanted,
+     by using an @local reloc; the linker works this out, so it's safe
+     to use now. We can't, of course, actually branch there, because
+     we'd cause an illegal instruction exception; so we need to compute
+     the address ourselves. That gives us the following code: */
+
+  /* Get address of the 'b _DYNAMIC@local'...  */
+  asm ("bl 0f ;"
+       "b _DYNAMIC@local;"
+       "0:"
+       : "=l"(branchaddr));
+
+  /* ... and the address of the GOT.  */
+  asm (" bl _GLOBAL_OFFSET_TABLE_-4@local"
+       : "=l"(got));
+
+  /* So now work out the difference between where the branch actually points,
+     and the offset of that location in memory from the start of the file.  */
+  return ((Elf32_Addr)branchaddr - *got
+	  + ((int)(*branchaddr << 6 & 0xffffff00) >> 6));
+}
+
+#define ELF_MACHINE_BEFORE_RTLD_RELOC(dynamic_info) /* nothing */
+
+/* The PLT uses Elf32_Rela relocs.  */
+#define elf_machine_relplt elf_machine_rela
+
+/* This code is used in dl-runtime.c to call the `fixup' function
+   and then redirect to the address it returns.  It is called
+   from code built in the PLT by elf_machine_runtime_setup.  */
+#if !defined PROF
+#define ELF_MACHINE_RUNTIME_TRAMPOLINE asm ("\n\
+	.section \".text\"	\n\
+	.align 2	\n\
+	.globl _dl_runtime_resolve	\n\
+	.type _dl_runtime_resolve,@function	\n\
+_dl_runtime_resolve:	\n\
+ # We need to save the registers used to pass parameters, and register 0,\n\
+ # which is used by _mcount; the registers are saved in a stack frame.\n\
+	stwu 1,-64(1)	\n\
+	stw 0,12(1)	\n\
+	stw 3,16(1)	\n\
+	stw 4,20(1)	\n\
+ # The code that calls this has put parameters for `fixup' in r12 and r11.\n\
+	mr 3,12	\n\
+	stw 5,24(1)	\n\
+	mr 4,11	\n\
+	stw 6,28(1)	\n\
+	mflr 0	\n\
+ # We also need to save some of the condition register fields.\n\
+	stw 7,32(1)	\n\
+	stw 0,48(1)	\n\
+	stw 8,36(1)	\n\
+	mfcr 0	\n\
+	stw 9,40(1)	\n\
+	stw 10,44(1)	\n\
+	stw 0,8(1)	\n\
+	bl fixup@local	\n\
+ # 'fixup' returns the address we want to branch to.\n\
+	mtctr 3	\n\
+ # Put the registers back...\n\
+	lwz 0,48(1)	\n\
+	lwz 10,44(1)	\n\
+	lwz 9,40(1)	\n\
+	mtlr 0	\n\
+	lwz 8,36(1)	\n\
+	lwz 0,8(1)	\n\
+	lwz 7,32(1)	\n\
+	lwz 6,28(1)	\n\
+	mtcrf 0xFF,0	\n\
+	lwz 5,24(1)	\n\
+	lwz 4,20(1)	\n\
+	lwz 3,16(1)	\n\
+	lwz 0,12(1)	\n\
+ # ...unwind the stack frame, and jump to the PLT entry we updated.\n\
+	addi 1,1,64	\n\
+	bctr	\n\
+	.size	 _dl_runtime_resolve,.-_dl_runtime_resolve	\n\
+	\n\
+	.align 2	\n\
+	.globl _dl_prof_resolve	\n\
+	.type _dl_prof_resolve,@function	\n\
+_dl_prof_resolve:	\n\
+ # We need to save the registers used to pass parameters, and register 0,\n\
+ # which is used by _mcount; the registers are saved in a stack frame.\n\
+	stwu 1,-64(1)	\n\
+        stw 0,12(1)	\n\
+	stw 3,16(1)	\n\
+	stw 4,20(1)	\n\
+ # The code that calls this has put parameters for `fixup' in r12 and r11.\n\
+	mr 3,12	\n\
+	stw 5,24(1)	\n\
+	mr 4,11	\n\
+	stw 6,28(1)	\n\
+	mflr 5	\n\
+ # We also need to save some of the condition register fields.\n\
+	stw 7,32(1)	\n\
+	stw 5,48(1)	\n\
+	stw 8,36(1)	\n\
+	mfcr 0	\n\
+	stw 9,40(1)	\n\
+	stw 10,44(1)	\n\
+	stw 0,8(1)	\n\
+	bl profile_fixup@local	\n\
+ # 'fixup' returns the address we want to branch to.\n\
+	mtctr 3	\n\
+ # Put the registers back...\n\
+	lwz 0,48(1)	\n\
+	lwz 10,44(1)	\n\
+	lwz 9,40(1)	\n\
+	mtlr 0	\n\
+	lwz 8,36(1)	\n\
+	lwz 0,8(1)	\n\
+	lwz 7,32(1)	\n\
+	lwz 6,28(1)	\n\
+	mtcrf 0xFF,0	\n\
+	lwz 5,24(1)	\n\
+	lwz 4,20(1)	\n\
+	lwz 3,16(1)	\n\
+        lwz 0,12(1)	\n\
+ # ...unwind the stack frame, and jump to the PLT entry we updated.\n\
+	addi 1,1,64	\n\
+	bctr	\n\
+	.size	 _dl_prof_resolve,.-_dl_prof_resolve	\n\
+ # Undo '.section text'.\n\
+	.previous	\n\
+");
+#else
+# define ELF_MACHINE_RUNTIME_TRAMPOLINE asm ("\n\
+	.section \".text\"	\n\
+	.align 2	\n\
+	.globl _dl_runtime_resolve	\n\
+	.globl _dl_prof_resolve	\n\
+	.type _dl_runtime_resolve,@function	\n\
+	.type _dl_prof_resolve,@function	\n\
+_dl_runtime_resolve:	\n\
+_dl_prof_resolve:	\n\
+ # We need to save the registers used to pass parameters, and register 0,\n\
+ # which is used by _mcount; the registers are saved in a stack frame.\n\
+	stwu 1,-64(1)	\n\
+	stw 0,12(1)	\n\
+	stw 3,16(1)	\n\
+	stw 4,20(1)	\n\
+ # The code that calls this has put parameters for `fixup' in r12 and r11.\n\
+	mr 3,12	\n\
+	stw 5,24(1)	\n\
+	mr 4,11	\n\
+	stw 6,28(1)	\n\
+	mflr 0	\n\
+ # We also need to save some of the condition register fields.\n\
+	stw 7,32(1)	\n\
+	stw 0,48(1)	\n\
+	stw 8,36(1)	\n\
+	mfcr 0	\n\
+	stw 9,40(1)	\n\
+	stw 10,44(1)	\n\
+	stw 0,8(1)	\n\
+	bl fixup@local	\n\
+ # 'fixup' returns the address we want to branch to.\n\
+	mtctr 3	\n\
+ # Put the registers back...\n\
+	lwz 0,48(1)	\n\
+	lwz 10,44(1)	\n\
+	lwz 9,40(1)	\n\
+	mtlr 0	\n\
+	lwz 8,36(1)	\n\
+	lwz 0,8(1)	\n\
+	lwz 7,32(1)	\n\
+	lwz 6,28(1)	\n\
+	mtcrf 0xFF,0	\n\
+	lwz 5,24(1)	\n\
+	lwz 4,20(1)	\n\
+	lwz 3,16(1)	\n\
+	lwz 0,12(1)	\n\
+ # ...unwind the stack frame, and jump to the PLT entry we updated.\n\
+	addi 1,1,64	\n\
+	bctr	\n\
+	.size	 _dl_runtime_resolve,.-_dl_runtime_resolve	\n\
+");
+#endif
+
+/* Mask identifying addresses reserved for the user program,
+   where the dynamic linker should not map anything.  */
+#define ELF_MACHINE_USER_ADDRESS_MASK	0xf0000000UL
+
+/* The actual _start code is in dl-start.S.  Use a really
+   ugly bit of assembler to let dl-start.o see _dl_start.  */
+#define RTLD_START asm (".globl _dl_start");
+
+/* Decide where a relocatable object should be loaded.  */
+extern ElfW(Addr)
+__elf_preferred_address(struct link_map *loader, size_t maplength,
+			ElfW(Addr) mapstartpref);
+#define ELF_PREFERRED_ADDRESS(loader, maplength, mapstartpref) \
+  __elf_preferred_address (loader, maplength, mapstartpref)
+
+/* ELF_RTYPE_CLASS_PLT iff TYPE describes relocation of a PLT entry, so
+   PLT entries should not be allowed to define the value.
+   ELF_RTYPE_CLASS_NOCOPY iff TYPE should not be allowed to resolve to one
+   of the main executable's symbols, as for a COPY reloc.  */
+/* We never want to use a PLT entry as the destination of a
+   reloc, when what is being relocated is a branch. This is
+   partly for efficiency, but mostly so we avoid loops.  */
+#define elf_machine_type_class(type) \
+  ((((type) == R_PPC_JMP_SLOT				\
+    || (type) == R_PPC_REL24				\
+    || (type) == R_PPC_ADDR24) * ELF_RTYPE_CLASS_PLT)	\
+   | (((type) == R_PPC_COPY) * ELF_RTYPE_CLASS_COPY))
+
+/* A reloc type used for ld.so cmdline arg lookups to reject PLT entries.  */
+#define ELF_MACHINE_JMP_SLOT	R_PPC_JMP_SLOT
+
+/* The PowerPC never uses REL relocations.  */
+#define ELF_MACHINE_NO_REL 1
+
+/* Set up the loaded object described by L so its unrelocated PLT
+   entries will jump to the on-demand fixup code in dl-runtime.c.
+   Also install a small trampoline to be used by entries that have
+   been relocated to an address too far away for a single branch.  */
+extern int __elf_machine_runtime_setup (struct link_map *map,
+					int lazy, int profile);
+#define elf_machine_runtime_setup __elf_machine_runtime_setup
+
+static inline void
+elf_machine_lazy_rel (struct link_map *map,
+		      Elf32_Addr l_addr, const Elf32_Rela *reloc)
+{
+  /* elf_machine_runtime_setup handles this. */
+}
+
+/* Change the PLT entry whose reloc is 'reloc' to call the actual routine.  */
+extern Elf32_Addr __elf_machine_fixup_plt (struct link_map *map,
+					   const Elf32_Rela *reloc,
+					   Elf32_Addr *reloc_addr,
+					   Elf32_Addr finaladdr);
+
+static inline Elf32_Addr
+elf_machine_fixup_plt (struct link_map *map, lookup_t t,
+		       const Elf32_Rela *reloc,
+		       Elf32_Addr *reloc_addr, Elf64_Addr finaladdr)
+{
+  return __elf_machine_fixup_plt (map, reloc, reloc_addr, finaladdr);
+}
+
+/* Return the final value of a plt relocation.  */
+static inline Elf32_Addr
+elf_machine_plt_value (struct link_map *map, const Elf32_Rela *reloc,
+		       Elf32_Addr value)
+{
+  return value + reloc->r_addend;
+}
+
+#endif /* dl_machine_h */
+
+#ifdef RESOLVE
+
+/* Do the actual processing of a reloc, once its target address
+   has been determined.  */
+extern void __process_machine_rela (struct link_map *map,
+				    const Elf32_Rela *reloc,
+				    const Elf32_Sym *sym,
+				    const Elf32_Sym *refsym,
+				    Elf32_Addr *const reloc_addr,
+				    Elf32_Addr finaladdr,
+				    int rinfo);
+
+/* Perform the relocation specified by RELOC and SYM (which is fully resolved).
+   LOADADDR is the load address of the object; INFO is an array indexed
+   by DT_* of the .dynamic section info.  */
+
+inline void
+elf_machine_rela (struct link_map *map, const Elf32_Rela *reloc,
+		  const Elf32_Sym *sym, const struct r_found_version *version,
+		  Elf32_Addr *const reloc_addr)
+{
+  const Elf32_Sym *const refsym = sym;
+  Elf32_Word finaladdr;
+  const int rinfo = ELF32_R_TYPE (reloc->r_info);
+
+#ifndef RESOLVE_CONFLICT_FIND_MAP
+  if (__builtin_expect (rinfo == R_PPC_NONE, 0))
+    return;
+
+  /* The condition on the next two lines is a hack around a bug in Solaris
+     tools on Sparc.  It's not clear whether it should really be here at all,
+     but if not the binutils need to be changed.  */
+  if (rinfo == R_PPC_RELATIVE
+      || (sym->st_shndx != SHN_UNDEF
+	  && ELF32_ST_BIND (sym->st_info) == STB_LOCAL))
+    {
+      /* Has already been relocated.  */
+      Elf32_Word loadbase = map->l_addr;
+      finaladdr = loadbase + reloc->r_addend;
+    }
+  else
+    {
+      Elf32_Word loadbase
+	= (Elf32_Word) (char *) (RESOLVE (&sym, version,
+					  ELF32_R_TYPE(reloc->r_info)));
+      if (sym == NULL)
+	{
+	  /* Weak symbol that wasn't actually defined anywhere.  */
+	  assert (loadbase == 0);
+	  finaladdr = reloc->r_addend;
+	}
+      else
+	finaladdr = (loadbase + (Elf32_Word) (char *) sym->st_value
+		     + reloc->r_addend);
+    }
+#else
+  finaladdr = reloc->r_addend;
+  if (rinfo == R_PPC_JMP_SLOT)
+    RESOLVE_CONFLICT_FIND_MAP (map, reloc_addr);
+#endif
+
+  /* A small amount of code is duplicated here for speed.  In libc,
+     more than 90% of the relocs are R_PPC_RELATIVE; in the X11 shared
+     libraries, 60% are R_PPC_RELATIVE, 24% are R_PPC_GLOB_DAT or
+     R_PPC_ADDR32, and 16% are R_PPC_JMP_SLOT (which this routine
+     wouldn't usually handle).  As an bonus, doing this here allows
+     the switch statement in __process_machine_rela to work.  */
+  if (rinfo == R_PPC_RELATIVE
+      || rinfo == R_PPC_GLOB_DAT
+      || rinfo == R_PPC_ADDR32)
+    {
+      *reloc_addr = finaladdr;
+    }
+  else
+    __process_machine_rela (map, reloc, sym, refsym,
+			    reloc_addr, finaladdr, rinfo);
+}
+
+static inline void
+elf_machine_rela_relative (Elf32_Addr l_addr, const Elf32_Rela *reloc,
+			   Elf32_Addr *const reloc_addr)
+{
+  *reloc_addr = l_addr + reloc->r_addend;
+}
+
+/* The SVR4 ABI specifies that the JMPREL relocs must be inside the
+   DT_RELA table.  */
+#define ELF_MACHINE_PLTREL_OVERLAP 1
+
+#endif /* RESOLVE */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/dl-start.S ../glibc-2.3/sysdeps/powerpc/powerpc32/dl-start.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/dl-start.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/dl-start.S	Thu Sep  5 04:30:15 2002
@@ -0,0 +1,105 @@
+/* Machine-dependent ELF startup code.  PowerPC version.
+   Copyright (C) 1995-2000, 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+
+/* Initial entry point code for the dynamic linker.
+   The C function `_dl_start' is the real entry point;
+   its return value is the user program's entry point.	*/
+ENTRY(_start)
+/* We start with the following on the stack, from top:
+   argc (4 bytes);
+   arguments for program (terminated by NULL);
+   environment variables (terminated by NULL);
+   arguments for the program loader. */
+
+/* Call _dl_start with one parameter pointing at argc */
+	mr	r3,r1
+/* (we have to frob the stack pointer a bit to allow room for
+   _dl_start to save the link register).  */
+	li	r4,0
+	addi	r1,r1,-16
+	stw	r4,0(r1)
+	bl	_dl_start@local
+
+	/* FALLTHRU */
+ENTRY(_dl_start_user)
+/* Now, we do our main work of calling initialisation procedures.
+   The ELF ABI doesn't say anything about parameters for these,
+   so we just pass argc, argv, and the environment.
+   Changing these is strongly discouraged (not least because argc is
+   passed by value!).  */
+
+/*  Put our GOT pointer in r31, */
+	bl	_GLOBAL_OFFSET_TABLE_-4@local
+	mflr	r31
+/*  the address of _start in r30, */
+	mr	r30,r3
+/*  &_dl_argc in 29, &_dl_argv in 27, and _dl_loaded in 28.  */
+	lwz	r28,_rtld_global@got(r31)
+	lwz	r29,_dl_argc@got(r31)
+	lwz	r27,_dl_argv@got(r31)
+
+/* Call _dl_init (_dl_loaded, _dl_argc, _dl_argv, _dl_argv+_dl_argc+1). */
+	lwz	r3,0(r28)
+	lwz	r4,0(r29)
+	lwz	r5,0(r27)
+	slwi	r6,r4,2
+	add	r6,r5,r6
+	addi	r6,r6,4
+	bl	_dl_init_internal@local
+
+/* Now, to conform to the ELF ABI, we have to: */
+/* Pass argc (actually _dl_argc) in r3; */
+	lwz	r3,0(r29)
+/* pass argv (actually _dl_argv) in r4; */
+	lwz	r4,0(r27)
+/* pass envp (actually _dl_argv+_dl_argc+1) in r5; */
+	slwi	r5,r3,2
+	add	r6,r4,r5
+	addi	r5,r6,4
+/* pass the auxilary vector in r6. This is passed to us just after _envp.  */
+2:	lwzu	r0,4(r6)
+	cmpwi	r0,0
+	bne	2b
+	addi	r6,r6,4
+/* Pass a termination function pointer (in this case _dl_fini) in r7.  */
+	lwz	r7,_dl_fini@got(r31)
+/* Now, call the start function in r30... */
+	mtctr	r30
+	lwz	r26,_dl_starting_up@got(r31)
+/* Pass the stack pointer in r1 (so far so good), pointing to a NULL value.
+   (This lets our startup code distinguish between a program linked statically,
+   which linux will call with argc on top of the stack which will hopefully
+   never be zero, and a dynamically linked program which will always have
+   a NULL on the top of the stack).
+   Take the opportunity to clear LR, so anyone who accidentally returns
+   from _start gets SEGV.  Also clear the next few words of the stack.  */
+
+	li	r31,0
+	stw	r31,0(r1)
+	mtlr	r31
+	stw	r31,4(r1)
+	stw	r31,8(r1)
+	stw	r31,12(r1)
+/* Clear _dl_starting_up.  */
+	stw	r31,0(r26)
+/* Go do it!  */
+	bctr
+END(_start)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/elf/bzero.S ../glibc-2.3/sysdeps/powerpc/powerpc32/elf/bzero.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/elf/bzero.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/elf/bzero.S	Thu Sep  5 04:45:56 2002
@@ -0,0 +1,37 @@
+/* Optimized bzero `implementation' for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+
+ENTRY (BP_SYM (__bzero))
+
+#if __BOUNDED_POINTERS__
+	mr	r6,r4
+	li	r5,0
+	mr	r4,r3
+	/* Tell memset that we don't want a return value.  */
+	li	r3,0
+#else
+	mr	r5,r4
+	li	r4,0
+#endif
+	b	BP_SYM (memset)@local
+END (BP_SYM (__bzero))
+weak_alias (BP_SYM (__bzero), BP_SYM (bzero))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/elf/start.S ../glibc-2.3/sysdeps/powerpc/powerpc32/elf/start.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/elf/start.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/elf/start.S	Thu Sep  5 04:46:13 2002
@@ -0,0 +1,57 @@
+/* Startup code for programs linked with GNU libc.
+   Copyright (C) 1998, 1999, 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include "bp-sym.h"
+
+ /* These are the various addresses we require.  */
+	.section ".rodata"
+	.align	2
+	weak_extern(_init)
+	weak_extern(_fini)
+L(start_addresses):
+	.long	_SDA_BASE_
+	.long	JUMPTARGET(BP_SYM (main))
+	.long 	JUMPTARGET(_init)
+	.long 	JUMPTARGET(_fini)
+	ASM_SIZE_DIRECTIVE(L(start_addresses))
+
+	.section ".text"
+ENTRY(_start)
+ /* Save the stack pointer, in case we're statically linked under Linux.  */
+	mr	r9,r1
+ /* Set up an initial stack frame, and clear the LR.  */
+	clrrwi	r1,r1,4
+	li	r0,0
+	stwu	r1,-16(r1)
+	mtlr	r0
+	stw	r0,0(r1)
+ /* Set r13 to point at the 'small data area', and put the address of
+    start_addresses in r8...  */
+	lis	r8,L(start_addresses)@ha
+	lwzu	r13,L(start_addresses)@l(r8)
+ /* and continue in libc-start, in glibc.  */
+	b	JUMPTARGET(BP_SYM (__libc_start_main))
+END(_start)
+
+/* Define a symbol for the first piece of initialized data.  */
+	.section ".data"
+	.globl	__data_start
+__data_start:
+weak_alias (__data_start, data_start)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/Makefile ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/Makefile
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/Makefile	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/Makefile	Thu Sep  5 05:57:11 2002
@@ -0,0 +1,3 @@
+ifeq ($(subdir),misc)
+sysdep_routines += fprsave fprrest
+endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/__longjmp.S ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/__longjmp.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/__longjmp.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/__longjmp.S	Thu Sep  5 04:58:45 2002
@@ -0,0 +1,74 @@
+/* longjmp for PowerPC.
+   Copyright (C) 1995, 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#define _ASM
+#define _SETJMP_H
+#include <bits/setjmp.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+ENTRY (BP_SYM (__longjmp))
+	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
+
+	lwz r1,(JB_GPR1*4)(r3)
+	lwz r2,(JB_GPR2*4)(r3)
+	lwz r0,(JB_LR*4)(r3)
+	lwz r14,((JB_GPRS+0)*4)(r3)
+	lfd fp14,((JB_FPRS+0*2)*4)(r3)
+	lwz r15,((JB_GPRS+1)*4)(r3)
+	lfd fp15,((JB_FPRS+1*2)*4)(r3)
+	lwz r16,((JB_GPRS+2)*4)(r3)
+	lfd fp16,((JB_FPRS+2*2)*4)(r3)
+	lwz r17,((JB_GPRS+3)*4)(r3)
+	lfd fp17,((JB_FPRS+3*2)*4)(r3)
+	lwz r18,((JB_GPRS+4)*4)(r3)
+	lfd fp18,((JB_FPRS+4*2)*4)(r3)
+	lwz r19,((JB_GPRS+5)*4)(r3)
+	lfd fp19,((JB_FPRS+5*2)*4)(r3)
+	lwz r20,((JB_GPRS+6)*4)(r3)
+	lfd fp20,((JB_FPRS+6*2)*4)(r3)
+	mtlr r0
+	lwz r21,((JB_GPRS+7)*4)(r3)
+	lfd fp21,((JB_FPRS+7*2)*4)(r3)
+	lwz r22,((JB_GPRS+8)*4)(r3)
+	lfd fp22,((JB_FPRS+8*2)*4)(r3)
+	lwz r0,(JB_CR*4)(r3)
+	lwz r23,((JB_GPRS+9)*4)(r3)
+	lfd fp23,((JB_FPRS+9*2)*4)(r3)
+	lwz r24,((JB_GPRS+10)*4)(r3)
+	lfd fp24,((JB_FPRS+10*2)*4)(r3)
+	lwz r25,((JB_GPRS+11)*4)(r3)
+	lfd fp25,((JB_FPRS+11*2)*4)(r3)
+	mtcrf 0xFF,r0
+	lwz r26,((JB_GPRS+12)*4)(r3)
+	lfd fp26,((JB_FPRS+12*2)*4)(r3)
+	lwz r27,((JB_GPRS+13)*4)(r3)
+	lfd fp27,((JB_FPRS+13*2)*4)(r3)
+	lwz r28,((JB_GPRS+14)*4)(r3)
+	lfd fp28,((JB_FPRS+14*2)*4)(r3)
+	lwz r29,((JB_GPRS+15)*4)(r3)
+	lfd fp29,((JB_FPRS+15*2)*4)(r3)
+	lwz r30,((JB_GPRS+16)*4)(r3)
+	lfd fp30,((JB_FPRS+16*2)*4)(r3)
+	lwz r31,((JB_GPRS+17)*4)(r3)
+	lfd fp31,((JB_FPRS+17*2)*4)(r3)
+	mr r3,r4
+	blr
+END (BP_SYM (__longjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/fprrest.S ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/fprrest.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/fprrest.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/fprrest.S	Thu Sep  5 04:59:21 2002
@@ -0,0 +1,94 @@
+/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+    Floating Point Registers (FPRs) restore routine
+*/
+
+#include <sysdep.h>
+
+ENTRY(_restfpr_all)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf14)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_14)
+C_TEXT(_restf14):
+C_TEXT(_restfpr_14):	lfd	fp14,-144(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf15)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_15)
+C_TEXT(_restf15):
+C_TEXT(_restfpr_15):	lfd	fp15,-136(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf16)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_16)
+C_TEXT(_restf16):
+C_TEXT(_restfpr_16):	lfd	fp16,-128(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf17)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_17)
+C_TEXT(_restf17):
+C_TEXT(_restfpr_17):	lfd	fp17,-120(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf18)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_18)
+C_TEXT(_restf18):
+C_TEXT(_restfpr_18):	lfd	fp18,-112(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf19)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_19)
+C_TEXT(_restf19):
+C_TEXT(_restfpr_19):	lfd	fp19,-104(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf20)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_20)
+C_TEXT(_restf20):
+C_TEXT(_restfpr_20):	lfd	fp20,-96(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf21)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_21)
+C_TEXT(_restf21):
+C_TEXT(_restfpr_21):	lfd	fp21,-88(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf22)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_22)
+C_TEXT(_restf22):
+C_TEXT(_restfpr_22):	lfd	fp22,-80(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf23)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_23)
+C_TEXT(_restf23):
+C_TEXT(_restfpr_23):	lfd	fp23,-72(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf24)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_24)
+C_TEXT(_restf24):
+C_TEXT(_restfpr_24):	lfd	fp24,-64(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf25)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_25)
+C_TEXT(_restf25):
+C_TEXT(_restfpr_25):	lfd	fp25,-56(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf26)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_26)
+C_TEXT(_restf26):
+C_TEXT(_restfpr_26):	lfd	fp26,-48(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf27)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_27)
+C_TEXT(_restf27):
+C_TEXT(_restfpr_27):	lfd	fp27,-40(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf28)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_28)
+C_TEXT(_restf28):
+C_TEXT(_restfpr_28):	lfd	fp28,-32(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restf29)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restfpr_29)
+C_TEXT(_restf29):
+C_TEXT(_restfpr_29):	lwz	r0,8(r1)	#get return address from frame
+			lfd	fp29,-24(r1)    #restore f29
+			mtlr	r0		#move return address to LR
+			lfd	fp30,-16(r1)	#restore f30
+			lfd	fp31,-8(r1)	#restore f31
+			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/fprsave.S ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/fprsave.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/fprsave.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/fprsave.S	Thu Sep  5 04:59:40 2002
@@ -0,0 +1,93 @@
+/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+    Floating Point Registers (FPRs) save routine
+*/
+
+#include <sysdep.h>
+
+ENTRY(_savefpr_all)
+                ASM_GLOBAL_DIRECTIVE C_TEXT(_savef14)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_14)
+C_TEXT(_savef14):
+C_TEXT(_savefpr_14):	stfd	fp14,-144(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef15)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_15)
+C_TEXT(_savef15):
+C_TEXT(_savefpr_15):	stfd	fp15,-136(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef16)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_16)
+C_TEXT(_savef16):
+C_TEXT(_savefpr_16):	stfd	fp16,-128(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef17)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_17)
+C_TEXT(_savef17):
+C_TEXT(_savefpr_17):	stfd	fp17,-120(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef18)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_18)
+C_TEXT(_savef18):
+C_TEXT(_savefpr_18):	stfd	fp18,-112(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef19)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_19)
+C_TEXT(_savef19):
+C_TEXT(_savefpr_19):	stfd	fp19,-104(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef20)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_20)
+C_TEXT(_savef20):
+C_TEXT(_savefpr_20):	stfd	fp20,-96(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef21)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_21)
+C_TEXT(_savef21):
+C_TEXT(_savefpr_21):	stfd	fp21,-88(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef22)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_22)
+C_TEXT(_savef22):
+C_TEXT(_savefpr_22):	stfd	fp22,-80(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef23)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_23)
+C_TEXT(_savef23):
+C_TEXT(_savefpr_23):	stfd	fp23,-72(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef24)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_24)
+C_TEXT(_savef24):
+C_TEXT(_savefpr_24):	stfd	fp24,-64(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef25)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_25)
+C_TEXT(_savef25):
+C_TEXT(_savefpr_25):	stfd	fp25,-56(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef26)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_26)
+C_TEXT(_savef26):
+C_TEXT(_savefpr_26):	stfd	fp26,-48(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef27)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_27)
+C_TEXT(_savef27):
+C_TEXT(_savefpr_27):	stfd	fp27,-40(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef28)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_28)
+C_TEXT(_savef28):
+C_TEXT(_savefpr_28):	stfd	fp28,-32(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savef29)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savefpr_29)
+C_TEXT(_savef29):
+C_TEXT(_savefpr_29):	stfd	fp29,-24(r1)	#save f29
+			stfd	fp30,-16(r1)	#save f30
+			stfd	fp31,-8(r1)	#save f31
+			stw	r0,8(r1)	#save LR in callers frame
+			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/s_copysign.S ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/s_copysign.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/s_copysign.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/s_copysign.S	Thu Sep  5 05:00:22 2002
@@ -0,0 +1,50 @@
+/* Copy a sign bit between floating-point values.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/* This has been coded in assembler because GCC makes such a mess of it
+   when it's coded in C.  */
+
+#include <sysdep.h>
+
+ENTRY(__copysign)
+/* double [f1] copysign (double [f1] x, double [f2] y);
+   copysign(x,y) returns a value with the magnitude of x and
+   with the sign bit of y.  */
+	stwu	r1,-16(r1)
+	stfd	fp2,8(r1)
+	lwz	r3,8(r1)
+	cmpwi   r3,0
+	addi    r1,r1,16
+	blt     L(0)
+	fabs    fp1,fp1
+	blr
+L(0):	fnabs   fp1,fp1
+	blr
+	END (__copysign)
+
+weak_alias(__copysign,copysign)
+
+/* It turns out that it's safe to use this code even for single-precision.  */
+weak_alias(__copysign,copysignf)
+strong_alias(__copysign,__copysignf)
+
+#ifdef NO_LONG_DOUBLE
+weak_alias(__copysign,copysignl)
+strong_alias(__copysign,__copysignl)
+#endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/s_copysignf.S ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/s_copysignf.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/s_copysignf.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/s_copysignf.S	Thu Sep  5 05:00:36 2002
@@ -0,0 +1 @@
+/* __copysignf is in s_copysign.S  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/setjmp.S ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/fpu/setjmp.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/fpu/setjmp.S	Thu Sep  5 05:00:00 2002
@@ -0,0 +1,73 @@
+/* setjmp for PowerPC.
+   Copyright (C) 1995, 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#define _ASM
+#define _SETJMP_H
+#include <bits/setjmp.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+ENTRY (BP_SYM (__sigsetjmp))
+	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
+
+	stw  r1,(JB_GPR1*4)(3)
+	mflr r0
+	stw  r2,(JB_GPR2*4)(3)
+	stw  r14,((JB_GPRS+0)*4)(3)
+	stfd fp14,((JB_FPRS+0*2)*4)(3)
+	stw  r0,(JB_LR*4)(3)
+	stw  r15,((JB_GPRS+1)*4)(3)
+	stfd fp15,((JB_FPRS+1*2)*4)(3)
+	mfcr r0
+	stw  r16,((JB_GPRS+2)*4)(3)
+	stfd fp16,((JB_FPRS+2*2)*4)(3)
+	stw  r0,(JB_CR*4)(3)
+	stw  r17,((JB_GPRS+3)*4)(3)
+	stfd fp17,((JB_FPRS+3*2)*4)(3)
+	stw  r18,((JB_GPRS+4)*4)(3)
+	stfd fp18,((JB_FPRS+4*2)*4)(3)
+	stw  r19,((JB_GPRS+5)*4)(3)
+	stfd fp19,((JB_FPRS+5*2)*4)(3)
+	stw  r20,((JB_GPRS+6)*4)(3)
+	stfd fp20,((JB_FPRS+6*2)*4)(3)
+	stw  r21,((JB_GPRS+7)*4)(3)
+	stfd fp21,((JB_FPRS+7*2)*4)(3)
+	stw  r22,((JB_GPRS+8)*4)(3)
+	stfd fp22,((JB_FPRS+8*2)*4)(3)
+	stw  r23,((JB_GPRS+9)*4)(3)
+	stfd fp23,((JB_FPRS+9*2)*4)(3)
+	stw  r24,((JB_GPRS+10)*4)(3)
+	stfd fp24,((JB_FPRS+10*2)*4)(3)
+	stw  r25,((JB_GPRS+11)*4)(3)
+	stfd fp25,((JB_FPRS+11*2)*4)(3)
+	stw  r26,((JB_GPRS+12)*4)(3)
+	stfd fp26,((JB_FPRS+12*2)*4)(3)
+	stw  r27,((JB_GPRS+13)*4)(3)
+	stfd fp27,((JB_FPRS+13*2)*4)(3)
+	stw  r28,((JB_GPRS+14)*4)(3)
+	stfd fp28,((JB_FPRS+14*2)*4)(3)
+	stw  r29,((JB_GPRS+15)*4)(3)
+	stfd fp29,((JB_FPRS+15*2)*4)(3)
+	stw  r30,((JB_GPRS+16)*4)(3)
+	stfd fp30,((JB_FPRS+16*2)*4)(3)
+	stw  r31,((JB_GPRS+17)*4)(3)
+	stfd fp31,((JB_FPRS+17*2)*4)(3)
+	b JUMPTARGET (BP_SYM (__sigjmp_save))
+END (BP_SYM (__sigsetjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/gprrest0.S ../glibc-2.3/sysdeps/powerpc/powerpc32/gprrest0.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/gprrest0.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/gprrest0.S	Thu Sep  5 04:39:15 2002
@@ -0,0 +1,69 @@
+/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+    General Purpose Register (GPR) restore routine
+    when Floating Point Registers (FPRs) are not saved
+
+    Note: This restore routine must not be called when GPR30 or
+    GPR31, or both, are the only registers beings saved. In these
+    cases, the saving and restoring must be done inline.
+*/
+
+#include <sysdep.h>
+
+ENTRY(_restgpr0_all)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_13)
+C_TEXT(_restgpr0_13):	lwz	r13,-76(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_14)
+C_TEXT(_restgpr0_14):	lwz	r14,-72(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_15)
+C_TEXT(_restgpr0_15):	lwz	r15,-68(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_16)
+C_TEXT(_restgpr0_16):	lwz	r16,-64(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_17)
+C_TEXT(_restgpr0_17):	lwz	r17,-60(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_18)
+C_TEXT(_restgpr0_18):	lwz	r18,-56(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_19)
+C_TEXT(_restgpr0_19):	lwz	r19,-52(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_20)
+C_TEXT(_restgpr0_20):	lwz	r20,-48(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_21)
+C_TEXT(_restgpr0_21):	lwz	r21,-44(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_22)
+C_TEXT(_restgpr0_22):	lwz	r22,-40(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_23)
+C_TEXT(_restgpr0_23):	lwz	r23,-36(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_24)
+C_TEXT(_restgpr0_24):	lwz	r24,-32(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_25)
+C_TEXT(_restgpr0_25):	lwz	r25,-28(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_26)
+C_TEXT(_restgpr0_26):	lwz	r26,-24(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_27)
+C_TEXT(_restgpr0_27):	lwz	r27,-20(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_28)
+C_TEXT(_restgpr0_28):	lwz	r28,-16(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_restgpr0_29)
+C_TEXT(_restgpr0_29):	lwz	r0,8(r1)	#get return address from frame
+			lwz	r29,-12(r1)	#restore r29
+			mtlr	r0		#move return address to LR
+			lwz	r30,-8(r1)	#restore r30
+			lwz	r31,-4(r1)	#restore r31
+			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/gprrest1.S ../glibc-2.3/sysdeps/powerpc/powerpc32/gprrest1.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/gprrest1.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/gprrest1.S	Thu Sep  5 04:40:02 2002
@@ -0,0 +1,63 @@
+/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+    General Purpose Register (GPR) restore routine
+    when Floating Point Registers (FPRs) are saved
+*/
+
+#include <sysdep.h>
+
+ENTRY(_restgpr1_all)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_13)
+C_TEXT(_restgpr1_13):	lwz	r13,-76(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_14)
+C_TEXT(_restgpr1_14):	lwz	r14,-72(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_15)
+C_TEXT(_restgpr1_15):	lwz	r15,-68(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_16)
+C_TEXT(_restgpr1_16):	lwz	r16,-64(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_17)
+C_TEXT(_restgpr1_17):	lwz	r17,-60(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_18)
+C_TEXT(_restgpr1_18):	lwz	r18,-56(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_19)
+C_TEXT(_restgpr1_19):	lwz	r19,-52(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_20)
+C_TEXT(_restgpr1_20):	lwz	r20,-48(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_21)
+C_TEXT(_restgpr1_21):	lwz	r21,-44(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_22)
+C_TEXT(_restgpr1_22):	lwz	r22,-40(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_23)
+C_TEXT(_restgpr1_23):	lwz	r23,-36(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_24)
+C_TEXT(_restgpr1_24):	lwz	r24,-32(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_25)
+C_TEXT(_restgpr1_25):	lwz	r25,-28(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_26)
+C_TEXT(_restgpr1_26):	lwz	r26,-24(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_27)
+C_TEXT(_restgpr1_27):	lwz	r27,-20(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_28)
+C_TEXT(_restgpr1_28):	lwz	r28,-16(r12)
+		ASM_GLOBAL_DIRECTIVE	C_TEXT(_restgpr1_29)
+C_TEXT(_restgpr1_29):	lwz	r29,-12(r12)	#restore r29
+			lwz	r30,-8(r12)	#restore r30
+			lwz	r31,-4(r12)	#restore r31
+			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/gprsave0.S ../glibc-2.3/sysdeps/powerpc/powerpc32/gprsave0.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/gprsave0.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/gprsave0.S	Thu Sep  5 04:40:20 2002
@@ -0,0 +1,68 @@
+/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+    General Purpose Register (GPR) save routine
+    when Floating Point Registers (FPRs) are not saved
+
+    Note: This save routine must not be called when GPR30 or
+    GPR31, or both, are the only registers beings saved. In these
+    cases, the saving and restoring must be done inline.
+*/
+
+#include <sysdep.h>
+
+ENTRY(_savegpr0_all)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_13)
+C_TEXT(_savegpr0_13):	stw	r13,-76(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_14)
+C_TEXT(_savegpr0_14):	stw	r14,-72(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_15)
+C_TEXT(_savegpr0_15):	stw	r15,-68(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_16)
+C_TEXT(_savegpr0_16):	stw	r16,-64(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_17)
+C_TEXT(_savegpr0_17):	stw	r17,-60(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_18)
+C_TEXT(_savegpr0_18):	stw	r18,-56(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_19)
+C_TEXT(_savegpr0_19):	stw	r19,-52(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_20)
+C_TEXT(_savegpr0_20):	stw	r20,-48(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_21)
+C_TEXT(_savegpr0_21):	stw	r21,-44(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_22)
+C_TEXT(_savegpr0_22):	stw	r22,-40(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_23)
+C_TEXT(_savegpr0_23):	stw	r23,-36(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_24)
+C_TEXT(_savegpr0_24):	stw	r24,-32(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_25)
+C_TEXT(_savegpr0_25):	stw	r25,-28(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_26)
+C_TEXT(_savegpr0_26):	stw	r26,-24(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_27)
+C_TEXT(_savegpr0_27):	stw	r27,-20(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_28)
+C_TEXT(_savegpr0_28):	stw	r28,-16(r1)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr0_29)
+C_TEXT(_savegpr0_29):	stw	r29,-12(r1) #save r29
+			stw	r30,-8(r1)  #save r30
+			stw	r31,-4(r1)  #save r31
+			stw	r0,8(r1)    #save LR in callers frame
+			blr		    #return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/gprsave1.S ../glibc-2.3/sysdeps/powerpc/powerpc32/gprsave1.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/gprsave1.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/gprsave1.S	Thu Sep  5 04:40:32 2002
@@ -0,0 +1,63 @@
+/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/*
+    General Purpose Register (GPR) save routine
+    when Floating Point Registers (FPRs) are saved
+*/
+
+#include <sysdep.h>
+
+ENTRY(_savegpr1_all)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_13)
+C_TEXT(_savegpr1_13):	stw	r13,-76(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_14)
+C_TEXT(_savegpr1_14):	stw	r14,-72(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_15)
+C_TEXT(_savegpr1_15):	stw	r15,-68(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_16)
+C_TEXT(_savegpr1_16):	stw	r16,-64(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_17)
+C_TEXT(_savegpr1_17):	stw	r17,-60(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_18)
+C_TEXT(_savegpr1_18):	stw	r18,-56(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_19)
+C_TEXT(_savegpr1_19):	stw	r19,-52(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_20)
+C_TEXT(_savegpr1_20):	stw	r20,-48(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_21)
+C_TEXT(_savegpr1_21):	stw	r21,-44(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_22)
+C_TEXT(_savegpr1_22):	stw	r22,-40(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_23)
+C_TEXT(_savegpr1_23):	stw	r23,-36(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_24)
+C_TEXT(_savegpr1_24):	stw	r24,-32(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_25)
+C_TEXT(_savegpr1_25):	stw	r25,-28(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_26)
+C_TEXT(_savegpr1_26):	stw	r26,-24(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_27)
+C_TEXT(_savegpr1_27):	stw	r27,-20(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_28)
+C_TEXT(_savegpr1_28):	stw	r28,-16(r12)
+		ASM_GLOBAL_DIRECTIVE C_TEXT(_savegpr1_29)
+C_TEXT(_savegpr1_29):	stw	r29,-12(r12)	#save r29
+			stw	r30,-8(r12)	#save r30
+			stw	r31,-4(r12)	#save r31
+			blr			#return
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/libgcc-compat.S ../glibc-2.3/sysdeps/powerpc/powerpc32/libgcc-compat.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/libgcc-compat.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/libgcc-compat.S	Thu Sep  5 04:31:16 2002
@@ -0,0 +1,144 @@
+/* pre-.hidden libgcc compatibility
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+	.file	"libgcc-compat.S"
+
+#include <shlib-compat.h>
+
+#if SHLIB_COMPAT (libc, GLIBC_2_0, GLIBC_2_2_6)
+
+#define __ashldi3_v_glibc20	INTUSE (__ashldi3)
+#define __ashrdi3_v_glibc20	INTUSE (__ashrdi3)
+#define __lshrdi3_v_glibc20	INTUSE (__lshrdi3)
+#define __cmpdi2_v_glibc20	INTUSE (__cmpdi2)
+#define __ucmpdi2_v_glibc20	INTUSE (__ucmpdi2)
+#define __fixdfdi_v_glibc20	INTUSE (__fixdfdi)
+#define __fixsfdi_v_glibc20	INTUSE (__fixsfdi)
+#define __fixunsdfdi_v_glibc20	INTUSE (__fixunsdfdi)
+#define __fixunssfdi_v_glibc20	INTUSE (__fixunssfdi)
+#define __floatdidf_v_glibc20	INTUSE (__floatdidf)
+#define __floatdisf_v_glibc20	INTUSE (__floatdisf)
+
+	.symver __ashldi3_v_glibc20,__ashldi3@GLIBC_2.0
+	.symver __ashrdi3_v_glibc20,__ashrdi3@GLIBC_2.0
+	.symver __lshrdi3_v_glibc20,__lshrdi3@GLIBC_2.0
+	.symver __cmpdi2_v_glibc20,__cmpdi2@GLIBC_2.0
+	.symver __ucmpdi2_v_glibc20,__ucmpdi2@GLIBC_2.0
+	.symver __fixdfdi_v_glibc20,__fixdfdi@GLIBC_2.0
+	.symver __fixunsdfdi_v_glibc20,__fixunsdfdi@GLIBC_2.0
+	.symver __fixsfdi_v_glibc20,__fixsfdi@GLIBC_2.0
+	.symver __fixunssfdi_v_glibc20,__fixunssfdi@GLIBC_2.0
+	.symver __floatdidf_v_glibc20,__floatdidf@GLIBC_2.0
+	.symver __floatdisf_v_glibc20,__floatdisf@GLIBC_2.0
+
+#ifdef HAVE_DOT_HIDDEN
+	.hidden __ashldi3
+	.hidden __ashrdi3
+	.hidden __lshrdi3
+	.hidden __cmpdi2
+	.hidden __ucmpdi2
+	.hidden __fixdfdi
+	.hidden __fixsfdi
+	.hidden __fixunsdfdi
+	.hidden __fixunssfdi
+	.hidden __floatdidf
+	.hidden __floatdisf
+#endif
+
+	.section	".text"
+
+	.align 2
+	.globl __ashldi3_v_glibc20
+	.type	__ashldi3_v_glibc20,@function
+__ashldi3_v_glibc20:
+	b __ashldi3@local
+.Lfe5:
+	.size	__ashldi3_v_glibc20,.Lfe5-__ashldi3_v_glibc20
+	.align 2
+	.globl __ashrdi3_v_glibc20
+	.type	__ashrdi3_v_glibc20,@function
+__ashrdi3_v_glibc20:
+	b __ashrdi3@local
+.Lfe6:
+	.size	__ashrdi3_v_glibc20,.Lfe6-__ashrdi3_v_glibc20
+	.align 2
+	.globl __lshrdi3_v_glibc20
+	.type	__lshrdi3_v_glibc20,@function
+__lshrdi3_v_glibc20:
+	b __lshrdi3@local
+.Lfe7:
+	.size	__lshrdi3_v_glibc20,.Lfe7-__lshrdi3_v_glibc20
+	.align 2
+	.globl __cmpdi2_v_glibc20
+	.type	__cmpdi2_v_glibc20,@function
+__cmpdi2_v_glibc20:
+	b __cmpdi2@local
+.Lfe8:
+	.size	__cmpdi2_v_glibc20,.Lfe8-__cmpdi2_v_glibc20
+	.align 2
+	.globl __ucmpdi2_v_glibc20
+	.type	__ucmpdi2_v_glibc20,@function
+__ucmpdi2_v_glibc20:
+	b __ucmpdi2@local
+.Lfe9:
+	.size	__ucmpdi2_v_glibc20,.Lfe9-__ucmpdi2_v_glibc20
+	.align 2
+	.globl __fixdfdi_v_glibc20
+	.type	__fixdfdi_v_glibc20,@function
+__fixdfdi_v_glibc20:
+	b __fixdfdi@local
+.Lfe10:
+	.size	__fixdfdi_v_glibc20,.Lfe10-__fixdfdi_v_glibc20
+	.align 2
+	.globl __fixunsdfdi_v_glibc20
+	.type	__fixunsdfdi_v_glibc20,@function
+__fixunsdfdi_v_glibc20:
+	b __fixunsdfdi@local
+.Lfe11:
+	.size	__fixunsdfdi_v_glibc20,.Lfe11-__fixunsdfdi_v_glibc20
+	.align 2
+	.globl __fixsfdi_v_glibc20
+	.type	__fixsfdi_v_glibc20,@function
+__fixsfdi_v_glibc20:
+	b __fixsfdi@local
+.Lfe12:
+	.size	__fixsfdi_v_glibc20,.Lfe12-__fixsfdi_v_glibc20
+	.align 2
+	.globl __fixunssfdi_v_glibc20
+	.type	__fixunssfdi_v_glibc20,@function
+__fixunssfdi_v_glibc20:
+	b __fixunssfdi@local
+.Lfe13:
+	.size	__fixunssfdi_v_glibc20,.Lfe13-__fixunssfdi_v_glibc20
+	.align 2
+	.globl __floatdidf_v_glibc20
+	.type	__floatdidf_v_glibc20,@function
+__floatdidf_v_glibc20:
+	b __floatdidf@local
+.Lfe14:
+	.size	__floatdidf_v_glibc20,.Lfe14-__floatdidf_v_glibc20
+	.align 2
+	.globl __floatdisf_v_glibc20
+	.type	__floatdisf_v_glibc20,@function
+__floatdisf_v_glibc20:
+	b __floatdisf@local
+.Lfe15:
+	.size	__floatdisf_v_glibc20,.Lfe15-__floatdisf_v_glibc20
+
+#endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/lshift.S ../glibc-2.3/sysdeps/powerpc/powerpc32/lshift.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/lshift.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/lshift.S	Thu Sep  5 04:31:33 2002
@@ -0,0 +1,131 @@
+/* Shift a limb left, low level routine.
+   Copyright (C) 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* mp_limb_t mpn_lshift (mp_ptr wp, mp_srcptr up, mp_size_t usize,
+  			 unsigned int cnt)  */
+
+EALIGN (BP_SYM (__mpn_lshift), 3, 0)
+
+#if __BOUNDED_POINTERS__
+	slwi r10,r5,2		/* convert limbs to bytes */
+	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
+#endif
+	mtctr	r5		# copy size into CTR
+	cmplwi	cr0,r5,16	# is size < 16
+	slwi	r0,r5,2
+	add	r7,r3,r0	# make r7 point at end of res
+	add	r4,r4,r0	# make r4 point at end of s1
+	lwzu	r11,-4(r4)	# load first s1 limb
+	subfic	r8,r6,32
+	srw	r3,r11,r8	# compute function return value
+	bge	cr0,L(big)	# branch if size >= 16
+
+	bdz	L(end1)
+
+L(0):	lwzu	r10,-4(r4)
+	slw	r9,r11,r6
+	srw	r12,r10,r8
+	or	r9,r9,r12
+	stwu	r9,-4(r7)
+	bdz	L(end2)
+	lwzu	r11,-4(r4)
+	slw	r9,r10,r6
+	srw	r12,r11,r8
+	or	r9,r9,r12
+	stwu	r9,-4(r7)
+	bdnz	L(0)
+
+L(end1):slw	r0,r11,r6
+	stw	r0,-4(r7)
+	blr
+
+
+/* Guaranteed not to succeed.  */
+L(boom): tweq    r0,r0
+
+/* We imitate a case statement, by using (yuk!) fixed-length code chunks,
+   of size 4*12 bytes.  We have to do this (or something) to make this PIC.  */
+L(big):	mflr    r9
+	bltl-   cr0,L(boom)	# Never taken, only used to set LR.
+	slwi    r10,r6,4
+	mflr    r12
+	add     r10,r12,r10
+	slwi	r8,r6,5
+	add     r10,r8,r10
+	mtctr   r10
+	addi	r5,r5,-1
+	mtlr    r9
+	bctr
+
+L(end2):slw	r0,r10,r6
+	stw	r0,-4(r7)
+	blr
+
+#define DO_LSHIFT(n) \
+	mtctr	r5;							\
+L(n):	lwzu	r10,-4(r4);						\
+	slwi	r9,r11,n;						\
+	inslwi	r9,r10,n,32-n;					\
+	stwu	r9,-4(r7);						\
+	bdz-	L(end2);						\
+	lwzu	r11,-4(r4);						\
+	slwi	r9,r10,n;						\
+	inslwi	r9,r11,n,32-n;					\
+	stwu	r9,-4(r7);						\
+	bdnz	L(n);							\
+	b	L(end1)
+
+	DO_LSHIFT(1)
+	DO_LSHIFT(2)
+	DO_LSHIFT(3)
+	DO_LSHIFT(4)
+	DO_LSHIFT(5)
+	DO_LSHIFT(6)
+	DO_LSHIFT(7)
+	DO_LSHIFT(8)
+	DO_LSHIFT(9)
+	DO_LSHIFT(10)
+	DO_LSHIFT(11)
+	DO_LSHIFT(12)
+	DO_LSHIFT(13)
+	DO_LSHIFT(14)
+	DO_LSHIFT(15)
+	DO_LSHIFT(16)
+	DO_LSHIFT(17)
+	DO_LSHIFT(18)
+	DO_LSHIFT(19)
+	DO_LSHIFT(20)
+	DO_LSHIFT(21)
+	DO_LSHIFT(22)
+	DO_LSHIFT(23)
+	DO_LSHIFT(24)
+	DO_LSHIFT(25)
+	DO_LSHIFT(26)
+	DO_LSHIFT(27)
+	DO_LSHIFT(28)
+	DO_LSHIFT(29)
+	DO_LSHIFT(30)
+	DO_LSHIFT(31)
+
+END (BP_SYM (__mpn_lshift))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/memset.S ../glibc-2.3/sysdeps/powerpc/powerpc32/memset.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/memset.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/memset.S	Thu Sep  5 04:25:07 2002
@@ -0,0 +1,338 @@
+/* Optimized memset implementation for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* Define a global static that can hold the cache line size.  The 
+   assumption is that startup code will access the "aux vector" to
+   to obtain the value set by the kernel and store it into this 
+   variable.  */
+   
+	.globl __cache_line_size
+	.section	".data","aw"
+	.align 2
+	.type	 __cache_line_size,@object
+	.size	 __cache_line_size,4
+__cache_line_size:
+	.long 0
+	.section	".text"
+/* __ptr_t [r3] memset (__ptr_t s [r3], int c [r4], size_t n [r5]));
+   Returns 's'.
+
+   The memset is done in four sizes: byte (8 bits), word (32 bits),
+   32-byte blocks (256 bits) and __cache_line_size (128, 256, 1024 bits).
+   There is a special case for setting whole cache lines to 0, which 
+   takes advantage of the dcbz instruction.  */
+
+EALIGN (BP_SYM (memset), 5, 1)
+
+#define rTMP	r0
+#define rRTN	r3	/* initial value of 1st argument */
+#if __BOUNDED_POINTERS__
+# define rMEMP0	r4	/* original value of 1st arg */
+# define rCHR	r5	/* char to set in each byte */
+# define rLEN	r6	/* length of region to set */
+# define rMEMP	r10	/* address at which we are storing */
+#else
+# define rMEMP0	r3	/* original value of 1st arg */
+# define rCHR	r4	/* char to set in each byte */
+# define rLEN	r5	/* length of region to set */
+# define rMEMP	r6	/* address at which we are storing */
+#endif
+#define rALIGN	r7	/* number of bytes we are setting now (when aligning) */
+#define rMEMP2	r8
+
+#define rPOS32	r7	/* constant +32 for clearing with dcbz */
+#define rNEG64	r8	/* constant -64 for clearing with dcbz */
+#define rNEG32	r9	/* constant -32 for clearing with dcbz */
+
+#define rGOT	r9	/* Address of the Global Offset Table.  */
+#define rCLS	r8	/* Cache line size obtained from static.  */
+#define rCLM	r9	/* Cache line size mask to check for cache alignment.  */
+
+#if __BOUNDED_POINTERS__
+	cmplwi	cr1, rRTN, 0
+	CHECK_BOUNDS_BOTH_WIDE (rMEMP0, rTMP, rTMP2, rLEN)
+	beq	cr1, L(b0)
+	STORE_RETURN_VALUE (rMEMP0)
+	STORE_RETURN_BOUNDS (rTMP, rTMP2)
+L(b0):
+#endif
+
+/* take care of case for size <= 4  */
+	cmplwi	cr1, rLEN, 4
+	andi.	rALIGN, rMEMP0, 3
+	mr	rMEMP, rMEMP0
+	ble-	cr1, L(small)
+/* align to word boundary  */
+	cmplwi	cr5, rLEN, 31
+	rlwimi	rCHR, rCHR, 8, 16, 23
+	beq+	L(aligned)	/* 8th instruction from .align */
+	mtcrf	0x01, rMEMP0
+	subfic	rALIGN, rALIGN, 4
+	add	rMEMP, rMEMP, rALIGN
+	sub	rLEN, rLEN, rALIGN
+	bf+	31, L(g0)
+	stb	rCHR, 0(rMEMP0)
+	bt	30, L(aligned)
+L(g0):	sth	rCHR, -2(rMEMP)	/* 16th instruction from .align */
+/* take care of case for size < 31 */
+L(aligned):
+	mtcrf	0x01, rLEN
+	rlwimi	rCHR, rCHR, 16, 0, 15
+	ble	cr5, L(medium)
+/* align to cache line boundary...  */
+	andi.	rALIGN, rMEMP, 0x1C
+	subfic	rALIGN, rALIGN, 0x20
+	beq	L(caligned)
+	mtcrf	0x01, rALIGN
+	add	rMEMP, rMEMP, rALIGN
+	sub	rLEN, rLEN, rALIGN
+	cmplwi	cr1, rALIGN, 0x10
+	mr	rMEMP2, rMEMP
+	bf	28, L(a1)
+	stw	rCHR, -4(rMEMP2)
+	stwu	rCHR, -8(rMEMP2)
+L(a1):	blt	cr1, L(a2)
+	stw	rCHR, -4(rMEMP2) /* 32nd instruction from .align */
+	stw	rCHR, -8(rMEMP2)
+	stw	rCHR, -12(rMEMP2)
+	stwu	rCHR, -16(rMEMP2)
+L(a2):	bf	29, L(caligned)
+	stw	rCHR, -4(rMEMP2)
+/* now aligned to a cache line.  */
+L(caligned):
+	cmplwi	cr1, rCHR, 0
+	clrrwi.	rALIGN, rLEN, 5
+	mtcrf	0x01, rLEN	/* 40th instruction from .align */
+	
+/* Check if we can use the special case for clearing memory using dcbz.
+   This requires that we know the correct cache line size for this    
+   processor.  Getting the __cache_line_size may require establishing GOT
+   addressability, so branch out of line to set this up.  */
+	beq	cr1, L(checklinesize) 
+	
+/* Store blocks of 32-bytes (256-bits) starting on a 32-byte boundary. 
+   Can't assume that rCHR is zero or that the cache line size is either
+   32-bytes or even known.  */
+L(nondcbz):
+	srwi	rTMP, rALIGN, 5
+	mtctr	rTMP
+	beq	L(medium)	/* we may not actually get to do a full line */
+	clrlwi.	rLEN, rLEN, 27
+	add	rMEMP, rMEMP, rALIGN
+	li	rNEG64, -0x40
+	bdz	L(cloopdone)	/* 48th instruction from .align */
+
+/* We can't use dcbz here as we don't know the cache line size.  We can
+   use "data cache block touch for store", which is safe.  */
+L(c3):	dcbtst rNEG64, rMEMP
+	stw	rCHR, -4(rMEMP)
+	stw	rCHR, -8(rMEMP)
+	stw	rCHR, -12(rMEMP)
+	stw	rCHR, -16(rMEMP)
+	nop			/* let 601 fetch last 4 instructions of loop */
+	stw	rCHR, -20(rMEMP)
+	stw	rCHR, -24(rMEMP) /* 56th instruction from .align */
+	nop			/* let 601 fetch first 8 instructions of loop */
+	stw	rCHR, -28(rMEMP)
+	stwu	rCHR, -32(rMEMP)
+	bdnz	L(c3)
+L(cloopdone):
+	stw	rCHR, -4(rMEMP)
+	stw	rCHR, -8(rMEMP)
+	stw	rCHR, -12(rMEMP)
+	stw	rCHR, -16(rMEMP) /* 64th instruction from .align */
+	stw	rCHR, -20(rMEMP)
+	cmplwi	cr1, rLEN, 16
+	stw	rCHR, -24(rMEMP)
+	stw	rCHR, -28(rMEMP)
+	stwu	rCHR, -32(rMEMP)
+	beqlr
+	add	rMEMP, rMEMP, rALIGN
+	b	L(medium_tail2)	/* 72nd instruction from .align */
+
+	.align 5
+	nop
+/* Clear cache lines of memory in 128-byte chunks.  
+   This code is optimized for processors with 32-byte cache lines.
+   It is further optimized for the 601 processor, which requires
+   some care in how the code is aligned in the i-cache.  */
+L(zloopstart):
+	clrlwi	rLEN, rLEN, 27
+	mtcrf	0x02, rALIGN
+	srwi.	rTMP, rALIGN, 7
+	mtctr	rTMP
+	li	rPOS32, 0x20
+	li	rNEG64, -0x40
+	cmplwi	cr1, rLEN, 16	/* 8 */
+	bf	26, L(z0)
+	dcbz	0, rMEMP
+	addi	rMEMP, rMEMP, 0x20
+L(z0):	li	rNEG32, -0x20
+	bf	25, L(z1)
+	dcbz	0, rMEMP
+	dcbz	rPOS32, rMEMP
+	addi	rMEMP, rMEMP, 0x40 /* 16 */
+L(z1):	cmplwi	cr5, rLEN, 0
+	beq	L(medium)
+L(zloop):
+	dcbz	0, rMEMP
+	dcbz	rPOS32, rMEMP
+	addi	rMEMP, rMEMP, 0x80
+	dcbz	rNEG64, rMEMP
+	dcbz	rNEG32, rMEMP
+	bdnz	L(zloop)
+	beqlr	cr5
+	b	L(medium_tail2)
+
+	.align 5
+L(small):
+/* Memset of 4 bytes or less.  */
+	cmplwi	cr5, rLEN, 1
+	cmplwi	cr1, rLEN, 3
+	bltlr	cr5
+	stb	rCHR, 0(rMEMP)
+	beqlr	cr5
+	nop
+	stb	rCHR, 1(rMEMP)
+	bltlr	cr1
+	stb	rCHR, 2(rMEMP)
+	beqlr	cr1
+	nop
+	stb	rCHR, 3(rMEMP)
+	blr
+
+/* Memset of 0-31 bytes.  */
+	.align 5
+L(medium):
+	cmplwi	cr1, rLEN, 16
+L(medium_tail2):
+	add	rMEMP, rMEMP, rLEN
+L(medium_tail):
+	bt-	31, L(medium_31t)
+	bt-	30, L(medium_30t)
+L(medium_30f):
+	bt-	29, L(medium_29t)
+L(medium_29f):
+	bge-	cr1, L(medium_27t)
+	bflr-	28
+	stw	rCHR, -4(rMEMP)	/* 8th instruction from .align */
+	stw	rCHR, -8(rMEMP)
+	blr
+
+L(medium_31t):
+	stbu	rCHR, -1(rMEMP)
+	bf-	30, L(medium_30f)
+L(medium_30t):
+	sthu	rCHR, -2(rMEMP)
+	bf-	29, L(medium_29f)
+L(medium_29t):
+	stwu	rCHR, -4(rMEMP)
+	blt-	cr1, L(medium_27f) /* 16th instruction from .align */
+L(medium_27t):
+	stw	rCHR, -4(rMEMP)
+	stw	rCHR, -8(rMEMP)
+	stw	rCHR, -12(rMEMP)
+	stwu	rCHR, -16(rMEMP)
+L(medium_27f):
+	bflr-	28
+L(medium_28t):
+	stw	rCHR, -4(rMEMP)
+	stw	rCHR, -8(rMEMP)
+	blr
+	
+L(checklinesize):
+#ifdef SHARED
+	mflr rTMP
+/* If the remaining length is less the 32 bytes then don't bother getting
+	 the cache line size.  */
+	beq	L(medium)	
+/* Establishes GOT addressability so we can load __cache_line_size 
+   from static. This value was set from the aux vector during startup.  */
+	bl   _GLOBAL_OFFSET_TABLE_@local-4
+	mflr rGOT
+	lwz	 rGOT,__cache_line_size@got(rGOT)
+	lwz	 rCLS,0(rGOT)
+	mtlr rTMP
+#else 
+/* Load __cache_line_size from static. This value was set from the 
+   aux vector during startup.  */
+	lis	 rCLS,__cache_line_size@ha
+/* If the remaining length is less the 32 bytes then don't bother getting
+	 the cache line size.  */
+	beq	L(medium)
+	lwz  rCLS,__cache_line_size@l(rCLS)
+#endif
+	
+/*If the cache line size was not set then goto to L(nondcbz), which is
+	safe for any cache line size.  */	
+	cmplwi cr1,rCLS,0
+	beq	cr1,L(nondcbz)
+	
+/* If the cache line size is 32 bytes then goto to L(zloopstart),
+	 which is coded specificly for 32-byte lines (and 601).  */	
+	cmplwi cr1,rCLS,32
+	beq	cr1,L(zloopstart)
+	
+/* Now we know the cache line size and it is not 32-bytes.  However 
+	 we may not yet be aligned to the cache line and may have a partial 
+	 line to fill.  Touch it 1st to fetch the cache line.  */	
+	dcbtst 0,rMEMP	
+	
+	addi rCLM,rCLS,-1
+L(getCacheAligned):
+	cmplwi cr1,rLEN,32
+	and. rTMP,rCLM,rMEMP
+	blt	 cr1,L(handletail32)
+	beq	 L(cacheAligned)
+/* We are not aligned to start of a cache line yet.  Store 32-byte
+   of data and test again.  */
+	addi rMEMP,rMEMP,32
+	addi rLEN,rLEN,-32
+	stw	 rCHR,-32(rMEMP)
+	stw	 rCHR,-28(rMEMP)
+	stw	 rCHR,-24(rMEMP)
+	stw	 rCHR,-20(rMEMP)
+	stw	 rCHR,-16(rMEMP)
+	stw	 rCHR,-12(rMEMP)
+	stw	 rCHR,-8(rMEMP)
+	stw	 rCHR,-4(rMEMP)
+	b	 L(getCacheAligned)
+	
+/* Now we are aligned to the cache line and can use dcbz.  */	
+L(cacheAligned):
+	cmplw cr1,rLEN,rCLS
+	blt	 cr1,L(handletail32)
+	dcbz 0,rMEMP
+	subf rLEN,rCLS,rLEN
+	add	 rMEMP,rMEMP,rCLS
+	b	 L(cacheAligned)
+
+/* We are here because; the cache line size was set, it was not 
+   32-bytes, and the remainder (rLEN) is now less than the actual cache 
+   line size.  Set up the preconditions for L(nondcbz) and go there to 
+   store the remaining bytes.  */			
+L(handletail32):
+	clrrwi.	rALIGN, rLEN, 5
+	b		L(nondcbz)
+		
+END (BP_SYM (memset))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/mul_1.S ../glibc-2.3/sysdeps/powerpc/powerpc32/mul_1.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/mul_1.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/mul_1.S	Thu Sep  5 04:31:49 2002
@@ -0,0 +1,53 @@
+/* Multiply a limb vector by a limb, for PowerPC.
+   Copyright (C) 1993-1995, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* mp_limb_t mpn_mul_1 (mp_ptr res_ptr, mp_srcptr s1_ptr,
+                        mp_size_t s1_size, mp_limb_t s2_limb)
+   Calculate s1*s2 and put result in res_ptr; return carry.  */
+
+ENTRY (BP_SYM (__mpn_mul_1))
+#if __BOUNDED_POINTERS__
+	slwi r10,r5,2		/* convert limbs to bytes */
+	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
+#endif
+	mtctr	r5
+
+	lwz	r0,0(r4)
+	mullw	r7,r0,r6
+	mulhwu	r10,r0,r6
+	addi	r3,r3,-4		# adjust res_ptr
+	addic	r5,r5,0			# clear cy with dummy insn
+	bdz	L(1)
+
+L(0):	lwzu	r0,4(r4)
+	stwu	r7,4(r3)
+	mullw	r8,r0,r6
+	adde	r7,r8,r10
+	mulhwu	r10,r0,r6
+	bdnz	L(0)
+
+L(1):	stw	r7,4(r3)
+	addze	r3,r10
+	blr
+END (BP_SYM (__mpn_mul_1))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/ppc-mcount.S ../glibc-2.3/sysdeps/powerpc/powerpc32/ppc-mcount.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/ppc-mcount.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/ppc-mcount.S	Thu Sep  5 04:25:25 2002
@@ -0,0 +1,85 @@
+/* PowerPC-specific implementation of profiling support.
+   Copyright (C) 1997, 1999 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+/* This would be bad.  */
+#ifdef PROF
+#undef PROF
+#endif
+
+#include <sysdep.h>
+
+/* We do profiling as described in the SYSV ELF ABI, _mcount is called
+   with the address of a data word in r0 (that is different for every
+   routine, initialised to 0, and otherwise unused).  The caller has put
+   the address the caller will return to in the usual place on the stack,
+   4(r1).  _mcount is responsible for ensuring that when it returns no
+   argument-passing registers are disturbed, and that the LR is set back
+   to (what the caller sees as) 4(r1).
+
+   This is intended so that the following code can be inserted at the
+   front of any routine without changing the routine:
+
+	.data
+	.align	2
+   0:	.long	0
+	.previous
+	mflr	r0
+	lis	r11,0b@ha
+	stw	r0,4(r1)
+	addi	r0,r11,0b@l
+	bl	_mcount
+*/
+
+ENTRY(_mcount)
+	stwu	r1,-48(r1)
+/* We need to save the parameter-passing registers.  */
+	stw	r3, 12(r1)
+	stw	r4, 16(r1)
+	stw	r5, 20(r1)
+	stw	r6, 24(r1)
+	mflr	r4
+	lwz	r3, 52(r1)
+	mfcr	r5
+	stw	r7, 28(r1)
+	stw	r8, 32(r1)
+	stw	r9, 36(r1)
+	stw	r10,40(r1)
+	stw	r4, 44(r1)
+	stw	r5,  8(r1)
+	bl	JUMPTARGET(__mcount_internal)
+	nop
+ /* Restore the registers...  */
+	lwz     r6,  8(r1)
+	lwz	r0, 44(r1)
+	lwz	r3, 12(r1)
+	mtctr	r0
+	lwz	r4, 16(r1)
+	mtcrf	0xff,r6
+	lwz	r5, 20(r1)
+	lwz	r6, 24(r1)
+	lwz	r0, 52(r1)
+	lwz	r7, 28(r1)
+	lwz	r8, 32(r1)
+	mtlr	r0
+	lwz	r9, 36(r1)
+	lwz	r10,40(r1)
+ /* ...unwind the stack frame, and return to your usual programming.  */
+	addi	r1,r1,48
+	bctr
+END(_mcount)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/register-dump.h ../glibc-2.3/sysdeps/powerpc/powerpc32/register-dump.h
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/register-dump.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/register-dump.h	Thu Sep  5 04:25:50 2002
@@ -0,0 +1,121 @@
+/* Dump registers.
+   Copyright (C) 1998 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sys/uio.h>
+#include <stdio-common/_itoa.h>
+
+/* This prints out the information in the following form: */
+static const char dumpform[] = "\
+Register dump:\n\
+fp0-3:   0000030%0000031% 0000032%0000033% 0000034%0000035% 0000036%0000037%\n\
+fp4-7:   0000038%0000039% 000003a%000003b% 000003c%000003d% 000003e%000003f%\n\
+fp8-11:  0000040%0000041% 0000042%0000043% 0000044%0000045% 0000046%0000047%\n\
+fp12-15: 0000048%0000049% 000004a%000004b% 000004c%000004d% 000004e%000004f%\n\
+fp16-19: 0000050%0000051% 0000052%0000053% 0000054%0000055% 0000056%0000057%\n\
+fp20-23: 0000058%0000059% 000005a%000005b% 000005c%000005d% 000005e%000005f%\n\
+fp24-27: 0000060%0000061% 0000062%0000063% 0000064%0000065% 0000066%0000067%\n\
+fp28-31: 0000068%0000069% 000006a%000006b% 000006c%000006d% 000006e%000006f%\n\
+r0 =0000000% sp =0000001% r2 =0000002% r3 =0000003%  trap=0000028%\n\
+r4 =0000004% r5 =0000005% r6 =0000006% r7 =0000007%   sr0=0000020% sr1=0000021%\n\
+r8 =0000008% r9 =0000009% r10=000000a% r11=000000b%   dar=0000029% dsi=000002a%\n\
+r12=000000c% r13=000000d% r14=000000e% r15=000000f%   r3*=0000022%\n\
+r16=0000010% r17=0000011% r18=0000012% r19=0000013%\n\
+r20=0000014% r21=0000015% r22=0000016% r23=0000017%    lr=0000024% xer=0000025%\n\
+r24=0000018% r25=0000019% r26=000001a% r27=000001b%    mq=0000027% ctr=0000023%\n\
+r28=000001c% r29=000001d% r30=000001e% r31=000001f%  fscr=0000071% ccr=0000026%\n\
+";
+
+/* Most of the fields are self-explanatory.  'sr0' is the next
+   instruction to execute, from SRR0, which may have some relationship
+   with the instruction that caused the exception.  'r3*' is the value
+   that will be returned in register 3 when the current system call
+   returns.  'sr1' is SRR1, bits 16-31 of which are copied from the MSR:
+
+   16 - External interrupt enable
+   17 - Privilege level (1=user, 0=supervisor)
+   18 - FP available
+   19 - Machine check enable (if clear, processor locks up on machine check)
+   20 - FP exception mode bit 0 (FP exceptions recoverable)
+   21 - Single-step trace enable
+   22 - Branch trace enable
+   23 - FP exception mode bit 1
+   25 - exception prefix (if set, exceptions are taken from 0xFFFnnnnn,
+        otherwise from 0x000nnnnn).
+   26 - Instruction address translation enabled.
+   27 - Data address translation enabled.
+   30 - Exception is recoverable (otherwise, don't try to return).
+   31 - Little-endian mode enable.
+
+   'Trap' is the address of the exception:
+
+   00200 - Machine check exception (memory parity error, for instance)
+   00300 - Data access exception (memory not mapped, see dsisr for why)
+   00400 - Instruction access exception (memory not mapped)
+   00500 - External interrupt
+   00600 - Alignment exception (see dsisr for more information)
+   00700 - Program exception (illegal/trap instruction, FP exception)
+   00800 - FP unavailable (should not be seen by user code)
+   00900 - Decrementer exception (for instance, SIGALRM)
+   00A00 - I/O controller interface exception
+   00C00 - System call exception (for instance, kill(3)).
+   00E00 - FP assist exception (optional FP instructions, etc.)
+
+   'dar' is the memory location, for traps 00300, 00400, 00600, 00A00.
+   'dsisr' has the following bits under trap 00300:
+   0 - direct-store error exception
+   1 - no page table entry for page
+   4 - memory access not permitted
+   5 - trying to access I/O controller space or using lwarx/stwcx on
+       non-write-cached memory
+   6 - access was store
+   9 - data access breakpoint hit
+   10 - segment table search failed to find translation (64-bit ppcs only)
+   11 - I/O controller instruction not permitted
+   For trap 00400, the same bits are set in SRR1 instead.
+   For trap 00600, bits 12-31 of the DSISR set to allow emulation of
+   the instruction without actually having to read it from memory.
+*/
+
+#define xtoi(x) (x >= 'a' ? x + 10 - 'a' : x - '0')
+
+static void
+register_dump (int fd, struct sigcontext *ctx)
+{
+  char buffer[sizeof(dumpform)];
+  char *bufferpos;
+  unsigned regno;
+  unsigned *regs = (unsigned *)(ctx->regs);
+
+  memcpy(buffer, dumpform, sizeof(dumpform));
+
+  /* Generate the output.  */
+  while ((bufferpos = memchr (buffer, '%', sizeof(dumpform))))
+    {
+      regno = xtoi (bufferpos[-1]) | xtoi (bufferpos[-2]) << 4;
+      memset (bufferpos-2, '0', 3);
+      _itoa_word (regs[regno], bufferpos+1, 16, 0);
+    }
+
+  /* Write the output.  */
+  write (fd, buffer, sizeof(buffer));
+}
+
+
+#define REGISTER_DUMP \
+  register_dump (fd, ctx)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/rshift.S ../glibc-2.3/sysdeps/powerpc/powerpc32/rshift.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/rshift.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/rshift.S	Thu Sep  5 04:32:02 2002
@@ -0,0 +1,63 @@
+/* Shift a limb right, low level routine.
+   Copyright (C) 1995, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* INPUT PARAMETERS
+   res_ptr	r3
+   s1_ptr	r4
+   size		r5
+   cnt		r6  */
+
+ENTRY (BP_SYM (__mpn_rshift))
+#if __BOUNDED_POINTERS__
+	slwi r10,r5,2		/* convert limbs to bytes */
+	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
+#endif
+	mtctr	r5		# copy size into CTR
+	addi	r7,r3,-4	# move adjusted res_ptr to free return reg
+	subfic	r8,r6,32
+	lwz	r11,0(r4)	# load first s1 limb
+	slw	r3,r11,r8	# compute function return value
+	bdz	L(1)
+
+L(0):	lwzu	r10,4(r4)
+	srw	r9,r11,r6
+	slw	r12,r10,r8
+	or	r9,r9,r12
+	stwu	r9,4(r7)
+	bdz	L(2)
+	lwzu	r11,4(r4)
+	srw	r9,r10,r6
+	slw	r12,r11,r8
+	or	r9,r9,r12
+	stwu	r9,4(r7)
+	bdnz	L(0)
+
+L(1):	srw	r0,r11,r6
+	stw	r0,4(r7)
+	blr
+
+L(2):	srw	r0,r10,r6
+	stw	r0,4(r7)
+	blr
+END (BP_SYM (__mpn_rshift))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/setjmp.S ../glibc-2.3/sysdeps/powerpc/powerpc32/setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/setjmp.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/setjmp.S	Thu Sep  5 04:26:02 2002
@@ -0,0 +1,55 @@
+/* setjmp for PowerPC.
+   Copyright (C) 1995, 1996, 1997, 1999, 2000, 2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#define _ASM
+#define _SETJMP_H
+#include <bits/setjmp.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+ENTRY (BP_SYM (__sigsetjmp))
+	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
+
+	stw  r1,(JB_GPR1*4)(3)
+	mflr r0
+	stw  r2,(JB_GPR2*4)(3)
+	stw  r14,((JB_GPRS+0)*4)(3)
+	stw  r0,(JB_LR*4)(3)
+	stw  r15,((JB_GPRS+1)*4)(3)
+	mfcr r0
+	stw  r16,((JB_GPRS+2)*4)(3)
+	stw  r0,(JB_CR*4)(3)
+	stw  r17,((JB_GPRS+3)*4)(3)
+	stw  r18,((JB_GPRS+4)*4)(3)
+	stw  r19,((JB_GPRS+5)*4)(3)
+	stw  r20,((JB_GPRS+6)*4)(3)
+	stw  r21,((JB_GPRS+7)*4)(3)
+	stw  r22,((JB_GPRS+8)*4)(3)
+	stw  r23,((JB_GPRS+9)*4)(3)
+	stw  r24,((JB_GPRS+10)*4)(3)
+	stw  r25,((JB_GPRS+11)*4)(3)
+	stw  r26,((JB_GPRS+12)*4)(3)
+	stw  r27,((JB_GPRS+13)*4)(3)
+	stw  r28,((JB_GPRS+14)*4)(3)
+	stw  r29,((JB_GPRS+15)*4)(3)
+	stw  r30,((JB_GPRS+16)*4)(3)
+	stw  r31,((JB_GPRS+17)*4)(3)
+	b JUMPTARGET (BP_SYM (__sigjmp_save))
+END (BP_SYM (__sigsetjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/stpcpy.S ../glibc-2.3/sysdeps/powerpc/powerpc32/stpcpy.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/stpcpy.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/stpcpy.S	Thu Sep  5 04:26:37 2002
@@ -0,0 +1,121 @@
+/* Optimized stpcpy implementation for PowerPC.
+   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* See strlen.s for comments on how the end-of-string testing works.  */
+
+/* char * [r3] stpcpy (char *dest [r3], const char *src [r4])  */
+
+EALIGN (BP_SYM (__stpcpy), 4, 0)
+
+#define rTMP	r0
+#define rRTN	r3
+#if __BOUNDED_POINTERS__
+# define rDEST	r4		/* pointer to previous word in dest */
+# define rSRC	r5		/* pointer to previous word in src */
+# define rLOW	r11
+# define rHIGH	r12
+#else
+# define rDEST	r3		/* pointer to previous word in dest */
+# define rSRC	r4		/* pointer to previous word in src */
+#endif
+#define rWORD	r6		/* current word from src */
+#define rFEFE	r7		/* 0xfefefeff */
+#define r7F7F	r8		/* 0x7f7f7f7f */
+#define rNEG	r9		/* ~(word in src | 0x7f7f7f7f) */
+#define rALT	r10		/* alternate word from src */
+
+	CHECK_BOUNDS_LOW (rSRC, rLOW, rHIGH)
+	CHECK_BOUNDS_LOW (rDEST, rLOW, rHIGH)
+	STORE_RETURN_BOUNDS (rLOW, rHIGH)
+
+	or	rTMP, rSRC, rDEST
+	clrlwi.	rTMP, rTMP, 30
+	addi	rDEST, rDEST, -4
+	bne	L(unaligned)
+
+	lis	rFEFE, -0x101
+	lis	r7F7F, 0x7f7f
+	lwz	rWORD, 0(rSRC)
+	addi	rFEFE, rFEFE, -0x101
+	addi	r7F7F, r7F7F, 0x7f7f
+	b	L(g2)
+
+L(g0):	lwzu	rALT, 4(rSRC)
+	stwu	rWORD, 4(rDEST)
+	add	rTMP, rFEFE, rALT
+	nor	rNEG, r7F7F, rALT
+	and.	rTMP, rTMP, rNEG
+	bne-	L(g1)
+	lwzu	rWORD, 4(rSRC)
+	stwu	rALT, 4(rDEST)
+L(g2):	add	rTMP, rFEFE, rWORD
+	nor	rNEG, r7F7F, rWORD
+	and.	rTMP, rTMP, rNEG
+	beq+	L(g0)
+
+	mr	rALT, rWORD
+/* We've hit the end of the string.  Do the rest byte-by-byte.  */
+L(g1):	rlwinm.	rTMP, rALT, 8, 24, 31
+	stbu	rTMP, 4(rDEST)
+	beqlr-
+	rlwinm.	rTMP, rALT, 16, 24, 31
+	stbu	rTMP, 1(rDEST)
+	beqlr-
+	rlwinm.	rTMP, rALT, 24, 24, 31
+	stbu	rTMP, 1(rDEST)
+	beqlr-
+	stbu	rALT, 1(rDEST)
+	CHECK_BOUNDS_HIGH (rDEST, rHIGH, twlgt)
+	STORE_RETURN_VALUE (rDEST)
+	blr
+
+/* Oh well.  In this case, we just do a byte-by-byte copy.  */
+	.align 4
+	nop
+L(unaligned):
+	lbz	rWORD, 0(rSRC)
+	addi	rDEST, rDEST, 3
+	cmpwi	rWORD, 0
+	beq-	L(u2)
+
+L(u0):	lbzu	rALT, 1(rSRC)
+	stbu	rWORD, 1(rDEST)
+	cmpwi	rALT, 0
+	beq-	L(u1)
+	nop		/* Let 601 load start of loop.  */
+	lbzu	rWORD, 1(rSRC)
+	stbu	rALT, 1(rDEST)
+	cmpwi	rWORD, 0
+	bne+	L(u0)
+L(u2):	stbu	rWORD, 1(rDEST)
+	CHECK_BOUNDS_HIGH (rDEST, rHIGH, twlgt)
+	STORE_RETURN_VALUE (rDEST)
+	blr
+L(u1):	stbu	rALT, 1(rDEST)
+	CHECK_BOUNDS_HIGH (rDEST, rHIGH, twlgt)
+	STORE_RETURN_VALUE (rDEST)
+	blr
+END (BP_SYM (__stpcpy))
+
+weak_alias (BP_SYM (__stpcpy), BP_SYM (stpcpy))
+libc_hidden_def (__stpcpy)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/strchr.S ../glibc-2.3/sysdeps/powerpc/powerpc32/strchr.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/strchr.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/strchr.S	Thu Sep  5 04:26:52 2002
@@ -0,0 +1,130 @@
+/* Optimized strchr implementation for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* See strlen.s for comments on how this works.  */
+
+/* char * [r3] strchr (const char *s [r3] , int c [r4] )  */
+
+ENTRY (BP_SYM (strchr))
+
+#define rTMP1	r0
+#define rRTN	r3	/* outgoing result */
+#if __BOUNDED_POINTERS__
+# define rSTR	r4
+# define rCHR	r5	/* byte we're looking for, spread over the whole word */
+# define rWORD	r8	/* the current word */
+#else
+# define rSTR	r8	/* current word pointer */
+# define rCHR	r4	/* byte we're looking for, spread over the whole word */
+# define rWORD	r5	/* the current word */
+#endif
+#define rCLZB	rCHR	/* leading zero byte count */
+#define rFEFE	r6	/* constant 0xfefefeff (-0x01010101) */
+#define r7F7F	r7	/* constant 0x7f7f7f7f */
+#define rTMP2	r9
+#define rIGN	r10	/* number of bits we should ignore in the first word */
+#define rMASK	r11	/* mask with the bits to ignore set to 0 */
+#define rTMP3	r12
+
+	CHECK_BOUNDS_LOW (rSTR, rTMP1, rTMP2)
+	STORE_RETURN_BOUNDS (rTMP1, rTMP2)
+
+	rlwimi	rCHR, rCHR, 8, 16, 23
+	li	rMASK, -1
+	rlwimi	rCHR, rCHR, 16, 0, 15
+	rlwinm	rIGN, rRTN, 3, 27, 28
+	lis	rFEFE, -0x101
+	lis	r7F7F, 0x7f7f
+	clrrwi	rSTR, rRTN, 2
+	addi	rFEFE, rFEFE, -0x101
+	addi	r7F7F, r7F7F, 0x7f7f
+/* Test the first (partial?) word.  */
+	lwz	rWORD, 0(rSTR)
+	srw	rMASK, rMASK, rIGN
+	orc	rWORD, rWORD, rMASK
+	add	rTMP1, rFEFE, rWORD
+	nor	rTMP2, r7F7F, rWORD
+	and.	rTMP1, rTMP1, rTMP2
+	xor	rTMP3, rCHR, rWORD
+	orc	rTMP3, rTMP3, rMASK
+	b	L(loopentry)
+
+/* The loop.  */
+
+L(loop):lwzu rWORD, 4(rSTR)
+	and.	rTMP1, rTMP1, rTMP2
+/* Test for 0.	*/
+	add	rTMP1, rFEFE, rWORD
+	nor	rTMP2, r7F7F, rWORD
+	bne	L(foundit)
+	and.	rTMP1, rTMP1, rTMP2
+/* Start test for the bytes we're looking for.  */
+	xor	rTMP3, rCHR, rWORD
+L(loopentry):
+	add	rTMP1, rFEFE, rTMP3
+	nor	rTMP2, r7F7F, rTMP3
+	beq	L(loop)
+/* There is a zero byte in the word, but may also be a matching byte (either
+   before or after the zero byte).  In fact, we may be looking for a
+   zero byte, in which case we return a match.  We guess that this hasn't
+   happened, though.  */
+L(missed):
+	and.	rTMP1, rTMP1, rTMP2
+	li	rRTN, 0
+	STORE_RETURN_VALUE (rSTR)
+	beqlr
+/* It did happen. Decide which one was first...
+   I'm not sure if this is actually faster than a sequence of
+   rotates, compares, and branches (we use it anyway because it's shorter).  */
+	and	rFEFE, r7F7F, rWORD
+	or	rMASK, r7F7F, rWORD
+	and	rTMP1, r7F7F, rTMP3
+	or	rIGN, r7F7F, rTMP3
+	add	rFEFE, rFEFE, r7F7F
+	add	rTMP1, rTMP1, r7F7F
+	nor	rWORD, rMASK, rFEFE
+	nor	rTMP2, rIGN, rTMP1
+	cmplw	rWORD, rTMP2
+	bgtlr
+	cntlzw	rCLZB, rTMP2
+	srwi	rCLZB, rCLZB, 3
+	add	rRTN, rSTR, rCLZB
+	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, twlge)
+	STORE_RETURN_VALUE (rSTR)
+	blr
+
+L(foundit):
+	and	rTMP1, r7F7F, rTMP3
+	or	rIGN, r7F7F, rTMP3
+	add	rTMP1, rTMP1, r7F7F
+	nor	rTMP2, rIGN, rTMP1
+	cntlzw	rCLZB, rTMP2
+	subi	rSTR, rSTR, 4
+	srwi	rCLZB, rCLZB, 3
+	add	rRTN, rSTR, rCLZB
+	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, twlge)
+	STORE_RETURN_VALUE (rSTR)
+	blr
+END (BP_SYM (strchr))
+
+weak_alias (BP_SYM (strchr), BP_SYM (index))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/strcmp.S ../glibc-2.3/sysdeps/powerpc/powerpc32/strcmp.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/strcmp.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/strcmp.S	Thu Sep  5 04:27:07 2002
@@ -0,0 +1,126 @@
+/* Optimized strcmp implementation for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* See strlen.s for comments on how the end-of-string testing works.  */
+
+/* int [r3] strcmp (const char *s1 [r3], const char *s2 [r4])  */
+
+EALIGN (BP_SYM (strcmp), 4, 0)
+
+#define rTMP	r0
+#define rRTN	r3
+#define rSTR1	r3	/* first string arg */
+#define rSTR2	r4	/* second string arg */
+#if __BOUNDED_POINTERS__
+# define rHIGH1	r11
+# define rHIGH2 r12
+#endif
+#define rWORD1	r5	/* current word in s1 */
+#define rWORD2	r6	/* current word in s2 */
+#define rFEFE	r7	/* constant 0xfefefeff (-0x01010101) */
+#define r7F7F	r8	/* constant 0x7f7f7f7f */
+#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f) */
+#define rBITDIF	r10	/* bits that differ in s1 & s2 words */
+
+	CHECK_BOUNDS_LOW (rSTR1, rTMP, rHIGH1)
+	CHECK_BOUNDS_LOW (rSTR2, rTMP, rHIGH2)
+
+	or	rTMP, rSTR2, rSTR1
+	clrlwi.	rTMP, rTMP, 30
+	lis	rFEFE, -0x101
+	bne	L(unaligned)
+
+	lwz	rWORD1, 0(rSTR1)
+	lwz	rWORD2, 0(rSTR2)
+	lis	r7F7F, 0x7f7f
+	addi	rFEFE, rFEFE, -0x101
+	addi	r7F7F, r7F7F, 0x7f7f
+	b	L(g1)
+
+L(g0):	lwzu	rWORD1, 4(rSTR1)
+	bne	cr1, L(different)
+	lwzu	rWORD2, 4(rSTR2)
+L(g1):	add	rTMP, rFEFE, rWORD1
+	nor	rNEG, r7F7F, rWORD1
+	and.	rTMP, rTMP, rNEG
+	cmpw	cr1, rWORD1, rWORD2
+	beq+	L(g0)
+L(endstring):
+/* OK. We've hit the end of the string. We need to be careful that
+   we don't compare two strings as different because of gunk beyond
+   the end of the strings...  */
+	and	rTMP, r7F7F, rWORD1
+	beq	cr1, L(equal)
+	add	rTMP, rTMP, r7F7F
+	xor.	rBITDIF, rWORD1, rWORD2
+	andc	rNEG, rNEG, rTMP
+	blt-	L(highbit)
+	cntlzw	rBITDIF, rBITDIF
+	cntlzw	rNEG, rNEG
+	addi	rNEG, rNEG, 7
+	cmpw	cr1, rNEG, rBITDIF
+	sub	rRTN, rWORD1, rWORD2
+	bgelr+	cr1
+L(equal):
+	li	rRTN, 0
+	/* GKM FIXME: check high bounds.  */
+	blr
+
+L(different):
+	lwz	rWORD1, -4(rSTR1)
+	xor.	rBITDIF, rWORD1, rWORD2
+	sub	rRTN, rWORD1, rWORD2
+	bgelr+
+L(highbit):
+	ori	rRTN, rWORD2, 1
+	/* GKM FIXME: check high bounds.  */
+	blr
+
+
+/* Oh well.  In this case, we just do a byte-by-byte comparison.  */
+	.align 4
+L(unaligned):
+	lbz	rWORD1, 0(rSTR1)
+	lbz	rWORD2, 0(rSTR2)
+	b	L(u1)
+
+L(u0):	lbzu	rWORD1, 1(rSTR1)
+	bne-	L(u4)
+	lbzu	rWORD2, 1(rSTR2)
+L(u1):	cmpwi	cr1, rWORD1, 0
+	beq-	cr1, L(u3)
+	cmpw	rWORD1, rWORD2
+	bne-	L(u3)
+	lbzu	rWORD1, 1(rSTR1)
+	lbzu	rWORD2, 1(rSTR2)
+	cmpwi	cr1, rWORD1, 0
+	cmpw	rWORD1, rWORD2
+	bne+	cr1, L(u0)
+L(u3):	sub	rRTN, rWORD1, rWORD2
+	/* GKM FIXME: check high bounds.  */
+	blr
+L(u4):	lbz	rWORD1, -1(rSTR1)
+	sub	rRTN, rWORD1, rWORD2
+	/* GKM FIXME: check high bounds.  */
+	blr
+END (BP_SYM (strcmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/strcpy.S ../glibc-2.3/sysdeps/powerpc/powerpc32/strcpy.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/strcpy.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/strcpy.S	Thu Sep  5 04:27:23 2002
@@ -0,0 +1,120 @@
+/* Optimized strcpy implementation for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* See strlen.s for comments on how the end-of-string testing works.  */
+
+/* char * [r3] strcpy (char *dest [r3], const char *src [r4])  */
+
+EALIGN (BP_SYM (strcpy), 4, 0)
+
+#define rTMP	r0
+#define rRTN	r3	/* incoming DEST arg preserved as result */
+#if __BOUNDED_POINTERS__
+# define rDEST	r4	/* pointer to previous word in dest */
+# define rSRC	r5	/* pointer to previous word in src */
+# define rLOW	r11
+# define rHIGH	r12
+#else
+# define rSRC	r4	/* pointer to previous word in src */
+# define rDEST	r5	/* pointer to previous word in dest */
+#endif
+#define rWORD	r6	/* current word from src */
+#define rFEFE	r7	/* constant 0xfefefeff (-0x01010101) */
+#define r7F7F	r8	/* constant 0x7f7f7f7f */
+#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f) */
+#define rALT	r10	/* alternate word from src */
+
+	CHECK_BOUNDS_LOW (rSRC, rLOW, rHIGH)
+	CHECK_BOUNDS_LOW (rDEST, rLOW, rHIGH)
+	STORE_RETURN_BOUNDS (rLOW, rHIGH)
+
+	or	rTMP, rSRC, rRTN
+	clrlwi.	rTMP, rTMP, 30
+#if __BOUNDED_POINTERS__
+	addi	rDEST, rDEST, -4
+#else
+	addi	rDEST, rRTN, -4
+#endif
+	bne	L(unaligned)
+
+	lis	rFEFE, -0x101
+	lis	r7F7F, 0x7f7f
+	lwz	rWORD, 0(rSRC)
+	addi	rFEFE, rFEFE, -0x101
+	addi	r7F7F, r7F7F, 0x7f7f
+	b	L(g2)
+
+L(g0):	lwzu	rALT, 4(rSRC)
+	stwu	rWORD, 4(rDEST)
+	add	rTMP, rFEFE, rALT
+	nor	rNEG, r7F7F, rALT
+	and.	rTMP, rTMP, rNEG
+	bne-	L(g1)
+	lwzu	rWORD, 4(rSRC)
+	stwu	rALT, 4(rDEST)
+L(g2):	add	rTMP, rFEFE, rWORD
+	nor	rNEG, r7F7F, rWORD
+	and.	rTMP, rTMP, rNEG
+	beq+	L(g0)
+
+	mr	rALT, rWORD
+/* We've hit the end of the string.  Do the rest byte-by-byte.  */
+L(g1):	rlwinm.	rTMP, rALT, 8, 24, 31
+	stb	rTMP, 4(rDEST)
+	beqlr-
+	rlwinm.	rTMP, rALT, 16, 24, 31
+	stb	rTMP, 5(rDEST)
+	beqlr-
+	rlwinm.	rTMP, rALT, 24, 24, 31
+	stb	rTMP, 6(rDEST)
+	beqlr-
+	stb	rALT, 7(rDEST)
+	/* GKM FIXME: check high bound.  */
+	blr
+
+/* Oh well.  In this case, we just do a byte-by-byte copy.  */
+	.align 4
+	nop
+L(unaligned):
+	lbz	rWORD, 0(rSRC)
+	addi	rDEST, rRTN, -1
+	cmpwi	rWORD, 0
+	beq-	L(u2)
+
+L(u0):	lbzu	rALT, 1(rSRC)
+	stbu	rWORD, 1(rDEST)
+	cmpwi	rALT, 0
+	beq-	L(u1)
+	nop		/* Let 601 load start of loop.  */
+	lbzu	rWORD, 1(rSRC)
+	stbu	rALT, 1(rDEST)
+	cmpwi	rWORD, 0
+	bne+	L(u0)
+L(u2):	stb	rWORD, 1(rDEST)
+	/* GKM FIXME: check high bound.  */
+	blr
+L(u1):	stb	rALT, 1(rDEST)
+	/* GKM FIXME: check high bound.  */
+	blr
+
+END (BP_SYM (strcpy))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/strlen.S ../glibc-2.3/sysdeps/powerpc/powerpc32/strlen.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/strlen.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/strlen.S	Thu Sep  5 04:27:34 2002
@@ -0,0 +1,159 @@
+/* Optimized strlen implementation for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* The algorithm here uses the following techniques:
+
+   1) Given a word 'x', we can test to see if it contains any 0 bytes
+      by subtracting 0x01010101, and seeing if any of the high bits of each
+      byte changed from 0 to 1. This works because the least significant
+      0 byte must have had no incoming carry (otherwise it's not the least
+      significant), so it is 0x00 - 0x01 == 0xff. For all other
+      byte values, either they have the high bit set initially, or when
+      1 is subtracted you get a value in the range 0x00-0x7f, none of which
+      have their high bit set. The expression here is
+      (x + 0xfefefeff) & ~(x | 0x7f7f7f7f), which gives 0x00000000 when
+      there were no 0x00 bytes in the word.
+
+   2) Given a word 'x', we can test to see _which_ byte was zero by
+      calculating ~(((x & 0x7f7f7f7f) + 0x7f7f7f7f) | x | 0x7f7f7f7f).
+      This produces 0x80 in each byte that was zero, and 0x00 in all
+      the other bytes. The '| 0x7f7f7f7f' clears the low 7 bits in each
+      byte, and the '| x' part ensures that bytes with the high bit set
+      produce 0x00. The addition will carry into the high bit of each byte
+      iff that byte had one of its low 7 bits set. We can then just see
+      which was the most significant bit set and divide by 8 to find how
+      many to add to the index.
+      This is from the book 'The PowerPC Compiler Writer's Guide',
+      by Steve Hoxey, Faraydon Karim, Bill Hay and Hank Warren.
+
+   We deal with strings not aligned to a word boundary by taking the
+   first word and ensuring that bytes not part of the string
+   are treated as nonzero. To allow for memory latency, we unroll the
+   loop a few times, being careful to ensure that we do not read ahead
+   across cache line boundaries.
+
+   Questions to answer:
+   1) How long are strings passed to strlen? If they're often really long,
+   we should probably use cache management instructions and/or unroll the
+   loop more. If they're often quite short, it might be better to use
+   fact (2) in the inner loop than have to recalculate it.
+   2) How popular are bytes with the high bit set? If they are very rare,
+   on some processors it might be useful to use the simpler expression
+   ~((x - 0x01010101) | 0x7f7f7f7f) (that is, on processors with only one
+   ALU), but this fails when any character has its high bit set.  */
+
+/* Some notes on register usage: Under the SVR4 ABI, we can use registers
+   0 and 3 through 12 (so long as we don't call any procedures) without
+   saving them. We can also use registers 14 through 31 if we save them.
+   We can't use r1 (it's the stack pointer), r2 nor r13 because the user
+   program may expect them to hold their usual value if we get sent
+   a signal. Integer parameters are passed in r3 through r10.
+   We can use condition registers cr0, cr1, cr5, cr6, and cr7 without saving
+   them, the others we must save.  */
+
+/* int [r3] strlen (char *s [r3])  */
+
+ENTRY (BP_SYM (strlen))
+
+#define rTMP1	r0
+#define rRTN	r3	/* incoming STR arg, outgoing result */
+#define rSTR	r4	/* current string position */
+#define rPADN	r5	/* number of padding bits we prepend to the
+			   string to make it start at a word boundary */
+#define rFEFE	r6	/* constant 0xfefefeff (-0x01010101) */
+#define r7F7F	r7	/* constant 0x7f7f7f7f */
+#define rWORD1	r8	/* current string word */
+#define rWORD2	r9	/* next string word */
+#define rMASK	r9	/* mask for first string word */
+#define rTMP2	r10
+#define rTMP3	r11
+#define rTMP4	r12
+
+	CHECK_BOUNDS_LOW (rRTN, rTMP1, rTMP2)
+
+	clrrwi	rSTR, rRTN, 2
+	lis	r7F7F, 0x7f7f
+	rlwinm	rPADN, rRTN, 3, 27, 28
+	lwz	rWORD1, 0(rSTR)
+	li	rMASK, -1
+	addi	r7F7F, r7F7F, 0x7f7f
+/* That's the setup done, now do the first pair of words.
+   We make an exception and use method (2) on the first two words, to reduce
+   overhead.  */
+	srw	rMASK, rMASK, rPADN
+	and	rTMP1, r7F7F, rWORD1
+	or	rTMP2, r7F7F, rWORD1
+	add	rTMP1, rTMP1, r7F7F
+	nor	rTMP1, rTMP2, rTMP1
+	and.	rWORD1, rTMP1, rMASK
+	mtcrf	0x01, rRTN
+	bne	L(done0)
+	lis	rFEFE, -0x101
+	addi	rFEFE, rFEFE, -0x101
+/* Are we now aligned to a doubleword boundary?  */
+	bt	29, L(loop)
+
+/* Handle second word of pair.  */
+	lwzu	rWORD1, 4(rSTR)
+	and	rTMP1, r7F7F, rWORD1
+	or	rTMP2, r7F7F, rWORD1
+	add	rTMP1, rTMP1, r7F7F
+	nor.	rWORD1, rTMP2, rTMP1
+	bne	L(done0)
+
+/* The loop.  */
+
+L(loop):
+	lwz	rWORD1, 4(rSTR)
+	lwzu	rWORD2, 8(rSTR)
+	add	rTMP1, rFEFE, rWORD1
+	nor	rTMP2, r7F7F, rWORD1
+	and.	rTMP1, rTMP1, rTMP2
+	add	rTMP3, rFEFE, rWORD2
+	nor	rTMP4, r7F7F, rWORD2
+	bne	L(done1)
+	and.	rTMP1, rTMP3, rTMP4
+	beq	L(loop)
+
+	and	rTMP1, r7F7F, rWORD2
+	add	rTMP1, rTMP1, r7F7F
+	andc	rWORD1, rTMP4, rTMP1
+	b	L(done0)
+
+L(done1):
+	and	rTMP1, r7F7F, rWORD1
+	subi	rSTR, rSTR, 4
+	add	rTMP1, rTMP1, r7F7F
+	andc	rWORD1, rTMP2, rTMP1
+
+/* When we get to here, rSTR points to the first word in the string that
+   contains a zero byte, and the most significant set bit in rWORD1 is in that
+   byte.  */
+L(done0):
+	cntlzw	rTMP3, rWORD1
+	subf	rTMP1, rRTN, rSTR
+	srwi	rTMP3, rTMP3, 3
+	add	rRTN, rTMP1, rTMP3
+	/* GKM FIXME: check high bound.  */
+	blr
+END (BP_SYM (strlen))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/sub_n.S ../glibc-2.3/sysdeps/powerpc/powerpc32/sub_n.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/sub_n.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/sub_n.S	Thu Sep  5 04:32:28 2002
@@ -0,0 +1,78 @@
+/* Subtract two limb vectors of equal, non-zero length for PowerPC.
+   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* mp_limb_t mpn_sub_n (mp_ptr res_ptr, mp_srcptr s1_ptr, mp_srcptr s2_ptr,
+                        mp_size_t size)
+   Calculate s1-s2 and put result in res_ptr; return borrow, 0 or 1.  */
+
+/* Note on optimisation: This code is optimal for the 601.  Almost every other
+   possible 2-unrolled inner loop will not be.  Also, watch out for the
+   alignment...  */
+
+EALIGN (BP_SYM (__mpn_sub_n), 3, 1)
+
+#if __BOUNDED_POINTERS__
+	slwi r10,r6,2		/* convert limbs to bytes */
+	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r5, r8, r9, r10)
+#endif
+
+/* Set up for loop below.  */
+	mtcrf 0x01,r6
+	srwi. r7,r6,1
+	mtctr r7
+	bt    31,L(2)
+
+/* Set the carry (clear the borrow).  */
+	subfc r0,r0,r0
+/* Adjust pointers for loop.  */
+	addi  r3,r3,-4
+	addi  r4,r4,-4
+	addi  r5,r5,-4
+	b     L(0)
+
+L(2):	lwz   r7,0(r5)
+	lwz   r6,0(r4)
+	subfc r6,r7,r6
+	stw   r6,0(r3)
+        beq   L(1)
+
+/* Align start of loop to an odd word boundary to guarantee that the
+   last two words can be fetched in one access (for 601).  This turns
+   out to be important.  */
+L(0):
+	lwz   r9,4(r4)
+	lwz   r8,4(r5)
+	lwzu  r6,8(r4)
+	lwzu  r7,8(r5)
+	subfe r8,r8,r9
+	stw   r8,4(r3)
+	subfe r6,r7,r6
+	stwu  r6,8(r3)
+	bdnz  L(0)
+/* Return the borrow. */
+L(1):	subfe r3,r3,r3
+	neg   r3,r3
+	blr
+END (BP_SYM (__mpn_sub_n))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc32/submul_1.S ../glibc-2.3/sysdeps/powerpc/powerpc32/submul_1.S
--- glibc-2.2.93/sysdeps/powerpc/powerpc32/submul_1.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc32/submul_1.S	Thu Sep  5 04:32:46 2002
@@ -0,0 +1,59 @@
+/* Multiply a limb vector by a single limb, for PowerPC.
+   Copyright (C) 1993-1995, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* mp_limb_t mpn_submul_1 (mp_ptr res_ptr, mp_srcptr s1_ptr,
+                           mp_size_t s1_size, mp_limb_t s2_limb)
+   Calculate res-s1*s2 and put result back in res; return carry.  */
+
+ENTRY (BP_SYM (__mpn_submul_1))
+#if __BOUNDED_POINTERS__
+	slwi r10,r5,2		/* convert limbs to bytes */
+	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
+	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
+#endif
+	mtctr	r5
+
+	lwz	r0,0(r4)
+	mullw	r7,r0,r6
+	mulhwu	r10,r0,r6
+	lwz     r9,0(r3)
+	subf 	r8,r7,r9
+	addc    r7,r7,r8		# invert cy (r7 is junk)
+	addi	r3,r3,-4		# adjust res_ptr
+	bdz	L(1)
+
+L(0):	lwzu	r0,4(r4)
+	stwu	r8,4(r3)
+	mullw	r8,r0,r6
+	adde	r7,r8,r10
+	mulhwu	r10,r0,r6
+	lwz     r9,4(r3)
+	addze   r10,r10
+	subf    r8,r7,r9
+	addc    r7,r7,r8		# invert cy (r7 is junk)
+	bdnz	L(0)
+
+L(1):	stw	r8,4(r3)
+	addze	r3,r10
+	blr
+END (BP_SYM (__mpn_submul_1))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/powerpc64/elf/entry.h ../glibc-2.3/sysdeps/powerpc/powerpc64/elf/entry.h
--- glibc-2.2.93/sysdeps/powerpc/powerpc64/elf/entry.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/powerpc64/elf/entry.h	Sat Sep 14 04:54:53 2002
@@ -0,0 +1,34 @@
+/* Finding the entry point and start of text.  PowerPC64 version.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+
+#ifndef __ASSEMBLY__
+extern void _start (void);
+#endif
+
+#define ENTRY_POINT _start
+
+/* We have to provide a special declaration.  */
+#define ENTRY_POINT_DECL(class) class void _start (void);
+
+/* Use the address of ._start as the lowest address for which we need
+   to keep profiling records.  We can't copy the ia64 scheme as our
+   entry poiny address is really the address of the function
+   descriptor, not the actual function entry.  */
+#define TEXT_START (((long int *) ENTRY_POINT)[0])
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/ppc-mcount.S ../glibc-2.3/sysdeps/powerpc/ppc-mcount.S
--- glibc-2.2.93/sysdeps/powerpc/ppc-mcount.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/ppc-mcount.S	Wed Dec 31 19:00:00 1969
@@ -1,85 +0,0 @@
-/* PowerPC-specific implementation of profiling support.
-   Copyright (C) 1997, 1999 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-/* This would be bad.  */
-#ifdef PROF
-#undef PROF
-#endif
-
-#include <sysdep.h>
-
-/* We do profiling as described in the SYSV ELF ABI, _mcount is called
-   with the address of a data word in r0 (that is different for every
-   routine, initialised to 0, and otherwise unused).  The caller has put
-   the address the caller will return to in the usual place on the stack,
-   4(r1).  _mcount is responsible for ensuring that when it returns no
-   argument-passing registers are disturbed, and that the LR is set back
-   to (what the caller sees as) 4(r1).
-
-   This is intended so that the following code can be inserted at the
-   front of any routine without changing the routine:
-
-	.data
-	.align	2
-   0:	.long	0
-	.previous
-	mflr	r0
-	lis	r11,0b@ha
-	stw	r0,4(r1)
-	addi	r0,r11,0b@l
-	bl	_mcount
-*/
-
-ENTRY(_mcount)
-	stwu	r1,-48(r1)
-/* We need to save the parameter-passing registers.  */
-	stw	r3, 12(r1)
-	stw	r4, 16(r1)
-	stw	r5, 20(r1)
-	stw	r6, 24(r1)
-	mflr	r4
-	lwz	r3, 52(r1)
-	mfcr	r5
-	stw	r7, 28(r1)
-	stw	r8, 32(r1)
-	stw	r9, 36(r1)
-	stw	r10,40(r1)
-	stw	r4, 44(r1)
-	stw	r5,  8(r1)
-	bl	JUMPTARGET(__mcount_internal)
-	nop
- /* Restore the registers...  */
-	lwz     r6,  8(r1)
-	lwz	r0, 44(r1)
-	lwz	r3, 12(r1)
-	mtctr	r0
-	lwz	r4, 16(r1)
-	mtcrf	0xff,r6
-	lwz	r5, 20(r1)
-	lwz	r6, 24(r1)
-	lwz	r0, 52(r1)
-	lwz	r7, 28(r1)
-	lwz	r8, 32(r1)
-	mtlr	r0
-	lwz	r9, 36(r1)
-	lwz	r10,40(r1)
- /* ...unwind the stack frame, and return to your usual programming.  */
-	addi	r1,r1,48
-	bctr
-END(_mcount)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/register-dump.h ../glibc-2.3/sysdeps/powerpc/register-dump.h
--- glibc-2.2.93/sysdeps/powerpc/register-dump.h	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/register-dump.h	Wed Dec 31 19:00:00 1969
@@ -1,121 +0,0 @@
-/* Dump registers.
-   Copyright (C) 1998 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sys/uio.h>
-#include <stdio-common/_itoa.h>
-
-/* This prints out the information in the following form: */
-static const char dumpform[] = "\
-Register dump:\n\
-fp0-3:   0000030%0000031% 0000032%0000033% 0000034%0000035% 0000036%0000037%\n\
-fp4-7:   0000038%0000039% 000003a%000003b% 000003c%000003d% 000003e%000003f%\n\
-fp8-11:  0000040%0000041% 0000042%0000043% 0000044%0000045% 0000046%0000047%\n\
-fp12-15: 0000048%0000049% 000004a%000004b% 000004c%000004d% 000004e%000004f%\n\
-fp16-19: 0000050%0000051% 0000052%0000053% 0000054%0000055% 0000056%0000057%\n\
-fp20-23: 0000058%0000059% 000005a%000005b% 000005c%000005d% 000005e%000005f%\n\
-fp24-27: 0000060%0000061% 0000062%0000063% 0000064%0000065% 0000066%0000067%\n\
-fp28-31: 0000068%0000069% 000006a%000006b% 000006c%000006d% 000006e%000006f%\n\
-r0 =0000000% sp =0000001% r2 =0000002% r3 =0000003%  trap=0000028%\n\
-r4 =0000004% r5 =0000005% r6 =0000006% r7 =0000007%   sr0=0000020% sr1=0000021%\n\
-r8 =0000008% r9 =0000009% r10=000000a% r11=000000b%   dar=0000029% dsi=000002a%\n\
-r12=000000c% r13=000000d% r14=000000e% r15=000000f%   r3*=0000022%\n\
-r16=0000010% r17=0000011% r18=0000012% r19=0000013%\n\
-r20=0000014% r21=0000015% r22=0000016% r23=0000017%    lr=0000024% xer=0000025%\n\
-r24=0000018% r25=0000019% r26=000001a% r27=000001b%    mq=0000027% ctr=0000023%\n\
-r28=000001c% r29=000001d% r30=000001e% r31=000001f%  fscr=0000071% ccr=0000026%\n\
-";
-
-/* Most of the fields are self-explanatory.  'sr0' is the next
-   instruction to execute, from SRR0, which may have some relationship
-   with the instruction that caused the exception.  'r3*' is the value
-   that will be returned in register 3 when the current system call
-   returns.  'sr1' is SRR1, bits 16-31 of which are copied from the MSR:
-
-   16 - External interrupt enable
-   17 - Privilege level (1=user, 0=supervisor)
-   18 - FP available
-   19 - Machine check enable (if clear, processor locks up on machine check)
-   20 - FP exception mode bit 0 (FP exceptions recoverable)
-   21 - Single-step trace enable
-   22 - Branch trace enable
-   23 - FP exception mode bit 1
-   25 - exception prefix (if set, exceptions are taken from 0xFFFnnnnn,
-        otherwise from 0x000nnnnn).
-   26 - Instruction address translation enabled.
-   27 - Data address translation enabled.
-   30 - Exception is recoverable (otherwise, don't try to return).
-   31 - Little-endian mode enable.
-
-   'Trap' is the address of the exception:
-
-   00200 - Machine check exception (memory parity error, for instance)
-   00300 - Data access exception (memory not mapped, see dsisr for why)
-   00400 - Instruction access exception (memory not mapped)
-   00500 - External interrupt
-   00600 - Alignment exception (see dsisr for more information)
-   00700 - Program exception (illegal/trap instruction, FP exception)
-   00800 - FP unavailable (should not be seen by user code)
-   00900 - Decrementer exception (for instance, SIGALRM)
-   00A00 - I/O controller interface exception
-   00C00 - System call exception (for instance, kill(3)).
-   00E00 - FP assist exception (optional FP instructions, etc.)
-
-   'dar' is the memory location, for traps 00300, 00400, 00600, 00A00.
-   'dsisr' has the following bits under trap 00300:
-   0 - direct-store error exception
-   1 - no page table entry for page
-   4 - memory access not permitted
-   5 - trying to access I/O controller space or using lwarx/stwcx on
-       non-write-cached memory
-   6 - access was store
-   9 - data access breakpoint hit
-   10 - segment table search failed to find translation (64-bit ppcs only)
-   11 - I/O controller instruction not permitted
-   For trap 00400, the same bits are set in SRR1 instead.
-   For trap 00600, bits 12-31 of the DSISR set to allow emulation of
-   the instruction without actually having to read it from memory.
-*/
-
-#define xtoi(x) (x >= 'a' ? x + 10 - 'a' : x - '0')
-
-static void
-register_dump (int fd, struct sigcontext *ctx)
-{
-  char buffer[sizeof(dumpform)];
-  char *bufferpos;
-  unsigned regno;
-  unsigned *regs = (unsigned *)(ctx->regs);
-
-  memcpy(buffer, dumpform, sizeof(dumpform));
-
-  /* Generate the output.  */
-  while ((bufferpos = memchr (buffer, '%', sizeof(dumpform))))
-    {
-      regno = xtoi (bufferpos[-1]) | xtoi (bufferpos[-2]) << 4;
-      memset (bufferpos-2, '0', 3);
-      _itoa_word (regs[regno], bufferpos+1, 16, 0);
-    }
-
-  /* Write the output.  */
-  write (fd, buffer, sizeof(buffer));
-}
-
-
-#define REGISTER_DUMP \
-  register_dump (fd, ctx)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/rshift.S ../glibc-2.3/sysdeps/powerpc/rshift.S
--- glibc-2.2.93/sysdeps/powerpc/rshift.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/rshift.S	Wed Dec 31 19:00:00 1969
@@ -1,63 +0,0 @@
-/* Shift a limb right, low level routine.
-   Copyright (C) 1995, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* INPUT PARAMETERS
-   res_ptr	r3
-   s1_ptr	r4
-   size		r5
-   cnt		r6  */
-
-ENTRY (BP_SYM (__mpn_rshift))
-#if __BOUNDED_POINTERS__
-	slwi r10,r5,2		/* convert limbs to bytes */
-	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
-#endif
-	mtctr	r5		# copy size into CTR
-	addi	r7,r3,-4	# move adjusted res_ptr to free return reg
-	subfic	r8,r6,32
-	lwz	r11,0(r4)	# load first s1 limb
-	slw	r3,r11,r8	# compute function return value
-	bdz	L(1)
-
-L(0):	lwzu	r10,4(r4)
-	srw	r9,r11,r6
-	slw	r12,r10,r8
-	or	r9,r9,r12
-	stwu	r9,4(r7)
-	bdz	L(2)
-	lwzu	r11,4(r4)
-	srw	r9,r10,r6
-	slw	r12,r11,r8
-	or	r9,r9,r12
-	stwu	r9,4(r7)
-	bdnz	L(0)
-
-L(1):	srw	r0,r11,r6
-	stw	r0,4(r7)
-	blr
-
-L(2):	srw	r0,r10,r6
-	stw	r0,4(r7)
-	blr
-END (BP_SYM (__mpn_rshift))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/setjmp.S ../glibc-2.3/sysdeps/powerpc/setjmp.S
--- glibc-2.2.93/sysdeps/powerpc/setjmp.S	Thu Dec  6 02:53:55 2001
+++ ../glibc-2.3/sysdeps/powerpc/setjmp.S	Wed Dec 31 19:00:00 1969
@@ -1,55 +0,0 @@
-/* setjmp for PowerPC.
-   Copyright (C) 1995, 1996, 1997, 1999, 2000, 2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#define _ASM
-#define _SETJMP_H
-#include <bits/setjmp.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-ENTRY (BP_SYM (__sigsetjmp))
-	CHECK_BOUNDS_BOTH_WIDE_LIT (r3, r8, r9, JB_SIZE)
-
-	stw  r1,(JB_GPR1*4)(3)
-	mflr r0
-	stw  r2,(JB_GPR2*4)(3)
-	stw  r14,((JB_GPRS+0)*4)(3)
-	stw  r0,(JB_LR*4)(3)
-	stw  r15,((JB_GPRS+1)*4)(3)
-	mfcr r0
-	stw  r16,((JB_GPRS+2)*4)(3)
-	stw  r0,(JB_CR*4)(3)
-	stw  r17,((JB_GPRS+3)*4)(3)
-	stw  r18,((JB_GPRS+4)*4)(3)
-	stw  r19,((JB_GPRS+5)*4)(3)
-	stw  r20,((JB_GPRS+6)*4)(3)
-	stw  r21,((JB_GPRS+7)*4)(3)
-	stw  r22,((JB_GPRS+8)*4)(3)
-	stw  r23,((JB_GPRS+9)*4)(3)
-	stw  r24,((JB_GPRS+10)*4)(3)
-	stw  r25,((JB_GPRS+11)*4)(3)
-	stw  r26,((JB_GPRS+12)*4)(3)
-	stw  r27,((JB_GPRS+13)*4)(3)
-	stw  r28,((JB_GPRS+14)*4)(3)
-	stw  r29,((JB_GPRS+15)*4)(3)
-	stw  r30,((JB_GPRS+16)*4)(3)
-	stw  r31,((JB_GPRS+17)*4)(3)
-	b JUMPTARGET (BP_SYM (__sigjmp_save))
-END (BP_SYM (__sigsetjmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/stpcpy.S ../glibc-2.3/sysdeps/powerpc/stpcpy.S
--- glibc-2.2.93/sysdeps/powerpc/stpcpy.S	Sat Aug  3 19:29:00 2002
+++ ../glibc-2.3/sysdeps/powerpc/stpcpy.S	Wed Dec 31 19:00:00 1969
@@ -1,121 +0,0 @@
-/* Optimized stpcpy implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* See strlen.s for comments on how the end-of-string testing works.  */
-
-/* char * [r3] stpcpy (char *dest [r3], const char *src [r4])  */
-
-EALIGN (BP_SYM (__stpcpy), 4, 0)
-
-#define rTMP	r0
-#define rRTN	r3
-#if __BOUNDED_POINTERS__
-# define rDEST	r4		/* pointer to previous word in dest */
-# define rSRC	r5		/* pointer to previous word in src */
-# define rLOW	r11
-# define rHIGH	r12
-#else
-# define rDEST	r3		/* pointer to previous word in dest */
-# define rSRC	r4		/* pointer to previous word in src */
-#endif
-#define rWORD	r6		/* current word from src */
-#define rFEFE	r7		/* 0xfefefeff */
-#define r7F7F	r8		/* 0x7f7f7f7f */
-#define rNEG	r9		/* ~(word in src | 0x7f7f7f7f) */
-#define rALT	r10		/* alternate word from src */
-
-	CHECK_BOUNDS_LOW (rSRC, rLOW, rHIGH)
-	CHECK_BOUNDS_LOW (rDEST, rLOW, rHIGH)
-	STORE_RETURN_BOUNDS (rLOW, rHIGH)
-
-	or	rTMP, rSRC, rDEST
-	clrlwi.	rTMP, rTMP, 30
-	addi	rDEST, rDEST, -4
-	bne	L(unaligned)
-
-	lis	rFEFE, -0x101
-	lis	r7F7F, 0x7f7f
-	lwz	rWORD, 0(rSRC)
-	addi	rFEFE, rFEFE, -0x101
-	addi	r7F7F, r7F7F, 0x7f7f
-	b	L(g2)
-
-L(g0):	lwzu	rALT, 4(rSRC)
-	stwu	rWORD, 4(rDEST)
-	add	rTMP, rFEFE, rALT
-	nor	rNEG, r7F7F, rALT
-	and.	rTMP, rTMP, rNEG
-	bne-	L(g1)
-	lwzu	rWORD, 4(rSRC)
-	stwu	rALT, 4(rDEST)
-L(g2):	add	rTMP, rFEFE, rWORD
-	nor	rNEG, r7F7F, rWORD
-	and.	rTMP, rTMP, rNEG
-	beq+	L(g0)
-
-	mr	rALT, rWORD
-/* We've hit the end of the string.  Do the rest byte-by-byte.  */
-L(g1):	rlwinm.	rTMP, rALT, 8, 24, 31
-	stbu	rTMP, 4(rDEST)
-	beqlr-
-	rlwinm.	rTMP, rALT, 16, 24, 31
-	stbu	rTMP, 1(rDEST)
-	beqlr-
-	rlwinm.	rTMP, rALT, 24, 24, 31
-	stbu	rTMP, 1(rDEST)
-	beqlr-
-	stbu	rALT, 1(rDEST)
-	CHECK_BOUNDS_HIGH (rDEST, rHIGH, twlgt)
-	STORE_RETURN_VALUE (rDEST)
-	blr
-
-/* Oh well.  In this case, we just do a byte-by-byte copy.  */
-	.align 4
-	nop
-L(unaligned):
-	lbz	rWORD, 0(rSRC)
-	addi	rDEST, rDEST, 3
-	cmpwi	rWORD, 0
-	beq-	L(u2)
-
-L(u0):	lbzu	rALT, 1(rSRC)
-	stbu	rWORD, 1(rDEST)
-	cmpwi	rALT, 0
-	beq-	L(u1)
-	nop		/* Let 601 load start of loop.  */
-	lbzu	rWORD, 1(rSRC)
-	stbu	rALT, 1(rDEST)
-	cmpwi	rWORD, 0
-	bne+	L(u0)
-L(u2):	stbu	rWORD, 1(rDEST)
-	CHECK_BOUNDS_HIGH (rDEST, rHIGH, twlgt)
-	STORE_RETURN_VALUE (rDEST)
-	blr
-L(u1):	stbu	rALT, 1(rDEST)
-	CHECK_BOUNDS_HIGH (rDEST, rHIGH, twlgt)
-	STORE_RETURN_VALUE (rDEST)
-	blr
-END (BP_SYM (__stpcpy))
-
-weak_alias (BP_SYM (__stpcpy), BP_SYM (stpcpy))
-libc_hidden_def (__stpcpy)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/strchr.S ../glibc-2.3/sysdeps/powerpc/strchr.S
--- glibc-2.2.93/sysdeps/powerpc/strchr.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/strchr.S	Wed Dec 31 19:00:00 1969
@@ -1,130 +0,0 @@
-/* Optimized strchr implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* See strlen.s for comments on how this works.  */
-
-/* char * [r3] strchr (const char *s [r3] , int c [r4] )  */
-
-ENTRY (BP_SYM (strchr))
-
-#define rTMP1	r0
-#define rRTN	r3	/* outgoing result */
-#if __BOUNDED_POINTERS__
-# define rSTR	r4
-# define rCHR	r5	/* byte we're looking for, spread over the whole word */
-# define rWORD	r8	/* the current word */
-#else
-# define rSTR	r8	/* current word pointer */
-# define rCHR	r4	/* byte we're looking for, spread over the whole word */
-# define rWORD	r5	/* the current word */
-#endif
-#define rCLZB	rCHR	/* leading zero byte count */
-#define rFEFE	r6	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r7	/* constant 0x7f7f7f7f */
-#define rTMP2	r9
-#define rIGN	r10	/* number of bits we should ignore in the first word */
-#define rMASK	r11	/* mask with the bits to ignore set to 0 */
-#define rTMP3	r12
-
-	CHECK_BOUNDS_LOW (rSTR, rTMP1, rTMP2)
-	STORE_RETURN_BOUNDS (rTMP1, rTMP2)
-
-	rlwimi	rCHR, rCHR, 8, 16, 23
-	li	rMASK, -1
-	rlwimi	rCHR, rCHR, 16, 0, 15
-	rlwinm	rIGN, rRTN, 3, 27, 28
-	lis	rFEFE, -0x101
-	lis	r7F7F, 0x7f7f
-	clrrwi	rSTR, rRTN, 2
-	addi	rFEFE, rFEFE, -0x101
-	addi	r7F7F, r7F7F, 0x7f7f
-/* Test the first (partial?) word.  */
-	lwz	rWORD, 0(rSTR)
-	srw	rMASK, rMASK, rIGN
-	orc	rWORD, rWORD, rMASK
-	add	rTMP1, rFEFE, rWORD
-	nor	rTMP2, r7F7F, rWORD
-	and.	rTMP1, rTMP1, rTMP2
-	xor	rTMP3, rCHR, rWORD
-	orc	rTMP3, rTMP3, rMASK
-	b	L(loopentry)
-
-/* The loop.  */
-
-L(loop):lwzu rWORD, 4(rSTR)
-	and.	rTMP1, rTMP1, rTMP2
-/* Test for 0.	*/
-	add	rTMP1, rFEFE, rWORD
-	nor	rTMP2, r7F7F, rWORD
-	bne	L(foundit)
-	and.	rTMP1, rTMP1, rTMP2
-/* Start test for the bytes we're looking for.  */
-	xor	rTMP3, rCHR, rWORD
-L(loopentry):
-	add	rTMP1, rFEFE, rTMP3
-	nor	rTMP2, r7F7F, rTMP3
-	beq	L(loop)
-/* There is a zero byte in the word, but may also be a matching byte (either
-   before or after the zero byte).  In fact, we may be looking for a
-   zero byte, in which case we return a match.  We guess that this hasn't
-   happened, though.  */
-L(missed):
-	and.	rTMP1, rTMP1, rTMP2
-	li	rRTN, 0
-	STORE_RETURN_VALUE (rSTR)
-	beqlr
-/* It did happen. Decide which one was first...
-   I'm not sure if this is actually faster than a sequence of
-   rotates, compares, and branches (we use it anyway because it's shorter).  */
-	and	rFEFE, r7F7F, rWORD
-	or	rMASK, r7F7F, rWORD
-	and	rTMP1, r7F7F, rTMP3
-	or	rIGN, r7F7F, rTMP3
-	add	rFEFE, rFEFE, r7F7F
-	add	rTMP1, rTMP1, r7F7F
-	nor	rWORD, rMASK, rFEFE
-	nor	rTMP2, rIGN, rTMP1
-	cmplw	rWORD, rTMP2
-	bgtlr
-	cntlzw	rCLZB, rTMP2
-	srwi	rCLZB, rCLZB, 3
-	add	rRTN, rSTR, rCLZB
-	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, twlge)
-	STORE_RETURN_VALUE (rSTR)
-	blr
-
-L(foundit):
-	and	rTMP1, r7F7F, rTMP3
-	or	rIGN, r7F7F, rTMP3
-	add	rTMP1, rTMP1, r7F7F
-	nor	rTMP2, rIGN, rTMP1
-	cntlzw	rCLZB, rTMP2
-	subi	rSTR, rSTR, 4
-	srwi	rCLZB, rCLZB, 3
-	add	rRTN, rSTR, rCLZB
-	CHECK_BOUNDS_HIGH_RTN (rSTR, rTMP2, twlge)
-	STORE_RETURN_VALUE (rSTR)
-	blr
-END (BP_SYM (strchr))
-
-weak_alias (BP_SYM (strchr), BP_SYM (index))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/strcmp.S ../glibc-2.3/sysdeps/powerpc/strcmp.S
--- glibc-2.2.93/sysdeps/powerpc/strcmp.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/strcmp.S	Wed Dec 31 19:00:00 1969
@@ -1,126 +0,0 @@
-/* Optimized strcmp implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* See strlen.s for comments on how the end-of-string testing works.  */
-
-/* int [r3] strcmp (const char *s1 [r3], const char *s2 [r4])  */
-
-EALIGN (BP_SYM (strcmp), 4, 0)
-
-#define rTMP	r0
-#define rRTN	r3
-#define rSTR1	r3	/* first string arg */
-#define rSTR2	r4	/* second string arg */
-#if __BOUNDED_POINTERS__
-# define rHIGH1	r11
-# define rHIGH2 r12
-#endif
-#define rWORD1	r5	/* current word in s1 */
-#define rWORD2	r6	/* current word in s2 */
-#define rFEFE	r7	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r8	/* constant 0x7f7f7f7f */
-#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f) */
-#define rBITDIF	r10	/* bits that differ in s1 & s2 words */
-
-	CHECK_BOUNDS_LOW (rSTR1, rTMP, rHIGH1)
-	CHECK_BOUNDS_LOW (rSTR2, rTMP, rHIGH2)
-
-	or	rTMP, rSTR2, rSTR1
-	clrlwi.	rTMP, rTMP, 30
-	lis	rFEFE, -0x101
-	bne	L(unaligned)
-
-	lwz	rWORD1, 0(rSTR1)
-	lwz	rWORD2, 0(rSTR2)
-	lis	r7F7F, 0x7f7f
-	addi	rFEFE, rFEFE, -0x101
-	addi	r7F7F, r7F7F, 0x7f7f
-	b	L(g1)
-
-L(g0):	lwzu	rWORD1, 4(rSTR1)
-	bne	cr1, L(different)
-	lwzu	rWORD2, 4(rSTR2)
-L(g1):	add	rTMP, rFEFE, rWORD1
-	nor	rNEG, r7F7F, rWORD1
-	and.	rTMP, rTMP, rNEG
-	cmpw	cr1, rWORD1, rWORD2
-	beq+	L(g0)
-L(endstring):
-/* OK. We've hit the end of the string. We need to be careful that
-   we don't compare two strings as different because of gunk beyond
-   the end of the strings...  */
-	and	rTMP, r7F7F, rWORD1
-	beq	cr1, L(equal)
-	add	rTMP, rTMP, r7F7F
-	xor.	rBITDIF, rWORD1, rWORD2
-	andc	rNEG, rNEG, rTMP
-	blt-	L(highbit)
-	cntlzw	rBITDIF, rBITDIF
-	cntlzw	rNEG, rNEG
-	addi	rNEG, rNEG, 7
-	cmpw	cr1, rNEG, rBITDIF
-	sub	rRTN, rWORD1, rWORD2
-	bgelr+	cr1
-L(equal):
-	li	rRTN, 0
-	/* GKM FIXME: check high bounds.  */
-	blr
-
-L(different):
-	lwz	rWORD1, -4(rSTR1)
-	xor.	rBITDIF, rWORD1, rWORD2
-	sub	rRTN, rWORD1, rWORD2
-	bgelr+
-L(highbit):
-	ori	rRTN, rWORD2, 1
-	/* GKM FIXME: check high bounds.  */
-	blr
-
-
-/* Oh well.  In this case, we just do a byte-by-byte comparison.  */
-	.align 4
-L(unaligned):
-	lbz	rWORD1, 0(rSTR1)
-	lbz	rWORD2, 0(rSTR2)
-	b	L(u1)
-
-L(u0):	lbzu	rWORD1, 1(rSTR1)
-	bne-	L(u4)
-	lbzu	rWORD2, 1(rSTR2)
-L(u1):	cmpwi	cr1, rWORD1, 0
-	beq-	cr1, L(u3)
-	cmpw	rWORD1, rWORD2
-	bne-	L(u3)
-	lbzu	rWORD1, 1(rSTR1)
-	lbzu	rWORD2, 1(rSTR2)
-	cmpwi	cr1, rWORD1, 0
-	cmpw	rWORD1, rWORD2
-	bne+	cr1, L(u0)
-L(u3):	sub	rRTN, rWORD1, rWORD2
-	/* GKM FIXME: check high bounds.  */
-	blr
-L(u4):	lbz	rWORD1, -1(rSTR1)
-	sub	rRTN, rWORD1, rWORD2
-	/* GKM FIXME: check high bounds.  */
-	blr
-END (BP_SYM (strcmp))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/strcpy.S ../glibc-2.3/sysdeps/powerpc/strcpy.S
--- glibc-2.2.93/sysdeps/powerpc/strcpy.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/strcpy.S	Wed Dec 31 19:00:00 1969
@@ -1,120 +0,0 @@
-/* Optimized strcpy implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* See strlen.s for comments on how the end-of-string testing works.  */
-
-/* char * [r3] strcpy (char *dest [r3], const char *src [r4])  */
-
-EALIGN (BP_SYM (strcpy), 4, 0)
-
-#define rTMP	r0
-#define rRTN	r3	/* incoming DEST arg preserved as result */
-#if __BOUNDED_POINTERS__
-# define rDEST	r4	/* pointer to previous word in dest */
-# define rSRC	r5	/* pointer to previous word in src */
-# define rLOW	r11
-# define rHIGH	r12
-#else
-# define rSRC	r4	/* pointer to previous word in src */
-# define rDEST	r5	/* pointer to previous word in dest */
-#endif
-#define rWORD	r6	/* current word from src */
-#define rFEFE	r7	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r8	/* constant 0x7f7f7f7f */
-#define rNEG	r9	/* ~(word in s1 | 0x7f7f7f7f) */
-#define rALT	r10	/* alternate word from src */
-
-	CHECK_BOUNDS_LOW (rSRC, rLOW, rHIGH)
-	CHECK_BOUNDS_LOW (rDEST, rLOW, rHIGH)
-	STORE_RETURN_BOUNDS (rLOW, rHIGH)
-
-	or	rTMP, rSRC, rRTN
-	clrlwi.	rTMP, rTMP, 30
-#if __BOUNDED_POINTERS__
-	addi	rDEST, rDEST, -4
-#else
-	addi	rDEST, rRTN, -4
-#endif
-	bne	L(unaligned)
-
-	lis	rFEFE, -0x101
-	lis	r7F7F, 0x7f7f
-	lwz	rWORD, 0(rSRC)
-	addi	rFEFE, rFEFE, -0x101
-	addi	r7F7F, r7F7F, 0x7f7f
-	b	L(g2)
-
-L(g0):	lwzu	rALT, 4(rSRC)
-	stwu	rWORD, 4(rDEST)
-	add	rTMP, rFEFE, rALT
-	nor	rNEG, r7F7F, rALT
-	and.	rTMP, rTMP, rNEG
-	bne-	L(g1)
-	lwzu	rWORD, 4(rSRC)
-	stwu	rALT, 4(rDEST)
-L(g2):	add	rTMP, rFEFE, rWORD
-	nor	rNEG, r7F7F, rWORD
-	and.	rTMP, rTMP, rNEG
-	beq+	L(g0)
-
-	mr	rALT, rWORD
-/* We've hit the end of the string.  Do the rest byte-by-byte.  */
-L(g1):	rlwinm.	rTMP, rALT, 8, 24, 31
-	stb	rTMP, 4(rDEST)
-	beqlr-
-	rlwinm.	rTMP, rALT, 16, 24, 31
-	stb	rTMP, 5(rDEST)
-	beqlr-
-	rlwinm.	rTMP, rALT, 24, 24, 31
-	stb	rTMP, 6(rDEST)
-	beqlr-
-	stb	rALT, 7(rDEST)
-	/* GKM FIXME: check high bound.  */
-	blr
-
-/* Oh well.  In this case, we just do a byte-by-byte copy.  */
-	.align 4
-	nop
-L(unaligned):
-	lbz	rWORD, 0(rSRC)
-	addi	rDEST, rRTN, -1
-	cmpwi	rWORD, 0
-	beq-	L(u2)
-
-L(u0):	lbzu	rALT, 1(rSRC)
-	stbu	rWORD, 1(rDEST)
-	cmpwi	rALT, 0
-	beq-	L(u1)
-	nop		/* Let 601 load start of loop.  */
-	lbzu	rWORD, 1(rSRC)
-	stbu	rALT, 1(rDEST)
-	cmpwi	rWORD, 0
-	bne+	L(u0)
-L(u2):	stb	rWORD, 1(rDEST)
-	/* GKM FIXME: check high bound.  */
-	blr
-L(u1):	stb	rALT, 1(rDEST)
-	/* GKM FIXME: check high bound.  */
-	blr
-
-END (BP_SYM (strcpy))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/strlen.S ../glibc-2.3/sysdeps/powerpc/strlen.S
--- glibc-2.2.93/sysdeps/powerpc/strlen.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/strlen.S	Wed Dec 31 19:00:00 1969
@@ -1,159 +0,0 @@
-/* Optimized strlen implementation for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* The algorithm here uses the following techniques:
-
-   1) Given a word 'x', we can test to see if it contains any 0 bytes
-      by subtracting 0x01010101, and seeing if any of the high bits of each
-      byte changed from 0 to 1. This works because the least significant
-      0 byte must have had no incoming carry (otherwise it's not the least
-      significant), so it is 0x00 - 0x01 == 0xff. For all other
-      byte values, either they have the high bit set initially, or when
-      1 is subtracted you get a value in the range 0x00-0x7f, none of which
-      have their high bit set. The expression here is
-      (x + 0xfefefeff) & ~(x | 0x7f7f7f7f), which gives 0x00000000 when
-      there were no 0x00 bytes in the word.
-
-   2) Given a word 'x', we can test to see _which_ byte was zero by
-      calculating ~(((x & 0x7f7f7f7f) + 0x7f7f7f7f) | x | 0x7f7f7f7f).
-      This produces 0x80 in each byte that was zero, and 0x00 in all
-      the other bytes. The '| 0x7f7f7f7f' clears the low 7 bits in each
-      byte, and the '| x' part ensures that bytes with the high bit set
-      produce 0x00. The addition will carry into the high bit of each byte
-      iff that byte had one of its low 7 bits set. We can then just see
-      which was the most significant bit set and divide by 8 to find how
-      many to add to the index.
-      This is from the book 'The PowerPC Compiler Writer's Guide',
-      by Steve Hoxey, Faraydon Karim, Bill Hay and Hank Warren.
-
-   We deal with strings not aligned to a word boundary by taking the
-   first word and ensuring that bytes not part of the string
-   are treated as nonzero. To allow for memory latency, we unroll the
-   loop a few times, being careful to ensure that we do not read ahead
-   across cache line boundaries.
-
-   Questions to answer:
-   1) How long are strings passed to strlen? If they're often really long,
-   we should probably use cache management instructions and/or unroll the
-   loop more. If they're often quite short, it might be better to use
-   fact (2) in the inner loop than have to recalculate it.
-   2) How popular are bytes with the high bit set? If they are very rare,
-   on some processors it might be useful to use the simpler expression
-   ~((x - 0x01010101) | 0x7f7f7f7f) (that is, on processors with only one
-   ALU), but this fails when any character has its high bit set.  */
-
-/* Some notes on register usage: Under the SVR4 ABI, we can use registers
-   0 and 3 through 12 (so long as we don't call any procedures) without
-   saving them. We can also use registers 14 through 31 if we save them.
-   We can't use r1 (it's the stack pointer), r2 nor r13 because the user
-   program may expect them to hold their usual value if we get sent
-   a signal. Integer parameters are passed in r3 through r10.
-   We can use condition registers cr0, cr1, cr5, cr6, and cr7 without saving
-   them, the others we must save.  */
-
-/* int [r3] strlen (char *s [r3])  */
-
-ENTRY (BP_SYM (strlen))
-
-#define rTMP1	r0
-#define rRTN	r3	/* incoming STR arg, outgoing result */
-#define rSTR	r4	/* current string position */
-#define rPADN	r5	/* number of padding bits we prepend to the
-			   string to make it start at a word boundary */
-#define rFEFE	r6	/* constant 0xfefefeff (-0x01010101) */
-#define r7F7F	r7	/* constant 0x7f7f7f7f */
-#define rWORD1	r8	/* current string word */
-#define rWORD2	r9	/* next string word */
-#define rMASK	r9	/* mask for first string word */
-#define rTMP2	r10
-#define rTMP3	r11
-#define rTMP4	r12
-
-	CHECK_BOUNDS_LOW (rRTN, rTMP1, rTMP2)
-
-	clrrwi	rSTR, rRTN, 2
-	lis	r7F7F, 0x7f7f
-	rlwinm	rPADN, rRTN, 3, 27, 28
-	lwz	rWORD1, 0(rSTR)
-	li	rMASK, -1
-	addi	r7F7F, r7F7F, 0x7f7f
-/* That's the setup done, now do the first pair of words.
-   We make an exception and use method (2) on the first two words, to reduce
-   overhead.  */
-	srw	rMASK, rMASK, rPADN
-	and	rTMP1, r7F7F, rWORD1
-	or	rTMP2, r7F7F, rWORD1
-	add	rTMP1, rTMP1, r7F7F
-	nor	rTMP1, rTMP2, rTMP1
-	and.	rWORD1, rTMP1, rMASK
-	mtcrf	0x01, rRTN
-	bne	L(done0)
-	lis	rFEFE, -0x101
-	addi	rFEFE, rFEFE, -0x101
-/* Are we now aligned to a doubleword boundary?  */
-	bt	29, L(loop)
-
-/* Handle second word of pair.  */
-	lwzu	rWORD1, 4(rSTR)
-	and	rTMP1, r7F7F, rWORD1
-	or	rTMP2, r7F7F, rWORD1
-	add	rTMP1, rTMP1, r7F7F
-	nor.	rWORD1, rTMP2, rTMP1
-	bne	L(done0)
-
-/* The loop.  */
-
-L(loop):
-	lwz	rWORD1, 4(rSTR)
-	lwzu	rWORD2, 8(rSTR)
-	add	rTMP1, rFEFE, rWORD1
-	nor	rTMP2, r7F7F, rWORD1
-	and.	rTMP1, rTMP1, rTMP2
-	add	rTMP3, rFEFE, rWORD2
-	nor	rTMP4, r7F7F, rWORD2
-	bne	L(done1)
-	and.	rTMP1, rTMP3, rTMP4
-	beq	L(loop)
-
-	and	rTMP1, r7F7F, rWORD2
-	add	rTMP1, rTMP1, r7F7F
-	andc	rWORD1, rTMP4, rTMP1
-	b	L(done0)
-
-L(done1):
-	and	rTMP1, r7F7F, rWORD1
-	subi	rSTR, rSTR, 4
-	add	rTMP1, rTMP1, r7F7F
-	andc	rWORD1, rTMP2, rTMP1
-
-/* When we get to here, rSTR points to the first word in the string that
-   contains a zero byte, and the most significant set bit in rWORD1 is in that
-   byte.  */
-L(done0):
-	cntlzw	rTMP3, rWORD1
-	subf	rTMP1, rRTN, rSTR
-	srwi	rTMP3, rTMP3, 3
-	add	rRTN, rTMP1, rTMP3
-	/* GKM FIXME: check high bound.  */
-	blr
-END (BP_SYM (strlen))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/sub_n.S ../glibc-2.3/sysdeps/powerpc/sub_n.S
--- glibc-2.2.93/sysdeps/powerpc/sub_n.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/sub_n.S	Wed Dec 31 19:00:00 1969
@@ -1,78 +0,0 @@
-/* Subtract two limb vectors of equal, non-zero length for PowerPC.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* mp_limb_t mpn_sub_n (mp_ptr res_ptr, mp_srcptr s1_ptr, mp_srcptr s2_ptr,
-                        mp_size_t size)
-   Calculate s1-s2 and put result in res_ptr; return borrow, 0 or 1.  */
-
-/* Note on optimisation: This code is optimal for the 601.  Almost every other
-   possible 2-unrolled inner loop will not be.  Also, watch out for the
-   alignment...  */
-
-EALIGN (BP_SYM (__mpn_sub_n), 3, 1)
-
-#if __BOUNDED_POINTERS__
-	slwi r10,r6,2		/* convert limbs to bytes */
-	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r5, r8, r9, r10)
-#endif
-
-/* Set up for loop below.  */
-	mtcrf 0x01,r6
-	srwi. r7,r6,1
-	mtctr r7
-	bt    31,L(2)
-
-/* Set the carry (clear the borrow).  */
-	subfc r0,r0,r0
-/* Adjust pointers for loop.  */
-	addi  r3,r3,-4
-	addi  r4,r4,-4
-	addi  r5,r5,-4
-	b     L(0)
-
-L(2):	lwz   r7,0(r5)
-	lwz   r6,0(r4)
-	subfc r6,r7,r6
-	stw   r6,0(r3)
-        beq   L(1)
-
-/* Align start of loop to an odd word boundary to guarantee that the
-   last two words can be fetched in one access (for 601).  This turns
-   out to be important.  */
-L(0):
-	lwz   r9,4(r4)
-	lwz   r8,4(r5)
-	lwzu  r6,8(r4)
-	lwzu  r7,8(r5)
-	subfe r8,r8,r9
-	stw   r8,4(r3)
-	subfe r6,r7,r6
-	stwu  r6,8(r3)
-	bdnz  L(0)
-/* Return the borrow. */
-L(1):	subfe r3,r3,r3
-	neg   r3,r3
-	blr
-END (BP_SYM (__mpn_sub_n))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/submul_1.S ../glibc-2.3/sysdeps/powerpc/submul_1.S
--- glibc-2.2.93/sysdeps/powerpc/submul_1.S	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/powerpc/submul_1.S	Wed Dec 31 19:00:00 1969
@@ -1,59 +0,0 @@
-/* Multiply a limb vector by a single limb, for PowerPC.
-   Copyright (C) 1993-1995, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* mp_limb_t mpn_submul_1 (mp_ptr res_ptr, mp_srcptr s1_ptr,
-                           mp_size_t s1_size, mp_limb_t s2_limb)
-   Calculate res-s1*s2 and put result back in res; return carry.  */
-
-ENTRY (BP_SYM (__mpn_submul_1))
-#if __BOUNDED_POINTERS__
-	slwi r10,r5,2		/* convert limbs to bytes */
-	CHECK_BOUNDS_BOTH_WIDE (r3, r8, r9, r10)
-	CHECK_BOUNDS_BOTH_WIDE (r4, r8, r9, r10)
-#endif
-	mtctr	r5
-
-	lwz	r0,0(r4)
-	mullw	r7,r0,r6
-	mulhwu	r10,r0,r6
-	lwz     r9,0(r3)
-	subf 	r8,r7,r9
-	addc    r7,r7,r8		# invert cy (r7 is junk)
-	addi	r3,r3,-4		# adjust res_ptr
-	bdz	L(1)
-
-L(0):	lwzu	r0,4(r4)
-	stwu	r8,4(r3)
-	mullw	r8,r0,r6
-	adde	r7,r8,r10
-	mulhwu	r10,r0,r6
-	lwz     r9,4(r3)
-	addze   r10,r10
-	subf    r8,r7,r9
-	addc    r7,r7,r8		# invert cy (r7 is junk)
-	bdnz	L(0)
-
-L(1):	stw	r8,4(r3)
-	addze	r3,r10
-	blr
-END (BP_SYM (__mpn_submul_1))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/test-arith.c ../glibc-2.3/sysdeps/powerpc/test-arith.c
--- glibc-2.2.93/sysdeps/powerpc/test-arith.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/test-arith.c	Fri Jul  6 00:56:01 2001
@@ -0,0 +1,605 @@
+/* Test floating-point arithmetic operations.
+   Copyright (C) 1997, 1998 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+#ifndef _GNU_SOURCE
+#define _GNU_SOURCE
+#endif
+#include <math.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <fenv.h>
+#include <assert.h>
+
+#ifndef ESIZE
+typedef double tocheck_t;
+#define ESIZE 11
+#define MSIZE 52
+#define FUNC(x) x
+#endif
+
+#define R_NEAREST 1
+#define R_ZERO 2
+#define R_UP 4
+#define R_DOWN 8
+#define R_ALL (R_NEAREST|R_ZERO|R_UP|R_DOWN)
+static fenv_t rmodes[4];
+static const char * const rmnames[4] =
+{ "nearest","zero","+Inf","-Inf" };
+
+typedef union {
+  tocheck_t tc;
+  unsigned char c[sizeof(tocheck_t)];
+} union_t;
+
+/* Don't try reading these in a font that doesn't distinguish
+   O and zero.  */
+typedef enum {
+  P_Z    = 0x0,  /* 00000...0 */
+  P_000O = 0x1,  /* 00011...1 */
+  P_001Z = 0x2,  /* 00100...0 */
+  P_00O  = 0x3,  /* 00111...1 */
+  P_01Z  = 0x4,  /* 01000...0 */
+  P_010O = 0x5,  /* 01011...1 */
+  P_011Z = 0x6,  /* 01100...0 */
+  P_0O   = 0x7,  /* 01111...1 */
+  P_1Z   = 0x8,  /* 10000...0 */
+  P_100O = 0x9,  /* 10011...1 */
+  P_101Z = 0xa,  /* 10100...0 */
+  P_10O  = 0xb,  /* 10111...1 */
+  P_11Z  = 0xc,  /* 11000...0 */
+  P_110O = 0xd,  /* 11011...1 */
+  P_111Z = 0xe,  /* 11100...0 */
+  P_O    = 0xf,  /* 11111...1 */
+  P_Z1   = 0x11, /* 000...001 */
+  P_Z10  = 0x12, /* 000...010 */
+  P_Z11  = 0x13, /* 000...011 */
+  P_0O00 = 0x14, /* 011...100 */
+  P_0O01 = 0x15, /* 011...101 */
+  P_0O0  = 0x16, /* 011...110 */
+  P_1Z1  = 0x19, /* 100...001 */
+  P_1Z10 = 0x1a, /* 100...010 */
+  P_1Z11 = 0x1b, /* 100...011 */
+  P_O00  = 0x1c, /* 111...100 */
+  P_O01  = 0x1d, /* 111...101 */
+  P_O0   = 0x1e, /* 111...110 */
+  P_R    = 0x20, /* rrr...rrr */ /* ('r' means random. ) */
+  P_Ro   = 0x21, /* rrr...rrr, with odd parity.  */
+  P_0R   = 0x22, /* 0rr...rrr */
+  P_1R   = 0x23, /* 1rr...rrr */
+  P_Rno  = 0x24, /* rrr...rrr, but not all ones.  */
+} pattern_t;
+
+static void
+pattern_fill(pattern_t ptn, unsigned char *start, int bitoffset, int count)
+{
+#define bitset(count, value) \
+      start[(count)/8] = (start[(count)/8] & ~(1 << 7-(count)%8)  \
+                          |  (value) << 7-(count)%8)
+  int i;
+
+  if (ptn >= 0 && ptn <= 0xf)
+    {
+      /* Patterns between 0 and 0xF have the following format:
+	 The LSBit is used to fill the last n-3 bits of the pattern;
+	 The next 3 bits are the first 3 bits of the pattern. */
+      for (i = 0; i < count; i++)
+	if (i < 3)
+	  bitset((bitoffset+i), ptn >> (3-i) & 1);
+	else
+	  bitset((bitoffset+i), ptn >> 0 & 1);
+    }
+  else if (ptn <= 0x1f)
+    {
+      /* Patterns between 0x10 and 0x1F have the following format:
+	 The two LSBits are the last two bits of the pattern;
+	 The 0x8 bit is the first bit of the pattern;
+	 The 0x4 bit is used to fill the remainder. */
+      for (i = 0; i < count; i++)
+	if (i == 0)
+	  bitset((bitoffset+i), ptn >> 3 & 1);
+	else if (i >= count-2)
+	  bitset((bitoffset+i), ptn >> (count-1-i) & 1);
+	else
+	  bitset((bitoffset+i), ptn >> 2 & 1);
+    }
+  else switch (ptn)
+    {
+    case P_0R: case P_1R:
+      assert(count > 0);
+      bitset(bitoffset, ptn & 1);
+      count--;
+      bitoffset++;
+    case P_R:
+      for (; count > 0; count--, bitoffset++)
+	bitset(bitoffset, rand() & 1);
+      break;
+    case P_Ro:
+      {
+	int op = 1;
+	assert(count > 0);
+	for (; count > 1; count--, bitoffset++)
+	  bitset(bitoffset, op ^= (rand() & 1));
+	bitset(bitoffset, op);
+	break;
+      }
+    case P_Rno:
+      {
+	int op = 1;
+	assert(count > 0);
+	for (; count > 1; count--, bitoffset++)
+	{
+	  int r = rand() & 1;
+	  op &= r;
+	  bitset(bitoffset, r);
+	}
+	bitset(bitoffset, rand() & (op ^ 1));
+	break;
+      }
+
+    default:
+      assert(0);
+    }
+#undef bitset
+}
+
+static tocheck_t
+pattern(int negative, pattern_t exp, pattern_t mant)
+{
+  union_t result;
+#if 0
+  int i;
+#endif
+
+  pattern_fill(negative ? P_O : P_Z, result.c, 0, 1);
+  pattern_fill(exp, result.c, 1, ESIZE);
+  pattern_fill(mant, result.c, ESIZE+1, MSIZE);
+#if 0
+  printf("neg=%d exp=%02x mant=%02x: ", negative, exp, mant);
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", result.c[i]);
+  printf("\n");
+#endif
+  return result.tc;
+}
+
+/* Return the closest different tocheck_t to 'x' in the direction of
+   'direction', or 'x' if there is no such value.  Assumes 'x' is not
+   a NaN.  */
+static tocheck_t
+delta(tocheck_t x, int direction)
+{
+  union_t xx;
+  int i;
+
+  xx.tc = x;
+  if (xx.c[0] & 0x80)
+    direction = -direction;
+  if (direction == +1)
+    {
+      union_t tx;
+      tx.tc = pattern(xx.c[0] >> 7, P_O, P_Z);
+      if (memcmp(tx.c, xx.c, sizeof(tocheck_t)) == 0)
+	return x;
+    }
+  for (i = sizeof(tocheck_t)-1; i > 0; i--)
+    {
+      xx.c[i] += direction;
+      if (xx.c[i] != (direction > 0 ? 0 : 0xff))
+	return xx.tc;
+    }
+  if (direction < 0 && (xx.c[0] & 0x7f) == 0)
+    return pattern(~(xx.c[0] >> 7) & 1, P_Z, P_Z1);
+  else
+    {
+      xx.c[0] += direction;
+      return xx.tc;
+    }
+}
+
+static int nerrors = 0;
+
+#ifdef FE_ALL_INVALID
+static const int all_exceptions = FE_ALL_INVALID | FE_ALL_EXCEPT;
+#else
+static const int all_exceptions = FE_ALL_EXCEPT;
+#endif
+
+static void
+check_result(int line, const char *rm, tocheck_t expected, tocheck_t actual)
+{
+  if (memcmp(&expected, &actual, sizeof(tocheck_t)) != 0)
+    {
+      unsigned char *ex, *ac;
+      size_t i;
+
+      printf("%s:%d:round %s:result failed\n"
+	     " expected result 0x", __FILE__, line, rm);
+      ex = (unsigned char *)&expected;
+      ac = (unsigned char *)&actual;
+      for (i = 0; i < sizeof(tocheck_t); i++)
+	printf("%02x", ex[i]);
+      printf(" got 0x");
+      for (i = 0; i < sizeof(tocheck_t); i++)
+	printf("%02x", ac[i]);
+      printf("\n");
+      nerrors++;
+    }
+}
+
+static const struct {
+  int except;
+  const char *name;
+} excepts[] = {
+#define except_entry(ex) { ex, #ex } ,
+#ifdef FE_INEXACT
+  except_entry(FE_INEXACT)
+#else
+# define FE_INEXACT 0
+#endif
+#ifdef FE_DIVBYZERO
+  except_entry(FE_DIVBYZERO)
+#else
+# define FE_DIVBYZERO 0
+#endif
+#ifdef FE_UNDERFLOW
+  except_entry(FE_UNDERFLOW)
+#else
+# define FE_UNDERFLOW 0
+#endif
+#ifdef FE_OVERFLOW
+  except_entry(FE_OVERFLOW)
+#else
+# define FE_OVERFLOW 0
+#endif
+#ifdef FE_INVALID
+  except_entry(FE_INVALID)
+#else
+# define FE_INVALID 0
+#endif
+#ifdef FE_INVALID_SNAN
+  except_entry(FE_INVALID_SNAN)
+#else
+# define FE_INVALID_SNAN FE_INVALID
+#endif
+#ifdef FE_INVALID_ISI
+  except_entry(FE_INVALID_ISI)
+#else
+# define FE_INVALID_ISI FE_INVALID
+#endif
+#ifdef FE_INVALID_IDI
+  except_entry(FE_INVALID_IDI)
+#else
+# define FE_INVALID_IDI FE_INVALID
+#endif
+#ifdef FE_INVALID_ZDZ
+  except_entry(FE_INVALID_ZDZ)
+#else
+# define FE_INVALID_ZDZ FE_INVALID
+#endif
+#ifdef FE_INVALID_COMPARE
+  except_entry(FE_INVALID_COMPARE)
+#else
+# define FE_INVALID_COMPARE FE_INVALID
+#endif
+#ifdef FE_INVALID_SOFTWARE
+  except_entry(FE_INVALID_SOFTWARE)
+#else
+# define FE_INVALID_SOFTWARE FE_INVALID
+#endif
+#ifdef FE_INVALID_SQRT
+  except_entry(FE_INVALID_SQRT)
+#else
+# define FE_INVALID_SQRT FE_INVALID
+#endif
+#ifdef FE_INVALID_INTEGER_CONVERSION
+  except_entry(FE_INVALID_INTEGER_CONVERSION)
+#else
+# define FE_INVALID_INTEGER_CONVERSION FE_INVALID
+#endif
+};
+
+static int excepts_missing = 0;
+
+static void
+check_excepts(int line, const char *rm, int expected, int actual)
+{
+  if (expected & excepts_missing)
+    expected = expected & ~excepts_missing | FE_INVALID_SNAN;
+  if ((expected & all_exceptions) != actual)
+    {
+      size_t i;
+      printf("%s:%d:round %s:exceptions failed\n"
+	     " expected exceptions ", __FILE__, line,rm);
+      for (i = 0; i < sizeof(excepts)/sizeof(excepts[0]); i++)
+	if (expected & excepts[i].except)
+	  printf("%s ",excepts[i].name);
+      if ((expected & all_exceptions) == 0)
+	printf("- ");
+      printf("got");
+      for (i = 0; i < sizeof(excepts)/sizeof(excepts[0]); i++)
+	if (actual & excepts[i].except)
+	  printf(" %s",excepts[i].name);
+      if ((actual & all_exceptions) == 0)
+	printf("- ");
+      printf(".\n");
+      nerrors++;
+    }
+}
+
+typedef enum {
+  B_ADD, B_SUB, B_MUL, B_DIV, B_NEG, B_ABS, B_SQRT
+} op_t;
+typedef struct {
+  int line;
+  op_t op;
+  int a_sgn;
+  pattern_t a_exp, a_mant;
+  int b_sgn;
+  pattern_t b_exp, b_mant;
+  int rmode;
+  int excepts;
+  int x_sgn;
+  pattern_t x_exp, x_mant;
+} optest_t;
+static const optest_t optests[] = {
+  /* Additions of zero.  */
+  {__LINE__,B_ADD, 0,P_Z,P_Z, 0,P_Z,P_Z, R_ALL,0, 0,P_Z,P_Z },
+  {__LINE__,B_ADD, 1,P_Z,P_Z, 0,P_Z,P_Z, R_ALL & ~R_DOWN,0, 0,P_Z,P_Z },
+  {__LINE__,B_ADD, 1,P_Z,P_Z, 0,P_Z,P_Z, R_DOWN,0, 1,P_Z,P_Z },
+  {__LINE__,B_ADD, 1,P_Z,P_Z, 1,P_Z,P_Z, R_ALL,0, 1,P_Z,P_Z },
+
+  /* Additions with NaN.  */
+  {__LINE__,B_ADD, 0,P_O,P_101Z, 0,P_Z,P_Z, R_ALL,0, 0,P_O,P_101Z },
+  {__LINE__,B_ADD, 0,P_O,P_01Z, 0,P_Z,P_Z, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_11Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_O,P_0O, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_O },
+  {__LINE__,B_ADD, 0,P_Z,P_Z, 0,P_O,P_11Z, R_ALL,0, 0,P_O,P_11Z },
+  {__LINE__,B_ADD, 0,P_O,P_001Z, 0,P_O,P_001Z, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_101Z },
+  {__LINE__,B_ADD, 0,P_O,P_1Z, 0,P_Z,P_Z, R_ALL,0, 0,P_O,P_1Z },
+  {__LINE__,B_ADD, 0,P_0O,P_Z, 0,P_O,P_10O, R_ALL,0, 0,P_O,P_10O },
+
+  /* Additions with infinity.  */
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_Z,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 1,P_Z,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 0,P_Z,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 1,P_Z,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_O,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 1,P_O,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 1,P_O,P_Z, R_ALL,
+   FE_INVALID | FE_INVALID_ISI, 0,P_O,P_1Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 0,P_O,P_Z, R_ALL,
+   FE_INVALID | FE_INVALID_ISI, 0,P_O,P_1Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 0,P_0O,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 0,P_0O,P_Z, R_ALL,0, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O,P_Z, 1,P_0O,P_Z, R_ALL,0, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O,P_Z, 1,P_0O,P_Z, R_ALL,0, 1,P_O,P_Z },
+
+  /* Overflow (and zero).  */
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 0,P_O0,P_Z, R_NEAREST | R_UP,
+   FE_INEXACT | FE_OVERFLOW, 0,P_O,P_Z },
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 0,P_O0,P_Z, R_ZERO | R_DOWN,
+   FE_INEXACT | FE_OVERFLOW, 0,P_O0,P_O },
+  {__LINE__,B_ADD, 1,P_O0,P_Z, 1,P_O0,P_Z, R_NEAREST | R_DOWN,
+   FE_INEXACT | FE_OVERFLOW, 1,P_O,P_Z },
+  {__LINE__,B_ADD, 1,P_O0,P_Z, 1,P_O0,P_Z, R_ZERO | R_UP,
+   FE_INEXACT | FE_OVERFLOW, 1,P_O0,P_O },
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 1,P_O0,P_Z, R_ALL & ~R_DOWN,
+   0, 0,P_Z,P_Z },
+  {__LINE__,B_ADD, 0,P_O0,P_Z, 1,P_O0,P_Z, R_DOWN,
+   0, 1,P_Z,P_Z },
+
+  /* Negation.  */
+  {__LINE__,B_NEG, 0,P_Z,P_Z,   0,0,0, R_ALL, 0, 1,P_Z,P_Z },
+  {__LINE__,B_NEG, 1,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_NEG, 0,P_O,P_Z,   0,0,0, R_ALL, 0, 1,P_O,P_Z },
+  {__LINE__,B_NEG, 1,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_NEG, 0,P_O,P_1Z,  0,0,0, R_ALL, 0, 1,P_O,P_1Z },
+  {__LINE__,B_NEG, 1,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_NEG, 0,P_O,P_01Z, 0,0,0, R_ALL, 0, 1,P_O,P_01Z },
+  {__LINE__,B_NEG, 1,P_O,P_01Z, 0,0,0, R_ALL, 0, 0,P_O,P_01Z },
+  {__LINE__,B_NEG, 0,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 1,P_1Z,P_1Z1 },
+  {__LINE__,B_NEG, 1,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 0,P_1Z,P_1Z1 },
+  {__LINE__,B_NEG, 0,P_Z,P_Z1,  0,0,0, R_ALL, 0, 1,P_Z,P_Z1 },
+  {__LINE__,B_NEG, 1,P_Z,P_Z1,  0,0,0, R_ALL, 0, 0,P_Z,P_Z1 },
+
+  /* Absolute value.  */
+  {__LINE__,B_ABS, 0,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_ABS, 1,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_ABS, 0,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_ABS, 1,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_ABS, 0,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_ABS, 1,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_ABS, 0,P_O,P_01Z, 0,0,0, R_ALL, 0, 0,P_O,P_01Z },
+  {__LINE__,B_ABS, 1,P_O,P_01Z, 0,0,0, R_ALL, 0, 0,P_O,P_01Z },
+  {__LINE__,B_ABS, 0,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 0,P_1Z,P_1Z1 },
+  {__LINE__,B_ABS, 1,P_1Z,P_1Z1, 0,0,0, R_ALL, 0, 0,P_1Z,P_1Z1 },
+  {__LINE__,B_ABS, 0,P_Z,P_Z1,  0,0,0, R_ALL, 0, 0,P_Z,P_Z1 },
+  {__LINE__,B_ABS, 1,P_Z,P_Z1,  0,0,0, R_ALL, 0, 0,P_Z,P_Z1 },
+
+  /* Square root.  */
+  {__LINE__,B_SQRT, 0,P_Z,P_Z,   0,0,0, R_ALL, 0, 0,P_Z,P_Z },
+  {__LINE__,B_SQRT, 1,P_Z,P_Z,   0,0,0, R_ALL, 0, 1,P_Z,P_Z },
+  {__LINE__,B_SQRT, 0,P_O,P_1Z,  0,0,0, R_ALL, 0, 0,P_O,P_1Z },
+  {__LINE__,B_SQRT, 1,P_O,P_1Z,  0,0,0, R_ALL, 0, 1,P_O,P_1Z },
+  {__LINE__,B_SQRT, 0,P_O,P_01Z, 0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 0,P_O,P_11Z },
+  {__LINE__,B_SQRT, 1,P_O,P_01Z, 0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SNAN, 1,P_O,P_11Z },
+
+  {__LINE__,B_SQRT, 0,P_O,P_Z,   0,0,0, R_ALL, 0, 0,P_O,P_Z },
+  {__LINE__,B_SQRT, 0,P_0O,P_Z,  0,0,0, R_ALL, 0, 0,P_0O,P_Z },
+
+  {__LINE__,B_SQRT, 1,P_O,P_Z,   0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SQRT, 0,P_O,P_1Z },
+  {__LINE__,B_SQRT, 1,P_1Z,P_1Z1, 0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SQRT, 0,P_O,P_1Z },
+  {__LINE__,B_SQRT, 1,P_Z,P_Z1,  0,0,0, R_ALL,
+   FE_INVALID | FE_INVALID_SQRT, 0,P_O,P_1Z },
+
+};
+
+static void
+check_op(void)
+{
+  size_t i;
+  int j;
+  tocheck_t r, a, b, x;
+  int raised;
+
+  for (i = 0; i < sizeof(optests)/sizeof(optests[0]); i++)
+    {
+      a = pattern(optests[i].a_sgn, optests[i].a_exp,
+		  optests[i].a_mant);
+      b = pattern(optests[i].b_sgn, optests[i].b_exp,
+		  optests[i].b_mant);
+      x = pattern(optests[i].x_sgn, optests[i].x_exp,
+		  optests[i].x_mant);
+      for (j = 0; j < 4; j++)
+	if (optests[i].rmode & 1<<j)
+	  {
+	    fesetenv(rmodes+j);
+	    switch (optests[i].op)
+	      {
+	      case B_ADD: r = a + b; break;
+	      case B_SUB: r = a - b; break;
+	      case B_MUL: r = a * b; break;
+	      case B_DIV: r = a / b; break;
+	      case B_NEG: r = -a; break;
+	      case B_ABS: r = FUNC(fabs)(a); break;
+	      case B_SQRT: r = FUNC(sqrt)(a); break;
+	      }
+	    raised = fetestexcept(all_exceptions);
+	    check_result(optests[i].line,rmnames[j],x,r);
+	    check_excepts(optests[i].line,rmnames[j],
+			  optests[i].excepts,raised);
+	  }
+    }
+}
+
+static void
+fail_xr(int line, const char *rm, tocheck_t x, tocheck_t r, tocheck_t xx,
+	int xflag)
+{
+  size_t i;
+  unsigned char *cx, *cr, *cxx;
+
+  printf("%s:%d:round %s:fail\n with x=0x", __FILE__, line,rm);
+  cx = (unsigned char *)&x;
+  cr = (unsigned char *)&r;
+  cxx = (unsigned char *)&xx;
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", cx[i]);
+  printf(" r=0x");
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", cr[i]);
+  printf(" xx=0x");
+  for (i = 0; i < sizeof(tocheck_t); i++)
+    printf("%02x", cxx[i]);
+  printf(" inexact=%d\n", xflag != 0);
+  nerrors++;
+}
+
+static void
+check_sqrt(tocheck_t a)
+{
+  int j;
+  tocheck_t r0, r1, r2, x0, x1, x2;
+  int raised = 0;
+  int ok;
+
+  for (j = 0; j < 4; j++)
+    {
+      int excepts;
+
+      fesetenv(rmodes+j);
+      r1 = FUNC(sqrt)(a);
+      excepts = fetestexcept(all_exceptions);
+      fesetenv(FE_DFL_ENV);
+      raised |= excepts & ~FE_INEXACT;
+      x1 = r1 * r1 - a;
+      if (excepts & FE_INEXACT)
+	{
+	  r0 = delta(r1,-1); r2 = delta(r1,1);
+	  switch (1 << j)
+	    {
+	    case R_NEAREST:
+	      x0 = r0 * r0 - a; x2 = r2 * r2 - a;
+	      ok = fabs(x0) >= fabs(x1) && fabs(x1) <= fabs(x2);
+	      break;
+	    case R_ZERO:  case R_DOWN:
+	      x2 = r2 * r2 - a;
+	      ok = x1 <= 0 && x2 >= 0;
+	      break;
+	    case R_UP:
+	      x0 = r0 * r0 - a;
+	      ok = x1 >= 0 && x0 <= 0;
+	      break;
+	    default:
+	      assert(0);
+	    }
+	}
+      else
+	ok = x1 == 0;
+      if (!ok)
+	fail_xr(__LINE__,rmnames[j],a,r1,x1,excepts&FE_INEXACT);
+    }
+  check_excepts(__LINE__,"all",0,raised);
+}
+
+int main(int argc, char **argv)
+{
+  int i;
+
+  _LIB_VERSION = _IEEE_;
+
+  /* Set up environments for rounding modes.  */
+  fesetenv(FE_DFL_ENV);
+  fesetround(FE_TONEAREST);
+  fegetenv(rmodes+0);
+  fesetround(FE_TOWARDZERO);
+  fegetenv(rmodes+1);
+  fesetround(FE_UPWARD);
+  fegetenv(rmodes+2);
+  fesetround(FE_DOWNWARD);
+  fegetenv(rmodes+3);
+
+#if defined(FE_INVALID_SOFTWARE) || defined(FE_INVALID_SQRT)
+  /* There's this really stupid feature of the 601... */
+  fesetenv(FE_DFL_ENV);
+  feraiseexcept(FE_INVALID_SOFTWARE);
+  if (!fetestexcept(FE_INVALID_SOFTWARE))
+    excepts_missing |= FE_INVALID_SOFTWARE;
+  fesetenv(FE_DFL_ENV);
+  feraiseexcept(FE_INVALID_SQRT);
+  if (!fetestexcept(FE_INVALID_SQRT))
+    excepts_missing |= FE_INVALID_SQRT;
+#endif
+
+  check_op();
+  for (i = 0; i < 100000; i++)
+    check_sqrt(pattern(0, P_Rno, P_R));
+  for (i = 0; i < 100; i++)
+    check_sqrt(pattern(0, P_Z, P_R));
+  check_sqrt(pattern(0,P_Z,P_Z1));
+
+  printf("%d errors.\n", nerrors);
+  return nerrors == 0 ? 0 : 1;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/powerpc/test-arithf.c ../glibc-2.3/sysdeps/powerpc/test-arithf.c
--- glibc-2.2.93/sysdeps/powerpc/test-arithf.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/powerpc/test-arithf.c	Sun Aug 10 13:49:46 1997
@@ -0,0 +1,6 @@
+typedef float tocheck_t;
+#define ESIZE 8
+#define MSIZE 23
+#define FUNC(x) x##f
+
+#include "test-arith.c"
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/s390/fpu/fesetenv.c ../glibc-2.3/sysdeps/s390/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/s390/fpu/fesetenv.c	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/s390/fpu/fesetenv.c	Sat Sep 14 09:40:54 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Denis Joseph Barrow (djbarrow@de.ibm.com).
 
@@ -54,3 +54,4 @@
   /* Success.  */
   return 0;
 }
+libm_hidden_def (fesetenv)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/s390/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/s390/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/s390/fpu/fraiseexcpt.c	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/s390/fpu/fraiseexcpt.c	Sat Sep 14 09:40:54 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 2000 Free Software Foundation, Inc.
+   Copyright (C) 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Denis Joseph Barrow (djbarrow@de.ibm.com) and
    Martin Schwidefsky (schwidefsky@de.ibm.com).
@@ -70,3 +70,4 @@
   /* Success.  */
   return 0;
 }
+libm_hidden_def (feraiseexcept)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/s390/fpu/libm-test-ulps ../glibc-2.3/sysdeps/s390/fpu/libm-test-ulps
--- glibc-2.2.93/sysdeps/s390/fpu/libm-test-ulps	Wed Jan 16 19:26:21 2002
+++ ../glibc-2.3/sysdeps/s390/fpu/libm-test-ulps	Thu Sep  5 19:27:55 2002
@@ -1,53 +1,18 @@
 # Begin of automatic generation
 
-# asin
-Test "asin (0.7) == 0.77539749661075306374035335271498708":
-double: 1
-idouble: 1
-
 # atan2
-Test "atan2 (-0.7, -1.0) == -2.530866689200584621918884506789267":
+Test "atan2 (-0.75, -1.0) == -2.49809154479650885165983415456218025":
 float: 3
 ifloat: 3
-Test "atan2 (0.7, -1.0) == 2.530866689200584621918884506789267":
+Test "atan2 (0.75, -1.0) == 2.49809154479650885165983415456218025":
 float: 3
 ifloat: 3
-Test "atan2 (1.4, -0.93) == 2.1571487668237843754887415992772736":
-float: 4
-ifloat: 4
-
-# atanh
-Test "atanh (0.7) == 0.8673005276940531944":
-double: 1
-idouble: 1
-
-# cabs
-Test "cabs (-0.7 + 12.4 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (-0.7 - 12.4 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (-12.4 + 0.7 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (-12.4 - 0.7 i) == 12.419742348374220601176836866763271":
-float: 1
-ifloat: 1
-Test "cabs (0.7 + 1.2 i) == 1.3892443989449804508432547041028554":
-double: 1
-idouble: 1
-Test "cabs (0.7 + 12.4 i) == 12.419742348374220601176836866763271":
+Test "atan2 (1.390625, 0.9296875) == 0.981498387184244311516296577615519772":
 float: 1
 ifloat: 1
 
-# cacos
-Test "Real part of: cacos (0.7 + 1.2 i) == 1.1351827477151551088992008271819053 - 1.0927647857577371459105272080819308 i":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "Imaginary part of: cacos (0.7 + 1.2 i) == 1.1351827477151551088992008271819053 - 1.0927647857577371459105272080819308 i":
+# atanh
+Test "atanh (0.75) == 0.972955074527656652552676371721589865":
 float: 1
 ifloat: 1
 
@@ -62,20 +27,12 @@
 float: 3
 idouble: 1
 ifloat: 3
-Test "Real part of: cacosh (0.7 + 1.2 i) == 1.0927647857577371459105272080819308 + 1.1351827477151551088992008271819053 i":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
 
 # casin
-Test "Real part of: casin (0.7 + 1.2 i) == 0.4356135790797415103321208644578462 + 1.0927647857577371459105272080819308 i":
-double: 3
-float: 2
-idouble: 3
-ifloat: 2
-Test "Imaginary part of: casin (0.7 + 1.2 i) == 0.4356135790797415103321208644578462 + 1.0927647857577371459105272080819308 i":
+Test "Real part of: casin (0.75 + 1.25 i) == 0.453276177638793913448921196101971749 + 1.13239363160530819522266333696834467 i":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
 
 # casinh
@@ -89,11 +46,13 @@
 float: 6
 idouble: 3
 ifloat: 6
-Test "Real part of: casinh (0.7 + 1.2 i) == 0.97865459559367387689317593222160964 + 0.91135418953156011567903546856170941 i":
+Test "Real part of: casinh (0.75 + 1.25 i) == 1.03171853444778027336364058631006594 + 0.911738290968487636358489564316731207 i":
+float: 1
+ifloat: 1
+Test "Imaginary part of: casinh (0.75 + 1.25 i) == 1.03171853444778027336364058631006594 + 0.911738290968487636358489564316731207 i":
 double: 1
-idouble: 1
-Test "Imaginary part of: casinh (0.7 + 1.2 i) == 0.97865459559367387689317593222160964 + 0.91135418953156011567903546856170941 i":
 float: 1
+idouble: 1
 ifloat: 1
 
 # catan
@@ -105,12 +64,9 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "Real part of: catan (0.7 + 1.2 i) == 1.0785743834118921877443707996386368 + 0.57705737765343067644394541889341712 i":
+Test "Real part of: catan (0.75 + 1.25 i) == 1.10714871779409050301706546017853704 + 0.549306144334054845697622618461262852 i":
 float: 4
 ifloat: 4
-Test "Imaginary part of: catan (0.7 + 1.2 i) == 1.0785743834118921877443707996386368 + 0.57705737765343067644394541889341712 i":
-double: 1
-idouble: 1
 
 # catanh
 Test "Real part of: catanh (-2 - 3 i) == -0.14694666622552975204743278515471595 - 1.3389725222944935611241935759091443 i":
@@ -119,10 +75,10 @@
 Test "Imaginary part of: catanh (-2 - 3 i) == -0.14694666622552975204743278515471595 - 1.3389725222944935611241935759091443 i":
 float: 4
 ifloat: 4
-Test "Real part of: catanh (0.7 + 1.2 i) == 0.2600749516525135959200648705635915 + 0.97024030779509898497385130162655963 i":
-float: 1
-ifloat: 1
-Test "Imaginary part of: catanh (0.7 + 1.2 i) == 0.2600749516525135959200648705635915 + 0.97024030779509898497385130162655963 i":
+Test "Real part of: catanh (0.75 + 1.25 i) == 0.261492138795671927078652057366532140 + 0.996825126463918666098902241310446708 i":
+double: 1
+idouble: 1
+Test "Imaginary part of: catanh (0.75 + 1.25 i) == 0.261492138795671927078652057366532140 + 0.996825126463918666098902241310446708 i":
 float: 6
 ifloat: 6
 
@@ -130,7 +86,10 @@
 Test "cbrt (-27.0) == -3.0":
 double: 1
 idouble: 1
-Test "cbrt (0.970299) == 0.99":
+Test "cbrt (0.75) == 0.908560296416069829445605878163630251":
+double: 1
+idouble: 1
+Test "cbrt (0.9921875) == 0.997389022060725270579075195353955217":
 double: 1
 idouble: 1
 
@@ -138,12 +97,14 @@
 Test "Imaginary part of: ccos (-2 - 3 i) == -4.1896256909688072301 - 9.1092278937553365979 i":
 float: 1
 ifloat: 1
-Test "Real part of: ccos (0.7 + 1.2 i) == 1.3848657645312111080 - 0.97242170335830028619 i":
-double: 1
-idouble: 1
-Test "Imaginary part of: ccos (0.7 + 1.2 i) == 1.3848657645312111080 - 0.97242170335830028619 i":
+Test "Real part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
 double: 1
+float: 1
 idouble: 1
+ifloat: 1
+Test "Imaginary part of: ccos (0.75 + 1.25 i) == 1.38173873063425888530729933139078645 - 1.09193013555397466170919531722024128 i":
+float: 1
+ifloat: 1
 
 # ccosh
 Test "Real part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
@@ -152,25 +113,20 @@
 Test "Imaginary part of: ccosh (-2 - 3 i) == -3.7245455049153225654 + 0.5118225699873846088 i":
 float: 1
 ifloat: 1
-Test "Real part of: ccosh (0.7 + 1.2 i) == 0.4548202223691477654 + 0.7070296600921537682 i":
+Test "Real part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "Imaginary part of: ccosh (0.7 + 1.2 i) == 0.4548202223691477654 + 0.7070296600921537682 i":
-double: 1
-idouble: 1
+Test "Imaginary part of: ccosh (0.75 + 1.25 i) == 0.408242591877968807788852146397499084 + 0.780365930845853240391326216300863152 i":
+float: 1
+ifloat: 1
 
 # cexp
 Test "Imaginary part of: cexp (-2.0 - 3.0 i) == -0.13398091492954261346140525546115575 - 0.019098516261135196432576240858800925 i":
 float: 1
 ifloat: 1
-Test "Real part of: cexp (0.7 + 1.2 i) == 0.72969890915032360123451688642930727 + 1.8768962328348102821139467908203072 i":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "Imaginary part of: cexp (0.7 + 1.2 i) == 0.72969890915032360123451688642930727 + 1.8768962328348102821139467908203072 i":
+Test "Real part of: cexp (0.75 + 1.25 i) == 0.667537446429131586942201977015932112 + 2.00900045494094876258347228145863909 i":
 float: 1
 ifloat: 1
 
@@ -178,6 +134,9 @@
 Test "Imaginary part of: clog (-2 - 3 i) == 1.2824746787307683680267437207826593 - 2.1587989303424641704769327722648368 i":
 float: 3
 ifloat: 3
+Test "Real part of: clog (0.75 + 1.25 i) == 0.376885901188190075998919126749298416 + 1.03037682652431246378774332703115153 i":
+float: 1
+ifloat: 1
 
 # clog10
 Test "Imaginary part of: clog10 (-0 + inf i) == inf + pi/2*log10(e) i":
@@ -215,14 +174,9 @@
 Test "Imaginary part of: clog10 (0 - inf i) == inf - pi/2*log10(e) i":
 float: 1
 ifloat: 1
-Test "Real part of: clog10 (0.7 + 1.2 i) == 0.1427786545038868803 + 0.4528483579352493248 i":
-double: 1
+Test "Real part of: clog10 (0.75 + 1.25 i) == 0.163679467193165171449476605077428975 + 0.447486970040493067069984724340855636 i":
 float: 1
-idouble: 1
 ifloat: 1
-Test "Imaginary part of: clog10 (0.7 + 1.2 i) == 0.1427786545038868803 + 0.4528483579352493248 i":
-double: 1
-idouble: 1
 Test "Imaginary part of: clog10 (3 + inf i) == inf + pi/2*log10(e) i":
 float: 1
 ifloat: 1
@@ -237,11 +191,6 @@
 ifloat: 1
 
 # cos
-Test "cos (0.7) == 0.76484218728448842625585999019186495":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
 Test "cos (M_PI_6l * 2.0) == 0.5":
 double: 1
 float: 1
@@ -259,6 +208,22 @@
 ifloat: 1
 
 # cpow
+Test "Real part of: cpow (0.75 + 1.25 i, 0.0 + 1.0 i) == 0.331825439177608832276067945276730566 + 0.131338600281188544930936345230903032 i":
+float: 1
+ifloat: 1
+Test "Imaginary part of: cpow (0.75 + 1.25 i, 0.0 + 1.0 i) == 0.331825439177608832276067945276730566 + 0.131338600281188544930936345230903032 i":
+float: 1
+ifloat: 1
+Test "Real part of: cpow (0.75 + 1.25 i, 0.75 + 1.25 i) == 0.117506293914473555420279832210420483 + 0.346552747708338676483025352060418001 i":
+double: 1
+float: 4
+idouble: 1
+ifloat: 4
+Test "Real part of: cpow (0.75 + 1.25 i, 1.0 + 1.0 i) == 0.0846958290317209430433805274189191353 + 0.513285749182902449043287190519090481 i":
+double: 2
+float: 3
+idouble: 2
+ifloat: 3
 Test "Real part of: cpow (2 + 3 i, 4 + 0 i) == -119.0 - 120.0 i":
 double: 1
 float: 4
@@ -273,19 +238,14 @@
 idouble: 2
 ifloat: 2
 
-# csin
-Test "Imaginary part of: csin (0.7 + 1.2 i) == 1.1664563419657581376 + 1.1544997246948547371 i":
-float: 1
-ifloat: 1
-
 # csinh
 Test "Imaginary part of: csinh (-2 - 3 i) == 3.5905645899857799520 - 0.5309210862485198052 i":
 double: 1
 idouble: 1
-Test "Real part of: csinh (0.7 + 1.2 i) == 0.27487868678117583582 + 1.1698665727426565139 i":
+Test "Real part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
 float: 1
 ifloat: 1
-Test "Imaginary part of: csinh (0.7 + 1.2 i) == 0.27487868678117583582 + 1.1698665727426565139 i":
+Test "Imaginary part of: csinh (0.75 + 1.25 i) == 0.259294854551162779153349830618433028 + 1.22863452409509552219214606515777594 i":
 float: 1
 ifloat: 1
 
@@ -296,27 +256,14 @@
 Test "Real part of: csqrt (-2 - 3 i) == 0.89597747612983812471573375529004348 - 1.6741492280355400404480393008490519 i":
 float: 1
 ifloat: 1
-Test "Real part of: csqrt (0.7 + 1.2 i) == 1.022067610030026450706487883081139 + 0.58704531296356521154977678719838035 i":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "Imaginary part of: csqrt (0.7 + 1.2 i) == 1.022067610030026450706487883081139 + 0.58704531296356521154977678719838035 i":
-float: 1
-ifloat: 1
 
 # ctan
 Test "Real part of: ctan (-2 - 3 i) == 0.0037640256415042482 - 1.0032386273536098014 i":
 double: 1
 idouble: 1
-Test "Real part of: ctan (0.7 + 1.2 i) == 0.1720734197630349001 + 0.9544807059989405538 i":
-float: 1
-ifloat: 1
-Test "Imaginary part of: ctan (0.7 + 1.2 i) == 0.1720734197630349001 + 0.9544807059989405538 i":
+Test "Imaginary part of: ctan (0.75 + 1.25 i) == 0.160807785916206426725166058173438663 + 0.975363285031235646193581759755216379 i":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
 
 # ctanh
 Test "Real part of: ctanh (-2 - 3 i) == -0.9653858790221331242 + 0.0098843750383224937 i":
@@ -327,34 +274,22 @@
 Test "Imaginary part of: ctanh (0 + pi/4 i) == 0.0 + 1.0 i":
 float: 1
 ifloat: 1
-Test "Real part of: ctanh (0.7 + 1.2 i) == 1.3472197399061191630 + 0.4778641038326365540 i":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "Imaginary part of: ctanh (0.7 + 1.2 i) == 1.3472197399061191630 + 0.4778641038326365540 i":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
+Test "Real part of: ctanh (0.75 + 1.25 i) == 1.37260757053378320258048606571226857 + 0.385795952609750664177596760720790220 i":
+double: 1
+idouble: 1
+
+# erf
+Test "erf (1.25) == 0.922900128256458230136523481197281140":
+double: 1
+idouble: 1
 
 # erfc
-Test "erfc (0.7) == 0.32219880616258152702":
+Test "erfc (2.0) == 0.00467773498104726583793074363274707139":
 double: 1
 idouble: 1
-Test "erfc (1.2) == 0.089686021770364619762":
-double: 2
-float: 2
-idouble: 2
-ifloat: 2
-Test "erfc (2.0) == 0.0046777349810472658379":
+Test "erfc (4.125) == 0.542340079956506600531223408575531062e-8":
 double: 1
 idouble: 1
-Test "erfc (4.1) == 0.67000276540848983727e-8":
-double: 24
-float: 12
-idouble: 24
-ifloat: 12
 
 # exp10
 Test "exp10 (-1) == 0.1":
@@ -362,8 +297,10 @@
 float: 1
 idouble: 2
 ifloat: 1
-Test "exp10 (0.7) == 5.0118723362727228500155418688494574":
+Test "exp10 (0.75) == 5.62341325190349080394951039776481231":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
 Test "exp10 (3) == 1000":
 double: 6
@@ -372,32 +309,13 @@
 ifloat: 2
 
 # expm1
+Test "expm1 (0.75) == 1.11700001661267466854536981983709561":
+double: 1
+idouble: 1
 Test "expm1 (1) == M_El - 1.0":
 float: 1
 ifloat: 1
 
-# fmod
-Test "fmod (-6.5, -2.3) == -1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "fmod (-6.5, 2.3) == -1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "fmod (6.5, -2.3) == 1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "fmod (6.5, 2.3) == 1.9":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-
 # hypot
 Test "hypot (-0.7, -12.4) == 12.419742348374220601176836866763271":
 float: 1
@@ -414,9 +332,6 @@
 Test "hypot (0.7, -12.4) == 12.419742348374220601176836866763271":
 float: 1
 ifloat: 1
-Test "hypot (0.7, 1.2) == 1.3892443989449804508432547041028554":
-double: 1
-idouble: 1
 Test "hypot (0.7, 12.4) == 12.419742348374220601176836866763271":
 float: 1
 ifloat: 1
@@ -433,12 +348,15 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "j0 (10.0) == -0.24593576445134833520":
+Test "j0 (0.75) == 0.864242275166648623555731103820923211":
+float: 1
+ifloat: 1
+Test "j0 (10.0) == -0.245935764451348335197760862485328754":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "j0 (2.0) == 0.22389077914123566805":
+Test "j0 (2.0) == 0.223890779141235668051827454649948626":
 float: 2
 ifloat: 2
 Test "j0 (4.0) == -3.9714980986384737228659076845169804197562E-1":
@@ -446,72 +364,89 @@
 float: 1
 idouble: 1
 ifloat: 1
-Test "j0 (8.0) == 0.17165080713755390609":
+Test "j0 (8.0) == 0.171650807137553906090869407851972001":
 float: 1
 ifloat: 1
 
 # j1
-Test "j1 (10.0) == 0.043472746168861436670":
+Test "j1 (10.0) == 0.0434727461688614366697487680258592883":
 float: 2
 ifloat: 2
-Test "j1 (2.0) == 0.57672480775687338720":
+Test "j1 (2.0) == 0.576724807756873387202448242269137087":
 double: 1
 idouble: 1
-Test "j1 (8.0) == 0.23463634685391462438":
+Test "j1 (8.0) == 0.234636346853914624381276651590454612":
 double: 1
 idouble: 1
 
 # jn
-Test "jn (0, 10.0) == -0.24593576445134833520":
+Test "jn (0, -4.0) == -3.9714980986384737228659076845169804197562E-1":
+double: 1
+float: 1
+idouble: 1
+ifloat: 1
+Test "jn (0, 0.75) == 0.864242275166648623555731103820923211":
+float: 1
+ifloat: 1
+Test "jn (0, 10.0) == -0.245935764451348335197760862485328754":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "jn (0, 2.0) == 0.22389077914123566805":
+Test "jn (0, 2.0) == 0.223890779141235668051827454649948626":
 float: 2
 ifloat: 2
-Test "jn (0, 8.0) == 0.17165080713755390609":
+Test "jn (0, 4.0) == -3.9714980986384737228659076845169804197562E-1":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
-Test "jn (1, 10.0) == 0.043472746168861436670":
+Test "jn (0, 8.0) == 0.171650807137553906090869407851972001":
+float: 1
+ifloat: 1
+Test "jn (1, 10.0) == 0.0434727461688614366697487680258592883":
 float: 2
 ifloat: 2
-Test "jn (1, 2.0) == 0.57672480775687338720":
+Test "jn (1, 2.0) == 0.576724807756873387202448242269137087":
 double: 1
 idouble: 1
-Test "jn (1, 8.0) == 0.23463634685391462438":
+Test "jn (1, 8.0) == 0.234636346853914624381276651590454612":
 double: 1
 idouble: 1
-Test "jn (10, 0.1) == 0.26905328954342155795e-19":
-double: 6
-float: 4
-idouble: 6
-ifloat: 4
-Test "jn (10, 0.7) == 0.75175911502153953928e-11":
-double: 3
+Test "jn (10, 0.125) == 0.250543369809369890173993791865771547e-18":
+double: 1
 float: 1
-idouble: 3
+idouble: 1
+ifloat: 1
+Test "jn (10, 0.75) == 0.149621713117596814698712483621682835e-10":
+double: 1
+float: 1
+idouble: 1
 ifloat: 1
-Test "jn (10, 10.0) == 0.20748610663335885770":
+Test "jn (10, 10.0) == 0.207486106633358857697278723518753428":
 double: 4
 float: 3
 idouble: 4
 ifloat: 3
-Test "jn (10, 2.0) == 0.25153862827167367096e-6":
+Test "jn (10, 2.0) == 0.251538628271673670963516093751820639e-6":
 float: 4
 ifloat: 4
-Test "jn (3, 0.1) == 0.000020820315754756261429":
+Test "jn (3, 0.125) == 0.406503832554912875023029337653442868e-4":
 double: 1
+float: 1
 idouble: 1
-Test "jn (3, 0.7) == 0.0069296548267508408077":
+ifloat: 1
+Test "jn (3, 0.75) == 0.848438342327410884392755236884386804e-2":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
-Test "jn (3, 10.0) == 0.058379379305186812343":
+Test "jn (3, 10.0) == 0.0583793793051868123429354784103409563":
 double: 3
 float: 1
 idouble: 3
 ifloat: 1
-Test "jn (3, 2.0) == 0.12894324947440205110":
+Test "jn (3, 2.0) == 0.128943249474402051098793332969239835":
 double: 1
 float: 2
 idouble: 1
@@ -529,43 +464,22 @@
 idouble: 1
 ifloat: 2
 
-# log
-Test "log (0.7) == -0.35667494393873237891263871124118447":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
 # log10
-Test "log10 (0.7) == -0.15490195998574316929":
+Test "log10 (0.75) == -0.124938736608299953132449886193870744":
 double: 1
-float: 1
+float: 2
 idouble: 1
-ifloat: 1
+ifloat: 2
 Test "log10 (e) == log10(e)":
 float: 1
 ifloat: 1
 
 # log1p
-Test "log1p (-0.3) == -0.35667494393873237891263871124118447":
-double: 1
+Test "log1p (-0.25) == -0.287682072451780927439219005993827432":
 float: 1
-idouble: 1
-ifloat: 1
-
-# log2
-Test "log2 (0.7) == -0.51457317282975824043":
-double: 1
-float: 1
-idouble: 1
 ifloat: 1
 
 # sincos
-Test "sincos (0.7, &sin_res, &cos_res) puts 0.76484218728448842625585999019186495 in cos_res":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
 Test "sincos (M_PI_6l*2.0, &sin_res, &cos_res) puts 0.5 in cos_res":
 double: 1
 float: 1
@@ -585,30 +499,11 @@
 float: 1
 ifloat: 1
 
-# sinh
-Test "sinh (0.7) == 0.75858370183953350346":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
 # tan
 Test "tan (pi/4) == 1":
 double: 1
 idouble: 1
 
-# tanh
-Test "tanh (-0.7) == -0.60436777711716349631":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "tanh (0.7) == 0.60436777711716349631":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
 # tgamma
 Test "tgamma (-0.5) == -2 sqrt (pi)":
 double: 1
@@ -625,172 +520,130 @@
 ifloat: 1
 
 # y0
-Test "y0 (0.7) == -0.19066492933739506743":
+Test "y0 (1.0) == 0.0882569642156769579829267660235151628":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "y0 (1.0) == 0.088256964215676957983":
+Test "y0 (1.5) == 0.382448923797758843955068554978089862":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "y0 (1.5) == 0.38244892379775884396":
-double: 2
+Test "y0 (10.0) == 0.0556711672835993914244598774101900481":
 float: 1
-idouble: 2
 ifloat: 1
-Test "y0 (10.0) == 0.055671167283599391424":
-float: 1
-ifloat: 1
-Test "y0 (8.0) == 0.22352148938756622053":
+Test "y0 (8.0) == 0.223521489387566220527323400498620359":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
 
 # y1
-Test "y1 (0.1) == -6.4589510947020269877":
+Test "y1 (0.125) == -5.19993611253477499595928744876579921":
 double: 1
 idouble: 1
-Test "y1 (0.7) == -1.1032498719076333697":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-Test "y1 (1.5) == -0.41230862697391129595":
+Test "y1 (1.5) == -0.412308626973911295952829820633445323":
 float: 1
 ifloat: 1
-Test "y1 (10.0) == 0.24901542420695388392":
+Test "y1 (10.0) == 0.249015424206953883923283474663222803":
 double: 3
 float: 1
 idouble: 3
 ifloat: 1
-Test "y1 (2.0) == -0.10703243154093754689":
+Test "y1 (2.0) == -0.107032431540937546888370772277476637":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "y1 (8.0) == -0.15806046173124749426":
+Test "y1 (8.0) == -0.158060461731247494255555266187483550":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
 
 # yn
-Test "yn (0, 0.7) == -0.19066492933739506743":
-double: 2
-float: 1
-idouble: 2
-ifloat: 1
-Test "yn (0, 1.0) == 0.088256964215676957983":
+Test "yn (0, 1.0) == 0.0882569642156769579829267660235151628":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "yn (0, 1.5) == 0.38244892379775884396":
+Test "yn (0, 1.5) == 0.382448923797758843955068554978089862":
 double: 2
 float: 1
 idouble: 2
 ifloat: 1
-Test "yn (0, 10.0) == 0.055671167283599391424":
+Test "yn (0, 10.0) == 0.0556711672835993914244598774101900481":
 float: 1
 ifloat: 1
-Test "yn (0, 8.0) == 0.22352148938756622053":
+Test "yn (0, 8.0) == 0.223521489387566220527323400498620359":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (1, 0.1) == -6.4589510947020269877":
+Test "yn (1, 0.125) == -5.19993611253477499595928744876579921":
 double: 1
 idouble: 1
-Test "yn (1, 0.7) == -1.1032498719076333697":
-double: 1
+Test "yn (1, 1.5) == -0.412308626973911295952829820633445323":
 float: 1
-idouble: 1
 ifloat: 1
-Test "yn (1, 1.5) == -0.41230862697391129595":
-float: 1
-ifloat: 1
-Test "yn (1, 10.0) == 0.24901542420695388392":
+Test "yn (1, 10.0) == 0.249015424206953883923283474663222803":
 double: 3
 float: 1
 idouble: 3
 ifloat: 1
-Test "yn (1, 2.0) == -0.10703243154093754689":
+Test "yn (1, 2.0) == -0.107032431540937546888370772277476637":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (1, 8.0) == -0.15806046173124749426":
+Test "yn (1, 8.0) == -0.158060461731247494255555266187483550":
 double: 1
 float: 2
 idouble: 1
 ifloat: 2
-Test "yn (10, 0.1) == -0.11831335132045197885e19":
-double: 2
-float: 2
-idouble: 2
-ifloat: 2
-Test "yn (10, 0.7) == -0.42447194260703866924e10":
-double: 3
-idouble: 3
-Test "yn (10, 1.0) == -0.12161801427868918929e9":
+Test "yn (10, 0.125) == -127057845771019398.252538486899753195":
 double: 1
 idouble: 1
-Test "yn (10, 10.0) == -0.35981415218340272205":
+Test "yn (10, 0.75) == -2133501638.90573424452445412893839236":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (10, 2.0) == -129184.54220803928264":
-double: 2
-idouble: 2
-Test "yn (3, 0.1) == -5099.3323786129048894":
+Test "yn (10, 1.0) == -121618014.278689189288130426667971145":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
-Test "yn (3, 0.7) == -15.819479052819633505":
-double: 3
-float: 1
-idouble: 3
-ifloat: 1
-Test "yn (3, 10.0) == -0.25136265718383732978":
+Test "yn (10, 10.0) == -0.359814152183402722051986577343560609":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-Test "yn (3, 2.0) == -1.1277837768404277861":
-double: 1
-idouble: 1
-
-# Maximal error of functions:
-Function: "asin":
-double: 1
-idouble: 1
-
-Function: "atan2":
-float: 4
-ifloat: 4
-
-Function: "atanh":
+Test "yn (10, 2.0) == -129184.542208039282635913145923304214":
+double: 2
+idouble: 2
+Test "yn (3, 0.125) == -2612.69757350066712600220955744091741":
 double: 1
 idouble: 1
-
-Function: "cabs":
+Test "yn (3, 0.75) == -12.9877176234475433186319774484809207":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
-
-Function: Real part of "cacos":
+Test "yn (3, 10.0) == -0.251362657183837329779204747654240998":
 double: 1
 float: 1
 idouble: 1
 ifloat: 1
+Test "yn (3, 2.0) == -1.12778377684042778608158395773179238":
+double: 1
+idouble: 1
+
+# Maximal error of functions:
+Function: "atan2":
+float: 3
+ifloat: 3
 
-Function: Imaginary part of "cacos":
+Function: "atanh":
 float: 1
 ifloat: 1
 
@@ -807,13 +660,9 @@
 ifloat: 3
 
 Function: Real part of "casin":
-double: 3
-float: 2
-idouble: 3
-ifloat: 2
-
-Function: Imaginary part of "casin":
+double: 1
 float: 1
+idouble: 1
 ifloat: 1
 
 Function: Real part of "casinh":
@@ -840,9 +689,7 @@
 
 Function: Real part of "catanh":
 double: 4
-float: 1
 idouble: 4
-ifloat: 1
 
 Function: Imaginary part of "catanh":
 float: 6
@@ -854,12 +701,12 @@
 
 Function: Real part of "ccos":
 double: 1
+float: 1
 idouble: 1
+ifloat: 1
 
 Function: Imaginary part of "ccos":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Real part of "ccosh":
@@ -869,29 +716,27 @@
 ifloat: 1
 
 Function: Imaginary part of "ccosh":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Real part of "cexp":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Imaginary part of "cexp":
 float: 1
 ifloat: 1
 
+Function: Real part of "clog":
+float: 1
+ifloat: 1
+
 Function: Imaginary part of "clog":
 float: 3
 ifloat: 3
 
 Function: Real part of "clog10":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: Imaginary part of "clog10":
@@ -907,9 +752,9 @@
 ifloat: 1
 
 Function: Real part of "cpow":
-double: 1
+double: 2
 float: 4
-idouble: 1
+idouble: 2
 ifloat: 4
 
 Function: Imaginary part of "cpow":
@@ -918,10 +763,6 @@
 idouble: 2
 ifloat: 2
 
-Function: Imaginary part of "csin":
-float: 1
-ifloat: 1
-
 Function: Real part of "csinh":
 float: 1
 ifloat: 1
@@ -933,44 +774,34 @@
 ifloat: 1
 
 Function: Real part of "csqrt":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
-Function: Imaginary part of "csqrt":
 float: 1
 ifloat: 1
 
 Function: Real part of "ctan":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
 
 Function: Imaginary part of "ctan":
 double: 1
-float: 1
 idouble: 1
-ifloat: 1
 
 Function: Real part of "ctanh":
-double: 2
+double: 1
 float: 2
-idouble: 2
+idouble: 1
 ifloat: 2
 
 Function: Imaginary part of "ctanh":
-double: 2
 float: 1
-idouble: 2
 ifloat: 1
 
+Function: "erf":
+double: 1
+idouble: 1
+
 Function: "erfc":
-double: 24
-float: 12
-idouble: 24
-ifloat: 12
+double: 1
+idouble: 1
 
 Function: "exp10":
 double: 6
@@ -979,19 +810,13 @@
 ifloat: 2
 
 Function: "expm1":
+double: 1
 float: 1
-ifloat: 1
-
-Function: "fmod":
-double: 2
-float: 1
-idouble: 2
+idouble: 1
 ifloat: 1
 
 Function: "hypot":
-double: 1
 float: 1
-idouble: 1
 ifloat: 1
 
 Function: "j0":
@@ -1007,9 +832,9 @@
 ifloat: 2
 
 Function: "jn":
-double: 6
+double: 4
 float: 4
-idouble: 6
+idouble: 4
 ifloat: 4
 
 Function: "lgamma":
@@ -1018,28 +843,14 @@
 idouble: 1
 ifloat: 2
 
-Function: "log":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
 Function: "log10":
 double: 1
-float: 1
+float: 2
 idouble: 1
-ifloat: 1
+ifloat: 2
 
 Function: "log1p":
-double: 1
 float: 1
-idouble: 1
-ifloat: 1
-
-Function: "log2":
-double: 1
-float: 1
-idouble: 1
 ifloat: 1
 
 Function: "sincos":
@@ -1048,21 +859,9 @@
 idouble: 1
 ifloat: 1
 
-Function: "sinh":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
-
 Function: "tan":
 double: 1
 idouble: 1
-
-Function: "tanh":
-double: 1
-float: 1
-idouble: 1
-ifloat: 1
 
 Function: "tgamma":
 double: 1
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/sh/sh4/fpu/fesetenv.c ../glibc-2.3/sysdeps/sh/sh4/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/sh/sh4/fpu/fesetenv.c	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/sh/sh4/fpu/fesetenv.c	Sat Sep 14 09:40:54 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997, 1998, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -32,3 +32,4 @@
     }
   return 0;
 }
+libm_hidden_def (fesetenv)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/sh/sh4/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/sh/sh4/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/sh/sh4/fpu/fraiseexcpt.c	Sat Jul  7 15:21:28 2001
+++ ../glibc-2.3/sysdeps/sh/sh4/fpu/fraiseexcpt.c	Sat Sep 14 09:40:54 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997, 1998, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1998, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -33,3 +33,4 @@
 
   return 0;
 }
+libm_hidden_def (feraiseexcept)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/sparc/fpu/fesetenv.c ../glibc-2.3/sysdeps/sparc/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/sparc/fpu/fesetenv.c	Sat Jul  7 15:21:29 2001
+++ ../glibc-2.3/sysdeps/sparc/fpu/fesetenv.c	Sat Sep 14 09:40:54 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -51,4 +51,5 @@
 compat_symbol (libm, __old_fesetenv, fesetenv, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__fesetenv, fesetenv)
 versioned_symbol (libm, __fesetenv, fesetenv, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/sparc/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/sparc/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/sparc/fpu/fraiseexcpt.c	Sat Jul  7 15:21:29 2001
+++ ../glibc-2.3/sysdeps/sparc/fpu/fraiseexcpt.c	Sat Sep 14 09:40:54 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 1997, 1999, 2000 Free Software Foundation, Inc.
+   Copyright (C) 1997, 1999, 2000, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -67,4 +67,5 @@
 compat_symbol (libm, __old_feraiseexcept, feraiseexcept, GLIBC_2_1);
 #endif
 
+libm_hidden_ver (__feraiseexcept, feraiseexcept)
 versioned_symbol (libm, __feraiseexcept, feraiseexcept, GLIBC_2_2);
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/aix/sigset-cvt-mask.h ../glibc-2.3/sysdeps/unix/sysv/aix/sigset-cvt-mask.h
--- glibc-2.2.93/sysdeps/unix/sysv/aix/sigset-cvt-mask.h	Tue Aug 27 00:52:45 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/aix/sigset-cvt-mask.h	Thu Sep  5 19:27:56 2002
@@ -18,8 +18,16 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#define sigset_set_old_mask(set, mask) \
-  ((set)->__losigs = (unsigned int) (mask), (set)->__hisigs = 0, 0)
+static inline int __attribute__ ((unused))
+sigset_set_old_mask (sigset_t *set, int mask)
+{
+  set->__losigs = (unsigned int) mask;
+  set->__hisigs = 0;
+  return 0;
+}
 
-#define sigset_get_old_mask(set, mask) \
-  ((unsigned int) (set)->__losigs)
+static inline int __attribute__ ((unused))
+sigset_get_old_mask (const sigset_t *set)
+{
+  return (unsigned int) set->__losigs;
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/configure ../glibc-2.3/sysdeps/unix/sysv/linux/configure
--- glibc-2.2.93/sysdeps/unix/sysv/linux/configure	Sun Jul 28 18:23:00 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/configure	Thu Sep  5 19:27:57 2002
@@ -85,10 +85,13 @@
     arch_minimum_kernel=2.4.0
     libc_cv_gcc_unwind_find_fde=yes
     ;;
-  powerpc*)
+  powerpc/powerpc32)
     libc_cv_gcc_unwind_find_fde=yes
     arch_minimum_kernel=2.0.10
     ;;
+  powerpc/powerpc64)
+    arch_minimum_kernel=2.4.19
+    ;;
   s390/s390-32)
     libc_cv_gcc_unwind_find_fde=yes
     arch_minimum_kernel=2.2.10
@@ -129,11 +132,11 @@
 
 if test -n "$minimum_kernel"; then
   echo $ac_n "checking for kernel header at least $minimum_kernel""... $ac_c" 1>&6
-echo "configure:133: checking for kernel header at least $minimum_kernel" >&5
+echo "configure:136: checking for kernel header at least $minimum_kernel" >&5
   decnum=`echo "$minimum_kernel.0.0.0" | sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\).*/(\1 * 65536 + \2 * 256 + \3)/'`;
   abinum=`echo "$minimum_kernel.0.0.0" | sed 's/\([0-9]*\)\.\([0-9]*\)\.\([0-9]*\).*/\1,\2,\3/'`;
   cat > conftest.$ac_ext <<EOF
-#line 137 "configure"
+#line 140 "configure"
 #include "confdefs.h"
 #include <linux/version.h>
 #if LINUX_VERSION_CODE < $decnum
@@ -181,7 +184,8 @@
 # in /lib and /etc.
 if test "$prefix" = "/usr" -o "$prefix" = "/usr/"; then
   # 64bit libraries on sparc go to /lib64 and not /lib
-  if test "$machine" = "sparc/sparc64" -o "$machine" = "x86_64"; then
+  if test "$machine" = "sparc/sparc64" -o "$machine" = "x86_64" \
+	  -o "$machine" = "powerpc/powerpc64"; then
     libc_cv_slibdir="/lib64"
     if test "$libdir" = '${exec_prefix}/lib'; then
       libdir='${exec_prefix}/lib64';
@@ -265,6 +269,9 @@
   x86_64*)
     ldd_rewrite_script=../sysdeps/unix/sysv/linux/x86_64/ldd-rewrite.sed
     ;;
+  powerpc*)
+    ldd_rewrite_script=../sysdeps/unix/sysv/linux/powerpc/ldd-rewrite.sed
+    ;;
   *)
     ;;
 esac
@@ -280,7 +287,7 @@
     ac_prefix=$ac_default_prefix
   fi
   echo $ac_n "checking for symlinks in ${ac_prefix}/include""... $ac_c" 1>&6
-echo "configure:284: checking for symlinks in ${ac_prefix}/include" >&5
+echo "configure:291: checking for symlinks in ${ac_prefix}/include" >&5
   ac_message=
   if test -L ${ac_prefix}/include/net; then
     ac_message="$ac_message
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/configure.in ../glibc-2.3/sysdeps/unix/sysv/linux/configure.in
--- glibc-2.2.93/sysdeps/unix/sysv/linux/configure.in	Sun Jul 28 18:22:50 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/configure.in	Thu Sep  5 19:27:57 2002
@@ -74,10 +74,13 @@
     arch_minimum_kernel=2.4.0
     libc_cv_gcc_unwind_find_fde=yes
     ;;
-  powerpc*)
+  powerpc/powerpc32)
     libc_cv_gcc_unwind_find_fde=yes
     arch_minimum_kernel=2.0.10
     ;;
+  powerpc/powerpc64)
+    arch_minimum_kernel=2.4.19
+    ;;
   s390/s390-32)
     libc_cv_gcc_unwind_find_fde=yes
     arch_minimum_kernel=2.2.10
@@ -151,7 +154,8 @@
 # in /lib and /etc.
 if test "$prefix" = "/usr" -o "$prefix" = "/usr/"; then
   # 64bit libraries on sparc go to /lib64 and not /lib
-  if test "$machine" = "sparc/sparc64" -o "$machine" = "x86_64"; then
+  if test "$machine" = "sparc/sparc64" -o "$machine" = "x86_64" \
+	  -o "$machine" = "powerpc/powerpc64"; then
     libc_cv_slibdir="/lib64"
     if test "$libdir" = '${exec_prefix}/lib'; then
       libdir='${exec_prefix}/lib64';
@@ -234,6 +238,9 @@
     ;;
   x86_64*)
     ldd_rewrite_script=../sysdeps/unix/sysv/linux/x86_64/ldd-rewrite.sed
+    ;;
+  powerpc*)
+    ldd_rewrite_script=../sysdeps/unix/sysv/linux/powerpc/ldd-rewrite.sed
     ;;
   *)
     ;;
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/mips/syscalls.list ../glibc-2.3/sysdeps/unix/sysv/linux/mips/syscalls.list
--- glibc-2.2.93/sysdeps/unix/sysv/linux/mips/syscalls.list	Sat Aug  3 15:41:00 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/mips/syscalls.list	Sat Sep 14 09:41:00 2002
@@ -67,6 +67,7 @@
 s_putpmsg	putpmsg	putpmsg		i:ippii	__syscall_putpmsg
 s_ptrace	ptrace	ptrace		i:iipp	__syscall_ptrace
 s_pwrite64	pwrite64 pwrite		i:ibniii __syscall_pwrite
+s_readahead	EXTRA	readahead	i:iipi	__syscall_readahead
 s_reboot	reboot	reboot		i:iii	__syscall_reboot
 s_setrlimit	setrlimit setrlimit	i:ip	__syscall_setrlimit
 s_sigpending	sigpending sigpending	i:p	__syscall_sigpending
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/Dist ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/Dist
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/Dist	Wed Aug 28 04:55:04 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/Dist	Thu Sep  5 19:28:01 2002
@@ -1,4 +1,3 @@
-clone.S
 dl-brk.S
 fe_nomask.c
 ipc_priv.h
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/Makefile ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/Makefile
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/Makefile	Thu Mar 28 18:41:51 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/Makefile	Thu Sep  5 19:28:01 2002
@@ -2,7 +2,3 @@
 sysdep_routines += rt_sigsuspend rt_sigprocmask rt_sigtimedwait	\
 		   rt_sigqueueinfo rt_sigaction rt_sigpending
 endif
-
-ifeq ($(subdir),resource)
-sysdep_routines += oldgetrlimit64
-endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/Versions ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/Versions
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/Versions	Fri Aug 23 15:47:00 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/Versions	Wed Dec 31 19:00:00 1969
@@ -1,23 +0,0 @@
-libc {
-  GLIBC_2.0 {
-    # Exception handling support functions from libgcc
-    __register_frame; __register_frame_table; __deregister_frame;
-    __frame_state_for; __register_frame_info_table;
-  }
-  GLIBC_2.2 {
-    # functions used in other libraries
-    __xstat64; __fxstat64; __lxstat64;
-
-    # g*
-    glob64;
-
-    # New rlimit interface
-    getrlimit; setrlimit; getrlimit64; setrlimit64;
-
-    # r*
-    readdir64; readdir64_r;
-
-    # s*
-    scandir64;
-  }
-}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/brk.S ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/brk.S
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/brk.S	Sat Jul  7 15:21:35 2001
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/brk.S	Wed Dec 31 19:00:00 1969
@@ -1,54 +0,0 @@
-/* brk system call for Linux/ppc.
-   Copyright (C) 1995, 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#define _ERRNO_H	1
-#include <bits/errno.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-	.comm	__curbrk,4,4
-	.section ".text"
-ENTRY (BP_SYM (__brk))
-	DISCARD_BOUNDS (r3)	/* the bounds are meaningless, so toss 'em */
-
-	stwu    r1,-16(r1)
-	stw	r3,8(r1)
-	DO_CALL(SYS_ify(brk))
-	lwz     r6,8(r1)
-#ifdef PIC
-	mflr    r4
-	bl      _GLOBAL_OFFSET_TABLE_@local-4
-	mflr    r5
-	lwz     r5,__curbrk@got(r5)
-	mtlr    r4
-	stw     r3,0(r5)
-#else
-	lis     r4,__curbrk@ha
-	stw     r3,__curbrk@l(r4)
-#endif
-	cmplw   r6,r3
-	addi    r1,r1,16
-	li	r3,0
-	blelr+
-	li      r3,ENOMEM
-	b	JUMPTARGET(__syscall_error)
-END (BP_SYM (__brk))
-
-weak_alias (BP_SYM (__brk), BP_SYM (brk))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/clone.S ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/clone.S
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/clone.S	Sat Aug  3 22:20:06 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/clone.S	Wed Dec 31 19:00:00 1969
@@ -1,94 +0,0 @@
-/* Wrapper around clone system call.
-   Copyright (C) 1997,98,99,2000,02 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#define _ERRNO_H	1
-#include <bits/errno.h>
-#include <bp-sym.h>
-#include <bp-asm.h>
-
-/* This is the only really unusual system call in PPC linux, but not
-   because of any weirdness in the system call itself; because of
-   all the freaky stuff we have to do to make the call useful.  */
-
-/* int [r3] clone(int (*fn)(void *arg) [r3], void *child_stack [r4],
-   		  int flags [r5], void *arg [r6]); */
-
-ENTRY (BP_SYM (__clone))
-	/* GKM FIXME: add bounds checks, where sensible.  */
-	DISCARD_BOUNDS (r4)
-	DISCARD_BOUNDS (r6)
-
-	/* Check for child_stack == NULL || fn == NULL.  */
-	cmpwi	cr0,r4,0
-	cmpwi	cr1,r3,0
-	cror	cr0*4+eq,cr1*4+eq,cr0*4+eq
-	beq-	cr0,L(badargs)
-
-	/* Set up stack frame for parent.  */
-	stwu	r1,-32(r1)
-	stmw	r29,16(r1)
-
-	/* Set up stack frame for child.  */
-	clrrwi	r4,r4,4
-	li	r0,0
-	stwu	r0,-16(r4)
-
-	/* Save fn, args, stack across syscall.  */
-	mr	r29,r3			/* Function in r29.  */
-	mr	r30,r4			/* Stack pointer in r30.  */
-	mr	r31,r6			/* Argument in r31.  */
-
-	/* 'flags' argument is first parameter to clone syscall. (The other
-	   argument is the stack pointer, already in r4.)  */
-	mr	r3,r5
-
-	/* Do the call.  */
-	DO_CALL(SYS_ify(clone))
-
-	/* Check for child process.  */
-	cmpwi	cr1,r3,0
-	crandc	cr1*4+eq,cr1*4+eq,cr0*4+so
-	bne-	cr1,L(parent)		/* The '-' is to minimise the race.  */
-
-	/* On at least mklinux DR3a5, clone() doesn't actually change
-	   the stack pointer.  I'm pretty sure this is a bug, because
-	   it adds a race condition if a signal is sent to a thread
-	   just after it is created (in the previous three instructions).  */
-	mr	r1,r30
-	/* Call procedure.  */
-	mtctr	r29
-	mr	r3,r31
-	bctrl
-	/* Call _exit with result from procedure.  */
-	b	HIDDEN_JUMPTARGET(_exit)
-
-L(parent):
-	/* Parent.  Restore registers & return.  */
-	lmw	r29,16(r1)
-	addi	r1,r1,32
-	bnslr+
-	b	JUMPTARGET(__syscall_error)
-
-L(badargs):
-	li	r3,EINVAL
-	b	JUMPTARGET(__syscall_error)
-END (BP_SYM (__clone))
-
-weak_alias (BP_SYM (__clone), BP_SYM (clone))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/kernel_stat.h ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/kernel_stat.h
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/kernel_stat.h	Sat Jul  7 15:21:35 2001
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/kernel_stat.h	Wed Dec 31 19:00:00 1969
@@ -1,59 +0,0 @@
-/* Definition of `struct stat' used in the kernel.
-   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-struct kernel_stat
-  {
-    unsigned int st_dev;
-    unsigned int st_ino;
-    unsigned int st_mode;
-    unsigned short st_nlink;
-    unsigned int st_uid;
-    unsigned int st_gid;
-    unsigned int st_rdev;
-    unsigned long int st_size;
-    unsigned long int st_blksize;
-    unsigned long int st_blocks;
-    unsigned long int st_atime;
-    unsigned long int __unused1;
-#define _HAVE___UNUSED1
-    unsigned long int st_mtime;
-    unsigned long int __unused2;
-#define _HAVE___UNUSED2
-    unsigned long int st_ctime;
-    unsigned long int __unused3;
-#define _HAVE___UNUSED3
-    unsigned long int __unused4;
-#define _HAVE___UNUSED4
-    unsigned long int __unused5;
-#define _HAVE___UNUSED5
-  };
-
-#define _HAVE_STAT___UNUSED1
-#define _HAVE_STAT___UNUSED2
-#define _HAVE_STAT___UNUSED3
-#define _HAVE_STAT___UNUSED4
-#define _HAVE_STAT___UNUSED5
-#define _HAVE_STAT___PAD1
-#define _HAVE_STAT___PAD2
-#define _HAVE_STAT64___UNUSED1
-#define _HAVE_STAT64___UNUSED2
-#define _HAVE_STAT64___UNUSED3
-#define _HAVE_STAT64___UNUSED4
-#define _HAVE_STAT64___UNUSED5
-#define _HAVE_STAT64___PAD2
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/ldconfig.h ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/ldconfig.h
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/ldconfig.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/ldconfig.h	Sat Sep 14 05:00:26 2002
@@ -0,0 +1,27 @@
+/* ldconfig default paths and libraries.  Linux/PowerPC version.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdeps/generic/ldconfig.h>
+
+#define SYSDEP_KNOWN_INTERPRETER_NAMES \
+  { "/lib/ld.so.1", FLAG_ELF_LIBC6 },	\
+  { "/lib64/ld64.so.1", FLAG_ELF_LIBC6 },
+#define SYSDEP_KNOWN_LIBRARY_NAMES \
+  { "libc.so.6", FLAG_ELF_LIBC6 },	\
+  { "libm.so.6", FLAG_ELF_LIBC6 },
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/ldd-rewrite.sed ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/ldd-rewrite.sed
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/ldd-rewrite.sed	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/ldd-rewrite.sed	Thu Sep  5 06:04:14 2002
@@ -0,0 +1,15 @@
+/LD_TRACE_LOADED_OBJECTS=1/a\
+add_env="$add_env LD_LIBRARY_VERSION=\\$verify_out"
+
+# ldd is generated from elf/ldd.bash.in with the name
+# of ld.so as generated in Makeconfig
+
+# that name is replaced by a pair referring to both
+# the 32bit and 64bit dynamic linker.
+
+# /lib(64|)/*(64|).so* is replaced with /lib/*.so* and /lib64/*64.so*
+# this works for /lib64/ld64.so.x and /lib/ld.so.x as input
+s_lib64_lib_
+s_64\.so_\.so_
+s_^RTLDLIST=\(.*lib\)\(/[^/]*\)\(\.so\.[0-9.]*\)[[:blank:]]*$_RTLDLIST="\1\2\3 \164\264\3"_
+
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/Dist ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/Dist
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/Dist	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/Dist	Thu Sep  5 06:08:24 2002
@@ -0,0 +1 @@
+clone.S
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/Makefile ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/Makefile
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/Makefile	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/Makefile	Thu Sep  5 06:09:45 2002
@@ -0,0 +1,3 @@
+ifeq ($(subdir),resource)
+sysdep_routines += oldgetrlimit64
+endif
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/Versions ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/Versions
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/Versions	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/Versions	Thu Sep  5 06:12:15 2002
@@ -0,0 +1,23 @@
+libc {
+  GLIBC_2.0 {
+    # Exception handling support functions from libgcc
+    __register_frame; __register_frame_table; __deregister_frame;
+    __frame_state_for; __register_frame_info_table;
+  }
+  GLIBC_2.2 {
+    # functions used in other libraries
+    __xstat64; __fxstat64; __lxstat64;
+
+    # g*
+    glob64;
+
+    # New rlimit interface
+    getrlimit; setrlimit; getrlimit64; setrlimit64;
+
+    # r*
+    readdir64; readdir64_r;
+
+    # s*
+    scandir64;
+  }
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/brk.S ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/brk.S
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/brk.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/brk.S	Thu Sep  5 05:12:40 2002
@@ -0,0 +1,54 @@
+/* brk system call for Linux/ppc.
+   Copyright (C) 1995, 1996, 1997, 1999, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#define _ERRNO_H	1
+#include <bits/errno.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+	.comm	__curbrk,4,4
+	.section ".text"
+ENTRY (BP_SYM (__brk))
+	DISCARD_BOUNDS (r3)	/* the bounds are meaningless, so toss 'em */
+
+	stwu    r1,-16(r1)
+	stw	r3,8(r1)
+	DO_CALL(SYS_ify(brk))
+	lwz     r6,8(r1)
+#ifdef PIC
+	mflr    r4
+	bl      _GLOBAL_OFFSET_TABLE_@local-4
+	mflr    r5
+	lwz     r5,__curbrk@got(r5)
+	mtlr    r4
+	stw     r3,0(r5)
+#else
+	lis     r4,__curbrk@ha
+	stw     r3,__curbrk@l(r4)
+#endif
+	cmplw   r6,r3
+	addi    r1,r1,16
+	li	r3,0
+	blelr+
+	li      r3,ENOMEM
+	b	JUMPTARGET(__syscall_error)
+END (BP_SYM (__brk))
+
+weak_alias (BP_SYM (__brk), BP_SYM (brk))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/clone.S	Thu Sep  5 05:13:00 2002
@@ -0,0 +1,94 @@
+/* Wrapper around clone system call.
+   Copyright (C) 1997,98,99,2000,02 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#define _ERRNO_H	1
+#include <bits/errno.h>
+#include <bp-sym.h>
+#include <bp-asm.h>
+
+/* This is the only really unusual system call in PPC linux, but not
+   because of any weirdness in the system call itself; because of
+   all the freaky stuff we have to do to make the call useful.  */
+
+/* int [r3] clone(int (*fn)(void *arg) [r3], void *child_stack [r4],
+   		  int flags [r5], void *arg [r6]); */
+
+ENTRY (BP_SYM (__clone))
+	/* GKM FIXME: add bounds checks, where sensible.  */
+	DISCARD_BOUNDS (r4)
+	DISCARD_BOUNDS (r6)
+
+	/* Check for child_stack == NULL || fn == NULL.  */
+	cmpwi	cr0,r4,0
+	cmpwi	cr1,r3,0
+	cror	cr0*4+eq,cr1*4+eq,cr0*4+eq
+	beq-	cr0,L(badargs)
+
+	/* Set up stack frame for parent.  */
+	stwu	r1,-32(r1)
+	stmw	r29,16(r1)
+
+	/* Set up stack frame for child.  */
+	clrrwi	r4,r4,4
+	li	r0,0
+	stwu	r0,-16(r4)
+
+	/* Save fn, args, stack across syscall.  */
+	mr	r29,r3			/* Function in r29.  */
+	mr	r30,r4			/* Stack pointer in r30.  */
+	mr	r31,r6			/* Argument in r31.  */
+
+	/* 'flags' argument is first parameter to clone syscall. (The other
+	   argument is the stack pointer, already in r4.)  */
+	mr	r3,r5
+
+	/* Do the call.  */
+	DO_CALL(SYS_ify(clone))
+
+	/* Check for child process.  */
+	cmpwi	cr1,r3,0
+	crandc	cr1*4+eq,cr1*4+eq,cr0*4+so
+	bne-	cr1,L(parent)		/* The '-' is to minimise the race.  */
+
+	/* On at least mklinux DR3a5, clone() doesn't actually change
+	   the stack pointer.  I'm pretty sure this is a bug, because
+	   it adds a race condition if a signal is sent to a thread
+	   just after it is created (in the previous three instructions).  */
+	mr	r1,r30
+	/* Call procedure.  */
+	mtctr	r29
+	mr	r3,r31
+	bctrl
+	/* Call _exit with result from procedure.  */
+	b	HIDDEN_JUMPTARGET(_exit)
+
+L(parent):
+	/* Parent.  Restore registers & return.  */
+	lmw	r29,16(r1)
+	addi	r1,r1,32
+	bnslr+
+	b	JUMPTARGET(__syscall_error)
+
+L(badargs):
+	li	r3,EINVAL
+	b	JUMPTARGET(__syscall_error)
+END (BP_SYM (__clone))
+
+weak_alias (BP_SYM (__clone), BP_SYM (clone))
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/kernel_stat.h ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/kernel_stat.h
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/kernel_stat.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/kernel_stat.h	Thu Sep  5 05:13:26 2002
@@ -0,0 +1,59 @@
+/* Definition of `struct stat' used in the kernel.
+   Copyright (C) 1997, 2000 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+struct kernel_stat
+  {
+    unsigned int st_dev;
+    unsigned int st_ino;
+    unsigned int st_mode;
+    unsigned short st_nlink;
+    unsigned int st_uid;
+    unsigned int st_gid;
+    unsigned int st_rdev;
+    unsigned long int st_size;
+    unsigned long int st_blksize;
+    unsigned long int st_blocks;
+    unsigned long int st_atime;
+    unsigned long int __unused1;
+#define _HAVE___UNUSED1
+    unsigned long int st_mtime;
+    unsigned long int __unused2;
+#define _HAVE___UNUSED2
+    unsigned long int st_ctime;
+    unsigned long int __unused3;
+#define _HAVE___UNUSED3
+    unsigned long int __unused4;
+#define _HAVE___UNUSED4
+    unsigned long int __unused5;
+#define _HAVE___UNUSED5
+  };
+
+#define _HAVE_STAT___UNUSED1
+#define _HAVE_STAT___UNUSED2
+#define _HAVE_STAT___UNUSED3
+#define _HAVE_STAT___UNUSED4
+#define _HAVE_STAT___UNUSED5
+#define _HAVE_STAT___PAD1
+#define _HAVE_STAT___PAD2
+#define _HAVE_STAT64___UNUSED1
+#define _HAVE_STAT64___UNUSED2
+#define _HAVE_STAT64___UNUSED3
+#define _HAVE_STAT64___UNUSED4
+#define _HAVE_STAT64___UNUSED5
+#define _HAVE_STAT64___PAD2
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/socket.S ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/socket.S
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/socket.S	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/socket.S	Thu Sep  5 05:13:44 2002
@@ -0,0 +1,85 @@
+/* Copyright (C) 1995, 1996, 1997, 1999 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#include <sysdep.h>
+#include <socketcall.h>
+
+#define P(a, b) P2(a, b)
+#define P2(a, b) a##b
+
+/* The socket-oriented system calls are handled unusally in Linux.
+   They are all gated through the single `socketcall' system call number.
+   `socketcall' takes two arguments: the first is the subcode, specifying
+   which socket function is being called; and the second is a pointer to
+   the arguments to the specific function.
+
+   The .S files for the other calls just #define socket and #include this.
+   They also #define a 'number-of-arguments' word in NARGS, which
+   defaults to 3.  */
+
+#ifndef NARGS
+#ifdef socket
+#error NARGS not defined
+#endif
+#define NARGS 3
+#endif
+
+#define stackblock 20
+
+#ifndef __socket
+#define __socket P(__,socket)
+#endif
+
+	.text
+ENTRY(__socket)
+	stwu r1,-48(r1)
+#if NARGS >= 1
+	stw  r3,stackblock(r1)
+#endif
+#if NARGS >= 2
+	stw  r4,4+stackblock(r1)
+#endif
+#if NARGS >= 3
+	stw  r5,8+stackblock(r1)
+#endif
+#if NARGS >= 4
+	stw  r6,12+stackblock(r1)
+#endif
+#if NARGS >= 5
+	stw  r7,16+stackblock(r1)
+#endif
+#if NARGS >= 6
+	stw  r8,20+stackblock(r1)
+#endif
+#if NARGS >= 7
+	stw  r9,24+stackblock(r1)
+#endif
+#if NARGS >= 8
+	stw  r10,28+stackblock(r1)
+#endif
+#if NARGS >= 9
+#error too many arguments!
+#endif
+	li	r3,P(SOCKOP_,socket)
+	addi	r4,r1,stackblock
+	DO_CALL(SYS_ify(socketcall))
+	addi	r1,r1,48
+	PSEUDO_RET
+PSEUDO_END (__socket)
+
+weak_alias (__socket, socket)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/syscalls.list	Thu Sep  5 05:12:24 2002
@@ -0,0 +1,54 @@
+# File name	Caller	Syscall name	# args	Strong name	Weak names
+
+# System calls with wrappers.
+s_ioctl		ioctl	ioctl		i:iiI	__syscall_ioctl
+s_ipc		msgget	ipc		i:iiiip	__syscall_ipc
+s_llseek	llseek	_llseek		i:iiipi	__syscall__llseek
+s_readahead	readahead readahead	i:iiii	__syscall_readahead
+s_chown		chown	chown		i:sii	__syscall_chown
+s_execve	execve	execve		i:spp	__syscall_execve
+rt_sigaction	-	rt_sigaction	i:ippi	__syscall_rt_sigaction
+rt_sigpending	-	rt_sigpending	i:pi	__syscall_rt_sigpending
+rt_sigprocmask	-	rt_sigprocmask	i:ippi	__syscall_rt_sigprocmask
+rt_sigqueueinfo	-	rt_sigqueueinfo	i:iip	__syscall_rt_sigqueueinfo
+rt_sigsuspend	-	rt_sigsuspend	i:pi	__syscall_rt_sigsuspend
+rt_sigtimedwait	-	rt_sigtimedwait	i:pppi	__syscall_rt_sigtimedwait
+s_fcntl		fcntl 	fcntl		i:iiF	__syscall_fcntl
+s_fcntl64	fcntl64	fcntl64		i:iiF	__syscall_fcntl64
+s_fstat64	fxstat64 fstat64	i:ip	__syscall_fstat64
+s_ftruncate64	ftruncate64 ftruncate64	i:iii	__syscall_ftruncate64
+s_getcwd	getcwd	getcwd		i:pi	__syscall_getcwd
+s_getdents	getdents getdents	i:ipi	__syscall_getdents
+s_getdents64	getdents getdents64	i:ipi	__syscall_getdents64
+s_getpmsg	getpmsg	getpmsg		i:ipppp	__syscall_getpmsg
+s_getpriority	getpriority getpriority	i:ii	__syscall_getpriority
+getresgid	-	getresgid	i:ppp	getresgid
+getresuid	-	getresuid	i:ppp	getresuid
+s_getrlimit	getrlimit getrlimit	i:ip	__syscall_getrlimit
+s_lstat64	lxstat64 lstat64	i:sp	__syscall_lstat64
+s_mmap2		mmap64	mmap2		b:aniiii __syscall_mmap2
+s_poll		poll	poll		i:pii	__syscall_poll
+s_pread64	pread64	pread		i:ibnii	__syscall_pread
+s_ptrace	ptrace	ptrace		i:iipp	__syscall_ptrace
+s_putpmsg	putpmsg	putpmsg		i:ippii	__syscall_putpmsg
+s_pwrite64	pwrite64 pwrite		i:ibnii	__syscall_pwrite
+s_reboot	reboot	reboot		i:iii	__syscall_reboot
+s_setrlimit	setrlimit setrlimit	i:ip	__syscall_setrlimit
+s_sigaction	sigaction sigaction	i:ipp	__syscall_sigaction
+s_sigpending	sigpending sigpending	i:p	__syscall_sigpending
+s_sigprocmask	sigprocmask sigprocmask	i:ipp	__syscall_sigprocmask
+s_sigsuspend	sigsuspend sigsuspend	i:iii	__syscall_sigsuspend
+s_stat64	xstat64 stat64		i:sp	__syscall_stat64
+s_sysctl	sysctl	_sysctl		i:p	__syscall__sysctl
+s_truncate64	truncate64 truncate64	i:sii	__syscall_truncate64
+s_ugetrlimit	getrlimit ugetrlimit	i:ip	__syscall_ugetrlimit
+s_ustat		ustat	ustat		i:ip	__syscall_ustat
+s_vfork		vfork	vfork		i:	__syscall_vfork
+sys_fstat	fxstat	fstat		i:ip	__syscall_fstat
+sys_lstat	lxstat	lstat		i:sp	__syscall_lstat
+sys_mknod	xmknod	mknod		i:pii	__syscall_mknod
+sys_readv	readv	readv		i:ipi	__syscall_readv
+sys_stat	xstat	stat		i:sp	__syscall_stat
+sys_writev	writev	writev		i:ipi	__syscall_writev
+oldgetrlimit	EXTRA	getrlimit	i:ip	__old_getrlimit	getrlimit@GLIBC_2.0
+oldsetrlimit	EXTRA	setrlimit	i:ip	__old_setrlimit	setrlimit@GLIBC_2.0
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc32/sysdep.h	Thu Sep  5 05:14:09 2002
@@ -0,0 +1,35 @@
+/* Copyright (C) 1992,1997,1998,1999,2000,2001 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#ifndef _LINUX_POWERPC_SYSDEP_H
+#define _LINUX_POWERPC_SYSDEP_H 1
+
+#include <sysdeps/unix/powerpc/sysdep.h>
+
+/* For Linux we can use the system call table in the header file
+	/usr/include/asm/unistd.h
+   of the kernel.  But these symbols do not follow the SYS_* syntax
+   so we have to redefine the `SYS_ify' macro here.  */
+#undef SYS_ify
+#ifdef __STDC__
+# define SYS_ify(syscall_name)	__NR_##syscall_name
+#else
+# define SYS_ify(syscall_name)	__NR_/**/syscall_name
+#endif
+
+#endif /* linux/powerpc/sysdep.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc64/dl-cache.h ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc64/dl-cache.h
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/powerpc64/dl-cache.h	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/powerpc64/dl-cache.h	Sat Sep 14 05:00:28 2002
@@ -0,0 +1,25 @@
+/* Support for reading /etc/ld.so.cache files written by Linux ldconfig.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+#define _DL_CACHE_DEFAULT_ID	0x503
+
+#define _dl_cache_check_flags(flags)			\
+  ((flags) == _DL_CACHE_DEFAULT_ID)
+
+#include_next <dl-cache.h>
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/readelflib.c ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/readelflib.c
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/readelflib.c	Wed Dec 31 19:00:00 1969
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/readelflib.c	Sat Sep 14 05:00:27 2002
@@ -0,0 +1,61 @@
+/* Special checks on libraries for ldconfig.  Linux/PowerPC version.
+   Copyright (C) 2002 Free Software Foundation, Inc.
+   This file is part of the GNU C Library.
+
+   The GNU C Library is free software; you can redistribute it and/or
+   modify it under the terms of the GNU Lesser General Public
+   License as published by the Free Software Foundation; either
+   version 2.1 of the License, or (at your option) any later version.
+
+   The GNU C Library is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+   Lesser General Public License for more details.
+
+   You should have received a copy of the GNU Lesser General Public
+   License along with the GNU C Library; if not, write to the Free
+   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
+   02111-1307 USA.  */
+
+
+int process_elf32_file (const char *file_name, const char *lib, int *flag,
+			unsigned int *osversion, char **soname,
+			void *file_contents, size_t file_length);
+int process_elf64_file (const char *file_name, const char *lib, int *flag,
+			unsigned int *osversion, char **soname,
+			void *file_contents, size_t file_length);
+
+/* Returns 0 if everything is ok, != 0 in case of error.  */
+int
+process_elf_file (const char *file_name, const char *lib, int *flag,
+		  unsigned int *osversion, char **soname, void *file_contents,
+		  size_t file_length)
+{
+  ElfW(Ehdr) *elf_header = (ElfW(Ehdr) *) file_contents;
+  int ret;
+
+  if (elf_header->e_ident [EI_CLASS] == ELFCLASS32)
+    return process_elf32_file (file_name, lib, flag, osversion, soname,
+			       file_contents, file_length);
+  else
+    {
+      ret = process_elf64_file (file_name, lib, flag, osversion, soname,
+				file_contents, file_length);
+      /* PowerPC 64bit libraries are always libc.so.6+.  */
+      if (!ret)
+	*flag = FLAG_POWERPC_LIB64|FLAG_ELF_LIBC6;
+      return ret;
+    }
+}
+
+#undef __ELF_NATIVE_CLASS
+#undef process_elf_file
+#define process_elf_file process_elf32_file
+#define __ELF_NATIVE_CLASS 32
+#include "sysdeps/generic/readelflib.c"
+
+#undef __ELF_NATIVE_CLASS
+#undef process_elf_file
+#define process_elf_file process_elf64_file
+#define __ELF_NATIVE_CLASS 64
+#include "sysdeps/generic/readelflib.c"
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/socket.S ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/socket.S
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/socket.S	Sat Jul  7 15:21:35 2001
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/socket.S	Wed Dec 31 19:00:00 1969
@@ -1,85 +0,0 @@
-/* Copyright (C) 1995, 1996, 1997, 1999 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#include <sysdep.h>
-#include <socketcall.h>
-
-#define P(a, b) P2(a, b)
-#define P2(a, b) a##b
-
-/* The socket-oriented system calls are handled unusally in Linux.
-   They are all gated through the single `socketcall' system call number.
-   `socketcall' takes two arguments: the first is the subcode, specifying
-   which socket function is being called; and the second is a pointer to
-   the arguments to the specific function.
-
-   The .S files for the other calls just #define socket and #include this.
-   They also #define a 'number-of-arguments' word in NARGS, which
-   defaults to 3.  */
-
-#ifndef NARGS
-#ifdef socket
-#error NARGS not defined
-#endif
-#define NARGS 3
-#endif
-
-#define stackblock 20
-
-#ifndef __socket
-#define __socket P(__,socket)
-#endif
-
-	.text
-ENTRY(__socket)
-	stwu r1,-48(r1)
-#if NARGS >= 1
-	stw  r3,stackblock(r1)
-#endif
-#if NARGS >= 2
-	stw  r4,4+stackblock(r1)
-#endif
-#if NARGS >= 3
-	stw  r5,8+stackblock(r1)
-#endif
-#if NARGS >= 4
-	stw  r6,12+stackblock(r1)
-#endif
-#if NARGS >= 5
-	stw  r7,16+stackblock(r1)
-#endif
-#if NARGS >= 6
-	stw  r8,20+stackblock(r1)
-#endif
-#if NARGS >= 7
-	stw  r9,24+stackblock(r1)
-#endif
-#if NARGS >= 8
-	stw  r10,28+stackblock(r1)
-#endif
-#if NARGS >= 9
-#error too many arguments!
-#endif
-	li	r3,P(SOCKOP_,socket)
-	addi	r4,r1,stackblock
-	DO_CALL(SYS_ify(socketcall))
-	addi	r1,r1,48
-	PSEUDO_RET
-PSEUDO_END (__socket)
-
-weak_alias (__socket, socket)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/syscalls.list ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/syscalls.list
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/syscalls.list	Thu May 30 13:54:14 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/syscalls.list	Wed Dec 31 19:00:00 1969
@@ -1,54 +0,0 @@
-# File name	Caller	Syscall name	# args	Strong name	Weak names
-
-# System calls with wrappers.
-s_ioctl		ioctl	ioctl		i:iiI	__syscall_ioctl
-s_ipc		msgget	ipc		i:iiiip	__syscall_ipc
-s_llseek	llseek	_llseek		i:iiipi	__syscall__llseek
-s_readahead	readahead readahead	i:iiii	__syscall_readahead
-s_chown		chown	chown		i:sii	__syscall_chown
-s_execve	execve	execve		i:spp	__syscall_execve
-rt_sigaction	-	rt_sigaction	i:ippi	__syscall_rt_sigaction
-rt_sigpending	-	rt_sigpending	i:pi	__syscall_rt_sigpending
-rt_sigprocmask	-	rt_sigprocmask	i:ippi	__syscall_rt_sigprocmask
-rt_sigqueueinfo	-	rt_sigqueueinfo	i:iip	__syscall_rt_sigqueueinfo
-rt_sigsuspend	-	rt_sigsuspend	i:pi	__syscall_rt_sigsuspend
-rt_sigtimedwait	-	rt_sigtimedwait	i:pppi	__syscall_rt_sigtimedwait
-s_fcntl		fcntl 	fcntl		i:iiF	__syscall_fcntl
-s_fcntl64	fcntl64	fcntl64		i:iiF	__syscall_fcntl64
-s_fstat64	fxstat64 fstat64	i:ip	__syscall_fstat64
-s_ftruncate64	ftruncate64 ftruncate64	i:iii	__syscall_ftruncate64
-s_getcwd	getcwd	getcwd		i:pi	__syscall_getcwd
-s_getdents	getdents getdents	i:ipi	__syscall_getdents
-s_getdents64	getdents getdents64	i:ipi	__syscall_getdents64
-s_getpmsg	getpmsg	getpmsg		i:ipppp	__syscall_getpmsg
-s_getpriority	getpriority getpriority	i:ii	__syscall_getpriority
-getresgid	-	getresgid	i:ppp	getresgid
-getresuid	-	getresuid	i:ppp	getresuid
-s_getrlimit	getrlimit getrlimit	i:ip	__syscall_getrlimit
-s_lstat64	lxstat64 lstat64	i:sp	__syscall_lstat64
-s_mmap2		mmap64	mmap2		b:aniiii __syscall_mmap2
-s_poll		poll	poll		i:pii	__syscall_poll
-s_pread64	pread64	pread		i:ibnii	__syscall_pread
-s_ptrace	ptrace	ptrace		i:iipp	__syscall_ptrace
-s_putpmsg	putpmsg	putpmsg		i:ippii	__syscall_putpmsg
-s_pwrite64	pwrite64 pwrite		i:ibnii	__syscall_pwrite
-s_reboot	reboot	reboot		i:iii	__syscall_reboot
-s_setrlimit	setrlimit setrlimit	i:ip	__syscall_setrlimit
-s_sigaction	sigaction sigaction	i:ipp	__syscall_sigaction
-s_sigpending	sigpending sigpending	i:p	__syscall_sigpending
-s_sigprocmask	sigprocmask sigprocmask	i:ipp	__syscall_sigprocmask
-s_sigsuspend	sigsuspend sigsuspend	i:iii	__syscall_sigsuspend
-s_stat64	xstat64 stat64		i:sp	__syscall_stat64
-s_sysctl	sysctl	_sysctl		i:p	__syscall__sysctl
-s_truncate64	truncate64 truncate64	i:sii	__syscall_truncate64
-s_ugetrlimit	getrlimit ugetrlimit	i:ip	__syscall_ugetrlimit
-s_ustat		ustat	ustat		i:ip	__syscall_ustat
-s_vfork		vfork	vfork		i:	__syscall_vfork
-sys_fstat	fxstat	fstat		i:ip	__syscall_fstat
-sys_lstat	lxstat	lstat		i:sp	__syscall_lstat
-sys_mknod	xmknod	mknod		i:pii	__syscall_mknod
-sys_readv	readv	readv		i:ipi	__syscall_readv
-sys_stat	xstat	stat		i:sp	__syscall_stat
-sys_writev	writev	writev		i:ipi	__syscall_writev
-oldgetrlimit	EXTRA	getrlimit	i:ip	__old_getrlimit	getrlimit@GLIBC_2.0
-oldsetrlimit	EXTRA	setrlimit	i:ip	__old_setrlimit	setrlimit@GLIBC_2.0
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/sysdep.h ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/sysdep.h
--- glibc-2.2.93/sysdeps/unix/sysv/linux/powerpc/sysdep.h	Wed Nov  7 14:40:34 2001
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/powerpc/sysdep.h	Wed Dec 31 19:00:00 1969
@@ -1,35 +0,0 @@
-/* Copyright (C) 1992,1997,1998,1999,2000,2001 Free Software Foundation, Inc.
-   This file is part of the GNU C Library.
-
-   The GNU C Library is free software; you can redistribute it and/or
-   modify it under the terms of the GNU Lesser General Public
-   License as published by the Free Software Foundation; either
-   version 2.1 of the License, or (at your option) any later version.
-
-   The GNU C Library is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY; without even the implied warranty of
-   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-   Lesser General Public License for more details.
-
-   You should have received a copy of the GNU Lesser General Public
-   License along with the GNU C Library; if not, write to the Free
-   Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
-   02111-1307 USA.  */
-
-#ifndef _LINUX_POWERPC_SYSDEP_H
-#define _LINUX_POWERPC_SYSDEP_H 1
-
-#include <sysdeps/unix/powerpc/sysdep.h>
-
-/* For Linux we can use the system call table in the header file
-	/usr/include/asm/unistd.h
-   of the kernel.  But these symbols do not follow the SYS_* syntax
-   so we have to redefine the `SYS_ify' macro here.  */
-#undef SYS_ify
-#ifdef __STDC__
-# define SYS_ify(syscall_name)	__NR_##syscall_name
-#else
-# define SYS_ify(syscall_name)	__NR_/**/syscall_name
-#endif
-
-#endif /* linux/powerpc/sysdep.h */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/pread.c ../glibc-2.3/sysdeps/unix/sysv/linux/pread.c
--- glibc-2.2.93/sysdeps/unix/sysv/linux/pread.c	Wed Jul 17 16:34:23 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/pread.c	Sat Sep 14 09:40:57 2002
@@ -28,6 +28,13 @@
 
 #include "kernel-features.h"
 
+#ifdef __NR_pread64		/* Newer kernels renamed but it's the same.  */
+# ifdef __NR_pread
+#  error "__NR_pread and __NR_pread64 both defined???"
+# endif
+# define __NR_pread __NR_pread64
+#endif
+
 #if defined __NR_pread || __ASSUME_PREAD_SYSCALL > 0
 
 /* The order of hi, lo depends on endianness.  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/pread64.c ../glibc-2.3/sysdeps/unix/sysv/linux/pread64.c
--- glibc-2.2.93/sysdeps/unix/sysv/linux/pread64.c	Sat Jul  7 15:21:32 2001
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/pread64.c	Sat Sep 14 09:40:57 2002
@@ -27,6 +27,13 @@
 
 #include "kernel-features.h"
 
+#ifdef __NR_pread64		/* Newer kernels renamed but it's the same.  */
+# ifdef __NR_pread
+#  error "__NR_pread and __NR_pread64 both defined???"
+# endif
+# define __NR_pread __NR_pread64
+#endif
+
 #if defined __NR_pread || __ASSUME_PREAD_SYSCALL > 0
 
 extern ssize_t __syscall_pread (int fd, void *__unbounded buf, size_t count,
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/pwrite.c ../glibc-2.3/sysdeps/unix/sysv/linux/pwrite.c
--- glibc-2.2.93/sysdeps/unix/sysv/linux/pwrite.c	Wed Jul 17 16:34:58 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/pwrite.c	Sat Sep 14 09:40:57 2002
@@ -28,6 +28,13 @@
 
 #include "kernel-features.h"
 
+#ifdef __NR_pwrite64		/* Newer kernels renamed but it's the same.  */
+# ifdef __NR_pwrite
+#  error "__NR_pwrite and __NR_pwrite64 both defined???"
+# endif
+# define __NR_pwrite __NR_pread64
+#endif
+
 #if defined __NR_pwrite || __ASSUME_PWRITE_SYSCALL > 0
 
 /* The order of hi, lo depends on endianness.  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/pwrite64.c ../glibc-2.3/sysdeps/unix/sysv/linux/pwrite64.c
--- glibc-2.2.93/sysdeps/unix/sysv/linux/pwrite64.c	Fri Aug  2 17:46:59 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/pwrite64.c	Sat Sep 14 09:40:57 2002
@@ -27,6 +27,13 @@
 
 #include "kernel-features.h"
 
+#ifdef __NR_pwrite64		/* Newer kernels renamed but it's the same.  */
+# ifdef __NR_pwrite
+#  error "__NR_pwrite and __NR_pwrite64 both defined???"
+# endif
+# define __NR_pwrite __NR_pread64
+#endif
+
 #if defined __NR_pwrite || __ASSUME_PWRITE_SYSCALL > 0
 
 extern ssize_t __syscall_pwrite (int fd, const void *__unbounded buf, size_t count,
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/shm_open.c ../glibc-2.3/sysdeps/unix/sysv/linux/shm_open.c
--- glibc-2.2.93/sysdeps/unix/sysv/linux/shm_open.c	Sat Jul  7 15:21:32 2001
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/shm_open.c	Sat Sep 14 09:40:57 2002
@@ -1,4 +1,4 @@
-/* Copyright (C) 2000, 2001 Free Software Foundation, Inc.
+/* Copyright (C) 2000, 2001, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -80,8 +80,8 @@
   while ((mp = __getmntent_r (fp, &resmem, buf, sizeof buf)) != NULL)
     /* The original name is "shm" but this got changed in early Linux
        2.4.x to "tmpfs".  */
-    if ((strcmp (mp->mnt_type, "tmpfs") == 0)
-	|| (strcmp (mp->mnt_type, "shm")))
+    if (strcmp (mp->mnt_type, "tmpfs") == 0
+	|| strcmp (mp->mnt_type, "shm") == 0)
       {
 	/* Found it.  There might be more than one place where the
            filesystem is mounted but one is enough for us.  */
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/linux/sigset-cvt-mask.h ../glibc-2.3/sysdeps/unix/sysv/linux/sigset-cvt-mask.h
--- glibc-2.2.93/sysdeps/unix/sysv/linux/sigset-cvt-mask.h	Tue Aug 27 00:52:45 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/linux/sigset-cvt-mask.h	Thu Sep  5 19:27:57 2002
@@ -19,17 +19,26 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#define sigset_set_old_mask(set, mask) \
-  ({									      \
-    unsigned long int *__ptr;						      \
-    int __cnt;								      \
-    __ptr = &(set)->__val[0];						      \
-    *__ptr++ = (unsigned long int) (mask);				      \
-    __cnt = _SIGSET_NWORDS - 2;						      \
-    do									      \
-      *__ptr++ = 0ul;							      \
-    while (--__cnt >= 0);						      \
-    0; })
+static inline int __attribute__ ((unused))
+sigset_set_old_mask (sigset_t *set, int mask)
+{
+  unsigned long int *ptr;
+  int cnt;
 
-#define sigset_get_old_mask(set) \
-  ((unsigned int) (set)->__val[0])
+  ptr = &set->__val[0];
+
+  *ptr++ = (unsigned int) mask;
+
+  cnt = _SIGSET_NWORDS - 2;
+  do
+    *ptr++ = 0ul;
+  while (--cnt >= 0);
+
+  return 0;
+}
+
+static inline int __attribute__ ((unused))
+sigset_get_old_mask (const sigset_t *set)
+{
+  return (unsigned int) set->__val[0];
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/unix/sysv/sysv4/sigset-cvt-mask.h ../glibc-2.3/sysdeps/unix/sysv/sysv4/sigset-cvt-mask.h
--- glibc-2.2.93/sysdeps/unix/sysv/sysv4/sigset-cvt-mask.h	Tue Aug 27 00:52:46 2002
+++ ../glibc-2.3/sysdeps/unix/sysv/sysv4/sigset-cvt-mask.h	Thu Sep  5 19:28:02 2002
@@ -19,15 +19,19 @@
    Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
    02111-1307 USA.  */
 
-#define sigset_set_old_mask(set, mask) \
-  ({									      \
-    unsigned long int *__ptr;						      \
-    __ptr = &(set)->__sigbits[0];					      \
-    __ptr[0] = (mask);							      \
-    __ptr[1] = 0ul;							      \
-    __ptr[2] = 0ul;							      \
-    __ptr[3] = 0ul;							      \
-    0; })
+static inline int __attribute__ ((unused))
+sigset_set_old_mask (sigset_t *set, int mask)
+{
+  set->__sigbits[0] = (unsigned int) mask;
+  set->__sigbits[1] = 0ul;
+  set->__sigbits[2] = 0ul;
+  set->__sigbits[3] = 0ul;
 
-#define sigset_get_old_mask(set) \
-  ((unsigned int) (set)->__sigbits[0])
+  return 0;
+}
+
+static inline int __attribute__ ((unused))
+sigset_get_old_mask (const sigset_t *set)
+{
+  return (unsigned int) set->__sigbits[0];
+}
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/x86_64/fpu/fesetenv.c ../glibc-2.3/sysdeps/x86_64/fpu/fesetenv.c
--- glibc-2.2.93/sysdeps/x86_64/fpu/fesetenv.c	Wed Sep 19 06:23:17 2001
+++ ../glibc-2.3/sysdeps/x86_64/fpu/fesetenv.c	Sat Sep 14 09:41:01 2002
@@ -1,5 +1,5 @@
 /* Install given floating-point environment.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -87,3 +87,4 @@
   /* Success.  */
   return 0;
 }
+libm_hidden_def (fesetenv)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/x86_64/fpu/fraiseexcpt.c ../glibc-2.3/sysdeps/x86_64/fpu/fraiseexcpt.c
--- glibc-2.2.93/sysdeps/x86_64/fpu/fraiseexcpt.c	Wed Sep 19 06:23:17 2001
+++ ../glibc-2.3/sysdeps/x86_64/fpu/fraiseexcpt.c	Sat Sep 14 09:41:01 2002
@@ -1,5 +1,5 @@
 /* Raise given exceptions.
-   Copyright (C) 2001 Free Software Foundation, Inc.
+   Copyright (C) 2001, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
 
    The GNU C Library is free software; you can redistribute it and/or
@@ -117,3 +117,4 @@
   /* Success.  */
   return 0;
 }
+libm_hidden_def (feraiseexcept)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/x86_64/fpu/s_expm1l.S ../glibc-2.3/sysdeps/x86_64/fpu/s_expm1l.S
--- glibc-2.2.93/sysdeps/x86_64/fpu/s_expm1l.S	Wed Sep 19 06:24:08 2001
+++ ../glibc-2.3/sysdeps/x86_64/fpu/s_expm1l.S	Sat Sep 14 09:41:01 2002
@@ -1,5 +1,5 @@
 /* ix87 specific implementation of exp(x)-1.
-   Copyright (C) 1996, 1997, 2001 Free Software Foundation, Inc.
+   Copyright (C) 1996, 1997, 2001, 2002 Free Software Foundation, Inc.
    This file is part of the GNU C Library.
    Contributed by Ulrich Drepper <drepper@cygnus.com>, 1996.
    Based on code by John C. Bowman <bowman@ipp-garching.mpg.de>.
@@ -80,4 +80,5 @@
 	fldl	MO(minus1)	// Set result to -1.0.
 3:	ret
 END(__expm1l)
+libm_hidden_def (__expm1l)
 weak_alias (__expm1l, expm1l)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/sysdeps/x86_64/fpu/s_finitel.S ../glibc-2.3/sysdeps/x86_64/fpu/s_finitel.S
--- glibc-2.2.93/sysdeps/x86_64/fpu/s_finitel.S	Sat Jul  6 11:07:10 2002
+++ ../glibc-2.3/sysdeps/x86_64/fpu/s_finitel.S	Sat Sep 14 09:41:01 2002
@@ -12,5 +12,5 @@
 	shrl	$31, %eax
 	ret
 END (__finitel)
-strong_alias(__finitel, __finitel_internal)
 weak_alias (__finitel, finitel)
+hidden_def (__finitel)
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/test-skeleton.c ../glibc-2.3/test-skeleton.c
--- glibc-2.2.93/test-skeleton.c	Tue Jul 23 19:15:19 2002
+++ ../glibc-2.3/test-skeleton.c	Sat Sep 14 09:40:45 2002
@@ -263,8 +263,17 @@
   if (WTERMSIG (status) != EXPECTED_SIGNAL)
     {
       if (EXPECTED_SIGNAL != 0)
-	fprintf (stderr, "Incorrect signal from child: got `%s', need `%s'\n",
-		 strsignal (WTERMSIG (status)), strsignal (EXPECTED_SIGNAL));
+	{
+	  if (WTERMSIG (status) == 0)
+	    fprintf (stderr,
+		     "Expected signal '%s' from child, got none\n",
+		     strsignal (EXPECTED_SIGNAL));
+	  else
+	    fprintf (stderr,
+		     "Incorrect signal from child: got `%s', need `%s'\n",
+		     strsignal (WTERMSIG (status)),
+		     strsignal (EXPECTED_SIGNAL));
+	}
       else
 	fprintf (stderr, "Didn't expect signal from child: got `%s'\n",
 		 strsignal (WTERMSIG (status)));
diff -urN -x CVS -x .cvsignore -x *texi -x *manual* glibc-2.2.93/wcsmbs/wcsmbsload.c ../glibc-2.3/wcsmbs/wcsmbsload.c
--- glibc-2.2.93/wcsmbs/wcsmbsload.c	Mon Sep  2 15:45:55 2002
+++ ../glibc-2.3/wcsmbs/wcsmbsload.c	Thu Sep  5 19:28:03 2002
@@ -166,10 +166,7 @@
       /* Allocate the gconv_fcts structure.  */
       new_fcts = malloc (sizeof *new_fcts);
       if (new_fcts == NULL)
-	{
-	failed:
-	  new_category->private.ctype = &__wcsmbs_gconv_fcts_c;
-	}
+	goto failed;
 
       /* Get name of charset of the locale.  */
       charset_name = new_category->values[_NL_ITEM_INDEX(CODESET)].string;
@@ -201,11 +198,15 @@
 	    __gconv_close_transform (new_fcts->towc, new_fcts->towc_nsteps);
 
 	  free (new_fcts);
-	  goto failed;
-	}
 
-      new_category->private.ctype = new_fcts;
-      new_category->private.cleanup = &_nl_cleanup_ctype;
+	failed:
+	  new_category->private.ctype = &__wcsmbs_gconv_fcts_c;
+	}
+      else
+	{
+	  new_category->private.ctype = new_fcts;
+	  new_category->private.cleanup = &_nl_cleanup_ctype;
+	}
     }
 
   __libc_lock_unlock (__libc_setlocale_lock);
